<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Some Python features you may not have known about</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 I was very fond of Python after reading Mark Lutz‚Äôs book, Learning Python. The language is very beautiful, it's nice to write and express y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Some Python features you may not have known about</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  I was very fond of Python after reading Mark Lutz‚Äôs book, Learning Python.  The language is very beautiful, it's nice to write and express your own ideas.  A large number of interpreters and compilers, extensions, modules and frameworks indicate that the community is very active and the language is developing.  In the process of learning the language, I had a lot of questions that I carefully googled and tried to understand every construction that I did not understand.  About this we will talk with you in this article, the article is focused on the novice Python developer. <br><br><a name="habracut"></a><br><h4>  Little about terms </h4><br>  Perhaps I'll start with terms that often confuse beginner Python programmers. <br><br>  <i>List comprehensions</i> or list generators return a list.  I have always confused list generators and expressions ‚Äî generators (but not expression generators!).  Agree, the Russian sounds very similar.  Expressions - generators are <i>generator expressions</i> , special expressions that return an iterator, not a list.  Let's compare: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="python hljs">f = (x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">100</span></span>)) <span class="hljs-comment"><span class="hljs-comment">#  -  c = [x for x in xrange(100)] #  </span></span></code> </pre> <br><br>  These are two completely different designs.  The first returns a generator (that is, an iterator), the second is a regular list. <br><br>  <i>Generators</i> or generators are special functions that return an iterator.  To get the generator, you need to return the function value through yield: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lst)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lst: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> i &gt;&gt;&gt; f = prime([<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>]) &gt;&gt;&gt; list(f) [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>] &gt;&gt;&gt; next(f) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; StopIteration &gt;&gt;&gt;</code> </pre><br><br>  By the way, in Python 3.3 there was a new design yield from.  The sharing of yield and for is used so often that the two designs decide to merge. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first, last)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(first, last): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> i <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(first, last)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> range(first, last)</code> </pre><br><br><h4>  What are context managers and what are they for? </h4><br>  Context managers are special constructs that are blocks of code enclosed in a with statement.  The with statement creates a block using the context manager protocol, which we will discuss later in this article.  The simplest function using this protocol is the open () function.  Every time we open a file, we need to close it in order to push the output to disk (in fact, Python calls the close () method automatically, but using it explicitly is a good tone).  For example: <br><br><pre> <code class="python hljs">fp = open(<span class="hljs-string"><span class="hljs-string">"./file.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) fp.write(<span class="hljs-string"><span class="hljs-string">"Hello, World"</span></span>) fp.close()</code> </pre><br><br>  In order not to call the close () method each time, we can use the context manager of the open () function, which automatically closes the file after exiting the block: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">"./file.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fp: fp.write(<span class="hljs-string"><span class="hljs-string">"Hello, World"</span></span>)</code> </pre><br><br>  Here we don‚Äôt need to call the close method each time to push the data into the file.  From this it follows that the context manager is used to perform any actions before entering the block and after exiting it.  But the functionality of context managers does not end there.  In many programming languages, destructors are used for such tasks.  But in Python, if an object is used somewhere else, there is no guarantee that the destructor will be called, since the __del__ method is called only if all references to the object have been exhausted: <br><br><pre> <code class="python hljs">In [<span class="hljs-number"><span class="hljs-number">4</span></span>]: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hello</span></span></span><span class="hljs-class">:</span></span> ...: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__del__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ...: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'destructor'</span></span> ...: In [<span class="hljs-number"><span class="hljs-number">5</span></span>]: f = Hello() In [<span class="hljs-number"><span class="hljs-number">6</span></span>]: c = Hello() In [<span class="hljs-number"><span class="hljs-number">7</span></span>]: e = Hello() In [<span class="hljs-number"><span class="hljs-number">8</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> e destructor In [<span class="hljs-number"><span class="hljs-number">9</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> c destructor In [<span class="hljs-number"><span class="hljs-number">10</span></span>]: c = f In [<span class="hljs-number"><span class="hljs-number">11</span></span>]: e = f In [<span class="hljs-number"><span class="hljs-number">12</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> f <span class="hljs-comment"><span class="hljs-comment"># &lt;-   </span></span></code> </pre><br><br>  We will solve this problem through context managers: <br><br><pre> <code class="python hljs">In [<span class="hljs-number"><span class="hljs-number">1</span></span>]: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hello</span></span></span><span class="hljs-class">:</span></span> ...: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__del__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ...: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> ...: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> ...: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'  '</span></span> ...: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__exit__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, exp_type, exp_value, traceback)</span></span></span><span class="hljs-function">:</span></span> ...: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'  '</span></span> ...: In [<span class="hljs-number"><span class="hljs-number">2</span></span>]: f = Hello() In [<span class="hljs-number"><span class="hljs-number">3</span></span>]: c = f In [<span class="hljs-number"><span class="hljs-number">4</span></span>]: e = f In [<span class="hljs-number"><span class="hljs-number">5</span></span>]: d = f In [<span class="hljs-number"><span class="hljs-number">6</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> d In [<span class="hljs-number"><span class="hljs-number">7</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> e In [<span class="hljs-number"><span class="hljs-number">8</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> c In [<span class="hljs-number"><span class="hljs-number">9</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> f <span class="hljs-comment"><span class="hljs-comment"># &lt;-           </span></span></code> </pre><br><br>  Now let's try calling the context manager: <br><br><pre> <code class="python hljs">In [<span class="hljs-number"><span class="hljs-number">10</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Hello(): ....: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u' '</span></span> ....:         </code> </pre><br><br>  We saw that there was a guaranteed exit from the block after the execution of our code. <br><br><h4>  Context manager protocol </h4><br>  We have already briefly reviewed the context manager's protocol by writing a small Hello class.  Let's now look at the protocol in more detail.  In order for an object to become a context manager in its class, it is necessary to include two methods: __enter__ and __exit__.  The first method is performed before entering the block.  The method can return the current instance of the class so that it can be accessed using the as statement. <br><br>  The __exit__ method is executed after exiting the with block, and it contains three parameters ‚Äî exp_type, exp_value, and exp_tr.  The context manager can catch the exceptions that were raised in the with block.  We can catch only the exceptions we need or suppress unnecessary ones. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Open</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, file, flag)</span></span></span><span class="hljs-function">:</span></span> self.file = file self.flag = flag <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self.fp = open(self.file, self.flag) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> IOError: self.fp = open(self.file, <span class="hljs-string"><span class="hljs-string">"w"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.fp <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__exit__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, exp_type, exp_value, exp_tr)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    IOError """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exp_type <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> IOError: self.fp.close() <span class="hljs-comment"><span class="hljs-comment">#   return True self.fp.close() #   with Open("asd.txt", "w") as fp: fp.write("Hello, World\n")</span></span></code> </pre><br><br>  The variable exp_type contains the exception class that was raised, exp_value is the exception message.  In the example, we close the file and suppress the IOError exception by returning True to the __exit__ method.  We allow all other exceptions in the block.  As soon as our code comes to an end and the block ends, the self.fp.close () method is called, regardless of which exception was raised.  By the way, such exceptions as NameError, SyntaxError can be suppressed inside the with block, but this should not be done. <br><br>  The context manager protocols are very easy to use, but for common tasks there is an even simpler way that comes with the standard python library.  Next we look at the contextlib package. <br><br><h4>  Package contextlib </h4><br>  Creating contextual managers in the traditional way, that is, writing classes with __enter__ and __exit__ methods is not one of the complicated tasks.  But for a trivial code, writing such classes takes more work.  For these purposes, the contextmanager () decorator, which is part of the contextlib package, was invented.  Using the contextmanager () decorator, we can make a context manager from a normal function: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> contextlib @contextlib.contextmanager <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'  '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> RuntimeError, err: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'error: '</span></span>, err <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'  '</span></span></code> </pre><br><br>  Check the code performance: <br><br><pre> <code class="python hljs">In [<span class="hljs-number"><span class="hljs-number">8</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> context() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> fp: ...: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u''</span></span> ...:       </code> </pre><br><br>  Let's try to raise an exception inside the block. <br><br><pre> <code class="python hljs">In [<span class="hljs-number"><span class="hljs-number">14</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> context() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> value: ....: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> RuntimeError, <span class="hljs-string"><span class="hljs-string">'Error'</span></span> ....:    error: Error    In [<span class="hljs-number"><span class="hljs-number">15</span></span>]:</code> </pre><br><br>  As you can see from the example, the implementation using classes is practically no different in functionality from the implementation using the contextmanager () decorator, but using the decorator greatly simplifies our code. <br><br>  Another interesting example of using contextmanager () decorator: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> contextlib @contextlib.contextmanager <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bold_text</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;b&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-comment"><span class="hljs-comment">#    with   print '&lt;/b&gt;' with bold_text(): print "Hello, World"</span></span></code> </pre><br><br>  Result: <br><pre> <code class="python hljs">&lt;b&gt;Hello, World&lt;/b&gt;</code> </pre> <br><br>  Doesn't it look like blocks in ruby? <br><br>  And finally, let's talk about nested contexts.  Nested contexts allow you to manage multiple contexts simultaneously.  For example: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> contextlib @contextlib.contextmanager <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'   %s'</span></span> % (name) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> name <span class="hljs-comment"><span class="hljs-comment">#   print u'   %s' % (name) with contextlib.nested(context('first'), context('second')) as (first, second): print u'  %s %s' % (first, second)</span></span></code> </pre><br><br>  Result: <br><br>  enter context first <br>  context entry second <br>  inside block first second <br>  out of context second <br>  out of context first <br><br>  Similar code without using the nested function: <br><br><pre> <code class="python hljs">first, second = context(<span class="hljs-string"><span class="hljs-string">'first'</span></span>), context(<span class="hljs-string"><span class="hljs-string">'second'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> first <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> first: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> second <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> second: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'  %s %s'</span></span> % (first, second)</code> </pre><br><br>  Although this code is similar to the previous one, in some situations it will not work as we would like.  The context ('first') and context ('second') objects are called before entering the block, so we will not be able to catch the exceptions that were raised in these objects.  Agree, the first option is much more compact and looks more beautiful.  But in Python 2.7 and 3.1, the nested function is outdated and a new syntax for nested contexts has been added: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> context(<span class="hljs-string"><span class="hljs-string">'first'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> first, context(<span class="hljs-string"><span class="hljs-string">'second'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> second: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">u'  %s %s'</span></span> % (first, second)</code> </pre><br><br><h4>  range and xrange in Python 2.7 and Python 3 </h4><br>  It is known that Python 2.7 range returns a list.  I think everyone will agree that storing large amounts of data in memory is impractical, so we use the xrange function, which returns an xrange object that behaves almost the same as the list, but does not store all of the issued items in memory.  But I was a little surprised by the xrange behavior in Python 2.x when large values ‚Äã‚Äãare passed to functions.  Let's look at an example: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>f = xrange(<span class="hljs-number"><span class="hljs-number">1000000000000000000000</span></span>) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; OverflowError: Python int too large to convert to C long &gt;&gt;&gt;</code> </pre><br><br>  Python tells us that int is too long and cannot be converted to C long.  It turns out that Python 2.x has restrictions on the integer, which we can be sure of by looking at the sys.maxsize constant: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys &gt;&gt;&gt; sys.maxsize <span class="hljs-number"><span class="hljs-number">9223372036854775807</span></span> &gt;&gt;&gt;</code> </pre><br><br>  Here it is the maximum value of an integer: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys &gt;&gt;&gt; sys.maxsize+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">9223372036854775808L</span></span> &gt;&gt;&gt;</code> </pre><br><br>  Python neatly converted our number to a long int.  Don't be surprised if xrange in Python 2.x behaves differently for large values. <br><br>  In Python 3.3, the integer can be infinitely large, let's check: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys &gt;&gt;&gt; sys.maxsize <span class="hljs-number"><span class="hljs-number">9223372036854775807</span></span> &gt;&gt;&gt; range(sys.maxsize+<span class="hljs-number"><span class="hljs-number">1</span></span>) range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">9223372036854775808</span></span>) &gt;&gt;&gt;</code> </pre><br><br>  Conversion to long int did not happen.  Here is another example: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys &gt;&gt;&gt; sys.maxsize + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">9223372036854775808</span></span> &gt;&gt;&gt; f = sys.maxsize + <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt; type(f) &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">'&gt; &gt;&gt;&gt;</span></span></code> </pre><br><br>  In Python 2.7 <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys &gt;&gt;&gt; type(sys.maxsize + <span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;type <span class="hljs-string"><span class="hljs-string">'long'</span></span>&gt; &gt;&gt;&gt;</code> </pre><br><br><h4>  Not obvious behavior of some constructions. </h4><br>  I think everyone will agree that the simplicity of the python lies not in the ease of its study, but in the simplicity of the language itself.  Python is beautiful, flexible and you can write on it not only in object-oriented style, but also in a functional one.  But about the behavior of some structures, which at first glance seem strange, you need to know.  To begin, consider the first example. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>f = [[]] * <span class="hljs-number"><span class="hljs-number">3</span></span> &gt;&gt;&gt; f[<span class="hljs-number"><span class="hljs-number">0</span></span>].append(<span class="hljs-string"><span class="hljs-string">'a'</span></span>) &gt;&gt;&gt; f[<span class="hljs-number"><span class="hljs-number">1</span></span>].append(<span class="hljs-string"><span class="hljs-string">'b'</span></span>) &gt;&gt;&gt; f[<span class="hljs-number"><span class="hljs-number">2</span></span>].append(<span class="hljs-string"><span class="hljs-string">'c'</span></span>) &gt;&gt;&gt;</code> </pre><br><br>  What will be the result of this design?  The untrained developer will report the result: [['a'], [b '], [c']].  But actually we get: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> f [[<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>], [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>], [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>]] &gt;&gt;&gt;</code> </pre><br><br>  Why is the result duplicated in each list?  The fact is that the multiplication operator creates links within our list to the same list.  It is easy to be convinced of it a little having added our example: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>c = [[], [], []] &gt;&gt;&gt; hex(id(c[<span class="hljs-number"><span class="hljs-number">0</span></span>])), hex(id(c[<span class="hljs-number"><span class="hljs-number">1</span></span>])), hex(id(c[<span class="hljs-number"><span class="hljs-number">2</span></span>])) (<span class="hljs-string"><span class="hljs-string">'0x104ede7e8'</span></span>, <span class="hljs-string"><span class="hljs-string">'0x104ede7a0'</span></span>, <span class="hljs-string"><span class="hljs-string">'0x104ede908'</span></span>) &gt;&gt;&gt; &gt;&gt;&gt; hex(id(f[<span class="hljs-number"><span class="hljs-number">0</span></span>])), hex(id(f[<span class="hljs-number"><span class="hljs-number">1</span></span>])), hex(id(f[<span class="hljs-number"><span class="hljs-number">2</span></span>])) (<span class="hljs-string"><span class="hljs-string">'0x104ede710'</span></span>, <span class="hljs-string"><span class="hljs-string">'0x104ede710'</span></span>, <span class="hljs-string"><span class="hljs-string">'0x104ede710'</span></span>) &gt;&gt;&gt;</code> </pre><br><br>  In the first case, everything is fine and the references to the lists are different, and in the second example we refer to the same object.  From this it follows that a change in the first list will entail a change in the subsequent ones, so be careful. <br><br>  The second example was already considered on Habr√©, but I wanted to include it in the article.  Let's look at lambda, the function that we will run through the for loop, and put each function in the dictionary: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>tmp = {} &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): ... tmp[i] = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: i &gt;&gt;&gt; tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>]() <span class="hljs-number"><span class="hljs-number">9</span></span> &gt;&gt;&gt; tmp[<span class="hljs-number"><span class="hljs-number">1</span></span>]() <span class="hljs-number"><span class="hljs-number">9</span></span> &gt;&gt;&gt;</code> </pre><br><br>  Within the lambda function, the variable i is closed and an instance of another variable i is created in the lambda block, a function that is a reference to the variable i in the for loop.  Every time the for loop counter changes, the values ‚Äã‚Äãin all lambda functions also change, so we get the value of i-1 in all functions.  It is easy to fix this by explicitly passing the default value of the i variable to the lambda function as the first parameter: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>tmp = {} &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">10</span></span>): ... tmp[i] = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> i = i: i &gt;&gt;&gt; tmp[<span class="hljs-number"><span class="hljs-number">0</span></span>]() <span class="hljs-number"><span class="hljs-number">0</span></span> &gt;&gt;&gt; tmp[<span class="hljs-number"><span class="hljs-number">1</span></span>]() <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;&gt;&gt;</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/196382/">https://habr.com/ru/post/196382/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196372/index.html">Features of embedding in key mechanisms of Linux kernel using LSM</a></li>
<li><a href="../196374/index.html">Simple words about Fourier transform</a></li>
<li><a href="../196376/index.html">How to make a module 1C-Bitrix</a></li>
<li><a href="../196378/index.html">One Platform Foundation: AppDF and OpenIAB Overview</a></li>
<li><a href="../196380/index.html">Cline and creating an interactive command line application</a></li>
<li><a href="../196384/index.html">The epic of the WD My Book Live, or "device-sweetie" with "cookies"</a></li>
<li><a href="../196388/index.html">How Mail.Ru Group Kills AAA-Class MMO Games</a></li>
<li><a href="../196390/index.html">Generalization task</a></li>
<li><a href="../196394/index.html">Mistress of the present - integrated graphics (Intel GPU) 2013 or "mylophone with me!"</a></li>
<li><a href="../196396/index.html">Group editing of resources (documents) using MIGXDB</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>