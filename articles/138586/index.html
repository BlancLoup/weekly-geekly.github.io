<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Here be dragons</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Looking through the materials of the GoingNative 2012 conference (which I strongly advise all C ++ programmers to look at), I noticed one example of c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Here be dragons</h1><div class="post__text post__text-html js-mediator-article">  Looking through the materials of the <a href="http://channel9.msdn.com/Events/GoingNative/GoingNative-2012/">GoingNative 2012</a> conference (which I strongly advise all C ++ programmers to look at), I noticed one example of code: <br><img src="https://habrastorage.org/storage2/e6e/b89/aa4/e6eb89aa469662d5662702eed8de27ac.png" align="right"><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; struct S { int n; }; struct X { X(int) {} }; void f(void*) { std::cerr &lt;&lt; "Pointer!\n"; } void f(X) { std::cerr &lt;&lt; "X! \n"; } int main() { f(S().n); }</span></span></span></span></code> </pre> <br>  Can you, without looking back, say what this program prints and most importantly, <b>why</b> ? <br><br>  Under the cut, Google‚Äôs <a href="http://ru.wikipedia.org/wiki/Clang">Clang</a> developer‚Äôs suggestion about why this code works the way it works.  Once again, who did not catch it: the <a href="http://channel9.msdn.com/Events/Speakers/Chandler-Carruth">developer of the</a> C ++ compiler from Google does not know this for sure, it just has a guess. <br><a name="habracut"></a><br><h4>  Answer </h4><br>  When compiling in accordance with standard C ++ 98, this code will print " <b>X!</b> ", When compiled in accordance with standard C ++ 11, this code will print " <b>Pointer!</b> ". <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># clang++ -std=c++98 -g -o cxx11-4 cxx11-4.cpp # ./cxx11-4 X! # clang++ -std=c++11 -g -o cxx11-4 cxx11-4.cpp # ./cxx11-4 Pointer!</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Question to the developers of the standard C ++ 11 </h4><br><img src="http://habrastorage.org/storage2/d5d/b16/e8d/d5db16e8d2fe38c0973763de7fd0c37c.jpg"><br><br><h4>  Explanations </h4><br>  Let's look carefully at the line <br><br><pre> <code class="cpp hljs">f(S().n);</code> </pre><br>  As you can see, a copy of the S structure is created here. It does not have an explicit constructor, which means that the default constructor is called.  And here comes the C ++ 11 standard with its advanced support for constant expressions ( <a href="http://en.wikipedia.org/wiki/C%252B%252B11">Generalized constant expressions</a> ).  Any function (including a constructor) in C ++ 11 can be declared as always returning the same expression.  This is done to enable the writing of such code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_five</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> some_value[get_five() + <span class="hljs-number"><span class="hljs-number">7</span></span>];</code> </pre><br>  Constant expressions are used in array declarations, in enums, in switch \ case blocks.  And the C ++ 11 compiler tries any function that can be constant, to consider it exactly constant, in order to be able to use it in all these places.  And what about the constructor of the structure <b>S</b> ?  Well, if he assigns a certain number to a variable <b>n</b> (and the standard does not prohibit this), then it can also be a constant expression.  And why would he assign <b>n</b> different values ‚Äã‚Äãeach time?  Assigns zero.  Why exactly zero?  Do you have any smarter meaning on your mind? <br>  So, the above line is equivalent to: <br><br><pre> <code class="cpp hljs">f(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  Well, as we know, this is completely equivalent: <br><br><pre> <code class="cpp hljs">f(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);</code> </pre><br>  This is converted to <b>void *</b> rather than to <b>struct X</b> (even with the appropriate constructor <b>X (int)</b> ).  And here we have an explicit call <b>void f (void *)</b> !  Well printed " <b>Pointer!</b> ". <br><br>  Why is this not happening in a compiler with C ++ 98 support?  Yes, because he does not have this very advanced support for constant expressions.  The default constructor of the structure <b>S</b> has no reason to set the <b>n</b> property to zero (the standard does not require this).  Well, he does not.  So the string <b>f (S (). N);</b>  cannot be uniquely converted to <b>f (0);</b>  with all the ensuing consequences. <br><br><h4>  Conclusion </h4><br>  Standard C ++ 11 is new, its support in compilers is also still raw.  Be prepared for similar surprises. </div><p>Source: <a href="https://habr.com/ru/post/138586/">https://habr.com/ru/post/138586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138576/index.html">Release stable version of Apache 2.4</a></li>
<li><a href="../138577/index.html">Why we created Julia, the new YAP for technical computing</a></li>
<li><a href="../138580/index.html">In-line editing tabular data in ASP.Net MVC 3</a></li>
<li><a href="../138582/index.html">Creating Gems - Guide</a></li>
<li><a href="../138585/index.html">Once again about Bridge (in pictures)</a></li>
<li><a href="../138587/index.html">I like vs like</a></li>
<li><a href="../138590/index.html">How to rollback commits on github.com</a></li>
<li><a href="../138591/index.html">What does "> / dev / null 2> & 1" mean?</a></li>
<li><a href="../138592/index.html">Compiling header files or documentation for free</a></li>
<li><a href="../138593/index.html">Semi-Prezi in 10 minutes in .NET and WPF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>