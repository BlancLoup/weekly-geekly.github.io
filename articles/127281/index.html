<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bypassing the integrated protection of PIC microcontrollers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the comments to the recent topic about opening the processor, an article was mentioned about how it was possible to bypass the built-in protection ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bypassing the integrated protection of PIC microcontrollers</h1><div class="post__text post__text-html js-mediator-article">  In the comments to the recent <a href="http://habrahabr.ru/blogs/easyelectronics/127205/">topic</a> about opening the processor, an article was mentioned about how it was possible to bypass the built-in protection against reading the microcontroller firmware (the so-called Fuse bits).  I liked it, below - translation with some additions and explanations. <br><br><h4>  Hacking MK PIC18F1320 </h4><br>  I thought it would be nice to try some of the PIC microcontroller hacking techniques I've heard about.  Typically, PIC microcontrollers have a number of so-called fuse-bits, which serve to protect against reading or modification of some parts of the memory.  However, there are times when it becomes necessary to read the contents of an already programmed and protected controller (legally).  A typical example is the loss by a company of technical documentation on a device, or the dismissal of those people who originally developed a secure microcontroller firmware.  This also often happens when a company wants to update its product line. <h6>  Well, you know, there are still some situations where such skills can come in handy. </h6><br><br><a name="habracut"></a>  I bought four PIC18F1320 and started tormenting them.  This is what the PIC18F1320 looks like in its original, not peeled form: <br><img src="https://habrastorage.org/getpro/geektimes/post_images/718/e46/cec/718e46cecaff64dc9a310b7704c74676.jpg" alt="image"><br>  The first thing to do is to open the upper part of the case so that the silicon interiors of the microcontroller become available.  Although there are many amateur ways to do this, they are usually based on the use of nitric or sulfuric acid.  First, it is most likely not the things that you really want to see next to you.  Secondly, they are not easy to get, because, for example, nitric acid is one of the components for the manufacture of explosives.  I decided that the easiest and most reliable way was to send microcontrollers to a failure analysis lab, such as <a href="http://www.mefas.com/">MEFAS</a> , and get the ‚Äúdecapitated‚Äù components into my hands for $ 50 and 2 days.  For this project, I removed the compound from three microcontrollers.  Two of them remained completely working, and one lost the case completely, i.e.  there was only the chip itself.  This was dictated by the design features of my microscope at high magnifications. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/f65/0d1/fda/f650d1fdab390fd1272b9dbfa6b69a8e.jpg" alt="image"><br>  A brief examination of the chip surface revealed some of the characteristic areas of the microcontroller, shown below: <br> <a href="http://bunniestudios.com/blog/images/pic/fullchip_labels.pdf"><img src="https://habrastorage.org/getpro/geektimes/post_images/3fe/dcd/716/3fedcd716157a2d088c0856257946354.jpg"></a> <br>  Visible (clockwise): 8 KB flash-memory, reference voltage source, <a href="http://en.wikipedia.org/wiki/Charge_pump">charge pump</a> for programming flash / EEPROM memory, 256 bytes EEPROM memory, built-in timers and clocking circuits, computing core, ROM with microcode, array with fuse-bits, 256 bytes of RAM, ADC.  ( <h6>  it would be very interesting to learn how he defined all this by his appearance </h6> ) <br>  One structure immediately caught my attention: a series of metal screens above the transistors, which were arranged in the correct order, and the number of which coincided with the number of fuse-bits.  The complete overlap of elements with metal screens on silicon crystals is very rare, and by itself such elements attract attention because  contain something extremely important. <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/d90/061/287/d90061287d36113d68f918708277a817.jpg"></a> <br>  Think a little about these metal screens.  What are they needed for?  First, let's recall some interesting facts about flash technology (this type of memory is also used in PIC microcontrollers for storing fuse bits).  Flash technology involves the use of floating gate transistors, very similar to those used in old ROM chips with IF-erasing (do you remember the 2616s in a ceramic case and with quartz glass?).  Both in flash and in UV-EPROM, data is saved by injecting electrons into the floating gate using a tunnel effect, where these electrons can be located for decades.  Additional electrons in the floating gate create noticeable changes in the characteristics of the transistor.  The difference lies in the fact that in flash-memory for erasing information enough electrical pulses, while in the UV-EPROM in order to "expel" the electrons from the floating gate photons are needed with high energy.  This requires ultraviolet from a wavelength of about 250 nm.  In order to UV radiation is not too weakened, apply quartz glass (the same windows on the old ROM chips). <br>  An important conclusion that can be drawn from the above facts: flash memory can <i>also</i> be erased with UV radiation, because  it has almost the same transistor structure as the device's UV-EPROM.  The case of devices with flash memory usually prevents UV from reaching the surface of the crystal, but since our PIC microcontroller is now deprived of a plastic top of the case, we can apply UV radiation and see what happens. <br>  I conducted an experiment in which I programmed the PIC controller with consecutive values ‚Äã‚Äãfrom 0x00 to 0xFF, and then exposed it to my UV-EPROM eraser while taking a shower and checking mail. <br>  When I removed the controller from the eraser, I found that the flash memory was indeed cleared and returned to its original state (all values ‚Äã‚Äãare 0xFF), and that the protective fuse bits were also deactivated.  It should also be borne in mind that UV radiation acts on the EEPROM memory. <br>  It is clear that the metal plates above the protective fuse-bits just serve as protection against dumping them separately from the flash-memory of programs. <br> <a href=""><img src="https://habrastorage.org/getpro/geektimes/post_images/89d/286/1d4/89d2861d44dcc7448ea2a6c7c4e8cb94.gif"></a> <br>  The picture illustrates the problem (and its solution) that I encountered.  In order to erase the information on the flash memory transistor, strong UV radiation must reach its floating gate.  And metal screens prevent this by effectively reflecting UV rays. <br>  However, due to the difference between the refractive indices of light for oxide and silicon, the light falling from a certain angle will be reflected from its surface.  To better understand this effect you can jump into the pool and look at the water almost at eye level.  Water will have a very good reflectivity just because of the difference in the refractive indices of water and air.  This is called total internal reflection. <br>  This reflection can just be used to cause UV radiation to reflect off the metal surface of the screen and fall back onto the floating gate of the transistor.  So, turning the PIC microcontroller inside the eraser ROM, I can direct enough light so that it bounces around the flash memory transistor and erasing it.  After several attempts, I developed a technology that seems to work quite well. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/225/25b/27f/22525b27f533ff273685c3439cdbd60e.jpg"><br>  This is a photo of the microcontroller inside the eraser ROM (the blue glow around the controller is due to the operation of the UV lamp).  The microcontroller is fixed at an angle in the antistatic material. <br>  But all this can not protect against erasing the necessary data in the part of the flash-memory where the microcontroller program is stored.  In order to prevent erasing of these data, a full mask is used, which was very carefully cut out of electrical tape and attached to the crystal with two tweezers, a microscope and an unwavering hand) The electrical tape effectively blocks the passage of ultraviolet radiation, thereby protecting absorbs ultraviolet reflected from the silicon substrate. <br><img src="https://habrastorage.org/getpro/geektimes/post_images/06f/b4f/5bc/06fb4f5bcc5e5da1864207db6d34521a.jpg" alt="image"><br>  This is a photo of a crystal with an attached mask over the flash memory area. <br>  Using this technique, I was finally able to reset the protection fuse-bits without erasing the main program of the microcontroller.  The same way you can erase only some of the flash-memory.  Hooray! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Remarks </h5><br>  Obviously, the described method is suitable only for those devices that contain reprogrammable fuse-bits.  If the protection bits are programmed only once (and this happens), then this technique is not suitable.  In these devices, thin conductors on a chip are simply burned out.  However, my colleague said that even in this case, their own methods of struggle were developed (I think, they restore contact in some similar microsurgical manner).  I also know that this operation is worth a lot. <br>  Just want to note that in the popularly popular AVR microcontrollers fuse-bits have a similar structure (they are reprogrammed in the same way), which allows us to hope that the described technique is suitable for them! <br><br>  <b>UPD:</b> corrected the translation flaws whenever possible (about the width of the forbidden zone, magnetic tape and the method of filling the controller memory). <br><br>  <b>UPD 2:</b> the same topic, but for AVR microcontrollers, is affected <a href="http://www.avrfreaks.net/index.php%3Fname%3DPNphpBB2%26file%3Dprintview%26t%3D19790%26start%3D0">here</a> and <a href="http://www.cl.cam.ac.uk/~sps32/mcu_lock.html">here</a> .  Here you can order reading the firmware and even buy specials.  appliances. <br><br>  Original article <a href="http://www.bunniestudios.com/blog/%3Fpage_id%3D40">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/127281/">https://habr.com/ru/post/127281/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127271/index.html">Zend_Db_Table ease of use</a></li>
<li><a href="../127273/index.html">Obtaining zero statistical information in the absence of source data</a></li>
<li><a href="../127274/index.html">Emulate network problems with WANem</a></li>
<li><a href="../127275/index.html">SCLOG: a bike with all the features of a programming language</a></li>
<li><a href="../127276/index.html">Language for working with ActionScript events</a></li>
<li><a href="../127282/index.html">SymmetricDS based PostgreSQL database replication</a></li>
<li><a href="../127285/index.html">Keymaster.js: a simple micro-library for hot keys</a></li>
<li><a href="../127286/index.html">Analyzing system performance</a></li>
<li><a href="../127287/index.html">"Cloud" as an alternative to traditional hosting</a></li>
<li><a href="../127288/index.html">Visualization of intra-class relationships using GraphViz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>