<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Netgear WNR3500L: Turning a router into a NAS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The purchase history of the router Netgear WNR3500L is similar to the proverb of motorists: car tuning begins after an accident. So in my case. An old...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Netgear WNR3500L: Turning a router into a NAS</h1><div class="post__text post__text-html js-mediator-article">  The purchase history of the router Netgear WNR3500L is similar to the proverb of motorists: car tuning begins after an accident.  So in my case.  An old and buggy D-Link DIR300 died the death of the brave (most likely overheating from the load).  Since he worked, to put it mildly, unsatisfactorily, it was decided to buy a more powerful and modern piece of metal. <br><br>  Among the applicants were 3 models: Asus N16, Linksys WRT160NL and Netgear WNR3500L.  All of them met several criteria: fast processor, a lot of RAM, USB for connecting a hard disk and the ability to install alternative firmware.  Despite the great love of the Linksys brand, the choice fell towards Netgear.  The reason is simple: linksysis was simply not available anywhere, I bought the asus right in front of my nose, and the router was very necessary.  As a drive was chosen 3.5 ‚ÄùWD Elements at 1.5TB. <br><br>  WNR3500L is positioned by Netgear as an open source router.  The most popular firmware for it is Tomato, OpenWRT and DD-WRT.  I stopped at DD-WRT.  I liked it both in speed and in functionality, which is extended by installing Optware packages.  Earlier, the topic of installing Samba on DD-WRT (right <a href="http://habrahabr.ru/blogs/DIY/98812/">here</a> ) was already revealed in Habr√©, but in this topic I will try to solve the issue of installation and initial configuration of this router as much as possible according to the method that our foreign colleagues call ‚ÄúThe Right Way‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Step one: Install DD-WRT. </h4><br><br>  First we follow the <a href="http://www.dd-wrt.com/site/support/router-database">link</a> and type in the model of the router in the search box.  Next, select from the found a specific model.  In my case, this is the WNR3500L.  Now you need to download 2 files: the actual firmware and Netgear WNR3500L Firmware: Special File for initial flashing.  Since the flash memory in the router is as much as 8MB, I chose the NEWD K2.6 Big Generic firmware. <br>  Now everything is ready for the firmware.  Since the router "out of the box" does not understand the firmware in * .bin format, we first <b>d-wrt.v24-14896_NEWD-2_K2.6_mini-WNR3500L.chk</b> .  Go to the router (192.168.1.1 by default) in the section "Update router", select * .chk and click "Download". <br><br><img src="http://netgear.ru/upload/opensource/Updating.JPG" alt="image"><br><br>  Now we just wait and do nothing.  After the update is complete, you need to reset the router using the hardware button and wait for the download.  Again we go to the router and see the DD-WRT web interface asking to enter a new password. <br><br><img src="http://netgear.ru/upload/opensource/Password.JPG" alt="image"><br><br>  After entering the password, go to the Administration&gt; Firmware Upgrade section, select the fully-fledged firmware in * .bin format and click Upgrade. <br><br><img src="http://netgear.ru/upload/opensource/Complete_2.JPG" alt="image"><br><br>  After a few minutes, enjoy the result.  Next, we proceed to setting up an Internet connection, but since the settings are different for each provider, I don‚Äôt see any reason to describe this process in detail, they are as simple as setting up any other router.  In my case, this is VPN via PPTP.  All Internet connection settings are on the Setup&gt; Basic Setup tab. <br><br><h4>  Step Two: Preparing the Disk and Installing Samba </h4><br><br>  In order for the disk to be correctly mounted to the system, it must be properly partitioned and formatted.  For the disk we will use the ext3 file system.  You can format it in any Linux distribution (the Live CD will do), or directly from under Windows, using disk utilities (Acronis Disk Director Suite or Partition Magic).  I chose the second path.  The disk should be divided into 4 partitions (Primary, or Main in the Russian version), in exactly this order: <br><br><ul><li>  Partituon # 1.  Optware (ext3): mounted on / opt.  Optware packages will be installed here.  Size not less than 512 megabytes. </li><li>  Partituon # 2.  Swap (Linux Swap): swap itself.  Large size is not needed.  128 MB is enough. </li><li>  Partituon # 3.  JFFS (ext3): mounted on / temp.  Size not less than 128 megabytes. </li><li>  Partituon # 4.  Share (ext3): mounted on / mnt.  Actually there will be a ball for samba. </li></ul><br><br>  This procedure is needed for proper automounting in DD-WRT.  Earlier (using the old method), the disk was mounted in / jffs, the mount scripts were written to the startup.  This is no longer needed.  After splitting the disk go to the settings of the router.  The Services&gt; USB tab is shown as follows: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/ec5/8a9/90a/ec58a990a35553792d6519953232bc50.jpg" alt="image"><br><br>  We connect the disk to the router and reboot it with the ‚Äúiron‚Äù button (I did not pick up the disk after the soft reset).  After loading the router, again go to the web interface to the Services&gt; USB tab, and if the previous steps were performed correctly, we see something like the following: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/331/f08/062/331f08062afae461111aa3989374d960.jpg" alt="image"><br><br>  Now we proceed to the installation of samba.  First connect to the router with any telnet client (I used putty) <br><br>  <b>Login:</b> root <br>  <b>Password: the</b> one that you specified at the very beginning in the web interface. <br><br>  and using the mount command, check if the disks were mounted correctly.  Should issue something like this: <br><br> <code>root@berry:~# mount <br> rootfs on / type rootfs (rw) <br> /dev/root on / type squashfs (ro) <br> none on /dev type devfs (rw) <br> proc on /proc type proc (rw) <br> ramfs on /tmp type ramfs (rw) <br> sysfs on /sys type sysfs (rw) <br> devpts on /dev/pts type devpts (rw) <br> devpts on /proc/bus/usb type usbfs (rw) <br> /dev/discs/disc0/part1 on /opt type ext3 (rw,noatime,data=ordered) <br></code> <br><br>  Next is the installation of the basic Optware packages.  For this you need to run the following commands: <br><br> <code><a href="http://wd.mirmana.com/prep_optware"></a> wget -O /tmp/prep_optware wd.mirmana.com/prep_optware <br> sh /tmp/prep_optware</code> <br> <br>  This is probably the longest stage.  On my 4 MB channel, it took about 20 minutes.  After this procedure is completed, you need to wait about 1-2 minutes (temp is cleared), and then restart the router with the <b>reboot</b> command. <br><br>  By rebooting the router, you can check the free space on mounted disks with the <b>df -h command</b> <br><br> <code>root@berry:~# df -h <br> Filesystem Size Used Avail Use% Mounted on <br> rootfs 5.7M 5.7M 0 100% / <br> /dev/root 5.7M 5.7M 0 100% / <br> /dev/discs/disc0/part1 <br> 1010M 387M 573M 41% /opt <br> /dev/sda4 1.4T 19G 1.3T 2% /mnt <br> /dev/sda3 1010M 33M 927M 4% /tmp/c</code> <br> <br>  as well as running services with the <b>service</b> command <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/346/b3c/4f2/346b3c4f2650b231350f1e07a48a85b2.jpg" alt="image"><br><br>  Now you need to update the samba to the latest available version (3.5 at the time of this writing).  Do the following: copy the configs of the old samba <br><br> <code>cp /opt/etc/samba/smb.conf /opt/etc/samba/smb.conf.copy <br> cp /opt/etc/init.d/S80samba /opt/etc/init.d/S80samba.copy</code> <br> <br>  then move the copies to a safe place. <br><br> <code>mv /mnt/smb.conf.copy /opt/etc/samba/smb.conf.copy <br> mv /mnt/S80samba.copy /opt/etc/init.d/S80samba.copy</code> <br> <br>  Next you need to edit the samba config.  Open the copied version. <br><br> <code>vi /opt/etc/samba/smb.conf.copy <br></code> <br><br>  and look for the string <b>interfaces =</b> .  We replace it with <b>interfaces = 192.168.1.1/24</b> .  Save the config and go ahead - stop the samba services <br><br> <code>service samba stop <br> service samba off</code> <br> <br>  remove samba2 and install samba35 + SWAT (web interface). <br><br> <code>ipkg-opt remove samba2 <br> ipkg-opt install samba35 <br> ipkg-opt install samba35-swat</code> <br> <br>  Samba swears at configs, but we do not pay attention to it and continue.  We transfer the copies made earlier to the legal place and we delete configs made by samba35. <br><br> <code>cp /opt/etc/samba/smb.conf.copy /opt/etc/samba/smb.conf <br> cp /opt/etc/init.d/S80samba.copy /opt/etc/init.d/S80samba <br> rm /opt/etc/init.d/S08samba <br> rm /opt/etc/init.d/S80samba.copy</code> <br> <br>  We start samba services <br><br> <code>service samba on <br> service samba start</code> <br> <br>  Reboot and enjoy! <br><br> <code>reboot</code> <br> <br><h4>  Step Three: Configure Samba and Transmission </h4><br><br>  After the reboot, you need to start the xinetd service.  It will allow you to use the samba web interface, which will be available at <a href="http://192.168.1.1:901/">http://192.168.1.1:901</a> . <br><br> <code>service xinetd on <br> service xinetd start</code> <br> <br>  Initially, samba is already configured quite competently.  Those interested can pick it up more, but I did not touch it.  The created samba will be available at \\ 192.168.1.1 \ public.  Next, I advise you to turn off Twonky.  This is a good media server, but it eats an incredible amount of router resources (although you can try using it on the WNDR3700).  All you need is 2 teams. <br><br> <code>service twonky stop <br> service twonky off</code> <br> <br>  He won't bother us anymore.  Now came a series of Transmission torrent client.  First you need to run it <br><br> <code>service transmission on <br> service transmission start</code> <br> <br>  then go to the web interface at <a href="http://192.168.1.1:9091/">http://192.168.1.1:9091</a> and start using!  For more convenient use of the torrent I will advise one good thing - <a href="http://code.google.com/p/transmisson-remote-gui/">Transmisson Remote GUI</a> .  With it you can more fully control the download process.  But the most useful feature is the transfer of torrents.  Transmission initially downloads all files to its folder: / mnt / Torrent / work.  But with the help of Transmisson Remote you can drag them out into the necessary directories after downloading.  I tested the torrent on multiple connections, the results are as follows: the router's processor is loaded 100% (4 MB / s channel) with about 3k connections, but the router does not hang and outwardly does not show any signs of its loading (which is very strange). <br><br>  That's all.  About an hour of time spent converting this router to a NAS.  During the tests of samba, the router showed a speed of approximately 5.5MB / s (over the wire), which I consider sufficient for the functions assigned to it.  Wi-Fi speed is lower.  Screenshot of a small test: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/7f9/01d/2eb/7f901d2eb147473e93902abf614ecc04.jpg" alt="image"><br><br><ul><li>  <b>Channel:</b> Wi-Fi </li><li>  <b>Encryption:</b> WPA2 </li><li>  <b>File:</b> 9Gb * .mkv </li></ul><br><br>  Disabling encryption on Wi-Fi does not give a significant increase in speed.  The average speed is 2.4MB \ sec.  The maximum that managed to squeeze out of Wi-Fi - 3MB \ s (disabled all services except samba).  CPU power - with a margin. <br><br>  I also note that what is described in this topic is not all the capabilities of DD-WRT firmware.  Optware packages allow you to greatly expand the functionality of the device, but do not forget that this is a home router and you should not demand high performance from it with a huge number of connected services.  In all you need to know when to stop. <br><br>  In the next topic, I will describe the configuration of the print and media server on this router.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/111312/">https://habr.com/ru/post/111312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111305/index.html">Receiving and processing SMS messages on a Linux machine</a></li>
<li><a href="../111306/index.html">We use Python in our program</a></li>
<li><a href="../111308/index.html">CANVAS step by step: Basics</a></li>
<li><a href="../111309/index.html">Sony Ericsson XPeria Arc - the most stylish Android smartphone</a></li>
<li><a href="../111311/index.html">Server rental experience in Germany with Server4you</a></li>
<li><a href="../111313/index.html">Simple firewall using puppet</a></li>
<li><a href="../111314/index.html">5 things you might not know about jQuery</a></li>
<li><a href="../111315/index.html">Flash + IntelliJ IDEA</a></li>
<li><a href="../111318/index.html">Zephyr solar drone set three new records</a></li>
<li><a href="../111319/index.html">Non-standard Referer in opera-mini</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>