<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FreeSWITCH PSTN Gateway for Lync Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the easy ways to connect Lync Server to any IP telephony provider. 

 A small but significant obstacle to using Lync Server as the basis of cor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FreeSWITCH PSTN Gateway for Lync Server</h1><div class="post__text post__text-html js-mediator-article">  One of the easy ways to connect Lync Server to any IP telephony provider. <br><br>  A small but significant obstacle to using Lync Server as the basis of corporate telephony can be the peculiarity of its work with the SIP protocol.  The peculiarity is the complete incompatibility with the standards of IP-telephony providers.  Lync Server supports TCP or TLS and cannot transfer credentials, IP-telephony providers, in turn, mostly use UDP and require authentication by login and password. <a name="habracut"></a><br><br><h4>  Task </h4>  Choose the most simple and easy solution for the organization of the gateway.  Ideally, free, stable and under Windows. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Decision </h4>  FreeSWITCH in the smallest possible configuration, sufficient to connect on the one hand with the Lync Server and on the other for authorization with the providers of IP-telephony. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/efc/382/f10/efc382f109edf9e427d9298055436331.png" alt="image"></div><br>  As a basis for solving FreeSWITCH is not chosen by chance.  Ideologically, this is a fairly powerful platform-router of multimedia traffic flows with the ability to connect additional handlers in the form of plug-in modules.  The Lync &lt;-&gt; FreeSWITCH &lt;-&gt; PSTN configuration is the simplest case to follow the FreeSWITCH architectural model. <br><br><h4>  Topology </h4>  It all depends on the configuration of the specific network and the existing load on the telephony.  Both options are viable, both with the installation of FreeSWITCH together with the Mediation Server (or Standard Edition) role, and on a separate server. <br><br><h4>  Customization </h4>  The whole setup process is extremely simple and consists of 3 steps: <ol><li>  <a href="https://habr.com/ru/company/starxoft/blog/205580/">Creating SIP Trunks in Topology Builder</a> </li><li>  <a href="https://habr.com/ru/company/starxoft/blog/205580/">Lync Server Setup</a> </li><li>  <a href="https://habr.com/ru/company/starxoft/blog/205580/">Configure FreeSWITCH</a> </li></ol><br><a name="s1"></a><h5>  Creating SIP Trunks in Topology Builder </h5>  Open an existing topology in Topology Builder.  In the properties of the Mediation Server we enable the TCP port (for example, 5068).  Create a new PSTN Gateway object (the name and address can be specified either as a separate server or as a Mediation in case of a joint installation).  In the SIP trunk parameters, we specify the port on which FreeSWITCH is listening (for example, 6000), the TCP protocol (in this example), the Mediation Server port (5068). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bd/425/fdf/4bd425fdf825427b273483ce7a7c99a8.png" alt="Trunk Parameters"></div><br><br><a name="s2"></a><h5>  Lync Server Setup </h5>  Open the section <b>Voice Routing</b> . <br><br>  In the <b>Trunk Configuration</b> subsection, open the rule <b>Global</b> .  For the parameter <b>Encryption support level,</b> select <b>Not Supported</b> , for the parameter <b>Refer support</b> - <b>None</b> .  Select the <b>Centralized media processing</b> checkbox and remove all others. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/093/2cc/6ef/0932cc6ef5da219acbdc022a4552e1b0.png" alt="image"></div><br><br>  In the <b>Route</b> subsection, we create a rule for routing calls to external numbers on a SIP trunk to our gateway. <br><br><a name="s3"></a><h5>  Configure FreeSWITCH </h5>  Download and install FreeSWITCH.  Delete all the contents of the \ conf folder in the installation directory.  Instead of deleted files, unpack the archive with the configuration (link at the end of the post). <br><br>  In the \ conf \ pstn folder, specify the credentials in the file template for one of the providers and delete the extension ‚Äú.noload‚Äù from it.  If for your provider the template is not in the folder, then you can take any one as a basis and copy it into a file without the ‚Äú.noload‚Äù extension.  As a result, there should remain one or several .xml files with the parameters of the existing providers of IP-telephony. <br><br>  In the freeswitch.xml file, we specify the address (fe.lab.local in our example), port (5068) and protocol (tcp) Lync Mediation Server, local address and port (6000) for connecting to the Lync Mediation Server, local address and port ( 5060, but can be any) to connect to the PSTN provider. <br>  At the end of the file in the "dialplan" section in the context of "from_Lync" for &lt;extension name = "RouteToPSTN"&gt; in the "action" rule, specify the name of the gateway from the profile of the current PSTN provider to which all external calls from Lync will be sent.  If there are several providers, you need to create call routing rules.  You can do this in Lync itself, but this is better described in a separate article. <br><br>  FreeSWITCH can be launched as a console application or as a service.  After making the parameters in the configuration template, you need to start the console application and check if the profiles and gateways are connected.  To do this, run the command in the command line: <br><br><pre><code class="bash hljs">sofia status</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d8/df4/e80/0d8df4e8089ca1092bfe9e9188a7b0fa.png" alt="image"></div><br><br>  If both profiles and gateway (to PSTN) were successfully launched and connected, you can close the console with the command "..." (three points), start and set the delayed autostart service FreeSWITCH. <br><br>  Gateway configured! <br><br><hr>  FreeSWITCH configuration template: <a href="" title="FreeSWITCH PSTN Gateway for Lync Server">freeswitch.conf.lync-pstn.zip</a> . <br><br>  Use on health! <br><br></div><p>Source: <a href="https://habr.com/ru/post/205580/">https://habr.com/ru/post/205580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205566/index.html">By car in the "cloud"</a></li>
<li><a href="../205570/index.html">Object oriented C</a></li>
<li><a href="../205572/index.html">Installing ADB driver for phones of lesser-known manufacturers</a></li>
<li><a href="../205574/index.html">Pair programming as a service</a></li>
<li><a href="../205578/index.html">StartAD.mobi: Greetings</a></li>
<li><a href="../205584/index.html">Payoneer US Payment Service: Important Updates</a></li>
<li><a href="../205586/index.html">Mars One announced the start of a fundraising campaign</a></li>
<li><a href="../205590/index.html">Performance / Cost Comparison for GCE and AWS</a></li>
<li><a href="../205594/index.html">Megaphone is in no hurry to close the old security holes</a></li>
<li><a href="../205598/index.html">Released - Nanocad 5.1 FREE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>