<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java OSM Geocoder</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers of Habr. In this article we will talk 



- About addresses and data storages with fuzzy scheme 
- About the processing of geodata...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java OSM Geocoder</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear readers of Habr.  In this article we will talk <br><br><ul><li>  About addresses and data storages with fuzzy scheme </li><li>  About the processing of geodata in java, namely about the Java Topology Suite </li><li>  About the cost of "simplicity" for the developer </li><li>  About pure Java nosql document database / full-text search engine - Elasticsearch. </li></ul><br><a name="habracut"></a><br><br><h5>  For Java hub readers unfamiliar with OSM </h5><br>  OSM is an open geospatial database with highly detailed global coverage. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For a user, this is simply a map that can be viewed on-line, downloaded to a navigator, telephone, edited, printed, and generally used in any other imaginable way, including commercial gain from it. <br><br>  From the point of view of the developer, this is a very peculiar database. <br><ul><li>  In OSM there is no clear data scheme, there is no usual division into layers into GIS.  The type of the object, its properties, and in a certain sense the geometry, are specified via tags - text key-value pairs. </li><li>  Geometry is stored only for points.  A line is an array of id's points.  Polygon - a set of links to lines with an indication of which of the boundaries a line is inside or outside. </li><li>  This allows the community to model new types of data on the fly.  Want to mark sidewalks - negotiate a combination of tags and go ahead.  All this without dramas (well, almost) with cutting out some incomprehensible moderator of the data that is dear to your heart with the comment ‚Äúyou litter the card, nobody needs your work‚Äù. </li></ul><br><br>  Naturally, for developers, this liberty easily turns into a nightmare. <br><br><h5>  Addresses </h5><br>  Most of us live life after changing 1-2 cities, and we just do not have time to pay attention to the variety of postal addressing schemes. <br><br>  It starts with a small one - with a record of the address: from large to small or from small to large. <br><br>  Then it turns out that in some cities they do not use the street in the address: <br>  house 521, Kotor, Montenegro or the Russian Federation, the village Energetik house 15. <br><br>  That one house may have several addresses: <br>  The best city on earth, Straight Street, 22, and he has the Best City on earth, Perpendicular Street, 12 <br><br>  That double addressing can be not only at the corner houses and that 2 addresses are far from the limit. <br>  Tallinn Kashtanovaya street 13, 15, 17 <br>  Tallinn Cherry Street 1, 3 <br>  * An example is quite from my own life, I just forgot the original street names. <br><br>  What can be addressed are not only the houses themselves, but also the entrances, and even the sections of the house that do not manifest themselves in any way.  (This is just from the example of Tallinn - addresses on the same street inside the same building are internal sections that once belonged to different owners). <br><br>  And finally, all exotic as <br>  Naberezhnye Chelny, 11/1 <br>  This is 11 residential complex, house 1. In fact, houses in the LF also have the usual addresses of Street Street, but local residents do not use them. <br><br>  Now multiply this by: <br>  4 fundamentally different ways to specify the Settlement in OSM <br>  3-4 ways to specify multiple addressing <br>  3 ways to specify the street for the address <br><br>  Moreover, if you enter the data, you just need to use a couple of schemes from this zoo.  If you want to write a decent geocoder, it is not enough for you to just remember the existence of this zoo, you need to ‚Äúcalculate‚Äù it. <br><br>  For example, let's see what needs to be done to match a home ‚Äî a city. <br>  Let's start with the homeland of the project - the UK. <br><br>  Here for example a house in Westminster.  <a href="http://www.openstreetmap.org/way/46138969">www.openstreetmap.org/way/46138969</a> <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:housenumber</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:street</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Derby</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Gate</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">building</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">yes</span></span></code> </pre> <br><br>  Westminster itself is marked like this: <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">name</span></span> Westminster <span class="hljs-type"><span class="hljs-type">name</span></span>:ru  place town</code> </pre><br><br>  What else is important to remember, duck is that this is practically the very center of London.  London essentially consists of several dozen smaller towns.  Which city to take the house?  To London or to Westminster? <br><br>  In fact, it is impossible to unequivocally answer this question, for a building it is not indicated to which city it formally refers.  But, for me, for example, it is obvious that a good geocoder should find this house both at the request of "London, Derby Gate, 1" and at the request of "Westminster, Derby Gate, 1" and "London, Westminster, Derby Gate, 1" <br><br>  How do I see the implementation: I associate with each house (address point) all polygonal boundaries into which it falls (the boundaries of the city fall here if they are specified) and an array of surrounding settlements, here fall London as the nearest city, and Westminster, as the nearest town and still their neighbors. <br><br>  Here is how it looks in the json data schema for elasticsearch <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     "nearby_places": { "properties": { "id": { "type": "string" }, "place": { "type": "string" }, "name": { "type": "string" }, "alt_names": { "type": "string" } } }, //         ,   ,     "locality_name": { "type": "string" }</span></span></code> </pre><br><br>  Accordingly, when searching, it will be possible to find a house on request with any of the cities, the difference will be only in the relevance of the exactly matched city and neighboring cities.  Each "need" is 1 or 2 spatial join'a. <br><br><h5>  Geocoder </h5><br>  As said one famous osmer <a href="https://habrahabr.ru/users/zverik/" class="user_link">Zverik</a> <blockquote>  ‚ÄúRecently, everyone is only busy with what the next geocoder is doing.‚Äù </blockquote><br>  I will not be an exception: everyone writes geocoder, why am I worse?  I also want a <s>bike</s> geocoder. <br><br>  What do people want from OSM about addresses? <br><ol><li>  Upload me addresses in csv or sqlite </li><li>  Geocode, please, a list of 100,500 addresses </li><li>  Online geocoding service (there are online geocoders in OSM, therefore this item is not in the first place) </li><li>  I entered the address for the house or organization, why can not I find it through an online geocoder? </li><li>  I want my local search engine with OSM data, which advise. </li></ol><br><br>  The answer usually begins like this: <br><ol><li>  You will need postgres, postgis (90% usually pass this part of the quest) </li><li>  You will need to load OSM data into this database using osmosis or osm2pgsql, if suddenly you decide to rotate such a focus on a global scale, then please be fast (16-32 gig) and patience (several days, if you have many operatives, and several weeks, if little RAM).  Country is also not very fast and not very loyal to the gland. </li><li>  Process the data scripts on postgreshke.  (Depending on the desired result, there remain 10% - 20% who wish to contact OSM-Stoics data processing.) </li><li>  Add search in DB with addresses or upload the one you need to csv / json </li></ol><br><br>  Entirely the whole quest pass units.  Adding each new chip to a geocoder turns around for hours, or even days, for processing geospatial joines with a postgreshka and gigabytes of RAM needed to load the new data you need into a postgreshka. <br><br>  And when you understand that in the Russian Federation it is considered to be a city for a home by entering the city landfill, and in the UK - by proximity to points of settlements, respectively, you need both the city boundaries adopted in the Russian Federation and Voronoi landfills + neighbors for the UK, and all this mixed up.  The eyes are filled with blood, and the next addressing scheme, based on a heap of relationships, causes a flurry of emotions. <br><br>  Geocoding can be considered as two almost independent tasks: <br><ol><li>  For all objects (addresses, streets, cities, points of interest) to obtain data: the boundaries of cities, neighboring points of cities, the surrounding streets. </li><li>  Organize a search for this data.  In the simplest case, this is just a full-text search. </li></ol><br><br>  I concentrated on solving the problem 1 - get the data in a form suitable for search indexing.  In principle, having given this data for indexing google or yandex, the second part of the geocoder can be outsourced. <br><br><h5>  Attempt # 1 </h5><br><br>  My first attempt here.  <a href="https://github.com/kiselev-dv/osm-addresses-pgsql">github.com/kiselev-dv/osm-addresses-pgsql</a> <br>  I load the simplified data into postgres, after which, resorting to various tricks to keep within a reasonable time, I process them. <br><br>  In the process of development, it turned out that it is faster and more flexible to process geometry into java and load ready-made geometry into postgres. <br><br><h5>  Computational complexity in computational geometry </h5><br><br>  The middle of the article usually no one reads, I hope, an obvious tautology will encourage the bored reader. <br><br>  Why is it necessary to download 6 GB of data packed in zipped xml, 6+ GB of RAM? <br><br>  OSM data does not contain complete geometry, the only OSM object that is geo-referenced is a point.  (Just triumph of data normalization) In order to get the geometry, you need to load the points in the lists of id's lines from the lines.  Actually the bulk of the memory eats index points.  In order not to climb once more on the disc, tags are usually saved for them.  Now the planet‚Äôs dump contains about 3 billion points, add here the overhead of storing points in the index, and for a regular home computer, JavaHeapSpace will loom. <br><br>  Suppose we managed to fake it and load it all into database, collect geometric indices.  How to speed up the execution of requests? <br>  The main part of the work is Point Location Problem.  That is, using the example of the Russian Federation, we need to calculate the occurrence of one and a half million points in half a million border polygons.  It is also important to understand that, for example, the border of the Russian Federation contains 40,000 segments.  All million points should be checked for entry into the border.  Despite the existence of the index, the complexity is O (N * M).  Postgis quickly using the index will determine that the point n from the million address points possibly falls within the Russian Federation, after which, determining whether the point is inside the polygon, it will calculate M scalar products, where M is the number of segments of the polygon boundary. <br><br>  By the time this fact was realized, I had already done almost all the preparatory work: parsing the polygons of administrative boundaries, getting and simplifying the geometry of the streets, getting geometry for houses with java addresses using the Java Topology Suite.  <a href="http://www.vividsolutions.com/jts/jtshome.htm">www.vividsolutions.com/jts/jtshome.htm</a> I basically used postgis for calculating spatial join'ov well, and as a general io framework. <br><br>  Another bottleneck with postgis is the difficulty to parallelize query execution.  In this case, I have not hundreds of requests per second, but 1 thick request for several hours. <br><br><h5>  The best bike, attempt number 2 </h5><br><br>  In fact, while describing the complexity of data processing, I curse my heart a little.  For example, the OSM community copes quite well with the conversion of maps into various navigation software formats.  It does this on a daily basis, using both dedicated servers and regular home computers of the participants. <br>  At the same time, the community of the Russian Federation will process OSM data taking into account local specifics, the German community will take into account its own. <br><br>  In the second attempt, I decided to go the same way.  I decided to write an application that could be used by most OSMs on home PCs. <br>  What is required for this: <br><ol><li>  The most important thing is ease of installation.  No one will set up an environment for you, install additional libraries, or a database engine.  (Goodbye postgres) </li><li>  Ability to customize.  If you want the community to help you, let the community take into account and implement local traditions and practices. </li><li>  A variety of uses.  Again, allow the local community to solve a wide range of tasks with your tool.  Give the opportunity to download the address registry in the form in which it is needed by the local community. </li></ol><br><br>  Since  I already had some experience after trying # 1, I had to partially repeat the process implemented for postgis using only java.  In fact, I need only spatial indices RTree and QuadTree, which are implemented in JTS.  And a couple of utilitarian methods for working with geometry, such as the separation of geometry and a point on the line. <br><br>  So, I process OSM data in 2 stages. <br>  1 I get the geometry from the OSM file, I cut it into pieces - strips with a width of 0.1 degrees.  This allows you to naturally break the task into parts and at the same time simplifies the geometry of the borders.  That is, instead of 1 border of the Russian Federation with 40,000 segments, I get 1,500 pieces, in each of which there are a couple of tens of segments.  The number of border polygons per strip also goes around several dozen. <br>  2 In the second stage, I expect to hit the points in the polygons of borders, looking for the nearest streets, the nearest cities.  Each "band" is processed separately, respectively, this stage is parallelized between threads / nodes. <br><br>  As a result, I get a json description for points of interest, streets, cities, borders and houses. <br><br><div class="spoiler">  <b class="spoiler_title">The description of POI looks like this</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"poipnt-3372930671-n600379459"</span></span>, <span class="hljs-string"><span class="hljs-string">"ftype"</span></span>: <span class="hljs-string"><span class="hljs-string">"poipnt"</span></span>, <span class="hljs-string"><span class="hljs-string">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"2014-05-14T15:22:11.785Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"poiTypes"</span></span>: [<span class="hljs-string"><span class="hljs-string">"police"</span></span>], <span class="hljs-string"><span class="hljs-string">"boundaries"</span></span>: { <span class="hljs-string"><span class="hljs-string">"index_name"</span></span>: <span class="hljs-string"><span class="hljs-string">",  ,  "</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,  , "</span></span>, <span class="hljs-string"><span class="hljs-string">"langs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"longText"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,  ,  , "</span></span>, <span class="hljs-string"><span class="hljs-string">"boundariesHash"</span></span>: <span class="hljs-number"><span class="hljs-number">-410546539</span></span>, <span class="hljs-string"><span class="hljs-string">"parts"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"lvl"</span></span>: <span class="hljs-string"><span class="hljs-string">"boundary:2"</span></span>, <span class="hljs-string"><span class="hljs-string">"names"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">//         "int_name": "Russia", "official_name": " ", "name": "" }, "lnk": "admbnd-2864649470-r60189", "name": " ", "lvl-size": 130 }, { "lvl": "boundary:4", "names": { "name:en": "Nizhny Novgorod Oblast", "name:ru": " ", "name": " ", "name:de": "Oblast Nischni Nowgorod" }, "lnk": "admbnd-3018389977-r72195", "name": " ", "lvl-size": 110 }, { "lvl": "boundary:6", "names": { "name:ru": " ", "name": " ", "official_name": "  " }, "lnk": "admbnd-3704710510-r2031968", "name": " ", "lvl-size": 90 }, { "lvl": "place:town", "names": { "name:hu": "Szarov", "name:en": "Sarov", "name:ru": "", "name:pl": "Sarow", "name": "", "name:de": "Sarow" }, "lnk": "plcbnd-3118671325-r1428992", "name": "", "lvl-size": 70 }] }, "properties": { "name": "", "amenity": "police" }, "type": "Feature", "metainfo": { "id": 600379459, "type": "node" }, "geometry": { "type": "Point", "coordinates": [43.323823, 54.935209] } }</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">The description of the house (address point) looks like this</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"adrpnt-0642964090-w129096772"</span></span>, <span class="hljs-string"><span class="hljs-string">"ftype"</span></span>: <span class="hljs-string"><span class="hljs-string">"adrpnt"</span></span>, <span class="hljs-string"><span class="hljs-string">"timestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"2014-05-14T15:31:38.778Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"nearbyStreets"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"hghway-3750745956-w128994466"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"highway"</span></span>: <span class="hljs-string"><span class="hljs-string">"unclassified"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"hghway-1683350308-w129293134"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"kladr:user"</span></span>: <span class="hljs-string"><span class="hljs-string">"87005000001000100"</span></span>, <span class="hljs-string"><span class="hljs-string">"surface"</span></span>: <span class="hljs-string"><span class="hljs-string">"concrete"</span></span>, <span class="hljs-string"><span class="hljs-string">"highway"</span></span>: <span class="hljs-string"><span class="hljs-string">"tertiary"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">"oneway"</span></span>: <span class="hljs-string"><span class="hljs-string">"no"</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"hghway-0059099168-w129293131"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"highway"</span></span>: <span class="hljs-string"><span class="hljs-string">"unclassified"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"hghway-0069632087-w129293121"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"kladr:user"</span></span>: <span class="hljs-string"><span class="hljs-string">"87005000001000100"</span></span>, <span class="hljs-string"><span class="hljs-string">"surface"</span></span>: <span class="hljs-string"><span class="hljs-string">"concrete"</span></span>, <span class="hljs-string"><span class="hljs-string">"highway"</span></span>: <span class="hljs-string"><span class="hljs-string">"tertiary"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">"oneway"</span></span>: <span class="hljs-string"><span class="hljs-string">"no"</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"hghway-4111943004-w128995822"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"highway"</span></span>: <span class="hljs-string"><span class="hljs-string">"residential"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> } }], <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"building"</span></span>: <span class="hljs-string"><span class="hljs-string">"yes"</span></span>, <span class="hljs-string"><span class="hljs-string">"building:levels"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"sport"</span></span>: <span class="hljs-string"><span class="hljs-string">"swimming"</span></span>, <span class="hljs-string"><span class="hljs-string">"amenity"</span></span>: <span class="hljs-string"><span class="hljs-string">"swimming_pool"</span></span>, <span class="hljs-string"><span class="hljs-string">"addr:street"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">"addr:housenumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"14"</span></span> }, <span class="hljs-string"><span class="hljs-string">"nearestCity"</span></span>: { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"plcdln-2842041450-n1575069719"</span></span>, <span class="hljs-string"><span class="hljs-string">"properties"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name:fr"</span></span>: <span class="hljs-string"><span class="hljs-string">"Providenia"</span></span>, <span class="hljs-string"><span class="hljs-string">"addr:postcode"</span></span>: <span class="hljs-string"><span class="hljs-string">"689251"</span></span>, <span class="hljs-string"><span class="hljs-string">"name:ru"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"name:en"</span></span>: <span class="hljs-string"><span class="hljs-string">"Provideniya"</span></span>, <span class="hljs-string"><span class="hljs-string">"name:nl"</span></span>: <span class="hljs-string"><span class="hljs-string">"Providenia"</span></span>, <span class="hljs-string"><span class="hljs-string">"name:pl"</span></span>: <span class="hljs-string"><span class="hljs-string">"Prowidienija"</span></span>, <span class="hljs-string"><span class="hljs-string">"name:it"</span></span>: <span class="hljs-string"><span class="hljs-string">"Providenija"</span></span>, <span class="hljs-string"><span class="hljs-string">"name:es"</span></span>: <span class="hljs-string"><span class="hljs-string">"Provid√©niya"</span></span>, <span class="hljs-string"><span class="hljs-string">"addr:country"</span></span>: <span class="hljs-string"><span class="hljs-string">"RU"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"name:de"</span></span>: <span class="hljs-string"><span class="hljs-string">"Prowidenija"</span></span>, <span class="hljs-string"><span class="hljs-string">"addr:region"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-string"><span class="hljs-string">"place"</span></span>: <span class="hljs-string"><span class="hljs-string">"town"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Feature"</span></span>, <span class="hljs-string"><span class="hljs-string">"addresses"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"index_name"</span></span>: <span class="hljs-string"><span class="hljs-string">" 14,   , ,  ,   ,  "</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,   ,  , ,   ,  14"</span></span>, <span class="hljs-string"><span class="hljs-string">"langs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"longText"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,   ,   ,  , ,   ,  14"</span></span>, <span class="hljs-string"><span class="hljs-string">"parts"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"lvl"</span></span>: <span class="hljs-string"><span class="hljs-string">"postcode"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"lvl-size"</span></span>: <span class="hljs-number"><span class="hljs-number">55</span></span> }, { <span class="hljs-string"><span class="hljs-string">"lvl"</span></span>: <span class="hljs-string"><span class="hljs-string">"boundary:2"</span></span>, <span class="hljs-string"><span class="hljs-string">"names"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">//   }, "lnk": "admbnd-2864649470-r60189", "name": " ", "lvl-size": 130 }, { "lvl": "boundary:3", "names": { "name:sv": "Fj√§rran √∂sterns federala distrikt", "name:en": "Far Eastern Federal District", "name:ru": "  ", "name:ja": "Ê•µÊù±ÈÄ£ÈÇ¶ÁÆ°Âå∫", "name:es": "Distrito federal del Lejano Oriente", "name:de": "F√∂derationskreis Ferner Osten", "short_name": "", "name:vi": "V√πng li√™n bang Vi·ªÖn ƒê√¥ng", "name:pt": "Distrito Federal Oriental", "name:fr": "District f√©d√©ral extr√™me-oriental", "name:uk": "—ñ  ", "name:nl": "Federaal District Verre Oosten", "name:zh": "ÈÅ†Êù±ËÅØÈÇ¶ÁÆ°ÂçÄ", "name:it": "Distretto Federale dell'Estremo Oriente", "name:pl": "Dalekowschodni Okrƒôg Federalny", "name": "  " }, "lnk": "admbnd-2969582277-r1221185", "name": "  ", "lvl-size": 120 }, { "lvl": "boundary:4", "names": { "name:sv": "Tjuktjien", "name:en": "Chukotka Autonomous Okrug", "name:ru": "  ", "name:ja": "„ÉÅ„É•„ÇØ„ÉÅËá™Ê≤ªÁÆ°Âå∫", "name:es": "Chukotka", "name:de": "Autonomer Kreis der Tschuktschen", "short_name": "", "name:vi": "Khu t·ª± tr·ªã Chukotka", "name:fr": "Tchoukotka", "name:uk": "  ", "name:nl": "Tsjoekotka", "name:zh": "Ê•öÁßëÂ•áËá™Ê≤ªÂå∫", "name:it": "Circondario autonomo della ƒåukotka", "name:pl": "Czukocki Okrƒôg Autonomiczny", "int_name": "Chukotka Autonomous Okrug", "name": "  " }, "lnk": "admbnd-4289483775-r151231", "name": "  ", "lvl-size": 110 }, { "lvl": "boundary:6", "names": { "name:ru": " ", "name": " " }, "lnk": "admbnd-2373015928-r1949882", "name": " ", "lvl-size": 90 }, { "lvl": "place:town", "names": { "name": "" }, "lnk": "plcbnd-3753535756-w129289823", "name": "", "lvl-size": 70 }, { "lvl": "street", "strtUID": -30263303, "lnk": "hghway-1683350308-w129293134", "names": { "name": "  " }, "name": "  ", "lvl-size": 20 }, { "lvl": "hn", "names": {}, "lnk": "adrpnt-0642964090-w129096772", "name": " 14", "lvl-size": 10 }], "addr-scheme": "regular" }], "metainfo": { "id": 129096772, "type": "way", "fullGeometry": { "type": "Polygon", "coordinates": [ [ [-173.2301084, 64.4217729], [-173.229167, 64.4220204], [-173.2293185, 64.4221278], [-173.2298729, 64.421982], [-173.2299223, 64.4220171], [-173.2302113, 64.4219379], [-173.2300846, 64.4218517], [-173.2301819, 64.421825], [-173.2301084, 64.4217729] ] ] } }, "geometry": { "type": "Point", "coordinates": [-173.22972832, 64.42195376] } }</span></span></code> </pre><br></div></div><br><br>  Intermediate data storage format - json (packed gzip).  This, firstly, greatly simplifies debag.  I can see intermediate results with simple (z) cat, (z) grep.  Secondly, it simplifies the life of third-party developers, if any. <br><br>  At the output, I generate csv for a bunch of postgis + sphynx (maybe the postgis is superfluous here, but it‚Äôs convenient to do a reverse geocoder in this bundle) and json for elasticsearch (reverse geocoding can be done using the elasticsearch itself). <br><br>  It takes about 2 hours to process the RF, with 6 GB of RAM and approximately 5 GB of disk space.  You can shrink to a smaller amount of ram by sacrificing time.  The analogs known to me spend two days. <br>  Many sites can be customized (I plan to increase the number of extensions) using my class implementations, passing them from groovy to extensions. <br>  The application for data processing is a 1 jar executable and does not require you to install additional dependencies. <br>  At the moment I have a rather tricky syntax for launching, with a lot of command line parameters, in the future I plan to launch 1 line java -jar gazetteer.jar russia.config and even better as a working node of the cluster. <br><br>  Link to the bike <a href="https://github.com/kiselev-dv/gazetteer">github.com/kiselev-dv/gazetteer</a> <br><br>  I am not strong in search technologies, so the search for downloaded elasticsearch itself is lame.  If there are those in Habr√© who are interested in working with this kind of data and experimenting with the settings of a search engine by geodata - welcome. <br><br>  The project consists of two parts. <br>  Gazetteer - data processing. <br>  GazetteerWeb - api over elasticsearch (while on tomcat - I plan to use netty in the future) </div><p>Source: <a href="https://habr.com/ru/post/222875/">https://habr.com/ru/post/222875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222857/index.html">Autologin with password and ssh control ‚Äúon a visit‚Äù using expect</a></li>
<li><a href="../222859/index.html">‚ÄúLike‚Äù button for websites and blogs: tasting</a></li>
<li><a href="../222861/index.html">SERPClick prepares to enter western markets</a></li>
<li><a href="../222863/index.html">Professional change management</a></li>
<li><a href="../222871/index.html">SpaceIL - Google Lunar X PRIZE member</a></li>
<li><a href="../222877/index.html">We program stm32 microcontrollers with QtCreator</a></li>
<li><a href="../222883/index.html">Adaptive interface for transformers on the example of Krita Gemini</a></li>
<li><a href="../222885/index.html">bb-mobile micrON-4: headset with the form of a phone with support for SMS and notifications</a></li>
<li><a href="../222887/index.html">International Agile Consortium ICAgile: Agile, Lean and all-all</a></li>
<li><a href="../222891/index.html">Radioactivity meter (radiometer) with Glonass receiver and data transmission via Wi-Fi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>