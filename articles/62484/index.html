<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transactions in Spring</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article describes an example of working with transactions in the popular framework Spring. The article assumes that you are familiar with java and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transactions in Spring</h1><div class="post__text post__text-html js-mediator-article">  The article describes an example of working with transactions in the popular framework Spring.  The article assumes that you are familiar with java and spring.  Working code example can be downloaded from sf <br><br><a name="habracut"></a><br><br>  There are two management strategies: program management (we write code manually) and declarative (we set up transaction boundaries in XML configurations).  In addition, we can work with different types of transactions: local and distributed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      General information on the use of transactions is available in the Spring documentation, but many encounter problems when trying to put information into practice.  The article contains a working example for a local and distributed transaction, using both strategies. <br><br><br><h4>  Shortly about transactions </h4><br>  By transaction, we mean a series of actions (not necessarily in the database), which are perceived by the system as a single package, i.e.  or all actions are successful, or all are rolled back to their original positions. <br><br>  Consider the classic example of transferring money from one account to another.  Money transfer is our ‚Äúpackage‚Äù, which contains two actions: it reduces the balance of account A and increases the balance of account B. It is obvious that we cannot reduce the first account, and fail to increase the second - in case of an error we must roll back both operations. <br><br>  As we said earlier, there are two types of transactions - local and distributed.  A local transaction works with one source, for example, one database;  distributed uses a few - for example jms source and db. <br><br>  If the mechanism of local transactions is simple, then a certain infrastructure is required for distributed ones.  A distributed process requires a certain element that will synchronize the work of all sources.  This item is a distributed transaction manager.  Such managers are issued by a large number of companies, and they all require a certain study of the documentation. <br><br>  But there is a much simpler way - to use any jEE server, since  they contain pre-configured components.  In our example, we will try to use JBoss 5. <br><br>  For more information about the mechanisms of transactions I recommend to see wikipedia. <br><br><h4>  Environment </h4><br>  First, we need data sources: create two databases in mysql and call them Alfa and Beta.  In alpha, we make two tables: alfa1 and alfa2;  The table structures are the same and contain the id and name fields.  Additionally, we add a unique index on the name column for alfa1.  In the Beta database, create only one table with the same fields and a unique index. <br><br>  Be sure to specify the engine for the tables - InnoDB, otherwise transactions will not work. <br>  In the archive with an example there is a script for creating all the structures. <br><br><h4>  Use case </h4><br>  Our script contains two operations: each inserts data into one table.  Since the alfa2 table does not contain an index, we can insert any number of duplicates.  Duplicates in the remaining tables are not possible, and as a result, we should receive an error when re-inserting and rolling back the transaction. <br><br>  Each example must be run twice: the first start will end normally and in both tables there will be new entries;  restart will fail. <br><br><h4>  Local Transaction Example </h4><br>  Local transaction works with one base: Alfa.  Connection to the database is described in the standard spring context, along with descriptions of the data access layer and the layer service.  There are also hibernate configurations. <br>  Data access object contains two methods for inserting data (alfa1 alfa2). <br>  The layer service uses dao for immediate work. <br><br>  For a start, let's try the program management method. <br>  Create a context (programContext.xml) and declare all the bins: connection to the database, hibernate configuration, dao and service.  All bins use dependency injection. <br>  The most important bean for us is the transaction manager.  We declare a standard class and use it in our service.  In the Service an example of use is indicated - this is the only nuance. <br>  We also do a class for running our structures, which initializes the context and calls our service layer.  The first run is performed normally and we see the data in the tables alfa1 and alfa2.  Restarting causes an error - since there is a unique index on alfa1, but a rollback will occur in the alfa2 table as well, which was necessary for us. <br>  In this approach, we had to explicitly use the transaction manager, i.e.  our code has become dependent on external libraries.  We can avoid this by using a declarative approach to managing transactions. <br><br>  We will create a new object in the service layer, in which there will be no transaction management code, and declare all the beans in the new context. <br>  (declarativeContext.xml).  Connections to the database, settings, transaction manager - all this is similar to the previous example.  The only difference in the definition of Service, now it does not use the transaction manager. <br>  But we still need the transactions ourselves, and we need to inform spring about this.  In general, we need to declare two elements: what methods we want to put in the transaction, and which manager to use. <br>  The rule for defining the method: execution (* service.DeclarativeTx. * (..)) - i.e.  We choose all the methods of our service.  And the next setting says that we will use the default manager. <br>  Delete the data from the tables and run the example twice.  As usual, the first run is performed normally, and the second ends with an error, along with the rollback of the entire transaction. <br><br><h4>  Distributed Transaction Example </h4><br>  Most applications have enough local transactions to succeed.  But there are a number of applications that are forced to work with data distributed by many sources.  In this case, distributed transactions are used to manage changes. <br>  In general, everything works in the same way as normal transactions, except for the fact that we need to synchronize the work of all sources.  It helps a separate subsystem: the manager of management of distributed transactions. <br>  Managers are released by a large number of vendors as separate software products, i.e.  we must download, install and configure the system.  To do this, you will have to read the documentation and TP, but we will choose the path easier: modern jee application servers contain built-in, already configured managers. <br>  We will use jboss 5, although you can use any other.  Thanks to spring's flexibility not to make server-dependent changes. <br><br>  <b>Our goal:</b> to create a web application with a single flow.  The controller must invoke services to insert data into both databases.  As usual, the first page display will be successful, and the second will cause an error with the rollback of the transaction. <br><br>  The application deployment will take place in JBoss, which we have to pre-configure.  At a minimum, we need access to both databases - we will create two files to configure datasources and copy them into server / default / deploy.  The files themselves are available in the archive with an example.  Perhaps you need to change the username and password, and, most importantly, do not forget to put the driver for myysql in the jdbc server lib. <br><br>  The application itself is also in the archive.  Let's take a closer look at it, instead of writing an analog from scratch. <br>  The project contains jars: the most springs needed to support web, hibernate and so on. <br>  The source code is generally similar to the previous examples: in the context there are two datasource configured via jndi.  There are hibernate mapping, dao, serice layer.  The declarative definition of transactions is also similar to the earlier example. <br>  Pay attention to the definition of a distributed transaction manager.  We said earlier: we must use some kind of external system for managing transactions.  But we do not make any configurations, thanks to spring.  When spring is initialized, the available manager will automatically be found via jndi - because  it takes the standard jndi paths for all popular servers, and sequentially iterates over them. <br><br>  Additionally, we create web flow using mvc.  Our controller calls the service to work with databases. <br>  As usual, the first launch (opening of the page) is successfully processed, if the page is reloaded - we get exception and rollback of the transaction. <br><br><h4>  To run web sample </h4><br>  Create both bases.  Copy and unzip JBoss5.  Edit the source definitions from the example and write them into server / default / deploy. <br>  Package the application in xa.wat and copy the WAR in deploy. <br>  Run JBoss (bin / run) and, if everything is in order, open: <br>  <a href="http://localhost/">localhost</a> : 8080 / xa / testxa.do <br><br>  Andrew Romanenco <br>  andrew@romanenco.com <br>  <a href="http://www.romanenco.com/springtx">www.romanenco.com/springtx</a> <br><br>  You can download sample code from sf.net: <br><br>  <a href="https://sourceforge.net/project/showfiles.php%3Fgroup_id%3D220231%26package_id%3D326183%26release_id%3D689145">sourceforge.net/project/showfiles.php?group_id=220231&amp;package_id=326183&amp;release_id=689145</a> </div><p>Source: <a href="https://habr.com/ru/post/62484/">https://habr.com/ru/post/62484/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62476/index.html">MUSICDEPO.RU - Community of Artists and Fans</a></li>
<li><a href="../62477/index.html">[3.0.] Jailbreak Tightens</a></li>
<li><a href="../62478/index.html">UbuntuOne open</a></li>
<li><a href="../62482/index.html">Web Proxy service for Opera Unite</a></li>
<li><a href="../62483/index.html">Home server Part one - the choice of components</a></li>
<li><a href="../62485/index.html">Internet Olympiad in Informatics and Mathematics 2009</a></li>
<li><a href="../62487/index.html">Starcraft 2 Battlereport 3!</a></li>
<li><a href="../62489/index.html">Redsn0w - iPhone OS 3.0 jailbreak, iPhone 2g & 3g unlock (Mac & Win)</a></li>
<li><a href="../62490/index.html">Your choice? And why?</a></li>
<li><a href="../62495/index.html">Shortcut.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>