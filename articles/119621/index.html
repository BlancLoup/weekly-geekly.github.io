<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Another Canvas Guide [4]: ‚Äã‚ÄãThe end</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this part 
 [Transformations, 
 Compositions 
 Animations 
 Pixel Manipulation] 

 Transformations 
 Recall some methods 
 First, we will need to r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Another Canvas Guide [4]: ‚Äã‚ÄãThe end</h1><div class="post__text post__text-html js-mediator-article"><h2>  In this part </h2><br>  [Transformations, <br>  Compositions <br>  Animations <br>  Pixel Manipulation] <br><a name="habracut"></a><br><h2>  Transformations </h2><br><h3>  Recall some methods </h3><br>  First, we will need to recall the two methods that were mentioned in the last chapter. <br>  save - saves the current state at the top of the stack <br>  restore - sets the state from the top of the stack <br>  The state should be understood: transformation matrix, drawing area, and the following properties: strokeStyle, fillStyle globalAlpha, lineWidth, lineCap, lineJoin, miterLimit, shadowOffsetX, shadowOffsetY, shadowBlur, shadowColor, globalCompositeOperation, font, textAlign, textBaseline. <br><br><h3>  Displace </h3><br><pre><code class="cpp hljs">translate(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y)</code> </pre>  - let's shift the current position of the origin of coordinates by x and y from the previous position. <br>  Consider the following example: <br><pre> <code class="javascript hljs">ctx.save() <span class="hljs-comment"><span class="hljs-comment">//  ctx.translate(100,100) //   ctx.textBaseline = 'top' ctx.font = "bold italic 30px sans-serif" ctx.strokeText(" ",0,0) //     (0;0),        ctx.restore() // ,     ,   </span></span></code> </pre><br><h3>  Turn </h3><br> <a href="http://jsfiddle.net/r2Gr7/"><img src="https://habrastorage.org/storage/4427e74c/000e54ce/b2a913b0/ed70ae64.png" align="left"></a> <br><pre> <code class="cpp hljs">rotate(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> angle)</code> </pre>  - rotates the x-axis and ordinate angle angle, also do not forget that the angle is measured in radians, to convert the angle to radians from degrees, multiply degrees by Pi and divide by 180, that is: rad = deg * Math.PI // 180 <br>  For example, add a line after ctx.translate (100,100): ctx.rotate (45 * Math.PI / 180) <br><br><h3>  Reduce / increase </h3><br> <a href="http://jsfiddle.net/P3ec8/1/"><img src="https://habrastorage.org/storage/7d847d5b/8c369d95/f94de4cd/1e1d6a0a.png" align="left"></a> <br><pre> <code class="cpp hljs">scale(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y)</code> </pre>  - will apply the new scale to the x and y axes. <br>  For example, replace ctx.rotate (45 * Math.PI / 180) with ctx.scale (0.65,1.5) <br><h3>  Multiply the matrix </h3><br><pre> <code class="cpp hljs">transform(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m11, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m12, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m21, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m22, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dx , <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dy)</code> </pre>  - multiply the old matrix to the new matrix. <br><h3>  Apply the matrix </h3><br><img src="https://habrastorage.org/storage/c3f344fe/f9b0a005/de2eb948/eddd2dc8.png" align="left"><br><pre> <code class="cpp hljs">setTransform(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m11, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m12, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m21, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m22, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dx , <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dy)</code> </pre>  - Apply a new matrix, for example, look at the following code. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); img.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ctx.save() ctx.setTransform(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0.5</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) ctx.drawImage(img,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">78</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>) ctx.restore() } img.src = <span class="hljs-string"><span class="hljs-string">'brick.jpg'</span></span>;</code> </pre><br>  I used a brick wall picture and a <a href="http://en.wikipedia.org/wiki/Transformation_matrix">shearing transformation</a> . <br>  In addition, the transformations can be read in more detail in the <a href="http://habrahabr.ru/blogs/html5/104718/">topic from Nutochka</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Compositions </h2><br><h3>  Types of composition operations </h3><br><img src="https://habrastorage.org/storage/bc8c1996/b6fd2ed1/9b218ac7/36e19f3b.png" align="left"><br>  The globalCompositeOperation property is responsible for the type of composition operation, we could paint all its possible values, but there is a <a href="">Canvas Cheat Sheet</a> and it is better to show a part of the picture, a blue rectangle was drawn first, and a red circle second and depending on the value of globalCompositeOperation we will get different results . <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><h3>  GlobalAlpha property </h3><br> <a href="http://jsfiddle.net/5GT78/"><img src="https://habrastorage.org/storage/f3454e7c/f9c53f6b/1d10d19e/f061d26f.png" align="left"></a> <br>  The globalAlpha property is actually a multiplier by which the transparency of each image is multiplied, while only if 0 &lt;= globalAlpha &lt;= 1. For example, consider the code: <br><pre> <code class="javascript hljs">ctx.globalAlpha = <span class="hljs-number"><span class="hljs-number">0.6</span></span>; ctx.fillRect(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>) ctx.fillRect(<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>)</code> </pre><br><br><h2>  Animation </h2><br><h2>  requestAnimationFrame </h2><br>  If earlier timers were used for animation, now a special function called requestAnimationFrame has appeared, the topic is already covered so it is better to read the <a href="http://habrahabr.ru/blogs/javascript/114358/">translation from azproduction</a> . <br><br><h2>  The basic principle of animation </h2><br>  The basic principle of animation is to erase the old frame and draw a new one.  To erase the old frame is the easiest to use the clearRect function.  For example, consider the following code. First, add the requestAnimationFrame definition to your code: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">400</span></span>, y = <span class="hljs-number"><span class="hljs-number">300</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ ctx.clearRect(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">800</span></span>,<span class="hljs-number"><span class="hljs-number">600</span></span>); ctx.beginPath(); ctx.arc(x++,y++,<span class="hljs-number"><span class="hljs-number">50</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.PI*<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-literal"><span class="hljs-literal">false</span></span>); ctx.fill() requestAnimFrame(loop); })();</code> </pre><br>  Also about animation can be read in the <a href="http://habrahabr.ru/blogs/canvas/119585/">topic from trickii</a> <a href="http://habrahabr.ru/blogs/canvas/119585/"><br></a> <br><h2>  1 game! = 1 canvas </h2><br>  I saw this rule in the canvas acceleration presentation and realized that this is the simplest rule. <br>  Instead of drawing complex images with each frame, you can save this image into a virtual canvas and then draw it with each frame, but however it is worth noting that you don‚Äôt have to shove everything into a virtual canvas, you only have to push shapes that are really difficult to draw (for example, text or gradient ).  <a href="http://jsperf.com/cache-canvas-test">For example, I did a small test on jsperf.com</a> , not ideal, but I think the meaning is clear. <br><br><h2>  Manipulate pixels </h2><br>  Apart from high-level methods, canvas also has full access to pixels, using it you can create wonderful things (I mean filters and the like), and also draw simple things very quickly.  There is a special type of ImageData for working with pixels, it has three properties, width, height (I think it doesn‚Äôt need to be explained) and data is an array of r, g, b, a values ‚Äã‚Äãfor each pixel. <br><h3>  How pixel data is stored </h3><br><img src="https://habrastorage.org/storage/c236c19c/28c56fde/681d34bd/4d8a231a.png"><br>  Data about the pixels as previously stated is stored in an array, while the number of elements in the array is equal to the number of pixels multiplied by 4. All elements take values ‚Äã‚Äãin the range 0..255. <br>  Including the alpha channel stored in values ‚Äã‚Äãfrom 0..255.  The picture shows that the four values ‚Äã‚Äãof r, g, b, a form a segment, the segment in turn is a single indivisible cell storing the parameters of one pixel. <br><br><h3>  Creating an empty ImageData </h3><br><pre> <code class="cpp hljs">ImageData = context.createImageData(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h)</code> </pre>  - creates an empty ImageData with width and height w and h, respectively. <br><pre> <code class="cpp hljs">ImageData = context.createImageData(imageData)</code> </pre>  - create an empty ImageData with the width and height of the transferred imageData, note: the data is not copied. <br><br><h3>  Application ImageData </h3><br><pre> <code class="cpp hljs">context.putImageData(imageData imgd, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y)</code> </pre>  - will change the array of pixels of the canvas in the area from the point xy with the width and height of imageData. <br><br><h3>  Simple example </h3><br>  But enough of the theory, let's get down to business, let's try to draw a graph of the function y = x * x, without smoothing: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imgd = ctx.createImageData(<span class="hljs-number"><span class="hljs-number">800</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x,y,segment,xround,yround; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (x=<span class="hljs-number"><span class="hljs-number">-40</span></span> ; x&lt;=<span class="hljs-number"><span class="hljs-number">40</span></span> ; x+=<span class="hljs-number"><span class="hljs-number">0.01</span></span>) { y = x*x; xround = ~~(x+<span class="hljs-number"><span class="hljs-number">0.5</span></span>); yround = ~~(y+<span class="hljs-number"><span class="hljs-number">0.5</span></span>); segment = ((-yround+<span class="hljs-number"><span class="hljs-number">400</span></span>)*imgd.width + xround + <span class="hljs-number"><span class="hljs-number">40</span></span>)*<span class="hljs-number"><span class="hljs-number">4</span></span>; imgd.data[segment+<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">255</span></span>; } ctx.putImageData(imgd, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  To compare performance, I wrote similar <a href="http://jsperf.com/imagedata-vs-fillrect">code using fillRect, again on jsperf</a> , however, to draw one point, it is better to use fillRect since creating imageData also takes resources. <br><br><h3>  Manipulation of image pixels </h3><br><img src="http://habrastorage.org/storage/7fa470ce/75f8c7ef/bab0a477/b69e2b4c.png" align="left"><pre> <code class="cpp hljs">ImageData = context.createImageData(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> w, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h)</code> </pre>  - returns an imageData object with data from canvas in a rectangular area with a left top vertex at (x; y) and a width, height w and h, respectively.  For example, let's try to highlight white areas in a photo: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); img.src = <span class="hljs-string"><span class="hljs-string">'test.jpg'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     img.onload = function(){ //netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"); --      FireFox   ctx.drawImage(img, 0, 0, 160, 120); var imgd = ctx.getImageData(0, 0, 160, 120); // imageData for (var i=0 ; i&lt;imgd.data.length ; i+=4) { imgd.data[i] = imgd.data[i+1] = imgd.data[i+2] = imgd.data[i] &lt; 200 &amp;&amp; imgd.data[i+1] &lt; 200 &amp;&amp; imgd.data[i+2] &lt; 200 ? 0 : 255; //     } ctx.putImageData(imgd, 0, 0); //, ,     }</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/119621/">https://habr.com/ru/post/119621/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119611/index.html">Limit inbound and outbound traffic to Linux</a></li>
<li><a href="../119612/index.html">Order sata multipliers for a 90 TB file storage in Taiwan</a></li>
<li><a href="../119616/index.html">Attracting an audience to the site using an iPhone application</a></li>
<li><a href="../119619/index.html">3D printers are getting even smaller and cheaper.</a></li>
<li><a href="../11962/index.html">And laughter and sin</a></li>
<li><a href="../119624/index.html">Linq To Entities vs. Linq To Objects on the example of grouping</a></li>
<li><a href="../119625/index.html">Cord - plug for cable selection</a></li>
<li><a href="../119626/index.html">Ukrainian parliament returns VAT on IT services</a></li>
<li><a href="../11963/index.html">Beijing and Moscow - Spam Capitals of the World</a></li>
<li><a href="../119632/index.html">Blackberry Playbook in my hands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>