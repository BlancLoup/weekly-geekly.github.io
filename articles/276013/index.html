<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical use of Linux Deploy on desktops</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite the fact that Linux Deploy was originally conceived as an application for Android, over time, there are other options for its use. With the ad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical use of Linux Deploy on desktops</h1><div class="post__text post__text-html js-mediator-article">  Despite the fact that Linux Deploy was originally conceived as an application for Android, over time, there are other options for its use.  With the advent of Linux Deploy CLI, a number of features have become available that open up new areas of application for this tool. <br><br><img src="https://habrastorage.org/files/647/f38/347/647f383473c242dba8882919a3e3f2a6.png" alt="Linux Deploy"><br><a name="habracut"></a><br>  <b>The Linux Deploy CLI</b> is a command line application designed to automate the process of installing, configuring, and running GNU / Linux distributions inside the chroot container.  The application can work both in regular Linux desktop distributions and on mobile platforms based on the Linux kernel, provided that the necessary dependencies are observed (all dependencies can be collected statically).  Applications from the Linux distribution run in a chroot environment, run in parallel with the main system and are comparable to it in speed.  Since the work of Linux Deploy is based on the Linux kernel system call, only Linux distributions can act as guest systems. <br><br>  The application can work in two modes: with root privileges (chroot) and without them (proot).  In normal mode, all supported installation types are available: installation to a file, to a disk partition (logical disk), to a POSIX compatible directory, and to RAM (tmpfs).  In proot mode, installation is only available in a directory, and a number of restrictions appear: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  all users inside the container have full access to the entire file system of the container, and the current user is the owner of all files and directories; </li><li>  no access to privileged system operations, for example, ping, ulimit, etc. does not work; </li><li>  applications can only work with network port numbers above 1024; </li><li>  if the application uses the chroot system call in its work, then it must be run through a special fakechroot utility, for example fakechroot / usr / sbin / sshd -p 2222. </li></ul><br>  The application supports automatic installation (base system) and initial configuration of Debian, Ubuntu, Kali Linux, Arch Linux, Fedora, CentOS, Gentoo, openSUSE and Slackware distributions.  Installing Linux-distribution is carried out on the network from the official mirrors on the Internet.  It also supports importing any other system from a pre-prepared rootfs file in tar.gz, tar.bz2 or tar.xz format.  The application allows you to connect to the console of the installed system (container), as well as start and stop applications inside the container (there is support for various initialization systems and custom autorun scripts).  Each installation option is saved in a separate configuration file, which is responsible for setting up each container.  If necessary, the containers can be run in parallel.  You can export the configuration and the container itself as a rootfs archive for later deployment of this container without reinstalling and configuring. <br><br>  In general, the idea of ‚Äã‚ÄãLinux Deploy arose from a desire to get an easy and convenient tool for quickly deploying a Linux distribution that could be used for development, testing or training, and then quickly remove it without making changes to the main (host) Linux system and without risking its integrity.  Thanks to the <a href="http://proot.me/">PRoot</a> program, <a href="http://proot.me/">it</a> became possible to create containers for running Linux applications without root privileges (root), and also to use <a href="https://ru.wikipedia.org/wiki/QEMU">QEMU</a> software emulation to run applications with a different architecture from the host without having to support the <a href="https://en.wikipedia.org/wiki/Binfmt_misc">kernel</a> module <a href="https://en.wikipedia.org/wiki/Binfmt_misc">binfmt_misc</a> . <br><br>  It turned out that my main job since 2011 has been using computers with Debian.  Local developers periodically need a system to run and test their web applications (mostly Java, PHP, Python).  For these purposes, virtual systems were usually used either based on VirtualBox, or in the local Proxmox cloud, or Docker.  The main disadvantage of VirtualBox is its demands on computer resources, the large size of the VDI disk image, the relatively low performance and the likelihood of a VM image crashing if the system is not properly shut down.  The disadvantage of using the "cloud" can be called the need for the administrator to handle user requests for the creation of such systems, as well as the expenditure of "cloud" resources for secondary tasks.  Docker requires superuser privileges. <br><br>  An experiment was conducted this month, for PHP developers, their virtual server was replaced with an LD container.  Two containers based on Debian were prepared: Apache + PHP + OCI8 and Apache + PHP + MySQL + PhpMyAdmin.  The containers were placed on a shared network drive in the local network, the size of each container was about 150 MB. <br><br>  What did the administrator get from this? <br><br><ul><li>  Once prepared, the container can be deployed on the developer‚Äôs computer with one team without administrator‚Äôs participation; </li><li>  Work with the container does not require superuser rights, so there is no risk of the main system breaking. </li></ul><br>  What the developer got: <br><br><ul><li>  deployment, launch and management of the system in a container is carried out without the participation of the administrator by one team; </li><li>  container deployment from pre-prepared archives is carried out over the network in less than a minute; </li><li>  starting and stopping the container (Web server + DB) occurs instantly, no need to wait for the operating system to start; </li><li>  There is no risk of damaging the container if you forgot to turn it off when you turn off the computer, because  The system image is a regular directory without its own file system; </li><li>  the computer is faster because  resources are spent only on running software in the container, and not on the entire operating system (in our case it is about 50 MB, instead of 500 MB in VirtualBox). </li><li>  checking software operation directly from the IDE directory without having to upload it to the server; to do this, simply connect the necessary directory of the main system to the container. </li></ul><br>  And now more details on how to achieve this.  Next will be instructions on the preparation and deployment of the LD container. <br><br>  To run containers without superuser rights, you need to install PRoot: <br><br><pre><code class="hljs javascript">mkdir ~<span class="hljs-regexp"><span class="hljs-regexp">/bin wget http:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/portable.proot.me/</span></span>proot-x86_64 -O ~<span class="hljs-regexp"><span class="hljs-regexp">/bin/</span></span>proot chmod <span class="hljs-number"><span class="hljs-number">755</span></span> ~<span class="hljs-regexp"><span class="hljs-regexp">/bin/</span></span>proot</code> </pre> <br>  Download and install the Linux Deploy CLI: <br><br><pre> <code class="hljs ruby">wget -O cli.zip <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/github.com/meefik</span></span><span class="hljs-regexp"><span class="hljs-regexp">/linuxdeploy-cli/archive</span></span><span class="hljs-regexp"><span class="hljs-regexp">/master.zip unzip cli.zip rm cli.zip ln -sf ~/linuxdeploy</span></span>-cli/cli.sh ~<span class="hljs-regexp"><span class="hljs-regexp">/bin/linuxdeploy</span></span></code> </pre><br>  Creating a configuration called ‚Äúlinux‚Äù to deploy the base system of Debian Wheezy (64 bits): <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">linuxdeploy</span></span> -p linux conf --method=<span class="hljs-string"><span class="hljs-string">'proot'</span></span> --source-path=<span class="hljs-string"><span class="hljs-string">'http://mirror.yandex.ru/debian/'</span></span> \ --distrib=<span class="hljs-string"><span class="hljs-string">'debian'</span></span> --arch=<span class="hljs-string"><span class="hljs-string">'amd64'</span></span> --suite=<span class="hljs-string"><span class="hljs-string">'wheezy'</span></span> --target-path=<span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ENV_DIR</span></span></span><span class="hljs-string">/rootfs/linux'</span></span> \ --chroot-dir=<span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TARGET_PATH</span></span></span><span class="hljs-string">'</span></span> --target-type=<span class="hljs-string"><span class="hljs-string">'directory'</span></span> --username=<span class="hljs-string"><span class="hljs-string">'webmaster'</span></span> --include=<span class="hljs-string"><span class="hljs-string">'bootstrap'</span></span></code> </pre><br>  View saved configuration: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">linuxdeploy</span></span> -p linux conf -x</code> </pre><br>  Running a new system deployment: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">linuxdeploy</span></span> -p linux deploy</code> </pre><br>  Connecting the container to the console as root (exit command exit): <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">linuxdeploy</span></span> -p linux shell -u root</code> </pre><br>  Then you can install and configure the necessary software in the container, but you should consider the features described earlier.  For example, to start Apache, you need to change its port (file /etc/apache2/ports.conf) to 8000, set the empty parameter APACHE_ULIMIT_MAX_FILES = "" (file / etc / apache2 / envvars), and start apachectl from under a regular user ( not root). <br><br>  Configuring autorun based on the SysV initialization system: <br><br><pre> <code class="hljs kotlin">linuxdeploy -p linux conf --include=<span class="hljs-string"><span class="hljs-string">'$INCLUDE init'</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>=<span class="hljs-string"><span class="hljs-string">'sysv'</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>-level=<span class="hljs-string"><span class="hljs-string">'3'</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>-user=<span class="hljs-string"><span class="hljs-string">'$USER_NAME'</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>-async</code> </pre><br>  Parameters: INIT_LEVEL ‚Äî SysV initialization level, INIT_USER ‚Äî from which user to start services (by default, this is root), INIT_ASYNC ‚Äî to start services in parallel. <br><br>  Preparing the configuration, exporting it and exporting the container to the rootfs archive (tar.gz, tar.bz2 and tar.xz archives are supported): <br><br><pre> <code class="hljs ruby">linuxdeploy -p linux conf --source-path=<span class="hljs-string"><span class="hljs-string">'linux.tgz'</span></span> --target-path=<span class="hljs-string"><span class="hljs-string">'\$ENV_DIR/rootfs/linux'</span></span> --chroot-dir=<span class="hljs-string"><span class="hljs-string">'\$TARGET_PATH'</span></span> linuxdeploy -p linux conf -x &gt; <span class="hljs-regexp"><span class="hljs-regexp">/path/to</span></span><span class="hljs-regexp"><span class="hljs-regexp">/linux.conf linuxdeploy -p linux export /path</span></span><span class="hljs-regexp"><span class="hljs-regexp">/to/linux</span></span>.tgz</code> </pre><br>  Escaping "\ $" allows you to save variable names in the config, not their values.  Thus, when importing a config, these variables will be automatically replaced with the corresponding values, which may differ from the current values.  Now there are two files (linux.conf and linux.tgz) that can be used when importing a container on another computer: <br><br><pre> <code class="hljs pgsql">cd /<span class="hljs-type"><span class="hljs-type">path</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">to</span></span> linuxdeploy -p linux conf -i ./linux.conf linuxdeploy -p linux deploy</code> </pre><br>  Connect the host system directory to the container (connect the ~ / www directory to the / var / www container): <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">linuxdeploy</span></span> -p linux conf --mounts=<span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$HOME</span></span></span><span class="hljs-string">/www:/var/www'</span></span></code> </pre><br>  Container launch (for SysV, the /etc/rcN.d/SXXname start scripts are executed): <br><br><pre> <code class="hljs pgsql">linuxdeploy -p linux <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre><br>  Stopping the container with freeing resources (for SysV, the /etc/rc6.d/KXXname stop scripts are executed): <br><br><pre> <code class="hljs sql">linuxdeploy -p linux <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> -u</code> </pre><br>  The result was a solution that meets the needs of both developers and administrators.  Linux Deploy application source code is available under the GPL version 3 license. </div><p>Source: <a href="https://habr.com/ru/post/276013/">https://habr.com/ru/post/276013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276003/index.html">Cach√© Class Explorer - explore Cach√© in UML notation</a></li>
<li><a href="../276005/index.html">Unsafe to Swift</a></li>
<li><a href="../276007/index.html">Office lighting control over Wi-Fi. Part 3: Driving the Light</a></li>
<li><a href="../276009/index.html">In Lenovo software, the immutable password was sewn 12345678</a></li>
<li><a href="../276011/index.html">Unmanaged C ++ library in .NET. Full integration</a></li>
<li><a href="../276015/index.html">HPE Proactive Care Advanced - a new service for a new type of IT</a></li>
<li><a href="../276017/index.html">Adjusted sliding exam, coclassifiers, fractal classifiers and local error probability</a></li>
<li><a href="../276019/index.html">Fuzzy search in the dictionary with the universal Levenshtein automaton. Part 2</a></li>
<li><a href="../276023/index.html">Install / Update Veeam B & R v9 on Hyper-V Server</a></li>
<li><a href="../276025/index.html">SLES 12, Watchdog Timer and IBM / Lenovo Servers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>