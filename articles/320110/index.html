<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Windows Performance Station or how I taught the computer to work effectively</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers! So I got to Habr and want to tell here the story of my project. Many aspects of our own experience and work have to be described ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Windows Performance Station or how I taught the computer to work effectively</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a61/ddf/f2e/a61ddff2e1f3d6977dce351017540c64.png" alt="image"><br><br>  Hello, dear readers!  So I got to Habr and want to tell here the story of my project.  Many aspects of our own experience and work have to be described in fairly general terms in order not to hurt the commercial secrets of the organizations in question. <br><br>  The essence of this story is to share the found method of solving the problem of computer performance on Windows and tell about the approach that made this decision completely universal and individual for each user.  It took about 2 years of daily work to write the code and select the most effective mechanisms, as well as advice and assistance from a large number of my comrades from different IT areas, for which I thank them so much. <br><a name="habracut"></a><br>  So, this story began in the 2013th year, at that time I worked in a large international organization producing powders and shampoos.  I had a position as a sysadmin, but, as is often the case, in fact I was a ‚Äúprogrammer‚Äù.  The essence of the work was to maintain some systems of EDS, writing various macros on VBA, utilities for automating or integrating different simple systems, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And just at the same time, I solved one of the urgent problems of the organization, namely, the unsatisfactory performance of various software on new laptops of many employees.  In fact, I had to face the problem that many sysadmins of large companies face - on staff computers, besides their favorite MS Office, SAP, 1C, etc., there was at least one favorite by all IT specialists ‚Äúmcafee‚Äù, ‚Äúpunto switcher "," Mail satellite "and that just is not.  It is worthwhile to clarify that the company then promoted a liberal attitude towards the computers of its employees, and, in fact, gave rise to BYOD. <br><br>  Since performance complaints have been received, incl.  and to me, I began to look for applications for performance tuning like Process Lasso.  My choice then fell on "Bill2`s Process Manager".  At that time, I found many alternatives, but they all had a terribly overloaded interface and ate up more resources for my own work than could be freed up with optimization. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f6/955/0e5/2f69550e57fe42600c00dfcdfa526246.png" alt="image"></div><br>  Found at that time, "Bill2` s Process Manager "had a lot of advantages over system tools, because  was pretty easy to manage and set up.  In fact, he allowed to do the same thing that the task manager is able to, namely, set the base priority and the kernel mask for applications, but, unlike the dispatcher, made it possible to save these settings after rebooting and distinguished the applications that are displayed in the windows on the desktop desk or work in the background. <br><br>  Thanks to this application, I managed to solve one of the most pressing problems, explain to the computer with which applications I am working now, and what is more important for me - EXCEL or background installation of updates. <br><br>  But, despite the fact that for me this application solved the main problem, it had a lot of flaws: <br><br><ol><li>  The lack of continuity of the config, it was impossible to simply copy the application from one computer to another with a similar configuration, it was necessary to re-configure.  Partially, this problem was solved by packing a customized application into a Portable file.  (Maybe somehow it was possible to pull the parameters out of the registry, but at that time I didn‚Äôt figure it out). <br><br></li><li>  Lack of control of RAM, namely the compression of RAM.  Many tweakers have a so-called ‚Äúmemory defragmentation,‚Äù which is essentially nonsense, since  defragmenting RAM is completely meaningless in terms of performance.  I needed to clean the data that hangs in the RAM and does not fall into SWAP, so that with a heavy load on the RAM, it was already free and the OS did not try to guess what you now need in RAM and what not.  By the way, a year later this chip appeared regularly in Windows 10, but there it‚Äôs archiving inside the RAM, which, in fact, doesn‚Äôt completely solve the problem either. <br><br></li><li>  Lack of priority I / O control on the hard disk (or SSD).  Normally, Windows has this function even with whists, but it was actively used only in Win10. <br><br></li><li>  Lack of definition of a ‚Äúfocal‚Äù application, since  Windows is not everything, if I work with a dozen applications, in one of which something compiles, and in the other I watch YouTube, then I don‚Äôt want YouTube lagging if the focus of the window is on it, and not on other windows. <br><br></li><li>  The inability to specify a folder with applications to apply the rule to newly installed programs at once. </li></ol><br>  In fact, studying the architecture of the Windows operating system, I constantly found many excellent mechanisms that allow you to build performance in the system ideally, provided one ‚ÄúBUT‚Äù.  BUT, if the programmers who write their software will tell the operating system what their software does, what it is intended for (games, movies, etc.) and with what priority it should apply to the CPU / RAM / HDD. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f6/fd9/5b3/5f6fd95b3322ec97a0fbaf9975f94d22.png" alt="image"><br><br>  In life, it turns out that only a small part of software is written taking into account the software architecture of Windows, most manufacturers, incl.  very serious and large, they write software without specifying these parameters and the OS uses everything by default. <br><br>  And this is not to mention the services that completely shitlessly eat off any available resources as soon as the event comes to action (such as downloading and installing updates).  Those who want to check the situation on their PC can open the task manager and display the column ‚Äúbasic priority‚Äù in the tab with processes. <br><br>  MMCSS corrects this situation a little, but it is too gentle on the processes, almost without affecting their actual performance. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b11/0ba/134/b110ba1345a09cda39347924f5fb7bd1.jpg" alt="image"></div><br>  The most embarrassing thing about multitasking Windows that constantly haunted me was listening to music during demanding operations.  Since  during the work I listened to music through Chrome and started calculating large tables in Excel, the sound had a peculiarity just at the moment of full CPU load or constantly hoarse at any jump of this load.  This situation was almost completely solved by using ‚ÄúBill2`s Process Manager‚Äù, but it had to be manually set to Chrome so that it wouldn‚Äôt grunt and it turned out that chrome was always at a higher priority even when the music wasn‚Äôt needed, which was no longer buzzing. <br><br>  Immediately it should be clarified that the computers and then used quite powerful by the standards of laptops.  At that time, it was a Core i5 2430m / 8GB Ram / 256GB SSD. <br><br>  At the same time, the then-emerging BYOD company assumed that employees could work with their working laptops everywhere, incl.  from home and, at the same time, use a working PC as a home to watch movies, games, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/781/2d4/f7d/7812d4f7d438685607f7611c579ec3d6.jpg" alt="image"></div><br>  All these factors ultimately prompted me to write my own application, which will incorporate all the best from existing alternatives and eliminate their shortcomings, while not just an interface for setting up as a task manager, but a fully automatic system for adapting performance to the task.  In fact, I was going to create an ideal structure for BYOD on my PC, in which I could work without reducing the performance of Steam, iTunes or the like.  and play, watch movies without the influence of corporate software, antiviruses, etc. <br><br>  To solve this problem, I needed to attract several of my friends, who also worked in IT.  The initial idea was to make an application for our own convenience and to expand our own knowledge on the operation of the OS and various applications. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/af4/dd8/d7c/af4dd8d7c3e1dc4983f282ee48c81285.jpg" alt="image"></div><br>  It was a small matter, at first we wrote a simple alternative to ‚ÄúBill2`s Process Manager‚Äù, but without configuration interfaces, so that the application works with a pre-configured config.  The main feature was to determine which windows are deployed, which processes work in the background and which application is in focus.  Just immediately added the option of assigning priority not only to the process, but to all processes from a specific folder.  It was quite easy to write this application, and thanks to the experience we had immediately managed to prevent memory leaks, handlers, crashes, and other bugs.  the application had to work in the background for a long time without rebooting.  To make the application easy and efficient, we used only standard OS and WinAPI functions.  At the very beginning, we did without an interface. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e80/fde/e75/e80fdee753a5ca37d296904f5d39ad68.png" alt="image"></div><br>  The next step was to write a local learning algorithm, which, according to the input parameters, would determine the purpose of the application.  The basis was a mathematical model of a neural network with neurons based on a threshold transfer function, but at that time weights were not taken into account, which we added later.  At first, this neural network studied only on the basic parameters of working with the application, its name, rule in the configuration and location on the hard disk (for example, if many applications are constantly used and do not work in the background, they are located in the same root folder of the type ‚ÄúC: / Games / ", Then most likely all subsequent applications launched from this folder will be used actively and you do not need to lower their priority in the background). <br><br>  It took almost half a year to bring this algorithm to perfection.  Subsequently, the number of input parameters for analysis increased and the optimal rules applied to third-party applications were selected. <br><br>  It is worth clarifying here that, unlike the classic task dispatchers, we decided not to manage priorities, cores, RAM and I / O separately, but combined these parameters into rules that combined in different proportions.  For example, for the main application, the rule = FOREGROUND (all kernels are available, priority is above average, I / O priority is high, we do not reset RAM to SWAP). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ea/2a3/248/3ea2a324808296ffdb616ad4fff12678.gif" alt="image"></div><br>  Later, the window positioning parameters were added to the learning algorithm (whether the application has a displayed window, is minimized or maximized. If it is maximized and focused, then you need to pay more attention to this process than background, etc.). <br><br>  The definition of services was added because  equally-called svchost.exe service processes perform completely different tasks. <br><br>  The most difficult, perhaps, was to teach the application to distinguish between the same processes for different purposes.  For example, many browsers launch a separate process for each individual tab (Chrome, Firefox, Yandex, Opera, etc.), and the sound and video reproduce the host processes, hence from 20 chrome processes, when it is not in focus, you need to enhance those processes that reproduce the sound.  The same applies to any other processes that can work in the background. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a67/a55/76f/a67a5576ff8c6723ec8bdeff2a294403.png" alt="image"><br><br>  In order not to prescribe in the config all processes known to the world, eventually the application learned how to determine not only how often the user works with the process, but also the actual purpose of the process and its importance for the work. <br><br>  Thus, the application has learned to distribute the load across the key nodes of the computer, depending on what the user is currently working with.  Moreover, the load is distributed individually for each PC depending on the usage scenario of an application, i.e.  whether it is used in the window, whether it plays video / sound / 3d, how much the user accesses this application and in which folder this application is located. <br><br>  The application turned out to be simple and universal, the installation takes place in a couple of clicks and no settings are required for operation, everything adapts automatically. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f2/565/a52/1f2565a5261f833a5d3813497d05a83f.png" alt="image"><br><br>  All this logic could not exist without tight integration with the system, so for the implementation of all the mechanisms we had to use the maximum of the Windows API functions.  This made it possible to reach deep core functions and to maintain maximum compatibility with any PC on an x86-64 processor at the minimum cost of the calculated power. <br><br>  It was also important to take into account the type of computer the user is working with.  For example, when working from a battery, several different algorithms for working with CPU cores are used to reduce the load and save the charge.  Power management options have been added so that you can not turn off your laptop or tablet, and, having turned off the screen, continue to listen to music or download / copy / archive files with power consumption during sleep mode. <br><br>  It was also important to learn how to determine how the processor works with multithreading and how it distributes the load on the cores. <br><br>  All these algorithms together helped to create a truly universal solution that is not a tweaker or overclocking and does not limit the functionality of the OS and other software.  In fact, the application teaches the computer to understand user requests and manage the load on key nodes in the way an experienced admin would do for each specific task. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2f/8ec/cf0/e2f8eccf017f09d3a85fd0393c8b0fbc.png" alt="image"></div><br>  Over time, other my comrades joined the work on this project and helped to design, site, VK group, etc.  questions. <br><br>  Anticipating various tips from the guru, I want to immediately mention that my total experience in IT at the moment is 8 years.  While working on this application, I have encountered many conflicting information on the features of the OS and some PC components, so I would not be surprised that someone might disagree with some of the described approaches, but the final testing showed the effectiveness of these solutions. <br><br>  Even in the professional field of my colleagues, many do not fully understand the subtleties of the CPU, multithreading, multitasking and multi-core work.  Information about some of the system functions of Windows had to be found in the most remote parts of the Internet.  The most difficult, perhaps, was to find a working (!) Way of setting high I / O priority for third-party applications. <br><br>  The described mechanism is not a spherical algorithm in vacuum and successfully works on real machines.  In cases where multitasking is actually used - the performance increase can be up to 50%. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74b/111/fe7/74b111fe7f211972d89b3809f20cf4d8.png" alt="image"></div><br>  The final touch for the work on the application was the signing of the ‚Äúcode signing‚Äù certificate for Windows. <br><br>  Many thanks to all who mastered this text to the end. <br><br>  <b>PS</b> I apologize for some confusion, I tried to put only the most important info so that the text would not grow much. <br><br>  We distribute the application according to the Freemium scheme so that any user can use the most basic functions, but we will be very pleased if the Habra community supports us so that our project can develop further. <br><br>  We still have a lot of ideas to increase the functionality and performance of our application to make it even better and more efficient. <br><br>  I sincerely hope that our efforts will help ease the work with the computer to many users who do not have the special skills to configure their PC, and the burned specialists will be able to get rid of the constant choice between speed and functionality. <br><br>  I will be happy to tell in more detail about the various aspects of the application work separately, if this article is of interest. </div><p>Source: <a href="https://habr.com/ru/post/320110/">https://habr.com/ru/post/320110/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320100/index.html">Development of SELinux-module for the application</a></li>
<li><a href="../320102/index.html">Upgrading features and infrastructure of free video conferencing 3CX WebMeeting</a></li>
<li><a href="../320104/index.html">About ScalaCheck. Generators (Part 2)</a></li>
<li><a href="../320106/index.html">VulnHub: Immerse yourself in hacking in the style of the TV series Mr. Robot</a></li>
<li><a href="../320108/index.html">Why case value is exaggerated and why it is harmful</a></li>
<li><a href="../320114/index.html">Stagnation: message format</a></li>
<li><a href="../320116/index.html">"... and in every joke there is some joke"</a></li>
<li><a href="../320120/index.html">Visual C ++ for IoT Development: Breakthrough or Frustration?</a></li>
<li><a href="../320124/index.html">Overview of modern web desktops systems</a></li>
<li><a href="../320128/index.html">Entity Framework 6 extensions that you might not know about</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>