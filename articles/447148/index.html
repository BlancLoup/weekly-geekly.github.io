<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>(Not) the official application Habr - HabrApp 2.0: gaining access</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One languid and already rather annoying in the evening, I, leafing through the official application of the habr, once again bent my fingers, one for e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>(Not) the official application Habr - HabrApp 2.0: gaining access</h1><div class="post__text post__text-html js-mediator-article"><p>  One languid and already rather annoying in the evening, I, leafing through the <em>official</em> application of the habr, once again bent my fingers, one for each inactive feature.  Here, for example, it is impossible to comment, it is denied the right to vote, and in general, why not see the formulas on the screen? </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/xr/p3/py/xrp3pywwsy_2qr5c4ynkitutrnc.jpeg"></div><br>  It was decided: you need something comfortable, pleasant, your own.  What about your application for Habr? <a name="habracut"></a><br>  Let's give you a few screenshots to understand the situation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/iq/c-/cn/iqc-cnpr991dwu63t2nl3lds9vi.jpeg"></div>  <em>Somehow it looks like <strong>this</strong> - of.</em>  <em>habr.com application</em> <br><br><div class="spoiler">  <b class="spoiler_title">List of "inconveniences"</b> <div class="spoiler_text"><ul><li>  You cannot rate a publication that has a rating other than 0. </li><li>  You can not always write a comment </li><li>  Polls don't work </li><li>  In the dark theme can not see the formulas (black on black) </li><li>  Not all bookmarks are available. </li></ul></div></div><br>  Yes, the application has not been updated since last August, but still bad.  In general, it is necessary to correct. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p></p><h2>  Part one.  In search of access. </h2><br><p>  A quick request to Google <em>‚Äúhabrahabr API‚Äù</em> has already issued an orderly outdated <a href="https://github.com/thematicmedia/habrahabr_api">repository</a> on the githaba, which has not been updated since <strong>November 21, 2016</strong> , and this is, for a minute, <strong>two and a half years</strong> . <br><br>  Ignoring the fact that this is PHP, scroll down and read: </p><br><blockquote><p>  Getting application ID </p><br><br><p>  Using <a href="https://habrahabr.ru/feedback/">this form</a> on Habrahabr, you need to briefly describe the essence of the new application and the purpose for which it needs an API. </p></blockquote><br><p>  No question, if you need to gain access, then it is necessary.  Writing a letter (in abbreviation): </p><br><div class="spoiler">  <b class="spoiler_title">Letter</b> <div class="spoiler_text"><blockquote><p>  There is a desire to make an application for Habr based on PWA.  There are several reasons for this. </p><br><p>  The first and most understandable: the Android application does not satisfy my personal requirements. </p><br><p>  Second: there are not enough native notifications about all sorts of things that usually arrive in the mail (comments, for example). </p><br><p>  Third: personal digests (as a perspective) on people / hubs that interest me, taking into account my interests. </p></blockquote></div></div><br><p>  The answer, of course, was not very pleasant, but at least honest: </p><br><blockquote><p>  Unfortunately, access to our API is currently not available.  We plan to resume granting access after we finish finalizing the API, but we don‚Äôt have any exact dates yet, because  At the moment we are busy with other priorities. </p></blockquote><br><p>  ‚ÄúOkay, never mind!  We'll think of something! ‚Äù- I said to myself, and began to search. </p><br><p></p><h2>  Part two.  Deep excavations. </h2><br><p>  Based on the logic, if the application works, then it has access to the API, and it is sewn into the application.  Let's analyze. </p><br><p>  Since we are dealing with traffic, Wireshark is our choice.  Not without torment, by connecting the phone to the Internet via a desktop computer, open the application and look at the requests: <br><br></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/yi/14/dk/yi14dkzwz69sjn8qwqwp9ik7tc8.png"></div><br>  <em>It is clear that nothing is clear</em> <br><br>  Yes, everything is encrypted, but I do not want to mess with cryptography.  Then you have to look inside the application itself. <br><br><p> Decompiling <strong>.apk</strong> , we begin to search.  What does any API need?  That's right, <em>endpoint</em> , a place where all requests go.  This is probably http (s), try to find "https: //": <br><br>  In the <code>AuthLinkManager.smali</code> file we find </p><br><pre> <code class="java hljs">.field OAUTH:Ljava/lang/String; = <span class="hljs-string"><span class="hljs-string">"https://habrahabr.ru/auth/o/%s/"</span></span> .field OAUTH_PARAMS:Ljava/lang/String; = <span class="hljs-string"><span class="hljs-string">"?client_id=%s&amp;response_type=token&amp;redirect_uri=%s"</span></span> .field OAUTH_REDIRECT_URL:Ljava/lang/String; = <span class="hljs-string"><span class="hljs-string">"http://cleverpumpkin.ru"</span></span></code> </pre><br><p>  This is the code for the Android virtual machine ( <em>Dalvik VM</em> ), which is not very comprehensible to humans, but still quite informative.  These three constants, judging by their content and name, as well as the GitHub repository, are used to query the access token using the <code>GET</code> method. </p><br><p>  We look further.  Next in the search comes across the <code>NetworkModule.smali</code> file: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span>-string v0, <span class="hljs-string"><span class="hljs-string">"https://habr.com/api/v1/"</span></span></code> </pre><p>  <em>And here is the place to turn requests!</em> </p><br><p>  For normal operation of the samopny client, it remains to find out only one thing - <code>client_id</code> , which most likely is the unique identifier of the application. </p><br><p>  However, the search for this text in the source to find relevant information did not lead ... </p><br><p>  But suddenly in one file the eyes caught on interesting lines: </p><br><pre> <code class="plaintext hljs">const-string p8, "log-tag" invoke-static {p8, p2}, Landroid/util/Log;-&gt;d(Ljava/lang/String;Ljava/lang/String;)I</code> </pre><br><p>  This, as you can understand, the entry in the log.  But a record of what? </p><br><p></p><h2>  Part Three  So logs! </h2><br><p>  Use <code>adb logcat</code> to view application logs. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gg/8l/xi/gg8lxiebmz-aoycxcejnxc7urxc.png"></div><br><p>  Suddenly, the logs turned out to be even more detailed than expected. </p><br><p>  There is not only the <code>client_id</code> we <code>client_id</code> , but also the user / application <b>token</b> , as well as the <b>login</b> and <b>password in</b> clear text! </p><br><div class="spoiler">  <b class="spoiler_title">Few conspiracy theories</b> <div class="spoiler_text">  By itself, the presence of the login and password logs does not harm anything, since these logs can be read only if you have either root-rights or a connection via <code>adb</code> .  But due to the fact that among the people reading Habr, there are developers on android that can have debugging turned on, this becomes a problem. <br><br>  In this case, ‚Äúfree charging‚Äù at the airport can result in hijacking your account <s>, although who needs it?</s> </div></div><br>  From these logs you can make: <br><br><ul><li>  <code>client_id</code> and <code>apikey</code> required to access <i>api</i> ; </li><li>  User authorization URL (strange, but there is nothing in the repository about this method, maybe not provided?) </li></ul><br>  And so it happened.  On the basis of this tiny research, work is already underway on a small project - a private implementation of a mobile application.  Those wishing to help, please write to the messages, and all the others - to vote (for I want to understand whether someone needs this). <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/447148/">https://habr.com/ru/post/447148/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447128/index.html">The digest of fresh materials from the world of the frontend for the last week No. 359 (April 1 - 7, 2019)</a></li>
<li><a href="../447130/index.html">PHP Digest number 153 (March 25 - April 8, 2019)</a></li>
<li><a href="../447132/index.html">From Tula to Berlin: analysis of cities on Instagram</a></li>
<li><a href="../447134/index.html">React course, part 28: modern React opportunities, project ideas, conclusion</a></li>
<li><a href="../447146/index.html">Industrial unmanaged switches EKI</a></li>
<li><a href="../447150/index.html">Chat on the site and in the issuance of Yandex</a></li>
<li><a href="../447152/index.html">The release of cross-platform .NET UI-toolkit AvaloniaUI 0.8</a></li>
<li><a href="../447158/index.html">Wireshark 3.x: code analysis for macOS and error review</a></li>
<li><a href="../447160/index.html">Space - for children. A few ideas for the Day of Cosmonautics</a></li>
<li><a href="../447162/index.html">Don't buy ERP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>