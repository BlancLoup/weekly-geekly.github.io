<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Draw graphs (diagrams) in Django</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From time to time, many web developers are faced with the need to visualize a relatively large amount of data using diagrams (I will call them graphs ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Draw graphs (diagrams) in Django</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dc/786/197/3dc78619743cfc6a1990898b5a15504d.png" alt="django-google-charts"></div><br>  From time to time, many web developers are faced with the need to visualize a relatively large amount of data using diagrams (I will call them graphs below, although this is not quite true).  The task is not new, and there are many ready-made solutions on the network: server-side and client-side, using images, Canvas, SVG, Flash, Silverlight ... <br><br>  In this article I will tell about <a href="http://publishedin.com/django-google-charts/">django-google-charts</a> and some features of using <a href="http://code.google.com/apis/chart/">Google Chart Tools</a> for plotting graphs on a site running Django. <br><br>  Often, when you need to add a graph to a page, the developer follows the path of least resistance: copies the JavaScript from the example on the Internet and somehow outputs data from the application to it.  It turns out something like: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chart_data = [ {% <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> chart_data %} [{{ row<span class="hljs-number"><span class="hljs-number">.0</span></span> }}, {{ row<span class="hljs-number"><span class="hljs-number">.1</span></span> }}], {% endfor %} ];</code> </pre> <br><a name="habracut"></a><h4>  Why is that bad? </h4><ul><li>  The code is hard to read, making it easy to make a mistake.  Did you notice a mistake in my example?  :) </li><li>  Difficult to scale.  When you need to add a second graph to the page, they usually copy the same piece of code again and change the variable names.  The result is unreadable porridge, debugging it and making changes is quite unpleasant. </li><li>  Strong binding to context.  Reuse of this pattern is limited. </li></ul>  Such a construction is still suitable for a temporary solution, but no more. <br><br><h4>  Formulation of the problem </h4><br>  A good solution for drawing graphs: <ol><li>  Allows you to simply and clearly add new graphics to the site and remove unnecessary; </li><li>  Follows the <acronym>DRY</acronym> principle for defining common elements (for example, a color scheme); </li><li>  Can be reused; </li><li>  Does not invent a new API. </li></ol><h4>  Solution </h4><br>  The django-google-charts graphing application has grown from a small set of hacks in my current project.  Alarma: this is the first public release, bizarre bugs are possible.  Corrections and comments are welcome. <br><br><h5>  Installation </h5><br><pre> <code class="bash hljs">$ pip install django-google-charts <span class="hljs-comment"><span class="hljs-comment">#  $ easy_install django-google-charts</span></span></code> </pre><br>  Add <code>'googlecharts'</code> to <code>INSTALLED_APPS</code> . <br><br><h5>  How it works (general view) </h5><br><pre> <code class="javascript hljs">{% load googlecharts %} {% googlecharts %} {% data  <span class="hljs-string"><span class="hljs-string">" "</span></span> %} {# ()   #} {% col <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> %}...{% endcol %} {#  #} {% col <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> %}...{% endcol %} {#   #} ... {% enddata %} {% options <span class="hljs-string"><span class="hljs-string">" "</span></span> %} {# ()   #} ... {% endoptions %} {% graph <span class="hljs-string"><span class="hljs-string">"#id"</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> %} {#   #} {% endgooglecharts %}</code> </pre><br>  I'll tell you a little about the purpose of each tag. <br><br><h5> <code>{% googlecharts %}...{% endgooglecharts %}</code> </h5> <br>  Connects the necessary scripts, is a container for the whole structure.  Nothing interesting. <br><br><h5> <code>{% data  "" %}...{% enddata %}</code> </h5> <br>  Named dataset.  The name can be not specified (it will turn out <code>"default"</code> ). <br><br><h5> <code>{% col "" "" %}...{% endcol %}</code> </h5> <br>  Format.  The data types in the Google Visualization API are: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'string'</span></span> <span class="hljs-string"><span class="hljs-string">'number'</span></span> <span class="hljs-string"><span class="hljs-string">'boolean'</span></span> <span class="hljs-string"><span class="hljs-string">'date'</span></span> <span class="hljs-string"><span class="hljs-string">'datetime'</span></span> <span class="hljs-string"><span class="hljs-string">'timeofday'</span></span></code> </pre><br>  You can read more in the <a href="http://code.google.com/apis/chart/interactive/docs/reference.html">documentation</a> . <br><br>  A special variable <code>val</code> is passed inside the tag, in this place it can be formatted: <br><br><pre> <code class="javascript hljs">{% col <span class="hljs-string"><span class="hljs-string">"string"</span></span> <span class="hljs-string"><span class="hljs-string">"Date"</span></span> %}<span class="hljs-string"><span class="hljs-string">'{{ val|date:"M j" }}'</span></span>{% endcol %} {# ,  #} {% col <span class="hljs-string"><span class="hljs-string">"number"</span></span> %}{{ val|floatformat:<span class="hljs-number"><span class="hljs-number">2</span></span> }}{% endcol %}</code> </pre><br>  The result must match the declared type;  quotes around the string will not be put. <br><br>  <b>Example.</b>  Suppose we have passed such a context variable to the <code>{% data %}</code> block: <br><br><pre> <code class="javascript hljs">[[<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>], [<span class="hljs-string"><span class="hljs-string">'bar'</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>], [<span class="hljs-string"><span class="hljs-string">'baz'</span></span>, <span class="hljs-number"><span class="hljs-number">96</span></span>]]</code> </pre><br>  We need two tags <code>{% col %}</code> , according to the number of elements in the input line.  The first will get 'foo', 'bar' and 'baz' to the input;  the second, respectively, 32, 64 and 96. The implementation (the simplest) may look like this: <br><br><pre> <code class="javascript hljs">{% col <span class="hljs-string"><span class="hljs-string">"string"</span></span> <span class="hljs-string"><span class="hljs-string">"Name"</span></span> %}<span class="hljs-string"><span class="hljs-string">"{{ val }}"</span></span>{% endcol %} {% col <span class="hljs-string"><span class="hljs-string">"number"</span></span> <span class="hljs-string"><span class="hljs-string">"Value"</span></span> %}{{ val }}{% endcol %}</code> </pre><br><h5> <code>{% options "" %}...{% endoptions %}</code> </h5> <br>  Graphics options. <br><br><pre> <code class="javascript hljs">{% options %} kind: <span class="hljs-string"><span class="hljs-string">"LineChart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">240</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... } {% endoptions %}</span></span></code> </pre><br>  Inside the javascript object tag, you can use global variables and call functions.  Chart types and supported options for each type are listed <a href="http://code.google.com/apis/chart/interactive/docs/gallery.html">here</a> . <br><br><h5> <code>{% graph "id_" "" "" %}</code> </h5> <br>  We display the graph in the element on the page.  The last two parameters can be omitted, you get <code>"default" "default"</code> . <br><br><h4>  Usage example </h4><br>  Suppose we have this model: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Payment</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(models.Model)</span></span></span><span class="hljs-class">:</span></span> amount = models.DecimalField(max_digits=<span class="hljs-number"><span class="hljs-number">11</span></span>, decimal_places=<span class="hljs-number"><span class="hljs-number">4</span></span>) datetime = models.DateTimeField()</code> </pre><br>  You can use <a href="https://bitbucket.org/kmike/django-qsstats-magic">django-qsstats-magic</a> to prepare the data for display in the form of a graph. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> qsstats <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> QuerySetStats <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view_func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> start_date = ... end_date = ... queryset = Payment.objects.all() <span class="hljs-comment"><span class="hljs-comment">#   ... qsstats = QuerySetStats(queryset, date_field='datetime', aggregate=Count('id')) # ...     values = qsstats.time_series(start_date, end_date, interval='days') return render_to_response('template.html', {'values': values})</span></span></code> </pre><br>  The <code>time_series</code> method returns data in the following form: <br><br><pre> <code class="python hljs">[[date, value], [date, value], ...]</code> </pre><br>  In the template.html file: <br><br><pre> <code class="javascript hljs">{% load googlecharts %} &lt;div id=<span class="hljs-string"><span class="hljs-string">"count_graph"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> {% googlecharts %} {% data values <span class="hljs-string"><span class="hljs-string">"count"</span></span> %} {% col <span class="hljs-string"><span class="hljs-string">"string"</span></span> <span class="hljs-string"><span class="hljs-string">"Date"</span></span> %}<span class="hljs-string"><span class="hljs-string">"{{ val|date:"</span></span>M j<span class="hljs-string"><span class="hljs-string">" }}"</span></span>{% endcol %} {% col <span class="hljs-string"><span class="hljs-string">"number"</span></span> <span class="hljs-string"><span class="hljs-string">"# of payments"</span></span> %}{{ val }}{% endcol %} {% enddata %} {% options %} kind: <span class="hljs-string"><span class="hljs-string">"LineChart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">backgroundColor</span></span>: <span class="hljs-string"><span class="hljs-string">"#f9f9f9"</span></span>, <span class="hljs-attr"><span class="hljs-attr">colors</span></span>: [<span class="hljs-string"><span class="hljs-string">"#09f"</span></span>], <span class="hljs-attr"><span class="hljs-attr">gridlineColor</span></span>: <span class="hljs-string"><span class="hljs-string">"#ddd"</span></span>, <span class="hljs-attr"><span class="hljs-attr">legend</span></span>: <span class="hljs-string"><span class="hljs-string">"none"</span></span>, <span class="hljs-attr"><span class="hljs-attr">vAxis</span></span>: {<span class="hljs-attr"><span class="hljs-attr">minValue</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-attr"><span class="hljs-attr">chartArea</span></span>: {<span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">240</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">180</span></span>}, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">240</span></span> } {% endoptions %} {% graph <span class="hljs-string"><span class="hljs-string">"count_graph"</span></span> <span class="hljs-string"><span class="hljs-string">"count"</span></span> %} {#     #} {% endgooglecharts %}</code> </pre><br><h5>  Scaling </h5><br>  Now, to add another graph to the page, you need to do the following: <br><br>  - Collect data (views.py): <br><br><pre> <code class="python hljs"> <span class="hljs-comment"><span class="hljs-comment">#         summary = qsstats.time_series(start_date, end_date, interval='days', aggregate=Sum('amount')) return render_to_response('template.html', {'values': values, 'summary': summary})</span></span></code> </pre><br>  - Add to template.html: <br><br><pre> <code class="javascript hljs">&lt;div id=<span class="hljs-string"><span class="hljs-string">"count_sum"</span></span>&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ... {% data summary <span class="hljs-string"><span class="hljs-string">"sum"</span></span> %} {% col <span class="hljs-string"><span class="hljs-string">"string"</span></span> <span class="hljs-string"><span class="hljs-string">"Date"</span></span> %}<span class="hljs-string"><span class="hljs-string">"{{ val|date:"</span></span>M j<span class="hljs-string"><span class="hljs-string">" }}"</span></span>{% endcol %} {% col <span class="hljs-string"><span class="hljs-string">"number"</span></span> <span class="hljs-string"><span class="hljs-string">"Paid amount, USD"</span></span> %}{{ val|floatformat:<span class="hljs-number"><span class="hljs-number">2</span></span> }}{% endcol %} {% enddata %} ... {% graph <span class="hljs-string"><span class="hljs-string">"count_sum"</span></span> <span class="hljs-string"><span class="hljs-string">"sum"</span></span> %} {#    ,  #}</code> </pre><br><h4>  Github </h4><br>  <a href="https://github.com/mvasilkov/django-google-charts">The django-google-charts source code</a> also contains a sample project.  To run it, just run: <br><br><pre> <code class="bash hljs">$ python manage.py syncdb --noinput <span class="hljs-comment"><span class="hljs-comment">#    sqlite  /tmp $ python manage.py populatedb #     $ python manage.py runserver</span></span></code> </pre><br>  The test project looks like this: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d34/264/7db/d342647db9b5d741f34a918fd70317b5.png" alt="django-google-charts"></a> <br><br><h4>  Limitations of the first public release (fly in the ointment) </h4><ol><li>  Only one <code>{% googlecharts %}</code> tag per page; </li><li>  (Almost) no error checking, especially in javascript; </li><li>  Disappearing little documentation. </li></ol>  Thanks to everyone who read it.  How <i>do you</i> draw graphics? </div><p>Source: <a href="https://habr.com/ru/post/126704/">https://habr.com/ru/post/126704/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126692/index.html">13-year-old schoolboy patents a solar battery "on Fibonacci numbers"</a></li>
<li><a href="../126693/index.html">Some Python-like functions in C ++ 11</a></li>
<li><a href="../126697/index.html">Amazon seriously took up the video</a></li>
<li><a href="../126701/index.html">Bash scripts interaction with user</a></li>
<li><a href="../126703/index.html">Chrome with Yandex search</a></li>
<li><a href="../126705/index.html">Parsing spamming your Exim accounts</a></li>
<li><a href="../126707/index.html">Forwarding COM Ports from Linux to Windows</a></li>
<li><a href="../126708/index.html">Silicon Valley Infrastructure Overview</a></li>
<li><a href="../126710/index.html">About modern methods of near-earth astronomy</a></li>
<li><a href="../126711/index.html">Mi-one new smartphone Xiaomi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>