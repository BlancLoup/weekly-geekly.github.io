<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flexible configuration with PHPixie</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing it is often necessary to support several environments at once: development, staging. production, etc., which can have quite different ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flexible configuration with PHPixie</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/7cd/47c/66c/7cd47c66c5df9f4b83f7886240a1cba2.png" alt="image" align="right"><br><br>  When developing it is often necessary to support several environments at once: development, staging.  production, etc., which can have quite different settings.  The simplest example is the parameters of a database connection, but sometimes you want to change not only one parameter but a whole section, for example, logging or backend for the cache.  In addition, when developing various CMS, sometimes you want to put some of the settings in a prominent place to make it easier for the user to find them.  Let's see how these problems are solved in PHPixie.  And of course, it all works without the framework itself and is much lighter than the <i>symfony / config</i> package. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Options</b> <br><br>  The simplest thing we can do is create several variables that we can use later in the config, for this we create the file <i>/assets/parameters.php</i> : <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// /assets/parameters.php return [ 'apiToken' =&gt; 'jdf73jdhgj', //     'database' =&gt; [ 'connection' =&gt; 'mysql:host=localhost;dbname=quickstart', 'user' =&gt; 'root', 'password' =&gt; 'secret' ] ];</span></span></code> </pre> <br><br>  Now we can use them in configuration files through <i>% name%</i> , for example: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// /assets/config/database.php return [ 'default' =&gt; [ 'driver' =&gt; 'pdo', 'connection' =&gt; '%database.connection%', 'user' =&gt; '%database.user%', 'password' =&gt; '%database.password%' ] ];</span></span></code> </pre><br><br>  As a result, we separate the variables themselves from where they are used.  It is reasonable then to add <i>parameters.php</i> to <i>.gitignore</i> and then the code can be freely divided into a github. <br><br>  But what if we need more?  For example, add a few routes that only work for developers and are disabled in production?  For this we need an overlay. <br><br>  <b>Overlays</b> <br><br>  Suppose in one of the configurations we want to also connect the database to MongoDB.  To do this, create a folder in with some beautiful name, for example <i>local,</i> and add local changes to it: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// /assets/config/local/database.php return [ //       //     'default'  . //     array_replace_recursive() 'mongo' =&gt; [ 'driver' =&gt; 'mongo', 'database' =&gt; '%mongo.database%', 'user' =&gt; '%mongo.user%', 'password' =&gt; '%mongo.password%', ] ];</span></span></code> </pre><br><br>  If there is little change, you can not even create a folder but simply put everything in one file: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// /assets/config/local.php return [ 'database' =&gt; [ //          // ,        //   'default' 'mongo' =&gt; [ 'driver' =&gt; 'mongo', 'database' =&gt; '%mongo.database%', 'user' =&gt; '%mongo.user%', 'password' =&gt; '%mongo.password%', ] ] ];</span></span></code> </pre><br><br>  It remains only to enable it, for this we add one line to <i>parameters.php</i> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// /assets/parameters.php return [ 'configOverlay' =&gt; 'local', // ... ];</span></span></code> </pre><br><br>  Of course, you can create several such overlays and switch between them as you like. <br><br>  <i>How to see the result?</i> <br><br>  For debugging: <br><br><pre> <code class="php hljs">print_r($frameworkBuilder-&gt;configuration()-&gt;config()-&gt;get());</code> </pre><br><br>  <b>Use without framework</b> <br><br>  All functionality has been added to the <i>Slice</i> and <i>Config</i> base libraries.  When creating a configuration, we can specify a different configuration or Slice from which the parameters will be loaded: <br><br><pre> <code class="php hljs">$configBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \PHPixie\Config(); $parameterStorage = $configBuilder-&gt;file(<span class="hljs-string"><span class="hljs-string">'parameters.php'</span></span>); $rootDir = ...; <span class="hljs-comment"><span class="hljs-comment">//        (  ) $dirName = 'config'; //     $configuration = $configBuilder-&gt;directory($rootDir, $dirName, 'php', $parameterStorage);</span></span></code> </pre><br><br>  The overlay is even simpler; in fact, you can merge two Slice instances or configurations into one.  In this case, lazy file upload will continue to work normally. <br><br><pre> <code class="php hljs">$sliceBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \PHPixie\Slice(); $configBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \PHPixie\Config(); $configuration = $configBuilder-&gt;file(<span class="hljs-string"><span class="hljs-string">'config.php'</span></span>); $overlay = $configBuilder-&gt;file(<span class="hljs-string"><span class="hljs-string">'overlay.php'</span></span>); $merged = $sliceBuilder-&gt;mergeData($configuration, $overlay);</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/301152/">https://habr.com/ru/post/301152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301134/index.html">Firsthand case: how Igor Kalganov‚Äôs IT service ‚Äú33 Elephants‚Äù began to compete with real estate managers</a></li>
<li><a href="../301136/index.html">Animated stub "Sorry, your browser doesn't support WebGL"</a></li>
<li><a href="../301146/index.html">What is isomorphism for?</a></li>
<li><a href="../301148/index.html">How to dial in an IT startup development team that really makes the product?</a></li>
<li><a href="../301150/index.html">Can a car teach english?</a></li>
<li><a href="../301154/index.html">Friday format: Unusual data center solutions</a></li>
<li><a href="../301156/index.html">Report from Moscow CocoaHeads Meetup April 29</a></li>
<li><a href="../301166/index.html">Functional autotest</a></li>
<li><a href="../301172/index.html">Two availability, or why accessibility and availability are not the same</a></li>
<li><a href="../301174/index.html">Generics in Kotlin vs. Generics in JAVA: similarities, differences, features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>