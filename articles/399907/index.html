<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing FreeRTOS for Stm32vlDiscovery</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 
 Understanding the Stm32 microcontroller programming, I decided to try installing (real-time operating system) RTOS - FreeRTOS and encounte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing FreeRTOS for Stm32vlDiscovery</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br>  Understanding the Stm32 microcontroller programming, I decided to try installing (real-time operating system) RTOS - FreeRTOS and encountered a number of difficulties.  There are many articles on the Internet, but I haven‚Äôt found any clear instructions, so I‚Äôm asking anyone interested in what‚Äôs interesting. <br><a name="habracut"></a><br>  So first we decide what is necessary to have: <br><ul><li>  Stm32VLDiscovery debug board </li><li>  Installed IDE Keil ARM 5 and above </li><li>  The desire to razrazratsya new </li></ul><br>  If you have already developed something for the Keil STM32F1x family, you can skip this paragraph.  First you need to install development packages for the STM32F1x family, this is done as follows: <br><ol><li>  Launch Keil. </li><li>  Click on the Pack Installer button in the panel <img src="https://habrastorage.org/files/6d6/7a9/af0/6d67a9af00624dc786a107933c5c722b.png"></li><li>  In the window that opens, click the Check For Updates button (waiting for the update of the package list) </li><li>  Select the STMicroelectronics-&gt; STM32F1 Series-&gt; STM32F100 in the tree and install all the packages. </li></ol><br>  This completes the preparation of the development environment. <br>  We proceed directly to creating a project using FreeRTOS. <br>  The first thing that needs to be done is to download the latest distribution of the RTOS from the official site <a href="http://www.freertos.org/">www.freertos.org</a> , at the time of this writing, the latest version was FreeRTOSv9.0.0.  So, we got an impressive archive, unpack it in any place (I‚Äôll say that we don‚Äôt need 99% of it, so don‚Äôt be intimidated by the resulting folder, I have more than 200 MB). <br><br>  Now we need to create a new project in Keil. <br><br><img src="https://habrastorage.org/files/0b3/4ac/02e/0b34ac02ebc04408a399973a47ba5600.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I called it FreeRTOSDemo, you can choose any suitable name, the main thing is that there are no spaces and Russian letters in the way of project placement. <br>  Now we need to choose our chip, I tested it on the debug board of STM32VLDiscovery with the chip of STM32F100RB and chose it accordingly. <br><br><img src="https://habrastorage.org/files/aa7/3cf/605/aa73cf60537b41f59fc925c319a5d366.png"><br><br><img src="https://habrastorage.org/files/394/23a/401/39423a40140e4c04a2e436fab7838252.png"><br><br>  After selecting the chip, you must select the libraries that we will use.  We need a library of CMSIS and StdPeriph.  The figures below show the minimum selection of components to test the operation of the RTOS and blink diodes (this applies to the StdPeriph library, CMSIS is required). <br><br><img src="https://habrastorage.org/files/15d/6b5/068/15d6b5068bd84793870173363e32b889.png"><br><br><img src="https://habrastorage.org/files/37e/83e/bc9/37e83ebc9c1440909e267b84adbf3a32.png"><br><br><img src="https://habrastorage.org/files/22a/aaa/9fa/22aaaa9fa106492983f71f4a07769e03.png"><br><br>  So we created a project, it looks like this: <br><br><img src="https://habrastorage.org/files/1c6/344/33f/1c634433f7484467abe7a43253ec00eb.png"><br><br>  Further, for convenience in the project, we create several groups so that later the confusion from the files does not turn out. <br><br><img src="https://habrastorage.org/files/41d/9cb/e30/41d9cbe30342492eb36800a61b5c5a92.png"><br><br>  Everything is ready to copy the RTOS files into the project.  Create a folder FreeRTOS in the project folder. <br>  From the FreeRTOSv9.0.0 \ FreeRTOS \ Source \ folder, copy all * .c files into the created FreeRTOS folder.  There we copy the include folder. <br>  From the FreeRTOSv9.0.0 \ FreeRTOS \ Source \ portable \ RVDS \ ARM_CM3 \ folder, copy the * . and * .h files to their respective locations in the FreeRTOS folder of our project. <br>  From the folder FreeRTOSv9.0.0 \ FreeRTOS \ Source \ portable \ MemMang \ copy the file heap_2.c. <br>  From the FreeRTOSv9.0.0 \ FreeRTOS \ Demo \ CORTEX_STM32F103_Keil \ folder, copy the FreeRTOSConfig.h file. <br>  After all the manipulations, you should get the following: <br><br><img src="https://habrastorage.org/files/c26/ede/939/c26ede939e704f75925f0100db70ed29.png"><br><br><img src="https://habrastorage.org/files/a85/aef/e61/a85aefe614874d07897f357c50bf8b9c.png"><br><br>  Next, we need to add files to the appropriate groups in the project, as well as create the main.cc file with the main program text. <br>  The result should be the following project structure. <br><br><img src="https://habrastorage.org/files/da0/8db/198/da08db1981bd499180890344aa68925b.png"><br><br>  In order for the project to be compiled in its settings, you must specify all the paths to the * .h files, as well as prescribe the USE_STDPERIPH_DRIVER directive. <br><br><img src="https://habrastorage.org/files/436/46a/0ec/43646a0ec578405a9f8f55f81981770c.png"><br><br>  Now it remains to change a few lines in the FreeRTOSConfig.h file, for correct operation: <br><pre><code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configCPU_CLOCK_HZ ( ( unsigned long ) 72000000 ) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**/</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configCPU_CLOCK_HZ ( ( unsigned long ) 24000000 ) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configTOTAL_HEAP_SIZE ( ( size_t ) ( 17 * 1024 ) ) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/**/</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configTOTAL_HEAP_SIZE ( ( size_t ) ( 5 * 1024 ) )</span></span></code> </pre> <br>  And add the following lines after the #define FREERTOS_CONFIG_H <br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> xPortSysTickHandler SysTick_Handler #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> xPortPendSVHandler PendSV_Handler #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> vPortSVCHandler SVC_Handler</span></span></code> </pre><br>  After that, in the main.c file, we write the simplest program for flashing LEDs. <br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"FreeRTOS.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"task.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"queue.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f10x.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f10x_gpio.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f10x_rcc.h"</span></span></span><span class="hljs-meta"> GPIO_InitTypeDef port; uint8_t state; void vFreeRTOSInitAll() { RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOC, ENABLE); GPIO_StructInit(&amp;port); port.GPIO_Mode = GPIO_Mode_Out_PP; port.GPIO_Pin = GPIO_Pin_9|GPIO_Pin_8; port.GPIO_Speed = GPIO_Speed_50MHz; GPIO_Init(GPIOC, &amp;port); } void vLedTask (void *pvParameters) { while(1) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (state == 0) { GPIO_SetBits(GPIOC,GPIO_Pin_9); GPIO_ResetBits(GPIOC,GPIO_Pin_8); state = 1; vTaskDelay(500); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { GPIO_ResetBits(GPIOC,GPIO_Pin_9); GPIO_SetBits(GPIOC,GPIO_Pin_8); state = 0; vTaskDelay(500); } } vTaskDelete(NULL); } int main(void) { vFreeRTOSInitAll(); xTaskCreate(vLedTask,(signed char*)</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"LedTask"</span></span></span><span class="hljs-meta">, configMINIMAL_STACK_SIZE, NULL, tskIDLE_PRIORITY + 1, NULL); vTaskStartScheduler(); }</span></span></code> </pre><br><br>  Now you can assemble the project and upload the firmware to the microcontroller, after the reboot observe the flashing LEDs. </div><p>Source: <a href="https://habr.com/ru/post/399907/">https://habr.com/ru/post/399907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../399895/index.html">Startup blast</a></li>
<li><a href="../399897/index.html">Why do you need to navigate the shopping center in Vkontakte, Telegram and Facebook</a></li>
<li><a href="../399899/index.html">Elektroovtsy ate people: the possible consequences of the development of AI for the labor market</a></li>
<li><a href="../399903/index.html">Car Digest: What to read, watch and listen to the New Year holidays</a></li>
<li><a href="../399905/index.html">Find my car: autoblockchain HashCoins against hijackings and "not a bit, not beautiful" ads</a></li>
<li><a href="../399909/index.html">Mathematics of Biological Switches</a></li>
<li><a href="../399911/index.html">Proprioception for non-specialists. Part 1: Smooth back standing for 10 seconds</a></li>
<li><a href="../399913/index.html">Year of reading under strict control of the goal</a></li>
<li><a href="../399915/index.html">Social networks kill communication because they look like TV</a></li>
<li><a href="../399917/index.html">Technorelax: the beauty and power of CNC machine tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>