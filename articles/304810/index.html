<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mobile VR-game on the Unreal Engine: pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, virtual reality technology has become increasingly popular. And along with the popularization of VR, more developers are starting to make VR...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mobile VR-game on the Unreal Engine: pitfalls</h1><div class="post__text post__text-html js-mediator-article">  Recently, virtual reality technology has become increasingly popular.  And along with the popularization of VR, more developers are starting to make VR games.  At the same time, those rakes that can be stepped on when developing your VR games often differ from the rakes in conventional mobile development.  Under the cut, you will find a detailed story about the pitfalls that the developer of a mobile VR game on the Unreal Engine 4 may encounter. <a href="http://game.hsbi.ru/">Internet projects</a> ‚Äùand together with the FurecoVR company. <br><br><img src="https://habrastorage.org/files/6ad/208/303/6ad2083038484a55af9075c2cfb18c05.jpg"><br><a name="habracut"></a><br>  Before you start any mobile development, you need to decide on basic things.  In particular, create a concept, vision and other game design documentation for your project.  I will not now focus on this topic - <a href="https://habrahabr.ru/company/mailru/blog/266369/">read more in another article</a> on Habr√© from the teacher of the course ‚ÄúProject documentation‚Äù of the program ‚ÄúManagement of online gaming projects‚Äù. <br><br><h2>  <font color="#0066cc">Let's start with goal setting and selection of development tools.</font> </h2><br>  If we talk about our 2048 VR game quite briefly, then we set ourselves the goal of testing the development and launch of a VR game exclusively.  In this regard, it was necessary to choose a simple and fast-to-develop mechanic, which however would be interesting for us, and also had the potential to appeal to the audience and gain user base without marketing investments.  Although we do not embed monetization in this game, it will be useful for our future VR projects to have a user base of our VR game.  After all, as you know, the marketing of VR games on mobile devices is now a separate song, and apart from transferring players from one VR game to another, there is no way to send targeted traffic to people who own VR glasses. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, based on these goals, it was decided to port the well-known and simple mechanics to VR.  Known to use the organic base to install.  Simple, so that the development was fast.  Our solution in this case was a clone of the well-known mobile game 2048, but transferred to VR format using 3D graphics.  Controlling the game field is different from the original game in that the numbers on the field are not shifted with a swipe of a finger, but with head movements left / right, up / down.  It was probably inspired by the fact that a friend in one of clones 2048 (not VR of course) without marketing injections had more than 1.5 million installations from the world, and even monetized well. <br>  So, a simple and potentially popular mechanic is chosen.  Concept and vision we wrote.  It's time to develop. <br><br><img src="https://habrastorage.org/files/bd6/5a8/b5b/bd65a8b5b61c4172908ec00dbac6f789.jpg"><br><br><h2>  <font color="#0066cc">A few words about the choice of engine.</font>  <font color="#0066cc">Why exactly Unreal Engine 4 (further UE)?</font> </h2><br><ol><li>  <b>VR support</b> .  UE was one of the first to announce official support for VR.  The fact that in fact it did not help us, we will tell further. </li><li>  <b>A set of free assets</b> .  Assets are a set of standard models with customized materials that come with the engine.  Since we did not have a budget for creating a unique environment, and for our purposes this was not necessary, the availability of high-quality standard assets allowed us to save a lot of time and money. </li><li>  <b>Good render out of the box</b> .  The UE has a quality render, which produces a decent picture without any special tambourine tricks, if there are well-tuned materials on the models.  And since we used assets provided by the UE itself, we easily got a decent picture. </li><li>  <b>Price issue</b> .  We had the opportunity to do everything on Unity or on the UE, and we just gave a task to evaluate both specialists.  The evaluation of development on Unity was 3 times higher, and having no doubts about UE at that time, we decided not to overpay.  I‚Äôll clarify that for the price it was in our team at that time that the work of the available specialist on Unity was more expensive than the specialist‚Äôs work on the UE. </li></ol><br><br><img src="https://habrastorage.org/files/713/9f3/c8b/7139f3c8b3ce4717bbfad48efd327e2f.jpg"><br><br><h2>  <font color="#0066cc">Something about core mechanics</font> </h2><br>  We went over a few ideas on how exactly the game field will be managed.  At first they wanted to use the side button on the helmet to confirm the action of the field bias, but quickly realized that it was too tiring for both the hand and the whole.  Then they wanted to use the Bluetooth remote control, but they also quickly refused, because  The device, though convenient, is extremely poorly distributed, which means we will not have an audience. <br><br>  So we came to the simplest and most obvious decision - to track head gestures.  While tracking gestures - it says loudly.  In fact, we track the turns of the game camera.  When the center of the screen goes beyond a certain ‚Äúsafe‚Äù zone on the playing field, we consider that the player intends to make a gesture, and depending on where in the center of the screen crossed the border of the safe zone, we decide in which direction the player wants to move the field. (left / right / down / up). <br><br>  Of course, there is one drawback: if a player wants to just look around, the game will still react and the numbers on the field will shift as with a normal gesture.  So you can freely turn your head, though it is possible, but not without consequences for the game results.  We decided that this is a one-time event and in general it is not scary. <br><br><img src="https://habrastorage.org/files/3c3/df5/a88/3c3df5a88814462d9943113252e56f64.jpg"><br><br><h2>  <font color="#0066cc">Now about the pitfalls of the development of Unreal Engine 4</font> </h2><br><ol><li>  <b>Mobile VR is not supported</b> .  It quickly turned out that when the UE talked about supporting VR, it was only about the SDK for Sumsung Gear VR, Oculus Rift and Steam VR (aka HTC Vive).  As it turned out, there was no official SDK for Google Cardboard and other mobile glasses.  <i>But there was an SDK, developed and shared by Nival, which was launched under Cardboard and only on version 4.10 of the engine.</i>  <i>We, determined to work with him</i> . <br><br><img src="https://habrastorage.org/files/623/989/073/623989073cd1404899737812473e8a24.jpg"><br></li><li>  <b>No correspondence of head gestures to camera turns</b> .  One of the first problems we encountered was that the player turns his head horizontally to the right, and instead, the camera rises.  Or the player lowers his head down and the camera turns clockwise.  Those.  Axes and controls are confused.  The Nival SDK was apparently designed only for the android device, and everything worked as it should for them.  But on the iPhone, when switching the orientation from portrait to landscape Pitch, Yaw and Roll did not switch.  At the same time, depending on whether we have the right landscape orientation or the left, they had to switch differently.  <i>The solution was to select only one orientation (used only Landscape Left Orientation) and remove the direct camera control from the HMD.</i>  <i>The orientation of the device only affected the controller, we received its orientation for the camera and changed it: Roll to Yaw, Pitch to Roll and Yaw to Pitch.</i> <br><br></li><li>  <b>Blocking free flip phone</b> .  When we overcame the problem with the axes, it turned out that if we turn the phone over and try to control the field, then the axes will again become confused.  <i>The solution to this problem could take extra time, so we decided to just block the image flipping, and when loading to display a picture that would show how to properly hold the phone</i> . <br><br></li><li>  <b>Duplication and layering of text fields</b> .  We have over the playing field displays points for combining cells with numbers.  Each time a player made a new union, the number of points above the field was not replaced with a new one, but overlapped with a new value.  And this could be repeated to infinity.  The correction took about 2 days.  As it turned out, it was a mistake in the engine itself.  It consisted in the fact that on 3D widgets when building on a device, the rendered text was never removed from the widget.  This error was safely fixed in the 4.11 version of the engine, but we could not use it, since Nival did not patch its plugin.  <i>It was necessary to re-create the entire widget with every change of the account</i> . <br><br></li><li> <b>Under-cross-platform</b> .  It was not possible to develop a single cross-platform build that could be easily built on iOS or Android.  We had to lead and maintain 2 separate builds for each of the axes.  At the same time, creating and testing a project on two platforms turned out to be a bad idea, since the SDK for Android and iOS worked differently and the build requirements for Android and iOS are different.  <i>The solution was to duplicate the project and focus on developing a game for one platform, and then for another</i> . <br><br></li><li>  <b>Wrong starting position of the head when starting the application</b> .  When launching, the user did not align the horizon line in the application, i.e.  when a player clicks on the application icon on the desktop, then the download takes place, and this is where the phone was at the moment the download was completed, this position was considered to be original, and then all the offsets were calculated from this point.  This led to the fact that if a person launched the application while holding the phone in their hands so that, for example, the phone‚Äôs camera was aimed at the floor, then after downloading the application, when the person had already inserted the phone into the helmet, the person tried to look straight ahead, the game camera looked instead somewhere up.  As it turned out, this problem cannot be fixed in adequate time, because  This decision lies on the side of the SDK.  <i>Therefore, all that was in our power is to add a picture when the application is loaded, that when starting the application, the player must place the phone with glasses immediately, while the application has not yet fully loaded.</i>  <i>We were able to solve this problem only with the release of the official SDK for Google VR in version 4.12, but more on that later</i> . <br><br></li><li>  <b>Accumulated offset</b> .  In the process of testing, they began to notice that the longer you play, the further the center of the camera moves somewhere to the side.  It could have gone so far that the camera was so lowered down that the player rested his chin on the chest while trying to make the next field shift down.  Most likely, this bug also came from the Nival SDK, since  In similar VR-developed applications on Unity, this problem was not noticed, and <i>with the release of UE 4.12 update, this bug was also not reproduced</i> . <br><br></li><li>  <b>Logos on download</b> .  As in most mobile applications, in the process of downloading the game, we put our logos.  But the fact is that the UE now, in principle, does not have such a way to insert a picture or video for download so that it is displayed in the VR format, so the logos are shown as flat, as in a normal non-VR application.  This is because the standard way to install the boot image displays the image before the game is downloaded directly in VR format.  And if we move the logos inside the game and display it to show it in VR format, then the player will not understand at first what the game will look like while the game is really loading, and when the game is loaded, they will still watch the video with our logos, which in general will delay the entry moment in Game.  <i>Therefore, in one of the versions, we turned off the video with logos altogether</i> . <br><br></li><li>  <b>Weight of the application</b> .  Our first builds weighed about 370 mb.  And this is the weight of a simple one-play game!  Obviously, the UE has by default packed a lot of its libraries in the build, which, most likely, were not used in our application.  As it turned out, the standard Unreal Engine 4 is a lot of plug-ins connected.  <i>Therefore, we have disabled everything that we did not need: 2D graphics plugins, Android support in the iOS version and vice versa, and the like.</i>  <i>But here you need to be cautious and do not turn off the excess.</i>  <i>As a result, the Android version has decreased to 87 MB, and iOS to 182 MB.</i> <br><br></li><li>  <b>Problems with creating iOS build with certificate for publishing</b> .  From the very beginning, we faced the problem of building a build for iOS.  Since we didn‚Äôt have a Mac device at hand, we had to raise a virtual machine with a Mac and configure the Unreal Remote Tool (to tell how to do this, you need to write a separate article).  When we began to release the iOS version, and tried to supplement the build with a certificate for publishing, the AppStore did not accept the application in any way.  We spent about 30 hours searching for a solution, and, in desperation, asked for help in support of the UE.  Fortunately, thanks to Alexey Savchenko, the question was processed quickly.  It turned out that we are working on the only version of UE 4.10, which has a bug with creating publishing builds for iOS, in previous and next versions there is no problem.  Here is this luck!  <i>Actually the problem was that the build compiled by the engine was not properly ‚Äúsigned‚Äù.</i>  <i>Because of this, the assembled build had to be unpacked, re-signed and re-built</i> . </li><li>  <b>UE update and official SDK Cardboard support</b> .  And on that very day, when we finished our sprint on a rake, we overcame some problems, reluctantly, reconciled with some, Google announces a new platform Daydream, and right there the UE rolls out an update that supports this platform, and at the same time and Cardboard.  Thus, a normal SDK for mobiles appears in the UE.  Without hesitation, we decide to try out this SDK.  On the test scene, we see that the problems we have struggled with for so long are not.  But then the bad news also turns out - the SDK only supports Android devices.  OK!  Let us decide at least on Android, and begin the process of transferring the game to the new SDK.  It takes us about 2 days.  As a result, we get a build in which all the problems from the list above are solved.  Hooray!  Or not?  Not really.  First, some problems still arose, although they were reproduced only on separate devices.  For example, on one Chinese device there was a noise similar to the one that appears when the TV signal is bad.  In addition to this, they began to podlyuchivat little materials (material crawled from one object and partially clasped on another).  As well as the VR image looked defocused, it doubled in the eyes.  However, the bug was not repeated on modern branded phones like the Samsung S6, so it's difficult to assess the coverage of the problem.  But the critical problem for us was that the new SDK did not build Android builds below version 5 at all, although before that we started the application on 4.1+.  After examining the analyst, we found out that about 43% of devices work on Android 5+, which turned out to be below the critical level for us.  We wanted to support at least 80% of devices.  <i>After weighing all the pros and cons, we decided to postpone the release of the version on the new SDK, in favor of the old one, and when the coverage of devices on Android 5+ increases, we update the application.</i> <br><br></li></ol><br><img src="https://habrastorage.org/files/aa9/af1/eda/aa9af1eda3cd4f818adf35ffcb2580a0.jpg"><br><br><h2>  <font color="#0066cc">findings</font> </h2><br><br>  Remember, at first we estimated the development estimate for Unity and Unreal?  So, the development on Unreal cost us no less, and even more.  The main reason for this overkill emerged, initially, because of the fight against the SDK, and then, because of the fight against the publishing of the iOS version. <br><br>  If you ask us, would we again undertake to make a mobile VR game on Unreal, going through all this?  If done exclusively under Android 5+, then, probably, yes.  Otherwise, no.  The team made such an application on Unity for several evenings, and did not worry about the SDK, focusing on the functionality, although the developer managed much more expensive, but less nerves and a faster result. <br><br>  What is UE suitable for?  If you are doing a VR project on a PC, or NOT a VR project for mobile phones, then the UE is an excellent choice for a number of reasons, which we will not delay now, since  The article is not about that.  But for a mobile VR, it is not yet ready.  However, for sure, with updates, mobile VR support will improve. <br><br>  As for the direction of VR development as a whole, I myself personally believe that virtual reality will ignite already by 2020 and will bring good revenue to VR developers.  Therefore, those who are now starting their experiments or conducting research on this technology, in my subjective opinion, have great chances to get their profit a hundredfold by 2020.  And I hope that the article will help those who are now dropping into this as yet only picking up course of the VR locomotive. <br><br><img src="https://habrastorage.org/files/621/312/c35/621312c352e44f4c8e1fa62742a80a4a.jpg"><br><br>  Separate, thanks for the help in developing the application and writing the article for the FurecoVR team: <a href="https://www.facebook.com/filchencko">Evgeny Filchenko</a> and Dmitry Kostyukevich. <br>  And thanks for advising <a href="https://habrahabr.ru/users/kallist/" class="user_link">Kallist</a> and <a href="https://habrahabr.ru/users/eligar/" class="user_link">Eligar</a> <br><br>  <b>Here are the links to the game:</b> <b><br></b>  <b>iOS: <a href="https://itunes.apple.com/ru/app/2048/id1109740917">https://itunes.apple.com/ru/app/2048/id1109740917</a></b> <b><br></b>  <b>Android: <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.antarex.vr2048">https://play.google.com/store/apps/details?id=com.antarex.vr2048</a></b> <br><br>  I will be glad to answer your questions and discuss the prospects of mobile VR in the comments! </div><p>Source: <a href="https://habr.com/ru/post/304810/">https://habr.com/ru/post/304810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304794/index.html">First look at the new Cisco Firepower Threat Defense software (UPD 02.09.16)</a></li>
<li><a href="../304798/index.html">Everything you wanted to know about RAID controllers, but it was too lazy to look</a></li>
<li><a href="../304800/index.html">Bloom filter for web developers</a></li>
<li><a href="../304804/index.html">Comparison of online name resolution services</a></li>
<li><a href="../304806/index.html">Beginning the translation of the ‚Äúlegacy‚Äù of the Angular JS project to the Angular 1.5 Components / ES6 and TypeScript</a></li>
<li><a href="../304812/index.html">Oracle has stopped developing Java EE?</a></li>
<li><a href="../304814/index.html">Ansible: testing playbooks (part 2)</a></li>
<li><a href="../304816/index.html">How to learn programming languages</a></li>
<li><a href="../304818/index.html">Why do hackers really attack the exchanges and is the problem so big?</a></li>
<li><a href="../304820/index.html">Gartner's Magic Quadrant for Data Center Networking Market: Arista Networks Leading</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>