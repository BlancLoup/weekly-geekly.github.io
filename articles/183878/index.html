<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Account hacking and unicode characters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the technical blog " Spotify " an interesting study was published on the topic of hacking service accounts by using the features of canonization of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Account hacking and unicode characters</h1><div class="post__text post__text-html js-mediator-article"> In the technical blog " <a href="https://www.spotify.com/">Spotify</a> " <a href="http://labs.spotify.com/2013/06/18/creative-usernames/">an</a> interesting study <a href="http://labs.spotify.com/2013/06/18/creative-usernames/">was published</a> on the topic of hacking service accounts by using the features of canonization of user-entered data.  This was made possible thanks to the fact that Spottifayans are proud of - a fully Unicode login.  For example, a user can easily have a snowman as an account name if he so desires.  The implementation of this, however, from the very beginning brought some inconvenience. <br><br>  A few years ago on Good Friday, a message was posted on the tech support forum about the possibility of hacking any account on the service.  A company representative asked to demonstrate this using the example of his own account, and within a few minutes he was given a new password and a new playlist was created.  This immediately attracted the attention of several employees who were forced to spend Easter in an attempt to close the ‚Äúhole‚Äù.  Due to the nature of the vulnerability, registration of new accounts has been temporarily closed. <br><br>  The hacker acted as follows: wanting to hack an account with a name, say, bigbird, he registered an account with the name ·¥Æ·¥µ·¥≥·¥Æ·¥µ·¥ø·¥∞ (in Python, this line looks like <code>u'\u1d2e\u1d35\u1d33\u1d2e\u1d35\u1d3f\u1d30‚Ä≤</code> ).  After requesting a link to reset the password, a new password was set that matched the bigbird account. <br><a name="habracut"></a><br>  The problem was to canonize a username that incorrectly handled forbidden and equivalent characters.  Obviously, no spaces are allowed in the username, and BigBird and bigbird are the same login.  The first case is the processing of prohibited characters, the second is the processing of some characters as equivalent to each other.  Similar is achieved by canonizing the username. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If only Latin characters are allowed (a ‚Äî z, A ‚Äî Z), then <br><br><pre> <code class="python hljs">canonical_username = username.lower()</code> </pre> <br><br>  Thus BigBird, Bigbird, bigbird and any derivatives will be the same login.  In this case, BigBird is called the exact user name, and bigbird is called canonical.  When creating an account it is necessary that the canonical login is free in the system. <br><br>  Appeal to lower case has the property of idempotency, that is, its application to the same line one and more times gives the same result: <br><br><pre> <code class="python hljs">x.lower() == x.lower().lower()</code> </pre> <br><br>  With the resolution of unicode characters, various problems begin.  For example, it is difficult to externally distinguish Œ© from Œ©, although the first is the letter omega, and the second is the unit symbol, and in Unicode these are different symbols.  Obviously, just going to lower case would not be enough.  Fortunately for developers, they did not have to develop their own canonization system, the Twisted framework had the necessary methods developed for XMPP. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> twisted.words.protocols.jabber.xmpp_stringprep <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> nodeprep <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canonical_username</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nodeprep.prepare(name)</code> </pre> <br><br>  Idempotency <a href="https://tools.ietf.org/html/draft-ietf-xmpp-nodeprep-03">is promised in the specifications</a> .  So what's the deal?  Let's see what happens when you type ·¥Æ·¥µ·¥≥·¥Æ·¥µ·¥ø·¥∞. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>canonical_username(<span class="hljs-string"><span class="hljs-string">u'\u1d2e\u1d35\u1d33\u1d2e\u1d35\u1d3f\u1d30'</span></span>) <span class="hljs-string"><span class="hljs-string">u'BIGBIRD'</span></span> &gt;&gt;&gt; canonical_username(canonical_username(<span class="hljs-string"><span class="hljs-string">u'\u1d2e\u1d35\u1d33\u1d2e\u1d35\u1d3f\u1d30'</span></span>)) <span class="hljs-string"><span class="hljs-string">u'bigbird'</span></span></code> </pre> <br><br>  As can be seen, the idempotency property is not satisfied for these symbols.  The fact is that according to official documentation, Unicode 3.2 characters were taken into account, which does not include any of the ·¥Æ·¥µ·¥≥·¥Æ·¥µ·¥ø·¥∞ characters.  When registering an account after a single use of the canonization function, a BIGBIRD login was created, which was acceptable, since the canonical name did not overlap with the existing bigbird account.  When sending an e-mail with a link to reset the password, ·¥Æ·¥µ·¥≥·¥Æ·¥µ·¥ø·¥∞ was canonized once, so the user received a BIGBIRD message.  But when using the link, the canonization function was reused, which led to resetting the password for the bigbird account, and not BIGBIRD. <br><br>  The vulnerability was first corrected by the requirement of fulfilling the condition <code>X==canonical_username(X)</code> .  Later, a function was added that, in fact, only performed the function of canonization and refused to register if <code>old_prepare(old_prepare(name)) != old_prepare(name)</code> .  The problem in Twisted was fixed in version 11.0.0, and, as it turned out, the bug manifested itself only when upgrading the version of Python from 2.4 to 2.5, which was caused by changes in the standard library. <br><br>  Such cases once again underline the need to validate user input and avoid negative information when communicating between users and employees.  The hackers who found the vulnerability were awarded several months of a free premium subscription, and this was not the first or the last case of problems with character processing features.  Also, do not forget that updates do not always promise to get rid of bugs and sometimes generate new ones. </div><p>Source: <a href="https://habr.com/ru/post/183878/">https://habr.com/ru/post/183878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183864/index.html">NASA is asking for help in finding dangerous asteroids to neutralize them</a></li>
<li><a href="../183866/index.html">Watch MKV on Apple TV from Plex</a></li>
<li><a href="../183868/index.html">Add links to site pages in CKEDITOR 4</a></li>
<li><a href="../183872/index.html">A network of "solar" charging stations is being created in New York</a></li>
<li><a href="../183874/index.html">The arrival of Node on Android: the first steps</a></li>
<li><a href="../183882/index.html">Using vSphere Web Client to Deploy Virtual Machines</a></li>
<li><a href="../183886/index.html">Helmet with integrated navigation system</a></li>
<li><a href="../183888/index.html">Call center is simple and cheap</a></li>
<li><a href="../183890/index.html">CyanogenMod vs AOKP</a></li>
<li><a href="../183892/index.html">Real orders microcontroller Virt2real (Virtuirlki)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>