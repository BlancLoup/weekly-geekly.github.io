<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>And about the "home" Asterisk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading this post , I decided to share my experience. 

 Currently 2 simple tasks are solved: 


- all calls to the PSTN number (normal city) ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>And about the "home" Asterisk</h1><div class="post__text post__text-html js-mediator-article">  After reading <a href="http://habrahabr.ru/blogs/voip/104026/">this post</a> , I decided to share my experience. <br><br>  Currently 2 simple tasks are solved: <br><ul><li>  all calls to the PSTN number (normal city) are forwarded to a mobile phone, which I always have in my pocket and, at the same time, to a SIP phone that is at home </li><li>  From a SIP phone, I can call both in Russia and in some of the countries I need at minimum rates. </li></ul><br>  How is this done? <a name="habracut"></a><br><br><h2>  Choose a DID number </h2><br>  It all starts with the phone number to which they will call you, the common name is <a href="http://en.wikipedia.org/wiki/Direct_inward_dialing">Direct Inward Dialing (DID) number</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The cheapest offer with direct Moscow number - " <a href="http://gobaza.ru/">Baza</a> " (provided by the Central Telegraph).  At the time of writing the post, <a href="http://gobaza.ru/price/Start-viz/untitled.php">the cheapest fare is</a> 250 rubles per month, plus a one-time fee for connecting a number in code 499 or 495, to choose from.  When signing the contract, it is better to immediately ask for the connection to be redirected to a SIP device (additional service ‚ÄúBaza-IP‚Äù, the connection is charged one-time).  Forwarding to SIP is free.  It is my choice. <br><br>  If you need a very cheap and angry, there is a <a href="http://mangooffice.ru/ru/tariffs/msk_sdov/">mango-office, a Moscow number with a tone dial</a> for 30 rubles / month :) I have not tried this option. <br><br>  You can buy a DID number from 49 <a href="http://www.localphone.com/incoming_numbers">local countries from the localphone</a> (Russia is not on the list) with a payment of ¬£ 0.75 (‚âà37 rubles) per month.  I have not tried this option yet, but I plan it :) A room in London or New York can be useful. <br><br><h2>  Customize the "Bas" </h2><br>  In the "personal account" we go to the "redirection" section and set, to your taste, the settings: <br><ul><li>  number of simultaneous incoming connections ‚Üí "1" </li><li>  call forwarding to voicemail ‚Üí ‚Äúoff‚Äù </li></ul><br>  Next, in the ‚ÄúForwarding Numbers‚Äù subsection add the magic phone number: 88830849XXXXXXXXX.  For example, if you have a phone number of the base (499) 501-2345, then you should set the redirection to the number 8883084995012345. Forwarding to this number means redirecting to the SIP device, which is registered on the database server.  The remaining redirection numbers, if any, can be deleted. <br><img src="https://habrastorage.org/storage/habraeffect/60/85/6085f648406aa99a6b9a56ff5ff71dfb.png" width="576" height="395"><br><br>  This completes the minimum required settings. <br><br><h2>  VoIP Server </h2><br>  For Asterisk, a cheap <a href="http://www.syscentral.de/en/">virtual server in Germany</a> was selected on Xen technology for ‚Ç¨ 3 / month: 128Mb RAM, 256Mb swap, 10Gb disk, Debian stable OS.  At the moment this is more than enough. <br><br><h2>  Connecting "Bas" and Asterisk </h2><br>  It is enough to enter the following lines in /etc/asterisk/users.conf: <br><blockquote><code>[baza] <br> secret            = *** <br> defaultuser       = 849******** <br> trunkname         = baza <br> callerid          = <br> hasexten          = no <br> hassip            = yes <br> hasiax            = no <br> host              = qwerty.cnt.ru <br> context           = from-baza <br> insecure          = invite <br> fromuser          = 849******** <br> fromdomain        = qwerty.cnt.ru <br> type              = friend <br> callbackextension = 111 <br> disallow          = all <br> allow             = alaw <br> allow             = ulaw <br> allow             = g729 <br> nat               = no <br> canreinvite       = nonat <br> dtmfmode          = rfc2833 <br></code> </blockquote><br><br>  And we create a ‚Äúfrom-baza‚Äù context in terms of numbering with one single number, which was specified above in the callbackextension parameter.  The easiest option in /etc/asterisk/extensions.conf: <br><br><blockquote> <code>[inc-redirect-to-me] <br> Exten =&gt; 111, 1, Dial(SIP/terrasip/79*********&amp;SIP/112,60) <br> Exten =&gt; 111, n, Hangup() <br> <br> [from-baza] <br> include =&gt; inc-redirect-to-me <br></code> </blockquote><br><br>  We call simultaneously on the mobile phone through the <a href="http://terrasip.com/">TerraSIP</a> operator and on the SIP phone standing on the table.  I will not give the last settings - everything is standard. <br><br><h2>  Operator selection for VoIP traffic termination </h2><br>  It was not without adventures. <br><br>  At first, the choice seemed obvious - Betamax.  This is a German VoIP operator with very tasty tariffs and, with it, good call quality.  He works through several dozen of his resellers, so first we look at the rates in the <a href="http://backsla.sh/betamax">pivot table</a> , then check in with the reseller with the most favorable rates and enjoy life :) I did so. <br><br>  And yesterday everything stopped working.  Betamax servers consistently send a message to my asterisk: "SIP / 2.0 503 For wholesale traffic, check <a href="http://www.voicetrading.com/">www.voicetrading.com</a> ". <br><br>  The investigation showed that it was the IP address of my virtual server that was banned - from my home computer all calls under the same accounts pass.  Posted in support.  They pretend that they know nothing and offer me to check my settings.  The aforementioned voicetrading.com is also a Betamax reseller, but it works with organizations and the minimum contribution there, as far as I was able to figure out, is $ 500 (versus ‚Ç¨ 10 for the rest). <br><br>  Summary: Betamax is not suitable for my purposes, as sad as it sounds. <br><br>  Now I use the <a href="http://terrasip.com/">TerraSip</a> operator.  Tariffs here are <a href="http://www.terrasip.com/index.php%3Fseite%3Dtarife4%26language%3Dru%26t_country%3Dru">slightly higher</a> than that of Betamax and, most importantly, there are no free minutes, as in the latter.  Asterisk settings for working with TerraSip will also not be given - everything is <a href="https://www.terrasip.com/xoshop/faqdesk_index.php%3Fnav%3D2%26faqPath%3D8">described in detail</a> on their website. <br><br><h2>  Future plans </h2><br>  I add additional functionality as I read the documentation for Asterisk and when there is a desire to improve everything :) The plans include setting up your voice mail, <a href="http://en.wikipedia.org/wiki/Call_screening">call screening</a> (taking into account that Caller ID is lost when forwarding to a mobile phone), recording conversations, black / gray lists , callback to mobile phone, etc.  I will share the nuances :) </div><p>Source: <a href="https://habr.com/ru/post/104085/">https://habr.com/ru/post/104085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104079/index.html">My minimum set of applications for Android</a></li>
<li><a href="../104080/index.html">Vanity: a community for advertisers</a></li>
<li><a href="../104081/index.html">About persistent stirring in the right places</a></li>
<li><a href="../104083/index.html">What does the Chinese keyboard look like?</a></li>
<li><a href="../104084/index.html">Unusual congratulations on the day of the programmer</a></li>
<li><a href="../104086/index.html">pdb - Interactive debugger</a></li>
<li><a href="../104087/index.html">Ultralight startups in Runet: already possible ... but lazy?</a></li>
<li><a href="../104089/index.html">HTC Desire vs. Wildfire</a></li>
<li><a href="../104092/index.html">Android 2.x is currently used on 70% of all active Android devices.</a></li>
<li><a href="../104093/index.html">Interview: Jim Johnson from Standish Group</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>