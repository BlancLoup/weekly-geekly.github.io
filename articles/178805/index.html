<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Safe work with exceptions in C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Structural exceptions are one of the key mechanisms for handling erroneous (including exceptional situations proper). Below are some programming guide...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Safe work with exceptions in C #</h1><div class="post__text post__text-html js-mediator-article"> Structural exceptions are one of the key mechanisms for handling erroneous (including exceptional situations proper).  Below are some programming guidelines that improve the overall quality of the code when dealing with exceptions in C # and, more broadly, the .NET platform. <br><br>  <b>Own class</b> .  Throw exceptions based on your own class inherited from <code>Exception</code> , and not directly on the basis of <code>Exception</code> , because it gives you the opportunity to define your own handler and separate the tracking and handling of exceptions thrown by your code and the code of .NET. <br><br>  <b>Separate fields</b> .  Create separate fields in your own class to transfer essential information, instead of serializing and deserializing data in the <code>Message</code> field.  Despite the fact that the idea of ‚Äã‚Äãpacking complex data in a <code>Message</code> in the form of a JSON string is tempting, it is rarely a good idea because it adds an extra expense to the coding, localization, decoding. <br><a name="habracut"></a><br>  <b>Messages to the log</b> .  Write to the log message whenever the handler catches <code>Exception</code> , by calling <code>Exception.ToString();</code>  this makes it easier to track when debugging exceptions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Exact class</b> .  Use the least common class to catch exceptions, otherwise it can lead to hard-to-find errors.  Consider the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleClass</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoSomething</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SimpleLibrary.ReportStatus(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Failure 1"</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleLibrary</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReportStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String.Format(<span class="hljs-string"><span class="hljs-string">"Success {0}."</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre><br><br>  If we assume that the code of the <code>SimpleClass</code> and <code>SimpleLibrary</code> are in separate assemblies, then in the case when both assemblies are installed correctly, the code runs correctly, displaying the message ‚ÄúSuccess 0‚Äù, and if the assembly with the <code>SimpleLibrary</code> class <code>SimpleLibrary</code> not installed, then the code is executed incorrectly, displaying the message ‚ÄúFailure 1‚Äù, despite the fact that no error occurs during the execution of the <code>ReportStatus</code> function.  The problem is not obvious due to too generalized handling of exceptions.  The code formatting the string throws <code>ArgumentNullException</code> and <code>FormatException</code> , so these exceptions should be caught in the catch block, then the reason for the error becomes obvious - this is a <code>FileNotFoundException</code> exception due to the absence or incorrect installation of the assembly containing the <code>SimpleLibrary</code> class. <br><br>  <b>Content processing</b> .  Always handle exceptions meaningfully.  View Code <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { DoSomething(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (SomeException) { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> ... }</span></span></code> </pre><br><br>  hides problems, not allowing them to be detected during debugging or execution. <br><br>  <b>Cleaning in the <code>finally</code> block</b> .  Delete temporary objects in <code>finally</code> blocks.  Consider the operation of writing a temporary file. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkWithFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamWriter sw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamWriter(filename)) { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Do something with temporary file } File.Delete(filename); } catch (Exception) { File.Delete(filename); throw; } }</span></span></code> </pre><br><br>  As you can see, the code deleting the file is duplicated.  To avoid repetition, you need to remove the temporary file from the <code>finally</code> block. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WorkWithFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (StreamWriter sw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamWriter(filename)) { <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> Do something with temporary file } } finally { File.Delete(filename); } }</span></span></code> </pre><br><br>  <b>Operator <code>using</code></b> .  Use the <code>using</code> statement.  It guarantees a call to the <code>Dispose</code> method, even if an exception occurs in the object when the methods are called. <br><br><pre> <code class="bash hljs">using (Font f = new Font(<span class="hljs-string"><span class="hljs-string">"Times New Roman"</span></span>, 12.0f)) { byte charset = f.GdiCharSet; }</code> </pre><br><br>  Using the <code>using</code> statement is equivalent to a <code>try/finally</code> block, but more compact and concise. <br><br><pre> <code class="cs hljs">Font f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Font(<span class="hljs-string"><span class="hljs-string">"Times New Roman"</span></span>, <span class="hljs-number"><span class="hljs-number">12.0f</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> charset = f.GdiCharSet; } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) ((IDisposable)f).Dispose(); }</code> </pre><br><br>  <b>The result of the function</b> .  Do not use exceptions to return the result of the function and do not use special return codes for error handling.  To each his own.  The result of the function must be returned, and errors that cannot be skipped must be processed using exceptions. <br><br>  <b>Lack of resource</b> .  Return <code>null</code> if there is no resource.  According to the convention common to the .NET API, functions should not throw exceptions when there is no resource; they should return <code>null</code> .  So <code>GetManifestResourceStream</code> returns <code>null</code> if resources were not specified during compilation or not visible to the calling code. <br><br>  <b>Departure location</b>  Keep information about the original location of the exception.  For example, <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Do something to throw exception } catch (Exception e) { // Do something to handle exception throw e; // Wrong way! throw; // Right way }</span></span></code> </pre><br><br>  In the case of a call to <code>throw e;</code>  information about the place of generation of the exception will be replaced by a new line, since the creation of a new exception will clear the call stack.  Instead, call <code>throw;</code>  which simply rethrows the original exception. <br><br>  <b>Adding meaning</b> .  Change the original exception only to add meaning to the user.  For example, in the case of connecting to the database, the user may be indifferent to the reason for the connection failure (socket error), enough information about the failure itself. <br><br>  <b>Serialization</b> .  Make exceptions inherited from <code>Exception</code> serializable with <code>[Serializable]</code> .  This is useful because it is never known in advance where the exception will be received, for example, in a web service. <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SampleSerializableException</span></span> : <span class="hljs-title"><span class="hljs-title">Exception</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleSerializableException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleSerializableException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleSerializableException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message, Exception innerException</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message, innerException</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SampleSerializableException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SerializationInfo info, StreamingContext context</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">info, context</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre><br><br>  <b>Standard constructors</b> .  Implement standard constructors, otherwise proper exception handling can be difficult.  So to exclude <code>NewException</code> these constructors are: <br><br><ul><li> <code>public NewException();</code> </li> <li> <code>public NewException(string);</code> </li> <li> <code>public NewException(string, Exception);</code> </li> <li> <code>protected or private NewException(SerializationInfo, StreamingContext);</code> </li> </ul><br><hr><br>  Based on MSDN, CodeProject, StackOverflow. </div><p>Source: <a href="https://habr.com/ru/post/178805/">https://habr.com/ru/post/178805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178789/index.html">"Solar impulse" crosses the US, using only the energy of the sun</a></li>
<li><a href="../178791/index.html">Lenticular hidden text boards for small people</a></li>
<li><a href="../178797/index.html">Development Environment with Vagrant and Chef</a></li>
<li><a href="../178799/index.html">Small script for Naumen Phone Outsourcing</a></li>
<li><a href="../178803/index.html">Google Glass. Start</a></li>
<li><a href="../178807/index.html">So Is Symbian Dead Or A Tale Of Cameraphones?</a></li>
<li><a href="../178809/index.html">Automatic shutdown of computer peripherals</a></li>
<li><a href="../178811/index.html">Work with data models in javascript</a></li>
<li><a href="../178813/index.html">Introducing GStreamer: Introduction</a></li>
<li><a href="../178815/index.html">Chaos within us</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>