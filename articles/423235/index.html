<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From Dribbble to Android Motion</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the Internet, there are many interesting animated templates with beautiful user interfaces for mobile applications, but not many examples with the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From Dribbble to Android Motion</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/1f/ik/0y/1fik0y6mjvsy1x6qgcgzpaqgx8a.png"><br><br>  On the Internet, there are many interesting animated templates with beautiful user interfaces for mobile applications, but not many examples with the implementation of these interfaces.  Despite the abundance of various built-in frameworks and tools in the Android SDK, it is often difficult for a beginner developer to implement a beautiful user interface, including the presence of a ready-made template. <br><br>  In this article we will try to implement the user interface developed by designer Ivan Parfenov for the studio PLATES. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mw/ue/3o/mwue3ov1hvefjixsf9uq8cfis6i.gif" width="640" height="480"></div><br>  First, create two fragments: <code>RecyclerFragment</code> and <code>DetailsFragment</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/webt/_-/y0/gs/_-y0gsqq2iheehhv6n6m8hllyki.png"></div><br><h3>  Android Transition framework? </h3><br>  Android Transition framework works well, but there are some nuances.  First, we want everything to work for us at least on API 19, and second, we need to animate several user elements at the same time and some of them are present in only one fragment.  Therefore, we implement the animation of the transition element (shared element transition) manually using <a href="https://developer.android.com/reference/android/view/ViewPropertyAnimator"><code>ViewPropertyAnimator</code></a> . <br><br><h3>  All in order </h3><br><ol><li>  We calculate the final coordinates of the selected item from the list (its coordinates in the <code>DerailsFragment</code> ), the list is <code>RecyclerView</code> ; </li><li>  Save current coordinates (coordinates in <code>RecyclerFragment</code> ) and transfer them to <code>DetailsFragment</code> (this is needed for reverse animation with API &lt;21); </li><li>  Create a copy of the selected item from the list; </li><li>  Make the selected item invisible (not the copy, but the item itself); </li><li>  Add the copy created in p. 3 to the root layout of the parent fragment, in our case it is <code>RecyclerFragment</code> ; </li><li>  Run the animation of the rest of the interface elements and move the created copy to the final coordinates from step 1; </li><li>  When the animation ends, create a transaction and show <code>DetailsFragment</code> ; </li><li>  We start animation of elements of the interface in <code>DetailsFragment</code> . </li></ol><br><h3>  UI element animation </h3><br>  To animate the <code>Toolbar</code> we will create an additional <code>View</code> in the <code>RecyclerFragment</code> and place it behind the screen above.  This <code>View</code> will be animated in the <code>Toolbar</code> container in <code>DetailsFragment</code> (blue color on gif) using <code>ViewPropertyAnimator</code> . <br><br><pre> <code class="hljs objectivec">&lt;View android:<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>=<span class="hljs-string"><span class="hljs-string">"@+id/details_toolbar_helper"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"@dimen/details_toolbar_container_height"</span></span> android:background=<span class="hljs-string"><span class="hljs-string">"@color/colorPrimary"</span></span> app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span>/&gt; <span class="hljs-comment"><span class="hljs-comment">// In RecyclerFragment details_toolbar_helper.translationY = -details_toolbar_helper.height</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/sm/3z/gwsm3zijdtpledns5la0lcdzi0y.gif" alt="image"></div><br>  The animation <code>BottomNavigationView</code> and <code>RecyclerView</code> also implemented using <code>ViewPropertyAnimator</code> , nothing complicated (changing transparency and moving). <br><br><h3>  A little bit from the Transition framework </h3><br>  If in simple terms, the android transition framework, when it starts animating the transition element, creates a copy of the content of this transition element (something like print screen), makes an ImageView from this copy, then adds this image to the additional layer of the root markup (overlay layer) in called fragment and starts the animation. <br><br>  Us android transition framework does not quite fit, because  when the transition element animation starts, all other user interface elements in the fragment are destroyed and we cannot animate them.  Those.  When we in the <code>RecyclerFragment</code> click on the list item to open the <code>DetailsFragment</code> and start the transition animation, all other interface elements in the <code>RecyclerFragment</code> destroyed without animation. <br><br>  To get the desired result, we will manually create a copy of the selected item from the list, add it to the overlay layer and then animate.  But here there is a small problem, the documentation for the <code>ViewGroupOverlay add(view: View)</code> method says: <br><blockquote>  If you‚Äôre on the wall, you‚Äôll have to add it to the overlay. </blockquote><br>  But for <code>RecyclerView</code> this does not work, the selected item is not removed from <code>RecyclerView</code> after it is added to the overlay layer. <br><br>  This is what happens when we add the selected item to the overlay layer: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vq/ma/wb/vqmawbr_kn5wjnqkdr6-igjoouu.gif"></div><br><br>  And we need to: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t4/_w/lj/t4_wljnxye_ywpwvlxlewpqezac.gif"></div><br><br>  Therefore, we will not use the overlay layer, but we will immediately add a copy to the root layout.  Create a copy of the content of the selected item, add it to the <code>ImageView</code> and set the coordinates: <br><br><pre> <code class="hljs coffeescript">fun View.copyViewImage(): View { val copy = ImageView(context) val bitmap = drawToBitmap() copy.setImageBitmap(bitmap) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  pre-Lollipop   ,   card view  ,      card view <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) { CardView(context).apply { cardElevation = resources.getDimension(R.dimen.card_elevation) radius = resources.getDimension(R.dimen.card_corner_radius) addView(copy) } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { copy }).apply { layoutParams = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.layoutParams layoutParams.height = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.height layoutParams.width = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.width x = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.x y = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>@copyViewImage.y } }</code> </pre> <br><br>  <i>Why create a copy if you can just animate an item directly selected from the list?</i> <br><br>  Because the <code>RecyclerView</code> itself will also be animated and, accordingly, all its elements, including the selected one, which we want to animate separately. <br><br>  After that, add a copy to the root markup and start the animation. <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">View</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fragmentTransaction = initFragmentTransaction(view) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> copy = view.createCopyView() root.addView(copy) view.visibility = View.INVISIBLE startAnimation(copy, fragmentTransaction) }</code> </pre> <br><br>  And here's what we got: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sq/4j/qn/sq4jqnsbpjbhkm1zi20-1bjp-f4.gif" width="320" height="530"></div><br><br><h3>  Finish line </h3><br>  The animation on the gif above occurs in the <code>RecyclerFragment</code> , and after its completion we need to show the <code>DetailsFragment</code> . <br><br><pre> <code class="hljs">.withEndAction { fragmentTransaction?.commitAllowingStateLoss() }</code> </pre> <br>  <i>Why do we use <code>commitAllowingStateLoss</code> ?</i> <br><br>  If it is not used and at the time of the animation is, for example, a change in the orientation of the screen, then we will get <code>IllegalStateExeption</code> .  <a href="https://www.androiddesignpatterns.com/2013/08/fragment-transaction-commit-state-loss.html">Here it is</a> well written about it. <br><br>  Next, we start the animation of the required user interface elements in <code>DetailsFragment</code> . <br><br><h3>  Run it all together </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kq/dj/2c/kqdj2cn8_lzsn3cc6xrllb-xlv0.gif"></div><br><br>  Not exactly as the original, but it looks like. <br><br><h3>  Examples </h3><br>  The source code is available on <a href="https://github.com/bitvale/DroidMotion">GitHub</a> , also the article is available in <a href="https://android.jlelse.eu/from-dribbble-template-to-android-motion-74fe03282c88">English</a> . <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/423235/">https://habr.com/ru/post/423235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../423221/index.html">Interview with Liz Parrish, CEO BioViva</a></li>
<li><a href="../423225/index.html">Jeff Bezos Foundation "Day One"</a></li>
<li><a href="../423229/index.html">Pattern matching in C # 7</a></li>
<li><a href="../423231/index.html">Anomaly Frango, the climax</a></li>
<li><a href="../423233/index.html">Artificial Intelligence in the real world</a></li>
<li><a href="../423237/index.html">Simple but smart robotic arm</a></li>
<li><a href="../423239/index.html">Creating packages for Kubernetes with Helm: chart structure and templating</a></li>
<li><a href="../423241/index.html">Digium A20 and A25 SIP Phone Review</a></li>
<li><a href="../423243/index.html">Vector averaging method for measuring wind direction</a></li>
<li><a href="../423247/index.html">What is intelligence?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>