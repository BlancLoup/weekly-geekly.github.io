<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protection against SQL injection in PHP and MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To my surprise, I did not find an exhaustive article on the topic of protection against injections on Habr√©. Therefore, I decided to write my own. 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protection against SQL injection in PHP and MySQL</h1><div class="post__text post__text-html js-mediator-article">  To my surprise, I did not find an exhaustive article on the topic of protection against injections on Habr√©.  Therefore, I decided to write my own. <br><br><div class="spoiler">  <b class="spoiler_title">Somewhat extensive disclaimer, not directly related to the issue</b> <div class="spoiler_text">  Let's recognize the fact: the number of articles (and comments) on the topic of protection against SQL injections that have appeared on Habr√© lately, tells us that the glade is not so well trampled as some believe.  Moreover, the repetition of the same mistakes suggests that some errors are too stable, and not just a listing of standard techniques is required, but a detailed explanation of how they work and in what cases should be used (and in which cases not). <br><br>  The article turned out to be rather long - it contains research results for several years - but I will try to set out the most important information in a very compact way at the very beginning, and bring more detailed arguments and illustrations, as well as various curiosities and interesting facts, at the end.  Also, I will try to finally dispel the multiple misconceptions and superstitions associated with the topic of protection from injections. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will not try to portray the polyglot and write recommendations for all databases and languages ‚Äã‚Äãat once.  I have enough experience only in web development, on a bunch of PHP / MySQL.  Therefore, all practical examples and recommendations will be given for these technologies.  Nevertheless, the theoretical principles outlined below are applicable, of course, for any other languages ‚Äã‚Äãand DBMS. <br><br>  I‚Äôll immediately reply to the standard remark about ORM, Active record and other query builders: first, all these wonderful tools are not born by magic of the sea foam, but are written by programmers using all the same sinful SQL.  Secondly, we will be realistic: the listed technologies are good, but in practice, raw SQL is constantly encountered in our work - whether it is a legacy code or a spreading JOIN, which is translated to ORM - more expensive.  So let's not bury our heads in the sand and pretend that there is no problem. <br><br>  Although I have tried to highlight in detail all the nuances, but it is quite possible that some of my conclusions may not seem obvious.  I fully admit that my context and reader contexts may vary.  And things that seem self-evident to me are not so for some readers.  In this case, I will be glad to questions and clarifications that will help me correct the article, making it more understandable and informative. <br></div></div><br>  Having just started to be interested in the topic of protection against injections, I always wanted to formulate a set of rules that would be both exhaustive and compact.  Over time, I managed it: <br><br><h4>  The rules, the observance of which guarantees us from injections </h4><br><ol><li>  We substitute data into the request only through placeholders </li><li>  identifiers and keywords are substituted only from the white list, written in our code. </li></ol><br>  Only two points. <br>  Of course, the practical implementation of these rules needs more detailed coverage. <br>  But this list has a great advantage - it is accurate and comprehensive.  Unlike the mass-conscious rules of ‚Äúdriving user input through mysql_real_escape_string‚Äù or ‚Äúalways use prepared expressions,‚Äù my set of rules is not a catastrophic error (like the first) or incomplete (like the second). <br><br>  But forward, reader - let's proceed to a detailed analysis. <br><a name="habracut"></a><br><h5>  Placeholders - Data Substitution </h5><br>  In principle, everything is simple: any data should fall into the query not directly, but through a certain representative, wildcard expression. <br>  The request is written in the form, for example, <pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> &gt; ? <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> ?</code> </pre>  and the data is added and processed separately. <br>  But why is this better than ‚Äúordinary escape‚Äù?  And all: <br><ul><li>  Firstly, escaping has nothing to do with security at all.  Imagine! </li><li>  Secondly, the code becomes trite shorter.  No mysql_real_escape_string (), nor even intval () to you - all processing is hidden inside. </li><li>  Thirdly, the code becomes <i>easier</i> .  No need to memorize different rules for formatting different parts of the request. </li><li>  Fourthly, the use of placeholders (provided that they are processed correctly) guarantees us from injections through the data.  ‚ÄúIt's obvious!‚Äù - you will say - ‚Äúwas it worth a separate item?‚Äù It was worth it.  The same escape protection does not guarantee.  Plus, the reduction of formatting rules to one - confusing something here will be difficult </li><li>  Fifth, and most importantly, <b>we process data exactly where it is needed</b> !  This is a very important point that many do not understand.  In the classic ‚Äúcool‚Äù tutorials, data formatting for SQL is scattered throughout the code.  And in old versions of PHP, it started at all before the start of the code execution - which is no longer possible at any gate!  This situation leads to the fact that <i>some data is formatted twice, others - only half, and the third - and never once or not at all, as needed, without the slightest benefit</i> .  At the same time, the data formatted for SQL suddenly appears in HTML or cookies, which also does not add joy to users and developers. </li></ul><br>  Therefore, the best option would be to format the data immediately before the execution of the request - so we will always be sure that the data is formatted correctly, this is done only once, and the formatted data will go strictly according to its purpose - in the database and nowhere else. <br>  And that's just the purpose of such - timely, safe and correct - data processing and placeholders serve, giving us a <b>guarantee of security</b> , at the same time <b>simplifying the</b> code. <br><br><h6>  Examples of using: </h6><br>  From the manual: <br><pre> <code class="php hljs">$stmt = $dbh-&gt;prepare(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM REGISTRY where name LIKE ?"</span></span>); $stmt-&gt;execute(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"%$_GET[name]%"</span></span>)); $data = $stmt-&gt;fetchAll();</code> </pre><br>  An example of what you should strive for: <br><pre> <code class="php hljs">$ban = $db-&gt;getRow(<span class="hljs-string"><span class="hljs-string">"SELECT 1 FROM ban WHERE ip = inet_aton(s:)"</span></span>, $ip);</code> </pre><br>  As you can see, it is not difficult, and also - with skillful use - it turns out much <i>shorter</i> than making a request with your hands.  Do you still want to write in the old-fashioned way? <br><br>  <b>Important note:</b> Of course, data substitution through placeholders must <b>always</b> be done, regardless of the source of the data or any other conditions. <br><br><h5>  Identifiers and Keywords - Whitelists </h5><br>  The overwhelming majority of articles devoted to injections, completely overlook this moment.  But the reality is that in it we are faced with the need to substitute in the query not only data, but also other elements - identifiers (field and table names) and even syntax elements, keywords.  Even insignificant such as DESC or AND, but the safety requirements for such substitutions should still be no less strict! <br><br>  Let us examine a rather banal case. <br>  We have a database of products that is displayed to the user in the form of an HTML table.  The user can sort this table by one of the fields, in any direction. <br>  That is, at least from the user's side, the name of the column and the direction of sorting come to us. <br>  Substitute them in the request directly - guaranteed injection.  The usual formatting methods will not help here.  Prepared expressions with neither identifiers nor keywords will lead to nothing but an error message. <br>  The only solution is <b>whitelisting</b> . <br>  This is, of course, not a Newton binomial, and many developers easily implement this paradigm along the way, faced for the first time with the need to substitute the field name into a query.  However, the article on protection against injection without this rule will be incomplete, and the defense itself will be full of holes. <br><br>  The essence of the method lies in the fact that <b>all possible choices should be strictly written in our code, and only they should be included in the request</b> , based on user input. <br><br><h6>  Application example: </h6><br><pre> <code class="php hljs">$order = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'order'</span></span>]) ? $_GET[<span class="hljs-string"><span class="hljs-string">'order'</span></span>] : <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     $sort = isset($_GET['sort']) ? $_GET['sort'] : ''; $allowed = array("name", "price", "qty"); //  $key = array_search($sort,$allowed); //      $orderby = $allowed[$key]; //  (,     - ) . $order = ($order == 'DESC') ? 'DESC' : 'ASC'; //    $query = "SELECT * FROM `table` ORDER BY $orderby $order"; // 100% </span></span></code> </pre><br>  I used to assume that a placeholder is sufficient for identifiers.  But over time, an understanding of the shortcomings of this method came: <br><ul><li>  First, if the field name is incorrect, the request will cause an error.  And mistakes are always bad </li><li>  secondly, and much more important: if you substitute the names of the fields without prior filtering, automatically, only escaping them, you can get an injection of another kind - after all, the user can then enter in the names of the fields that are not supposed to be changed!  Let's say if we form a SQL query automatically based on the $ _POST array (while correctly formatting the field names!), The hacker adds the admin field with the value ‚Äú1‚Äù to the form and becomes the admin </li></ul><br>  So now I use both methods: <br>  First I get the ID from the white list. <br>  And then I add it through the placeholder - just to avoid manual formatting.  And for uniformity.  In this case, the last line will look like <br><pre> <code class="php hljs">$query = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM `table` ORDER BY n: $order"</span></span>;</code> </pre> <br>  In principle, this information is enough to start writing completely secure queries.  But, as usual, in real life there are different nuances, and I would like to understand the mechanism of placeholders in more detail. <br><br><h4>  Work with placeholders </h4><br>  First you need to understand that there are two options for the implementation of placeholders - server and client: <br><ul><li>  In the first case, the request goes to the server with placeholders, and the data is sent separately from it.  In English, native prepared statements are called ‚Äúnative‚Äù prepared expressions ‚Äî that is, the handling of placeholders is carried out by the DBMS itself, on the server.  For brevity, I will use the name server server placeholders. </li><li>  In the second case, the data is formatted and substituted into the query string for the place of placeholders directly on the client, forming a classic SQL query, which then goes into the database in the usual way. </li></ul>  Each of the methods has its advantages and disadvantages, which we consider below. <br>  It should also be remembered that the PDO sits on these two chairs at the same time - by default it works according to the second variant, only emulating the first one.  This functionality can be disabled by forcing the PDO to send data to the server separately from the request. <br><pre> <code class="php hljs">$dbh-&gt;setAttribute( PDO::ATTR_EMULATE_PREPARES, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> );</code> </pre>  But since even emulation is done without the participation of a programmer, below we will consider PDO as a representative of server placeholders. <br><br><h5>  Server placeholders </h5><br>  To begin with, let's formulate - why are injections possible at all? <br>  In fact, the SQL query is a program.  A full program - with operators, variables and string literals.  The problem is that we are collecting this program dynamically, on the go.  Unlike our PHP scripts, which are written once and for all, and do not change based on the incoming data, the SQL query is dynamically re-generated each time.  And, as a result, incorrectly formatted data can spoil the request, or even change it by substituting operators for which we have not anticipated.  Actually, this is the essence of injection. <br><br>  What does the server handling of placeholders offer us? <br>  A very simple thing: we bring into our program such a thing as ... <i>variables</i> !  Yes, the placeholder is a common variable that is hard coded in our SQL ‚Äúscript‚Äù and does not change depending on the data.  And the data itself goes to the server <b>separately</b> from the request, and never intersects with it.  Only after the request is interpreted, the data will be used directly at the execution stage. <br>  In practice, it looks like this: when you call prepare (), our request goes to the server directly in this form - with placeholders / variables, the server parses it and signals - ‚Äúokay, ready to accept data‚Äù (well, or reports an error).  And then, when executing execute (), data is already being sent to the server (and not in text form, but in a binary package, in a structure resembling the one in which the query result is returned), and participate directly in the execution. <br><br>  In theory, it sounds very tempting. <br>  However, in practice, unfortunately, in the existing libraries for working with Mysql in PHP, the implementation of working with prepared expressions is still very far from ideal. <br>  It is enough to cite such, for example, facts: <br><ul><li>  Such a banal possibility, like getting a result string to an array (analog of mysql_fetch_array ()), for queries using prepared expressions, was added to mysqli only in the version in 5.3 (!).  Prior to this version, the library was practically unusable without <a href="http://www.php.net/manual/ru/mysqli-stmt.bind-result.php">hellish perversions</a> . </li><li>  The same applies to specifying the connection encoding in PDO - this became possible only in the same 5.3.  In all previous versions, it was simply <b>impossible</b> to specify the connection encoding in the PDO (which, to be fair, it should be admitted, is not a big problem when compatibility mode is off, but - a hole!). </li><li>  In some cases, mysqli <a href="https://bugs.php.net/bug.php%3Fid%3D51386">tries to reserve as much memory as the field in the database as possible</a> - be careful with mediumtext! </li></ul>  These facts tell us that both libraries are still quite raw, and we can expect from them a lack of other necessary functionality. <br><br><h5>  We list the main disadvantages of existing libraries </h5><br><ul><li>  verbosity </li><li>  lack of some useful placeholders </li><li>  inability to get classic SQL query for debugging purposes </li><li>  possible performance problems * (this issue will be discussed below) </li></ul><br>  and analyze them more <br><br><h6>  Verbosity. </h6><br>  Take such, for example, a demanded operation, like getting all the rows of the result of a query into a two-dimensional array.  There is still no such function in mysqli.  Or, say, to bind variables to placeholders there can only be a separate function. <br>  As a result, it will take at least nine (!) Lines of code to retrieve the data of a single request: <br><pre> <code class="php hljs">$data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $query = <span class="hljs-string"><span class="hljs-string">"SELECT Name, Population, Continent FROM Country WHERE Continent=? ORDER BY Name LIMIT 1"</span></span>; $stmt-&gt;prepare($query); $stmt-&gt;bind_param(<span class="hljs-string"><span class="hljs-string">"s"</span></span>, $continent); $stmt-&gt;execute(); $result = $stmt-&gt;get_result(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($row = $result-&gt;fetch_array(MYSQLI_NUM)) { $data[] = $row; }</code> </pre><br>  Moreover, most of this code does not carry any semantic load, is absolutely the same for all executed queries and is repeated many times in hundreds of scripts. <br>  while only two lines are enough to get data: <br><pre> <code class="php hljs">$query = <span class="hljs-string"><span class="hljs-string">"SELECT Name, Population, Continent FROM Country WHERE Continent=? ORDER BY Name LIMIT 1"</span></span>; $data = $db-&gt;getAll($query,$continent);</code> </pre><br>  PDO has a little better with this - they guessed to allow the transfer of an array to execute () and there is a method fetchAll ().  But you still have to write a lot of unnecessary uniform code for the most simple operations. <br>  In particular - let's return to the topic of our article - binding.  Here I have the variable $ _GET ['id'];  I want to tie her to a placeholder.  Great, I can do it right in execute () ... but only by making it an array.  What for?  Is the driver himself unable to do this for me? <br><br><h6>  Function failure </h6><br>  Another problem that has already been raised in the comments to a recent article is the IN () operator.  Making substitutions for it is a very nontrivial task.  Although it would seem, it was for such cases that the placeholders were invented: <br><pre> <code class="php hljs">$conts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'Europe'</span></span>,<span class="hljs-string"><span class="hljs-string">'Africa'</span></span>,<span class="hljs-string"><span class="hljs-string">'Asia'</span></span>,<span class="hljs-string"><span class="hljs-string">'North America'</span></span>); $query = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM Country WHERE Continent IN(?) ORDER BY Name LIMIT 1"</span></span>; $data = $db-&gt;getAll($query,$conts);</code> </pre> <br>  Instead of dozens of lines of clever code. <br>  What conclusion can we draw from this?  It is necessary to finish. <br><br><h6>  Inability to get SQL query </h6><br>  Someone will say that he does not need it, someone dodges and writes a request with his hands or uses sly software.  We will respect the opinion of these people, but the fact remains that the functionality of the output of a ready request is convenient for debugging, and server placeholders do not allow it. <br><br><h6>  Performance </h6><br>  Usually, apologists for server-prepared expressions stress the fact that the request is parsed only once. <br>  Unfortunately, this does not work for a web application.  That copy of the script that executed prepare () executes execute () for this query exactly 1 time and safely dies.  And a new copy of re-do prepare.  As a result, there is more work where they wanted to save. <br>  In the comments to a recent article, I was pointed to another potential speed gain - caching the query plan.  Indeed, even if we prepare for each request, the database can cache the same request for different data.  And get a execution plan without parsing, but with a simple string comparison! <br>  Alas, I am not so strong in the internal MySQL device to confirm or deny both the presence of the mechanism itself and its practical effectiveness. <br>  At the same time, as far as I know, under large real loads, server-prepared expressions lose speed in terms of standard SQL queries. <br>  In any case, the topic is open and still waiting for its researcher.  In the end, DBMS versions grow and test results become obsolete. <br><br>  In general, we found out that the tools provided by the DBMS and the drivers for working with it were not as good as they appeared in the advertisement.  And the question arises - can we implement the work with the placers on our own?  And there is an answer - we can! <br><br><h4>  Self implementation of placeholders </h4><br>  In general, in fact, no one bothers us to improve the usability of existing libraries, without fussing on placeholders.  Say, write a wrapper over PDO that implements the missing functionality using PDO's own placeholders (or mysqli, as was done in the library, <a href="http://habrahabr.ru/post/119294/">published a</a> year ago in Habr√©). <br><br>  But we have several reasons to consider homemade placeholders: <br>  First, as we have already seen, the set of placeholders available in standard libraries is not enough. <br>  Secondly, server placeholders for some reason may not be suitable for us. <br>  Thirdly, on the example of self-processing of placeholders, we consider the nuances of correctly formatting SQL queries. <br><br><h5>  Principles of formatting various SQL query elements </h5><br>  Implement homemade placeholders is a snap.  The primitive parser is already built into PHP.  The only thing we need is to learn to distinguish the various elements of the request.  But this is a very important point, which is worth staying in more detail. <br>  Since the formatting rules depend on the type of the element, we need, first, to clearly understand which element of the query we substitute into it.  And secondly, we need to somehow communicate this information to the processor of the placers. <br><br>  To begin with, let's determine which elements a query can consist of? <br>  Take, for example, the following SQL: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`db`</span></span>.<span class="hljs-string"><span class="hljs-string">`table`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">`t1`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span>(<span class="hljs-string"><span class="hljs-string">'string'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1.5</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">NOW</span></span>());</code> </pre>  It can be divided into three main groups of elements: <br><ul><li>  The actual elements of the SQL language are operators, built-in functions, variables, etc. </li><li>  identifiers (names of databases, tables and fields) </li><li>  literals (data substituted directly into the query) of several different types. </li></ul>  We will be interested in the last two points, since only they require special formatting. <br><br>  Now we will think about how to communicate information about the type of inline data to our handler.  The existing solutions make it crooked (which should not surprise you anymore).  There are two options here: either you have to set the type by calling the binding function (which immediately complicates the code many times), or not to set it at all, as the PDO does, if you pass the data straight to execute ().  But it is impossible to do without the type at all, and therefore all PDO data transmitted to execute is treated as strings.  That leads to funny consequences if PDO works in compatibility mode: when you try to pass parameters for LIMIT to execute (), PDO will crash with an error message, in which you can see quotes that the fair library has framed with an offset and limit! <br><br>  In general, you need another solution.  And it is!  But we'll talk about it below, but for now let's consider the formatting rules. <br><br><h6>  Identifier formatting </h6><br>  In general, the rules for naming identifiers are <a href="http://dev.mysql.com/doc/refman/5.0/en/identifiers.html">quite extensive</a> .  But given that we use white lists for security, and the placeholder only for formatting, these two will suffice: <ul><li>  the identifier must be enclosed in reverse single quotes (backticks) </li><li>  if such a quote is found in the name - it must be escaped by doubling. </li></ul><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">escapeIdent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"`"</span></span>.str_replace(<span class="hljs-string"><span class="hljs-string">"`"</span></span>,<span class="hljs-string"><span class="hljs-string">"``"</span></span>,$value).<span class="hljs-string"><span class="hljs-string">"`"</span></span>; }</code> </pre><br>  Lyrical digression: <br>  Do I need or not need to format identifiers?  After all, in most cases it is not required? <br>  If the request is written by hand, the need can be determined on the spot: the request is working - you can not format it;  crashes with an identifier - must be formatted. <br>  If we use a placeholder - that is, we add the identifier to the request dynamically - it is necessary to format it, because we do not know which field name will be inserted into the request, and, therefore, whether it needs formatting or not.  So we will format everything. <br><br>  Actually, if we talk about the use of placeholders in general, it is precisely the consistent, without exception, application of the formatting rules and allows us to speak of guaranteed protection against injections and, which is important, of errors.  After all, formatting is primarily done in order to ensure the syntactic correctness of the request.  And protection from injections is just a side effect. <br>  Therefore, I prefer to use the term "formatting" rather than "escaping" <br><br><h6>  Formatting string literals </h6><br>  The most beaten seemingly topic. ,     ,         ,    ‚Äî  . ,       SQL. <br><ul><li>       (  ,        ,    ) </li><li>        .   API   .            </li></ul><br>   <br><ul><li>      ,    -  </li><li>              </li></ul><br>  ,  ?   ,     . <br>      PHP,    mysql_real_escape_string()  : ¬´    ,         SQL-. ¬ª ‚Äî         ,    - ! <br><br>    PDO   ‚Äî    ,    :  PDO::quote()    ,    ‚Äî   <i></i>    .     : <br><pre> <code class="php hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">escapeString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"'"</span></span>.mysqli_real_escape_string(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;connect,$value).<span class="hljs-string"><span class="hljs-string">"'"</span></span>; }</code> </pre> <br>   ,  ¬´  ¬ª    <a href="http://www.php.net/manual/ru/mysqli.set-charset.php">mysqli_set_charset</a> / <a href="http://ru2.php.net/manual/ru/function.mysql-set-charset.php">mysql_set_charset</a> ,   PDO ‚Äî  DSN. <br><br><h6>   </h6><br> ,        ,      .     <br><ul><li>  STRICT MODE  mysql, ,  ,             </li><li>  LIMIT,        </li><li>    mysql  ,     ,        .      ,     . </li></ul>  ,    .  ,        . <br>    ‚Äî        PHP.        ,   PHP_INT_MAX,    .        intval(). <br><br>         ,   PHP   ,  -  DECIMAL  MySQL. <br><br><h5> ¬´ ¬ª </h5><br> ,   . <br>   ,     ‚Äî  sprintf(). ,         .  <i></i> !  , ,     ,   . ,   ,      ‚Äî   PDO,   mysqli      .             . <br><br>  , sprintf          . , sprintf    ,     .      ‚Äî      .     <i></i> ,   .   ,  ‚Äî   -. <br>     ,   ,       ,      .   .   ,     . <br><br>      <b></b>    . ,  .      ,       sprintf() ‚Äî  ,       . <br>    ?     ,   -   ‚Äî   ! ,        .        ,     . <br>       <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">query</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $query = array_shift($args); $query = str_replace(<span class="hljs-string"><span class="hljs-string">"%s"</span></span>,<span class="hljs-string"><span class="hljs-string">"'%s'"</span></span>,$query); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($args <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $val) { $args[$key] = mysql_real_escape_string($val); } $query = vsprintf($query, $args); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$query) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>; $res = mysql_query($query) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> trigger_error(<span class="hljs-string"><span class="hljs-string">"db: "</span></span>.mysql_error().<span class="hljs-string"><span class="hljs-string">" in "</span></span>.$query); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $res; }</code> </pre> <br>           . <br>     :    ,  ,  , %s  %d   LIMIT,       ,    (      ). <br><br> ,    printf()    ‚Äî a ,    ,    ,     . <br>   ,      ,   ,                 ,     ,          3-4 . <br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dbget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* usage: dbget($mode, $query, $param1, $param2,...); $mode - "dimension" of result: 0 - resource 1 - scalar 2 - row 3 - array of rows */</span></span> $args = func_get_args(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($args) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { trigger_error(<span class="hljs-string"><span class="hljs-string">"dbget: too few arguments"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } $mode = array_shift($args); $query = array_shift($args); $query = str_replace(<span class="hljs-string"><span class="hljs-string">"%s"</span></span>,<span class="hljs-string"><span class="hljs-string">"'%s'"</span></span>,$query); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($args <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $val) { $args[$key] = mysql_real_escape_string($val); } $query = vsprintf($query, $args); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$query) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $res = mysql_query($query); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$res) { trigger_error(<span class="hljs-string"><span class="hljs-string">"dbget: "</span></span>.mysql_error().<span class="hljs-string"><span class="hljs-string">" in "</span></span>.$query); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($mode === <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $res; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($mode === <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($row = mysql_fetch_row($res)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $row[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; } $a = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($mode === <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($row = mysql_fetch_assoc($res)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $row; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($mode === <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($row = mysql_fetch_assoc($res)) $a[]=$row; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a; } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></div></div><br>  : <br><pre> <code class="php hljs">$name = dbget(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"SELECT name FROM users WHERE id=%d"</span></span>,$_GET[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]); <span class="hljs-comment"><span class="hljs-comment">//      $user = dbget(2,"SELECT * FROM users WHERE id=%d",$_GET['id']); //     $sql = "SELECT * FROM news WHERE title LIKE %s LIMIT %d,%d"; $news = dbget(3,$sql,"%$_GET[search]%",$start,$per_page); //  </span></span></code> </pre><br>    ,     ,       :   KISS     ,         DRY. <br><br>    ,    .     . <br> ,        ,        .      . <br><br> -,      ,        .    ,     -          ‚Äî ,  ,  ,     ,     . <br><br> -,          .     PDO  . <br>      <br><pre> <code class="bash hljs">[az]:[az]*</code> </pre> <br>  For example, <pre> <code class="bash hljs">i:</code> </pre>  or <pre> <code class="bash hljs">s:name</code> </pre> <br>       ,    ‚Äî . <br>    ,       ,   ‚Äî . <br><br> -,     IN() ( ) <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createIN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_array($data)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> E_DB_MySQL_parser(<span class="hljs-string"><span class="hljs-string">"Value for a: type placeholder should be array."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$data) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> E_DB_MySQL_parser(<span class="hljs-string"><span class="hljs-string">"Empty array for a: type placeholder."</span></span>); } $query = $comma = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($data <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { $query .= $comma.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escapeString($value); $comma = <span class="hljs-string"><span class="hljs-string">","</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $query; }</code> </pre><br>     . <br>   ,      .  Why? <br>   mysql    IN(),      . <br> -      implode    ,    :   ‚Äî    ,             . <br><br> <a href="https://habrahabr.ru/users/dmitrykoterov/" class="user_link">DmitryKoterov</a>    dbSimple      ‚Äî     IN    , ,    ,    .       ,  ,   ,  . <br><br> <b>Update:</b> <br>  ,   <a href="https://habrahabr.ru/users/zerkms/" class="user_link">zerkms</a>  <a href="https://habrahabr.ru/users/david_mz/" class="user_link">david_mz</a> , ,        ! <br><pre> <code class="sql hljs">IN(NULL)</code> </pre>       FALSE ‚Äî     . <br>  ,      NULL: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createIN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_array($data)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> E_DB_MySQL_parser(<span class="hljs-string"><span class="hljs-string">"Value for a: type placeholder should be array."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$data) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'NULL'</span></span>; } $query = $comma = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($data <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { $query .= $comma.<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escapeString($value); $comma = <span class="hljs-string"><span class="hljs-string">","</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $query; }</code> </pre><br>      ,    : <br> ,            .     ,     ,   . <br>  ,      ,            .      ,       . <br> &lt;/update&gt; <br><br> C         .         ‚Äî parse(),     ,       SQL ‚Ä¶   (,       ,       !).       ,   ‚Äî  ,  : <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($array) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $array) { $sql .= $db-&gt;parse(<span class="hljs-string"><span class="hljs-string">" AND type IN(a:)"</span></span>,$array); }</code> </pre><br>           WHERE: <br><pre> <code class="php hljs">$w = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $where = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'type'</span></span>])) $w[] = $db-&gt;parse(<span class="hljs-string"><span class="hljs-string">"type = s:"</span></span>, $_GET[<span class="hljs-string"><span class="hljs-string">'type'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'rooms'</span></span>])) $w[] = $db-&gt;parse(<span class="hljs-string"><span class="hljs-string">"rooms IN (a:)"</span></span>,$_GET[<span class="hljs-string"><span class="hljs-string">'rooms'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'max_price'</span></span>])) $w[] = $db-&gt;parse(<span class="hljs-string"><span class="hljs-string">"price &lt;= i:"</span></span>, $_GET[<span class="hljs-string"><span class="hljs-string">'max_price'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($w)) $where = <span class="hljs-string"><span class="hljs-string">"WHERE "</span></span>.implode(<span class="hljs-string"><span class="hljs-string">' AND '</span></span>,$w); $data = $db-&gt;getArr(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM table $where LIMIT i:,i:"</span></span>,$start,$per_page);</code> </pre><br> <a href="http://dklab.ru/lib/DbSimple/">  DbSimple</a> , ,    ,          ( ,     ,    100500    ),    ,        10  ,   -     . <br><br><h4>    </h4><br>    . <br>        -,        .    , . <br>   ,   :         ,   .       ,  .          .   . <br>        ,      .  ,     ,    (  !) ,   .       <br><br><h6>  mysql_*   deprecated  PHP </h6><br>  . <br>   ,       . <br><br> -,  ¬´¬ª,   . <br> -,  deprecated,  discouraged,   ,   .   ,      . <br> -,           .   ,        ‚Äî   ,     .      ,    - ,          .     ,          ,    mysql   . <br><br>        ,  .   ,       . <br>     ¬´ mysql_*¬ª,         !     mysqli_*, pdo_*      ¬´¬ª API.   ‚Äî     ,     :      API     ,          .     mysql(i)_query(),  mysql(i)_fetch_array()     , ,  . <br>  ,  ,  :  API  .  ,      ,    .       ,   ,       .  ,     API   ,   ,    ‚Äî  ,   ‚Ä¶  ! <br>  PDO      , ,   , .    PDO         . <br>    ‚Äî    mysql_*  - .        ,    . <br><br><h6>    </h6><br>   ‚Äî .    ,     . <br>  ,       .     ,  ‚Äî . <br><br><h6>  </h6><br>    .  ,         , ,   : <br><ul><li> ¬´   mysql_real_escape_string  ,    ¬ª ‚Äî  .    mysql_real_escape_string()   ,      ,     </li><li> ¬´    ¬ª ‚Äî ,   .     </li><li> ¬´  ‚Äû‚Äú  ‚Äû‚Äú¬ª ‚Äî   .  ¬´¬ª   .  ,      ,  ,   ,    ‚Äî    </li><li> ¬´    -     ¬ª ‚Äî ,   ?     .   ,     .         </li><li> ¬´      ¬ª ‚Äî , ,   .   ,   ‚Äî    .      ‚Äî    ,       SQL .     PDO,        ‚Äî  ,    ,      .   PDO    . ,    ,  ¬´¬ª    .   PDO   ¬´¬ª,    . </li></ul><br><h6>     ¬´¬ª    </h6><br>   ¬´UNION¬ª,    .    . ,    -  ,     ,     ‚Äî    ,        ?  -       ,     ¬´¬ª ¬´-¬ª. <br><br><h6>     </h6><br>       . ¬´    ,     ‚Äû ‚Äú           !¬ª ‚Äî  . <br>     , ¬´¬ª   .    ,        .       . <br>   ,        ,    .      ,     ‚Äî      .       , ,  .          magic_quotes, ,  ,   .     ,  ,    ,    (     ). <br>  , ,     ‚Äî     SQL      . <br><br><h6>  Encodings </h6><br>        .         . <br>   , <a href="http://shiflett.org/blog/2006/jan/addslashes-versus-mysql-real-escape-string">¬´      ¬ª</a>     <a href="http://ilia.ws/archives/103-mysql_real_escape_string-versus-Prepared-Statements.html"></a> ,  mysql_real_escape_string()   (!) <br>    ,   <a href="http://php.net/manual/ru/function.mysql-real-escape-string.php">  </a> , mysql_real_escape_string() <b></b> ¬´    ¬ª,      .      ‚Äî latin1,       ,  mysql_real_escape_string()       mysql_escape_string(). <br>    2006     mysql_real_escape_string()     mysql   .   , ,        ‚Äî  <a href="http://www.php.net/manual/ru/function.mysql-set-charset.php">mysql_set_charset()</a> .           SET NAMES. <br><br>   ,       .     UTF-8    (    ,       addslashes()). <br><br>       ,    .  ‚Äî   ,  . <br><div class="spoiler"> <b class="spoiler_title">   ,    .</b> <div class="spoiler_text"> MySQL. <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(); +<span class="hljs-comment"><span class="hljs-comment">---------------------+ | version() | +---------------------+ | 5.0.45-community-nt | +---------------------+ 1 row in set (0.00 sec) mysql&gt; CREATE TABLE users ( -&gt; username VARCHAR(32) CHARACTER SET GBK, -&gt; password VARCHAR(32) CHARACTER SET GBK, -&gt; PRIMARY KEY (username) -&gt; ); Query OK, 0 rows affected (0.08 sec) mysql&gt; insert into users SET username='ewrfg', password='wer44'; Query OK, 1 row affected (0.02 sec) mysql&gt; insert into users SET username='ewrfg2', password='wer443'; Query OK, 1 row affected (0.03 sec) mysql&gt; insert into users SET username='ewrfg4', password='wer4434'; Query OK, 1 row affected (0.00 sec)</span></span></code> </pre><br>  Php <br><pre> <code class="php hljs">&lt;pre&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"PHP version: "</span></span>.PHP_VERSION.<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; mysql_connect(); mysql_select_db(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); mysql_query(<span class="hljs-string"><span class="hljs-string">"SET NAMES GBK"</span></span>); $_POST[<span class="hljs-string"><span class="hljs-string">'username'</span></span>] = chr(<span class="hljs-number"><span class="hljs-number">0xbf</span></span>).chr(<span class="hljs-number"><span class="hljs-number">0x27</span></span>).<span class="hljs-string"><span class="hljs-string">' OR username = username /*'</span></span>; $_POST[<span class="hljs-string"><span class="hljs-string">'password'</span></span>] = <span class="hljs-string"><span class="hljs-string">'guess'</span></span>; $username = addslashes($_POST[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]); $password = addslashes($_POST[<span class="hljs-string"><span class="hljs-string">'password'</span></span>]); $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM users WHERE username = '$username' AND password = '$password'"</span></span>; $result = mysql_query($sql) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> trigger_error(mysql_error().$sql); var_dump($username); var_dump(mysql_num_rows($result)); var_dump(mysql_client_encoding()); $username = mysql_real_escape_string($_POST[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]); $password = mysql_real_escape_string($_POST[<span class="hljs-string"><span class="hljs-string">'password'</span></span>]); $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM users WHERE username = '$username' AND password = '$password'"</span></span>; $result = mysql_query($sql) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> trigger_error(mysql_error().$sql); var_dump($username); var_dump(mysql_num_rows($result)); var_dump(mysql_client_encoding()); mysql_set_charset(<span class="hljs-string"><span class="hljs-string">"GBK"</span></span>); $username = mysql_real_escape_string($_POST[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]); $password = mysql_real_escape_string($_POST[<span class="hljs-string"><span class="hljs-string">'password'</span></span>]); $sql = <span class="hljs-string"><span class="hljs-string">"SELECT * FROM users WHERE username = '$username' AND password = '$password'"</span></span>; $result = mysql_query($sql) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> trigger_error(mysql_error().$sql); var_dump($username); var_dump(mysql_num_rows($result)); var_dump(mysql_client_encoding());</code> </pre><br><br>  Result <br><pre> <code class="php hljs">PHP version: <span class="hljs-number"><span class="hljs-number">5.3</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> string(<span class="hljs-number"><span class="hljs-number">29</span></span>) <span class="hljs-string"><span class="hljs-string">"—ó\' OR username = username /*"</span></span> int(<span class="hljs-number"><span class="hljs-number">3</span></span>) string(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-string"><span class="hljs-string">"latin1"</span></span> string(<span class="hljs-number"><span class="hljs-number">29</span></span>) <span class="hljs-string"><span class="hljs-string">"—ó\' OR username = username /*"</span></span> int(<span class="hljs-number"><span class="hljs-number">3</span></span>) string(<span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-string"><span class="hljs-string">"latin1"</span></span> string(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-string"><span class="hljs-string">"\—ó\' OR username = username /*"</span></span> int(<span class="hljs-number"><span class="hljs-number">0</span></span>) string(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-string"><span class="hljs-string">"gbk"</span></span></code> </pre><br></div></div><br>  ,     : <br>  PDO         . ,  mysql_set_charset()  PDO ,   DSN   5.3     charset,    ,      . <br> ,  , ,    ,   ,  PDO   . <br><br><h6> ¬´  LIKE¬ª </h6><br>   LIKE   :      . <br> -            .     ,   LIKE ,      <b> </b> .   LIKE  .  ,           %  _,     ,      ‚Äî   , .  That's all. <br><br><h4>  Conclusion </h4><br>          mysql,       ,  ,    ,    ,   ,   .         ,    ¬´¬ª      . <br>       ¬´¬ª  ,      ,   ,     , ,      . <br>       ,      . <br><br> <b>Update:</b> <a href="http://phpfaq.ru/safemysql">     mysql    SQL </a> ,     . </div><p>Source: <a href="https://habr.com/ru/post/148701/">https://habr.com/ru/post/148701/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148693/index.html">OAuth 2.0 editor asked to cross out your name from specifications</a></li>
<li><a href="../148695/index.html">Warsow 1.0</a></li>
<li><a href="../148697/index.html">Traffic monetization: make more money online!</a></li>
<li><a href="../148698/index.html">Winter holidays with benefits</a></li>
<li><a href="../148700/index.html">2GIS Online and API updates: search tips and more</a></li>
<li><a href="../148703/index.html">Follow the Summer Olympics with Android</a></li>
<li><a href="../148704/index.html">Corona SDK - for beginners. Working with multiple scenes using the Storyboard API</a></li>
<li><a href="../148706/index.html">Java client for FlexMonkey, or Java-style LocalConnection</a></li>
<li><a href="../148708/index.html">New IP DECT from Grandstream DP715 / DP710</a></li>
<li><a href="../148711/index.html">Tool-assisted speedrunning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>