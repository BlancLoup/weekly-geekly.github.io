<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What do gamedevs have in common with astronautics or work with PHP iterators?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 

 It so happened that I recently got into the hands of a wonderful book Pro PHP , in which a whole section is devoted to iterators. Yes, I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What do gamedevs have in common with astronautics or work with PHP iterators?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/dda/51d/110/dda51d110a82b20b84c2422660fd1fa4.png"><br><br>  Hi, Habr. <br><br>  It so happened that I recently got into the hands of a wonderful book <a href="http://www.amazon.com/Pro-PHP-Patterns-Frameworks-Testing/dp/1590598199">Pro PHP</a> , in which a whole section is devoted to iterators.  Yes, I know that this topic has already been raised on Habr√© (and probably more than once), but I will allow myself to finish this article, since  Most of the examples in the above-mentioned articles are quite divorced from reality.  And so - if you are interested in what a real problem we are going to solve with the help of iterators - welcome under cat. <br><a name="habracut"></a><br><h4>  What kind of animal is this - an iterator? </h4><br>  Essentially, an iterator is an object that allows you to simplify a specific traversal of child elements.  In php there is an interface <a href="http://www.php.net/manual/ru/class.iterator.php">Iterator</a> , implementing which you can achieve the desired effect.  The SPL ( <a href="http://php.net/spl">Standart PHP Library</a> ) also includes several classes that implement the most common and popular iterators.  Their list can be found <a href="http://www.php.net/manual/ru/spl.iterators.php">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  So why do we then need iterators - can we just use arrays? </h4><br>  In php, it has somehow historically developed that the enumeration of objects or data simply ‚Äúadds‚Äù to an array, the elements of which can then be searched.  Imagine a situation in which you have data of some field of elements represented by a square, divided into 9 equal parts (for example, a map).  And you need to bypass all the squares in a clockwise direction, and in the array they are folded randomly.  Not very comfortable, right? <br><br>  And so - in this case iterators will help us.  Instead of adding elements to the array, add them to the iterator and then we can conveniently sort through them.  An example of code that implements the enumeration of neighboring map elements can be found below: <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> https://bitbucket.org/t1gor/strategy/src/242e58cdcd60c61d02ae26d420da9d415117cb0d/application/model/map/MapTileNeighboursIterator.php?at=default */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TileIterator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Iterator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_side = <span class="hljs-string"><span class="hljs-string">'north_west'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_neighbours = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_isValid = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($neighboursArray)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'north_west'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_neighbours = $neighboursArray; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rewind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'north_west'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> MapTile */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">current</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_neighbours[<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side; } <span class="hljs-comment"><span class="hljs-comment">/** * Loop through neighbours clock-wise * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">next</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'north_west'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'north'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'north'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'north_east'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'north_east'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'east'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'east'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'south_east'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'south_east'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'south'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'south'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'south_west'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'south_west'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_side = <span class="hljs-string"><span class="hljs-string">'west'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">// this is the end of a circle case 'west': $this-&gt;_isValid = false; break; } } function valid() { return $this-&gt;_isValid; } }</span></span></code> </pre> <br>  And now the actual call: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   , ..     $tilesStmt = PDO::prepare("SELECT * FROM tiles ... LIMIT 9"); $tilesStmt-&gt;execute(); $tiles = new TileIterator($tilesStmt-&gt;fetchAll());</span></span></code> </pre><br>  Well, then - the usual bust of all, but already in the correct order: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($tiles <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $tile) { ... }</code> </pre><br><h4>  Yes, really not bad.  And what else can you do with the iterator? </h4><br>  Since the topic is quite extensive, I will consider only my favorite examples: <br><br>  <a href="http://www.php.net/manual/ru/class.limititerator.php">LimitIterator is</a> very useful when debugging or testing code.  In particular, when working with <a href="http://phpexcel.codeplex.com/">PHPExcel</a> , in the search for rows, the library uses the <a href="https://github.com/markushausammann/PHPExcel/blob/master/PHPExcel/Worksheet/RowIterator.php">RowIterator</a> class, whose name implies that it is an Iterator.  To avoid ‚Äúdragging‚Äù all the lines every time you parse the document, you can wrap the <a href="https://github.com/markushausammann/PHPExcel/blob/master/PHPExcel/Worksheet/RowIterator.php">RowIterator</a> in the <a href="http://www.php.net/manual/ru/class.limititerator.php">LimitIterator</a> and work with only a dozen lines: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   ... $inputFileType = PHPExcel_IOFactory::identify('example.xlsx'); $objReader = PHPExcel_IOFactory::createReader($inputFileType); $document = $objReader-&gt;load($inputFile); $sheet = $document-&gt;getSheet(0); // ...     10  $dataForDebug = new LimitIterator($sheet-&gt;getRowIterator(), 0, 10);</span></span></code> </pre><br>  The <a href="http://www.php.net/manual/ru/class.filteriterator.php">FilterIterator</a> class <a href="http://www.php.net/manual/ru/class.filteriterator.php">makes</a> it easy to filter data on the fly.  In some way, this is similar to the WHERE part of the SQL query.  Suppose you are working with a third-party API, for example, the <a href="https://github.com/sirprize/basecamp">BaseCamp Classic API</a> , whose SDK returns to you user objects.  And you need to notify some of them by emial about changes in the project.  And you will need to exclude according to 3 parameters: email, ID and name.  To make it simple and supported, the above class allows: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> http://ua2.php.net/FilterIterator */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotificationFilter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FilterIterator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_skip; <span class="hljs-comment"><span class="hljs-comment">/** * Build filter * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Iterator $iterator * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $filter -    ,    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> InvalidArgumentException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterator $iterator, $filter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_array($filter)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">"Filter should be an array. "</span></span>.gettype($filter).<span class="hljs-string"><span class="hljs-string">" given."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($iterator); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_skip = $filter; } <span class="hljs-comment"><span class="hljs-comment">/** * Check user data and make sure we can notify him/her * * Filtering by 2 params: * - Does the user belong to your company (avoid spamming clients)? * - Should we skipp the user based on the user ID * - Should we skipp the user based on the user email * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> http://php.net/manual/filteriterator.accept.php * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> https://github.com/sirprize/basecamp/blob/master/example/basecamp/person/get-by-id * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// get current user from the Iterator $bcUser = $this-&gt;getInnerIterator()-&gt;current(); // check if skipped by ID $skippedById = in_array($bcUser-&gt;getId(), $this-&gt;_skip['byID']); // or by email $skippedByEmail = in_array($bcUser-&gt;getEmailAddress(), $this-&gt;_skip['byEmail']); // check that he/she belongs to your company $belongsToCompany = $yourCompanyBaseCampID === (int) $bcUser-&gt;getCompanyId()-&gt;__toString(); // notify only if belongs to your company and shouldn't be skipped return $belongsToCompany &amp;&amp; !$skippedById &amp;&amp; !$skippedByEmail; } }</span></span></code> </pre><br>  Thus, in the NotificationFilter :: accept () method, we work with only one user. <br><br>  And, you can easily <a href="http://stackoverflow.com/a/1320259/1847769">convert multidimensional arrays to one-dimensional</a> using <a href="http://www.php.net/manual/ru/class.recursiveiteratoriterator.php">RecursiveIteratorIterator</a> , conveniently get <a href="http://www.php.net/manual/en/class.recursivedirectoryiterator.php">directory listings</a> using <a href="http://www.php.net/manual/en/class.recursivedirectoryiterator.php">RecursiveDirectoryIterator,</a> and much more. <br><br><h4>  And where does astronautics? </h4><br>  Yes, I almost forgot.  While I was ‚Äúplaying‚Äù with iterators, trying to understand for myself how to use them, I had the following idea - how could I read only posts on Habr√© that are in the <a href="http://habrahabr.ru/hub/gdev/">GameDev</a> hub and in <a href="http://habrahabr.ru/hub/webdev/">Web development</a> ?  In the tape, you can read posts from both hubs, but not the intersection of posts, if you know what I mean.  As a result, I got a small project using iterators. <br><br>  The entire project code can be found in the <a href="https://bitbucket.org/t1gor/habraintersector">repository on BitBucket</a> , and here I will publish only the most interesting part.  Code below: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Basic post class */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HabraPost</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $name = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $url = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $hubs = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $baseUrl = <span class="hljs-string"><span class="hljs-string">'http://habrahabr.ru/hub/'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Some hubs links */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $fullHubList = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'infosecurity'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'webdev'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'gdev'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Game Development'</span></span>, <span class="hljs-string"><span class="hljs-string">'DIY'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DIY   '</span></span>, <span class="hljs-string"><span class="hljs-string">'pm'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'programming'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'space'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'hardware'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'algorithms'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'image_processing'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, ); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $url, $hubs = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;name = $name; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;url = $url; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hubs = $hubs; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFullHubsList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $list = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$fullHubList; asort($list); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $list; } } <span class="hljs-comment"><span class="hljs-comment">/** * Post storage object * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> http://php.net/manual/class.splobjectstorage.php */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostsStorage</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $_iterator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_iterator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SplObjectStorage(); } <span class="hljs-comment"><span class="hljs-comment">/** * Add new post * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> HabraPost $post * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HabraPost $post)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// reduce duplicates if (!$this-&gt;_iterator-&gt;contains($post)) { $this-&gt;_iterator-&gt;attach($post); } } /** * Get internal iterator * * @return SplObjectStorage */ public function getIterator() { return $this-&gt;_iterator; } } /** * Posts filtering class * * @link http://php.net/manual/class.filteriterator.php */ class HabraPostFilter extends FilterIterator { /** * Hubs to filter by */ private $_filterByHubs = array(); public function __construct(Iterator $iterator, $filteringHubs) { parent::__construct($iterator); $this-&gt;_filterByHubs = $filteringHubs; } /** * Accept * * @link http://php.net/manual/filteriterator.accept.php * @return bool */ public function accept() { $object = $this-&gt;getInnerIterator()-&gt;current(); $aggregate = true; foreach ($this-&gt;_filterByHubs as $filterHub) { $aggregate = $aggregate &amp;&amp; in_array($filterHub, $object-&gt;hubs); } return $aggregate; } }</span></span></code> </pre><br>  So - the idea is very simple: <br><ol><li>  The user selects one or more hubs, </li><li>  We iterate over the available Habr pages and collect links to content, </li><li>  We drive all this into the <code>PostsStorage</code> , </li><li>  And filter using <code>HabraPostFilter</code> </li></ol><br>  As a result, we get something similar to the screenshot: <br><br><div class="spoiler">  <b class="spoiler_title">GameDev + Web Development</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/009/a21/4b7/009a214b76520dd2312d833e458fdd55.png"></div></div><br><br>  I would be happy to put the project in free access if someone kindly provides hosting that can withstand the Habra effect. <br><br>  Thank you all for your attention. <br><br>  PS I am pleased to accept the edits / comments in the comments to the post or in personal correspondence. <br><br>  <b>UPD</b> .  Thank you <a href="https://habrahabr.ru/users/nikita_rogatnev/" class="user_link">Nikita_Rogatnev</a> for help in correcting typos. <br>  <b>UPD</b> .  Thank you <a href="https://habrahabr.ru/users/hell0w0rd/" class="user_link">hell0w0rd</a> for the <a href="http://habraintersector.nkt.me/">demo</a> . </div><p>Source: <a href="https://habr.com/ru/post/214833/">https://habr.com/ru/post/214833/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214817/index.html">Evernote for Android now supports handwriting.</a></li>
<li><a href="../214819/index.html">EasyEclipse: Eclipse with a Kickstarter human face</a></li>
<li><a href="../214821/index.html">Pizza Smell DVD!</a></li>
<li><a href="../214827/index.html">Show Sound # 6 - Podcast about audio equipment, components, formats and technologies</a></li>
<li><a href="../214831/index.html">Evernote for Android received support for handwritten notes</a></li>
<li><a href="../214837/index.html">OrientDB - a simple example of working with graphs for beginners.</a></li>
<li><a href="../214839/index.html">Using GPIO from Python on Raspberry Pi</a></li>
<li><a href="../214841/index.html">5 ways to compare two byte arrays. Comparative Testing</a></li>
<li><a href="../214847/index.html">MMORPG without unnecessary details</a></li>
<li><a href="../214849/index.html">Why does the robot have ears? (survey: do you need OpenTod)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>