<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we protected the administration of the Kaluga region from spam</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a corporate cloud provider, we offer our customers the maximum amount of services related to the storage and transmission of data - including prote...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we protected the administration of the Kaluga region from spam</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/177/037/fc5/177037fc588c4dbaa43862a336e7a6d0.jpg"><br><br>  As a corporate cloud provider, we offer our customers the maximum amount of services related to the storage and transmission of data - including protection against spam.  In this post we want to talk about how the <a href="http://cloud4y.ru/cloud-services/antispam/">Cloud4Y anti-spam service</a> based on SpamTitan for the VMware platform works on the example of one of our clients - the administration of the Kaluga region.  We want to talk about the functional features and basic settings of "Spam Titan", as well as how we had to solve the licensing problem that arose at the client during the work. <a name="habracut"></a><br><br><h2>  Opportunities </h2><br>  It does not make sense in this post to list all the functionality of the system, we present only the most interesting features: <br><ul><li>  Rapid deployment to VMware virtual machines with a ready-made virtual appliance </li><li>  it is possible to create a cluster mail gateway to optimize the load; </li><li>  convenient custom reports and notifications </li><li>  flexible access policies for users and administrators </li><li>  dual antivirus protection </li></ul><br>  Other features can be found at <a href="http://www.spamtitan.com/about-us/about-spamtitan">www.spamtitan.com/about-us/about-spamtitan</a> <br>  Comparison of SpamTitan with other systems <a href="http://cloud4y.ru/cloud-services/antispam/">cloud4y.ru/cloud-services/antispam</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Customization </h2><br>  Setting up SpamTitan usually does not take much time, and consists of the following steps, which you should pay attention to: <br><ul><li>  Deploy a virtual machine image based on a virtual client infrastructure.  For the VMware platform, we used the Virtual appliance, which can be downloaded from the manufacturer‚Äôs website. </li><li>  Configuring the network settings of the virtual machine is done from the local console through the interface in the form of a text menu and should not cause any problems. </li></ul><br><img src="https://habrastorage.org/files/aee/afe/d77/aeeafed7752444d5a71185175f387be3.jpg"><br><br>  Further configuration is already going through the web interface available at http: // ip-your-server <br><br>  The first thing to do after configuring the network and rebooting is to add a license key.  The key can be obtained either trial (for 10 days without restrictions) or purchase commercial.  This is done in the ‚ÄúSystem setup‚Äù ‚ÄúLicensing‚Äù section. <img src="http://habr.habrastorage.org/post_images/330/ed7/08a/330ed708a1aa493498f25de98a59cf09.gif"><br><br><img src="https://habrastorage.org/files/59c/c7b/a6f/59cc7ba6ffc8472a9b4e156f9eb672f2.jpg"><br><br>  Then update the system to the latest version in System Updates.  At the time of this writing, the current version is 6.0.4. <br><br><img src="https://habrastorage.org/files/78f/8d0/48a/78f8d048ae664e829738225fb9f90c05.jpg"><br><br>  In the Network section, configure the Network configuration DNS Settings network. <br><br><img src="https://habrastorage.org/files/621/16a/adc/62116aadc86944d0b39775e3931d41e8.jpg"><br><br>  Configure time synchronization. <br><br><img src="https://habrastorage.org/files/97e/69a/849/97e69a849a81420ab45055b36f8c658a.jpg"><br><br>  We configure Mail relay for the required domain. <br><br><img src="https://habrastorage.org/files/8d0/fcc/930/8d0fcc930c504440aa03e742928b25e9.jpg"><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/33f/2f3/08c/33f2f308cc0d435b84218fd89a056ef8.jpg"></div><br><br>  You must enter the domain name, the address of the SMTP server that services this domain now.  Several connection modes are possible: <br>  with checking the existence of the box and without checking the existence of the box. <br><br>  On the IP CONTROLS tab, you can configure white lists and blacklists of SMTP servers and enable support for RBLs (Realtime Blackhole Lists), in our case this was not relevant, since we were behind SMTP Relay and we accept all mail from one server. <br><br>  In GENERAL SETTING, you must specify the spam filter hostname, which must match the dns entry. <br><br>  <b>Content Filtering -&gt; Viruses</b> <br>  Configure virus scan settings, update Clam AV, Kasperky AV databases <br><br>  <b>Content Filtering-&gt; Spam</b> <br>  We include spam check and update spam lists. <br><br>  <b>Anti-Spam Engine-&gt; Settings</b> <br>  Enable network tests Razor V2, Pyzor, RBLs <br><br>  <b>Anti-Spam Engine-&gt; Domain policies / User-Policies</b> <br>  You can set global domain policies and policies for individual users.  For example, the global domain policy defaults all spam letters, and for other users send to quarantine <br>  Anti-Spam Engine-&gt; Roles and permissions / Admins / Domain Groups <br>  You can create roles for users, global administrators, and domain administrators. <br><br>  <b>Settings-&gt; Access / Authentification</b> <br>  You can configure the user authentication method to the web interface quarantine <br>  We used authentication through the Windows domain through LDAP. In this case, each of the clients gets their own quarantine section, which is accessed via the web interface, the login and password match the login credentials for the email. <br><br>  <b>Filter Rules</b> <br>  You can create bookmarks for global white and black lists of email addresses and domains. <br><br>  <b>Quarantine</b> <br>  Full list of quarantined messages. <br><br>  <b>Reporting Graphs</b> <br>  Report on all processed messages, detected viruses, CPU load, memory and disk system for periods 1 day, week, month, year: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bb2/9a2/ec1/bb29a2ec1a2840939d1b4d4678be242b.jpg"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/6da/955/410/6da9554106df43378cc1d8509f22bdd5.jpg"></div><br><br>  <b>Reporting History</b> <br>  Full log messages with the ability to sort by fields. <br><br>  <b>Logs</b> <br>  Raw logs from the / var / logs directory: Maillog, messages and CFMA <br><br>  <b>Cluster</b> <br>  Section to configure the cluster configuration. <br><br>  Full SpamTitan documentation can be found <a href="http://www.spamtitan.com/resources/documentation">here</a> . <br><br><h2>  Problem </h2><br>  In the course of the work, it turned out that out of 3,500 boxes it was necessary to protect only 500 from spam, despite the fact that licenses were purchased only for 500 boxes and it was not planned to expand them. <br><br>  The logic of calculating the necessary licenses is as follows: every 24 hours, the average for the last 5 working days is the number of mailboxes that received mail, minus 20% for alias (only 20% is given because, as a rule, aliases are not used with the same intensity as the main mailbox).  Information about current usage is displayed in the management console. <br>  If the number of boxes is exceeded, the system will issue a warning and the license will need to be expanded. <br><br>  For example, in your organization 100 boxes, but only 50 of them you need to protect from spam.  Since the system counts the total number of boxes passing through it, in case of passing 51 boxes, the system will be blocked.  You will have to buy a license or use the solution described below. <br><br><h2>  Decision </h2><br>  As an example, we give the real part of the customer's infrastructure. <br><br>  In order for SpamTitan not to be blocked, it needs to ‚Äútell‚Äù which boxes it needs to protect. <br>  Therefore, first a list of the mailboxes that will pass through the spam filter was compiled.  This list is added to the gateway, for example, SMTP Relay Postfix.  After the letters pass through the Kerio Firewall firewall, they are sent to SMTP Relay, which reconciles with the list made up earlier.  If the mailbox is on the list of protected - then the letter is sent to SpamTitan, if it is missing, then the letter is sent to the mail server. <br><br>  An example of an ideal model for passing mail messages and modified taking into account the specifics of SpamTitan licensing: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/88d/43e/3a9/88d43e3a91b44ec38f11934142adad4c.jpg"></div><br><br>  The client wanted to leave the old firewall in the appendage to spamtitan.  Spam Titan is after Kerio.  During the installation process, it turned out that the client had purchased licenses for a smaller quantity than required. I had to look for a way out that does not violate the licensing conditions, but allows using the full functionality of the system. <br><br>  An example of a tailored version of SpamTitan licensing: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/4c7/c72/294/4c7c722946a642f68786bba080ff99f9.jpg"></div><br><br>  SMTP relay was deployed to the client, where they placed the routing rules for messages based on mailbox lists.  Messages for mailboxes from the list are sent to titan spam, pass through a filter and are sent to the mail server, and all others are sent directly to the mail server. <br><br><h2>  Result </h2><br><br>  In this reviewed case, Spam Titan's work allows us to filter out 24% of all emails that are classified as spam daily from the total number.  At the same time, the client has a tool for flexible configuration of the list of boxes that need to be protected from spam without additional costs for the purchase of licenses. <br><br><img src="https://habrastorage.org/files/a12/a1b/c5e/a12a1bc5e3e5447c9c78c63101763f69.jpg"><br><br>  Separately, we would like to thank the IT specialists of the Kaluga Region Administration for the professionalism shown. <br><br>  Thank you for your attention and as always we welcome your comments. </div><p>Source: <a href="https://habr.com/ru/post/233999/">https://habr.com/ru/post/233999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233987/index.html">Full cost of the loan (loan) - an example / calculation algorithm</a></li>
<li><a href="../233991/index.html">Mojolicious Perl Style</a></li>
<li><a href="../233993/index.html">Career IT project manager. How to get a job in a leading technology company</a></li>
<li><a href="../233995/index.html">Steve Ballmer finally left Microsoft</a></li>
<li><a href="../233997/index.html">What to expect from the new Samsung Galaxy Note 4</a></li>
<li><a href="../234001/index.html">BlueJ - java IDE for beginners</a></li>
<li><a href="../234003/index.html">Log in to IT: Long road to Java</a></li>
<li><a href="../234005/index.html">What should be the service implementation of media content, or why piracy thrives</a></li>
<li><a href="../234007/index.html">Cybersecurity books: 5+ recommendations from our experts</a></li>
<li><a href="../234009/index.html">mCube: a miniature accelerometer of a new type that can even turn clothes into a fitness tracker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>