<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a whois client for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my last article I told that there are quite a few libraries for parsing html, this time I decided to show how you can extract information from the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a whois client for Android</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/a1/6c/a16cafa95c569e2ffc4f186498d3003e.png" alt="Logo"><br><br>  In my last <a href="http://habrahabr.ru/blogs/android_development/115127/">article</a> I told that there are quite a few libraries for parsing html, this time I decided to show how you can extract information from the text using regular expressions, where it is impossible to hook onto tags and use the mentioned libraries.  Initially, it all started with a small application, but gradually I came up with something new and in the end, it seems to me, it turned out quite interesting. <br><br>  Under the cut, I will talk about the development process, show examples of work and options for development. <br><a name="habracut"></a><br>  To begin with, I decided to study what is on the market, so I looked into the market, and with the keyword ‚Äúwhois‚Äù I downloaded several applications, I immediately realized that my application would be unique in that it would work with IDN domains, i.e.  domains with Cyrillic names. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Development </h4><br>  The first distinctive feature of my application is the support of Cyrillic domains, and the second is that I will display the ‚Äúrecognized‚Äù data.  I will clearly know which line contains which data, and not like downloaded applications, where they simply take and parse the block with data output and output it to WebView, so that I understand why I need regular expressions, I will show a piece of the document with information that interests me: <br><br><img src="https://habrastorage.org/storage/habraeffect/da/76/da76feb578aa638f3aa8f0a542bfea45.png" alt="whois block"><br><br>  The screenshot shows that the tags are almost absent and no xpath will help here for splitting this text, so it's time to start creating the project and get to work: <br><br><img src="https://habrastorage.org/storage/habraeffect/a5/65/a565df060e56fc0222dbd0b30c5b856a.png" alt="new project"><br><br>  This time I decided to choose the minimum version for which I downloaded the SDK, I read later on Habr√© that 2.1 and 2.2 are the most popular versions now, I‚Äôll say that I am developing for 2.1 (testing on the emulator), and I will use it on 2.2. <br><br>  This time I paid more attention to the interface, for this reason I can‚Äôt upload full xml files of the interface, due to the fact that they turned out to be quite impressive. <br><br>  The main elements are: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">EditText</font> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="wrap_content"</font> <br> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:id</font> <font color="#0000ff">="@+id/site"</font> <br> <font color="#ff0000">android:maxLines</font> <font color="#0000ff">="1"</font> <br> <font color="#ff0000">android:text</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">EditText</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Button</font> <font color="#ff0000">android:text</font> <font color="#0000ff">="@string/get"</font> <br> <font color="#ff0000">android:id</font> <font color="#0000ff">="@+id/getData"</font> <br> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="fill_parent"</font> <br> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="wrap_content"</font> <br> <font color="#ff0000">android:background</font> <font color="#0000ff">="@layout/custom_button"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">Button</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ListView</font> <font color="#ff0000">android:id</font> <font color="#0000ff">="@+id/whoisList"</font> <br> <font color="#ff0000">android:layout_width</font> <font color="#0000ff">="wrap_content"</font> <br> <font color="#ff0000">android:layout_height</font> <font color="#0000ff">="wrap_content"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">ListView</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In EditText we will specify the site, here I indicated android: maxLines = "1", so that several lines could not be entered.  Button is used to start the parsing, later it turned out that in order to set simple styles for the button you need a few more gestures than in many PC applications, so I will use a separate file for the android settings: background = "@ layout / custom_button" .  ListView is also not as simple as it may seem at first glance, for it I developed a separate row, which consists of two columns. <br><br>  Interface files: <br>  <a href="">main.xml</a> - main file <br>  <a href="">custom_button.xml</a> - button styles <br>  <a href="">color.xml</a> - colors <br>  <a href="">row.xml</a> - ListView row <br><br>  As a result, we will have a left screenshot (although you will have to ask the constant lines yourself or go to the end of the article and download the project): <br><br><img src="https://habrastorage.org/storage/habraeffect/4b/52/4b527c39c1c8d9b1ea6b2b6caf8ea30b.png" alt="Interface"><br><br>  I combined all the screenshots by two, so that the post does not come out too elongated, so I‚Äôll say right away that this is the result of the ProgressDialog after clicking on the button ‚ÄúGet whois data‚Äù.  As I wrote above, input of only one line is available, so when you try to press the transfer button on a new line, we will complete the input, which will immediately hide the keyboard: <br><blockquote> <code><font color="black">EditText edittext = (EditText)findViewById(R.id.site); <br> edittext.setImeOptions(EditorInfo.IME_ACTION_DONE);</font> <br></code> </blockquote><br>  But since the user may not hide the keyboard and press the ‚ÄúGet whois data‚Äù button, we will hide it programmatically: <br><blockquote> <code><font color="black">InputMethodManager imm = (InputMethodManager)getSystemService(Context.INPUT_METHOD_SERVICE); <br> imm.hideSoftInputFromWindow(edittext.getWindowToken(), 0);</font> <br></code> </blockquote><br>  I also wanted to try calling the messages on the screen: <br><br><img src="https://habrastorage.org/storage/habraeffect/f3/90/f390c917ab8fe5216d175a3ea44167f9.png" alt="Messages"><br><br>  At our left: <br><blockquote> <code><font color="black">Toast.makeText(MainActivity. <font color="#0000ff">this</font> , <font color="#A31515">" ..."</font> , Toast.LENGTH_LONG).show();</font> <br></code> </blockquote><br>  And on the right is displayed: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">AlertDialog.Builder alertbox = <font color="#0000ff">new</font> AlertDialog.Builder(MainActivity. <font color="#0000ff">this</font> ); <br> alertbox.setMessage( <font color="#A31515">"   "</font> ); <br> alertbox.setNeutralButton( <font color="#A31515">"Ok"</font> , <font color="#0000ff">new</font> DialogInterface.OnClickListener() { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> onClick(DialogInterface arg0, <font color="#0000ff">int</font> arg1) { <br> <font color="#008000">//   </font> <br> } <br> }); <br> alertbox.show();</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The second message is more critical, so you need to make sure that the user reads it, for this we use AlertDialog. <br><br>  To transfer the domain, we will use a third-party <a href="http://www.net-track.ch/opensource/java-idna/">library</a> .  Using which you can get from the "site. Rf" character set "xn - 80aswg.xn - p1ai". <br><blockquote> <code><font color="black">import gnu.inet.encoding.IDNA; <br> IDNA.toASCII( <font color="#A31515">"."</font> );</font> <br></code> </blockquote><br>  Many will say, why not use java.net.idn, but the documentation says that it is only in 9 api, and we have 7, my test also showed that in 7-8 api import does not work, but in 9 is really all OK and the following <a href="http://www.java2s.com/Code/JavaAPI/java.net/IDNtoUnicodeStringinput.htm">code</a> works fine without any libraries. <br><br>  Now we go directly to the parsing, as already mentioned, I will use regular expressions: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">HashMap&lt; <font color="#2B91AF">String</font> , <font color="#2B91AF">String</font> &gt; map; <br> Pattern p = Pattern.compile( <font color="#A31515">"created:\\s+(\\d{4}\\.\\d{2}\\.\\d{2})\n"</font> , Pattern.CASE_INSENSITIVE); <br> Matcher matcher = p.matcher(str); <br> <font color="#0000ff">if</font> (matcher.find()) { <br> map = <font color="#0000ff">new</font> HashMap&lt; <font color="#2B91AF">String</font> , <font color="#2B91AF">String</font> &gt;(); <br> map.put( <font color="#A31515">"param"</font> , <font color="#A31515">":"</font> ); <br> map.put( <font color="#A31515">"value"</font> , matcher.group(1)); <br> list.add(map); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  "Created: \\ s + (\\ d {4} \\. \\ d {2} \\. \\ d {2}) \ n" - the date in the format yyyy.dd.MM or yyyy.MM.dd <br>  "Person: \\ s + (. +) \ N" - any character set between the space and the carriage to a new line <br>  "Phone: \\ s + (\\ + [\\ s \\ d] +) \ n" - + (plus) and spaces with numbers between spaces and the carriage to a new line <br>  "Mail: \\ s + (. +) \ N" - any character set between the space and the carriage to a new line <br>  "Registrar: \\ s + (. +) \ N" - any character set between the space and the carriage to a new line <br>  "Org: \\ s + (. +) \ N" - any character set between the space and the carriage to a new line <br><br>  In fact, there are only two options - to use the library and get only a block of code where the required data are contained and in addition to use getting an innertext, which in the future will give quite tangible flexibility, since  Many registrars add their own tags ‚Äî these are links to the mailto, a link to the site as in the example, etc.  Either run through the regular expressions the entire response from the server (I tried to choose a registrar, whose page is not too heavily overloaded). <br><br>  After we get the result, you can load it into the ListView: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">ListView list = (ListView) findViewById(R.id.whoisList); <br> SimpleAdapter myAdapter = <font color="#0000ff">new</font> SimpleAdapter(MainActivity. <font color="#0000ff">this</font> , mylist, R.layout.row, <br> <font color="#0000ff">new</font> <font color="#2B91AF">String</font> [] { <font color="#A31515">"param"</font> , <font color="#A31515">"value"</font> }, <br> <font color="#0000ff">new</font> <font color="#0000ff">int</font> [] {R.id.whoisParam, R.id.whoisData}); <br> list.setAdapter(myAdapter);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The result of the work for the two sites will be as follows: <br><br><img src="https://habrastorage.org/storage/habraeffect/3e/f2/3ef26f6b3e99f28be021ddb699340338.png" alt="Sites"><br><br>  And the last thing I wanted to do was add a menu and another Activity: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Menu myMenu = <font color="#0000ff">null</font> ; <br> <br> @Override <br> <font color="#0000ff">public</font> boolean onCreateOptionsMenu(Menu menu) <br> { <br> <font color="#008000">//call the parent to attach any system level menus</font> <br> super.onCreateOptionsMenu(menu); <br> <br> <font color="#0000ff">this</font> .myMenu = menu; <br> <br> <font color="#0000ff">int</font> <font color="#0000ff">base</font> = Menu.FIRST; <font color="#008000">// value is 1</font> <br> MenuItem item = menu.add( <font color="#0000ff">base</font> , <font color="#0000ff">base</font> , <font color="#0000ff">base</font> , <font color="#A31515">""</font> ); <br> item.setIcon(R.drawable.help); <br> <br> <font color="#008000">//it must return true to show the menu</font> <br> <font color="#008000">//if it is false menu won't show</font> <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> @Override <br> <font color="#0000ff">public</font> boolean onOptionsItemSelected(MenuItem item)   { <br> <font color="#0000ff">if</font> (item.getItemId() == 1)    { <br> Intent intent = <font color="#0000ff">new</font> Intent(MainActivity. <font color="#0000ff">this</font> , Help. <font color="#0000ff">class</font> ); <br> startActivity(intent); <br> } <br> <font color="#008000">//should return true if the menu item</font> <br> <font color="#008000">//is handled</font> <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Here I create a menu and do the processing of pressing the menu button, after which I will see the next picture (on the left, the form after calling up the menu, and on the right after pressing the button).  To close, simply call finish () in the second Activity. <br><br><img src="https://habrastorage.org/storage/habraeffect/bc/00/bc008a39ec2048b6ebc1e03198910e8f.png" alt="Menu"><br><br>  The only thing that I almost forgot is the manifest file, where you definitely need to mention the use of the Internet and the existence of a new Activity.  The finished project is as follows: <br><br><img src="https://habrastorage.org/storage/habraeffect/a4/56/a4567d04aba27ea5df2b907b473af111.png" alt="Project"><br><br>  Download link: <a href="">project</a> ( <a href="">mirror</a> ) <br><br><h4>  Total </h4><br>  It seems to me that a rather interesting application has turned out, this time the development options are just a lot.  In the future, this application can become a rather interesting seo tool; you can add sites for other domain zones, get PageRank, TIC, save the results in the database.  In general, the idea seems to me you can endlessly develop, although I agree with those who decide to write a web service, and the application for Android will be used as a client to get data from a single site, which of course will save traffic and most likely will work faster. <br></div><p>Source: <a href="https://habr.com/ru/post/115812/">https://habr.com/ru/post/115812/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115801/index.html">How to come up with a domain name for the site - a creative approach</a></li>
<li><a href="../115804/index.html">New York Times newspaper website will be paid</a></li>
<li><a href="../115805/index.html">Projection mouse evoMouse</a></li>
<li><a href="../115808/index.html">Capturing video from network cameras, part 1</a></li>
<li><a href="../115811/index.html">Debian GNU / Linux 6.0.1 released</a></li>
<li><a href="../115813/index.html">Meet COBOL - Part 1</a></li>
<li><a href="../115815/index.html">wiki.php.net compromised</a></li>
<li><a href="../115817/index.html">IPad 2 Video Review (Part 1 and 2)</a></li>
<li><a href="../115818/index.html">Storing your photo archive</a></li>
<li><a href="../115820/index.html">Problems with DKIM in the class phpmailer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>