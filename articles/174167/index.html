<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do you know static routing well?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A static route is the first thing that anyone encounters when learning the concept of IP packet routing. It is believed that this is the simplest topi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do you know static routing well?</h1><div class="post__text post__text-html js-mediator-article">  A static route is the first thing that anyone encounters when learning the concept of IP packet routing.  It is believed that this is the simplest topic of all, everything is simple and obvious.  I will try to show that even such a primitive technology can contain many nuances. <br><a name="habracut"></a><br>  <i>Reservation.</i>  <i>When writing a topic, I assume that the reader is familiar with the concept of routing, knows how to do static routes and does not consider the word ‚ÄúARP‚Äù abusive.</i>  <i>However, even experienced telecom operators will surely find something new here.</i> <i><br></i>  <i>All examples were tested on the IOS 15.2M line.</i>  <i>The behavior of other operating systems may vary.</i> <i><br></i>  <i>And there will be no dynamic routing here.</i> <br><br>  We work with the following topology: <br><img src="https://habrastorage.org/storage2/9e1/ba0/740/9e1ba07400ceb32896829ec2f86becf2.png"><br><br><h3>  How does a static route appear? </h3><br>  To begin with, we will execute the command that everyone knows, and see in debigs what will happen: <br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">R00</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span></code> </pre> <br><pre> <code class="hljs pgsql">IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): updating same distance <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> RT: updating static <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> (<span class="hljs-number"><span class="hljs-number">0x0</span></span>): via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> RT: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>, static metric [<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> succeed, active state IP ARP: creating incomplete entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> IP address: <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> IP ARP: sent req src <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">30e4</span></span>.db16<span class="hljs-number"><span class="hljs-number">.7791</span></span>, dst <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-number"><span class="hljs-number">0000.0000</span></span><span class="hljs-number"><span class="hljs-number">.0000</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> IP ARP: rcvd rep src <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-number"><span class="hljs-number">0019.</span></span>aad6.ae10, dst <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  IOS created the route, and immediately sent an arp request in search of next hop, which we have is 10.0.0.3.  And immediately the question: how did the router know that the request should be sent to the interface Gi0 / 1?  Surely someone will say "from the list of local interfaces," and cruelly mistaken.  Routing does not work that way.  In fact, IOS made a recursive query to the routing table to find out how to get to next hop: <br><pre> <code class="hljs kotlin">R00#show ip route <span class="hljs-number"><span class="hljs-number">10.0</span></span>.0.3 Routing entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span>.0.0/<span class="hljs-number"><span class="hljs-number">24</span></span> Known via <span class="hljs-string"><span class="hljs-string">"connected"</span></span>, distance <span class="hljs-number"><span class="hljs-number">0</span></span>, metric <span class="hljs-number"><span class="hljs-number">0</span></span> (connected, via <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Routing</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Descriptor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Blocks</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">* directly connected</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">via GigabitEthernet0/1 Route metric is 0</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">traffic share count is 1</span></span></span></span></code> </pre> <br>  And here it is, our Gi0 / 1.  IOS will find out that with recursive queries to the RIB it is necessary to end as soon as it finds a route with the "directly connected" flag.  But what if, in response to the initial request for 10.0.0.3, it does not return a connected route at all, but an intermediate one that refers to another next hop?  Let's come back to this a bit later, but for now let's remember what CEF is. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Approximately in all documentation focused on beginners, it is said that each packet moves according to the routing table.  In fact, on all more or less modern platforms this is no longer the case, because the routing table (hereinafter referred to as RIB) is not optimized for fast data transfer at all.  <a href="http://www.cisco.com/web/partners/downloads/765/tools/quickreference/routerperformance.pdf">This</a> table allows us to estimate the scale of the disaster (although the process switching has many drawbacks besides non-optimal queries ‚Äî for example, constant switching of the CPU scheduler between contexts, which is very expensive).  CEF is a serious optimization.  In a modern implementation, he builds two tables ‚Äî FIB (Forwarding Information Base, a packet transfer table, based on a coherent graph with the terrible name 256-way mtrie) and an adjacency table.  The first one is built on the basis of the routing table and in one pass allows you to get all the necessary information.  It is built in advance, even before the first corresponding package appears. <br><br>  Let's return to our static route.  Here is the entry in the routing table: <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">R00</span></span>#show ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-type"><span class="hljs-type">Known</span></span> via <span class="hljs-string"><span class="hljs-string">"static"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, metric <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> <span class="hljs-type"><span class="hljs-type">Descriptor</span></span> <span class="hljs-type"><span class="hljs-type">Blocks</span></span>: * <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-type"><span class="hljs-type">Route</span></span> metric <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, traffic share <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Where to send the package?  Where to look for 10.0.0.3?  Unclear.  It is necessary to once again request the routing table, this time about 10.0.0.3, and, if necessary, perform a few more iterations until we find out the connected interface.  And about this way, we are actually several times reducing the performance of the router. <br><br>  This is what CEF says: <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> detail <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> attached <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Simple and concise.  There is an interface, there is next hop, to which you need to send a packet.  What was said about the adjacency table? <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> adjacency <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> detail Protocol Interface Address IP GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> packets, <span class="hljs-number"><span class="hljs-number">0</span></span> bytes epoch <span class="hljs-number"><span class="hljs-number">0</span></span> sourced <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sev-epoch <span class="hljs-number"><span class="hljs-number">2</span></span> Encap length <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">0019</span></span>AAD6AE1030E4DB1677910800 ARP</code> </pre> <br>  Pay attention to some long sequence in the last but one line.  Something it reminds ... We look mac 10.0.0.3: <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> arp | <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> Internet <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0019.</span></span>aad6.ae10 ARPA GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  We look at your mac address on gi0 / 1: <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> up, <span class="hljs-type"><span class="hljs-type">line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> up Hardware <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> CN Gigabit Ethernet, address <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">30e4</span></span>.db16<span class="hljs-number"><span class="hljs-number">.7791</span></span> (bia <span class="hljs-number"><span class="hljs-number">30e4</span></span>.db16<span class="hljs-number"><span class="hljs-number">.7791</span></span>)</code> </pre> <br>  Yeah.  That terrible line is just two poppies that need to be substituted into the Ethernet header at the encapsulation stage, and ethertype 0x0800, i.e.  banal IPv4.  And in two CEF tables there is absolutely all the information that is needed to successfully send a packet further down the chain. <br><br>  If someone has a question, why should a piece of iron hold two tables at once instead of one, then I will give an obvious answer: usually, the router has few interfaces (and neighbors as well) and many routes.  What is the point of duplicating the same Macs thousands of times in the FIB?  Memory does not happen much, especially on hardware platforms, be it the new-fledged ASRs or even the L3 switches of the Catalyst line.  All of them involve CEF in the transmission of packets. <br><br>  And by the way, let's return for a moment to the initial debug.  Disable CEF with no ip cef (never do this) and compare the result: <br><pre> <code class="hljs pgsql">IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): updating same distance <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> RT: updating static <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> (<span class="hljs-number"><span class="hljs-number">0x0</span></span>): via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span> RT: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span>, static metric [<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> succeed, active state</code> </pre> <br>  Route added.  Arp request was not.  And rightly so - why did RIB give up mac address?  If you let ping up, for example, 3.1.1.1, then most likely it will be like this: <br><pre> <code class="hljs pgsql">R00#ping <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">escape</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abort</span></span>. Sending <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>-byte ICMP Echos <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, timeout <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> seconds: .!!!! Success rate <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> percent (<span class="hljs-number"><span class="hljs-number">4</span></span>/<span class="hljs-number"><span class="hljs-number">5</span></span>), round-trip min/avg/max = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">4</span></span> ms</code> </pre> <br>  The first packet is discarded, and the router sends an arp request in order to find out the mac address 10.0.0.3 if it was not previously known.  CEF, however, always knows in advance the mac address of the next hop. <br><br>  With this sorted out.  Now back to the question of what will happen if the next hop of a static route is not at all on the directly connected interface.  We proceed simply: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">R00</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span> 100<span class="hljs-selector-class"><span class="hljs-selector-class">.100</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.100</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.101</span></span></code> </pre> <br>  where Gi0 / 2 has the address 100.100.100.100/24. <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> detail <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> attached <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  How bad everything is ... And what if we have a route for a whole supernetwork? <br><pre> <code class="hljs pgsql">R00(config)#<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> ip route <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> R00(config)#ip route <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> detail <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> attached <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Now our routing table looks like this: <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip route <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> variably subnetted, <span class="hljs-number"><span class="hljs-number">2</span></span> subnets, <span class="hljs-number"><span class="hljs-number">3</span></span> masks S <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>] via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> C <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> L <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">100.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> variably subnetted, <span class="hljs-number"><span class="hljs-number">2</span></span> subnets, <span class="hljs-number"><span class="hljs-number">2</span></span> masks C <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span> L <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Seems alright.  The new route at 100.100.100.101 does not apply to 10.0.0.3, since its mask / 8 is much shorter than / 24 at the connected interface.  But suddenly Gi0 / 1, which contained next hop for 3.1.1.0/24, for some unknown reason went down, and its connected route disappeared from the RIB. <br><pre> <code class="hljs pgsql">%LINK<span class="hljs-number"><span class="hljs-number">-5</span></span>-CHANGED: Interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> administratively down %LINEPROTO<span class="hljs-number"><span class="hljs-number">-5</span></span>-UPDOWN: <span class="hljs-type"><span class="hljs-type">Line</span></span> protocol <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, changed state <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> down RT: interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> removed <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routing <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> RT: del <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> via <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>, connected metric [<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>] RT: <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> subnet route <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> RT: del <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> via <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>, connected metric [<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>] RT: <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> subnet route <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): updating GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Here is what became: <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> detail <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> attached <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Oh.  Now packets on the 3.1.1.0/24 network go somewhere not there.  I can not imagine a scenario when the expected behavior of a static route is switching to another interface.  If there is a backup path behind that interface, you still need to create another static route ... <br><br>  What to do?  Specify the interface immediately in the route.  Recreate the route: <br><pre> <code class="hljs lua">R00(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#no ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> R00(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br>  Raise Gi0 / 1.  We look where the route now leads to 3.1.1.0/24: <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">R00</span></span>#show ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-type"><span class="hljs-type">Known</span></span> via <span class="hljs-string"><span class="hljs-string">"static"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, metric <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> <span class="hljs-type"><span class="hljs-type">Descriptor</span></span> <span class="hljs-type"><span class="hljs-type">Blocks</span></span>: * <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.3</span></span>, via <span class="hljs-type"><span class="hljs-type">GigabitEthernet0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">Route</span></span> metric <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, traffic share <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  There is already an interface.  Therefore, there will be no recursive queries to the routing table.  Check FIB: <br><pre> <code class="hljs objectivec">R00<span class="hljs-meta"><span class="hljs-meta">#show ip cef 3.1.1.0 3.1.1.0/24 nexthop 10.0.0.3 GigabitEthernet0/1</span></span></code> </pre> <br>  Yes, no "recursive".  And if you again pay gi0 / 1?  The route has disappeared. <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> % Network <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> route</code> </pre> <br>  And despite the fact that the route to 10.0.0.3 was still: <br><pre> <code class="hljs objectivec">R00<span class="hljs-meta"><span class="hljs-meta">#show ip cef 10.0.0.3 10.0.0.0/8 nexthop 100.100.100.101 GigabitEthernet0/2</span></span></code> </pre> <br>  And what will happen if the path to next hop gives the default route and the route to 3.1.1.0/24 does not refer to the interface? <br><pre> <code class="hljs pgsql">R00(config)#<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> ip route <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> R00(config)#ip route <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> R00(config)#<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> R00(config)#ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> % Network <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> detail <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span>, flags <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> route <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">100.100</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> attached <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Note that the first line after ‚Äúshow ip cef‚Äù is ‚Äú0.0.0.0/0‚Äù, and not ‚Äú3.1.1.0/24‚Äù.  Despite the fact that next hop is formally, in fact, all iterations of polling the routing table (except the first) ignore the default route, which is logical, otherwise any query to the routing table would almost always be resolved (‚Äúresolving‚Äù means finding an interface in which need to send a package).  Therefore, our static route is missing, but packages still fly to Gi0 / 2.  It seems to be the same as without explicitly specifying the interface?  Not really.  Let's say the routing protocol was told to "redistribute static".  If the static route is gone, then the announcement also responds.  And if not, the router will continue to tell everyone to ‚Äúgo through me there,‚Äù and this will almost certainly turn L3 into a ring for the prefix 3.1.1.0/24, which could be accessed from somewhere else.  But wait, we agreed not to touch the dynamic routing ... <br><br>  And what if you specify an interface in a static route, but do not specify the IP address of the next hop?  Answer: in the case of Ethernet, if proxy arp is not disabled at next hop, the connectivity will not be broken, but the router can be VERY bad.  <a href="http://habrahabr.ru/post/170649/">More details</a> .  If you say ‚Äúip route 3.1.1.0 255.255.255.0 gi0 / 1‚Äù, then nothing particularly terrible will happen, even a couple of hundred entries in the arp table any router will digest (and there are workaround scripts where the optimal solution is just such a crutch ), but the ‚Äúip route 0.0.0.0 0.0.0.0 gi0 / 1‚Äù on the border router will surely kill it.  Therefore, remember the general rule: if you create a static route with next hop on the Ethernet interface, its IP address should always be indicated.  Exceptions - only when you are very well aware of what you are doing, why you are doing it and why you cannot do it otherwise. <br><br>  And finally, we will make one very bad thing. <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">R00</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)# <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">R00</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre> <br>  The first route is in order, tested a hundred times.  But the second is strange - it leads through the first.  And the first now refers to the second, and we have endless recursion.  Here is what happened: <br><pre> <code class="hljs sql">IP-ST(default): updating same distance on 3.1.1.0/24 IP-ST(default): 3.1.1.0/24 [1], 10.0.0.3 Path = 8, no <span class="hljs-keyword"><span class="hljs-keyword">change</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Path</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> RT: updating <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> (<span class="hljs-number"><span class="hljs-number">0x0</span></span>): via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> RT: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> metric [<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> succeed, active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): updating same distance <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Path</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">change</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Path</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> RT: updating <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> (<span class="hljs-number"><span class="hljs-number">0x0</span></span>): via <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> RT: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> via <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> metric [<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> succeed, active state</code> </pre> <br>  Added successfully.  But then it appeared in debags: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">RT</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">recursion</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">probable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loop</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RT</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">recursion</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">error</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">probable</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">routing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">loop</span></span></code> </pre> <br>  And there was an entry in the log with severity 3: <br><pre> <code class="hljs pgsql">%IPRT<span class="hljs-number"><span class="hljs-number">-3</span></span>-RIB_LOOP: Resolution <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> formed <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> RIB</code> </pre> <br><pre> <code class="hljs pgsql">R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> detail <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span> Adj source: IP adj <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span>, addr <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-number"><span class="hljs-number">359503</span></span>C0 Dependent covered prefix <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> adjfib cover <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> RR source [<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> flags] <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, unresolved <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span>-looped R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> detail <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>, epoch <span class="hljs-number"><span class="hljs-number">0</span></span>, flags cover dependents Covered dependent prefixes: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">notify</span></span> cover updated: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span> via <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>, unresolved <span class="hljs-keyword"><span class="hljs-keyword">recursive</span></span>-looped</code> </pre> <br>  However, the RIB does not see any crime: <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">Routing</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-type"><span class="hljs-type">Known</span></span> via <span class="hljs-string"><span class="hljs-string">"static"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, metric <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> <span class="hljs-type"><span class="hljs-type">Descriptor</span></span> <span class="hljs-type"><span class="hljs-type">Blocks</span></span>: * <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-type"><span class="hljs-type">Route</span></span> metric <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, traffic share <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">R00</span></span>#show ip route <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.3</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-type"><span class="hljs-type">Known</span></span> via <span class="hljs-string"><span class="hljs-string">"static"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, metric <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> <span class="hljs-type"><span class="hljs-type">Descriptor</span></span> <span class="hljs-type"><span class="hljs-type">Blocks</span></span>: * <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-type"><span class="hljs-type">Route</span></span> metric <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, traffic share <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Conclusion - never do that. <br><br><h3>  Why a static route can not get into the routing table? </h3><br>  Any networker should immediately give one of the explanations regarding any source of routes in IOS: there is another route to the same prefix, but with a smaller AD (do everyone remember Administrative Distance?).  The route, the source of which is ‚Äúconnected‚Äù, always has AD = 0, and no other source of routes can bring anything lower than ‚Äú1‚Äù, not even a static route with an explicit indication of the interface.  Example connected: <br><pre> <code class="hljs pgsql">R00# <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip route C <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected, GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Those.  While the Gi0 / 1 interface is in the up state and has an address from the subnet 10.0.0.0/24, not a single static route to this prefix appears in the routing table. <br><br>  Another option is ‚Äúdifferent route sources add routes to the same prefix with the same AD‚Äù.  The behavior of iOS in this case is not documented, the general recommendation is ‚Äúnever do that.‚Äù <br><br>  But let's look at other, less obvious examples.  For example, static routes can be created with the word "permanent", which translates as "permanent", and then they will always hang in the routing table.  Right?  Not. <br><br>  Add it and see: <br><pre> <code class="hljs smalltalk"><span class="hljs-type"><span class="hljs-type">R00</span></span>(config)<span class="hljs-symbol"><span class="hljs-symbol">#ip</span></span> route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> permanent <span class="hljs-type"><span class="hljs-type">R00</span></span><span class="hljs-symbol"><span class="hljs-symbol">#show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> nexthop <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-type"><span class="hljs-type">GigabitEthernet0</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Put Gi0 / 1, and see: <br><pre> <code class="hljs objectivec">R00<span class="hljs-meta"><span class="hljs-meta">#show ip cef 3.1.1.0 3.1.1.0/24 unresolved via 10.0.0.3</span></span></code> </pre> <br>  It is in the RIB, and other routing protocols can use it: <br><pre> <code class="hljs swift"><span class="hljs-type"><span class="hljs-type">R00</span></span>#show ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span>.<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-type"><span class="hljs-type">Known</span></span> via <span class="hljs-string"><span class="hljs-string">"static"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">distance</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, metric <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">Routing</span></span> <span class="hljs-type"><span class="hljs-type">Descriptor</span></span> <span class="hljs-type"><span class="hljs-type">Blocks</span></span>: * <span class="hljs-number"><span class="hljs-number">10.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.3</span></span>, permanent <span class="hljs-type"><span class="hljs-type">Route</span></span> metric <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, traffic share <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  And now, without raising Gi0 / 1: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">R00</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#no</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">permanent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">R00</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">config</span></span>)<span class="hljs-selector-id"><span class="hljs-selector-id">#ip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">route</span></span> 3<span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 255<span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.255</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">permanent</span></span></code> </pre> <br>  Just recreated it, without changing anything.  And that's what happened: <br><pre> <code class="hljs pgsql">IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): updating same distance <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): cannot <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>, PERMANENT R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> % Network <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> route</code> </pre> <br>  Standing, speak?  Not.  There is one small nuance: in order for the permanent route to fit forever into the routing table, it is necessary that it should be resolved for at least a split second.  Although what else is "forever"?  When it was left hanging in the air without a resolving interface, it suffices to say ‚Äúclear ip route *‚Äù or, all the more, ‚Äúreload‚Äù so that it disappears from the RIB. <br><br>  But we will continue.  Let's do this: <br><pre> <code class="hljs lua">R00(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> R00(<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>)#ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br>  Like normal routes.  What will happen?  With the second - absolutely nothing. <br><pre> <code class="hljs pgsql">IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> change, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> active state</code> </pre> <br>  The bottom line is this.  Suppose there is a route on XXXX through YYYY. We add a route on X1.X1.X1.X1 (this prefix is ‚Äã‚Äãcompletely covered by XXXX) via X2.X2.X2.X2 (and it is also covered by XXXX).  IOS makes a logical conclusion: the second route does not carry any new information and is completely useless, so you can not install it in the RIB. <br><br>  And now feint ears. <br><pre> <code class="hljs pgsql">R00(config)#<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> R00(config)#ip route <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): updating same distance <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> IP-ST(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>): <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>], GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">Path</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span> RT: updating static <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> (<span class="hljs-number"><span class="hljs-number">0x0</span></span>): via <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Gi0/<span class="hljs-number"><span class="hljs-number">1</span></span> RT: network <span class="hljs-number"><span class="hljs-number">3.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> now variably masked RT: <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> via <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>, static metric [<span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> succeed, active state IP ARP: creating incomplete entry <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> IP address: <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> interface GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> IP ARP: sent req src <span class="hljs-number"><span class="hljs-number">10.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">30e4</span></span>.db16<span class="hljs-number"><span class="hljs-number">.7791</span></span>, dst <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-number"><span class="hljs-number">0000.0000</span></span><span class="hljs-number"><span class="hljs-number">.0000</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span> R00#<span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ip cef <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> nexthop <span class="hljs-number"><span class="hljs-number">3.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> GigabitEthernet0/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  And this brings us to another important point.  Specifying an interface in a static route allows you to bypass many checks, since the static route no longer needs to perform recursive queries to the RIB in search of a path to next hop, and when it is added, it will not trigger triggers on other routes.  But this does not cancel the main requirement: next hop must be resolved to a specific interface, and that interface must be up.  The fact that there will no longer be recursive requests to the RIB means that the specified IP address of the next hop is located directly behind the interface, and will most likely respond to the arp request (from the router's point of view).  If proxy arp is enabled on the neighbor Gi0 / 1 router, then in response to an arp request, it will most likely return its mac address, and everything will be fine.  Is that an extra entry in the arp table ... <br><br>  But still, you shouldn't do that. <br><br>  It is necessary to mention another important point.  The static route should, in theory, disappear from the routing table as soon as it stops resolving.  But in practice there are many situations where next hop disappears, but at the same time a static route remains for some time.  For example, when next hop is resolved via a route received from a dynamic routing protocol.  The thing is that the process that monitors the presence of next hop in the RIB cannot always receive a notification about the disappearance of the route, and it has to periodically (every 60 seconds by default) recheck whether everything is fine.  This will cause a noticeable delay in network convergence. <br><br>  To change the check interval, for example, for 10 seconds, you can use the command: <br><pre> <code class="hljs objectivec">ip route <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> adjust-time <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/174167/">https://habr.com/ru/post/174167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174147/index.html">How we chose hosting</a></li>
<li><a href="../174151/index.html">Development for Blackberry 10. First impressions</a></li>
<li><a href="../174153/index.html">Professional Audio / Video over Ethernet, a completely new approach</a></li>
<li><a href="../174157/index.html">How to run a program without an operating system: part 2</a></li>
<li><a href="../174159/index.html">Canadian sells his house for Bitcoins</a></li>
<li><a href="../174169/index.html">Droppers Gapz and Redyms are based on the Power Loader code</a></li>
<li><a href="../174171/index.html">Nokia's research project - a ready-made prototype of the phone, charged by the energy of radio waves</a></li>
<li><a href="../174173/index.html">Windows Azure Update: Hadoop, Dropbox, Mercurial, PhoneGap</a></li>
<li><a href="../174175/index.html">New stage in the race speeds JavaScript. OdinMonkey module speeds up low-level code 10 times</a></li>
<li><a href="../174177/index.html">2 Russian finalists for the Windows Phone Next App Star contest went to the second round!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>