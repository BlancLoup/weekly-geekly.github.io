<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Develop Chrome Extension with Angular CLI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have been developing extensions to Chrome for a long time, and during that time I have gone a whole way from Greasemonkey user scripts to a full-fle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Develop Chrome Extension with Angular CLI</h1><div class="post__text post__text-html js-mediator-article">  I have been developing extensions to Chrome for a long time, and during that time I have gone a whole way from Greasemonkey user scripts to a full-fledged Angular application in the chrome-extension shell.  My task is that I patch some already working sites in order to change their functionality and automate some processes on these sites.  Sometimes my application grows to a large scale and it becomes difficult to maintain a plain-js extension (there are a lot of settings in the application, CRUD functionality, etc.).  And here comes Angular to the rescue. <br><br>  In this article I will tell you how I made friends with the <i>Chrome Extension</i> and <i>Angular CLI</i> , and set up the development process, as well as what difficulties I encountered and how I solved them. <a name="habracut"></a><br>  Create a new folder and initialize a new application in it. <br><br><pre><code class="bash hljs">mkdir new-project <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> new-project ng new frontend --routing=<span class="hljs-literal"><span class="hljs-literal">true</span></span> --skipGit=<span class="hljs-literal"><span class="hljs-literal">true</span></span> --style=scss --skipTests=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  In the developmental stage, <i>Angular</i> generates a dynamic html-file in which development takes place, and the Chromov extension needs to be fed a static html-file in order to see the result of the work.  Of course, you can separately assemble the Angulyarovsky project and then build a version in addition, but it will be convenient if this happens automatically. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After generating the new application, go to the frontend folder and in the file package.json in the scripts section add a new script to build our project <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"developing"</span></span>: <span class="hljs-string"><span class="hljs-string">"ng build --watch --deploy-url /frontend/dist/frontend/ --base-href /frontend/dist/frontend/index.html?/"</span></span></code> </pre> <br>  Note the <code>deploy-url</code> and <code>base-href</code> . <br><br>  Then in the root of the project we create another <i>extension</i> folder and in it we will create the <i>extension.js</i> file, which will be the <i>background</i> script for our extension.  Current project structure: <br><br><pre> <code class="markdown hljs">| new-project/ | | extension/ | | | extension.js | | frontend/ | | | ...</code> </pre><br>  Content <i>extension.js</i> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ANGULAR_HTML_URL = <span class="hljs-string"><span class="hljs-string">"../../frontend/dist/frontend/index.html"</span></span>; chrome.browserAction.onClicked.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ chrome.tabs.create({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: chrome.runtime.getURL(ANGULAR_HTML_URL) }); });</code> </pre> <br>  This will be a <i>browserAction</i> , which will open a new tab with our angular application, which will be stored in the assembled form along this path. <br><br><div class="spoiler">  <b class="spoiler_title">Let's add manifest.json to our project</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Simple Chrome Ext"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Simple Chrome Extension as an example"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.00"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Bogdan"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' 'unsafe-eval'; object-src 'self'"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"background"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"persistent"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: [<span class="hljs-string"><span class="hljs-string">"/extension/extension.js"</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">"browser_action"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Chrome ext"</span></span> } }</code> </pre> <br></div></div><br>  Now we can build our project into an extension.  Go to <i>chrome: // extensions /</i> , turn on developer mode and select <i>Download unpacked extension</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text"><img src="http://charmingdate.ru/aos/%D0%A1%D0%BD%D0%B8%D0%BC%D0%BE%D0%BA%20%D1%8D%D0%BA%D1%80%D0%B0%D0%BD%D0%B0%202019-06-30%20%D0%B2%2022.23.39.png" alt="image"></div></div><br>  Convenience is that we have almost hot-reloading.  We started <i>ng build</i> with the <i>watch</i> flag and when the code changes, the project will be rebuilt and the js-files will be replaced.  That is, on the extension page, we just need to reload the page and all updates will pick up.  This greatly accelerates the development of add-ons. <br><br>  Another thing I ate at the dog, is that in the routing configuration: <br><br><pre> <code class="json hljs">{ useHash: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br>  as well as <i>returning</i> above, we specified <i>base-href</i> for the build as <i>/frontend/dist/frontend/index.html?/</i> - pay attention to the question mark before the last slash.  The fact is that on some systems, when clicking on links in an Angulyarov application, everything crashes without this sign.  Apparently, the static web server of the chrome engine perceived the URL change as a request to another file (even though useHash: true) and returned 404 error when refreshing the page.  Only in this combination, I was able to achieve stable operation on all systems. <br><br>  Let's go back to the <i>package.json of</i> our application and add another script. <br><br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"prod"</span></span>: <span class="hljs-string"><span class="hljs-string">"ng build --sourceMap false --prod true --deploy-url /frontend/dist/frontend/ --base-href /frontend/dist/frontend/index.html?/"</span></span></code> </pre> <br>  This will be a script to build our application for the production version. <br><br>  In the Chrome Web Store, a zip-archive with an extension is posted, and to simplify the build, I made a script for this purpose. <br><br><div class="spoiler">  <b class="spoiler_title">update.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash rm -rf ./prod-build mkdir -p prod-build/frontend cd frontend npm run prod cd .. cp -R ./frontend/dist ./prod-build/frontend cp -R ./extension ./prod-build cp ./manifest.json ./prod-build zip -r prod-build{.zip,} rm -rf ./prod-build</span></span></code> </pre></div></div><br>  Source code can be viewed <a href="https://github.com/mbogdan0/chrome-extension"><b>here</b></a> . <br><br>  Total: we created a blank for the development of the Angular Chrome Extension with the correct routing and convenient update / build of the application. <br><br>  PS: to get rid of such <i>/ frontend / dist / frontend /</i> paths, you can set up the environment and prescribe the path in a production assembly in a different way, but this is no longer the key point. </div><p>Source: <a href="https://habr.com/ru/post/458556/">https://habr.com/ru/post/458556/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458532/index.html">Pioneers of new technologies: Vadim Artsev told how he ceased to be blind</a></li>
<li><a href="../458536/index.html">Python + Pyside2 or just "Calculator"</a></li>
<li><a href="../458548/index.html">Creating a library in the style of Spring Data Repository do-it-yourself using Dynamic Proxy and Spring IoC</a></li>
<li><a href="../45855/index.html">Icons for your software products</a></li>
<li><a href="../458550/index.html">Symbols GOST library for DipTrace</a></li>
<li><a href="../458558/index.html">Reports from Magento Meetup Kharkiv - Videos and Presentations</a></li>
<li><a href="../458560/index.html">Training Cisco 200-125 CCNA v3.0. Day 12. In-depth study of the VLAN</a></li>
<li><a href="../458564/index.html">Pits on the way of becoming a programmer</a></li>
<li><a href="../458566/index.html">As we UX-designer caught on live bait</a></li>
<li><a href="../458568/index.html">The first 3D photos were taken, possibly the oldest Christian church in Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>