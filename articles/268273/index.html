<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Compalex: comparing schemas of two databases</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose you have a prod and test database. At some point, the developer made changes to the test base, but forgot to make these changes to the combat ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Compalex: comparing schemas of two databases</h1><div class="post__text post__text-html js-mediator-article">  Suppose you have a prod and test database.  At some point, the developer made changes to the test base, but forgot to make these changes to the combat base.  If this is a frequently used table, then the situation very quickly becomes obvious, since errors will appear in the logs in the SQL queries and the boss will start calling you with reproaches for ‚Äúwhat # # $%‚Äù. <br><br>  But sometimes the changes affect rarely used tables, either the changes are not at all obvious at first glance (for example, someone changed the length of the VARCHAR field and your lines were truncated, or someone added an index that makes queries on the test database run on order faster). <br><br>  Another option - you have updated the software and everything has stopped working for you.  A bunch of incomprehensible errors from scratch, the application is lying, users are not happy. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In such cases, it is very useful to see how the bases differ and draw the appropriate conclusions. <br><br><img src="https://habrastorage.org/files/84f/902/4f2/84f9024f291d4ffb8675532d361f5095.png"><br><a name="habracut"></a><br>  What comes to mind?  We do dump structures of one base, then another.  Run the diff utility and it shows the lines that differ in the two dumps.  For small changes this might work.  But, firstly, it is somewhat tedious, and secondly, the situation can turn out as in the screenshot when there is no table in one database and the diff begins to compare different tables. <br><br><img src="https://habrastorage.org/files/b51/88b/c61/b5188bc61d6841a19b364d4d267c8a15.png"><br><br>  Faced with these problems, I wrote a small php script ( <a href="https://github.com/dlevsha/compalex">https://github.com/dlevsha/compalex</a> ) that works with MySQL, MS SQL Server, PostgreSQL (with Oracle support) and allows you to compare two databases.  The script does not pull any dependencies, which simplifies its installation and support. <br><br>  To work, you need to install the script itself (it is assumed that php&gt; = 5.4 with PDO support is already installed, if not, then in debian / ubuntu this is done with a single line <b>aptitude install php5</b> , the only thing is that you should have php version not lower than 5.4 installed) <br><br><pre><code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/dlevsha/compalex.git $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> compalex</code> </pre> <br><br>  Open the <b>.environment</b> in the project folder and edit the parameters. <br><br><pre> <code class="hljs pgsql">[ Main settings ] ; Possible DATABASE_DRIVER: <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>, <span class="hljs-string"><span class="hljs-string">'pgsql'</span></span>, <span class="hljs-string"><span class="hljs-string">'dblib'</span></span>. ; Please use <span class="hljs-string"><span class="hljs-string">'dblib'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Microsoft <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> DATABASE_DRIVER = mysql DATABASE_ENCODING = utf8 SAMPLE_DATA_LENGTH = <span class="hljs-number"><span class="hljs-number">100</span></span> [ <span class="hljs-keyword"><span class="hljs-keyword">Primary</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> params ] DATABASE_HOST = localhost DATABASE_NAME = compalex_dev DATABASE_USER = <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> DATABASE_PASSWORD = <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> DATABASE_DESCRIPTION = Developer <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> [ Secondary <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> params ] DATABASE_HOST_SECONDARY = localhost DATABASE_NAME_SECONDARY = compalex_prod DATABASE_USER_SECONDARY = <span class="hljs-keyword"><span class="hljs-keyword">login</span></span> DATABASE_PASSWORD_SECONDARY = <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> DATABASE_DESCRIPTION_SECONDARY = Production <span class="hljs-keyword"><span class="hljs-keyword">database</span></span></code> </pre><br><br>  Select the <i>DATABASE_DRIVER</i> driver from the supported 'mysql', 'pgsql', 'dblib' <br><br>  Rule settings responsible for connecting to the first and second databases, respectively <br><br><pre> <code class="hljs pgsql">DATABASE_HOST = localhost DATABASE_NAME = compalex_dev DATABASE_USER = root DATABASE_PASSWORD = <span class="hljs-keyword"><span class="hljs-keyword">password</span></span></code> </pre><br><br>  In order not to get confused where is which database - give them names in the parameters <i>DATABASE_DESCRIPTION</i> <br><br>  After that, being in the project folder, we launch the web-server <br><br><pre> <code class="bash hljs">$ php -S localhost:8000</code> </pre><br><br>  and open in the browser <a href="http://localhost:8000/">http: // localhost: 8000 /</a> <br><br>  A comparison diagram consisting of two columns should be displayed, in accordance with the specified database parameters. <br><br><img src="https://habrastorage.org/files/534/35d/41f/53435d41fe8b4733aab671d0139d512b.png"><br><br>  The purpose of the elements shown in the diagram. <br><br>  Sometimes it is not possible to organize a direct local connection to the databases and changes need to be viewed directly on the server from the console. <br><br>  For these purposes, I recommend using the console browser <a href="https://ru.wikipedia.org/wiki/ELinks">eLinks</a> , which supports HTML formatting and colors in the markup. <br><br>  You need to install the script on the server, start the web-server (as described above) and execute: <br><br><pre> <code class="bash hljs">$ elinks http://localhost:8000</code> </pre><br><br>  We get about the following: <br><br><img src="https://habrastorage.org/files/4dd/555/48d/4dd55548dbfe41d5b6063c0596f97a8d.png"><br><br>  More information on the website (in English) <a href="http://compalex.net/">http://compalex.net/</a> . <br><br>  Here you can try how it all works <a href="http://demo.compalex.net/">http://demo.compalex.net/</a> . </div><p>Source: <a href="https://habr.com/ru/post/268273/">https://habr.com/ru/post/268273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268261/index.html">Three-Way Bitwise Quick Sort</a></li>
<li><a href="../268265/index.html">AngularJS: Migration from 1.2 to 1.4, Part 1</a></li>
<li><a href="../268267/index.html">Sometimes less is better - why only Google authorization? + channel Rusbase</a></li>
<li><a href="../268269/index.html">Why I chose Yii2</a></li>
<li><a href="../268271/index.html">ECFG: put ~ / .emacs on a diet</a></li>
<li><a href="../268275/index.html">Why the Internet needs IPFS before it's too late</a></li>
<li><a href="../268277/index.html">Big Data from A to Z. Part 2: Hadoop</a></li>
<li><a href="../268279/index.html">DroidSon Moscow 2015: how it was</a></li>
<li><a href="../268281/index.html">Paul Graham: "Design and Research"</a></li>
<li><a href="../268283/index.html">A detailed review of Affinity Designer (Mac OS). Part 1. Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>