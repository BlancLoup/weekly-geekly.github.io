<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Boost.DI: dependency injection in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúDo not call us. We will call you yourself. "- the principle of Hollywood 

 Dependency injection (DI) means the transfer (deployment) of one or more ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Boost.DI: dependency injection in C ++</h1><div class="post__text post__text-html js-mediator-article">  <i>‚ÄúDo not call us.</i>  <i>We will call you yourself. "- the principle of Hollywood</i> <br><br>  Dependency injection (DI) means the transfer (deployment) of one or more dependencies to an object (client, component) in such a way that, after implementation, this dependence becomes part of the object state.  This is a bit like the design strategy pattern, with the only difference that the strategy is set only once - in the constructor.  DI allows you to create a more loosely-connected application architecture that is better supported and tested. <br><br>  So, once again the pros: <br><ul><li>  Reduces component connectivity (separates business logic from object creation) </li><li>  Allows you to write more supported code (we can easily embed different dependencies on the same objects) </li><li>  Allows you to write more testable code (we can use stubs and mocks more easily) </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <table><tbody><tr><th>  Without dependency injection </th><th>  With the introduction of addiction </th></tr><tr><td><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: example() : logic_(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> logic{}) , logger_( logger_factory::create() ) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;ilogic&gt; logic_; <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;ilogger&gt; logger_; };</code> </pre> <br></td><td><pre> <code class="cpp hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">example</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: example(<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;ilogic&gt; logic , <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;ilogger&gt; logger) : logic_(logic), logger_(logger) { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;ilogic&gt; logic_; <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;ilogger&gt; logger_; };</code> </pre><br></td></tr></tbody></table><br><a name="habracut"></a><br>  Boost.DI is a library for implementing dependency injection in C ++.  To use it, you only need to include one header file in your code.  The purpose of the library is to simplify the creation of objects using automatic dependency injection: <br><ul><li>  Reducing the number of bottlenecks in the code - no extra factories, no creation of objects only in a certain order </li><li>  Simplified code support - changing the constructor signature will not affect the DI configuration </li><li>  Simplify Testing - Automatic Mock Injection </li><li>  Better control over what is created and when </li><li>  Better understanding of code in terms of object hierarchy </li></ul><br><br><table><tbody><tr><th>  Manual dependency injection </th><th>  Boost.DI </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*boilerplate code*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> logic = make_shared&lt;logic&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> logger = make_shared&lt;logger&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> example{logic, logger}.run(); }</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;ilogic, logic&gt; , di::bind&lt;ilogger, logger&gt; ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector.create&lt;example&gt;().run(); }</code> </pre><br></td></tr></tbody></table><br><h4>  Once again - why use dependency injection </h4><br><ul><li>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/motivation.html">Motivation</a> </li><li>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/rationale.html">Rationale</a> </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc9/962/e14/bc9962e14fcd3c47102b09d832221186.jpg" alt="image"><br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/oK_XtfXPkqw%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhgYO6KWVRW2fCWgr493OOya_0EvnA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Where to begin? </h4><br><br><ul><li>  Take a compiler with C ++ 14 support (Clang-3.4 +, GCC-5.0 +).  Boost library not required </li><li>  Read this document. </li><li>  Read the <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/tutorial.html">tutorial</a> </li><li>  Read the <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html">documentation.</a> </li></ul><br><br>  In general, all you need to work with the library is this <a href="">di.hpp</a> file <a href="">.</a> <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// main.cpp #include "di.hpp" int main() { }</span></span></code> </pre><br><br><pre> <code class="bash hljs"> <span class="hljs-variable"><span class="hljs-variable">$CXX</span></span> -std=c++1y -I. main.cpp</code> </pre><br><br>  Let's assume that all the examples below include boost / di.hpp and define di namespace as alias boost :: di. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;boost/di.hpp&gt; namespace di = boost::di; // struct i1 { virtual ~i1() = default; virtual void dummy1() = 0; }; struct i2 { virtual ~i2() = default; virtual void dummy2() = 0; }; struct impl1 : i1 { void dummy1() override { } }; struct impl2 : i2 { void dummy2() override { } }; struct impl : i1, i2 { void dummy1() override { } void dummy2() override { } };</span></span></span></span></code> </pre><br><br><h4><anchor>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/injector.html">Injector</a> </anchor></h4><br><table><tbody><tr><th>  Creating an empty injector </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector();</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(<span class="hljs-number"><span class="hljs-number">0</span></span> == injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;());</code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/bindings.html">Bindings</a> </h4><br>  <a href="">Examples</a> <br>  <a href="">More examples</a> <br><table><tbody><tr><th>  Interface binding to implementation </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector(di::bind&lt;i1, impl1&gt;);</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl1*&gt;(object.get()));</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Binding multiple interfaces to one implementation </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector(di::bind&lt;di::any_of&lt;i1, i2&gt;, impl&gt;);</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object1 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object2 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i2&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl*&gt;(object1.get())); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl*&gt;(object2.get()));</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Type binding to the value calculated at compile time </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> N&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> int_ = integral_constant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, N&gt;; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector(di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, int_&lt;<span class="hljs-number"><span class="hljs-number">42</span></span>&gt;&gt;);</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;());</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Type binding to value </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector(di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>));</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;());</code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/injections.html">Implementation</a> </h4><br>  <a href="">Examples</a> <br>  <a href="">More examples</a> <br><table><tbody><tr><th>  Implementation through the usual constructor </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d) : a(a), d(d) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87.0</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object.d);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementing through aggregation </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87.0</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object.d);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through the designer if available <br>  several constructors (the one with <br>  the largest number of parameters) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(); c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a) : a(a) { } c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d) : a(a), d(d) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87.0</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object.d);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through the designer in the presence of options <br>  selection (using BOOST_DI_INJECT) <br></th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a) : a(a), d(d) { } BOOST_DI_INJECT(c, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d) : a(a), d(d) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87.0</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object.d);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through the designer in the presence of options <br>  selection (using BOOST_DI_INJECT_TRAITS) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT_TRAITS(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>); c(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a) : a(a), d(d) { } c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d) : a(a), d(d) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87.0</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object.d);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through the designer in the presence of options <br>  choice (using di :: ctor_traits) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a) : a(a), d(d) { } c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d) : a(a), d(d) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> boost { <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> di { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctor_traits</span></span></span><span class="hljs-class">&lt;c&gt; {</span></span> BOOST_DI_INJECT_TRAITS(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>); }; }} <span class="hljs-comment"><span class="hljs-comment">// boost::di auto injector = di::make_injector( di::bind&lt;int&gt;.to(42) , di::bind&lt;double&gt;.to(87.0) );</span></span></code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object.d);</code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/annotations.html">Annotations</a> </h4><br>  <a href="">Examples</a> <br><table><tbody><tr><th>  Implementation through annotated constructors </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> int1 = []{}; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> int2 = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT(c , (named = int1) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a , (named = int2) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b) : a(a), b(b) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(int1).to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(int2).to(<span class="hljs-number"><span class="hljs-number">87</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87</span></span> == object.b);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through annotated constructors with <br>  using named parameters </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> n1 = []{}; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> n2 = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT(c , (named = n1) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a , (named = n1) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b , (named = n2) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c , <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> d , (named = n1) <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s) : i1(i1), i2(i2), i3(i3), i4(i4), s(s) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i3 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i4 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> s; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(n1).to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(n2).to(<span class="hljs-number"><span class="hljs-number">87</span></span>) , di::bind&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;.named(n1).to(<span class="hljs-string"><span class="hljs-string">"str"</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.i1); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.i2); assert(<span class="hljs-number"><span class="hljs-number">87</span></span> == object.i3); assert(<span class="hljs-number"><span class="hljs-number">0</span></span> == object.i4); assert(<span class="hljs-string"><span class="hljs-string">"str"</span></span> == cs);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through annotated constructors with <br>  making implementation of the constructor </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> int1 = []{}; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> int2 = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT(c , (named = int1) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a , (named = int2) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; c::c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b) : a(a), b(b) { } <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(int1).to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(int2).to(<span class="hljs-number"><span class="hljs-number">87</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87</span></span> == object.b);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Implementation through annotated constructors with <br>  using di :: ctor_traits </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> int1 = []{}; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> int2 = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b) : a(a), b(b) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> boost { <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> di { <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ctor_traits</span></span></span><span class="hljs-class">&lt;c&gt; {</span></span> BOOST_DI_INJECT_TRAITS( (named = int1) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> , (named = int2) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>); }; }} <span class="hljs-comment"><span class="hljs-comment">// boost::di auto injector = di::make_injector( di::bind&lt;int&gt;.named(int1).to(42) , di::bind&lt;int&gt;.named(int2).to(87) );</span></span></code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.a); assert(<span class="hljs-number"><span class="hljs-number">87</span></span> == object.b);</code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/scopes.html">Scopes</a> </h4><br>  <a href="">Examples</a> <br>  <a href="">More examples</a> <br><br><table><tbody><tr><th>  Display scope (default) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt; sp; <span class="hljs-comment"><span class="hljs-comment">/*singleton*/</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i2&gt; up; <span class="hljs-comment"><span class="hljs-comment">/*unique*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&amp; i; <span class="hljs-comment"><span class="hljs-comment">/*external*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d; <span class="hljs-comment"><span class="hljs-comment">/*unique*/</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> i = <span class="hljs-number"><span class="hljs-number">42</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt; , di::bind&lt;i2, impl2&gt; , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(ref(i)) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87.0</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object1 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;c&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object2 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;c&gt;&gt;(); assert(object1-&gt;sp == object2-&gt;sp); assert(object1-&gt;up != object2-&gt;up); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object1-&gt;i); assert(&amp;i == &amp;object1-&gt;i; assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object2-&gt;i); assert(&amp;i == &amp;object2-&gt;i); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object1-&gt;d); assert(<span class="hljs-number"><span class="hljs-number">87.0</span></span> == object2-&gt;d);</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Type of </th><th>  Derived scope </th></tr><tr><td>  T </td><td>  unique </td></tr><tr><td>  T &amp; </td><td>  error - must be linked as external </td></tr><tr><td>  const T &amp; </td><td>  unique (temporary) </td></tr><tr><td>  T * </td><td>  unique (transfer of ownership) </td></tr><tr><td>  const T * </td><td>  unique (transfer of ownership) </td></tr><tr><td>  T &amp;&amp; </td><td>  unique </td></tr><tr><td>  unique_ptr </td><td>  unique </td></tr><tr><td>  shared_ptr </td><td>  singleton </td></tr><tr><td>  weak_ptr </td><td>  singleton </td></tr></tbody></table><br><table><tbody><tr><th>  Unique scope </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt;.in(di::unique) );</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() != injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() | );</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Shared visibility (within the stream) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt;.in(di::shared) );</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() == injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() | );</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Singleton (shared between streams) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt;.in(di::singleton) );</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() == injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;());</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Scope of session </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> my_session = []{}; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt;.in( di::session(my_session) ) );</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> == injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;()); injector.call(di::session_entry(my_session)); assert(injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() == injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;()); injector.call(di::session_exit(my_session)); assert(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> == injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;());</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Outer scope </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> l = <span class="hljs-number"><span class="hljs-number">42l</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> b = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, int_&lt;<span class="hljs-number"><span class="hljs-number">41</span></span>&gt;&gt; , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;i1&gt;.to(make_shared&lt;impl&gt;()) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>&gt;.to(ref(l)) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>&gt;.to([]{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">87</span></span>;}) , di::bind&lt;i2&gt;.to( [&amp;](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; injector) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i2&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector.<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> create&lt; <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;impl2&gt;&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } ) );</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;()); <span class="hljs-comment"><span class="hljs-comment">// external has priority assert(injector.create&lt;shared_ptr&lt;i1&gt;&gt;() == injector.create&lt;shared_ptr&lt;i1&gt;&gt;() ); assert(l == injector.create&lt;long&amp;&gt;()); assert(&amp;l == &amp;injector.create&lt;long&amp;&gt;()); assert(87 == injector.create&lt;short&gt;()); { auto object = injector.create&lt;shared_ptr&lt;i2&gt;&gt;(); assert(nullptr == object); } { b = true; auto object = injector.create&lt;shared_ptr&lt;i2&gt;&gt;(); assert(dynamic_cast&lt;impl2*&gt;(object.get())); }</span></span></code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Special scope </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">custom_scope</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> priority = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TExpected</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">scope</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TProvider</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">create</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TProvider</span></span></span><span class="hljs-class">&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pr</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;TExpected&gt;{pr.get()}; } }; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt;.in(custom_scope{}) );</code> </pre><br></td><td><pre> <code class="cpp hljs">assert(injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() != injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt;&gt;() );</code> </pre><br></td></tr></tbody></table><br><img src="https://habrastorage.org/files/a6a/f42/963/a6af42963b9f4d319ea28824ec4a94bd.png"><br><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/modules.html">Modules</a> </h4><br>  <a href="">Examples</a> <br><table><tbody><tr><th>  Module </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; i1 , <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i2&gt; i2 , <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i) : i1(move(i1)) , i2(move(i2)), i(i) { } <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; i1; <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i2&gt; i2; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module1</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_injector( di::bind&lt;i1, impl1&gt; , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) ); } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module2</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_injector( di::bind&lt;i2, impl2&gt; ); }; }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( module1{}, module2{} );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;c&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl1*&gt;(object-&gt;i1.get())); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl2*&gt;(object-&gt;i2.get())); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object-&gt;i); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> up1 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl1*&gt;(up1.get())); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> up2 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i2&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl2*&gt;(up2.get()));</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Module opening type </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> c(<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt; i1 , <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i2&gt; i2 , <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i) : i1(i1), i2(i2), i(i) { } <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i1&gt; i1; <span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;i2&gt; i2; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> {</span></span> di::injector&lt;c&gt; configure() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; di::injector&lt;c&gt; <span class="hljs-comment"><span class="hljs-comment">//  c module::configure() const noexcept { return di::make_injector( di::bind&lt;i1, impl1&gt; , di::bind&lt;i2, impl2&gt; , di::bind&lt;int&gt;.to(i) ); } auto injector = di::make_injector( module{42} );</span></span></code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;c&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl1*&gt;(object.i1.get())); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl2*&gt;(object.i2.get())); assert(<span class="hljs-number"><span class="hljs-number">42</span></span> == object.i); <span class="hljs-comment"><span class="hljs-comment">// injector.create&lt;unique_ptr&lt;i1&gt;&gt;() //   // injector.create&lt;unique_ptr&lt;i2&gt;&gt;() //  </span></span></code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  The module that opens several types </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> {</span></span> di::injector&lt;i1, i2&gt; configure() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; di::injector&lt;i1, i2&gt; <span class="hljs-comment"><span class="hljs-comment">//  i1, i2 module::configure() const noexcept { return di::make_injector( di::bind&lt;i1, impl1&gt; , di::bind&lt;i2, impl2&gt; ); } auto injector = di::make_injector( module{} );</span></span></code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> up1 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl1*&gt;(up1.get())); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> up2 = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i2&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl2*&gt;(up2.get()));</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Open type module with annotation </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> my = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT(c , (named = my) <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; up) : up(up) { } <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; up; }; di::injector&lt;i1&gt; <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> = di::make_injector( di::bind&lt;i1, impl1&gt; ); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1&gt;.named(my).to(<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>) );</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> object = injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;c&gt;&gt;(); assert(<span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;impl1*&gt;(object-&gt;up.get()));</code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/providers.html">Providers</a> </h4><br>  <a href="">Examples</a> <br><table><tbody><tr><th>  "No throw" provider </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">heap_no_throw</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TInit</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">direct</span></span></span><span class="hljs-class">()/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uniform</span></span></span><span class="hljs-class">{</span></span>} , <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TMemory</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">heap</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stack</span></span></span><span class="hljs-class"> , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TArgs</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TInit</span></span></span><span class="hljs-class">&amp; , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TMemory</span></span></span><span class="hljs-class">&amp; , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TArgs</span></span></span><span class="hljs-class">&amp;&amp;... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">const</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noexcept</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (nothrow) T{forward&lt;TArgs&gt;(args)...}; } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">my_provider</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> di::config { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> heap_no_throw{}; } };</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   auto injector = di::make_injector&lt;my_provider&gt;(); assert(0 == injector.create&lt;int&gt;()); //   #define BOOST_DI_CFG my_provider auto injector = di::make_injector(); assert(0 == injector.create&lt;int&gt;());</span></span></code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/concepts/policies.html">Politicians</a> </h4><br>  <a href="">Examples</a> <br>  <a href="">More examples</a> <br><table><tbody><tr><th>  Defining configuration policies (dump types) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print_types_policy</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> di::config { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">policies</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_policies( [](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> type){ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> T = <span class="hljs-keyword"><span class="hljs-keyword">decltype</span></span>(type); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> arg = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T::type; <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(arg).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } ); } };</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   auto injector = di::make_injector&lt;print_types_policy&gt;(); injector.create&lt;int&gt;(); // : int //   #define BOOST_DI_CFG my_policy auto injector = di::make_injector(); injector.create&lt;int&gt;(); // : int</span></span></code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Defining configuration policies (detailed type dump) </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print_types_info_policy</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> di::config { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">policies</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_policies( [](<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> type , <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> dep , <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>... ctor) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> T = <span class="hljs-keyword"><span class="hljs-keyword">decltype</span></span>(type); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> arg = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T::type; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> arg_name = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T::name; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> D = <span class="hljs-keyword"><span class="hljs-keyword">decltype</span></span>(dep); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> scope = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> D::scope; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> expected = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> D::expected; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> given = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> D::given; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> name = <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> D::name; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ctor_s = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>...(ctor); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; ctor_s &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(arg).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(arg_name).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(scope).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(expected).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(given).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span> &lt;&lt; <span class="hljs-keyword"><span class="hljs-keyword">typeid</span></span>(name).name() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; ; } ); } };</code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   auto injector = di::make_injector&lt;print_types_info_policy&gt;( di::bind&lt;i1, impl1&gt; ); injector.create&lt;unique_ptr&lt;i1&gt;&gt;(); // : 0 // ctor_size of impl1 unique_ptr&lt;i1&gt; // ctor arg di::no_name // ctor arg name di::deduce // scope i1 // expected impl1 // given no_name // dependency //   #define BOOST_DI_CFG my_policy auto injector = di::make_injector( di::bind&lt;i1, impl1&gt; ); injector.create&lt;unique_ptr&lt;i1&gt;&gt;(); // : 0 // ctor_size of impl1 unique_ptr&lt;i1&gt; // cotr arg di::no_name // ctor arg name di::deduce // scope i1 // expected impl1 // given no_name // dependency</span></span></code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  "Can be constructed" policy </th><th>  Test </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;boost/di/ policies/constructible.hpp&gt; class all_must_be_bound_unless_int : public di::config { public: auto policies() const noexcept { using namespace di::policies; using namespace di::policies::operators; return di::make_policies( constructible( is_same&lt;_, int&gt;{} || is_bound&lt;_&gt;{}) ); } };</span></span></span></span></code> </pre><br></td><td><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   #define BOOST_DI_CFG all_must_be_bound_unless_int assert(0 == di::make_injector().create&lt;int&gt;()); // di::make_injector().create&lt;double&gt;(); //   assert(42.0 == make_injector( di::bind&lt;double&gt;.to(42.0) ).create&lt;double&gt;() );</span></span></code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/performance.html">Runtime performance</a> </h4><br>  <b>Environment</b> <br><ul><li>  x86_64 Intel¬Æ Core (TM) i7-4770 CPU @ 3.40GHz GenuineIntel GNU / Linux </li><li>  clang ++ 3.4 -O2 / gdb -batch -ex 'file ./a.out' -ex 'disassemble main' </li></ul><br><br><table><tbody><tr><th>  Creating a type without bindings </th><th>  Asm x86-64 (same as "return 0") </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); }</code> </pre><br></td><td><pre> <code class="cpp hljs">xor %eax,%eax retq</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Creating a type with object binding </th><th>  Asm x86-64 (same as "return 42") </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); }</code> </pre><br></td><td><pre> <code class="cpp hljs">mov $<span class="hljs-number"><span class="hljs-number">0x2a</span></span>,%eax retq</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Create Named Type </th><th>  Asm x86-64 (same as "return 42") </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> my_int = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT(c , (named = my_int) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i) : i(i) { } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.named(my_int).to(<span class="hljs-number"><span class="hljs-number">42</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> injector.create&lt;c&gt;().i; }</code> </pre><br></td><td><pre> <code class="cpp hljs">mov $<span class="hljs-number"><span class="hljs-number">0x2a</span></span>,%eax retq</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Creating an interface binding to the implementation </th><th>  Asm x86-64 (same as make_unique) </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;i1, impl1&gt; ); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ptr = injector.create&lt; <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr.get() != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; }</code> </pre><br></td><td><pre> <code class="cpp hljs">push %rax mov $<span class="hljs-number"><span class="hljs-number">0x8</span></span>,%edi callq <span class="hljs-number"><span class="hljs-number">0x4007b0</span></span> &lt;_Znwm@plt&gt; movq $<span class="hljs-number"><span class="hljs-number">0x400a30</span></span>,(%rax) mov $<span class="hljs-number"><span class="hljs-number">0x8</span></span>,%esi mov %rax,%rdi callq <span class="hljs-number"><span class="hljs-number">0x400960</span></span> &lt;_ZdlPvm&gt; mov $<span class="hljs-number"><span class="hljs-number">0x1</span></span>,%eax pop %rdx retq</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Creating an interface binding through a module </th><th>  Asm x86-64 (same as make_unique) </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_injector( di::bind&lt;i1, impl1&gt; ); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>{} ); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ptr = injector.create&lt; <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; }</code> </pre><br></td><td><pre> <code class="cpp hljs">push %rax mov $<span class="hljs-number"><span class="hljs-number">0x8</span></span>,%edi callq <span class="hljs-number"><span class="hljs-number">0x4007b0</span></span> &lt;_Znwm@plt&gt; movq $<span class="hljs-number"><span class="hljs-number">0x400a10</span></span>,(%rax) mov $<span class="hljs-number"><span class="hljs-number">0x8</span></span>,%esi mov %rax,%rdi callq <span class="hljs-number"><span class="hljs-number">0x400960</span></span> &lt;_ZdlPvm&gt; mov $<span class="hljs-number"><span class="hljs-number">0x1</span></span>,%eax pop %rdx retq</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Creating an interface binding through an open module </th><th>  Asm x86-64 <br>  price = virtual method call </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> {</span></span> di::injector&lt;i1&gt; configure() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_injector( di::bind&lt;i1, impl1&gt; ); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>{} ); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ptr = injector.create&lt; <span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt; &gt;(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ptr != <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; }</code> </pre><br></td><td><pre> <code class="cpp hljs">push %<span class="hljs-function"><span class="hljs-function">rbp </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function">,%ecx push %rbx lea -0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rcx)</span></span></span><span class="hljs-function">,%edx sub $0x38,%rsp mov %edx,</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> lea 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x10</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%rdi cmp $0x1,%ecx lea 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%rsi jne 0x400bcd &lt;main+173&gt; callq 0x400bf0 &lt;_ZN5boost2di7exposed&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rbx)</span></span></span><span class="hljs-function">,%rax mov 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x18</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%rdi mov %rbx,%rdi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rdi)</span></span></span><span class="hljs-function">,%rax callq *0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x10</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> lea 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%rsi lea 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rbx)</span></span></span><span class="hljs-function">,%rax callq *0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x10</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> mov $0x0,%ecx test %rax,%rax test %rcx,%rcx setne %bpl je 0x400bb8 &lt;main+152&gt; je 0x400b57 &lt;main+55&gt; mov $0xffffffff,%ecx </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function">,%rcx lock xadd %ecx,</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> mov %rax,%rdi mov %ecx,0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function"> callq *0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rcx)</span></span></span><span class="hljs-function"> mov 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%ecx mov 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x20</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%rbx jmp 0x400bbf &lt;main+159&gt; test %rbx,%rbx </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function">,%ecx je 0x400bcd &lt;main+173&gt; lea -0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rcx)</span></span></span><span class="hljs-function">,%edx lea 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x8</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rbx)</span></span></span><span class="hljs-function">,%rax mov %edx,</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> mov $0x0,%ecx cmp $0x1,%ecx test %rcx,%rcx jne 0x400bcd &lt;main+173&gt; je 0x400b82 &lt;main+98&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mov</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rbx)</span></span></span><span class="hljs-function">,%rax mov $0xffffffff,%ecx mov %rbx,%rdi lock xadd %ecx,</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> callq *0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x18</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rax)</span></span></span><span class="hljs-function"> mov %ecx,0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function"> movzbl %bpl,%eax mov 0</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x30</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(%rsp)</span></span></span><span class="hljs-function">,%ecx add $0x38,%rsp jmp 0x400b89 &lt;main+105&gt; pop %rbx pop %rbp --&gt; retq</span></span></code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/performance.html">Performance at compile time</a> </h4><br>  <a href="">Example</a> <br><br>  <b>Environment</b> <br><ul><li>  x86_64 Intel¬Æ Core (TM) i7-4770 CPU @ 3.40GHz GenuineIntel GNU / Linux </li><li>  clang ++ 3.4 -O2 </li></ul><br><br><table><tbody><tr><th>  Header file Boost.DI </th><th>  Time [sec] </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;boost/di.hpp&gt; int main() { }</span></span></span></span></code> </pre><br></td><td>  0.165 <br></td></tr></tbody></table><br>  <b>Legend</b> <br><ul><li>  ctor = naked constructor: c (int i, double d); </li><li>  inject = implementation into constructor: BOOST_DI_INJECT (c, int i, double d); </li><li>  all = all types in the module are available: auto configure (); </li><li>  exposed = one type in the module is available: di :: injector &lt;c&gt; configure (); </li></ul><br><br><img src="https://habrastorage.org/files/baf/966/51e/baf96651eab0490bae5325e92683918f.png"><br><ul><li>  4248897537 objects created </li><li>  132 different types </li><li>  10 modules </li></ul><br><br><img src="https://habrastorage.org/files/263/2a2/f7e/2632a2f7eea24a7996dbe131b2d25e2b.png"><br><ul><li>  1862039751439806464 object created </li><li>  200 different types </li><li>  10 modules </li></ul><br><br><img src="https://habrastorage.org/files/00f/7c4/baf/00f7c4bafe9d438b88351bf6913f734d.png"><br><ul><li>  5874638529236910091 object created </li><li>  310 different types </li><li>  100 different interfaces </li><li>  10 modules </li></ul><br><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/diagnostic_messages.html">Diagnostic messages</a> </h4><br><table><tbody><tr><th>  Creating an interface without reference to the implementation </th><th>  Error message </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector(); injector.create&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;i1&gt;&gt;();</code> </pre><br></td><td><pre> <code class="cpp hljs">error: allocating an object of abstract <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i1</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nothrow</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">{</span></span>forward&lt;TArgs&gt;(args)...};</code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Binding ambiguity </th><th>  Error message </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector( di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">42</span></span>) , di::bind&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;.to(<span class="hljs-number"><span class="hljs-number">87</span></span>) ); injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;();</code> </pre><br></td><td><pre> <code class="cpp hljs">error: base <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;int, no_name&gt;' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">specified</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">more</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">than</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">once</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">as</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">direct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">base</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span></span></code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Creating an object without bindings <br>  with policies requiring them </th><th>  Error message </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">all_bound</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> di::config { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">policies</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">noexcept</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> di::make_policies( constructible(is_bound&lt;_&gt;{}) ); } }; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> injector = di::make_injector&lt;all_bound&gt;(); injector.create&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;();</code> </pre><br></td><td><pre> <code class="cpp hljs">error: <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span> failed <span class="hljs-string"><span class="hljs-string">"Type T is not allowed"</span></span></code> </pre><br></td></tr></tbody></table><br><table><tbody><tr><th>  Invalid annotation syntax <br>  (NAMED instead of named) </th><th>  Error message </th></tr><tr><td><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> name = []{}; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">c</span></span></span><span class="hljs-class"> {</span></span> BOOST_DI_INJECT(c , (NAMED = name) <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) { } }; di::make_injector().create&lt;c&gt;();</code> </pre><br></td><td><pre> <code class="cpp hljs">error: use of undeclared identifier <span class="hljs-string"><span class="hljs-string">'named'</span></span></code> </pre><br></td></tr></tbody></table><br><h4>  <a href="http://krzysztof-jusiak.github.io/di/cpp14/boost/libs/di/doc/html/di/overview.html">Configuration</a> </h4><br><table><tbody><tr><th>  Macro </th><th>  Description </th></tr><tr><td><pre> <code class="cpp hljs">BOOST_DI_CFG_CTOR_LIMIT_SIZE ---------------------------------------- BOOST_DI_CFG ---------------------------------------- BOOST_DI_INJECTOR</code> </pre><br></td><td><pre> <code class="cpp hljs">       [<span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-number"><span class="hljs-number">-10</span></span>, - <span class="hljs-number"><span class="hljs-number">10</span></span>] ----------------------------------------  ,      ---------------------------------------- ,   Boost.DI     [- boost_di_injector__]</code> </pre><br></td></tr></tbody></table><br><h4>  Related Libraries </h4><br><ul><li>  C ++ |  <a href="https://bitbucket.org/cheez/dicpp">dicpp</a> |  <a href="https://github.com/google/fruit">Fruit</a> </li><li>  Java |  <a href="https://github.com/google/dagger">Dagger 2</a> |  <a href="https://github.com/google/guice">Guice</a> </li><li>  C # |  <a href="http://www.ninject.org/">Ninject</a> </li></ul><br><br>  License: <a href="http://www.boost.org/LICENSE_1_0.txt">Boost Software License, Version 1.0</a> <br>  Nuance: the library is not yet included in Boost, but is only in the " <a href="http://rrsd.com/blincubator.com/alphabetically/">incubator</a> ". </div><p>Source: <a href="https://habr.com/ru/post/248879/">https://habr.com/ru/post/248879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248867/index.html">Interview: CISSP, CISA, SecurityPlus and other words that only IT security experts can understand</a></li>
<li><a href="../248869/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ144 (January 19 - 25, 2015)</a></li>
<li><a href="../248871/index.html">Runscript - utility to run python scripts</a></li>
<li><a href="../248873/index.html">Skyforge rendering technology</a></li>
<li><a href="../248875/index.html">Meteor. And now loading photos</a></li>
<li><a href="../248881/index.html">Overview Friendly interactive shell (fish) and why it is better than bash</a></li>
<li><a href="../248887/index.html">Hacking a bitcoin exchange on Rails</a></li>
<li><a href="../248889/index.html">‚ÄúOpen Financial Data: Possibilities for Using It‚Äù</a></li>
<li><a href="../248891/index.html">Do not rush to throw out the old servers, you can assemble fast Ethernet-storage in an hour</a></li>
<li><a href="../248893/index.html">Practice "Intel IoT". Galileo Gen2 - Linux & Arduino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>