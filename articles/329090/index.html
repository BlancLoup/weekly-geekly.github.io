<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Evil lives in comparison functions.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Readers may remember my article entitled The Last Line Effect. It deals with the pattern I noticed: the error is most often allowed in the last line o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Evil lives in comparison functions.</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aab/470/783/aab470783a9ba1903260167fc424cc73.png" alt="Evil in comparison functions"></div><br>  Readers may remember my article entitled The Last Line Effect.  It deals with the pattern I noticed: the error is most often allowed in the last line of the same type blocks of text.  Now I want to tell about the new interesting observation.  It turns out that programmers make a mistake in comparing two objects.  Such a statement seems implausible, however, I will show a huge number of examples of errors that shock the reader.  Read the new study, it will be interesting and scary. <br><a name="habracut"></a><br><h2>  Problematics </h2><br>  I argue that programmers very often make mistakes in fairly simple functions that are designed to compare two objects.  This statement is based on the experience of our team checking a large number of open source projects in C, C ++ and C #. <br><br>  The functions in question are such names as <i>IsEqual</i> , <i>Equals</i> , <i>Compare</i> , <i>AreEqual,</i> and so on.  Or overloaded operators such as <i>==,!</i> <i>=</i> . <br><br>  I noticed that when writing <a href="https://www.viva64.com/ru/inspections/">articles</a> I very often come across errors related to comparison functions.  I decided to investigate this issue in more detail and studied the <a href="https://www.viva64.com/ru/examples/">base of</a> the errors we found.  For this, the database was searched for functions with names containing the words <i>Cmp</i> , <i>Equal</i> , <i>Compare,</i> and so on.  The result was very impressive and shocking. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, this story is similar to writing the article "Last line effect."  Similarly, I noticed an anomaly and decided to study it in more detail.  Unfortunately, in contrast to the mentioned article, I do not know what numbers and statistics to give me.  Probably, I will think up: how and what can be counted - later.  Now, I am guided by intuition and can only share my feelings.  They say that there are many errors in the comparison functions, and I am sure that you will have the same feeling when I show a large number of impressive examples. <br><br><h2>  Psychology </h2><br>  For a moment, back to the article " <a href="https://www.viva64.com/ru/b/0260/">The effect of the last line</a> ."  By the way, if you have not read it, then I suggest to pause and get to know it.  There is a more detailed analysis of this topic: " <a href="https://www.viva64.com/ru/b/0485/">Explanation of the effect of the last line</a> ." <br><br>  In general, it can be concluded that the cause of the errors in the last lines is due to the fact that the developer has already mentally moved to the next lines / tasks, instead of focusing on the completion of the current fragment.  As a result, at the end of writing the same type of text blocks in the last of them, it is more likely to make a typo than the previous ones. <br><br>  I believe that in the case of writing the comparison function, the developer in general often does not focus on it, considering it trivial.  In other words, he writes code automatically, without thinking about it.  Otherwise, it is not clear how you can make a similar error: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsLuidsEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LUID luid1, LUID luid2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (luid1.LowPart == luid2.LowPart) &amp;&amp; (luid2.HighPart == luid2.HighPart); }</code> </pre> <br>  The PVS-Studio analyzer detected this error in the code of the project <b>RunAsAdmin Explorer Shim</b> (C ++): <a href="http://www.viva64.com/ru/w/V501/">V501</a> == 'operator: luid2.HighPart == luid2.HighPart RAACommon raacommonfuncs. cpp 1511 <br><br>  A typo.  The second line should read: <i>luid1.HighPart == luid2.HighPart</i> . <br><br>  Agree, the code is simple.  Apparently, the simplicity of the code just spoils everything.  The programmer immediately perceives the task of writing such a function as standard and uninteresting.  He instantly decides in his head how to write a function, and all that remains is to implement the code.  This is a routine, but unfortunately, necessary process in order to proceed to writing more important, complex and interesting code.  Thoughts the developer is already there and ... as a result - makes a mistake. <br><br>  In addition, programmers rarely write unit tests for such functions.  Again the deceptive simplicity of these functions fails.  It seems excessive to test them, because these functions are so simple and of the same type.  A man wrote hundreds of such functions in his life, can he really make a mistake in another function ?!  Maybe it does. <br><br>  At the same time I want to note that this article is not about the code of students who learn to program.  We are talking about errors in the code of such projects as GCC, Qt, GDB, LibreOffice, Unreal Engine 4, CryEngine V, Chromium, MongoDB, Oracle VM Virtual Box, FreeBSD, WinMerge, CoreCLR, MySQL, Mono, CoreFX, Roslyn, MSBuild and etc.  Everything is very serious. <br><br>  I will show you so many different examples that you will be scared to go to bed. <br><br><h2>  Error patterns in comparison functions </h2><br>  All errors in the comparison functions will be divided into several patterns.  The article deals with errors in projects in the C, C ++ and C # languages, but it makes no sense to separate these languages, since many patterns are the same for different languages. <br><br><h3>  Pattern: A &lt;B, B&gt; A </h3><br>  Very often in the comparison functions it is necessary to perform such checks: <br><br><ul><li>  A &lt;b </li><li>  A&gt; B </li></ul><br>  Sometimes programmers find it more beautiful to use the same &lt;operator, but swap the variable names: <br><br><ul><li>  A &lt;b </li><li>  B &lt;A </li></ul><br>  However, due to carelessness, such checks are obtained: <br><br><ul><li>  A &lt;b </li><li>  B&gt; a </li></ul><br>  In fact, the same comparison is performed here twice.  Perhaps you did not understand what was going on, but now we turn to practical examples, and everything will become clearer. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span> _server; .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&lt;( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ServerAndQuery&amp; other ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! _orderObject.isEmpty() ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _orderObject.woCompare( other._orderObject ) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _server &lt; other._server ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( other._server &gt; _server ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _extra.woCompare( other._extra ) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  The PVS-Studio analyzer detected this error in the code of the <b>MongoDB</b> project ( ++): <a href="http://www.viva64.com/ru/w/V581/">V581</a>  Check lines: 44, 46. parallel .h 46 <br><br>  This condition: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( other._server &gt; _server )</code> </pre> <br>  It will always be false, since the exact same check was carried out two lines above.  The correct code is: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( _server &lt; other._server ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( other._server &lt; _server ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br>  Such an error is also detected in the <b>Chromium</b> (C ++) project code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ContentSettingsType; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntryMapKey</span></span></span><span class="hljs-class"> {</span></span> ContentSettingsType content_type; ... }; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> OriginIdentifierValueMap::EntryMapKey::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&lt;( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OriginIdentifierValueMap::EntryMapKey&amp; other) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (content_type &lt; other.content_type) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (other.content_type &gt; content_type) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (resource_identifier &lt; other.resource_identifier); }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V517/">warning</a> : <a href="http://www.viva64.com/ru/w/V517/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 61, 63. browser content_settings_origin_identifier_value_map.cc 61 <br><br>  I showed an example in C ++, now it's C #.  The following error was found in the <b>IronPython and IronRuby</b> (C #) code. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SourceLocation left, SourceLocation right)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (left &lt; right) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (right &gt; left) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  PVS-Studio (C #) <a href="http://www.viva64.com/ru/w/V3021/">warning</a> : <a href="http://www.viva64.com/ru/w/V3021/">V3021</a> There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains method return.  This means that the statement is senseless.  SourceLocation.cs 156 <br><br>  I think the explanation is superfluous. <br><br>  Note.  For C # there is only one example of error, and for C ++ there were 2. In general, errors for C # code in the article will be shown less than for C / C ++.  However, I do not recommend rushing to the conclusion that C # is much safer.  The fact is that the PVS-Studio analyzer has learned to analyze C # code relatively recently, and we just checked a lot less projects written in C # than in C and C ++. <br><br><h3>  Pattern: class member compares with itself </h3><br>  Comparison functions often consist of successive comparisons of structure / class fields.  Such a code leads to errors when a member of the class begins to compare with itself.  In this case, two subspecies of error can be distinguished. <br><br>  In the first case, they forget to specify the name of the object and write like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_x == foo.m_x &amp;&amp; m_y == m_y &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= m_z == foo.m_z;</span></span></code> </pre> <br>  In the second case, they write the same object name: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> zzz.m_x == foo.m_x &amp;&amp; zzz.m_y == zzz.m_y &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= zzz.m_z == foo.m_z;</span></span></code> </pre> <br>  Let's now get acquainted with this pattern of errors in practice.  By the way, note that the incorrect comparison is often found in the last of the same type of text blocks: hello "last line effect". <br><br>  Error found in <b>Unreal Engine 4</b> (C ++) project code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> FPooledRenderTargetDesc&amp; rhs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bExact)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Extent == rhs.Extent &amp;&amp; Depth == rhs.Depth &amp;&amp; bIsArray == rhs.bIsArray &amp;&amp; ArraySize == rhs.ArraySize &amp;&amp; NumMips == rhs.NumMips &amp;&amp; NumSamples == rhs.NumSamples &amp;&amp; Format == rhs.Format &amp;&amp; LhsFlags == RhsFlags &amp;&amp; TargetableFlags == rhs.TargetableFlags &amp;&amp; bForceSeparateTargetAndShaderResource == rhs.bForceSeparateTargetAndShaderResource &amp;&amp; ClearValue == rhs.ClearValue &amp;&amp; AutoWritable == AutoWritable; <span class="hljs-comment"><span class="hljs-comment">// &lt;= }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: AutoWritable == AutoWritable rendererinterface.h 180 <br><br>  <b>Samba</b> project code (C): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare_procids</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *p1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *p2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server_id</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i1</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server_id</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p1</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server_id</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">i2</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server_id</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p2</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i1-&gt;pid &lt; i2-&gt;pid) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i2-&gt;pid &gt; i2-&gt;pid) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: i2-&gt; pid&gt; i2-&gt; pid brlock.c 1901 <br><br>  <b>MongoDB</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MemberCfg&amp; r) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _id==r._id &amp;&amp; votes == r.votes &amp;&amp; h == rh &amp;&amp; priority == r.priority &amp;&amp; arbiterOnly == r.arbiterOnly &amp;&amp; slaveDelay == r.slaveDelay &amp;&amp; hidden == r.hidden &amp;&amp; buildIndexes == buildIndexes; <span class="hljs-comment"><span class="hljs-comment">// &lt;= }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: buildIndexes == buildIndexes rs_config.h 101 <br><br>  <b>Geant4 Software</b> Project <b>Code</b> (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> G4bool G4FermiIntegerPartition:: <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> G4FermiIntegerPartition&amp; right) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (total == right.total &amp;&amp; enableNull == enableNull &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= partition == right.partition); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: enableNull == enableNull G4hadronic_deex_fermi_breakup g4fermiintegerpartition.icc 58 <br><br>  <b>LibreOffice</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SvgGradientEntry</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SvgGradientEntry&amp; rCompare) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (getOffset() == rCompare.getOffset() &amp;&amp; getColor() == getColor() <span class="hljs-comment"><span class="hljs-comment">// &lt;= &amp;&amp; getOpacity() == getOpacity()); // &lt;= } .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: getColor () == getColor () svggradientprimitive2d.hxx 61 <br><br>  <b>Chromium</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FileIOTest::MatchesResult(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TestStep&amp; a, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TestStep&amp; b) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (a.data_size == a.data_size &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= std::equal(a.data, a.data + a.data_size, b.data)); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: a.data_size == a.data_size cdm_file_io_test.cc 367 <br><br>  <b>FreeCAD</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FaceTypedBSpline::isEqual(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TopoDS_Face &amp;faceOne, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TopoDS_Face &amp;faceTwo) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (surfaceOne-&gt;IsURational() != surfaceTwo-&gt;IsURational()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (surfaceTwo-&gt;IsVRational() != <span class="hljs-comment"><span class="hljs-comment">// &lt;= surfaceTwo-&gt;IsVRational()) // &lt;= return false; if (surfaceOne-&gt;IsUPeriodic() != surfaceTwo-&gt;IsUPeriodic()) return false; if (surfaceOne-&gt;IsVPeriodic() != surfaceTwo-&gt;IsVPeriodic()) return false; if (surfaceOne-&gt;IsUClosed() != surfaceTwo-&gt;IsUClosed()) return false; if (surfaceOne-&gt;IsVClosed() != surfaceTwo-&gt;IsVClosed()) return false; if (surfaceOne-&gt;UDegree() != surfaceTwo-&gt;UDegree()) return false; if (surfaceOne-&gt;VDegree() != surfaceTwo-&gt;VDegree()) return false; .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions 'surfaceTwo-&gt; IsVRational ()' to the left!  modelrefine.cpp 780 <br><br>  <b>Serious Engine</b> Project Code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CTexParams</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CTexParams tp)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tp_iFilter == tp.tp_iFilter &amp;&amp; tp_iAnisotropy == tp_iAnisotropy &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= tp_eWrapU == tp.tp_eWrapU &amp;&amp; tp_eWrapV == tp.tp_eWrapV; }; .... };</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator: tp_iAnisotropy == tp_iAnisotropy gfx_wrapper.h 180 <br><br>  <b>Qt</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">qCompare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QImage </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;t1, QImage </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp;t2, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t1.width() != t2.width() || t2.height() != t2.height()) { .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501 there is no need for a</a> '! =' Operator: t2.height ()! = T2.height () qtest_gui.h 101 <br><br>  <b>FreeBSD</b> Project Code (C): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare_sh</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *_a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *_b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ipfw_sopt_handler</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">, *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">b</span></span></span><span class="hljs-class">;</span></span> a = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> struct ipfw_sopt_handler *)_a; b = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> struct ipfw_sopt_handler *)_b; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>)a-&gt;handler &lt; (<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>)b-&gt;handler) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>)b-&gt;handler &gt; (<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>)b-&gt;handler) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return (1); return (0); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions '(uintptr_t) b-&gt; handler' to the left.  ip_fw_sockopt.c 2893 <br><br>  Project code <b>Mono</b> (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AreEqual</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VisualStyleElement value1, VisualStyleElement value2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value1.ClassName == value1.ClassName &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= value1.Part == value2.Part &amp;&amp; value1.State == value2.State; }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3001/">warning</a> : <a href="http://www.viva64.com/ru/w/V3001/">V3001</a> There are identical sub-expressions 'value1.ClassName' to the left.  ThemeVisualStyles.cs 2141 <br><br>  Project code <b>Mono</b> (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExactInference</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TypeSpec u, TypeSpec v)</span></span></span><span class="hljs-function"> </span></span>{ .... var ac_u = (ArrayContainer) u; var ac_v = (ArrayContainer) v; .... var ga_u = u.TypeArguments; var ga_v = v.TypeArguments; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (u.TypeArguments.Length != u.TypeArguments.Length) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return 0; .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3001/">warning</a> : <a href="http://www.viva64.com/ru/w/V3001/">V3001</a> There are identical sub-expressions 'u.TypeArguments.Length' to the left and the right!  generic.cs 3135 <br><br>  <b>MonoDevelop</b> project code (C #): <br><br><pre> <code class="cpp hljs">Accessibility DeclaredAccessibility { get; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsStatic { get; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MembersMatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ISymbol member1, ISymbol member2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (member1.Kind != member2.Kind) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (member1.DeclaredAccessibility != <span class="hljs-comment"><span class="hljs-comment">// &lt;=1 member1.DeclaredAccessibility // &lt;=1 || member1.IsStatic != member1.IsStatic) // &lt;=2 { return false; } if (member1.ExplicitInterfaceImplementations().Any() || member2.ExplicitInterfaceImplementations().Any()) { return false; } return SignatureComparer .HaveSameSignatureAndConstraintsAndReturnTypeAndAccessors( member1, member2, this.IsCaseSensitive); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3001/">warning</a> : <a href="http://www.viva64.com/ru/w/V3001/">V3001</a> There are identical sub-expressions of "member1.IsStatic" to the left!  CSharpBinding AbstractImplementInterfaceService.CodeAction.cs 545 <br><br>  <b>Haiku</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">CORTEX_NAMESPACE__ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareTypeAndID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> retValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lJack &amp;&amp; rJack) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lJack-&gt;m_jackType &lt; lJack-&gt;m_jackType) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { return -1; } if (lJack-&gt;m_jackType == lJack-&gt;m_jackType) // &lt;= { if (lJack-&gt;m_index &lt; rJack-&gt;m_index) { return -1; } else { return 1; } } else if (lJack-&gt;m_jackType &gt; rJack-&gt;m_jackType) { retValue = 1; } } return retValue; }</span></span></code> </pre> <br>  PVS-Studio Warning: <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are no '&lt;operator: lJack-&gt; m_jackType &lt;lJack-&gt; m_jackType MediaJack.cpp 783 <br><br>  Below, there is another exact error.  As I understand it, in both cases they forgot to replace <i>lJack</i> with <i>rJack</i> . <br><br>  <b>CryEngine V</b> (C ++) project code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareRotation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Quat&amp; q1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Quat&amp; q2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> epsilon)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (fabs_tpl(q1.vx - q2.vx) &lt;= epsilon) &amp;&amp; (fabs_tpl(q1.vy - q2.vy) &lt;= epsilon) &amp;&amp; (fabs_tpl(q2.vz - q2.vz) &lt;= epsilon) <span class="hljs-comment"><span class="hljs-comment">// &lt;= &amp;&amp; (fabs_tpl(q1.w - q2.w) &lt;= epsilon); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> operator - q: vz - q2.vz entitynode.cpp 93 <br><br><h3>  Pattern: calculating pointer size instead of structure / class size </h3><br>  This type of error occurs in programs in C and C ++ languages ‚Äã‚Äãand is associated with improper use of the <i>sizeof</i> operator.  The error is not calculating the size of the object, but the size of the pointer.  Example: <br><br><pre> <code class="cpp hljs">T *a = foo1(); T *b = foo2(); x = <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(a, b, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(a));</code> </pre> <br>  Instead of the size of the structure <i>T</i> , the size of the pointer is calculated.  The size of the pointer depends on <a href="https://www.viva64.com/ru/t/0012/">the data model used</a> , but usually it is 4 or 8 bytes.  As a result, more or less bytes of memory are compared than the structure takes. <br><br>  The correct code is: <br><br><pre> <code class="cpp hljs">x = <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(a, b, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T));</code> </pre> <br>  or <br><br><pre> <code class="cpp hljs">x = <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(a, b, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*a));</code> </pre> <br>  Now let's get to practice.  Here is how this error looks in the code of the <b>CryEngine V</b> (C ++) project: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SComputePipelineStateDescription&amp; other) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> == <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, &amp;other, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V579/">warning</a> : <a href="http://www.viva64.com/ru/w/V579/">V579</a>  It is possibly a mistake.  Inspect the third argument.  graphicspipelinestateset.h 58 <br><br>  <b>Unreal Engine 4</b> (C ++) project code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> FRecastQueryFilter::IsEqual( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> INavigationQueryFilterInterface* Other) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-comment"><span class="hljs-comment">// @</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">NOTE:</span></span></span><span class="hljs-comment"> not type safe, should be changed when // another filter type is introduced return FMemory::Memcmp(this, Other, sizeof(this)) == 0; }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V579/">warning</a> : <a href="http://www.viva64.com/ru/w/V579/">V579</a> .  It is possibly a mistake.  Inspect the third argument.  pimplrecastnavmesh.cpp 172 <br><br><h3>  Pattern: Duplicate arguments of the form Cmp (A, A) </h3><br>  Comparison functions often call other comparison functions.  In this case, one of the possible errors is that the link / pointer to the same object is transmitted twice.  Example: <br><br><pre> <code class="cpp hljs">x = <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(A, A, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T));</code> </pre> <br>  Here object <i>A</i> will be compared with itself, which, naturally, does not make sense. <br><br>  We begin with the error found in the <b>GDB</b> (C) debugger code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">psymbol_compare</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *addr1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *addr2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial_symbol</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sym1</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial_symbol</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addr1</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial_symbol</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sym2</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">partial_symbol</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addr2</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span> (&amp;sym1-&gt;ginfo.value, &amp;sym1-&gt;ginfo.value, <span class="hljs-comment"><span class="hljs-comment">// &lt;= sizeof (sym1-&gt;ginfo.value)) == 0 &amp;&amp; sym1-&gt;ginfo.language == sym2-&gt;ginfo.language &amp;&amp; PSYMBOL_DOMAIN (sym1) == PSYMBOL_DOMAIN (sym2) &amp;&amp; PSYMBOL_CLASS (sym1) == PSYMBOL_CLASS (sym2) &amp;&amp; sym1-&gt;ginfo.name == sym2-&gt;ginfo.name); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V549/">warning</a> : <a href="http://www.viva64.com/ru/w/V549/">V549</a> The first argument of the memcmp function is equal to the second argument.  psymtab.c 1580 <br><br>  <b>CryEngineSDK</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> != (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEfResTexture &amp;m) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stricmp(m_Name.c_str(), m_Name.c_str()) != <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-comment"><span class="hljs-comment">// &lt;= m_TexFlags != m.m_TexFlags || m_bUTile != m.m_bUTile || m_bVTile != m.m_bVTile || m_Filter != m.m_Filter || m_Ext != m.m_Ext || m_Sampler != m.m_Sampler) return true; return false; }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V549/">warning</a> : <a href="http://www.viva64.com/ru/w/V549/">V549</a> The first argument of the 'stricmp' function is equal to the second argument.  ishader.h 2089 <br><br>  <b>PascalABC.NET</b> project code (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; enum_consts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SymScope ts)</span></span></span><span class="hljs-function"> </span></span>{ EnumScope es = ts as EnumScope; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (es == null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (enum_consts.Count != es.enum_consts.Count) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; es.enum_consts.Count; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Compare(enum_consts[i], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enum_consts[i], <span class="hljs-literal"><span class="hljs-literal">true</span></span>) != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3038/">warning</a> : <a href="http://www.viva64.com/ru/w/V3038/">V3038</a> The 'enum_consts [i]' argument was passed to the 'Compare' method several times.  It can be passed.  CodeCompletion SymTable.cs 2206 <br><br>  Here I will explain a little.  Error in the actual arguments of the <i>Compare</i> function: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Compare(enum_consts[i], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enum_consts[i], <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br>  The fact is that <i>enum_consts [i]</i> and <i>this.enum_consts [i]</i> are the same.  As I understand it, the correct call should be like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Compare(es.enum_consts[i], <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.enum_consts[i], <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br>  or <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Compare(enum_consts[i], es.enum_consts[i], <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br><h3>  Pattern: Duplicate checks A == B &amp;&amp; A == B </h3><br>  <a href="https://www.viva64.com/ru/examples/V501/">A common</a> programming error is when the same check is performed twice.  Example: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> A == B &amp;&amp; C == D &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= C == D &amp;&amp; // &lt;= E == F;</span></span></code> </pre> <br>  In such cases, there are 2 options.  The first is harmless: one comparison is superfluous, and you can just delete it.  The second is worse: they wanted to check some other variables, but they were sealed. <br><br>  In any case, this code deserves close attention.  Let me scare you harder and show that such an error can be found even in the <b>GCC</b> compiler code (C): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dw_val_equal_p</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dw_val_node *a, dw_val_node *b)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> dw_val_class_vms_delta: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span> (a-&gt;v.val_vms_delta.lbl1, b-&gt;v.val_vms_delta.lbl1) &amp;&amp; !<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span> (a-&gt;v.val_vms_delta.lbl1, b-&gt;v.val_vms_delta.lbl1)); .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions '! Strcmp (a-&gt; v.val_vms_delta.lbl1, b-&gt; v.val_vms_delta.lbl1)' the operator.  dwarf2out.c 1428 <br><br>  The <i>strcmp</i> function is called <i>twice</i> with the same set of arguments. <br><br>  <b>Unreal Engine 4</b> (C ++) project code: <br><br><pre> <code class="cpp hljs">FORCEINLINE <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FShapedGlyphEntryKey&amp; Other) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FontFace == Other.FontFace &amp;&amp; GlyphIndex == Other.GlyphIndex <span class="hljs-comment"><span class="hljs-comment">// &lt;= &amp;&amp; FontSize == Other.FontSize &amp;&amp; FontScale == Other.FontScale &amp;&amp; GlyphIndex == Other.GlyphIndex; // &lt;= }</span></span></code> </pre> <br>  Warning PVS-Studio: <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions 'GlyphIndex == Other.GlyphIndex' operator.  fontcache.h 139 <br><br>  <b>Serious Engine</b> Project Code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> BOOL CValuesForPrimitive::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(....) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( (....) &amp;&amp; (vfp_ptPrimitiveType == vfpToCompare.vfp_ptPrimitiveType) &amp;&amp; .... (vfp_ptPrimitiveType == vfpToCompare.vfp_ptPrimitiveType) &amp;&amp; .... );</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V501/">warning</a> : <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions '(vfp_ptPrimitiveType == vfpToCompare.vfp_ptPrimitiveType)' operator.  worldeditor.h 580 <br><br>  <b>Oracle VM Virtual Box</b> (C ++) Project Code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SCMDIFFSTATE</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fIgnoreTrailingWhite; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fIgnoreLeadingWhite; .... } SCMDIFFSTATE; <span class="hljs-comment"><span class="hljs-comment">/* Pointer to a diff state. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> SCMDIFFSTATE *PSCMDIFFSTATE; <span class="hljs-comment"><span class="hljs-comment">/* Compare two lines */</span></span> DECLINLINE(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>) scmDiffCompare(PSCMDIFFSTATE pState, ....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pState-&gt;fIgnoreTrailingWhite <span class="hljs-comment"><span class="hljs-comment">// &lt;= || pState-&gt;fIgnoreTrailingWhite) // &lt;= return scmDiffCompareSlow(....); .... }</span></span></code> </pre> <br>  PVS-Studio Warning: <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions 'pState-&gt; fIgnoreTrailingWhite' to the left and the right of the '||'  operator.  scmdiff.cpp 238 <br><br><h3>  Pattern: incorrect use of the value returned by memcmp </h3><br>  The <i>memcmp</i> function returns the following <i>int</i> values: <br><br><ul><li>  &lt;0 - buf1 less than buf2; </li><li>  0 - buf1 identical to buf2; </li><li>  &gt; 0 - buf1 greater than buf2; </li></ul><br>  Note.  "More than 0" means any numbers, not at all 1. These numbers can be: 2, 3, 100, 256, 1024, 5555, 65536 and so on.  This means that this result cannot be placed in a variable of type <i>char</i> or <i>short</i> .  Significant bits may be dropped, causing the program execution logic to be violated. <br><br>  It also follows from this that the result cannot be compared with the constants 1 or -1.  In other words, doing it wrong is: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(a, b, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T)) == <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(x, y, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T)) == <span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br>  Correct comparisons: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(a, b, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T)) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(a, b, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(T)) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  The cunningness of the described errors is that the code can work successfully for a long time.  Errors can begin to manifest themselves when switching to a new platform or changing the version of the compiler. <br><br>  <b>ReactOS</b> project code (C ++): <br><br><pre> <code class="cpp hljs">HRESULT WINAPI CRecycleBin::CompareIDs(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MAKE_HRESULT(SEVERITY_SUCCESS, <span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span>)<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(pidl1-&gt;mkid.abID, pidl2-&gt;mkid.abID, pidl1-&gt;mkid.cb)); }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V642/">warning</a> : <a href="http://www.viva64.com/ru/w/V642/">V642</a> Saving the 'memcmp' function result inside the 'unsigned short' type variable is inappropriate.  Breaking the program's logic.  recyclebin.cpp 542 <br><br>  <b>Firebird</b> project code (C ++): <br><br><pre> <code class="cpp hljs">SSHORT TextType::compare(ULONG len1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UCHAR* str1, ULONG len2, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> UCHAR* str2) { .... SSHORT cmp = <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(str1, str2, MIN(len1, len2)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmp == <span class="hljs-number"><span class="hljs-number">0</span></span>) cmp = (len1 &lt; len2 ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : (len1 &gt; len2 ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmp; }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V642/">warning</a> : <a href="http://www.viva64.com/ru/w/V642/">V642</a> Saving the 'memcmp' function result inside the short type variable is inappropriate.  Breaking the program's logic.  texttype.cpp 338 <br><br>  <b>CoreCLR</b> (C ++) project code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">operator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> GUID&amp; _Key1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> GUID&amp; _Key2)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(&amp;_Key1, &amp;_Key2, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(GUID)) == <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V698/">warning</a> : <a href="http://www.viva64.com/ru/w/V698/">V698</a> Expression 'memcmp (....) == -1' is incorrect.  This function can return not only the value '-1', but any negative value.  Consider using 'memcmp (....) &lt;0' instead.  sos util.cpp 142 <br><br>  <b>OpenToonz</b> project <b>code</b> (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> TFilePath::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&lt;(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TFilePath &amp;fp) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> differ; differ = _wcsicmp(iName.c_str(), jName.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (differ != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> differ &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-literal"><span class="hljs-literal">true</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V642/">warning</a> : <a href="http://www.viva64.com/ru/w/V642/">V642</a> Saving the '_wcsicmp' function result inside the 'char' type variable is inappropriate.  Breaking the program's logic.  tfilepath.cpp 328 <br><br><h3>  Pattern: incorrect null reference checking </h3><br>  This error pattern is characteristic of C # programs.  In comparison functions, type casting is sometimes performed using the <i>as</i> operator.  The error lies in the fact that due to inattention to <i>null, it</i> is not the new link that is checked, but the original one.  Consider a synthetic example: <br><br><pre> <code class="cpp hljs">ChildT foo = obj as ChildT; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (foo.zzz()) {}</code> </pre> <br>  The <i>if (obj == null)</i> check protects against the situation if the <i>obj</i> variable contained a null reference.  However, there is no protection from the case if it turns out that the <i>as</i> operator returns a null reference.  The correct code should look like this: <br><br><pre> <code class="cpp hljs">ChildT foo = obj as ChildT; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (foo == null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (foo.zzz()) {}</code> </pre> <br>  As a rule, the error occurs due to the negligence of the programmer.  Similar errors are possible in programs in C and C ++, but I did not find any such cases in the database we found errors. <br><br>  <b>MonoDevelop</b> project code (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object o)</span></span></span><span class="hljs-function"> </span></span>{ SolutionItemReference sr = o as SolutionItemReference; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (path == sr.path) &amp;&amp; (id == sr.id); }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'o', 'sr'.  MonoDevelop.Core SolutionItemReference.cs 81 <br><br>  <b>CoreFX</b> Project <b>Code</b> (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object comparand)</span></span></span><span class="hljs-function"> </span></span>{ CredentialHostKey comparedCredentialKey = comparand as CredentialHostKey; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (comparand == null) { <span class="hljs-comment"><span class="hljs-comment">// This covers also the compared == null case return false; } bool equals = string.Equals(AuthenticationType, comparedCredentialKey.AuthenticationType, .... .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'comparand', 'comparedCredentialKey'.  CredentialCache.cs 4007 <br><br>  <b>Roslyn</b> project code (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ var d = obj as DiagnosticDescription; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_code.Equals(d._code)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'obj', 'd'.  DiagnosticDescription.cs 201 <br><br>  <b>Roslyn</b> project code (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AreEqual</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object other)</span></span></span><span class="hljs-function"> </span></span>{ var otherResourceString = other as LocalizableResourceString; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> other != null &amp;&amp; _nameOfLocalizableResource == otherResourceString._nameOfLocalizableResource &amp;&amp; _resourceManager == otherResourceString._resourceManager &amp;&amp; _resourceSource == otherResourceString._resourceSource &amp;&amp; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'other', 'otherResourceString'.  LocalizableResourceString.cs 121 <br><br>  <b>MSBuild</b> Project Code (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ AssemblyNameExtension name = obj as AssemblyNameExtension; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == null) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { return false; } .... }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'obj', 'name'.  AssemblyRemapping.cs 64 <br><br>  Project code <b>Mono</b> (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object o)</span></span></span><span class="hljs-function"> </span></span>{ UrlMembershipCondition umc = (o as UrlMembershipCondition); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (o == null) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return false; .... return (String.Compare (u, 0, umc.Url, ....) == 0); // &lt;= }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'o', 'umc'.  UrlMembershipCondition.cs 111 <br><br>  <b>Media Portal 2</b> (C #) project code: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ EpisodeInfo other = obj as EpisodeInfo; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TvdbId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; other.TvdbId &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TvdbId == other.TvdbId; .... }</code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'obj', 'other'.  EpisodeInfo.cs 560 <br><br>  <b>NASA World Wind</b> project code (C #): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ RenderableObject robj = obj as RenderableObject; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(obj == null) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return 1; return this.m_renderPriority.CompareTo(robj.RenderPriority); }</span></span></code> </pre> <br>  PVS-Studio <a href="http://www.viva64.com/ru/w/V3019/">warning</a> : <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'obj', 'robj'.  RenderableObject.cs 199 <br><br><h3>  Pattern: Wrong Loops </h3><br>  Some functions compare collections of items.  Naturally, various cycles are used to compare them.  If you write code inattentively, as happens with comparison functions, then it‚Äôs easy to make a mess of cycles.  Consider a few of these situations. <br><br>  <b>Trans-Proteomic Pipeline</b> project code (C ++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Peptide::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(Peptide&amp; p) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;stripped.length(), j &lt; p.stripped.length(); i++, j++) { .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: </font></font><a href="http://www.viva64.com/ru/w/V521/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V521</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Such expressions using the ',' operator are dangerous. </font><font style="vertical-align: inherit;">Make sure the expression is correct. </font><font style="vertical-align: inherit;">tpplib peptide.cpp 191 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that the condition uses the comma operator. </font><font style="vertical-align: inherit;">The code is clearly incorrect, as the condition to the left of the comma is not taken into account. </font><font style="vertical-align: inherit;">That is, the condition on the left is calculated, but its result is not used in any way. </font><b><font style="vertical-align: inherit;">Qt</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C ++):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( class1* val1, class2* val2 )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size = val1-&gt;size(); ... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( --size &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !comp(*itr1,*itr2) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; itr1++; itr2++; } ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V547/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V547/"><font style="vertical-align: inherit;">V547</font></a><font style="vertical-align: inherit;"> Expression '- size&gt; = 0' is always true. </font><font style="vertical-align: inherit;">Unsigned type value is always&gt; = 0. QtCLucene arrays.h 154 </font><b><font style="vertical-align: inherit;">CLucene</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (C ++):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Arrays</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( class1* val1, class2* val2 )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> _comparator comp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( val1 == val2 ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size = val1-&gt;size(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( size != val2-&gt;size() ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; _itr1 itr1 = val1-&gt;begin(); _itr2 itr2 = val2-&gt;begin(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( --size &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> ){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( !comp(*itr1,*itr2) ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; itr1++; itr2++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V547/">V547</a> Expression '-- size &gt;= 0' is always true. Unsigned type value is always &gt;= 0. arrays.h 154 <br><br>   <b>Mono</b> (C#): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>.Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> found = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ps.<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>.Count; j++) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (list [i].Equals (ps.list [j])) { found = true; break; } } if (!found) return false; } return true; }</span></span></code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V3015/">V3015</a> It is likely that a wrong variable is being compared inside the 'for' operator. Consider reviewing 'i' corlib-net_4_x PermissionSet.cs 607 <br><br>     , ,   ,        <i>j</i> ,   <i>i</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; ps.<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>.Count; j++)</code> </pre> <br><h3> : A = getA(), B = GetA() </h3><br>          : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetA().x == GetB().x &amp;&amp; GetA().y == GetB().y)</code> </pre> <br>       ,   : <br><br><pre> <code class="cpp hljs">Type A = GetA(); Type B = GetB(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Ax == Bx &amp;&amp; Ay == By)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> At the same time, due to carelessness, they sometimes make a mistake and initialize temporary variables with the same value: </font></font><br><br><pre> <code class="cpp hljs">Type A = GetA(); Type B = GetA();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's see how such errors look in the code of real applications. </font><b><font style="vertical-align: inherit;">LibreOffice</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C ++):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CmpAttr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> SfxPoolItem&amp; rItem1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> SfxPoolItem&amp; rItem2)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bNumOffsetEqual = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ::boost::optional&lt;sal_uInt16&gt; oNumOffset1 = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SwFmtPageDesc&amp;&gt;(rItem1).GetNumOffset(); ::boost::optional&lt;sal_uInt16&gt; oNumOffset2 = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SwFmtPageDesc&amp;&gt;(rItem1).GetNumOffset(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!oNumOffset1 &amp;&amp; !oNumOffset2) { bNumOffsetEqual = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (oNumOffset1 &amp;&amp; oNumOffset2) { bNumOffsetEqual = oNumOffset1.get() == oNumOffset2.get(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { bNumOffsetEqual = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: </font></font><a href="http://www.viva64.com/ru/w/V656/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V656</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Variables 'oNumOffset1', 'oNumOffset2' are initialized. </font><font style="vertical-align: inherit;">It's probably not an error or un-optimized code. </font><font style="vertical-align: inherit;">Check lines: 68, 69. findattr.cxx 69 </font><b><font style="vertical-align: inherit;">Qt</font></b><font style="vertical-align: inherit;"> (C ++) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project code </font><font style="vertical-align: inherit;">:</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs">AtomicComparator::ComparisonResult IntegerComparator::compare(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Item &amp;o1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AtomicComparator::Operator, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Item &amp;o2) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Numeric *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> num1 = o1.as&lt;Numeric&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Numeric *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> num2 = o1.as&lt;Numeric&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(num1-&gt;isSigned() || num2-&gt;isSigned()) .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V656/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V656/"><font style="vertical-align: inherit;">V656</font></a><font style="vertical-align: inherit;"> Variables 'num1', 'num2' are initialized. </font><font style="vertical-align: inherit;">It's probably not an error or un-optimized code. </font><font style="vertical-align: inherit;">Consider inspecting the 'o1.as &lt;Numeric&gt; ()' expression. </font><font style="vertical-align: inherit;">Check lines: 220, 221. qatomiccomparators.cpp 221</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pattern: failed copy code </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Many of the errors previously cited can be called the consequences of an unsuccessful Copy-Paste. </font><font style="vertical-align: inherit;">They fell under some kind of erroneous pattern, and I decided that it was logical to describe them in the appropriate sections. </font><font style="vertical-align: inherit;">However, I still have a few errors that obviously arose due to unsuccessful copying of the code, but which I do not know how to classify. </font><font style="vertical-align: inherit;">So I just collected these errors here. </font><b><font style="vertical-align: inherit;">CoreCLR</font></b><font style="vertical-align: inherit;"> (C ++) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project code </font><font style="vertical-align: inherit;">:</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __cdecl Compiler::RefCntCmp(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* op1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* op2) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weight1) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (varTypeIsGC(dsc1-&gt;TypeGet())) { weight1 += BB_UNITY_WEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dsc1-&gt;lvRegister) { weight1 += BB_UNITY_WEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weight1) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (varTypeIsGC(dsc2-&gt;TypeGet())) { weight1 += BB_UNITY_WEIGHT / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } if (dsc2-&gt;lvRegister) { weight2 += BB_UNITY_WEIGHT / 2; } } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V778/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V778/"><font style="vertical-align: inherit;">V778</font></a><font style="vertical-align: inherit;"> Two code fragments were found. Perhaps this is a typo and 'weight2' variable should be used instead of 'weight1'. clrjit lclvars.cpp 2702 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function was long, so it was thoroughly shortened for the article. If we look at the code of this function, it is noticeable that part of the code was copied, but in one place the programmer forgot to replace the variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weight1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">weight2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><b><font style="vertical-align: inherit;">WPF samples by Microsoft</font></b><font style="vertical-align: inherit;"> (C #) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">project code </font><font style="vertical-align: inherit;">:</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GlyphRun a, GlyphRun b)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (aPoint.Y &gt; bPoint.Y) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { return -1; } else if (aPoint.Y &gt; bPoint.Y) // &lt;= { result = 1; } else if (aPoint.X &lt; bPoint.X) { result = -1; } else if (aPoint.X &gt; bPoint.X) { result = 1; } .... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V3003/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V3003/"><font style="vertical-align: inherit;">V3003</font></a><font style="vertical-align: inherit;"> The use of if (A) {...} else if (A) {...} 'pattern was detected. </font><font style="vertical-align: inherit;">There is a possibility of logical error presence. </font><font style="vertical-align: inherit;">Check lines: 418, 422. txtserializerwriter.cs 418 </font><b><font style="vertical-align: inherit;">PascalABC.NET</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C #):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompareInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (left is int64_const) CompareInternal(left as int64_const, right as int64_const); .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (left is int64_const) CompareInternal(left as int64_const, right as int64_const); .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V3003/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V3003/"><font style="vertical-align: inherit;">V3003</font></a><font style="vertical-align: inherit;"> The use of if (A) {...} else if (A) {...} 'pattern was detected. </font><font style="vertical-align: inherit;">There is a possibility of logical error presence. </font><font style="vertical-align: inherit;">Check lines: 597, 631. ParserTools SyntaxTreeComparer.cs 597 </font><b><font style="vertical-align: inherit;">SharpDevelop</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C #):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SharpTreeNode x, SharpTreeNode y)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeNameComparison == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.Text.ToString().Length &lt; y.Text.ToString().Length) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x.Text.ToString().Length &lt; y.Text.ToString().Length) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V3021/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V3021/"><font style="vertical-align: inherit;">V3021</font></a><font style="vertical-align: inherit;"> There are two 'if' statements with identical conditional expressions. </font><font style="vertical-align: inherit;">The first 'if' statement contains method return. </font><font style="vertical-align: inherit;">This means that the statement of the second 'if' statement is a senseless NamespaceTreeNode.cs 87 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Code of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coin3D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font><font style="vertical-align: inherit;">(C ++):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SbProfilingData::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> == (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SbProfilingData &amp; rhs) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;actionType != rhs.actionType) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;actionStartTime != rhs.actionStopTime) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;actionStartTime != rhs.actionStopTime) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; .... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V649/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V649/"><font style="vertical-align: inherit;">V649</font></a><font style="vertical-align: inherit;"> There are two 'if' statements with identical conditional expressions. </font><font style="vertical-align: inherit;">The first 'if' statement contains function return. </font><font style="vertical-align: inherit;">This means that the statement is senseless. </font><font style="vertical-align: inherit;">Check lines: 1205, 1206. sbprofilingdata.cpp 1206 </font><b><font style="vertical-align: inherit;">Spring</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C ++):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> &lt; (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> aiFloatKey&amp; o) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mTime &lt; o.mTime;} <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> &gt; (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> aiFloatKey&amp; o) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mTime &lt; o.mTime;}</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V524/">V524</a> It is odd that the body of '&gt;' function is fully equivalent to the body of '&lt;' function. assimp 3dshelper.h 470 <br><br>      ,    PVS-Studio    <b>MySQL</b> (C++): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rr_cmp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(uchar *a,uchar *b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">0</span></span>] != b[<span class="hljs-number"><span class="hljs-number">0</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">0</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">1</span></span>] != b[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">1</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">2</span></span>] != b[<span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">2</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">3</span></span>] != b[<span class="hljs-number"><span class="hljs-number">3</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">3</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">3</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">4</span></span>] != b[<span class="hljs-number"><span class="hljs-number">4</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">4</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">5</span></span>] != b[<span class="hljs-number"><span class="hljs-number">5</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">1</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (a[6] != b[6]) return (int) a[6] - (int) b[6]; return (int) a[7] - (int) b[7]; }</span></span></code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V525/">V525</a> The code containing the collection of similar blocks. Check items '0', '1', '2', '3', '4', '1', '6' in lines 680, 682, 684, 689, 691, 693, 695. sql records.cc 680 <br><br>  ,    ,      .        : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">1</span></span>] != b[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">1</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">1</span></span>];</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And put it in the text of the program the necessary number of times. </font><font style="vertical-align: inherit;">Then he changed the indices, but he made a mistake in one place, and an incorrect comparison was obtained:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a[<span class="hljs-number"><span class="hljs-number">5</span></span>] != b[<span class="hljs-number"><span class="hljs-number">5</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) a[<span class="hljs-number"><span class="hljs-number">1</span></span>] - (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) b[<span class="hljs-number"><span class="hljs-number">5</span></span>];</code> </pre> <br>  Note.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I discuss this error in more detail in the mini-book ‚Äú </font></font><a href="https://www.viva64.com/ru/b/0391/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Main Question of Programming, Refactoring and All</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> That‚Äù (see the chapter ‚ÄúDo not take over the work of the compiler‚Äù).</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pattern: Equals method incorrectly handles null reference </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In C #, it is common practice to implement </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> methods </font><font style="vertical-align: inherit;">so that they correctly handle the situation if a null reference comes as an argument. </font><font style="vertical-align: inherit;">Unfortunately, the implementation of not all methods complies with this rule. </font><b><font style="vertical-align: inherit;">GitExtensions</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (C #):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetHashCode() == obj.GetHashCode(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V3115/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V3115/"><font style="vertical-align: inherit;">V3115</font></a><font style="vertical-align: inherit;"> Passing 'null' to 'Equals (object obj)' method should not result in 'NullReferenceException'. </font><font style="vertical-align: inherit;">Git.hub Organization.cs 14 </font><b><font style="vertical-align: inherit;">PascalABC.NET</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C #):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ var rhs = obj as ServiceReferenceMapFile; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FileName == rhs.FileName; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V3115/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V3115/"><font style="vertical-align: inherit;">V3115</font></a><font style="vertical-align: inherit;"> Passing 'null' to 'Equals' method should not result in 'NullReferenceException'. </font><font style="vertical-align: inherit;">ICSharpCode.SharpDevelop ServiceReferenceMapFile.cs 31</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Various other errors </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project code for </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">G3D Content Pak</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (C ++):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Matrix4::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>==(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Matrix4&amp; other) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, &amp;other, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Matrix4) == <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V575/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V575/"><font style="vertical-align: inherit;">V575</font></a><font style="vertical-align: inherit;"> The 'memcmp' function processes '0' elements. </font><font style="vertical-align: inherit;">Inspect the 'third' argument. </font><font style="vertical-align: inherit;">graphics3D matrix4.cpp 269 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One closing bracket does not </font><font style="vertical-align: inherit;">fit </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As a result, the number of compared bytes is calculated by the expression </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sizeof (Matrix4) == 0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The size of any class is greater than 0, which means that the result of the expression is 0. Thus, 0 bytes are compared. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The correct option is:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">memcmp</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, &amp;other, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Matrix4)) == <span class="hljs-number"><span class="hljs-number">0</span></span>) {</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project code </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wolfenstein 3D</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (C ++):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>!=( <span class="hljs-keyword"><span class="hljs-keyword">quat_t</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">quat_t</span></span> b ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( ( ax != bx ) || ( ay != by ) || ( az != bz ) &amp;&amp; ( aw != bw ) ); }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V648/">V648</a> Priority of the '&amp;&amp;' operation is higher than that of the '||' operation. math_quaternion.h 167 <br><br>   , ,    <i>&amp;&amp;</i>  <i>||</i>  . <br><br>   <b>FlightGear</b> (): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tokMatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct Token* a, struct Token* b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, l = a-&gt;<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!a || !b) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }</code> </pre> <br>  PVS-Studio: <a href="http://www.viva64.com/ru/w/V595/">V595</a> The 'a' pointer was utilized before it was verified against nullptr. Check lines: 478, 479. codegen.c 478 <br><br>         <i>NULL</i> ,     ,        <i>0</i> . <br><br>   <b>WinMerge</b> (C++): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TimeSizeCompare::CompareFiles(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> compMethod, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DIFFITEM &amp;di) { UINT code = DIFFCODE::SAME; ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (di.left.size != di.right.size) { code &amp;= ~DIFFCODE::SAME; code = DIFFCODE::DIFF; } ... }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V519/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V519/"><font style="vertical-align: inherit;">V519</font></a><font style="vertical-align: inherit;"> The 'code' variable is assigned values ‚Äã‚Äãtwice successively.</font></font> Perhaps this is a mistake.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check lines: 79, 80. Merge timesizecompare.cpp 80 </font><b><font style="vertical-align: inherit;">ReactOS</font></b></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project code </font><font style="vertical-align: inherit;">(C ++):</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"></font><br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> IsEqualGUID(rguid1, rguid2) \ (!memcmp(&amp;(rguid1), &amp;(rguid2), sizeof(GUID))) static int ctl2_find_guid(....) { MSFT_GuidEntry *guidentry; ... </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (IsEqualGUID(guidentry, guid)) return offset; ... }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V512/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V512/"><font style="vertical-align: inherit;">V512</font></a><font style="vertical-align: inherit;"> A call of the 'memcmp' function will be guidentry. </font><font style="vertical-align: inherit;">oleaut32 typelib2.c 320 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The pointer is the first argument of the macro. </font><font style="vertical-align: inherit;">As a result, the address of the pointer is calculated, which makes no sense. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The correct option is:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsEqualGUID(*guidentry, guid)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> offset;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code for the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IronPython and IronRuby</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> project </font><font style="vertical-align: inherit;">(C #):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x == y) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !Single.IsNaN(x); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x == y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio </font></font><a href="http://www.viva64.com/ru/w/V3024/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">warning</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font><a href="http://www.viva64.com/ru/w/V3024/"><font style="vertical-align: inherit;">V3024</font></a><font style="vertical-align: inherit;"> An odd precise comparison: x == y. </font><font style="vertical-align: inherit;">Consider using a precision with a precision: Math.Abs ‚Äã‚Äã(A - B) &lt;Epsilon. </font><font style="vertical-align: inherit;">FloatOps.cs 1048 </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is not clear what is the point of a special test on </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NaN</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If the condition </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(x == y)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is satisfied, then this means that both </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> are different from </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NaN</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , because </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NaN is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> not equal to any other value, including itself. </font><font style="vertical-align: inherit;">It seems that checking for </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NaN is</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> just superfluous and the code can be reduced to:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x == y; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project code </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mono</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (C #):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CounterSample other)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rawValue == other.rawValue &amp;&amp; baseValue == other.counterFrequency &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= counterFrequency == other.counterFrequency &amp;&amp; // &lt;= systemFrequency == other.systemFrequency &amp;&amp; timeStamp == other.timeStamp &amp;&amp; timeStamp100nSec == other.timeStamp100nSec &amp;&amp; counterTimeStamp == other.counterTimeStamp &amp;&amp; counterType == other.counterType; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PVS-Studio Warning: </font></font><a href="http://www.viva64.com/ru/w/V3112/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V3112</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An abnormality within similar comparisons. </font><font style="vertical-align: inherit;">It is possible that a typo is currently inside the expression 'baseValue == other.counterFrequency'. </font><font style="vertical-align: inherit;">System-net_4_x CounterSample.cs 139</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How do these programs work? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Looking through all these errors, it seems surprising that all these programs work at all. </font><font style="vertical-align: inherit;">After all, comparison functions perform an extremely important and responsible task in programs. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are several explanations for the health of programs with such errors:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In many functions, only part of the object is incorrectly compared. </font><font style="vertical-align: inherit;">In this case, a partial comparison is enough for most tasks in this program.</font></font></li><li>   () ,     . ,    ,        ,     <i>memcmp</i>     <i>char</i> .   . </li><li>          . </li><li>   ,   ?     - ! </li></ol><br><h2>  Recommendations </h2><br>  ,        .   ,          -. <br><br>   -   ,   <i>Equals</i>   . <br><br> ,       ,            :        ‚Ä¶  ,     ,     . <br><br>           . <br><br><h2>  Conclusion </h2><br>       ,    .        .   ,     PVS-Studio    .    ,  PVS-Studio       ,       . <br><br>        <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> . <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0509/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov. <a href="http://www.viva64.com/en/b/0509/">The Evil within the Comparison Functions</a> </div><p>Source: <a href="https://habr.com/ru/post/329090/">https://habr.com/ru/post/329090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329080/index.html">GTD and blah blah blah</a></li>
<li><a href="../329082/index.html">Machine Learning for an Insurance Company: Realistic Ideas</a></li>
<li><a href="../329084/index.html">Welcome to the Unreal Engine Meetup May 24</a></li>
<li><a href="../329086/index.html">Standoff Positive Hack Days: Attackers Set to Rematch</a></li>
<li><a href="../329088/index.html">Protected text messaging service</a></li>
<li><a href="../329092/index.html">Telephony to the office for a stick of sausage</a></li>
<li><a href="../329094/index.html">Textures and RGB channels in Unreal Engine 4</a></li>
<li><a href="../329096/index.html">Who needs these SMS?</a></li>
<li><a href="../329098/index.html">Security Week 20: Fake WannaCry, HP has keylogger on firewood, Chrome downloads extra</a></li>
<li><a href="../329100/index.html">EVPN Multihoming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>