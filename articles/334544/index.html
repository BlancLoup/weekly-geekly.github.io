<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smok testing on a small project: how it started and what the results</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Developing a project in C ++. I decided to try test scenarios on my project. 
 scripting in Python instead of testing the code manually. Usually it is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smok testing on a small project: how it started and what the results</h1><div class="post__text post__text-html js-mediator-article">  Developing a project in C ++.  I decided to try test scenarios on my project. <br>  scripting in Python instead of testing the code manually.  Usually it is not required from programmers in our company, so this was an experiment.  Over the year I wrote about 100 tests and this experiment turned out to be quite useful.  Tests are performed a few minutes and allow you to quickly check both my pool requests and pool requesters of other developers. <br><a name="habracut"></a><br>  Before this experiment, as a developer, after adding a new feature, I performed a manual <br>  testing.  The fact that testing by a programmer of new features was done manually was not a problem in the company - at least in those groups where I worked, the developers usually tested this way. <br><br>  From a design point of view, test scripts have a very simple organization.  The class for each test plus several classes for modeling interacting programs.  These are the classes for simulating interacting programs and they require early writing time.  It took a lot of time to write the first test scripts.  The task that can be done in 1 hour did 1 day.  So the first few tests are the most time consuming.  And in the future on small modifications to write a test, more time is spent than on a manual test.  So I did not test for every revision. <br><br>  However, on tasks with long-term development, the ratio is different.  Once written <br>  An automatic test saves time because it is used many times during the development process.  For example, during the development of one task, 18 tests were written, and it was they who guaranteed the correctness of the algorithm, which consisted of C ++, Lua, SQL and used message exchange with RabbitMQ and work with the database. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As I did tests for myself, I added a test run mode in which the program under test does not start during testing, and the tests expect that the program under test is already running.  This gives me the opportunity to perform a test when the program is running under the IDE and set breakpoint in the required places.  This mode turned out to be convenient for debugging complex test scenarios. <br><br>  After six months of adding tests, when there were already a few dozen of them, and we managed to get rid of false positives, the tangible benefits for the project began to appear from them.  I began to use them to quickly check the pool of requests from other developers.  After the code review, I ran the tests on the request pool.  A few minutes of the tests and it was clear if there are any problems in the existing code - crashes or incorrect processing.  As a result, I began to use these test scripts for testing on the project. <br><br><div class="spoiler">  <b class="spoiler_title">An example of a separate test</b> <div class="spoiler_text"><pre><code class="bash hljs">$ python3 autotests.py -c VirtualPaymentsDeleteWithShard [ ========== ] Running 1 tests [ ========== ] autotest dir /home/sergey.kurenkov/src.git/dp.confirm_bfam/User_Part/build/autotests.dir [ RUN ] BisrtAddon.VirtualPaymentsDeleteWithShard [<span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-comment"><span class="hljs-comment">#1, time: 2017-07-31 18:09:05, test suite duration: 2.62] [ OK ] BisrtAddon.VirtualPaymentsDeleteWithShard [8.012 sec, time: 2017-07-31 18:09:13, test suite duration: 10.64] [ ========== ] 1 tests ran [ PASSED ] 1 tests [ ] test suite duration (21.678 sec)</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Test example - test code in the run_in_test_env method</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VirtualPaymentsBase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, autotest_cfg)</span></span></span><span class="hljs-function">:</span></span> self.autotest_cfg = autotest_cfg self.table_name = <span class="hljs-string"><span class="hljs-string">"virtual_payments"</span></span> self.db_records = [] self.rabbit_srv = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.snmp_agent = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.con = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.cart_consumer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.pub = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.test_env = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.sent_cart_records = [] self.sent_hrs_records = [] self.sent_brt_records = [] self.sent_bfam_records = [] self.cart_consumer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.hrs_consumer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.brt_consumer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.bfam_consumer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.test_clnt_id = random.randint(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_db_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_sent_cart_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> utility.check_number_of_records(self.sent_cart_records, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expect_cart_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_sent_hrs_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> utility.check_number_of_records(self.sent_hrs_records, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expect_hrs_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_sent_brt_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expect_brt_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_sent_bfam_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expect_bfam_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">db_records_has_been_fetched</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, db_records)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(db_records) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare_db</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_finish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @utility.log_run <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_in_test_env</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, test_env)</span></span></span><span class="hljs-function">:</span></span> self.snmp_agent = test_env.snmp_agent self.con = test_env.con self.test_env = test_env self.pub = test_env.pub self.cart_consumer = test_env.cart_consumer self.hrs_consumer = test_env.hrs_consumer self.brt_consumer = test_env.brt_consumer self.bfam_consumer = test_env.bfam_consumer self.prepare_db() self.publish_records() self.db_records = fetch_table_records(partial(db_functions.fetch_virtual_payments, clnt_id=self.test_clnt_id), self.con, self.db_records_has_been_fetched) logging.info(<span class="hljs-string"><span class="hljs-string">"checking db records"</span></span>) self.check_db_records() logging.info(<span class="hljs-string"><span class="hljs-string">"checking cart records"</span></span>) self.sent_cart_records = self.cart_consumer.get_records(<span class="hljs-number"><span class="hljs-number">10</span></span>, self.expect_cart_records()) self.check_sent_cart_records() logging.info(<span class="hljs-string"><span class="hljs-string">"checking brt records"</span></span>) self.sent_brt_records = self.brt_consumer.get_records(<span class="hljs-number"><span class="hljs-number">10</span></span>, self.expect_brt_records()) self.check_sent_brt_records() logging.info(<span class="hljs-string"><span class="hljs-string">"checking hrs records"</span></span>) self.sent_hrs_records = self.hrs_consumer.get_records(<span class="hljs-number"><span class="hljs-number">10</span></span>, self.expect_hrs_records()) self.check_sent_hrs_records() logging.info(<span class="hljs-string"><span class="hljs-string">"checking bfam records"</span></span>) self.sent_bfam_records = self.bfam_consumer.get_records(<span class="hljs-number"><span class="hljs-number">10</span></span>, self.expect_bfam_records()) self.check_sent_bfam_records() self.on_finish() logging.info(<span class="hljs-string"><span class="hljs-string">"done"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VirtualPaymentsWithShard</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(VirtualPaymentsBase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, autotest_cfg)</span></span></span><span class="hljs-function">:</span></span> VirtualPaymentsBase.__init__(self, autotest_cfg) self.routing_key = <span class="hljs-string"><span class="hljs-string">"ps.ocsdb_tevt.virtual_payments.100"</span></span> self.brt_routing_key = <span class="hljs-string"><span class="hljs-string">"ps.ocsdb.virtual_payments"</span></span> self.bfam_routing_key = <span class="hljs-string"><span class="hljs-string">"ps.ocsdb_bfam.confirm_virt"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"BisrtAddon.VirtualPaymentsWithShard"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepare_db</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> cur = self.con.cursor() cur.execute(<span class="hljs-string"><span class="hljs-string">"delete from virtual_payments t "</span></span> <span class="hljs-string"><span class="hljs-string">"where t.clnt_clnt_id = {clnt_id}"</span></span>.format(clnt_id=self.test_clnt_id)) self.con.commit() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publish_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> record = { <span class="hljs-string"><span class="hljs-string">'last_record'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'virt_id'</span></span> : self.test_clnt_id, <span class="hljs-string"><span class="hljs-string">'vrtp_vrtp_id'</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'clnt_clnt_id'</span></span> : self.test_clnt_id, <span class="hljs-string"><span class="hljs-string">'amount_r'</span></span> : <span class="hljs-number"><span class="hljs-number">123.4</span></span>, <span class="hljs-string"><span class="hljs-string">'exp_date'</span></span> : <span class="hljs-string"><span class="hljs-string">'20900102'</span></span>, <span class="hljs-string"><span class="hljs-string">'virtual_date'</span></span> : <span class="hljs-string"><span class="hljs-string">'20690203'</span></span>, <span class="hljs-string"><span class="hljs-string">'amount_'</span></span> : <span class="hljs-number"><span class="hljs-number">12.3</span></span>, <span class="hljs-string"><span class="hljs-string">'vrnt_vrnt_id'</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'vrct_vrct_id'</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'start_date'</span></span> : <span class="hljs-string"><span class="hljs-string">'20160203'</span></span>, <span class="hljs-string"><span class="hljs-string">'end_date'</span></span> : <span class="hljs-string"><span class="hljs-string">'20890405'</span></span>, <span class="hljs-string"><span class="hljs-string">'navi_date'</span></span> : <span class="hljs-string"><span class="hljs-string">'20170405'</span></span>, } message_str = json.dumps([record], indent=<span class="hljs-number"><span class="hljs-number">4</span></span>) logging.info(message_str) self.pub.publish(self.routing_key, message_str) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_db_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> utility.check_number_of_records(self.db_records, <span class="hljs-number"><span class="hljs-number">1</span></span>) expected_recs = [(self.test_clnt_id, <span class="hljs-number"><span class="hljs-number">1</span></span>, self.test_clnt_id, <span class="hljs-number"><span class="hljs-number">123.4</span></span>, datetime(<span class="hljs-number"><span class="hljs-number">2090</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), datetime(<span class="hljs-number"><span class="hljs-number">2069</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), <span class="hljs-number"><span class="hljs-number">12.3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, datetime(<span class="hljs-number"><span class="hljs-number">2016</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), datetime(<span class="hljs-number"><span class="hljs-number">2089</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), datetime(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, )] compare_db_records(self.db_records, expected_recs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expect_brt_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_sent_brt_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> utility.check_number_of_records(self.sent_brt_records, <span class="hljs-number"><span class="hljs-number">1</span></span>) a_message = self.sent_brt_records[<span class="hljs-number"><span class="hljs-number">0</span></span>] check_message_routing_key(a_message, self.brt_routing_key) check_message_header_type(a_message, self.brt_routing_key) a_record = a_message[<span class="hljs-string"><span class="hljs-string">'record'</span></span>] check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'clnt_id'</span></span>, self.test_clnt_id) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'virt_id'</span></span>, self.test_clnt_id) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'vrtp_id'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'vrct_id'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) check_amqp_field_not_present(a_record, <span class="hljs-string"><span class="hljs-string">'bltp_id'</span></span>) check_amqp_field_not_present(a_record, <span class="hljs-string"><span class="hljs-string">'chrg_id'</span></span>) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'amount'</span></span>, <span class="hljs-number"><span class="hljs-number">12.3</span></span>) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'amount_r'</span></span>, <span class="hljs-number"><span class="hljs-number">123.4</span></span>) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">"start_date"</span></span>, <span class="hljs-string"><span class="hljs-string">'2016-02-03'</span></span>) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">"end_date"</span></span>, <span class="hljs-string"><span class="hljs-string">'2089-04-05'</span></span>) check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">"deleted"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">expect_bfam_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_sent_bfam_records</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> utility.check_number_of_records(self.sent_bfam_records, <span class="hljs-number"><span class="hljs-number">1</span></span>) a_message = self.sent_bfam_records[<span class="hljs-number"><span class="hljs-number">0</span></span>] check_message_routing_key(a_message, self.bfam_routing_key) check_message_header_type(a_message, self.bfam_routing_key) a_record = a_message[<span class="hljs-string"><span class="hljs-string">'record'</span></span>] utility.check_amqp_field(a_record, <span class="hljs-string"><span class="hljs-string">'virt_id'</span></span>, self.test_clnt_id)</code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/334544/">https://habr.com/ru/post/334544/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334532/index.html">GeekUniversity opens a set of students to the department of Python-development</a></li>
<li><a href="../334534/index.html">Gigabit GOST VPN. Tss diamond</a></li>
<li><a href="../334536/index.html">Beginner's Guide to Progressive Web Applications and the Frontend</a></li>
<li><a href="../334538/index.html">Interview for a front-end JavaScript developer: best questions</a></li>
<li><a href="../334542/index.html">How to cross a hedgehog with a snake. We use GridView from Yii 2 in the project on Laravel</a></li>
<li><a href="../334546/index.html">About Reflect API available language</a></li>
<li><a href="../334548/index.html">The unrealized potential of the Internet of Things</a></li>
<li><a href="../334550/index.html">Company Development with Open Source</a></li>
<li><a href="../334552/index.html">A quarter of a million for the "beetle": Microsoft is beginning an active struggle with bugs</a></li>
<li><a href="../334554/index.html">Characteristics of the PVS-Studio analyzer on the example of EFL Core Libraries, 10-15% of false positives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>