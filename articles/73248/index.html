<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alternative way to write IP addresses (version 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading a note in September of an alternative way to record IP addresses , I wondered what kind of smart programs are, and forgot. 

 Recently I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alternative way to write IP addresses (version 2)</h1><div class="post__text post__text-html js-mediator-article">  After reading a note in September of an <a href="http://habrahabr.ru/blogs/sysadm/69587/">alternative way to record IP addresses</a> , I wondered what kind of smart programs are, and forgot. <br><br>  Recently I had to install mpi for local development.  I tried both MS MPI and MPICH, both ended with an unclear error on the 10051 network, as MSDN says, which means that the network is not available.  I tried to overcome it for a long time, I already thought on the OS and on the software packages themselves, re-created the network interfaces.  But it turned out a little differently ... <br><a name="habracut"></a><br>  Then I accidentally remembered a note about IP addresses and it dawned on me; I gave the computer a name for the unusual: 0x0A0D.  The fears were confirmed, this name was immediately converted to an IP address and the mpi program could not connect to the dispatcher. <br><br><h4>  Os windows </h4><br>  So, are all programs so smart?  First, let's look at how the system ping utility of MS Windows resolves the incoming parameter to the IP address.  This is done using the POSIX-compatible function getaddrinfo of the WinSock library.  It happens like this: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">struct</font> addrinfo hints; <br> ZeroMemory( &amp;hints, <font color="#0000ff">sizeof</font> (hints) ); <br> hints.ai_flags = AI_NUMERICHOST; <br> <br> dwRetval = getaddrinfo(argv[1], NULL, &amp;hints, &amp;result); <br> <font color="#0000ff">if</font> ( dwRetval != 0 ) { <br> hints.ai_flags = AI_CANONNAME; <br> dwRetval = getaddrinfo(argv[1], NULL, &amp;hints, &amp;result); <br> <font color="#0000ff">if</font> ( dwRetval != 0 ) { <br> printf( <font color="#A31515">"getaddrinfo failed with error: %d\n"</font> , dwRetval); <br> WSACleanup(); <br> <font color="#0000ff">return</font> 1; <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Here is its description: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">int</font> WSAAPI getaddrinfo( <br> __in <font color="#0000ff">const</font> <font color="#0000ff">char</font> *nodename, <br> __in <font color="#0000ff">const</font> <font color="#0000ff">char</font> *servname, <br> __in <font color="#0000ff">const</font> <font color="#0000ff">struct</font> addrinfo *hints, <br> __out <font color="#0000ff">struct</font> addrinfo **res <br> ); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The most interesting parameter is hints, which serves as a hint for interpreting the nodename input string.  The ai_flags field can take several values ‚Äã‚Äãon which the logic of converting an incoming string to an address depends.  In the ping utility, as in many other programs, an attempt is first made to directly convert a string to an IP address, and only then it is repeated through the DNS subsystem.  It is quite logical and rational. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so, what happens when we force a direct transformation?  In the depths of the winsock code, there is a lot of transformations and checks, but in the end the execution flow reaches the <b>RtlIpv4StringToAddressW</b> function of the <b>Ntdll.dll</b> library.  By the way, this function is completely independent of the network subsystem and can be used without explicit initialization of WinSock.  It just interprets various options for recording IP addresses.  MSDN talks about all formats, but why exactly are they? <br><br><h4>  Linux OS </h4><br>  With this operating system, everything is much simpler, since the source code of its and its many utilities are open.  Having found the first source of the ping utility for Linux, you can see how it converts a string to an IP address: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">bzero(( <font color="#0000ff">char</font> *)&amp;whereto, <font color="#0000ff">sizeof</font> ( <font color="#0000ff">struct</font> sockaddr) ); <br> to-&gt;sin_family = AF_INET; <br> to-&gt;sin_addr.s_addr = inet_addr(av[0]); <br> <font color="#0000ff">if</font> (to-&gt;sin_addr.s_addr != (unsigned)-1) { <br> strcpy(hnamebuf, av[0]); <br> hostname = hnamebuf; <br> } <font color="#0000ff">else</font> { <br> hp = gethostbyname(av[0]); <br> <font color="#0000ff">if</font> (hp) { <br> to-&gt;sin_family = hp-&gt;h_addrtype; <br> bcopy(hp-&gt;h_addr, (caddr_t)&amp;to-&gt;sin_addr, hp-&gt;h_length); <br> hostname = hp-&gt;h_name; <br> } <font color="#0000ff">else</font> { <br> printf( <font color="#A31515">"%s: unknown host %sn"</font> , argv[0], av[0]); <br> exit(1); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  As you can see, the code is different, but by defining the function assignments, it can be understood that the algorithms are identical.  <b>After reading man inet_addr</b> , it becomes clear that this function is similar to <b>RtlIpv4StringToAddressW in</b> Windows.  Also in her description mentioned the mysterious standard <b>POSIX.1-2001</b> . <br><br><h4>  POSIX.1-2001 standard </h4><br>  And so the standard says, the function must accept a string in one of the following formats: <br><ul><li>  abcd - When 4 parts are indicated, each part must be interpreted as a data byte and assigned from left to right to four bytes of an IP address. </li><li>  abc - When 3 parts are indicated, the third part is interpreted as a 16-bit value and assigned to the right two bytes of the IP address.  Thus, you can jot down addresses in class B networks. </li><li>  ab - When two parts are indicated, the second part is interpreted as a 24-bit value and is used to briefly write class A addresses. </li><li>  a - When one part is indicated, it must be directly converted to an IP address without permutations. </li></ul><br>  All parts of the dotted IP address notation should be numbers in decimal, octal, or hexadecimal numbering systems according to ISO C. <br><br><h4>  findings </h4><br><ol><li>  You need to select the network name of the computer that cannot be directly converted to an address, otherwise the computer may not be available by name </li><li>  IP4 address translation has nothing to do with writing IPv6 addresses or URLs, but IP4 addresses are a subset of IPv6 addresses </li><li>  This works only on POSIX compatible systems and only on programs that first try to directly translate the address (on some Linux, the type A address is not perceived) </li><li>  For local connections, it is better to use the name localhost, not the computer name :) </li></ol><br><br><h4>  Links </h4><br>  <a href="http://habrahabr.ru/blogs/sysadm/69587/">Alternative way to write IP addresses</a> <br>  <a href="http://www.ping127001.com/pingpage.htm">The ping page</a> <br>  <a href="http://www.opengroup.org/onlinepubs/009695399/functions/inet_addr.html">inet_addr IEEE Std 1003.1</a> </div><p>Source: <a href="https://habr.com/ru/post/73248/">https://habr.com/ru/post/73248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../73234/index.html">Sleep</a></li>
<li><a href="../73238/index.html">The organization of differentiation of the rights of the user on operations in an ASP.NET-application</a></li>
<li><a href="../73240/index.html">Sony returns virtualization to their computers</a></li>
<li><a href="../73241/index.html">Wikinomics. How mass collaboration changes everything</a></li>
<li><a href="../73247/index.html">Unladen Swallow 2009Q3</a></li>
<li><a href="../73249/index.html">Multithreading: which way to think</a></li>
<li><a href="../73250/index.html">Apple closes open source ZFS project</a></li>
<li><a href="../73251/index.html">Browsera - a new site testing tool</a></li>
<li><a href="../73253/index.html">Google Wave - distribution of invites has begun!</a></li>
<li><a href="../73255/index.html">Troll Control</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>