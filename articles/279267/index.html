<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android client for rutracker: bypass the blocking using Google Compression proxy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I believe that all users of the Habr somehow found a way to get to the root-tracker, but sometimes it is too lazy to turn on your torus, proxy, VPN or...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android client for rutracker: bypass the blocking using Google Compression proxy</h1><div class="post__text post__text-html js-mediator-article">  I believe that all users of the Habr somehow found a way to get to the root-tracker, but sometimes it is too lazy to turn on your torus, proxy, VPN or something else.  I now became lazy, and so I decided to write my little client.  To bypass the blocking, I decided to use a google compression proxy.  An interesting, good and useful thing - it is strange that there were no articles on it.  Looking ahead, I will immediately say that everything turned out, and you can try the working version on your device.  However, in the process there were many interesting sorts of nuances that are somewhat more curious than the application itself.  So, let's begin! <br><a name="habracut"></a><br><br><h1>  Google Compression proxy </h1><br>  In order not to repeat Google manuals (you can find all links at the end of the article), I‚Äôll just say that this proxy server allows your Google Chrome to significantly reduce the amount of perceived traffic due to its compression by Google servers.  Proxy can work on HTTP and HTTPS.  In the first case, the address is used by compress.googlezip.net, in the second - proxy.googlezip.net.  Interestingly, the proxy requires its own header.  In the official documentation it is not, but you can find the source from Google and a little dig into them.  They look like <a href="">this</a> (link to the most interesting file, I have already posted on the GiHab, since nothing can be seen in the <a href="https://code.google.com/archive/p/datacompressionproxy/">official repository</a> on the google code). <br>  From there we get such good: <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authHeader = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authValue = <span class="hljs-string"><span class="hljs-string">'ac4500dd3b7579186c1b0620614fdb1f7d61f944'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> timestamp = <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now().toString().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chromeVersion = navigator.appVersion.match(<span class="hljs-regexp"><span class="hljs-regexp">/Chrome\/(\d+)\.(\d+)\.(\d+)\.(\d+)/</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Chrome-Proxy'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">'ps='</span></span> + timestamp + <span class="hljs-string"><span class="hljs-string">'-'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">1000000000</span></span>) + <span class="hljs-string"><span class="hljs-string">'-'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">1000000000</span></span>) + <span class="hljs-string"><span class="hljs-string">'-'</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * <span class="hljs-number"><span class="hljs-number">1000000000</span></span>) + <span class="hljs-string"><span class="hljs-string">', sid='</span></span> + MD5(timestamp + authValue + timestamp) + <span class="hljs-string"><span class="hljs-string">', b='</span></span> + chromeVersion[<span class="hljs-number"><span class="hljs-number">3</span></span>] + <span class="hljs-string"><span class="hljs-string">', p='</span></span> + chromeVersion[<span class="hljs-number"><span class="hljs-number">4</span></span>] + <span class="hljs-string"><span class="hljs-string">', c=win'</span></span> }; };</code> </pre> <br><br>  It's pretty obvious, but <br><div class="spoiler">  <b class="spoiler_title">You can stop more.</b> <div class="spoiler_text">  For each request there should be a Chrome-Proxy header. <br>  It should have the following line: <br><pre> <code class="xml hljs"> ps=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timestamp</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">num1</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">num2</span></span></span><span class="hljs-tag">&gt;</span></span>-<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">num3</span></span></span><span class="hljs-tag">&gt;</span></span>, sid=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">md5</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">string</span></span></span><span class="hljs-tag">&gt;</span></span>, b=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span>, p=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">patch</span></span></span><span class="hljs-tag">&gt;</span></span>, c=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Where: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      timestamp: time in linux timestamp <br>  num1, num2, num3: some random numbers that can be set to 0 <br>  md5 string: md5 authorization string hash <br>  auth string: <pre> <code class="xml hljs">"<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timestamp</span></span></span><span class="hljs-tag">&gt;</span></span>" + "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">auth</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">&gt;</span></span>" + "<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timestamp</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre> <br>  auth key: ac4500dd3b7579186c1b0620614fdb1f7d61f944 - just a certain key ... One for all, and all for one. <br>  build: chrome build number - for example, 2214 <br>  patch: chrome patch number - for example, 115 <br>  platform: platform - for example, "win" <br>  As a complete example, you can cite the following title: <br><blockquote>  Chrome-Proxy: ps = 1439961190-0-0-0, sid = 9fb96126616582c4be88ab7fe26ef593, b = 2214, p = 115, c = win </blockquote><br><br>  Strangely enough and not funny, you can use this very line for any number of requests without any changes ... For example, the extension for Firefox, which is engaged in recompression of traffic, is based on this.  Apparently, protection from a lazy fool was simply made. <br>  However, the honest option would be to rewrite it in Java like this: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] authHeader() { String[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[<span class="hljs-number"><span class="hljs-number">2</span></span>]; result[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">"Chrome-Proxy"</span></span>; String authValue = <span class="hljs-string"><span class="hljs-string">"ac4500dd3b7579186c1b0620614fdb1f7d61f944"</span></span>; String timestamp = Long.toString(System.currentTimeMillis()).substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); String[] chromeVersion = {<span class="hljs-string"><span class="hljs-string">"49"</span></span>, <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-string"><span class="hljs-string">"2623"</span></span>, <span class="hljs-string"><span class="hljs-string">"87"</span></span>}; String sid = (timestamp + authValue + timestamp); sid = Utils.md5(sid); result[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">"ps="</span></span> + timestamp + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + Integer.toString((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.random() * <span class="hljs-number"><span class="hljs-number">1000000000</span></span>)) + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + Integer.toString((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.random() * <span class="hljs-number"><span class="hljs-number">1000000000</span></span>)) + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + Integer.toString((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (Math.random() * <span class="hljs-number"><span class="hljs-number">1000000000</span></span>)) + <span class="hljs-string"><span class="hljs-string">", sid="</span></span> + sid + <span class="hljs-string"><span class="hljs-string">", b="</span></span> + chromeVersion[<span class="hljs-number"><span class="hljs-number">2</span></span>] + <span class="hljs-string"><span class="hljs-string">", p="</span></span> + chromeVersion[<span class="hljs-number"><span class="hljs-number">3</span></span>] + <span class="hljs-string"><span class="hljs-string">", c=win"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br></div></div><br>  Next you need to choose which option for proxying we choose.  My provider is harsh and blocks requests if they go over HTTP via google proxy, so I had to go the right way over SSL. <br><br><h1>  WebView via SSL </h1><br>  In order not to go a long and sad way of writing a client from scratch, I decided to ‚Äújust‚Äù show everything as it is through a standard WebView, since I had already written a simple client that does roughly the same thing, and works smartly even on a heavy web site.  It seems - work for half an hour.  How wrong I was ... If you look at the solutions for proxying WebView on the Internet, it becomes very sad - everyone does something like this: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setKitKatWebViewProxy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Context appContext, String host, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, String exclusionList</span></span></span><span class="hljs-function">)</span></span> { Properties properties = System.getProperties(); properties.setProperty(<span class="hljs-string"><span class="hljs-string">"http.proxyHost"</span></span>, host); properties.setProperty(<span class="hljs-string"><span class="hljs-string">"http.proxyPort"</span></span>, port + <span class="hljs-string"><span class="hljs-string">""</span></span>); properties.setProperty(<span class="hljs-string"><span class="hljs-string">"https.proxyHost"</span></span>, host); properties.setProperty(<span class="hljs-string"><span class="hljs-string">"https.proxyPort"</span></span>, port + <span class="hljs-string"><span class="hljs-string">""</span></span>); properties.setProperty(<span class="hljs-string"><span class="hljs-string">"http.nonProxyHosts"</span></span>, exclusionList); properties.setProperty(<span class="hljs-string"><span class="hljs-string">"https.nonProxyHosts"</span></span>, exclusionList); <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> ... such much shit }</span></span></code> </pre><br>  The rest of the deliberately lowered - there is still about a hundred lines with conditions for the version of the android and eerie shamanism.  At the same time, many still don‚Äôt work, plus there are problems with switching the proxying mode - and it is ‚Äúsolved‚Äù by installing Thread.Sleep (1000) between operations.  Although I am not a Java developer, I just sometimes indulge, I poplohelo.  Common sense prompted me to intercept requests from Webview (for this, WebViewClient has a wonderful function shouldInterceptRequest), and then do the proxying myself.  I even managed to do it: <br><pre> <code class="hljs javascript"> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>.Type.HTTP, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InetSocketAddress(<span class="hljs-string"><span class="hljs-string">"compress.googlezip.net"</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span>)); HttpURLConnection connection = (HttpURLConnection) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(url).openConnection(proxy);</code> </pre><br><br>  Everything is fine, everything works!  Only one problem.  As attentive readers have noticed, the 80th port is indicated in the function parameters.  For a rather ridiculous reason.  Namely - because HttpURLConnection does not know how to work with HTTPS proxies.  Totally.  No  It took me a lot of time to understand that everything is so bad, and that it is impossible to make a HTTPS proxy through HttpURLConnection, or through the popular okHttp.  I became a little thoughtful, then with a decisive gesture dismissed all the arguments of Google that the Apache libraries were not suitable for Android, shook the dust off the tested jars and strongly connected them to the project.  And everything turned out!  The fifth and sixth android cheers apprehended such a terrible offense.  If someone knows how to solve the problem without using Apache libraries, tell us.  Of course, one could do everything on sockets, but this is rather sad. <br><br>  So, we were finally able to display the rutracker's main page.  It would seem that victory is near.  How wrong I was. <br><br><h1>  Advertising </h1><br>  Almost from the first attempt at debugging, I was faced with the fact that everything is monstrously slow.  The reason is pretty obvious - an insane amount of advertisements of all kinds.  I really did not want to do something with it - we all know the position of the rutracker, and the dudes clearly need a lot of gold to protect against DDOS and their native state - but with advertising the application was generally unrealistic to use.  The correct solution would be to find it and cut it out from the body of the page, but the quicker approach to implement was simply to cut it into hosts: <br><br><div class="spoiler">  <b class="spoiler_title">pretty obvious code</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_adv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Uri url)</span></span></span><span class="hljs-function"> </span></span>{ String[] adv_hosts = {<span class="hljs-string"><span class="hljs-string">"marketgid.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"adriver.ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"thisclick.network"</span></span>, <span class="hljs-string"><span class="hljs-string">"hghit.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"onedmp.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"acint.net"</span></span>, <span class="hljs-string"><span class="hljs-string">"yadro.ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"tovarro.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"marketgid.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"rtb.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"adx1.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"directadvert.ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"rambler.ru"</span></span>}; String[] adv_paths = {<span class="hljs-string"><span class="hljs-string">"brand"</span></span>, <span class="hljs-string"><span class="hljs-string">"iframe"</span></span>}; String host = url.getHost(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String item : adv_hosts) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringUtils.containsIgnoreCase(host, item)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringUtils.containsIgnoreCase(url.getHost(), <span class="hljs-string"><span class="hljs-string">"rutracker.org"</span></span>)) { String path = url.getPath(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String item : adv_paths) { { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringUtils.containsIgnoreCase(path, item)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }</code> </pre><br></div></div><br><br>  And after that we just chop off its receipt: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Utils.is_adv(url)) { Log.d(<span class="hljs-string"><span class="hljs-string">"WebView"</span></span>, <span class="hljs-string"><span class="hljs-string">"Not fetching advertisment"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebResourceResponse(<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); }</code> </pre><br>  In hindsight, I just thought that it might be easier to make a list of allowed hosts ... But with this very mind, everyone is strong. <br>  Now the application began to work not only with acceptable, but with a very vigorous and pleasant speed.  If the owners of the rutracker are upset, then I will remove the blocking - but most likely with the application.  With monstrous brakes it simply will not make sense. <br><br><h1>  Submitting forms </h1><br>  Leaning back on the chair, I found ... That authorization does not work.  What was actually quite obvious was that, because in the request I intercepted and transmitted further, I did not send the data that should go to POST.  It would seem a couple of minutes - and everything will be fine.  How wrong I was ... <br>  It turned out that there are no ways to intercept POST from WebView.  Totally.  No  Best practices are to embed your javascript into a page and call special Java methods from it.  Or transfer server to GET requests.  From the first option, I am somewhat poplohelo, and the second is not available for obvious reasons.  Yes, and would be incorrect.  After scratching my head and trying to catch POST in several more places, I came to the conclusion that there was still no normal solution.  As a result, made the decision funny.  Namely, when a page is received, change the method of all forms from POST to GET.  And after this, the next time you convert the parameters passed in the address bar to the body of the POST request.  It sounds awful, but it's not so bad if you do not have an address bar in which you can disgrace, large variables or files to transfer.  Although no, I lie of course.  Everything is very bad, but I did not find another adequate way. <br><div class="spoiler">  <b class="spoiler_title">pretty obvious code</b> <div class="spoiler_text"><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> UrlEncodedFormEntity </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get2post</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Uri url</span></span></span><span class="hljs-function">)</span></span> { Set&lt;String&gt; <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> = url.getQueryParameterNames(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">params</span></span>.isEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; List&lt;NameValuePair&gt; paramsArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String name : <span class="hljs-keyword"><span class="hljs-keyword">params</span></span>) { Log.d(<span class="hljs-string"><span class="hljs-string">"Utils"</span></span>, <span class="hljs-string"><span class="hljs-string">"converting parameter "</span></span> + name + <span class="hljs-string"><span class="hljs-string">" to post"</span></span>); paramsArray.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicNameValuePair(name, url.getQueryParameter(name))); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlEncodedFormEntity(paramsArray, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (UnsupportedEncodingException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre><br></div></div><br><br><h1>  Where are my cookies, dude? </h1><br>  When I once again sat back in the chair after successfully passed the authorization and clicked the following link, I found that the authorization is dying on the next page.  That, in general, is also quite logical, since nobody magically controls the cookies, and we send all the headers manually.  But here, for once, I was not mistaken in that <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Utils.is_login_form(url)) { <span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>[] <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> = response.getAllHeaders(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">Header</span></span> header1 : <span class="hljs-keyword"><span class="hljs-keyword">all</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.d("WebView", "LOGIN HEADER: " + header1.getName() + " : " + header1.getValue()); } <span class="hljs-keyword"><span class="hljs-keyword">Header</span></span>[] cookies = response.getHeaders("set-cookie"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookies.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { String val = cookies[<span class="hljs-number"><span class="hljs-number">0</span></span>].getValue(); val = val.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, val.indexOf(";")); authCookie = val.trim(); CookieManager.put(MainContext, authCookie); <span class="hljs-keyword"><span class="hljs-keyword">Log</span></span>.d("WebView", "=== Auth cookie: ==='" + val + "'"); //redirect does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">work</span></span> o_O String msgText = "&lt;script&gt;window.location = \"http://rutracker.org/forum/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.php\"&lt;/script&gt;"; ByteArrayInputStream msgStream = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ByteArrayInputStream(msgText.getBytes("UTF-8")); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WebResourceResponse("text/html", "UTF-8", msgStream); } }</code> </pre><br></div></div><br>  True, an attentive reader will find that there is some kind of strange redirection javascript.  Yes, that's it.  The response should have been 302 authorization header, but for some reason it did not come anywhere.  As a result, I found myself on the forum page at an incorrect address with the domain login.rutracker.org ‚Äî everything worked, but since links are relative everywhere, the next click was a bummer.  By the way, here you can also notice that we carefully save the user cookie so that you do not have to log in again later. <br><br><h1>  Now is that all ?! </h1><br>  It was with this question that I once again opened the page, already confident that I did not miss anything.  How can I ... In general, you could freely search through a native search or through Google without authorization, you could watch any topic, you could not only one ... Download torrent.  Since by clicking links nothing good happens.  But this time it was also easy - the program menu with the Share button was added to the interface, which allows you to send a link to Magnet anywhere.  It would be more convenient to throw a link to a torrent file, but you will obviously be blocked from it.  Of course, it would be possible to download a torrent file and transfer it through sharing - but this is some other time. <br><br><h1>  Result </h1><br>  You can look at the screenshots - the <a href="">main page</a> and <a href="">sharing magnet links from the topic</a> . <br><br><h1>  It remains only to publish </h1><br>  Based on those strange android applications that I posted before, I got the feeling that they are missing everything.  So, with a light heart, I sent the application for publication and sat down to write an article.  Usually the application appeared on google play for a couple of hours, so there was just enough time.  Unfortunately, this time was 8 hours.  And the answer came <br><div class="spoiler">  <b class="spoiler_title">Here is a letter.</b> <div class="spoiler_text">  After review, rutracker free - unofficial, ru.jehy.proxy_rutracker, has been suspended and removed from the play. <br>  <strong>Next Steps</strong> <br><ol><li>  Read through the article. </li><li>  Make sure your app is in accordance with the <a href="https://play.google.com/about/developer-content-policy.html">Developer Policies</a> .  If you‚Äôre there, you‚Äôll be able to get it. </li><li>  <a href="https://play.google.com/apps/publish">Sign up for your Developer Console</a> and a new app name. </li></ol><br>  <strong>What if I have permission to use the content?</strong> <br><br>  <a href="https://support.google.com/googleplay/android-developer/troubleshooter/2993242">Contact our support team</a> to provide a justification for its use.  If you want to have a google account, you can use it.  If your account is terminated, you may be able to pay for it. may have been in error, please contact our <a href="https://support.google.com/googleplay/android-developer/troubleshooter/2993242">policy support team</a> .  You can get back to you within 2 business days. <br></div></div><br><br>  It is not entirely clear who impersonated whom, but I had three options, what Google didn‚Äôt like: <br><ol><li>  What I took from somewhere icons; </li><li>  What I mentioned in the comments is that the application works through a google compression proxy; </li><li>  That as banners, I used the options of the funny logos of the rutracker from the new contest; </li></ol><br>  Of course, in any case, it is rather unpleasant that you need to rename pakage for some reason and download it again.  Yes, and you also warned that "I remember you, and once again do so - banned."  Well, somehow gopnicheski.  I did not expect it, it's a shame. <br>  Of the options mentioned above, I decided that the second is most likely to blame - the mention of Google in vain.  Well, okay, as you say - I did not write how the application works.  Just "an application with proxying, which allows you to bypass the lock rutracker.org".  Well, at the same time I put the curves drawn in five minutes icons and similar banners.  And what do you think - my efforts were rewarded!  Then came to me <div class="spoiler">  <b class="spoiler_title">next answer.</b> <div class="spoiler_text">  After review, ru.rautracker_free, ru.rautracker_free. <br><br>  Next Steps <br><br>  Read through the webviews spam. <br>  Make sure your app is compliant with the Spam Policies.  Remember that you couldn‚Äôt have any apps. <br>  It is possible to bring your app in compliance with your app. <br></div></div><br><br>  In general, I was accused of not giving the application only referral links, or not doing anything other than a webview.  There is nothing ‚Äúleft‚Äù in the application, and calling it ‚Äúnormal mapping‚Äù is also wrong - there is quite a lot of work on proxying.  Well, and this especially surprised me in the light of the fact that I had already successfully downloaded applications on Google Play, which in fact only consist of web views to the site.  There were two nuances - there was authorization in the application, and I was the owner of the site I was webcasting on.  But I didn‚Äôt indicate this, and Google couldn‚Äôt find out. <br>  In general, I answered both of these accusations with a request to sort it out - there is no answer day, maybe the answer will come another day.  Although hope is somehow small.  So we put so far the application from APK.  If it does appear on Google Play, then it will be possible to upgrade from there. <br><br><h1>  ToDo </h1><br>  If you make a full-fledged pleasant application, then you could add a lot of good things.  Including <br><ol><li>  Styles with adaptation to viewing from the phone and tablet;  <b>UPD: done to some extent;</b> </li><li>  Automatic update;  <b>UPD: done;</b> </li><li>  Correct advertising cut; </li><li>  Transfer torrents torrent files, not magnet links; </li><li>  Exit from the authorized state on the rutracker (yes, now you will log in there forever); </li><li>  Any meaningful messages about probable errors; </li><li>  Compatibility with a large number of devices - now you can try to run on Android from 4.0 to 6 - but the result is unpredictable - you need to test a lot.  I work on Nexus 5 with Android 6 and on Sony Xperia Z3 with Android 5; </li><li>  Convenient input of authorization and search without poking at the terrible little elements of the web form; </li><li>  Remove some copy-from-code from the code; </li><li>  Add encryption of a stored user cookie with a unique device key in case data is stolen from the phone; </li><li>  Implement the monetization of the application, its pop-up banners and links that would bring me tons of gold. </li></ol><br>  But, unfortunately, I don‚Äôt have time to do this seriously - I just wanted to make a working prototype - to show that web applications in Android applications work, work well and quickly.  Along the way, however, the opinion was confirmed that the average quality of Android development at the hospital suffers quite a bit, standard libraries do not cover all cases, and there are a large number of strange tasks that have not been implemented by anyone. <br>  I would be glad if someone takes this code to develop a more serious application or sends pull requests - I promise to watch them carefully and use them. <br><br><h1>  Q &amp; A </h1><br>  - But it‚Äôs much easier to go to the root tracker through XXX (for example, simply turning on the traffic saving on the phone or in the browser). <br>  - Yes. <br><br>  - And what if Google blocks the root tracker? <br>  - It may well be stated in their policy that they are blocking resources that are prohibited in your country.  Well, that's okay - ways around the thousand. <br><br>  - And if the root tracker blocks Google for a large number of visits from their proxy? <br>  - To them, and so now go through it, just using chrome.  So it is unlikely.  And in general, banning everyone is a bad idea, so you can become an official. <br><br>  - Your code is terrible! <br>  - Yes, I have already mentioned that I am not a Java developer. <br><br>  - It didn't work for me. <br>  - Yes, this is a common Android problem - a full-fledged application should be tested 10 times longer than writing.  Alas, I had no such opportunity.  Send errors, pull requests - we will fix it. <br><br>  - Is it possible to use Google Compression Proxy in general? <br>  - While it is not clear - the application was banned before this potential issue. <br><br>  - I do not trust you, for sure you steal all my passwords and download my own torrents. <br>  - Please - build the application yourself from the source. <br><br>  - Why are the icons so scary? <br>  - Look under the heading ‚Äúit remains only to publish‚Äù - everything is explained there. <br><br>  - It's freedom for evil robots and spiders! <br>  - No, do not flatter yourself.  Obviously, there are limits and checks for robots too.  There are much simpler ways for bots. <br><br>  - The site is crookedly displayed. <br>  - Yes, in some places there are problems.  But rather related to poor-quality layout. <br><br><h1>  Hi rutrekeru </h1><br>  Separately - a few wishes for the rutraker administration in case they suddenly look in here. <br><div class="spoiler">  <b class="spoiler_title">Wishlist</b> <div class="spoiler_text"><ol><li>  Please consider alternative monetization options.  Anyway, most users bypass these terrible banner garlands with adblokom. </li><li>  It would be good to introduce various authorization providers - google or facebook, for example. </li><li>  Update the layout and appearance to something more beautiful, comfortable and preferably with a mobile version. </li></ol><br></div></div><br><h1>  Links </h1><br>  <b>UPD</b> : <a href="https://habrahabr.ru/post/279553/">post</a> about how the update is implemented, and how to live without Google Play; <br><br><ol><li>  For those who have not mastered the whole text - once again screenshots: the <a href="">main page</a> and <a href="">sharing magnet links from the topic</a> . </li><li>  Actual <a href="https://github.com/jehy/rutracker-free">source code</a> and github <a href="https://github.com/jehy/rutracker-free/releases">releases</a> ; </li><li>  <a href="http://whois.jehy.ru/">Here</a> you can take me to work - yes, I'm looking for her; </li><li>  A fun <a href="http://wirama.web.id/using-google-chromes-compression-proxy-for-every-browser/">article</a> about how to use Google Compression Proxy + Squid.  I started it with her; </li><li>  <a href="https://code.google.com/archive/p/datacompressionproxy/">Here</a> are the sources from the compression proxy from Google.  Since the google code does not give them a look, you can look at <a href="">my githaba</a> .  I also assorted it; </li><li>  What is a google compression proxy <a href="https://developer.chrome.com/multidevice/data-compression">for the user</a> and <a href="https://developer.chrome.com/multidevice/data-compression-for-isps">for the administrator</a> ; </li><li>  Good <a href="http://superuser.com/questions/945924/how-do-i-use-google-data-compression-proxy-on-firefox">answer and analysis of the google compression proxy standard</a> , though only for HTTP traffic, not HTTPS.  There is an example implementation for firefox.  I translated it for the article; </li><li>  <a href="https://github.com/miku-nyan/DCP-bridge">A java proxy implementation that proxies</a> through the google data compression server.  Made for some image board.  Good code, there is something to see; </li><li>  The only option I found was for <a href="https-proxy">proxying HTTP traffic through an HTTPS proxy</a> using apache libraries.  I was finishing it. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/279267/">https://habr.com/ru/post/279267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279253/index.html">Ether through the prism Or new Rocket AC AirPrism</a></li>
<li><a href="../279255/index.html">Explaining the inexplicable. Part 3</a></li>
<li><a href="../279257/index.html">Yandex is killing a business, or be careful with the #main block</a></li>
<li><a href="../279261/index.html">No one wants to use your product.</a></li>
<li><a href="../279263/index.html">Welcome to Android Devs Meetup March 17</a></li>
<li><a href="../279269/index.html">Custom floating point format on FPGA</a></li>
<li><a href="../279275/index.html">CLRium # 3. Announcement of speakers</a></li>
<li><a href="../279277/index.html">Connect to the Jump Start online event March 15: "Infrastructure as an Azure Resource Manager-based service"</a></li>
<li><a href="../279279/index.html">1.5 Compiling SFML with CMake</a></li>
<li><a href="../279281/index.html">Containerization mechanisms: namespaces</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>