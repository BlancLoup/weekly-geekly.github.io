<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using OpenStreetMap with SQL Server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's no secret that OpenStreetMap is a young, dynamically developing project, in which, now you can find a lot of useful information. This information...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using OpenStreetMap with SQL Server</h1><div class="post__text post__text-html js-mediator-article"> It's no secret that OpenStreetMap is a young, dynamically developing project, in which, now you can find a lot of useful information.  This information is already structured, therefore, with a little effort, it is possible to extract and filter absolutely everything that the soul can wish for. <br>  The purpose of this post is to show how this information can be stored and retrieved using the SQL Server database server.  SQL Server since the 2008 version allows you to store and process geometric and geographic data types.  Therefore, it is suitable for this purpose, as well as possible. <br><a name="habracut"></a><br>  To begin with, we will have to export the data in a form understandable for the database server.  Fortunately, there is no need to reinvent the wheel.  OpenStreetMap supports exporting to XML format which is understandable for most modern databases, although by mistake they are called OSM <br>  Suppose that we want to see and process information about all banks in the city of St. Petersburg.  To do this, you need to find the necessary information on the project and then click the "Export" button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a44/114/ef2/a44114ef26c6dcbdd86abbfa29fa4cf3.png" alt="image"><br><br>  At the same time, it is necessary to select the ‚ÄúData (OpenStreetMap XML)‚Äù export format <br>  Unfortunately, and perhaps fortunately, sometimes, the number of objects in the selected area exceeds the limit.  Then a saved osm file can come to the rescue, from the <a href="http://gis-lab.info/projects/osm-export.html">gis-lab.info</a> resource <a href="http://gis-lab.info/projects/osm-export.html">.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If necessary, we select St. Petersburg and download the necessary osm file. <br>  Now we can load the received data into the database.  As you remember, we were going to do this in SQL Server, or rather, I will use SQL Server 2008R2. <br><br>  First, we convert the data into a variable of xml type: <br><br> <code>DECLARE @x xml; <br> SET @x = (SELECT * FROM OPENROWSET( <br> BULK 'C:\tmp\stpeter.osm', <br> SINGLE_BLOB) AS x);</code> <br> <br>  Then create tables of nodes (nodes) and their descriptions (nodestag) <br>  First, first: <br> <code>IF object_id('nodes') IS NOT NULL <br> DROP TABLE nodes <br> <br> CREATE TABLE nodes ( <br> nodeid int, <br> latitude float, <br> longitude float, <br> geog4326 geography <br> ); <br> INSERT INTO nodes <br> SELECT <br> OSMnode.value('@id', 'int') AS nodeid, <br> OSMnode.value('@lat', 'float') AS latitude, <br> OSMnode.value('@lon', 'float') AS longitude, <br> geography::Point(OSMnode.value('@lat', 'float'), OSMnode.value('@lon', 'float'), 4326) AS geog4326 <br> FROM <br> @x.nodes('/osm/node') AS OSM(OSMnode)</code> <br> <br>  Here's what the data looks like in SQL Server Management Studio: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/87e/e98/016/87ee98016617f7aae32d3710eb00e96d.png" alt="image"><br><br>  Each node can (optionally) have any number of tags.  In the XML source file, they are presented in the child element (s) of each We define them: <br><br> <code>IF object_id('nodetags') IS NOT NULL <br> DROP TABLE nodetags <br> CREATE TABLE nodetags ( <br> nodeid int, <br> tagname varchar(32), <br> tagvalue varchar(32) <br> ); <br> INSERT INTO nodetags <br> SELECT <br> OSMNode.e.value('(@id)[1]', 'int') AS 'NodeID', <br> OSMNodeTag.e.value('@k', 'nvarchar(32)') AS 'TagName', <br> OSMNodeTag.e.value('@v', 'nvarchar(32)') AS 'TagValue' <br> FROM <br> @x.nodes('/osm/node') AS OSMNode(e) <br> CROSS APPLY <br> OSMNode.e.nodes('tag') AS OSMNodeTag(e)</code> <br> <br>  Well, let's try to get something for which we all started it: <br><br> <code>SELECT <br> n.nodeid, <br> n.geog4326, <br> nt.TagValue <br> FROM nodes n <br> LEFT JOIN nodetags nt ON n.nodeid = nt.nodeid AND TagName in ('Name' ,'operator') <br> WHERE n.nodeid IN <br> ( <br> SELECT nodeid from nodetags <br> where tagvalue like '%%' <br> )</code> <br> <br>  Here‚Äôs how points are displayed in SSMS: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/470/cc4/8c3/470cc48c38a8bd4776f81cfe6ff581df.png" alt="image"><br><br>  It is also easy to transfer the obtained data, for example, to Bing cards (I did this with the help of microsoft Report Builder). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afd/de6/4a5/afdde64a5f733d810b6150ae34d06e93.png" alt="image"><br><br>  I can only thank the guys with gis-lab.info And also regret that there is no separate testing ground for the city of Kiev.  Such entities as the whole Ukraine are extremely difficult to roll ... </div><p>Source: <a href="https://habr.com/ru/post/113788/">https://habr.com/ru/post/113788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113783/index.html">Distree XXL: Blu-ray player on Intel Atom, keyboard for tablet PCs and others</a></li>
<li><a href="../113784/index.html">The future of the Windows Phone platform is revealed: multitasking, IE9 and GPU acceleration of web pages, integration with Kinect, and more.</a></li>
<li><a href="../113785/index.html">20 years of the company Blizzard Entertainment</a></li>
<li><a href="../113786/index.html">VKontakte privacy panic - explanations</a></li>
<li><a href="../113787/index.html">Who needs me?</a></li>
<li><a href="../113789/index.html">Crowdsourcing translation of the Twitter interface into Russian has begun</a></li>
<li><a href="../113790/index.html">HTML5 Web Sql Database and Google Gears support with examples</a></li>
<li><a href="../113791/index.html">Optimus 3D smartphone and Optimus Pad tablet: a preliminary review of LG's new products at MWC-2011</a></li>
<li><a href="../113792/index.html">Signaling System # 7 / Signaling System # 7</a></li>
<li><a href="../113793/index.html">Moscow ALT.NET: 2nd meeting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>