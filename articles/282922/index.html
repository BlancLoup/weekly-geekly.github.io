<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with WAV files using PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that I thought about how to display on the site information about the downloaded audio file. First I decided to deal with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with WAV files using PHP</h1><div class="post__text post__text-html js-mediator-article">  It all started with the fact that I thought about how to display on the site information about the downloaded audio file.  First I decided to deal with the simplest format - wav.  As it turned out, there is nothing difficult in this and writing about it, in general, there would be no point, good, information about how the wav file ‚Äúfrom the inside‚Äù is full on the Internet. <br><br>  <s>And then Ostap suffered</s> And then a bright thought came to mind that it would be fun not only to display information about the file, but also to be able to generate such a file on the fly.  I think everyone has seen all sorts of ‚Äúonline pianos‚Äù on the net and stuff, right? <br><br>  So, what I managed to do for 2 pm - under the cut. <br><a name="habracut"></a><br>  So, to begin with, let us return to the structure of the WAV file, as such.  For simplicity, we take the simplest single-channel wav file without compression. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Any wav file consists of several sections (chunks).  In detail about all sections you can read, for example, <a href="http://microsin.net/programming/pc/wav-format.html">by reference</a> , I‚Äôll focus on three main ones: <br><br><ul><li>  section type - <pre>  "RIFF" </pre></li><li>  format section - <pre>  fmt </pre></li><li>  data section - <pre>  "data" </pre></li></ul><br>  Each section has its ID, section size and, in fact, some data specific to this section. <br><br>  Section RIFF is simple to disgrace: "RIFF &lt;file size-8&gt; WAVE" <br><br>  &lt;file size-8&gt; because this value describes "how many bytes are contained further."  Accordingly, 4 bytes for the value of "how much" and another 4 for the "RIFF" which was at the beginning. <br><br>  The format section stores the main information of interest for the common person: Sample Rate (sampling frequency, for example, 44100 Hz), the number of channels (1 = mono, 2 = stereo, and so on). <br><br>  In the data section, in fact, we need the necessary audio data for playing.  In essence, they are the amplitude of a wave at a point in time. <br><br>  Proceeding from the foregoing and proceeding from the specification of the format itself, nothing prevents us from writing the simplest classes describing each section we need and the simplest parser that will read the wav file and create the objects we need. <br><br><div class="spoiler">  <b class="spoiler_title">Header (Header.php)</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Header</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $size; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $format; ...</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Format section (FormatSection.php)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FormatSection</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $size; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $audioFormat; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $numberOfChannels; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $sampleRate; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $byteRate; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $blockAlign; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $bitsPerSample; ...</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Data Section (DataSection.php)</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataSection</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $size; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $raw; ...</code> </pre><br></div></div><br>  In the code above, all the logic is removed, we are now interested only in the structure of the data itself. <br><br>  Actually, for their reading we will make a small wrapper-helper for fread for more convenient reading of binary data. <br><br><div class="spoiler">  <b class="spoiler_title">Helper.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Helper</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle, $length)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::readUnpacked($handle, <span class="hljs-string"><span class="hljs-string">'a*'</span></span>, $length); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readLong</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::readUnpacked($handle, <span class="hljs-string"><span class="hljs-string">'V'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readWord</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::readUnpacked($handle, <span class="hljs-string"><span class="hljs-string">'v'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readUnpacked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle, $type, $length)</span></span></span><span class="hljs-function"> </span></span>{ $data = unpack($type, fread($handle, $length)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_pop($data); } ... }</code> </pre><br></div></div><br>  It remains the case for small, take and read the contents of the wav file: <br><br><div class="spoiler">  <b class="spoiler_title">Reading data from a wav file</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parser</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filename)</span></span></span><span class="hljs-function"> </span></span>{ ... $handle = fopen($filename, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $header = Header::createFromArray(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::parseHeader($handle)); $formatSection = FormatSection::createFromArray(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::parseFormatSection($handle)); $dataSection = DataSection::createFromArray(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::parseDataSection($handle)); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { fclose($handle); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioFile($header, $formatSection, $dataSection); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; Helper::readString($handle, <span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-string"><span class="hljs-string">'size'</span></span> =&gt; Helper::readLong($handle), <span class="hljs-string"><span class="hljs-string">'format'</span></span> =&gt; Helper::readString($handle, <span class="hljs-number"><span class="hljs-number">4</span></span>), ]; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseFormatSection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; Helper::readString($handle, <span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-string"><span class="hljs-string">'size'</span></span> =&gt; Helper::readLong($handle), <span class="hljs-string"><span class="hljs-string">'audioFormat'</span></span> =&gt; Helper::readWord($handle), <span class="hljs-string"><span class="hljs-string">'numberOfChannels'</span></span> =&gt; Helper::readWord($handle), <span class="hljs-string"><span class="hljs-string">'sampleRate'</span></span> =&gt; Helper::readLong($handle), <span class="hljs-string"><span class="hljs-string">'byteRate'</span></span> =&gt; Helper::readLong($handle), <span class="hljs-string"><span class="hljs-string">'blockAlign'</span></span> =&gt; Helper::readWord($handle), <span class="hljs-string"><span class="hljs-string">'bitsPerSample'</span></span> =&gt; Helper::readWord($handle), ]; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseDataSection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($handle)</span></span></span><span class="hljs-function"> </span></span>{ $data = [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; Helper::readString($handle, <span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-string"><span class="hljs-string">'size'</span></span> =&gt; Helper::readLong($handle), ]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($data[<span class="hljs-string"><span class="hljs-string">'size'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $data[<span class="hljs-string"><span class="hljs-string">'raw'</span></span>] = fread($handle, $data[<span class="hljs-string"><span class="hljs-string">'size'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $data; }</code> </pre><br></div></div><br>  So, the data obtained, we can bring them in the right place by simply doing something in the spirit: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $audio-&gt;getSampleRate();</code> </pre><br><h3>  Creating wav files </h3><br>  So, I, as a person who graduated from music school once, was interested in the generation of melodies based on notes.  It remains only to shift the knowledge of musical literacy and physics to the code. <br><br>  The simplest step in this business was to turn a note into a code.  In fact, any note is characterized primarily by the frequency of the sound.  For example, the note ‚Äúla‚Äù is the frequency of 440 Hz (the standard frequency of the tuning fork for tuning musical instruments). <br><br>  In fact, we can only compare each note to its frequency.  Total notes (tones) in octave 7, and half tones - 12. And some half tones have several spellings.  For example, "F-flat" is the same as "mi".  Or G sharp is the same as A flat. <br><br>  So, turn this knowledge into code: <br><br><div class="spoiler">  <b class="spoiler_title">Frequency constants for all notes</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Note</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> C = <span class="hljs-number"><span class="hljs-number">261.63</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> C_SHARP = <span class="hljs-number"><span class="hljs-number">277.18</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> D = <span class="hljs-number"><span class="hljs-number">293.66</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> D_FLAT = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::C_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> D_SHARP = <span class="hljs-number"><span class="hljs-number">311.13</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> E = <span class="hljs-number"><span class="hljs-number">329.63</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> E_FLAT = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::D_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> E_SHARP = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::F; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> F = <span class="hljs-number"><span class="hljs-number">346.23</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> F_FLAT = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::E; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> F_SHARP = <span class="hljs-number"><span class="hljs-number">369.99</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> G = <span class="hljs-number"><span class="hljs-number">392.00</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> G_FLAT = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::F_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> G_SHARP = <span class="hljs-number"><span class="hljs-number">415.30</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> A = <span class="hljs-number"><span class="hljs-number">440.00</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> A_FLAT = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::G_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> A_SHARP = <span class="hljs-number"><span class="hljs-number">466.16</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> H = <span class="hljs-number"><span class="hljs-number">493.88</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> H_FLAT = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::A_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($note)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($note) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::C; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'C#'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::C_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::D; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'D#'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::D_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'E'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::E; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'E#'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::E_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'F'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::F; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'F#'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::F_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'G'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::G; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'G#'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::G_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::A; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'A#'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::A_SHARP; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::H_FLAT; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'H'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::H; } } }</code> </pre><br></div></div><br>  In general, music is quite an exact science.  In our case, this, first of all, means that all possible sounds of various instruments have long been described by physicists and mathematicians, which, in fact, allows us to produce, for example, synthesizers.  Details on the synthesis of sound waves are written, for example, <a href="http://www.acoustics.salford.ac.uk/acoustics_info/sound_synthesis/">here</a> . <br><br>  Well, since I am also lazy, I didn‚Äôt have a desire to understand the whole matter in detail, so I began to google furiously.  Information about the emulation of the sounds of various musical instruments in Russian was not found absolutely nothing (maybe, of course, I was looking bad, but not the essence).  But in the end I managed to find an audio synthesizer, though on JavaScript ( <a href="https://github.com/keithwhor/audiosynth">GitHub</a> ).  In general, it remained only to translate the JS-code in PHP, which I did. <br><br>  As a result, we get SampleBuilder, with which we can create samples (pieces of wav-data) by specifying the note, octave and duration of the sound. <br><br>  The code in more detail - by spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Samplebuilder</b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Piano sound generator</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Piano</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Generator</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDampen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sampleRate = null, $frequency = null, $volume = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pow(<span class="hljs-number"><span class="hljs-number">0.5</span></span> * log(($frequency * $volume) / $sampleRate), <span class="hljs-number"><span class="hljs-number">2</span></span>); } ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getWave</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sampleRate, $frequency, $volume, $i)</span></span></span><span class="hljs-function"> </span></span>{ $base = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getModulations()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> call_user_func_array($base, [ $i, $sampleRate, $frequency, pow(call_user_func_array($base, [$i, $sampleRate, $frequency, <span class="hljs-number"><span class="hljs-number">0</span></span>]), <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">0.75</span></span> * call_user_func_array($base, [$i, $sampleRate, $frequency, <span class="hljs-number"><span class="hljs-number">0.25</span></span>]) + <span class="hljs-number"><span class="hljs-number">0.1</span></span> * call_user_func_array($base, [$i, $sampleRate, $frequency, <span class="hljs-number"><span class="hljs-number">0.5</span></span>]) ]); } ... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getModulations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($i, $sampleRate, $frequency, $x)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * sin(<span class="hljs-number"><span class="hljs-number">2</span></span> * M_PI * (($i / $sampleRate) * $frequency) + $x); }, ... ]; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Samplebuilder</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Generator */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $generator; ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">note</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($note, $octave, $duration)</span></span></span><span class="hljs-function"> </span></span>{ $result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \SplFixedArray((int) ceil(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate() * $duration * <span class="hljs-number"><span class="hljs-number">2</span></span>)); $octave = min(<span class="hljs-number"><span class="hljs-number">8</span></span>, max(<span class="hljs-number"><span class="hljs-number">1</span></span>, $octave)); $frequency = Note::get($note) * pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, $octave - <span class="hljs-number"><span class="hljs-number">4</span></span>); $attack = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generator-&gt;getAttack(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate(), $frequency, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getVolume()); $dampen = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generator-&gt;getDampen(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate(), $frequency, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getVolume()); $attackLength = (int) (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate() * $attack); $decayLength = (int) (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate() * $duration); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $attackLength; $i++) { $value = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getVolume() * ($i / (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate() * $attack)) * <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getGenerator()-&gt;getWave( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate(), $frequency, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getVolume(), $i ); $result[$i &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>] = Helper::packChar($value); $result[($i &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] = Helper::packChar($value &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; $i &lt; $decayLength; $i++) { $value = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getVolume() * pow((<span class="hljs-number"><span class="hljs-number">1</span></span> - (($i - (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate() * $attack)) / (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate() * ($duration - $attack)))), $dampen) * <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getGenerator()-&gt;getWave( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSampleRate(), $frequency, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getVolume(), $i ); $result[$i &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>] = Helper::packChar($value); $result[($i &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>] = Helper::packChar($value &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Sample($result-&gt;getSize(), implode(<span class="hljs-string"><span class="hljs-string">''</span></span>, $result-&gt;toArray())); } }</code> </pre><br></div></div><br></div></div><br>  Well, and a small example of code that loses the beginning of the well-known ‚ÄúTo Elise‚Äù L. Beethoven. <br><br><div class="spoiler">  <b class="spoiler_title">For Elise in PHP</b> <div class="spoiler_text"><pre> <code class="php hljs">$sampleBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Wav\SampleBuilder(\Wav\Generator\Piano::NAME); $samples = [ $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'E'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'D#'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'E'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'D#'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'E'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'H'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'D'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'C'</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>), $sampleBuilder-&gt;note(<span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), ]; $builder = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Wav\Builder()) -&gt;setAudioFormat(\Wav\WaveFormat::PCM) -&gt;setNumberOfChannels(<span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt;setSampleRate(\Wav\Builder::DEFAULT_SAMPLE_RATE) -&gt;setByteRate(\Wav\Builder::DEFAULT_SAMPLE_RATE * <span class="hljs-number"><span class="hljs-number">1</span></span> * <span class="hljs-number"><span class="hljs-number">16</span></span> / <span class="hljs-number"><span class="hljs-number">8</span></span>) -&gt;setBlockAlign(<span class="hljs-number"><span class="hljs-number">1</span></span> * <span class="hljs-number"><span class="hljs-number">16</span></span> / <span class="hljs-number"><span class="hljs-number">8</span></span>) -&gt;setBitsPerSample(<span class="hljs-number"><span class="hljs-number">16</span></span>) -&gt;setSamples($samples); $audio = $builder-&gt;build(); $audio-&gt;returnContent();</code> </pre><br></div></div><br><h3>  Links </h3><br>  The code is fully posted on github: <a href="https://github.com/nkolosov/wav">https://github.com/nkolosov/wav</a> <br><br>  If someone is interested, you can connect to your project with the help of composer: <br><br> <code>composer require nkolosov/wav <br></code> <br><h3>  Future plans </h3><br>  Well, first of all, I would like to implement full support for wav-files (processing all sections), implement support for multi-channel files, perhaps support for various wav formats (with compression, etc.), implement a graphical wave display (on Habr√© there was an article about <a href="https://habrahabr.ru/post/113239/">how to do it in Python</a> , I'm also interested in doing it in PHP). <br><br>  In terms of generation, add some more instruments, try to make the sound smoother, so that you can actually copy whole pieces of music into code, realize the ability to play chords, etc. <br><br>  If you want to join - welcome to GitHub. </div><p>Source: <a href="https://habr.com/ru/post/282922/">https://habr.com/ru/post/282922/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../282910/index.html">NB-IoT: narrow band - broad prospects</a></li>
<li><a href="../282912/index.html">We send data from Arduino to Azure IoT Hub</a></li>
<li><a href="../282914/index.html">Writing the background process on Apache Cordova</a></li>
<li><a href="../282916/index.html">IMAPSync. Transfer mail between servers</a></li>
<li><a href="../282918/index.html">Performance Indicators: KVM vs. Xen</a></li>
<li><a href="../282924/index.html">Test Gradle Plugins Correctly</a></li>
<li><a href="../282926/index.html">About Modbus and Intel Edison Protocol</a></li>
<li><a href="../282930/index.html">Smart or virtual hardware drivers</a></li>
<li><a href="../282932/index.html">About the usefulness of indexes by expressions</a></li>
<li><a href="../282934/index.html">Easy Hack: Java application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>