<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zipper - derived from type</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zipper is a way to represent the data type, allowing you to go through the structure and change individual elements, despite the functional purity. Fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zipper - derived from type</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://en.wikipedia.org/wiki/Zipper_(data_structure)">Zipper</a> is a way to represent the data type, allowing you to go through the structure and change individual elements, despite the functional purity.  For example, if according to the list we can only run forward, doing something with elements, then with a zipper we can ‚Äúbe‚Äù in a certain element, move back and forth and change the current element. <br>  Interestingly, a zipper for some type can be obtained literally by taking its derivative. <br><a name="habracut"></a><br>  Let's try to come up with a zipper first for a list without mathematics. <br>  We need the ability to go through the list forward and back, as well as to have a separately taken current value in order to change it. <br><blockquote><code>[0,1,2,3,4,5,6,7,8,9] <br> | <br> [0,1,2]3[4,5,6,7,8,9] <br></code> </blockquote>  This shows that the zipper can be represented as a current element, a list of subsequent values ‚Äã‚Äãand a list of previous ones.  Then, to go to element 4, we simply add 3 to the list of previous ones, and in the list of subsequent ones we will ‚Äútear off‚Äù this 4, and to go to element 2, the opposite is true.  Since it is easier to add and cut off a list from the head, it is more convenient to expand the list of previous elements (so in this case, 2 will be in front of the list).  Replacing the current item is trivial. <br><blockquote> <code>[1,2]3[4,5,6,7,8,9] <br> |-&gt; <br> [1,2,3]4[5,6,7,8,9] <br> | <br> [1,2,3]7[5,6,7,8,9] <br></code> </blockquote>  To get a zipper for the list, you can take its head as the initial element, and the tail as the subsequent elements.  Well, to get the corresponding list for the zipper, the list of previous elements (without forgetting to turn it back, of course) must be connected with the current element and the list of the subsequent ones. <br><br>  To take a derivative, first you need to somehow present the type in a form suitable for its taking. <br>  Let type 0 be a type that has no value, 1 be a type with exactly one value, and so on. <br>  Type A + B can be represented by either a value of type A or a value of type B.  the number of all possible values ‚Äã‚Äãof type A + B will be the sum of all possible values ‚Äã‚Äãof A and B. In Haskell, this corresponds to the type <code>Either ab</code> . <br>  Type A √ó B is represented by both types simultaneously.  this is a tuple. <br><br>  A list can either be empty (a simple value corresponds to 1), or it contains a head (an element of the corresponding type) and a tail (the rest of the list).  We write this using the above notation: <br><blockquote> <code>List A = 1 + A √ó (List A) <br></code> </blockquote>  The zipper for the list contains the current item, the list in the front and the list behind: <br><blockquote> <code>ZipperList A = A √ó (List A) √ó (List A) <br></code> </blockquote>  Rewrite the type of the list as a normal function, so that it is more familiar to take a derivative: <br><blockquote> <code>f(x) = 1 + x*f(x) <br> zipper = x*f'(x) -- x -   <br></code> </blockquote>  Only in this case, x is not a number, but a type of [list elements], but this does not affect further conversions. <br>  This is followed by the mechanical taking of the derivative, known to everyone since school: <br><blockquote> <code>f'(x) = 0 + 1*f(x) + x*f'(x) <br> f'(x) = f(x) + x*f'(x) <br></code> </blockquote>  rename f 'to g <br><blockquote> <code>g(x) = f(x) + x*g(x) <br></code> </blockquote>  if you open g (x) on the right side a couple of times <br><blockquote> <code>g(x) = f(x) + x*f(x) + x*x*f(x) + x*x*x*g(x) <br></code> </blockquote>  then you can see that f (x) can be braced out <br><blockquote> <code>g(x) = f(x) * (1 + x*g(x)) <br></code> </blockquote>  we introduce an additional function h (x) <br><blockquote> <code>h(x) = 1 + x*h(x) <br></code> </blockquote>  note that h (x) * f (x) = g (x) <br><blockquote> <code>h(x)*f(x) = f(x) + x*f(x)*h(x) = f(x) + x*f(x) + x*x*f(x)*h(x) = g(x) <br> g(x) = f(x)*h(x) <br></code> </blockquote>  Now look at f (x);) <br><blockquote> <code>f(x) = 1 + x*f(x) <br> h(x) = 1 + x*h(x) <br></code> </blockquote>  So finally, zipper looks like <br><blockquote> <code>zipper = x*f'(x) = x*f(x)*h(x) <br> Zipper = A √ó (List A) √ó (List A) <br></code> </blockquote>  Those.  exactly what we had! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To make sure, we will try to find a zipper for a tree and see what happens.  The tree can either be empty or have a current element and left / right branches: <br><blockquote> <code>Tree A = 1 + A √ó (Tree A) √ó (Tree A) <br> f(x) = 1 + x*f(x)^2 <br> f'(x) = 0 + 1*f(x)^2 + x*2*f(x)*f'(x) <br> f'(x) = f(x)^2 + f'(x)*(2*x*f(x)) <br> -- f' -&gt; g, f(x)^2 -&gt; T, 2*x*f(x) -&gt; S <br> g(x) = T + S*g(x) = T + S*T + S*S*g(x) = T + S*T + S*S*T + ... = T * (1 + S*g(x)) <br></code> </blockquote>  History repeats itself, only expressions become more complicated.  Similarly, you can make T and eventually we get: <br><blockquote> <code>h(x) = 1 + S*h(x) = List S(x) <br> g(x) = T(x) * (List S(x)) <br> <br> Zipper = A √ó (Tree A) √ó (Tree A) √ó [A √ó (Tree A) + A √ó (Tree A)] <br></code> </blockquote>  It remains to figure out what it all means. <br>  The first A is obviously the value in the current node.  The next two (Tree A) are left and right subtrees relative to this node.  Knowing them, we can move down the tree - right or left. <br>  If we go to the right, then we take the current values ‚Äã‚Äãof the subtrees from the right subtree, and in order not to lose the left one, we will write it in the list.  But besides this, we must also indicate in the list exactly which path we have chosen (right or left), so there is a sum of identical tuples.  If there is the value of the left term, then we have moved to the left, if the right, then to the right.  Thus, all information for moving is available. <br>  How do we get back up?  To take one step up, you need to know the element in that node and know the missing subtree (we already have one ‚Äî our current position is the known subtree of the node above).  Steps up can be many, so you need to keep the entire list. <br>  If the list contains the Left value (5 √ó rtree), then we hit the current node by stepping left from the node with value 5, which has a right subtree of rtree;  and if the list is Right (7 √ó ltree), then we have stepped to the right from the node with the left subtree rtree. <br><br>  Perhaps the code will be easier to understand, I will give it ‚Äúas is‚Äù, you can check it in the interpreter. <br><blockquote> <code><b><font color="#0080FF">data</font></b> Tree a <font color="#8000FF">=</font> Empty <font color="#8000FF">|</font> Node a <font color="#8000FF">(</font> Tree a <font color="#8000FF">)</font> <font color="#8000FF">(</font> Tree a <font color="#8000FF">)</font> <b><font color="#0080FF">deriving</font></b> <font color="#8000FF">(</font> Read <font color="#8000FF">,</font> Show <font color="#8000FF">)</font> <br> <br> <b><font color="#0080FF">data</font></b> TreeZipper a <font color="#8000FF">=</font> TreeZipper a <font color="#8000FF">(</font> Tree a <font color="#8000FF">)</font> <font color="#8000FF">(</font> Tree a <font color="#8000FF">)</font> <font color="#8000FF">[</font> Either <font color="#8000FF">(</font> a <font color="#8000FF">,</font> Tree a <font color="#8000FF">)</font> <font color="#8000FF">(</font> a <font color="#8000FF">,</font> Tree a <font color="#8000FF">)</font> <font color="#8000FF">]</font> <b><font color="#0080FF">deriving</font></b> <font color="#8000FF">(</font> Read <font color="#8000FF">,</font> Show <font color="#8000FF">)</font> <br> <br> zipperFromTree Empty <font color="#8000FF">=</font> error <font color="#80C000">"Zipper can't point empty trees"</font> <br> zipperFromTree <font color="#8000FF">(</font> Node val left right <font color="#8000FF">)</font> <font color="#8000FF">=</font> TreeZipper val left right [] <br> <br> zipperToTree <font color="#8000FF">(</font> TreeZipper val left right [] <font color="#8000FF">)</font> <font color="#8000FF">=</font> Node val left right <br> zipperToTree zipper <font color="#8000FF">=</font> zipperToTree <font color="#8000FF">$</font> moveBack zipper <br> <br> moveRight <font color="#8000FF">(</font> TreeZipper <b><font color="#0080FF">_</font></b> <b><font color="#0080FF">_</font></b> Empty <b><font color="#0080FF">_</font></b> <font color="#8000FF">)</font> <font color="#8000FF">=</font> error <font color="#80C000">"No way!"</font> <br> moveRight <font color="#8000FF">(</font> TreeZipper val left <font color="#8000FF">(</font> Node nval nleft nright <font color="#8000FF">)</font> trace <font color="#8000FF">)</font> <font color="#8000FF">=</font> <br> TreeZipper nval nleft nright <font color="#8000FF">(</font> <font color="#8000FF">(</font> Right <font color="#8000FF">(</font> val <font color="#8000FF">,</font> left <font color="#8000FF">)</font> <font color="#8000FF">)</font> <font color="#8000FF">:</font> trace <font color="#8000FF">)</font> <br> <br> moveLeft <font color="#8000FF">(</font> TreeZipper <b><font color="#0080FF">_</font></b> Empty <b><font color="#0080FF">_</font></b> <b><font color="#0080FF">_</font></b> <font color="#8000FF">)</font> <font color="#8000FF">=</font> error <font color="#80C000">"No way!"</font> <br> moveLeft <font color="#8000FF">(</font> TreeZipper val <font color="#8000FF">(</font> Node nval nleft nright <font color="#8000FF">)</font> right trace <font color="#8000FF">)</font> <font color="#8000FF">=</font> <br> TreeZipper nval nleft nright <font color="#8000FF">(</font> <font color="#8000FF">(</font> Left <font color="#8000FF">(</font> val <font color="#8000FF">,</font> right <font color="#8000FF">)</font> <font color="#8000FF">)</font> <font color="#8000FF">:</font> trace <font color="#8000FF">)</font> <br> <br> moveBack <font color="#8000FF">(</font> TreeZipper val left right [] <font color="#8000FF">)</font> <font color="#8000FF">=</font> error <font color="#80C000">"No way!"</font> <br> moveBack <font color="#8000FF">(</font> TreeZipper val left right <font color="#8000FF">(</font> <font color="#8000FF">(</font> Right <font color="#8000FF">(</font> rval <font color="#8000FF">,</font> rleft <font color="#8000FF">)</font> <font color="#8000FF">)</font> <font color="#8000FF">:</font> trace <font color="#8000FF">)</font> <font color="#8000FF">)</font> <font color="#8000FF">=</font> <br> TreeZipper rval rleft <font color="#8000FF">(</font> Node val left right <font color="#8000FF">)</font> trace <br> moveBack <font color="#8000FF">(</font> TreeZipper val left right <font color="#8000FF">(</font> <font color="#8000FF">(</font> Left <font color="#8000FF">(</font> lval <font color="#8000FF">,</font> lright <font color="#8000FF">)</font> <font color="#8000FF">)</font> <font color="#8000FF">:</font> trace <font color="#8000FF">)</font> <font color="#8000FF">)</font> <font color="#8000FF">=</font> <br> TreeZipper lval <font color="#8000FF">(</font> Node val left right <font color="#8000FF">)</font> lright trace <br> <br> getNodeValue <font color="#8000FF">(</font> TreeZipper val <b><font color="#0080FF">_</font></b> <b><font color="#0080FF">_</font></b> <b><font color="#0080FF">_</font></b> <font color="#8000FF">)</font> <font color="#8000FF">=</font> val <br> setNodeValue <font color="#8000FF">(</font> TreeZipper <b><font color="#0080FF">_</font></b> left right trace <font color="#8000FF">)</font> <font color="#8000FF">=</font> TreeZipper val left right trace <br> <br> <font color="#008080">--    ,  ,  ,     10</font> <br> ghci <font color="#8000FF">&gt;</font> zipperFromTree tree <br> TreeZipper <font color="#80C000">1</font> <font color="#8000FF">(</font> Node <font color="#80C000">2</font> Empty Empty <font color="#8000FF">)</font> <font color="#8000FF">(</font> Node <font color="#80C000">3</font> <font color="#8000FF">(</font> Node <font color="#80C000">4</font> Empty Empty <font color="#8000FF">)</font> Empty <font color="#8000FF">)</font> [] <br> ghci <font color="#8000FF">&gt;</font> moveRight it <br> TreeZipper <font color="#80C000">3</font> <font color="#8000FF">(</font> Node <font color="#80C000">4</font> Empty Empty <font color="#8000FF">)</font> Empty <font color="#8000FF">[</font> Right <font color="#8000FF">(</font> <font color="#80C000">1</font> <font color="#8000FF">,</font> Node <font color="#80C000">2</font> Empty Empty <font color="#8000FF">)</font> <font color="#8000FF">]</font> <br> ghci <font color="#8000FF">&gt;</font> moveLeft it <br> TreeZipper <font color="#80C000">4</font> Empty Empty <font color="#8000FF">[</font> Left <font color="#8000FF">(</font> <font color="#80C000">3</font> <font color="#8000FF">,</font> Empty <font color="#8000FF">)</font> <font color="#8000FF">,</font> Right <font color="#8000FF">(</font> <font color="#80C000">1</font> <font color="#8000FF">,</font> Node <font color="#80C000">2</font> Empty Empty <font color="#8000FF">)</font> <font color="#8000FF">]</font> <br> ghci <font color="#8000FF">&gt;</font> setNodeValue <font color="#80C000">10</font> it <br> TreeZipper <font color="#80C000">10</font> Empty Empty <font color="#8000FF">[</font> Left <font color="#8000FF">(</font> <font color="#80C000">3</font> <font color="#8000FF">,</font> Empty <font color="#8000FF">)</font> <font color="#8000FF">,</font> Right <font color="#8000FF">(</font> <font color="#80C000">1</font> <font color="#8000FF">,</font> Node <font color="#80C000">2</font> Empty Empty <font color="#8000FF">)</font> <font color="#8000FF">]</font> <br> ghci <font color="#8000FF">&gt;</font> zipperToTree it <br> Node <font color="#80C000">1</font> <font color="#8000FF">(</font> Node <font color="#80C000">2</font> Empty Empty <font color="#8000FF">)</font> <font color="#8000FF">(</font> Node <font color="#80C000">3</font> <font color="#8000FF">(</font> Node <font color="#80C000">10</font> Empty Empty <font color="#8000FF">)</font> Empty <font color="#8000FF">)</font></code> </blockquote> <br><br>  Based on the <a href="http://www.cs.nott.ac.uk/~ctm/diff.pdf">Regular Type The One-Hole Contexts</a> </div><p>Source: <a href="https://habr.com/ru/post/59552/">https://habr.com/ru/post/59552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../59542/index.html">Moose (X). Continuation</a></li>
<li><a href="../59543/index.html">Team Fortress 2 Sniper Update</a></li>
<li><a href="../59544/index.html">Business social networks</a></li>
<li><a href="../59548/index.html">Service for creating forums without ads</a></li>
<li><a href="../59551/index.html">GreaseMonkey Script Removing Bad Quotes from Bash</a></li>
<li><a href="../59553/index.html">GAE Java SDK 1.2.1 released</a></li>
<li><a href="../59557/index.html">Report on ‚Äú.NET Architecture Day: Windows 7‚Äù 2009, Ekaterinburg</a></li>
<li><a href="../59558/index.html">Many faces const</a></li>
<li><a href="../59559/index.html">Forest Office Selgas Cano</a></li>
<li><a href="../59560/index.html">Open-mindedness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>