<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Smart lamp that shows the mood in your city</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone knows this feeling when an obsessive desire arises to do something: buy something, create something, write something, call someone ... So I h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Smart lamp that shows the mood in your city</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/uh/vi/eq/uhvieqz4u17x6p6fzdp5lcmx5mi.jpeg"><br><br>  Everyone knows this feeling when an obsessive desire arises to do something: buy something, create something, write something, call someone ... So I had a desire to do something with my own hands.  In search of a suitable project on instructables.com, I came across <a href="https://www.instructables.com/id/Twitter-Mood-Light-The-Worlds-Mood-in-a-Box/">this one</a> and understood - this is what you need! <br><a name="habracut"></a><br>  First of all, I adapted this lamp project for myself: <br><br><ul><li>  instead of the mood of the whole world, I decided to take the mood of my city </li><li>  instead of raspberry pi, I decided to use arduino (since it was already available) </li><li>  I also slightly changed the design of the plexiglass box at my discretion </li><li>  the ability to configure the lamp without flashing through sd card. </li></ul><br>  The first step I decided to write a program for arduino.  The problem was that the arduino had no wifi, but the solution was found rather quickly - esp8266.  ESP8266 - microcontroller with Wi-Fi interface.  In addition to Wi-Fi, the microcontroller features the ability to execute programs from external flash memory with an SPI interface.  Programming of the ESP8266 is done via a serial adapter, which can be used as an arduino.  In addition, writing and flashing programs can also be done through the arduino IDE. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/so/ns/jv/sonsjv6obvmpnmfjmulf1tqwfn0.jpeg"><br><br>  While working with the ESP-01 board, I quickly realized that using the arduino uno + ESP-01 bundle is not the best solution.  The fact is that for programming the board, it was necessary to assemble a small programmer circuit.  This, of course, is easy, but very inconvenient: for the module firmware, you need to connect the ESP-01 through the programmer to the arduino uno, which works in the serial adapter mode, and to test the program, you need to reconnect the ESP-01 directly to the arduino uno in the pants mode so that the two boards can exchange information via the serial port. <br><br><img src="https://habrastorage.org/webt/cb/sc/1s/cbsc1sludsx1ty3r3gukccbqe-s.jpeg"><br><br>  Therefore, I decided to use a NodeMCU board as a microcontroller, which is something like esp8266 and arduino mini on one board.  In addition, it has a micro usb input, which greatly simplifies the procedure for working with it. <br><br><img src="https://habrastorage.org/webt/zo/6c/ay/zo6cayg0goy_vby2v4wbfigwdic.jpeg"><br><br>  The program itself turned out pretty simple.  First, it connects to the wifi network, the login and password to which is stored on the sd card.  After that, json is downloaded from the site <a href="http://ip-api.com/json">ip-api.com/json</a> to determine the location of the lamp (only the name of the city and geographical coordinates are taken from the package).  When the location of the lamp becomes known, the program begins to generate requests for twitter, using keywords that describe each programmed "mood".  After finishing the processing of requests, the program counts the total number of tweets and determines the percentage of each mood on the current cycle.  To make the calculation of the current mood more "alive" - ‚Äã‚Äãthe program compares the current mood with the previous one and calculates the percentage change.  For example, if on the first cycle of work, the distribution of moods was 0.4 for happiness and 0.05 for romance, and on the second cycle, 0.5 and 0.1, respectively, the program would select ‚Äúromance‚Äù as the current mood (since the increase in happiness was 25%, and romance - 100 %).  This approach allows you to quickly respond to sharp changes in mood in the city, as well as track mixed moods (if the mass fraction of the two moods is about the same, the program will switch between them in turn). <br><br>  The second stage was the assembly of the lamp housing.  I immediately decided on the material - frosted plexiglass (44% light transmission) 2 mm thick.  At the same time, according to the idea, the bottom shelf - where all the electronics are located, was made of transparent plexiglass.  At the same time, there is a feeling that when the lamp is working, the light as it pours out from below and creates the illusion of levitation of the lamp itself. <br><br>  I wanted to glue the walls cut from plexiglass together with hot glue.  But such a design turned out to be unstable (possibly due to the small width of the walls) and was constantly falling apart.  Then I decided to fasten the walls with the help of corners and screws.  This option turned out to be more reliable (although not so cute), so I stopped at it. <br><br>  After assembling the case, I moved on to the third and final stage - installing the electronics on the bottom shelf.  It was all pretty simple, except that instead of the planned 4 LEDs, I used 8 - the additional 4 are directed downwards to create a levitation effect.  The fact is that I missed the size of the lamp and 30% of the shelf ate a compartment for 4 AA batteries, blocking the light of the LEDs. <br><br><img src="https://habrastorage.org/webt/o9/w9/kh/o9w9khoanlb2twipnbkef1g3cfm.jpeg"><br><br>  It was also found that the LEDs I purchased did not cope well with the display of complex colors.  Therefore, we had to limit ourselves to the 7th simple ones: red, green, blue, pink (red + blue), yellow (red + green), turquoise (green + blue) and white. <br><br>  The final result of the work can be seen in the <a href="https://youtu.be/u6aVd_PSDWU">video</a> . <br><br>  In this video, the lamp is in demo mode - it quickly switches all the wired color combinations in random order.  In the ‚Äúnormal‚Äù mode of operation, the lamp every ten minutes polls twitter to calculate the current mood and changes color according to the results of the calculation. <br><br>  The project budget amounted to a little more than 2 thousand rubles.  At the same time, the most expensive parts: 4x AA batteries 700r, frosted plexiglass sheet 600r, Chinese nodemcu 500r. <br><br>  What can be improved: <br><br><ul><li>  When assembling the case, you can use transparent corners so that they do not stand out so much. </li><li>  The cost of the plexiglass box can be significantly reduced if you buy a large sheet of plexiglass and cut it yourself. </li><li>  You can use more expensive LEDs that allow you to display intermediate colors like orange, violet, etc. normally. </li><li>  You can use another power source, such as a crown.  This is primarily due to the fact that the battery compartment for 4x AA batteries is too large and blocks a lot of light from the bottom of the lamp.  The truth is not known how long the lamp will be able to work from one crown. </li><li>  You can make a simple web interface to configure the lamp.  Since the library for working with sd cards does not support the Russian language, it is not possible to set keywords for searching in this way. </li></ul><br>  The program code can be found on the <a href="https://github.com/pec-orange/twitterMoodLights">githaba</a> .  If it is interesting, I can tell you more about the program in a separate article. </div><p>Source: <a href="https://habr.com/ru/post/419299/">https://habr.com/ru/post/419299/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419279/index.html">The digest of interesting materials for the mobile developer # 264 (July 30 - August 5)</a></li>
<li><a href="../419283/index.html">Bezos throws money and engineers to develop a rocket in connection with the acceleration of the space race</a></li>
<li><a href="../419291/index.html">Announcement of Heisenbug 2018 Moscow: all the answers</a></li>
<li><a href="../419295/index.html">Multi-Modularity and Dagger 2. Yandex Lecture</a></li>
<li><a href="../419297/index.html">View comments on Habr√© in order of adding</a></li>
<li><a href="../419303/index.html">Tesla report showed higher losses and revenue than investors expected</a></li>
<li><a href="../419305/index.html">Spy toy or find: Barbie ‚Ñ¢ typewriter</a></li>
<li><a href="../419307/index.html">Roskomnadzor inquired about Facebook business connections</a></li>
<li><a href="../419309/index.html">Average color in javascript</a></li>
<li><a href="../419311/index.html">Industrial lamps from the domestic manufacturer Effest with a good color rendering index</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>