<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We document and test the REST API using SpringRestDocs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, I want to touch on the topic of documenting the REST API. Immediately make a reservation, this material will be focused on engineers w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We document and test the REST API using SpringRestDocs</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, I want to touch on the topic of documenting the REST API.  Immediately make a reservation, this material will be focused on engineers working in the Spring ecosystem. <br>  On several recent projects, I used the SpringRestDocs framework, it was successfully entrenched in the portfolio, was shown to friends, who also began to successfully use it, and now I want to share with you in the article about its capabilities and benefits.  The article will allow you to understand the use of SpringRestDocs and start using it. <br><a name="habracut"></a><br><blockquote>  From the moment of acquaintance with this tool, I realized that there was a solution, which I was waiting for and it was not enough in development.  Judge for yourself - one could only dream about it: <br><br><ul><li>  Documentation is generated automatically when running tests. </li><li>  You can control the original format of the documentation file ‚Äî for example, compile html.  Since we use Spring boot, we can modify the steps and tasks in the gradle, copy the documentation file and include it in the jar-ku, publish the documentation on the remote server, copy the documentation to the archive.  Thus, you will always have a static endpoint with documentation wherever your service is located.  For offline version you can connect pdf, epub, abook permissions. </li><li>  The documentation of our REST service is consistent with the logic of work.  The documentation is synchronized with the logic of the application.  Made changes, forgot to reflect them in the documentation - instantly see the falling tests with a detailed description of the difference inconsistencies. </li><li>  Documentation is generated from tests.  Now, in order to add new sections to the documentation, or start to lead it - you need to start by writing a test, but a test.  After all, very often developers, in conditions of lack of time, undelivered processes on a project, or other reasons, write tons of code, but do not pay attention to the importance of tests.  Oddly enough, but the documentation framework encourages you to work on TDD </li><li>  As a result, you maintain a high level of coverege.  More precisely, the non-coverage percentages that will be drawn in code analysis systems or reports are important.  It is important that you cover different scenarios with separate tests and include their execution results in the documentation.  Green tests are always nice. </li></ul></blockquote>  Let's deal with the work of SpringRestDocs, I will combine the material with theoretical inserts and lead a practical line of the tutorial, after reading which you can configure and use the framework. <br><br><h3>  SpringRestDocs Pipeline </h3><br>  In order to start working with SpringRestDocs, you need to understand the principle of its pipeline, it is quite simple and linear: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/d08/c15/854/d08c15854195290e0d1afbad8a1a6fc2.png" alt="rest docs pipeline"><br><br>  All actions originate from tests, except for the resource verification logic, also snippets are generated.  Snippets are a serialized value of a specific HTTP attribute with which our controller interacted.  We prepare a special file template in which we indicate in which sections the generated snippets should be included.  The output is a compiled documentation file, note that we can specify the format of the documentation - it can be in the format of html, pdf, epub, abook. <br><br>  Further, in the text of the article we will assemble this pipeline, write tests, configure SpringRestDocs and compile the documentation. <br><br><h4>  Dependencies </h4><br>  Below are the dependencies from my project that works with spring rest docs, for example which we will analyze the work <br><br><pre><code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">dependencies</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">compile</span></span> <span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-data-jpa"</span></span> compile <span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-hateoas"</span></span> compile <span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web"</span></span> compile <span class="hljs-string"><span class="hljs-string">"org.springframework.restdocs:spring-restdocs-core:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$restdocsVersion</span></span></span><span class="hljs-string">"</span></span> compile <span class="hljs-string"><span class="hljs-string">"com.h2database:h2:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$h2Version</span></span></span><span class="hljs-string">"</span></span> compile <span class="hljs-string"><span class="hljs-string">"org.projectlombok:lombok"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-test"</span></span> asciidoctor <span class="hljs-string"><span class="hljs-string">"org.springframework.restdocs:spring-restdocs-asciidoctor:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$restdocsVersion</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"org.springframework.restdocs:spring-restdocs-mockmvc:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$restdocsVersion</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"com.jayway.jsonpath:json-path"</span></span> }</code> </pre> <br><h4>  Tested Controller </h4><br>  I will show the part of the controller for which we will write a test, connect SpringRestDocs and generate the documentation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/speakers"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpeakerController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpeakerRepository speakerRepository; <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(path = <span class="hljs-string"><span class="hljs-string">"/{id}"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResponseEntity&lt;SpeakerResource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSpeaker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@PathVariable </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> speakerRepository.findOne(id) .map(speaker -&gt; ResponseEntity.ok(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeakerResource(speaker))) .orElse(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResponseEntity(HttpStatus.NOT_FOUND)); }</code> </pre> <br>  Let's look at its logic.  With the help of SpringDataRepository, I apply to the database for a record with the ID that was transferred to the controller.  SpringDataRepository returns Optional - in case there is a value in it, we perform the transformation of the JPA Entity into a resource (we can encapsulate some of the fields that we don‚Äôt want to show in the response), but if Optional.isEmpty () then we return the 404 code NOT_FOUND . <br><br><h4>  ResourceResource resource code </h4><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@NoArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@Relation</span></span>(value = <span class="hljs-string"><span class="hljs-string">"speaker"</span></span>, collectionRelation = <span class="hljs-string"><span class="hljs-string">"speakers"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpeakerResource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceSupport</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String company; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpeakerResource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Speaker speaker)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = speaker.getName(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.company = speaker.getCompany(); add(linkTo(methodOn(SpeakerController.class).getSpeaker(speaker.getId())).withSelfRel()); add(linkTo(methodOn(SpeakerController.class).getSpeakerTopics(speaker.getId())).withRel(<span class="hljs-string"><span class="hljs-string">"topics"</span></span>)); } }</code> </pre><br><h4>  Write a basic test for this endpoint </h4><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(SpringRunner.class) <span class="hljs-meta"><span class="hljs-meta">@SpringBootTest</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureMockMvc</span></span> <span class="hljs-meta"><span class="hljs-meta">@AutoConfigureRestDocs</span></span>(outputDir = <span class="hljs-string"><span class="hljs-string">"build/generated-snippets"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpControllerTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MockMvc mockMvc; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpeakerRepository speakerRepository; <span class="hljs-meta"><span class="hljs-meta">@After</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tearDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ speakerRepository.deleteAll(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGetSpeaker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Given Speaker speaker = Speaker.builder().name("Roman").company("Lohika").build(); speakerRepository.save(speaker); // When ResultActions resultActions = mockMvc.perform(get("/speakers/{id}", speaker.getId())) .andDo(print()); // Then resultActions.andExpect(status().isOk()) .andExpect(jsonPath("name", is("Roman"))) .andExpect(jsonPath("company", is("Lohika"))); } }</span></span></code> </pre><br>  In the test, I connect the mockMVC, RestDocs autoconfiguration.  For restdocs, it is necessary to specify the directory where snippets will be generated <b>(outputDir = "buid / generated-snippets")</b> , this is a common test using mockMvc, which we write almost every day when we test rest services.  I use the proprietary library from Dependancy spring.tests mockMvc, however, if you prefer to use RestAssured, then everything read will also be relevant - there are only minor modifications.  My test performs a call to the HTTP method of the controller, verifies the status, fields, and prints the request / response flow to the console. <br><br><h4>  Resultshandler </h4><br>  After running the test in its output, we see the following: <br><br><pre> <code class="bash hljs">MockHttpServletRequest: HTTP Method = GET Request URI = /speakers/1 Parameters = {} Headers = {} Handler: Type = smartjava.domain.speaker.SpeakerController Method = public org.springframework.http.ResponseEntity&lt;smartjava.domain.speaker.SpeakerResource&gt; smartjava.domain.speaker.SpeakerController.getSpeaker(long) Async: Async started = <span class="hljs-literal"><span class="hljs-literal">false</span></span> Async result = null Resolved Exception: Type = null ModelAndView: View name = null View = null Model = null FlashMap: Attributes = null MockHttpServletResponse: Status = 200 Error message = null Headers = {Content-Type=[application/hal+json;charset=UTF-8]} Content <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> = application/hal+json;charset=UTF-8 Body = { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Roman"</span></span>, <span class="hljs-string"><span class="hljs-string">"company"</span></span> : <span class="hljs-string"><span class="hljs-string">"Lohika"</span></span>, <span class="hljs-string"><span class="hljs-string">"_links"</span></span> : { <span class="hljs-string"><span class="hljs-string">"self"</span></span> : { <span class="hljs-string"><span class="hljs-string">"href"</span></span> : <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/speakers/1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"topics"</span></span> : { <span class="hljs-string"><span class="hljs-string">"href"</span></span> : <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/speakers/1/topics"</span></span> } } }</code> </pre> <br>  This is the output of the HTTP request and response contents to the console.  Thus, we can trace which values ‚Äã‚Äãwere transferred to our controller and what was the response from it.  The output to the console is performed by the connected handler: <br><br><pre> <code class="java hljs"> resultActions.andDo(print());</code> </pre> <br><blockquote>  <b>ResultHandler</b> is a functional interface.  By creating our own implementation and connecting it in the test, we can access the <b>HttpRequest / HttpResponse</b> , which was performed in the test and interpret the execution results, if we wish to record these values ‚Äã‚Äãto the console, to the file system, to our own documentation file, and so on. </blockquote><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResultHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Perform an action on the given result. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> result the result of the executed request * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception if a failure occurs */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MvcResult result)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception</span></span>; }</code> </pre> <br><h4>  MvcResult </h4><br>  As we can see, ResultHandler has access and can interpret MvcResult values ‚Äã‚Äã- the object containing the mockMvc test execution results, and through it the attributes of two key players - MockHttpServletRequest, MockHttpServletResponse.  Here is a partial list of these attributes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db4/19a/c2b/db419ac2b0c89d3383262e9ffae1535f.png" alt="mvcResults"><br><br>  Here is an example of MyResultHandler, which logs the type of the HTTP method called and the status code of the response: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyResultHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResultHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Logger logger = LoggerFactory.getLogger(MyResultHandler.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResultHandler </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyResultHandler(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MvcResult result)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ MockHttpServletRequest request = result.getRequest(); MockHttpServletResponse response = result.getResponse(); logger.error(<span class="hljs-string"><span class="hljs-string">"HTTP method: {}, status code: {}"</span></span>, request.getMethod(), response.getStatus()); } }</code> </pre> <br><pre> <code class="java hljs"> resultActions.andDo(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyResultHandler())</code> </pre> <br>  It was this idea with processing and registration that Pivotal used to generate the documentation.  We need to connect a handler from the MockMvcRestDocumentation class to our test: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Document resultActions.andDo(MockMvcRestDocumentation.document("{class-name}/{method-name}"));</span></span></code> </pre> <br><h4>  Let's generate snippets </h4><br>  Let's run the test again and note that after it has been executed, folders with files have been created in the <b>build / generated-snippets</b> directory: <br><br><pre> <code class="bash hljs">./sp-controller-test/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-get-speaker: total 48 -rw-r--r-- 1 rtsypuk staff 68B Oct 31 14:17 curl-request.adoc -rw-r--r-- 1 rtsypuk staff 87B Oct 31 14:17 http-request.adoc -rw-r--r-- 1 rtsypuk staff 345B Oct 31 14:17 http-response.adoc -rw-r--r-- 1 rtsypuk staff 69B Oct 31 14:17 httpie-request.adoc -rw-r--r-- 1 rtsypuk staff 36B Oct 31 14:17 request-body.adoc -rw-r--r-- 1 rtsypuk staff 254B Oct 31 14:17 response-body.adoc</code> </pre><br>  These are the generated snippets.  By default, rest docs generates 6 types of snippet, I will show some of them. <br><br><blockquote>  <b>Snippet</b> is a part of the HTTP request / response HTTP load that is serialized into a file in a textual representation.  The most commonly used snippets are curl-request, http-request, http-response, request-body, response-body, links (for HATEOAS services), path-parameters, response-fields, headers. <br></blockquote><br>  curl-request.adoc <br><br><pre> <code class="bash hljs">[<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>,bash] ---- $ curl <span class="hljs-string"><span class="hljs-string">'http://localhost:8080/speakers/1'</span></span> -i ----</code> </pre> <br><br>  http-request.adoc <br><pre> <code class="bash hljs">[<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>,bash] [<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>,http,options=<span class="hljs-string"><span class="hljs-string">"nowrap"</span></span>] ---- GET /speakers/1 HTTP/1.1 Host: localhost:8080 ----</code> </pre> <br>  http-response.adoc <br><br><pre> <code class="bash hljs">[<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>,bash] [<span class="hljs-built_in"><span class="hljs-built_in">source</span></span>,http,options=<span class="hljs-string"><span class="hljs-string">"nowrap"</span></span>] ---- HTTP/1.1 200 OK Content-Type: application/hal+json;charset=UTF-8 Content-Length: 218 { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Roman"</span></span>, <span class="hljs-string"><span class="hljs-string">"company"</span></span> : <span class="hljs-string"><span class="hljs-string">"Lohika"</span></span>, <span class="hljs-string"><span class="hljs-string">"_links"</span></span> : { <span class="hljs-string"><span class="hljs-string">"self"</span></span> : { <span class="hljs-string"><span class="hljs-string">"href"</span></span> : <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/speakers/1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"topics"</span></span> : { <span class="hljs-string"><span class="hljs-string">"href"</span></span> : <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/speakers/1/topics"</span></span> } } } ----</code> </pre> <br><h4>  Preparing a template file </h4><br>  Now you need to prepare a template file and mark up its sections, which will include generated snipeet blocks.  The template is maintained in a flexible asciidoc format, by default the template should be located in the <b>src / docs / asciidoc directory</b> : <br><br><pre> <code class="hljs cmake">== Rest convention <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>::etc/rest_conv.adoc[] == Endpoints === Speaker ==== Get speaker by ID ===== Curl example <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>::{snippets}/sp-controller-<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>-get-speaker/curl-request.adoc[] ===== HTTP Request <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>::{snippets}/sp-controller-<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>-get-speaker/http-request.adoc[] ===== HTTP Response ====== Success HTTP responses <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>::{snippets}/sp-controller-<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>-get-speaker/http-response.adoc[] ====== Response fields <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>::{snippets}/sp-controller-<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>-get-speaker/response-fields.adoc[] ====== HATEOAS links <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>::{snippets}/sp-controller-<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>-get-speaker/links.adoc[]</code> </pre> <br>  Using the asciidoc syntax we can include static files (for example, in the rest_conv.adoc file I made a description of which methods supported the service, in what cases which status codes should be returned), as well as auto-generated snippets files. <br><br><h4>  Static rest_conv.adoc </h4><br><pre> <code class="hljs sql">=== HTTP verbs Speakers Service tries to adhere as closely as possible to standard HTTP and REST conventions in its <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">HTTP</span></span> verbs. |=== | Verb | <span class="hljs-keyword"><span class="hljs-keyword">Usage</span></span> | <span class="hljs-string"><span class="hljs-string">`GET`</span></span> | Used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> retrieve a <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> | <span class="hljs-string"><span class="hljs-string">`POST`</span></span> | Used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> | <span class="hljs-string"><span class="hljs-string">`PATCH`</span></span> | Used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> an existing <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">including</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> updates | <span class="hljs-string"><span class="hljs-string">`PUT`</span></span> | Used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> an existing <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">full</span></span> updates <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> | <span class="hljs-string"><span class="hljs-string">`DELETE`</span></span> | Used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> an existing <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> |=== === <span class="hljs-keyword"><span class="hljs-keyword">HTTP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> codes Speakers Service tries <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> adhere <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> closely <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> possible <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> standard <span class="hljs-keyword"><span class="hljs-keyword">HTTP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> REST conventions <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> its <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">HTTP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> codes. |=== | <span class="hljs-keyword"><span class="hljs-keyword">Status</span></span> code | <span class="hljs-keyword"><span class="hljs-keyword">Usage</span></span> | <span class="hljs-string"><span class="hljs-string">`200 OK`</span></span> | Standard response <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> successful <span class="hljs-keyword"><span class="hljs-keyword">HTTP</span></span> requests. The actual response will depend <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> the request method used. <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> request, the response will contain an entity <span class="hljs-keyword"><span class="hljs-keyword">corresponding</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the requested resource. <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> a POST request, the response will contain an entity describing <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> containing the <span class="hljs-keyword"><span class="hljs-keyword">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the action. | <span class="hljs-string"><span class="hljs-string">`201 Created`</span></span> | The request has been fulfilled <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> resulted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> being created. | <span class="hljs-string"><span class="hljs-string">`204 No Content`</span></span> | The <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> successfully processed the request, but <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">returning</span></span> <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> content. | <span class="hljs-string"><span class="hljs-string">`400 Bad Request`</span></span> | The <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> cannot <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> will <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> process the request due <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> something that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> perceived <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be a <span class="hljs-keyword"><span class="hljs-keyword">client</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> (eg, malformed request syntax, invalid request message framing, <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> deceptive request routing). | <span class="hljs-string"><span class="hljs-string">`404 Not Found`</span></span> | The requested <span class="hljs-keyword"><span class="hljs-keyword">resource</span></span> could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be <span class="hljs-keyword"><span class="hljs-keyword">found</span></span> but may be available again <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the future. Subsequent requests <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">client</span></span> <span class="hljs-keyword"><span class="hljs-keyword">are</span></span> permissible. | <span class="hljs-string"><span class="hljs-string">`409 Conflict`</span></span> | The request could <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be completed due <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a conflict <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> state <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the target resource. | <span class="hljs-string"><span class="hljs-string">`422 Unprocessable Entity`</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">Validation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> has happened due <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> processing the posted entity. |===</code> </pre> <br><h4>  Configuring build.gradle </h4><br>  In order for the documentation to be compiled it is necessary to make a basic configuration - to enable the necessary dependencies, in the gradle.build buildscript.dependencies you need to add asciidoctor-gradle-plugin <br><br><pre> <code class="hljs perl">buildscript { repositories { jcenter() mavenCentral() mavenLocal() maven { url <span class="hljs-string"><span class="hljs-string">"https://plugins.gradle.org/m2/"</span></span> } } dependencies { classpath <span class="hljs-string"><span class="hljs-string">"org.asciidoctor:asciidoctor-gradle-plugin:$asciiDoctorPluginVersion"</span></span> classpath <span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-gradle-plugin:$springBootVersion"</span></span> } }</code> </pre> <br>  Apply the plugin <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">apply</span></span> plugin: <span class="hljs-string"><span class="hljs-string">'org.asciidoctor.convert'</span></span></code> </pre><br>  Now we need to make the basic configuration asciidoctor: <br><br><pre> <code class="hljs pgsql">asciidoctor { dependsOn test backends = [<span class="hljs-string"><span class="hljs-string">'html5'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> doctype: <span class="hljs-string"><span class="hljs-string">'book'</span></span> attributes = [ <span class="hljs-string"><span class="hljs-string">'source-highlighter'</span></span>: <span class="hljs-string"><span class="hljs-string">'highlightjs'</span></span>, <span class="hljs-string"><span class="hljs-string">'imagesdir'</span></span> : <span class="hljs-string"><span class="hljs-string">'./images'</span></span>, <span class="hljs-string"><span class="hljs-string">'toc'</span></span> : <span class="hljs-string"><span class="hljs-string">'left'</span></span>, <span class="hljs-string"><span class="hljs-string">'toclevels'</span></span> : <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'numbered'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'icons'</span></span> : <span class="hljs-string"><span class="hljs-string">'font'</span></span>, <span class="hljs-string"><span class="hljs-string">'setanchors'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'idprefix'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'idseparator'</span></span> : <span class="hljs-string"><span class="hljs-string">'-'</span></span>, <span class="hljs-string"><span class="hljs-string">'docinfo1'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'safe-mode-unsafe'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'allow-uri-read'</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'snippets'</span></span> : snippetsDir, linkattrs : <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">encoding</span></span> : <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span> ] inputs.dir snippetsDir outputDir "build/asciidoc" sourceDir <span class="hljs-string"><span class="hljs-string">'src/docs/asciidoc'</span></span> sources { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'index.adoc'</span></span> } }</code> </pre><br>  Check the build documentation, run in the console <br><br><pre> <code class="bash hljs">gradle asciidoctor</code> </pre> <br>  since we have indicated that the asciidoctor task is dependent on running tests, tests will first be broken through, snippets will be generated and these snippets will be included in the generated documentation. <br><br><h4>  Documentation </h4><br>  All the described configuration steps must be performed once when the project is lifted.  Now, every time we run tests, we will additionally generate snippets and generate documentation.  Here are some screenshots: <br><br>  Section of the agreement on HTTP methods and status codes <br><br><img src="https://habrastorage.org/getpro/habr/post_images/74f/79d/27c/74f79d27c4a14358936d3290b40c6988.png" alt="image"><br><br>  Example of Get All Speakers Method Documentation <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29e/f29/eed/29ef29eed0deeab466663f781e3c8d87.png" alt="image"><br><br>  Identical documentation is also available in pdf format.  It is convenient as an offline version, can be sent along with the specifications of your service to customers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd5/aac/74d/dd5aac74d16f33101f760c4e33c37917.png" alt="image"><br><br><h4>  Jar task modification </h4><br>  Well, since we are working with spring boot now we can use one of its interesting properties - all the resources that are in the <b>src / static</b> or <b>src / public</b> directory will be available as static content when accessed from the browser <br><br><pre> <code class="hljs pgsql">jar { dependsOn asciidoctor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ("${asciidoctor.outputDir}/html5") { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'**/index.html'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'**/images/*'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-string"><span class="hljs-string">'static/docs'</span></span> } }</code> </pre><br>  This is what we will do - after the documentation is assembled, we will copy it to the / static / docs directory.  Thus, each assembled jar artifact will contain a static endoint with documentation.  Regardless of where it will be located, what environment it will be in - we will always have the latest version of the documentation available. <br><br><h4>  Conclusion </h4><br><blockquote>  This is only a small part of the capabilities of this wonderful tool, it is impossible to cover everything in one article.  For anyone interested in SpringRestDocs, I offer links to resources: <br><br><ul><li>  This is how the compiled documentation looks like; in this example, you can look at the asciidoc format, how powerful it is (by the way, the dock can be automatically uploaded to githubpages) <a href="https://tsypuk.github.io/springrestdoc/">tsypuk.github.io/springrestdoc</a> </li><li>  my github with a customized demo project with SpringRestDocs <a href="https://github.com/tsypuk/springrestdoc">github.com/tsypuk/springrestdoc</a> (all configured, use the code in your projects for a quick start, asciidoctor demo syntax, examples of extensions, diagrams that can be easily generated and included in the documentation) </li><li>  And of course the <a href="https://projects.spring.io/spring-restdocs/">official documentation</a> </li></ul></blockquote></div><p>Source: <a href="https://habr.com/ru/post/341636/">https://habr.com/ru/post/341636/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341626/index.html">Knowledge base of web development</a></li>
<li><a href="../341628/index.html">Developer Path, Part 4: Towards a Dream</a></li>
<li><a href="../341630/index.html">ARKit, Flutter, Core ML, animations and more at MBLTdev 2017</a></li>
<li><a href="../341632/index.html">Avito on Highload ++ 2017</a></li>
<li><a href="../341634/index.html">Startup of the day (October 2017)</a></li>
<li><a href="../341638/index.html">Open Data Council: Related Data Working Group, Openness of FIU and Rosleskhoz</a></li>
<li><a href="../341640/index.html">Lenovo ThinkSystem SR950 Server Overview</a></li>
<li><a href="../341642/index.html">PM from Facebook: Counterintuitive conclusions about management (part 1)</a></li>
<li><a href="../341644/index.html">Security Week 44: a quiet hunt, or Carbanak to help, why the Firefox features Tor Browser, a Google loophole - buganizer</a></li>
<li><a href="../341646/index.html">Ten Node.js Questions You Can't Answer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>