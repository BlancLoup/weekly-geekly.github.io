<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search for texts that do not match the topic and find similar articles</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have a site with articles of similar subjects. The site had two problems: spam messages and duplicate articles, and duplicates were often not exact ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search for texts that do not match the topic and find similar articles</h1><div class="post__text post__text-html js-mediator-article">  I have a site with articles of similar subjects.  The site had two problems: spam messages and duplicate articles, and duplicates were often not exact copies. <br><br>  This post is about how I solved these problems. <br><br>  Given: <br><ul><li>  total number of articles 140,000; </li><li>  spam count: approximately 16%; </li><li>  number of obscure duplicates: approximately 63%; </li></ul><br>  The task: to get rid of spam and duplicates, as well as to prevent their further occurrence. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/d3d/41e/dab/d3d41edab5924e50b37d2d85b9aab9a6.jpg"><br><br><a name="habracut"></a><br><h1>  Part 1. Classification for spam / not spam </h1><br>  All articles on my site relate to the same subject and, as a rule, spammers / advertising messages differ in content.  I decided to manually sort a number of articles.  And on their basis to build a classifier.  For classification, we will consider the <a href="http://en.wikipedia.org/wiki/Cosine_similarity">cosine distance</a> between the vector of the article being checked and the vectors of two groups (spam / not spam).  Which group of the article being checked is closer to, and we will refer the article to that. <br><br>  First you need to manually classify articles.  Sketched for this form with the checkboxes and collected in a few hours 650 articles of spam and 2000 not spam. <br><br>  All posts are cleared of garbage - noise words that do not carry a payload (participles, interjections, etc.).  To do this, I gathered from different dictionaries that I found on the Internet, my own <a href="https://github.com/shurik2533/erofeyPavlovich/blob/master/stop.txt">dictionary of noise words</a> . <br><br>  To minimize the number of different forms of a single word, you can use <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B5%25D0%25BC%25D0%25BC%25D0%25B5%25D1%2580_%25D0%259F%25D0%25BE%25D1%2580%25D1%2582%25D0%25B5%25D1%2580%25D0%25B0">Porter's smong</a> .  I took the finished Java implementation <a href="http://www.algorithmist.ru/2010/12/porter-stemmer-russian.html">from here</a> .  Thank you, <a href="http://habrahabr.ru/users/edunov/" class="user_link">edunov</a> <br><br>  From the words of classified articles, cleared of noise words and driven through the stemming, it is necessary to collect a dictionary. <br><br>  From the dictionary, delete the words that are found only in one article. <br><br>  For each manually classified article count the number of occurrences of each word from the dictionary.  You will get vectors similar to the following: <br><img src="https://habrastorage.org/files/9dc/b36/707/9dcb36707fac4054968867d975b1a8f5.jpg"><br><br>  We increase the weight of words in each vector, counting <a href="http://en.wikipedia.org/wiki/Tf%25E2%2580%2593idf">TF-IDF</a> for them.  TF-IDF is considered separately for each group spam / not spam. <br><br>  First, we consider the TF (term frequency) for each article.  This is the ratio of the number of occurrences of a specific word to the total number of words in the article: <br><br><img src="https://habrastorage.org/files/004/d3e/b5e/004d3eb5efa045258492722801eb4437.png"><br><br>  where n <sub>i</sub> is the number of occurrences of the word in the document, and in the denominator - the total number of words in this document. <br><img src="https://habrastorage.org/files/2be/b56/67f/2beb5667f1654857ad1a29324d855370.jpg"><br><br>  Next, consider the IDF (inverse document frequency).  Inversion of the frequency with which some word is found in the documents of the group (spam / not spam).  IDF reduces the weight of words that are often used in a group.  It is considered for each group. <br><br><img src="https://habrastorage.org/files/4ca/8c5/f12/4ca8c5f127004d29a961829006f9a003.png"><br><br>  Where <br><ul><li>  | D |  - the number of documents in the group; </li><li>  d <sub>i</sub> ‚äÉ <sub>t i</sub> is the number of documents in which t <sub>i</sub> occurs (when n <sub>i</sub> 0). </li></ul><br><img src="https://habrastorage.org/files/6e9/e41/ea1/6e9e41ea1f9842689ad5fd0c082cc050.jpg"><br><br>  We consider TF-IDF: <br><br><img src="https://habrastorage.org/files/e2b/672/c0a/e2b672c0ad994def9665e646922a3990.png"><br><br>  A lot of weight in TF-IDF will get words with a high frequency within a specific document and with a low frequency of use in other documents. <br><img src="https://habrastorage.org/files/9ce/8aa/883/9ce8aa883088497ebec37b717060b30b.jpg"><br><br>  For each group, we form one vector, counting the arithmetic average of each parameter within the group: <br><img src="https://habrastorage.org/files/e2d/b48/b1a/e2db48b1a75746a9b50b5c7fd910a07f.jpg"><br><br>  To check an article for spam, you need to get for it the number of occurrences of words from the dictionary.  Count for these words TF-IDF for spam and not spam.  This will result in two vectors (in the TF-IDF image, not spam and TF-IDF spam).  IDF for calculations, we take the one that was considered for the classifying sample. <br><img src="https://habrastorage.org/files/6f0/ec0/9da/6f0ec09da5084f2bbbd99eeb77455bbb.jpg"><br><br>  For each vector, we assume the cosine distance with the vectors for spam and not spam, respectively.  The cosine distance is a measure of the similarity of two vectors.  The scalar product of the vectors and the cosine of the angle Œ∏ between them are related as follows: <br><img src="https://habrastorage.org/files/271/3c5/dc3/2713c5dc36b5415cbdec93656e665152.png"><br><br>  Having two vectors A and B, we obtain the cosine distance - cos (Œ∏) <br><img src="https://habrastorage.org/files/4ae/706/30f/4ae70630fedf49ca80c278f09dd7f35e.png"><br><br><div class="spoiler">  <b class="spoiler_title">Java code</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cosine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dotProd = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> sqA = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> sqB = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; a.length; i++) { dotProd += a[i] * b[i]; sqA += a[i] * a[i]; sqB += b[i] * b[i]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dotProd/(Math.sqrt(sqA)*Math.sqrt(sqB)); }</code> </pre> <br></div></div><br>  The result is a range from -1 to 1. -1 means that the vectors are completely opposite, 1, that they are the same. <br><br>  Which of the obtained values ‚Äã‚Äã(for spam and not spam) will be closer to 1, to that group and we will refer the article. <br><br>  When checking the similarity for not spam, the number was 0.87: <br><img src="https://habrastorage.org/files/351/531/812/3515318123774c5bbc10a6aff2a59520.jpg"><br>  for spam - 0.62: <br><img src="https://habrastorage.org/files/e3d/1e1/1de/e3d1e11de41541cc8d3afb8bb2e43144.jpg"><br>  Therefore, we consider that the article is not spam. <br><br>  For testing, I manually selected another 700 entries.  The accuracy of the results was 98%.  At the same time, what was mistakenly classified was even difficult for me to refer to one category or another. <br><hr><br><h1>  Part 2. Search for fuzzy duplicates </h1><br>  After clearing spam, 118,000 articles remain. <br><br>  To search for duplicates, I decided to use an inverted index ( <a href="http://en.wikipedia.org/wiki/Inverted_index">Inverted index</a> ).  An index is a data structure, where for each word it is indicated in which documents it is contained.  Accordingly, if we have a set of words, you can easily make a request for documents containing these words. <br><br>  Example with wiki.  Suppose we have the following documents: <br><pre> <code class="java hljs">T[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-string"><span class="hljs-string">"it is what it is"</span></span> T[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">"what is it"</span></span> T[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-string"><span class="hljs-string">"it is a banana"</span></span></code> </pre><br>  For these documents, we construct an index, indicating which document contains the word: <br><pre> <code class="java hljs"><span class="hljs-string"><span class="hljs-string">"a"</span></span>: {<span class="hljs-number"><span class="hljs-number">2</span></span>} <span class="hljs-string"><span class="hljs-string">"banana"</span></span>: {<span class="hljs-number"><span class="hljs-number">2</span></span>} <span class="hljs-string"><span class="hljs-string">"is"</span></span>: {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>} <span class="hljs-string"><span class="hljs-string">"it"</span></span>: {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>} <span class="hljs-string"><span class="hljs-string">"what"</span></span>: {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}</code> </pre><br>  All the words "what", "is" and "it" are in documents 0 and 1: <br><pre> <code class="java hljs">{<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>} ‚à© {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>} ‚à© {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>} = {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}</code> </pre><br>  I saved the index in the MySQL database.  Indexing took about 2 days. <br><br>  To search for similar articles, it is not necessary that all the words match, so when searching by index we get all the articles for which at least 75% of words coincided.  The found ones contain similar duplicates, as well as other articles that include 75% of the original words, for example, these can be very long articles. <br><br>  In order to weed out what is not a duplicate, we must calculate the cosine distance between the original and the found ones.  The fact that more than 75% match is considered a duplicate.  The number of 75% derived empirically.  It allows you to find fairly modified versions of the same article. <br><br><div class="spoiler">  <b class="spoiler_title">An example of duplicates found:</b> <div class="spoiler_text">  <b>Option 1:</b> <br>  Cheesecake with condensed milk (without baking) <br><br>  Ingredients: <br>  * 450 gr Sour cream from 20% fat <br>  * 300 gr pastry <br><br>  * 100 grams of melted butter <br>  * 300 grams of good condensed milk <br>  * 10 grams of instant gelatin <br>  * 3/4 ‚Äã‚Äãcup cold boiled water <br><br>  Cooking: <br>  Collapsible form lined with parchment paper. <br>  Mixed into small crumb cookies mix with melted butter.  The mixture should not be oily, but not dry.  Put the mixture into shape and seal well.  Put in the fridge for 30 minutes. <br>  Sour cream mixed with condensed milk. <br>  Gelatin pour 3/4 cup of water and put on for 10 minutes to swell.  Then melt it in a water bath so that it dissolves. <br>  In a mixture of condensed milk and sour cream gently pour the gelatin, stirring well.  Pour then into the form.  And put it in the fridge until it is completely set for about 2-3 hours. <br>  When frozen, you can add berries of fresh cranberries or sprinkle with grated chocolate or nuts. <br><br>  Enjoy your meal! <br><br>  <b>Option 2:</b> <br>  "Cheesecake" without baking with condensed milk <br><br>  Ingredients: <br><br>  - Sour cream from 20% of fat content 450 gr <br><br>  -300 gr cookies (I took oatmeal) <br>  -100 g melted butter <br>  -300 g of high-quality condensed milk <br>  -10g instant gelatin <br>  -3/4 cup cold boiled water <br><br>  Cooking: <br><br>  one).  Form (better detachable) cover with parchment paper. <br>  2).  Chop the cookies into fine chips and mix with melted butter.  The mass should not be oily, but not too dry.  Put the mass in shape and tamp well.  Put in the fridge for half an hour. <br>  3).  Sour cream mixed with condensed milk (you can add more or less condensed milk, this is a matter of taste). <br>  4) Gelatin pour 3/4 cup of water and leave for 10 minutes.  to swell.  Then melt it in a water bath so that it dissolves completely. <br>  5) Slowly add gelatin to the creamy condensed mass, stirring well.  Pour then into the form.  And send in the fridge to full freeze.  I froze quickly.  Somewhere 2 hours. <br>  I added fresh berries of cranberries when it hardened - this added spice and sourness.  You can sprinkle with grated chocolate or nuts. <br></div></div><br>  Full cleaning took about 5 hours. <br><br>  To update the index to find duplicates, it is not necessary to rebuild existing data.  The index is completed incrementally. <br><br>  Because of the limited amount of RAM on the server, I don‚Äôt have the ability to keep the index in memory, so I keep it in MySQL, where the articles themselves are stored.  Checking one article, if you do not load everything into memory, takes about 9 seconds for the program.  It is long, but because  Only a few dozen new articles appear per day, I decided not to bother with speed until it is needed. </div><p>Source: <a href="https://habr.com/ru/post/252265/">https://habr.com/ru/post/252265/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252249/index.html">When this == null: the untamed story from the world of the CLR</a></li>
<li><a href="../252255/index.html">Apple's environmental care, IMGA international award, Google Play success - and other news of the week for a mobile developer</a></li>
<li><a href="../252259/index.html">Who earned the most money in the mobile market in 2014</a></li>
<li><a href="../252261/index.html">FPGA - my first steps</a></li>
<li><a href="../252263/index.html">Distributed Captive Portal in public places and Apple issues</a></li>
<li><a href="../252267/index.html">Game in 14 days [For those who have been building a team for years, but never made a prototype]</a></li>
<li><a href="../252269/index.html">TeleGeography World Wide Web Map. 2015 version</a></li>
<li><a href="../252271/index.html">Mobile application for the governor and sales agent</a></li>
<li><a href="../252273/index.html">Mobile Development Conference 2015: Announcement of Reports</a></li>
<li><a href="../252275/index.html">Hotpatch. Windows kernel memory patch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>