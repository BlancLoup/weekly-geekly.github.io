<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we saddled OPNsense</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, habrovchane! 

 Until the holivars on the subject diminish, whether it is immoral or not to use free platforms for creating commercial products...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we saddled OPNsense</h1><div class="post__text post__text-html js-mediator-article">  Hello, habrovchane! <br><br>  Until the holivars on the subject diminish, whether it is immoral or not to use free platforms for creating commercial products, we have done it on the sly.  And do not hesitate to take money from customers, because they wrote a really cool thing on the basis of free code - a universal hardware security gateway.  We used to have a commercially successful firewall, but for Microsoft Windows.  A stormy stream of ideas at some point came out of the shores of the "Windows", and the question arose - what next?  And then - Linux or Net / Open / Free BSD.  Our gurus got together, smoked and decided to use OPNsense instead of inventing their own bicycle.  This article will help those who want to do something similar. <br><br><img src="https://habrastorage.org/webt/zd/3_/nm/zd3_nmxapzoi1ps31meqmwwwi1a.jpeg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h4>  Why OPNsense? </h4><br>  First, OPNsense is a fork of the open UTM system pfSense, which is considered one of the best solutions of this class based on FreeBSD.  We studied the OPNsense code and we liked its quality, as well as the approach to the implementation of functionality.  Here, modern design principles are actively used, and above all - the MVC model, when data is stored in one place, and the display is done using a special subsystem of templates.  There are controllers for each module, normal WebAPI is implemented across all the functionality, the code is well structured, and the project leaders pay a lot of attention to the programming style.  This facilitates our development and support, the division of functionality into individual modules, the allocation of plug-ins and other programmer routine.  Among other things, the BSD license is ideally suited to the creators of a commercial product - it does not contain related to the so-called.  "Copyleft" restrictions.  The last one is on the list, but not the least important reason - earlier our developers had already used FreeBSD in their projects.  The experience and skills in any case can not be discounted. <br><br><h4>  Beginning of work </h4><br>  Cooperation with the OPNsense team began with the creation of the Russian localization for the main branch of the project.  It was expensive, professional translators worked for several months to Russify a huge number of interface elements, system messages and reference information with a large number of special terms - all this we still maintain up to date.  By the way, when we encounter errors in OPNsense, we offer fixes, improvements and improvements to the product, which are available to everyone for free, so that the ‚Äúbailouts who profit from free software‚Äù contributed to the development of free code. <br><br><h4>  Joining the mainstream </h4><br>  The guys from OPNsense were ready to cooperate.  When we make any changes, the key project developers respond promptly and immediately give feedback.  If we give the new functionality to the main branch of the basic project, we have to maintain it ourselves, but the search for errors and testing is seriously simplified.  There are times that are hard for us to live with, but we have to put up with them - the advantages of free software outweigh the disadvantages. <br><br>  <b>If we do refactoring affecting a large amount of code, OPNsense developers are not always able to quickly digest the changes.</b>  They simply do not have enough resources for this, so functions that are still not available in the basic version are already available in Traffic Inspector Next Generation.  In OPNsense, standard syslog is used, but we switched to syslog-ng a long time ago - it allows, for example, to write logs to the database.  The logging system affects a lot of things, the volume of changes was huge.  To port the code to OPNsense, we tried to break it into several iterations, but the process is not yet complete. <br><br>  The second point is related to changes in the web interface.  In OPNsense, the MVC model is far from being used everywhere, the inherited code stretches there from pfSense and we were offered to transfer it to new ‚Äúrails‚Äù.  We started the rework from the page with certificates, but when OPNsense figured out the amount of work required for the adoption of the new code, their hair stood on end. <br><br><h4>  Problems‚Ä¶ </h4><br>  Although we are the official distributors of OPNsense, this does not give elevated privileges to change the code of a free product.  The community controls its own economy, the project developers themselves should test and accept our changes.  We can only offer them to redo some solutions to facilitate the passage of changes. <br><br>  Accumulating differences with the main product code is a serious problem.  We try to build our work in such a way as to facilitate the update process as much as possible.  When the OPNsense update is transferred to Traffic Inspector Next Generation, our functionality should not break and it, in turn, should not break new OPNsense functionality.  It is important to understand that Traffic Inspector Next Generation is not an independently evolving fork - the interaction of products occurs constantly and it is difficult to keep them in a non-conflicting state.  The amount of work is crazy, but you have to live with it.  <b>It will not be possible to just stick your logo and take for the product for money, although some clever people try to do it.</b> <br><br><h4>  ... and solutions </h4><br>  We deal with the problems as follows: if there is an opportunity to add functionality by the plugin, we do so.  OPNsense has a well-thought-out API for embedding plug-ins, it rarely changes and developers pay enough attention to backward compatibility issues.  When the new version of OPNsense comes out, we also raise the new version of Traffic Inspector Next Generation and update the code base without a headache, although it is impossible to do without a headache. <br><br>  Another interesting point, not all of our achievements, we give to OPNsense.  Some of them are needed only on the Russian market, while proprietary modules have licensing restrictions.  In our country there is a law that obliges, for example, a cafe with a Wi-Fi access point to identify the client.  In Traffic Inspector Next Generation, this is done via SMS, but the local Russian cuisine is not interesting to anyone abroad. <br><br>  We can mention Kaspersky Anti-Virus - for it we have compiled a package using the Kaspersky Lab libraries.  You cannot integrate such a package into the main branch.  There is also a Russian resource filter in NetPolice categories, which implies a subscription to the service, and, of course, things related to the certification of the FSTEC.  Such, for example, as checking the integrity of the system and notifying administrators of its violations. <br><br>  The division of functionality into modules and the active use of plug-ins allowed us to effectively separate flies from cutlets, but there was a lot of difference between the two products.  In addition to those already mentioned, you can call the traffic reporting module and the single Control Center for working with several Traffic Inspector Next Generation devices.  There is also a plug-in for integration with Microsoft Active Directory, a system for restricting access to network resources by IP and MAC addresses, and NTLM authentication.  Some of these goodies will sooner or later appear in OPNsense, but many will never be there. <br><br><h4>  Machine differences </h4><br>  The most important difference: Traffic Inspector Next Generation is a hardware and software complex, i.e.  packaged solution.  We take the hardware of the leading manufacturers of server hardware, create software for it and sell everything that is called, in one piece.  The advantages are obvious: the customer receives a product that does not require complex configuration without problems with software compatibility.  At the same time, he has a limited warranty and, of course, free technical support by phone and email. <br><br>  The creators of free software can not test all hardware platforms and offer to use the software at your own risk.  From support, they have only documentation and forums, which we also have (moreover, Russian-speaking).  Add to this additional functionality that we have already described, and you will get Russified OPNsense on steroids along with ready-to-eat iron - you can pay for it.  Moreover, there are configurations with FSTEC certificate on sale and OPNsense will not offer you this one for objective reasons. <br><br><h4>  Conclusion: free free </h4><br>  The use of free products as a basis for commercial decisions requires an integrated approach and a trained team.  A large community of developers quickly notices and corrects errors, and also tracks changes made.  In our case, double control is obtained: we check the OPNsense code, and other project participants inspect our open code.  As a result, the quality increases and the reliability of both products increases.  It is difficult not to notice the cost reduction: we do not need to pay for licenses for the operating system, development tools and modules implementing UTM functionality.  This does not mean that we got everything for free.  The developers of the Smart-Soft team have devoted many years to creating solutions for the FreeBSD platform.  Our experience is a significant component of the cost of creating Traffic Inspector Next Generation, and there are also a lot of direct financial costs.  Developing solutions based on open source software is not a free pleasure, and if you miss this moment, you will not be able to do something worthy. </div><p>Source: <a href="https://habr.com/ru/post/350964/">https://habr.com/ru/post/350964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350952/index.html">Testing C / C ++ Projects with Python</a></li>
<li><a href="../350954/index.html">How to monitor the work of the business process and not be distracted by nonsense</a></li>
<li><a href="../350956/index.html">Rust: use serde to serialize</a></li>
<li><a href="../350960/index.html">Integration between monitoring and ITSM</a></li>
<li><a href="../350962/index.html">Hooks life cycle Vue.js</a></li>
<li><a href="../350966/index.html">Choosing Web Fonts: A Beginner's Guide</a></li>
<li><a href="../350968/index.html">Yandex opens Alice for all developers. Yandex.Dialogy Platform (beta)</a></li>
<li><a href="../350972/index.html">Organization of information systems production processes. Part 1. Starting point</a></li>
<li><a href="../350974/index.html">Slingshot APT: Advanced virus found - it went unnoticed for 6 years</a></li>
<li><a href="../350976/index.html">Guide to SEO javascript sites. Part 1. The Internet through the eyes of Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>