<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PowerShell for IT security. Part IV: Script Security Platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous post of this series, I suggested the possibility of combining my separate scripts ‚Äî one for handling events, the other for classificat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PowerShell for IT security. Part IV: Script Security Platform</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/cb/b6/59cbb6848bf94050802070.jpeg"><br><br>  In the <a href="https://habrahabr.ru/company/varonis/blog/338166/">previous post of</a> this series, I suggested the possibility of combining my separate scripts ‚Äî one for handling events, the other for classification ‚Äî into one system.  Is it possible to wipe the security platform on the basis of a single PowerShell code? <br><br>  After working through some of the details, mainly related to the dreadful events of PowerShell, I was able to declare my victory and registered a patent for a security platform based on scripts - Security Scripting Platform (SSP). <br><a name="habracut"></a><br>  <b>United States PowerShell</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      While I was getting an unforgettable experience with PowerShell, I realized that some of you may not remember my results of working with scripts. <br>  Let's remember them together. <br><br>  In the <a href="https://habrahabr.ru/company/varonis/blog/335176/">first note,</a> I presented an amazing line of PowerShell code that monitors file access events and runs a script block, similar to PS, that is, script code that runs in its own memory region. <br><br><pre><code class="hljs sql">1. Register-WmiEvent -Query "<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> __InstanceModificationEvent <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> TargetInstance ISA <span class="hljs-string"><span class="hljs-string">'CIM_DataFile'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TargetInstance.Path = <span class="hljs-string"><span class="hljs-string">'\\Users\\bob\\'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> targetInstance.Drive = <span class="hljs-string"><span class="hljs-string">'C:'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (targetInstance.Extension = <span class="hljs-string"><span class="hljs-string">'doc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> targetInstance.Extension = <span class="hljs-string"><span class="hljs-string">'txt)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> targetInstance.LastAccessed &gt; <span class="hljs-string"><span class="hljs-string">'$($cur)'</span></span> <span class="hljs-string"><span class="hljs-string">" -sourceIdentifier "</span></span>Accessor<span class="hljs-string"><span class="hljs-string">" -Action $action</span></span></code> </pre> <br>  Having added some elements of the script, I received the code, which I called the file access analysis application.  In fact, it counts access events and displays some basic statistical data, and also identifies access bursts that may indicate hacking attempts. <br><br>  This is a simplified version of the technology for analyzing user behavior, which is widely used here in the company <a href="https://www.varonis.com/ru">Varonis.</a> <a href="https://www.varonis.com/ru"><br></a> <br>  So far, so good. <br><br>  Then in the third note, I showed how using PowerShell you can relatively simply scan and categorize the files in a folder.  Since this action is associated with disk-intensive use, it makes sense to use the multitasking feature of PowerShell, known as Runspaces, to speed up the classification. <br><br>  Existing solutions for file event handling and data classification, say Varonis's Data Classification Framework, use a more optimized approach to categorizing files by transferring file operations to the classification module. <br><br>  Why? <br><br>  Because they do not need to re-classify the contents of the files again: only the files that are changed are considered.  Therefore, my script classifier will greatly benefit if it receives some information about file change events. <br><br>  I implemented this approach using a security platform using scripts. <br>  Varonis proprietary agents that intercept Linux or Windows file events are highly specialized, low-level code.  This type of operation requires code that is short, simple, and fully focused on gathering information about events and quickly transferring this data to other applications that will already handle higher-level processing. <br><br>  So I took my original event handling script, optimized it and deleted all the code to display statistical data.  Then I reworked the classifier to check only the modified files. <br><br>  Basically, this is a classic combination of the internal module and the external interface. <br>  The question is how to connect two scripts: how to inform the classifier about the operation with the file? <br><br>  <b>Messages and events</b> <br><br>  After I spent several long days studying the developer forums, I finally came across a PowerShell function called Register-EngineEvent. <br><br>  What is this PowerShell cmdlet? <br><br>  It seems to me that this is a way to send messages using a named event that can be shared in two scripts.  It works slightly differently from traditional system messages and queues, since the received message asynchronously starts the PowerShell script block.  Further it will become more understandable. <br><br>  The fact is that register-EngineEvent has two options.  With the -forward option, this cmdlet works as an event publisher.  Without the -forward option, it acts as a recipient. <br><br>  Clear? <br><br>  I used an event called Delta ‚Äî which technically plays the role of the SourceIdentifier ID ‚Äî to coordinate my event-handling script, which reports events, and my classifier script, which receives these messages. <br><br>  In the first of these two scripts, an excerpt from which is presented below, I show how I registered the public name of the Delta event using the line -Register-EngineEvent -forward, and then waited for the internal file access events.  When such an event occurred, I sent a message about the internal file event ‚Äî in PowerShell, I sent it to the corresponding Register-EngineEvent cmdlet in the classifier script in the second code snippet. <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> Register-EngineEvent -SourceIdentifier Delta -Forward <span class="hljs-number"><span class="hljs-number">2.</span></span> While ($true) { <span class="hljs-number"><span class="hljs-number">3.</span></span> $args=Wait-Event -SourceIdentifier Access # wait on internal <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> <span class="hljs-number"><span class="hljs-number">4.</span></span> Remove-Event -SourceIdentifier Access <span class="hljs-number"><span class="hljs-number">5.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($args.MessageData -eq <span class="hljs-string"><span class="hljs-string">"Access"</span></span>) { <span class="hljs-number"><span class="hljs-number">6.</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> some plain access processing <span class="hljs-number"><span class="hljs-number">7.</span></span> New-Event -SourceIdentifier Delta -EventArguments $args.SourceArgs -MessageData $args.MessageData #send <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> to classifier via forwarding <span class="hljs-number"><span class="hljs-number">8.</span></span> } <span class="hljs-number"><span class="hljs-number">9.</span></span> elseif ($args.MessageData -eq <span class="hljs-string"><span class="hljs-string">"Burst"</span></span>) { <span class="hljs-number"><span class="hljs-number">10.</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> some burst processing <span class="hljs-number"><span class="hljs-number">11.</span></span> New-Event -SourceIdentifier Delta -EventArguments $args.SourceArgs -MessageData $args.MessageData #send <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> to classifier via forwarding <span class="hljs-number"><span class="hljs-number">12.</span></span> } <span class="hljs-number"><span class="hljs-number">13.</span></span> }</code> </pre> <br>  On the recipient side, I didn‚Äôt use the -forward parameter and instead switched to a PowerShell script block that asynchronously processed the event.  You can see the result below. <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> Register-EngineEvent -SourceIdentifier Delta -Action { <span class="hljs-number"><span class="hljs-number">2.</span></span> <span class="hljs-number"><span class="hljs-number">3.</span></span> Remove-Event -SourceIdentifier Delta <span class="hljs-number"><span class="hljs-number">4.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($event.MessageData -eq <span class="hljs-string"><span class="hljs-string">"Access"</span></span>) { <span class="hljs-number"><span class="hljs-number">5.</span></span> $filename = $args[<span class="hljs-number"><span class="hljs-number">0</span></span>] #got <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>! <span class="hljs-number"><span class="hljs-number">6.</span></span> Lock-Object $deltafile.SyncRoot{ $deltafile[$filename]=<span class="hljs-number"><span class="hljs-number">1</span></span>} #lock&amp;load <span class="hljs-number"><span class="hljs-number">7.</span></span> } <span class="hljs-number"><span class="hljs-number">8.</span></span> elseif ($event.Messagedata -eq <span class="hljs-string"><span class="hljs-string">"Burst"</span></span>) { <span class="hljs-number"><span class="hljs-number">9.</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something <span class="hljs-number"><span class="hljs-number">10.</span></span> } <span class="hljs-number"><span class="hljs-number">11.</span></span> <span class="hljs-number"><span class="hljs-number">12.</span></span> }</code> </pre> <br>  Confused?  And I said recently that handling event files is not easy, and that my training scripts will not cope with handling real production loads? <br>  Confusion arises because the New-Event and Wait-Event cmdlets for internal event messaging are different from the external event messaging functions provided in Register-EngineEvent. <br><br>  <b>More confusion</b> <b><br></b> <br>  The full classification script is presented below.  I will tell you more about him in the next and last article in this series.  In the meantime, take a look at this script and note the event handling and multitasking. <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1.</span></span> Import-Module -Name .\pslock.psm1 -Verbose <span class="hljs-number"><span class="hljs-number">2.</span></span> function updatecnts { <span class="hljs-number"><span class="hljs-number">3.</span></span> Param ( <span class="hljs-number"><span class="hljs-number">4.</span></span> [parameter(position=<span class="hljs-number"><span class="hljs-number">1</span></span>)] <span class="hljs-number"><span class="hljs-number">5.</span></span> $match, <span class="hljs-number"><span class="hljs-number">6.</span></span> [parameter(position=<span class="hljs-number"><span class="hljs-number">2</span></span>)] <span class="hljs-number"><span class="hljs-number">7.</span></span> $obj <span class="hljs-number"><span class="hljs-number">8.</span></span> ) <span class="hljs-number"><span class="hljs-number">9.</span></span> <span class="hljs-number"><span class="hljs-number">10.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($j=<span class="hljs-number"><span class="hljs-number">0</span></span>; $j -lt $match.Count;$j=$j+<span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-number"><span class="hljs-number">11.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> -wildcard ($match[$j]) { <span class="hljs-number"><span class="hljs-number">12.</span></span> <span class="hljs-string"><span class="hljs-string">'Top*'</span></span> { $obj| Add-Member -Force -type NoteProperty -Name Secret -Value $match[$j+<span class="hljs-number"><span class="hljs-number">1</span></span>] } <span class="hljs-number"><span class="hljs-number">13.</span></span> <span class="hljs-string"><span class="hljs-string">'Sens*'</span></span> { $obj| Add-Member -Force -type NoteProperty -Name Sensitive -Value $match[$j+<span class="hljs-number"><span class="hljs-number">1</span></span>] } <span class="hljs-number"><span class="hljs-number">14.</span></span> <span class="hljs-string"><span class="hljs-string">'Numb*'</span></span> { $obj| Add-Member -Force -type NoteProperty -Name Numbers -Value $match[$j+<span class="hljs-number"><span class="hljs-number">1</span></span>] } <span class="hljs-number"><span class="hljs-number">15.</span></span> } <span class="hljs-number"><span class="hljs-number">16.</span></span> <span class="hljs-number"><span class="hljs-number">17.</span></span> } <span class="hljs-number"><span class="hljs-number">18.</span></span> <span class="hljs-number"><span class="hljs-number">19.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $obj <span class="hljs-number"><span class="hljs-number">20.</span></span> } <span class="hljs-number"><span class="hljs-number">21.</span></span> <span class="hljs-number"><span class="hljs-number">22.</span></span> $scan = { <span class="hljs-number"><span class="hljs-number">23.</span></span> $name=$args[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-number"><span class="hljs-number">24.</span></span> function scan { <span class="hljs-number"><span class="hljs-number">25.</span></span> Param ( <span class="hljs-number"><span class="hljs-number">26.</span></span> [parameter(position=<span class="hljs-number"><span class="hljs-number">1</span></span>)] <span class="hljs-number"><span class="hljs-number">27.</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>] $Name <span class="hljs-number"><span class="hljs-number">28.</span></span> ) <span class="hljs-number"><span class="hljs-number">29.</span></span> $classify =@{<span class="hljs-string"><span class="hljs-string">"Top Secret"</span></span>=[regex]<span class="hljs-string"><span class="hljs-string">'[tT]op [sS]ecret'</span></span>; <span class="hljs-string"><span class="hljs-string">"Sensitive"</span></span>=[regex]<span class="hljs-string"><span class="hljs-string">'([Cc]onfidential)|([sS]nowflake)'</span></span>; <span class="hljs-string"><span class="hljs-string">"Numbers"</span></span>=[regex]<span class="hljs-string"><span class="hljs-string">'[0-9]{3}-[0-9]{2}-[0-9]{3}'</span></span> } <span class="hljs-number"><span class="hljs-number">30.</span></span> <span class="hljs-number"><span class="hljs-number">31.</span></span> $data = Get-Content $Name <span class="hljs-number"><span class="hljs-number">32.</span></span> <span class="hljs-number"><span class="hljs-number">33.</span></span> $cnts= @() <span class="hljs-number"><span class="hljs-number">34.</span></span> <span class="hljs-number"><span class="hljs-number">35.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($data.Length -eq <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cnts} <span class="hljs-number"><span class="hljs-number">36.</span></span> <span class="hljs-number"><span class="hljs-number">37.</span></span> foreach ($key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $classify.Keys) { <span class="hljs-number"><span class="hljs-number">38.</span></span> <span class="hljs-number"><span class="hljs-number">39.</span></span> $m=$classify[$key].matches($data) <span class="hljs-number"><span class="hljs-number">40.</span></span> <span class="hljs-number"><span class="hljs-number">41.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($m.Count -gt <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-number"><span class="hljs-number">42.</span></span> $cnts+= @($key,$m.Count) <span class="hljs-number"><span class="hljs-number">43.</span></span> } <span class="hljs-number"><span class="hljs-number">44.</span></span> } <span class="hljs-number"><span class="hljs-number">45.</span></span> $cnts <span class="hljs-number"><span class="hljs-number">46.</span></span> } <span class="hljs-number"><span class="hljs-number">47.</span></span> scan $name <span class="hljs-number"><span class="hljs-number">48.</span></span> } <span class="hljs-number"><span class="hljs-number">49.</span></span> <span class="hljs-number"><span class="hljs-number">50.</span></span> <span class="hljs-number"><span class="hljs-number">51.</span></span> $outarray = @() #where I keep classification stats <span class="hljs-number"><span class="hljs-number">52.</span></span> $deltafile = [hashtable]::Synchronized(@{}) #hold <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> events <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> master loop <span class="hljs-number"><span class="hljs-number">53.</span></span> <span class="hljs-number"><span class="hljs-number">54.</span></span> $list=Get-WmiObject -Query <span class="hljs-string"><span class="hljs-string">"SELECT * From CIM_DataFile where Path = '\\Users\\bob\\' and Drive = 'C:' and (Extension = 'txt' or Extension = 'doc' or Extension = 'rtf')"</span></span> <span class="hljs-number"><span class="hljs-number">55.</span></span> <span class="hljs-number"><span class="hljs-number">56.</span></span> <span class="hljs-number"><span class="hljs-number">57.</span></span> #long list --let<span class="hljs-string"><span class="hljs-string">'s multithread 58. 59. #runspace 60. $RunspacePool = [RunspaceFactory]::CreateRunspacePool(1,5) 61. $RunspacePool.Open() 62. $Tasks = @() 63. 64. 65. foreach ($item in $list) { 66. 67. $Task = [powershell]::Create().AddScript($scan).AddArgument($item.Name) 68. $Task.RunspacePool = $RunspacePool 69. 70. $status= $Task.BeginInvoke() 71. $Tasks += @($status,$Task,$item.Name) 72. } 73. 74. 75. Register-EngineEvent -SourceIdentifier Delta -Action { 76. 77. Remove-Event -SourceIdentifier Delta 78. if($event.MessageData -eq "Access") { 79. $filename = $args[0] #got file 80. Lock-Object $deltafile.SyncRoot{ $deltafile[$filename]=1} #lock&amp; load 81. } 82. elseif ($event.Messagedata -eq "Burst") { 83. #do something 84. } 85. } 86. 87. while ($Tasks.isCompleted -contains $false){ 88. 89. } 90. 91. #check results of tasks 92. for ($i=0; $i -lt $Tasks.Count; $i=$i+3){ 93. $match=$Tasks[$i+1].EndInvoke($Tasks[$i]) 94. 95. 96. if ($match.Count -gt 0) { # update clasafication array 97. $obj = New-Object System.Object 98. $obj | Add-Member -type NoteProperty -Name File -Value $Tasks[$i+2] 99. #defaults 100. $obj| Add-Member -type NoteProperty -Name Secret -Value 0 101. $obj| Add-Member -type NoteProperty -Name Sensitive -Value 0 102. $obj| Add-Member -type NoteProperty -Name Numbers -Value 0 103. 104. $obj=updatecnts $match $obj 105. $outarray += $obj 106. } 107. $Tasks[$i+1].Dispose() 108. 109. } 110. 111. $outarray | Out-GridView -Title "Content Classification" #display 112. 113. #run event handler as a separate job 114. Start-Job -Name EventHandler -ScriptBlock({C:\Users\bob\Documents\evhandler.ps1}) #run event handler in background 115. 116. 117. while ($true) { #the master executive loop 118. 119. 120. Start-Sleep -seconds 10 121. Lock-Object $deltafile.SyncRoot { #lock and iterate through synchronized list 122. foreach ($key in $deltafile.Keys) { 123. 124. $filename=$key 125. 126. if($deltafile[$key] -eq 0) { continue} #nothing new 127. 128. $deltafile[$key]=0 129. $match = &amp; $scan $filename #run scriptblock 130. #incremental part 131. 132. $found=$false 133. $class=$false 134. if($match.Count -gt 0) 135. {$class =$true} #found sensitive data 136. if($outarray.File -contains $filename) 137. {$found = $true} #already in the array 138. if (!$found -and !$class){continue} 139. 140. #let'</span></span>s add/update <span class="hljs-number"><span class="hljs-number">141.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$found) { <span class="hljs-number"><span class="hljs-number">142.</span></span> <span class="hljs-number"><span class="hljs-number">143.</span></span> $obj = New-Object System.Object <span class="hljs-number"><span class="hljs-number">144.</span></span> $obj | Add-Member -type NoteProperty -Name File -Value $Tasks[$i+<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-number"><span class="hljs-number">145.</span></span> #defaults <span class="hljs-number"><span class="hljs-number">146.</span></span> $obj| Add-Member -type NoteProperty -Name Secret -Value <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">147.</span></span> $obj| Add-Member -type NoteProperty -Name Sensitive -Value <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">148.</span></span> $obj| Add-Member -type NoteProperty -Name Numbers -Value <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">149.</span></span> <span class="hljs-number"><span class="hljs-number">150.</span></span> $obj=updatecnts $match $obj <span class="hljs-number"><span class="hljs-number">151.</span></span> <span class="hljs-number"><span class="hljs-number">152.</span></span> } <span class="hljs-number"><span class="hljs-number">153.</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-number"><span class="hljs-number">154.</span></span> $outarray|? {$_.File -eq $filename} | % { updatecnts $match $_} <span class="hljs-number"><span class="hljs-number">155.</span></span> } <span class="hljs-number"><span class="hljs-number">156.</span></span> $outarray | Out-GridView -Title <span class="hljs-string"><span class="hljs-string">"Content Classification ( $(get-date -format M/d/yy:HH:MM) )"</span></span> <span class="hljs-number"><span class="hljs-number">157.</span></span> <span class="hljs-number"><span class="hljs-number">158.</span></span> } #foreach <span class="hljs-number"><span class="hljs-number">159.</span></span> <span class="hljs-number"><span class="hljs-number">160.</span></span> } #lock <span class="hljs-number"><span class="hljs-number">161.</span></span> }#<span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">162.</span></span> <span class="hljs-number"><span class="hljs-number">163.</span></span> Write-Host <span class="hljs-string"><span class="hljs-string">"Done!"</span></span></code> </pre> <br>  In short, this classifier performs an initial scan of files in a folder, saves the classification results to $ outarray, then, when a file change event occurs, it updates $ outarray, entering new classification data into it.  In other words, a system for adding data is implemented. <br><br>  There is a minor side problem with the need to work with updates in $ outarray, which occurs every time a search is made in a different part of the classification script for what has been changed in this hash table variable. <br><br>  This is a classic match.  And to handle this situation, I decided to use synchronized PowerShell variables. <br><br>  I will tell you more about this mysterious PowerShell function in my next post, and in conclusion I will say a few words about how to make your own solutions. </div><p>Source: <a href="https://habr.com/ru/post/338848/">https://habr.com/ru/post/338848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338832/index.html">Numbers - Douglas Crockford‚Äôs paper on number systems in life and in programming</a></li>
<li><a href="../338836/index.html">Design patterns in test automation</a></li>
<li><a href="../338840/index.html">How faster DOM build: parsing, async, defer and preload</a></li>
<li><a href="../338844/index.html">Web server - your first Arduino network program</a></li>
<li><a href="../338846/index.html">How to get frustrated and NOT go Linux</a></li>
<li><a href="../338850/index.html">Strange character and hot announcements of the first days of Microsoft Ignite</a></li>
<li><a href="../338852/index.html">Why do business games and what have the ERA</a></li>
<li><a href="../338854/index.html">How we did design for bitcoin</a></li>
<li><a href="../338856/index.html">Become a hacker: from ‚ÄúTest lab‚Äù to ‚ÄúCorporate laboratories‚Äù</a></li>
<li><a href="../338858/index.html">How to make gif-animation for Behance and Dribbble?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>