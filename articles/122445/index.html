<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Memo to ssh users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="abstract: The article describes the advanced features of OpenSSH, which allow you to greatly simplify the life of system administrators and programmer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Memo to ssh users</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/784/133/dac/784133dac3a6daa093e5a8174962be7f.png" align="right">  abstract: The article describes the advanced features of OpenSSH, which allow you to greatly simplify the life of system administrators and programmers who are not afraid of the shell.  Unlike most manuals, which do not describe anything except the keys and the -L / D / R options, I tried to collect all the interesting features and conveniences that ssh carries with them. <br><br>  Warning: the post is <em>very</em> voluminous, but for ease of use, I decided not to cut it apart. <br><br>  Table of contents: <br><ul><li>  key management </li><li>  copying files via ssh </li><li>  Forwarding I / O streams </li><li>  Mounting a remote FS via ssh </li><li>  Remote code execution </li><li>  Aliases and options for connections in .ssh / config </li><li>  Default options </li><li>  Forwarding the X server </li><li>  ssh as socks proxy </li><li>  Port forwarding - forward and reverse </li><li>  Reverse Sox Proxy </li><li>  tunneling L2 / L3 traffic </li><li>  Forwarding authorization agent </li><li>  Ssh tunneling through ssh through untrusted server ( <b>you most likely do not know this</b> ) </li></ul><a name="habracut"></a><br><h1>  Key management </h1><br>  Theory in a few words: ssh can log in not by password, but by key.  The key consists of an open and closed part.  Open is placed in the user's home directory, "who" go to the server, closed - in the user's home directory, which goes to a remote server.  Halves are compared (I'm exaggerating) and if everything is ok, they let it go.  Important: not only the client on the server is authorized, but also the server in relation to the client (that is, the server has its own key).  The main feature of the key compared to the password is that it cannot be ‚Äústolen‚Äù by hacking the server - the key is not transferred from the client to the server, and during authorization the client proves to the server that he owns the key (the same cryptographic magic). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Key generation </h2><br>  You can generate your key using the ssh-keygen command.  If you do not set the parameters, then it will save everything as it should. <br><br>  The key can be locked with a password.  This password (in regular graphical interfaces) is asked once and saved for a while.  If the password is empty, it will not be asked for use.  Recover a forgotten password is impossible. <br><br>  You can change the password to the key using the <b>ssh-keygen -p</b> command. <br><br><h2>  Key structure </h2><br>  (if the question about the location was answered by default). <br>  <b>~ / .ssh / id_rsa.pub</b> - public key.  It is copied to the server where you want to access. <br>  <b>~ / .ssh / id_rsa</b> - private key.  It can not be shown to anyone.  If you copy it to a letter / chat instead of pub, then you need to generate a new key.  (I'm not kidding, about 10% of people who ask to give ssh-key post id_rsa, and of these ten percent of male 100%). <br><br><h2>  Copy key to server </h2><br>  In the directory of the user under which you want to log in, if you create a file <b>~ / .ssh / authorized_keys</b> and put the public key there, then you can enter without a password.  Please note that file permissions should not allow other users to write to this file, otherwise ssh will not accept it.  In the key, the last field is user @ machine.  It has no relation to authorization and serves only for convenience of determining where is whose key.  Note that this field can be changed (or even deleted) without breaking the key structure. <br><br>  If you know the user's password, the process can be simplified.  The <b>ssh-copy-id user @ server</b> command allows you to copy the key without editing the files manually. <br><br>  Note: Older ssh manuals mention about authorized_keys2.  The reason: there was the first version of ssh, then the second (current) became, for it they made their own set of configs, everyone was very tired, and the second version had long since switched to the version without any ‚Äú2‚Äù.  That is always authorized_keys and not to think about different versions. <br><br>  If you have ssh on a non-standard port, then ssh-copy-id requires special tricks to work with: <code>ssh-copy-id '-p 443 user@server'</code> (focus on quotes). <br><br><h2>  Server key </h2><br>  The first time you go to the server, ssh asks you if you trust the key.  If you answer no, the connection is closed.  If yes, the key is saved to the file <b>~ / .ssh / known_hosts</b> .  Find out where the key can not be (for nesekurno). <br><br>  If the server key has changed (for example, the server has been reinstalled), ssh screams from a fake key.  Please note, if the server was not touched, and ssh screams, it means you are not breaking into that server (for example, another computer with the same IP appeared on the network, all local networks with 192.168.1.1, of which there are several millions in the world) suffer .  The ‚Äúevil man in the middle attack‚Äù scenario is unlikely, more often just an error with IP, although if ‚Äúeverything is good‚Äù and the key has changed, this is a reason to raise the paranoia level by a couple of levels (and if you have authorization by key, and the server suddenly asked for a password - that paranoia can be turned on 100% and the password is not entered). <br><br>  You can delete a known server key using the <b>ssh-keygen -R server</b> command.  At the same time, you also need to delete the IP key (they are stored separately): <b>ssh-keygen -R 127.0.0.1</b> . <br><br>  The server key is stored in <b>/ etc / ssh / ssh_host_rsa_key</b> and <b>/etc/ssh/ssh_host_rsa_key.pub</b> .  They can be: <br>  a) copy from the old server to the new one. <br>  b) generate with ssh-keygen.  No password is required (i.e. empty).  The password with the password ssh-server can not use. <br><br>  Note, if you are cloning a server (for example, in virtual machines), then the server's ssh-keys need to be regenerated. <br><br>  It is better to remove old keys from know_hosts, otherwise ssh will swear at the duplicate key. <br><hr><br><h1>  Copying files </h1><br>  Transferring files to the server can sometimes be tiring.  In addition to messing with sftp and other strange things, ssh provides us with the <b>scp</b> command, which performs the copying of a file through an ssh session. <br><br> <code>scp path/myfile user@8.8.8.8:/full/path/to/new/location/ <br></code> <br><br>  You can also back: <br> <code>scp user@8.8.8.8:/full/path/to/file /path/to/put/here <br></code> <br><br>  Fish warning: Despite the fact that mc can do a ssh connection, copying large files will be very painful, because  fish (the mc module for working with ssh as with virtual fs) is very slow.  100-200kb - the limit, then begins the test of patience.  (I remembered my very early youth, when not knowing about scp, I copied ~ 5GB via fish in mc, it took a little more than 12 hours on FastEthernet). <br><br>  Ability to copy cool.  But I want to ‚Äúsave as‚Äù - and immediately to the server.  And in the graphic mode to copy not from a special program, but from any familiar one. <br><br>  So, too, you can: <br><br><h1>  sshfs </h1><br>  Theory: the fuse module allows you to ‚Äúexport‚Äù file system requests from the kernel back to the userspace to the appropriate program.  This makes it easy to implement pseudo-file systems.  For example, we can provide access to a remote file system via ssh so that all local applications (with a few exceptions) will not suspect anything. <br><br>  Actually, the exception: O_DIRECT is not supported, alas (this is not a sshfs problem, this is a fuse problem in general). <br><br>  Usage: install the sshfs package (it will bring fuse itself). <br><br>  Actually, an example of my script that mounts desunote.ru (located on my home computer - it shows pictures in this article) to my laptop: <br><br><pre> #! / bin / bash
 sshfs desunote.ru:/var/www/desunote.ru//media/desunote.ru -o reconnect
</pre><br><br>  Make the file + x, call, go to any application, say save and see: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/75c/2b5/e5a/75c2b5e5ab213271ae7bcd828c2f21a8.png"><br><br>  The sshfs options that may be important: -o reconnect (says trying to reconnect instead of errors). <br><br>  If you work a lot with data from the root, you can (need) do an idmap: <br><br>  <b>-o idmap = user</b> .  It works as follows: if we connect as a pupkin @ server user, and locally work as a vasiliy user, then we say "assume that the pupkin files are the vasiliy files".  well, or ‚Äúroot‚Äù if we connect as root. <br><br>  In my case, idmap is not needed because the usernames (local and remote) are the same. <br><br>  Note, it only works comfortably if we have an ssh-key (see the beginning of the article), if not - password authorization drives out a 2-3 connection. <br><br>  You can disable it back with the <b>fusermount -u / path</b> command, however, if the connection is stuck (for example, there is no network), then you can / should do it from under the root: sudo umount -f / path. <br><br><hr><br><h1>  Remote code execution </h1><br>  ssh can execute a command on a remote server and close the connection immediately.  The simplest example is: <br><br> <code>ssh user@server ls /etc/ <br></code> <br><br>  Print the contents of / etc / to us on the server, and we will have a local command line. <br><br>  Some applications want to have a controlling terminal.  They should be run with the -t option: <br> <code>ssh user@server -t remove_command <br></code> <br><br>  By the way, we can do something like this: <br> <code>ssh user@server cat /some/file|awk '{print $2}' |local_app <br></code> <br><br>  This brings us to the following feature: <br><h2>  Forward stdin / out </h2><br>  Suppose we want to make a request to the program remotely, and then put its output in a local file <br><br>  ssh user@8.8.8.8 command&gt; my_file <br><br>  Suppose we want to put a local output remotely <br><br>  mycommand | scp - user@8.8.8.8: / path / remote_file <br><br>  Let's complicate an example - we can transfer files from the server to the server: Make a chain to put stdin on 10.1.1.2, which is not available to us outside: <br><br>  mycommand |  ssh user@8.8.8.8 "scp - user@10.1.1.2: / path / to / file" <br><br>  There is such a puzzling method of using pipe (kindly suggested in the comments in LJ): <br><br> <code>tar -c * | ssh user@server "cd &amp;&amp; tar -x" <br></code> <br><br>  Tar packs files by mask locally, writes them to stdout, from where ssh reads them, transfers to stdin on a remote server, where cd ignores them (does not read stdin), and tar reads and unpacks.  So say the scp for the poor. <br><br><h1>  Aliases </h1><br>  Frankly, until recently, did not know and did not use.  Turned out to be very comfortable. <br><br>  In a more or less large company, it often happens that the server names look like this: spb-MX-i3.extrt.int.company.net.  And the user there is not equal to the local one.  That is, you need to log in as follows: ssh ivanov_i@spb-MX-i3.extrt.int.company.net.  To print every time - tunnel syndromes will not get enough.  In small companies, the problem is reversed - no one thinks about DNS, and a call to the server looks like this: ssh root@192.168.1.4.  In short, but still annoying.  Even more drama, if we have a non-standard port, and, for example, the first version of ssh (hello to tsiskam).  Then everything looks like this: ssh -1 -p 334 vv_pupkin@spb-MX-i4.extrt.int.company.net.  Strangle.  I don‚Äôt even want to talk about drama with scp. <br><br>  You can write system-wide alias on IP (/ etc / hosts), but this is a crooked way out (and the user and options print anyway).  There is a shorter way. <br><br>  The <b>~ / .ssh / config</b> file allows you to set connection parameters, including special ones for servers, which is the most important, for each server.  Here is an example config: <br><br><pre> Host ric
         Hostname ooo-horn-and-hoof.rf
         User Administrator
         ForwardX11 yes
         Compression yes
 Host home
         Hostname myhome.dyndns.org
         User vasya
         PasswordAuthentication no
</pre><br><br>  All options available for use can be seen in <b>man ssh_config</b> (not to be confused with sshd_config). <br><hr><br><h1>  Default options </h1><br>  At the prompt <a href="https://habrahabr.ru/users/uuser/" class="user_link">UUSER</a> : you can specify default connection settings using the Host * construct, that is, for example: <br><br><pre> Host *
 User root
 Compression yes
</pre><br><br>  The same can be done in / etc / ssh / ssh_config (not to be confused with / etc / ssh / ssh <b>d</b> _config), but this requires root rights and applies to all users. <br><br><hr><br><br><h1>  Forwarding the X server </h1><br>  Actually, a little bit, I went through this part in the config example above.  ForwardX11 is just that. <br><br>  Theory: Graphic applications in Unix typically use an X server (wayland is on the way, but still not ready).  This means that the application starts and connects to the X-server for drawing.  In other words, if you have a bare server without Gui and there is a local x-server (in which you work), then you can allow applications from the server to draw on your desktop.  Typically, connecting to a remote X server is not the most secure and trivial thing.  SSH allows you to simplify this process and make it completely secure.  And the ability to reap traffic also allows you to get by with less traffic (i.e., reduce channel utilization, that is, reduce ping (more precisely, latency), that is, reduce lags). <br><br>  Keys: -X - probros X-server.  -Y login authentication. <br><br>  Just remember the ssh -XYC user @ SERVER combination. <br>  In the example above (fictitious company names), I connect to the ooo-horn-and-hoof.rf server for a reason, and in order to gain access to the windows-server.  <a href="http://technet.microsoft.com/en-us/security/bulletin/ms11-083">We all know the</a> security of microsoft when working on the network, so it‚Äôs uncomfortable to expose a bare RDP.  Instead, we connect to the server via ssh, and then run the rdesktop command there: <br> <code>ssh ric <br> rdesktop -k en-us 192.168.1.1 -g 1900x1200 <br></code> <br><br>  and a miracle, login window in windows on our desktop.  Note, carefully encrypted and indistinguishable from normal ssh-traffic. <br><img src="https://habrastorage.org/getpro/habr/post_images/db6/2c2/14c/db62c214cad5492b401c4ca9b09ae16e.png"><br><br><hr><br><h1>  Socks proxy </h1><br>  When I find myself in another hotel (cafe, conference), then local wifi often turns out to be terrible - closed ports, what level of security is unknown.  And there is not much confidence in other people's access points (this is not paranoia, I quite watched as passwords and cookies are taken away with the help of a banal laptop that distributes 3G to everyone with the name of a nearby cafe (and writes interesting in the process)). <br><br>  Special problems deliver closed ports.  That dzhabber will cover, then IMAP, then something else. <br><br>  Regular VPN (pptp, l2tp, openvpn) does not work in such situations - they simply do not let it through.  It is experimentally known that the 443rd port is most often left, and in the CONNECT mode, that is, they are passed "as is" (the usual http can still be wrapped transparently on the squid). <br><br>  The solution is <em>socks-proxy</em> ssh mode.  Its principle is: the ssh client connects to the server and listens locally.  After receiving the request, he sends it (through an open connection) to the server, the server establishes the connection according to the request and sends all data back to the ssh client.  And he responds to the applicant.  To work, you need to tell applications to use socks-proxy.  And specify the IP address of the proxy.  In the case of ssh, this is most often localhost (so you don‚Äôt give your channel to strangers). <br><br>  Connecting in sock-proxy mode looks like this: <br><pre> ssh -D 8080 user @ server
</pre><br><br>  Due to the fact that other people's wifi is often not only fig, but also laggy, it is not bad to turn on the -C option (compress traffic).  It turns out almost opera turbo (only the pictures are not too tight).  In real surfing on http, it‚Äôs about 2-3 times too tight (read - if you have a 64kbp accident, you‚Äôll open megabyte pages not for two minutes, but for 40 seconds. That is not good, but it's better).  But the main thing: no stolen cookies and overheard sessions. <br><br>  I said for good reason about the closed ports.  The 22nd port is closed exactly the same way as the ‚Äúunnecessary‚Äù jabber port.  The solution is to hang the server on port 443.  You should not remove it from 22, sometimes there are systems with DPI (deep packet inspection) that your ‚Äúpseudo-ssl‚Äù will not allow. <br><br>  This is what my config looks like: <br><br>  / etc / ssh / sshd_config: <br>  (fragment) <br>  Port 22 <br>  Port 443 <br><br>  And here is a piece of ~ / .ssh / config from a laptop that describes vpn <br><br><pre> Host vpn
     Hostname desunote.ru
     User vasya
     Compression yes
     DynamicForward 127.1: 8080
     Port 443
</pre><br><br>  (Pay attention to the ‚Äúlazy‚Äù form of the localhost entry - 127.1, this is quite a legitimate method to write 127.0.0.1) <br><br><hr><br><h1>  Port forwarding </h1><br>  We turn to the extremely difficult to understand part of the SSH functionality, which allows performing puzzling TCP tunneling operations ‚Äúfrom the server‚Äù and ‚Äúto the server‚Äù. <br><br>  To understand the situation, all the examples below will refer to this scheme: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a6/f7e/772/8a6f7e772b229939f690db8b89190c94.png"><br><br>  Comments: Two gray networks.  The first network resembles a typical office network (NAT), the second is a ‚Äúgateway‚Äù, that is, a server with a white interface and a gray one looking into its own private network.  In further discussion, we assume that ‚Äúour‚Äù laptop is A, and ‚Äúserver‚Äù is B. <br><br>  <u>Task</u> : we have an application running locally, we need to enable another user (outside our network) to look at it. <br><br>  Solution: forwarding the local port (127.0.0.1:80) to a publicly available address.  Suppose our ‚Äúpublicly available‚Äù B has occupied port 80 with something useful, so we will be forwarding to a non-standard port (8080). <br><br>  The final configuration: requests for 8.8.8.8:8080 will go to the localhost of notebook A. <br><br> <code>ssh -R 127.1:80:8.8.8.8:8080 user@8.8.8.8 <br></code> <br><br>  The <b>-R</b> option allows you to redirect the port to your (local) port from a remote ( <b>R</b> emote) server. <br>  Important: if we want to use the address 8.8.8.8, then we need to enable GatewayPorts in the server B settings. <br>  <u>Task</u> .  On server ‚ÄúB‚Äù a certain demon is listening (say, an sql server).  Our application is not compatible with the server (other bits, OS, evil admin, prohibiting and imposing limits, etc.).  We want to locally access the remote localhost. <br><br>  Final configuration: requests to localhost: 3333 to 'A' should be serviced by a daemon to localhost: 3128 'B'. <br><br> <code>ssh -L 127.1:3333:127.1:3128 user@8.8.8.8 <br></code> <br><br>  The <b>-L</b> option allows local calls ( <b>L</b> ocal) to be sent to a remote server. <br><br>  <u>Task</u> : On server ‚ÄúB‚Äù on a gray interface, a certain service is listening and we want to enable a colleague (192.168.0.3) to look at this application. <br><br>  Summary configuration: requests to our gray IP address (192.168.0.2) fall on the gray interface of server B. <br><br> <code>ssh -L 192.168.0.2:8080:10.1.1.1:80 user@8.8.8.8 <br></code> <br><br><h2>  Nested tunnels </h2><br>  Of course, the tunnels can be redirected. <br><br>  Let's complicate the task: now we want to show a colleague the application running on localhost on a server with the address 10.1.1.2 (on port 80). <br><br>  The solution is difficult: <br> <code>ssh -L 192.168.0.2:8080:127.1:9999 user@8.8.8.8 ssh -L 127.1:9999:127.1:80 user2@10.1.1.2 <br></code> <br><br>  What's happening?  We tell ssh to redirect local requests from our address to localhost of server B and immediately after connecting, start ssh (that is, ssh client) on server B with the option to listen to localhost and send requests to server 10.1.1.2 (where the client should connect).  Port 9999 is chosen arbitrarily, as long as it matches the first call and the second one. <br><br><h2>  Reverse Sox Proxy </h2><br><br>  If the previous example seemed simple and obvious to you, then try to guess what this example will do: <br> <code>ssh -D 8080 -R 127.1:8080:127.1:8080 user@8.8.8.8 ssh -R 127.1:8080:127.1:8080 user@10.1.1.2 <br></code> <br>  If you are a security officer whose task is to prohibit the use of the Internet on the server 10.1.1.2, then you can start pulling out the hair on the pope, because this team organizes Internet access for the server 10.1.1.2 by means of a socks proxy running on computer "A".  Traffic is completely encrypted and indistinguishable from any other SSH traffic.  And outgoing traffic from the computer from the point of view of the ‚Äú192.168.0 / 24‚Äù network is not distinguishable from the normal traffic of computer A. <br><hr><br><h1>  Tunneling </h1><br>  If at this point the priest of the security department does not shine with a bald spot, and ssh is still not listed as the number one enemy of security enemies, here‚Äôs your ultimate killer of everything: IP tunneling or even ethernet.  In the most radical cases, this allows dhcp tunneling, remote arp spoofing, wake up on lan, and other second-level disgraces. <br><br>  Details are described here: <a href="http://www.khanh.net/blog/archives/51-using-openSSH-as-a-layer-2-ethernet-bridge-VPN.html">www.khanh.net/blog/archives/51-using-openSSH-as-a-layer-2-ethernet-bridge-VPN.html</a> <br><br>  (I myself, alas, did not use this). <br><br>  It is easy to understand that in such conditions it is impossible to catch such tunnels with any DPI (deep packet inspection) - either ssh is allowed (read - do what you want), or ssh is forbidden (and you can safely leave such a company of idiots without feeling the slightest regret). <br><br><h1>  Forward authorization </h1><br>  If you think that this is all, then ........ however, unlike the author, who has not yet written ‚Äúbelow‚Äù, the reader sees in advance that there are a lot of letters below and intrigue does not work. <br><br>  OpenSSH allows you to use servers as a springboard for connecting to other servers, even if these servers are untrusted and can be abused with anything they want. <br><br>  For a start, about simple authentication authorization. <br><br>  I repeat the picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a6/f7e/772/8a6f7e772b229939f690db8b89190c94.png"><br><br>  Suppose we want to connect to the server 10.1.1.2, which is ready to accept our key.  But we don‚Äôt want to copy it to 8.8.8.8, because there is a thoroughfare and half of the people there have sudo and can be searched through other directories.  A compromise option would be to have a ‚Äúdifferent‚Äù ssh-key that would authorize user@8.8.8.8 to 10.1.1.2, but if we don‚Äôt want to let anyone get from 8.8.8.8 to 10.1.1.2, then this is not an option (much less that the key can not only be copied, but also copied to itself ‚Äúfor a rainy day‚Äù). <br><br>  ssh offers the possibility of a forward ssh agent (this is a service that requests a password to the key).  The <b>ssh -A</b> option forward authorization to a remote server. <br><br>  The call looks like this: <br><br> <code>ssh -A user@8.8.8.8 ssh user2@10.1.1.2 <br></code> <br><br>  A remote ssh client (at 8.8.8.8) can prove 10.1.1.2 that we are we only if we are connected to this server and have given the ssh client access to its authorization agent (but not the key!). <br><br>  In most cases, it rolls. <br><br>  However, if the server is completely bad, then the root server can use a socket for impersonalization when we are connected. <br><br>  There is an even more powerful method - it turns ssh into a simple pipe (in the sense of ‚Äúpipe‚Äù) through which we work through a remote server. <br><br>  The main advantage of this method is complete independence from the power of attorney of the intermediate server.  He can use a fake ssh server, log all bytes and all actions, intercept any data and fake it as he wants - the interaction goes between the ‚Äúfinal‚Äù server and the client.  If the data of the terminal server is tampered with, then the signature will not converge.  If the data is not tampered with, then the session is established in protected mode, so there is nothing to intercept. <br><br>  I did not know this cool setting, and dug out its <a href="https://habrahabr.ru/users/redrampage/" class="user_link">redrampage</a> . <br><br>  The configuration is tied to two ssh options: the -W option (which turns ssh into a pipe) and the <b>ProxyCommand config</b> option (command line options, it seems, no), which says "start the program and stick to its stdin / out".  These options have appeared recently, so centos users are in flight. <br><br>  It looks like this (tsiferki picture above): <br><br>  .ssh / config: <br><pre> Host raep
      HostName 10.1.1.2
      User user2
      ProxyCommand ssh -W% h:% p user@8.8.8.8
</pre><br><br>  Well, the connection is trivial: <code>ssh raep</code> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will repeat an important thought: the 8.8.8.8 server cannot intercept or forge traffic, use the user authorization agent or otherwise change the traffic. </font><font style="vertical-align: inherit;">Prohibit - yes, it can. </font><font style="vertical-align: inherit;">But if allowed - skip through itself without decoding or modification. </font><font style="vertical-align: inherit;">For the configuration to work, you need to have your public key in authorized_keys for both user@8.8.8.8 and user2@10.1.1.2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, the connection can be equipped with all other baubles - port sweeping, file copying, sox proxy, L2 tunnels X servers, etc.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The final </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Of course, in a post about tunnels there must be a tunnel, and in any successful article - the secret ingredient of universal popularity. </font></font> Keep: <br><img src="https://habrastorage.org/getpro/habr/post_images/a39/cc7/aee/a39cc7aeede3a100a92e75d5c53e7042.jpg"></div><p>Source: <a href="https://habr.com/ru/post/122445/">https://habr.com/ru/post/122445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122429/index.html">First Summer Feedback</a></li>
<li><a href="../122432/index.html">RURU: Payment system from Alfa-Bank and Beeline</a></li>
<li><a href="../122433/index.html">A first look at the Nokia N9: a couple of videos and a couple of thoughts</a></li>
<li><a href="../122437/index.html">TOP-100 leading web studios Russia-2011</a></li>
<li><a href="../122438/index.html">Advertising a program that disguises a Facebook account with Excel</a></li>
<li><a href="../122446/index.html">"Face control in the supermarket" or registration before purchase</a></li>
<li><a href="../122447/index.html">Inverser - APOZH for Android</a></li>
<li><a href="../122451/index.html">PHP script that updates itself</a></li>
<li><a href="../122455/index.html">Blitz review of the BlackBerry PlayBook</a></li>
<li><a href="../122457/index.html">SkyDrive update and how to connect SkyDrive as a network resource</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>