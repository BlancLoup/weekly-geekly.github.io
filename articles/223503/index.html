<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Putting in order the css-code. Yandex experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 I am working on the front-end of a huge project - Yandex search results. And we, like any other large web project, have a huge amount of css...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Putting in order the css-code. Yandex experience</h1><div class="post__text post__text-html js-mediator-article"> Hello! <br><br>  I am working on the front-end of a huge project - Yandex search results.  And we, like any other large web project, have a huge amount of css-code and a rather big team that interacts with it. <br><br>  When many people write and edit css using different tools, over time this css can turn out to be very confusing, inconsistent and generally begins to look bad.  For example, it is more convenient for someone to write vendor prefixes in the same order, for someone in another, someone puts quotes around the url, someone does not, and someone fixes an urgent bug to release could, for example, <code>position: relative</code> at the beginning of the property block, without noticing that somewhere between <code>color</code> and <code>box-shadow</code> , is already <code>position: absolute</code> , and wondering for a long time why nothing works. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="http://habrahabr.ru/company/yandex/blog/223503/"><img src="https://habrastorage.org/getpro/habr/post_images/9be/f10/925/9bef109258aff563f8fcff4a3177ccb1.png" width="800"></a> <br><br>  But despite the fact that everyone writes code differently, we have an ideal order in the repository: the css-code is completely consistent and looks great.  The whole. <br><br>  As we have achieved, you can read under the cut. <br><a name="habracut"></a><br><h4>  The first steps </h4><br>  If we want the entire css to be written on a code style, then the first obvious thought is for some top boss to say: ‚ÄúYou need to write this and that, follow it,‚Äù and catch inconsistencies with the review code.  It sounds cool, but, unfortunately, it only sounds, but in practice it turns out so-so: <br><ol><li>  We are all human beings - and it is a little difficult for a person to remember the exact-recommended-order of the whole heap of css properties, and never make mistakes in it. </li><li>  The revision code in this case turns into a set of code style revisions, but I would like it to discuss logic and architecture. </li><li>  All errors in this place need to be corrected by hand, and all inconsistencies clarified in some dock. </li></ol><br>  In general, it looks somehow not very good, it takes a lot of time and, most importantly, it is very frustrating for developers. <br>  To make the developers happy, I had to look for some other solution, and it was found. <br><br><h4>  Little about robots </h4><br>  There was one old robot - <a href="http://habrahabr.ru/post/149998/">CSScomb</a> , which solved the most important part of our task: <br>  he could sort properties in a given order.  But he had several drawbacks: <br><ol><li>  In addition, he could not do anything, and in fact he really wanted both quotes where there was no need to remove, and build a vendor prefix with a ladder ... </li><li>  It was written in PHP and regexp, and also did not provide for expansion. </li></ol><br>  And although, of course, PHP in the js-programmers environment is a little more famous than c ++, it‚Äôs still not quite what you want. <br><br>  <a href="https://habrahabr.ru/users/mishanga/" class="user_link">Mishanga</a> from our team, looked at the whole thing and decided to make a tool that would be deprived of these shortcomings: he knew a lot of different things, would be written in js, and could easily be expanded.  And although Yandex employees are actively involved in the development, CSScomb.js is a full-fledged open source project that has long gone beyond Yandex. <br><br>  Meet <a href="">CSScomb.js</a> - this is a new version of the old CSScomb, which can do a lot of cool things. <br><br><h4>  What does this look like? </h4><br>  Consider the current development process by example.  For example, for educational purposes only, we want to commit such code: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.block</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .1); <span class="hljs-attribute"><span class="hljs-attribute">-moz-box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .1); <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .1); <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#FFFFFF</span></span>; }</code> </pre><br>  It does not look very good, and not at all on the code type, and therefore when trying to commit, we will see this: <br><br><pre> <code class="bash hljs">% git commit block.css -m<span class="hljs-string"><span class="hljs-string">"Add My awesome css"</span></span> Code style errors found. ! block.css</code> </pre><br>  Committing such a css-file will not succeed.  This happens because in our repository in the git there is a precommitte hook that checks with CSScomb all changes in the css-files that we want to commit.  It works in linter mode.  The hook is pretty smart, so it only checks what we are going to commit, and not everything. <br><br>  Having seen such a message, we are not upset, but simply ask CSScomb.js to fix everything: <br><br><pre> <code class="bash hljs">% csscomb block.css</code> </pre><br>  Here, now another thing: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.block</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#fff</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .1); <span class="hljs-attribute"><span class="hljs-attribute">-moz-box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .1); <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .1); }</code> </pre><br>  He did quite a lot of routine minor edits for us in the code: he moved the bracket to another line, translated the color to lower case, built the vendor prefixes in the ladder, and the properties in the correct order.  Now such a code will successfully pass an automatic check and will be taken on a further review of its already functional qualities. <br><br>  Thus, the developer no longer needs to think about how to correctly write css by code type, he simply writes as he likes, and the rest is done automatically.  This is exactly what we wanted to achieve. <br><br><h4>  And inside her neonka </h4><br>  Such a system consists of two parts - the CSScomb itself and the precommit hook that uses it.  I will tell you about the hook in the next section, and in this section I will focus on how CSSComb.js works. <br><br>  CSScomb.js is based on two things: the plug-in system and the <a href="https://github.com/tonyganch/gonzales-pe">gonzales-pe</a> css-parser is a very cool thing that can work not only with pure css, but also with preprocessors like Sass or LESS. <br><br>  Let's start with the parser.  It is set on the css-code and builds on its basis AST.  For example, for: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.block</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute }</code> </pre><br>  AST will look like this: <br><br><pre> <code class="hljs json">[ <span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"ruleset"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"selector"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"simpleselector"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"class"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"ident"</span></span>, <span class="hljs-string"><span class="hljs-string">"block"</span></span> ] ], [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span> ] ] ], [ <span class="hljs-string"><span class="hljs-string">"block"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n "</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"declaration"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"property"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"ident"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span> ] ], [ <span class="hljs-string"><span class="hljs-string">"propertyDelim"</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"value"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"ident"</span></span>, <span class="hljs-string"><span class="hljs-string">"absolute"</span></span> ] ] ], [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span> ] ] ], [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span> ] ]</code> </pre><br>  This format is very bulky and inconvenient for people to read, but it is very convenient for automatic processing, which <a href="https://github.com/csscomb/csscomb.js/tree/master/lib/options">plugins do</a> .  It is they who are involved in all further css conversions, and the plugins work not directly with css-code, but with AST, which is much easier to handle.  What plugins to use, as well as their settings are specified in a separate configuration file. <br><br>  In the example above, we did not put a semicolon after <code>absolute</code> .  The plugin that is responsible for detecting and correcting semicolons is noticed and corrected through an AST modification (I cut down the tree a bit so as not to duplicate a large piece of code): <br><br><pre> <code class="hljs ruby">... [ <span class="hljs-string"><span class="hljs-string">"block"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n "</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"declaration"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"property"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"ident"</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span> ] ], [ <span class="hljs-string"><span class="hljs-string">"propertyDelim"</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"value"</span></span>, [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span> ], [ <span class="hljs-string"><span class="hljs-string">"ident"</span></span>, <span class="hljs-string"><span class="hljs-string">"absolute"</span></span> ] ] ], <span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt;</span></span>[ <span class="hljs-string"><span class="hljs-string">"declDelim"</span></span> ],&lt;&lt;&lt; [ <span class="hljs-string"><span class="hljs-string">"s"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span> ] ...</code> </pre><br>  After all the plugins have worked, using the same gonzales-pe AST turns back into css code, <br>  and the forgotten semicolon is in its place: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.block</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; }</code> </pre><br><h4>  How to start using it? </h4><br><h5>  Step one </h5><br>  It is necessary in one way or another to add CSScomb.js depending on your project. <br>  If the project uses npm, you need to add it to devDependencies in package.json <br><br><pre> <code class="hljs objectivec">{ ... <span class="hljs-string"><span class="hljs-string">"devDependencies"</span></span>: { ... <span class="hljs-string"><span class="hljs-string">"csscomb"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.4"</span></span>, ... } ... }</code> </pre><br><h5>  Step Two </h5><br>  In order for the plugins to bring the code to the form we need, you need to put the <a href="">file with the configuration of the</a> plugins in the root of the project.  Details on what each plugin does and what options it has can be read <a href="">here</a> . <br><br>  CSScomb.js can do this to some extent automatically, because it can generate a config, based on some existing css-ku. <br><br><pre> <code class="bash hljs">csscomb -d example.css &gt; .csscomb.json</code> </pre><br>  This way all plugins can be configured.  The only exception is the sorting of properties, which you still have to write yourself, or copy from somewhere else with your hands. <br><br><h5>  Last step </h5><br>  You need to make CSScomb.js in linter mode run before a commit, along with jscs / jshint-groups or other tools that usually run before a commit.  In the case of git and linux / BSD, it might look something like this: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env bash PATCH_FILE="working-tree.patch" NPM_BIN="./node_modules/.bin" function cleanup { exit_code=$? if [ -f "$PATCH_FILE" ]; then patch -p0 &lt; "$PATCH_FILE" rm "$PATCH_FILE" fi exit $exit_code } #     trap cleanup EXIT SIGINT SIGHUP #   git diff &gt; "$PATCH_FILE" --no-prefix #     git checkout -- . #       ,     git_cached_files=$(git diff --cached --name-only --diff-filter=ACMR | xargs echo) if [ "$git_cached_files" ]; then #  CSScomb.js $NPM_BIN/csscomb -v -l $git_cached_files || exit 1 fi</span></span></code> </pre><br>  This hook has an interesting feature.  It would seem, why not run CSSComb.js immediately in repair mode and then automatically silently commit?  In most cases, this really works fine, but problems arise in a situation where we make several edits in the file, and we want only one of them ( <code>git add -p</code> ).  In this case, if we find an error in the version of the file that you commit, unpleasant situations begin: <br><ol><li>  We can run CSScomb.js on the version of the file we are going to commit, and in some situations get conflicts when applying the patch. </li><li>  Either run CSScomb.js on the current file entirely, but edits that we don‚Äôt want to commit can be anything, including the wrong code. </li></ol><br>  On the whole, this is not very pleasant when the file suddenly changes by itself.  Therefore, we came to the conclusion that CSScomb.js should be run by the developer. <br><br><h4>  Done! </h4><br>  Everything.  Now CSScomb.js will not commit the code not by a code type, and it gives an opportunity to bring the code to the desired form in one command. <br>  So simple in general, an idea and an uncomplicated tool help keep the code in order, and also save time and developer nerves. <br><br>  Such a bundle can be used in many projects, and if you are missing some basic functionality or plug-ins, then you can always start an issue or <a href="https://github.com/csscomb/csscomb.js/pulls">fix the</a> necessary things yourself. </div><p>Source: <a href="https://habr.com/ru/post/223503/">https://habr.com/ru/post/223503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223491/index.html">Free seminar ADVANSERV and Huawei May 28, 2014</a></li>
<li><a href="../223497/index.html">Law enforcement agencies detain hacking group Blackshades</a></li>
<li><a href="../2235/index.html">Yandex Cup Final will be shown on O2TV</a></li>
<li><a href="../22350/index.html">GoogleTalk, part III (calls, VoIP & SIP)</a></li>
<li><a href="../223501/index.html">HTML5 attacks: what you need to know</a></li>
<li><a href="../223505/index.html">The future comes to AMF 2014</a></li>
<li><a href="../223507/index.html">Document in perspective, what to do with it? Correction of the results of contactless scanning and photographs of documents</a></li>
<li><a href="../223509/index.html">At Indiegogo raise money for a prototype of an inexpensive fusion reactor</a></li>
<li><a href="../22351/index.html">Original PC or SPECTRUM form factor returns</a></li>
<li><a href="../223511/index.html">Using MultiSSID in life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>