<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An interesting feature of Grub2: loading from ISO file</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Actually, I wanted to look at Unity. According to the pictures and video - like nothing. Yes, here's the trouble. In the virtual machine you will not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An interesting feature of Grub2: loading from ISO file</h1><div class="post__text post__text-html js-mediator-article"> Actually, I wanted to look at Unity.  According to the pictures and video - like nothing.  Yes, here's the trouble.  In the virtual machine you will not start it - 3D requires.  I myself KDEshnik.  The main OS on the laptop is kubuntu.  Well, I think you can put the second system.  Free space, like, there is. <br><br>  OK.  I shake the image of Natty, I <s>burn</s> it, but hell.  It turned out my CD-ROM is not working.  The laptop is already quite old.  Boot from flash drives in the BIOS either.  After a brief panic, a solution was found. <br><br>  It turned out that grub2 learned to understand the ISO 9660 format and can load the OS directly from an ISO image located on a hard disk.  As it turned out, not all systems are ready for this turn of events.  Many for one reason or another are confused when loading.  Fortunately, Ubuntu is not one of them. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, let's get started.  First of all, add a new menu item to Grub2.  To do this, edit /etc/grub.d/custom_40, adding the following lines to the end of the file: <br><br> <code>menuentry "Ubuntu Live" { <br> set root=(hd0,7) <br> loopback loop /ubuntu-11.04-desktop-amd64.iso <br> linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=/ubuntu-11.04-desktop-amd64.iso noeject noprompt -- <br> initrd (loop)/casper/initrd.lz <br> } <br></code> <br>  And what are we doing here: <br>  In ‚Äúset root‚Äù we indicate the partition in which the iso image is located <br>  In the ‚Äúloopback loop‚Äù we create a loop-device to which we are mounting our iso file (see, for example, the mount manual, the ‚ÄúLoop Device‚Äù section, if you don‚Äôt know what kind of loop device it is). <br>  The next two lines indicate the location of the kernel and the initrd image relative to the loop device root (the path to the kernel files and the initrd inside the ISO image). <br><br>  If anyone tries to repeat, keep in mind: <br><br>  1. In set root = (hd0,7), replace the 7 with the partition number on your machine where the iso-image of the system is located.  For example, if you downloaded ubuntu-11.04-desktop-amd64.iso into the / dev / sda1 partition, the line will change to set root = (hd0,1). <br>  2. I downloaded the ISO to the <u>root of</u> my home partition (which is (hd0.7). If you have an image in any folder, specify the full path to the image relative to the root. <br><br>  Update the grub2 configuration file: <br> <code>update-grub</code> <br> <br>  Actually, then I created a new partition for the future second system using fdisk, and rebooted. <br><br>  As expected, a new item ‚ÄúUbuntu Live‚Äù has appeared in the boot menu, which was immediately selected.  When loading, no adventures happened, but instead of Unity I was met by Gnome :-) Firewood for my nvidia is not included in the distro. <br><br>  It's time to start the installation.  I press install.  After selecting the sections for /, swap and / home, I was waiting for the next file.  Ubiquity refused to continue for a period, arguing that I have a mounted partition.  In order to create a loop device with our Ubuntu image, grub2 first mounted the partition on which this image was located.  And it does not matter that this section did not figure in any way among those who claimed any modification during the installation, the installer of Ubiquity was adamant and the installation refused to continue. <br><br>  After a brief search in Google, it turned out that I was not the first to encounter this.  The problem was solved by removing the line with the mounted partition (in my case it was / dev / sda7) from / etc / mtab.  It was necessary to do this before starting the installation.  After its removal, everything went like clockwork.  The installation was completed successfully, I installed the video card driver and after rebooting ... TA-DA. <br><br><img src="https://habrastorage.org/storage/ea39aa57/3e64c940/3b1e4907/0e4feda1.png" alt="image" align="left"><br><br>  After a successful experience with Ubuntu, I decided to see how versatile this boot method is.  I am forced to report that many distributions do not have it all so smoothly. <br>  First of all, grub2 must be installed in the main system (the one you use with the bootloader).  Grub and the rest of the boot loaders do not know how to load the system from the ISO on the disk. <br><br>  The problem is also that the developers of the distribution kit, which we load by this method, should obviously provide the option of loading from the ISO file.  In Ubuntu, if you look at the line of the grub2 configuration file, which specifies the path to the kernel, you will see that the special parameter iso-scan / filename is passed to the kernel, which clearly indicates that the system is loaded from an ISO file. <br><br>  Downloading from the ISO-file in distributions based on Ubuntu (Mint, Kubuntu, Mythubuntu, BackTrack ...) works.  There is support for downloading from the ISO file in Gentoo, SystemRescueCD, several less famous distributions: Sidux, Grml, Xbmc.  Also, this method can be used to download small distributions, which, after unpacking the initrd, are completely stored in memory and do not use files in the image.  For example, CentOS, Debian (and probably many other distributions) have so-called ‚Äúnetinstall‚Äù images that contain only a minimum and all packages are installed over the network. <br><br>  Fedora is not yet ‚Äúable‚Äù to boot by this method (although the bug in their bug tracker is hanging and work is being done in this direction).  Also this method does not work in Arch and Debian yet. </div><p>Source: <a href="https://habr.com/ru/post/118472/">https://habr.com/ru/post/118472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118462/index.html">Create an application for Windows Phone 7 from start to finish. Part 15. Access to photos on Windows Phone</a></li>
<li><a href="../118465/index.html">Presented by the official LiveJournal application for Android</a></li>
<li><a href="../118466/index.html">Bezamochnye algorithms: model "make, write, (try again)"</a></li>
<li><a href="../118468/index.html">User profiles: pros, cons, pitfalls</a></li>
<li><a href="../118470/index.html">AlterRussia.ru or "If I were president"!</a></li>
<li><a href="../118474/index.html">St. Petersburg radio market Juno</a></li>
<li><a href="../118475/index.html">How to become a system administrator - a guide for beginners (Part 1)</a></li>
<li><a href="../118478/index.html">The number of free applications in the Android Market has exceeded the number of the same in the AppStore</a></li>
<li><a href="../118479/index.html">On-Line Broadcasting with Linux InstallFest in Nizhny Novgorod</a></li>
<li><a href="../118481/index.html">50% click fraud on Yandex.Market or how to detect click fraud using standard tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>