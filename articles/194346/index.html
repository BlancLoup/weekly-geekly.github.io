<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linux Malware Detect - antivirus for web servers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Internet is no longer the same as before - there are enemies around. The topic of detecting a direct infection of a site and searching for malicio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linux Malware Detect - antivirus for web servers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage3/97e/39b/581/97e39b581b0ced992ee9c7943ca19e2a.png"><br><br>  The Internet is no longer the same as before - there are enemies around.  The topic of detecting a direct infection of a site and searching for malicious / infected scripts on a hacked site is poorly considered, we will try to fix it. <br>  So, we present to your attention Linux Malware Detect. <br><br>  Linux Malware Detect (LMD) is a Linux scanner designed to search for web shells, spam bots, trojans, malicious scripts and other typical threats specific to web spaces and is especially relevant for virtual shared hosting platforms.  The main difference from other Linux antiviruses is its web-based, web site file scanning, because ordinary antiviruses are guided by more global system-level threats. <br><a name="habracut"></a><br><h4>  What can </h4><br><ul><li>  Search for threats on the MD5 database and recognition of the type of threat (for example, php.cmdshell.nan.296.HEX) on the HEX database. </li><li>  Statistical analysis of files for obfuscated malware and injections. </li><li>  Detection of ClamAV installed in the system for use as a scanner. </li><li>  Manual and automatic (crown) update signatures. </li><li>  Manual and automatic update of the version of the script itself. </li><li>  Ability to scan recently added / modified files (for example, for the last 2 days). </li><li>  The option to upload detected potential threats to the official website for analysis. </li><li>  Reporting system. </li><li>  Cleaning files from malicious injections. </li><li>  Crown blanks to run a regular scan of userspaces or other directories. </li><li>  Exception sets by extensions, signatures and paths. </li><li>  Ability to send scan results to e-mail. </li><li>  Real-time monitoring of created / modified / modified files using inotify_watch: monitoring selected users, directories or files. </li><li>  ‚Ä¶ And so on. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How it works </h4><br>  Scanning is performed using a custom grep-based script, and if ClamAV is installed on the system, then using clamscan.  Similarly with signatures: the program has its signature database, but if ClamAV is installed in the system, it also uses its base. <br><br><h5>  Signature sources: </h5><br><ol><li>  Slice network data.  LMD developer is a hosting administrator for 35.000 sites, data is analyzed and processed daily.  The main source of signatures. </li><li>  Community data collected from antimalvar sites. </li><li>  ClamAV, interchange signatures. </li><li>  Data sent by users. </li></ol><br><br>  Signatures are updated almost daily, <a href="http://www.rfxn.com/api/lmd.php">RSS feed</a> with updates of signatures is present on the official website. <br><br>  The scan results are saved to a file, and can also be sent to the e-mail specified in the config file.  Alas, no integration with popular control panels, if you are a hoster, customers will have to send messages manually. <br><br>  Integration with the popular ISPmanager and Cpanel panels would be a good contribution to the community (this is the case if you wish). <br><br><h4>  What does it give </h4><br><ul><li>  Allows you to monitor the security of your sites on VDS and DS. </li><li>  Hosters - daily scanning and sending alerts to customers will increase customer loyalty, which is often very far from knowledge of coding and the basics of security. </li><li>  If your site or client site is hacked - you will know about it either immediately (if real-time monitoring is enabled) or during the period selected for cron-scanning.  After all, ‚Äúforewarned means armed‚Äù: infected sites often become sources of spamming with all the consequences (for example, blacklisting of IP in DNSBL). </li></ul><br><h4>  Typical Detection Examples </h4><br>  The scan report looks like this: <br><pre><code class="bash hljs">malware detect scan report <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> servername: SCAN ID: 090913-1000.17637 TIME: Sep 9 16:04:40 +0300 PATH: /var/www RANGE: 2 days TOTAL FILES: 151224 TOTAL HITS: 5 TOTAL CLEANED: 0 {HEX}php.cmdshell.unclassed.344 : www/user1/data/www/example.com/wp-content/plugins/7ja1i/nxeogyqbd3h.php {HEX}php.cmdshell.cih.215 : /var/www/user1/data/www/example.com/xyiznwsk/info.php {CAV}PHP.Trojan.Spambot : www/user1/data/www/example.com/wwp-content/plugins/customize-admin/bannerTQIz.php {HEX}php.nested.base64.513 : /var/www/user1/data/www/example.com/engine/modules/topnews.php {HEX}base64.inject.unclassed.6 : /var/www/user1/data/www/example.com/wp-content/plugins/wpematico/app/settings_page.php {HEX}gzbase64.inject.unclassed.14 : /var/www/user1/data/director/example.com/wp-content/themes/zenith/404.php</code> </pre> <br><br><h4>  Installation </h4><br>  Downloading: <br><pre> <code class="bash hljs">wget http://www.rfxn.com/downloads/maldetect-current.tar.gz</code> </pre> <br>  Unpack: <br><pre> <code class="bash hljs">tar -zxvf maldetect-current.tar.gz</code> </pre> <br>  Run the installation: <br><pre> <code class="bash hljs">sh ./install.sh</code> </pre> <br><br>  When you run install.sh, the installer places the LMD files in / usr / local / maldetect, puts the executable script in / usr / local / sbin and libinotifytools.so.0 in / usr / lib. <br><br>  The installation process automatically creates daily cron jobs for updating signatures and starting a scan.  By default, the configuration shows typical paths for scanning Webspaces of popular control panels, such as ensim, psa, DirectAdmin, cpanel, interworx, and default apache paths for hosting sites (/ var / www / html, / usr / local / apache / htdocs).  For ISPmanager, the path / var / www / will have to be added manually. <br><br><h4>  Customization </h4><br>  The LMD config is located in the /usr/local/maldetect/conf.maldet file. <br>  The config is well documented and allows you to customize everything your heart desires. <br><br><h4>  On a note: </h4><br>  ionice -c 3 added to the startup lines of scripts for searching and scanning files will help prevent the load on the disk subsystem by setting the lowest i / o priority. <br><br>  In the / usr / local / maldetect / maldet file <br>  we find: <br><pre> <code class="bash hljs">find=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$find</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  change to: <br><pre> <code class="bash hljs">find=<span class="hljs-string"><span class="hljs-string">"ionice -c 3 </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$find</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  we find: <br><pre> <code class="bash hljs">clamscan=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$clamscan</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  change to: <br><pre> <code class="bash hljs">clamscan=<span class="hljs-string"><span class="hljs-string">"ionice -c 3 </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$clamscan</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  It should be noted that this solution is a kind of ‚Äúcrutch‚Äù, this option should be added to the upstream. <br><br><h4>  Typical commands </h4><br>  Run the scan of the specified directory: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># maldet -a /home/user1/exapmle.com</span></span></code> </pre> <br><br>  At the end we get the result of the form: <br><pre> <code class="bash hljs">maldet(24128): {scan} scan completed on example.com: files 4, malware hits 0, cleaned hits 0 maldet(24128): {scan} scan report saved, to view run: maldet --report 091713-1715.24128</code> </pre> <br><br>  See the report: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet --report 091713-1715.24128</span></span></code> </pre> <br><br>  Forcibly update bases with rfxn.com: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet -u</span></span></code> </pre> <br><br>  Forced update of rfxn.com version: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet -d</span></span></code> </pre> <br><br>  We scan all files that were changed in the last X days (in this case, 2) in the specified directory <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet -r /home/user1/ 2</span></span></code> </pre> <br><br>  We send an unknown vulnerability to rfxn.com: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet -c /home/user1/file.php</span></span></code> </pre> <br><br>  Quarantine SCANID scan results (id from scan results) <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet -q 091713-1715.24128</span></span></code> </pre> <br><br>  Trying to clear scan results <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#maldet -n, --clean 091713-1715.24128</span></span></code> </pre> <br><br>  The program is licensed under the GNU GPLv2. <br>  Official project page: <a href="http://www.rfxn.com/projects/linux-malware-detect">http://www.rfxn.com/projects/linux-malware-detect</a> Linux Malware Detect. <br><br>  I have experience of use and settings, I will gladly answer all questions in the comments. </div><p>Source: <a href="https://habr.com/ru/post/194346/">https://habr.com/ru/post/194346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194334/index.html">Sales of GTA 5 in the first 24 hours amounted to $ 800 million</a></li>
<li><a href="../194336/index.html">Microsoft buys almost all old mobile devices</a></li>
<li><a href="../194338/index.html">Neustar: the risk assessment of new gTLDs is greatly overestimated</a></li>
<li><a href="../194340/index.html">We leave to the finish line - two weeks before #FailOverConf Ukraine!</a></li>
<li><a href="../194344/index.html">NFC application development for Android</a></li>
<li><a href="../194352/index.html">Kiev ITSM meeting on September 26</a></li>
<li><a href="../194354/index.html">VoxImplant - a cloud platform for developers of communication services and applications</a></li>
<li><a href="../194356/index.html">Easy setup Asterisk + Fail2Ban</a></li>
<li><a href="../194358/index.html">Breaking stereotypes: Female voice of World of Tanks</a></li>
<li><a href="../194360/index.html">Feedly opened API for all RSS clients</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>