<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Step by step: we assemble and test the Internet of things based on the SAP Cloud Platform platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article can help the SAP Coder 2017 contestants to solve one of the problems. 

 The Internet of Things is an exciting topic that will change the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Step by step: we assemble and test the Internet of things based on the SAP Cloud Platform platform</h1><div class="post__text post__text-html js-mediator-article"><hr>  This article can help <a href="http://sapcoder.ru/"><b>the SAP Coder 2017 contestants</b></a> to solve one of the problems. <br><hr><br>  The Internet of Things is an exciting topic that will change the world tomorrow.  Existing IoT platforms allow testing technology, which we will do. <br><br>  Here is a step-by-step example of creating and configuring a data collection system from Arduino-based devices and connecting it to the SAP Cloud Platform. <br><br> <a href="https://habrahabr.ru/company/sap/blog/326526/"><img src="https://habrastorage.org/getpro/habr/post_images/9f3/1f8/3f8/9f31f83f875cf13ed4ef727a8c5b60e6.jpg"></a> <br><a name="habracut"></a><br>  IoT is the most promising topic of the next decade.  The most important catalyst of the Internet of Things was the dramatic drop in prices for miniature sensors, microcontrollers, RFID sensors and memory chips.  They can be put hundreds, thousands.  For example, about 30,000 sensors are installed on an oil platform.  But only 1% of the information taken from them is actually used to control the platform and detect abnormal situations.  The infrastructure is there, but IoT applications are not enough. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to analysts, the global IoT market will grow to 10 trillion dollars by 2025, and most of the cake - 69% - will eat off the industrial segment.  All major IT developers urgently build their platforms for IoT deployment.  Today we will work with one of them - our SAP Cloud Platform cloud development platform.  It includes a set of tools and services that allow you to create your own Internet of Things project very quickly from ready-made blocks and templates. <br><br>  The SAP Cloud Platform supports OpenStack technology, which makes it independent of hardware infrastructure.  When developing applications, you can use various technologies for working with data - both conventional relational DBMS and DBMS with in-memory storage (SAP HANA), as well as mechanisms for working with unstructured ‚Äúbig‚Äù HADOOP data.  Java, Java Script, XS JS are supported from programming languages, so it will be easy to start coding.  But the main value of the platform lies in the set of ready-made business services that significantly reduce application development time. <br><br>  This article focuses on the basic functions of the Internet of things of the things that allow you to collect data from equipment and sensors.  Further development of the SAP IoT line will allow you to use ready-made libraries for working with a wide range of equipment and templates for developing typical IoT applications, for example, to create applications for monitoring machine operation and predicting emergency situations. <br><br>  Almost all SAP technologies are available for study.  To get acquainted with the platform, you just need to register on the website <a href="https://hcp.sap.com/">hcp.sap.com</a> and get a test account.  You can also try your hand at creating on-prem applications based on <a href="https://www.sap.com/developer/topics/sap-hana-express.html">HANA Express</a> , which you can deploy on your personal computer. <br><br>  But enough of the lyrics, let's create our first IoT solution based on the SAP Cloud Platform.  For example, we will develop a variant when data on temperature and light level are collected by the controller on the Arduino.  Then they are transferred to the SAP ‚Äúcloud‚Äù, where you can see the information in the form of a table and a graph. <br><br><h2>  Step 1. We register in the cloud service SAP Cloud Platform </h2><br>  To register in the SAP Cloud Platform, you need to follow the link: <br>  <a href="https://hcp.sap.com/">https://hcp.sap.com</a> .  Free registration will allow you to use all the features of the SAP platform in demo mode. <br><br><img src="https://habrastorage.org/files/2d9/fad/c60/2d9fadc60d044fe4a9570e1c22111821.png" alt="image"><br><br>  Click the Try for Free button, then Try Now. <br><br><img src="https://habrastorage.org/files/ce5/39c/2a3/ce539c2a3cb84f24b627a550a39e4eec.png"><br><br>  Click the "Register" button and enter your registration information. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/390/b67/458/390b67458d446693a43e26cdb72a7ca0.png"><br><br>  At the specified email address must receive a letter confirming registration.  To complete the process, you need to activate your account by clicking on the link in the letter. <br><br><img src="https://habrastorage.org/files/1ed/a4e/a4d/1eda4ea4d94646d1922809efc11654b5.png"><br><br>  Everything is ready to use the SAP Cloud Platform!  Let's go to the control panel and create our first IoT application.  Click Log On. <br><br><h2>  Step 2. Create a database and distribute rights. </h2><br><br><img src="https://habrastorage.org/files/417/ed8/ca9/417ed8ca993240d69ae82d8f5f9c180b.png"><br><br>  You get into the "control panel" of your development on SAP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/265/416/c52/265416c528269a12dc351d0a7529d28c.png"><br><br>  It allows you to see all the developed applications, access the database, launch development or activate services. <br><br>  In principle, the IoT service will be able to automatically create the necessary structure of tables and instances of the database.  But in order to understand how it works, and fully manage the database, we will create our own HANA instance.  The so-called HANA MDC - Multitenant Database Containers. <br>  It is in this system that our data will be stored.  To do this, we go to the Persistence tab -&gt; Database &amp; Schemas and click the New button. <br><br><img src="https://habrastorage.org/files/209/3c8/ec7/2093c8ec74ca4c3c8ecc1f94dc52b3e7.png"><br><br>  After that, set any name for the HANA instance.  The name must be written in small Latin letters without the use of special characters.  As the Database System, select HANA MDC and set the password for the SYSTEM user. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afc/a9d/b49/afca9db49b5c28204b561e98844c9fd2.png"><br><br>  In the cloud, a database instance is created, with which we will work.  Please note that this took us only a few minutes.  This is a huge advantage of cloud technology.  Usually, it may take several days for the administrator to install a database on the server and properly configure it.  And here - one click and ready! <br><br>  When the instance is ready, the yellow CREATING icon changes to green CREATED, and we can manage the base structure. <br><br><img src="https://habrastorage.org/files/db8/542/01e/db854201efe14788ba32fc70c3ca9ff5.png"><br><br>  Let's use the web-tools for managing the database structure.  In the future, in addition to the built-in database tools, you can set up an Eclipse environment, as described in the article " <a href="https://habrahabr.ru/company/sap/blog/256761/">Creating a HANA application using the Eclipse development environment</a> ." <br><br>  First, click on the SAP HANA Cockpit line.  The system will issue a warning about the absence of rights. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b2/f9b/a0a/3b2f9ba0aa062a6aff4e68f0d972f33a.png"><br><br>  Click OK, and you will automatically be granted rights to work with Cockpit. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08e/d4a/14a/08ed4a14ae3d9a811b19c781a450d2a9.png"><br><br>  In this tool, you can view and configure many options for working with your HANA instance. <br><br>  To work with SAP HANA Web-based Development Workbench, you will need to add some rights to the system user.  Click on the ‚ÄúManage Role and Users‚Äù tile. <br><br><img src="https://habrastorage.org/files/9f0/844/c2d/9f0844c2dd4b4a8bb4f5cd8d57ccf8a2.png"><br><br>  Select the SYSTEM user and on the Granted Roles tab, click the plus button.  Of course, for productive systems, you will need to create a new user and grant him the required rights.  But now we are making our first application and can retreat a little from the rules. <br><br><img src="https://habrastorage.org/files/64c/e3e/735/64ce3e7353614383b35e4d319e7b7069.png"><br><br>  The rights necessary for the operation of the administration tool are described <a href="https://help.hana.ondemand.com/help/frameset.htm%3Fd7c4ca5dac4f4dbbb47901eebe9ea0d1.html">here</a> . <br><br>  Give the following rights to your user: <br><br><table><tbody><tr><td>  <b>Role</b> <br></td><td>  <b>Description</b> <br></td></tr><tr><td colspan="2">  <b>SAP HANA Web-based Development Workbench</b> <br></td></tr><tr><td>  <i>sap.hana.xs.ide.roles :: EditorDeveloper</i> or parent roles <i>sap.hana.xs.ide.roles :: Developer</i> <br></td><td>  SAP HANA Web-based Development Workbench. <br></td></tr><tr><td>  <i>sap.hana.xs.debugger :: Debugger</i> <br></td><td>  Debug server-side javascript code <br></td></tr><tr><td colspan="2">  <b>SAP HANA XS Administration Tool</b> <br></td></tr><tr><td>  <i>sap.hana.xs.admin.roles :: HTTPDestViewer</i> <br></td><td>  View HTTP destinations. <br></td></tr><tr><td>  <i>sap.hana.xs.admin.roles :: HTTPDestAdministrator</i> <br></td><td>  Full access to HTTP destination configurations (display and edit). <br></td></tr><tr><td>  <i>sap.hana.xs.admin.roles :: TrustStoreViewer</i> <br></td><td>  If you are a client, you must be able to read it. <br></td></tr><tr><td>  <i>sap.hana.xs.admin.roles :: TrustStoreAdministrator</i> <br></td><td>  SAP HANA XS applications. <br></td></tr></tbody></table><br>  After adding the roles, click the "Save" button.  Your user will be added the rights necessary for work.  Now you can return to the initial SAP Cloud Platform screen and select the SAP HANA Web-based Development Workbench. <br><br><img src="https://habrastorage.org/files/526/324/907/5263249078354368b27dc26fd1eb3884.png"><br><br>  A page with a set of services will open. <br><br><img src="https://habrastorage.org/files/1b8/c45/574/1b8c45574c524540aa49a45078eb628c.png"><br><br>  By clicking, for example, the Catalog tile, you can see the structure of the database: tables, view, packages. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d6/265/2d5/4d62652d5083af1fde7a1fed3240c9ef.png"><br><br>  With the help of this tool, we will be able to see later how the data from the connected sensors fall into a special table created by the IoT service. <br><br><h2>  Step 3. Activate and configure the SAP Cloud Platform for IoT service </h2><br>  Now our newly created database is ready to receive data.  Go to the Services tab and, scrolling through the list of services that you can use, find the Internet of Things service. <br><br><img src="https://habrastorage.org/files/d52/adc/e1f/d52adce1fdbd471dba60aae7fb7ee762.png"><br><br>  As you can see, it does not work yet.  Let's activate it.  By clicking on the service, we will get to the settings panel, where we must click the Enable button to start it. <br><br><img src="https://habrastorage.org/files/76f/d7d/726/76fd7d726c8a4fbf9ee3b77e90fcff99.png"><br><br>  After a while you will see the green label Enabled.  This means that the service is ready to go.  This service will be engaged in collecting data from sensors and storing them in the database.  It will automate most of the work and make it as quick and convenient for the developer as possible. <br><br>  Let's configure the service to receive data from the sensors.  When you click on the IoT service control tab, click the Go to Service link. <br><br><img src="https://habrastorage.org/files/565/d48/7bb/565d487bb23a424a9c9a9fa4cfcadad5.png"><br><br>  You will see a control panel for connecting external devices and sensors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b99/4cb/1b8/b994cb1b810621debed9c27130c73392.png"><br><br>  As you can see, the number 0 in all sections tells us that no devices have been connected to the service yet.  What do the sections mean? <br><br>  <b>Device Types</b> - device types.  This is a general description of the class of devices.  For example, ‚ÄúWeather Station‚Äù or ‚ÄúPaint Line Control Device‚Äù. <br><br>  <b>Message Type</b> - types of messages or data that can be sent or received by the device.  For example, "Weather Data".  At the same time, the ‚ÄúWeather Data‚Äù type can transmit temperature, humidity, precipitation, atmospheric pressure, and so on. <br><br>  <b>Devices</b> - a specific device with a specific number that we will connect.  For example, "Weather Station ‚Ññ1 VDNH", "Weather Station ‚Ññ2 Vorobyevy Gory". <br><br>  <b>Deploy Message</b> - Start button, when pressed, the service will be automatically configured and work will be activated. <br><br>  <b>Send and view messages</b> is a section with which you can test the operation of the IoT service.  We will simulate the work of the sensors (even if we don‚Äôt have them), transmit the message in the correct format and see the already transmitted data in a table. <br><br>  Let's configure our device.  Select the Message Type section and in the lower left corner of the form that appears click "plus". <br><br><img src="https://habrastorage.org/files/479/9b7/310/4799b7310bbc4a3ebc60f5b4b794177c.png"><br><br>  Create a TempLightHumidity message type for an Arduino device type with two-way Bidirectional data transfer.  Remove the timestamp field, which is displayed by default, and create four custom fields: <br><br><pre><code class="hljs pgsql">Temperature  <span class="hljs-type"><span class="hljs-type">Integer</span></span> Light  <span class="hljs-type"><span class="hljs-type">Integer</span></span> Humidity  <span class="hljs-type"><span class="hljs-type">Integer</span></span></code> </pre> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/533/815/f92/533815f92bf2161c8d3c9d6ed184ceb7.png"><br><br>  Click the Create button.  Now we have created four fields in which we will be able to transmit information from sensors about temperature, humidity, and level of illumination. <br><br>  We return to the main screen.  We need to create a type of device that will collect data.  Click Device Type and create an Arduino type with a binding to the message type TempLightHumidity. <br><br><img src="https://habrastorage.org/files/1bb/5e3/c44/1bb5e3c44b0e49e293711b610e473e62.png"><br><br>  The final step is to create a device instance in the Devices section. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0df/d62/739/0dfd62739d2a70d780a4f68bae1c5b5d.png"><br><br>  Fill in the device name - ArduinoForTraining and specify the data that it will transmit - Arduino. <br><br>  After saving the device, the system will display important information - Token, which will later be required for the device to be able to log in to the SAP Cloud Platform system.  Write it down. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/32d/8fc/faf/32d8fcfaf8d8fb0f3c0af3756a3f5a85.png"><br><br>  If you forget to write token, you can later generate a new one by clicking on the Generate Token button. <br><br>  In addition to Token, we will need two more parameters: ID Message Type and ID of the device instance.  The first parameter can be found on the ‚ÄúInformation‚Äù tab in the message type. <br><br><img src="https://habrastorage.org/files/238/8da/492/2388da49273341f4baa0640989bf280c.png"><br><br>  The second parameter is on the device instance page. <br><br><img src="https://habrastorage.org/files/4f8/587/9e8/4f85879e847b4a3abd3f6151d55215c4.png"><br><br>  In my case, the following parameters were obtained: <br><br><pre> <code class="hljs delphi">ID <span class="hljs-keyword"><span class="hljs-keyword">Message</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = <span class="hljs-number"><span class="hljs-number">3531068190</span></span>e9d68c4a0a ID   = <span class="hljs-number"><span class="hljs-number">8</span></span>a61bdd3-c50b-<span class="hljs-number"><span class="hljs-number">4585</span></span>-a3f4-dba7f05af22e Token = e0b0dc97cc4913311a17cfcdb3f9321e</code> </pre> <br>  Now all settings are made. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d83/2ba/02c/d832ba02cc764aae644f4e5bfad67176.png"><br><br>  You can activate the activation of the service settings by going to the Deploy Message item. <br>  Enter your data and password to the SAP Cloud Platform system and click the Deploy button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e8/dba/42b/0e8dba42b3b91f51428b46917e87d283.png"><br><br>  If everything is configured correctly, you will receive a message about successful activation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b2/6ff/571/9b26ff5710592e5de0dba17f52992e91.png"><br><br>  Let's return to the SAP Cloud Platform control panel and go to the Java Application section.  There you will see the new iotmms app. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45d/af4/b35/45daf4b356ed9353b362fb4832e5b543.png"><br><br>  This is a special application that is automatically created by the system for collecting data from sensors on the settings that you just asked.  While the status of the application is ‚Äúyellow‚Äù - it takes a little time to launch it.  After 1-2 minutes, the application starts completely, which is signaled in green in the State column. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/006/426/022/0064260227d0767d2339f9a41473438d.png"><br><br>  You can enter the application and see how it can be controlled: stop, set permissions, check its operation and test performance.  Most of the settings in our example is not required.  We will execute only one - we will tie service to our database.  By default, the application writes all the data in its own database schema. <br><br>  Go to the section Configuration ‚Üí Data Source Binding in the left toolbar.  Delete the default data binding by clicking the Delete button. <br><br><img src="https://habrastorage.org/files/fe6/dfc/731/fe6dfc731fa14a08bb406c3472eccd1d.png"><br><br>  Click the New Binding button.  The system itself will offer to bind the service to our database.  You only need to enter the data to connect: login - SYSTEM (or the name of your user, if you made it earlier) and password.  Next, save the entered parameters by clicking the Save button. <br><br><img src="https://habrastorage.org/files/0d7/a08/243/0d7a082433684fed99dd1f0ac4fde4f9.png"><br><br>  The default schema has been replaced with our own. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/27d/a50/fbb/27da50fbb5b52084cff14205615047b2.png"><br><br>  Another important setting is the issuance of access rights to the IoT application.  We need to allow our user to work with the created iotmms program.  Go to the tab Security ‚Üí Roles. <br><br><img src="https://habrastorage.org/files/1ab/47b/877/1ab47b87705443ad8b16287db0e71e69.png"><br><br>  It is seen that there is already a role that allows you to work with this program - IoT-MMS_User.  It must be added to our user.  Click the Assign button in the lower left table and enter the User ID. <br><br><img src="https://habrastorage.org/files/03c/76c/282/03c76c2828b34c189a27ec49130c06f6.png"><br><br>  The username can be found in the Account section in the SAP Cloud Platform setup or in the address bar of the browser. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc3/78a/9f4/dc378a9f432e10692e8ff999cd8eed28.png"><br><br>  In order for all our settings to take effect and to work with binding to a new database, you need to restart the iotmms service.  To do this, go to the iotmms settings and click "Stop", and after - "Start".  New settings will take effect, and the data will be recorded in our database. <br><br><img src="https://habrastorage.org/files/c15/12b/ab5/c1512bab54ca471787cf2ca9389f618d.png"><br><br>  We return to the Services section.  Here you need to select the Internet of Things service and run the go to Service setting.  We will check his work. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a47/f7b/af8/a47f7baf868f27c71409091eef07be7a.png"><br><br><h2>  Step 4. We test the IoT service and transfer the test message to the SAP Cloud Platform </h2><br>  Go to the Send Message section. <br><img src="https://habrastorage.org/getpro/habr/post_images/163/5cd/e3b/1635cde3b05b4a405266e171d829ad7b.png"><br><br>  Here we can see the messages sent from the device or test the transfer. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/695/c00/0d0/695c000d06fbb5286265bad9270b3130.png"><br><br>  Go to the section Display stored message. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e8a/760/2cb/e8a7602cbb1457c3a1b8d510cb85d2de.png"><br><br>  Here you will see two technical tables, according to which you can always find out the status of the connected devices: whether it is working or not, when the data was last transmitted, and much more.  You can see what data is stored in these tables by simply clicking on them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c64/0ef/6ab/c640ef6abbfa1b8879d20468c626c899.png"><br><br>  But the table with our data on temperature, humidity, light level yet.  It will be created automatically as soon as the first data is transferred from the sensor to the SAP Cloud Platform platform. <br><br>  Let's try to send the first message from the device.  For now, we will test the service operation without physically connecting the microcontroller.  The message will be transmitted in the form of an HTTP request, which we will form in the control panel.  But first, recall the previously saved parameters: <br><br><pre> <code class="hljs delphi">ID <span class="hljs-keyword"><span class="hljs-keyword">Message</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = <span class="hljs-number"><span class="hljs-number">3531068190</span></span>e9d68c4a0a ID   = <span class="hljs-number"><span class="hljs-number">8</span></span>a61bdd3-c50b-<span class="hljs-number"><span class="hljs-number">4585</span></span>-a3f4-dba7f05af22e Token = e0b0dc97cc4913311a17cfcdb3f9321e</code> </pre> <br>  Go to the section Send and receive massage through HTTP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d21/d7e/281/d21d7e281eccb63ef4a7eebec31fddf3.png"><br><br>  There is a special tool for emulating the transmission of messages from sensors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b16/fb6/c02/b16fb6c025c52bfcdb854c81f9fe1bf5.png"><br><br>  It is an ordinary Rest API client to form an HTTP request to a remote service.  You can also use any other convenient tool.  I will show the variant with Google Chrome extension later. <br><br>  We add the correct identifiers of our devices and slightly change the format of the transmitted message, according to our settings. <br><br><img src="https://habrastorage.org/files/c94/efc/72b/c94efc72b003406aa35bb6987fdd6a87.png"><br><br>  In the HTTP endpoint section, you need to replace the device call with our own (previously saved) device instance ID.  So the system will be able to understand that the signal comes exactly from the sensor with the desired number. <br><br>  <a href="https://iotmms/">iotmms</a> <font color="cc0000">p1942514293</font> trial.hanatrial.ondemand.com/com.sap.iotservices.mms/v1/api/http/data/ <font color="cc0000">8a61bdd3-c50b-4585-a3f4-dba7f05af22e</font> <br><br>  In the Message to Post section, you need to insert our Message ID and add fields: <br><br>  {"Mode": "sync", "messageType": " <b><font color="cc0000">3531068190e9d68c4a0a</font></b> ", "messages": <b>[{"Temperature": 17, "Light": 23, "Humidity": 65}]}</b> <b><br></b> <br>  The red font indicates the parameters - the message ID and the device instance ID.  We will not need token yet.  Since this is an internal testing tool, the system ignores security settings.  But if we try to do this from a third-party application, the system will not allow entering without a token, i.e.  without password. <br><br>  Now everything is ready and you can click Post.  Your first message has been sent to the SAP Cloud Platform!  You can check this in the Reply from Service section.  If something is wrong, the error code that the remote IoT service returned is indicated here.  By code, you can understand what happened. <br><br><img src="https://habrastorage.org/files/8c9/cc6/90c/8c9cc690c73346dbac37b5fe5981f1df.png"><br><br>  Now go back to the Send and view message section and select Display Stored Messages. <br><br><img src="https://habrastorage.org/files/0a1/c5e/736/0a1c5e736fa4401b94fdd686c175ea01.png"><br><br>  Here you will see two more tables that were created automatically as soon as we transferred the data to the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0c/175/80e/f0c17580e3e7bf0975dab12b39cac05e.png"><br><br>  Look at the contents of the table and make sure that this is exactly the data that you passed to the test. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3e/a13/42e/c3ea1342edd6dcb23a4e6cb46f955271.png"><br><br>  Try changing the test data for temperature or light level and transfer the data again.  In our example, we changed the parameter of the light level several times. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/331/b0b/335/331b0b33502000acdaa49d47c06e171f.png"><br><br>  Going to the table, we see that the IoT service is ready to receive data from sensors. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d6/9ca/3e1/3d69ca3e1ff76ef63af8533c3b5da653.png"><br><br>  All your entries have been saved automatically.  And by choosing the icon for displaying data in graphical form and your data type + instance, you will see them as a graph. <br><br><img src="https://habrastorage.org/files/20c/464/2b5/20c4642b58b24453bd9d8e6511363195.png"><br><br><h2>  Step 5. We test the IoT service using the Advanced Rest Client extension in Google Chrome browser </h2><br>  And now let's test our service taking into account all security requirements.  To do this, we need a Google Chrome browser.  Install the browser.  Run it.  In the search bar, enter the advanced rest client. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e5/c54/6ef/4e5c546ef980c63073b37a23503d6c31.png"><br><br>  This is a special Google Chrome browser extension that is intended for developers.  It helps to test HTTP requests without the need to develop your own programs. <br>  Install the application (the first link in the search results) by clicking the Add to Chrome button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/31b/ebf/96a/31bebf96a37b12375dd9108b57a971a7.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/3cb/76b/c73/3cb76bc7352981b60662cb07f83dbb8d.png"><br><br>  And run by clicking ARC in the list of services. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/949/96f/ff8/94996fff8018328191d2820788a70dc3.png"><br><br>  You need to construct a call to the POST method, specifying the necessary parameters, as you already did, testing the service using the SAP Cloud Platform.  The only difference is that you need to take care of the transfer of the secret code token in the header of the POST request. <br><br>  In the URL header, enter the same string with the device ID: <br><br>  <a href="https://iotmms/">iotmms</a> <font color="cc0000">p1942514293</font> trial.hanatrial.ondemand.com/com.sap.iotservices.mms/v1/api/http/data/ <font color="cc0000">8a61bdd3-c50b-4585-a3f4-dba7f05af22e</font> <br><br>  In the message body, pass the value of the parameters: <br><br>  {"Mode": "sync", "messageType": " <font color="cc0000"><b>3531068190e9d68c4a0a</b></font> ", "messages": <b>[{"Temperature": 17, "Light": 23, "Humidity": 65}]}</b> <br><br>  We did not fill the Headers header, and it should be in the specified format: <br><br>  Content-Type: application / json; charset = UTF-8 <br>  Authorization: Bearer <font color="cc0000">e0b0dc97cc4913311a17cfcdb3f9321e</font> <br><br>  Where the red text indicates the parameters that need to be changed (including the token) to those that we recorded earlier.  The result should be the following picture: <br><br><img src="https://habrastorage.org/files/0d2/1db/1d7/0d21db1d7e5b4605ba1e5f5d43ec3a9e.png"><br><br>  By clicking Send, you will see the response from the server and you can see the transferred record. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/419/430/b5f/419430b5fcedae692bf4c17bd4e436e3.png"><br><br>  Try an experiment.  Remove the line <br><br>  Authorization: Bearer <font color="cc0000">58536ee037cf158db4992d5538b8d5b0</font> <br><br>  The server does not pass such a request, it responds with an authorization error 401. Thus, we are afraid of connecting unauthorized devices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/36e/bf8/e39/36ebf8e3964d7ad84a835adef640246f.png"><br><br>  This is just one example of how the SAP Cloud Platform security system works.  In industrial programs, security is taken even more seriously and various methods are used (not only authorization using token) to protect programs and industrial systems. <br><br><h2>  Alternative: configure IoT service operation using MQTT protocol </h2><br>  If you have carefully studied the application for testing IoT-service, you might notice another way to work with data - via the MQTT protocol. <br><br><img src="https://habrastorage.org/files/370/8de/176/3708de1766a247abaedc1c41eeddfb20.png"><br><br>  MQTT (Message Queuing Telemetry Transport) is a simple, open protocol designed specifically for IoT and used to exchange data between devices.  An MQTT network includes an MQTT broker that mediates the interaction of MQTT agents ‚Äî publishers and subscribers.  Publishers publish information intended for subscribers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/962/5f8/874/9625f8874c5f3f773b5cd16e8c71a7ff.png"><br><br><h3>  Broker, publisher and subscriber in the MQTT network </h3><br>  MQTT is designed for low-power embedded devices, so the computational requirements for its implementation are minimal.  The protocol is highly efficient even on low bandwidth channels.  There is very little overhead information in the structure of the data transmitted with its help.  According to measurements made in 3G networks, the bandwidth of MQTT is 93 times higher than the REST (Representational State Transfer) protocol that runs over HTTP. <br><br>  MQTT uses a limited set of commands, they all boil down to interacting with a broker and working with themes and messages.  Agents connect to the broker, and then either publish the topics and posts in them, or subscribe to the threads and receive messages in these topics published.  Upon completion, agents disconnect from the broker. <br><br>  You can read more about the principles of operation of the MQTT protocol in various articles on the Internet, including on Habrahabr.  For example <a href="https://habrahabr.ru/company/intel/blog/304228/">here</a> . <br><br>  In order to start working with the MQTT protocol, we need to choose a broker through which we will exchange data between devices and the SAP Cloud Platform platform.  There are many free brokers MQTT, you can also set your own broker.  In our case, we use the MQTT broker test.mosca.io.  This broker is configured on port 1883 and does not require a username or password to operate. <br><br>  Let's configure our IoT service to work with this MQTT broker. <br><br><img src="https://habrastorage.org/files/2ff/912/c2c/2ff912c2cf7640f4863c56262e557f48.png"><br><br>  Select Configure the Message Management Service. <br>  In the Data section, enter the settings for your MQTT broker: <br><br><pre> <code class="hljs objectivec">tcp:<span class="hljs-comment"><span class="hljs-comment">//test.mosca.io:1883</span></span></code> </pre> <br><br><img src="https://habrastorage.org/files/0cd/fb4/688/0cdfb4688c274c07bb6b0d99fd9c81cf.png"><br><br>  If your MQTT broker uses a username and password for authorization, this data also needs to be entered into the service settings.  In our case for the user and password, enter: test \ test <br>  After saving the data, go to the MQTT over TCP Messaging section. <br><br><img src="https://habrastorage.org/files/a4b/b14/3a7/a4bb143a70f04ac98b679123b517ffb2.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0a/00d/ac6/c0a00dac66d37382ac1b495cf567127b.png"><br><br>  In the Device ID section, enter your data: 8a61bdd3-c50b-4585-a3f4-dba7f05af22e <br>  In the Message field: <br><br>  {"Mode": "sync", "messageType": " <font color="cc0000"><b>3531068190e9d68c4a0a</b></font> ", "messages": <b>[{"Temperature": 25, "Light": 23, "Humidity": 65}]}</b> <br><br>  And click the "Connect" button to connect to the broker. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07e/75d/00f/07e75d00f01db427060bff720250a452.png"><br><br>  Try to send a message by clicking Send on the form. <br><br><img src="https://habrastorage.org/files/3ac/afb/524/3acafb52493e495a9f8d52a41470a4c6.png"><br><br>  Check that your message has been transferred to the IoT table through an MQTT broker. <br><br><img src="https://habrastorage.org/files/756/358/7e8/7563587e85e944fa80304bcd9601bb3b.png"><br><br>  You can try to send a message to the SAP Cloud Platform via a third-party MQTT client.  For example, through <a href="http://mqttfx.org/">MQTT FX</a> . <br>  Install the program and configure the connection to your MQTT broker. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/258/9df/3b3/2589df3b34f282dff7fffc728866d59b.png"><br><br>  Click Connect and on the Subscribe tab subscribe to the topic that you saw in the configuration of the IoT service: <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">iot</span></span>/<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">/iotmmsp1942514293trial/v1/8a61bdd3-c50b-4585-a3f4-dba7f05af22e</span></span></code> </pre> <br><br><img src="https://habrastorage.org/files/7f1/d29/33f/7f1d2933fd7d43f88d34eaf0ab36ffdb.png"><br><br><img src="https://habrastorage.org/files/3df/a1f/26c/3dfa1f26cd7949f78e180e0704b75483.png"><br><br>  On the Publish tab, you can send messages with the corresponding topic through a broker to the configured IoT service. <br><br><img src="https://habrastorage.org/files/ece/dc8/2e5/ecedc82e55bc4a7b9cfc208bccd3c445.png"><br><br>  Try passing multiple values ‚Äã‚Äãand verify that data reception is successful. <br><br><h2>  Step 6. Cooking "iron" on the Arduino </h2><br>  In this section, we will connect a real controller and sensors to the platform.  The Arduino Yun microcontroller will act as a control device.  Arduino is a very convenient platform for the rapid development of electronic devices for beginners and professionals. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/647/71d/37f/64771d37f87c3600777c77d40bd6938f.png"><br><br>  Arduino Yun is convenient because in addition to the main microcontroller, the Atmel ATmega32U4 has an additional Atheros AR9331 processor running Linux with the wireless OpenWrt stack.  For our project, this is a suitable device, since it carries ‚Äúon board‚Äù Linux and allows you to connect via the HTTPS protocol to remote services, including the SAP Cloud Platform. <br><br>  Before we begin, we need to put the development environment for the Arduino, make the initial configuration of the microcontroller and connect it to the network (wired or WiFi). <br><br>  As sensors and controls for our Arduino we will use: <br><br>  1) <a href="http://amperka.ru/product/troyka-button">Button</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b2c/ea0/ec1/b2cea0ec14bdcc25248b2a554a4a49c6.jpg"><br><br>  2) <a href="http://amperka.ru/product/troyka-temperature-humidity-sensor-dht11">Digital temperature and humidity sensor</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ff/010/520/3ff0105208ed5a63d89abe05b4ef2203.jpg"><br><br>  3) <a href="http://amperka.ru/product/troyka-light-sensor">Light sensor</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64a/bf0/a52/64abf0a52b5910e5ae2e8374cf7a8f6f.jpg"><br><br>  4) <a href="http://amperka.ru/product/troyka-led-module">LED</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84e/3ec/580/84e3ec580545200ae04991075dac30cb.jpg"><br><br>  Instead of these sensors, you can use any other, making the appropriate changes to the control program. <br><br>  Each sensor has three contacts - S, V, G. <br>  Connect the sensors according to the diagram. <br><br>  <b>Connect button:</b> <br>  8 pin (V - power, red) <br>  9 pin (G - ground, black) <br>  10 contact (S - signal, yellow) <br><br>  <b>LED connection:</b> <br>  11 pin (V - power, red) <br>  12 pin (G - ground, black) <br>  13 contact (S - signal, yellow) <br><br>  <b>Photodiode connection:</b> <br>  A0 contact (S - signal, yellow) <br>  A1 contact (V - power, red) <br>  A2 contact (G - ground, black) <br><br>  <b>Connection of temperature sensor:</b> <br>  A3 contact (S - signal, yellow) <br>  A4 pin (V - power, red) <br>  A5 contact (G - ground, black) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/095/6b2/e03/0956b2e03e9aea622b248ae7291f14cc.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa1/8fe/2de/aa18fe2deaa4ae4090a9cc533282ffc8.jpg"><br><br><h2>  Step 7. Arrange data transfer from Arduino to the cloud via HTTP </h2><br>  Set up data transfer to the SAP Cloud Platform platform by calling the POST request using the HTTP protocol.  When you click on the button, data on the level of illumination, humidity and temperature should be transmitted to the SAP Cloud Platform system. <br><br>  The peculiarity of this program is that the SAP Cloud Platform in the trial version requires the mandatory organization of a secure connection using the HTTPS protocol, which is impossible to do in regular versions of Arduino.  Therefore, we have to use a version of Arduino Yun with embedded Linux.  The easiest way to do this is with the CURL utility, which is implemented in the script below. <br><br>  For debugging and checking the script, I recommend trying the CURL utility, directly connecting to Arduino Yun in terminal mode via Putty.  To do this, you need to download a utility from Putty.org, with which you can connect to the microcontroller.  Or directly use the terminal if you are working in a Linux environment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d3/a32/6c6/3d3a326c6ca80f924c92f37fa721a94b.png"><br><br>  Enter the IP address into the utility in the Host Name or IP field <br><img src="https://habrastorage.org/getpro/habr/post_images/09c/362/d91/09c362d911be285a17dd90c09eb33b28.png"><br><br>  Enter the IP address into the utility in the Host Name or IP field <br><br>  SSH connection type.  Click Open. <br><br>  In terminal mode, type the username root. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/947/f38/657/947f3865760a7b461600d7b812e8637c.png"><br><br>  And the password that you set in the connection settings with the Arduino. <br><br>  The system is connected and ready to execute commands. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b68/b71/a6e/b68b71a6ee3dbea948c709ed4981ba46.png"><br><br>  Adapt the curl command according to your data: <br><br>  curl --header "Authorization: Bearer <font color="cc0000">e0b0dc97cc4913311a17cfcdb3f9321e</font> " --header "Content-Type: application / json; charset = UTF-8" -k -X POST <a href="https://iotmms/">iotmms</a> <font color="cc0000">p1942514293</font> trial.hanatrial.ondemand.com/com.sap.iotservices / v1 / api / http / data / <font color="cc0000">8a61bdd3-c50b-4585-a3f4-dba7f05af22e - data</font> '' {'' mode '': '' async '', '' messageType '': '' &lt;font color = '' cc0000 ''&gt; 3531068190e9d68c4a0a '', '' messages '': [{'' Temperature '': 23, '' Light ':' 21, '' Humidity '': 65}]} '' <br><br>  The fragments highlighted in red must be changed according to your parameters.  Copy the finished text.  In the terminal, click the right mouse button.  The text will be copied. <br><br>  Press Enter. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/50a/bc5/642/50abc5642717e8e6920cd951ec452d29.png"><br><br>  If all the parameters are specified correctly and the Arduino Yun settings are correct, the SAP Cloud Platform server will return an acknowledgment that the IoT service saved the record: 1 message received from device. <br><br><div class="spoiler">  <b class="spoiler_title">Now you can upload a sketch and adapt it, according to your IoT service settings data in the SAP Cloud Platform (highlighted in red).</b> <div class="spoiler_text"><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;TroykaDHT11.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Process.h&gt;</span></span></span><span class="hljs-meta"> //   DHT11 dht(A3); int check; int Light_v; int Temp_v; int Humidity_v; void setup() { Bridge.begin(); Serial.begin(9600); dht.begin(); //  pinMode(8, OUTPUT); pinMode(9, OUTPUT); pinMode(10, INPUT); digitalWrite(8, HIGH); digitalWrite(9, LOW); //  pinMode(11, OUTPUT); pinMode(12, OUTPUT); pinMode(13, OUTPUT); digitalWrite(11, LOW); digitalWrite(12, HIGH); digitalWrite(13, LOW); //  pinMode(A0, INPUT); pinMode(A1, OUTPUT); pinMode(A2, OUTPUT); digitalWrite(A1, HIGH); digitalWrite(A2, LOW); //   pinMode(A4, OUTPUT); pinMode(A5, OUTPUT); digitalWrite(A4, HIGH); digitalWrite(A5, LOW); } void pushToCloud(int Temperature_value, int Light_value, int Humidity_value) { //   SAP Cloud Platform     Linux   curl Process p; p.begin(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"curl"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-k"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-f"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-H"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Authorization: Bearer e0b0dc97cc4913311a17cfcdb3f9321e"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-H"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Content-Type: application/json;charset=UTF-8"</span></span></span><span class="hljs-meta">); //p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-X"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"POST"</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&lt;a href="</span></span></span><span class="hljs-meta">https://iotmmsp1941889917trial.hanatrial.ondemand.com/com.sap.iotservices.mms/v1/api/http/data/a0e2ed53-f5a4-4aa8-bdac-379b9c2c197e</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"&gt;https://iotmmsp1942514293trial.hanatrial.ondemand.com/com.sap.iotservices.mms/v1/api/http/data/8a61bdd3-c50b-4585-a3f4-dba7f05af22e &lt;/a&gt; "</span></span></span><span class="hljs-meta">); p.addParameter(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"--data"</span></span></span><span class="hljs-meta">); String str; str = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">mode\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">async\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">messageType\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;b&gt;</span></span></span><span class="hljs-meta">3531068190e9d68c4a0a</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;/b&gt;</span></span></span><span class="hljs-meta">\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">messages\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":[{\"</span></span></span><span class="hljs-meta">Temperature\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":"</span></span></span><span class="hljs-meta"> + String(Temperature_value) + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">Light\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":"</span></span></span><span class="hljs-meta"> + String(Light_value) + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">Humidity\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":"</span></span></span><span class="hljs-meta"> + String(Humidity_value) + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}]}"</span></span></span><span class="hljs-meta">; p.addParameter(str); p.run(); //    curl    Serial.println(str); Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Exit: "</span></span></span><span class="hljs-meta">); Serial.println(p.exitValue()); } void loop() { //         check = dht.read(); //   ,   digitalWrite(13, digitalRead(10)); //   if (digitalRead(10)) {  Light_v = analogRead(0);  Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Light = "</span></span></span><span class="hljs-meta">);  Serial.println(Light_v);  //    Temp_v = dht.getTemperatureC();  Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Temperature = "</span></span></span><span class="hljs-meta">);  Serial.print(Temp_v);  Serial.println(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C \t"</span></span></span><span class="hljs-meta">);  //    Humidity_v = dht.getHumidity();  Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Humidity = "</span></span></span><span class="hljs-meta">);  Serial.print(Humidity_v);  Serial.println(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%"</span></span></span><span class="hljs-meta">);  Serial.println(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">);  //   SAP Cloud Platform  pushToCloud(Temp_v, Light_v, Humidity_v);  delay(100); } }</span></span></code> </pre> <br></div></div><br>  Please note that for the temperature sensor to work, you will need a ready-made library TroykaDHT11.h, which you need to connect to the Arduino IDE software development environment. <br><br>  You can find the library on the Internet at <a href="https://github.com/amperka/TroykaDHT11">https://github.com/amperka/TroykaDHT11.</a> <br><br>    . <br><img src="https://habrastorage.org/getpro/habr/post_images/56b/d7c/f28/56bd7cf282e495556ca64029b85c7f12.png"><br><br>     ,  , ,   ,     , ,   SAP Cloud Platform. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5fb/c7b/ed4/5fbc7bed4d8512aae32aa2346f728742.png"><br><br>     ,        IoT. <br><br><h2> :     Arduino    MQTT </h2><br><div class="spoiler"> <b class="spoiler_title">      MQTT.       Arduino,   .</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;TroykaDHT11.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Process.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Bridge.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;BridgeClient.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;PubSubClient.h&gt;</span></span></span><span class="hljs-meta"> //   DHT11 dht(A3); int check; int Light_v; int Temp_v; int Humidity_v; char message_buff[200]; void callback(char* topic, byte* payload, unsigned int length) { //    } //  MQTT- BridgeClient ethClient; PubSubClient client(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"test.mosca.io"</span></span></span><span class="hljs-meta">, 1883, callback, ethClient); void setup() { Bridge.begin(); Serial.begin(9600); dht.begin(); //  MQTT  if (client.connect(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"arduinoClient"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"test"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"test"</span></span></span><span class="hljs-meta">)) //        { client.subscribe(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"iot/data/iotmmsp1942514293trial/v1/8a61bdd3-c50b-4585-a3f4-dba7f05af22e"</span></span></span><span class="hljs-meta">);  } //  pinMode(8, OUTPUT); pinMode(9, OUTPUT); pinMode(10, INPUT); digitalWrite(8, HIGH); digitalWrite(9, LOW); //  pinMode(11, OUTPUT); pinMode(12, OUTPUT); pinMode(13, OUTPUT); digitalWrite(11, LOW); digitalWrite(12, HIGH); digitalWrite(13, LOW); //  pinMode(A0, INPUT); pinMode(A1, OUTPUT); pinMode(A2, OUTPUT); digitalWrite(A1, HIGH); digitalWrite(A2, LOW); //   pinMode(A4, OUTPUT); pinMode(A5, OUTPUT); digitalWrite(A4, HIGH); digitalWrite(A5, LOW); } void pushToCloud(int Temperature_value, int Light_value, int Humidity_value) { //   SAP Cloud Platform     Linux   curl  if (!client.connected()) {     client.connect(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"arduinoClient"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"test"</span></span></span><span class="hljs-meta">, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"test"</span></span></span><span class="hljs-meta">); //       }  String str = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"{\"</span></span></span><span class="hljs-meta">mode\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">async\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">messageType\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":\"</span></span></span><span class="hljs-meta">d8bda569c1340f7ee7fb\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">messages\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":[{\"</span></span></span><span class="hljs-meta">Temperature\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":"</span></span></span><span class="hljs-meta"> + String(Temperature_value) + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">Light\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":"</span></span></span><span class="hljs-meta"> + String(Light_value) + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">",\"</span></span></span><span class="hljs-meta">Humidity\</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":"</span></span></span><span class="hljs-meta"> + String(Humidity_value) + </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"}]}"</span></span></span><span class="hljs-meta">;  str.toCharArray(message_buff, str.length()+1);  client.publish(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"iot/data/iotmmsp1942514293trial/v1/8a61bdd3-c50b-4585-a3f4-dba7f05af22e"</span></span></span><span class="hljs-meta">, message_buff); } void loop() { //         check = dht.read(); //   ,   digitalWrite(13, digitalRead(10)); //   if (digitalRead(10)) {  Light_v = analogRead(0);  Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Light = "</span></span></span><span class="hljs-meta">);  Serial.println(Light_v);  //    Temp_v = dht.getTemperatureC();  Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Temperature = "</span></span></span><span class="hljs-meta">);  Serial.print(Temp_v);  Serial.println(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C \t"</span></span></span><span class="hljs-meta">);  //    Humidity_v = dht.getHumidity();  Serial.print(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Humidity = "</span></span></span><span class="hljs-meta">);  Serial.print(Humidity_v);  Serial.println(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%"</span></span></span><span class="hljs-meta">);  Serial.println(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">""</span></span></span><span class="hljs-meta">);  //   SAP Cloud Platform  client.loop();  pushToCloud(Temp_v, Light_v, Humidity_v);  delay(100); } }</span></span></code> </pre> <br></div></div><br>         PubSubClient,    <a href="https://github.com/knolleary/pubsubclient"></a> . <br><br>      Arduino,   Yun,          Ethernet Shield. ,   BridgeClient   EthernetClient.       . <br><br>            SAP Cloud Platform      /.   IoT-        . Stay with us! <br><br><hr><br> ,    <b><a href="http://sapcoder.ru/">SAP  2017</a></b>  <br><br>  <b><a href="https://habrahabr.ru/article/323088/"></a></b>     SAP Cloud Platform      . <br><hr></div><p>Source: <a href="https://habr.com/ru/post/326526/">https://habr.com/ru/post/326526/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326512/index.html">Test of knowledge of mobile analytics from Appmetrica</a></li>
<li><a href="../326516/index.html">The process of creating a game about parkour on the example of Parkour Simulator 3D</a></li>
<li><a href="../326518/index.html">Yandex through the eyes of an intern</a></li>
<li><a href="../326520/index.html">N reasons to use the Create React App</a></li>
<li><a href="../326524/index.html">SPA Meetup Report and Materials April 8, 2017</a></li>
<li><a href="../326528/index.html">AppCode 2017.1: improved Swift support, new code generation features, and more</a></li>
<li><a href="../326530/index.html">Cyber ‚Äã‚Äãrisk insurance</a></li>
<li><a href="../326532/index.html">3Ds max. The basics. How and where to start?</a></li>
<li><a href="../326534/index.html">How can a novice programmer get into game dev? Advice from Krasnodar Plarium Studio Specialists</a></li>
<li><a href="../326536/index.html">Key points in project manager communication</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>