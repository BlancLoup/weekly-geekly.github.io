<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple and fast C / C ++ server with C # client: TCP version</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Slowly going through the sheets of books, I do server programming. And my mind got to the point that it would be possible to write on a C ++ se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple and fast C / C ++ server with C # client: TCP version</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Slowly going through the sheets of books, I do server programming.  And my mind got to the point that it would be possible to write on a C ++ server.  Well, without thinking twice (or rather without thinking at all, and knowing poorly the advantages), I went to write a server. <br><br>  And I began to stumble upon different errors, previously alien to me, but incomprehensible to the syntax.  And in the end, now I am sharing with you how and how not to write even the simplest server. <br>  So, let's begin. <br><br>  Let's start with the most important element - the SServer server class: <br><a name="habracut"></a><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"includes.h"</span></span></span><span class="hljs-meta"> class SServer { public: SServer(); ~SServer(); void startServer(); void closeServer(); void handle(); unsigned short port; private: SOCKET this_s; WSAData wData; };</span></span></code> </pre> <br>  Here I think it will not be difficult.  We create SOCKET as a socket for the server, it will listen. <br>  WSAData is needed to activate the use of sockets in Windows. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      That was the headline.  Let's go to CPP: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SServer.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"includes.h"</span></span></span><span class="hljs-meta"> SServer::SServer(){ } SServer::~SServer(){ } void SServer::startServer(){ </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (WSAStartup(MAKEWORD(2, 2), &amp;wData) == 0) { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"WSA Startup succes\n"</span></span></span><span class="hljs-meta">); } SOCKADDR_IN addr; int addrl = sizeof(addr); addr.sin_addr.S_un.S_addr = INADDR_ANY; addr.sin_port = htons(port); addr.sin_family = AF_INET; this_s = socket(AF_INET, SOCK_STREAM, NULL); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (this_s == SOCKET_ERROR) { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Socket not created\n"</span></span></span><span class="hljs-meta">); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (bind(this_s, (struct sockaddr*)&amp;addr, sizeof(addr)) != SOCKET_ERROR) { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Socket succed binded\n"</span></span></span><span class="hljs-meta">); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (listen(this_s, SOMAXCONN) != SOCKET_ERROR){ printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Start listenin at port%u\n"</span></span></span><span class="hljs-meta">, ntohs(addr.sin_port)); } handle(); } void SServer::closeServer() { closesocket(this_s); WSACleanup(); cout &lt;&lt; </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Server was stoped. You can close app"</span></span></span><span class="hljs-meta"> &lt;&lt; endl; } void SServer::handle() { while (true) { SOCKET acceptS; SOCKADDR_IN addr_c; int addrlen = sizeof(addr_c); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((acceptS = accept(this_s, (struct sockaddr*)&amp;addr_c, &amp;addrlen)) != 0) { printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"send\n"</span></span></span><span class="hljs-meta">); printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sended Client connected from 0 %u.%u.%u.%u:%u\n"</span></span></span><span class="hljs-meta">, (unsigned char)addr_c.sin_addr.S_un.S_un_b.s_b1, (unsigned char)addr_c.sin_addr.S_un.S_un_b.s_b2, (unsigned char)addr_c.sin_addr.S_un.S_un_b.s_b3, (unsigned char)addr_c.sin_addr.S_un.S_un_b.s_b4, ntohs(addr_c.sin_port)); SClient* client = new SClient(acceptS, addr_c); } Sleep(50); } }</span></span></code> </pre><br>  And now in order.  First, activate WSA by calling WSAStartup ().  MAKEWORD sets the version of the libraries that will be connected and the link to the WSAData object.  Usually it always works successfully, only you ate not * unix, hehe.  Farther.  The SOCKADDR_IN structure helps us determine in advance the port and availability of our server.  And now I will explain: <br><br><ul><li>  INETADDR_ANY says that the server will be accessible from any user machine.  If you specify how to write inet_aadr ("127.0.0.1"), then it will not allow you to test even on the local network </li><li>  htons () is a function that turns hardware to network short using ushort.  Next is the function ntohs () - the opposite is true. </li><li>  AF_INET - constant, responsible for the fact that the device uses the global network using the IPv4 protocol, AF_INET6 - IPv6 </li></ul><br>  Next comes the <s>magic of</s> calling three functions and checking their values ‚Äã‚Äãon SOCKET_ERROR.  I think there is more or less clear.  Initialized, zabindili and forced to listen. <br><br>  SOCK_STREAM talks about using the TCP protocol, SOCK_DGRAM indicates UDP, respectively. <br>  Call the handle of the incoming connections and start checking in an infinite loop. <br>  Create a socket for the incoming connection, structure to fill the address and the length of the structure. <br>  We make a check that our created socket is not connected to the address of such-and-such a computer.  And if everything is good, then we display the message and connect from the address of our client and create a client who will later process everything himself. <br><br>  Now the client code.  Header and implementation together: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"includes.h"</span></span></span><span class="hljs-meta"> class SClient { public: SClient(SOCKET s, SOCKADDR_IN sock_in); ~SClient(); void handle(); private: SOCKET c_sock; SOCKADDR_IN c_addr; char buffer[1024]; }; SClient::SClient(SOCKET s, SOCKADDR_IN sock_in) { c_sock = s; c_addr = sock_in; printf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Client created\n"</span></span></span><span class="hljs-meta">); handle(); } SClient::~SClient() { } void SClient::handle() { while (true) { int k = recv(c_sock, buffer, sizeof(buffer), NULL); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(k&gt;0){ printf(buffer); } Sleep(30); } }</span></span></code> </pre><br>  Here, too, as you can see, there is nothing complicated.  the main thing is the handle () function, which we immediately launch in the constructor.  The recv () function is preferably used with TCP, and recvfrom () with the UDP protocol, respectively. <br><br>  And lastly.  In main.cpp It looks like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SServer.h"</span></span></span><span class="hljs-meta"> int main() { SServer server ; server.port = 3487;</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  ushort -   cin.get()  ..    .    server.startServer(); return 0; }</span></span></span></span></code> </pre><br>  And the file you so often saw includes.h.  Here he is: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> once #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> comment(lib, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ws2_32.lib"</span></span></span><span class="hljs-meta">) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">warning</span></span></span><span class="hljs-meta">(disable: 4996) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;WinSock2.h&gt; #include &lt;winsock.h&gt; #include "SClient.h" using namespace std;</span></span></span></span></code> </pre><br>  Bottom line: We learned how to create a simple TCP server in C ++ by reading a good article in Habr√© <br>  The UDP version will be the same, but the differences are very small and I think soon there will be too. <br><br>  Also everything is on <a href="https://github.com/DenisKaVladimirovich/ServerProject/">GitHub</a> </div><p>Source: <a href="https://habr.com/ru/post/327574/">https://habr.com/ru/post/327574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327564/index.html">Debian developers publish the Stretch preparation report and disable FTP support on their servers.</a></li>
<li><a href="../327566/index.html">Seven times ALTER one DROP</a></li>
<li><a href="../327568/index.html">Contextual interview. Notes for the design of the study</a></li>
<li><a href="../327570/index.html">DevTools in the browser Vivaldi 1.10.289.3</a></li>
<li><a href="../327572/index.html">Comparison of GPT and MBR partition structures</a></li>
<li><a href="../327576/index.html">Self-sufficient controllers on Xamarin.Forms: "Re-use the code to the maximum!". Part 1</a></li>
<li><a href="../327578/index.html">How three schoolchildren hacked the source code of Final Fantasy V to localize it</a></li>
<li><a href="../327580/index.html">Microsoft itself</a></li>
<li><a href="../327582/index.html">How does the testing of the developers KOMPAS-3D</a></li>
<li><a href="../327584/index.html">Development: technical task on the site or concept?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>