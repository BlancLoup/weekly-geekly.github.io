<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Under the white flag post, or How I saved your video course from appearing on the tracker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Hmm, I have the feeling that we have already met ... Oh, yes. Here is the post where we discussed the lamp condition of whether it was accep...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Under the white flag post, or How I saved your video course from appearing on the tracker</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/tn/c2/w_/tnc2w_eanffeyudfj7cl9wzsil4.jpeg" alt="captain_barbossa.jpg"></div><br>  Hi, Habr!  Hmm, I have the feeling that we have already met ... Oh, yes.  <a href="https://habr.com/ru/post/449970/">Here</a> is the post where we discussed the lamp condition of whether it was acceptable to monitor the environment, limit the user to the number of devices to view, provide executable files instead of paid videos, and behave differently and uncivilized when organizing the ‚Äúprotection‚Äù of video courses from piracy. <br><br>  And all would be nothing, but that's just not to criticize, not offering in return his decision.  <i>‚ÄúYou can do better, or what ?!‚Äù</i> , - cries from comments were heard.  <i>‚ÄúIt would be better to support my compatriot, to help make their product better!‚Äù</i> , I briefly retell some general thoughts.  Fair.  So, <b>I really can do better</b> .  At the very least, my proposal will not require the end user to launch a curved software instead of the expected video files. <br><a name="habracut"></a><br><h3>  <font color="#4682b4">Solving all problems</font> </h3><br>  And the solution is the most trivial, friends: watermarks.  Yes, just watermarks.  Instead of inventing complex binding mechanisms for a specific device, ‚Äúsign‚Äù the video sequence.  That‚Äôs all. <br><br>  What properties should a watermark have in order to perform a defensive function: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Watermark must contain information that uniquely identifies the user who bought the video course.  This can be an activation key issued to the user, or a username obtained when registering on the video course purchase site, or time stamps corresponding to the course purchase time (of course, if you can unambiguously correlate them with the buyer's personality), or anything from this opera. </li><li>  Watermark should cover most of the frame so that it cannot be cut without major losses for the video course. </li><li>  The scheme of imposing a watermark should be random for each copy of the course, so that the villain does not write an automator on cutting out that same watermark. </li></ol><br>  If you make a watermark highly transparent, its presence does not interfere with the user, but still it is worth mentioning this in the course description <b>before paying</b> . <br><br>  Thus, to extract incriminating information, a potential pirate would need to go through one of the scenarios described below: <br><br><ol><li>  Cut the <b>entire</b> watermark (remember that according to the 2nd property, the watermark should occupy the entire screen and continue to perform its protective functions even if it is partially erased), thereby devaluing the video (in my opinion, it is logical that in the case where there is no roller, there is no value roller). </li><li>  Edit each frame separately to get rid of the watermark, without causing significant damage to the video.  The complexity of performing such an action manually exceeds the creation of a video from scratch, and according to the 3rd property, the offender does not have the ability to automate the process. </li><li>  (?) Probably, you can ask a smart neural network to do it for you.  Although not sure, not an expert, you can correct me in the comments. </li></ol><br><h3>  <font color="#4682b4">Proof-of-concept</font> </h3><br>  For half an hour, a trivial script of 100 lines was compiled, demonstrating the simplicity and accessibility of the implementation of such protection.  <u>I emphasize</u> : not to show how clever I am, but quite the opposite, to note that a person very far from image processing could create quite working code (under the spoiler) in half an hour, like this: <br><br><div class="spoiler">  <b class="spoiler_title">fckInfoprotectorV2.py</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 # -*- coding: utf-8 -*- # Usage: python3 fckInfoprotectorV2.py import os from shutil import rmtree import numpy as np import cv2 class VideoSigner: def __init__(self, video, watermark): os.makedirs('original') os.makedirs('watermarked') self.vidin = cv2.VideoCapture(video) self.fps = self.vidin.get(cv2.CAP_PROP_FPS) self.frame_size = ( int(self.vidin.get(cv2.CAP_PROP_FRAME_WIDTH)), int(self.vidin.get(cv2.CAP_PROP_FRAME_HEIGHT)) ) self.watermark = cv2.imread(watermark, cv2.IMREAD_UNCHANGED) self.wH, self.wW = self.watermark.shape[:2] B, G, R, A = cv2.split(self.watermark) B = cv2.bitwise_and(B, B, mask=A) G = cv2.bitwise_and(G, G, mask=A) R = cv2.bitwise_and(R, R, mask=A) self.watermark = cv2.merge([B, G, R, A]) def __del__(self): rmtree('original') rmtree('watermarked') def _split(self): print('[*] Splitting video by frames... ', end='', flush=True) (success, image), count = self.vidin.read(), 0 while success: path = os.path.join('original', f'{count}.jpg') cv2.imwrite(path, image) success, image = self.vidin.read() count += 1 print('Done') def _watermark(self): print('[*] Signing each frame... ', end='', flush=True) for image_name in sorted( os.listdir('original'), key=lambda x: int(x.split('.')[0]) ): image_path = os.path.join('original', image_name) image = cv2.imread(image_path) h, w = image.shape[:2] image = np.dstack([ image, np.ones((h, w), dtype='uint8') * 255 ]) overlay = np.zeros((h, w, 4), dtype='uint8') half_h_diff = (h - self.wH) // 2 half_w_diff = (w - self.wW) // 2 overlay[half_h_diff:half_h_diff + self.wH, half_w_diff:half_w_diff + self.wW] = self.watermark output = image.copy() cv2.addWeighted(overlay, 0.25, output, 1.0, 0, output) path = os.path.join('watermarked', image_name) cv2.imwrite(path, output) print('Done') def _merge(self): print('[*] Merging signed frames... ', end='', flush=True) self.vidout = cv2.VideoWriter( 'signed.avi', cv2.VideoWriter_fourcc(*'XVID'), fps=self.fps, frameSize=self.frame_size ) for image_name in sorted( os.listdir('watermarked'), key=lambda x: int(x.split('.')[0]) ): image_path = os.path.join('watermarked', image_name) image = cv2.imread(image_path) self.vidout.write(image) print('Done') def sign(self): self._split() self._watermark() self._merge() if __name__ == '__main__': signer = VideoSigner('SampleVideo_1280x720_1mb.mp4', 'watermark.png') signer.sign()</span></span></code> </pre> <br></div></div><br>  The result of the script, on <a href="">this</a> sample as an example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s2/fm/yf/s2fmyf3leblxu89ohhwgfqr29-k.gif" alt="sample_original.gif"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vh/oy/qh/vhoyqhxu2-8-igsm3ihf1-yd4c4.gif" alt="sample_signed.gif"></div><br><br>  Not for the sake of HYIP, but only for the common good. <br><br>  I have the honor. </div><p>Source: <a href="https://habr.com/ru/post/450344/">https://habr.com/ru/post/450344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450324/index.html">How a performance monitoring system automatically dismisses Amazon employees</a></li>
<li><a href="../45033/index.html">CMF BORS ¬©</a></li>
<li><a href="../450332/index.html">How the rendering of The Witcher 3 is implemented: lightning, witches sneak and other effects</a></li>
<li><a href="../45034/index.html">To start or introductory course in esoteric language</a></li>
<li><a href="../450340/index.html">How to analyze a competitor's site for free. Step-by-step instruction</a></li>
<li><a href="../450354/index.html">Announced Windows Vision Skills (Preview)</a></li>
<li><a href="../450360/index.html">The architecture of the SPA-application exchange in 2019</a></li>
<li><a href="../450362/index.html">Consider agents "Auditor"</a></li>
<li><a href="../450368/index.html">We get the absolute exchange rates from the paired cross-exchange rates</a></li>
<li><a href="../450372/index.html">How Amazon's algorithms determine who should fire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>