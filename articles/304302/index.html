<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco FirePOWER and ISE Integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habr! Starting with FirePOWER version 6.0.0.0, the possibility of integration with the corporate server of centralized authentication and authoriza...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco FirePOWER and ISE Integration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/080/d66/51a/080d6651acc0425ba9820506a6f22fb0.png"><br><br>  Hi habr!  Starting with FirePOWER version 6.0.0.0, the possibility of integration with the corporate server of centralized authentication and authorization of Cisco ISE has appeared.  In this article we will briefly review what exactly Cisco FirePOWER communication with ISE provides and how this connection is configured. <a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">What is FirePOWER</b> <div class="spoiler_text">  Quite a lot have written on our website in the questions / answers section: <br><ul><li>  <a href="http://www.cbs.ru/site/faq/%3Fsection%3D9474">What is SourceFire?</a> </li><li>  <a href="http://www.cbs.ru/site/faq/%3Fsection%3D9474">What are the advantages of FirePOWER and the features of its implementation / use?</a> </li><li>  <a href="http://www.cbs.ru/site/faq/%3Fsection%3D9474">How to start FirePOWER services on ASA 5500-X?</a> </li></ul>  Also there is an article on habrahabr ‚ÄúWe <a href="https://habrahabr.ru/company/cbs/blog/270795/">share experience.</a>  <a href="https://habrahabr.ru/company/cbs/blog/270795/">Integrating FirePOWER Services on Cisco ASA</a> . ‚Äù <br></div></div><br><div class="spoiler">  <b class="spoiler_title">What is Cisco ISE</b> <div class="spoiler_text">  Enough <a href="https://habrahabr.ru/company/cisco/blog/229525/">is written</a> in <a href="https://habrahabr.ru/company/cisco/blog/229525/">detail</a> on habrahabr in the corporate blog of Cisco. <br>  There is also a <a href="http://gblogs.cisco.com/ru/dkazakov_cisco_trustsec/">serious article</a> from a Cisco engineer that describes how to use Cisco ISE and the TrustSec architecture. <br></div></div><br>  FirePOWER integration with ISE provides, first of all, a new way to obtain user identification data.  Prior to FirePOWER version 6.0.0.0, user authentication occurred in passive mode.  This means that somewhere in the network an agent must be installed on the computer entering the domain or directly on the Active Directory (AD) server.  This agent should monitor the AD logs for user login / logoff events and pass the matching IP address and user account to FirePOWER.  The latest reincarnation of this agent from SourceFIRE is called the Cisco FirePOWER User Agent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Passive Authentication Agents</b> <div class="spoiler_text">  Cisco inherited a SourceFIRE User Agent from SourceFIRE, which is able to integrate with the Defense Center Management System (FireSIGHT).  By the way, now the actual name of the FirePOWER control system looks like this: FirePOWER Management Center (abbreviated FMC).  And the agent is called the Cisco FirePOWER User Agent. <br><br>  Prior to this, Cisco had its own agent options: the Cisco Active Directory Agent (AD Agent), managed from the command line, and a later GUI solution - the Context Directory Agent (CDA).  These solutions could be used to get Identity FireWall functionality on a Cisco ASA device.  Those.  on Cisco ASA, it was possible to create access lists not by IP addresses, but by accounts from AD.  CDA could also be used with the Cisco ASA CX solution (this solution is no longer sold in favor of ASA + FirePOWER), with the Cisco WSA WEB-proxy server, and with the Cisco ISE authentication and authorization server. <br></div></div><br>  The advantage of using an agent for user authentication is the complete transparency of the authentication process.  In other words, the User Experience for the end user does not change at all when implementing authentication on a network gateway.  However, this method has several disadvantages.  The obvious disadvantage is in the approach itself: you need to install additional software, which should monitor the AD logs around the clock.  If for some reason AD logs are not available, the user will not be authorized on the network device.  There may also be a problem with incorrect access rights.  For example, if the PC was disconnected from the network at the time the user logged in, in theory, the new user would be able to get the access rights of the previous PC user if after some time he connected the PC back to the network. <br><br>  Another approach is active authentication, in which the installation of an agent is not required, but users must independently enter their credentials upon request.  The disadvantage of this method is obvious. <br><br>  Active FirePOWER authentication was also introduced with the release of version 6.0.0.0. <br><br>  Using Cisco ISE to identify users on FirePOWER solves the problems inherent in both passive authentication with the agent and active authentication.  As it follows from the definition, Cisco ISE is a centralized system for authenticating and authorizing users when connected to a network.  As soon as the user successfully passes the authentication and authorization procedures and gains access to the network, full information about this user appears on the Cisco ISE, including the user's IP address and account.  Further, this information is sufficient to transfer to FirePOWER, and more specifically to the FirePOWER Management Center management system.  The system will be able to map the IP address of a network transaction to a user account and apply customized access policies. <br><br>  But the functionality of Cisco ISE is not limited to the authentication and authorization of users on the network.  Cisco ISE allows you to profile user devices, i.e.  Determine which device is connected to a specific port on a specific switch.  Device information includes: manufacturer, OS version, device type (mobile / stationary), etc.  This information can also be transferred to FirePOWER.  This makes it possible to configure different access rules for different types of devices.  For example, for Android and iOS more specific limitations than for Microsoft Workstation.  An example of setting up a rule according to the type of device is presented below: <br><br><img src="https://habrastorage.org/files/04d/376/8d4/04d3768d44704cad83835e4608e2e24a.PNG"><br><br>  In addition to profiling, Cisco ISE devices allow you to implement Cisco TrustSec architecture.  Very briefly, Cisco TrustSec allows you to differentiate network access by tags, called Security Group Tags (SGT).  The label is an arbitrary number from 1 to 65535 transmitted within the Ethernet frame.  Accordingly, devices through which SGT-tagged frames pass must support the TrustSec architecture.  Otherwise, tag information for a network transaction can be transmitted via the Security Group Tag Exchange Protocol (SXP).  Upon successful completion of the authentication and authorization procedures, the user is assigned a label indicating his access to network resources.  The description, SGT tag assignment, and tag access rules (SGT ACL) are configured using Cisco ISE.  Starting with FirePOWER version 6.0.0.0, it became possible to use SGT tags in FirePOWER access policies.  An example of setting up a rule with an SGT tag is shown below: <br><br><img src="https://habrastorage.org/files/9e3/fb1/7b4/9e3fb17b4825406ebd710cc9fdca1666.PNG"><br><br>  The last ISE attribute that can be used in FirePOWER access policies version 6.0.0.0 is Location IP.  This attribute indicates the IP address of the network device that authenticated the user through the Cisco ISE.  Consequently, you can create different access rules for the same user, depending on which network device it is connected to (switch or WiFi access point, or, for example, a switch in the head office or a switch in a remote branch office, or, for example, user connection remotely via AnyConnect). <br><br>  Before proceeding to setting up a FirePOWER connection with Cisco ISE, let's summarize.  When integrating FirePOWER and Cisco ISE, we get the following benefits: <br><ol><li>  There is no need to use the Cisco FirePOWER User Agent to authenticate users.  Also, there is no need for active authentication.  All tasks of authentication and authorization of users in a network are assumed by Cisco ISE. </li><li>  More accurate user identification on FirePOWER compared to using Cisco FirePOWER User Agent. </li><li>  Using the attributes of Cisco ISE, as follows: <br><ul><li>  It is possible to use the results of Cisco ISE profiling in FirePOWER access rules. </li><li>  It is possible to use TrustSec labels (SGT) in FirePOWER access rules. </li><li>  It becomes possible to use the IP address of the authorizing device in FirePOWER access rules. </li></ul><br></li></ol><br>  <b>Configuring FirePOWER Communication with Cisco ISE</b> <br><br>  The configuration is for FirePOWER Management Center version 6.0.1 and Cisco ISE version 2.0.0.306.  As mentioned earlier, Cisco ISE stores detailed information about users authorized on the network.  The main task is to transfer the necessary information to FirePOWER. <br><br>  Traditionally, when one system must communicate with another system, they use custom or proprietary APIs (Application Programing Interface).  Cisco offers its own technology through which various Cisco products interact, as well as the connection of Cisco solutions with systems from other vendors.  The technology is referred to as the Cisco Platform Exchange Grid (pxGrid).  This technology offers a common interaction language for exchanging information between different systems, for example, FirePOWER, ISE, WSA, Cyber ‚Äã‚ÄãThreat Defense (CTD), etc. <br><br>  The core component of pxGrid is Cisco ISE.  Other external systems act as clients or agents within pxGrid and subscribe to Cisco ISE for receiving or transmitting information.  When external systems connect to pxGrid by registering with the Cisco ISE, they are able to exchange information using the ‚Äúevery with each‚Äù scheme using common methods.  Registration of external systems on Cisco ISE in pxGrid is carried out by means of digital certificates.  To use pxGrid on Cisco ISE, a PLUS license is required. <br><br>  Let's go to the settings.  First Cisco ISE. <br><br>  1. Activate pxGrid Persona on Cisco ISE. <br><br>  Administration tab -&gt; System -&gt; Deployment. <br><br><img src="https://habrastorage.org/files/f28/e29/0e8/f28e290e8ec845ddad7365035ab87574.PNG"><br><br>  Choose an ISE server.  Click on its name.  Set checkbox in front of pxGrid: <br><br><img src="https://habrastorage.org/files/e33/697/622/e3369762250b4b5e867ed00d0748bef6.PNG"><br><br>  Click Save. <br><br>  2. Get a digital certificate for pxGrid.  The pxGrid service requires advanced digital key usage, namely, authentication of both the server and the client.  Therefore, the certificate used for standard ISE tasks (EAP Authentication, Admin portals, User Portals) is not suitable for pxGrid.  It is necessary to generate and sign a certificate for pxGrid on the corporate certificate authority (hereinafter referred to as corporate CA).  To do this, go to the Administration -&gt; System -&gt; Certificates tab and select Certificate Signing Requests in the menu on the left: <br><br><img src="https://habrastorage.org/files/9b9/5e4/cdd/9b95e4cdd9904476a0cb0a38c1aeba04.PNG"><br><br>  Click Generate Certificate Signing Request (CSR) and fill in the required fields.  The example in the image below: <br><br><img src="https://habrastorage.org/files/382/6a0/4b5/3826a04b5a0f4246bf317909c3f8b0d1.PNG"><br><br>  Click Generate and export the resulting CSR.  Now we go to the corporate CA and sign the CSR certificate.  At this moment I will not stop in detail, I‚Äôll just insert screenshots: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/78f/b18/998/78fb18998f334612b0b17f4a23cc087a.PNG"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/509/f64/7b9/509f647b9e514951b75935e2d17cea47.PNG"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e90/5d3/1e0/e905d31e0d264a168db1770d8c435b55.PNG"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/229/dac/c7e/229dacc7e7114f328805ac7f62132a49.png"></div><br><br>  Signed certificate received.  We return to ISE, we bind the certificate to the CSR: <br><br><img src="https://habrastorage.org/files/bd7/304/ee8/bd7304ee8071421ab3a7c78f8d321991.png"><br><br><img src="https://habrastorage.org/files/829/f9e/a78/829f9ea78f354ba6815317e3209db0aa.png"><br><br>  Now ISE has the required certificate for pxGrid: <br><br><img src="https://habrastorage.org/files/935/60c/467/93560c4673384ad09ffdd000be48d747.png"><br><br>  3. You can check clients connected via pxGrid on the tab Administration -&gt; pxGrid Services.  Here we set the ‚ÄúEnable Auto Registration‚Äù setting: <br><br><img src="https://habrastorage.org/files/445/85b/692/44585b6923854460bd80893c67f3a281.png"><br><br>  ISE is configured.  Now let's move on to the pxGrid settings on FirePOWER. <br><br>  4. It is necessary to go to the System -&gt; Integration -&gt; Identity Sources tab and select the Identity Services Engine as the source of the identification information: <br><br><img src="https://habrastorage.org/files/936/42d/191/93642d191d15491bbb5efc1e607df952.png"><br><br>  5. Fill in the required fields.  You must specify the IP address or name of the ISE server: <br><br><img src="https://habrastorage.org/files/fe6/fdd/86c/fe6fdd86c574443ead993b384476b831.png"><br><br>  6. Specify the certificates ‚ÄúpxGrid Server CA‚Äù and ‚ÄúMNT Server CA‚Äù.  As these certificates, you can use the corporate CA root certificate: <br><br><img src="https://habrastorage.org/files/cca/27c/96b/cca27c96b3f34619aad467e6f6cfbd4d.png"><br><br>  7. Specify the certificate and key ‚ÄúFMC Server Certificate‚Äù.  This FirePOWER Management Center certificate will be presented by Cisco ISE when attempting to connect to pxGrid.  To get this certificate, you need to generate a CSR on FirePOWER, sign it on the corporate CA, and upload the signed certificate to FirePOWER.  To do this, you need to generate a key pair and a CSR from the FMC command line using the openssl utility: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/da0/527/def/da0527defd9c4a8ba257853d5d76efd3.png"></div><br><br>  I used the following parameter string to create a CSR and Private Key: <br><br><pre><code class="python hljs">req -batch -new -newkey rsa:<span class="hljs-number"><span class="hljs-number">2048</span></span> -nodes -keyout fp.key -subj <span class="hljs-string"><span class="hljs-string">'/C=RU/ST=Moscow/L=Moscow/O=CBS/OU=Computers/emailAddress=uskov@cbs.ru/CN=fmc/CN=cbs/CN=com/CN=ru'</span></span> -out fp.csr</code> </pre> <br>  Next, in CSR, you need to sign a certificate on the corporate CA.  The procedure is absolutely similar to the process of obtaining the pxGrid certificate for ISE.  Import the signed certificate into the FirePOWER Management Center.  The Objects tab -&gt; Object Management menu PKI -&gt; Internal Certs: <br><br><img src="https://habrastorage.org/files/4b8/6ba/8d6/4b86ba8d60d74aa7ad88613080c243bb.png"><br><br>  Click Add Internal Cert, select signed certificate and Private Key: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c26/c5a/1ec/c26c5a1ecae64f40acacdb6c4cf9d3f1.png"></div><br><br>  Certificate and key ‚ÄúFMC Server Certificate‚Äù is ready.  Go back to the System -&gt; Integration -&gt; Identity Sources tab and select the Identity Services Engine.  Specify "FMC Server Certificate": <br><br><img src="https://habrastorage.org/files/7cf/e98/5f2/7cfe985f232c480ebd68b8f7879fc28e.png"><br><br>  8. In the same menu, click Test.  A ‚ÄúSuccess‚Äù window should appear: <br><br><img src="https://habrastorage.org/files/873/6b5/cd1/8736b5cd1e3540509a7226efd2a074ae.png"><br><br>  9. Do not forget to click Save in the upper right corner: <br><br><img src="https://habrastorage.org/files/8f8/5b3/eef/8f85b3eefb6d4e9c9882c875d6ac5b94.png"><br><br>  10. Back to ISE, check the Administration tab -&gt; pxGrid Services.  We see new pxGrid clients: <br><br><img src="https://habrastorage.org/files/532/3dd/239/5323dd239a1c4144901ef7423330ccdb.png"><br><br>  Check the performance of the customized solution.  Cisco ISE is configured to authenticate a wired network test segment.  We will not discuss Cisco ISE policy settings as part of this note.  Connect using a laptop to a wired network, as a supplicant we use Cisco AnyConnect Network Access Manager (NAM): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c24/9e6/c4c/c249e6c4c0c24f48b9e8827d1df7dbd4.png"></div><br><br>  In the ISE logs, check Radius Livelog (Operations tab -&gt; RADIUS Livelog): <br><br><img src="https://habrastorage.org/files/2d4/f9d/5a5/2d4f9d5a5c39425cbb9dea9ac2ff4941.png"><br><br>  Authentication was successful.  Now let's check User Activity for FirePOWER (Analysis tab -&gt; Users -&gt; User Activity): <br><br><img src="https://habrastorage.org/files/ced/bbc/209/cedbbc209afb42ebb931f470869ab0db.png"><br><br>  If you flush the User Activity output to the right, you can see that the FirePOWER Management Center received additional attributes from ISE: Security Group Tag, Endpoint Profile and Endpoint Location: <br><br><img src="https://habrastorage.org/files/fa7/f2a/696/fa7f2a696ef44da787eb534813a5d7c9.png"><br><br>  This concludes the description of the integration of ISE and FirePOWER.  I hope this material will be useful to readers. <br><br>  If you are interested in this topic, welcome to us at <a href="http://www.cbs.ru/site/lab/10770/">Cisco ISE</a> , <a href="http://www.cbs.ru/site/lab/10663/">Cisco FirePOWER</a> . </div><p>Source: <a href="https://habr.com/ru/post/304302/">https://habr.com/ru/post/304302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304290/index.html">IaaS-digest: 30 materials on technology transformation</a></li>
<li><a href="../304292/index.html">Improving service design in IaaS model</a></li>
<li><a href="../304294/index.html">Independent Developer Cup</a></li>
<li><a href="../304296/index.html">Visualization with Google Chart Tools API</a></li>
<li><a href="../304298/index.html">WRIO Internet OS. Architecture: Linked Data and JSON-LD</a></li>
<li><a href="../304304/index.html">The fight for code style or Bracket Wars</a></li>
<li><a href="../304306/index.html">NetApp ONTAP 9</a></li>
<li><a href="../304308/index.html">std :: shared_ptr and custom allocator</a></li>
<li><a href="../304312/index.html">LoRa technology</a></li>
<li><a href="../304316/index.html">How to quickly create product descriptions for your store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>