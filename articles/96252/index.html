<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spreading applications on twisted</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My job is to create various Twisted applications to work with numerous web services. Unlike the projects on TurboGears , which I spread as eggs using ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spreading applications on twisted</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/5e2/7d5/ea8/5e27d5ea88bc4879b8343f8b4dd39f4f.png" alt="image">  My job is to create various <a href="http://twistedmatrix.com/">Twisted</a> applications to work with numerous web services.  Unlike the projects on <a href="http://turbogears.org/">TurboGears</a> , which I spread as eggs using <a href="http://peak.telecommunity.com/DevCenter/EasyInstall">easy_install</a> (via setuptools) I did not have a convenient way to roll out projects on Twisted. <br><br>  Up to this point. <br><a name="habracut"></a><br>  Twisted overcomes a convenient <a href="http://twistedmatrix.com/projects/core/documentation/howto/plugin.html">system of plug-ins</a> that allow applications to <a href="http://twistedmatrix.com/projects/core/documentation/howto/tap.html">be built</a> into the "twistd" starter. <br><br>  Only one problem - the complete lack of decent documentation about this process. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Below I want to give a short story about how you can build a simple application in a twisted package.  Actually - I will take the well-known <a href="http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html">tutorial - Twisted finger</a> and I will add step number 12: ‚ÄúHow to create a package for finger as a Twisted application for twistd‚Äù (aka ‚ÄúSkipped step‚Äù). <br><br><h4>  Step 12: Twisted application plug-in for twistd installer </h4><br><br>  Create a directory structure as shown below. <br> <code>finger <br> finger/__init__.py <br> finger/finger.py <br> MANIFEST.in <br> setup.py <br> twisted <br> twisted/plugins <br> twisted/plugins/finger_plugin.py</code> <br> <br>  finger / finger.py is <a href="http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html">the finger app from here</a> . <br><br>  twisted / plugins - directory structure, contains the file finger_plugin.py, which will be described below.  Please note - no __init__.py files in the twisted and twisted / plugins directories are important! <br><br>  finger_plugin.py implements the IServiceMaker and IPlugin interfaces. <br><pre>  # ==== twisted / plugins / finger_plugin.py ====
 # - Zope modules -
 from zope.interface import implements

 # - Twisted modules -
 from twisted.python import usage
 from twisted.application.service import IServiceMaker
 from twisted.plugin import IPlugin

 # - Finger modules -
 from finger import finger

 class Options (usage.Options):
     synopsis = "[options]"
     longdesc = "Make a finger server."
     optParameters = [
         ['file', 'f', '/ etc / users'],
         ['templates', 't', '/ usr / share / finger / templates'],
         ['ircnick', 'n', 'fingerbot'],
         ['ircserver', None, 'irc.freenode.net'],
         ['pbport', 'p', 8889],
     ]
    
     optFlags = [['ssl', 's']]

 class MyServiceMaker (object):
     implements (IServiceMaker, IPlugin)
    
     tapname = "finger"
     description = "Finger server."
     options = Options
    
     def makeService (self, config):
         return finger.makeService (config)

 serviceMaker = MyServiceMaker () </pre><br><br>  setup.py is a standard installer file.  Pay attention to the ‚Äúpackages‚Äù and ‚Äúpackage_data‚Äù arguments in the setup () function and the refresh_plugin_cache () function, which is called after it has fully completed setup () s.  The latter will manually reset the Twisted plugins cache (twisted / plugins / dropin.cache). <br><pre>  # ==== twisted / plugins / finger_plugin.py ====
 '' 'setup.py for finger.

 This is an extension of the twisted finger tutorial demonstrating how
 to package the Twisted application and installable Python package and
 twistd plugin (consider it "Step 12" if you like).

 Uses twisted.python.dist.setup () to make this package installable as
 a Twisted Application Plugin.

 After the installation should be manageable as a twistd
 command.

 For example, to enter it in the foreground:
 $ twistd -n finger

 To view the options for finger enter:
 $ twistd finger --help
 '' '

 __author__ = 'Chris Miles'


 import sys

 try:
     import twisted
 except ImportError:
     raise SystemExit ("twisted not found. Make sure you"
                      "have installed the Twisted core package.")

 from distutils.core import setup

 def refresh_plugin_cache ():
     from twisted.plugin import IPlugin, getPlugins
     list (getPlugins (IPlugin))

 if __name__ == '__main__':
    
     if sys.version_info [: 2]&gt; = (2, 4):
         extraMeta = dict (
             classifiers = [
                 "Development Status :: 4 - Beta",
                 "Environment :: No Input / Output (Daemon)",
                 "Programming Language :: Python",
             ])
     else:
         extraMeta = {}

     setup (
         name = "finger",
         version = '0.1',
         description = "Finger server.",
         author = __ author__,
         author_email = "you@email.address",
         url = "http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html",
         packages = [
             "finger",
             "twisted.plugins",
         ],
         package_data = {
             'twisted': ['plugins / finger_plugin.py'],
         },
         ** extraMeta)
    
     refresh_plugin_cache () </pre><br><br>  MANIFEST.in contains one script, which, I believe, tells distutils to modify an existing Twisted package (to install twisted / plugin / finger_plugin.py) and something like that. <br> <code>graft twisted</code> <br> <br>  This is all so that you can start installing the package in the usual way: <br> <code>$ python setup.py install</code> <br> <br>  After that, you need to run twistd - to make sure that the application is installed normally and accessible.  Look at the twistd options: <br> <code>$ twistd --help <br> Usage: twistd [options] <br> ... <br> Commands: <br> athena-widget Create a service which starts a NevowSite with a single <br> page with a single widget. <br> ftp An FTP server. <br> telnet A simple, telnet-based remote debugging service. <br> socks A SOCKSv4 proxy service. <br> manhole-old An interactive remote debugger service. <br> portforward A simple port-forwarder. <br> web A general-purpose web server which can serve from a <br> filesystem or application resource. <br> inetd An inetd(8) replacement. <br> vencoderd Locayta Media Farm vencoderd video encoding server. <br> news A news server. <br> words A modern words server <br> toc An AIM TOC service. <br> finger Finger server. <br> dns A domain name server. <br> mail An email service <br> manhole An interactive remote debugger service accessible via <br> telnet and ssh and providing syntax coloring and basic <br> line editing functionality. <br> conch A Conch SSH service.</code> <br> <br>  Let's look at the options of our finger server in the plugin: <br> <code>$ twistd finger --help <br> Usage: twistd [options] finger [options] <br> Options: <br> -s, --ssl <br> -f, --file= [default: /etc/users] <br> -t, --templates= [default: /usr/share/finger/templates] <br> -n, --ircnick= [default: fingerbot] <br> --ircserver= [default: irc.freenode.net] <br> -p, --pbport= [default: 8889] <br> --version <br> --help Display this help and exit. <br> <br> Make a finger server.</code> <br> <br>  Run the finger server in the console: <br> <code>$ sudo twistd -n finger --file=users <br> 2007/12/23 22:12 +1100 [-] Log opened. <br> 2007/12/23 22:12 +1100 [-] twistd 2.5.0 (/Library/Frameworks/Python.framework/ <br> Versions/2.5/Resources/Python.app/Contents/MacOS/Python 2.5.0) starting up <br> 2007/12/23 22:12 +1100 [-] reactor class: &lt;class 'twisted.internet.selectreactor.SelectReactor'&gt; <br> 2007/12/23 22:12 +1100 [-] finger.finger.FingerFactoryFromService starting on 79 <br> 2007/12/23 22:12 +1100 [-] Starting factory &lt;finger.finger.FingerFactoryFromService instance at 0x1d0a4e0&gt; <br> 2007/12/23 22:12 +1100 [-] twisted.web.server.Site starting on 8000 <br> 2007/12/23 22:12 +1100 [-] Starting factory &lt;twisted.web.server.Site instance at 0x1d0a558&gt; <br> 2007/12/23 22:12 +1100 [-] twisted.spread.pb.PBServerFactory starting on 8889 <br> 2007/12/23 22:12 +1100 [-] Starting factory &lt;twisted.spread.pb.PBServerFactory instance at 0x1d0a670&gt; <br> 2007/12/23 22:12 +1100 [-] Starting factory &lt;finger.finger.IRCClientFactoryFromService instance at 0x1d0a5f8&gt; <br></code> <br><br>  Twistd provides numerous useful features - such as starting a daemon, specifying the location of the log and pid files, etc ... <br><br>  Unfortunately, Twisted and setuptools do not work well together, so I could not pack my Twisted application as an egg, I have to tinker with the dependencies resolution system setuptools, or install using easy_install. <br><br><h4>  References: </h4><br><ul><li>  <a href="http://twistedmatrix.com/projects/core/documentation/howto/plugin.html">twistedmatrix.com/projects/core/documentation/howto/plugin.html</a> </li><li>  <a href="http://twistedmatrix.com/projects/core/documentation/howto/tap.html">twistedmatrix.com/projects/core/documentation/howto/tap.html</a> </li><li>  <a href="http://twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html">twistedmatrix.com/projects/core/documentation/howto/tutorial/index.html</a> </li></ul><br>  - <a href="http://chrismiles.livejournal.com/23399.html">Source</a> </div><p>Source: <a href="https://habr.com/ru/post/96252/">https://habr.com/ru/post/96252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96241/index.html">E-NUM client for Android</a></li>
<li><a href="../96244/index.html">Mobile interface for gesture control</a></li>
<li><a href="../96245/index.html">Second Life Mac Classic</a></li>
<li><a href="../96247/index.html">Toshiba Satellite A660</a></li>
<li><a href="../96249/index.html">Nagios: SMS Notification without Google Calendar</a></li>
<li><a href="../96253/index.html">These could be the new icons for LiveJournal.</a></li>
<li><a href="../96255/index.html">User data protection</a></li>
<li><a href="../96257/index.html">Apple Inc. is going to buy ARM Holdings again?</a></li>
<li><a href="../96259/index.html">Foxconn closes its factories in China</a></li>
<li><a href="../96260/index.html">Eight daring, or "Causes Taimyr!", Part One</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>