<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Make it True - Developing a logical game on Unity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share the process of developing a simple mobile game by two developers and an artist. This article is more a description of the technical im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Make it True - Developing a logical game on Unity</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/4k/h-/6e/4kh-6e4-iwvtuaz42eqb2gg81iu.png"><br><br>  I want to share the process of developing a simple mobile game by two developers and an artist.  This article is more a description of the technical implementation. <br>  Careful, a lot of text! <br><br>  The article is not a guide or a lesson, although I hope that readers will be able to learn something useful from it.  Designed for developers familiar with Unity who have some programming experience. <br><a name="habracut"></a><br><a name="Content"></a><h4>  Content: </h4><br>  <a href="https://habr.com/ru/post/453564/">Idea</a> <br>  <a href="https://habr.com/ru/post/453564/">Gameplay</a> <br>  <a href="https://habr.com/ru/post/453564/">Plot</a> <br>  <a href="https://habr.com/ru/post/453564/">Development</a> <br>  <a href="https://habr.com/ru/post/453564/">Core</a> <br><ol><li>  <a href="https://habr.com/ru/post/453564/">Electrical items</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Solver</a> </li><li>  <a href="https://habr.com/ru/post/453564/">ElementsProvider</a> </li><li>  <a href="https://habr.com/ru/post/453564/">CircuitGenerator</a> </li></ol><br>  <a href="https://habr.com/ru/post/453564/">Game classes</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habr.com/ru/post/453564/">Development Approach and DI</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Configuration</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Electrical items</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Game management</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Loading levels</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Cutscenes</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Extra gameplay</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Monetization</a> </li><li>  <a href="https://habr.com/ru/post/453564/">User interface</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Analytics</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Camera positioning and diagrams</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Color schemes</a> </li></ol><br>  <a href="https://habr.com/ru/post/453564/">Editor extensions</a> <a href="https://habr.com/ru/post/453564/"><br></a> <br><br><ol><li>  <a href="https://habr.com/ru/post/453564/">Generator</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Solver</a> </li></ol><br>  <a href="https://habr.com/ru/post/453564/">Useful</a> <br><br><ol><li>  <a href="https://habr.com/ru/post/453564/">Asserthelper</a> </li><li>  <a href="https://habr.com/ru/post/453564/">SceneObjectsHelper</a> </li><li>  <a href="https://habr.com/ru/post/453564/">CoroutineStarter</a> </li><li>  <a href="https://habr.com/ru/post/453564/">Gizmo</a> </li></ol><br>  <a href="https://habr.com/ru/post/453564/">Testing</a> <br>  <a href="https://habr.com/ru/post/453564/">Development results</a> <br><br><a name="Idea"></a><h2>  Idea </h2><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  An idea to make a simple mobile game, for a short period. <br><br>  Conditions: <br><br><ul><li>  Easy to implement game </li><li>  Minimum requirements for art </li><li>  Short development time (several months) </li><li>  With easy automation of content creation (levels, locations, game elements) </li><li>  Quick level creation if the game consists of a finite number of levels </li></ul><br>  In order to determine what to actually do?  After all, the idea to make a game, and not the idea of ‚Äã‚Äãthe game.  It was decided to look for inspiration in the app store. <br><br>  To the above points are added: <br><br><ul><li>  The game must have a certain popularity among the players (number of downloads + ratings) </li><li>  The app store should not be filled with similar games. </li></ul><br>  A game was found with a gameplay based on logic gates.  There were no similar ones in a larger number. The game has many downloads and positive ratings.  Nevertheless, having tried there were some flaws that can be taken into account in your game. <br><br>  The gameplay of the game is that the level is a digital circuit with multiple inputs and outputs.  The player must choose such a combination of inputs so that the output is logical 1. It does not sound very difficult.  Also, the game has automatically generated levels, which suggests that the ability to automate the creation of levels, although it does not sound very simple.  The game is also good for learning, which I really liked. <br><br>  Pros: <br><br><ul><li>  Technical simplicity of gameplay </li><li>  Looks easy to test AutoTests </li><li>  Ability to auto-generate levels </li></ul><br>  Minuses: <br><br><ul><li>  You must first create levels </li></ul><br>  Now explore the shortcomings of the game which were inspired. <br><br><ul><li>  Not adapted for non-standard aspect ratio, like 18: 9 </li><li>  There is no way to skip a difficult level or get a hint. </li><li>  In the reviews, there were complaints about a small number of levels. </li><li>  In the reviews complained about the lack of diversity of elements </li></ul><br>  We proceed to the planning of our game: <br><br><ul><li>  We use standard logic gates (AND, NAND, OR, NOR, XOR, XNOR, NOR, NOT) </li><li>  Gates display a picture instead of a text designation, which is easier to distinguish.  Since elements have standard ANSI notation we use them. </li><li>  We discard the switch that connects one input to one of the outputs.  For the reason that he demands to press on himself and does not fit into the real digital elements a little.  And it's hard to imagine a toggle switch in a microcircuit. </li><li>  Add the elements Encoder and Decoder. </li><li>  Enter the mode in which the player must select the desired element in the cell with fixed values ‚Äã‚Äãat the inputs of the scheme. </li><li>  We implement player assistance: hint + skip level. </li><li>  It would be nice to add some plot. </li></ul><br><a name="Gameplay"></a><h2>  Gameplay </h2><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  Mode 1: The player receives the scheme and has access to change the values ‚Äã‚Äãat the inputs. <br>  Mode 2: The player receives a scheme in which he can change the elements but cannot change the values ‚Äã‚Äãat the inputs. <br><br>  The gameplay will be done in the form of pre-prepared levels.  After passing the level, the player must get some result. This will be done in the form of the traditional three stars, depending on the result of the passage. <br><br>  What may be the passing indicators: <br>  Number of actions: Each interaction with game elements increases the counter. <br>  The number of differences in the resulting state from the original.  Does not take into account how many attempts the player had to pass.  Unfortunately, it does not fit with the second mode. <br>  It would be nice to add the same mode with random level generation.  But for now, let's postpone it for later. <br><br><a name="Plot"></a><h2>  Plot </h2><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  While thinking about the gameplay and starting to develop different ideas appeared to improve the game.  And there was quite an interesting idea - add a story. <br><br>  It is about an engineer who designs circuits.  Not bad, but the completeness is not felt. It is probably worth displaying the manufacture of chips based on what the player does?  As a matter of routine, there is no clear and simple result. <br><br>  Idea!  The engineer develops a cool robot using his logic circuits.  The robot is quite simple understandable thing and perfectly fit with the gameplay. <br><br>  Remember the first item ‚ÄúMinimum requirements for art‚Äù?  Something does not fit with the cutscenes in the plot.  Here comes to the aid of a familiar artist, who agreed to help us. <br><br>  Now we will define the format and integration of the cutscene into the game. <br><br>  The plot must be displayed as a cutscene without sound or text description that will remove problems with localization, simplify its understanding, and many people play on mobile devices without sound.  The game is a very real elements of digital circuits, that is, it is quite possible to link it with reality. <br><br>  The cutscenes and levels must be separate scenes.  Before a certain level, a specific scene is loaded. <br><br>  Well, the task has been set, there are resources for execution, the work has begun to boil. <br><br><a name="Development"></a><h2>  Development </h2><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  With a platform was defined at once, it is Unity.  Yes, a little overkill, but nevertheless I am familiar with it. <br><br>  During the development process, the code is written immediately with tests or even after.  But for a holistic narrative, testing is placed in a separate section below.  The current section will describe the development process separately from testing. <br><br><a name="Core"></a><h3>  Core </h3><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  The core of the gameplay looks pretty simple and not tied to the engine, so we started with the design in the form of C # code.  It seems that you can select a separate core of the logic.  We carry it out in a separate project. <br><br>  Unity works with the C # solution and projects inside a bit unusual for a regular .Net developer, the .sln and .csproj files are generated by Unity itself and changes inside these files are not accepted for consideration on the Unity side.  He will simply overwrite them and delete all changes.  To create a new project, you must use the <a href="https://docs.unity3d.com/Manual/ScriptCompilationAssemblyDefinitionFiles.html">Assembly Definition</a> file. <br><br><img src="https://habrastorage.org/webt/b2/84/92/b28492ps5o-_mv62mdvo1frk4l8.png"><br><br><img src="https://habrastorage.org/webt/vd/xk/_k/vdxk_k9ydjfhu1aiee8ctlx3eau.png"><br><br>  Unity now generates a project with the appropriate name.  All that is in the folder with the .asmdef file will be related to this project and build. <br><br><a name="CoreElectricalElements"></a><h4>  Electrical items </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  The goal is to describe in the code the interaction of logical elements with each other. <br><br><ul><li>  An item can have multiple inputs and multiple outputs. </li><li>  The input of the element must be connected to the output of another element. </li><li>  The element itself must contain its own logic. </li></ul><br>  Let's get started <br><br><ul><li>  <b>The element</b> contains its own operation logic and links to its inputs.  When requesting a value from an element, it takes values ‚Äã‚Äãfrom the inputs, applies logic to them, and returns the result.  There can be several outputs, because a value is requested for a specific output, the default is 0. </li><li>  To take values ‚Äã‚Äãat the input, there will be an <b>input connection</b> p, it stores a link to another - an output connector. </li><li>  <b>The output connector</b> refers to a specific element and stores a link to its element; when a value is requested, it requests it from the element. </li></ul><br><img src="https://habrastorage.org/webt/am/7q/yo/am7qyonro-bohnomthogk8qy8o0.png"><br><br>  The arrows indicate the direction of the data, the dependence of the elements in the opposite direction. <br>  Define the connector interface.  You can get value from it. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IConnector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br>  Just how to connect it to another connector? <br><br>  Define more interfaces. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IInputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IConnector</span></span> { IOutputConnector ConnectedOtherConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  The IInputConnector is an input connector; it has a link to another connector. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOutputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IConnector</span></span> { IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br>  The output connector refers to its element from which it asks for a value. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br>  The electrical element must contain a method that returns a value at a particular output, number is the output number. <br><br>  <i>I called it IElectricalElement although it transmits only logical voltage levels, but on the other hand it can be an element that does not add logic at all, it simply conveys a value, like a conductor.</i> <br><br>  We now turn to the implementation <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IInputConnector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOutputConnector ConnectedOtherConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ConnectedOtherConnector?.Value ?? <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } }</code> </pre> <br>  The incoming connector may not be connected, in which case it will return false. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">OutputConnector</span></span> : <span class="hljs-title"><span class="hljs-title">IOutputConnector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> number; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputConnector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.number = number; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value =&gt; Element.GetValue(number); } }</code> </pre> <br>  The output should have a link to its element and its number in relation to the element. <br>  Further, using this number, it requests the value from the element. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElectricalElementBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IInputConnector[] Input { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  The base class for all elements simply contains an array of inputs. <br><br>  Example of element implementation: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">And</span></span> : <span class="hljs-title"><span class="hljs-title">ElectricalElementBase</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> outputValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input?.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { outputValue = Input[<span class="hljs-number"><span class="hljs-number">0</span></span>].Value; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Input) { outputValue &amp;= item.Value; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outputValue; } }</code> </pre> <br>  The implementation is based entirely on logical operations without a hard truth table.  Perhaps not as clearly as with a table, but flexibly, it will work on any number of inputs. <br>  All logic gates have one output, so the value at the output will not depend on the input number. <br><br>  Inverted elements are made as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Nand</span></span> : <span class="hljs-title"><span class="hljs-title">And</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetValue(number); } }</code> </pre> <br>  It is worth noting that the GetValue method is overlapped here, and not redefined virtually.  This is done based on the logic that if Nand someone speaks up to And, then he will continue to behave like And.  It was also possible to apply the composition, but this would require extra code that does not make much sense. <br><br>  In addition to conventional valves, the following elements were created: <br>  Source - the source of the constant value 0 or 1. <br>  Conductor is simply a conductor of the same Or, only has a slightly different use, see generation. <br>  AlwaysFalse - always returns 0, it is necessary for the second mode. <br><br><a name="Solver"></a><h4>  Solver </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  Next, a class is useful for automatically finding combinations that yield 1 on the output of the circuit. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISolver</span></span> { ICollection&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; GetSolutions(IElectricalElement root, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> Source[] sources); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Solver</span></span> : <span class="hljs-title"><span class="hljs-title">ISolver</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICollection&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; GetSolutions(IElectricalElement root, <span class="hljs-keyword"><span class="hljs-keyword">params</span></span> Source[] sources) { <span class="hljs-comment"><span class="hljs-comment">// max value can be got with this count of bits(sources count), also it's count of combinations -1 // for example 8 bits provide 256 combinations, and max value is 255 int maxValue = Pow(sources.Length); // inputs that can solve circuit var rightInputs = new List&lt;bool[]&gt;(); for (int i = 0; i &lt; maxValue; i++) { var inputs = GetBoolArrayFromInt(i, sources.Length); for (int j = 0; j &lt; sources.Length; j++) { sources[j].Value = inputs[j]; } if (root.GetValue()) { rightInputs.Add(inputs); } } return rightInputs; } private static int Pow(int power) { int x = 2; for (int i = 1; i &lt; power; i++) { x *= 2; } return x; } private static bool[] GetBoolArrayFromInt(int value, int length) { var bitArray = new BitArray(new[] {value}); var boolArray = new bool[length]; for (int i = length - 1; i &gt;= 0; i‚Äî) { boolArray[i] = bitArray[i]; } return boolArray; }</span></span></code> </pre> <br>  Solutions are easy to find.  For this, the maximum number is determined which can be expressed by a set of bits in an amount equal to the number of sources.  That is, 4 sources = 4 bits = max number 15. Enumerate all numbers from 0 to 15. <br><br><a name="ElementsProvider"></a><h4>  ElementsProvider </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  For convenience of generation, I decided to define a number for each element. To do this, I created the ElementsProvider class with the IElementsProvider integrarace. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IElementsProvider</span></span> { IList&lt;Func&lt;IElectricalElement&gt;&gt; Gates { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IList&lt;Func&lt;IElectricalElement&gt;&gt; Conductors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IList&lt;ElectricalElementType&gt; GateTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IList&lt;ElectricalElementType&gt; ConductorTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElementsProvider</span></span> : <span class="hljs-title"><span class="hljs-title">IElementsProvider</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;Func&lt;IElectricalElement&gt;&gt; Gates { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt; { () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> And(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nand(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Or(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xnor() }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;Func&lt;IElectricalElement&gt;&gt; Conductors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt; { () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Conductor(), () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Not() }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;ElectricalElementType&gt; GateTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ElectricalElementType&gt; { ElectricalElementType.And, ElectricalElementType.Nand, ElectricalElementType.Or, ElectricalElementType.Nor, ElectricalElementType.Xor, ElectricalElementType.Xnor }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;ElectricalElementType&gt; ConductorTypes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ElectricalElementType&gt; { ElectricalElementType.Conductor, ElectricalElementType.Not }; }</code> </pre> <br>  The first two lists are something like factories that give an element at a specified number.  The last two lists are a crutch which should be used because of features of Unity.  About this further. <br><br><a name="CircuitGenerator"></a><h4>  CircuitGenerator </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br>  Now the most difficult part of the development is schema generation. <br><br>  The task is to generate a list of schemes from which in the editor you can then choose the one you like.  Generation is needed only for simple valves. <br><br>  Certain parameters of the scheme are specified: the number of layers (horizontal lines of the elements) and the maximum number of elements in the layer.  You also need to determine from which gates you need to generate circuits. <br><br>  My approach was to split the task into two parts - the generation of the structure and the selection of options. <br><br>  The structure generator determines the positions and connections of the logic elements. <br>  The variant generator selects valid combinations of elements in the positions. <br><br><h4>  StructureGenerator </h4><br>  The structure consists of layers of logic elements and layers of conductors / inverters.  The whole structure contains not real elements, but containers for them. <br><br>  The container is a class inherited from IElectricalElement, which inside contains a list of valid elements and can switch between them.  Each item has its own number in the list. <br><br><pre> <code class="cs hljs">ElectricalElementContainer : ElectricalElementBase, IElectricalElement</code> </pre> <br><br>  The container can set itself in one of the items from the list.  During initialization, you must pass it a list of delegates who will create the elements.  Inside, it calls each delegate and gets the item.  Then you can set a specific type of this element, it connects the internal element to the same inputs as in the container and the output from the container will be taken from the output of this element. <br><br><img src="https://habrastorage.org/webt/wq/kt/bn/wqktbn6x7esbfnqxkuwh606qvqa.png"><br><br>  Method to set the list of items: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;Func&lt;IElectricalElement&gt;&gt; elements</span></span></span><span class="hljs-function">)</span></span> { Elements = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IElectricalElement&gt;(elements.Count); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> elements) { Elements.Add(item()); } }</code> </pre> <br>  Then you can set the type as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isInitialized == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(UnitializedElementsExceptionMessage); } SelectedType = number; RealElement = Elements[number]; ((ElectricalElementBase) RealElement).Input = Input; }</code> </pre> <br>  After which it will work as the specified element. <br><br>  This structure was created for the scheme: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CircuitStructure</span></span> : <span class="hljs-title"><span class="hljs-title">ICloneable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, ElectricalElementContainer[]&gt; Gates; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, ElectricalElementContainer[]&gt; Conductors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Source[] Sources; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> And FinalDevice; }</code> </pre> <br>  Dictionaries here store the layer number in the key and the array of containers for this layer.  Next, an array of sources and one FinalDevice to which everything is connected. <br><br>  Thus, the structural generator creates containers and connects them to each other.  It is created all in layers, from bottom to top.  Bottom is the widest (most elements).  The layer above contains two times less elements and so on until we reach the minimum.  Outputs of all elements of the upper layer are connected to the final device. <br><br>  A layer of logic elements contains containers for valves.  In the layer of conductors are elements with one input and output.  Elements there can be either a conductor or an element of NO.  The conductor transmits to the output what came to the input, and the element NO returns the inverted value at the output. <br><br>  The first is an array of sources.  The generation takes place from the bottom up, the layer of conductors is first generated, the logic layer is farther, and the conductors are again at the output. <br><br><img src="https://habrastorage.org/webt/pq/bj/hs/pqbjhsbn3xxxi6r6wosryczrdjc.png"><br><br>  But such schemes are very boring!  We wanted to simplify our life even more and decided to make the generated structures more interesting (complex). It was decided to add structure modifications with branching or joining through multiple layers. <br><br>  Well, to say ‚Äúsimplified‚Äù - it means complicating your life in something else. <br>  The generation of schemes with the maximum level of modification turned out to be a laborious and not very practical task.  Therefore, our team decided to do something that met these criteria: <br>  The development of this task took not much time. <br>  More or less adequate generation of modified structures. <br>  There were no intersections between the conductors. <br>  As a result of a long and hard programming, the solution was written in 4 pm. <br>  Let's take a look at the code and Ã∂uÃ∂zhÃ∂aÃ∂sÃ∂nÃ∂Ã∂mÃ∂sÃ∂yaÃ∂. <br><br>  <i>There is a class OverflowArray.</i>  <i>For historical reasons, it was added after the basic structural generation and has more to do with the generation of variants, therefore it is located lower.</i>  <i><a href="https://habr.com/ru/post/453564/">Link</a></i> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;CircuitStructure&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateStructure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxElementsInLine, StructureModification modification</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseStructure = GenerateStructure(lines, maxElementsInLine); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; lines; i++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxValue = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> branchingSign = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.All) { maxValue = <span class="hljs-number"><span class="hljs-number">2</span></span>; branchingSign = <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lengthOverflowArray = baseStructure.Gates[(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>].Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elementArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(lengthOverflowArray, maxValue); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> numberOfOption = Math.Pow(<span class="hljs-number"><span class="hljs-number">2</span></span>, lengthOverflowArray); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = <span class="hljs-number"><span class="hljs-number">1</span></span>; k &lt; numberOfOption - <span class="hljs-number"><span class="hljs-number">1</span></span>; k++) { elementArray.Increase(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.Branching || modification == StructureModification.All) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!CheckOverflowArrayForAllConnection(elementArray, branchingSign, lengthOverflowArray)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// Clone CircuitStructure var structure = (CircuitStructure) baseStructure.Clone(); ConfigureInputs(lines, structure.Conductors, structure.Gates); var sources = AddSourcesLayer(structure.Conductors, maxElementsInLine); var finalElement = AddFinalElement(structure.Conductors); structure.Sources = sources; structure.FinalDevice = finalElement; int key = (i * 2) + 1; ModifyStructure(structure, elementArray, key, modification); ClearStructure(structure); yield return structure; } } }</span></span></code> </pre> <br>  After viewing this code, I would like to understand what is happening in it. <br>  Do not worry!  A brief explanation without details hurries to you. <br><br>  The first thing we do is create an ordinary (basic) structure. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseStructure = GenerateStructure(lines, maxElementsInLine);</code> </pre> <br>  Then, as a result of a simple check, we set the branching sign (branchingSign) to the appropriate value. Why is this necessary?  It will be clear further. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxValue = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> branchingSign = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.All) { maxValue = <span class="hljs-number"><span class="hljs-number">2</span></span>; branchingSign = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br>  Now we define the length of our OverflowArray and initialize it. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lengthOverflowArray = baseStructure.Gates[(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>].Length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elementArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(lengthOverflowArray, maxValue);</code> </pre> <br>  In order for us to continue our structure manipulations, we need to know the number of possible variations of our OverflowArray.  For this there is a formula that was applied in the next line. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lengthOverflowArray = baseStructure.Gates[(i * <span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>].Length;</code> </pre> <br>  Next comes the nested loop in which all the ‚Äúmagic‚Äù occurs and for which all this preface was. At the very beginning, we produce an increase in the values ‚Äã‚Äãof our array. <br><br><pre> <code class="cs hljs">elementArray.Increase();</code> </pre><br>  After that we see a validation check, as a result of which we move on or on to the next iteration. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (modification == StructureModification.Branching || modification == StructureModification.All) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!CheckOverflowArrayForAllConnection(elementArray, branchingSign, lengthOverflowArray)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } }</code> </pre><br>  If the validation of the array passes the test, then we clone our basic structure.  Cloning is necessary, since we will modify our structure for many more iterations. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Clone CircuitStructure var structure = (CircuitStructure) baseStructure.Clone(); ConfigureInputs(lines, structure.Conductors, structure.Gates); var sources = AddSourcesLayer(structure.Conductors, maxElementsInLine); var finalElement = AddFinalElement(structure.Conductors); structure.Sources = sources; structure.FinalDevice = finalElement;</span></span></code> </pre> <br>  And finally, we proceed to the modification of the structure and its cleaning of unnecessary elements.  Unnecessary they became as a result of the modification of the structure. <br><br><pre> <code class="cs hljs">ModifyStructure(structure, elementArray, key, modification); ClearStructure(structure);</code> </pre> <br>  I don‚Äôt see the point of disassembling dozens of minor functions that are performed ‚Äúsomewhere out there‚Äù in depth. <br><br><h4>  VariantsGenerator </h4><br>  The structure + elements that should be in it is called CircuitVariant. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> CircuitVariant { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CircuitStructure Structure; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt; Gates; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt; Conductors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; Solutions; }</code> </pre> <br>  The first field is a link to the structure.  The second two dictionaries in which the key is the layer number, and the value is an array that contains the element numbers in their places in the structure. <br><br>  We proceed to the selection of combinations.  We may have a certain number of valid logic elements and conductors.  Total logical elements can be 6 a conductors 2. <br>  You can imagine a number system with a base of 6 and in each digit get numbers that correspond to the elements.  Thus, by increasing this hexadecimal number, you can loop through all combinations of elements. <br><br>  That is, a hexadecimal number of three digits will be 3 elements.  It is only worth considering that the number of elements not 6 and 4 can be transferred. <br><br>  For the discharge of such a number, I defined the structure <br><a name="ClampedInt"></a><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> ClampedInt { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = Mathf.Clamp(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, MaxValue); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MaxValue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampedInt</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxValue</span></span></span><span class="hljs-function">)</span></span> { MaxValue = maxValue; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryIncrease</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Value + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= MaxValue) { Value++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// overflow return true; } }</span></span></code> </pre> <br><a name="OverflowArray"></a><br>  Next is a class with a strange name <b>OverflowArray</b> .  Its essence is that it stores the <b><a href="https://habr.com/ru/post/453564/">ClampedInt</a></b> array and increases the most significant bit if an overflow has occurred in the <b><a href="https://habr.com/ru/post/453564/">low</a></b> -order bit and so on until it reaches the maximum value in all the cells. <br><br>  In accordance with each ClampedInt, the values ‚Äã‚Äãof the corresponding ElectricalElementContainer are set.  This way you can sort through all possible combinations.  It should be noted that if it is necessary to generate a circuit with elements (for example, And (0) and Xor (4)), it is not necessary to go through all the options including the elements 1,2,3.  For this, during generation, the elements get their local numbers (for example, And = 0, Xor = 1), and then they are converted back to global numbers. <br><br>  So you can iterate through all possible combinations in all elements. <br><br>  After the values ‚Äã‚Äãin the containers are set, the schema is checked for solutions for it, using <b>Solver</b> .  If the scheme has passed the decision, it will be returned. <br><br>  After the circuit is generated, it checks the number of solutions.  It should not exceed the limit and should not have solutions consisting entirely of 0 or 1. <br><br><div class="spoiler">  <b class="spoiler_title">Lot of code</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IVariantsGenerator</span></span> { <span class="hljs-function"><span class="hljs-function">IEnumerable&lt;CircuitVariant&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;CircuitStructure&gt; structures, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNot, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">.MaxValue</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">VariantsGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IVariantsGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ISolver solver; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IElementsProvider elementsProvider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VariantsGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISolver solver, IElementsProvider elementsProvider</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.solver = solver; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.elementsProvider = elementsProvider; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IEnumerable&lt;CircuitVariant&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;CircuitStructure&gt; structures, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNot, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions = </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">.MaxValue</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> manyGates = availableGates.Count &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableLeToGeneralNumber = GetDictionaryFromAllowedElements(elementsProvider.Gates, availableGates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gatesList = GetElementsList(availableLeToGeneralNumber, elementsProvider.Gates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableConductorToGeneralNumber = useNot ? GetDictionaryFromAllowedElements(elementsProvider.Conductors, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}) : GetDictionaryFromAllowedElements(elementsProvider.Conductors, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>[] {<span class="hljs-number"><span class="hljs-number">0</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductorsList = GetElementsList(availableConductorToGeneralNumber, elementsProvider.Conductors); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> structure <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> structures) { InitializeCircuitStructure(structure, gatesList, conductorsList); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gates = GetListFromLayersDictionary(structure.Gates); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductors = GetListFromLayersDictionary(structure.Conductors); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gatesArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(gates.Count, availableGates.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> conductorsArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OverflowArray(conductors.Count, useNot ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (useNot &amp;&amp; conductorsArray.EqualInts) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } SetContainerValuesAccordingToArray(conductors, conductorsArray); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (manyGates &amp;&amp; gatesArray.Length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; gatesArray.EqualInts) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } SetContainerValuesAccordingToArray(gates, gatesArray); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> solutions = solver.GetSolutions(structure.FinalDevice, structure.Sources); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (solutions.Any() &amp;&amp; solutions.Count &lt;= maxSolutions &amp;&amp; !(solutions.Any(s =&gt; s.All(b =&gt; b)) || solutions.Any(s =&gt; s.All(b =&gt; !b)))) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variant = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CircuitVariant { Conductors = GetElementsNumberFromLayers(structure.Conductors, availableConductorToGeneralNumber), Gates = GetElementsNumberFromLayers(structure.Gates, availableLeToGeneralNumber), Solutions = solutions, Structure = structure }; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> variant; } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!gatesArray.Increase()); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (useNot &amp;&amp; !conductorsArray.Increase()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeCircuitStructure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CircuitStructure structure, IList&lt;Func&lt;IElectricalElement&gt;&gt; gates, IList&lt;Func&lt;IElectricalElement&gt;&gt; conductors</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lElements = GetListFromLayersDictionary(structure.Gates); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> lElements) { item.SetElements(gates); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cElements = GetListFromLayersDictionary(structure.Conductors); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cElements) { item.SetElements(conductors); } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IList&lt;Func&lt;IElectricalElement&gt;&gt; GetElementsList(IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; availableToGeneralGate, IReadOnlyList&lt;Func&lt;IElectricalElement&gt;&gt; elements) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Func&lt;IElectricalElement&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> availableToGeneralGate) { list.Add(elements[item.Value]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDictionaryFromAllowedElements</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IReadOnlyCollection&lt;Func&lt;IElectricalElement&gt;&gt; allElements, IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableElements</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enabledDic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(allElements.Count); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; allElements.Count; i++) { enabledDic.Add(i, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> availableElements) { enabledDic[item] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> availableToGeneralNumber = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enabledDic) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.Value) { availableToGeneralNumber.Add(index, item.Key); index++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> availableToGeneralNumber; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetContainerValuesAccordingToArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IReadOnlyList&lt;ElectricalElementContainer&gt; containers, IOverflowArray overflowArray</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; containers.Count; i++) { containers[i].SetType(overflowArray[i].Value); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IReadOnlyList&lt;ElectricalElementContainer&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetListFromLayersDictionary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, ElectricalElementContainer[]&gt; layers</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ElectricalElementContainer&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> layers) { elements.AddRange(layer.Value); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> elements; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt; GetElementsNumberFromLayers(IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, ElectricalElementContainer[]&gt; layers, IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; elementIdToGlobal = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dic = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]&gt;(layers.Count); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> convert = elementIdToGlobal != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> layer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> layers) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[layer.Value.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; layer.Value.Length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!convert) { values[i] = layer.Value[i].SelectedType; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { values[i] = elementIdToGlobal[layer.Value[i].SelectedType]; } } dic.Add(layer.Key, values); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dic; } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each of the generators returns its own variant using the yield operator. </font><font style="vertical-align: inherit;">Thus, CircuitGenerator using the StructureGenerator and the VariantsGenerator generates an IEnumerable. (The yield approach helped well in the future, see below). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Following from the fact that the variant generator gets a list of structures. </font><font style="vertical-align: inherit;">You can generate variants for each structure independently. </font><font style="vertical-align: inherit;">This could be parallelized, but adding AsParallel did nothing (probably yield prevents). </font><font style="vertical-align: inherit;">Manually parallelizing will be a long time, therefore we reject this option. </font><font style="vertical-align: inherit;">Actually, I tried to do parallel generation, it worked, but there were some difficulties, therefore it did not go to the repository.</font></font><br><br><a name="GameClasses"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Game classes </font></font></h3><br><a name="Approach"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Development Approach and DI </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The project is built under </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependency Injection</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (DI). </font><font style="vertical-align: inherit;">This means that classes can simply claim to themselves some object corresponding to the interface and not create this object. </font><font style="vertical-align: inherit;">What are the advantages:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The place of creation and initialization of the dependency object is defined in one place and is separated from the logic of the dependent classes, which removes duplication of code. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Eliminates the need to dig out the entire dependency tree and instantiate all dependencies. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Allows you to easily change the implementation of the interface, which is used in many places. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Like a DI container in a project, </font></font><a href="http://"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zenject is</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zenject has several contexts, I use only two of them:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The project context is the registration of dependencies throughout the entire application. </font></font></li><li>  :                . </li><li>       ,        .      </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registration of classes is stored in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . For the context of the project, I use </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ScriptableObjectInstaller</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and for the context of the scene - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MonoInstaller</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Most of the classes I register are AsSingle, since they do not contain states, rather they are simply containers for methods. AsTransient I use for classes where there is an internal state that should not be common to other classes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, you need to somehow create MonoBehaviour classes that will represent these elements. Classes associated with Unity, I also singled out a separate project dependent on the Core project.</font></font><br><br><img src="https://habrastorage.org/webt/eg/s1/se/egs1seui5csmxylqk9we7qhedwc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For MonoBehaviour classes, I prefer to create my own interfaces. </font><font style="vertical-align: inherit;">This, in addition to the standard advantages of interfaces, allows you to hide a very large number of members of MonoBehaviour. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For convenience, DI often create a simple class that performs all the logic, and MonoBehaviour a wrapper for it. </font><font style="vertical-align: inherit;">For example, the class has Start and Update methods, I create such methods in the class, then in the MonoBehaviour class I add a dependency field and in the corresponding methods I call Start and Update. </font><font style="vertical-align: inherit;">This gives the ‚Äúcorrect‚Äù injection into the constructor, the detachment of the main class from the DI container and the ability to easily test.</font></font><br><br><a name="Config"></a><h4>  Configuration </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By configuration, I mean data common to the whole application. </font><font style="vertical-align: inherit;">In my case, these are prefabs, identifiers for advertising and shopping, tags, scene names, etc. </font><font style="vertical-align: inherit;">For these purposes, I use ScriptableObjects:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For each data group, the class is derived from ScriptableObject. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It creates the necessary serializable fields. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Properties are added to read from these fields. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The interface with the above fields is highlighted. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The class is registered to the interface in a DI container. </font></font></li><li>  Profit </li></ol><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ITags</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FixedColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BackgroundColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ForegroundColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AccentedColor { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } [CreateAssetMenu(fileName = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Tags), menuName = <span class="hljs-string"><span class="hljs-string">"Configuration/"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(Tags))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Tags</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObject</span></span>, <span class="hljs-title"><span class="hljs-title">ITags</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fixedColor; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> backgroundColor; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> foregroundColor; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> accentedColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FixedColor =&gt; fixedColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> BackgroundColor =&gt; backgroundColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ForegroundColor =&gt; foregroundColor; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> AccentedColor =&gt; accentedColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { fixedColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(fixedColor)); backgroundColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(backgroundColor)); foregroundColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(foregroundColor)); accentedColor.AssertNotEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(accentedColor)); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To configure a separate installer (code abbreviated): </font></font><br><br><pre> <code class="cs hljs">CreateAssetMenu(fileName = <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(ConfigurationInstaller), menuName = <span class="hljs-string"><span class="hljs-string">"Installers/"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(ConfigurationInstaller))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConfigurationInstaller</span></span> : <span class="hljs-title"><span class="hljs-title">ScriptableObjectInstaller</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ConfigurationInstaller</span></span>&gt; { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditorElementsPrefabs editorElementsPrefabs; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LevelCompletionSteps levelCompletionSteps; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CommonValues commonValues; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AdsConfiguration adsConfiguration; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CutscenesConfiguration cutscenesConfiguration; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Colors colors; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Tags tags; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InstallBindings</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Container.Bind&lt;IEditorElementsPrefabs&gt;().FromInstance(editorElementsPrefabs).AsSingle(); Container.Bind&lt;ILevelCompletionSteps&gt;().FromInstance(levelCompletionSteps).AsSingle(); Container.Bind&lt;ICommonValues&gt;().FromInstance(commonValues).AsSingle(); Container.Bind&lt;IAdsConfiguration&gt;().FromInstance(adsConfiguration).AsSingle(); Container.Bind&lt;ICutscenesConfiguration&gt;().FromInstance(cutscenesConfiguration).AsSingle(); Container.Bind&lt;IColors&gt;().FromInstance(colors).AsSingle(); Container.Bind&lt;ITags&gt;().FromInstance(tags).AsSingle(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { editorElementsPrefabs.AssertNotNull(); levelCompletionSteps.AssertNotNull(); commonValues.AssertNotNull(); adsConfiguration.AssertNotNull(); cutscenesConfiguration.AssertNotNull(); colors.AssertNOTNull(); tags.AssertNotNull(); } }</code> </pre> <br><a name="GameElectricalElements"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Electrical items </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we need to somehow introduce electrical elements. </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IElectricalElementMb</span></span> { GameObject GameObject { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IOutputConnectorMb[] OutputConnectorsMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IInputConnectorMb[] InputConnectorsMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } Transform Transform { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetInputConnectorsMb</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">InputConnectorMb[] inputConnectorsMb</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetOutputConnectorsMb</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">OutputConnectorMb[] outputConnectorsMb</span></span></span><span class="hljs-function">)</span></span>; } [DisallowMultipleComponent] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElectricalElementMb</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElementMb</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OutputConnectorMb[] outputConnectorsMb; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> InputConnectorMb[] inputConnectorsMb; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform Transform =&gt; transform; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject GameObject =&gt; gameObject; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; name; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IElectricalElement Element { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOutputConnectorMb[] OutputConnectorsMb =&gt; outputConnectorsMb; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IInputConnectorMb[] InputConnectorsMb =&gt; inputConnectorsMb; }</code> </pre> <br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Provide additional data to be able to configure it after manual install. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public interface IElectricalElementMbEditor : IElectricalElementMb { ElectricalElementType Type { get; } } public class ElectricalElementMbEditor : ElectricalElementMb, IElectricalElementMbEditor { [SerializeField] private ElectricalElementType type; public ElectricalElementType Type =&gt; type; }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IInputConnectorMb</span></span> : <span class="hljs-title"><span class="hljs-title">IConnectorMb</span></span> { IOutputConnectorMb OutputConnectorMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } IInputConnector InputConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputConnectorMb</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IInputConnectorMb</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OutputConnectorMb outputConnectorMb; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Transform Transform =&gt; transform; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IOutputConnectorMb OutputConnectorMb { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> =&gt; outputConnectorMb; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; outputConnectorMb = (OutputConnectorMb) <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IInputConnector InputConnector { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InputConnector(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> UNITY_EDITOR private void OnDrawGizmos() { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (outputConnectorMb != null) { Handles.DrawLine(transform.position, outputConnectorMb.Transform.position); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We have the line public IElectricalElement Element {get; </font><font style="vertical-align: inherit;">set;</font></font> } <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But how to install this item? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A good option would be to make generic: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public class ElectricalElementMb: MonoBehaviour, IElectricalElementMb where T: IElectricalElement </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But here‚Äôs the catch that Unity does not support generic MonoBehaviour classes. Moreover, Unity does not support the serialization of properties and interfaces. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, in runtime, it is quite possible to pass in an IElectricalElement Element {get; set;</font></font> } <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desired value. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I made enum ElectricalElementType in which there will be all necessary types. </font><font style="vertical-align: inherit;">Enum is well serialized by Unity and is beautifully displayed in the Inspector as a drop-down list. </font><font style="vertical-align: inherit;">Defined two kinds of element: which is created in runtime and which is created in the editor and can be saved. </font><font style="vertical-align: inherit;">Thus, there is IElectricalElementMb and IElectricalElementMbEditor, which additionally contains a field of type ElectricalElementType. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second type also needs to be initialized in runtime. </font><font style="vertical-align: inherit;">To do this, there is a class that at the start will bypass all the elements and initializes them depending on the type in the enum field. </font><font style="vertical-align: inherit;">In the following way:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;ElectricalElementType, Func&lt;IElectricalElement&gt;&gt; ElementByType = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;ElectricalElementType, Func&lt;IElectricalElement&gt;&gt; { {ElectricalElementType.And, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> And()}, {ElectricalElementType.Or, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Or()}, {ElectricalElementType.Xor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xor()}, {ElectricalElementType.Nand, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nand()}, {ElectricalElementType.Nor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Nor()}, {ElectricalElementType.NOT, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NOT()}, {ElectricalElementType.Xnor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Xnor()}, {ElectricalElementType.Source, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Source()}, {ElectricalElementType.Conductor, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Conductor()}, {ElectricalElementType.Placeholder, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AlwaysFalse()}, {ElectricalElementType.Encoder, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Encoder()}, {ElectricalElementType.Decoder, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Decoder()} };</code> </pre> <br><a name="GameManagement"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Game management </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, the question arises, where to locate the logic of the game itself (checking the conditions of passage, counting the readings of the passage and helping the player)? .. There are also questions about the location of the logic for saving and loading progress, settings and other things. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For this, I single out certain classes of managers who are responsible for a certain class of tasks. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DataManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is responsible for storing the data of the results of the user's passage and setting up the game. It is registered by AsSingle in the context of the project. This means that it is one for the entire application. While the application is running, data is stored directly in memory, inside the DataManager. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It uses the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFileStoreService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which is responsible for loading and saving data and the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IFileSerializer</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">responsible for serializing files into a ready-made view for saving. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a game manager in a single scene. </font></font><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I got it a little GodObject, since he is still responsible for the UI, that is, opening and closing the menu, the reaction to the buttons. But it is permissible, given the size of the project and the absence of the need to expand it. The sequence of actions is even simpler and more clearly visible.</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There are two options. They are called </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for mode 1 and 2, respectively. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the first case, the logic is based on the reaction to a value change event in one of the Sources and checking the value at the output of the circuit.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the second case, the logic responds to the element change event and also checks the values ‚Äã‚Äãat the output of the circuit. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are some data of the current level, such as the level number and player assistance. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data about the current level is stored in </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CurrentLevelData</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The level number is stored there - a boolean property with a check for help, a flag to evaluate the game and data to help the player.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICurrentLevelData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LevelNumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HelpExist { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> ProposeRate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICurrentLevelDataMode1</span></span> : <span class="hljs-title"><span class="hljs-title">ICurrentLevelData</span></span> { IEnumerable&lt;SourcePositionValueHelp&gt; PartialHelp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICurrentLevelDataMode2</span></span> : <span class="hljs-title"><span class="hljs-title">ICurrentLevelData</span></span> { IEnumerable&lt;PlaceTypeHelp&gt; PartialHelp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The help for the first mode is the source numbers and values ‚Äã‚Äãon them. In the second mode, this is the type of element to be installed in the cell. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The collection contains structures that store the position and the value that needs to be set at the specified position. A dictionary would be more beautiful, but Unity cannot serialize dictionaries. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Differences scenes of different modes are that in the context of the scene set another </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelGameManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and another </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICurrentLevelData</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, I have an event-oriented approach to the connection of elements. </font><font style="vertical-align: inherit;">On the one hand, it is logical and convenient. </font><font style="vertical-align: inherit;">On the other hand, it is possible to get problems without unsubscribing when necessary. </font><font style="vertical-align: inherit;">Nevertheless, there were no problems in this project, and the scale was not too large. </font><font style="vertical-align: inherit;">Usually subscription occurs during the start of the scene for everything you need. </font><font style="vertical-align: inherit;">In runtime, almost nothing is created, so there is no confusion.</font></font><br><br><a name="LevelsLoading"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Loading levels </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Each level in the game is represented by a Unity-scene, it necessarily contains a level prefix and a number, for example ‚ÄúLevel23‚Äù. </font><font style="vertical-align: inherit;">The prefix is ‚Äã‚Äãincluded in the configuration. </font><font style="vertical-align: inherit;">Level loading occurs by name, which is formed from the prefix. </font><font style="vertical-align: inherit;">Thus, the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LevelsManager</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class </font><font style="vertical-align: inherit;">can load levels by number.</font></font><br><br><a name="Cutscenes"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cutscenes </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The cutscenes are common unity scenes with numbers in the title, similar to levels. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The animation itself is implemented using Timeline. </font><font style="vertical-align: inherit;">Unfortunately, I don‚Äôt have any animation skills or the ability to work with the Timeline, so ‚Äúdo not shoot the pianist - he plays as he can‚Äù. </font></font><br><br><img src="https://habrastorage.org/webt/h8/ny/rf/h8nyrfwesvjp8v6kmy70tcfiduc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It turned out that one logical cutscene should consist of different scenes with different objects. </font><font style="vertical-align: inherit;">It turned out that it was noticed a little late, but it was decided simply: by locating parts of the cutscenes in different places on the stage and instantly moving the camera.</font></font><br><br><img src="https://habrastorage.org/webt/s1/jq/jc/s1jqjces_osngyiexu03i3inrlk.png"><br><br><a name="AdditionalGameplay"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Extra gameplay </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The game is evaluated by the number of actions at the level and the use of hints. The less action the better. Using the tooltip reduces the maximum rating to 2 stars, skipping a level to 1 star. To assess the passage is stored the number of steps to pass. It consists of two values: the minimum value (for 3 stars) and maximum (1 star). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The number of steps to complete the levels is not stored in the scene file itself, but in the configuration file, since you need to display the number of stars for the passed level. This complicated the process of creating levels a little. It was especially interesting to see changes in the version control system: </font></font><br><br><img src="https://habrastorage.org/webt/fl/uc/4q/fluc4q2iu7946a11fywzat8afck.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Try to guess what level it belongs to. It was possible to store the dictionary of course, but it is not firstly serialized by Unity, and secondly it would have to manually set the numbers.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If a player is difficult to pass a level, he can get a hint - the correct values ‚Äã‚Äãon some inputs, or the correct element in the second mode. This was also done manually, although it could be automated. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the player‚Äôs help did not help, he can completely skip the level. In case of missing a level, a player gets 1 star for it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A user who has passed a level with a hint cannot rewrite it for a while, so that it would be difficult to re-level the level with fresh memory, as if without a hint.</font></font><br><br><a name="Monetization"></a><h4>  monetization </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The game has two types of monetization: the display of advertising and disabling advertising for money. An ad impression includes displaying advertisements between levels and viewing rewarded advertisements to skip a level. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the player is willing to pay for disabling advertising, he can do it. In this case, ads between the levels and when skipping the level will not be displayed. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For advertising created a class called </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AdsService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , with the interface</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IAdsService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> AdsDisabled { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadBetweenLevelAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowBetweenLevelAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> level, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> force = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">false</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadHelpAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action onLoaded = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowHelpAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Action onRewarded, Action onClosed</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> HelpAdLoaded { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HelpAd is a rewarding ad for level skipping. Initially, we called help partial and full help. Partial is a hint, and complete is a level skip. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This class contains within the limitation of the frequency of display of advertising on time, after the first launch of the game. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The implementation uses the </font></font><a href="https://github.com/googleads/googleads-mobile-unity"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Mobile Ads Unity Plugin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With rewarded advertising, I stepped on a rake - it turns out that devotees can be called in another thread, it‚Äôs not very clear why. Therefore, it is better that those delegates would not call anything in the code associated with Unity. In the event that a purchase has been made to disable advertising, the advertising will not be displayed and the delegate of the successful display of advertising will be executed immediately. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is an interface for shopping.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPurchaseService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsAdsDisablePurchased { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action DisableAdsPurchased; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BuyDisableAds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveDisableAd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The implementation uses </font></font><a href="https://docs.unity3d.com/Manual/UnityIAP.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity IAP</font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> With the purchase of disabling advertising there is a trick. </font><font style="vertical-align: inherit;">Google Play does not seem to provide information about what the player has bought some kind of purchase. </font><font style="vertical-align: inherit;">Just come confirmation that it passed once. </font><font style="vertical-align: inherit;">But if you put the product status after the purchase is not </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Complete,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> but </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pending,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> this will allow you to check the property of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasReceipt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> product </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">If it is true then the purchase was made. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although of course this approach confuses me. I suspect that all may not be going smoothly. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The RemoveDisableAd method is needed at the time of testing, it removes the purchased disable advertising.</font></font><br><br><a name="UI"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> User interface </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All interface elements work in accordance with the event-oriented approach. </font><font style="vertical-align: inherit;">The interface elements themselves usually do not contain logic except events caused by public methods that Unity can use. </font><font style="vertical-align: inherit;">Although it also happens to perform certain duties related only to the interface.</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UiElementBase</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">IUiElement</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action ShowClick; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action HideCLick; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Show</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gameObject.SetActive(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); ShowClick?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hide</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gameObject.SetActive(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); HideCLick?.Invoke(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PauseMenu</span></span> : <span class="hljs-title"><span class="hljs-title">UiElementEscapeClose</span></span>, <span class="hljs-title"><span class="hljs-title">IPauseMenu</span></span> { [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Text levelNumberText; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LocalizedText finishedText; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GameObject restartButton; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> levelNumber; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action GoToMainMenuClick; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action RestartClick; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LevelNumber { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> =&gt; levelNumberText.text = <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{finishedText.Value}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class="hljs-string">"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisableRestartButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { restartButton.SetActive(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToMainMenu</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GoToMainMenuClick?.Invoke(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Restart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { RestartClick?.Invoke(); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, this is not always the case. </font><font style="vertical-align: inherit;">For good, you should leave these elements as active View, make an event listener from it, something like a controller that will trigger the necessary actions on the managers.</font></font><br><br><a name="Analytics"></a><h4>  Analytics </h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Along the path of least resistance, an </font></font><a href="https://docs.unity3d.com/Manual/UnityAnalytics.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analyst from Unity</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> was chosen </font><font style="vertical-align: inherit;">. Easy to implement, although limited to a free subscription - it‚Äôs impossible to export raw data. There is also a limit on the number of events - 100 / hour per player. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For analytics, created a wrapper class </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AnalyticsService</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . It has methods for each type of event, receives the necessary parameters, and causes the event to be sent using tools built into Unity. Creating a method for each event is certainly not the best practice in general, but in a deliberately small project it is better than doing something big and complicated. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All used events are </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CustomEvent.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">They are built from the name of the event and the dictionary parameter name and value. </font><font style="vertical-align: inherit;">AnalyticsService gets the necessary values ‚Äã‚Äãfrom the parameters and creates a dictionary inside. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All the names of events and parameters are in constants. </font><font style="vertical-align: inherit;">Not in the form of a traditional approach with ScriptableObject, since these values ‚Äã‚Äãshould never change. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example method:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LevelComplete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> number, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stars, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> actionCount, TimeSpan timeSpent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> levelMode</span></span></span><span class="hljs-function">)</span></span> { CustomEvent(LevelCompleteEventName, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; { {LevelNumber, number}, {LevelStars, stars}, {LevelActionCount, actionCount}, {LevelTimeSpent, timeSpent}, {LevelMode, levelMode} }); }</code> </pre> <br><a name="CameraAlign"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Camera positioning and diagrams </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The task is to position FinalDevice at the top of the screen, at the same distance from the upper boundary, and Sources from the bottom is also always at an equal distance from the lower boundary. </font><font style="vertical-align: inherit;">In addition, the screens come in different aspect ratios; you need to adjust the size of the camera before starting the level so that it can fit the circuit correctly. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For this, the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CameraAlign</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> class is </font><b><font style="vertical-align: inherit;">created</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Algorithm for determining the size:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Find all the items you want on stage </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Find the minimum width and height based on the aspect ratio </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Determine camera size </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Set the camera in the center </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Move FinalDevice to the top edge of the screen </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Move sources to the bottom edge of the screen. </font></font></li></ol><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CameraAlign</span></span> : <span class="hljs-title"><span class="hljs-title">ICameraAlign</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ISceneObjectsHelper sceneObjectsHelper; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICommonValues commonValues; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CameraAlign</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISceneObjectsHelper sceneObjectsHelper, ICommonValues commonValues</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sceneObjectsHelper = sceneObjectsHelper; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.commonValues = commonValues; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Align</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Camera camera</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elements = sceneObjectsHelper.FindObjectsOfType&lt;IElectricalElementMb&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> finalDevice = sceneObjectsHelper.FindObjectOfType&lt;IFinalDevice&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = elements.OfType&lt;ISourceMb&gt;().ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (finalDevice != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sources.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> leftPos = elements.Min(s =&gt; s.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rightPos = elements.Max(s =&gt; s.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> width = Mathf.Abs(leftPos - rightPos); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fPos = finalDevice.Transform.position; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> height = Mathf.Abs(sources.First().Transform.position.y - fPos.y) * camera.aspect; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> size = Mathf.Max(width * commonValues.CameraOffset, height * commonValues.CameraOffset); camera.orthographicSize = Mathf.Clamp(size, commonValues.MinCameraSize, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>.MaxValue); camera.transform.position = GetCenterPoint(elements, <span class="hljs-number"><span class="hljs-number">-1</span></span>); fPos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(fPos.x, camera.ScreenToWorldPoint(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(Screen.width, Screen.height)).y - commonValues.FinalDeviceTopOffset * camera.orthographicSize); finalDevice.Transform.position = fPos; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sourceY = camera.ScreenToWorldPoint(Vector2.zero).y + commonValues.SourcesBottomOffset; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sources) { item.Transform.position = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(item.Transform.position.x, sourceY); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.Log(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">nameof</span></span></span></span><span class="hljs-string"><span class="hljs-subst">(CameraAlign)}</span></span></span><span class="hljs-string">: No final device or no sources in scene"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCenterPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICollection&lt;IElectricalElementMb&gt; elements, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> top = elements.Max(e =&gt; e.Transform.position.y); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bottom = elements.Min(e =&gt; e.Transform.position.y); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> left = elements.Min(e =&gt; e.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> right = elements.Max(e =&gt; e.Transform.position.x); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = left + ((right - left) / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = bottom + ((top - bottom) / <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(x, y, z); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This method is called when a scene is started in a wrapper class. </font></font><br><br><a name="Colors"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Color schemes </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the game will have a very primitive interface decided to make it with two color schemes, black and white. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To do this, create an interface</font></font><br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IColors</span></span> { Color ColorAccent { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } Color Background { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } Color Foreground { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> Action ColorsChanged; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Colors can be set right in the Unity editor; this can be used for testing. Then you can switch them and have two sets of colors. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The colors of Background and Foreground can change, the color accent is one in any mode. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the player can set a non-standard theme, the color data should be stored in the settings file. If the settings file did not contain color data, they are filled with standard values. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then there are several classes: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CameraColorAdjustment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - responsible for setting the background color on the camera, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UiColorAdjustment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - setting the colors of the interface elements and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TextMeshColorAdjustment</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- sets the color of the numbers on the sources. </font><font style="vertical-align: inherit;">UiColorAdjustment also uses tags. </font><font style="vertical-align: inherit;">In the editor, you can mark each element with a tag, which will mean what type of color to set for it (Background, Foreground, AccentColor and FixedColor). </font><font style="vertical-align: inherit;">This is all set at the start of the scene or the event of a change in color scheme.</font></font><br><br>  Result: <br><br><img src="https://habrastorage.org/webt/jk/6o/zz/jk6ozzdaz6h8ixxrykmnocrtgze.png"><br><br><img src="https://habrastorage.org/webt/kl/4d/u6/kl4du6hxim70hyncofiakaiqsi4.png"><br><br><a name="Editor"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Editor extensions </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To simplify and speed up the development process, it is often necessary to create the necessary tool that is not provided by standard editor tools. </font><font style="vertical-align: inherit;">The traditional approach in Unity is to create the derived class EditorWindow. </font><font style="vertical-align: inherit;">There is also an approach with UiElements, but it is still in the development process, so I decided to use the traditional approach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you simply create a class that uses something from the UnityEditor namespace next to other classes for the game, then the project simply does not build up, since this namespace is not available in the build. </font><font style="vertical-align: inherit;">There are several solutions:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Select a separate project for editor scripts </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Place files in the Assets / Editor folder </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wrap these files in #if UNITY_EDITOR </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The project uses the first approach and sometimes #if UNITY_EDITOR if necessary in the class that is required in the build, add a small part for the editor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All classes that are needed only in the editor I defined in the assembly, which will be available only in the editor. </font><font style="vertical-align: inherit;">In the build of the game she will not go. </font></font><br><br><img src="https://habrastorage.org/webt/-u/yv/ie/-uyviepp1z3u4aal0mgbzlothxg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It would be nice to have DI in your editor extensions now. </font><font style="vertical-align: inherit;">For this, I use Zenject.StaticContext. </font><font style="vertical-align: inherit;">In order to set it in the editor, a class with an InitializeOnLoad attribute is used, in which there is a static constructor.</font></font><br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">InitializeOnLoad</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EditorInstaller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditorInstaller</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = StaticContext.Container; container.Bind&lt;IElementsProvider&gt;().To&lt;ElementsProvider&gt;().AsSingle(); container.Bind&lt;ISolver&gt;().To&lt;Solver&gt;().AsSingle(); .... } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To register ScriptableObject-classes in a static context, I use the following code: </font></font><br><br><pre> <code class="cs hljs">BindFirstScriptableObject&lt;ISceneNameConfiguration, SceneNameConfiguration&gt;(container); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BindFirstScriptableObject&lt;TInterface, TImplementation&gt;(DiContainer container) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TImplementation : ScriptableObject, TInterface { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = GetFirstScriptableObject&lt;TImplementation&gt;(); container.Bind&lt;TInterface&gt;().FromInstance(obj).AsSingle(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T GetFirstScriptableObject&lt;T&gt;() <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : ScriptableObject { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> guids = AssetDatabase.FindAssets(<span class="hljs-string"><span class="hljs-string">"t:"</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T).Name); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> path = AssetDatabase.GUIDToAssetPath(guids.First()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = AssetDatabase.LoadAssetAtPath&lt;T&gt;(path); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TImplementation is required only for this line. AssetDatabase.LoadAssetAtPath (path) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You cannot put the dependency into the constructor. </font><font style="vertical-align: inherit;">Instead, add the [Inject] attribute to the window class in the dependency fields and call </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StaticContext.Container.Inject (this) </font><font style="vertical-align: inherit;">when starting the window </font><font style="vertical-align: inherit;">; </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I also recommend adding to the window update cycle a check for null of one of the dependency fields and, if the field is empty, perform the above line. </font><font style="vertical-align: inherit;">Because after changing the code in a project, Unity may re-create the window and not cause Awake on it.</font></font><br><br><a name="GeneratorWindow"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Generator </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><img src="https://habrastorage.org/webt/4i/cp/ud/4icpudizv2-8r-bwrbkk3bva8kq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The initial view of the generator. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The window should provide the interface for generating a list of schemes with indication of parameters, display the list of schemes and locate the selected scheme in the current scene. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The window consists of three sections from left to right:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> generation settings </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> list of options in the form of buttons </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> text selection </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The columns are created using EditorGUILayout.BeginVertical () and EditorGUILayout.EndVertical (). Unfortunately, it was not possible to fix and limit the dimensions, but this is not so critical. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It turned out that the generation process on a large number of circuits is not so fast. A lot of combinations are obtained with elements I. As the profiler showed, the circuit itself is the slowest part. Parallelizing it is not an option, one scheme is used for all variants, and cloning this structure is difficult.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then I thought that probably all the code extensions editor works in Debug mode. Under Release, debugging does not go well, breakpoints do not stop, lines are skipped, etc. Indeed, having measured the performance, it turned out that the speed of the generator in Unity corresponds to the Debug build launched from the console application, and this is ~ 6 times slower than Release. Keep this in mind. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As an option, you can make an external assembly and add it to the Unity DLL with an assembly, but this greatly complicates the assembly and editing of the project. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immediately I passed the generation process to a separate Task with a code containing the following: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">circuitGenerator.Generate (lines, maxElementsInLine, availableLogicalElements, useNOT, modification) .ToList ()</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Already better, though the editor does not hang at the time of generation. </font><font style="vertical-align: inherit;">But it is still necessary to wait a long time, for several minutes (more than 20 minutes on large schemes). </font><font style="vertical-align: inherit;">Plus, there is a problem that the task is not so easy to complete and it continues to work until the generation is completed.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lot of code</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Ext</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;CircuitVariant&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IEnumerable&lt;CircuitVariant&gt; circuitVariants</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> circuitVariants.OrderBy(a =&gt; a.Solutions.Count()) .ThenByDescending(a =&gt; a.Solutions .Select(b =&gt; b.Sum(i =&gt; i ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">-1</span></span>)) .OrderByDescending(b=&gt;b) .First()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IEditorGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { CircuitVariant[] FilteredVariants { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LastPage { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FilterVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> page</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxElementsInLine, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNOT, StructureModification? modification, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EditorGenerator</span></span> : <span class="hljs-title"><span class="hljs-title">IEditorGenerator</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> PageSize = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> ICircuitGenerator circuitGenerator; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ConcurrentBag&lt;CircuitVariant&gt; variants; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CircuitVariant&gt; sortedVariants; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Thread generatingThread; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EditorGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICircuitGenerator circuitGenerator</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.circuitGenerator = circuitGenerator; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { generatingThread?.Abort(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CircuitVariant[] FilteredVariants { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LastPage { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FilterVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> page</span></span></span><span class="hljs-function">)</span></span> { CheckVariants(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sortedVariants == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Fetch(); } FilteredVariants = sortedVariants.Skip(page * PageSize) .Take(PageSize) .ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = sortedVariants.Count; LastPage = count % PageSize == <span class="hljs-number"><span class="hljs-number">0</span></span> ? (count / PageSize) - <span class="hljs-number"><span class="hljs-number">1</span></span> : count / PageSize; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fetch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { CheckVariants(); sortedVariants = variants.OrderVariants() .ToList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxElementsInLine, ICollection&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; availableGates, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> useNOT, StructureModification? modification, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> maxSolutions</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (generatingThread != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Stop(); } variants = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentBag&lt;CircuitVariant&gt;(); generatingThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Thread(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = circuitGenerator.Generate(lines, maxElementsInLine, availableGates, useNOT, modification, maxSolutions); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> v) { variants.Add(item); } }); generatingThread.Start(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { generatingThread?.Abort(); sortedVariants = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; variants = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; generatingThread = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; FilteredVariants = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckVariants</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (variants == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">"VariantsGeneration is not started. Use Start before."</span></span>); } } ~EditorGenerator() { generatingThread.Abort(); } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The idea is to generate in the background, and update the internal list of sorted variants on request. Then you can choose options page by page. Thus, there is no need to sort each time, which significantly speeds up work on large lists. Schemes are sorted by ‚Äúinterestingness‚Äù: by the number of decisions, by increase and by how diverse the values ‚Äã‚Äãare required for the solution. That is, the scheme with the solution 1 1 1 1 is less interesting than 1 0 1 1. </font></font><br><br><img src="https://habrastorage.org/webt/mr/ud/aa/mrudaajqtmoetizlrvzd1muja4q.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, it turned out, without waiting for the end of the generation, to select the scheme for the level. Another plus that because of the pagination editor does not slow down like a beast.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The feature of Unity is very disturbing in that when you click on Play, the contents of the window are reset, as are all generated data. </font><font style="vertical-align: inherit;">If they were easily serializable, they could be stored as files. </font><font style="vertical-align: inherit;">Thus, you can even make caching the results of the generation. </font><font style="vertical-align: inherit;">But alas, it is difficult to serialize a complex structure where objects refer to each other. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition, I added lines to each gate like</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.Length == <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Input[<span class="hljs-number"><span class="hljs-number">0</span></span>].Value &amp;&amp; Input[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Which greatly improved performance. </font></font><br><br><a name="SolverWindow"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Solver </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When you collect the scheme in the editor, you need to be able to quickly understand whether it is solved and how many solutions it has. </font><font style="vertical-align: inherit;">For this, I created a ‚Äúsolver‚Äù window. </font><font style="vertical-align: inherit;">It provides solutions to the current scheme in the form of text. </font></font><br><br><img src="https://habrastorage.org/webt/k4/4e/pk/k44epkd08ngv_gh2rpejtr6jzkg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The logic of its ‚Äúbackend‚Äù operation:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSourcesLabel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourcesMb = sceneObjectsHelper.FindObjectsOfType&lt;SourceMb&gt;().OrderBy(s =&gt; s.name); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourcesLabelSb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sourcesMb) { sourcesLabelSb.Append(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{item.name.Replace(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"Source"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">, </span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">"Src"</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">\t"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sourcesLabelSb.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>[]&gt; FindSolutions() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> elementsMb = sceneObjectsHelper.FindObjectsOfType&lt;IElectricalElementMbEditor&gt;(); elementsConfigurator.Configure(elementsMb); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> root = sceneObjectsHelper.FindObjectOfType&lt;FinalDevice&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (root == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">"No final device in scene"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sourcesMb = sceneObjectsHelper.FindObjectsOfType&lt;SourceMb&gt;().OrderBy(s =&gt; s.name); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = sourcesMb.Select(mb =&gt; (Source) mb.Element).ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> solver.GetSolutions(root.Element, sources); }</code> </pre> <br><a name="Useful"></a><h3>  Useful </h3><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><a name="AssertHelper"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Asserthelper </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To check that values ‚Äã‚Äãare set in asses, I use extension methods that I call in OnEnable </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AssertHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IElectricalElementMbEditor elementMbEditor, ElectricalElementType expectedType</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (elementMbEditor.Type != expectedType) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Field for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{expectedType}</span></span></span><span class="hljs-string"> require element with such type, but given element is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{elementMbEditor.Type}</span></span></span><span class="hljs-string">"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AssertNOTNull&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> T obj, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fieldName = <span class="hljs-string"><span class="hljs-string">""</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(fieldName)) { fieldName = <span class="hljs-string"><span class="hljs-string">$"of type </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{</span></span><span class="hljs-keyword"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-string"><span class="hljs-subst">(T).Name}</span></span></span><span class="hljs-string">"</span></span>; } Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Field </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{fieldName}</span></span></span><span class="hljs-string"> is not installed"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertNOTEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fieldName = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(str)) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Field </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{fieldName}</span></span></span><span class="hljs-string"> is not installed"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertSceneCanBeLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Application.CanStreamedLevelBeLoaded(name)) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">$"Scene </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{name}</span></span></span><span class="hljs-string"> can't be loaded."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> name; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checking that the scene has the ability to be loaded may sometimes not pass, although the scene may be loaded. </font><font style="vertical-align: inherit;">Perhaps this is a bug in Unity. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Examples of using:</font></font><br><br><pre> <code class="cs hljs">mainMenuSceneName.AssertNOTEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(mainMenuSceneName)).AssertSceneCanBeLoaded(); levelNamePrefix.AssertNOTEmpty(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(levelNamePrefix)); editorElementsPrefabs.AssertNOTNull(); not.AssertType(ElectricalElementType.NOT); <span class="hljs-comment"><span class="hljs-comment">//     enum    </span></span></code> </pre> <br><a name="SceneObjectsHelper"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SceneObjectsHelper </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The SceneObjectsHelper class was also useful for working with scene elements: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lot of code</font></font></b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Circuit.Game.Utility</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ISceneObjectsHelper</span></span> { T[] FindObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; T FindObjectOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; T Instantiate&lt;T&gt;(T prefab) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DestroyObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Destroy&lt;T&gt;(T obj, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DestroyAllChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Transform transform</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span>; T GetComponent&lt;T&gt;(GameObject obj) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SceneObjectsHelper</span></span> : <span class="hljs-title"><span class="hljs-title">ISceneObjectsHelper</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> DiContainer diContainer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SceneObjectsHelper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DiContainer diContainer</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.diContainer = diContainer; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T GetComponent&lt;T&gt;(GameObject obj) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj.GetComponents&lt;Component&gt;().OfType&lt;T&gt;().FirstOrDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T[] FindObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (includeDisabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Resources.FindObjectsOfTypeAll(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Object)).OfType&lt;T&gt;().ToArray(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Object.FindObjectsOfType&lt;Component&gt;().OfType&lt;T&gt;().ToArray(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DestroyObjectsOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objects = includeDisabled ? Resources.FindObjectsOfTypeAll(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Object)).OfType&lt;T&gt;().ToArray() : Object.FindObjectsOfType&lt;Component&gt;().OfType&lt;T&gt;().ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> objects) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immediate) { Object.DestroyImmediate((item <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Component)?.gameObject); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Object.Destroy((item <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Component)?.gameObject); } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Destroy&lt;T&gt;(T obj, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> immediate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (immediate) { Object.DestroyImmediate(obj); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Object.Destroy(obj); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DestroyAllChildren</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Transform transform</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> childCount = transform.childCount; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; childCount; i++) { Destroy(transform.GetChild(i).gameObject); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T FindObjectOfType&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> includeDisabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (includeDisabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Resources.FindObjectsOfTypeAll(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Object)).OfType&lt;T&gt;().FirstOrDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Object.FindObjectsOfType&lt;Component&gt;().OfType&lt;T&gt;().FirstOrDefault(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Inject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { diContainer.Inject(obj); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Instantiate&lt;T&gt;(T prefab) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : Object { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = Object.Instantiate(prefab); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Component) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> components = ((Component) (<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>) obj).gameObject.GetComponents&lt;Component&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> component <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> components) { Inject(component); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Inject(obj); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj; } } }</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here some things may not be very effective where you need high performance, but they rarely cause me and do not create any influence. </font><font style="vertical-align: inherit;">But they allow you to find objects by interface, for example, which looks pretty nice.</font></font><br><br><a name="CoroutineStarter"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CoroutineStarter </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Only MonoBehaviour can launch Coroutine. </font><font style="vertical-align: inherit;">Because I created the class CoroutineStarter and registered it in the context of the scene.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICoroutineStarter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginCoroutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator routine</span></span></span><span class="hljs-function">)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CoroutineStarter</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span>, <span class="hljs-title"><span class="hljs-title">ICoroutineStarter</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BeginCoroutine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerator routine</span></span></span><span class="hljs-function">)</span></span> { StartCoroutine(routine); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to convenience, the introduction of such tools allowed to facilitate automated testing. </font><font style="vertical-align: inherit;">For example the execution of korutiny in tests:</font></font><br><br><pre> <code class="cs hljs">coroutineStarter.When(x =&gt; x.BeginCoroutine(Arg.Any&lt;IEnumerator&gt;())).Do(info =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = (IEnumerator) info[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (a.MoveNext()) { } });</code> </pre> <br><a name="Gizmo"></a><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gizmo </font></font></h4><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For the convenience of displaying invisible elements, I recommend using gizmo images that are visible only in the scene. </font><font style="vertical-align: inherit;">They make it easy to select an invisible element by clicking. </font><font style="vertical-align: inherit;">Also made the connection elements in the form of lines:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnDrawGizmos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outputConnectorMb != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Handles.DrawLine(transform.position, outputConnectorMb.Transform.position); } }</code> </pre> <br><img src="https://habrastorage.org/webt/ta/ce/d5/taced5wyeyhwkpj5vtiuvauu68s.png"><br><br><a name="Testing"></a><h3>  Testing </h3><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I wanted to squeeze the most out of automatic testing, because tests were used wherever possible and easy to use. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For Unit-tests, it is common practice to use mock-objects instead of the classes implementing the interface on which the test-class depends. For this, I used the </font></font><a href="https://nsubstitute.github.io/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSubstitute</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> library </font><font style="vertical-align: inherit;">. Than very satisfied. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity does not support NuGet, so I had to separately get the DLL, then the assembly, how the dependency is added to the AssemblyDefinition file and is used without any problems. </font></font><br><br><img src="https://habrastorage.org/webt/y-/bh/sp/y-bhsprsfvxo-j9javgdhdzzhig.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For automated testing, Unity offers TestRunner, which works with the very popular </font></font><a href="https://nunit.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NUnit</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> test framework </font><font style="vertical-align: inherit;">. From the point of view of TestRunner tests are of two types:</font></font><br><br><ul><li> EditMode ‚Äî     ,   .    Nunit .    ,    .        GameObject  Monobehaviour .   ,     EditMode . </li><li> PlayMode ‚Äî     .    </li></ul><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EditMode. In my experience, there was a lot of inconvenience and strange behavior in this mode. Nevertheless, they are convenient to automatically check the performance of the application as a whole. Also provide an honest check for code in methods such as Start, Update and the like. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlayMode tests can be described as normal NUnit tests, but there is an alternative. In PlayMode, you may need to wait some time or a certain number of frames. For this, tests should be described in a similar way to Coroutine. The return value must be IEnumerator / IEnumerable and inside, to skip time, you must use, for example:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br>  or <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return new </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForSeconds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br> <a href="https://docs.unity3d.com/ScriptReference/WaitForSeconds.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are other return values. </font></font></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Such a test needs to set the </font></font><a href="https://docs.unity3d.com/Manual/PlaymodeTestFramework.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnityTest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> attribute </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">There are also </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UnitySetUp and UnityTearDown attributes with which you need to use a similar approach. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I, in turn, share EditMode tests for Modular and Integration. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unit tests test only one class in complete isolation from other classes. </font><font style="vertical-align: inherit;">Such tests often allow you to more easily prepare the environment for the class under test and errors, as they pass, allow you to more accurately localize the problem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In unit tests, I test many Core classes and classes needed directly in the game. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tests of the elements of the scheme are very similar, so I created a base class</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ElectricalElementTestsBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TElement</span></span>&gt; <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TElement</span></span> : <span class="hljs-title"><span class="hljs-title">ElectricalElementBase</span></span>, <span class="hljs-title"><span class="hljs-title">IElectricalElement</span></span>, <span class="hljs-title"><span class="hljs-title">new</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> TElement element; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput1; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput2; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput3; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> IInputConnector mInput4; [OneTimeSetUp] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { element = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TElement(); mInput1 = Substitute.For&lt;IInputConnector&gt;(); mInput2 = Substitute.For&lt;IInputConnector&gt;(); mInput3 = Substitute.For&lt;IInputConnector&gt;(); mInput4 = Substitute.For&lt;IInputConnector&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue_3Input</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input3, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> expectedOutput</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// arrange mInput1.Value.Returns(input1); mInput2.Value.Returns(input2); mInput3.Value.Returns(input3); element.Input = new[] {mInput1, mInput2, mInput3}; // act bool result = element.GetValue(); // assert Assert.AreEqual(expectedOutput, result); } protected void GetValue_2Input(bool input1, bool input2, bool expectedOutput) { // arrange mInput1.Value.Returns(input1); mInput2.Value.Returns(input2); element.Input = new[] {mInput1, mInput2}; // act bool result = element.GetValue(); // assert Assert.AreEqual(expectedOutput, result); } protected void GetValue_1Input(bool input, bool expectedOutput) { // arrange mInput1.Value.Returns(input); element.Input = new[] {mInput1}; // act bool result = element.GetValue(); // assert Assert.AreEqual(expectedOutput, result); } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Further tests of the element look like this: </font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AndTests</span></span> : <span class="hljs-title"><span class="hljs-title">ElectricalElementTestsBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">And</span></span>&gt; { [TestCase(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue_2Input</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> output</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetValue_2Input(input1, input2, output); } [TestCase(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [TestCase(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue_1Input</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> input, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> expectedOutput</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetValue_1Input(input, expectedOutput); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perhaps from the point of view of ease of understanding, this is a complication, which is usually not necessary in tests, but I didn‚Äôt want to copy-paste the same thing 11 times. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are also tests GameManager-s. </font><font style="vertical-align: inherit;">Since they have a lot in common, they also received a base class of tests. </font><font style="vertical-align: inherit;">Managers of the game in both modes should have some of the same functionality and some different. </font><font style="vertical-align: inherit;">Common things are tested by the same tests for each successor and in addition specific behavior is tested. </font><font style="vertical-align: inherit;">Despite the event-based approach, testing the behavior performed by the event was not difficult:</font></font><br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FullHelpAgree_FinishesLevel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// arrange levelGameManager.Start(); helpMenu.ClearReceivedCalls(); dataManager.ClearReceivedCalls(); // act helpMenu.FullHelpClick += Raise.Event&lt;Action&gt;(); fullHelpWindow.Agreed += Raise.Event&lt;Action&lt;bool&gt;&gt;(true); // assert dataManager.Received().SaveGame(); helpMenu.Received().Hide(); } [Test] public void ChangeSource_RootOutBecomeTrue_SavesGameOpensMenu() { // arrange currentLevelData.IsTestLevel.Returns(false); rootOutputMb.OutputConnector.Value.Returns(true); // act levelGameManager.Start(); levelFinishedMenu.ClearReceivedCalls(); dataManager.ClearReceivedCalls(); source.ValueChanged += Raise.Event&lt;Action&lt;bool&gt;&gt;(true); // assert dataManager.Received().SaveGame(); levelFinishedMenu.Received().Show(); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In integration tests, I also tested classes for the editor, and took them from the static context of the DI container. </font><font style="vertical-align: inherit;">Thereby checking including the correct injection, which is no less important than the unit test.</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PlacerTests</span></span> { [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ICircuitEditorPlacer circuitEditorPlacer; [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ICircuitGenerator circuitGenerator; [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IEditorSolver solver; [Inject] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ISceneObjectsHelper sceneObjectsHelper; [TearDown] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TearDown</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { sceneObjectsHelper.DestroyObjectsOfType&lt;IElectricalElementMb&gt;(immediate: <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } [OneTimeSetUp] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = StaticContext.Container; container.Inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)] [TestCase(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaceSolve_And_NoModifications_AllVariantsSolved</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elementsInLine</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variants = circuitGenerator.Generate(lines, elementsInLine, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; {<span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variant <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> variants) { circuitEditorPlacer.PlaceCircuit(variant); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> solutions = solver.FindSolutions(); CollectionAssert.IsNOTEmpty(solutions); } } [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.Branching)] [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.ThroughLayer)] [TestCase(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.All)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.Branching)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.ThroughLayer)] [TestCase(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, StructureModification.All)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaceSolve_And_Modifications_AllVariantsSolved</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lines, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elementsInLine, StructureModification modification</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variants = circuitGenerator.Generate(lines, elementsInLine, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; {<span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, modification); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> variant <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> variants) { circuitEditorPlacer.PlaceCircuit(variant); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> solutions = solver.FindSolutions(); CollectionAssert.IsNOTEmpty(solutions); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this test, real implementations of all dependencies are used and it also sets objects on the stage, which is quite possible in the EditMode tests. It is true to test that it placed them in a sense of responsibility - I have little idea how, so I check that the posted scheme has solutions.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PlayMode tests are used as system tests. They are checked prefabs, injection, etc. A good option to use ready-made scenes in which the test only loads and produces some interaction. But I use a prepared empty stage for testing, in which the environment is different from what is in the game. There was an attempt to use PlayMode to test the whole process of the game, like entering the menu, entering the level and so on, but the work of these tests was unstable, so it was decided to postpone it for later (never). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For writing tests, it is convenient to use coverage assessment tools, but unfortunately I haven‚Äôt found solutions that work with Unity.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Found a problem that with the upgrade of Unity to 2018.3 tests began to work much slower, up to 10 times slower (on a synthetic example). </font><font style="vertical-align: inherit;">The project contains 288 EditMode tests that run for 11 seconds, although nothing has been done there for so long.</font></font><br><br><a name="Resume"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Development results </font></font></h3><br>  <a href="https://habr.com/ru/post/453564/">Content</a> <br><br><img src="https://habrastorage.org/webt/kl/4d/u6/kl4du6hxim70hyncofiakaiqsi4.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Game Level Screenshot The</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> logic of some games can be formulated independently of the platform. This at an early stage provides ease of development and testability autotests. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DI is convenient. Even taking into account the fact that Unity does not have it natively, the bolted side works very well. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity allows you to automatically test a project. True, since all embedded GameObject components do not have interfaces and can only be used directly to mock such things as Collider, SpriteRenderer, MeshRenderer, etc. will not work. Although GetComponent allows you to get components by interface. As an option, write your wrappers for everything.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The use of autotests simplified the process of forming the initial logic, while there was no user interface to the code. Tests found an error several times at once during development. Naturally, errors appeared further, but often it was possible to write additional tests to this error / modify existing ones and subsequently to catch it automatically. Errors with DI, prefabs, scriptable objects and similar tests are difficult to catch, but it is possible, since you can use real installers for Zenject, which will tighten dependencies, as it happens in the build.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unity generates a huge number of errors, crashes. </font><font style="vertical-align: inherit;">Often errors are solved by restarting the editor. </font><font style="vertical-align: inherit;">Faced with the strange loss of references to objects in prefabs. </font><font style="vertical-align: inherit;">Sometimes the prefab by reference became destroyed (ToString () returns ‚Äúnull‚Äù) although everything looks working, the prefab is dragged to the scene and the link is not empty. </font><font style="vertical-align: inherit;">Sometimes some connections are lost in all scenes. </font><font style="vertical-align: inherit;">Everything seemed to be installed, it worked, but when switching to another branch all the scenes are broken - there are no links between the elements. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortunately, these errors were often corrected by restarting the editor or sometimes deleting the Library folder. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In total, about six months passed from the idea to publication on Google Play. </font><font style="vertical-align: inherit;">The development itself took 3 months, in free time from the main work.</font></font></div><p>Source: <a href="https://habr.com/ru/post/453564/">https://habr.com/ru/post/453564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../453548/index.html">We revive braking Samsung Galaxy TAB 2 WiFi</a></li>
<li><a href="../453552/index.html">Sort: determine the best algorithm</a></li>
<li><a href="../453554/index.html">How has Starlink changed from SpaceX</a></li>
<li><a href="../453558/index.html">Introduction to machine learning</a></li>
<li><a href="../453562/index.html">Digital events in Moscow from May 27 to June 2</a></li>
<li><a href="../453578/index.html">From critics to algorithms: labels, corporations and musical culture of the 20th century</a></li>
<li><a href="../45358/index.html">Blog for crisis</a></li>
<li><a href="../453580/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ 366 (May 20 - 26, 2019)</a></li>
<li><a href="../453584/index.html">Get ready: Angular 8 is close</a></li>
<li><a href="../453588/index.html">Opus about His Majesty Clay. Part Four - Silicones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>