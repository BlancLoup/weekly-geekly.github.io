<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Backload for Downloadable Files in ASP.NET MVC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I faced the task of organizing a beautiful and convenient mechanism for uploading files to a server with support for uploading large files, displ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Backload for Downloadable Files in ASP.NET MVC</h1><div class="post__text post__text-html js-mediator-article">  When I faced the task of organizing a beautiful and convenient mechanism for uploading files to a server with support for uploading large files, displaying download progress and other pleasures of the modern web, I began to search for what is available so as not to sculpt another bike. <br><br>  With the Javascript aploaders, everything turned out to be very good - there are a lot of options, for all requirements and tastes.  But with the server components for the implementation of the back end, the situation was somewhat worse.  Most of the solutions I found were small examples of handlers that I wouldn‚Äôt need to file more than one file for real use. <br><br>  As a result, for work on the client <a href="https://github.com/blueimp/jQuery-File-Upload">jQuery-File-Upload</a> , which was repeatedly discussed on the habre, was chosen, the benefit for it is the angularjs wrapper (which was relevant), and its documentation found a link to the implementation of the backend, which I wanted to tell - <b><a href="http://backload.org/">Backload</a></b> . <br><a name="habracut"></a><br>  <b>Backload</b> is a complete backend implementation for several js-plugins for upload (including jquery-file-upload).  The project is constantly evolving, has a decent set of settings and features and allows you to quickly raise an intelligently working mechanism for receiving downloadable files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The project has several editions - free (standart) and a number of paid ones.  But this fly in the ointment is compensated by the fact that for most of the tasks the free option is enough with my head (I had enough of it completely). <br><br>  To get started, just install the <a href="http://www.nuget.org/packages/Backload/">Backload</a> package from nuget or put it immediately with <a href="http://www.nuget.org/packages/JQuery_File_Upload_Plugin/">jquery-file-upload</a> . <br>  For the most simple purposes - a simple installation is enough; you just need to specify the necessary URL for jquery-file-upload: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileUploadUrl = <span class="hljs-string"><span class="hljs-string">"/Backload/UploadHandler"</span></span>; $(<span class="hljs-string"><span class="hljs-string">'#fileupload'</span></span>).fileupload({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: fileUploadUrl });</code> </pre> <br><br>  And that's all.  Requests will be processed by the embedded handler. <br><br>  For situations where this is not enough and you want to customize and customize the process in more detail - you can customize the behavior of Backload by editing the configuration file (.config), or you can get into the work of the handler by processing its events. <br><br>  To do this, you need to create your own controller, and specify jquery-file-upload to its URL.  After that, in our controller, we create an instance of FileUploadHandler, subscribe to those of its events that we need and pass on to it processing. <br><br><div class="spoiler">  <b class="spoiler_title">An example of a controller with subscriptions to Backload events</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileUploadController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;ActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FileHandler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { FileUploadHandler handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileUploadHandler(Request, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); handler.IncomingRequestStarted += handler_IncomingRequestStarted; handler.AuthorizeRequestStarted += handler_AuthorizeRequestStarted; handler.AuthorizeRequestFinished += handler_AuthorizeRequestFinished; handler.GetFilesRequestStarted += handler_GetFilesRequestStarted; handler.GetFilesRequestFinished += handler_GetFilesRequestFinished; handler.GetFilesRequestException += handler_GetFilesRequestException; handler.StoreFileRequestStartedAsync += handler_StoreFileRequestStartedAsync handler.StoreFileRequestFinished += handler_StoreFileRequestFinished; handler.StoreFileRequestException += handler_StoreFileRequestException; handler.DeleteFilesRequestStarted += handler_DeleteFilesRequestStarted; handler.DeleteFilesRequestFinishedAsync += handler_DeleteFilesRequestFinishedAsync; handler.DeleteFilesRequestException += handler_DeleteFilesRequestException; handler.OutgoingResponseCreated += handler_OutgoingResponseCreated; handler.ProcessPipelineExceptionOccured += handler_ProcessPipelineExceptionOccured; ActionResult result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> handler.HandleRequestAsync(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> }</code> </pre></div></div><br><br>  After this, it becomes possible to influence the processing of the file upload request. <br>  For example, under some condition to change the file name, the path to save, or simply refuse to apload according to some criteria. <br><br><div class="spoiler">  <b class="spoiler_title">Simple example</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_StoreFileRequestStartedAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, StoreFileRequestEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileName = e.Param.FileStatusItem.FileName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileName.Equals(<span class="hljs-string"><span class="hljs-string">"some_bad_name.tmp"</span></span>, StringComparison.OrdinalIgnoreCase)) { fileName = <span class="hljs-string"><span class="hljs-string">"some_good_name.tmp"</span></span>; e.Param.FileStatusItem.FileName = fileName; e.Param.FileStatusItem.UpdateStatus(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } }</code> </pre></div></div><br><br>  Or, for example, at the end of the apload something to do with the file. <br><br><div class="spoiler">  <b class="spoiler_title">Another simple example</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_StoreFileRequestFinished</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, StoreFileRequestEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileName = e.Param.FileStatusItem.FileName; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> folder = e.Param.FileStatusItem.StorageInfo.FileDirectory; DoSomeOperations(folder, fileName); }</code> </pre></div></div><br><br>  According to the events there is a very detailed description in the documentation and even <a href="https://github.com/blackcity/Backload">examples of their use</a> .  The spectrum of events is large enough to intervene in the process exactly when needed.  In particular, it turned out to be very convenient for me to implement a rather complicated logic of determining the right path for uploading files, checking permissions for files into specific folders, my own logging of operations with files and adding metadata files to downloadable files. <br><br>  I hope this article will be useful to someone and will show that there are quite simple, but convenient solutions for working with downloadable files. <br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/204878/">https://habr.com/ru/post/204878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204868/index.html">Chromebook in Russia</a></li>
<li><a href="../204870/index.html">Crowdfunding, freedom and cinema</a></li>
<li><a href="../204872/index.html">Next year, a new USB interface will appear, and it can be inserted by either side.</a></li>
<li><a href="../204874/index.html">How does roaming work - international, national, emergency</a></li>
<li><a href="../204876/index.html">Launch iframe application in Vkontakte</a></li>
<li><a href="../204886/index.html">Yandex conducts an experiment on encrypting the request text in the Referer header</a></li>
<li><a href="../204894/index.html">Beeline + Apple = L ...</a></li>
<li><a href="../204896/index.html">KM in games</a></li>
<li><a href="../204898/index.html">Evolution of the Test The Text algorithm</a></li>
<li><a href="../204900/index.html">Cloud ci: travis-ci and drone.io</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>