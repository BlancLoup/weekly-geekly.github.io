<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unicorn in space: check the source code of 'Space Engineers'</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you already understood from the title, this article will talk about suspicious places found in the source code of the 'Space Engineers'. But the fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unicorn in space: check the source code of 'Space Engineers'</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/e86/fdf/93e/e86fdf93e3134de8a3584a89fae593b8.png"></div><br><br>  As you already understood from the title, this article will talk about suspicious places found in the source code of the 'Space Engineers'.  But the format of the article is somewhat different from the rest.  In addition to information about the project, a review of some of the suspicious places and errors found, as well as ways to correct them, I included in the text a small section on the correct scenario of using a static analyzer.  I strongly recommend that you familiarize yourself with it, since many developers do not know or simply do not think about how to properly use the tools of this class.  As a result, static analysis tools are used an order of magnitude less efficiently than they could. <br><a name="habracut"></a><br><h2>  A little about the game </h2><br><img src="https://habrastorage.org/files/bca/28d/fab/bca28dfab38f44dc99b7f6fd4b319f1d.png"><br><br>  <a href="http://www.spaceengineersgame.com/">Space Engineers</a> is a sandbox about building and maintaining space objects.  Players can build space ships and stations of various sizes and purposes (civilian and military), manage them and extract resources.  The game uses a realistic physics engine: any object can be assembled, disassembled, damaged and completely destroyed.  The game is based on the graphics engine VRage 2.0 of its own, developed by the creator company <a href="https://en.wikipedia.org/wiki/Keen_Software_House">Keen Software House</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The source code of the game is available in the <a href="https://github.com/KeenSoftwareHouse/SpaceEngineers">repository on GitHub</a> . <br><br>  The source code is written in C # and verified using the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static code analyzer.  You can check the project that interests you by <a href="http://www.viva64.com/ru/pvs-studio-download/">downloading</a> and trying the analyzer on your own or someone else's code. <br><br>  The general list of found errors and projects in which they were identified can be found on the <a href="http://www.viva64.com/ru/examples/">corresponding link</a> . <br><br><h2>  Wrong and suspicious places </h2><br>  Below are some of the warnings that the analyzer issued, as well as code fragments that it considered suspicious.  I repeat that these are not all warnings.  More information about the total number of errors and why not all of them were considered, is written in the appropriate section. <br><br>  But you already want to look at the code, right?  Well, let's get started. <br><br><h3>  Typos and inattentive 'copy-paste' </h3><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeserializeV0</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XmlReader reader</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (property.Name == <span class="hljs-string"><span class="hljs-string">"Rotation"</span></span> || property.Name == <span class="hljs-string"><span class="hljs-string">"AxisScale"</span></span> || property.Name == <span class="hljs-string"><span class="hljs-string">"AxisScale"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0381/">warning</a> : <a href="http://www.viva64.com/ru/d/0381/">V3001</a> There are identical sub-expressions 'property.Name == "AxisScale"' to the left and to the right of the '||'  operator.  Sandbox.Graphics MyParticleEmitter.cs 352 <br><br>  A typical mistake that occurs in C ++ code, C # code, and, probably, in many other programming languages.  The reason for such errors, as a rule, is a simple inattention.  Compared the property 'property.Name' with string literals and twice compared with 'AxisScale'.  Most likely, a comparison with another literal was implied (in neighboring methods this property is compared with the literal 'LimitAngle', so I think it was meant here). <br><br>  Not less typical errors of the same bodies of the 'if' operator in the 'then' and 'else'-blocks were encountered.  Such errors arise due to inattention (including due to inattention <a href="http://www.viva64.com/ru/t/0068/">copy-paste</a> ).  Consider a few similar examples: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartRespawn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { m_lastCountdownTime = MySandboxGame.TotalGamePlayTimeInMilliseconds; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_removeAfterDeath) m_deathCountdownMs = AgentDefinition.RemoveTimeMs; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> m_deathCountdownMs = AgentDefinition.RemoveTimeMs; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0402/">warning</a> : <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Sandbox.Game MyAgentBot.cs 260 <br><br>  Regardless of the value of the 'm_removeAfterDeath' variable, the other variable - 'm_deathCountdownMs' - will be assigned the same value.  In this case, it is difficult to say what needs to be changed here.  But the fact that the code contains an error is obvious. <br><br>  The following similar fragment: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsTriangleDangerous</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> triIndex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MyPerGameSettings.NavmeshPresumesDownwardGravity) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> triIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> triIndex == <span class="hljs-number"><span class="hljs-number">-1</span></span>; } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0402/">warning</a> : <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Sandbox.Game MyNavigationTriangle.cs 189 <br><br>  The situation is similar to the previous one, the use of the 'if' operator in this code does not make sense.  And again it's hard to say how to fix this code.  Perhaps, depending on the condition, it is necessary to use either the '==' operator, or '! ='.  But this is only an assumption. <br><br>  And one more similar situation: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateLight</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((MyCubeGrid)Parent).GridSizeEnum == MyCubeSize.Large) Light.GlareIntensity = <span class="hljs-number"><span class="hljs-number">0.5f</span></span> + length * <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Light.GlareIntensity = <span class="hljs-number"><span class="hljs-number">0.5f</span></span> + length * <span class="hljs-number"><span class="hljs-number">2</span></span>; .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0402/">warning</a> : <a href="http://www.viva64.com/ru/d/0402/">V3004</a> The 'then' statement is equivalent to the 'else' statement.  Sandbox.Game MyThrust.cs 149 <br><br>  Depending on the condition, it is necessary to change the intensity of the glare.  But due to copy-paste it will always be the same.  What value needs to be set in this or that case again cannot be said, it is up to the authors of the code. <br><br><h3>  Loss of return values </h3><br>  There is code in projects that does not use the return value of the method.  This may be due, for example, to the fact that the programmer has forgotten that the 'Replace' method of the 'String' class returns the modified string, and the original remains intact, since the objects of the 'String' class are immutable.  This project also encountered 2 errors associated with the loss of the value returned by the method: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cueName</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_arcade.Hash == MyStringHash.NullOrEmpty &amp;&amp; m_realistic.Hash == MyStringHash.NullOrEmpty) MySandboxGame.Log.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Could not find any sound for '{0}'"</span></span>, cueName)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_arcade.IsNull) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Could not find arcade sound for '{0}'"</span></span>, cueName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_realistic.IsNull) <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Could not find realistic sound for '{0}'"</span></span>, cueName); } }</code> </pre> <br>  <b>PVS-Studio warnings</b> : <ul><li>  <a href="http://www.viva64.com/ru/d/0406/">V3010</a>  Sandbox.Game MyEntity3DSoundEmitter.cs 72 </li><li>  <a href="http://www.viva64.com/ru/d/0406/">V3010</a>  Sandbox.Game MyEntity3DSoundEmitter.cs 74 </li></ul><br>  The static method 'Format' of the class 'String' makes up the result string based on the format string and the arguments that form it, and then returns the result string.  Therefore, calling this method without using the return value does not make sense. <br><br>  From this code, it is clear that in case some elements could not be found, it is necessary to write error information to the log.  And the last two calls to the 'string.Format' method should be arguments to the 'MySandboxGame.Log.WriteLine' method. <br><br>  The correct code might look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_arcade.IsNull) MySandboxGame.Log.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Could not find arcade sound for '{0}'"</span></span>, cueName)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_realistic.IsNull) MySandboxGame.Log.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format( <span class="hljs-string"><span class="hljs-string">"Could not find realistic sound for '{0}'"</span></span>, cueName));</code> </pre><br><h3>  Incorrect verification after using the 'as' operator </h3><br>  In my other articles about checking C # projects (' <a href="http://www.viva64.com/ru/b/0371/">Checking the source code of C # /. NET components from Sony</a> ', ' <a href="http://www.viva64.com/ru/b/0366/">Looking for bugs in MonoDevelop</a> '), I mentioned that among some bugs that C # programmers make, certain patterns.  And with each new proven project, I am more and more convinced of this.  One of them is to cast an object with the help of the 'as' operator to a compatible type, and after that - check for the 'null' not of the received object, but of the original one, which causes the likelihood of exceptions of the type 'NullReferenceException'.  "Space engineers" did not stand aside. <br><br>  Let's look at some examples with similar errors: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyObjectBuilder_DefinitionBase builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Init(builder); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ob = builder <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MyObjectBuilder_WeaponBlockDefinition; Debug.Assert(builder != <span class="hljs-literal"><span class="hljs-literal">null</span></span>); WeaponDefinitionId = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyDefinitionId(ob.WeaponDefinitionId.Type, ob.WeaponDefinitionId.Subtype); ResourceSinkGroup = MyStringHash.GetOrCompute(ob.ResourceSinkGroup); InventoryMaxVolume = ob.InventoryMaxVolume; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0388/">warning</a> : <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'builder', 'ob'.  Sandbox.Game MyWeaponBlockDefinition.cs 21 <br><br>  This code will work correctly if the builder is equal to null.  Then the Assert will work and everyone will be happy (relatively, of course).  If the 'builder' is of the type 'MyObjectBuilder_WeaponBlockDefinition', everything is fine again.  But if 'builder' has a value not 'null', but as a result of casting, the object 'ob' will have the value 'null' - the check 'Debug.Assert (builder! = Null)' will pass successfully, and below, when using the object 'ob' will throw an exception of type 'NullReferenceException'. <br><br>  I have ‚Äúchewed up‚Äù some of the cases where the code will work correctly, and when it will not, in order not to repeat these explanations later.  But, I think, it is obvious that such code contains an error. <br><br>  Similar error: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contextMenu_ItemClicked</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyGuiControlContextMenu sender, MyGuiControlContextMenu.EventArgs args</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> actionsItem = item <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MyToolbarItemActions; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || idx &gt;= actionsItem .PossibleActions(ShownToolbar.ToolbarType) .Count) RemoveToolbarItem(slot); .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0388/">warning</a> : <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly an incorrect variable is compared to null after type conversion using 'as' keyword.  Check variables 'item', 'actionsItem'.  Sandbox.Game MyGuiControlToolbar.cs 511 <br><br>  If the item object could not be cast to the 'MyToolbarItemActions' and 'actionsItem' types, checking the 'item! = Null' will not help, since the wrong object is checked, and an exception of the 'NullReferenceException' type may occur below. <br>  Then it would be correct to correct the check for this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (actionsItem != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)</code> </pre> <br>  Several warnings with similar cases: <ul><li>  <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'ob', 'objectBuilder'.  Sandbox.Game MyBlockNavigationDefinition.cs 172 </li><li>  <a href="http://www.viva64.com/ru/d/0388/">V3019</a> Possibly incorrectly variable conversion compared to null after type conversion using 'as' keyword.  Check variables 'Owner', 'character'.  Sandbox.Game MyWelder.cs 232 </li></ul><br><h3>  Suspicious comparisons </h3><br>  In the <a href="http://www.viva64.com/ru/d/0013/">PVS-Studio 6.01</a> version, in addition to the newly added ones, existing diagnostics have been improved, and some of them have been significantly improved.  An example of one of these diagnostics is <a href="http://www.viva64.com/ru/d/0391/">V3022</a> , which determines that the condition will always be true or false. <br>  I propose to consider several fragments of a similar code, marked by the analyzer: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SpawnInventoryContainer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyDefinitionId bagDefinition</span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCharacterDead</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bagEntityId = SpawnInventoryContainer( Character.Definition.InventorySpawnContainerId.Value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bagEntityId != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0391/">warning</a> : <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'bagEntityId! = Null' is always true.  Sandbox.Game MyCharacterInventorySpawnComponent.cs 60 <br><br>  Since the 'SpawnInventoryContainer' method returns an object of type 'long', the variable 'bagEntityId' will have the same type.  Primitive types like 'long' can be compared with 'null' (long_var == null), but the result of this comparison will always be 'false'.  As a consequence, the body of the 'if' operator will always be executed.  Most likely, the expected nullable-type - 'long?'. <br><br>  This is not the only such case, there were more places where primitive significant types were compared to 'null'.  Relevant warning analyzer: <br><br><ul><li>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'info. WorkshopId == null' is always false.  Sandbox.Game MyGuiBlueprintScreen.cs 326 </li><li>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'info. SteamIDOwner == null' is always false.  Sandbox.Game MyGuiBlueprintScreen.cs 328 </li><li>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'result! = Null' is always true.  Sandbox.Game MyGpsCollection.cs 293 </li></ul><br>  There are other interesting code snippets: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> new </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestPlacement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; PreviewGrids.Count; ++i) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (retval &amp;&amp; i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> settings = i == <span class="hljs-number"><span class="hljs-number">0</span></span> ? m_settings.GetGridPlacementSettings(grid, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) : MyPerGameSettings.BuildingSettings.SmallStaticGrid; .... } .... } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0391/">warning</a> : <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'i == 0' is always true.  Sandbox.Game MyGridClipboardAdvanced.cs 790 <br><br>  Also a very interesting case.  There is a ternary operator in the code, but there is no sense from it.  In the condition of the 'if' operator, it is checked that 'i == 0', and then, when the 'settings' object is initialized, this condition is checked again.  It would be logical, but between these parts of the code the 'i' does not change at all, as a result - there is no point in checking, the 'settings' will be constantly initialized with the same value. <br><br>  There were more warnings in the same cycle: <br><br><ul><li>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'i == 0?  true: grid.IsStatic 'is always true.  Sandbox.Game MyGridClipboardAdvanced.cs 808 </li><li>  <a href="http://www.viva64.com/ru/d/0391/">V3022</a> Expression 'i == 0' is always true.  Sandbox.Game MyGridClipboardAdvanced.cs 808 </li></ul><br>  The code has met several dozen such warnings.  It makes no sense to consider all of them here, if you wish, you can download the project source code and the analyzer and check the project yourself (there are links to the code and the analyzer at the beginning of the article).  Fortunately, the project is assembled and analyzed simply and quickly.  Kill several birds with one stone - try the analyzer, see the benefits of using tools of this kind, and at the same time familiarize yourself with the source code of the project. <br><br><h3>  And again about dereferencing null links </h3><br>  Despite the fact that C # in terms of referring to null links is much safer than dereferencing null pointers in C ++ (leading to <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BE%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D1%2591%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">UB</a> ), the unexpected generation of exceptions like 'NullReferenceException' is still extremely unpleasant, especially if these exceptions occur to users rather than show yourself at the design stage.  Therefore, if there is a possibility of dereferencing the zero reference, you need to be extremely attentive: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyEntity Entity { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EnergyCritWarningMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MyGuiSounds cue, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> MyStringId text</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MySession.ControlledEntity.Entity <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MyCharacter || MySession.ControlledEntity == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0414/">warning</a> : <a href="http://www.viva64.com/ru/d/0414/">V3027</a> The variable 'MySession.ControlledEntity' has been verified.  Sandbox.Game MyHudWarning.cs 415 <br><br>  There is a need to perform some actions if 'MySession.ControlledEntity == null' or 'MySession.ControlledEntity.Entity' is a type compatible with 'MyCharacter'.  But since the verification of these conditions is in the wrong order, an exception may occur.  It will be generated if 'MySession.ControlledEntity == null', since 'Entity' is an instance property.  The solution is to change the order of the subexpressions: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MySession.ControlledEntity == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || MySession.ControlledEntity.Entity <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MyCharacter)</code> </pre> <br><br><h3>  Strange cycles </h3><br>  There are also errors with cycles in the code, for example, when the body of the cycle is never executed, it will always be executed strictly once, or it will be executed indefinitely.  There are many reasons, and they are all different.  I propose to look at one of these cycles: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddDivisionForCullingStructure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;MyRenderObject&gt; roList, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> objectCountLimit, List&lt;BoundingBoxD&gt; resultDivision</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> axis = bestAxis; axis &lt;= bestAxis; axis++) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0396/">warning</a> : <a href="http://www.viva64.com/ru/d/0396/">V3028</a> Consider inspecting the 'for' operator.  Initial and final values ‚Äã‚Äãof the iterator are the same.  VRage.Render MyRender-Management.cs 1034 <br><br>  The loop counter ('axis') is initialized with the value of 'bestAxis', but the exit condition is the same or a smaller value, due to which no iteration of the loop will be performed.  The implication was that the counter should initialize 0, then the loop would look like this: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> axis = <span class="hljs-number"><span class="hljs-number">0</span></span>; axis &lt;= bestAxis; axis++)</code> </pre><br>  Not less interesting example with a cycle: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Draw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flame <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> m_thrust.Flames) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_thrust.CubeGrid.Physics == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_landingEffect != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { m_landingEffect.Stop(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); m_landingEffect = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; --m_landingEffectCount; } <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... if (m_landingEffect == null) continue; .... } }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0410/">warning</a> : <a href="http://www.viva64.com/ru/d/0410/">V3020</a> An unconditional 'continue' within a loop.  Sandbox.Game MyRenderComponentThrust.cs 109 <br><br>  The error lies in the fact that the 'continue' operator is outside the 'then'-branch of the' if 'operator, because of which it will always be executed.  This means that all the code following this statement (more than 10 lines) will never be executed.  The solution to the problem is obvious - it is necessary to make the 'continue' operator under the condition. <br><br><h2>  The remaining warnings </h2><br>  I repeat that in the articles I do not write out all the warnings that the analyzer issues on the source code of the project.  It would take too much time to analyze all warnings, the article on volumes would become excessively large and it would be tiresome to read it.  But you are probably wondering how many suspicious places in the code did the analyzer find?  At the time of this writing, the statistics were as follows: <br><br><ul><li>  75 high-level alerts; </li><li>  92 mean warnings; </li><li>  817 low severity alerts; </li></ul><br>  You should definitely study all the warnings of a high level of importance and at least look at the average level.  Do not think that the warnings of a low level of importance do not contain anything interesting, just that more specific diagnostics are located at this level.  In any case, it‚Äôs worthwhile to get acquainted with the list of these messages, since, perhaps, it contains exactly those specific diagnostics that are necessary for your project. <br><br><h2>  The benefits of static analysis and how to correctly use a static analyzer </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8e0/efd/780/8e0efd780fc94441a7368536c8dc12b6.png"></div><br><br>  Unfortunately, we have to deal with the fact that many people do not know how to correctly use a static analyzer. <br><br>  The following variant of work is often considered to be acceptable: they downloaded the analyzer, checked the project before the release, corrected something, forgot about the analyzer.  Oh, release soon!  They remembered about the analyzer, checked the project, corrected something, forgot it. <br><br>  This is the most incorrect use case.  Errors made at the time of development are not immediately detected by the static analyzer, but rest in the code.  Some of them are found by the compiler, some by the programmer himself, and another part by the testers.  And only what remains after all this is found by the static analyzer, when they nevertheless decide to resort to its help.  This requires a lot of effort from different people, and still there is a high chance of missing something.  What is even worse - the longer the error is in the code, the more expensive it will eventually be fixed. <br><br>  If the analyzer were used regularly, most of the errors would be corrected at the design stage, which would facilitate the task for both the programmer and the testers. <br><br>  It is quite possible that the static analyzer will find too many errors, and then they simply will not edit.  This could be avoided in 2 ways: <br><br><ul><li>  All the same regular launches of the analyzer and timely correction of errors.  If there are initially a few mistakes and they can be corrected, this should be done, as well as timely monitor the correction of new ones.  If there are many errors right away, and there is no way to fix them all, you should consider the second use case; </li><li>  Hiding (fixing) existing errors and correcting only newly emerging ones.  This will prevent the emergence of new errors and at least not increase the number of existing errors.  The fixed errors are corrected gradually, during which the total number of errors gradually from the fixed value is reduced to zero.  Details: the <a href="http://www.viva64.com/ru/b/0364/">practice of using the PVS-Studio analyzer</a> . </li></ul><br>  From the above, a simple conclusion follows - a static analyzer is a tool for regular use, not a one-time use.  It is in this scenario of work that he fully reveals his potential, allowing him to correct errors at the earliest stages of their occurrence, when the cost of correction is still small. <br><br><h2>  Conclusion </h2><br><img src="https://habrastorage.org/files/a03/7ef/583/a037ef583b9842258af0961a80b26a42.png"><br><br>  To summarize, I will not talk about the quality of the source code, whether a project is good or bad - these are subjective concepts, everyone‚Äôs views may differ.  Some impression you can make on the basis of the figures given in the article (the number of warnings) and code fragments.  You will get a more complete picture by checking the project yourself and reviewing the messages, which I highly recommend to do.  This will allow you to make a more detailed picture of the quality of the code, as well as to get a closer look at the static analyzer, the information on the use of which I tried to convey to you in this article. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0376/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Vasiliev.  <a href="http://www.viva64.com/en/b/0376/">Unicorn in Space: Analyzing the Source Code of 'Space Engineers'</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/277119/">https://habr.com/ru/post/277119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277109/index.html">Vision-based SLAM: tutorial</a></li>
<li><a href="../277111/index.html">Problems of access control based on the access list in ECM systems</a></li>
<li><a href="../277113/index.html">Why I no longer use MVC frameworks</a></li>
<li><a href="../277115/index.html">Cloud to organization scale - how Varonis can help build secure data sharing</a></li>
<li><a href="../277117/index.html">Zimbra: delete random or unnecessary emails</a></li>
<li><a href="../277121/index.html">Resource Binding in Microsoft DirectX 12. Performance Issues</a></li>
<li><a href="../277123/index.html">Open letter @ignored test</a></li>
<li><a href="../277125/index.html">Results of 2015: IT industry</a></li>
<li><a href="../277127/index.html">Record of the webinar "Centralized Management with MyKerio"</a></li>
<li><a href="../277129/index.html">Understanding garbage collection and memory leak detection in Node.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>