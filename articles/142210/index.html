<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gearman - Queue Server: Use in PHP Projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago there was a wonderful article describing the general principles of working with the Gearman queue server. I would like to continue the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gearman - Queue Server: Use in PHP Projects</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago there was a <a href="http://habrahabr.ru/post/123451/">wonderful article</a> describing the general principles of working with the Gearman queue server.  I would like to continue the material, complementing it with some details of practical application, namely: <br>  - installation and server management <br>  - queue management - what is possible and how <br>  - PECL and PEAR php extensions to work with Gearman <br>  - server monitoring <br>  - code examples <br>  - data transfer in portions <br>  - organization of parallel computing in PHP <br><br>  Interesting?  I ask under the cat <br><a name="habracut"></a><br>  Before proceeding to the presentation of the material, I must say where it came from.  This is a compilation of practical applications in several projects (all dealt with working with slow remote sites), extracts from documentation and discussions, just some observations and abstract considerations.  Of course, there may be inaccuracies, controversial decisions and controversial thoughts - the author will be grateful for any criticism and editing. <br><br><h4>  Content </h4><br>  <a href="https://habr.com/ru/post/142210/">Gearman Data Lifecycle</a> <br>  <a href="https://habr.com/ru/post/142210/">Gearman Installation and Management</a> <br>  <a href="https://habr.com/ru/post/142210/">Server state monitoring</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://habr.com/ru/post/142210/">Fate queue at gearman restart</a> <br>  <a href="https://habr.com/ru/post/142210/">Reset the entire queue and reset the queue of a specific task</a> <br>  <a href="https://habr.com/ru/post/142210/">Restart worker</a> <br><br>  <a href="https://habr.com/ru/post/142210/">PECL and REAR php extensions to work with Gearman</a> <br>  <a href="https://habr.com/ru/post/142210/">pear net_geearman</a> <br>  <a href="https://habr.com/ru/post/142210/">pecl gearman</a> <br>  <a href="https://habr.com/ru/post/142210/">Install pecl gearman</a> <br><br>  <a href="https://habr.com/ru/post/142210/">The easiest client and worker (+ video)</a> <br>  <a href="https://habr.com/ru/post/142210/">Data transfer in parts and additional data exchange with the client (+ video)</a> <br>  <a href="https://habr.com/ru/post/142210/">Background Tasks and Priority</a> <br>  <a href="https://habr.com/ru/post/142210/">Parallel computations in PHP using Gearman (+ video)</a> <br><br><a name="cycl"></a><br><h4>  Gearman Data Lifecycle </h4><br>  Before we go into details, once again illustrate working with the server. <br>  The simplest example.  How does calling and executing functions in PHP: <br><br><img src="https://habrastorage.org/storage2/673/924/a2a/673924a2a3907c418cdc4af45b1597b3.png"><br><br>  Trivially.  Now the same, but using the queue server: <br><br><img src="https://habrastorage.org/storage2/ea8/32a/9d8/ea832a9d8c299757e42b00b67f87a33a.png"><br><br>  In short, the script that needs the results / actions of the function (‚Äúclient‚Äù) sends to the server (registers) the name of the function and its arguments ‚Äî a task is created on the server (‚Äútask‚Äù). <br><br>  If a handler is registered on the server for a function with the same name (‚Äúworker‚Äù) and it is currently free, data for processing and the name of the function in the form of a task (‚Äújob‚Äù) are transferred to it. <br>  If the worker for such a function is not registered or he is busy, the task is queued and waits for processing. <br><br>  After processing the worker transfers what returns f-i, back on Gearman.  The queue server looks at which client registered tasks with such a name and with such data, and sends the result of the worker to it (this is if the client did not register the task as background. If the task is registered as background, nothing is sent to the client) . <br><br>  What immediately follows from this principle of work? <br><br>  1. Four objects are involved in working with Gearman: <i><b>client, task, worker, job</b></i> .  Description of all objects are <a href="http://www.php.net/manual/ru/book.gearman.php">at the office.</a>  <a href="http://www.php.net/manual/ru/book.gearman.php">PHP site</a> . <br><br>  2. The data transferred ‚Äî and to the server from the client, and back from the worker ‚Äî is only a string, and only one.  If you need to pass several arguments or not a string - an array for example - serialization is required. <br><br>  However, all of the above - just a brief repeated of.  documentation and already published materials.  Now the nuances. <br><br><a name="setup"></a><br><h4>  Gearman Installation and Management </h4><br>  If there is a great need, you can start the Gearman server on Windows, there is its implementation in Java: <br>  <a href="https://launchpad.net/gearman-java">https://launchpad.net/gearman-java</a> <br><br>  But we will consider working under linux (the following examples are for debian). <br>  Server installation runs smoothly and has no features: <br><br>  aptitude install gearman-job-server <br><br>  After a successful installation, the server is controlled from etc / init.d / gearman-job-server with simple and clear commands: <br>  {start |  stop |  restart |  force-reload} <br>  The default host for the server is localhost, the port is 4730 <br><br><a name="monitor"></a><br><h5>  Server state monitoring </h5><br>  There is always a need to see what happens on the server: what tasks are registered, how many are in the queue, how many workers are registered for each task. <br>  This can be done from the console with the command <br>  (echo status) |  netcat 127.0.0.1 4730 <br><br><a name="qu"></a><br><h5>  Fate queue at gearman restart </h5><br>  Immediately the question arises: what will happen to the queue on a running server, if you make it <s>hara-kiri</s> restart? <br>  With the default installation, the queue is stored in memory, restarting the server cancels all tasks that clients sent to the server, and cancels the registration of all workers on the server.  In this case, the workers will generate exceptions like "Lost connection with the server." <br>  The queue can be saved in the database, supported by MySQL, PostgreSQL, SQLite.  How to organize such a queue is well written at the office.  site: <br>  <a href="http://gearman.org/index.php%3Fid%3Dmanual:job_server">http://gearman.org/index.php?id=manual:job_server#persistent_queues</a> <br><br>  It should be borne in mind that even if the queue is saved, when the server is restarted, task handlers ‚Äî workers ‚Äî will still ‚Äúfall off‚Äù from the server, and you will either have to restart them, or you should foresee such a situation in advance by the workers themselves. <br><br><a name="reset"></a><br><h5>  Reset the entire queue and reset the queue of a specific task </h5><br>  If the queue is not stored in the database, restarting the server, as mentioned above, will reset the entire queue.  If the queue is stored in the database, you need, in addition to restarting the server, to clear the corresponding table - all or selectively.  Recall that restarting the server will generate exceptions in both clients and workers. <br><br>  However, there may be a situation when you need to reset the queue for only one task.  Example: we parse 100 sites, one has stopped responding, 1000 tasks have accumulated in the queue to receive data from this site, data from all other sites are received through the queue server without any problems.  It is necessary to reset the queue only for the stalled site. <br>  The easiest and painless way to do this is to run a fake worker who registers a task with the same name on the queue server, but quickly returning a NULL, empty string or anything else ‚Äî the main thing is quickly.  This worker will pass through all the pending tasks, the queue will be cleared. <br><br><a name="reset2"></a><br><h5>  Restart worker </h5><br>  What may it take?  Well, except for the obvious situation where the worker is frozen and this is beyond doubt, there is one more, very frequent. <br>  Situation: the worker is running, has registered his tasks on the server.  If at this moment you make changes to the code of the worker, no matter how much you save it, the code that was at the time of the task registration will process the tasks from the queue server. <br>  In order for the changes in the code to take effect - that is, that the tasks from the server are processed by the already changed code, the worker must be restarted, that is, the execution script of the current worker must be stopped and restarted.  The methods are trivial: manually, using a bash-script, provide for a processing in the worker - like exit_worker and launching it from the crown, etc. <br><br><a name="ps"></a><br><h4>  PECL and REAR php extensions to work with Gearman </h4><br>  Two variants of extensions can be used to work with the Gearman queue server in php: <a href="http://pecl.php.net/package/gearman">pecl gearman</a> and <a href="http://pear.php.net/package/Net_Gearman">pear Net_Gearman</a> <br><br>  There is a fundamental difference between these extensions. <br><br><a name="pear"></a><br><h5>  pear net_geearman </h5><br>  pear Net_Gearman is just a few php files.  And that's all.  It is very easy to install on the server: <br>  pear install Net_Gearman channel: //pear.php.net/Net_Gearman-0.2.3 <br>  You can even not install on the server - just unpack the archive, implement the connection acc.  classes and everything - you can use, like so for example <br><br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__autoload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($className)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  pear Net_Gearman,  Net_Gearman_Job if(strstr($className, 'Net_Gearman_') and !strstr($className, 'Net_Gearman_Job_')){ $className = str_replace('Net_Gearman_', '', $className); include_once PATH_TO_PEAR_NET_GEARMAN.$className.'.php'; } //  pear Net_Gearman_Job if(strstr($className, 'Net_Gearman_Job_')){ $className = str_replace('Net_Gearman_Job_', '', $className); include_once PATH_TO_PEAR_NET_GEARMAN.'Job/'.$className.'.php'; } }</span></span></code> </pre> <br>  This, by the way, makes it possible to work with Gearman in php using the same Denwer or OpenServer. <br><br>  The current version is the alpha release dated 2009.  But it is not scary: no one bothers to edit the required files, no additional components / libraries are used. <br>  Despite the date, the library is operable on php5.3. * And does not require revision. <br><br>  The question arises: how does all this happiness interact with the Gearman server?  Via sockets, sending commands to the server (here is a <a href="http://gearman.org/%3Fid%3Dprotocol">description of the interaction with the server on the off site</a> ) <br><br>  Note the important detail pear Net_Gearman: the library has server monitoring tools and (partially) its management, which makes it possible to do, for example, the monitoring script mentioned above. <br><br><a name="pecl"></a><br><h5>  pecl gearman </h5><br>  Despite all the advantages, the interface of the pear Net_Gearman library is poor and, as they say somewhere, somewhat clumsy.  In addition, IDE - phpStorm, for example, does not contain Net_Gearman classes ( <s>you need to</s> fasten the <s>crutch for convenient work</s> ), and pecl gearman is better suited for working use. <br>  The main difference between pecl gearman and pear Net_gearman is that pecl gearman does not directly interact with the server - this is a wrapper for the libgearman C-library. <br><a name="pecl_setup"></a><br><h6>  Install pecl gearman </h6><br>  I would really like this here and now: <br>  pecl install gearman <br>  But this will not work.  At the end of the installation, a message appears stating that libgearman version 0.21 and higher is required, building such a library pulls some more actions along with it, and it may not all be crowned with success. <br>  There are a lot of recommendations for installing the pecl-gearman-0.7.0 library on the Internet, but it has a bug - there is a high probability of crashing with a Segmentation fault. <br>  By means of several tests it was established that version 0.8.1 is working stably and without problems. <br>  Here is the installation procedure for debian6 / php5.3 * from scratch, starting with the server (for debian7 / php5.4, see <a href="http://habrahabr.ru/post/243857/">this post here</a> ): <br><br><pre> <code class="bash hljs">aptitude install gearman-job-server aptitude install php5-dev aptitude install php-pear aptitude install make aptitude install libgearman-dev <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp pecl download gearman-0.8.1 tar -xvf gearman-0.8.1.tgz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gearman-0.8.1 phpize ./configure make make <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> make install <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'extension=gearman.so'</span></span> &gt; /etc/php5/conf.d/gearman.ini</code> </pre><br><br>  Now you can safely use all the beauty of the library in a real project.  The IDE contains classes for pecl gearman, no further action is required.  All the examples below use the pecl gearman extension. <br><br><h4>  Examples </h4><br><a name="ex1"></a><br><h5>  The easiest client and worker </h5><br>  Customer <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GearmanClient(); <span class="hljs-comment"><span class="hljs-comment">/* -  true   ,     .       echo(''),               */</span></span> $client-&gt;addServer(<span class="hljs-string"><span class="hljs-string">'192.168.68.4'</span></span>); $client-&gt;setTimeout(<span class="hljs-number"><span class="hljs-number">29000</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*true/false     */</span></span> $haveGoodServer = $client-&gt;echo(<span class="hljs-string"><span class="hljs-string">''</span></span>); var_dump($haveGoodServer); $data = <span class="hljs-string"><span class="hljs-string">'slon yooo'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     Gearman   */</span></span> $res = $client-&gt;do(<span class="hljs-string"><span class="hljs-string">'function_revert_string_and_caps'</span></span>, $data); <span class="hljs-comment"><span class="hljs-comment">/*  ,     ,     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $res;</code> </pre><br><br>  Worker <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GearmanWorker(); $worker-&gt;addServer(<span class="hljs-string"><span class="hljs-string">'192.168.68.4'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*  ,    - function_revert_string_and_caps,      - 'revCaps*/</span></span> $worker-&gt;addFunction(<span class="hljs-string"><span class="hljs-string">'function_revert_string_and_caps'</span></span>, <span class="hljs-string"><span class="hljs-string">'revCaps'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* .       */</span></span> $worker-&gt;work(); <span class="hljs-comment"><span class="hljs-comment">/*      -   */</span></span> <span class="hljs-comment"><span class="hljs-comment">//while($worker-&gt;work()){}; //   - ,   - - job function revCaps($job){ /*  job ,  */ $content = $job-&gt;workload(); return mb_strtoupper(strrev($content)); }</span></span></code> </pre><br>  Sample video <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/m0aO8d12VSM%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhjveLaCMZJXxPa0oI8kp4GW7PZ13g" frameborder="0" allowfullscreen=""></iframe><br><br><a name="ex2"></a><br><h5>  Data transmission in parts and additional data exchange with the client </h5><br>  It is not always convenient to use the do operation in the client; it is often better to use adding a task and processing data coming from the server using simple callback functions. <br>  In addition, if the data is transmitted in parts, it makes sense to display the number of processed parts - for example, for a progress bar. <br>  Customer <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GearmanClient(); $client-&gt;addServer(<span class="hljs-string"><span class="hljs-string">'192.168.68.4'</span></span>); $data = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* .     */</span></span> $client-&gt;addTask(<span class="hljs-string"><span class="hljs-string">'function_serial_send'</span></span>, $data); <span class="hljs-comment"><span class="hljs-comment">/*,  -        */</span></span> $client-&gt;setCreatedCallback(<span class="hljs-string"><span class="hljs-string">'createTask'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*   - -   */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GearmanTask $task)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Start data from "</span></span>.$task-&gt;jobHandle().<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*,  -    */</span></span> $client-&gt;setDataCallback(<span class="hljs-string"><span class="hljs-string">'getData'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* -    */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GearmanTask $task)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"received:"</span></span>.$task-&gt;data().<span class="hljs-string"><span class="hljs-string">"\n\n"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*,  -    Complete -    */</span></span> $client-&gt;setCompleteCallback(<span class="hljs-string"><span class="hljs-string">'stopTask'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*- -     */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"task Stop\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*,  -      */</span></span> $client-&gt;setStatusCallback(<span class="hljs-string"><span class="hljs-string">'getStatus'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    %*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GearmanTask $task)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Handled: "</span></span>.$task-&gt;taskNumerator() / $task-&gt;taskDenominator()*(<span class="hljs-number"><span class="hljs-number">100</span></span>).<span class="hljs-string"><span class="hljs-string">"%\n"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*   -    . :       - callback -      */</span></span> $client-&gt;runTasks();</code> </pre><br><br>  Worker <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $worker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GearmanWorker(); $worker-&gt;addServer(<span class="hljs-string"><span class="hljs-string">'192.168.68.4'</span></span>); $worker-&gt;addFunction(<span class="hljs-string"><span class="hljs-string">'function_serial_send'</span></span>, <span class="hljs-string"><span class="hljs-string">'sendDataAndStatus'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* -   ,  worker  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($worker-&gt;work()){} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendDataAndStatus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GearmanJob $job)</span></span></span></span>{ $arr = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'one'</span></span>,<span class="hljs-string"><span class="hljs-string">'two'</span></span>, <span class="hljs-string"><span class="hljs-string">'three'</span></span>, <span class="hljs-string"><span class="hljs-string">'four'</span></span>, <span class="hljs-string"><span class="hljs-string">'five'</span></span>); $i = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($arr <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $diggo){ <span class="hljs-comment"><span class="hljs-comment">/*   -    1,5 2,5  ..   - Numerator,   ‚Äú‚Äù,  Denumenator - ‚Äú‚Äù.     ,    long*/</span></span> $job-&gt;sendStatus($i, count($arr)); <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> $job-&gt;sendData($diggo); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"send data: "</span></span>.$diggo, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $i++; sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/*   -       */</span></span> $job-&gt;sendComplete(<span class="hljs-string"><span class="hljs-string">''</span></span>); }</code> </pre><br><br>  Video of this example: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Qb3ap49GrS8%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhhPOla6XZbHv94_SeOD2oKfeUhNiw" frameborder="0" allowfullscreen=""></iframe><br><br><a name="bg"></a><br><h5>  Background Tasks and Priority </h5><br>  The status of the task is normal or background (synchronous / asynchronous) and the priority of its execution is set in the client.  If a task is added to the server as a background task, the client actually simply ‚Äúthrows‚Äù it onto the server and is not interested in its future.  If the task is normal, the client waits from the server for the result of its execution. <br>  For background tasks, the prefix background is used. <br>  For priorities there are three levels - normal (without prefixes), low / high sootv.  Low / High, for example, the addTaskHighBackground method ‚Äî add a high-priority background task. <br>  All this is well written in the <a href="http://ua2.php.net/manual/ru/book.gearman.php">office.</a>  <a href="http://ua2.php.net/manual/ru/book.gearman.php">documentation</a> in the GearmanClient section <br><br><a name="parallel"></a><br><h4>  Parallel computations in PHP using Gearman </h4><br>  For a snack, of course, the most delicious. <br>  The code of this example is somewhat voluminous, therefore it is not given, but there is nothing military in it: the client adds 800+ tasks to the queue server, 4 workers handle the tasks. <br>  The tasks themselves are the translation of pieces of text using the Yandex Translate API, the entire task as a whole is the translation of the book The Godfather from Russian into Ukrainian. <br>  Here's a video: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/XvdLPuuGB6Y%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhibP7xIJnyBlLBXqQlPzZpfcgNlaA" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/142210/">https://habr.com/ru/post/142210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142204/index.html">WinPhone DevHub - a mobile application that should be at hand with every WP7 developer</a></li>
<li><a href="../142206/index.html">codestre.am - terminal stream recording</a></li>
<li><a href="../142207/index.html">Should you use .Net for your startup?</a></li>
<li><a href="../142208/index.html">Gigapixel panoramas of two capitals</a></li>
<li><a href="../142209/index.html">Moody's lowered Nokia‚Äôs status to ‚Äúhigh-risk investment‚Äù</a></li>
<li><a href="../142211/index.html">Minesweeper on DCPU-16</a></li>
<li><a href="../142212/index.html">Using Grab: Spider for parsing sites</a></li>
<li><a href="../142213/index.html">Open Source Photo Realism on GPU: Cycles Render</a></li>
<li><a href="../142215/index.html">Personal account for the wholesale company. Is it really that hard?</a></li>
<li><a href="../142217/index.html">Google-sponsored research struggles with fake reviews</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>