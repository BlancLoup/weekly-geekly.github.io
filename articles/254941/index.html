<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Code Quality Visualization with PhpMetrics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I came across a great tool for analyzing PHP code. I publish the translation of an article with an overview of this tool. 
 

 PhpMetrics use...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Code Quality Visualization with PhpMetrics</h1><div class="post__text post__text-html js-mediator-article">  <i>Recently I came across a great tool for analyzing PHP code.</i>  <i>I publish the translation of an article with an overview of this tool.</i> <i><br></i> <br><br>  <a href="http://www.phpmetrics.org/">PhpMetrics</a> uses D3 and several complex algorithms to scan your application code and output intricate results reports. <br><img src="https://habrastorage.org/getpro/habr/post_images/790/f7e/366/790f7e3665ca06cd71a755bad23c3767.png" alt="image"><br><a name="habracut"></a><br><br><h4>  Installing and using PhpMetrics </h4><br>  It is a little difficult to discuss without having a good example in front of your eyes, so let's install and run the utility, and then we will look at every detail. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Environment </h5><br>  For the experiments we need an isolated environment.  As usual, we will use our trusty <a href="http://www.sitepoint.com/quick-tip-get-homestead-vagrant-vm-running/">Homestead Improved</a> Vagrant Box so that all readers have the same environment for experiments. <br><br><h5>  Install PhpMetrics </h5><br>  As with any modern PHP project, the installation is very simple.  Installation will perform globally, making it available to all projects on the machine. <br><br><pre><code class="bash hljs">sudo composer global require <span class="hljs-string"><span class="hljs-string">'halleck45/phpmetrics'</span></span></code> </pre> <br><br><h5>  Getting the code </h5><br>  We will test PhpMetrics on two heavyweight projects: Laravel and Symfony, let's consider frameworks, not projects.  This means that we will not use the Composer'a create-project command, but examine the source code of each framework. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/symfony/symfony symframe git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/laravel/framework lframe</code> </pre><br>  We do this to stay away from code that is not related to the framework. <br><br><h5>  Using PhpMetrics on a heavyweight project </h5><br>  Now that we have uploaded the projects, let's run PhpMetrics on them. <br><br><pre> <code class="bash hljs">mkdir Laravel mkdir Laravel/public phpmetrics --report-html=/Laravel/public/report_symfony.html symframe phpmetrics --report-html=/Laravel/public/report_laravel.html lframe</code> </pre><br>  Never mind that we use the ‚ÄúLaravel‚Äù directory for reports, it is just registered in the default settings of Homestead and we can use them for our small example to reduce the number of steps when setting up.  This allows us to easily access reports at the following addresses. <br><br><pre> <code class="bash hljs">homestead.app:8000/report_symfony.html homestead.app:8000/report_laravel.html</code> </pre><br>  This is what we see in the Laravel report: <br><img src="https://habrastorage.org/getpro/habr/post_images/9aa/bde/8d4/9aabde8d465493701ef84344aa2f3f73.png" alt="image"><br><br>  and this is what we get for symfony analysis: <br><img src="https://habrastorage.org/getpro/habr/post_images/23a/476/af9/23a476af94470fe37c5c43c1d5ba2b8d.png" alt="image"><br><br><h4>  Analysis </h4><br>  PhpMetrics offers many metrics.  Let's clarify the essence of these circles and graphs and find out exactly what we are looking at! <br><br><h5>  Color coding </h5><br>  After reviewing the guide to the report, we can immediately note that symfony has more orange-red, while Laravel has more green.  Note the important point - how many more files does Symfony have in relation to Laravel - you can clearly see this by comparing the density of the circles. <br>  PhpMetrics takes into account people with vision problems.  The ‚Äúcolor blind‚Äù checkbox changes the color of the circles from green, yellow and orange to stripes at different angles. <br><img src="https://habrastorage.org/getpro/habr/post_images/c46/364/b0c/c46364b0c6d66a787663c59a065d2875.png" alt="image"><br><br><h5>  Cyclomatic complexity and sustainability score </h5><br>  If you look closely, it becomes clear that the circles are indicators of CC and MI, and, as stated in the documentation, large red circles are likely to be very difficult to maintain. <br>  Both terms are easy to googling, but let me rid you of this and explain on your fingers. <br>  Cyclomatic complexity essentially shows the number of various paths through which you can go through the logic of the script.  The more paths, the higher the complexity of the file.  A good way to avoid high CC is to make the code as modular and atomic as possible; this happens naturally if you follow the SOLID principles. <br>  As Wikipedia says, the maintainability index is calculated using specific formulas based on the following metrics ‚Äî the number of lines of code, McCabe, Holstead.  The number of lines of code is self-evident - literally counting the number of lines of code.  The Mac Cabe metric is actually the second name for cyclomatic complexity.  Halstead's complexity is a set of formulas that try to look into the syntax of the code and derive properties such as coding complexity, a set of unique program commands, difficulty understanding the program, etc.  If you are interested in specific formulas, check out Wikipedia. <br>  Taking all this into account, the circles are set in size and color, reflecting the sum of all standard metrics of complexity and maintainability of the code. <br><br><h5>  Tables </h5><br>  If you want to see all the data in tabular form, you can select ‚ÄúExplore‚Äù in the report menu. <br><img src="https://habrastorage.org/getpro/habr/post_images/b59/732/c56/b59732c562c7596578912b110e9c441b.png" alt="image"><br><br>  This table will include all of the above and more - from the number of lines of code to the number of classes and, moreover, information for both the directory and the file.  This incredibly detailed report you need to search for very accurate information on the entire code in one place. <br><br><h5>  Customizable graphics </h5><br>  The middle area in the report contains a custom graph. <br><img src="https://habrastorage.org/getpro/habr/post_images/66f/a48/b85/66fa48b85f79dc5540c82ef7ab414b0e.png" alt="image"><br><br>  In the example above, we compare for each file the ratio CC (mentioned above) and Lcom (as far as the methods are not related to each other through properties), but you can easily switch the values ‚Äã‚Äãof the X and Y axes to something else.  For example, there is a comparison of complexity with the number of lines of code - you can note that the trend for Laravel is more proportional - the more Loc, the greater the complexity.  while for symfony the picture is more blurred for some files. <br><img src="https://habrastorage.org/getpro/habr/post_images/d4f/6a8/26f/d4f6a826ffe7c8527b6427d3bb65b5c6.png" alt="image"><br>  For example, the BinaryMode.php file Symfony has a very big complexity with 150 lines of code, and Response.php with 1275 lines has a very low complexity indicator.  Examine the files that give curious results and see what can be obtained from these observations. <br><br><h5>  Abstraction / Instability </h5><br>  This graph is very well explained <a href="http://pdepend.org/documentation/handbook/reports/abstraction-instability-chart.html">here</a> , but if it is short, the middle diagonal line is called the balance or the main sequence.  The goal is to keep your classes as close to the line as possible, because it means that they are balanced ‚Äî fairly abstract and concrete enough. <br>  <i>Note</i>  <i>translator: the author for some reason failed to build this graph.</i>  <i>To make it clear what I mean, I give an example for Yii2.</i> <i><br></i> <img src="https://habrastorage.org/getpro/habr/post_images/dfb/a0d/fb2/dfba0dfb2822365acf618abc8bbb4efc.png" alt="image"><br><br><h5>  Evaluation </h5><br>  Under the assessment refers to the graph, which reflects the average values ‚Äã‚Äãof various indicators of the entire project.  These values ‚Äã‚Äãare not absolute, but are given in comparison with modern projects considered by the tool at the moment.  On the report page there is a reservation, they say, the schedule is purely cosmetic, does not reflect an objective picture. <br><img src="https://habrastorage.org/getpro/habr/post_images/0dd/308/4d0/0dd3084d0a65ba642dfb0eb0a5877d0f.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/c02/9bb/f7b/c029bbf7b27422d7eef99b5506f9934a.png" alt="image"><br>  The tool considers both frameworks the same in terms of maintainability.  Not very shocking the conclusion that Laravel is friendlier to new developers and simpler in terms of algorithms, not to mention smaller volumes. <br><br><h5>  Map of connections </h5><br>  The map of connections is more useful for small projects - it allows you to see the connections between classes.  If a class extends or implements another, the map of links will show it.  Due to the fact that in both projects the number of classes and the connections between them are too large, the map is not so useful for our case - in fact, I did not have it built for Symfony.  But if you try to build it on a test project with a smaller number of links, you will definitely see the benefits. <br>  <i>Note</i>  <i>translator, so that it was clear what I was talking about, I give an example for Yii2</i> <i><br></i> <img src="https://habrastorage.org/getpro/habr/post_images/62a/578/4d2/62a5784d2dfcd53ab7689f701f91bc41.png" alt="image"><br><br><h5>  Redistribution </h5><br>  And finally, the redistribution information page summarizes all the results in a simpler form than on the Explore tab. <br><br>  Symfony: <br><img src="https://habrastorage.org/getpro/habr/post_images/264/995/e14/264995e1497fb104fe57c9e0016e5a42.png" alt="image"><br><br>  Laravel: <br><img src="https://habrastorage.org/getpro/habr/post_images/508/69d/85f/50869d85f4f8036e446f3372e186ed0a.png" alt="image"><br><br><h4>  Comparison results </h4><br>  So, what conclusions can be drawn from the results?  Without making a deep analysis, we can conclude that: <br><ol><li>  Laravel is more user-friendly for new developers, has simpler algorithms and less bloated files. </li><li>  Laravel is radically more lightweight.  Symfony has at least three times the most ‚Äî methods, classes, lines of code ... it's three times more massive. </li><li>  Symfony has a higher relative complexity (middle column in the redistribution report). </li><li>  Laravel is more stable in terms of complexity in files - complexity is proportional to the lines of code, in Symfony this is not the case. </li><li>  Symfony can work on dividing some complex files into more atomic files ‚Äî large red circles everywhere on the first graph. </li></ol><br>  See what else you can find out by playing on your own with graphs and numbers, let us know in the comments. <br><br><h4>  Conclusion </h4><br>  PhpMetrics is another tool in a long line of code quality analyzers, but with buns.  In comparison with the search for typical code problems by standard means, here we see a whole set of new attributes and explanations in excellent form.  To find out what each attribute means, refer to the <a href="http://www.phpmetrics.org/documentation/index.html">table</a> . <br>  Will you use phpMetrics to analyze your project?  Do you embed this tool <a href="http://plugins.jetbrains.com/plugin/7500">in your IDE</a> ?  Do you see this tool as a constant addition to your continuous integration process? </div><p>Source: <a href="https://habr.com/ru/post/254941/">https://habr.com/ru/post/254941/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254927/index.html">(Archive) 10 reasons to try Matryoshka</a></li>
<li><a href="../254931/index.html">(Translation) Introduction to C ++ Development in UE4</a></li>
<li><a href="../254933/index.html">Sample test items for iOS developers</a></li>
<li><a href="../254937/index.html">Secrets of exporting from Blender to Unity</a></li>
<li><a href="../254939/index.html">A detailed look at the legacy of Leibniz</a></li>
<li><a href="../254945/index.html">The digest of interesting materials for the mobile developer # 97 (March 30 - April 5)</a></li>
<li><a href="../254947/index.html">"Kings of the North" - the battle for gameplay</a></li>
<li><a href="../254949/index.html">Static analysis of PHP code on the example of Symfony2 (part 2)</a></li>
<li><a href="../254951/index.html">Thorns around gold</a></li>
<li><a href="../254955/index.html">Morphological image processing. Lectures from Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>