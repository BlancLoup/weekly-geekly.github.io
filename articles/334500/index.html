<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why Node.js as a frontend base is cool [updated]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the eve of the launch of the Node.js school from Yandex. Money, I would like to tell a little more about why this platform has taken root in our fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why Node.js as a frontend base is cool [updated]</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/1d9/00d/a3d/1d900da3d4f74cfa883990d32a30e49c.png"></p><br><p>  <strong>On the eve of the launch of the Node.js school from Yandex. Money, I would like to tell a little more about why this platform has taken root in our front end.</strong> </p><br><p>  A few years ago, in Yandex.Money, there was a change of platform for the front-end server layer: the one that was available was an internal proprietary development and was gradually dying from weak support and sagging performance speed.  Together with the slow work in runtime and the lack of development of XSLT, on which the API worked, this ‚Äúblack box‚Äù with many restrictions has come it‚Äôs time to replace. </p><br><p>  By "frontend" we understand not only the code executed in the browser, but also the server layer for data collection and HTML generation.  Node.js became a good substitute for the logic available. <a name="habracut"></a></p><br><h1 id="pochemu-nodejs">  Why Node.js </h1><br><p>  Instead of the traditional thread-based concurrency model, Node.js uses the principles of event-oriented systems ‚Äî compared to the ‚Äúone thread per connection‚Äù approach, the code is simpler and faster.  Node.js became popular thanks to the extensive NPM repository, an impressive developer community, and the ability to use JavaScript on the client, on the server, and for developing tools.  In general, our team liked all these advantages, so the choice was obvious. </p><br><div class="spoiler">  <b class="spoiler_title">A small historical excursion</b> <div class="spoiler_text"><p>  On September 2, 2008, the first public release of the open browser Chromium was officially presented, during the development of which the JavaScript interpreter V8 was also created.  They were rated as very fast and it was not far away when the ideas about using them on the server side began to appear. </p><br><p>  So, in 2009, the Node.js project appeared - a completely independent platform, including, besides V8, an embedded server and a basic set of libraries, as well as providing a fully asynchronous work with files and network devices using the libUV library. </p></div></div><br><p>  Since the Yandex.Money frontend is a collection of the client and Node.js, everything that the user interacts with or can get to gets into view of the front-end developer.  At the same time, the ‚Äúthick‚Äù business logic lives in separate backend components, which are provided by the public HTTP-based API for Node.js applications.  Backends know nothing about page entities and interface components, but they manipulate user entities, payments, settings, etc. </p><br><p>  From additional bonuses for the transition to a new technology - there is no need to retrain developers, and now not only one person can be engaged in supporting tool code. </p><br><h1 id="kak-novyy-freymvork-ustroilsya-v-nashem-frontende">  How is the new framework settled in our front end? </h1><br><p>  Our payment system is characterized by exactly the load for which Node.js was originally developed: many I / O operations (incoming requests and backend calls) and little work in one cycle, without complex synchronous calculations.  The result is a ‚Äúlive‚Äù event cycle in which the execution of operations is never blocked for long. </p><br><p>  Consider the logic of processing user requests in our Node.js applications: </p><br><ol><li><p>  The HTTP server on Node.js listens for incoming requests from users; </p><br></li><li><p>  it also processes the data from the request: parsing cookies, parsing the body of the post request, logging information about the request, etc .; </p><br></li><li><p>  then the URL is redirected to the processing logic: </p><br><ol><li><p>  in the process, the data required for the page is requested, they are aggregated and the subsequent execution of business logic; </p><br></li><li>  the server renders HTML from the collected data or generates another suitable response to the client (for example, json, binary file or redirect); </li></ol><br></li><li>  Node.js server places general response headers and sends the response to the client. </li></ol><br><p>  To implement all the processing logic of the request, we use <a href="http://expressjs.com/">Express</a> , the popular Node.js framework.  And for internal applications, <a href="http://koajs.com/">Koa 2 is used</a> , which allows you to write the entire request processing flow using <strong>Async Functions</strong> , a new JavaScript feature that greatly simplifies writing asynchronous JavaScript code. </p><br><p>  Moreover, Koa 2 will most likely appear on our external applications when Node.js 8 becomes LTS, which means it is suitable for installation on production servers.  It is in the eighth version that the V8 engine is used with the new TurboFan compiler, which optimizes Async Functions and allows them to be used in production. </p><br><blockquote>  You can learn more about V8 and the new optimizing compiler in the <a href="https://medium.com/devschacht/v8-behind-the-scenes-7ff45a7134fd">translation of the article by V8 developer Benedikt Meurer</a> . </blockquote><p>  Static files, such as js, css and images, are not distributed to Node.js by the server - for this there are more suitable web servers like Nginx.  In addition, more flexible caching control is available in Nginx.  Therefore, it is better to install a special web server in front of the Node.js application. </p><br><p>  Although Node.js executes the JavaScript code of your application in a single thread, it would be rash to start the process of processing all user requests for production into one stream, especially if you have multiple cores.  Therefore, we use clustering, that is, we generate a whole pool of individual Node.js processes ‚Äî workers ‚Äî from the main master process. </p><br><h1 id="metriki-i-grafiki">  Metrics and graphs </h1><br><p>  Like all our other services, the frontend is connected to the monitoring, and all its key indicators are displayed in real time on numerous team dashboards.  Supervision over schedules especially fascinates in days of releases or, for example, at a configuration of iron. </p><br><p>  <a href="http://graphiteapp.org/">Graphite</a> and <a href="https://prometheus.io/">Prometheus</a> are great for collecting metrics, and <a href="https://grafana.com/">Grafana</a> is responsible for a visual display of everything collected. </p><br><p>  Teams hang right in the office with teams displaying graphs and metrics of interest to them. </p><br><p><img src="https://habrastorage.org/web/af7/1c6/909/af71c69094894e01bdfa9d24bca74cde.png"><br>  <em>The dynamics of the key indicators of the frontend system.</em> </p><br><p>  The frontend team also has its own dashboard - the following graphs are displayed in real time: </p><br><ul><li><p>  HTML rendering time across all pages; </p><br></li><li><p>  number of incoming requests; </p><br></li><li><p>  processing time for incoming requests; </p><br></li><li><p>  the number of 5xx and 4xx status codes in the responses; </p><br></li><li><p>  execution time of outgoing requests to backends for all calls; </p><br></li><li>  Number of unsuccessful outgoing requests to backends. </li></ul><br><p>  Why for all this a separate TV?  First of all, you don‚Äôt always look into the mail and follow the alerts, but here everything is in front of your eyes and you don‚Äôt even need to turn on the laptop.  Secondly, it is possible to ‚Äústick‚Äù in the morning with the results of yesterday‚Äôs labor. </p><br><h1 id="s-chem-my-stolknulis">  What are we faced </h1><br><p>  The choice of Node.js as a platform for the server layer, in addition to many advantages, also entailed a certain amount of headaches for developers. </p><br><p>  For example, such large applications as ours, even with a good coverage of tests and documentation, each update is not easy: the constant presence in the change process comes not only from the desire of developers to please themselves or improve their product, but also from the realities of the modern world of JavaScript development . </p><br><p>  We use Node.js in conjunction with the binding of C ++ code in JavaScript, which we cannot abandon due to the existing infrastructure.  With each update of Node.js, we are faced not only with the standard difficulties of updating the migration guides, but also with updating our binding to support the next version of Node.js: libxml, libxslt and our internal C ++ libraries. </p><br><p>  In general, dependence on binders introduces additional overhead costs for support, so they should be avoided - for example, we try to translate our internal binders into separate HTTP services. </p><br><p>  A separate story is the asynchrony of Node.js, which still needs to be able to "prepare."  For example, at some point we noticed that from time to time the working worker fell due to a business logic error and restarted, although all the logic code in Express and Koa is wrapped in error catching and should be intercepted.  That is, the business logic described in the handlers of the route should not stop the whole Node.js process, but this happened to us all the same. </p><br><p>  An analysis of the situation revealed a curious feature.  When sent to the callback function in <a href="https://nodejs.org/dist/latest-v8.x/docs/api/process.html">process.nextTick</a> , it will start in the current clock cycle of the asynchronous cycle after the rest of the current clock code, including the error trapping code, is executed.  If Exception occurred inside such a function, it was not caught, because process.nextTick is not at all the ‚Äúnext clock‚Äù, but the end of the current one. </p><br><p>  There are still some nuances with ES2015: all our client code goes through Babyl transfiguration, which allows us to use any innovations of the language and not only the ES2015 standard.  But Node.js does not have such good support and a number of features are missing in it, and running the server code through Babel is a big headache when supporting and building code.  Thus, when writing JavaScript code, we need to always keep in mind the environment where this code will be executed, as well as adjust the linter rules in different ways. </p><br><p>  A pleasant cherry on the cake of difficulties can be considered the ‚Äúcomplicated‚Äù process of selecting modules for use.  Of course, there are recognized leaders in one or another area of ‚Äã‚Äãapplication, but even among them one can reasonably look for more suitable for each specific case.  Yes, the number of logic-reviews has increased, but Node.js and NPM are so good that we have a wide choice of open modules and the opportunity not to adapt to the technology, but to use the convenient one for us. </p><br><h1 id="pochemu-by-vsem-etim-ne-podelitsya">  Why not share it all </h1><br><p>  In the process of transition to modern technologies, we, of course, faced difficulties, stuffed bumps, but all of this paid off with invaluable experience and advantages that did not end exclusively in a single language for the client and server. </p><br><p>  To accumulate all this from scratch is long and unproductive, so our team decided to <strong>launch the Node.js development school and share experiences</strong> .  Training will begin on September 18, 2017, and you can apply now. </p><br><p>  During training, we will go through the following topics: </p><br><ul><li><p>  Web servers: variations and principles of operation; </p><br></li><li><p>  debugging and logging in Node.js; </p><br></li><li><p>  template engines and server HTML rendering; </p><br></li><li><p>  testing in Node.js: unit tests, integration tests; </p><br></li><li><p>  working with databases in Node.js; </p><br></li><li>  streams in Node.js. </li></ul><br><p>  In fact, the list is longer, you can see it on <a href="https://academy.yandex.ru/events/frontend/spb-2017/">the school page</a> .  But the salt itself will be in practice - over the course of 13 sessions we will together develop a server application for an electronic wallet for managing bank cards. </p><br><p>  <strong>Sign up and feel yourself as one of the developers of the whole Yandex.Money service.</strong> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/334500/">https://habr.com/ru/post/334500/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334486/index.html">We have long hands: 7 foreign sites where you can find remote work</a></li>
<li><a href="../334488/index.html">Build AngularJs Bundle Apps With Gulp</a></li>
<li><a href="../334490/index.html">Hackathon during working hours</a></li>
<li><a href="../334492/index.html">iRobot will sell data from IoT devices manufactured by the company</a></li>
<li><a href="../334498/index.html">How Chrome and Firefox agree to transfer two video streams</a></li>
<li><a href="../334502/index.html">‚ÄúI work on projects that integrate a book and an interactive‚Äù: Kay Horstmann about books and not only</a></li>
<li><a href="../334506/index.html">Do you want to encrypt any TCP connection at all? You now have a NoiseSocket</a></li>
<li><a href="../334510/index.html">In a section: the news aggregator on Android with backend. Introduction, idea, technology</a></li>
<li><a href="../334512/index.html">Nontrivial problems with generics and possible solutions.</a></li>
<li><a href="../334514/index.html">In a section: the news aggregator on Android with backend. Version Control System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>