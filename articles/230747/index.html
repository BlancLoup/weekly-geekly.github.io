<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of the Kutter-Jordan-Bossen method in MATLAB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Good day, users of Habr! 

 This article focuses on the software implementation of the Kutter-Jordan-Bossen steganographic method in MA...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of the Kutter-Jordan-Bossen method in MATLAB</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  Good day, users of Habr! <br><br>  This article focuses on the software implementation of the Kutter-Jordan-Bossen steganographic method in MATLAB. <br><br>  For those who do not know, I will explain: steganography is the science of the hidden transfer of information by keeping in secret the very fact of transmission.  In this method, the text information is recorded in the image according to a specific algorithm.  You can familiarize yourself with the algorithm itself in a post dated March 11, 2011 <a href="http://habrahabr.ru/post/115287/">‚ÄúKutter-Jordan-Bossen steganographic method‚Äù.</a>  A more detailed description of the algorithm can be found in the article Zaschelkin, Ivashchenko, Ivanov <a href="http://www.khai.edu/csp/nauchportal/Arhiv/REKS/2013/REKS513/Zaschelk.pdf">"Improving the steganographic concealment of Kutter-Jordan-Bossen data</a> . <a href="http://www.khai.edu/csp/nauchportal/Arhiv/REKS/2013/REKS513/Zaschelk.pdf">"</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now let's go directly to the code. <br><a name="habracut"></a><br><h5>  Main script </h5><br>  In connection with a sufficiently large amount of code, it was inconvenient to write it in one function, therefore, the code is divided into several functions.  The script, which code is shown below, allows you to encrypt a text message in an image, calling each function in turn. <br><br><pre><code class="matlab hljs">close all <span class="hljs-comment"><span class="hljs-comment">%      MATLAB clear; %     clc; %     %   RGB- rgbImg = imread('BMW-e36.bmp'); %      figure(1) imshow(rgbImg); title(['  *.bmp   RGB']); %     [ txt, bin_txt ]=read_txt(); disp(txt); %         [ rgbImgtxt, s, coords ]=KDB_write( rgbImg, bin_txt ); figure(2) imshow( rgbImgtxt ); title([ '   ' ]); %       [txt_new]=KDB_pull_out(rgbImgtxt,s,coords); disp(txt_new)</span></span></code> </pre> <br><br>  The first three lines are not required for the script to work correctly, however, they can make the process of working with the script more convenient by removing the data obtained from the last call of the script from the computer‚Äôs memory. <br><br><pre> <code class="matlab hljs">close all <span class="hljs-comment"><span class="hljs-comment">%      MATLAB clear; %     clc; %    </span></span></code> </pre><br><br>  The image is read into a variable using the imread command, and the name of the file is indicated in parentheses and, if necessary, the path to it. <br><br><pre> <code class="matlab hljs">rgbImg = imread(<span class="hljs-string"><span class="hljs-string">'BMW-e36.bmp'</span></span>);</code> </pre><br><br>  The read image is displayed on the screen using the imshow command, but to improve the perception of the result, the commands figure (create a new graphic window) and title (add a name in the graphic window) are used. <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%      figure(1) imshow(rgbImg); title(['  *.bmp   RGB']);</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ed/843/563/9ed84356334e1d6bd7c196108b543eb6.jpg"><br><br>  Read image. <br><br>  The text message to be encrypted must be read from the file and converted to binary.  This task is performed by the read_txt function.  This function returns to the script that called it two variables txt, bin_txt, in which the read text is written in symbolic as well as in binary form.  The disp (txt) command is used to display the text on the screen. <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%     [ txt, bin_txt ]=read_txt(); disp(txt);</span></span></code> </pre><br><br>  To write information to an image, the KDB_write function is called.  For this function to work, you must pass into it the value of the following variables: rgbImg, bin_txt.  The first variable contains the original image, and the second - the text converted to binary numbers.  The function returns the values ‚Äã‚Äãof the following variables: rgbImgtxt, s, coords. <br><br>  In the three-dimensional array rgbImgtxt recorded image with embedded data.  The vector s stores the size of the two-dimensional array bin_txt.  The three-dimensional coords array contains the coordinates of the pixels that have undergone a change, and is a kind of key for the subsequent extraction of embedded information.  After performing the function, an image is displayed on the screen, with embedded data. <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%         [ rgbImgtxt, s, coords ]=KDB_write( rgbImg, bin_txt ); figure(2) imshow( rgbImgtxt ); title([ '   ' ]);</span></span></code> </pre><br><br>  The KDB_pull_out function extracts the embedded information from the image and returns the encrypted text to the user, which is displayed on the screen. <br><br><pre> <code class="matlab hljs">[txt_new]=KDB_pull_out(rgbImgtxt,s,coords); <span class="hljs-built_in"><span class="hljs-built_in">disp</span></span>(txt_new)</code> </pre><br><br>  And now we will consider the work of each function separately. <br><br><h5>  The function of reading information from a text file </h5><br>  After the original image has been read, it is necessary to read the text message.  To do this, use the read_txt () function. <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ txt, bin_txt ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_txt</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span><span class="hljs-function"> %         %            %  </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt</span></span></span><span class="hljs-function">,      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt_r</span></span></span><span class="hljs-function">=''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt</span></span></span><span class="hljs-function">=''; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">text1</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('message.txt','r')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feof</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text1)</span></span></span><span class="hljs-function">==0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">line</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fgetl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt_r</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">char</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(txt_r,line)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fclose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1,:)</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt_r</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(find((double(txt_r)</span></span></span><span class="hljs-function">&gt;1040) + </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(double(txt_r)</span></span></span><span class="hljs-function">&lt;1103))); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(txt)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2:2:s(2)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bin_txt</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec2bin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(double(txt)</span></span></span><span class="hljs-function">)-'0'; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  The main task of this function is to read information from a text document and convert it to the optimal form for embedding. <br><br>  The file is opened using the fopen function in read mode, as indicated by the 'r' parameter. <br>  Using a while loop, the file will be read until its end is reached (then the feof function will produce a value of 1 and the loop will stop executing). <br><br>  In the body of the loop, the fgetl function is executed, which returns a string from the file, removing the end of line character.  This line is written to the variable line.  After that, the line variable is appended to the end of the text variable txt_r. <br><br>  After the information is received, the text file must be closed. <br><br><pre> <code class="matlab hljs">txt_r=<span class="hljs-string"><span class="hljs-string">''</span></span>; txt=<span class="hljs-string"><span class="hljs-string">''</span></span>; text1=fopen(<span class="hljs-string"><span class="hljs-string">'message.txt'</span></span>,<span class="hljs-string"><span class="hljs-string">'r'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> feof(text1)==<span class="hljs-number"><span class="hljs-number">0</span></span> line=fgetl(text1); txt_r=char(txt_r,line); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> fclose(text1);</code> </pre><br><br>  After that, using the find function, only the characters in the ASKII table are numbered from 1040 to 1103 are written into the txt variable in one line (the list includes Latin characters, Cyrillic, Arabic numerals, and punctuation marks).  To do this, you need to convert a variable of type char to double. <br><br>  To convert text characters to binary code, they are first converted to double type, and then the dec2bin function is used.  In order to get the final result in the form of a numeric array, rather than a string, you need to subtract the '0' symbol from dec2bin (double (txt)).  Matlab will perform these actions with character codes and return the result in numerical form. <br><br><pre> <code class="matlab hljs">txt(<span class="hljs-number"><span class="hljs-number">1</span></span>,:)=txt_r(<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>((double(txt_r)&gt;<span class="hljs-number"><span class="hljs-number">1040</span></span>) + (double(txt_r)&lt;<span class="hljs-number"><span class="hljs-number">1103</span></span>))); s=<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>(txt); txt=txt(<span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>:s(<span class="hljs-number"><span class="hljs-number">2</span></span>)); bin_txt=dec2bin(double(txt))-<span class="hljs-string"><span class="hljs-string">'0'</span></span>;</code> </pre><br><br><h5>  The function of recording information in the image </h5><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ rgbImgtxt, s, coords ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KDB_write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( rgbImg, bin_txt )</span></span></span><span class="hljs-function"> %       -- %     1    1  , %         ,     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L</span></span></span><span class="hljs-function">=0.1; % ,        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">=5; %      </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bin_txt)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">simg</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImg)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coordy</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([4,simg(1)</span></span></span><span class="hljs-function">-3],</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coordx</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([4,simg(2)</span></span></span><span class="hljs-function">-3],</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3, coordy, coordx)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgtxt</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImg</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">=1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function">=1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function">=1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> %   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0.298*rgbImg(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,1))+</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0.586*rgbImg(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,2))+</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0.114*rgbImg(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Y==0)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">=5/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> %        %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bin_txt(i,j)</span></span></span><span class="hljs-function">==1) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgtxt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImg(coords(i,j,k)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">, 3)+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgtxt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImg(coords(i,j,k)</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">, 3)-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImgtxt(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)&gt;255) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgtxt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)=255; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImgtxt(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)&lt;0) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgtxt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)=0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  This function is intended for embedding information by the Kutter-Jordan-Bossen method into an image saved in bmp format.  The original image and the binary code of the text to be embedded are transferred from the main script to it. <br><br>  The function determines the size of the array with binary character codes and the size of the image.  On the basis of the results obtained, two three-dimensional arrays are randomly generated, containing the coordinates of the pixels into which the embedding will be performed.  The number of layers in each array depends on the value of the variable r, is responsible for how many times one bit will be embedded.  In the first array coordinates are recorded vertically, and in the second - horizontally.  For convenience, these arrays are combined into one three-dimensional array. <br><br><pre> <code class="matlab hljs">s=<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>(bin_txt); simg=<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>(rgbImg); coordy=randi([<span class="hljs-number"><span class="hljs-number">4</span></span>,simg(<span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-number"><span class="hljs-number">-3</span></span>],s(<span class="hljs-number"><span class="hljs-number">1</span></span>),s(<span class="hljs-number"><span class="hljs-number">2</span></span>),r); coordx=randi([<span class="hljs-number"><span class="hljs-number">4</span></span>,simg(<span class="hljs-number"><span class="hljs-number">2</span></span>)<span class="hljs-number"><span class="hljs-number">-3</span></span>],s(<span class="hljs-number"><span class="hljs-number">1</span></span>),s(<span class="hljs-number"><span class="hljs-number">2</span></span>),r); coords=<span class="hljs-built_in"><span class="hljs-built_in">cat</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, coordy, coordx);</code> </pre><br><br>  The function uses three nested loops.  Two of them allow you to access the corresponding bits of the text message, the third - rewrites the bits. <br><br><pre> <code class="matlab hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> : s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">j</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> : s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k=<span class="hljs-number"><span class="hljs-number">1</span></span> : r</code> </pre><br><br>  The variable Y is recorded in the brightness of the pixel, in which the embedding will be carried out.  To determine it, it is necessary to determine the brightness value of each channel.  Image format bmp is stored as a three-dimensional matrix consisting of three layers.  In each layer recorded the brightness value for a particular color (from 0 to 255).  The resulting brightness value is multiplied by a certain constant and summed with the brightness values ‚Äã‚Äãof other channels.  If the brightness value is 0, you need to assign a variable a value of 5 / L. <br><br><pre> <code class="matlab hljs">Y=(<span class="hljs-number"><span class="hljs-number">0.298</span></span>*rgbImg(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">1</span></span>))+(<span class="hljs-number"><span class="hljs-number">0.586</span></span>*rgbImg(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">2</span></span>))+(<span class="hljs-number"><span class="hljs-number">0.114</span></span>*rgbImg(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Y==<span class="hljs-number"><span class="hljs-number">0</span></span>) Y=<span class="hljs-number"><span class="hljs-number">5</span></span>/L; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  The direct embedding of information occurs using a conditional operator.  If the text message bit is 1, the brightness of the blue channel of the image is increased by an amount equal to the product of L * Y.  Otherwise, this value will be subtracted from the brightness of the blue channel of the image.  In order to avoid possible overflow, you need to change the data type of uint8 to double. <br><br><pre> <code class="matlab hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bin_txt(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>)==<span class="hljs-number"><span class="hljs-number">1</span></span>) rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)=double(rgbImg(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)+L*Y); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)=double(rgbImg(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)-L*Y); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  If, after changing the brightness of the blue channel, the brightness value exceeds 255, then you need to set it equal to 255. And if the brightness value is less than 0, then set it equal to 0. <br><br><pre> <code class="matlab hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)&gt;<span class="hljs-number"><span class="hljs-number">255</span></span>) rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)=<span class="hljs-number"><span class="hljs-number">255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  After all the loop iterations have been completed, the message will be fully embedded in the image.  Visually determine what was embedded - it is almost impossible, especially with a small amount of embedded text. <br><br>  The function returns three variables to the script that caused it: rgbImgtxt, s, coordinates. <br><br><img src="https://habrastorage.org/files/c5c/d6d/057/c5cd6d0577a84a56bca61fd2a9db78c2.jpg"><br><br>  Image with embedded information <br><br>  To see the changes made to the image is almost impossible.  You can verify this by comparing the enlarged fragments of the image before and after embedding information into it. <br><br><img src="https://habrastorage.org/files/4d5/791/548/4d579154861f41c486557bd57da0a82b.jpg"><br><br>  Fragment of the original image <br><br><img src="https://habrastorage.org/files/11e/9db/945/11e9db9459fc47d19705cd701367f655.jpg"><br><br>  Fragment of the image with embedded information <br><br><h5>  The function of extracting information from the image </h5><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[ txt_new ]</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KDB_pull_out</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( rgbImgtxt, s, coords )</span></span></span><span class="hljs-function"> %       -- %         %   .      %          . </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgprog</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgtxt</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma</span></span></span><span class="hljs-function">=3; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">=5; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">=1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function">=1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">k</span></span></span><span class="hljs-function">=1 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function"> %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgprog</span></span></span><span class="hljs-function">=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(double(sum(rgbImgtxt(coords(i,j,k)</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k)</span></span></span><span class="hljs-function">+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)))+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sum(rgbImgtxt(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma</span></span></span><span class="hljs-function">:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">+</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma</span></span></span><span class="hljs-function">,3)))-2*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImgtxt(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3)))/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(4*sigma)</span></span></span><span class="hljs-function">; %        %    </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rgbImgtxt(coords(i,j,k)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coords</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j,k+3)</span></span></span><span class="hljs-function">,3))-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rgbImgprog</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( and(del==0,rgbImgprog==255)</span></span></span><span class="hljs-function"> ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">=0.5; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( and(del==0,rgbImgprog==0)</span></span></span><span class="hljs-function"> ) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">del</span></span></span><span class="hljs-function">=-0.5; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( del&gt;0 )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(k)</span></span></span><span class="hljs-function">=1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">else</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(k)</span></span></span><span class="hljs-function">=0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt_new_bin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i,j)</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">round</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sum(kat)</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt_new_doub</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bin2dec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num2str(txt_new_bin)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(txt_new_doub)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">txt_new</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">char</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reshape(txt_new_doub,s(2)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function">)); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br>  For the function to work, it is necessary to transfer an image with embedded information, the size of the array in which the binary codes of characters were written, and an array with the coordinates of the pixels into which the embedding was performed. <br><br>  The variable sigma sets the number of pixels spaced from a pixel with a modified brightness, which will be predicted for the initial brightness. <br><br>  As in the previous function, three cycles are used here.  They are responsible for accessing pixels with embedded information. <br><br><pre> <code class="matlab hljs"> sigma=<span class="hljs-number"><span class="hljs-number">3</span></span>; r=<span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> : s(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">j</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> : s(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k=<span class="hljs-number"><span class="hljs-number">1</span></span> : r</code> </pre><br><br>  At each iteration of the cycle, the predicted brightness of the blue channel of the pixel is found and compared with the actual one. <br><br>  In order to find the predicted brightness, the sum of the cells in the row is to the left and to the right of the pixel with the information, the cells located above and below the pixel.  Since the brightness value of the blue channel of the pixel itself with the embedded information is added twice, it needs to be multiplied by 2 and subtracted, and then divide the resulting number by the number of pixels used in the brightness calculation, in this function it is 12. <br><br><pre> <code class="matlab hljs">rgbImgprog=(double(sum(rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k)-sigma:coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k)+sigma,coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)))+double(sum(rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>)-sigma:coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>)+sigma,<span class="hljs-number"><span class="hljs-number">3</span></span>)))<span class="hljs-number"><span class="hljs-number">-2</span></span>*double(rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>)))/(<span class="hljs-number"><span class="hljs-number">4</span></span>*sigma);</code> </pre><br><br>  In order to decrypt the message, it is necessary to find the difference between the actual brightness of the blue channel and the predicted one.  Two options should also be considered when the difference between actual and predicted brightness is 0. <br><br>  In the first case, if the difference is 0, and the predicted brightness is 255, then any positive number, for example, 0.5, should be written to the variable del. <br><br>  If the difference and the predicted brightness are 0, then any negative number is written to the variable del. <br><br><pre> <code class="matlab hljs">del=double(rgbImgtxt(coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k),coords(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>,k+<span class="hljs-number"><span class="hljs-number">3</span></span>),<span class="hljs-number"><span class="hljs-number">3</span></span>))-rgbImgprog; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( and(del==<span class="hljs-number"><span class="hljs-number">0</span></span>,rgbImgprog==<span class="hljs-number"><span class="hljs-number">255</span></span>) ) del=<span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( and(del==<span class="hljs-number"><span class="hljs-number">0</span></span>,rgbImgprog==<span class="hljs-number"><span class="hljs-number">0</span></span>) ) del=<span class="hljs-number"><span class="hljs-number">-0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  In order to extract a message, it is necessary to compare the value of the variable del from 0. In case it is greater than 0, then 1 is written in the vector kat, otherwise - 0. <br><br><pre> <code class="matlab hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( del&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> ) kat(k)=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> kat(k)=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Since each bit is written to the image a certain number of times, (in our case, 3 times), we get a vector of three digits.  These figures may be different, since the extraction of information is probabilistic in nature.  In order to find the true value of the ciphertext bit, it is necessary to find the arithmetic average of all elements of the vector and perform rounding. <br><br><pre> <code class="matlab hljs">txt_new_bin(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>)=<span class="hljs-built_in"><span class="hljs-built_in">round</span></span>(sum(kat)/r);</code> </pre><br><br>  After the value of all bits of the message is found, they must be converted to type char and written as a string: <br><br><pre> <code class="matlab hljs">txt_new_doub=bin2dec(num2str(txt_new_bin)); s=<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>(txt_new_doub); txt_new=char(<span class="hljs-built_in"><span class="hljs-built_in">reshape</span></span>(txt_new_doub,s(<span class="hljs-number"><span class="hljs-number">2</span></span>),s(<span class="hljs-number"><span class="hljs-number">1</span></span>)));</code> </pre><br><br>  After this, the function will transfer the txt_new variables to the script with the extracted message.  This message may differ slightly from the source text, but remains readable.  The occurrence of errors is due to the fact that the brightness prediction does not always give an objective result (for example, the presence of a large number of small contrasting details on the image). <br><br>  I embedded the phrase ‚ÄúBavarian Motor Works‚Äù into the image.  As a result of 10 attempts at embedding-extracting information, I obtained the following results: <br><br><pre> <code class="matlab hljs">    &gt;     <span class="hljs-number"><span class="hljs-number">0</span></span>                    </code> </pre><br><br>  In order to avoid this inaccuracy, you can increase the number of embeddings of one bit and increase the size of the ‚Äúcross‚Äù, according to which brightness is predicted.  However, these methods are effective until a certain point.  In order to achieve the best result, it is necessary to use robust coding. <br><br>  Thank you for attention! <br><br>  List of sources used: <br><br>  1. <a href="http://habrahabr.ru/post/115287/">"Kutter-Jordan-Bossen's steganographic method."</a> <br>  2. <a href="http://www.khai.edu/csp/nauchportal/Arhiv/REKS/2013/REKS513/Zaschelk.pdf">Article by Zaschelkin, Ivashchenko, Ivanov ‚ÄúImprovement of the steganographic concealment of Kutter-Jordan-Bossen data‚Äù</a> . </div><p>Source: <a href="https://habr.com/ru/post/230747/">https://habr.com/ru/post/230747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230729/index.html">Fun with reluctance, or especially working with freelancers</a></li>
<li><a href="../230733/index.html">Port Flappy Bird on Gear 2</a></li>
<li><a href="../230735/index.html">Play with server jabber.ru</a></li>
<li><a href="../230737/index.html">What do not need to code yourself</a></li>
<li><a href="../230743/index.html">About the leak of the user password database</a></li>
<li><a href="../230749/index.html">One-page IDE in the browser [AngularJS / Ace]</a></li>
<li><a href="../230751/index.html">What is HTML import and how does it work?</a></li>
<li><a href="../230753/index.html">How does Grunt work: see the source</a></li>
<li><a href="../230755/index.html">Juniper SRX: Upgrading JunOS Version</a></li>
<li><a href="../230757/index.html">Free up hard disk space: WIMBoot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>