<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>It doesn't matter who you are ... it matters what your APN is!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article focuses on a little trick to which a virtual OCOSOC can resort to deceive its subscribers in the process of providing packet data service...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>It doesn't matter who you are ... it matters what your APN is!</h1><div class="post__text post__text-html js-mediator-article">  This article focuses on a little trick to which a virtual OCOSOC can resort to deceive its subscribers in the process of providing packet data services.  Our focus will be on the process of selecting and using the Access Point Name [APN]. <br>  As we remember from the <a href="http://habrahabr.ru/blogs/telecom/81385/">GPRS</a> article <a href="http://habrahabr.ru/blogs/telecom/81385/">from the inside.</a>  <a href="http://habrahabr.ru/blogs/telecom/81385/">Part 2</a> , APN is used during the PDP Context activation procedure and is intended to determine the service requested by the subscriber. <br><br><a name="habracut"></a><br><br>  The services provided by the resources of the mobile operator's packet network can be: <br><ul><li>  Mobile internet </li><li>  Intranet VPN access </li><li>  Mms </li><li>  Wap </li><li>  LAN over GPRS </li><li>  <a href="http://ru.wikipedia.org/wiki/PTT">PTT</a> [Push-To-Talk] </li><li>  SMS over GPRS * <br><blockquote>  * - APN is not used to provide services for sending short messages and there is no need to activate the PDP Context, it is enough to carry out the GPRS Attach procedure. </blockquote></li></ul><br>  Let us consider in more detail the mechanisms for choosing and using the <a href="http://en.wikipedia.org/wiki/Access_Point_Name">APN (en)</a> - Access Point Name in a GPRS session.  Let's start with the limitations, the APN should <b>NOT</b> : <br><ul><li>  end in '.gprs' * </li><li>  have special characters in the name (?% # $ *) ** </li><li>  be less than 1 character and more than 63 characters * </li><li>  start with combinations of sequences of characters: LAC, RAC, SGSN, RNC </li><li>  start with operator code (see below) </li></ul><br>  <em>* - This restriction applies to the so-called.</em>  <em>Network ID (see below)</em> <em><br></em>  <em>** - only alphanumeric sequences of characters are used: 'A ... Z', 'a ... z', '0 ... 9', as well as the characters'.</em>  <em>- '</em> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      An APN must also begin with an alphanumeric character string and is not case sensitive on the SGNS side. <br><br>  <b><i>Functionally, the</i></b> APN is designed to determine the IP address of the GGSN, which will provide the service requested by the subscriber when the PDP context is activated. <br>  <b><i>Optionally, an</i></b> APN consists of two parts ‚Äî a network identifier (mandatory part) and an operator identifier (optional part): <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/944/f62/269/944f622699df95ab00c2435c32c736f3.png" alt="image"><br><ul><li>  the network identifier determines the IP address of the GGSN or several GGSNs and, as a first approximation, determines the type of network to which the GGSN has output; </li><li>  The operator ID is the network settings of the operator in which the serving GGSN is located and consists of the <a href="http://ru.wikipedia.org/wiki/MNC">MNC</a> and <a href="http://ru.wikipedia.org/wiki/MCC">MCC</a> (for example, mnc009.mcc255.gprs is a certain operator, Ukraine - which is also called GOI [GGSN Operator Identifier]), if the APN name is missing these data, then for subscribers of the SGSN home network the operator will add the so-called Default APN Operator Identifier, prescribed in SGSN for the subscriber‚Äôs home network, so-called.  HPLMN *; <br><blockquote>  * - for a mobile network subscriber, there is the concept of a home network [HPLMN], i.e.  networks in which the tariffs specified in the contract for the provision of network services will operate, but there is also the concept of a guest or roaming network [VPLMN], in which tariffs will operate according to the roaming agreement between the operators.  In this case, the home network for the subscriber will be only one, and there may be several guest networks. </blockquote></li></ul><br>  The operator ID can be added to the APN in various ways: <br><ul><li>  Received from the subscriber when the PDP Context is activated (registered in the APN itself). </li><li>  Generated from the <a href="http://ru.wikipedia.org/wiki/IMSI">IMSI</a> subscriber if the guest user is roaming and requests access to his home network. </li><li>  Obtained from the GOI [Default APN Operator Identifier] parameter, which is assigned to the SGSN for the network to which the subscriber belongs </li></ul><br>  The full APN name (including the operator ID) is used to resolve the IP address of the GGSN that will serve the specified APN.  On the side of the local DNS operator, the APN will be ‚Äúdecrypted‚Äù from right to left, i.e.  determine the gprs domain service area, then the mcc255 domain service area, etc.  Before activating the PDP Context, the SGSN receives a user profile from the HLR.  In the user profile, the APN parameter may indicate the APN's allowed for use by the subscriber, or the ‚Äú*‚Äù sign, which allows the use of any of the existing APNs in the operator‚Äôs network.  If the profile contains a list of several allowed APNs, then the first APN in the list has a higher priority than the others - see examples. <br><br>  For each PLMN, be it Home PLMN or Visitor PLMN, most vendors allow you to register on SGSN, so-called.  Default APN Operator Identifier [DEFAPN], which is automatically substituted as a Network Identifier, i.e.  actually replacing the APN requested by the subscriber, but only if the subscriber made a mistake in writing the APN, or the operator APN that does not exist in the network is indicated.  The main idea of ‚Äã‚Äãusing the DEFAPN parameter is to reduce the number of unsuccessful attempts to activate PDP Context, in case subscribers make a mistake, i.e.  indicated wrong APN in connection settings.  Using the DEFAPN parameter is optional and does not affect the overall functionality, i.e.  the operator may not acquire licenses to use this functionality.  In addition to the DEFAPN settings, usually the SGSN'e mandatory setting is permission to overwrite the requested APN [Override of the requested APN], as well as separate override settings of the requested APN for the [Override of roaming APN] roaming subscribers. <br><br>  But what prevents the operator from using additional functionality for their own benefit ... :) <br><br>  The scenario is almost the same for both roaming subscribers and subscribers in their home network, the only difference is that the replacement parameters of the requested APN must be specified for the PLMN the user belongs to (i.e., either HPLMN or VPLMN) therefore all of the below is equally applicable to both subscriber location scenarios in both the roaming network (VPLMN) and the home network (HPLMN). <br><ol><li>  <b>Smart caller</b> <br>  <i>It is given: the</i> subscriber indicated in the phone settings an existing APN (for example, opsos.com.ua), access to which he is allowed.  In his profile on the HLR, the list of allowed APNs is indicated (for example, in this order - internet, opsos.com.ua, mms.opsos.com.ua). <br><ul><li>  <b><i>DEFAPN</i></b> Activated, <b><i>Override of Requested APN</i></b> Permited <br>  <i>Subscriber to be in your home network:</i> <br>  SGSN will add the GOI specified for HPLMN to the requested APN (i.e. for our virtual operator it is mnc009.mcc255.gprs), the full name of the APN - opsos.com.ua.mnc009.mcc255.gprs will be resolved to the IP address of the GGSN that will serve GPRS session.  PDP Context for the subscriber will be successfully activated by the APN indicated by him (in our case it will be opsos.com.ua), the tariffs for using the packet transmission will correspond to the tariffs of the access point opsos.com.ua. <br>  <i>Subscriber to be in the guest network:</i> <br>  in the guest network, the SGSN will add the GOI APN of the home network to the specified name, based on the information from the IMSI, send a request to the DNS server and get the GGSN IP address in the operator‚Äôs home network, then redirect the PDP Context to the subscriber‚Äôs home network, i.e.  while roaming, subscribers use a roaming SGSN, but all traffic passes through their home GGSN.  Tariffs for using packet transmission will correspond to the subscriber's roaming tariffs of the access point opsos.com.ua. <br></li><li>  <b><i>DEFAPN</i></b> NOT Activated, <b><i>Override of Requested APN</i></b> NOT Permited <br>  Further developments are almost similar for both roaming subscribers and subscribers in their home network (HPLMN), so we will not consider two scenarios, but only point out the main differences. <br>  In this scenario, events will not change anything, the subscriber will be able to activate the PDP Context by APN - opsos.com.ua, the tariffs for using the packet transfer services will correspond to the tariffs of the access point opsos.com.ua. <br></li></ul><br></li><li>  <b>Typical subscriber</b> <br>  <i>It is given: the</i> subscriber indicated an existing APN in the settings, for example, internet (or any other APN existing in the operator‚Äôs network), while the subscriber‚Äôs settings on the HLR (in its profile) are indicated with "*" in the APN parameter. <br><ul><li>  <b><i>DEFAPN</i></b> Activated, <b><i>Override of Requested APN</i></b> Permited <br>  The subscriber will be able to activate the PDP Context for the APN - internet specified by him, the tariffs for using the packet transfer services will correspond to the tariffs of the internet access point, since  DEFAPN parameter does not participate in subscriber context activation. <br></li><li>  <b><i>DEFAPN</i></b> NOT Activated, <b><i>Override of Requested APN</i></b> NOT Permited <br>  The subscriber will be able to activate the PDP Context for the APN - internet indicated by him, the tariffs for using the packet transfer services will correspond to the tariffs of the internet access point. <br></li></ul></li><li>  <b>Almost smart subscriber</b> <br>  <i>It is given: the</i> subscriber indicated in the phone settings <b>NOT an</b> existing APN (for example, mega.fast.internet), or the subscriber will indicate the existing APN in the settings, but which will not be present in the list of allowed APNs in the subscriber profile from the HLR.  In his profile on the HLR, the list of allowed APNs is indicated (for example, in this order - internet, opsos.com.ua, mms.opsos.com.ua). <br><br><ul><li>  <b><i>DEFAPN</i></b> Activated, <b><i>Override of Requested APN</i></b> Permited <br>  In this case, because  on the SGSN side, the subscriber profile will be received from the HLR, the first APN in the list will be determined and the PDP Context will be activated by this first APN. <br><blockquote>  Here there is a small nuance, tk.  the subscriber does not have the right to somehow interfere in changing his profile, that is, the likelihood that the first APN in the list will allow him to ‚Äúturn out‚Äù APN, the usage rates of which will not be quite small. </blockquote><br></li><li>  <b><i>DEFAPN</i></b> NOT Activated, <b><i>Override of Requested APN</i></b> NOT Permited <br>  In this case, the user will receive a Reject (rejection) to activate the PDP Context and will not be able to use the requested service until he has indicated one of the APNs indicated in his profile with HLR. <br></li></ul><br></li><li>  <b>"Gifted" subscriber + a little trick (read LOYALTY) operator</b> <br>  <i>It is given:</i> for the first time the subscriber hears the word APN (or indicated a non-existent APN / made a mistake when entering the existing APN), in his profile the ‚Äú*‚Äù is set to HLR instead of the APN. <br><br><ul><li>  <b><i>DEFAPN</i></b> Activated, <b><i>Override of Requested APN</i></b> Permited <br>  Suppose in the default SGSN settings for PLMN subscribers to which the subscriber belongs, for example, DEFAPN - expensive.net with the ‚Äúcheapest‚Äù (say, packet data transmission under APN expensive.net is the most expensive tariff in the operator‚Äôs network) is set for using packet data .  In this case, because  if the subscriber indicated not a ‚Äúcorrect‚Äù APN, then his requested APN will be replaced with the one specified in DEFAPN, i.e.  - expensive.net. <br><blockquote>  Another ‚Äúnuance‚Äù appears here, if the subscriber will connect to the network under the specified conditions, then he will pay for the services on the ‚Äúceiling‚Äù itself, i.e.  at the expensive.net rate. </blockquote><br></li><li>  <b><i>DEFAPN</i></b> NOT Activated, <b><i>Override of Requested APN</i></b> NOT Permited <br>  In this event scenario, the subscriber will receive a Reject to activate the PDP Context and will not be able to use the packet data services. <br></li></ul><br></li></ol><br>  Actually, with the help of such small tricks our virtual mobile operator can deceive its subscribers. <br><br>  <b>Conclusion:</b> always monitor the settings and parameters that are transmitted in any communication, including when using GPRS / EDGE services in the networks of mobile operators, because  very often the network skips the message about the indignation of data services and large bills for the use of mobile communication, and to get some sane response from the operator, sometimes very, very difficult. <br><br>  <b>. .:</b> when writing an article, not a single cellular subscriber suffered, since  in our country, all operators are "honest" and fluffy :-) <br><br>  <b><i>A small assistant:</i></b> <br><br>  <b>APN</b> - Access Point Name <br>  <b>GGSN</b> - Gateway GPRS Support Node <br>  <b>GOI</b> - GGSN Operator Identifier <br>  <b>GPRS</b> - General Packet Radio Service <br>  <b>HLR</b> - Home Location Register <br>  <b>HPLMN</b> - Home PLMN <br>  <b>IMSI</b> - International Mobile Subscriber Identity <br>  <b>LAC</b> - Location Area Code <br>  <b>MCC</b> - Mobile Country Code <br>  <b>MNC</b> - Mobile Network Code <br>  <b>PDN</b> - Packet Data Networks <br>  <b>PDP</b> - Packet Data Protocol <br>  <b>PLMN</b> - Public Land Mobile Network <br>  <b>RAC</b> - Routing Area Code <br>  <b>RNC</b> - Radio Network Controller <br>  <b>SGSN</b> - Serving GPRS Support Node <br>  <b>VPLMN</b> - Visitor PLMN <br><br>  <b><i>Related links (en):</i></b> <br><ul><li> <a href="http://www.3gpp.org/ftp/Specs/html-info/23003.htm">3GPP TS 23.003 Numbering, addressing and identification</a> </li><li>  <a href="http://www.3gpp.org/ftp/Specs/html-info/29061.htm">PLMN supporting packet based services and PDN</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/79505/">https://habr.com/ru/post/79505/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79492/index.html">Ant-bot. Worklog. Part 1</a></li>
<li><a href="../79495/index.html">How to remember a bunch of secure passwords, and do not go crazy</a></li>
<li><a href="../79500/index.html">DRWEB - virus database update</a></li>
<li><a href="../79501/index.html">Soon the new year!</a></li>
<li><a href="../79502/index.html">Open beta test MechWarrior: Living Legends</a></li>
<li><a href="../79507/index.html">Do I need a book on F # in Russian?</a></li>
<li><a href="../79511/index.html">Smile! Chef loves ... when they smile</a></li>
<li><a href="../79513/index.html">Python Plugins</a></li>
<li><a href="../79515/index.html">H-1, apotheosis and epic fail of the sixties</a></li>
<li><a href="../79518/index.html">"We know how it works." The final</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>