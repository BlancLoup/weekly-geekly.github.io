<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Saving "many to many" in Yii2 through behavior</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you had to work with Yii2, there must have been a situation when it was necessary to keep the ‚Äúmany-to-many‚Äù relationship. 

 When it became clear ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Saving "many to many" in Yii2 through behavior</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bbc/479/335/bbc47933552e4c90846c80e731b06ddf.jpg" align="left" width="330">  If you had to work with Yii2, there must have been a situation when it was necessary to keep the ‚Äúmany-to-many‚Äù relationship. <br><br>  When it became clear that there were no behaviors on the network to work with this type of connection, then the necessary code was written on the ‚Äúafter save‚Äù event and with the ‚Äúwell works‚Äù message was sent to the repository. <br><br>  Personally, I did not like this alignment of events.  I decided to write the same magical behavior, which is so lacking in the official assembly of Yii2. <br><a name="habracut"></a><br><h2>  Installation </h2><br>  Install via Composer: <br><pre><code class="bash hljs">php composer require --prefer-dist voskobovich/yii2-many-many-behavior <span class="hljs-string"><span class="hljs-string">"~3.0"</span></span></code> </pre> <br>  Or add to your project‚Äôs <i>composer.json</i> in the ‚Äúrequire‚Äù section: <br><pre> <code class="bash hljs"><span class="hljs-string"><span class="hljs-string">"voskobovich/yii2-many-many-behavior"</span></span>: <span class="hljs-string"><span class="hljs-string">"~3.0"</span></span></code> </pre><br>  We carry out: <br><pre> <code class="bash hljs">php composer update</code> </pre><br>  Sources on <a href="https://github.com/voskobovich/yii2-many-to-many-behavior">github</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  How to use? </h2><br>  For example, take the popular form of communication Publication and Categories. <br><br>  We connect behavior to the Publication. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [[<span class="hljs-string"><span class="hljs-string">'category_ids'</span></span>], <span class="hljs-string"><span class="hljs-string">'each'</span></span>, <span class="hljs-string"><span class="hljs-string">'rule'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'integer'</span></span>]], ... ]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \voskobovich\behaviors\ManyToManyBehavior::className(), <span class="hljs-string"><span class="hljs-string">'relations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'category_ids'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'categories'</span></span>, ], ], ]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCategories</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasMany(Category::className(), [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'category_id'</span></span>]) -&gt;viaTable(<span class="hljs-string"><span class="hljs-string">'{{%post_has_category}}'</span></span>, [<span class="hljs-string"><span class="hljs-string">'post_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($keyField = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'id'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $valueField = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'name'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $asArray = true)</span></span></span><span class="hljs-function"> </span></span>{ $query = <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::find(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($asArray) { $query-&gt;select([$keyField, $valueField])-&gt;asArray(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ArrayHelper::map($query-&gt;all(), $keyField, $valueField); } ... }</code> </pre><br>  The behavior will create a new <u>category_ids</u> attribute in the model.  It will take an array of primary key categories from the form or by API. <br><br>  Behavior can be configured to work with several links at once.  For example, a Publication may be associated with Categories, Tags, Users, Images, etc. <br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'relations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'category_ids'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'categories'</span></span>, <span class="hljs-string"><span class="hljs-string">'user_ids'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-string"><span class="hljs-string">'tag_ids'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'tags'</span></span>, ... ]</code> </pre><br>  All attributes created by the behavior <b>must be</b> mentioned in the validation rules.  Try to write meaningful rules, and not specify them in the group ‚Äúsafe‚Äù and ready. <br><br>  Now we will create in the view a field for selecting categories. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span>= $form-&gt;field($model, <span class="hljs-string"><span class="hljs-string">'category_ids'</span></span>)-&gt;dropDownList(Category::listAll(), [<span class="hljs-string"><span class="hljs-string">'multiple'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>]) <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  I have been using the <u>listAll ()</u> method for a long time in my projects and now I have the opportunity to share it.  It is great for filling out multi-selections in GridView forms and filters. <br><br>  Everything after these manipulations Categories should be attached to Publications without any problems. <br><br><h2>  What about optimization and security? </h2><br>  The request for the formation of a list of primary keys occurs <b>only</b> at the moment of reading the property, and not when selecting a model.  Until you contact him - the request will not leave. <br>  The entire logic of link management behavior is wrapped in a transaction. <br><br><h2>  Further more </h2><br>  Quite often, the task goes beyond the standard ‚Äúsave / get‚Äù related models.  For such tasks, the behavior provides advanced settings. <br><br><h3>  Custom getters and setters </h3><br>  Often, for different js plugins, you need to be able to give data in JSON or a string like "1,2,3,4".  Customize the behavior: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \voskobovich\behaviors\ManyToManyBehavior::className(), <span class="hljs-string"><span class="hljs-string">'relations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'category_ids'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'categories'</span></span>, <span class="hljs-string"><span class="hljs-string">'fields'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'json'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'get'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JSON::encode($value); }, <span class="hljs-string"><span class="hljs-string">'set'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JSON::decode($value); }, ], <span class="hljs-string"><span class="hljs-string">'string'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'get'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> implode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $value); }, <span class="hljs-string"><span class="hljs-string">'set'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> explode(<span class="hljs-string"><span class="hljs-string">','</span></span>, $value); }, ], ], ] ], ], ]; }</code> </pre><br>  With this configuration, the model will have 3 new attributes <u>category_ids</u> , <u>category_ids_json</u> and <u>category_ids_string</u> .  As can be seen from the configuration, you can not only change the format of outgoing data, but also process the data included in the attribute.  For example, parse a string or JSON into an array of primary keys. <br>  <a href="https://github.com/voskobovich/yii2-many-to-many-behavior">View in documentation</a> . <br><br><h3>  Managing field values ‚Äã‚Äãof the link table </h3><br>  Often the link contains not only primary keys, but also additional information.  For example: creation date or sorting order.  In this case, the behavior can also be configured: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \voskobovich\behaviors\ManyToManyBehavior::className(), <span class="hljs-string"><span class="hljs-string">'relations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'category_ids'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'categories'</span></span>, <span class="hljs-string"><span class="hljs-string">'viaTableValues'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'status_key'</span></span> =&gt; PostHasCategory::STATUS_ACTIVE, <span class="hljs-string"><span class="hljs-string">'created_at'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \yii\db\Expression(<span class="hljs-string"><span class="hljs-string">'NOW()'</span></span>); }, <span class="hljs-string"><span class="hljs-string">'is_main'</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($model, $relationName, $attributeName, $relatedPk)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      return array_search($relatedPk, $model-&gt;category_ids) === 0; }, ], ] ], ], ]; }</span></span></code> </pre><br>  <a href="https://github.com/voskobovich/yii2-many-to-many-behavior">View in documentation</a> . <br><br><h3>  Setting default values ‚Äã‚Äãfor orphaned models </h3><br>  I understand, the headline sounds weird, but it's the right thing. <br>  The fact is that behavior can work not only with a many-to-many connection, but also with one-to-many. <br>  In the first case, the records from the link table are simply deleted and new ones are written in their place. <br>  In the second type of connection, it is implied that you first need to make the connected models orphaned (untie), and then shelter them back (tie). <br>  As a result, some models can remain orphans and need to be placed in a certain ‚ÄúArchive‚Äù.  Just to configure the owner of all orphaned records and created the <u>default</u> parameter.  If you do not specify it, then the entries in the binding field will be null. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \voskobovich\behaviors\ManyToManyBehavior::className(), <span class="hljs-string"><span class="hljs-string">'relations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'category_ids'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'categories'</span></span>, <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">17</span></span>, ] ], ], ]; }</code> </pre><br>  <a href="https://github.com/voskobovich/yii2-many-to-many-behavior">View in documentation</a> . <br><br><h3>  The removal condition from the link table </h3><br>  Often in the connecting table are stored records of the same structure but of different types. <br>  For example: in the <i>product_has_attachment</i> table there are photos and prices of the goods.  For each type of attachment has its own connection. <br>  But what will happen if we add a new price to the product?  All records from the <i>product_has_attachment</i> table associated with this product will be <b>destroyed</b> and old prices + new will be written in their place. <br>  But ... but ... after all, there were not only prices, but also photos ... hell! <br>  To avoid this, you need to configure the behavior: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActiveRecord</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">behaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; \voskobovich\behaviors\ManyToManyBehavior::className(), <span class="hljs-string"><span class="hljs-string">'relations'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'image_ids'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'images'</span></span>, <span class="hljs-string"><span class="hljs-string">'viaTableValues'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type_key'</span></span> =&gt; ProductHasAttachment::TYPE_IMAGE, ], <span class="hljs-string"><span class="hljs-string">'customDeleteCondition'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type_key'</span></span> =&gt; ProductHasAttachment::TYPE_IMAGE, ], ], <span class="hljs-string"><span class="hljs-string">'priceList_ids'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'priceLists'</span></span>, <span class="hljs-string"><span class="hljs-string">'viaTableValues'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type_key'</span></span> =&gt; ProductHasAttachment::TYPE_PRICE_LIST, ], <span class="hljs-string"><span class="hljs-string">'customDeleteCondition'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'type_key'</span></span> =&gt; ProductHasAttachment::TYPE_PRICE_LIST, ], ] ], ], ]; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasMany(Attachment::className(), [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'attachment_id'</span></span>]) -&gt;viaTable(<span class="hljs-string"><span class="hljs-string">'{{%product_has_attachment}}'</span></span>, [<span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($query)</span></span></span><span class="hljs-function"> </span></span>{ $query-&gt;andWhere([ <span class="hljs-string"><span class="hljs-string">'type_key'</span></span> =&gt; ProductHasAttachment::TYPE_IMAGE, ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $query; }); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPriceLists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasMany(Attachment::className(), [<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'attachment_id'</span></span>]) -&gt;viaTable(<span class="hljs-string"><span class="hljs-string">'{{%product_has_attachment}}'</span></span>, [<span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($query)</span></span></span><span class="hljs-function"> </span></span>{ $query-&gt;andWhere([ <span class="hljs-string"><span class="hljs-string">'type_key'</span></span> =&gt; ProductHasAttachment::TYPE_PRICE_LIST, ]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $query; }); } ... }</code> </pre><br>  Thus, when a new price list is added, only the list of price lists will be affected, the pictures will remain untouched. <br>  <a href="https://github.com/voskobovich/yii2-many-to-many-behavior">View in documentation</a> . <br><br>  This article reflects only part of the functional behavior. <br>  For more accurate information, I recommend looking at the <a href="https://github.com/voskobovich/yii2-many-to-many-behavior">documentation</a> . <br>  Moreover, I update the article less often than the README repository. <br><br>  I sincerely hope that my behavior makes working with connections easier and simpler. <br>  If this is the case, put the stars on github and recommend it to your friends, because there are still those who have not heard of it and continue to ‚Äúrebuild crutch bikes‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/244709/">https://habr.com/ru/post/244709/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244697/index.html">InterSystems iKnow. Part two. Creating a simple domain</a></li>
<li><a href="../244699/index.html">We integrate AutoMapper with DI-containers on the example of Unity</a></li>
<li><a href="../244701/index.html">New version of RubyMine: Chef, Puppet, EditorConfig and more</a></li>
<li><a href="../244705/index.html">OpenVPN Denial of Service Vulnerability</a></li>
<li><a href="../244707/index.html">How to create a DbContext inside Visual Studio, or ‚ÄúWhat if you want something strange?‚Äù</a></li>
<li><a href="../244711/index.html">Optional types? Only if very necessary</a></li>
<li><a href="../244713/index.html">10 opportunities to be more productive with Eclipse for Java developers</a></li>
<li><a href="../244715/index.html">The script collapsing comments on Habr√©</a></li>
<li><a href="../244721/index.html">Revised Grunt Beginner's Guide</a></li>
<li><a href="../244723/index.html">Hacker's guide to neural networks. Schemes of real values. Strategy # 1: Random local search</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>