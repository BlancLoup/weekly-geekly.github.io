<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to protect your users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="$ 100 billion is a huge amount, isn't it? That is how many estimate the global online advertising market in 2012. No need to go far to understand who ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to protect your users</h1><div class="post__text post__text-html js-mediator-article">  $ 100 billion is a huge amount, isn't it?  That is how many estimate the global online advertising market in 2012.  No need to go far to understand who will get most of this money.  Of course, companies like Google, Facebook, Yahoo!  etc.  But approximately 20% of this amount will receive spammers.  This huge amount of money attracts very well-organized business and talented people. <br><br><img src="https://habrastorage.org/storage2/d18/4cf/b90/d184cfb90a65a8b8b825df518fd2ea67.png" alt="image"><a name="habracut"></a><br><br>  Before Facebook, Odnoklassniki, VKontakte and other social networks, mail was the most popular way to spread spam.  But now social networks offer a huge range of tools for the distribution of annoying ads bypassing official channels.  I will not go into details about each of them, this is not the topic of this post, I will simply list those that we encounter in Odnoklassniki. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first, and perhaps most important, is spam through private messages.  There is nothing easier than sending a message to the social network, is not it? <br><br>  The second is through comments on various objects (photos, videos, etc.). <br><br>  The third is invitations to spam groups, or the creation of relevant news and topics in regular groups. <br><br>  The fourth is spam in the photos, i.e.  when the advertising message is written on the photo and then uploaded to the site. <br><br>  The fifth type is conventionally called ‚ÄúEroklassnitsa‚Äù.  They set up an account for a photo of an attractive person in a semi-nude form, set an appropriate status, or add photos with junk ads, and begin to visit. <br><br>  Given the mass nature of social networks, it is not surprising that the main value for spammers is no longer email addresses, but activated accounts with the right to send messages, post photos and set statuses.  How can a spammer get so many accounts?  After all, automatic registrations in all major social networks do not work, because the activation of the account requires a phone number.  The answer to this question is simple - use the accounts of ordinary people.  But how to get access to them? <br><br>  Unfortunately, many of the problems associated with the illegal use of accounts cannot be solved on the side of the service developers, since they are caused by a low level of user training.  Many simply do not know that it is not safe to put simple passwords, that you shouldn‚Äôt download and install software from unknown manufacturers, that you don‚Äôt need to press the ‚Äúremember password‚Äù checkbox when logging in from publicly available computers.  The only thing that a developer can do is to force the use of complex passwords and make security recommendations, increasing the level of user training.  But all these problems are only the tip of the iceberg, and they will never lead to massive theft of accounts.  There are problems that are much more dangerous for users - for example, the low level of qualifications of the programmer who developed the service, or the testing process that is not well established.  Just about such problems and will be discussed in this post. <br><br>  Some time ago, we seriously attended to the problems of web security by standardizing the internal development and testing processes of the functional to meet the requirements for protecting client data, we managed to greatly reduce the number of vulnerabilities in the portal.  Further in the post I want to share with you some of the problems that we faced, and talk about how we solved them. <br><br>  <b>Cross-site scripting</b> <br><br>  One of the most common vulnerabilities, allowing you to embed your own code in the body of the document. <br><br>  How to use it: <br><ul><li>  You can steal cookies or other user data; </li><li>  You can change the appearance and behavior of the site; </li><li>  You can perform actions on behalf of the user (open windows, send messages, etc.). </li></ul><br><br>  Unfortunately, this trouble has not bypassed our resource: a number of vulnerabilities of this type have been found, but all of them are already closed.  Such errors occur when neglecting the output of data provided by the user. <br><br>  <u>Example 1:</u> <br>  The data entered by the user: <code>name = ‚Äú /&gt; ‚Äù;</code> <br>  How data is output: <code>${name}</code> <br><br>  When we output custom content directly into the body of a DOM document, we can easily get into a situation in which the browser will perceive the HTML code in the output string as code, and not as a string. <br><br><img src="https://habrastorage.org/storage2/41c/4e3/6f8/41c4e36f897dce1b3b0262e48ab0b350.png"><br><br>  The figure shows that the caption to the photo is depicted as an HTML select object (I replaced the script tag with a select for clarity).  The victims of this bug could be anyone who opened the photo, specially signed by the burglar. <br><br>  <u>Way to fight:</u> <br>  Carefully treat user data, everywhere when displaying in the body of the document, escape dangerous characters.  Substitute &amp; &lt;&gt; "'for &amp; amp; &amp; lt; &amp; gt; &amp; quot; &amp; # 39; <br><br>  <u>Example 2:</u> <br>  The data entered by the user: <code>name=‚Äù  '&gt;/ ‚Äù;</code> <br>  How is the data output: <br><br><img src="https://habrastorage.org/storage2/197/eab/db6/197eabdb6b50438602ced18d2e91e4a4.png"><br><br>  The effect will be the same as in the first example, the methods of protection are the same. <br><br>  <u>Example 3:</u> <br>  User input: <code>name=‚ÄùMadonna'); doSomeKillingAndStealing(' ‚Äù;</code> <code>name=‚ÄùMadonna'); doSomeKillingAndStealing(' ‚Äù;</code> <br>  How is the data output: <code>Search</code> <br><br>  The problem was in the musical status: when clicking on the name of the artist, you could substitute your own code. <br><br>  <u>Way to fight:</u> <br>  As in the two examples before, you need to escape dangerous characters, but for JavaScript they are slightly different.  It is necessary to substitute \ / '"for \\ \ / \' \" when outputting <br><br>  <u>The main rule is to never trust user data.</u> <br><br>  <b>Cookies</b> <br><br>  Cookies are the key / value storage in the browser that is used to store user data between sessions and the session ID.  By default, JavaScript has access to cookies, which, in the presence of the above vulnerabilities, makes them quite a dangerous place to store data.  But before telling you how to protect cookies, I want to pay attention to how they are set. <br><br>  So, cookies can be set for a specific domain, for all subdomains, and in general for all domains.  Almost always you need to set cookies for a specific domain.  But sometimes there are cases when it is necessary to be able to use data from cookies during the transition between domains.  For example, on Odnoklassniki, when switching between the main site and the mobile version, there is no need to enter the password again.  This is done by setting the session cookie to the domain ".odnoklassniki.ru".  But for this convenience you can pay dearly.  If suddenly a vulnerable subdomain appears at odnoklassniki.ru, then it will be possible to access the cookie of the main portal through this domain. <br><br>  The best way to protect cookies is to set the HttpOnly attribute to them.  This attribute denies access to cookies through JavaScript.  Such protection will work in 99% of cases, except when an attacker can send an XMLHttpRequest and receive a response setting cookies.  Then, using the getAllResponseHeaders method, you can access them. <br><br>  But let's continue the conversation about user data.  Data can be not only textual, but also in the form of files.  If your service allows you to upload files to yourself, then be extremely careful: it is necessary to clearly define those file formats that you allow to upload to your servers, and return these files to the correct headers.  Then I will tell you why. <br><br>  <b>Svg</b> <br><br>  SVG vector graphics format is one of the dangerous formats for uploading to servers.  The file itself may contain javascript.  There are 5 ways to connect it validly on the page. <br><ul><li>  Object </li><li>  Iframe </li><li>  Embed </li><li>  Img </li><li>  CSS background </li></ul><br><br>  The first 3 ways to connect will execute contained in the JavaScript file.  The mere fact of finding such a file on the server entails a certain danger.  After all, an attacker with a personal message can send a direct link to a file, opening which, the user will execute the script inside the file. <br><br>  SVG is not the only potentially dangerous format.  Any Flash or HTML document loaded by the user should be added to a separate domain that does not have access to your portal cookies. <br><br>  <b>Content and character set sniffing</b> <br><br>  Browsers have such an interesting feature: if the content of the file sent is different from the Content-Type specified in the header, the browser will search for the file internals, what is the actual format.  If suddenly the browser finds inside HTML, then it interprets the file as HTML.  Those.  if your service allows you to upload files in the JPEG and PNG format, and when outputting for any reason exposes the Content-Type: image / jpeg, then returning PNG-files, the browser will look inside to see what the actual file format is.  Even if you are optimizing images on the server, this absolutely does not guarantee you that after optimization, HTML will no longer be valid or will somehow change.  There are tools that allow you to create an image in such a way that after optimizing the HTML inside the file remains unchanged. <br>  In order to avoid problems, it is necessary to adhere to 3 basic rules: <br><ul><li>  always return files with a Content-Type that it actually has </li><li>  do not use text / plain and application / octet-stream, since  for these formats, browsers always look inside </li><li>  set the X-Content-Options: nosniff header.  This header prevents browsers from looking into the content. </li></ul><br><br>  <b>Clickjacking</b> <br><br>  We encountered this problem about six months ago, but it is not known how old it really is.  We learned about it from posting on one popular blog.  The meaning of the attack on Classmates was that our site was embedded in the iframe on a page with a very similar domain to the original.  The frame is stretched to full screen.  Then the user, having come to a malicious site and being authorized on our site, saw his profile and was completely confident that he was on Odnoklassniki.  At that moment, he was shown either a window asking to enter personal data (login and password), or a payment order to transfer money.  On many very popular sites on the Internet, this vulnerability is to this day.  On Classmates, we closed it as soon as we heard about it. <br><br>  There are two means of dealing with this problem: <br><ul><li>  header prohibiting the opening of the site in the frame (X-FRAME-OPTIONS = DENY) </li><li>  Javascript code </li></ul><br><br>  <u>An example of JavaScript that is used on Odnoklassniki:</u> <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ top.location.toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(top != self) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e){ top.location = location; }</code> </pre><br><br>  In our case, we cannot use the header due to some architectural features of the portal, therefore we are protected with JavaScript. <br><br>  <b>Cross-site request forgery</b> <br><br>  This is one of the easiest vulnerabilities.  It allows you to perform actions on behalf of the user, for example, to send messages, set ratings for photos, etc.  Of course, there are no similar problems on Odnoklassniki, but they are observed on some other known resources.  For the safety of these resources, I will not voice their names.  Let me explain the essence of this problem with an example: let's say you have a very popular forum, and you want to know exactly who goes to your site.  You can register an account on Odnoklassniki and embed a link to your profile in an invisible iframe.  Then, when logging into your forum, all users authorized on Odnoklassniki will automatically visit you, i.e.  perform the action of a visit to the guests, without even realizing it. <br><br>  On this I, perhaps, finish my rather big post.  If someone is interested in this topic, here are a couple of good sources of information: <br><br>  Book - The Tangled Web by Michal Zalewski <br>  <a href="http://www.owasp.org/">www.owasp.org</a> <br><br>  <i>Team Odnoklassniki</i> </div><p>Source: <a href="https://habr.com/ru/post/150439/">https://habr.com/ru/post/150439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150431/index.html">Thunderbird 15</a></li>
<li><a href="../150432/index.html">Demo Day at SumIT - look at the results</a></li>
<li><a href="../150433/index.html">Digital SSL certificates. Varieties how to choose?</a></li>
<li><a href="../150434/index.html">Samsung will introduce new memory cards</a></li>
<li><a href="../150438/index.html">Code Coverage analysis for iOS and OS X projects (xCode 4.4)</a></li>
<li><a href="../150440/index.html">Hi, habrovchane!</a></li>
<li><a href="../150443/index.html">leOS - multitasking kernel for Arduino</a></li>
<li><a href="../150446/index.html">Customer Guidelines for Apple Technical Support staff</a></li>
<li><a href="../150447/index.html">HTML5 Boilerplate 4.0.0 released</a></li>
<li><a href="../150448/index.html">Class Interfaces and Collections</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>