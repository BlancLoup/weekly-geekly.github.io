<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pebble: working with static graphics on the example of creating a 7-segment watchface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All applications for Pebble watches are divided into two categories of watchapp - just applications, and watchface - applications "watches", which, as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pebble: working with static graphics on the example of creating a 7-segment watchface</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/404/ea7/27b/404ea727b7b84d8eb42841b90d584ff0.png">  All applications for Pebble watches are divided into two categories of <i>watchapp</i> - just applications, and <i>watchface</i> - applications "watches", which, as the name suggests, are the face of the device.  The difference between ‚Äúfaces‚Äù is the lack of response to hardkey buttons, since ‚ÄúUP‚Äù and ‚ÄúDOWN‚Äù are used to cycle through the installed <i>watchfaces</i> . <br>  But, probably, due to the low resolution of the screen 144x168 px, it is quite difficult to find a watchfly that fits perfectly into the design of the watch, which at the same time performs its main function - counting time. <br>  It seems to me that the best in this screen look the numbers in the style of seven-segment indicators. <br>  <i>See</i> below for details on how to add elegant minimalism, personality and unique features to your <i>watch face</i> . <br>  So, a few pictures, code snippets and as a result, a link to the finished project. <br><br><a name="habracut"></a><br>  The creation of the watchface, the structure and the construction of the project are described in detail in the corresponding section of the <a href="https://habr.com/ru/post/245297/">Build Your Own Watchface documentation [1]</a> .  I will not repeat, but immediately go to <br><br><a name="contents"></a><h2>  Special features </h2><br>  What will distinguish our application from a dozen and a half of Examples and from hundreds with <a href="http://www.mypebblefaces.com/">mypebblefaces</a> : <br><ul><li>  <a href="https://habr.com/ru/post/245297/">font close to 7-segment indicators;</a> </li><li>  <a href="https://habr.com/ru/post/245297/">two screens</a> : <br><ul><li>  the main ‚Äústandby‚Äù screen, economical and minimalistic, updated once a minute, shows the current time; </li><li>  additional ‚Äúinfo‚Äù screen, extended information: current time with seconds, date, day of the week, weather forecast (where without it). </li></ul></li><li>  <a href="https://habr.com/ru/post/245297/">switching between screens with a gesture (shaking with a brush)</a> ; </li><li>  <a href="https://habr.com/ru/post/245297/">automatic transition to "standby"</a> ; </li><li>  <a href="https://habr.com/ru/post/245297/">display of battery status and bluetooth connection</a> . </li></ul><br>  First things first: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="contents1"></a><h3>  7-segment font </h3><br>  To display the numbers, you need two sets, the main one is large (figure 20x38px), for the time: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b81/05f/e12/b8105fe12bce470daf90eebf00b64f57.png"></div><br>  and extra small (figure 8x16px), for the date and seconds: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/ea4/b99/a39/ea4b99a396b743c88eb197ca8470104e.png"></div><br>  Both sets are drawn in a graphic editor, in the form of a two-color png-file. <br>  We connect them as resources in <i>appinfo.json</i> : <br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"resources"</span></span>: { <span class="hljs-string"><span class="hljs-string">"media"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"DIGITS"</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/digits.png"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"DIGITS_MIDI"</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/digits_midi.png"</span></span> } ]</code> </pre> <br>  A graphical framework is described in the <a href="https://habr.com/ru/post/245297/">documentation [2]</a> .  We are interested in the section on working with <a href="https://habr.com/ru/post/245297/">raster images [3]</a> . <br>  Preparatory actions for working with a raster, the creation of a resource will be put into a separate function: <br><pre> <code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GBitmap *bmp_digits; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GBitmap *bmp_digits_midi; <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_resources</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { bmp_digits = gbitmap_create_with_resource(RESOURCE_ID_DIGITS); bmp_digits_midi = gbitmap_create_with_resource(RESOURCE_ID_DIGITS_MIDI); } <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Window *window</span></span></span><span class="hljs-function">)</span></span> { load_resources(); }</code> </pre><br>  Do not forget to free up resources: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy_resources</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { gbitmap_destroy(bmp_digits); gbitmap_destroy(bmp_digits_midi); } <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_unload</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Window *window</span></span></span><span class="hljs-function">)</span></span> { destroy_resources(); }</code> </pre><br>  Digits are read from resources and created as a raster in memory, now we need a function of drawing a single digit, when calling a function, we specify the graphic context in which we will draw, the initial set from which we must ‚Äútear out‚Äù the image and the sequence number of the image in the set: <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* ctx -  ; sources -  ; bounces -      ; number -     . */</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> draw_picture(GContext* ctx, GBitmap **sources, GRect bounces, <span class="hljs-type"><span class="hljs-type">int</span></span> number) { GPoint origin = bounces.origin; bounces.origin = GPoint(bounces.size.w*number, <span class="hljs-number"><span class="hljs-number">0</span></span>); GBitmap* <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span> = gbitmap_create_as_sub_bitmap(*sources, bounces); bounces.origin = origin; graphics_draw_bitmap_in_rect(ctx, <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>, bounces); gbitmap_destroy(<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>); }</code> </pre><br>  and for example, to draw C grade at the coordinates (10, 0) in context: <br><pre> <code class="hljs lisp"> draw_picture(<span class="hljs-name"><span class="hljs-name">ctx</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">&amp;bmp_digits</span></span>, GRect(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>), <span class="hljs-number"><span class="hljs-number">3</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br>  <a href="https://habr.com/ru/post/245297/">to content</a> <br><br><a name="contents2"></a><h3>  Two screens </h3><br>  Since we will have two independent screens, each with its own content, we implement them as separate layers, the size of a clock screen: <br><pre> <code class="hljs javascript"><span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Layer *standby_layer; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Layer *info_layer; <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> window_load(Window *<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>) { Layer *window_layer = window_get_root_layer(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>); GRect bounds = layer_get_bounds(window_layer); load_resources(); standby_layer = layer_create(bounds); layer_add_child(window_layer, standby_layer); info_layer = layer_create(bounds); layer_add_child(window_layer, info_layer); }</code> </pre><br>  Switching between screens will be transferred to the ‚ÄúTick Timer‚Äù service handler: <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> current_screen = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> tick_handler(struct tm *tick_time, TimeUnits units_changed) { //    "standby"   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (units_changed &amp; MINUTE_UNIT) { layer_mark_dirty(standby_layer); }; switch (current_screen) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: //   "standby" ,      "info" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (layer_get_hidden(standby_layer)) { layer_set_hidden(info_layer, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); layer_set_hidden(standby_layer, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); }; break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: layer_mark_dirty(info_layer); //   "info" ,      "standby" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (layer_get_hidden(info_layer)) { layer_set_hidden(standby_layer, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); layer_set_hidden(info_layer, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); //         "standby" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (settings.s_auto) { standby_timer = app_timer_register(<span class="hljs-number"><span class="hljs-number">30000</span></span>, timer_callback, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>); }; }; break; }; } static <span class="hljs-type"><span class="hljs-type">void</span></span> init(<span class="hljs-type"><span class="hljs-type">void</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> tick_timer_service_subscribe(SECOND_UNIT, tick_handler); }</code> </pre><br>  So we come to the fact that we already need to draw content on the screens.  For example, the code for displaying content on the idle screen is a digital dial. <br>  To begin with, let's set the rendering function for the ‚Äústandby_layer‚Äù layer, which is automatically called when necessary: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Window *window</span></span></span><span class="hljs-function">)</span></span> { standby_layer = layer_create(bounds); layer_add_child(window_layer, standby_layer); layer_set_update_proc(standby_layer, update_standby); }</code> </pre><br>  and implement content rendering: <br><div class="spoiler">  <b class="spoiler_title">update_standby</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">static <span class="hljs-type"><span class="hljs-type">void</span></span> update_standby(Layer *layer, GContext* ctx) { GRect bounds = layer_get_bounds(layer); //   -  graphics_context_set_fill_color(ctx, GColorBlack); //   -  graphics_context_set_compositing_mode(ctx, GCompOpAssignInverted); //   graphics_fill_rect(ctx, bounds, <span class="hljs-number"><span class="hljs-number">0</span></span>, GCornerNone); time_t <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span> = <span class="hljs-type"><span class="hljs-type">time</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>); struct tm *tick_time = <span class="hljs-built_in"><span class="hljs-built_in">localtime</span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>); <span class="hljs-type"><span class="hljs-type">int</span></span> hour_dicker = tick_time-&gt;tm_hour/<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-type"><span class="hljs-type">int</span></span> hour_unit = tick_time-&gt;tm_hour%<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-type"><span class="hljs-type">int</span></span> min_dicker = tick_time-&gt;tm_min/<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-type"><span class="hljs-type">int</span></span> min_unit = tick_time-&gt;tm_min%<span class="hljs-number"><span class="hljs-number">10</span></span>; //   draw_picture(ctx, &amp;bmp_digits, GRect(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>), hour_dicker); draw_picture(ctx, &amp;bmp_digits, GRect(<span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>), hour_unit); draw_picture(ctx, &amp;bmp_digits, GRect(<span class="hljs-number"><span class="hljs-number">78</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>), min_dicker); draw_picture(ctx, &amp;bmp_digits, GRect(<span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>), min_unit); //   graphics_context_set_fill_color(ctx, GColorWhite); GRect frame = (GRect) { .origin = GPoint(bounds.size.w/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">63</span></span>), .size = GSize(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) }; graphics_fill_rect(ctx, frame, <span class="hljs-number"><span class="hljs-number">0</span></span>, GCornerNone); frame = (GRect) { .origin = GPoint(bounds.size.w/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-4</span></span>, <span class="hljs-number"><span class="hljs-number">81</span></span>), .size = GSize(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) }; graphics_fill_rect(ctx, frame, <span class="hljs-number"><span class="hljs-number">0</span></span>, GCornerNone); }</code> </pre><br></div></div><br>  Result: <br><img src="https://habrastorage.org/files/c8a/998/87b/c8a99887bbdb47b7a7ce879a2e21e419.png"><br>  similarly, using <i>draw_picture we</i> draw an information screen, in more detail in <a href="https://habr.com/ru/post/245297/">source codes</a> . <br>  Result: <br><img src="https://habrastorage.org/files/7b8/6ac/b0c/7b86acb0c1b0458c86f84262a12daf7c.png"><br>  <a href="https://habr.com/ru/post/245297/">to content</a> <br><br><a name="contents3"></a><h3>  Switch between screens </h3><br>  To switch screens, use the built-in <a href="https://habr.com/ru/post/245297/">accelerometer [4]</a> .  To do this, subscribe to the "Tap Event Service": <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tap_handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AccelAxisType axis, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> direction)</span></span></span><span class="hljs-function"> </span></span>{ current_screen = !current_screen; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> tick_timer_service_subscribe(SECOND_UNIT, tick_handler); accel_tap_service_subscribe(tap_handler); }</code> </pre><br>  <a href="https://habr.com/ru/post/245297/">to content</a> <br><br><a name="contents4"></a><h3>  Transition to "standby" </h3><br>  To automatically go to the idle screen, use the <a href="https://habr.com/ru/post/245297/">timer [4]</a> . <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> AppTimer *standby_timer = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> static <span class="hljs-type"><span class="hljs-type">void</span></span> timer_callback() { current_screen = <span class="hljs-number"><span class="hljs-number">0</span></span>; } static <span class="hljs-type"><span class="hljs-type">void</span></span> tick_handler(struct tm *tick_time, TimeUnits units_changed) { <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: layer_mark_dirty(info_layer); //   "info" ,      "standby" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (layer_get_hidden(info_layer)) { layer_set_hidden(standby_layer, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); layer_set_hidden(info_layer, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); //         "standby" <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (settings.s_auto) { standby_timer = app_timer_register(<span class="hljs-number"><span class="hljs-number">30000</span></span>, timer_callback, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>); }; }; break; <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> }</code> </pre><br>  <a href="https://habr.com/ru/post/245297/">to content</a> <br><br><a name="contents5"></a><h3>  Battery and bluetooth status </h3><br>  To display the state of the <a href="https://habr.com/ru/post/245297/">battery [6],</a> let's create a resource with images corresponding to tens of percent (the API gives the charge with such accuracy): <br><img src="https://habrastorage.org/files/69c/fca/49f/69cfca49f0fb4f2994e95b1078567be2.png"><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"resources"</span></span>: { <span class="hljs-string"><span class="hljs-string">"media"</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"BATTERY"</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/battery.png"</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> ] }</code> </pre><br>  And draw on the appropriate screen: <br><pre> <code class="hljs objectivec"> <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> BatteryChargeState charge_state = battery_state_service_peek(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bat_percent = charge_state.charge_percent/<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (charge_state.is_charging) { bat_percent = <span class="hljs-number"><span class="hljs-number">110</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>; }; draw_picture(ctx, &amp;bmp_battery, GRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), bat_percent); <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span></code> </pre><br>  The state of <a href="https://habr.com/ru/post/245297/">bluetooth [7] is</a> displayed with the corresponding icon: <br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"resources"</span></span>: { <span class="hljs-string"><span class="hljs-string">"media"</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> { <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"BT"</span></span>, <span class="hljs-string"><span class="hljs-string">"file"</span></span>: <span class="hljs-string"><span class="hljs-string">"images/bluetooth.png"</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/*..*/</span></span> ] }</code> </pre><br><pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bluetooth_connection_service_peek()) { draw_picture(ctx, &amp;bmp_bt, GRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>); };</code> </pre><br><br>  <a href="https://habr.com/ru/post/245297/">to content</a> <br><br>  Bottom line: the watchface, which most of the time is not annoying with redundant information, is readable and quite watchable, if desired, shares extended information. <br><br>  For those interested: <br><a name="Sources"></a>  <a href="http://bitbucket.org/">Bitbucket</a> <a href="https://bitbucket.org/tmnhy/7-segment-light/src/042e65e3b8c71afa70cc228f56c99d4b2cc1502d%3Fat%3Dmaster">project code</a> <br>  App on <a href="https://apps.getpebble.com/applications/5486da874c38cce14200001f">Pebble App Store</a> <br><br><a name="Anchor1"></a>  <a href="http://developer.getpebble.com/getting-started/watchface-tutorial/part1/">1. Pebble Developers // Build Your Own Watchface</a> <br><a name="Anchor2"></a>  <a href="http://developer.getpebble.com/docs/c/group___graphics.html">2. Pebble Developers // Graphics</a> <br><a name="Anchor3"></a>  <a href="http://developer.getpebble.com/docs/c/group___graphics_types.html">3. Pebble Developers // Graphics Types</a> <br><a name="Anchor4"></a>  <a href="http://developer.getpebble.com/guides/pebble-apps/sensors/accelerometer/">4. Pebble Developers // Detecting Acceleration</a> <br><a name="Anchor5"></a>  <a href="http://developer.getpebble.com/docs/c/group___timer.html">5. Pebble Developers // Timer</a> <br><a name="Anchor6"></a>  <a href="http://developer.getpebble.com/guides/pebble-apps/app-events/battery-service/">6. Pebble Developers // Measuring Battery Level</a> <br><a name="Anchor7"></a>  <a href="http://developer.getpebble.com/guides/pebble-apps/app-events/bluetooth-connection/">7. Pebble Developers // Managing Bluetooth Events</a> </div><p>Source: <a href="https://habr.com/ru/post/245297/">https://habr.com/ru/post/245297/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245287/index.html">The new version of Veeam ONE v8 has been released - a product for monitoring the virtual infrastructure of VMware vSphere and Hyper-V</a></li>
<li><a href="../245289/index.html">As I increased sales of modules for CMS</a></li>
<li><a href="../245291/index.html">Training testers. Practical experience and advice</a></li>
<li><a href="../245293/index.html">Virtual hosting and php5.4, when already?</a></li>
<li><a href="../245295/index.html">How to download virtual corporate Office 2013 from Microsoft</a></li>
<li><a href="../245299/index.html">What is in ORM mine? The near-scientific approach of choosing ORM for Android</a></li>
<li><a href="../245303/index.html">What the product consists of: know-how and IP inside the new electronics</a></li>
<li><a href="../245305/index.html">C ++ serialization with polymorphism and prototypes</a></li>
<li><a href="../245307/index.html">How ‚Äúdon't know‚Äù the game did</a></li>
<li><a href="../245311/index.html">Extending large missing parts of the image in photoshop: multigradient</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>