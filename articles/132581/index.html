<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Art Wallpapers + Weather Widget</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Story 
 It was always interesting to me to know what the weather was like outside the window, in the meantime different weather informers were used an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Art Wallpapers + Weather Widget</h1><div class="post__text post__text-html js-mediator-article"><h4>  Story </h4><br><img align="right" src="https://habrastorage.org/storage1/fc6b9f4e/2165a45a/92175102/9156a7b5.jpg">  It was always interesting to me to know what the weather was like outside the window, in the meantime different weather informers were used and then one day, on the advice of a friend, I came across <a href="http://artmeteo.ru/">this site</a> .  The site had its own zest, which consisted in the fact that the weather report was displayed on the background of artistic paintings that I wanted to notice of decent quality.  All these charms did not leave me indifferent and I added the site to the bookmarks.  Time passed, the site moved from the bookmarks to the speed dial tab, which was updated periodically, but something was still missing.  And, in the end, I got the idea - to take screenshots of the site and display them on the desktop. <br><br><h4>  purpose </h4><br>  Implement the idea, while spending as little as possible "resources" for implementation and make it so that the process from the creation of a screenshot to the replacement of wallpaper occurs unnoticed. <br><a name="habracut"></a><br><h4>  Means used </h4><ol><li>  <a href="http://code.google.com/p/phantomjs/">PhantomJS</a> - for getting screenshots from web resources </li><li>  <a href="http://www.xnview.com/en/nconvert.html">NConvert</a> - to convert images to various formats </li><li>  <a href="http://habrahabr.ru/blogs/sysadm/104460/">Wallpaper</a> - to update wallpaper in Windows Vista and 7 </li><li>  VBScript - to execute all necessary commands. </li><li>  Windows Task Scheduler - for regular wallpaper updates </li></ol><br><h4>  Implementation </h4><br>  First of all, download the latest versions of <a href="http://code.google.com/p/phantomjs/downloads/list">PhantomJS</a> , <a href="http://www.xnview.com/en/download_nc.html">NConvert</a> and <a href="">Wallpaper</a> . <br>  <em>Alas, the archive with the file ‚Äúwallpaper.exe‚Äù is not available, so you can download it from the archive with the source code for the article, the link to which will be published at the end.</em> <br>  At the time of this writing, Windows PhantomJS 1.3.0 (Static build) and NConvert v5.91 were used.  Then we create the folder ‚Äúmeteo_wall‚Äù, in it we create the subfolder ‚Äútools‚Äù.  Go to this subfolder and unpack the contents of the archive "PhantomJS" in the same folder.  Also in the ‚Äútools‚Äù folder we place NConvert and wallpaper.exe.  Next, it will be necessary to copy the ‚Äúrasterize.js‚Äù file from the examples folder and place it in the ‚Äútools‚Äù folder.  We will slightly correct the ‚Äúrasterize.js‚Äù file in order to be able to specify the required screenshots extension. <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> page = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebPage(), address, output, size; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phantom.args.length &lt; <span class="hljs-number"><span class="hljs-number">2</span></span> || phantom.args.length &gt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Usage: rasterize.js URL filename [paperwidth*paperheight|paperformat]'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">' paper (pdf output) examples: "5in*7.5in", "10cm*20cm", "A4", "Letter"'</span></span>); phantom.exit(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { address = phantom.args[<span class="hljs-number"><span class="hljs-number">0</span></span>]; output = phantom.args[<span class="hljs-number"><span class="hljs-number">1</span></span>]; page.viewportSize = { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">600</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phantom.args.length === <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; phantom.args[<span class="hljs-number"><span class="hljs-number">1</span></span>].substr(<span class="hljs-number"><span class="hljs-number">-4</span></span>) === <span class="hljs-string"><span class="hljs-string">".pdf"</span></span>) { size = phantom.args[<span class="hljs-number"><span class="hljs-number">2</span></span>].split(<span class="hljs-string"><span class="hljs-string">'*'</span></span>); page.paperSize = size.length === <span class="hljs-number"><span class="hljs-number">2</span></span> ? { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: size[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">height</span></span>: size[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-attr"><span class="hljs-attr">border</span></span>: <span class="hljs-string"><span class="hljs-string">'0px'</span></span> } : { <span class="hljs-attr"><span class="hljs-attr">format</span></span>: phantom.args[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-attr"><span class="hljs-attr">orientation</span></span>: <span class="hljs-string"><span class="hljs-string">'portrait'</span></span>, <span class="hljs-attr"><span class="hljs-attr">border</span></span>: <span class="hljs-string"><span class="hljs-string">'1cm'</span></span> }; }<span class="hljs-comment"><span class="hljs-comment">/* xrays add */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(phantom.args.length === <span class="hljs-number"><span class="hljs-number">3</span></span>){ size = phantom.args[<span class="hljs-number"><span class="hljs-number">2</span></span>].split(<span class="hljs-string"><span class="hljs-string">'*'</span></span>); page.viewportSize = { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: size[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">height</span></span>: size[<span class="hljs-number"><span class="hljs-number">1</span></span>] }; };<span class="hljs-comment"><span class="hljs-comment">/* end */</span></span> page.open(address, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (status !== <span class="hljs-string"><span class="hljs-string">'success'</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Unable to load the address!'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ page.render(output); phantom.exit(); }, <span class="hljs-number"><span class="hljs-number">200</span></span>); } }); }</code> </pre> <br>  Then you can start writing VBScript'a.  Create a file ‚Äúwallpaper.vbs‚Äù in the folder ‚Äútools‚Äù and, to begin with, describe the necessary variables in it and fill in the important variables: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> WshShell <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> WshShell = WScript.<span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> url, history, logon <span class="hljs-comment"><span class="hljs-comment">'    url = "http://www.artmeteo.ru/4335/" '    history = 1 '     logon = 1 '      Windows</span></span></code> </pre><br>  I admit honestly, before that I did not write code on VBScript.  In order to receive screenshots automatically you need to know the screen resolution: <br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    Dim obj, monSize Set obj = CreateObject("htmlfile") monSize = obj.parentWindow.screen.width &amp; "*" &amp; obj.parentWindow.screen.height</span></span></code> </pre> <br>  Further: <br><pre> <code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    '    Dim toolsPath, path Set obj = CreateObject("Scripting.FileSystemObject") '     obj toolsPath = obj.GetParentFolderName(WScript.ScriptFullName) &amp; "\" '      path = obj.GetParentFolderName(toolsPath) &amp; "\" '     '        Dim phantom, bmpname phantom = toolsPath&amp;"phantomjs\" '   phantomjs bmpname = path&amp;"url.bmp " '   bmp  WshShell.Run phantom &amp; "phantomjs.exe " &amp; toolsPath &amp; "rasterize.js " &amp; url &amp; " " &amp; bmpname &amp; monSize, 0, True '    </span></span></code> </pre> <br>  <em>Notes: at the end of the last line, the parameters <code>0, True</code> necessary for the code to be executed in the background and further commands described in the script are waiting for the execution of this code.</em> <br>  As you can see, the screenshot is saved in bmp format, this is done because versions of Windows OS under Vista do not perceive wallpaper in a different format.  Next, we determine the OS version: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Dim</span></span> OSType OSType = <span class="hljs-built_in"><span class="hljs-built_in">Left</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Trim</span></span>(WshShell.RegRead(<span class="hljs-string"><span class="hljs-string">"HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\CurrentVersion"</span></span>)),<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">'   windows Dim convert, n, time, jpgname, wallpaper</span></span></code> </pre> <br>  Since the script should be as versatile as possible, but with different versions of the OS, you also need to reckon with, then first we describe the code for Windows Vista and 7: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">If</span></span> OSType&gt;<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-comment"><span class="hljs-comment">'   Windows Vista  Windows 7 '   bmp  jpg Dim quality quality = 95 '   jpg  convert = toolsPath &amp; "nconvert.exe -out jpeg -q " &amp; quality &amp; " -i -overwrite -o " n = Now '      time = Right("00" &amp; Day(n), 2) &amp; "-" &amp; Right("00" &amp; Month(n), 2) &amp; "-" &amp; Right("00" &amp; Year(n), 2) &amp; "_" &amp; Right("00" &amp; Hour(n), 2) &amp; "_" &amp; Right("00" &amp; Minute(n), 2) &amp; "_" &amp; Right("00" &amp; Second(n), 2) '   jpgname = path &amp; time &amp; ".jpg " '   jpg  WshShell.Run convert &amp; jpgname &amp; bmpname, 0, True '   bmp  jpeg '      wallpaper = WshShell.ExpandEnvironmentStrings("%APPDATA%") &amp; "\Microsoft\Windows\Themes\TranscodedWallpaper.jpg" '    obj.CopyFile jpgname, wallpaper '  jpg   .   WshShell.RegWrite "HKCU\Control Panel\Desktop\Wallpaper", wallpaper '           '   logon Dim logonname logonname = WshShell.ExpandEnvironmentStrings("%windir%") &amp; "\System32\oobe\info\backgrounds\backgroundDefault.jpg " '   logon  If logon = 1 Then '    logon Dim logonconvert, goodlogon Set file = obj.GetFile(jpgname) '      logon If Round(file.size/1024) &lt; 256 Then '    &lt; 256,      goodlogon = 1 obj.CopyFile jpgname, logonname Else goodlogon = 0 quality = quality - 3 End If '     logon While goodlogon = 0 logonconvert = toolsPath &amp; "nconvert.exe -out jpeg -q " &amp; quality &amp; " -i -overwrite -o " ' -canvas 1280 800 top-left WshShell.Run logonconvert &amp; logonname &amp; bmpname, 0, True Set file = obj.GetFile(logonname) '      logon If Round(file.size/1024) &lt; 256 Then '   &lt; 256 Kb,    goodlogon = 1 Else quality = quality - 3 '     End If Wend WshShell.RegWrite "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\Background\OEMBackground", 1, "REG_DWORD" Else If obj.FileExists(logonname) Then obj.DeleteFile logonname, True '  logon ,    End If End If If history = 0 Then '      ,   jpg  obj.DeleteFile jpgname, True End If WshShell.Run toolsPath &amp; "wallpaper.exe", 0, True '  Windows     </span></span></code> </pre> <br>  You may notice that in this code there is a change in the logon image (picture of the welcome screen) to which the requirements of Windows apply.  The essence of these requirements is that the file cannot be larger than 256 KB, therefore, a cycle starts to reduce the quality of the image until the permissible limit of the threshold is reached. <br>  Now it‚Äôs time to describe the code for younger versions of Windows: <br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> <span class="hljs-comment"><span class="hljs-comment">'     Windows '      wallpaper = WshShell.ExpandEnvironmentStrings("%appdata%") &amp; "\Wallpaper.bmp" '    obj.CopyFile bmpname, wallpaper '  bmp   .   WshShell.RegWrite "HKCU\Control Panel\Desktop\Wallpaper", wallpaper '           '   logon Dim Background, Winlogon If logon = 1 Then '    logon Background = 1 Winlogon = 0 WshShell.RegWrite "HKEY_USERS\.DEFAULT\Control Panel\Desktop\TileWallpaper", 1, "REG_SZ" ' : (0 =  ; 1 =  ()) Else Background = 0 wallpaper = "" Winlogon = 1 End If WshShell.RegWrite "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\Background\OEMBackground", Background, "REG_DWORD" '     logon  WshShell.RegWrite "HKEY_USERS\.DEFAULT\Control Panel\Desktop\Wallpaper", wallpaper, "REG_SZ"'        logon  ' WshShell.RegWrite "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\LogonType", Winlogon, "REG_DWORD" ' 1 -   , 0 -      If history = 1 Then '     ,      bmp  jpg (95% ) convert = toolsPath &amp; "nconvert.exe -out jpeg -q 95 -overwrite -o " n = Now time = Right("00" &amp; Day(n), 2) &amp; "-" &amp; Right("00" &amp; Month(n), 2) &amp; "-" &amp; Right("00" &amp; Year(n), 2) &amp; "_" &amp; Right("00" &amp; Hour(n), 2) &amp; "_" &amp; Right("00" &amp; Minute(n), 2) &amp; "_" &amp; Right("00" &amp; Second(n), 2) '   jpgname = path &amp; time &amp; ".jpg " WshShell.Run convert &amp; jpgname &amp; bmpname, 0, True '  bmp  jpg End If WshShell.Run "%windir%\System32\RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters", 0, True '        End If</span></span></code> </pre> <br>  Final script fables: <br><pre> <code class="vbscript hljs">obj.DeleteFile bmpname, <span class="hljs-literal"><span class="hljs-literal">True</span></span> <span class="hljs-comment"><span class="hljs-comment">'  bmp  Set WshShell = Nothing</span></span></code> </pre> <br>  At this writing script is over.  Automatic execution of the script, for example, every 5 minutes, will be done using the built-in Windows Task Scheduler.  To do this, we create a new task and specify the path to the ‚Äúwallpaper.vbs‚Äù script as the program to be started, and also do not forget to select daily and repeat every 5 minutes in the properties to trigger the trigger. <br><br><h4>  Results </h4><br>  The script has been tested on 2 computers with Windows 7, on one with Windows 2003 Server and on one with Windows XP.  In order to see the changes in the welcome screen in Windows XP, you must either uncheck the ‚ÄúUse welcome page‚Äù item or uncomment the 100 line in the script source in the ‚ÄúControl Panel -&gt; User Accounts -&gt; Changes in Logged Users‚Äù box.  The sources of the script, with all the additional software can be taken <a href="">from here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Updates </h4><br>  Now you can check the script on another computer with Windows 7, but the successful launch was not successful.  The problem was that there was an error about the absence of the path to the file, which stores the picture of the welcome screen.  Experimentally, a solution was found that consists either of manually creating the following path <code>"%windir%\System32\oobe\info\backgrounds\"</code> or changing the user account control settings (UAC) to the lowest, then restarting the computer and updating the script which can be downloaded <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/132581/">https://habr.com/ru/post/132581/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132574/index.html">Red Hat targets Gluster at EMC / VMware</a></li>
<li><a href="../132575/index.html">Eventez</a></li>
<li><a href="../132577/index.html">Last chance to register at Startup Battle</a></li>
<li><a href="../132578/index.html">Site bigmir) net hacked</a></li>
<li><a href="../132579/index.html">New payment system PrivatePay</a></li>
<li><a href="../132582/index.html">Really three-dimensional volume image</a></li>
<li><a href="../132583/index.html">A set of PHD CTF Quals / Afterparty teams opens.</a></li>
<li><a href="../132584/index.html">Google hides bold future projects in a secret lab</a></li>
<li><a href="../132585/index.html">Three lines of shamanism</a></li>
<li><a href="../132586/index.html">Video review of Android applications and games - kedDroid</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>