<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Composition of functions on F # and Scala</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Simply speaking what it is all about 


 I started thinking about writing this article a few weeks ago, after when I tried to explain to my 7 year old...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Composition of functions on F # and Scala</h1><div class="post__text post__text-html js-mediator-article"><h3 id="prosche-govorya-o-chem-vse-eto">  Simply speaking what it is all about </h3><br><p>  I started thinking about writing this article a few weeks ago, after when I tried to explain to my 7 year old child what mathematical functions are.  We began by looking at very simple things.  It will sound crazy and probably awkward, but I finished my introductory explanation with a narration about the composition of functions.  It seemed so logical to explain what functions are, citing examples of their use from the outside world, to talk about composition.  The purpose of this article is to show how simple and powerful is the composition of functions.  I will begin by reviewing the concept of pure composition and a ground clarification, after which we will try a little curry and have fun with the monads.  I hope you will like it. </p><a name="habracut"></a><br><h3 id="funkciya-kak-nebolshoy-yaschik">  Function as a small box </h3><br><p>  Let's imagine the mathematical functions in the form of small boxes (boxes), where each box is able to accept any positive number of arguments, perform any task and return the result.  In short, we could introduce the addition function as shown below: </p><br><p><img src="https://habrastorage.org/files/b30/d99/72c/b30d9972c5a34b74bcbeaadf82bb1d0f.png"></p><br><p>  <em>Image 1, alphanumeric representation of the addition function</em> </p><br><p><img src="https://habrastorage.org/files/355/28d/990/35528d99027a4be19dd4d7d831ab7907.png"></p><br><p>  <em>Image 2, the symbolic representation of the addition function</em> </p><br><p>  Let's consider the situation when we need to build and run a bread factory a la all in one.  This factory will be built on the principle of requests, where each such request will activate a chain of specific operations and at the final stage will give us the result in the form of ready-made bread.  At the beginning we need to define these very specific operations, we will represent each operation as a function / box.  Here is a list of higher order operations that we might need: </p><br><ul><li>  Grind, takes the wheat, grinds it and returns the flour </li><li>  KneadDough, takes flour at the entrance, mixes it with the internal ingredients and produces dough. </li><li>  DistributeDough, takes the entire amount of dough, and distributes it to the forms on the output, it turns out molds with dough </li><li>  Bake, takes dough slices, bakes them and gives out portions of bread. </li></ul><br><p>  It is time to organize a bread factory, gathering in a single production chain as shown below: </p><br><pre><code class="hljs erlang-repl">w -&gt; [Grind] -&gt; [KneadDough] -&gt; [DistributeDough] -&gt; [Bake] -&gt; b</code> </pre> <br><p><img src="https://habrastorage.org/files/d54/160/2d6/d541602d613140b99f935162349ee1fa.png"></p><br><p>  <em>Image 3, representation of the assembled chain</em> </p><br><p>  That's all for now, our chain is ready for work, it is assembled from small pieces, where each piece can be disassembled into separate sub-pieces, and so on.  You can model a huge amount of things from the world around us, simply using the concept of composition of functions.  It is actually very simple.  You can read more theoretical aspects <a href="https://en.wikipedia.org/wiki/Function_composition">here</a> . </p><br><h3 id="vyrazhenie-kompozicii">  Composition expression </h3><br><p>  Let's take a look at how to present the production chain described above using javascript: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = bake(distribureDough(kneadDough(grind(w))));</code> </pre> <br><p>  Try to imagine how a chain of 10 - 15 functions will look, and this is only one of the possible problems that you may encounter.  It is also not quite a composition, since  in mathematics, the composition of functions is the one-by-one application of one function to the result of another to obtain the third function.  We can achieve this in the following way: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myChain1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">w</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bake(distribureDough(kneadDough(grind(w)))); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = myChain1(w);</code> </pre> <br><p>  It looks ridiculous, isn't it?  Let's call on the power of functional programming and implement it in a more digestible form.  We will operate with more understandable examples.  First we need to define what is composition in the functional concept. </p><br><h6 id="versiya-scala">  Scala version </h6><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forward</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TIn</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TIntermediate</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">f: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TIn</span></span></span></span><span class="hljs-class"><span class="hljs-params"> =&gt; </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TIntermediate</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;&gt;</span></span></span><span class="hljs-function"> </span></span>[<span class="hljs-type"><span class="hljs-type">TOut</span></span>](g: <span class="hljs-type"><span class="hljs-type">TIntermediate</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">TOut</span></span>): <span class="hljs-type"><span class="hljs-type">TIn</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">TOut</span></span> = source =&gt; g(f(source)) }</code> </pre> <br><h6 id="versiya-f">  Version f </h6><br><p>  Actually, F # already has a default composition operator, you don't need to declare anything.  But if you still need to override it, you can do it like this: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (&gt;&gt;) fgx = g ( f(x) )</code> </pre> <br><p>  The F # compiler is smart enough to assume that you are dealing with functions, so the type of the function described above <code>(&gt;&gt;)</code> will look like: </p><br><pre> <code class="hljs rust">f:(<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'b</span></span>) -&gt; g:(<span class="hljs-symbol"><span class="hljs-symbol">'b</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'c</span></span>) -&gt; x:<span class="hljs-symbol"><span class="hljs-symbol">'a</span></span> -&gt; <span class="hljs-symbol"><span class="hljs-symbol">'c</span></span></code> </pre> <br><h5 id="sceplyaem-vse-vmeste">  We put everything together </h5><br><p>  The solution for the previous task will look like this on <em>Scala</em> : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BreadFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Wheat</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Flour</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dough</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bread</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">grind</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Wheat</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Flour</span></span>) = w =&gt; {println(<span class="hljs-string"><span class="hljs-string">"make the flour"</span></span>); <span class="hljs-type"><span class="hljs-type">Flour</span></span>()} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kneadDough</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Flour</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Dough</span></span>) = f =&gt; {println(<span class="hljs-string"><span class="hljs-string">"make the dough"</span></span>); <span class="hljs-type"><span class="hljs-type">Dough</span></span>()} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distributeDough</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Dough</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>]) = d =&gt; {println(<span class="hljs-string"><span class="hljs-string">"distribute the dough"</span></span>); <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>]()} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bake</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>] =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bread</span></span>]) = sd =&gt; {println(<span class="hljs-string"><span class="hljs-string">"bake the bread"</span></span>); <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bread</span></span>]()} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { (grind &gt;&gt; kneadDough &gt;&gt; distributeDough &gt;&gt; bake) (<span class="hljs-type"><span class="hljs-type">Wheat</span></span>()) } <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forward</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TIn</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TIntermediate</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">f: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TIn</span></span></span></span><span class="hljs-class"><span class="hljs-params"> =&gt; </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TIntermediate</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;&gt;</span></span></span><span class="hljs-function"> </span></span>[<span class="hljs-type"><span class="hljs-type">TOut</span></span>](g: <span class="hljs-type"><span class="hljs-type">TIntermediate</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">TOut</span></span>): <span class="hljs-type"><span class="hljs-type">TIn</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">TOut</span></span> = source =&gt; g(f(source)) } }</code> </pre> <br><p>  The F # version will be more concise: </p><br><pre> <code class="cs hljs">type Wheat = {wheat:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>} type Flour = {flour:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>} type Dough = {dough:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>} type Bread = {bread:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grind</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">w:Wheat</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"make the flour"</span></span>; {flour = <span class="hljs-string"><span class="hljs-string">""</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kneadDough</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f:Flour</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"make the dough"</span></span>; {dough = <span class="hljs-string"><span class="hljs-string">""</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distributeDough</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d:Dough</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"distribute the dough"</span></span>; seq { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> d} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bake</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sd:seq&lt;Dough&gt;</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"bake the bread"</span></span>; seq { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> {bread = <span class="hljs-string"><span class="hljs-string">""</span></span>}} (grind &gt;&gt; kneadDough &gt;&gt; distributeDough &gt;&gt; bake) ({wheat = <span class="hljs-string"><span class="hljs-string">""</span></span>})</code> </pre> <br><p>  The console output will be: </p><br><pre> <code class="hljs go"><span class="hljs-built_in"><span class="hljs-built_in">make</span></span> the flour <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> the dough distribute the dough bake the bread</code> </pre> <br><h3 id="karring">  Carring </h3><br><p>  If you are not familiar with the concept of currying, you can find more information <a href="https://en.wikipedia.org/wiki/Currying">here</a> .  In this part, we combine two powerful mechanisms from the world of functional programming ‚Äî currying and composition.  Let's consider the situation when you need to work with functions that have more than one parameter and most of these parameters are known before the execution of the function itself.  For example, the <code>bake</code> function from the previous part may have parameters such as temperature and duration of baking, which in turn are well known in advance. </p><br><p>  Scala: </p><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bake</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>] =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bread</span></span>]) = temperature =&gt; duration =&gt; sd =&gt; { println(<span class="hljs-string"><span class="hljs-string">s"bake the bread, duration: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$duration</span></span></span><span class="hljs-string">, temperature: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$temperature</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bread</span></span>]() }</code> </pre> <br><p>  F #: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> bake temperature </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sd:seq&lt;Dough&gt;</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"bake the bread, duration: %d, temperature: %d"</span></span> temperature duration seq { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> {bread = <span class="hljs-string"><span class="hljs-string">""</span></span>}}</code> </pre> <br><p>  Carring is our friend, let's define one recipe for baking bread. </p><br><p>  Scala: </p><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bakeRecipe1</span></span></span><span class="hljs-function"> </span></span>= bake(<span class="hljs-number"><span class="hljs-number">350</span></span>)(<span class="hljs-number"><span class="hljs-number">45</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { (grind &gt;&gt; kneadDough &gt;&gt; distributeDough &gt;&gt; bakeRecipe1) (<span class="hljs-type"><span class="hljs-type">Wheat</span></span>()) }</code> </pre> <br><p>  F #: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bakeRecipe1: seq&lt;Dough&gt; -&gt; seq&lt;Bread&gt; = bake <span class="hljs-number"><span class="hljs-number">350</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> (grind &gt;&gt; kneadDough &gt;&gt; distributeDough &gt;&gt; bakeRecipe1) ({wheat = <span class="hljs-string"><span class="hljs-string">""</span></span>})</code> </pre> <br><p>  The output in both cases will be as follows: </p><br><pre> <code class="hljs go"><span class="hljs-built_in"><span class="hljs-built_in">make</span></span> the flour <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> the dough distribute the dough bake the bread, duration: <span class="hljs-number"><span class="hljs-number">45</span></span>, temperature: <span class="hljs-number"><span class="hljs-number">350</span></span></code> </pre> <br><h3 id="monadicheskie-cepochki">  Monadic chains </h3><br><p>  Can you imagine a situation when something goes wrong in the middle of your chain?  Well, for example, the situation when the wire supply of yeast or water becomes clogged and the production of dough is disturbed, or the situation in which the oven breaks and we get a semi-baked mass of dough.  Pure composition of functions may be interesting for problems tolerant to failures or to their non-failing counterparts.  But what do we do in the above cases?  The answer is obvious - use monads, hmm.  You can find a bunch of fundamental things about monads on a page on <a href="https://en.wikipedia.org/wiki/Monad_(functional_programming)">wikipedia</a> .  Let's see how monads can be useful in our situation, first we need to define (in F #) or use (in Scala) a special type called <code>Either</code> .  The definition in F # may look like a markup union below: </p><br><pre> <code class="cs hljs">type Either&lt;<span class="hljs-string"><span class="hljs-string">'a, '</span></span>b&gt; = | Left of <span class="hljs-string"><span class="hljs-string">'a | Right of '</span></span>b</code> </pre> <br><p>  Now we are ready to concatenate all elements, for this we need to create an equivalent of the <em>bind</em> monadic operation, which takes the monadic value (M) and the function (f) capable of transforming this value ( <code>f: (x -&gt; M y)</code> ). </p><br><p>  F #: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> chainFunOrFail twoTrackInput switchFunction = match twoTrackInput with | Left s -&gt; switchFunction s | Right f -&gt; <span class="hljs-function"><span class="hljs-function">Right f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">let</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">&gt;&gt;=</span></span></span><span class="hljs-function">)</span></span> = chainFunOrFail</code> </pre> <br><p>  Scala: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonadicForward</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TLeft</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TRight</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">twoTrackInput: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Either</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TLeft</span></span></span></span><span class="hljs-class"><span class="hljs-params">,</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">TRight</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">&gt;&gt;=</span></span></span><span class="hljs-function"> </span></span>[<span class="hljs-type"><span class="hljs-type">TIntermediate</span></span>](switchFunction: <span class="hljs-type"><span class="hljs-type">TLeft</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Either</span></span>[<span class="hljs-type"><span class="hljs-type">TIntermediate</span></span>, <span class="hljs-type"><span class="hljs-type">TRight</span></span>]) = twoTrackInput <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Left</span></span> (s) =&gt; switchFunction(s) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Right</span></span> (f) =&gt; <span class="hljs-type"><span class="hljs-type">Right</span></span>(f) } }</code> </pre> <br><p>  The last thing we have to do is make a small adaptation of the above chain in a new, more <code>Either</code> friendly format. </p><br><p>  F #: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grind</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">w:Wheat</span></span></span><span class="hljs-function">): Either&lt;Flour, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt;</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"make the flour"</span></span>; Left {flour = <span class="hljs-string"><span class="hljs-string">""</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kneadDough</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f:Flour</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"make the dough"</span></span>; Left {dough = <span class="hljs-string"><span class="hljs-string">""</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distributeDough</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">d:Dough</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"distribute the dough"</span></span>; Left(seq { <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> d}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> bake temperature </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sd:seq&lt;Dough&gt;</span></span></span><span class="hljs-function">)</span></span> = printfn <span class="hljs-string"><span class="hljs-string">"bake the bread, duration: %d, temperature: %d"</span></span> <span class="hljs-function"><span class="hljs-function">duration temperature </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Left</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">seq { </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">yield</span></span></span></span><span class="hljs-function"><span class="hljs-params"> {bread = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">""</span></span></span></span><span class="hljs-function"><span class="hljs-params">}}</span></span></span><span class="hljs-function">) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> bakeRecipe1: seq&lt;Dough&gt; -&gt; Either&lt;seq&lt;Bread&gt;, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt;</span></span> = bake <span class="hljs-number"><span class="hljs-number">350</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> ({wheat = <span class="hljs-string"><span class="hljs-string">""</span></span>} |&gt; grind) &gt;&gt;= kneadDough &gt;&gt;= distributeDough &gt;&gt;= bakeRecipe1</code> </pre> <br><p>  Scala: </p><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grind</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Wheat</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Either</span></span>[<span class="hljs-type"><span class="hljs-type">Flour</span></span>, <span class="hljs-type"><span class="hljs-type">String</span></span>]) = w =&gt; { println(<span class="hljs-string"><span class="hljs-string">"make the flour"</span></span>); <span class="hljs-type"><span class="hljs-type">Left</span></span>(<span class="hljs-type"><span class="hljs-type">Flour</span></span>()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kneadDough</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Flour</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Either</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>, <span class="hljs-type"><span class="hljs-type">String</span></span>]) = f =&gt; { println(<span class="hljs-string"><span class="hljs-string">"make the dough"</span></span>); <span class="hljs-type"><span class="hljs-type">Left</span></span>(<span class="hljs-type"><span class="hljs-type">Dough</span></span>()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distributeDough</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Dough</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Either</span></span>[<span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>], <span class="hljs-type"><span class="hljs-type">String</span></span>]) = d =&gt; { println(<span class="hljs-string"><span class="hljs-string">"distribute the dough"</span></span>); <span class="hljs-type"><span class="hljs-type">Left</span></span>(<span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>]()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bake</span></span></span></span>: (<span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Dough</span></span>] =&gt; <span class="hljs-type"><span class="hljs-type">Either</span></span>[<span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bread</span></span>], <span class="hljs-type"><span class="hljs-type">String</span></span>]) = temperature =&gt; duration =&gt; sd =&gt; { println(<span class="hljs-string"><span class="hljs-string">s"bake the bread, duration: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$duration</span></span></span><span class="hljs-string">, temperature: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$temperature</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-type"><span class="hljs-type">Left</span></span>(<span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">Bread</span></span>]()) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bakeRecipe1</span></span></span><span class="hljs-function"> </span></span>= bake(<span class="hljs-number"><span class="hljs-number">350</span></span>)(<span class="hljs-number"><span class="hljs-number">45</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { grind(<span class="hljs-type"><span class="hljs-type">Wheat</span></span>()) &gt;&gt;= kneadDough &gt;&gt;= distributeDough &gt;&gt;= bakeRecipe1 }</code> </pre> <br><p>  The output will look like this: </p><br><pre> <code class="hljs go"><span class="hljs-built_in"><span class="hljs-built_in">make</span></span> the flour <span class="hljs-built_in"><span class="hljs-built_in">make</span></span> the dough distribute the dough bake the bread, duration: <span class="hljs-number"><span class="hljs-number">45</span></span>, temperature: <span class="hljs-number"><span class="hljs-number">350</span></span></code> </pre> <br><p>  If one of the elements of your chain returns <code>Right</code> with a corresponding error indicator, the subsequent elements of the chain will be simply ignored and the workflow will skip them all and will simply spread the thrown exception from the previous link to the next one.  You can independently try to play with scenarios in which there are errors. </p><br><h3 id="zaklyuchitelnaya-chast">  Final part </h3><br><p>  As you can see, there is some magical connection between the theory of categories (the origins of monads) and the composition of functions.  The goal of this article is to show how to manage in practice with the presented mechanisms and how to organize your code in a more functional way.  You can plunge into more fundamental aspects of the material presented by yourself.  I hope this article will be useful for those of you who are looking for how to abandon imperative programming and understand the style of functional thinking, or who simply want to discover the practical aspects of monads and functional composition. </p><br><h3 id="ssylki">  Links </h3><br><ul><li>  The English version of this <a href="https://vba.github.io/posts/20160503-functions-composition-in-fsharp-and-scala.html">article</a> . </li><li>  All in one, the F # module is available <a href="https://gist.github.com/vba/409a3493466590f0a7002d728abc4be0">here.</a> </li><li>  Scala version can be downloaded <a href="https://gist.github.com/vba/55d522077268ce1ec586631bc2a2e7a6">here.</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/283162/">https://habr.com/ru/post/283162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283152/index.html">Meteor + MVVM =</a></li>
<li><a href="../283154/index.html">The digest of interesting materials for the mobile # 152 developer (May 4-9)</a></li>
<li><a href="../283156/index.html">PostgreSQL in Azure. Part 1</a></li>
<li><a href="../283158/index.html">MySQL is the best NoSQL system</a></li>
<li><a href="../283160/index.html">Expectations of development directions in the field of data storage and processing until 2020. Key Trends</a></li>
<li><a href="../283166/index.html">The easiest way to create a website</a></li>
<li><a href="../283168/index.html">R: processing missing values</a></li>
<li><a href="../283172/index.html">Digest of fresh materials from the world of frontend, design and IT for the last week ‚Ññ210 (May 2 - 8, 2016)</a></li>
<li><a href="../283176/index.html">Best Practices: Split DNS (Split DNS) in 3CX Phone System Infrastructure</a></li>
<li><a href="../283178/index.html">Production calendar and classifiers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>