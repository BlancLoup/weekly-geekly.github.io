<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Skeletal animation in games. Technician and Resource Overview</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anima is the soul that distinguishes the living from the dead. The Aristotelian soul is the principle of movement, manifested in four forms: movement,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Skeletal animation in games. Technician and Resource Overview</h1><div class="post__text post__text-html js-mediator-article">  Anima is the soul that distinguishes the living from the dead.  The Aristotelian soul is the principle of movement, manifested in four forms: movement, transformation, decrease and increase.  After almost two and a half thousand years, we use the same categories in computer graphics.  Skeletal animation defines movement, morphing is used for transformations, and descending and increasing is the usual scaling.  Animated graphics enlivens the image, breathes the soul into the picture, and this, in my opinion, is even more important than a reliable play of light and shadow. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87e/c70/52c/87ec7052c999787d9c664ef02e0a6094.gif" alt="image"></div><br><br>  Creating high-quality skeletal 3D animations today is perhaps the most difficult task for indie developers.  This is probably why there are so few indie games in 3D, and so many projects in pixel art or primitivism styles, as well as roamers without characters in the frame.  But now this ratio may change ... <br><a name="habracut"></a><br>  Try counting the number of different animations in Uncharted 4. I estimate there are about an hour of unique movements, not counting the front animation ( <a href="https://www.youtube.com/watch%3Fv%3DoGDIMftV4ng%26index%3D44%26list%3DLLGWnymHxC9SD5P4COP6jiag">850 expressions</a> according to the authors).  Such games set a fantastic level of quality. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img height="169" src="https://habrastorage.org/getpro/habr/post_images/4e1/8bd/563/4e18bd563b4fedfb1ccb4a44257e9f34.gif" width="300"></div><br><br><div class="spoiler">  <b class="spoiler_title">Uncharted 4 animation examples (&gt; 40mb GIF)</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf9/f94/0e3/cf9f940e336ee07b2edc40bfc83dd99b.gif" width="300"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/771/bad/0f7/771bad0f7aa642bcaffbcc24ecbfeffd.gif" width="300"></div><br></div></div><br>  If physical rendering and creation of well-lit static scenes are available to enthusiasts thanks to powerful free game engines and 3D modeling tools, creating good animation requires equipment for capturing movements and long-term painstaking work on their implementation.  One of the most affordable systems is the <a href="https://neuronmocap.com/">neuronmocap</a> suit, <a href="https://neuronmocap.com/">which</a> costs about $ 1.5k excluding delivery. <br><br>  I was not able to find examples of creating at least a similar level of animation using a manual personnel approach or some procedural animation.  The maximum that can be done manually, in my opinion, is simple strikes, fast movements and stylized cartoon animation.  But how to make a realistic walk up the stairs, where there are so many details related to the portable center of gravity and the balance of the body?  It is impossible to play them all manually.  Maybe I'm wrong, and someone will show the work of specialists of this level? .. <br><br>  I remember all this in order to appreciate the generous gift from <b>Mixamo</b> .  It literally opens the door to a new level for independent developers: <b>Adobe</b> <a href="http://fortune.com/2015/06/02/adobe-buys-mixamo/">bought</a> Mixamo, and now they give 2.5 thousand skeletal animations for the characters completely free of charge " <a href="https://community.mixamo.com/hc/en-us/community/posts/206646217-Licensing-Royalties-Ownership-EULA-TOS-Open-Q-A">for unlimited commercial or non commercial use</a> ": <br>  <a href="https://www.mixamo.com/">www.mixamo.com</a> <br><br>  Half a year ago it was possible to get them only by laying out about $ 36,000 (well, or spiral in the network).  In addition to animations, the company also offers a free version of the tool for ripping and skinning characters, a tool for creating multiple levels of detail with minimal quality loss (LOD), a character generator and a plugin for capturing facial animation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51d/820/58b/51d82058b78678bbd61e7e62ee077739.gif" alt="Mixamo animation example"></div><br><br>  There are at least well- <a href="http://www.kubold.com/%3Fpage_id%3D55">developed sets of animations</a> , available for purchase by enthusiasts.  But such a huge and high-quality set for the first time was available for free.  Another good source of clips remains <a href="http://mocap.cs.cmu.edu/">the animation base</a> of Carnegie‚Äôs University - Mellon and its <a href="https://www.assetstore.unity3d.com/en/">Unity-adapted version</a> , but the quality and content of this base is not so good. <br><br>  In addition to manual frame animation and motion capture of an actor, there are interesting procedural methods of motion simulation: <a href="https://www.youtube.com/watch%3Fv%3DdRthdBr46cs">evolutionary modeling</a> , <a href="https://www.youtube.com/watch%3Fv%3Durf-AAIwNYk">neural networks</a> , <a href="https://www.youtube.com/watch%3Fv%3D9VO7aCbRpAY">task based locomotion</a> .  Interestingly, at the SIGGRAPH 2016 conference, these challenging technicians pay a lot of attention.  But these things are not yet available to a wide range of independent developers, and I myself would like to know more about the possibility of their real use.  However, today there are also available tools that simulate muscular dynamics ( <a href="https://www.youtube.com/watch%3Fv%3D5PR11gHPzHY">Euphoria Engine</a> and <a href="https://www.youtube.com/watch%3Fv%3D0xICBEQoFvs">Puppet Master</a> for Unity3d), which allow you to bring in different reactions of characters to circumstances. <br><br><div style="text-align:center;"><img height="168" src="https://habrastorage.org/getpro/habr/post_images/48c/bb0/797/48cbb07973cf1743e6939372f63420b7.gif" title="Evolutionary muscular animation in development" width="300"></div><br><br><div style="text-align:center;"><img height="178" src="https://habrastorage.org/getpro/habr/post_images/ccc/0a2/bb0/ccc0a2bb0208e6b6335e438336edef2a.gif" width="200"></div><br><br><div style="text-align:center;"><img height="168" src="https://habrastorage.org/getpro/habr/post_images/ac2/e04/78f/ac2e0478fa3b57c6e291625f6b180c55.gif" title="Euphoria character balances" width="300"></div><br><br>  Get high-quality and diverse animation clips is only the first part of the task. <br>  The second part is to correctly use the received animations while controlling the character.  To do this, you first need to decide how to generally move the character in the scene: based on the data of the animation itself (1), or on the basis of some other considerations (for example, solid state physics) (2).  That is, either the animation will be calculated based on an arbitrary (physical) movement of the object in space (2), or the displacement in space itself will come from the recorded animation, ignoring other interventions (1). <br><br>  Both approaches have advantages and disadvantages.  In the old days, before the mass use of motion capture, there was almost no question about it - the characters moved procedurally, on the basis of some simple principles, and the animation clips were simply played to some extent corresponding to this movement.  But the better the animation and the graphics as a whole became, the more noticeable the discrepancy between the movement of the legs and the displacement of the character, as well as the lack of movement dynamics. <br><br>  One of the clearest examples is the game Guild Wars 2 where the animation of movements and graphics are already quite good, but here a large range of possible speeds and directions of movement of the character is not provided with an equally large set of animations, and the characters either stall in place or slip forward like on ice .  The same problem has been pursuing for a long time and games on the Gamebryo engine (TES series: Morrowind, Skyrim), and many others. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/LhMSaryh0p8%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhj776pQgVIu9Q850RUk5CHEjgUPxw" frameborder="0" allowfullscreen=""></iframe><br><br>  The real movement of a person is nonlinear - first we lean forward, then we throw out the leg, and only then we start the movement, quickly accelerating after the foot makes contact with the ground, and we move by inertia until the next step.  It is difficult to choose a function that accurately describes such a movement, and rarely anyone thinks about it at all.  What to say about more complex movements - strafe, transitions between directions, braking and turning. <br><br>  Therefore, in order to achieve realism, in any case, we will need a gigantic set of various clips with movements in different directions, at different speeds, and so on ... In addition, animated clips can rarely be used in isolation, reproducing one after another.  Most often, the game has a lot of animations, between which there are no special animated transitions.  Therefore, for their simulation, smooth mixing through linear interpolation of bone turns is used.  For convenient setting of such transitions, so-called.  state machine or state machine (State machine).  In UE and Unity there are special tools for this: <a href="https://docs.unrealengine.com/latest/INT/Engine/Animation/Persona/">Persona</a> and <a href="http://docs.unity3d.com/Manual/AnimationOverview.html">Mecanim</a> .  Each node there is a certain state of the skeleton model (the prepared animation clip or the result of their mixing is the Blend Tree).  When certain preconditions are fulfilled, a smooth transition from one state to another takes place, during which both have a time-proportional effect on bone rotations and object displacement.  Thus, the illusion of continuity of movement is achieved. <br><br>  The state may not be a single clip, but a mixed set of clips (Blend Tree / Blend Space) on the same principle.  For example, you can select several clips of movements of the character to the sides, mixing them in proportion to the vector of the desired movement, and get movement at any arbitrary angle.  However, there are such animations for which mixing turns into incorrect postures.  For example, when one animation moves a character's legs forward and the other sideways, linear mixing can cause the legs to intersect with each other.  To avoid this, you need to carefully select animated clips, synchronize their phase, length and speed, or add a separate clip specifically for this type of movement.  All this is a difficult and painstaking work.  And the more possible states and transitions between them, the more difficult it is to bring them into agreement with each other, and make sure that all the necessary transitions work when it is required. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50e/47e/e0c/50e47ee0ce879558c1558adeb2b3f28f.gif" alt="2-D mixing motion tweens"></div><br><br>  1) The most obvious solution is to capture the movements of a real actor with the help of Motion Capture and link the character's shift in the game to the displacement of the ‚Äúroot bone‚Äù in the animation itself - the Root Motion principle.  Then the character will move exactly as the actor moved during the recording. <br><br>  It looks very realistic.  Moreover, this is the only way to reliably reproduce complex maneuvers such as attacks, dodging, and parry attacks with melee weapons. <br><br>  But this approach also has obvious problems. <br><br>  Suppose a character wants to move to the edge of a cliff: the actor on the record leans, lifts his foot and takes a bold broad step across the stage.  And the character walks straight into the abyss ... To avoid this, you need to interrupt the step somewhere in the middle, but it not only looks unnatural, but also makes it difficult for the player to choose the right moment due to the nonlinearity of movement, which can be a long preparation (slope), and then a sharp confident movement (step).  You can record several variations of movements.  Suppose: cautious small steps, normal, and running.  And then mix them in the required speed, which can be increased linearly and predictably.  But what if we need movements to the side?  So for each variant of the step width, we need three or four more variants (minus the mirror ones).  And the character must be able to turn while moving.  So for each option, we need movement with a turn.  And if the turn can be fast and slow?  So once again multiply the number of clips needed by two.  And now we need to move on an inclined surface!  And then we want the character to be able to do the same thing on a squat.  Total - just hundreds and thousands of animation options that need to be mixed and ensure that this happens correctly and leads to movements with the desired speed.  And still, in many cases, the management will be felt as ‚Äúwadded‚Äù, since the inertia of the actor and our inability to foresee all possible human maneuvers will deprive the player of control over the character.  By the way, the players in The Witcher 3 felt this problem, so in one of the major updates, the developers introduced an alternative management option, where the animation responds faster to management to the detriment of realism.  In shooters, the problem of non-linearity of movement becomes particularly pronounced: the player often has to look around the corner and quickly go back, and the moment of an abrupt change in direction can be very different - the player needs to return back to cover as soon as possible, but we cannot predict in advance what width the pitch he planned and play the corresponding animation.  The player, in turn, will find it difficult to get used to the width of the step his character makes and to the speed of this step in order to interrupt him in time. <br><br>  Secondly, Root Motion is bad for network games.  Motion nonlinearity not only makes it difficult for the player to predict speed, but also makes it impossible for us to interpolate and extrapolate motion to compensate for network latency, which is a very important and complex aspect in fast network games.  If the character's offset is set only by animation, then it is difficult to analytically select the necessary parameters of the state machine (mixing different animations), which will lead to movement of the character in the exact direction we need and at the exact speed we need (selected to compensate for the discrepancy).  If we do the opposite, so that the animation will focus on the actual movement, then when correcting the discrepancy between the server and the client, it will be easy to choose the most suitable animation, and even if it slightly mismatches the actual displacement, almost no one will notice. <br><br>  Therefore, the Root Motion technique is often used in third-person single-player games, where control is contextual, depending on the availability of shelter, obstacles, driving patterns, or other circumstances, and is rarely used in network mode and MMOG. <br><br>  Of the last notable projects that use Root Motion, we can distinguish <a href="https://www.youtube.com/watch%3Fv%3DrPqKqTdkh4E">The Witcher 3</a> .  It is difficult to overestimate the efforts invested in the production of all its movements. <br><br><div class="spoiler">  <b class="spoiler_title">An example of the animation The Witcher 3 and its shooting</b> <div class="spoiler_text"><div style="text-align:center;"><img alt="The actor performs the movements of the witcher" src="https://habrastorage.org/getpro/habr/post_images/ad2/04d/a59/ad204da59269ba169ed05b429b242fe4.gif" width="300"></div><br><br><div style="text-align:center;"><img alt="Images from the game The Witcher 3" src="https://habrastorage.org/getpro/habr/post_images/ed5/fe7/cea/ed5fe7cea8d5cda66d15432ce839eea0.gif" width="300"></div><br></div></div><br>  2) Another solution is back to the principle of Root Motion - you need to bring the animation in the most exact correspondence with the happened or planned movement.  Then many of the problems described above are solved - the movement of the character can be made uniformly accelerated and predictable with the possibility of an arbitrarily fast change of direction.  But how to bring the nonlinear and inertial animation in accordance with such a movement?  An interesting integrated approach was described by the developers of the game Paragon.  Its essence is to find and play only the desired series of animation frames to achieve the desired offset / rotation, skipping unnecessary.  And use inverse kinematics to modify the step width. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/1UOY-FMm-xo%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgEebHXS6dv72UD_d8TcTnUIJrftg" frameborder="0" allowfullscreen=""></iframe><br><br>  The first obvious difficulty in adjusting the animation to the movement is that the movement has already occurred, and the animation has not yet been played.  Therefore, a motion prediction system that calculates the position of the character for the next frame is very useful.  Then, knowing the offset that the character must make for the next frame, you need to skip as many frames of the motion animation clip as you need to achieve the desired offset, and play the frame in which the desired offset has been reached.  In this case, the animation will be played at a changed speed, so as to exactly match the actual displacement, and this speed may be faster or slower than the original one, since it is impossible to make the real actor maintain a constant acceleration or speed.  This approach will allow smoothing the animation and aligning it with any complex procedural model of movement that changes during the game (the character can drink some accelerating potion or be slowed down by the opponent).  The disadvantage, of course, is that the animation may become less realistic due to strong changes in speed.  However, in practice, this gives a very good window of available variations in which the speed violations are not noticeable.  And together with the amendments of the step width using inverse kinematics, it covers an even greater range. <br><br>  But, unfortunately, this method quite violates the usual approach to animation, and therefore I could not find an easy way to implement it, for example, using the standard Unity animation component.  The Unreal Engine also does not yet have the necessary functionality, but the developers <a href="https://forums.unrealengine.com/showthread.php%3F97151-Animation-Techniques-used-in-Paragon-and-January-Game-Jam-Theme-Announcement-Live-From-Epic-HQ">promise</a> someday to transfer the low-level developments made for Paragon to the public version of the engine.  The main difficulty is the search and playback of the desired frame based on data on the actual displacement and rotation.  To do this, the authors propose to pre-process animation clips and generate an additional data block for each of them: Distance Curve, in which the offset and rotation of the root bone relative to the beginning or end of the animation will be stored frame by frame.  Then, during the sampling, you can perform a quick binary search of the desired frame, where the corresponding offset and rotation parameters are achieved, and play it back. <br><br>  In the meantime, you can limit yourself to the previous approach, and make a less accurate fit to the speed of the animation to the speed of the planned movement, focusing only on the speed of the character in the last frame.  The most important thing - a good set of souls for experiments is now available! </div><p>Source: <a href="https://habr.com/ru/post/304042/">https://habr.com/ru/post/304042/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304032/index.html">Cloud Storage: API Update</a></li>
<li><a href="../304034/index.html">History of programming languages: 100% "pure" C, without a single "plus"</a></li>
<li><a href="../304036/index.html">Full list of extensions for SQL Server Management Studio (SSMS)</a></li>
<li><a href="../304038/index.html">Typography in the design of emails</a></li>
<li><a href="../304040/index.html">Go language, microservices and DevOps - the good company?</a></li>
<li><a href="../304044/index.html">Ghost buttons in UX design</a></li>
<li><a href="../304046/index.html">PowerShell Module for Intel IoT Gateway</a></li>
<li><a href="../304050/index.html">Security Week 25: Vulnerabilities in Windows, libarchive and wordpress, new old cryptographic stunts</a></li>
<li><a href="../304052/index.html">Virtual reality in the design of data centers</a></li>
<li><a href="../304054/index.html">1C: Manufacturing enterprise management. ERP system overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>