<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backup with Open Source Solution - Bareos</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having a current backup at hand is an extremely important point, because no one is immune from unpleasant incidents associated with the failure of the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backup with Open Source Solution - Bareos</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/simnetworks/blog/313124/"><img src="https://habrastorage.org/files/469/f5d/b48/469f5db48d2642d8af84a8fa8eff68dc.png"></a> <br><br>  Having a current backup at hand is an extremely important point, because no one is immune from unpleasant incidents associated with the failure of the media, loss of information, accidental deletion, etc.  In such situations, the backup will save not only nerves, but also save you from possible financial problems that may arise due to data loss. <a name="habracut"></a><br><br>  <a href="https://www.bareos.org/en/">Bareos</a> - was selected as a backup system for the following reasons: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  is open source; </li><li>  actively developing; </li><li>  has many useful features; </li><li>  can extend its functionality with plugins. </li></ul><br><h3>  Task Description </h3><br>  Suppose we have 3 cars.  Servers: Bareos, BitrixVm, Windows Server 2012 R2.  For example, all this will be within the same network, but Bareos itself, of course, allows you to perform backups if the machine is located outside of it. <br><br><blockquote>  Bareos - 172.16.10.10 <br>  BitrixVM - 172.16.10.11 <br>  Windows Server - 172.16.10.12 </blockquote><br><br>  Add a repository: <br><br><pre><code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta"># wget http:</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//download.bareos.org/bareos/release/latest/CentOS_7/bareos.repo -O /etc/yum.repos.d/bareos.repo</span></span></span></span></code> </pre> <br><br>  For the server with Bareos, we will use CentOS 7. The usual installation occurs: <br><br><pre> <code class="hljs pgsql"># yum install -y bareos-client bareos-<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>-tools bareos-filedaemon bareos-<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>-postgresql bareos bareos-bconsole bareos-<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>-common bareos-<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span> bareos-director bareos-common</code> </pre> <br>  PostgreSQL will be used as the database.  Installation is also easy: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># yum install -y postgresql-server postgresql-contrib</span></span></code> </pre> <br>  When installing Bareos in / etc / bareos, we have the following list of files and folders, with the exception of the ‚Äússl‚Äù directory, we move on to it a little later: <br><br><pre> <code class="hljs dos">/bareos-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>.d /bareos-sd.d /ssl bareos-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>.conf bareos-fd.conf bareos-sd.conf bconsole.conf .rndpwd</code> </pre><br>  After installation, the scripts for working with Bareos will appear in the / usr / lib / bareos / scripts / directory.  Thanks to them, we can pre-configure the database (we will create a database, tables, and rights): <br><br><pre> <code class="hljs swift">su postgres -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /usr/lib/bareos/scripts/create_bareos_database su postgres -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /usr/lib/bareos/scripts/make_bareos_tables su postgres -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> /usr/lib/bareos/scripts/grant_bareos_privileges</code> </pre><br>  The important point is that the names of our machines must be resolved, if not, we add the appropriate lines in / etc / hosts <br><br><pre> <code class="hljs css">172<span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bareos-server</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bareos-fd</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.11</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span> 172<span class="hljs-selector-class"><span class="hljs-selector-class">.16</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">win-fd</span></span></code> </pre><br>  bareos-server - the server itself, bareos-fd - we will also make a backup of the server itself, i.e.  at the same time, it will act as a client, then it will be seen in the configuration, bitrixvm - the client name speaks for itself, win-fd is a client with Windows Server 2012 R2. <br><br>  The configuration of the server part for BareOS, namely the director, must be performed in the bareos-dir.conf file.  The director is responsible for all operations performed. <br><br>  Of the main guidelines: <br><br><blockquote>  Director - description of the director himself, <br>  Storage - the device on which we write backups, <br>  Catalog - contains information on completed jobs, saved files, clients, statuses, <br>  Messages - which messages will be collected and how to deliver them, <br>  Console - configure the console to manage the director, <br>  Client - description of the client from which backup copies will be taken, <br>  Pool - allows you to manage so-called.  Volume where data will be written for different types of backups (Full, Incremental, Differential), limit storage periods. Volume, sizes, <br>  FileSet - what backup and additional attributes, <br>  Schedule - schedule <br>  Job - description of the backup task. </blockquote><br>  From the official documentation, the scheme of interaction between the services: <br><br><img src="https://habrastorage.org/files/3b0/7e9/a6a/3b07e9a6ace0420dae8b29fab2a24329.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Contents of bareos-dir.conf file:</b> <div class="spoiler_text">  Director { <br>  # Mandatory parameter name of director <br>  Name = bareos-server <br>  # Required parameter for request files <br>  QueryFile = "/usr/lib/bareos/scripts/query.sql" <br>  # Number of jobs simultaneously running <br>  Maximum Concurrent Jobs = 10 <br>  # Password (often used 20-40 characters, for the test we will limit ourselves to 9 characters) <br>  Password = "zcx @ # $ BGj" <br>  # Specifying which alerts to use (Message directive is described below) <br>  Messages = Standart <br>  # TLS encryption.  Will be described below. <br>  # TLS enabled <br>  TLS Enable = yes <br>  TLS Require = yes <br><br>  TLS Verify Peer = yes <br>  # Allowed CN <br>  TLS Allowed CN = "bareos-server" <br>  TLS Allowed CN = "bitrixvm" <br>  TLS Allowed CN = "win-fd" <br>  # CA certificate location <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  # Location certificate <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  # Key location to the certificate <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  TLS DH File = /etc/bareos/ssl/dh1024.pem <br>  } <br><br>  Storage { <br>  Name = bareos-server-sd <br>  # You can specify both by IP and by name; for TLS to work correctly, it is important to specify by # name <br>  Address = bareos-server <br>  Password = "zcx @ # $ BGj" <br>  # Sets the name for the device where the data will be stored.  Device parameters are set in the bareos-sd.conf file <br>  Device = bareos-sd <br>  Media Type = File <br>  Port = 9103 <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  } <br><br>  Catalog { <br>  # All parameters for connecting to the database are set <br>  Name = bareos-server <br>  dbdriver = "postgresql" <br>  dbname = "bareos" <br>  dbuser = "bareos" <br>  dbpassword = "" <br>  } <br><br>  Messages { <br>  # Describes the types of messages that should be sent and recorded in the log <br>  Name = Standart <br>  mail = root @ localhost = all,! skipped,! audit <br>  console = all,! skipped,! saved,! audit <br>  append = "/var/log/bareos/bareos.log" = all,! skipped,! audit <br>  append = "/var/log/bareos/bareos-audit.log" = audit <br>  } <br><br>  Client { <br>  # Client name for backup <br>  Name = bareos-fd <br>  # Directory name <br>  Catalog = bareos-server <br>  Enabled = yes <br>  # Address set by name <br>  Address = bareos-server <br>  Password = "zcx @ # $ BGj" <br>  Port = 9102 <br>  # TLS settings will be described later <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  } <br><br>  Pool { <br>  # Pool name for full backup <br>  Name = bareos-pool-Full <br>  # Automatically appends a ‚Äúbareos-client-Full-‚Äù view label to the backup file + number #Volume <br>  # For example, the final name of the Volume after the next backup will look like bareos-client- # Full-0009 <br>  Label Format = "bareos-client-Full-" <br>  # Pool type.  According to the official BareOS documentation, only the type Backup is currently being performed. <br>  Pool Type = Backup <br>  # Volume for full backup stored for 3 months <br>  Volume Retention = 3 months <br>  # after which the directory is cleared of obsolete data <br>  AutoPrune = yes <br>  # Volume is overwritten <br>  Recycle = yes <br>  } <br><br>  Pool { <br>  # Pool name for incremental backup <br>  Name = bareos-pool-Incremental <br>  Pool Type = Backup <br>  Recycle = yes <br>  Auto Prune = yes <br>  Volume Retention = 10 days <br>  Label Format = "bareos-client-Incremental-" <br>  } <br><br>  Pool { <br>  # Pool name for differential backup <br>  Name = bareos-pool-Differential <br>  Pool Type = Backup <br>  Recycle = yes <br>  Auto Prune = yes <br>  Volume Retention = 11 days <br>  Label Format = "bareos-client-Differential-" <br>  } <br><br>  FileSet { <br>  # Set the name for the file set <br>  Name = bareos-fileset <br>  # In Include, we specify which files will be saved.  In this case, the / etc folder <br>  Include { <br>  File = "/ etc" <br>  } <br>  } <br><br>  Schedule { <br>  # Schedule Name <br>  Name = "MonthlyCycle" <br>  # 1 once a week, a full backup is performed <br>  Run = Level = Full mon at 2:00 <br>  # During the day, 5 incremental backups every hour <br>  Run = Level = Incremental hourly at 13:00 <br>  Run = Level = Incremental hourly at 14:00 <br>  Run = Level = Incremental hourly at 15:00 <br>  Run = Level = Incremental hourly at 16:00 <br>  Run = Level = Incremental hourly at 17:00 <br>  } <br><br>  Job { <br>  # Name for the task <br>  Name = Job-Full <br>  # His type.  Maybe Backup or Restore <br>  Type = Backup <br>  # Backup level.  Full, Differential or Incremental <br>  Level = Incremental <br>  # What client is running for? <br>  Client = bareos-fd <br>  # Fileset <br>  FileSet = bareos-fileset <br>  # Schedule <br>  Schedule = "MonthlyCycle" <br>  # Name of used storage <br>  Storage = bareos-server-sd <br>  # Alerts <br>  Messages = Standart <br>  # Used pool <br>  Pool = bareos-pool-Full <br>  Full Backup Pool = bareos-pool-Full <br>  Differential Backup Pool = bareos-pool-Differential <br>  Incremental Backup Pool = bareos-pool-Incremental <br>  } <br><br>  Job { <br>  Name = Job-Full-restore <br>  Type = Restore <br>  Client = bareos-fd <br>  FileSet = "bareos-fileset" <br>  Storage = bareos-server-sd <br>  Pool = bareos-pool-Full <br>  Messages = Standart <br>  # Specifying the path to where all files will get into during recovery <br>  Where = / tmp <br>  } <br></div></div><br>  # Add the two remaining clients as separate configuration files. <br><br><pre> <code class="hljs css">@/<span class="hljs-keyword"><span class="hljs-keyword">etc</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">bareos</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">bareos</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">dir</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">d</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">win</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">conf</span></span> @/etc/bareos/bareos-dir.d/bitrixvm.conf</code> </pre> <br>  It is important that there is a correspondence between the configurations: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/0cb/c9d/2c5/0cbc9d2c54974088996df70580f2a26a.jpg"></div><br><div class="spoiler">  <b class="spoiler_title">Next, configure Storage in bareos-sd.conf:</b> <div class="spoiler_text">  Storage { <br>  # Name <br>  Name = bareos-server-sd <br>  # Maximum number of simultaneously running jobs <br>  Maximum Concurrent Jobs = 20 <br>  # Address, specify by name <br>  SDAddress = bareos-server <br>  SDPort = 9103 <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS Verify Peer = no <br>  TLS Allowed CN = "bareos-server" <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  } <br><br>  Director { <br>  # We describe the parameters of the director who can connect to the Storage <br>  Name = bareos-server <br>  Password = "zcx @ # $ BGj" <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS Verify Peer = yes <br>  TLS Allowed CN = "bareos-server" <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  TLS DH File = /etc/bareos/ssl/dh1024.pem <br>  } <br><br>  Device { <br>  # We describe the storage device itself <br>  Name = bareos-sd <br>  Media Type = File <br>  # Path to device <br>  Archive Device = / opt / backup <br>  # Allow auto-mark up volumes <br>  LabelMedia = yes <br>  # For simultaneous access while performing multiple tasks <br>  Random Access = yes <br>  # Automatically mount device <br>  AutomaticMount = yes <br>  RemovableMedia = no <br>  AlwaysOpen = no <br>  } <br><br>  Messages { <br>  Name = Standard <br>  director = bareos-server = all <br>  } <br><br>  Configure the client bareos-fd.conf: <br><br>  Director { <br>  # Settings for director connection <br>  Name = bareos-server <br>  Password = "zcx @ # $ BGj" <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS Verify Peer = yes <br>  TLS Allowed CN = "bareos-server" <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  TLS DH File = /etc/bareos/ssl/dh1024.pem <br>  } <br><br>  FileDaemon { <br>  # FileDaemon is a synonym for Client <br>  Name = bareos-fd <br>  Maximum Concurrent Jobs = 20 <br>  # Disables compatibility with Bacula.  In this case, all features of #bareos are included, which are enabled by default. <br>  Compatible = no <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br><br>  } <br><br>  Messages { <br>  Name = Standard <br>  director = bareos-server = all <br>  } <br></div></div><br>  After all the basic settings you need to restart the bareos services: <br><br><pre> <code class="hljs pgsql">systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> bareos-dir systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> bareos-sd systemctl <span class="hljs-keyword"><span class="hljs-keyword">restart</span></span> bareos-fd</code> </pre> <br>  In case of errors, we look at the state with the command: <br><br><pre> <code class="hljs dos">systemctl status bareos-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>.service -l</code> </pre> <br>  Let's proceed to the installation of the bareos client plugin for Windows.  You can download <a href="http://download.bareos.org/bareos/release/">here</a> . <br><br>  Installing the plugin is also easy.  From the list of proposed components, we select only two indicated in the screenshot: then we set the name for the client, indicate the parameters of the already existing director: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/634/0af/49a/6340af49af9e42ccb0cbd9eecacb1106.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b2b/537/5f3/b2b5375f3f1948f2af033ab43d8dbfb7.png"></div><br>  We prescribe the following data: <br><br><blockquote>  Client Name - win-fd <br>  Director Name - bareos-server <br>  Password - zcx @ # $ BGj <br>  Networks Address - bareos-server </blockquote><br>  The entered settings can always be corrected, the default configuration file is in ‚ÄúC: \ Program Data \ Bareos \ bareos-fd.conf‚Äù. <br><br>  In the hosts file we also specify the IP for the BareOS server so that the name is resolved.  On the server side (bareos-server), the config for the client (win-fd) looks like this and is located along the /etc/bareos/bareos-dir.d/win.conf path: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  Client { <br>  Name = win-fd <br>  Address = win-fd <br>  Password = "zcx @ # $ BGj" <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  } <br><br>  Pool { <br>  Name = win-bareos-pool-Full <br>  Auto Prune = yes <br>  Label Format = "bareos-client-Full-" <br>  Pool Type = Backup <br>  AutoPrune = yes <br>  Recycle = yes <br>  Volume Retention = 3 months <br>  } <br><br>  Pool { <br>  Name = win-bareos-pool-Differential <br>  Pool Type = Backup <br>  AutoPrune = yes <br>  Recycle = yes <br>  Volume Retention = 11 days <br>  Label Format = "win-bareos-client-Differential-" <br>  } <br><br>  Pool { <br>  Name = win-bareos-pool-Incremental <br>  Pool Type = Backup <br>  AutoPrune = yes <br>  Recycle = yes <br>  Volume Retention = 10 days <br>  Label Format = "win-bareos-client-Incremental-" <br>  } <br><br>  FileSet { <br>  Name = bareos-fileset-win <br>  Include { <br>  File = "C: \\ Users \\" <br>  } <br>  } <br><br>  Job { <br>  Name = Job-win-Full <br>  Type = Backup <br>  Level = Incremental <br>  Client = win-fd <br>  FileSet = bareos-fileset-win <br>  Schedule = "MonthlyCycle" <br>  Storage = bareos-server-sd <br>  Messages = Standart <br>  Pool = win-bareos-pool-Incremental <br>  Full Backup Pool = win-bareos-pool-Full <br>  Differential Backup Pool = win-bareos-pool-Differential <br>  Incremental Backup Pool = bareos-pool-Incremental <br>  } <br><br>  Job { <br>  Name = Job-win-Full-restore <br>  Type = Restore <br>  Client = win-fd <br>  FileSet = "bareos-fileset-win" <br>  Storage = bareos-server-sd <br>  Pool = win-bareos-pool-Full <br>  Messages = Standart <br>  Where = "C: / tmp" <br>  } <br></div></div><br>  From the FileSet directive we see that for the Job-win-Full task we copy the users folder ‚ÄúC: \ Users‚Äù and in the Job-win-Full-restore task we restore it to the folder if necessary ‚ÄúC: \ tmp‚Äù. <br><br>  There is one more client (bitrixvm) for which you need to copy the root directory and copy the mysql database in a separate task. <br><br>  Let‚Äôs go to the bitrixvm machine and install the client: <br>  yum install -y bareos-client bareos-common <br><br>  Moving to the / etc / bareos directory <br><br><pre> <code class="hljs dos">/bareos-<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>.d /bareos-fd.d /bconsole.conf /ssl .rndpwd tray-monitor.d</code> </pre><br>  To configure the client go to the directory /bareos-fd.d <br><br><pre> <code class="hljs axapta">/<span class="hljs-keyword"><span class="hljs-keyword">client</span></span> /director /messages</code> </pre><br>  By default, after installation, the configuration is scattered into the three directories shown above, so for further convenience we will commit partial configurations in the directories and messages directories, and perform all the settings in /client/myself.conf <br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  Client { <br>  Name = bitrixvm <br>  Maximum Concurrent Jobs = 20 <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bitrixvm.cert.pem <br>  TLS Key = /etc/bareos/ssl/bitrixvm.nopass.key.pem <br>  compatible = no <br>  } <br><br>  Director { <br>  Name = bareos-server <br>  Password = "zcx @ # $ BGj" <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS Verify Peer = yes <br>  TLS Allowed CN = "bareos-server" <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bitrixvm.cert.pem <br>  TLS Key = /etc/bareos/ssl/bitrixvm.nopass.key.pem <br>  TLS DH File = /etc/bareos/ssl/dh1024.pem <br>  } <br><br>  Messages { <br>  Name = Standard <br>  Director = bareos-server = all,! Skipped,! Restored <br>  Description = "Send relevant messages to the Director." <br>  } <br></div></div><br>  We enter the parameters and restart the service: <br><br><pre> <code class="hljs swift">/etc/<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>.d/bareos-fd restart</code> </pre> <br>  Register in the hosts address for the bareos-server <br><br>  On the server side (bareos-server), the configuration for the client (bitrixvm) is as follows: /etc/bareos/bareos-dir.d/bitrixvm.conf: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  Client { <br>  Name = bitrixvm <br>  Address = bitrixvm <br>  Password = "zcx @ # $ BGj" <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br><br>  } <br><br>  Pool { <br>  Name = bitrixvm-bareos-pool-Full <br>  Label Format = "bitrixvm-bareos-client-Full-" <br>  Pool Type = Backup <br>  AutoPrune = yes <br>  Recycle = yes <br>  Volume Retention = 3 months <br>  } <br><br>  Pool { <br>  Name = bitrixvm-bareos-pool-Differential <br>  Pool Type = Backup <br>  Label Format = "bitrixvm-bareos-client-Differential-" <br>  AutoPrune = yes <br>  Recycle = yes <br>  Select Job resource (1-6): = 11 days <br>  } <br><br>  Pool { <br>  Name = bitrixvm-bareos-pool-Incremental <br>  Pool Type = Backup <br>  Label Format = "bitrixvm-bareos-client-Incremental-" <br>  AutoPrune = yes <br>  Recycle = yes <br>  Volume Retention = 10 days <br>  } <br><br>  Job { <br>  Name = Job-bitrixvm-mysql <br>  Type = Backup <br>  Level = Full <br>  Client = bitrixvm <br>  FileSet = bareos-fileset-bitrixvm-mysql <br>  Schedule = "MonthlyCycle" <br>  Storage = bareos-server-sd <br>  Messages = Standart <br>  Pool = bitrixvm-bareos-pool-Incremental <br>  Full Backup Pool = bitrixvm-bareos-pool-Full <br>  Differential Backup Pool = bitrixvm-bareos-pool-Differential <br>  Incremental Backup Pool = bitrixvm-bareos-pool-Incremental <br><br>  RunScript { <br>  # Run the script described in this section before performing the backup <br>  RunsWhen = Before <br>  # Run the script if the task (Job) fails <br>  RunsOnFailure = Yes <br>  RunsOnClient = Yes <br>  # <br>  # The command for the script itself <br>  Command = "sh -c 'mysqldump -uroot -ppassword --opt --all-databases&gt; /tmp/dump.sql'" <br>  } <br>  } <br><br>  Job { <br>  Name = Job-bitrixvm-Full <br>  Type = Backup <br>  Level = Full <br>  Client = bitrixvm <br>  FileSet = bareos-fileset-bitrixvm <br>  Schedule = "MonthlyCycle" <br>  Storage = bareos-server-sd <br>  Messages = Standart <br>  Pool = bitrixvm-bareos-pool-Incremental <br>  Full Backup Pool = bitrixvm-bareos-pool-Full <br>  Differential Backup Pool = bitrixvm-bareos-pool-Differential <br>  Incremental Backup Pool = bitrixvm-bareos-pool-Incremental <br>  } <br><br>  FileSet { <br>  Name = bareos-fileset-bitrixvm <br>  Include { <br>  Options { <br>  compression = GZIP <br>  } <br>  File = "/" <br>  } <br>  } <br><br>  FileSet { <br>  Name = bareos-fileset-bitrixvm-mysql <br>  Include { <br>  Options { <br>  # Set the type of compression <br>  compression = GZIP <br>  signature = MD5 <br>  } <br>  File = "/tmp/dump.sql" <br>  } <br>  } <br><br>  Job { <br>  Name = Job-bitrixvm-mysql-restore <br>  Type = Restore <br>  Client = bitrixvm <br>  FileSet = "bareos-fileset-bitrixvm-mysql" <br>  Storage = bareos-server-sd <br>  Pool = bitrixvm-bareos-pool-Full <br>  Messages = Standart <br>  Where = / tmp <br>  } <br><br>  Job { <br>  Name = Job-bitrixvm-Full-restore <br>  Type = Restore <br>  Client = bitrixvm <br>  FileSet = "bareos-fileset-bitrixvm" <br>  Storage = bareos-server-sd <br>  Pool = bitrixvm-bareos-pool-Full <br>  Messages = Standart <br>  Where = / tmp <br>  } <br></div></div><br>  In the RunScript section of the Command parameter, we run the mysqldump command, passing all the necessary "mysqldump -uroot -ppassword --opt --all-databases&gt; /tmp/dump.sql" parameters. <br><br>  The saved dump.sql file will be backed up as specified for the FileSet called "bareos-fileset-bitrixvm-mysql". <br><br>  Bareos uses the TLS protocol to encrypt data transfers.  For each client and director we must have a CA certificate, certificate and key.  We will use self-signed certificates, all this can be done through openssl. <br><br>  Let's follow the path of the openssl configuration file /etc/pki/tls/openssl.cnf <br><br>  We generate CA certificate: <br><br><pre> <code class="hljs scala">#openssl req -config openssl.cnf -<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -x509 -extensions v3_ca -keyout <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>/myca.key -out certs/myca.crt</code> </pre> <br>  After entering the password and other data, we get two files: <br><br><pre> <code class="hljs swift">/etc/pki/<span class="hljs-type"><span class="hljs-type">CA</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>/myca.key /etc/pki/<span class="hljs-type"><span class="hljs-type">CA</span></span>/certs/myca.crt</code> </pre> <br>  We will correct / check the settings file openssl.cnf so that the paths to the certificates are correct, bold highlights what needs to be changed. <br><br>  You also need to create the index.txt and serial files in the / etc / pki / CA folder: <br><br><pre> <code class="hljs pgsql">touch /etc/pki/CA/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.txt</code> </pre> <br>  In the serial file we immediately enter the value ‚Äú01‚Äù, the file will contain the following number for the following certificates: <br><br><pre> <code class="hljs ruby">echo <span class="hljs-string"><span class="hljs-string">'01'</span></span> &gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/pki</span></span><span class="hljs-regexp"><span class="hljs-regexp">/CA/serial</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Openssl.cnf content:</b> <div class="spoiler_text">  dir = <b>/ etc / pki / CA</b> <br>  certs = $ dir / certs <br>  crl_dir = $ dir / crl <br>  database = $ <b>dir / index.txt</b> <br>  #unique_subject = no <br><br>  new_certs_dir = $ dir / newcerts <br><br>  certificate = $ <b>dir / certs / myca.crt</b> <br>  serial = $ <b>dir / serial</b> <br>  crlnumber = $ dir / crlnumber <br><br>  crl = $ dir / crl.pem <br>  private_key = $ <b>dir / private / myca.key</b> <br>  RANDFILE = $ dir / private / .rand <br><br>  x509_extensions = usr_cert </div></div><br>  We generate a key for the server, you will need to enter a password. <br><br><pre> <code class="hljs pgsql">openssl genrsa -aes256 -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> bareos-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.key.pem <span class="hljs-number"><span class="hljs-number">4096</span></span></code> </pre> <br>  We generate a certificate request.  The important point is that in this section, when generating the certificate, you must correctly specify the Common Name (CN) so that it matches the name of the machine, otherwise errors will occur when attempting to perform any task.  In this example, CN = bareos-server <br>  openssl req -config openssl.cnf -key bareos-server.key.pem -new -sha256 -out bareos-server.csr.pem <br><br>  We sign CSR through CA, we get the certificate itself <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ca</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cnf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bareos-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bareos-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cert</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span></code> </pre> <br>  We remove the password for the key, because  bareos need him password free <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rsa</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bareos-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bareos-server</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.nopass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span></code> </pre> <br>  We will convert the CA key and certificate into one file with the PEM extension. <br><br><pre> <code class="hljs swift">cat /etc/pki/<span class="hljs-type"><span class="hljs-type">CA</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">private</span></span>/myca.key /etc/pki/<span class="hljs-type"><span class="hljs-type">CA</span></span>/certs/myca.cert &gt; ca-chain.cert.pem</code> </pre> <br>  Generating DH key <br><br><pre> <code class="hljs objectivec">openssl dhparam -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> dh1024.pem <span class="hljs-number"><span class="hljs-number">-5</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span></code> </pre> <br>  Copy the bareos-server.cert.pem certificates bareos-server.nopass.key.pem ca-chain.cert.pem dh1024.pem to the / etc / bareos / ssl folder that you first need to create and install the bareos group <br><br>  For each certificate, change the group to bareos <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">chgrp</span></span> bareos *</code> </pre> <br>  Similar actions need to be done for each client (bitrixvm, win-fd): <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">genrsa</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-aes256</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> 4096 <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">req</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cnf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-key</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-new</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-sha256</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ca</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-config</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cnf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.csr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cert</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">rsa</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-in</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-out</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bitrixvm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.nopass</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.key</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.pem</span></span></code> </pre> <br>  Using SCP, copy 4 files bitrixvm.cert.pem bitrixvm.nopass.key.pem ca-chain.cert.pem dh1024.pem to a remote bitrixvm machine in the / etc / bareos / ssl folder, which you must first create and install the bareos group for folder so for certificates. <br><br>  The bitrixvm client configuration (/etc/bareos/bareos-fd.d/client/myself.conf) in the Director {} section requires that client certificates, but not the director, be registered.  In the configuration on the server side (/etc/bareos/bareos-dir.d/bitrixvm.conf), in the Client {} section, director certificates are specified.  After making configuration changes, restart the services. <br><br>  Creating certificates for a win-fd machine is identical. <br><br>  You also need to register certificates for bconsole, a utility that allows you to manage the director in the /etc/bareos/bconsole.conf file: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  Director { <br>  Name = bareos-server <br>  DIRport = 9101 <br>  address = bareos-server <br>  Password = "mmm_777" <br>  TLS Enable = yes <br>  TLS Require = yes <br>  TLS Verify Peer = yes <br>  TLS Allowed CN = "bareos-server" <br>  TLS CA Certificate File = /etc/bareos/ssl/ca-chain.cert.pem <br>  TLS Certificate = /etc/bareos/ssl/bareos-server.cert.pem <br>  TLS Key = /etc/bareos/ssl/bareos-server.nopass.key.pem <br>  } <br></div></div><br>  The backup or restore procedure is as follows.  Let's use the bconsole utility, as a greeting we will see * <br>  run Shows all possible jobs: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  * run <br>  A job name must be specified. <br>  The defined Job resources are: <br>  1: Job-Full <br>  2: Job-Full-restore <br>  3: Job-bitrixvm-mysql <br>  4: Job-bitrixvm-Full <br>  5: Job-bitrixvm-mysql-restore <br>  6: Job-bitrixvm-Full-restore <br>  Select Job resource (1-6): 3 <br><br>  Run backup job <br>  JobName: Job-bitrixvm-mysql <br>  Level: Full <br>  Client: bitrixvm <br>  Format: Native <br>  FileSet: bareos-fileset-bitrixvm-mysql <br>  Pool: bitrixvm-bareos-pool-Full (From Job FullPool override) <br>  Storage: bareos-server-sd (From Job resource) <br>  When: 2016-10-16 11:05:16 <br>  Priority: 10 <br>  OK to run?  (yes / mod / no): <br>  # Task left for execution gets JobId <br>  Job queued.  JobId = 75 <br></div></div><br>  The result of the command can be viewed either through the message command and in response we get something like this: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  16-Oct 11:05 bareos-server-sd JobId 75: Volume ‚Äúbitrixvm-bareos-client-Full-0011‚Äù previously written, moving to end of data. <br>  16-Oct 11:05 bareos-server-sd JobId 75: ‚Äúbitrixvm-bareos-client-Full-0011‚Äù size = 2086097429 <br>  16-Oct 11:05 bareos-server-sd JobId 75: Elapsed time = 00: 00: 01, Transfer rate = 319.2 K Bytes / second <br>  16-Oct 11:05 bareos-server JobId 75: Bareos bareos-server 15.2.2 (16Nov15): <br>  Build OS: x86_64-redhat-linux-gnu redhat CentOS Linux release 7.0.1406 (Core) <br>  JobId: 75 <br>  Job: Job-bitrixvm-mysql.2016-10-16_11.05.38_07 <br>  Backup Level: Full <br>  Client: ‚Äúbitrixvm‚Äù 16.3.1 (01Jul16) x86_64-redhat-linux-gnu, redhat, CentOS release 6.6 (Final), CentOS_6, x86_64 <br>  FileSet: ‚Äúbareos-fileset-bitrixvm-mysql‚Äù 2016-10-14 04:57:40 <br>  Pool: "bitrixvm-bareos-pool-Full" (From Job FullPool override) <br>  Catalog: ‚Äúbareos-server‚Äù (From Client resource) <br>  Storage: "bareos-server-sd" (From Job resource) <br>  Scheduled time: 16-Oct-2016 11:05:16 <br>  Start time: 16-Oct-2016 11:05:42 <br>  End time: 16-Oct-2016 11:05:42 <br>  Elapsed time: 0 secs <br>  Priority: 10 <br>  FD Files Written: 1 <br>  SD Files Written: 1 <br>  FD Bytes Written: 319,187 (319.1 KB) <br>  SD Bytes Written: 319,285 (319.2 KB) <br>  Rate: 0.0 KB / s <br>  Software Compression: 71.0% (gzip) <br>  VSS: no <br>  Encryption: no <br>  Accurate: no <br>  Volume name (s): bitrixvm-bareos-client-Full-0011 <br>  Volume Session Id: 3 <br>  Volume Session Time: 1476554202 <br>  Last Volume Bytes: 2,086,417,588 (2.086 GB) <br>  Non-fatal FD errors: 0 <br>  SD Errors: 0 <br>  FD termination status: OK <br>  SD termination status: OK <br>  Termination: Backup OK <br></div></div><br>  Or through the status dir command <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text">  Terminated Jobs: <br>  JobId Level Files Bytes Status Finished Name <br>  ================================================= ================== <br>  72 Full 0 0 Error 15-Oct-16 13:39 Job-bitrixvm-Full <br>  73 Full 49,442 515.4 M OK 15-Oct-16 14:03 Job-bitrixvm-Full <br>  74 Incr 20 36.81 K OK 16-Oct-16 02:01 Job-Full <br>  75 Full 1 319.1 K OK 16-Oct-16 11:05 Job-bitrixvm-mysql <br></div></div><br>  Where in the status column, you can view the status of the backup.  Job number 75 was successful. <br><br>  The restore is done by the restore command <br><br><pre> <code class="hljs dos">*<span class="hljs-built_in"><span class="hljs-built_in">restore</span></span></code> </pre> <br>  Then a list of all possible options will be offered. <br><br><blockquote>  To select the JobIds, you have the following choices: <br><br>  1: List last 20 Jobs run <br>  2: List Jobs where a given File is saved <br>  3: Enter list of comma separated JobIds to select <br>  4: Enter SQL list command <br>  5: Select the most recent backup for a client <br>  6: Select backup for a client <br>  7: Enter a list of files to restore <br>  8: Enter a list of files <br>  9: Find the JobIds of the most recent backup for a client <br>  10: Find the job <br>  11: Enter a list of directories to restore for found JobIds <br>  12: Select full restore to a specified job date <br>  13: Cancel </blockquote><br>  We will show the list of the last 20 tasks: <br><br><img src="https://habrastorage.org/files/f3c/1e5/5ae/f3c1e55ae1a3452b9f80cb59f8ec76d4.png"><br><br>  Click 3 and specify JobID number, for example 75. After that, we automatically get to the console to select the files that we want to restore. <br><br><pre> <code class="hljs swift">cwd <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>: / $</code> </pre> <br>  A list of all available commands can be viewed via the help command.  We check which files are available in this backup, mark the necessary files with the mark command by specifying the files or via *, thus selecting everything.  Upon completion, we execute the done command, after which the dialogue with the system will start <br><br><pre> <code class="hljs ruby">$ ls tmp/ $ cd tmp/ cwd <span class="hljs-symbol"><span class="hljs-symbol">is:</span></span> /tmp/ $ ls dump.sql $ mark * <span class="hljs-number"><span class="hljs-number">1</span></span> file marked. $ done</code> </pre> <br>  The job will require the following <br>  Volume (s) Storage (s) SD Device (s) <br>  ================================================= ========================= <br><br>  bitrixvm-bareos-client-Full-0011 bareos-server-sd bareos-sd <br><br>  Volumes marked with "*" are online. <br><br>  1 file selected to be restored. <br><br>  Select the recovery task we need (point 2) <br><br>  The defined Restore Job resources are: <br>  1: Job-Full-restore <br>  2: Job-bitrixvm-mysql-restore <br>  3: Job-bitrixvm-Full-restore <br>  Select Restore Job (1-3): 2 <br><br>  Set the client for which we perform the recovery (2) <br><br>  Defined Clients: <br>  1: bareos-fd <br>  2: bitrixvm <br>  3: win-fd <br>  Select the Client (1-3): 2 <br><br>  Using Catalog "bareos-server" <br>  Run Restore job <br>  JobName: Job-bitrixvm-mysql-restore <br> Bootstrap: /var/lib/bareos/bareos-server.restore.1.bsr <br> Where: /tmp <br> Replace: Always <br> FileSet: bareos-fileset-bitrixvm-mysql <br> Backup Client: bitrixvm <br> Restore Client: bitrixvm <br> Format: Native <br> Storage: bareos-server-sd <br> When: 2016-10-16 11:26:54 <br> Catalog: bareos-server <br> Priority: 10 <br> Plugin Options: *None* <br> OK to run? (yes/mod/no): yes <br><br>    yes,  mod      ,        .    JobId. <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Job</span></span> queued. JobId=<span class="hljs-number"><span class="hljs-number">76</span></span></code> </pre> <br>   status dir    .     .       ,    /tmp    dump.sql. <br><br><pre> <code class="hljs css">76 1 1<span class="hljs-selector-class"><span class="hljs-selector-class">.100</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">M</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">OK</span></span> 16<span class="hljs-selector-tag"><span class="hljs-selector-tag">-Oct-16</span></span> 11<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:27</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Job-bitrixvm-mysql-restore</span></span></code> </pre> <br>    ,  Bareos  ,       ,      ,   ,         (  MS SQL,      Ceph, Gluster,  LDAP). <br><br> <a href="https://www.sim-networks.com/protected-cloud%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink"><img src="https://habrastorage.org/files/c2e/22e/3bd/c2e22e3bd22c4a0985f83c601d0394f4.png"></a> <br><br><hr><br>  <a href="https://www.sim-networks.com/protected-cloud%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink">SIM-CLOUD - Fail-safe cloud in Germany</a> <br><br>  <a href="https://www.sim-networks.com/dedicated-custom%3Fpid%3D2449%26utm_source%3Dhabrahabr%26utm_campaign%3Dcontent%26utm_medium%3Dpostlink">Dedicated servers in reliable data centers in Germany!</a> <br>  Any configuration, quick build and free installation </div><p>Source: <a href="https://habr.com/ru/post/313124/">https://habr.com/ru/post/313124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313114/index.html">Top 5 Threats to Online Gaming Users</a></li>
<li><a href="../313116/index.html">A simple class for building lines of the level of a two-dimensional grid function</a></li>
<li><a href="../313118/index.html">Introduction to Labtech - we automate the work of a system administrator</a></li>
<li><a href="../313120/index.html">Google Opens Source Code for Nomulus - Top-Level Cloud Domain Management Tool</a></li>
<li><a href="../313122/index.html">Four largest Australian banks want to boycott Apple Pay</a></li>
<li><a href="../313126/index.html">How to get into gamedev and become a sought-after specialist. Part 2</a></li>
<li><a href="../313128/index.html">From Jquery UI to Ext.js: a review of javascript UI libraries for the SPA. Part 1</a></li>
<li><a href="../313130/index.html">Dive into the blockchain technology: Ecosystem of digital dentistry</a></li>
<li><a href="../313132/index.html">VK rake SDK for Android</a></li>
<li><a href="../313134/index.html">Acyclic Visitor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>