<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a universal UIAlertController for various versions of iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most popular classes in UIKit before the release of iOS version 8 was UIAlertView and UIActionSheet. Probably every developer of applicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a universal UIAlertController for various versions of iOS</h1><div class="post__text post__text-html js-mediator-article">  One of the most popular classes in UIKit before the release of iOS version 8 was UIAlertView and UIActionSheet.  Probably every developer of applications for the mobile platform from Apple, sooner or later came across them.  Displaying messages or an action selection menu is an integral part of almost any user application.  To work with these classes, or rather, to handle keystrokes, the programmer needed to implement in its class the methods of the corresponding delegate - UIAlertViewDelegate or UIActionSheetDelegate (if you didn‚Äôt need anything beyond, then it was enough to implement the clickedButtonAtIndex).  In my opinion, this is very inconvenient: if several dialog boxes with different sets of actions were created inside the object, they were still processed in the same method with a bunch of conditions inside.  With the release of iOS 8, UIKit now includes the UIAlertController class, which replaced the UIAlertView and UIActionSheet.  And one of its main distinguishing features is that instead of delegates it uses the block approach: <br><br><pre><code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">UIAlertController</span></span> *alertController = [<span class="hljs-built_in"><span class="hljs-built_in">UIAlertController</span></span> alertControllerWithTitle:<span class="hljs-string"><span class="hljs-string">@"Hello"</span></span> message:<span class="hljs-string"><span class="hljs-string">@"Habr!"</span></span> preferredStyle:<span class="hljs-built_in"><span class="hljs-built_in">UIAlertControllerStyleAlert</span></span>]; [alertController addAction:[<span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> actionWithTitle:<span class="hljs-string"><span class="hljs-string">@"Action"</span></span> style:<span class="hljs-built_in"><span class="hljs-built_in">UIAlertActionStyleDefault</span></span> handler:^(<span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> *action) { <span class="hljs-comment"><span class="hljs-comment">//    }]];</span></span></code> </pre> <br>  This approach allows you to write more structured and logical code.  From now on, the programmer no longer needs to separate the creation of a dialog box and event handling - UIAlertController eliminates this misunderstanding, but at the same time introduces historical injustice due to the impossibility of using it in iOS 7 and earlier versions.  There are several ways to solve this problem: <br><br><ul><li>  Disregard the UIAlertController and continue to use outdated UIAlertView and UIActionSheet. <br></li><li>  Use custom dialogs.  The programmer either writes his own implementation, which leads to an increase in time costs, or connects third-party components (for example, <a href="https://github.com/Sumi-Interactive/SIAlertView">SIAlertView</a> ), the use of which has several disadvantages: <br><ol><li>  software modules with good support can be counted on the fingers (often their creators quickly throw this thankless job); </li><li>  If a project uses several components from different developers, then there may be problems with their interaction (rarely, but it is possible). </li></ol><br></li><li>  Check the iOS version and create either a UIAlertController, either a UIAlertView or a UIActionSheet. <br></li></ul><br>  The last option is the most logical, and most of the developers, I am sure, would choose it, but this method has a significant drawback - the condition for checking the version of the operating system will have to be written every time you need to display a dialog box.  Faced with this in practice, I created a special wrapper class UIAlertDialog, which allows you to forget about this problem. <br><a name="habracut"></a><br>  The idea is that the convenient block syntax UIAlertController'a can be used in their projects, not limited to the latest versions of iOS. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Defining the style of the dialog box <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NS_ENUM</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyle</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyleAlert</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyleActionSheet</span></span> };</code> </pre><br>  and block type <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(^<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogHandler</span></span>)(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> buttonIndex);</code> </pre><br>  You can go to the class structure: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialog</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertViewDelegate</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIActionSheetDelegate</span></span></span><span class="hljs-class">&gt; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instancetype</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithStyle</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialogStyle</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">style</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">andMessage</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addButtonWithTitle</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">andHandler</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialogHandler</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">handler</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">showInViewController</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">viewContoller</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Inside the constructor</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">instancetype</span></span>)initWithStyle:(<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyle</span></span>)style title:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)title andMessage:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)message { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = [<span class="hljs-keyword"><span class="hljs-keyword">super</span></span> init]) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.style = style; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title = title; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.message = message; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items = [<span class="hljs-built_in"><span class="hljs-built_in">NSMutableArray</span></span> new]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; }</code> </pre><br></div></div><br>  passed parameters are saved in <br><br><div class="spoiler">  <b class="spoiler_title">internal variables</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialog</span></span></span><span class="hljs-class"> () @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialogStyle</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">style</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSMutableArray</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">items</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></div></div><br>  and initialized an array (items) that will store the actions of the buttons. <br><br>  Adding a new button: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)addButtonWithTitle:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)title andHandler:(<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogHandler</span></span>)handler { <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> *item = [<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> new]; item.title = title; item.handler = handler; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items addObject:item]; }</code> </pre><br>  where UIAlertDialogItem is <br><br><div class="spoiler">  <b class="spoiler_title">special inner class (analogous to UIAlertAction)</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialogItem</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">copy</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialogHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">handler</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br></div></div><br>  which stores the text of the button and the action associated with it. <br><br>  And finally, the <i>showInViewController</i> method, which encapsulates the creation of a dialog box depending on the version of the operating system: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showInViewController:(<span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span> *)viewContoller { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([[<span class="hljs-built_in"><span class="hljs-built_in">UIDevice</span></span> currentDevice].systemVersion intValue] &gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) { [[<span class="hljs-built_in"><span class="hljs-built_in">NSOperationQueue</span></span> mainQueue] addOperationWithBlock:^{ [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> showAlertControllerInViewController:viewContoller]; }]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.style == <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyleActionSheet</span></span>) { [[<span class="hljs-built_in"><span class="hljs-built_in">NSOperationQueue</span></span> mainQueue] addOperationWithBlock:^{ [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> showActionSheetInView:viewContoller.view]; }]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { [[<span class="hljs-built_in"><span class="hljs-built_in">NSOperationQueue</span></span> mainQueue] addOperationWithBlock:^{ [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> showAlert]; }]; } }</code> </pre><br>  I focus your attention on the fact that each corresponding method is not executed immediately, but is added to the main queue for execution.  This is due to the fact that if another dialog box is created in the button handler, it will be displayed only after the entire animation of the previous dialog is completed. <br><br>  Let us consider in detail the methods for creating dialog boxes: <br><br>  <b>UIAlertController</b> <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showAlertControllerInViewController:(<span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span> *)viewController { <span class="hljs-built_in"><span class="hljs-built_in">UIAlertController</span></span> *alertController = [<span class="hljs-built_in"><span class="hljs-built_in">UIAlertController</span></span> alertControllerWithTitle:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title message:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.message preferredStyle:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.style == <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyleActionSheet</span></span> ? <span class="hljs-built_in"><span class="hljs-built_in">UIAlertControllerStyleActionSheet</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">UIAlertControllerStyleAlert</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> *item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items) { <span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> *alertAction = [<span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> actionWithTitle:item.title style:<span class="hljs-built_in"><span class="hljs-built_in">UIAlertActionStyleDefault</span></span> handler:^(<span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> *action) { <span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> buttonIndex = i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.handler) { item.handler(buttonIndex); } }]; [alertController addAction:alertAction]; i++; } <span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> *closeAction = [<span class="hljs-built_in"><span class="hljs-built_in">UIAlertAction</span></span> actionWithTitle:<span class="hljs-built_in"><span class="hljs-built_in">NSLocalizedString</span></span>(<span class="hljs-string"><span class="hljs-string">@"close"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) style:<span class="hljs-built_in"><span class="hljs-built_in">UIAlertActionStyleCancel</span></span> handler:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [alertController addAction:closeAction]; [viewController presentViewController:alertController animated:<span class="hljs-literal"><span class="hljs-literal">YES</span></span> completion:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; }</code> </pre><br>  In this listing, I would like to mark the line <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span> buttonIndex = i;</code> </pre><br>  or rather its position in the code.  Due to the property of the block to store the context in which it was created, it becomes possible to transfer the index of the pressed button to the block handler.  This method is necessary: ‚Äã‚ÄãUIAlertAction does not contain the desired parameter. <br><br>  <b>UIAlertView</b> and <b>UIActionSheet</b> <br><br>  According to the UIAlertDialog description, now the creation of the dialog box looks like this: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showMessage:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)message { <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialog</span></span> *alertDialog = [[<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialog</span></span> alloc] initWithStyle:<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogStyleAlert</span></span> title:message andMessage:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; [alertDialog showInViewController:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; }</code> </pre><br>  due to the fact that this class is a delegate of UIAlertView and UIActionSheet <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialog</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertViewDelegate</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIActionSheetDelegate</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br>  it is necessary to clarify one point. <br><br>  As you know, delegates in a class are described as properties with the <i>weak</i> modifier.  This means that if the <i>strong</i> references to the delegate object no longer exist, then an attempt to call delegate methods will throw an EXC_BAD_ACCESS exception. <br><br>  In our case, this is exactly what will happen - the ARC will remove the <i>alertDialog</i> , since there are no external links to it.  The problem can be solved by creating the heir classes UIAlertView and UIActionSheet by adding a link to the dialog object in them: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertViewDialog</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertView</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialog</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alertDialog</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  and <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIActionSheetDialog</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIActionSheet</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIAlertDialog</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alertDialog</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Thanks to this manipulation, the code for creating dialog boxes will look like this: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showActionSheetInView:(<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span> *)view { <span class="hljs-built_in"><span class="hljs-built_in">UIActionSheetDialog</span></span> *actionSheet = [[<span class="hljs-built_in"><span class="hljs-built_in">UIActionSheetDialog</span></span> alloc] initWithTitle:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title delegate:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> cancelButtonTitle:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> destructiveButtonTitle:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> otherButtonTitles:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; actionSheet.alertDialog = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> *item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items) { [actionSheet addButtonWithTitle:item.title]; } [actionSheet addButtonWithTitle:<span class="hljs-built_in"><span class="hljs-built_in">NSLocalizedString</span></span>(<span class="hljs-string"><span class="hljs-string">@"close"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)]; actionSheet.cancelButtonIndex = actionSheet.numberOfButtons - <span class="hljs-number"><span class="hljs-number">1</span></span>; [actionSheet showInView:view.window]; }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">similarly for UIAlertView</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)showAlert { <span class="hljs-built_in"><span class="hljs-built_in">UIAlertViewDialog</span></span> *alertView = [[<span class="hljs-built_in"><span class="hljs-built_in">UIAlertViewDialog</span></span> alloc] initWithTitle:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title message:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.message delegate:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> cancelButtonTitle:<span class="hljs-literal"><span class="hljs-literal">nil</span></span> otherButtonTitles:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; alertView.alertDialog = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> *item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items) { [alertView addButtonWithTitle:item.title]; } [alertView addButtonWithTitle:<span class="hljs-built_in"><span class="hljs-built_in">NSLocalizedString</span></span>(<span class="hljs-string"><span class="hljs-string">@"close"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)]; alertView.cancelButtonIndex = alertView.numberOfButtons - <span class="hljs-number"><span class="hljs-number">1</span></span>; [alertView show]; }</code> </pre><br></div></div><br>  and the final touch is the handling of button actions, which happens in the corresponding delegate method: <br><br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)actionSheet:(<span class="hljs-built_in"><span class="hljs-built_in">UIActionSheetDialog</span></span> *)actionSheet clickedButtonAtIndex:(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)buttonIndex { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttonIndex == actionSheet.numberOfButtons - <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> *item = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items[buttonIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.handler) { item.handler(buttonIndex); } }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">UIAlertViewDelegate</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)alertView:(<span class="hljs-built_in"><span class="hljs-built_in">UIAlertViewDialog</span></span> *)alertView clickedButtonAtIndex:(<span class="hljs-built_in"><span class="hljs-built_in">NSInteger</span></span>)buttonIndex { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttonIndex == alertView.numberOfButtons - <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">UIAlertDialogItem</span></span> *item = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.items[buttonIndex]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.handler) { item.handler(buttonIndex); } }</code> </pre><br></div></div><br>  <b>Conclusion</b> <br><br>  The result is a simple and compact solution that will significantly reduce the time to work with dialog boxes ( <a href="https://github.com/devnseven/uialertdialog">source code</a> ). <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/242801/">https://habr.com/ru/post/242801/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../242789/index.html">Financial data transfer methods: FIX protocol</a></li>
<li><a href="../242791/index.html">How Internet advertising works: Traffic arbitration</a></li>
<li><a href="../242795/index.html">As in Yandex use PyTest and other frameworks for functional testing.</a></li>
<li><a href="../242797/index.html">Publisher List for Mobile Game Developer</a></li>
<li><a href="../242799/index.html">Reissue certificate with SHA-2 - if Webnames does not go to Mahomet ...</a></li>
<li><a href="../242803/index.html">Protection of automated process control systems in Russia: we investigate new requirements of FSTEC</a></li>
<li><a href="../242807/index.html">Development of the program in Multimedia Builder on the example of a utility for remote work with cash register software</a></li>
<li><a href="../242811/index.html">Creating a Wi-Fi teapot "for dummies": how we have not broken Kickstarter (for now)</a></li>
<li><a href="../242813/index.html">Once again about education in school</a></li>
<li><a href="../242815/index.html">#MBLTDev 2014 through the eyes of a simple iOS developer from Tinkoff Bank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>