<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Openfire + Miranda NG. One-click remote help and a couple of features.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a remake of a few old notes on how to simplify regular user support tasks using Miranda. In the article you will not find the 1001st h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Openfire + Miranda NG. One-click remote help and a couple of features.</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/e9d/352/227/e9d35222782f472aaf0748bf7ef8eeb4.jpg"></div><br><br>  This article is a remake of a few old notes on how to simplify regular user support tasks using Miranda.  In the article you will not find the 1001st how to install Openfire on linux with pass-through authentication, but it will be described what it does: <br><br><pre><code class="bash hljs">?replace(?dbsetting(%subject%,?cinfo(%subject%,protocol),MirVer),Miranda NG Jabber 0.95.5.17337 x86 [,,],)</code> </pre> <br>  And how, using this garbage, get remote access to the user desktop, for example, using the same VNC or radmin, simply by clicking on the desired icon directly in the conversation window with the user. <br><a name="habracut"></a><br>  Baseline: <b>Debian 7, Openfire 4.1.3, Miranda NG 0.95.5.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The goal in the example will be the automatic launch of Remote Assistance (msra) with the connection to the desired user directly from the Miranda interface.  At once I will make a reservation that if necessary you will have to enter all the credentials for access additionally, i.e.  these tricks have no effect on safety. <br><br>  So, Openfire is already <a href="https://habrahabr.ru/post/181374/">configured</a> on debian, and Miranda NG is out of the box with a ‚Äúdomain login‚Äù and without registry tweaks clinging to the server without entering credentials.  It is also indicated to use the name of the computer as a resource.  We are required to take stock Miranda and finish in it a kind of "admin" functionality.  For simplicity, I will call assemblies: admin and user.  I draw your attention to the fact that any other will suit as a user.  The main thing is that somewhere in the MirVer field there is a ‚Äúresource‚Äù field, and the computer name is the resource, but more on that below.  Remote Assistance should already work.  I repeat, Miranda in our case is just a convenient interface-add-in. <br><br><div class="spoiler">  <b class="spoiler_title">It looks something like this:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ee3/d97/7c9/ee3d977c930d482d9a7ee278ac2be127.png"><br></div></div><br>  First of all, download the current (at the time of writing 0.95.5) <a href="http://www.miranda-ng.org/ru/downloads/">Miranda NG stable</a> , as well as the <a href="http://wiki.miranda-ng.org/index.php%3Ftitle%3DDownloads">necessary plugins</a> : Actman and Variables.  This is the minimum required, but in my build I will show a few others, with whom life becomes more fun.  We put the plugins in the Plugins folder, restart Miranda, and now point by point. <br><br>  1) The main window for working with custom actions inside Miranda is - <b>Settings ‚Üí Services ‚Üí Actions ‚Üí Actions</b> .  With the top green plus we create a new script (F2 for renaming), and with the bottom we add the Action ‚ÄúRun‚Äù to it (select in the upper right). <br><br><div class="spoiler">  <b class="spoiler_title">Actions Window</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a77/e0e/cb1/a77e0ecb1f6a439cb71d1e9dc3c8d26c.png"><br></div></div><br>  2) To run Remote Assistance, you must run <b>msra / offerra computer_name</b> .  Actually "Run" contains 2 fields - the path and arguments.  The first is the standard way. <br><br><pre> <code class="bash hljs">%SystemRoot%\system32\msra.exe</code> </pre> <br>  and in the second, you need to specify that we immediately want to connect to the specified station, passing as the last argument the parked name of the <b>camp</b> from the <b>MirVer</b> field of a specific user.  In the current Miranda NG, "MirVer" takes on meaning. <br><br><pre> <code class="bash hljs">Miranda NG Jabber 0.95.5.17337 x86 []</code> </pre> <br>  And we agreed that the name of the computer acts as a resource.  Hereinafter, the resource will be WS01 as an example.  Note that the second field must be marked as a script (button S, see screen above), otherwise the magic of variables will not work. <br><br>  3) You can get to the Help ‚ÄúVariable Assistance‚Äù either from Settings - <b>Services ‚Üí Variables ‚Üí blue V button</b> , or the same V icon by pressing the S / T buttons directly from the Actions dialog. <br><br>  In the contact properties, the MirVer value looks like <b>Miranda NG Jabber 0.95.5.17337 x86 [WS01]</b> .  The <b>point is</b> to find the entries " <b>Miranda NG Jabber 0.95.5.17337 x86 [</b> " and " <b>]</b> ", replace them with an empty string and get only WS01 on the output.  The code for the command line parameter and name lookup is: <br><br><pre> <code class="hljs mel">/offerra ?replace(?dbsetting(%subject%,?cinfo(%subject%,protocol),MirVer),Miranda NG Jabber <span class="hljs-number"><span class="hljs-number">0.95</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.17337</span></span> x86 [,,],)</code> </pre> <br>  Note that by pressing the S | T buttons, you will be taken to the ‚Äútext editor‚Äù, in which line breaks are allowed, and the result will still be written in one line.  Just do not forget about the spaces where necessary and where not needed. <br><br><div class="spoiler">  <b class="spoiler_title">Text editor</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/734/db8/2e4/734db82e46134b619dde3b87f4a1ab38.png"><br></div></div><br>  <b>? replace (x, y, z, ...)</b> is the replacement of all occurrences of Y in X by Z, multiple arguments Y and Z are possible. <br><br>  It's all clear.  We are looking for in MirVer a couple of the necessary above entries and change to ‚Äúempty‚Äù.  But how to get MirVer the right contact?  Help us: <br><br>  <b>? dbsettings (x, y, z, w)</b> - get the setting Z of the plug-in Y of contact X or return W if z does not exist (w is not necessary). <br><br>  Yeah, already better, but not clearer.  This is where the special <b>subject% subject%</b> comes to the rescue, a description of which you will find on the second tab of the Help for Variables window.  So, choosing a contact, the% subject% token takes the value of this contact.  Conventionally, we communicate with the user, and in% of the subject% is information about this particular contact.  Where to get <b>X</b> for? Dbsettings () figured out. <br><br>  Now you need to know the values ‚Äã‚Äãof the jabber plug-in for <b>Y</b> (after all, we are talking about jabber) from the selected contact: <br><br>  <b>? cinfo (x, y)</b> is the information property Y of contact X. Once again, we take the% subject% and look for the <abbr title="where I got to search for exactly the property of the protocol will find out closer to the end of the article">protocol</abbr> property, which will contain information about the currently used protocol, in the property values ‚Äã‚Äãof which you can find the required MirVer field.  Got <b>Y.</b> <br><br>  Well, the value <b>Z</b> indicates that we want to see just MirVer.  W is not needed. <br>  Everything, got the value of <b>Miranda NG Jabber 0.95.5.17337 x86 [WS01]</b> , naturally the name of the camp within each square bracket <abbr title="not at all necessary if miranda is running in a terminal">will be</abbr> different for each contact. <br><br>  And then we replace the found waste with? Replace the ‚ÄúMiranda NG Jabber 0.95.5.17337 x86 [by ' <i>empty</i> ' and '] change the' <i>empty</i> 'to, i.e.  remove excess.  The output is a clean <b>WS01</b> , which will be substituted in <b>msra / offerra WS01</b> . <br><br>  4) The penultimate step is to go to <b>Settings ‚Üí Services ‚Üí Actions ‚Üí Use actions</b> and mark where we want to see the remote assistant button.  In my case, this is the button bar in the message window when directly communicating with the user and right click on the contact in the roster. <br><br><div class="spoiler">  <b class="spoiler_title">Use of action</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/8fa/2c3/bb6/8fa2c3bb64564826833fd014ff92723e.png"><br></div></div><br>  5) It remains to fasten the beautiful, because in a bunch of custom buttons to find the remote assistant will be easier if he has his usual badge.  <b>Settings ‚Üí Icons ‚Üí Actions ‚Üí Registered actions ‚Üí Import icons</b> .  Specify the file containing the desired icon, and simply drag it to the desired action.  It is really convenient. <br><div class="spoiler">  <b class="spoiler_title">Own icon for action</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/2b1/5e0/d5a/2b15e0d5ac154a4395a27bcb75d03a1d.png"><br></div></div><br>  <b>UPD from: <a href="https://habr.com/users/magicex/" class="user_link">MagicEx</a> and <a href="https://habr.com/users/abyss777/" class="user_link">Abyss777</a> Allows you to work with any MirVer, provided that the resource is in square brackets</b> <br><div class="spoiler">  <b class="spoiler_title">long from @MagicEx</b> <div class="spoiler_text"><pre>  strchr (! dbsetting (% subject%,? cinfo (% subject%, protocol), jid), @), 1))? substr (! dbsetting (% subject%,? cinfo (% subject%, protocol), MirVer) ,? add (? strchr (! dbsetting (% subject%,? cinfo (% subject%, protocol), MirVer), [), 1),? sub (? strchr (! dbsetting (% subject%,? cinfo (% subject%, protocol), MirVer),]), 1)) </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">short on regexp by @ Abyss777</b> <div class="spoiler_text"><pre> <code class="bash hljs">?regexp_substr( \[(.*)\],!dbsetting(%subject%,!cinfo(%subject%,protocol),MirVer),1)</code> </pre> </div></div><br><br>  With this remote assistant everything is, check how it works.  You can practice with a couple of other utilities: <br><br>  <b>Remote Desktop</b> <br><br><pre> <code class="hljs mel">%SystemRoot%\system32\mstsc.exe /v:?replace(?dbsetting(%subject%,?cinfo(%subject%,protocol),MirVer),Miranda NG Jabber <span class="hljs-number"><span class="hljs-number">0.95</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.17337</span></span> x86 [,,],)</code> </pre> <br>  <b>Snap-in computer management</b> <br><br><pre> <code class="hljs mel">mmc.exe compmgmt.msc /computer=?replace(?dbsetting(%subject%,?cinfo(%subject%,protocol),MirVer),Miranda NG Jabber <span class="hljs-number"><span class="hljs-number">0.95</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.17337</span></span> x86 [,,],)</code> </pre> <br>  <b>UltraVNC</b> <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Program</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Files</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">x86</span></span>)\<span class="hljs-selector-tag"><span class="hljs-selector-tag">uvnc</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bvba</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">UltraVnc</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">vncviewer</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span> ?<span class="hljs-selector-tag"><span class="hljs-selector-tag">replace</span></span>(!<span class="hljs-selector-tag"><span class="hljs-selector-tag">dbsetting</span></span>(%<span class="hljs-selector-tag"><span class="hljs-selector-tag">subject</span></span>%,?<span class="hljs-selector-tag"><span class="hljs-selector-tag">cinfo</span></span>(%<span class="hljs-selector-tag"><span class="hljs-selector-tag">subject</span></span>%,<span class="hljs-selector-tag"><span class="hljs-selector-tag">protocol</span></span>),<span class="hljs-selector-tag"><span class="hljs-selector-tag">MirVer</span></span>),<span class="hljs-selector-tag"><span class="hljs-selector-tag">Miranda</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">NG</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Jabber</span></span> 0<span class="hljs-selector-class"><span class="hljs-selector-class">.95</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.17337</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x86</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[,,]</span></span>,)</code> </pre> <br>  Do not forget that third-party software like UltraVNC must be installed in the system. <br><br><hr><br>  Everything seems to be cool.  But what if the client is sitting on a different subnet, and indeed has its own DNS suffix?  The question of accessing the required subnet will be left at the mercy of the gateway, but the suffix is ‚Äã‚Äãharder, because there is nothing in the name of the resource about DNS, and it will not be possible to reach the user in another city using the name, the whole FQDN is needed.  Fortunately, Miranda with Actman and Variables plugins is so cool that there is a solution.  Now in a few words I will tell you how, and for convenience of perception I formatted the code: <br><br><pre> <code class="hljs mel">?puts(comp,?replace(?dbsetting(%subject%,?cinfo(%subject%,protocol),MirVer),Miranda NG Jabber <span class="hljs-number"><span class="hljs-number">0.95</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">.17337</span></span> x86 [,,],)) ?<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(?stricmp(?dbsetting(%subject%,CList,Group),), ?puts(grp,.jup.com), ?<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(?stricmp(?dbsetting(%subject%,CList,Group),), ?puts(grp,.mars.com), ?<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(?stricmp(?dbsetting(%subject%,CList,Group),), ?puts(grp,.venus.com), ?puts(grp,.earth.com) ) ) ) ?insert(?get(comp),?get(grp),?len(?get(comp)))</code> </pre> <br>  The general meaning here is that depending on the group of the roster in which the user is located, add the appropriate DNS suffix.  The example uses three groups: Jupiter (.jup.com), Mars (.mars.com), Venus (.venus.com), and Earth (.earth.com), if the user does not belong to any of the specified groups . <br><br>  1) The first line is used to search for the computer name, we passed this with only one difference, what now with the help <b>? Puts ()</b> write the computer name in the comp variable <br><br><div class="spoiler">  <b class="spoiler_title">? puts (x, y)</b> <div class="spoiler_text">  ? puts (x, y) - saves Y as a variable with the name X <br></div></div><br><pre> <code class="hljs dos">?puts(<span class="hljs-built_in"><span class="hljs-built_in">comp</span></span>,?<span class="hljs-built_in"><span class="hljs-built_in">replace</span></span>(?dbsetting(<span class="hljs-variable"><span class="hljs-variable">%subject%</span></span>,?cinfo(<span class="hljs-variable"><span class="hljs-variable">%subject%</span></span>,protocol),MirVer),Miranda NG Jabber <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">95</span></span>.<span class="hljs-number"><span class="hljs-number">5</span></span>.<span class="hljs-number"><span class="hljs-number">17337</span></span> x86 [,,],))</code> </pre> <br>  2) using nested operators <b>? If ()</b> looking for matching groups, suddenly the user in one of them <br><br><div class="spoiler">  <b class="spoiler_title">? if (x, y, z)</b> <div class="spoiler_text">  ? if (x, y, z) - shows Y, if X is TRUE, otherwise shows Z <br></div></div>  . <br>  Through <b>? Stricmp () we</b> check if our friend is from Jupiter and, if so, with the help of a friend? Puts () we assign the <b>value ".jup.com" to the</b> variable " <b>grp</b> " <br><br><div class="spoiler">  <b class="spoiler_title">? stricmp (x, y)</b> <div class="spoiler_text">  ? stricmp (x, y) - true if X = Y, case insensitive <br></div></div><br><pre> <code class="bash hljs">?stricmp(?dbsetting(%subject%,CList,Group),),?puts(grp,.jup.com)</code> </pre> <br>  If not from Jupiter, then the next comparison block is executed and, by analogy, another one.  As a result, if the user is <b>not found</b> on the three target planets, then by default we assume that he is from Earth and assign the variable grp to the value <b>.earth.com</b> . <br><br>  3) The final statement <b>? Insert ()</b> through <b>? Get ()</b> `s glues the computer name with the domain name, in the end we get the desired FQDN <br><br><div class="spoiler">  <b class="spoiler_title">? insert (x, y, z)? get (x)</b> <div class="spoiler_text">  ? insert (x, y, z) - inserts the string Y at the position Z in the row X <br>  ? get (x) is the variable defined by put named X <br></div></div><br><pre> <code class="bash hljs">?insert(?get(comp),?get(grp),?len(?get(comp)))</code> </pre> <br>  ? insert () is a hack for outputting the resulting value, since no echo and others are provided. <br><br>  Naturally, the number of nested statements may be different, depending on your need. <br><br>  As you can see, with the help of <b>Variables</b> and <b>Actions</b> in Miranda, you can do all sorts of cool things, and the functionality is not limited to the execution of applications with arguments.  The rest of the features if desired, you consider yourself.  It is easiest to <a href="http://wiki.miranda-ng.org/index.php%3Ftitle%3DPlugin:DbEditorPP/en">find the</a> necessary protocol values ‚Äã‚Äãand other things through the <a href="http://wiki.miranda-ng.org/index.php%3Ftitle%3DPlugin:DbEditorPP/en">DbEditorPP</a> database editor <a href="http://wiki.miranda-ng.org/index.php%3Ftitle%3DPlugin:DbEditorPP/en">plugin</a> .  Actually through this plugin, I opened the necessary property for? Cinfo (x, y), and indeed this tool will still be useful more than once. <br><br><hr><br>  I spread the finished <a href="http://devyatka.ru/filemanager/download/67448">user assembly</a> with my own settings and additional plug-ins, with which working in Miranda becomes more convenient.  I draw your attention to the fact that only plugins, emoticons and a couple of little things are added to the stock Miranda NG, the rest is tweaked through Settings.  The emphasis was on minimal changes of pure Miranda.  The user assembly is zakastomizirovana stronger, because  it is required to enable or disable a bunch of everything that the user will not do later, and the competent employee in the admin assembly will figure it out himself. <br><br>  <b>UPD:</b> <a href="http://devyatka.ru/filemanager/download/67465">Admin assembly</a> upon request in the comments.  Differences from user: <br>  1) Three plugins added: ActMan, Variables, DbEditorPP <br>  2) Remote Assistance Added <br>  3) Renamed profile directory and launcher removed <br><br>  I deliberately do not give a link to the admin assembly, because  I have it greatly changed from the original and it will be a chore to clean everything.  It will be correct to add a couple of plug-ins to the user version and copy a couple of lines from the examples.  But if necessary, tell me, lay out. <br><br><hr><br><h4>  At the end of the promised couple of features </h4><br>  Miranda, due to the nature of the architecture, has difficulty updating when used in a corporate environment.  PluginUpdater is engaged in updating, which simply does not have enough rights to write something to ProgramFiles, where Miranda is installed.  The option when the user has write permissions to the installation directory is not considered.  As a result, we have a scheme in which Miranda NG itself unfolds in% ProgramFiles%, and the user profile lies in the orthodox right% ApplicationData%.  As already said, the feature is that the settings, although they are in the user profile, are strongly tied to the kernel and plug-in versions, in the end, if you just roll a new build over, that is, a non-illusionary chance that everything will break.  Option two: do not update anything at all or update, but recreate the user profile Miranda.  Both options are bad.  In one case, security suffers; in the second, the user loses history, which also fails.  And if everything is clear with the first one, I‚Äôll dwell on the update in detail. <br><br>  I refused the regular installer of Miranda, which is Inno Setup, in favor of a custom script to copy my own build.  I will explain why.  All mandatory software is deployed using WSUS via <a href="https://habrahabr.ru/post/150518/">LUP</a> ( <a href="https://habrahabr.ru/post/307032/">WPP</a> ), but in the case of Miranda, sometimes, especially at the testing stage, it is necessary to update the test group of users frequently, and the profile with the settings will in any case remain old, i.e.  You need to finish it also.  In short, I decided to do it easier.  The deployment script looks at the version of Miranda on the server, and if it is larger than the one installed on the system, then stupidly bangs it and writes a new one.  Ini-file with the version is here MirandaNGCorpMod \ Profiles \ jabber \ profile_settings.ini.  Next, the custom launcher, with which Miranda is launched, looks into the installation directory and, if the version is newer than in the user profile, the profile bangs and launches Miranda.  Miranda herself using the setting-cln.ini, with the missing profile, creates a new one with the necessary settings.  In general, all settings that are different from the default are rendered to settings.ini, and in Mirandaboot.ini this is stated.  Next, the launcher waits another couple of seconds and writes a new version to the profile directory (just in case, the plus is 12 attempts in increments of 5 seconds). <br><br>  The deployment script should be <i>located next</i> to the Miranda directory, the launcher should be <i>in the directory</i> next to miranda32.exe <br><br><div class="spoiler">  <b class="spoiler_title">The script copy user assembly at AutoIT:</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">NoTrayIcon</span></span> ;<span class="hljs-attribute"><span class="hljs-attribute">read</span></span> current miranda version in ProgramFiles. If <span class="hljs-literal"><span class="hljs-literal">error</span></span> - <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-variable"><span class="hljs-variable">$MirCurVer</span></span> = IniRead(<span class="hljs-variable"><span class="hljs-variable">@ProgramFilesDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\Profiles\jabber\profile_settings.ini'</span></span>,<span class="hljs-string"><span class="hljs-string">'MirandaNGCorpMod'</span></span>,<span class="hljs-string"><span class="hljs-string">'version'</span></span>,<span class="hljs-string"><span class="hljs-string">'0000'</span></span>) ;<span class="hljs-attribute"><span class="hljs-attribute">read</span></span> new miranda version in ScriptDir. If <span class="hljs-literal"><span class="hljs-literal">error</span></span> - <span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-variable"><span class="hljs-variable">$MirNewVer</span></span> = IniRead(<span class="hljs-variable"><span class="hljs-variable">@ScriptDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\Profiles\jabber\profile_settings.ini'</span></span>,<span class="hljs-string"><span class="hljs-string">'MirandaNGCorpMod'</span></span>,<span class="hljs-string"><span class="hljs-string">'version'</span></span>,<span class="hljs-string"><span class="hljs-string">'0001'</span></span>) If <span class="hljs-variable"><span class="hljs-variable">$MirNewVer</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$MirCurVer</span></span> Then DirRemove(<span class="hljs-variable"><span class="hljs-variable">@ProgramFilesDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>) DirCopy(<span class="hljs-variable"><span class="hljs-variable">@ScriptDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod'</span></span>,<span class="hljs-variable"><span class="hljs-variable">@ProgramFilesDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod'</span></span>) FileCreateShortcut(<span class="hljs-variable"><span class="hljs-variable">@ProgramFilesDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\miranda_launch.exe'</span></span>,<span class="hljs-variable"><span class="hljs-variable">@DesktopCommonDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod.lnk'</span></span>) FileCreateShortcut(<span class="hljs-variable"><span class="hljs-variable">@ProgramFilesDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\miranda_launch.exe'</span></span>,<span class="hljs-variable"><span class="hljs-variable">@StartupCommonDir</span></span> &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod.lnk'</span></span>) EndIf</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Launcher code:</b> <div class="spoiler_text"><pre> <code class="hljs mel">#NoTrayIcon $sMirandaOptions = <span class="hljs-string"><span class="hljs-string">''</span></span> ;check <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> command line options <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Miranda32.exe If $cmdline[<span class="hljs-number"><span class="hljs-number">0</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> Then For $i = <span class="hljs-number"><span class="hljs-number">1</span></span> To $cmdline[<span class="hljs-number"><span class="hljs-number">0</span></span>] Step <span class="hljs-number"><span class="hljs-number">1</span></span> $sMirandaOptions = $sMirandaOptions &amp; <span class="hljs-string"><span class="hljs-string">' '</span></span> &amp; $cmdline[$i] Next EndIf ;read current miranda version. If <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> - <span class="hljs-number"><span class="hljs-number">0000</span></span> $MirCurVer = IniRead(@AppDataDir &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\jabber\profile_settings.ini'</span></span>,<span class="hljs-string"><span class="hljs-string">'MirandaNGCorpMod'</span></span>,<span class="hljs-string"><span class="hljs-string">'version'</span></span>,<span class="hljs-string"><span class="hljs-string">'0000'</span></span>) ;read new miranda version. If <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> - <span class="hljs-number"><span class="hljs-number">0001</span></span> $MirNewVer = IniRead(@ProgramFilesDir &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\Profiles\jabber\profile_settings.ini'</span></span>,<span class="hljs-string"><span class="hljs-string">'MirandaNGCorpMod'</span></span>,<span class="hljs-string"><span class="hljs-string">'version'</span></span>,<span class="hljs-string"><span class="hljs-string">'0001'</span></span>) ;<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> version <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> AppData less than ProgramFiles version, remove MirandaNG profile If $MirNewVer &gt; $MirCurVer Then DirRemove(@AppDataDir &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>) EndIf ;run miranda with command line parameters Run(@ScriptDir &amp; <span class="hljs-string"><span class="hljs-string">'\miranda32.exe '</span></span> &amp; $sMirandaOptions) Sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>) ;whaiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> miranda creates <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> profile <span class="hljs-string"><span class="hljs-string">"jabber.dat"</span></span>. <span class="hljs-number"><span class="hljs-number">12</span></span> retries, <span class="hljs-number"><span class="hljs-number">5</span></span> seconds per step For $i = <span class="hljs-number"><span class="hljs-number">1</span></span> To <span class="hljs-number"><span class="hljs-number">12</span></span> Step <span class="hljs-number"><span class="hljs-number">1</span></span> If FileExists(@AppDataDir &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\jabber\jabber.dat'</span></span>) Then ;copy current <span class="hljs-string"><span class="hljs-string">"profile_settings.ini"</span></span> to new profile FileCopy(@ProgramFilesDir &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\Profiles\jabber\profile_settings.ini'</span></span>,@AppDataDir &amp; <span class="hljs-string"><span class="hljs-string">'\MirandaNGCorpMod\jabber\profile_settings.ini'</span></span>) Exit EndIf Sleep(<span class="hljs-number"><span class="hljs-number">5000</span></span>) Next</code> </pre><br></div></div><br>  If you need the collected versions, tell me, lay out. <br><br>  In assemblies, you need to enable auto-connection at start <b>Settings ‚Üí Status ‚Üí Initial Status ‚Üí Status Profiles ‚Üí</b> in the <b>Status</b> window, select ‚ÄúOnline‚Äù and change the <b>LoginServer</b> parameter to your jabber server.  This can be done through Miranda settings or by editing the setting-cln.ini file.  Well, before the heap, you can change or remove the splash screen at the start altogether. <br><br><hr><br>  On this Miranda, it seems, that‚Äôs all, but I can‚Äôt help but turn on the hint how to <b>fasten users' photos from ActiveDitectoty</b> : <br><br><div class="spoiler">  <b class="spoiler_title">all matches are random</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a9c/8a7/14c/a9c8a714c4554741b7648cbc8d4fd3a8.png"><br></div></div><br>  I will make a reservation, the version of the scheme is not lower than Win2008R2. <br><br>  1) Include a replica in the GC for the attribute thumbnailPhoto (optional, but worth it) <br>  <a href="http://windowsitpro.com/active-directory/q-how-can-i-add-pictures-my-users-active-directory-ad">windowsitpro.com/active-directory/q-how-can-i-add-pictures-my-users-active-directory-ad</a> <br>  It is possible to add via the same link via PS, but it is inconvenient, drive on PS, we go further: <br><br>  2) Download and install software for uploading photos in AD <a href="https://www.codetwo.com/freeware/active-directory-photos/">www.codetwo.com/freeware/active-doryoryphotos</a> Free, you can install anywhere, but run with domain admin rights. <br><br>  3) In the OpenFire console, twist the parameters: <br>  <b>ldap.override.avatar</b> <i>true</i> <br><br>  and edit the parameter in vCard to be like this: <br><br><pre> <code class="bash hljs">&lt;PHOTO&gt; &lt;TYPE&gt;image/jpeg&lt;/TYPE&gt; &lt;BINVAL&gt;{thumbnailPhoto}&lt;/BINVAL&gt; &lt;/PHOTO&gt;</code> </pre><br>  4) Restarting OpenFire and MirandaNG sees avatars out of the box, but the user should at least once connect to jabber. <br><br>  Well, now for sure.  I hope the article will be useful, and welcome to the comments. </div><p>Source: <a href="https://habr.com/ru/post/325860/">https://habr.com/ru/post/325860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325848/index.html">Development and testing of chef dolls with Sparrowdo v2 tool</a></li>
<li><a href="../325850/index.html">Examples of real patches in PostgreSQL: part 3 of N</a></li>
<li><a href="../325852/index.html">Enough design in the sketch. Do design in the browser</a></li>
<li><a href="../325856/index.html">Facebook API: fixing a broken Like button on a site</a></li>
<li><a href="../325858/index.html">The world of payment mediation: a workshop in magic</a></li>
<li><a href="../325862/index.html">Wall Street Server: VPS for Traders</a></li>
<li><a href="../325864/index.html">What "kills" the seller</a></li>
<li><a href="../325866/index.html">101 free services for the designer</a></li>
<li><a href="../325868/index.html">Starting your blog on Ghost using docker-compose</a></li>
<li><a href="../325872/index.html">ASP.NET Core: Creating ASP.NET Web API Reference Pages with Swagger</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>