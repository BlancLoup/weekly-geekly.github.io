<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a cross-platform Half-Life or "Headcrabs inside your watch"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of months ago, on Hiktaimes , the news of the running Half-Life on Android Wear slipped . The article did not say a word about the developers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a cross-platform Half-Life or "Headcrabs inside your watch"</h1><div class="post__text post__text-html js-mediator-article"><img width="854" height="480" src="https://habrastorage.org/files/1d9/710/2c4/1d97102c456e4d239f12e90aa559e7aa.jpg"><br><br>  A couple of months ago, on Hiktaimes <a href="http://geektimes.ru/post/259364/">, the news</a> of the running Half-Life on Android Wear <a href="http://geektimes.ru/post/259364/">slipped</a> .  The article did not say a word about the developers, and then one of the habrovs asked in the comments why none of them would write here? <br><br>  And now the anniversary since I started the port of the free Xash3D engine on Linux, and also, since several of my friends were still interested in the details, I decided to write this post.  Who is interested in the history of the project, workarounds for various problems and my personal advice, please under the cat. <br><a name="habracut"></a><br>  I'll start with the history of the project.  The engine was originally written by a programmer with the nickname Uncle Misha or g-cont.  It is to him that we owe what we have now.  Only in 2011, he laid out the source of the engine under the GPLv3.  But he had a fatal flaw, Uncle Misha did not want to port the engine to something other than Windows.  For Android port, he wanted a certain amount, and, of course, the idea failed because of our community. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I personally began to follow the engine from 2012, a year after the source was opened, but only in the fall of 2014, with a little C ++ programming experience, I downloaded the source code of the engine.  Burning with the thought that the free game engine and cross-platform are concepts closely connected with Karmakov times, I began to port it to Linux. <br><br>  At first, the port was planned using winelib, but over time, having penetrated into the architecture of the engine, I settled on SDL2, as the ubiquitous multimedia library itself.  Yes, and Valve for its ports used it. <br><br>  And right away my first advice to those who want to port any application unknown to him to any OS: <br><br>  <b>1) Create project files immediately and, without making a single change in the project, compile it.</b> <br><br>  Yes, your IDE may even freeze from my advice, since the compiler will generate more than one thousand errors and warnings.  My compiler gave about 4000 errors. <br><br>  Moving from one mistake to another, I gradually got rid of them.  There was no screw code left, -Wl, - no-undefined saves a lot when porting. <br><br>  And it happened - the engine was loaded.  Shows its own console, and outside the window, in the meantime, it was already about the beginning of December last year.  I must emphasize that before me, attempts were made and approximately on the console and ended, if not earlier.  All December I went to download libraries in runtime, SDL input, sound - and here I post a screenshot on Linux.org.ru. <br><br><div class="spoiler">  <b class="spoiler_title">December screenshots</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d8a/202/f54/d8a202f545894461bb2403aa711a5df9.jpg"><br><br>  What I threw off once <a href="http://habrahabr.ru/users/exl/" class="user_link">EXL</a> . <br><br><img src="https://habrastorage.org/files/8c1/132/3e1/8c11323e151c47e7bb18fca30ce8dcf0.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">The first public screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/84f/52f/524/84f52f5248834c1b88d671236b2cbc55.png"><br></div></div><br>  Several people are interested in the work done.  I look back at the sources and I understand that it is impossible to work with this: in many places the code is unreadable due to macros, strange bugs appear, building outside of my localhost is very complicated.  And the engine version is very old.  In the comments to the thread indicate that the new versions are distributed in some other forum.  As a result, I start everything from scratch, and my friend helps to bring everything into a serious look - translates the assembly to CMake, drives me with bad-smelling rags for too large commits and govnokod.  Also on GitHub an organization SDLash3D is created, named after the old port.  At the time of this writing, there are already five people in it, but only two are active. <br><br>  Suddenly, number 2, which I have learned for myself at this time: <br><br>  <b>2) Make a header file containing only macros that will insert the necessary code for the target platform.</b> <br><br>  Also here is a tip for those who, while reading this article, write code in their studio. <br><br>  <b>3) At the expense of any suspicious and strange code, please contact Google.</b>  <b>He will tell you that your code is compiled only under Visual Studio, which has many non-standard extensions.</b>  <b>And less tied to WinAPI.</b> <br><br>  Meanwhile, nicknekit / Unc0nnected silently starts porting the old port to Android. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshots and videos courtesy of Nikita</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b49/2e0/226/b492e0226b17465aaaa3191547ec2dac.jpg"><br><br><img src="https://habrastorage.org/files/1e5/6ab/3d2/1e56ab3d27fd4ceea4935946847f1a30.jpg"><br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Z-hVh95kF_w%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJ8noyZR-Exo1av682wkv_X-7Dsg" frameborder="0" allowfullscreen=""></iframe><br></div></div><br>  From February Nikita and I begin to work together on the port.  He is busy with the old port, and I finish the new one and transfer the functionality associated with Android into it. <br><br>  At this point, the basic operation of the port on Android is established.  Now it looks like this: <br><br><img src="https://habrastorage.org/files/7d5/b1b/598/7d5b1b5988674db9a7d9d75da1b9f11f.png"><br><br>  In March, we create a thread at w3bsit3-dns.com, which we report on the progress of the transfer, new videos and screenshots.  The first of April is version 0.1, but April 1 cannot be without a joke, so a special condition has been made in the engine, under which it closes, if pakandroid.pak is not found, in which a very fun and sufficiently high-quality G-Man mode was ‚Äúsewn up‚Äù Invasion. <br><br>  Since then, among the significant events for the port were: <br><br><ul><li>  Support touch control, made in conjunction with Beloko Games; </li><li>  Release of version 0.14, which really brought success.  About 20 thousand visitors in two days, judging by the statistics on GitHub; </li><li>  Interface Android version for modifications made by our <a href="http://habrahabr.ru/users/mittorn/" class="user_link">mittorn</a> .  Modders can independently release their game also on Android. </li></ul><br>  On this you can and finish, below the bonus in the form of individual commits and links to us on GitHub and ModDB. <br><br>  <b>Bonus number 1.</b>  Several commits related to a different understanding of code in Visual Studio and GCC.  After fixing all of them, I‚Äôm sure that C support in the studio is the worst thing that happened in the field of programming: <br><br><ul><li>  <a href="https://github.com/SDLash3D/xash3d/commit/4ae18413bfaabb5c9df979af0eededca8538c124">A bug</a> in which sound files of words were recorded one element of the array forward.  Under MSVC does not manifest itself, in GCC manifests itself; </li><li>  <a href="https://github.com/SDLash3D/xash3d/commit/1bb3884d771c16e2f6b13eb5644af63d8b24e537">A bug</a> in which GCC swore to go beyond the array.  Under MSVC also does not appear; </li><li> <a href="https://github.com/SDLash3D/xash3d/commit/8d8ccf455a2ef06da16e273229faf025db5368cf">Studio manages to mess with C ++</a> ; </li><li>  <a href="https://github.com/SDLash3D/xash3d/commit/ee5b9241832950cc4ae23706818f4a07e1cba8ca">Another bug</a> .  And this is in C, in which exactly the same names are prohibited.  Estimate, in the studio it is compiled! </li><li>  <a href="https://github.com/SDLash3D/xash3d/commit/19b6acaf0256f4bb39c1035e0f558489d0e640cf">Bug fix, which stopped the fans in the game</a> .  Not quite sure who is to blame, but we have been looking for this bug for six months. </li></ul><br>  <b>Bonus number 2.</b>  Also some commits related to ARM, Android and OpenGL ES: <br><br><ul><li>  <a href="https://github.com/SDLash3D/xash3d/commit/b5be490c86d1343e76c72311e3b65aa3ece67b3d">Bug</a> , with strange multiplication and dividing by 1.0 by ARM; </li><li>  <a href="https://github.com/SDLash3D/xash3d/commit/8f2a0876542be171dd56258d62c4c16acff9019f">More problems with float</a> .  Caused random crashes with SIGBUS; </li><li>  And there are no links here.  I just suddenly discovered for myself that all char on ARM is unsigned.  That is why the NPC navigation went crazy, and the sprites didn't work in the engine.  You can either insert the -fsigned-char switch, or explicitly indicate that char should be signed for this variable; </li><li>  <a href="https://github.com/SDLash3D/xash3d/commit/ebe14451f381a37c19b4479a6b55489793b83c20">Render bug</a> .  Not really ARM problems, but OpenGL ES problem.  Still not fully fixed; </li><li>  <a href="https://github.com/SDLash3D/xash3d/commit/22cbfa79e5409e7669d36d557bd3251bfbc1d9bc">Its own implementation of dlsym () on Android</a> , and all because Android before Lollipop existed a bug with which some symbols from libraries did not resolve; </li></ul><br>  <b>References</b> : <br><br>  <a href="https://github.com/SDLash3D">Organization on github</a> . <br>  <a href="http://moddb.com/games/xash3d-android">Page on ModDB</a> . <br><br>  Thank you for your attention <i>a1batross</i> . </div><p>Source: <a href="https://habr.com/ru/post/268791/">https://habr.com/ru/post/268791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268777/index.html">DevTips: Web Developer Tips (17-32)</a></li>
<li><a href="../268781/index.html">Multithreading in Unity by means of reactive extensions</a></li>
<li><a href="../268785/index.html">Installing a white certificate on a Microsoft VDI farm</a></li>
<li><a href="../268787/index.html">Features of software and hardware firewalls</a></li>
<li><a href="../268789/index.html">HackedSim. Call from any number - fiction or reality?</a></li>
<li><a href="../268793/index.html">We return the auto-login to the Wi-Fi network of the Moscow metro in Android</a></li>
<li><a href="../268795/index.html">Introduction to arrow functions in javascript ES6</a></li>
<li><a href="../268799/index.html">Create a proxy checker worth 100 million for a couple of days</a></li>
<li><a href="../268801/index.html">WebGL Oscilloscope</a></li>
<li><a href="../268805/index.html">3CX Softphone got the BLF panel, import from Google and ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>