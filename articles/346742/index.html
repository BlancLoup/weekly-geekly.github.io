<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Grafana with DeviceHive IoT Platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Authors: Igor Trambovetsky, Developer; Nikolai Khabarov, Embedded Expert 

 The DeviceHive platform contains many different components, including the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Grafana with DeviceHive IoT Platform</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/dv/46/nk/dv46nk3gauskyjepnlwmp63sg0e.jpeg"><br><br>  <i>Authors: Igor Trambovetsky, Developer;</i>  <i>Nikolai Khabarov, Embedded Expert</i> <br><br>  The <a href="https://devicehive.com/">DeviceHive</a> platform contains many different components, including the <a href="https://grafana.com/">Grafana</a> plugin.  It can collect data from the DeviceHive server and display it using various information panels using the popular tool Grafana.  In this article I will explain how to create a Grafana Dashboard with DeviceHive, and as an example I use the analog input of an ESP8266 chip to visualize the voltage on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/nt/xv/zy/ntxvzyvi1cqeazbzccq89qddwte.jpeg"><a name="habracut"></a><br><br><h3>  Data </h3><br>  From the point of view of the DeviceHive server, the data that needs to be displayed can be provided through commands and notifications.  The former are usually used to transmit any messages to devices that initiate command execution.  Notifications are messages by means of which devices inform their subscribers about certain events.  Commands and notifications are simple JSON messages.  Both can be used to plot graphs, display static text, scale, table, or any other Grafana components.  In this article, we will generate notifications using a special DeviceHive firmware for the ESP8266 chip.  This firmware allows the chip to directly connect to the DeviceHive server using the appropriate protocol.  It also contains many pre-installed commands that can be run on the server side ( <a href="">https://github.com/devicehive/esp8266-firmware/blob/develop/DeviceHiveESP8266.md</a> ). <br><br><h3>  Generating Notifications with ESP8266 Firmware </h3><br>  Binary files for DeviceHive firmware are available <a href="https://github.com/devicehive/esp8266-firmware/releases">here</a> .  Download the latest version and install the firmware.  The distribution contains installation documentation, but if you have a NodeMCU board, you just need to connect it to the computer via a microUSB cable, run the esp-flasher utility from the distribution for your operating system and wait for the firmware installation to complete.  Then you need to configure your wireless network, DeviceHive server, and credentials.  This can be done in two ways: use the terminal with the esp-terminal utility or via Wi-Fi, as described <a href="https://geektimes.ru/company/dataart/blog/262110/">here</a> . <br><br>  There is a free <a href="https://playground.devicehive.com/">sandbox</a> that you can use to try out a DeviceHive server.  After connecting the board to your server or sandbox, log in to the administrative panel on the server, find the ESP8266 device in the device list and enter the command 'adc / int' with the parameters '{"0": 500}'. <br><br><img src="https://habrastorage.org/webt/-a/-m/ye/-a-mye9d-ud2vjlegkftgpilvms.jpeg"><br><br>  Thanks to this command, the ESP8266 device reports every 500 ms the input voltage # 0 of the ESP8266 ADC (this chip has only one analog input).  After switching to the notifications tab, the following data should appear: <br><br><img src="https://habrastorage.org/webt/w7/1s/tk/w71stkbdi0tgp-kccdqrqvfsqkm.jpeg"><br><br>  Values ‚Äã‚Äãin the parameters - the voltage at the output of the chip.  Such data is suitable for display using Grafana: 1) notifications contain data (in our case, notification parameters), 2) notifications are received continuously, 3) all DeviceHive notifications always have a time stamp.  Having an analog sensor connected to this pin, you can display this data using Grafana. <br><br><h3>  Installing the DeviceHive Grafana plugin </h3><br>  Grafana can be used as a local service or as a service hosted on a server.  Information on the local installation of Grafana can be found in the <a href="http://docs.grafana.org/installation/">official documentation</a> .  There is also information about <a href="http://docs.grafana.org/plugins/installation/">installing plugins</a> . <br><br>  To install the <a href="https://grafana.com/plugins/devicehive-devicehive-datasource">DeviceHive datasource data source</a> via grafana-cli, you can use the following command: <br><br>  <b>$ grafana-cli plugins install devicehive-devicehive-datasource</b> <br><br>  If you want to install the plugin manually, you must perform the following steps: <br><br>  These packages must be preinstalled: <br><br><ol><li>  Grafana&gt; = 4.6 </li><li>  NodeJs&gt; = 8 (optional) </li><li>  NPM&gt; = 5 (optional) </li><li>  Grunt (npm install grunt -g) (optional) </li></ol><br>  Also, you should have rights to copy data to the Plugins folder (you can set them in grafana.ini in Paths -&gt; plugins). <br><br>  1. Clone this repository into the Plugins folder: <br>  git clone <a href="">github.com/devicehive/devicehive-grafana-datasource.git</a> <br><br>  The following steps are optional (in case you want to change the source code): <br><br>  2.1.  Go to the folder: cd devicehive-grafana-datasource; <br>  2.2.  Install all packages: npm install; <br>  2.3.  Plugin build: npm run build; <br><br>  3. Restart the Grafana server; <br>  4. Open Grafana in a browser; <br>  5. Open the side menu by selecting the Grafana icon at the top of the window; <br>  6. Select Data Sources in the sidebar; <br>  7. Click + Add data source at the top of the window; <br>  8. Select DeviceHive from the Type drop-down list; <br>  9. Configure the data source. <br><br>  After installation, you can see the DeviceHive data source plugin in the list of installed plugins: <br><br><img src="https://habrastorage.org/webt/an/qi/ez/anqiezpehjoxzqdgtw8tuq-pwc4.jpeg"><br><br><h3>  Adding a Grafana Data Source </h3><br>  To add a DeviceHive data source: <br><br><ol><li>  Open the side menu by clicking the Grafana icon at the top of the window; </li><li>  Select Data Sources in the sidebar; </li><li>  Click + Add data source at the top of the window; </li><li>  Select DeviceHive from the Type drop-down list. </li></ol><br><br>  Take a look at the image below: <br><br><img src="https://habrastorage.org/webt/3t/ul/i9/3tuli9ztrdhtsp75pi-zrp3p62e.gif"><br><br>  To set up a DeviceHive data source, you need to fill in the following fields: <br><br><ul><li>  Server URL (the path to the DeviceHive WebSocket server. The following line is used for the sandbox: ws: //playground.devicehive.com/api/websocket); </li><li>  Device ID (unique device identifier DeviceHive); </li><li>  Login / Password or AccessToken - authentication credentials. </li></ul><br><br>  In addition, you can specify RefreshToken to automatically update AccessToken. <br><br>  The image below shows a screenshot of the configuration window: <br><br><img src="https://habrastorage.org/webt/up/nn/df/upnndfz7hhr9okus-mf5uy4mvbw.gif"><br><br>  After adding and configuring a DeviceHive data source, it should appear in the list of data sources, as shown in the screenshot: <br><br><img src="https://habrastorage.org/webt/ln/4p/k4/ln4pk4uaw6_u65vtsfl9rkse8l8.jpeg"><br><br><h3>  Creating a new panel </h3><br>  To create a new panel, you just need to click the New button on the side panel, as shown below: <br><br><img src="https://habrastorage.org/webt/s9/fn/wx/s9fnwxauywgoozjtwqfiimhjac0.jpeg"><br><br>  In this article, we show examples in the Graph panel, so you need to click the appropriate button: <br><br><img src="https://habrastorage.org/webt/ta/ib/lq/taiblqtn7l_v5tf5kvtrfch831e.jpeg"><br><br>  Then you can see the line diagram on your dashboard: <br><br><img src="https://habrastorage.org/webt/ee/al/ha/eealhavufmzk7qgjugcyqtuvc4e.jpeg"><br><br><h3>  Display notifications / commands using Grafana graphics </h3><br>  Notifications and commands are DeviceHive objects: <br><ul><li>  A command is a message sent by clients for devices; </li><li>  A notification is a message sent by devices to clients. </li></ul><br><br>  Both notifications and notifications include the parameters field in which the user can transmit his data. <br><br>  At the beginning of this article, we configured the ESP8266 device to send notifications with data on the status of the analog output of the # 0 chip.  In the image below, you can see how to configure the graphical panel of Grafana to display data on a line chart: <br><br><img src="https://habrastorage.org/webt/ky/hh/ib/kyhhibilemqdt1hd1cj81o5y40a.gif"><br><br><h3>  Display annotations on grafana graphics </h3><br>  Annotations allow you to mark points on a graph with many events.  By hovering over the annotation, you can get a description of the event (event description) and event tags (event tags).  The text box may contain links to other systems with more detailed information. <br>  More information about annotations can be found <a href="http://docs.grafana.org/reference/annotations/">here</a> . <br><br>  The figure below shows how to configure annotations based on a DeviceHive data source. <br><br><img src="https://habrastorage.org/webt/zl/ba/ko/zlbakoughmupnc1cyciwsjkdt8k.gif"><br><br><h3>  Advanced Graph Setup </h3><br>  After clicking the Add converter button ( <img src="https://habrastorage.org/webt/ji/t0/nx/jit0nx8odwnzmofcurvutdrltks.jpeg">  ) you can choose a converter. <br>  The converter is a simple function that converts the value. <br><br>  Currently, DeviceHive data sources support the following types of converters: <br><ul><li>  Scale - multiplies by the given value </li><li>  Offset - adds the specified value </li><li>  Unit Converter - converts a value into various units of the following measurement types: <br>  Temperature - Temperature (c - Celsius, f - Fahrenheit, k - Kelvin); <br>  Length - Length (m - Meter, mi - Mile, yd - Yard, ft - Foot, in - Inch); <br>  Weight - Weight (kg - Kilogram, lb - Pound, oz - Ounce); <br>  Volume - Volume (l - Liter, gal - Gallon, pt - Pinta). </li></ul><br><br><img src="https://habrastorage.org/webt/sh/9i/jb/sh9ijbk0lcode71uhejw_enujts.jpeg">  minimizes the choice of the converter. <br><br>  Clicking on the icon with the converter arrow will call up the editing panel. <br><br>  Click <img src="https://habrastorage.org/webt/jn/py/al/jnpyalo8zenabgxn35rh5vosz0i.jpeg">  to re-select converter?  or <img src="https://habrastorage.org/webt/kz/sc/d4/kzscd4mtpjcfhpkay_eh7ndnu1o.jpeg">  to remove the converter. <br><br>  An example of this function is shown below. <br><br><img src="https://habrastorage.org/webt/ws/88/wz/ws88wzvtpcz0fn2sinpsdcqqssw.gif"><br><br><h3>  Conclusion </h3><br>  Grafana is the perfect tool for data visualization.  It is very flexible and provides many different functions for visualization in the form that suits you.  Grafana can use multiple data sources from a wide range of software solutions, DeviceHive is one of them.  The example we gave in this article is very simple.  Using the same principles, you can create more complex graphics.  With Grafana and DeviceHive, you can create your own IoT visualization solutions, and, in addition, you can modify both projects as you like, since Grafana and DeviceHive are open source software products. </div><p>Source: <a href="https://habr.com/ru/post/346742/">https://habr.com/ru/post/346742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346730/index.html">New technology accelerates WAN networks up to 40 Gbps</a></li>
<li><a href="../346732/index.html">GopherCon Russia 2018: the conference will be held on March 17 in Moscow</a></li>
<li><a href="../346734/index.html">Probabilistic Seismic Hazard Analysis</a></li>
<li><a href="../346736/index.html">Major events in 2018: development</a></li>
<li><a href="../346738/index.html">On data locality in hyperconvergent systems</a></li>
<li><a href="../346744/index.html">First meeting with the ss team</a></li>
<li><a href="../346746/index.html">Reference application based on containers and microservice architecture</a></li>
<li><a href="../346748/index.html">Pentestit Corporate Laboratories: Practical Information Security Skills</a></li>
<li><a href="../346750/index.html">How we spent the day at Veeam</a></li>
<li><a href="../346752/index.html">An explanation of HTTPS on homing pigeons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>