<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FPGA is simple or do it yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√©, there are many articles devoted to microcontrollers and programming languages ‚Äã‚Äãon them, but not often you can find articles on programming ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FPGA is simple or do it yourself</h1><div class="post__text post__text-html js-mediator-article">  On Habr√©, there are many articles devoted to microcontrollers and programming languages ‚Äã‚Äãon them, but not often you can find articles on programming FPGAs.  FPGA firmware can be written in hardware description languages ‚Äã‚Äãor you can draw diagrams in CAD programs of FPGA companies.  Today I want to show how to program the ALU on an FPGA by Actel A3P250 (ProASIC 3 with a number of equivalent gates of 250,000) in the language of hardware description SystemVerilog.  This FPGA is interesting because it allows you to prototype custom-made ASIC or BMC chips.  The firmware that is synthesized for this FPGA can be turned with a serial chip. <br><br>  Who cares welcome under cat. <br><a name="habracut"></a><br>  So, the creation of the firmware can be divided into several stages: <br><br>  1. Determine what we want to get, draw on a piece of paper, in the head or in Visio a block diagram of the future device.  In my case it is an ALU, it has inputs: two operands of 4 bits each, a reset input, a synchronization input, an operation code input 2 bits (00 is addition, 01 is subtraction, 10 is multiplication, 11 is the result is 0) and output is the result of 8 discharges. <br>  2. If the project is complex, then it is necessary to write a behavioral model, in some high-level language, for example in C #, by which you can understand how it will work, in this case I‚Äôll skip this point, because I‚Äôll write a model in C or C This device will be able to many, and I'm sure better than me. <br>  3. Actually we write code, I use NPP with SystemVerilog syntax highlighting for this, although you can write in any text editor or in one of the programs for modeling, synthesizing or tracing the chip, but more on that later. <br>  The firmware code at this stage I will call the logical model, although it may be different in different sources. <br>  4. We write a test for our logical model, for this we can use several methods.  Also at this stage we combine test and model. <br>  5. Run our model with a test in the modeling environment.  I use QuestaSim for modeling, this is an advanced version of ModelSim from Mentor Graphics. <br>  6. If the tests are performed successfully, then you can proceed to the synthesis.  For synthesis, I use Mentor Graphics Precision Synthesis.  But you can use the software that the chip manufacturer provides you.  As a result of the synthesis, we get files in the format * .edf and Verilog, this is a logical model assembled by CAD synthesis from those blocks that are in the FPGA, as well as a description of the connections between them.  I will call these files no-lists. <br>  7. The file of the no-list in the Verilog format must be connected instead of the logical model and the simulation must be restarted to make sure that the synthesis was successful and the synthesizer did not throw out anything extra, he knows it very well.  Also at this stage, you can use the means of formal verification, which will verify the compliance of the resulting no-list of the logical model. <br>  8. If the no-list has been tested, you can proceed to the placement and tracing of the no-list in the FPGA, for this I will use Actel Designer, which is part of the Actel Libero IDE.  At this stage, we get the finished firmware FPGA and, just as important, the revised no-list and time delays in its circuits, the no-list again has the Verilog format, and the delays are generated in the * .sdf format. <br>  9. Now you need to simulate the no-list obtained as a result of tracing with time delays and make sure that everything works. <br>  10. If everything really works, then you can flash it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now back to the ALU. <br>  The code in SystemVerilog consists of modules, at least in that part, as regards the description of the equipment, since  When testing, the keywords class and program appear. <br><br>  As it is not sad, but the tag for SystemVerilog or at least Verilog is not, but there is a tag for VHDL, I had to use it ... <br><br>  We analyze the module ALU in parts. <br><br>  First we announce the name of the module and the inputs / outputs, remember we defined them at the first stage. <br><pre><code class="vhdl hljs">module ALU ( input rst, clk, //    input [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] cmd, //  input [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] a,b, // output logic [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] res // );</code> </pre> <br>  Then we declare several internal lines for connecting the combinational part and the trigger part. <br><pre> <code class="vhdl hljs"> logic [<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] A, B; logic [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] Cmd; logic [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] outpRes;</code> </pre><br><br>  Now we will describe combinational or asynchronous often ALU: <br><br><pre> <code class="vhdl hljs"> always_comb <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> unique <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(Cmd) <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b00</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>:add outpRes = A+B; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>:add <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b01</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>:sub outpRes = AB; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>:sub <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b10</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>:mul outpRes = A*B; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>:mul <span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b11</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>:div outpRes = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>:div endcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  And finally, the trigger or synchronous part of the ALU, because the ALU will be synchronous <br><pre> <code class="vhdl hljs"> always_ff @(posedge clk, posedge rst) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rst) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> res &lt;= '<span class="hljs-number"><span class="hljs-number">0</span></span>; A &lt;='<span class="hljs-number"><span class="hljs-number">0</span></span>; B &lt;='<span class="hljs-number"><span class="hljs-number">0</span></span>; Cmd &lt;='<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> A[<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;= a; B[<span class="hljs-number"><span class="hljs-number">3</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;= b; Cmd &lt;=cmd; res &lt;= outpRes; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Module close the keyword: <br><pre> <code class="vhdl hljs">endmodule</code> </pre><br><br>  Now we will write a test and run the simulation, we get the following timing diagram: <br><br><img src="http://habrastorage.org/storage2/619/ccd/b68/619ccdb687dd28aa13ddbd48ba16c99a.jpg"><br><br>  As we can see, operations are performed, but because of two triggers at the input and output, we get a delay of 2 clocks, this can be corrected, but we simply consider an example and do not create a Core i7, so let's leave it and proceed to the synthesis: <br><br><img src="http://habrastorage.org/storage2/578/617/368/578617368850b2a9a62488785e123284.png"><br><br>  The synthesizer decided that our circuit would look like the figure above, in general, I agree with him here, although this is not always the case and therefore I will not even run the test once more immediately proceed to the trace in the crystal. <br><br>  Since  I have a whale design, then I will place the conclusions of the FPGA as follows: <br><br><img src="http://habrastorage.org/storage2/e20/c02/725/e20c02725aad0f879a85c58753ea7490.png"><br><br>  The result of the work of the router (placement of elements in the crystal) in the figure below, by the way at this stage, you can move the elements around the crystal. <br><br><img src="http://habrastorage.org/storage2/644/d83/e8b/644d83e8b536742fa59ab3e3e42813b3.png"><br><br>  Yellow highlighted circuit clock signal. <br><br>  At this point I want to finish my story, the video will be later. <br><br>  Thanks to everyone who read to the end, I apologize for the style and possible errors in the text, but I'm not a writer just learning. <br><br>  PS To whom it is interesting PLIS I have been doing for 3 years already, this project of the ALU was made in an hour, it was necessary to have a simple layout for checking one method of introducing failures. </div><p>Source: <a href="https://habr.com/ru/post/152491/">https://habr.com/ru/post/152491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152475/index.html">Navigator with video recorder SeeMax Navi E540 HD DVR</a></li>
<li><a href="../152477/index.html">NoSQL database: we understand the essence</a></li>
<li><a href="../152479/index.html">The story of a startup in the field of information security</a></li>
<li><a href="../152483/index.html">Own Security Realm in GlassFish</a></li>
<li><a href="../152485/index.html">Digsby is now in Open Source, available on GitHub</a></li>
<li><a href="../152493/index.html">In the German parliament laptops were banned, the deputy of the Pirate Party came with a typewriter</a></li>
<li><a href="../152495/index.html">edX / MITx: Introduction to Computer Science and Programming</a></li>
<li><a href="../152497/index.html">Ask an iTunes Specialist</a></li>
<li><a href="../152499/index.html">Ancestor override (dirty hack)</a></li>
<li><a href="../152501/index.html">About Unity 3D first-hand. Interview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>