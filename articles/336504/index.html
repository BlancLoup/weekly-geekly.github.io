<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Check dependency injection on Swift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The project with Dependency Injection is similar to a Christmas tree garland - it is beautiful, it pleases children and adults. But if you do not inje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Check dependency injection on Swift</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/a85/c02/bb4/a85c02bb40ca41a0843b8c89db99a175.jpg" alt="image"></p><br><p>  The project with Dependency Injection is similar to a Christmas tree garland - it is beautiful, it pleases children and adults.  But if you do not inject a dependency somewhere, an entire segment of the application will disconnect.  And, to find the source of the problems, you will have to check all the dependencies in this segment. </p><br><p>  This article describes several options for finding empty dependencies.  And in our repository there is a small library that will help with this: <a href="https://github.com/TinkoffCreditSystems/InjectionsCheck">TinkoffCreditSystems / InjectionsCheck</a> </p><a name="habracut"></a><br><h2 id="vnedrenie-zavisimostey-v-init">  Dependency injection in init </h2><br><p>  To declare all dependencies as non-optional and embed them in Init is the most reliable way. </p><br><pre><code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheObject</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IObjectProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service: <span class="hljs-type"><span class="hljs-type">IService</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>( <span class="hljs-number"><span class="hljs-number">_</span></span> service: <span class="hljs-type"><span class="hljs-type">IService</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.service = service } }</code> </pre> <br><p>  <strong>Pros:</strong> </p><br><ul><li>  The project is not going to, if something forgot to initialize. </li><li>  The compiler will indicate what and where have forgotten. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  Cyclic dependencies cannot be used. </li><li>  Many parameters in Init. </li><li>  You cannot embed dependencies in ViewController and similar objects. </li></ul><br><h2 id="proverka-zavisimostey-v-testah-i-di-konteynere">  Dependency Checking in Tests and DI Container </h2><br><p>  You can use tests to check if all dependencies are in place.  But it is more difficult to follow them than for objects, so you need a simple way to keep such tests up to date.  A function that helps to check all the optional-properties of the object and reports an error if it finds nil will help with this. </p><br><p>  To be sure that the tests will not miss empty dependencies, you need to force them to check everything except dependencies from the list of exceptions.  It is easier to maintain an exclusion list than a list of properties that need to be checked.  If the exception is not registered, the test will fail, and it will be noticeable. </p><br><p>  <strong>Pros:</strong> </p><br><ul><li>  More freedom in dependency injection. </li><li>  You can implement protocol dependencies. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  We need to run tests to make sure that nothing is forgotten. </li><li>  All checked objects must be in tests. </li><li>  For dependencies, you need to use <code>guard</code> or <code>service?.doSomething</code> . </li></ul><br><p>  In Swift, this function can be created using reflection and the <a href="https://developer.apple.com/documentation/swift/mirror">Mirror</a> class.  It allows you to bypass all the properties and see their values. </p><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkInjections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(of object: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(‚Äú<span class="hljs-type"><span class="hljs-type">Properties</span></span> of \(<span class="hljs-type"><span class="hljs-type">String</span></span>(reflecting: object))‚Äù) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-type"><span class="hljs-type">Mirror</span></span>(reflecting: object).children { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(‚Äú\t\(child.label) = \(child.value)‚Äù) } }</code> </pre> <br><p>  <code>label: String</code> - the name of the property, <br>  <code>value: Any</code> is a value that can be nil. </p><br><p>  But there is one trouble: </p><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> child.value == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   }</span></span></code> </pre> <br><p>  Swift does not compare Any with nil.  Formally, he is right, because ‚ÄúAny‚Äù and ‚ÄúAny?‚Äù Are different types.  Therefore, you need to use the Mirror class again to find the final Optional in Any and see if it is equal to nil. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">fileprivate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unwrap</span></span></span><span class="hljs-function">&lt;ObjectType: Any&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> object: ObjectType)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ObjectType?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mirror = <span class="hljs-type"><span class="hljs-type">Mirror</span></span>(reflecting: object) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> mirror.displayStyle == .<span class="hljs-keyword"><span class="hljs-keyword">optional</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> object } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> child = mirror.children.first <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unwrap(any: child.value) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">ObjectType</span></span> }</code> </pre> <br><p>  Recursion is used because Any can have an optional nested, for example, an IService ?? ... The result of this function will produce the usual Optional, which can be compared to nil. </p><br><h3 id="spisok-isklyucheniy-dlya-svoystv">  Property Exception List </h3><br><p>  For some objects, not all properties need to be checked for nil, so we will add a list of exception properties.  Due to the fact that <strong>child.label</strong> is a string, you can set exceptions only this way: </p><br><ul><li>  Array of property names <code>[String]</code> </li><li>  Array of selectors <code>#Selector(keypath:)</code> (only for properties with <a href="https://habrahabr.ru/users/objc/" class="user_link">objc</a> ) </li><li>  Array of keys <code>#keyPath()</code> (only for properties with <a href="https://habrahabr.ru/users/objc/" class="user_link">objc</a> ) </li></ul><br><div class="spoiler">  <b class="spoiler_title">Why not use Swift 4 KeyPath</b> <div class="spoiler_text"><p>  Swift 4 KeyPath allows you to get a value by key - an object, not a string.  Now it is impossible to get the property name as a string.  And you can not get a complete list of all KeyPath to walk on them. </p></div></div><br><p>  We use the SelectorName protocol to support all variants without type casting, as well as enum: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectorName</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">String</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheObject</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IObjectProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> notService: <span class="hljs-type"><span class="hljs-type">INotService?</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectorsToIgnore</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectorName</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> notService } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">SelectorName protocol support for String, Selector, and RawRepresentable</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectorName</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Selectoe</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectorName</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">String</span></span>(describing: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SelectorName</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Self</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawRepresentable</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawType</span></span></span><span class="hljs-class"> == </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> valur: <span class="hljs-type"><span class="hljs-type">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.rawValue } }</code> </pre> </div></div><br><p>  The final function code for checking dependency injection will look like this: </p><br><div class="spoiler">  <b class="spoiler_title">func checkInjections</b> <div class="spoiler_text"><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InjectionCheckError</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Error</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> notInjected(properties: [<span class="hljs-type"><span class="hljs-type">String</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkInjections</span></span></span><span class="hljs-function">&lt;ObjectType&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> object: ObjectType, ignoring selectorsToIgnore: [SelectorName] = [] )</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ObjectType</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> selectorsSet = <span class="hljs-type"><span class="hljs-type">Set</span></span>&lt;<span class="hljs-type"><span class="hljs-type">String</span></span>&gt;(selectorsToIgnore.flatMap { $<span class="hljs-number"><span class="hljs-number">0</span></span>.stringValue } ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mirror = <span class="hljs-type"><span class="hljs-type">Mirror</span></span>(reflecting: object) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> uninjectedProperties: [<span class="hljs-type"><span class="hljs-type">String</span></span>] = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mirror.children { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> label = child.label, !selectorsSet.<span class="hljs-built_in"><span class="hljs-built_in">contains</span></span>(label), unwrap(child.value) == <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } uninjectedProperties.append(label) } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> uninjectedProperties.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error = <span class="hljs-type"><span class="hljs-type">InjectionCheckError</span></span>.notInjected(properties: uninjectedProperties, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: object) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> object }</code> </pre> </div></div><br><h2 id="forced-unwrap-zavisimosti">  Forced Unwrap dependencies </h2><br><p>  Dependencies can be declared as Force unwraped: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TheObject</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IObjectProtocol</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service: <span class="hljs-type"><span class="hljs-type">IService!</span></span> }</code> </pre> <br><p>  <strong>Pros:</strong> </p><br><ul><li>  The application immediately crashes if it is nil. </li><li>  The error log indicates what and where was nil. </li><li>  Convenient to use dependencies. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  Application falls. </li><li>  You can skip the code in production, which will fall. </li><li>  In the application, you need to find a place with empty dependencies so that it falls. </li></ul><br><p>  The fall of the app creates a negative user experience.  As in the example with garlands: you get a light bulb that explodes brightly if it burns out.  Most likely, such an empty dependency will pass by the developer and tester, if it is responsible for a not very important or rarely used function, and the application is able to work, albeit with limited functionality. </p><br><p>  For example, without a phone number formatter in the list of orders, the application will work, will display the rest of the information, and not fall.  And, of course, inform the developers about the problem. </p><br><h2 id="proverki-na-vyhode-iz-di-konteynera--padenie-v-debug-rezhime">  Checks at the exit of the DI-container + drop in debug-mode </h2><br><p>  In Swift, there is a conditional compilation, which allows using the Force unwrapped dependencies philosophy only in Debug mode.  Compiler conditions allow you to make a function that will call fatalError in debug mode if it finds empty dependencies.  And it is convenient to use it at the exit from the service locator, Assembly or factory. </p><br><p>  <strong>Pros:</strong> </p><br><ul><li>  Works without running tests. </li><li>  The application crashes only in debug mode. </li><li>  The error log will indicate what and where was nil. </li><li>  Embed in the project is simple. </li></ul><br><p>  <strong>Minuses:</strong> </p><br><ul><li>  All checked objects must pass through a function. </li><li>  For dependencies, you need to use <code>guard</code> or <code>service?.doSomething</code> . </li><li>  Testing the release build can detect errors only by logs. </li></ul><br><p>  This wrapper function checks the object's dependencies and drops it with an error if the <strong>-DDEBUG</strong> or <strong>-DINJECTION_CHECK_ENABLED</strong> flag is set for the compiler.  In the rest of the case, he quietly writes to the log: </p><br><pre> <code class="hljs swift"><span class="hljs-meta"><span class="hljs-meta">@discardableResult</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">debugCheckInjections</span></span></span><span class="hljs-function">&lt;ObjectType&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> object: ObjectType, ignoring selectorsToIgnore: [IgnorableSelector] = [], errorClosure: </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"> error: Error)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span> = { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"Injection check error: \($0)"</span></span>) }) -&gt; <span class="hljs-type"><span class="hljs-type">ObjectType?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> checkInjections(object, ignoring: selectorsToIgnore) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> object } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-type"><span class="hljs-type">DEBUG</span></span> || <span class="hljs-type"><span class="hljs-type">INJECTION_CHECK_ENABLED</span></span> errorClosure(error) #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Injection check error: \(error)"</span></span>) #endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre> <br><h2 id="vmesto-zaklyucheniya">  Instead of conclusion </h2><br><p>  All methods have their pros and cons.  Depending on the project, team, well-established principles of work will work better one way or another. </p><br><p>  I prefer not to introduce dependencies through Init, because it is impossible to embed dependencies that are created from Storyboard into ViewController.  And it complicates refactoring and making changes. </p><br><p>  Forced Unwrap is not used not only for managing dependencies, but also in production in general.  SwiftLint even has a 'force_unwrapping' rule activated that prevents it from being used. </p><br><p>  Dependency checking in tests works well to support old code.  Ensures that the old dependencies are not lost, and everything continues to work.  But inconvenient for current development. </p><br><p>  Therefore, I prefer checking on leaving the DI container with crashing in Debug mode.  So the fastest you can find empty dependencies and immediately fix them. </p><br><p>  All functions presented here are in the library: <br>  <a href="https://github.com/TinkoffCreditSystems/InjectionsCheck">TinkoffCreditSystems / InjectionsCheck</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336504/">https://habr.com/ru/post/336504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336494/index.html">Quick registration of image focal points using big-vote</a></li>
<li><a href="../336496/index.html">Architectural Pyramid Applications</a></li>
<li><a href="../336498/index.html">Know your tool: Event Loop in libuv</a></li>
<li><a href="../336500/index.html">PHP Digest number 115 - the latest news, materials and tools (August 14 - 27, 2017)</a></li>
<li><a href="../336502/index.html">Revit API Vector Geometry for Developers</a></li>
<li><a href="../336506/index.html">XBRL: just about the complex - Chapter 6. Immersion in XBRL - Part 5. New dimensions</a></li>
<li><a href="../336508/index.html">Change payment service using A / B test through HAProxy</a></li>
<li><a href="../336512/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ277 (August 21 - 27, 2017)</a></li>
<li><a href="../336514/index.html">Kim Dotcom was returned part of the confiscated property</a></li>
<li><a href="../336516/index.html">Text independent voice identification</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>