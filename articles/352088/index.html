<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Inversion of control in iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evgeny Yolchev rsi , KODE iOS timlide 


 Recently, I increasingly hear about DI. They are interested in my students at Geek University, it is mention...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Inversion of control in iOS</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/tz/e4/0i/tze40iy6pjurq5a_r-vbtxfnrmy.png" alt="image"></p><br><p><img src="https://habrastorage.org/webt/t5/d9/93/t5d993z3w29vkc7yvglgrrwsn8k.png" align="left">  <strong>Evgeny Yolchev <a href="https://habr.com/users/rsi/" class="user_link">rsi</a> , KODE iOS timlide</strong> </p><br><p>  <em>Recently, I increasingly hear about DI.</em>  <em>They are interested in my students at Geek University, it is mentioned in chat rooms.</em>  <em>Although the pattern is far from young, many do not quite understand it.</em> <em><br></em>  <em>Often, DI means a framework, for example, typhoon or swinject.</em>  <em>The article details the principles of implementing DI, as well as the principle of IoC.</em>  <em>If interested, please under the cat.</em> </p><a name="habracut"></a><br><blockquote>  DI (dependency injection, Eng. Dependency injection) is the process of providing external dependency to a software component.  It is a specific ‚ÄúIoC‚Äù form when it is applied to dependency management.  In full accordance with the principle of sole responsibility, the object gives care to build the dependencies required by it to an external, specially designed for this general mechanism. </blockquote><br><blockquote>  IoC (Inversion of Control, English Inversion of Control) is an important principle of object-oriented programming used to reduce hooking (connectedness) in computer programs. <br></blockquote><p>  Despite the fact that the article is about DI, we will begin our journey not with it, but with IoC, for the reason that DI is only one of the IoC types and the picture needs to be seen in its entirety. </p><br><h1 id="ioc">  IoC </h1><br><p>  For a start, let's look at what management is.  Take the simplest example - the console ‚ÄúHello world‚Äù: </p><br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstWord = ¬´hello¬ª <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondWord = <span class="hljs-string"><span class="hljs-string">"world!"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> phrase = firstWord + <span class="hljs-string"><span class="hljs-string">" "</span></span> + secondWord <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(phrase)</code> </pre> <br><p>  In this example, our commands manage data that is represented by string literals and variables.  At this level of abstraction, there is no longer any control, but we can add it using the ternary operator: </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number = arc4random_uniform(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstWord = number == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-string"><span class="hljs-string">"hello"</span></span> : <span class="hljs-string"><span class="hljs-string">"bye"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> secondWord = <span class="hljs-string"><span class="hljs-string">"world!"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> phrase = firstWord + <span class="hljs-string"><span class="hljs-string">" "</span></span> + secondWord <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(phrase)</code> </pre> <br><p>  Our code has become ambiguous, and now, depending on a random number, the string in the console will change.  In other words, the data controls our program.  This is the most trivial and simple example of inversion control. </p><br><p>  In a typical iOS application, control is everywhere.  System, user, server control application.  The application controls the server, the user and the system.  Our code contains a huge number of objects that also control each other.  For example, an object of class <strong>AuthViewController</strong> can control an object of class <strong>AuthService</strong> . </p><br><p>  Such management of objects in turn is based on several aspects.  First, the <strong>AuthViewController</strong> calls <strong>AuthService</strong> methods, and second, it creates it.  All this leads to high connectivity of objects, using the <strong>AuthViewController</strong> becomes impossible without an <strong>AuthService</strong> .  This is called a dependency, <strong>AuthViewController is</strong> completely dependent on <strong>AuthService</strong> . </p><br><p>  There is an opinion that there is nothing terrible in such dependencies.  As a rule, our controllers are not re-used and go hand in hand with their services all the time the application is supported.  But those who have been supporting long-lived applications know that this is not the case.  Requirements are constantly changing, we find bugs, change the flow, make a redesign.  If at the same time your application is more complicated than several controllers with a pair of buttons and services that are just wrappers for URLSession, then it sinks in dependencies.  The dependencies between the classes form a web, sometimes cyclic dependencies can be detected.  You cannot make changes to your classes, because it is not clear how and where they are used, it is easier for you to create a new method than to change the old one.  Replacing the class does turn into pain.  Challenge his designer scattered on various methods that you also have to change.  In the end, you stop understanding what is happening, the code turns into plain text and, armed with a search, you begin to replace words or sentences in this text, checking only compiler errors. </p><br><p>  In order to prevent such an outcome of events, many principles and techniques have been invented.  For example, one of the principles of the SOLID DIP principle describes how to reduce connectivity when calling methods and this is IoC. </p><br><blockquote>  DIP (dependency inversion principle, Eng. Dependency inversion principle) is one of five of the SOLID principles. <br><br>  Formulation: <br><br>  The modules of the upper levels should not depend on the modules of the lower levels.  Both types of modules must depend on abstractions. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Abstractions should not depend on the details.  Details must depend on abstractions. <br></blockquote><p>  But still, when someone says ‚Äú <strong>IoC</strong> ‚Äù, he means the inversion of control when creating dependencies.  Further I will use it only in this value.  By the way, DIP is almost impossible to implement without <strong>IoC</strong> , but not vice versa.  Using <strong>IoC</strong> does not guarantee compliance with DIP.  Another important nuance.  DIP and DI are different principles. </p><br><h1 id="na-puti-k-ioc">  Towards IoC </h1><br><p>  Actually, IoC is a very simple concept, and you don‚Äôt need to read a lot of literature, go to Tibet for a few years to understand Zen and start using it. </p><br><p>  As an example, I will consider the class of ‚Äúknight‚Äù ( <strong>Knight</strong> ) and its ‚Äúarmor‚Äù ( <strong>Armor</strong> ), all classes are shown below. <br><img src="https://habrastorage.org/webt/mu/h3/cm/muh3cmatxw7dn-cbcxnygp3mrv8.png" alt="image"><br>  Now look at the implementation of the class <strong>Armor</strong> </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> belt: <span class="hljs-type"><span class="hljs-type">Belt?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chest: hest? <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bracers: <span class="hljs-type"><span class="hljs-type">Bracers?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gloves: <span class="hljs-type"><span class="hljs-type">Gloves?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helmet: <span class="hljs-type"><span class="hljs-type">Helmet?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.boots = <span class="hljs-type"><span class="hljs-type">Boots</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.pants = <span class="hljs-type"><span class="hljs-type">Pants</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.belt = <span class="hljs-type"><span class="hljs-type">Belt</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.chest = hest() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.bracers = <span class="hljs-type"><span class="hljs-type">Bracers</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.gloves = <span class="hljs-type"><span class="hljs-type">Gloves</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.helmet = <span class="hljs-type"><span class="hljs-type">Helmet</span></span>() } }</code> </pre> <br><p>  and <strong>Knight</strong> </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">Armor?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareForBattle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.armor.configure() } }</code> </pre> <br><p>  At first glance, all is well.  If we need a knight, we'll just create it. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> knight = <span class="hljs-type"><span class="hljs-type">Knight</span></span>()</code> </pre> <br><p>  But not everything is so simple.  Unfortunately, surrogate examples cannot convey all the pain that this approach carries. </p><br><p>  Our classes are soldered together.  In <code>Armor</code> <code>make</code> method, 7 classes are created.  This makes the classes ossified.  With this approach, we cannot simply determine where and how a class is created.  If you need to inherit from armor and create, for example, front armor, replacing the helmet, we will have to redefine the whole method. </p><br><p>  The only plus in this approach is the speed of writing code, because when creating classes you don‚Äôt have to think about the future. </p><br><p>  Here is a small example of how it might look in life: </p><br><pre> <code class="hljs smalltalk">class <span class="hljs-type"><span class="hljs-type">FightViewController</span></span>: <span class="hljs-type"><span class="hljs-type">BaseViewController</span></span> { var titleLabel: <span class="hljs-type"><span class="hljs-type">UIView</span></span>! var knightList: <span class="hljs-type"><span class="hljs-type">UIView</span></span>! override func viewDidLoad() { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title = <span class="hljs-comment"><span class="hljs-comment">""</span></span> //       ,       //   let backgroundView = <span class="hljs-type"><span class="hljs-type">UIView</span></span>() //    <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(backgroundView) //    backgroundView.backgroundColor = <span class="hljs-type"><span class="hljs-type">UIColor</span></span>.red //   backgroundView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> backgroundView.translatesAutoresizingMaskIntoConstraints = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> backgroundView.leadingAnchor.constraint(equalTo: leadingAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> backgroundView.topAnchor.constraint(equalTo: topAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> backgroundView.trailingAnchor.constraint(equalTo: trailingAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> backgroundView.bottomAnchor.constraint(equalTo: bottomAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> let title = <span class="hljs-type"><span class="hljs-type">Views</span></span>.<span class="hljs-type"><span class="hljs-type">BigHeader</span></span>.<span class="hljs-type"><span class="hljs-type">View</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.titleLabel = title title.labelView.text = <span class="hljs-comment"><span class="hljs-comment">"labelView"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(title) title.translatesAutoresizingMaskIntoConstraints = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> title.leadingAnchor.constraint(equalTo: leadingAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> title.topAnchor.constraint(equalTo: topAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> title.trailingAnchor.constraint(equalTo: trailingAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> title.heightAnchor.constraint(equalToConstant: <span class="hljs-number"><span class="hljs-number">56</span></span>).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> let knightList = <span class="hljs-type"><span class="hljs-type">Views</span></span>.<span class="hljs-type"><span class="hljs-type">DataView</span></span>.<span class="hljs-type"><span class="hljs-type">View</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.knightList = knightList knightList.titleView.text = <span class="hljs-comment"><span class="hljs-comment">"knightList"</span></span> knightList.dataView.text = <span class="hljs-comment"><span class="hljs-comment">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.view.addSubview(knightList) knightList.translatesAutoresizingMaskIntoConstraints = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> knightList.leadingAnchor.constraint(equalTo: leadingAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> knightList.topAnchor.constraint(equalTo: title.topAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> knightList.trailingAnchor.constraint(equalTo: trailingAnchor).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> knightList.heightAnchor.constraint(equalToConstant: <span class="hljs-number"><span class="hljs-number">45</span></span>).isActive = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } }</code> </pre> <br><p>  This code is easy to find in someone else's project.  It perfectly illustrates that creating dependency classes in arbitrary places is not a good idea.  In addition, unlike armor, the elements here are not only created, but customized and even positioned.  The code has turned to mush. </p><br><p>  How can this be improved?  Use the ‚Äúfactory method‚Äù pattern.  It will not solve all problems, but it will make the class more flexible. </p><br><blockquote>  The factory method (English Factory Method, also known as the Virtual Designer (English Virtual Constructor)) is a generic design pattern that provides an interface for subclasses to create instances of a certain class. <br></blockquote><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.boots = makeBoots() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.pants = makePants() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><p>  Already better, the creation of dependencies rendered in separate methods.  They are easy to find, just change without risk of damaging the logic of the class.  With inheritance, we can override them and thus override dependencies. </p><br><p>  But still, our class should not be aware of the details of creating its dependencies, it should just use them.  How to deal with it?  It is necessary to move the generating logic from the class to a higher level. </p><br><blockquote>  Generating logic is code that creates instances of a class or structure.  In other words - the code that generates objects. <br></blockquote><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(boots: Boots?, pants: Pants?)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.boots = boots <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.pants = pants } }</code> </pre> <br><p>  Now our class <code>Armor</code> has no idea how its dependencies are created, they are simply passed as arguments.  This gives maximum flexibility.  We can even replace classes with protocols and completely ignore implementation details. </p><br><p>  But our <code>Knight</code> class is not doing so well. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">Armor?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preapreForBattle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boots = makeBoots() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pants = makePants() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.armor?.make(boots: boots, pants: pants) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><p>  He creates all parts of his armor.  You could say our knight is his own blacksmith. <br>  This is wrong, the knights should not forge armor for themselves, not their level of task, but how then to be?  You can again take out the generating logic to a higher level, but then the class at the top of the graph will be a huge dump for creating dependencies. </p><br><p>  We will come to the aid of another generating pattern - "factory". </p><br><blockquote>  Factory (eng. Factory) - an object that creates other objects. <br></blockquote><p>  We will build a smithy in which parts of armor will be made and assembled into a single set. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Armor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>() armor.boots = makeBoots() armor.pants = makePants() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> armor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><p>  The classes <code>Armor</code> and <code>Knight</code> will get rid of the generating logic and will look concisely. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">Armor?</span></span> }</code> </pre> <br><p>  Now the question arises before us: how, where and when to pick up dependencies from the ‚Äúfactory‚Äù and transfer them to our classes.  So, we finally came to the concepts of DI and SL. </p><br><h1 id="servis-lokator-sl">  Service Locator (SL) </h1><br><p>  Let's start with this pattern.  First, it is easier.  Secondly, many people think that this is DI, although it is not. </p><br><blockquote>  SL (service locator) is a design pattern used in software development for encapsulating processes associated with obtaining a service with a strong level of abstraction.  This template uses a central registry, known as a ‚Äúservice locator,‚Äù which, upon request, returns information (usually objects) necessary to perform a specific task. <br></blockquote><p>  What is its essence?  In order to get dependencies, a ‚Äúfactory‚Äù is transferred from the constructor to the class, from which he chooses what to get. </p><br><p>  In this case, our classes will look like this: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Armor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>(forge: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> armor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> forge: <span class="hljs-type"><span class="hljs-type">Forge</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">Armor?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(forge: <span class="hljs-type"><span class="hljs-type">Forge</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.forge = forge configure() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { armor = forge.makeArmor() } }</code> </pre> <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> forge: <span class="hljs-type"><span class="hljs-type">Forge</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(forge: <span class="hljs-type"><span class="hljs-type">Forge</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.forge = forge configure() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { boots = forge.makeBoots() pants = forge.makePants() } }</code> </pre> <br><pre> <code class="hljs lisp">let forge = Forge() let knight = Knight(<span class="hljs-name"><span class="hljs-name">forge</span></span>: forge)</code> </pre> <br><p>  Personally, this approach causes a double feeling to me.  On the one hand, the generating logic is in the ‚Äúfactory‚Äù, on the other hand, the process of obtaining dependencies is somewhat confused.  But the main drawback is that, looking at a class, it is impossible to unambiguously determine its dependencies.  He can get anything from the ‚Äúfactory‚Äù, a typical development mistake is to create one such ‚Äúfactory‚Äù for the entire application.  At the same time, the ‚Äúfactory‚Äù turns into a huge junk dump and creates the temptation to get inside the classes what they do not really need.  At classes contact, restrictions vanishes. </p><br><p>  You can imagine that our knight was presented with a treasure chest from which he can get the armor he needs, but no one will prevent him from gaining unnecessary decorations. <br>  It is for this reason that this pattern crossed the line of good and evil and turned into an anti-pattern.  If you have a choice between DI and SL, always choose DI. </p><br><h1 id="di">  DI </h1><br><p>  The second way to deliver dependencies to classes is DI.  This is currently the most common pattern.  It is so popular that in the world of backend all normal frameworks support it out of the box.  Unfortunately, we were not so lucky. </p><br><p>  The essence of this pattern is that dependencies are introduced into the class from the outside, while the dependency graph is built inside the DI container, which is a ‚Äúfactory‚Äù or a set of ‚Äúfactories‚Äù. </p><br><p>  Our classes look like this: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">Armor?</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Armor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>() armor.boots = makeBoots() armor.pants = makePants() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> armor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Garrison</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forge: <span class="hljs-type"><span class="hljs-type">Forge</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Forge</span></span>() }() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeKnight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Knight</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> knight = <span class="hljs-type"><span class="hljs-type">Knight</span></span>() knight.armor = forge.makeArmor() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> knight } }</code> </pre> <br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> garrison = <span class="hljs-type"><span class="hljs-type">Garrison</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> knight = garrison.makeKnight()</code> </pre> <br><p>  In this case, the classes look clean, they completely lack generating logic.  Two "factories" took full responsibility for the assembly: <code>Garrison</code> and <code>Forge</code> .  If desired, the number of these "factories" can be increased to prevent the growth of classes.  A good practice is to create a ‚Äúfactory‚Äù, responsible for creating any kindred objects.  For example, this ‚Äúfactory‚Äù can create services, controllers for a particular user story. </p><br><p>  At the same time, our knight finally finished doing things that are not appropriate to his status, the squire is in charge of his ammunition, and the knight can concentrate on fights and princesses. <br>  This could be finished, but it is worth talking about some aspects of DI and currently available frameworks. </p><br><h1 id="tipy-di">  Types DI </h1><br><p>  Initializer Injection - dependency injection through a constructor.  This approach is used when a class cannot exist without its dependencies, but even if this is not the case, it can be used to more clearly define a class contract.  If all the dependencies are declared as arguments to the constructor, it is easy to define them.  But do not get carried away, if the class has dozens of dependencies, it is better not to pass them in the constructor (or even better to figure out why your class has so many dependencies). </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(boots: <span class="hljs-type"><span class="hljs-type">Boots</span></span>, pants: <span class="hljs-type"><span class="hljs-type">Pants</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.boots = boots <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.pants = pants } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Armor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boots = makeBoots() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pants = makePants() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>(boots: boots, pants: pants) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> armor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><p>  Property Injection - the introduction of dependencies through the properties.  This method is used when a class has optional dependencies, without which it can do without, or when dependencies can change not only at the object initialization stage. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Armor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> boots: <span class="hljs-type"><span class="hljs-type">Boots?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pants: <span class="hljs-type"><span class="hljs-type">Pants?</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Armor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>() armor.boots = makeBoots() armor.pants = makePants() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> armor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><p>  Method Injection - dependency injection through a method.  This method is very similar to Property Injection, but it can be used to introduce a time dependency only at the time of performing an action or more closely associate dependency injection with the class logic. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">Armor?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">winTournament</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(armor: Armor)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.armor = armor defeatEnemy() seducePrincess() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.armor = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defeatEnemy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seducePrincess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> {} } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Garrison</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> forge: <span class="hljs-type"><span class="hljs-type">Forge</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Forge</span></span>() }() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeKnight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Knight</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> knight = <span class="hljs-type"><span class="hljs-type">Knight</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> knight } } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> garrison = <span class="hljs-type"><span class="hljs-type">Garrison</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> knight = garrison.makeKnight() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = garrison.forge.makeArmor() knight.winTournament(armor: armor)</code> </pre> <br><p>  According to my observations, the most common types are Initializer Injection and Property Injection, Method Injection is less commonly used.  And although I have described typical cases of choosing one type or another, we must remember that Swift is a very flexible language, providing more options for choosing a type.  For example, even with optional dependencies, you can implement a constructor with optional arguments and nil by default.  In this case, you can use Initializer Injection instead of Property Injection.  In any case, this is a compromise that can improve or degrade your code, and the choice is yours. </p><br><h1 id="dip">  Dip </h1><br><p>  Simple use of IoC, as in the examples above, brings good dividends by itself, but you can go further and enforce the DIP principle from SOLID.  To do this, we will close the dependencies with the protocols, and only the ‚Äúfactories‚Äù will know exactly what implementation lies behind this protocol. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Knight</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">AbstractArmor?</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">AbstractArmor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> armor = <span class="hljs-type"><span class="hljs-type">Armor</span></span>() armor.boots = makeBoots() armor.pants = makePants() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> armor } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeBoots</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Boots</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boots</span></span>() } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Pants</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Pants</span></span>() } }</code> </pre> <br><p>  In this case, we can easily substitute the implementation of armor with an alternative one. </p><br><p>  SOLID is beyond the scope of this article, however, if you do not know what it is, it is better to familiarize yourself with this set of principles.  You can start with a good <a href="https://habrahabr.ru/post/348286/">introductory article</a> , continue reading the relevant chapters in <a href="https://www.ozon.ru/context/detail/id/5800704/">this book</a> . </p><br><h1 id="oblasti-vidimosti">  Scopes </h1><br><p>  By itself, managing the scope of objects is not part of the IoC concept; it‚Äôs more likely to be the details of its implementation, but nevertheless it is a very powerful mechanism that makes it possible to drop singletons and solve other problems with common dependencies.  The scope determines how long the dependency created inside the ‚Äúfactory‚Äù will live, whether it will be created each time anew or saved after the first creation and simply passed by reference. </p><br><p>  Since scopes are not described in patterns, each implements and names them as it sees fit.  We consider the two most commonly used types. </p><br><p>  The standard scope is the behavior that we implemented in all the examples above.  ‚ÄúFactory‚Äù creates an object, gives it away and forgets about its existence.  When you call the factory method again, a new object will be created. </p><br><p>  The scope of the container is similar to the behavior of the singleton.  When you first call the factory method, a new object is created, then the ‚Äúfactory‚Äù saves a reference to it and returns the result of the factory method, with all the other method calls, the new object is not created, but the reference to the first object is returned. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forge</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> armor: <span class="hljs-type"><span class="hljs-type">AbstractArmor?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeArmor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">AbstractArmor</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        if let armor = self.armor { return armor } let armor = Armor() armor.boots = makeBoots() armor.pants = makePants() self.armor = armor return armor } func makeBoots() -&gt; Boots { return Boots() } func makePants() -&gt; Pants { return Pants() } }</span></span></code> </pre> <br><p>  As you can see, in the example above, armor is created only once, in all other cases, the previously created instance is returned.  Similar to singleton, we will always work with the same class instance, without global scope. </p><br><h1 id="plyusy-i-minusy">  Advantages and disadvantages </h1><br><p>  Like any other principles in programming IoC is not a silver bullet, it has its advantages: </p><br><ul><li>  Reduces connectivity of classes; </li><li>  It's easier to reuse classes; </li><li>  More compact classes due to the removal of damaging logic; </li><li>  Encapsulates generating logic, which makes it easier to refactor; </li><li>  Hides the implementation; </li><li>  Simplifies the replacement implementation; </li><li>  Simplifies testing: by replacing ‚Äúfactories‚Äù, you can replace dependencies with mocks; </li><li>  Allows you to fumble objects in the application without using a singleton. </li></ul><br><p>  And cons: </p><br><ul><li>  Increases the number of classes while hiding the implementation of an abstraction; </li><li>  Increases time immersion in the project; </li><li>  It can easily lead to over-engineering. </li></ul><br><p>  Although my opinion is that the main and only drawback is over-engineering as a result of an unbridled desire to strictly follow the principle of DIP.   ,    ,      ,       . </p><br><p>   ,     ,   .     ,      ?    ,      ?  ? ,     ? </p><br><h1 id="podvodya-itog">  Summarizing </h1><br><p>   ,   IoC      ,   ,      .      iOS-,  ,   android-  DI,     dagger,   .   , ,  spring        .  php-,  , , Laravel   DI      .  iOS,  ,       ,  ,    .   Objective-C    ,    swift. </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortunately, you do not need to use the famous framework. </font><font style="vertical-align: inherit;">One of the goals of this article was to show that IoC is not a framework, and the fact that if there is no typhoon in the project, this does not mean that there is no DI. </font><font style="vertical-align: inherit;">For the implementation of IoC in the project it does not matter whether you choose DI or SL, a rather ordinary ‚Äúfactory‚Äù that you can write yourself. </font><font style="vertical-align: inherit;">Such a ‚Äúfactory‚Äù is the simplest DI container.</font></font></p></div><p>Source: <a href="https://habr.com/ru/post/352088/">https://habr.com/ru/post/352088/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352078/index.html">How to make a report on the identified vulnerability</a></li>
<li><a href="../352080/index.html">FastTrack Training. "Network Basics". "Understanding Cisco Architectural Games (Overview)". Eddie Martin December 2012</a></li>
<li><a href="../352082/index.html">SEO multilingual website without geo-referencing under Google</a></li>
<li><a href="../352084/index.html">Marvin Minsky "The Emotion Machine": Chapter 2 "We want to create a machine that would be proud of us"</a></li>
<li><a href="../352086/index.html">Full list of intrinsic functions in HotSpot in JDK 7, 8, 9 and 10</a></li>
<li><a href="../352090/index.html">Alan Kay: How I would teach Computer Science 101</a></li>
<li><a href="../352092/index.html">Sample code organization for a complex Angular project</a></li>
<li><a href="../352096/index.html">Windows clean WinAPI. Or just about the difficult</a></li>
<li><a href="../352098/index.html">What is the difference between product and product? Opinions of managers of Yandex services</a></li>
<li><a href="../352100/index.html">Wesbos tells how to use the new React Context API (subtitles)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>