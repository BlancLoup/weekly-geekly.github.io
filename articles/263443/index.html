<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internet Explorer 11 Bookmarklets: Storage Format, Limits and Silent Rules, Treacherous Bug</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After two bookmarklets that worked in Google Chrome and Firefox at once refused to work in Internet Explorer 11, and did not issue any error messages ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internet Explorer 11 Bookmarklets: Storage Format, Limits and Silent Rules, Treacherous Bug</h1><div class="post__text post__text-html js-mediator-article">  After two bookmarklets that worked in Google Chrome and Firefox at once refused to work in Internet Explorer 11, and did not issue any error messages to the console and showed no signs of life at all, I began to figure out what was wrong. <br><br>  At first I decided that it was a limit on the length of the URL, and thus on the length of the bookmarklet.  In IE 7, the limit was 2083 characters, in IE 11, according to experimenters' assurances, the limit was increased.  It was necessary to find out experimentally what the border is now. <br><br>  But first, a small preface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Google Chrome stores bookmarks in JSON, Firefox - in the sqlite database.  Therefore, the names of the bookmarks can be arbitrary.  IE stores each bookmark as a separate file, for example, in the% userprofile% \ Favorites \ Links folder.  Therefore, the browser will adjust the names of the bookmarks so that they fit the file system standards (replace question marks, for example).  Therefore, in IE, two bookmarks with the same name cannot be in the same folder, but they can be in Google Chrome and Firefox (bookmarks in them can even be without a name, only with a site icon or a standard substitute). <a name="habracut"></a><br><br>  Google Chrome and Firefox allow you to create a bookmark from scratch by entering the name and URL, including the bookmarklet code, into the appropriate fields.  At the same time, Google Chrome and Firefox remove newlines in the code, and with whitespace they do differently: the first partially deletes them, and partially leaves them as far as the syntax permits;  the second turns the whitespace characters into% 20 characters, as the functions encodeURI () and encodeURIComponent () do.  After creation, both browsers allow editing both regular bookmarks and bookmarklets. <br><br>  In IE, you can add a bookmarklet only by dragging the link to the Favorites panel.  Editing the code after creating a bookmark in the browser itself is no longer possible (it cannot even be viewed in the browser: only the beginning can be seen in the pop-up tip, and the call to the bookmark properties opens a window that does not contain a URL or code field).  But there is a workaround: you can edit the bookmark files in the folder mentioned. <br><br>  These files have the .url extension, and are identical in format to the .ini text files.  Here is an example of a simple saved bookmarklet file for IE 11. <br><br><pre>  [{000214A0-0000-0000-C000-000000000046}]
 Prop3 = 19.15
 [InternetShortcut]
 URL = javascript: (function () {alert ('Hello, world!');}) ()
 IDList =
 [Bookmarklet]
 ExtendedURL = javascript: (function () {alert ('Hello, world!');}) () </pre><br><br>  This template can be used as a template: if you replace both lines of code in it and save it with a valid file name in the folder, a new bookmarklet appears on the Favorites panel.  Thus it is necessary to take into account such a feature: IE reads bookmarks once during the opening of a window or tab.  If you edit the file, the window or tab will still operate on the old version.  If you close the window and re-open it or open a new tab, then file changes will take effect for them.  Therefore, there may be such a situation that clicking on the same tab in five different tabs may produce five different results if you edited a file before each tab opening.  The confusion is aggravated by the fact that IE saves running processes: you can close a tab, IE will leave the child process in memory and use it when opening another tab, and the legacy of the bookmarks read will go to this, not entirely new tab.  Therefore, when testing the code of bookmarklets and directly editing their files, either restart one window, or open new tabs without closing the previous ones (it will probably be easier to use the console). <br><br>  Now about the file format, or rather about the part of interest to us.  As we can see, the URL or bookmarklet code is stored in two duplicate keys.  But between them there is both a distinction and a relationship.  Experimentally, we managed to find out the following rules: <br><br>  1. <code>URL</code> key limit = <b>2083</b> characters.  Key limit <code>ExtendedURL</code> = <b>5119</b> characters. <br>  2. With a bookmarklet code of more than 2083 characters, IE <b>terminates the value of the <code>URL</code> key by</b> exactly 2083 characters, cutting off all remaining mechanically.  He obviously takes the working code only from the second key. <br>  3. With a bookmarklet code of more than 5119 characters, IE leaves 2057 characters in the <code>URL</code> key, and the <b>entire code in <code>ExtendedURL</code></b> .  When adding such a bookmark to Favorites, no <b>warnings</b> <b>are made to the</b> user, the bookmarklet then simply does not work, with unsuccessful launches there are no <b>error messages in the console either</b> . <br>  4. With a large code, the first <b>2083</b> characters of both keys must <b>match up to the character</b> .  If they differ by at least one sign, or if the first key is at least 2082 characters, the bookmarklet will not work. <br><br>  Having figured out these rules, I checked my broken bookmarklets for consistency.  There were no violations.  They were more than three thousand characters, all the format rules in the files were followed. <br><br>  It can be seen, it is necessary to check with different options and the size of the code, maybe there are still hidden rules, I thought.  Or there are uncatchable errors, and you need to insert <code>try-catch</code> .  In general, prepare for an unpredictable number of tests. <br><br>  And then I noticed that both files have a strange similarity in one strange detail.  In both, the URL key value ended in a space.  I wondered earlier why IE had inserted a space at the end of the line.  But, having looked narrowly, I understood that IE did not insert anything.  By a funny coincidence, both codes of my bookmarklets had a space on the 2083 character.  And it dawned on me how terrible, and so saving guess, which was immediately justified by trials.  I had to formulate another rule of bookmarklets for IE 11, which is actually a bug rather than a rule: <br><br>  5. If in the code of the bookmarklet in place of 2083 characters there is a <b>space</b> and, thus, the space will be the last character of the <code>URL</code> key, such bookmarklet will not work.  As with the listed violations of the rules, the user will not receive any preliminary warnings or subsequent error messages. <br><br>  From all this, at least two tips that create bookmarklets for IE 11 follow: <br><br>  - Check the character limit of 5119 characters. <br>  - Check the absence of a space on the 2083 character, or clean up spaces to the maximum, or encode javascript: URL using functions, or paste it from Firefox bookmarks. <br><br>  Finally, I will give an example of an .url file with a threshold size of keys for those who want to verify what is described: <br><br><div class="spoiler">  <b class="spoiler_title">test.url</b> <div class="spoiler_text"><pre> [{000214A0-0000-0000-C000-000000000046}]
 Prop3 = 19.15
 [InternetShortcut]
 URL = javascript: (function () {alert ( '123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456  789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456  789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123
 IDList =
 [Bookmarklet]
 ExtendedURL = javascript: (function () {alert ( '123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345678  9 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345678  9 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345678  9 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345678  9 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12345678  9 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 123456789 12 ');}) ()
</pre></div></div><br><br>  This is the workbook bookmarklet code.  It will stop working if you: <br><br>  - increase at least by a sign one of the keys or both keys (even by the same sign); <br>  - reduce the first key by at least one character; <br>  - replace at least one character in one of the keys without identically changing the same character in another key; <br>  - in place of 2083 characters in both keys, put a space (in the first key it is the last character, in the second key - one of the characters in the middle of the line). <br><br>  Written in the hope of saving someone time and health. <br><br>  If someone knows the site, where it makes sense to send a message about this questionable behavior (like <a href="https://bugzilla.mozilla.org/">bugzilla.mozilla.org</a> for Firefox or <a href="https://code.google.com/p/chromium/issues/list">code.google.com/p/chromium/issues/list</a> for Google Chrome), please let us know.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/263443/">https://habr.com/ru/post/263443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263429/index.html">Beeline automatically changes HTML tags</a></li>
<li><a href="../263431/index.html">Configure Ubiquiti Wi-Fi and Cisco (Guest DHCP and VLANs)</a></li>
<li><a href="../263433/index.html">Responsive Sites, or How to Get Google Favor</a></li>
<li><a href="../263435/index.html">OData REST API - minor tricks (part 3)</a></li>
<li><a href="../263441/index.html">Print service support in ReactOS - very soon</a></li>
<li><a href="../263445/index.html">TIS-100 - a puzzle about a multithreaded assembler that no one expected</a></li>
<li><a href="../263447/index.html">Nested Intervals and their implementation under Yii2</a></li>
<li><a href="../263449/index.html">IncrediBuild to check a large project with PVS-Studio</a></li>
<li><a href="../263451/index.html">Survey: What data to open the tax office?</a></li>
<li><a href="../263453/index.html">Creating a game on Blend4Web. Scene and surroundings</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>