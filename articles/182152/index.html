<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Perform transactions on the PCI bus. Implementation on VHDL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, I asked about the mechanism for polling PCI devices. After that I got a job, completed the test task, and I asked exactly about him, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Perform transactions on the PCI bus. Implementation on VHDL</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, I <a href="http://habrahabr.ru/qa/24168/">asked</a> about the mechanism for polling PCI devices.  After that I got a job, completed the test task, and I asked exactly about him, and safely forgot about him.  But recently they gave out a new project and had to remember everything, at the same time and decided to write here. <br><br>  There are quite a few transactions on the PCI bus; only the following will be described in this topic: <br><ul><li>  Configuration transactions </li><li>  I / O Transactions </li><li>  Memory accesses </li></ul><br><a name="habracut"></a><br>  When making transactions, there are 2 options: <br><ul><li>  When the master is the south bridge </li><li>  When the master device is a device connected to a PCI bus </li></ul><br>  As it already happened, when considering the PCI bus, I will call the master device a master (Master), the slave - a target (Target). <br>  This article deals only with transactions when the master is the south bridge, since transactions when the master is a device connected to the PCI bus deserves a separate article. <br><br>  And so, to work with the bus, we need the following signals: <br><pre><code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Port</span></span> ( clk : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; AD : <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); IDSEL : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; CBE : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); FRAME : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; IRDY : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; TRDY : <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; STOP : <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; PAR : <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; RST : <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; DEVSEL : <span class="hljs-keyword"><span class="hljs-keyword">inout</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> main;</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      clk (Clock) - provides synchronization of all transactions on a PCI, and is also an input for each PCI device. <br>  AD (Address and Data) - multiplexing address bus and data. <br>  IDSEL (Initialization Device Select) is a selection of an initialization device, used to select a chip during a read configuration and write transaction. <br>  CBE (Bus Command and Byte Enables) - bus commands and byte resolution. <br>  FRAME (Frame) - the signal is issued by the master at the beginning of the transaction and determines its duration.  For single-phase FRAME transactions, one cycle always lasts.  In multiphase transactions, FRAME is removed one cycle before the completion of the transaction. <br>  IRDY (Initiator Ready) - a signal of readiness of the master.  It indicates that the wizard is ready to complete the current data phase. <br>  TRDY (Target Ready) - a target readiness signal indicating that the target is ready to complete the current data phase. <br>  STOP (Stop) - this signal is given by the target, if it wants to stop the current transaction. <br>  PAR (Parity) - parity control on lines AD and CBE. <br>  RST (Reset) - a reset signal.  It is asynchronous. <br>  DEVSEL (Device Select) - the device selection signal. <br><br>  Before you start working with any device, you need to initialize it.  Therefore, we consider the features of the configuration transactions. <br><br><h4>  Configuration transactions.  General information. </h4><br><div class="spoiler">  <b class="spoiler_title">View of the configuration transactions from the OS</b> <div class="spoiler_text">  To generate PCI configuration transactions on a PC, calls are made to two I / O ports named CONFIG_ADDRESS and CONFIG_DATA, which have addresses 0CF8h and 0CFCh, respectively, and are part of the Host ‚Äì PCI bridge, through which the PCI bus is directly or indirectly connected to the processor. <br>  The CONFIG_ADDRESS port has a double word size and is available only as a single unit.  Smaller calls to the addresses belonging to it are sent to the PCI bus as normal I / O transactions.  This port is read / write and has the following format: <br><img src="https://habrastorage.org/storage2/3df/165/f45/3df165f453d449433922a105a7c8e140.gif"><br>  When it is necessary to perform a configuration transaction, this port records the address of the PCI configuration space register, consisting of bus numbers (bits 23‚Äì16), device (15‚Äì11), functions (10‚Äì8), and the register itself (7‚Äì2).  Bits 1 and 0 must always contain zeros, and the high bit must contain one, thereby allowing the execution of a configuration transaction.  Digits 30-24 are reserved and must contain zeros. <br><br>  The actual generation of the configuration transaction occurs when the CONFIG_DATA port is read or written, when the address with the high bit set and the bus number corresponding to the bus connected to the Host ‚Äì PCI bridge, or any PCI bus lying below this bus and connected to it through was written to CONFIG_ADDRESS One or several PCI ‚Äì PCI bridges (the admissible range of bus numbers is set to the Host ‚Äì PCI bridge during its configuration).  Access to the CONFIG_DATA port must be equal to the size of the configuration register being read or written, whose address is in the CONFIG_ADDRESS. <br>  If the bus number specified in CONFIG_ADDRESS coincides with the bus number connected directly to the Host ‚Äì PCI bridge, a configuration transaction is generated with the address of type 0, and the device number in bits 15‚Äì11 of the CONFIG_ADDRESS port is used to issue one of the IDSEL signals, which are used to select a specific device.  In addition, the decoded device number (one one and the remaining zero bits) in the address phase of the configuration transaction is transmitted in address bits 31-11. <br>  If the address in CONFIG_ADDRESS indicates the wrong bus that is directly connected to the Host ‚Äì PCI bridge, the latter generates a configuration transaction with a type 1 address. It will be processed by the PCI ‚Äì PCI bridge, which recognizes the bus number in the address.  This bridge will either perform a configuration transaction with a type 0 address (if the addressed device is connected to a bus directly connected to this bridge), or it will generate a transaction with a type 1 address, thereby ensuring its passage through the next bridge.  The length of this chain is theoretically limited only by the width of the field reserved for the bus number (8 bits). <br><br>  If during the transaction it turns out that the addressable configuration register does not exist (the number of a nonexistent bus, device, function, or register is specified), the write operation will not take any action, and the read operation will return a value to the processor containing the units in each digit <br><img src="https://habrastorage.org/storage2/29e/e98/13f/29ee9813f072224ed3359b4591ae65b4.png"><br>  The address format for a type 1 transaction. <br><img src="https://habrastorage.org/storage2/d37/ed6/7c5/d37ed67c5c8c0e4f08912c9854d025cc.png"><br>  The address format for a transaction of type 0. <br></div></div><br>  Format of the configuration register: <br><img src="https://habrastorage.org/storage2/917/c11/e54/917c11e54860236010590141f463c6b9.png"><br>  The minimum set of registers: <br><ul><li>  Vendor ID - field identifies the manufacturer of the device.  It is forbidden to use the value 0xFFFF. </li><li>  Device ID - the field identifies the specific type of device.  It is forbidden to use the value 0xFFFF. </li><li>  Revision ID - addition to the device ID.  May be zero. </li><li>  Header Type - For multifunction devices.  If the 7th bit is 0, then the device is single-function, otherwise - multifunctional. </li><li>  Class Code is read only.  Used to identify the overall functionality of the device.  The high byte (address 0Bh) defines the base class, the middle one is a subclass, the low one is the program interface (if it is standardized). </li><li>  Subsystem ID, Subsystem Vendor ID - set by the manufacturer.  Only for reading.  Store identifiers to accurately identify cards and devices (can be installed in the system <br>  multiple cards with matching device and manufacturer IDs (Device ID and Vendor ID). </li><li>  BAR0 - BAR5 - describe areas of memory and I / O ports. </li></ul><br>  For memory areas and port descriptions are different: <br><ul><li>  Bit 0 = 0 - a sign of memory.  No larger than 2 GB </li><li>  Bit 0 = 1 - a sign of the port area.  Up to 256 bytes. </li></ul><br>  The size of the areas is calculated as follows.  0xFFFFFFFF is written to the BAR.  Further, the value is read from BAR, and subtracted from 0xFFFFFFFF.  The result is the size of the area.  The unit in the low bit is not counted. <br><br><h4>  General transaction execution algorithm </h4><br>  The master sets the device address on the AD bus, the command to be executed on the CBE bus, sets the FRAME signal to 0 and the IRDY signal to 0. Next, the master waits from the target ‚Äî setting it to TRDY and DEVSEL signals.  Also, the target puts the requested data onto the AD bus.  Data is considered valid when IRDY, TRDY and DEVSEL are equal to the logical zero level. <br><br><h4>  Implementation </h4><br>  To access the FPGA outputs, special components are required: I / O buffers for working with the Z-state. <br>  So, for the AD bus, the connection will look like this: <br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> AD_I: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span> (AD<span class="hljs-symbol"><span class="hljs-symbol">'range</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> AD_O: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span> (AD<span class="hljs-symbol"><span class="hljs-symbol">'range</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> AD_T: <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; AD_BUF: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> iCount <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> AD<span class="hljs-symbol"><span class="hljs-symbol">'low</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> AD<span class="hljs-symbol"><span class="hljs-symbol">'high</span></span> <span class="hljs-keyword"><span class="hljs-keyword">generate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> IOBUF_AD : IOBUF <span class="hljs-keyword"><span class="hljs-keyword">generic</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> ( DRIVE =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>, IOSTANDARD =&gt; <span class="hljs-string"><span class="hljs-string">"PCI33_3"</span></span>, SLEW =&gt; <span class="hljs-string"><span class="hljs-string">"SLOW"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> ( O =&gt; AD_I(iCount), IO =&gt; AD(iCount), I =&gt; AD_O(iCount), T =&gt; AD_T ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">generate</span></span>;</code> </pre><br>  Where, <br><ul><li>  O - output buffer. </li><li>  IO - input / output buffer, directly connected to the output of the FPGA. </li><li>  I - output buffer. </li><li>  T - input control, unit level - input, zero level - output. </li></ul><br>  For the rest of the signals in the same way, I will not quote, so as not to overload the article. <br><br>  As I wrote above, at the beginning of a transaction, when the address is set on the AD bus, the FRAME signal is always zero.  Below is the code that generates the AdrPhASE signal, during which you need to latch the address bus and the command bus for subsequent work.  In fact, the AdrPhASE signal is nothing more than the selection of the falling edge of the FRAME signal, which uniquely identifies the beginning of the transaction. <br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> AdrPhASE: <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> FRAME_D: <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> Addres: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(AD_I<span class="hljs-symbol"><span class="hljs-symbol">'range</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> Command: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(CBE<span class="hljs-symbol"><span class="hljs-symbol">'range</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> bCfgTr: <span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">process</span></span> (clk_i, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FRAME_D &lt;= <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FRAME_D &lt;= FRAME_I <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>; AdrPhASE &lt;= <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> FRAME_I <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> FRAME_D; <span class="hljs-keyword"><span class="hljs-keyword">process</span></span> (clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Address &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; Command &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; bCfgTr &lt;= <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AdrPhASE = <span class="hljs-string"><span class="hljs-string">'1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Address &lt;= AD_I <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; Command &lt;= CBE_I <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; bCfgTr &lt;= (IDSEL_I = <span class="hljs-string"><span class="hljs-string">'1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre><br>  Further, the operation of the entire device can be described using an automaton. <br><div class="spoiler">  <b class="spoiler_title">Automatic code</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TSM_PCI_T <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> (sIDLE, sDECODE, sCFG_READ, sCFG_WRITE, sIO_READ, sIO_WRITE, sMEM_READ, sMEM_WRITE); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> smPCI_T: TSM_PCI_T; <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (smPCI_T) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sIDLE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AdrPhASE = <span class="hljs-string"><span class="hljs-string">'1'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sDECODE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sDECODE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bCfgTr <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Address(<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) = b<span class="hljs-string"><span class="hljs-string">"000"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Command(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) = b<span class="hljs-string"><span class="hljs-string">"101"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Command(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sCFG_READ <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> smPCI_T &lt;= sCFG_WRITE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (Command(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)= b<span class="hljs-string"><span class="hljs-string">"001"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (Addres(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) = BAR0(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>))<span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Command(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIO_READ <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> smPCI_T &lt;= sIO_WRITE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (Command(<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) = b<span class="hljs-string"><span class="hljs-string">"011"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (Addres(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) = BAR1(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Command(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sMEM_READ <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> smPCI_T &lt;= sMEM_WRITE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sCFG_READ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IRDY_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sCFG_WRITE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IRDY_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sIO_WRITE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IRDY_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sIO_READ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IRDY_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sMEM_READ =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IRDY_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> sMEM_WRITE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IRDY_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; smPCI_T &lt;= sIDLE <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> </div></div><br>  To understand the above written, I will give the possible commands transmitted via the CBE bus. <br><ul><li>  0010 I / O Read </li><li>  0011 I / O Write </li><li>  0110 Memory Read </li><li>  0111 Memory Write </li><li>  1010 Configuration Read </li><li>  1011 Configuration Write </li></ul><br>  Each team has its own state machine.  Switching to it depends on the current state of the CBE bus and the AD bus for accessing memory and I / O ports.  The exit to the initial state is performed by the arrival of the IRDY signal from the master. <br><br><h5>  Read configuration </h5><br>  As described above, the device uses type 0 transactions for processing by the device. Since the device is one-function, the function number is 000, which are checked in the control machine.  Depending on the register number (bits 7..0 of the AD bus), the required register is sent to the AD bus, as shown in the figure above. <br><div class="spoiler">  <b class="spoiler_title">Configuration read code</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> CfgRData: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>):=x<span class="hljs-string"><span class="hljs-string">"00000000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> CommandReg: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := x<span class="hljs-string"><span class="hljs-string">"0000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> StatusReg: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := x<span class="hljs-string"><span class="hljs-string">"0200"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> LatencyTimer: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := x<span class="hljs-string"><span class="hljs-string">"00"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> CacheLineSize: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := x<span class="hljs-string"><span class="hljs-string">"00"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> BAR0: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := x<span class="hljs-string"><span class="hljs-string">"00000001"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> BAR1: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) := x<span class="hljs-string"><span class="hljs-string">"00000000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> InterruptLine: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">process</span></span> (clk_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (Address(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"00"</span></span> =&gt; CfgRData &lt;= x<span class="hljs-string"><span class="hljs-string">"00017788"</span></span> ; <span class="hljs-comment"><span class="hljs-comment">--Device ID and Vendor ID when x"04" =&gt; CfgRData &lt;= StatusReg &amp; CommandReg; --Status Register, Command Register when x"08" =&gt; CfgRData &lt;= x"10000001"; -- Class Code and Revision ID when x"0C" =&gt; CfgRData &lt;= x"0000" &amp; LatencyTimer &amp; CacheLineSize; -- BIST, Header Type(bit 7 = 0, single, bits 6-0 = 0, type0), Latency Timer(for masters), Cache Line Size (bit 2 in 1) when x"10" =&gt; CfgRData &lt;= BAR0; -- Base Adress 0 (Register IO address decoder) when x"14" =&gt; CfgRData &lt;= BAR1; -- Base Adress 1 when x"28" =&gt; CfgRData &lt;= x"00000000"; -- CarfdBus CIS Pointer when x"2C" =&gt; CfgRData &lt;= x"00017788"; -- Subsystem ID, Subsystem Vendor ID when x"30" =&gt; CfgRData &lt;= x"00000000"; -- Expanxion Rom Base Address when x"34" =&gt; CfgRData &lt;= x"00000000"; -- Reserved, Capabilitis Pointer when x"38" =&gt; CfgRData &lt;= x"00000000"; -- Reserved when x"3C" =&gt; CfgRData &lt;= x"004001" &amp; InterruptLine; -- Max_Lat(only bus master), Min_Gnt, Interrupt Pin, Interrupt Line when others =&gt; CfgRData &lt;= (others =&gt; '0'); end case; end if; end process;</span></span></code> </pre> </div></div><br>  This is how the configuration reads in the simulator: <br> <a href=""><img src="//habrastorage.org/files/535/c20/a0a/535c20a0ace943c5ab5e73d1a3123054.jpg"></a> <br><br><h5>  Configuration record </h5><br>  On the AD bus, the master sets the address of the register to be written, and in the next cycle, the data to be recorded is set.  In BAR0, bits 7..0 are read-only, in BAR1, bits 15..0 are read-only.  Therefore, 256 I / O addresses, 4 294 967 296 memory addresses. <br><div class="spoiler">  <b class="spoiler_title">Configuration Write Code</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">then</span></span> CommandReg &lt;= x<span class="hljs-string"><span class="hljs-string">"0000"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; StatusReg &lt;= x<span class="hljs-string"><span class="hljs-string">"0200"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; LatencyTimer &lt;= x<span class="hljs-string"><span class="hljs-string">"00"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; CacheLineSize &lt;= x<span class="hljs-string"><span class="hljs-string">"00"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; BAR0 &lt;= x<span class="hljs-string"><span class="hljs-string">"00000001"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; BAR1 &lt;= x<span class="hljs-string"><span class="hljs-string">"00000000"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span>(rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smPCI_T = sCFG_WRITE) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>(Address(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"04"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> CommandReg(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> CommandReg(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"0C"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> LatencyTimer &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> CacheLineSize &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"10"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">3</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> BAR0(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">2</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> BAR0(<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> BAR0(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"14"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">3</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> BAR1(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">2</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> BAR1(<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"3C"</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> InterruptLine &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> </div></div><br><br><h5>  Port Record </h5><br>  On the AD bus, the master sets the register number for recording; in the next cycle, the data to be recorded is set. <br>  We give an example for recording only one register, the rest are written in a similar way. <br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> IOReg0: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span> (<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>(clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> IOReg0 &lt;= x<span class="hljs-string"><span class="hljs-string">"00000000"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smPCI_T = sIO_WRITE <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Address(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) = x<span class="hljs-string"><span class="hljs-string">"00"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> IOReg0( <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;= AD_I( <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> IOReg0(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">2</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> IOReg0(<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CBE_I(<span class="hljs-number"><span class="hljs-number">3</span></span>) = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> IOReg0(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) &lt;= AD_I(<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre><br><h5>  Port reading </h5><br>  On the AD bus, the master sets the register number to be read.  The device then sends the requested data to the AD bus. <br><div class="spoiler">  <b class="spoiler_title">Read port code</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> IORDate: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span> (<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">process</span></span> (clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> IORDate &lt;= x<span class="hljs-string"><span class="hljs-string">"00000000"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (Address(<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"00"</span></span> =&gt; IORDate &lt;= IOReg0 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"04"</span></span> =&gt; IORDate &lt;= IOReg1 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"08"</span></span> =&gt; IORDate &lt;= IOReg2 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"0C"</span></span> =&gt; IORDate &lt;= IOReg3 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"10"</span></span> =&gt; IORDate &lt;= IOReg4 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"14"</span></span> =&gt; IORDate &lt;= IOReg5 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"18"</span></span> =&gt; IORDate &lt;= IOReg6 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"1C"</span></span> =&gt; IORDate &lt;= IOReg7 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"20"</span></span> =&gt; IORDate &lt;= IOReg8 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> x<span class="hljs-string"><span class="hljs-string">"24"</span></span> =&gt; IORDate &lt;= IOReg9 <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; IORDate &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre> </div></div><br>  This is what the I / O port reads and writes: <br> <a href=""><img src="//habrastorage.org/files/091/644/4f9/0916444f985142bc83236ca2b39877d9.jpg"></a> <br><br><h5>  Write and read memory </h5><br>  On the AD bus, the master sets the address to which the data is to be written, and in the next cycle the data itself.  When reading on the AD bus, the master sets the address for reading, then the target itself sets the data on the AD bus. <br>  Data is written in RAM to port A, read from port B. <br><div class="spoiler">  <b class="spoiler_title">Memory access code</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> RamWrEn: <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> RamOutputDate: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span> (<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> RamInputDate: <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span> (<span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">signal</span></span> RamRst: <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span> := <span class="hljs-string"><span class="hljs-string">'0'</span></span>; RAMB16_S36_S36_inst : RAMB16_S36_S36 <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> ( DOA =&gt; <span class="hljs-keyword"><span class="hljs-keyword">open</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- Port A 32-bit Data Output DOB =&gt; RamOutputDate, -- Port B 32-bit Data Output DOPA =&gt; open, -- Port A 4-bit Parity Output DOPB =&gt; open, -- Port B 4-bit Parity Output ADDRA =&gt; Address(8 downto 0), -- Port A 9-bit Address Input ADDRB =&gt; Address(8 downto 0), -- Port B 9-bit Address Input CLKA =&gt; clk_I, -- Port A Clock CLKB =&gt; clk_I, -- Port B Clock DIA =&gt; RamInputDate, -- Port A 32-bit Data Input DIB =&gt; x"00000000", -- Port B 32-bit Data Input DIPA =&gt; x"0", -- Port A 4-bit parity Input DIPB =&gt; x"0", -- Port-B 4-bit parity Input ENA =&gt; '1', -- Port A RAM Enable Input ENB =&gt; '1', -- PortB RAM Enable Input SSRA =&gt; '0', -- Port A Synchronous Set/Reset Input SSRB =&gt; '0', -- Port B Synchronous Set/Reset Input WEA =&gt; RamWrEn, -- Port A Write Enable Input WEB =&gt; '0' -- Port B Write Enable Input ); process(clk_I) begin if (rising_edge(clk_I)) then if (RST_I = '1') then RamRst &lt;= '0'; else RamRst &lt;= '1'; end if; end if; end process; process(clk_I, RST_I) begin if(RST_I = '0') then RamInputDate &lt;= (others =&gt; '0') after cTCQ; RamWrEn &lt;= '0' after cTCQ; elsif (rising_edge(clk_I)) then if (smPCI_T = sMEM_WRITE) then if (CBE_I(0) = '0') then RamInputDate(7 downto 0) &lt;= AD_I( 7 downto 0) after cTCQ; end if; if (CBE_I(1) = '0') then RamInputDate(15 downto 8) &lt;= AD_I(15 downto 8) after cTCQ; end if; if (CBE_I(2) = '0') then RamInputDate(23 downto 16) &lt;= AD_I(23 downto 16) after cTCQ; end if; if (CBE_I(3) = '0') then RamInputDate(31 downto 24) &lt;= AD_I(31 downto 24) after cTCQ; end if; RamWrEn &lt;= '1' after cTCQ; else RamWrEn &lt;= '0' after cTCQ; end if; end if; end process;</span></span></code> </pre> </div></div><br>  It looks like the recording and reading of memory in the simulator: <br> <a href=""><img src="//habrastorage.org/files/fb5/ce9/a50/fb5ce9a50ed9411496be52cefaebb3b2.jpg"></a> <br><br>  Data on the AD bus is displayed as follows.  Depending on the state of the machine, the corresponding register is connected to the output buffer. <br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">process</span></span> (clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AD_O &lt;= (<span class="hljs-keyword"><span class="hljs-keyword">others</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (smPCI_T = sCFG_READ) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AD_O &lt;= CfgRData <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (smPCI_T = sIO_READ) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AD_O &lt;= IORDate <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (smPCI_T = sMEM_READ) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AD_O &lt;= RamOutputDate <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre><br>  The data enable signal to the AD bus is formed as follows: <br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">process</span></span> (clk_I, RST_I) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RST_I = <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AD_T &lt;= <span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">elsif</span></span> (rising_edge(clk_I)) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AD_T &lt;= <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> b2l(smPCI_T = sCFG_READ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> smPCI_T = sIO_READ <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> smPCI_T = sMEM_READ) <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> cTCQ; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>;</code> </pre><br><br>  Separately, I would like to add about the component STS for example signal generation DEVSEL <br><pre> <code class="vhdl hljs">DEVSEL_STS : <span class="hljs-keyword"><span class="hljs-keyword">entity</span></span> WORK.componentIO(Behavioral) <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> (iD =&gt; DEVSEL_O, oT =&gt; DEVSEL_T, clk =&gt; clk_I, rst =&gt; RST_I)</code> </pre><br>  Since the active levels of control signals are equal to zero, in order to go to Z - state and release the line you need to first give the level of a logical unit and then transfer to the Z - state. <br><br><h4>  Conclusion </h4><br>  In conclusion, I want to say that the execution of transactions on the PCI bus is not as difficult as it seems.  Designed firmware was embedded in FPGA.  The board with FPGA is inserted into the PCI slot and the computer was turned on.  The system found a board and requested drivers for it. <br> <a href=""><img src="//habrastorage.org/files/9a7/1e9/994/9a71e9994b954bc19a2023678dbc8b19.jpg"></a> <br> <a href=""><img src="//habrastorage.org/files/3aa/6fd/6f2/3aa6fd6f2c4849938cbfc8070b0a30b6.jpg"></a> <br>  Works!  :) <br><br>  The project itself is <a href="https://drive.google.com/file/d/0B-i4aT8Q0ZNxc1VkV3J2b0dTRlU/view%3Fusp%3Dsharing">drive.google.com/file/d/0B-i4aT8Q0ZNxc1VkV3J2b0dTRlU/view?usp=sharing</a> .  Open xilinx ise 14.2. </div><p>Source: <a href="https://habr.com/ru/post/182152/">https://habr.com/ru/post/182152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182142/index.html">The beauty and power of the Qt Graphics View Framework by example</a></li>
<li><a href="../182144/index.html">Disaster recovery: Network sandbox based on vSphere and Hyper-V in Veeam Backup & Replication v7</a></li>
<li><a href="../182146/index.html">Justify Grid - a new word in the markup</a></li>
<li><a href="../182148/index.html">DevConf 2013 June 14th - the PHP section program is published, the PHP author will tell you about PHP acceleration 6 times</a></li>
<li><a href="../182150/index.html">The FSB Public Council proposes banning Tor and anonymizing sites, bringing their creators to justice.</a></li>
<li><a href="../182154/index.html">Determination of IP-address in Skype</a></li>
<li><a href="../182160/index.html">Step-by-step: SpecFlow setting for a Russian-language project when writing tests in the .Net environment</a></li>
<li><a href="../182162/index.html">Quadcopter for the evening not counting the delivery</a></li>
<li><a href="../182164/index.html">Dryad. Distributed Computing Framework</a></li>
<li><a href="../182166/index.html">Forwarding ports in Mikrotik - educational program for beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>