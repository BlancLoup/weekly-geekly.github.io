<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Change program settings while maintaining personal settings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 In one medical organization, they implemented solutions based on Orthanc PACS servers and Radiant DICOM clients. During the setup, we fou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Change program settings while maintaining personal settings</h1><div class="post__text post__text-html js-mediator-article"><h2>  Prehistory </h2><br>  In one medical organization, they implemented solutions based on Orthanc PACS servers and Radiant DICOM clients.  During the setup, we found out that each DICOM client should be described in PACS servers as follows: <br><br><ul><li>  Customer name </li><li>  AE name (must be unique) </li><li>  TCP port that opens automatically on the client side and receives DICOM surveys from the PACS server (i.e., the server pushes them towards the client ‚Äî initiating the connection first) </li><li>  IP address </li></ul><br>  After setting up Radiant, the clients received the following information to think about - for each client, setting up software with the above parameters resulted in filling out the <b>pacs.xml</b> file, which was located in the user profile (path: <b>% APPDATA% \ RadiantViewer \ pacs.xml</b> ).  At the same time, the configuration of one client differed from the other by at least two parameters (the AE-name is different for everyone, and the port is basically the same, except for terminal clients running on the same server - there, too, ports had to be assigned different). <br><br>  Example of the pacs.xml file at the <a href="https://drive.google.com/open%3Fid%3D1yd5q77gKRafZ2rvp6TWy-k1BKQrbrg6f">link</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For about half a year everything was fine, the system started working ... and then the " <b>pitfalls</b> " reached us: <br><br><ul><li>  We need to put into operation several new PACS servers that will replace the old ones (where the disk space has run out).  PACS server in virtual machines, but it's not about that; </li><li>  We need to somehow centrally change the unique configurations (with two different parameters) on 200 machines (their number regularly increased); </li><li>  Considering the growth rate of survey volumes, the solution needs not a one-time, but a replicable and regular solution (for example, 1 time in 3-5 months). </li></ul><br>  Solution below. <br><a name="habracut"></a><br><h2>  The choice of tools for solving the problem </h2><br>  Initially, there were attempts to find some solution that, on the client side, modified the pacs.xml file and made changes to the list of PACS servers without affecting the settings of the AE name and TCP port.  Windows clients at that time were based on both Windows XP and Windows 7 - so there were attempts to write something based on VBScript.  But alas, it was impossible to master such a task, due to the complete lack of experience in writing something complex and complex in this language.  Attempts to find and rewrite were also unsuccessful (it should be noted that there was already another plan in my head, so I didn‚Äôt bother with VBScript for more than 3-4 hours). <br><br>  As a result, I settled on the following solution: <br><br><ul><li>  Grouping all pacs.xml files in one place on any server in a network resource; </li><li>  Edit files in bulk (the experience of solving such problems has already been - using Perl); </li><li>  Also use group policies to update client settings. </li></ul><br><h3>  Collecting Files Using Group Policy </h3><br>  The simplest part is that when a client enters his profile, he, with his rights, executes a certain .bat file, in which it is written: <br><br><pre><code class="vbscript hljs">echo off <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy %APPDATA%\RadiantViewer\pacs.xml \\srv.test.local\pconfigs$\pacs-%COMPUTERNAME%-%USERNAME%.xml</code> </pre> <br>  Thus, on the server in a hidden resource, pacs.xml files will be accumulated, in the name of which there is information from which computer and from which user the given config was copied. <br><br>  The most difficult thing was to wait for all users to complete this policy. <br><br><h3>  Configuration changes using the Perl script </h3><br>  We will need <a href="https://www.activestate.com/products/activeperl/downloads/">Active Pertate</a> under Windows from ActiveState, as well as the XML :: Writer module, which can be installed using the <b>ppm install XML-Writer</b> command. <br><br>  The script itself turned out pretty simple: <br><br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> XML::Writer; <span class="hljs-comment"><span class="hljs-comment">#    ,   ( ): $report_dir = "C:\\Perl64\\WORK\\PACS-xml3\\"; opendir(DIR, "$report_dir") or die "     !"; @report_files = readdir DIR; shift (@report_files); #      (.) shift (@report_files); #       (..) # print "@report_files"; closedir(DIR); #    -    .    AET     . foreach $analiz_file (@report_files) { $full_path_to_file="C:\\Perl64\\WORK\\PACS-xml3\\".$analiz_file; open (INFO, $full_path_to_file); while ($line = &lt;INFO&gt;) { #  $aet  $port      XML : my ($other1, $aet, $other2, $port, $other3) = split /\"/, $line, 5; #    listener -           XML: if ($other1 =~ 'listener') { #   XML c    : my $writer = XML::Writer-&gt;new(OUTPUT =&gt; 'self', DATA_MODE =&gt; 1, DATA_INDENT =&gt; 2, ); $writer-&gt;xmlDecl('utf-8'); $writer-&gt;startTag('pacs'); $writer-&gt;startTag('listener', ae =&gt; $aet, port =&gt; $port); $writer-&gt;endTag(); $writer-&gt;startTag('hosts'); $writer-&gt;startTag('host', name =&gt; 'MRT', ae =&gt; 'ORTHANC', ip =&gt; 'XX.YY.214.17', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'KT', ae =&gt; 'ORTHANC2', ip =&gt; 'XX.YY.215.253', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'R', ae =&gt; 'ORTHANC3', ip =&gt; 'XX.YY.215.252', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'KT-20180501-20180831', ae =&gt; 'ORTHANC4', ip =&gt; 'XX.YY.215.251', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;startTag('host', name =&gt; 'KT-20180901-20181130', ae =&gt; 'ORTHANC5', ip =&gt; 'XX.YY.215.250', ts =&gt; '1.2.840.10008.1.2.1', port =&gt; '4242', maxassoc =&gt; '1', allpres =&gt; '0', search =&gt; '1', protocol =&gt; '1', searchcharset =&gt; '', wildcards =&gt; '3', carets =&gt; '0'); $writer-&gt;endTag(); $writer-&gt;endTag('hosts'); $writer-&gt;startTag('presets'); $writer-&gt;endTag(); $writer-&gt;startTag('lastsearch', dt =&gt; '4', mfid =&gt; '1048592'); $writer-&gt;endTag(); $writer-&gt;endTag('pacs'); #   XML  : my $xml = $writer-&gt;end(); #    : $rewritexml = $full_path_to_file; #  XML   : open (NEWXML, "&gt;$rewritexml"); print NEWXML $xml; close (NEWXML); } } }</span></span></code> </pre><br>  The principle of its work: <br><br><ul><li>  Open the directory in which we have collected pacs.xml configurations from clients and put the list of files into an array of scalars (@report_files); </li><li>  In the loop, we process one file at a time and read it line by line; </li><li>  Using split, we split each line into 5 parts, using quotes as a separator; </li><li>  We find a line with the word listener and put in two variables the data unique for each file (AE-name of the client and TCP port number); </li><li>  After that, we simply create a new XML file, enter unique parameters into it, and then insert the required number of PACS servers with their parameters ‚Äî <b>that is,</b>  <b>for the sake of which everything was started</b> ) </li><li>  Rewrite new XML file over old one. </li></ul><br>  It should be noted that in fact I use this script not completely automatically - in fact, I copy the collected configs into a separate directory and then launching the script change them all together.  Then a random check - and configs can be poured back into the machines. <br><br><h3>  Distribute changed pacs.xml files to clients </h3><br>  The simplest thing that came to mind was to make changes to the already working .bat file that collects configurations from clients and add a line: <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy /Y \\srv.test.local\pconfigsnew$\pacs-%COMPUTERNAME%-%USERNAME%.xml %APPDATA%\RadiantViewer\pacs.xml</code> </pre><br>  The resulting .bat file looks like this: <br><br><pre> <code class="vbscript hljs">@echo off <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy %APPDATA%\RadiantViewer\pacs.xml \\srv.test.local\pconfigs$\pacs-%COMPUTERNAME%-%USERNAME%.xml <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> exist %APPDATA%\RadiantViewer\pacs.xml copy /Y \\srv.test.local\pconfigsnew$\pacs-%COMPUTERNAME%-%USERNAME%.xml %APPDATA%\RadiantViewer\pacs.xml</code> </pre><br><h3>  Conclusion </h3><br>  Such a ‚Äú <b>knee-length</b> ‚Äù solution.  We tried it twice already (in September 2018 and in February 2019), while the flight is normal.  Of course, not 100% of clients update, but close to this value - the rest is completed remotely.  Script on the <a href="https://drive.google.com/open%3Fid%3D1z4aPdZoIxE3DOk9LxfPCg44H20wPH12q">link</a> . </div><p>Source: <a href="https://habr.com/ru/post/448270/">https://habr.com/ru/post/448270/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448258/index.html">Modular industrial monitors Advantech FPM-7002</a></li>
<li><a href="../448262/index.html">How to play Speedgate, the first sport created by AI</a></li>
<li><a href="../448264/index.html">Lipids cold uneasy: preventing the crystallization of water at -263 ¬∞ C</a></li>
<li><a href="../448266/index.html">Phoned! How to build your Web-dialer for an hour</a></li>
<li><a href="../448268/index.html">Box Telephone Systems</a></li>
<li><a href="../448274/index.html">SMS monitoring of the weight of three hives for $ 35</a></li>
<li><a href="../448276/index.html">How Alfa-Bank lives during the period of changes and what we managed to do when combining IT development and Alfa-Lab</a></li>
<li><a href="../448278/index.html">Technical mortgage: what and to whom should timlid</a></li>
<li><a href="../448280/index.html">Test drive nanoCAD SPDS Metal structures 1.2. Part 2</a></li>
<li><a href="../448286/index.html">News from the world of OpenStreetMap ‚Ññ455 (04/02/2019-08.04.2019)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>