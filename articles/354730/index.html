<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We reanimate the Nintendo Switch and PlayStation gaming service after locks on the RKN</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day readers. 

 This is my first article in many years of reading Habr, so please "understand and forgive." 

 In it, I want to share how to try ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We reanimate the Nintendo Switch and PlayStation gaming service after locks on the RKN</h1><div class="post__text post__text-html js-mediator-article">  Good day readers. <br><br>  This is my first article in many years of reading Habr, so please "understand and forgive." <br><br>  In it, I want to share how to try to bring to life the game services, whose addresses are blocked by the RKN in the <s>agony of</s> attempts to ban Telegram. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In my case, it was the Nintendo Switch, but I suppose the PSN service (and others too) is unlocked in the same way.  I just got lucky and PSN worked initially.  In any case, I have a PlayStation and I can investigate the problem and write a separate post on this topic. <br><br>  Running straight to the end - in my case, with Nintendo, it worked out. <br><a name="habracut"></a><br>  If you are too lazy to read a lot of letters, then the recipe: drive a foreign DNS from another continent, for example, <a href="https://public-dns.info/nameserver/us.html">from here</a> .  It did not work - we take the following.  I want consistency - read on. <br><br>  Now another spoiler for the advanced, who only need <s>to read the</s> essence of <s>laziness</s> : <br>  The domain names to which the prefix is ‚Äã‚Äãaddressed contain more than one ip address and the final backends of Nintendo services are located in geo-distributed data centers (this can be seen in the pictures below).  By dns request you are given some kind of address and one, but you can always find out the full list of all ip addresses. <br><br>  Thus, in the general case, the following <s>crutch is</s> obtained for the reanimation algorithm for an advanced audience: <br><br><ol><li>  We learn the domain names and ip addresses where the prefix climbs in a non-working case. </li><li>  We check these ip addresses for blocking RKN. </li><li>  Find out all the ip addresses related to the domain name, where there is a problem. </li><li>  ‚ÄúWe nail‚Äù working addresses in DNS-e, to which the prefix will address. </li></ol><br>  <b>Now in more detail</b> <br><br>  <b>1. We learn the domain names and ip addresses where the prefix climbs in a non-working case.</b> <br><br>  To do this, we need to turn on the console through the laptop so that we can analyze the traffic coming from it. <br><br>  The set we need for this is the following: <br><br><ul><li>  Prefix Nintendo Switch connected via wifi to the laptop. </li><li>  A laptop with a traffic analyzer installed (for example, Wireshark), with WiFi turned on in HotSpot mode.  Uplink via Ethernet laptop connected to a home router that distributes the Internet.  ICS (in the case of Windows), Internet sharing (in the case of Mac OS), iptables (in the case of Linux) are configured on the laptop. </li><li>  Router, distributing Internet. </li></ul><br>  <b>1.1</b> It is advisable to turn on and turn off the console, before starting to analyze the inactive service.  This is necessary in order to securely catch DNS requests from it. <br><br>  <b>1.2</b> Turn on the prefix (Power on), start the traffic analyzer to listen to the WiFi port. <br><br>  <b>1.3 We</b> connect the prefix via WiFi and play back the non-working case (in my case it was a connection status check). <br><br>  <b>1.4</b> We reach the end point of the case or error.  We stop the analyzer. <br><br>  <b>1.5</b> We need to see the captured DNS requests.  We drive the word dns into the filter of the traffic analyzer and rewrite the domain names that appear in the query packets (dns query) into the table, we will need them later.  We map domain names in the ip table of addresses that come from the dns server (dns response packets).  As a result, we get a table, dns - ip. <br><br><img src="https://habrastorage.org/webt/hm/gf/23/hmgf23a25mrxg9z2ecmxtj7bf38.png"><br><br>  <i>DNS address, IP address</i> <i><br></i>  <i>aauth-lp1.ndas.srv.nintendo.net, 54.85.208.211</i> <i><br></i>  <i>nncs1-lp1.nnsrv.nintendo.net, 35.158.74.61</i> <i><br></i>  <i>nncs2-lp1.nnsrv.nintendo.net, 35.157.230.202</i> <i><br></i>  <i>ctest-dl-lp1.cdn.nintendo.net - not required</i> <i><br></i>  <i>ctest-ul-lp1.cdn.nintendo.net - not required</i> <br><br>  The last 2 domain names work exactly.  They are related to the U / D bandwidth check service.  In addition, they are located on the CDN (a further link leads to akamai). <br><br>  <b>2. Check these ip addresses for blocking RKN.</b> <br><br>  <b>2.1</b> Open the blocking address checker.  I used the telegram bot @rknblockbot, but you can use the RNN verification service <a href="http://blocklist.rkn.gov.ru/">itself</a> . <br><br>  <b>2.2</b> Check the ip address from the table of paragraph 1.5. <br><br>  <b>2.3</b> Blocked ip addresses - mark. <br><br>  <b>2.4</b> As a result, we have a table in which domain names are visible, where, without intervention, we will not be able to get. <br><br>  <i>Domain name, ip address blocked.</i> <i><br></i>  <i>nncs1-lp1.nnsrv.nintendo.net, 35.158.74.61</i> <i><br></i>  <i>nncs2-lp1.nnsrv.nintendo.net, 35.157.230.202</i> <br><br>  <b>3. Find out all the ip addresses related to the domain name, where there is a problem.</b> <br><br>  <b>3.1</b> I solved this problem in the forehead, <a href="">simply having started the services</a> where you can see all the addresses. <br><br><img src="https://habrastorage.org/webt/cp/_n/el/cp_nelafgjoj4gg-a6poaye3i90.png"><br><br>  It just shows that the servers are geographically distributed across different continents. <br><br>  <b>3.2</b> Check the entire list of received addresses for blocking.  Add unblocked addresses to the table.  I did this: <br><br>  <i>Domain name, ip address blocked, new ip address.</i> <i><br></i>  <i>nncs1-lp1.nnsrv.nintendo.net, 35.158.74.61, 52.14.47.244</i> <i><br></i>  <i>nncs2-lp1.nnsrv.nintendo.net, 35.157.230.202, 52.14.237.148</i> <br><br>  <b>4. ‚ÄúNailing in‚Äù working addresses in DNS-e, to which the prefix will address.</b> <br><br>  <b>4.1</b> There are a lot of options for solving this task (for example, to find a foreign dns that returns the necessary ip addresses, as I indicated above, or to raise your own dns). <br>  I chose my simple option.  In the settings of my router (MGTS GPON ZTE F660), I indicated on the LAN tab that you need to use the DNS router 192.168.1.1, and in the Application-&gt; DNS Service I registered new ip addresses for the problematic domain names (in fact, this content goes directly to the file / etc / hosts on the router). <br><br>  <b>4.2 We will</b> overload the router, from the laptop we check with the utility nslookup / dig, that the necessary ip addresses are being returned. <br><br>  <b>4.3</b> Reconnect the console to the router, check. <br><br><img src="https://habrastorage.org/webt/yf/c-/xf/yfc-xflvvybftkv1oqxjoci01hk.png"><br><br>  And yes, do not forget that the "working type NAT" (in Nintendo terms) for an online game is NAT type A, B.  For this you need to do, in my opinion, a shaped disgrace: Assign port forwarding incoming UDP 49000-65535 (yeah ..) to the ip address of your console.  The address of the console must be static, or registered in the DHCP bundles of your router. <br><br>  <i>My personal opinion is laziness / timing of programmers.</i>  <i>It was possible to easily raise on the UDP ServerSocket and wait for answers from the outside world on it.</i>  <i>Routers would be configured more correctly.</i>  <i>Yes, and UPnP has not been canceled.</i>  <i>Well, it's all fantasy ..</i> <br><br>  But this is better than <a href="http://en-americas-support.nintendo.com/app/answers/detail/a_id/651/~/how-to-set-up-port-forwarding">recommending Nintendo to open UDP 1-65535</a> . <br><br>  <i>In addition</i> : <br>  <b>Splatoon 2</b> is treated with the same algorithm.  I have to say a bunch: <br>  <i>Nncs2.app.nintendowifi.net 52.14.237.96</i> <br><br>  <b>Login to PSN is treated as follows:</b> <br>  <i>elb001-csla-edge01.csla.usw2.np.cy.s0.playstation.net 52.88.123.195</i> <br><br><img src="https://habrastorage.org/webt/3g/k1/7k/3gk17k9mx7tnoc-aigoyepyqt78.jpeg"><br><br>  It is necessary to understand that the scheme is not eternal, and sooner or later something will break in it (for example, the ip-address will change).  There is only one remedy here - bomb your beloved RKN with letters asking you to unblock the collected addresses. </div><p>Source: <a href="https://habr.com/ru/post/354730/">https://habr.com/ru/post/354730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354720/index.html">Mikrotik - collecting and analyzing NetFlow traffic</a></li>
<li><a href="../354722/index.html">Failover VoIP Cluster 3CX</a></li>
<li><a href="../354724/index.html">Marvin Minsky "The Emotion Machine": Chapter 3 "The Pain"</a></li>
<li><a href="../354726/index.html">Who scans the Internet and does Australia exist</a></li>
<li><a href="../354728/index.html">Own asynchronous tcp-server in 15 minutes with detailed analysis</a></li>
<li><a href="../354732/index.html">Developing a simple deep learning model for predicting stock prices using TensorFlow</a></li>
<li><a href="../354736/index.html">How to work as an IT manager and why your boss doesn't have to be Steve Jobs</a></li>
<li><a href="../354738/index.html">Municipal Moira or What affects the career of an official</a></li>
<li><a href="../354740/index.html">Implementing a RESTful Table in the Atlassian User Interface</a></li>
<li><a href="../354742/index.html">PHP could get better</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>