<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Time Travel Debugging in the new WinDbg</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You may have already heard that Microsoft has released an updated version of its well-known WinDbg debugger, which was good before, but too far behind...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Time Travel Debugging in the new WinDbg</h1><div class="post__text post__text-html js-mediator-article">  You may have already heard that Microsoft has released an updated version of its well-known WinDbg debugger, which was good before, but too far behind the current trends in the interface.  The new version of WinDbg, fortunately, did not go so far as to get a new-fashioned UWP interface, but the classic ribbon bars in the style of Microsoft Office are very suitable for it.  The application is distributed only through the Microsoft Store and work on Win10 with at least Anniversary Update.  Microsoft says that this is done for ease of installation and upgrade, but somehow I don‚Äôt remember that there was any installation problem with classic WinDbg.  Rather, it looks like another way to teach developers and users the habit of using only the most recent version of Windows.  Well ok, so be it. <br><br>  WinDbg looks cute: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d7d/ebf/54a/d7debf54a246a7bef488aa133437f15e.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And all its power in the form of commands, debugging drivers, remote debugging, scripts and other things - remained with him.  Moreover, on September 25, an update was released, adding an important feature to the new WinDbg - debugging with the ability to move along the program in the opposite direction (Time Travel Debugging).  The opportunity is interesting, because once a programmer is in some invalid state, the programmer often asks the question ‚ÄúHow did it happen?‚Äù.  Previously, it was possible to get an answer to it by either losing commands in the mind in the reverse order, or by restarting debugging over and over again with the addition of logs and new control points.  All this took time.  Let's see how it works now. <br><a name="habracut"></a><br>  <a href="https://www.microsoft.com/en-us/store/p/windbg/9pgjgd53tn86">Install WinDbg</a> <br><br>  We write some small program and compile it.  I took the first bubble sorting implementation on the Internet (yes, because I'm lazy). <br><br><div class="spoiler">  <b class="spoiler_title">Bubble Sort</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stdafx.h"</span></span></span><span class="hljs-meta"> void swap(int *xp, int *yp) { int temp = *xp; *xp = *yp; *yp = temp; } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// An optimized version of Bubble Sort void bubbleSort(int arr[], int n) { int i, j; bool swapped; for (i = 0; i &lt; n - 1; i++) { swapped = false; for (j = 0; j &lt; n - i - 1; j++) { if (arr[j] &gt; arr[j + 1]) { swap(&amp;arr[j], &amp;arr[j + 1]); swapped = true; } } // IF no two elements were swapped by inner loop, then break if (swapped == false) break; } } /* Function to print an array */ void printArray(int arr[], int size) { int i; for (i = 0; i &lt; size; i++) printf("%d ", arr[i]); } // Driver program to test above functions int main() { int arr[] = { 64, 34, 25, 12, 22, 11, 90 }; int n = sizeof(arr) / sizeof(arr[0]); bubbleSort(arr, n); printf("Sorted array: \n"); printArray(arr, n); return 0; }</span></span></span></span></code> </pre> <br></div></div><br>  Now we have a compiled binary, a symbol file for it and a source file.  All this is needed for WinDbg. <br><br>  Run WinDbg with administrator privileges (this is important!).  Choose File ‚Üí Start debugging ‚Üí Launch executable (advanced): <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb603b221a219221030.png"><br><br>  Set the path to the debugged binary, put the checkbox ‚ÄúRecord process with Time Travel Debugging‚Äù, set the path for saving the recorded execution trace. <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb603d8e2f281212034.png"><br><br>  We press ok, the program starts, runs and closes.  WinDbg saves the recorded execution trace to the specified folder and immediately loads it (this saves debugging time). <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb60414580673449419.png"><br><br>  Now open the file with the code in WinDbg, set a couple of breakpoints, start debugging.  At first glance, everything looks familiar. <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb6043c0b6384019724.png"><br><br>  But here it is - the main difference: <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb60439f51908260634.png"><br><br>  We have access to the reverse direction control block.  We can just step back on the line. <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb6045bd0a129446285.png"><br><br>  We can put a new breakpoint somewhere higher and click ‚ÄúGo back‚Äù to get the program back to it. <br><br><img src="https://habrastorage.org/webt/59/ed/b6/59edb604608de632229728.png"><br><br>  Pay attention - we jumped back in time before the program entered the for loops - and below in the Locals window we already see that the variables i and j still have undefined values ‚Äã‚Äãat this moment. <br><br>  We can go back and forth as much as necessary, restart debugging from the very beginning.  You can connect to already running processes to record the execution of only certain blocks of code.  It is very convenient to catch bugs that are reproduced only occasionally or only in a certain environment, and then scroll through them again and again. <br><br>  In general, I like the feature. <br><br>  Materials on the topic: <br><br><ol><li>  <a href="https://blogs.msdn.microsoft.com/windbg/2017/09/25/time-travel-debugging-in-windbg-preview/">Announcement features in the blog WinDbg</a> </li><li>  <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/time-travel-debugging-overview">Documentation</a> </li><li>  <a href="https://www.microsoft.com/en-us/store/p/windbg/9pgjgd53tn86">Install WinDbg</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/340744/">https://habr.com/ru/post/340744/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340734/index.html">Eleven project management mistakes on the example of the transatlantic yacht crossing</a></li>
<li><a href="../340736/index.html">Three bugs iOS developer, which can be costly</a></li>
<li><a href="../340738/index.html">DevOops 2017: Docker, Docker, Docker</a></li>
<li><a href="../340740/index.html">Vim after 15 years</a></li>
<li><a href="../340742/index.html">You can‚Äôt please everyone, or what we learn from the 2006 redesign of the Facebook feed</a></li>
<li><a href="../340746/index.html">Video calls to Zoom video from web pages</a></li>
<li><a href="../340750/index.html">Web application on Node and Vue, part 1: project structure, API, authentication</a></li>
<li><a href="../340752/index.html">Secrets of a developer who has sold half a million copies of games</a></li>
<li><a href="../340754/index.html">Implementing a proxy server on the integration bus</a></li>
<li><a href="../340756/index.html">How quickly can the phone be infected with a virus, and what will happen to it after that?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>