<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RISC-V core generation and testing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As I wrote in my last post , the name of my project at GSoC-2016 is ‚ÄúRISC-V port at Parallella‚Äù, and the first thing I had to do was to get acquainted...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RISC-V core generation and testing</h1><div class="post__text post__text-html js-mediator-article">  As I wrote in my <a href="http://eliaskousk.teamdac.com/entry/welcome">last post</a> , the name of my project at GSoC-2016 is ‚ÄúRISC-V port at Parallella‚Äù, and the first thing I had to do was to get acquainted with the RISC-V ecosystem.  One of the best ways to do this is to watch the video from the presentation of the first RISC-V workshop on Youtube.  In order to understand the most important concepts, I recommend the following presentations: <br><br><ul><li>  Introduction (Krste Asanoviƒá) <a href="https://www.youtube.com/watch%3Fv%3DA5kpo_ff98M%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-intro-workshop-jan2015.pdf">slides</a> </li><li>  Tulchain RISC-V (Andrew Waterman) <a href="https://www.youtube.com/watch%3Fv%3DXSyH9T-Cj4w%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-software-toolchain-workshop-jan2015.pdf">slides</a> </li><li>  RISC-V SoC Generator ‚ÄúRocket Chip‚Äù in Chisel (Yunsup Lee) <a href="https://www.youtube.com/watch%3Fv%3DIr3h3qWcNlg%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-rocket-chip-generator-workshop-jan2015.pdf">slides</a> </li><li>  The structure of the software stack RISC-V (Sagar Karandikar) <a href="https://www.youtube.com/watch%3Fv%3D2T3eRndwcr0%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-software-stack-bootcamp-jan2015.pdf">slides</a> </li><li>  Debugging on RISC-V (Albert Ou) <a href="https://www.youtube.com/watch%3Fv%3DsIfG4C936rA%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-debugging-bootcamp-jan2015.pdf">slides</a> </li><li>  Porting RISC-V with OpenEmbedded (Martin Maas) <a href="https://www.youtube.com/watch%3Fv%3D0xfDcckQfGM%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-poky-bootcamp-jan2015.pdf">slides</a> </li><li>  RISC-V Test Environment (Stephen Twigg) <a href="https://www.youtube.com/watch%3Fv%3Dmbyb7BgYyXg%26feature%3Dyoutu.be">Video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-testing-frameworks-bootcamp-jan2015.pdf">Slides</a> </li></ul><br>  Another <a href="https://chisel.eecs.berkeley.edu/">link</a> if you are interested in Chisel, a Scala-based language that is used to describe the current hardware implementation of the RISC-V core (the Rocket core has an in-order pipeline, BOOM is out-of-order), and any future implementations. <br><br>  Chisel (Jonathan Bachrach) Quick Guide <a href="https://www.youtube.com/watch%3Fv%3DpfM1WUWbfBs%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-testing-frameworks-bootcamp-jan2015.pdf">slides</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Working with Rocket Chip, adding extensions, ASIC infrastructure and FPGA (Colin Schmidt) <a href="https://www.youtube.com/watch%3Fv%3D64nsYJJqNvI%26feature%3Dyoutu.be">video</a> <a href="https://riscv.org/wp-content/uploads/2015/01/riscv-rocket-chip-tutorial-bootcamp-jan2015.pdf">slides</a> <br><br>  If you are deeply interested in RISC-V and community development, I invite you to take part in <a href="https://riscv.org/workshops/">workshops</a> . <br><br><img src="https://habrastorage.org/webt/5j/1j/uc/5j1juczpvfrzr4y4roqj4m6zhsu.png"><br><a name="habracut"></a><br><br>  Our RISC-V port on Parallella will use a completely standard kernel, generated using Rocket Chip from Chisel sources (the <a href="https://www2.eecs.berkeley.edu/Pubs/TechRpts/2016/EECS-2016-17.html">article</a> gives a very good introduction).  The end result will be Verilog RTL (in unreadable form, only the source code on Chisel is readable), which we can include in our FPGA project for Parallella, which is available in <a href="https://github.com/parallella/oh">the</a> Parallella OH (Open Hardware) <a href="https://github.com/parallella/oh">repository</a> .  However, I will not go into details now, all this will be discussed in the following posts. <br><br>  In order to compile the software for this kernel, you can use the RISC-V GNU toolchain, which can be found <a href="https://github.com/riscv/riscv-tools">here</a> .  There are two compilation options: either with the Newlib C library, which is used for programs running on the <a href="https://github.com/riscv/riscv-pk">proxy kernel</a> (proxy kernel, pk) or compiling with the GNU C library (glibc), for compiling Linux and programs for Linux.  I compiled both versions ( <a href="https://github.com/riscv/riscv-linux">Linux kernel</a> , release 4.1) using the accompanying instructions, and it all worked, as expected, when simulating in <a href="https://github.com/riscv/riscv-isa-sim">Spike</a> , the reference simulator RISC-V ISA. <br><br>  The main <a href="https://github.com/freechipsproject/rocket-chip">repository of</a> Rocket Chip is connected by using Git submodules with all the repositories containing source codes (mainly Chisel), which are needed for proper generation using their wrapper files located in src / main / scala /.  Each submodule is associated with a particular commit, obviously working, as a result, the assembly is stable.  Personally, I did not encounter any errors when generating the default RV64G core (64 bits, [I] nteger, [M] ultiply / Division, [A] tomic, [F] Single Floating, [D] ouble Floating), the shortening of IMAFD is reduced to G (General) containing L1 instruction and data caches, TLB and FPU with MemIO and HostIO interfaces for communication with the outside world. <br><br>  In a typical FPGA system (as shown in the diagram from <a href="https://www.youtube.com/watch%3Fv%3DIr3h3qWcNlg%26feature%3Dyoutu.be">the</a> Y.Lee Rocket Chip <a href="https://www.youtube.com/watch%3Fv%3DIr3h3qWcNlg%26feature%3Dyoutu.be">presentation</a> ), these two interfaces are needed to access the main memory and to load the RISC-V core (bootstrap).  The latter is used to control CSR (control-status registers) and support system calls (for I / O operations) from the target machine (which runs the proxy kernel or the Linux kernel) to the host machine (that is, to the dual core ARM processor in Zynq FPGA) running <a href="https://github.com/riscv/riscv-fesvr">riscv-fesvr instance</a> (front end server) to dispatch system calls to the operating system (i.e. ARM Linux). <br><br>  To configure the kernel, you can also change the values ‚Äã‚Äãinside the <a href="https://github.com/freechipsproject/rocket-chip/blob/master/src/main/scala/config/Config.scala">Config.scala file</a> .  This file contains a set of configurations for various applications (C ++ model, normal sized FPGA, small FPGA, VLSI, etc.).  Whatever the script does that takes the variable CONFIG = XXX (i.e. DefaultFPGAConfig), this sets the desired configuration used to build the C ++ simulator or Verilog RTL for FPGA or VLSI.  This is a very useful thing if you want to experiment with various available options, quickly generate and test them in software or hardware. <br><br>  It is a good idea to compile the toolchain (with Newlib is best) before generating any kernels, since you need to compile and run tests to verify your kernel using the C ++ simulator or Synopsys VCS.  Unfortunately, I was able to use only the first, but not the last.  You cannot use any Verilog simulator (for example, Verilator, Icarus Verilog, Modelsim, QuestSim), since the testbench uses DirectC functions (linking Verilog testbenches and arbitrary C / C ++ code).  Fortunately, the C ++ simulator provides VCD output and I was able to use GTKWave to view the generated test benchmarks. <br><br> <a href=""><img src="https://habrastorage.org/webt/si/xd/q7/sixdq7bmjtwepsfgp54pb5bztz8.png"></a> <br><br>  I also added a session with simple commands needed to build the RISC-V toolchain and generate the RV64G core for FPGA.  These commands will be added to the final compilation script, which I am developing to fully automate everything necessary to get the RISC-V working core inside the Zynq chip on Parallella. <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     Rocket Chip git clone https://github.com/ucb-bar/rocket-chip.git cd rocket-chip git submodule update --init export TOP=$(pwd) #    (Ubuntu) sudo apt-get install autoconf automake autotools-dev curl \ libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex \ texinfo gperf libtool patchutils bc #   RISC-V ( Newlib   ) export RISCV=$TOP/riscv-tools #  ,   ,  ) export PATH=$PATH:$RISCV/bin cd $RISCV git submodule update --init --recursive #   build.common # JOBS =   / ,     ./build.sh #   RISC-V,    #     Spike ( ISA) #    - (pk) cd $TOP echo -e '#include &lt;stdio.h&gt;\n int main(void) \ { printf("Hello world!\\n"); return 0; }' &gt; hello.c riscv64-unknown-elf-gcc -o hello hello.c spike pk hello # :   Rocket Chip #  -j8  -jN ( /   ) cd $TOP/emulator make #   (:     ) # make -j8 run-asm-tests # make -j8 run-bmark-tests #     : make output/rv64ui-p-add.out # :   Rocket Chip   VCD #  -j8  -jN cd $TOP/emulator #      vcd2vpd,  src/main/scala/Testing.scala #     .vpd  .vcd (6 ) make debug #   (:        ) # make -j8 run-asm-tests-debug # make -j8 run-bmark-tests-debug #           #     vcd2vpd: make output/rv64ui-p-add.vcd #  Rocket Chip Verilog RTL  FPGAs ( fsim/generated-src/) #   "DefaultFPGAConfig",       # ,  "SmallFPGAConfig"     FPU #     .  make CONFIG=ConfigName verilog   #      (src/main/scala/Configs.scala) #   Verilog RTL  Top.ConfigName.v cd $TOP/fsim make verilog</span></span></code> </pre> <br>  In the next post, we will look at how to get an IP block from the generated RV64G core so that it can be easily connected to projects, for testing on Zedboard or for use in a large project on Parallella. </div><p>Source: <a href="https://habr.com/ru/post/352928/">https://habr.com/ru/post/352928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352914/index.html">Universal links: the palace of pitfalls</a></li>
<li><a href="../352916/index.html">Apache Ignite 2.4 BaselineTopology Concept</a></li>
<li><a href="../352918/index.html">How to test SkyNet? (if it is written in js)</a></li>
<li><a href="../352922/index.html">The path of the IT-manager (part # 1)</a></li>
<li><a href="../352924/index.html">5 lessons we learned by spending 100500 RK on Facebook</a></li>
<li><a href="../352930/index.html">What will happen if you combine ArrayList and LinkedList?</a></li>
<li><a href="../352932/index.html">Tooltips in Power BI - a new feature for Desktop</a></li>
<li><a href="../352934/index.html">[Ekaterinburg, announcement] java.ural.Meetup @ 2 - the announcement of the second Java-mitap + video reports from java.ural.Meetup @ 1</a></li>
<li><a href="../352938/index.html">Reusable UI components in Ruby on Rails applications</a></li>
<li><a href="../352942/index.html">Conference DEFCON 23. "How I knocked down the annoying drone of a neighbor's child." Michael robinson</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>