<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deep calculation. How do 3D technologies help people to count and make life easier?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="let's get acquainted 
 Our team develops intelligent software for IP video surveillance systems. For 9 years of existence, we have created dozens of f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deep calculation. How do 3D technologies help people to count and make life easier?</h1><div class="post__text post__text-html js-mediator-article"><h5>  <i>let's get acquainted</i> </h5><br>  Our team develops intelligent software for IP video surveillance systems.  For 9 years of existence, we have created dozens of functions and video analysis modules, faced hundreds of problems and won no fewer victories.  In our blog Macroscop we will tell about a part of them, share our vision of the development process and reveal some of our technologies. <br><br><h5>  <i>"Closer to the case"</i> </h5><br>  A few years ago, we identified the low popularity of one of our functions ‚Äî the interactive search function ‚Äî by the fact that users did not contact the company with questions or a problem with working with it.  When the tech phone is silent - this is a bad sign for developers. <br><br>  With the visitor counting module, it was the opposite  Users did not just buy and install it, they really used it!  And so they regularly called with technical support questions, wrote their wishes, told about non-standard ways of use and, of course, shared difficulties in their work. <a name="habracut"></a>  The accuracy of counting was high (over 92%), but it was possible to achieve it with correct installation of the camera, ensuring good shooting conditions (no light, glare, etc.) and painstaking adjustment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/th/ca/ra/thcaraxs_jwq4qwq_lcr37wm8z0.jpeg"><br>  <i>frame from the cartoon "Goatling, who counted to ten"</i> <br><br>  According to our assessment, when working with intelligent modules, users put the accuracy and ease of control of the function at the forefront.  When two years ago we adopted the concept of developing a Macroscop product through its simplification, one of the local milestones of this simplification was the reworking of popular visitor counts. <br><br><h2>  <i>But first things first‚Ä¶</i> </h2><br>  Traditionally, people are considered by video using tracking technology or optical flow method. <br><br>  <i>Tracking</i> builds the trajectories of moving objects, and the counting fixes the direction of intersection of the virtual entry / exit line.  Trajectories can be built in several ways: <br><br>  1. By analyzing the sequence of frames on which there are moving objects.  In general, several moving objects may be present in one frame, so the program needs not only to build trajectories, but also to distinguish between objects and their movements.  When moving objects cross the entry / exit line one by one, there is no difficulty with counting: the task is to determine the direction of intersection of the line. <br><br>  This task can be handled by a counting method based on the simplest implementation of tracking, analyzing foreground objects (moving objects) in two successive frames.  First, areas of motion that differ from the background image are highlighted on the current and previous frame, then, analyzing the speed, direction of motion of objects, as well as their sizes, the probabilities of objects moving from one point of the trajectory of the previous frame to another point of the current one are calculated.  The most probable movements of each object are added to the trajectory. <br><br>  2. In the general case, people in a frame can move in different ways: their trajectories can intersect or overlap, and the areas of motion corresponding to objects can be combined into one area.  In this case, the program needs to identify each object, divide groups of objects and correctly calculate people crossing a virtual line in one direction or another. <br><br>  In these cases, the task of constructing the exact trajectory of individual objects becomes more complicated, then the method of constructing the trajectory over two frames does not fit, it gives a high error.  The analysis of the sequence of frames and continuous post-processing of the obtained results is used: the program builds graphs - analyzes the transitions of objects from one state (position) to another;  analyzes the speed and direction of movement, position, color characteristics.  As a result, a set of the most probable object displacements, forming a trajectory, is given. <br><br>  To improve the accuracy of counting, methods of separating people in groups are also used.  This can be done by estimating the area of ‚Äã‚Äãgroups or by detecting and counting the heads of people. <br><br>  Tracking calculation provides the best accuracy when people in the frame overlap to the minimum.  And in real systems this can often be achieved only by installing a camera over a limited passage (narrow entrance door, escalator, etc.). <br><br>  <i>Counting visitors based on optical flow analysis</i> <br>  If the counting on the basis of tracking finds the object in the video stream and monitors its movements, then this method observes the virtual line of entry / exit and analyzes the movement of color pixels through it.  The method monitors the movement of an area of ‚Äã‚Äãa certain brightness and a certain color through the line, calculates the characteristics of the image features (edges, corners, special points, information about the texture, etc.). At the same time, the method only records the fact that an object is moving through the line, but not determines what kind of object it is, how many people move in the given object.  Methods for detecting heads and analyzing the area of ‚Äã‚Äãa moving object are also used to determine the number of people crossing the line. <br><br>  This method is applicable to a dense flow of people when traditional tracking methods are unsuitable.  The most accurate result is achieved when the flux of people is approximately uniform. <br><br>  We implemented both the first and second methods in our calculations.  Depending on the conditions under which the counting takes place, the user can select the most appropriate mode of operation.  If the shooting conditions are close to ideal (in terms of counting), the setup will not require much time and effort, but if this is not the case, the administrator will have to become puzzled. <br><br>  As a result, the counting of visitors for complex scenes of observation worked in proportion: the more power the user spends on setting up the module, the more accurately he will work.  That in our general concept did not fit. <br><br>  We were puzzled by the search for new solutions for counting visitors. <br><br><h2>  <i>New module 3D-counting visitors</i> </h2><br>  The new module is implemented in a fundamentally different way.  If earlier calculation used data of two measurements, then the third one is entered in the new one - depth (distance from the video camera to the person).  Now counting is not just a module, it is a software and hardware complex from a special device ‚Äî a depth sensor ‚Äî and a software module for data processing.  The sensor calculates the distance from the device to the objects, radiating and receiving IR signals, builds a depth matrix with which the program is already working. <br><br><img src="https://habrastorage.org/webt/dt/qr/z3/dtqrz30dv7lkwciigcmakpzng_i.png"><br><br>  Depth provides information about the height of the person who crosses the entry / exit line and allows people to be distinguished from other objects.  The user needs to set the minimum height of the visitor in the settings, and all people of this height and higher will be counted by the system. <br><br>  For a user, 3D counting of visitors is extremely simple: you only need to set two settings ‚Äî height and entry line. <br><br>  Its results practically do not depend on the conditions in which the calculation is made (unless you think in some very difficult reliefs). <br><br>  It is ultra-accurate - 98.5% in real conditions with real users (and not in the "greenhouse" laboratory, as programmers often like to test).  The highest accuracy is due to the fact that the module does not work with a picture, but with a three-dimensional map.  In addition, we implemented several technologies to solve a number of key tasks in the calculation: <br><br><ol><li>  The task of separating people.  When people are close to each other, their outlines at a given height can merge into one.  To avoid the ‚Äúloss‚Äù of a person, we ‚Äúcut‚Äù the depth map into layers and get multi-layer contours of objects.  The contour without attachments corresponds to the top of the person.  We consider the top. </li><li>  The task of determining the trajectories of the movement of people.  Tracking is used for this, but is absolutely new, which takes into account the peculiarities of the obtained depth data. </li><li>  The task of processing the depth map.  We obtain the depth data by evaluating the infrared signals reflected from the surfaces of the radiating device.  But the rays are differently reflected from different surfaces, so in some cases the map is obtained with ‚Äúholes‚Äù.  We have created an algorithm that completes the map based on values ‚Äã‚Äãin known areas. </li><li>  The task of angle compensation.  In order to maximally relieve the installers of the video systems, we implemented an algorithm that takes into account the deviation of the visitors counting device from the horizontal and corrects the depth values ‚Äã‚Äãaccordingly. </li><li>  The task of automatically determining the distance to the floor.  Its solution eliminates the need to accurately measure the height and set it in the module settings.  It also aims to improve the usability of counting. </li></ol><br><h2>  <i>"Keep it simple and people will reach out to you ..."</i> </h2><br>  New 3D-counting of visitors is much simpler than the traditional module.  It is also easier from the point of view of the technologies implemented in it, and from the point of view of user work.  However, it is much more accurate and less "whimsical" to the conditions of shooting. <br><br>  When we came up with new 3D-counting to users on real objects, the highest impression was not even the highest accuracy (98.5% in real conditions), but this very simplicity and the almost complete absence of any settings.  This once again assures us of its desire to develop, balancing simplicity and functionality, refuting the stereotype that a cool product should be heaped and complicated. </div><p>Source: <a href="https://habr.com/ru/post/341470/">https://habr.com/ru/post/341470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341460/index.html">The functional architecture is ports and adapters.</a></li>
<li><a href="../341462/index.html">What is silent post-mortem: the unknown story of the creation of Gothic 3</a></li>
<li><a href="../341464/index.html">Infinite scrolling on Firebase</a></li>
<li><a href="../341466/index.html">Create your own blockchain on Ethereum</a></li>
<li><a href="../341468/index.html">23 questions for a support candidate</a></li>
<li><a href="../341474/index.html">Digital Friday 2017 - sale of online services for businesses</a></li>
<li><a href="../341476/index.html">We are not waiting, but we are preparing for the transition to new standards of cryptographic protection of information</a></li>
<li><a href="../341478/index.html">Difference DAX and MDX</a></li>
<li><a href="../341480/index.html">Developer brain productization: how to stop writing code and start writing applications</a></li>
<li><a href="../341482/index.html">New survey features in 3CX WebMeeting</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>