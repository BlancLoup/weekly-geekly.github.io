<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The book "Probabilistic programming in Python: Bayesian inference and algorithms"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habrozhiteli! Bayesian methods scare the formulas of many IT people, but now it‚Äôs impossible to do without analyzing statistics and probabilities....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The book "Probabilistic programming in Python: Bayesian inference and algorithms"</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habr.com/ru/company/piter/blog/456562/"><img src="https://habrastorage.org/webt/he/38/cw/he38cwwp66fmz66fhaixur-fogs.jpeg" align="left" alt="image"></a>  Hi, Habrozhiteli!  Bayesian methods scare the formulas of many IT people, but now it‚Äôs impossible to do without analyzing statistics and probabilities.  Cameron Davidson-Paylon talks about the Bayesian method from the point of view of a programmer-practitioner who works with the multifunctional PyMC language and the NumPy, SciPy and Matplotlib libraries.  Expanding the role of Bayesian findings in A / V testing, fraud detection and other pressing tasks, you will not only easily understand this non-trivial topic, but also begin to apply this knowledge to achieve your goals. <br><br><h3>  Excerpt: 4.3.3.  Example: sorting comments on reddit </h3><br>  You may not agree that the law of large numbers applies to all, albeit implicitly, in subconscious decision making.  Consider the example of online product ratings.  Do you often trust an average rating of five points based on a single review?  Two reviews?  Three reviews?  You subconsciously understand that with such a small number of reviews, the average rating reflects badly how good or bad the product really is. <br><a name="habracut"></a><br><br>  As a consequence, there are omissions when sorting goods and generally when comparing them.  For many buyers, it is clear that sorting the results of an online search by rating is not very objective, no matter if it‚Äôs about books, videos or comments on the Internet.  Often, first-place films or comments get high marks only due to a small number of enthusiastic fans, and really good films or comments are hidden on subsequent pages with allegedly imperfect ratings of about 4.8.  What to do with it? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider the popular site Reddit (I deliberately do not provide links to it, because Reddit is notorious for dragging its users, and I am afraid that you will never return to my book).  On this site there are many links to different stories and pictures, and comments on these links are also very popular.  Users of the site (which is usually called the word redditor1) can vote for or against each comment (the so-called votes for (upvotes) and votes against (downvotes)).  Reddit by default sorts comments in descending order.  How to determine which comments are the best?  Usually focus on the following several indicators. <br><br>  1. <i>Popularity</i> .  A comment is considered good if many votes are cast for it.  Problems with the use of this model begin in the case of a comment with hundreds of votes ‚Äúfor‚Äù and thousands ‚Äúagainst‚Äù.  Although very popular, this comment seems to be too ambiguous to be considered "best." <br><br>  2. <i>Difference</i> .  You can use the difference between the number of votes "for" and "against."  This solves the problem of using the ‚Äúpopularity‚Äù metric, but does not take into account the temporary nature of the comments.  Comments can be sent many hours after the publication of the original link.  At the same time there is a shift, due to which the highest rating is received not by the best comments, but by the oldest ones, who managed to accumulate more ‚Äúfor‚Äù votes than the newer ones. <br><br>  3. <i>Time adjustment</i> .  Consider a method in which the difference in the votes ‚Äúfor‚Äù and ‚Äúagainst‚Äù is divided by the age of the comment and the frequency (rate) is obtained, for example, the magnitude of the difference per second or per minute.  A counterexample immediately comes to mind: using the ‚Äúper second‚Äù option, a comment left a second ago with one vote ‚Äúfor‚Äù will be better than a left one 100 seconds ago with 99 votes ‚Äúfor‚Äù.  This problem can be avoided if only comments left at least t seconds ago are taken into account.  But how to choose a good t value?  Does this mean that all comments left later than t seconds ago are bad?  The case will end by comparing unstable quantities with stable (new and old comments). <br><br>  4. <i>Value</i> .  Ranking comments by the ratio of votes "for" to the total number of votes "for" and "against."  This approach eliminates the problem with the temporal nature of comments, so that recently left comments with good ratings will receive a high rating with the same probability as left long ago, provided that they have a relatively high ratio of votes "for" to the total number of votes.  The problem with this method is that a comment with one vote ‚Äúfor‚Äù (ratio = 1.0) will be better than a comment with 999 votes ‚Äúfor‚Äù and one ‚Äúagainst‚Äù (ratio = 0.999), although it is obvious that the second of these comments would rather be the best. <br><br>  I wrote for a reason <i>"rather</i> . <i>"</i>  It may also be the case that the first comment with a single vote ‚Äúfor‚Äù is really better than the second, with 999 votes for.  It is difficult to agree with this statement, because we do not know what the 999 potential next votes for the first comment could be.  For example, he could have received as a result another 999 votes ‚Äúfor‚Äù and not one vote ‚Äúagainst‚Äù and be better than the second, although such a scenario is not very likely. <br><br>  In fact, we need to evaluate the actual proportion of votes "for".  I note that this is not at all the same as the observed ratio of votes ‚Äúfor‚Äù;  the actual ratio of votes ‚Äúfor‚Äù is hidden; we observe only the number of votes ‚Äúfor‚Äù compared with the votes ‚Äúagainst‚Äù (the actual ratio of votes ‚Äúfor‚Äù can be viewed as the probability of a vote receiving the vote for ‚Äúinstead‚Äù).  Thanks to the law of large numbers, it is safe to say that a comment with 999 votes in favor and one against will have an actual ratio of votes in favor likely to be 1. On the other hand, we are much less sure of what the actual ratio of votes "for" for a comment with one vote "for".  It looks like a Bayesian task. <br><br>  One of the ways to determine the prior distribution of the ratio of votes ‚Äúfor‚Äù is to study the history of the distribution of the ratio of votes ‚Äúfor‚Äù.  This can be done by scraping Reddit comments and then determining the distribution.  However, this method has several drawbacks. <br><br>  1. <i>Asymmetric data</i> .  The number of votes for the absolute majority of comments is very small, as a result of which the ratios of many comments will be close to extreme (see the ‚Äútriangular‚Äù graph in the example with the Kaggle dataset in Fig. 4.4) and the distribution will be strongly skewed.  You can try to take into account only comments whose number of votes exceeds a certain threshold value.  But here too there are difficulties.  It is necessary to seek a balance between the number of available comments, on the one hand, and a higher threshold value with a corresponding ratio accuracy - on the other. <br><br>  2. <i>Displaced (containing a systematic error) data</i> .  Reddit consists of many sub-forums (subreddits).  Two examples: r / aww with photos of funny animals and r / politics.  It is more than likely that users' behavior when commenting on these two sub-forums of Reddit will be radically different: in the first of these, visitors are likely to be touched and behave friendly, which will lead to a greater number of votes in favor, compared to the second, where in the comments are likely to diverge. <br><br>  In the light of the above, it seems to me that it makes sense to use a uniform prior distribution. <br><br>  Now we can calculate the a posteriori distribution of the actual ratio of votes ‚Äúfor‚Äù.  The comments_for_top_reddit_pic.py script is used to scrap comments from the current most popular Reddit image.  In the following code, we scrapped Reddit comments related to the image [3]: <a href="">http://i.imgur.com/OYsHKlH.jpg.</a> <br><br><pre><code class="plaintext hljs">from IPython.core.display import Image #       %run #   i-   . %run top_pic_comments.py 2</code> </pre> <br><blockquote><pre> <code class="plaintext hljs">[Output]: Title of submission: Frozen mining truck http://i.imgur.com/OYsHKlH.jpg</code> </pre> </blockquote><br><pre> <code class="plaintext hljs">""" Contents:       Votes:   NumPy  ""  ""    """ n_comments = len(contents) comments = np.random.randint(n_comments, size=4) print "  (    %d) \n -----------"%n_comments for i in comments: print '"' + contents[i] + '"' print " ""/"": ",votes[i,:] print</code> </pre> <br><blockquote><pre> <code class="plaintext hljs">[Output]:   (   77) ----------- "Do these trucks remind anyone else of Sly Cooper?"  ""/"": [2 0] "Dammit Elsa I told you not to drink and drive."  ""/"": [7 0] "I've seen this picture before in a Duratray (the dump box supplier) brochure..."  ""/"": [2 0] "Actually it does not look frozen just covered in a layer of wind packed snow."  ""/"": [120 18]</code> </pre> </blockquote><br>  With N votes and a given actual ratio of votes "for" p, the number of votes "for" resembles a binomial random variable with parameters p and N (the fact is that the actual ratio of votes "for" is equivalent to the probability of giving a vote "for" compared to a voice " against "with N possible voices / tests).  We will create a function for the Bayesian output of p with respect to the set of votes "for" / "against" a specific comment. <br><br><pre> <code class="plaintext hljs">import pymc as pm def posterior_upvote_ratio(upvotes, downvotes, samples=20000): """         ""  "",   ,    ,    . ,    . """ N = upvotes + downvotes upvote_ratio = pm.Uniform("upvote_ratio", 0, 1) observations = pm.Binomial("obs", N, upvote_ratio, value=upvotes, observed=True) # ;    MAP,     #       . map_ = pm.MAP([upvote_ratio, observations]).fit() mcmc = pm.MCMC([upvote_ratio, observations]) mcmc.sample(samples, samples/4) return mcmc.trace("upvote_ratio")[:]</code> </pre> <br>  The following are the resulting posterior distributions. <br><br><pre> <code class="plaintext hljs">figsize(11., 8) posteriors = [] colors = ["#348ABD", "#A60628", "#7A68A6", "#467821", "#CF4457"] for i in range(len(comments)): j = comments[i] label = u'(%d :%d )\n%s...'%(votes[j, 0], votes[j,1], contents[j][:50]) posteriors.append(posterior_upvote_ratio(votes[j, 0], votes[j,1])) plt.hist(posteriors[i], bins=18, normed=True, alpha=.9, histtype="step", color=colors[i%5], lw=3, label=label) plt.hist(posteriors[i], bins=18, normed=True, alpha=.2, histtype="stepfilled", color=colors[i], lw=3) plt.legend(loc="upper left") plt.xlim(0, 1) plt.ylabel(u"") plt.xlabel(u"  ''") plt.title(u"    '' \   ");</code> </pre> <br><blockquote><pre> <code class="plaintext hljs">[Output]: [****************100%******************] 20000 of 20000 complete</code> </pre> </blockquote><br>  As can be seen from fig.  4.5, some distributions are strongly ‚Äúcompressed‚Äù, while others have relatively long ‚Äútails‚Äù, expressing what we do not know for sure what the actual proportion of votes is for. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_o/vm/4v/_ovm4vt7lqlq9m7ikb6hrrfdjtm.png" alt="image"></div><br><h3>  4.3.4.  Sorting </h3><br>  So far, we have ignored the main goal of our example: sorting comments from best to worst.  Of course, it is not possible to sort distributions;  sort need scalar values.  There are many ways to extract the essence of the distribution in the form of a scalar;  for example, one can express the essence of a distribution through its expectation, or average value.  However, the average value for this is poor, because this indicator does not take into account the uncertainty of the distributions. <br><br>  I would recommend using the least plausible value of 95%, which is defined as a value with only a 5% probability that the actual value of the parameter is lower than it (compare with the lower limit of the Bayesian confidence interval).  Next, we build graphs of a posteriori distributions with the indicated 95% least plausible value (Fig. 4.6). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fu/t-/-5/fut--5kk2z6ddywqyx-efnblbxo.png" alt="image"></div><br><pre> <code class="plaintext hljs">N = posteriors[0].shape[0] lower_limits = [] for i in range(len(comments)): j = comments[i] label = '(%d :%d )\n%s‚Ä¶'%(votes[j, 0], votes[j,1], contents[j][:50]) plt.hist(posteriors[i], bins=20, normed=True, alpha=.9, histtype="step", color=colors[i], lw=3, label=label) plt.hist(posteriors[i], bins=20, normed=True, alpha=.2, histtype="stepfilled", color=colors[i], lw=3) v = np.sort(posteriors[i])[int(0.05*N)] plt.vlines(v, 0, 10 , color=colors[i], linestyles="‚Äî", linewidths=3) lower_limits.append(v) plt.legend(loc="upper left") plt.ylabel(u"") plt.xlabel(u"  ''") plt.title(u"    '' \   "); order = np.argsort(-np.array(lower_limits)) print order, lower_limits</code> </pre> <br><blockquote><pre> <code class="plaintext hljs">[Output]: [3 1 2 0] [0.36980613417267094, 0.68407203257290061, 0.37551825562169117, 0.8177566237850703]</code> </pre> </blockquote><br>  The best, according to our procedure, will be those comments for which the highest probability of obtaining a high percentage of votes "for".  Visually, these are comments with the closest to 95% least plausible value.  In fig.  4.6 The 95% least plausible value is shown with vertical lines. <br><br>  Why is sorting based on this indicator such a good idea?  Streamlining according to the 95% least plausible value means maximum caution in declaring comments to be the best.  That is, even in the worst case scenario, if we strongly overestimate the ratio of votes in favor, it is guaranteed that the best comments will be on top.  With this ordering, the following very natural properties are provided. <br><br>  1. Of the two comments with the same observed ratio of votes ‚Äúfor‚Äù, a comment with a higher number of votes will be recognized as the best (since there is a higher confidence in a higher ratio for it). <br><br>  2. Of the two comments with the same number of votes, the best is the comment with the most votes in favor. <br><br>  ¬ªMore information about the book can be found on <a href="https://www.piter.com/collection/new/product/veroyatnostnoe-programmirovanie-na-python-bayesovskiy-vyvod-i-algoritmy">the publisher site.</a> <br>  ¬ª <a href="https://storage.piter.com/upload/contents/978544611058/978544611058_X.pdf">Table of Contents</a> <br>  ¬ª <a href="https://storage.piter.com/upload/contents/978544611058/978544611058_p.pdf">Excerpt</a> <br><br>  For Habrozhiteley 25% coupon discount - <b>javascript</b> <br><br>  Upon payment of the paper version of the book, an e-book is sent to the e-mail. </div><p>Source: <a href="https://habr.com/ru/post/456562/">https://habr.com/ru/post/456562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45655/index.html">Google admitted in violation of the rules of the App Store</a></li>
<li><a href="../456554/index.html">Open Day of Netology "Professions Data Science"</a></li>
<li><a href="../456556/index.html">Nginx recipes: basic authorization with captcha</a></li>
<li><a href="../456558/index.html">Port scanner in Rostelecom‚Äôs personal account</a></li>
<li><a href="../45656/index.html">As before laptops did - Toshiba Libretto 50ct (1997 onwards)</a></li>
<li><a href="../456564/index.html">List of users with weak passwords in MS SQL</a></li>
<li><a href="../45657/index.html">Gamebox - an arcade toy on JavaScript.</a></li>
<li><a href="../456570/index.html">This Friday, June 21, the anniversary DevConfX will be held; on June 22, exclusive workshops</a></li>
<li><a href="../456572/index.html">40 years of advergeaming - retrospective of promotional video games</a></li>
<li><a href="../456578/index.html">Concepts VueJS for backend developers - master class on June 22</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>