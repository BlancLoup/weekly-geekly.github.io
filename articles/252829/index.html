<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sound effects in Windows Phone 8 applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Despite the fact that the vast majority of applications do not need to play sound effects, sometimes there is a situation where you can not do without...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sound effects in Windows Phone 8 applications</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/db0/778/8c3/db07788c3b7145598addf9ddf26dc523.jpg"></div>  Despite the fact that the vast majority of applications do not need to play sound effects, sometimes there is a situation where you can not do without a sound effect.  Then the natural question is how to reproduce the sound effect in the Windows Phone 8 application? <br><br>  Referring to the Windows Phone Silverlight documentation, you can find the following <a href="https://msdn.microsoft.com/en-us/library/windows/apps/ff402550.aspx">Media for Windows Phone</a> articles and the <a href="https://msdn.microsoft.com/en-us/library/windows/apps/xaml/dn263233.aspx">Playing a sound effect</a> .  Based on the content of the documents, you can come to the conclusion that there are only two ways to reproduce the effects in applications: use MediaElement or XNA.  Consider each of these methods in more detail. <br><br><h4>  Playing Sound Effects with MediaElement </h4><br>  The easiest and ‚Äúnative‚Äù way to play a sound effect is to use the MediaElement control.  This control provides ample opportunities to play audio and video content and can be used for our purposes. <br><a name="habracut"></a><br>  To use the control, you need to add it to the visual tree of the current page: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To do this, add the following code to the XAML page: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MediaElement</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewMediaElement"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AutoPlay</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  Or create a control from the cedebehind page using the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MediaElement _mediaElement; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateMediaElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _mediaElement = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaElement { AutoPlay = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; LayoutRoot.Children.Add(_mediaElement); }</code> </pre><br>  From the code, you can see that the control has the AutoPlay property set, this switches the control to immediate playback of the transferred content. <br><br>  To play a sound file, you must pass its address to the Source property of the control. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySoundClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { viewMediaElement.Source = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"/Assets/sound.wav"</span></span>, UriKind.Relative); }</code> </pre><br>  To set the value of the Source property, you can use XAML data binding, which allows you to completely eliminate codebehind content. <br><br><h5>  The advantages of using this method of playing sound effects: </h5><br><ul><li>  Ease of implementation and use </li><li>  Reproduction of the contents of files in any of the formats supported by the operating system </li></ul><br><h5>  Disadvantages: </h5><br><ul><li>  The control must be added to the visual tree of the application. </li><li>  This way you can play only one sound at a time, the documentation states that only one control is allowed. </li><li>  Playing sounds is tied to the user interface and requires synchronization with the UI stream. </li><li>  Unable to arrange seamless looping. </li></ul><br><h4>  Playing Sound Effects with XNA </h4><br>  To play sound effects, you can use the XNA library.  Despite the fact that this library was designed to work within the framework of the XNA infrastructure when developing game projects, it can be used in Windows Phone applications for playing sounds. <br><br>  This is quite simple: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySoundClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = TitleContainer.OpenStream(<span class="hljs-string"><span class="hljs-string">"Assets/sound.wav"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> soundEffect = SoundEffect.FromStream(stream); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instance = soundEffect.CreateInstance(); FrameworkDispatcher.Update(); instance.Play(); }</code> </pre><br>  Pay attention to two interesting points.  It is not necessary to call the CreateInstance method for a sound effect, you can play it simply by calling the PlayEl method of the SoundEffect instance, but only an explicitly created effect instance allows you to fully control the effect and fine-tune it.  Ignorance of this moment led to the common misconception of WP SL programmers that SoundEffect is out of control after playback is started. <br><br>  Calling the FrameworkDispatcher.Update () method is necessary to emulate the XNA gaming cycle, which is required for the XNA library to work correctly. <br><br><h5>  Advantages of sound reproduction using XNA SoundEffect: </h5><br><ul><li>  Ease of use. </li><li>  Advanced sound effects settings such as volume, speed, repeat, etc. </li></ul><br><h5>  Disadvantages: </h5><br><ul><li>  Outdated technology that is no longer supported by Microsoft. </li><li>  Plays only WAV files in PCM format, which takes up a large amount of memory. </li><li>  The need for additional manipulations, in the form of a game cycle emulation. </li></ul><br><h4>  Using XAudio2 to play sound effects </h4><br>  Unfortunately, there are no other ways to play sound effects for WP 8 applications available out of the box.  However, low-level XAudio2 sound effects playback technology is available for native applications.  This technology is positioned as a technology for playing sound effects in games, but it can be used to play sound effects in Windows Phone 8 applications. <br><br>  Since XAudio2 cannot be used directly from a WP application.  We will develop a simple Windows Runtime component that will allow the WP Silverlight application to play sound effects. <br><br>  The Windows Runtime components for the Windows Phone 8 operating system are developed only using C ++. <br><br>  Add a new project Windows Runtime Component (Windows Phone 8.0) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/735/4e1/4ea/7354e14ea6594e9faf1f60a24a3c0f00.png" width="640"></div><br><br>  For the correct assembly of the project, you must specify the linker to use the xaudio2.lib library.  To do this, open the project properties in the Linker -&gt; Input tab and add the xaudio2.lib library to the Additional Dependencies list. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/834/aa9/071/834aa9071fc44799ae64ae187cf0ccfa.png" width="640"></div><br><br>  Define the class of the component being created: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ref <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SoundEffect</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sealed</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt;WaveData&gt; _waveData; Microsoft::WRL::ComPtr&lt;IXAudio2&gt; _audioEngine; IXAudio2MasteringVoice* _masteringVoice; IXAudio2SourceVoice* _sourceVoice; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: SoundEffect(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Array&lt;byte&gt;^ source); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Play</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; };</code> </pre><br><br>  The class constructor takes a single parameter, an array of bytes with the contents of the sound file in PCM or ADPCM format.  To control the sound effect, the Play and Stop methods are used.  When the Play method is called, the effect should be played from the beginning, and when the Stop is called, the effect should stop playing. <br><br>  Class fields are used to store references to XAudio2 components and a description of the WaveData sound file.  The IXAudio2 component is a COM object, so the Microsoft :: WRL :: ComPrt container is used to store it, which ensures that the reference counting mechanism and the object are released correctly.  The remaining pointers to XAudio2 objects do not use ComPtr and reference counting their lifetime is controlled by the object IXAudio2. <br><br>  Initialize XAudio2 <br><br><pre> <code class="cpp hljs">SoundEffect::SoundEffect(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Array&lt;byte&gt;^ source) { _waveData = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_shared&lt;WaveData&gt;(source); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> hr = XAudio2Create(&amp;_audioEngine); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(hr)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ref <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Platform::Exception(hr); } hr = _audioEngine-&gt;CreateMasteringVoice(&amp;_masteringVoice); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(hr)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ref <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Platform::Exception(hr); } hr = _audioEngine-&gt;CreateSourceVoice(&amp;_sourceVoice, _waveData-&gt;Format); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(hr)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ref <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Platform::Exception(hr); } hr = _audioEngine-&gt;StartEngine(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(hr)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ref <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Platform::Exception(hr); } }</code> </pre><br>  The WaveData class will be discussed below, now it‚Äôs enough to know that it extracts information about the format of the audio data and the audio data from the sound file in wav format. <br><br>  The first step by calling the XAudio2Create function is to get a reference to the object that implements the IXAudio2 interface. <br><br>  The next step is to create an object that implements the IXAudioMasteringVoice interface, this object is responsible for combining data from the original voices into a single audio stream.  In essence, this object is a sound mixer. <br><br>  By calling the CreateSourceVoice method, we will create a source voice representing the sound stream from the sound effect file.  When creating the original voice, you must specify the format of the audio data that will be transferred to it for playback. <br><br>  Read more about XAudio2 voices on <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ee415825.aspx">XAudio2 Voices</a> . <br><br>  The final step in XAudio2 initialization is to call the StartEngine method to start processing sound effects from the library core. <br><br>  Methods for starting and ending effect playback <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SoundEffect::Play() { Stop(); XAUDIO2_BUFFER playBuffer = { <span class="hljs-number"><span class="hljs-number">0</span></span> }; playBuffer.AudioBytes = _waveData-&gt;Length; playBuffer.pAudioData = _waveData-&gt;Data; playBuffer.Flags = XAUDIO2_END_OF_STREAM; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> hr = _sourceVoice-&gt;SubmitSourceBuffer(&amp;playBuffer); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SUCCEEDED(hr)) { hr = _sourceVoice-&gt;Start(<span class="hljs-number"><span class="hljs-number">0</span></span>, XAUDIO2_COMMIT_NOW); } } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SoundEffect::Stop() { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> hr = _sourceVoice-&gt;Stop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SUCCEEDED(hr)) { _sourceVoice-&gt;FlushSourceBuffers(); } }</code> </pre><br>  Before starting playback, you need to fill the XAUDIO2_BUFER structure with audio file data and set it using the SubmitSourceBuffer method as a data source for the original voice. <br><br>  And the last step is to start the voice playback, the Start method; <br><br>  In fact, you can set the source of voice data once, then just start playback using the Play method, however I encountered the situation with an incorrectly completed Stop method and as a result subsequent errors when trying to start playback.  Setting the source buffer at each playback solved this problem. <br><br><h4>  Preparation and loading of audio files </h4><br>  The XAudio2 library on WP 8 can play PCM and ADPCM audio data.  To prepare ADPCM files, you must use the adpcmencode.exe utility, its use ensures compatibility of the resulting file with the XAudio2 library. <br><br>  In fact, I was not able to prepare a single file in the ADPCM format using third-party utilities, they were all incompatible, despite the formal compliance of the requirements. <br><br>  Two essential components must be extracted from the wav sound file: the audio data format and the audio stream data directly in PCM or ADPCM format.  To obtain the specified components, you must parse the wav file. <br><br>  The wav file is a Riff container, details of which can be read: <a href="http://en.wikipedia.org/wiki/Resource_Interchange_File_Format">WIKI RIFF</a> , <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd798636.aspx">Resource Interchange File Format Services</a> and <a href="https://msdn.microsoft.com/ru-ru/library/windows/desktop/ee415713.aspx">ADPCM RIFF</a> . <br><br>  The class WavData is responsible for extracting data from a wav file and their subsequent storage. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WaveData</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Array&lt;byte&gt;^ _buffer; <span class="hljs-function"><span class="hljs-function">ChunkInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindChunk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Array&lt;byte&gt;^ buffer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> RiffType&amp; chunkType)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Array&lt;byte&gt;^ buffer)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: WaveData(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Array&lt;byte&gt;^ buffer); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> WAVEFORMATEX* Format; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> byte* Data; uint32 Length; };</code> </pre><br><br>  When parsing a file, the class checks: <br><br><ol><li>  file contains wave data </li><li>  the file contains the frm (format) part and that its size is not less than the size of the WAVEFORMATEX structure </li><li>  PCM or ADPCM audio data format </li><li>  file contains data part </li></ol><br>  Pointers to the data obtained in paragraphs 2 and 4 are stored for later use. <br><br><h4>  Using the created component </h4><br>  Connect the created component to the WP Silverlight application and use it to play a sound effect: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySoundClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> soundEffect = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> CreateSoundEffectFromFile(<span class="hljs-string"><span class="hljs-string">"ms-appx:///Assets/sound.wav"</span></span>); soundEffect.Play(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;XAudio2SoundEffect.SoundEffect&gt; CreateSoundEffectFromFile(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileUri) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(fileUri)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> StorageFile.GetFileFromApplicationUriAsync(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(fileUri)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buffer = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> ReadFile(file); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XAudio2SoundEffect.SoundEffect(buffer); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[]&gt; ReadFile(StorageFile file) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> file.OpenReadAsync()) <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> reader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataReader(stream)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[stream.Size]; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> reader.LoadAsync((<span class="hljs-keyword"><span class="hljs-keyword">uint</span></span>)stream.Size); reader.ReadBytes(buffer); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buffer; } }</code> </pre><br><br><h4>  Instead of conclusion </h4><br>  By creating a component that uses the XAudio2 library to play sound effects, we got rid of obsolete XNA libraries and got rid of the shortcomings inherent in MediaElement. <br><br>  The created component implements the simplest sound effect control functions.  The developer has access to all the features provided by XAudio2, such as: volume control, playback speed control, loop playback, sound effects and more. <br><br>  Test project source codes are available on Github: <a href="https://github.com/Viacheslav01/WPSoundEffect">https://github.com/Viacheslav01/WPSoundEffect</a> </div><p>Source: <a href="https://habr.com/ru/post/252829/">https://habr.com/ru/post/252829/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252813/index.html">Can you trust the code in the editor? bi-directional text</a></li>
<li><a href="../252817/index.html">Automation of financial statements</a></li>
<li><a href="../252819/index.html">How to prepare TCP</a></li>
<li><a href="../252821/index.html">Nginx and https. We get class A +</a></li>
<li><a href="../252823/index.html">Custom SQLite Android functions or its own LOWER_FNC ()</a></li>
<li><a href="../252831/index.html">Track devices via passive WiFi listening</a></li>
<li><a href="../252833/index.html">Calculation of prescaler parameters for 8250-compatible USART</a></li>
<li><a href="../252837/index.html">Freedom dependent variables</a></li>
<li><a href="../252843/index.html">What is wrong with online courses and how to fix it: HTML Academy experience</a></li>
<li><a href="../252845/index.html">As a mini PBX manager with GSM and call recordings did</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>