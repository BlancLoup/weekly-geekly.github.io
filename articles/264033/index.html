<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As a regular Wordpress site, dial 99/100 in PageSpeed ‚Äã‚ÄãInsights</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that Adsense once again lowered the assessment of the effectiveness of pages: 

 And we all know that the speed of the si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As a regular Wordpress site, dial 99/100 in PageSpeed ‚Äã‚ÄãInsights</h1><div class="post__text post__text-html js-mediator-article">  It all started with the fact that Adsense once again lowered the assessment of the effectiveness of pages: <br><img src="https://habrastorage.org/getpro/habr/post_images/a4b/094/238/a4b0942384dad9b4387640e1a7203b6f.png" alt="image"><br>  And we all know that the speed of the site is one of the ranking factors in the issuance of Google. <br><br>  And if earlier it was possible to correct the situation by simple actions, turn on caching or compress JS, then now, it seems, the time has come to take on the site thoroughly. <br><br>  Initially, there is a site with articles, of which there are millions on the Internet: CMS Wordpress 4.2, two dozen plug-ins, a theme laid out by a freelancer and shared hosting. <br><a name="habracut"></a><br>  Let us examine the points that were corrected in this particular case.  I am sure the article will be useful to everyone who uses WP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The basis was taken by Alexey Klimanov's screencast ‚Äú <a href="http://www.youtube.com/watch%3Fv%3Dp-Sdyj9qnmY">How to increase the speed of the site‚Äôs loading</a> ‚Äù, for which a special thanks to him.  However, WP has its own characteristics, we will consider them in more detail. <br><br>  Okay, Google, what's wrong with my site? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c98/a47/535/c98a475351257c66ce8ebb705507bc97.png" alt="image"><br><br>  <b>1. Remove from the top of the page the javascript and css blocking code</b> <br><br>  The most fascinating item.  In short, you need to load CSS with scripts, transfer the scripts to the footer themselves and get rid of the standard Google Fonts connection. <br><br>  1.1.  On the usual WP-site, as a rule, there is a main style.css of the current theme and several files with plug-in styles, as well as various frameworks. <br><br>  First of all, we transfer <b>all the</b> styles to the style.css file of the current theme, fix the URLs of the pictures, make sure everything works. <br><br>  In order to disable the loading of styles of individual plug-ins, you need to do the following: we find where styles are connected in a plugin, usually the wp_enqueue_style () function is used for this.  The first argument to this function is a CSS file identifier, a text string. <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  fancybox,  css     : wp_enqueue_style('fancybox', ‚Ä¶blah-blah-blah‚Ä¶. );</span></span></code> </pre> <br>  Copy the identifier and unregister this file with wp_deregister_style () in your functions.php.  You need to hang the hook on the 'wp_print_styles' event, this is how it looks in full: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove_styles</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ wp_deregister_style (<span class="hljs-string"><span class="hljs-string">'fancybox'</span></span>); wp_deregister_style (<span class="hljs-string"><span class="hljs-string">'contact-form-7'</span></span>); wp_deregister_style (<span class="hljs-string"><span class="hljs-string">'etc'</span></span>); } add_action (<span class="hljs-string"><span class="hljs-string">'wp_print_styles'</span></span>,<span class="hljs-string"><span class="hljs-string">'remove_styles'</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>);</code> </pre><br>  It happens that the author of the plugin does not particularly bother and just connects the styles like this: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;link rel="stylesheet" href="‚Ä¶‚Ä¶</span></span></code> </pre><br>  In this case, if there is no need to constantly update this plugin, it may be worth making your edits and turning off the update for it. <br><br>  Further, it is important to quickly give the user the first screen.  All styles responsible for rendering the first screen are minimized and placed directly on the page in the head. <br><br>  The remaining styles remain in style.css and are loaded by the script.  For example, using such a line in the footer: <br><pre> <code class="javascript hljs">&lt;script&gt; jQuery(<span class="hljs-string"><span class="hljs-string">"head"</span></span>).append(<span class="hljs-string"><span class="hljs-string">"&lt;link rel="</span></span>stylesheet<span class="hljs-string"><span class="hljs-string">" href="</span></span>&lt;?php echo get_stylesheet_uri(); ?&gt; <span class="hljs-string"><span class="hljs-string">" type="</span></span>text/css<span class="hljs-string"><span class="hljs-string">" media="</span></span>screen<span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  In order for users with JS turned off to see the correct page, we frame the standard output of styles in noscript, PageSpeed ‚Äã‚Äãdoes not take into account this line: <br><pre> <code class="javascript hljs">&lt;noscript&gt;<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"&lt;?php echo get_stylesheet_uri(); ?&gt;"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">noscript</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br>  1.2 All JS scripts are connected at the end of the page.  This is done by adding a few lines of code to functions.php: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">footer_enqueue_scripts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ remove_action(<span class="hljs-string"><span class="hljs-string">'wp_head'</span></span>,<span class="hljs-string"><span class="hljs-string">'wp_print_scripts'</span></span>); remove_action(<span class="hljs-string"><span class="hljs-string">'wp_head'</span></span>,<span class="hljs-string"><span class="hljs-string">'wp_print_head_scripts'</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>); remove_action(<span class="hljs-string"><span class="hljs-string">'wp_head'</span></span>,<span class="hljs-string"><span class="hljs-string">'wp_enqueue_scripts'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); add_action(<span class="hljs-string"><span class="hljs-string">'wp_footer'</span></span>,<span class="hljs-string"><span class="hljs-string">'wp_print_scripts'</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); add_action(<span class="hljs-string"><span class="hljs-string">'wp_footer'</span></span>,<span class="hljs-string"><span class="hljs-string">'wp_enqueue_scripts'</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); add_action(<span class="hljs-string"><span class="hljs-string">'wp_footer'</span></span>,<span class="hljs-string"><span class="hljs-string">'wp_print_head_scripts'</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); } add_action(<span class="hljs-string"><span class="hljs-string">'after_setup_theme'</span></span>,<span class="hljs-string"><span class="hljs-string">'footer_enqueue_scripts'</span></span>);</code> </pre><br>  In this connection, the jQuery library also comes from the footer.  But on a regular site, often inserts with jQuery code are displayed in different places on the page.  To make this code work correctly, crinches from <a href="http://writing.colin-gourlay.com/safely-using-ready-before-including-jquery/">Colin Gourlay are used</a> . <br><br>  Add to head: <br><pre> <code class="javascript hljs">&lt;script&gt;(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">w,d,u</span></span></span><span class="hljs-function">)</span></span>{w.readyQ=[];w.bindReadyQ=[];<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x,y</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x==<span class="hljs-string"><span class="hljs-string">"ready"</span></span>){w.bindReadyQ.push(y);}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{w.readyQ.push(x);}};<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a={<span class="hljs-attr"><span class="hljs-attr">ready</span></span>:p,<span class="hljs-attr"><span class="hljs-attr">bind</span></span>:p};w.$=w.jQuery=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(f===d||f===u){<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{p(f)}}})(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>)&lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre><br>  And in the footer, right after &lt;? Php wp_footer ();  ?&gt;: <br><pre> <code class="javascript hljs">&lt;script&gt;(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$,d</span></span></span><span class="hljs-function">)</span></span>{$.each(readyQ,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i,f</span></span></span><span class="hljs-function">)</span></span>{$(f)});$.each(bindReadyQ,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i,f</span></span></span><span class="hljs-function">)</span></span>{$(d).bind(<span class="hljs-string"><span class="hljs-string">"ready"</span></span>,f)})})(jQuery,<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>)&lt;<span class="hljs-regexp"><span class="hljs-regexp">/script&gt;</span></span></code> </pre><br>  1.3 Yes, Pagespeed Insights believes that fonts that are downloaded from fonts.googleapis.com slow down the page display.  To fix this let's use the recipe from the site <a href="http://css-live.ru/articles-css/bystraya-zagruzka-veb-shriftov-na-adaptivnyx-sajtax.html">css-live.ru</a> <br><br>  The essence of the method is as follows: we convert the fonts into woff, encode them in base64 and connect them with one CSS file, loading it into localStorage.  Before the browser loads the font, the user sees Arial for example. <br><br>  I will not copy-paste, the method is described in great detail by reference. <br><br>  <b>2. Use browser cache</b> <br><br>  For the solution, 2 actions were performed: the Hyper Cache plugin with default settings was installed and the code in .htaccess was added, which gives the 'Expires' headers by file type: <br><br><pre> <code class="nginx hljs">&lt;<span class="hljs-attribute"><span class="hljs-attribute">ifModule</span></span> mod_expires.c&gt; ExpiresActive On <span class="hljs-comment"><span class="hljs-comment"># Cache Images ExpiresByType image/x-icon "access plus 2592000 seconds" ExpiresByType image/jpeg "access plus 2592000 seconds" ExpiresByType image/png "access plus 2592000 seconds" ExpiresByType image/gif "access plus 2592000 seconds" # Cache other content types (Flash, CSS, JS, HTML, XML) ExpiresByType application/x-shockwave-flash "access plus 2592000 seconds" ExpiresByType text/css "access plus 604800 seconds" ExpiresByType text/javascript "access plus 2592000 seconds" ExpiresByType application/javascript "access plus 2592000 seconds" ExpiresByType application/x-javascript "access plus 2592000 seconds" ExpiresByType text/html "access plus 600 seconds" ExpiresByType application/xhtml+xml "access plus 600 seconds" &lt;/ifModule&gt;</span></span></code> </pre><br>  <b>3. Shorten javascript</b> <b><br></b>  <b>4. Shorten CSS:</b> <br><br>  There are plugins, but since the code is not edited every day, it does not make sense to compress it ‚Äúon the fly‚Äù - an extra load on the server.  Therefore, the code js and css is minified every time after editing, through online services. <br><br>  <b>5. Shorten HTML</b> <br><br>  The easiest item.  For html compression, the plugin 'WP-HTML-Compression' was installed and activated. <br><br>  <b>6. Optimize images</b> <br><br>  It turned out that 2800 pictures can be downloaded from the server, run through the Tinygrab web interface, and downloaded back in just 4 hours.  After that, the tinygrab plugin was installed, which presses all of the loaded PNG and JPEG images, up to 500 images per month for free. <br><br>  <b>Total:</b> <br>  If you test a random page of the site, we get the result of 95-99, sometimes Google says that third-party scripts and images slow down the work. <br><img src="https://habrastorage.org/getpro/habr/post_images/884/f75/5f9/884f755f96f8de957dc84c2350e98a31.png" alt="image"><br>  For a more objective assessment, a page was created without third-party scripts, i.e.  no ads, counters and search forms.  Its result varies from 99 to 100 from time to time: <br><img src="https://habrastorage.org/getpro/habr/post_images/954/303/14c/95430314c69d20c38e5ebbfa247f5540.png" alt="image"><br><br>  And to be honest,% username%, I myself am a bit shocked. </div><p>Source: <a href="https://habr.com/ru/post/264033/">https://habr.com/ru/post/264033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264021/index.html">How to transfer a project of 9 million lines of code to a 64-bit platform?</a></li>
<li><a href="../264023/index.html">Increased battery life in Android M</a></li>
<li><a href="../264025/index.html">We are flashing the Upvel UR-313N4G router on OpenWRT</a></li>
<li><a href="../264029/index.html">A game for the little ones is a simple idea that is not a shame to include in the resume</a></li>
<li><a href="../264031/index.html">AccelEpi, or How EPAM Helped in Testing Drugs for Epilepsy</a></li>
<li><a href="../264035/index.html">Chat assistant to the site using Telegram in 15 minutes</a></li>
<li><a href="../264037/index.html">Advanced CSS filters</a></li>
<li><a href="../264039/index.html">Free grid control for Xamarin from DevExpress</a></li>
<li><a href="../264041/index.html">Will GCC C ++ be better for AVR and Arduino?</a></li>
<li><a href="../264043/index.html">FP9: The ability to dig and dig</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>