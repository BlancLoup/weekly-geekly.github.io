<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Keyboard do it yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For me, it all started here with this topic about mechanical keyboards , the desire to learn to type faster (to my shame, until recently I typed with ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Keyboard do it yourself</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b9b/d37/72c/b9bd3772cd12f550ef3794e931f32bde.jpg"><br>  For me, it all started here with <a href="http://habrahabr.ru/post/140454/">this topic about mechanical keyboards</a> , the desire to learn to type faster (to my shame, until recently I typed with two fingers, despite 25 years of programming experience), and the unpleasant feelings recently appeared in my hands after a working day (and indeed, spent at the computer). <br>  I did a short study on what keyboards are for programmers and for those who type a lot, and wrote <a href="http://habrahabr.ru/post/145084/">this</a> overview topic.  I bought myself <a href="https://en.wikipedia.org/wiki/Happy_Hacking_Keyboard">Happy Hacking Lite</a> (a minimalist keyboard with membrane switches), but typing on it turned out to be even less convenient than on a notebook, mainly because of an even more compact arrangement of keys. <br>  Soon, a topic appeared in which the author <a href="http://habrahabr.ru/post/151302/">spoke</a> about the Truly Ergonomic, which he had recently used, which is, perhaps, an almost perfect keyboard from my point of view, but in the comments the author also noted that after two months of use <a href="http://habrahabr.ru/post/151302/">he could</a> not transfer to it completely, and the position of the hands was not at <a href="http://habrahabr.ru/post/151302/">all as well as conveniently</a> as advertised. <br>  A little later, a <a href="http://habrahabr.ru/post/146353/">topic</a> appeared <a href="http://habrahabr.ru/post/146353/">on Kinesis Advantage</a> , which, according <a href="http://habrahabr.ru/post/146353/">to the</a> author, is also not so easy to get used to, and the price just scares. <br><a name="habracut"></a><br><br><h2>  Research </h2><br><br>  Following the link from the first topic, I went to the websites of fans of keyboard lovers, <a href="http://geekhack.org/">American</a> and <a href="http://deskthority.net/">European</a> , where people finished, reworked and made keyboards from scratch.  I studied them, found out everything (I will tell you a lot about this topic), what is needed to assemble the keyboard from scratch, ordered all the necessary parts and tools, and waited. <br>  The list of the necessary is below, but for the seed I will tell you about the two most interesting projects of ergonomic keyboards that I found, and which put the thought ‚ÄúI can also‚Äù into my head. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Bluecube </h3><br><br>  <a href="http://deskthority.net/workshop-f7/my-diy-keyboard-collection-or-how-i-became-a-kb-geek-t2534.html">Keyboard</a> from a homemade craftsman working in a company engaged in the manufacture of plastic products. <br><img src="https://habrastorage.org/storage2/0d3/2d1/81b/0d32d181bc3ceaac64b6bc9fa7c8596e.jpg"><br><br><h3>  ErgoDox </h3><br><br>  <a href="http://ergodox.org/">The keyboard</a> , which evolved from <a href="http://www.key64.org/">Key64</a> , <a href="">through</a> <a href="http://geekhack.org/index.php%3Ftopic%3D19227.0">DoxKB</a> , and reached the stage of <a href="https://www.massdrop.com/buy/ergodox">mass</a> production (albeit with self-assembly of parts) at a price of $ 200. <br><img src="https://habrastorage.org/storage2/a44/c8c/25f/a44c8c25fcd8a8aa19b7a15f318c8aa7.png"><br><br><h2>  Design </h2><br><br>  Both keyboards from the previous section differ from typical keyboards in that they have significantly fewer keys.  This is done by abandoning the number key block, the arrow block and the function key block.  It is worth considering whether they are so often used, and whether it is impossible to press Fn-1 or some other shortcut key instead of F1. <br>  The keys on BlueCube, Ergodox are arranged in even columns, not in even rows.  The same key layout is used in Truly Ergonomic, TypeMatrix and several more keyboards.  This was done for two reasons: firstly, the difference in the length of the fingers, the average is typically longer than the others, and the little finger is shorter, and it is not very convenient for all of them to lie on one row.  Secondly, when using the method of fast ten-finger printing, if you put index keys on serif keys, F and J, and the rest on the keys on the sides of them, try to reach the X key with the ring finger of your left hand without moving the rest of your fingers, or the middle left Hands up to key C. Placing the keys in even columns solves both of these problems. <br>  Another important point used in BlueCube is the combination of modifier keys with such keys as space, Tab, etc.  as follows: if the key is pressed once, the resulting character is a space, and if the key is clamped, and at this moment it is pressed and then released, another key, for example 'q', then the first key is interpreted as a modifier, for example, Shift, and the resulting the character is Q. <br>  It is also worth noting that the thumb, which is practically not used when typing on a conventional keyboard, is more involved here, similar to the Maltron and Kinesis keyboards.  However, the block of keys for thumbs does not seem so convenient that on ErgoDox (and similar on Maltron and Kinesis Advantage), and on BlueCube, where they have to bend right up to the base of the little finger. <br>  Since nothing was holding me back on how the keyboard would look, I decided to just put my hands on the paper and see where it would be convenient for me to reach with my fingers without moving my hands too much.  In the end, I got this sketch: <br><img src="https://habrastorage.org/storage2/27f/d72/bfd/27fd72bfd80d5d08a43b2452007182ed.jpg"><br><br>  which I immediately transferred to the vector editor, but with the keys to which I also applied symbols, arranging them more or less traditionally: <br><img src="https://habrastorage.org/storage2/e86/96c/6b3/e8696c6b339066f8b2be80ac957049b7.png"><br><br>  In total, it turned out that my fingers reach up to 50 keys, and it seems that all the necessary keys are in place (though not always on their own, if viewed from the point of view of traditional layouts).  Is it enough to have 50 keys, considering that on traditional keyboards there are 104 keys (in extreme cases, 87, in the version without a block of numeric keys)?  With the use of the Fn modifier, this becomes possible, because the combinations of letters and Fn are usually not used, and you can hang anything that does not fit on them, but for some reason you need, for example, arrows, Home, End, PgUp and PgDn. <br>  Brown squares under the wrists denote soft lining. <br>  Indicators?  I do not use Caps Lock, there is no separate digital block, so I don‚Äôt need a NumLock, and for what many people need ScrollLock, they probably don‚Äôt even know.  So sweep away the indicators. <br>  The block of keys under the little finger is slightly embarrassing, if suddenly someone else decides to use my keyboard, his little finger can be shorter than my seven-octave one, so I decided to make the little finger under the little finger from the one shown in the figure to parallel to other columns of keys. <br>  Another aspect is the natural position of the hands, which is rather closer to the vertical position of the palms than to the position of the palms down to which we are all accustomed.  This is one of the reasons why I didn‚Äôt buy the Truly Ergonomic keyboard and didn‚Äôt calm down.  This tends to make the keyboard split into two halves, like the Kinesis Freestyle and Ergodox with BlueCube, and tilted. <br><br>  So, according to the plan, the keyboard is split, with a reduced number of keys, with a shifted block for thumbs, with vertical even columns, vertically shifted relative to each other, the left and right blocks are inclined (adjustable, because different sources advise the slope from 15 to 90 degrees relative to the vertical surface, and shifting adjustable blocks under the little fingers, without indicators. <br><br><h2>  Details </h2><br><br>  A short list of what you need: <br><br>  - keyboard switches; <br>  - caps on the switches; <br>  - diodes (why are they needed - a little later); <br>  - microcontroller, allowing the keyboard to be a USB device, and reading the state of the switches; <br><br><h3>  Pay </h3><br><br>  Since I do not evaluate the chance for error-free design of the printed circuit board from the first attempt for myself as extremely low, with LUT and photoresist, I decided to make the wiring for the price of the production for the order in unit volume - high.  The material is textolite used in conventional printed circuit boards.  A friend, fortunately, lay a few plates of fiberglass, which I borrowed.  Chic material, for ease of use comparable only with the blue electrical tape. <br><img src="https://habrastorage.org/storage2/2d0/3c2/ded/2d03c2dedd0941b814484a2f5f519f7b.jpg"><br><br><h3>  Microcontroller </h3><br><br>  Despite my <a href="http://habrahabr.ru/post/161407/">youthful enthusiasm</a> about the bright future of ARM controllers, I nevertheless chose a device based on a more traditional AVR.  Of the most suitable for this application, the Atmega32u4 was identified, with a 32KB ROM, a sufficient number of input / output ports operating in the slave USB device mode, and also able to communicate on I <sup>2</sup> C. The fact that the keyboard would be without a traditional printed circuit board led to the need take the controller on the remote board, and I chose the most compact - <a href="http://www.pjrc.com/teensy/">Teensy</a> .  There <a href="http://deskthority.net/workshop-f7/teensy-2-0-alternatives-atmega32u4-t4253.html">are a lot of</a> options, even from the same manufacturer, and even there are domestic <a href="http://habrahabr.ru/post/161407/">analogues</a> , although for some reason they are <a href="http://habrahabr.ru/post/161407/">more expensive</a> . <br><img src="https://habrastorage.org/storage2/099/104/6c1/0991046c1f24369ff71946b0426acf42.png"><br><br><h3>  Switches </h3><br><br>  The choice of keyboard switches consisted only between mechanical ones from Cherry, the brand known to many by keyboards, and numerous Chinese clones of the now unreleased Alps switches. <br>  Cherry has two main switches, the low-profile <a href="http://www.cherrycorp.com/english/switches/key/ml.htm">Cherry</a> <a href="http://deskthority.net/wiki/Cherry_ML">ML</a> , and the more commonly used <a href="http://deskthority.net/wiki/Cherry_MX">MX</a> , produced in the following <a href="http://www.cherrycorp.com/english/switches/key/mx.htm">main versions</a> : <br>  - black (linear pressing force, medium elasticity, not clicking); <br>  - red (lined, light, not clicking), are popular in gaming keyboards; <br>  - gray (tactile, elastic, not clicking); <br>  - transparent (tactile, medium elastic, not clicking); <br>  - green (tactile, medium elastic, snapping); <br>  - blue (tactile, light, clicking); <br>  - brown (tactile, light, snapping); <br>  - white (tactile, medium elastic, moderately clicking). <br><br>  Based on personal preference, I liked the transparent ones. <br>  Switches are different way of installation.  There is an option for mounting on a printed circuit board, and for mounting on an additional plate.  The former have two additional columns for greater stability, and the latter requires an additional plate for stability.  In this additional plate, you can click the first option. <br>  There are many more modifications of MX, but this is one of those parts that are not so easy to buy, or not so cheap, especially in small quantities, and in not very popular versions - and even more so.  On Ebay, they are sold for nearly $ 4 each, the choice for suppliers of electronic components is very small.  It is remarkable that they organize group purchases on keyboard forums, one of which I fit into.  Unfortunately, it was necessary to either wait or take what was, and I took the blue ones (choosing from red, brown and blue), in the version with installation on a printed circuit board. <br><img src="https://habrastorage.org/storage2/ca9/136/e61/ca9136e61dcd92a38b73a6f0e44eed4d.jpg"><br><br><h3>  Caps </h3><br><br>  Initially, I wanted to buy some old mechanical keyboard, remove the switches from it and remove the caps, but I didn‚Äôt find anything worthwhile. <br>  Since buying a new one, choose one.  <a href="https://www.wasdkeyboards.com/index.php/products/full-keycap-sets.html">A good</a> <a href="https://www.wasdkeyboards.com/index.php/products/keycap-mod-packs.html">choice</a> for WASD Keyboards, I decided to try to take different keys, and took a set of 39 keys of the alphabet block, and two sets of color per sample, to which the keyboard dampers are also included to reduce the clicking effect (the clicking effect of caps on the board, and not internal flip switch effect).  I also need keys of larger size, and I took a few keys, usually used as Tab (1.5x), Alt (1.25x) and Caps Lock (1.75x), in different colors. <br>  Now mainly used cylindrical flasks, in which each row of keys has its own profile. <br><img src="https://habrastorage.org/storage2/8af/546/4fc/8af5464fc5648c1b9481ea9750863130.gif"><br><br>  I didn‚Äôt have a single key from the digital series E in the sets: <br><img src="https://habrastorage.org/storage2/b6e/d47/07c/b6ed4707c7e3834f15f5de88da10e20d.jpg"><br><img src="https://habrastorage.org/storage2/200/2e6/066/2002e6066e2298e1ced53bccdd701417.jpg"><br><br><h3>  Diodes </h3><br><br>  Diodes, namely 50 pcs.  1N4148 in the case of DO-35, which turned out to be easier and cheaper to buy with delivery from England than in local supermarkets selling electronic components. <br><br><h3>  "Lego for adults" </h3><br><br>  Details and tools. <br><img src="https://habrastorage.org/storage2/3cc/ff3/b23/3ccff3b23a2689d68cf931cf61074866.jpg"><br><br><h2>  Layout </h2><br><br><h3>  Iron </h3><br><br>  In order not to waste time, I decided to put together a mock-up and touch it, what could possibly come of all this, and not waste time if I suddenly don‚Äôt like this intermediate result.  Here's what I got: <br><img src="https://habrastorage.org/storage2/faf/e09/e9a/fafe09e9aae6c8c1991436bdb0a0ab94.jpg"><br>  The hand (left, I decided to act on the principle of fitting shoes) is comfortable, reaches all the keys.  Resolved, continue. <br><br><h3>  Microcontroller </h3><br><br>  Teensy comes with a wired flashing light.  Surprisingly, when you connect it with a USB cable to the computer, the little diode really starts blinking.  There is one more example for the site, called the ‚Äúfast-moving light bulb,‚Äù I downloaded it and uploaded it to the device, and the light bulb actually began to flash faster.  Filled the original - again slower.  Well, quite well, the strobe can already be done. <br>  Small swathes with example sources from a site called ‚ÄúUSB keyboard‚Äù, and every 8 seconds a space character is printed on the screen, and when GND is closed with any of the inputs, two characters appear on the screen, indicating the port and foot number, for example B1.  The current is miserable - 135¬µA.  More good luck. <br><br><h2>  Theory </h2><br><br>  How do you connect 50 (and on conventional keyboards, more than double) keys to a microcontroller with 25 I / O ports, leaving a few for things like a mouse? <br>  Everything is quite simple, you need to distribute the keys in rows and columns, forming a matrix.  By applying voltage to column A, and removing this voltage from rows 2 and 3, one can understand that now the keys at the intersection of these rows and this column are in a depressed state.  Voltage is applied to the speakers in turn.  Thus, roughly speaking, I do not need the number of I / O ports equal to the number of keys, but rather a square root of this number, in my case 8x7, that is, 8 outputs and 7 inputs (or vice versa). <br><br>  However, this method has one serious drawback, which is manifested in blocking and disappearing clicks: <br><img src="https://habrastorage.org/storage2/cd6/dfa/cef/cd6dfacef0c6d000ce3fd5aed61ecc77.png"><br>  This figure shows that when the keys W, E and D are pressed, and when the voltage is applied to column B, the false triggering of the key S occurs. Diodes are designed to fight this phenomenon: <br><img src="https://habrastorage.org/storage2/709/2df/f28/7092dff2872685edbdcf8951a6b8a9b2.png"><br><br>  Read more about this <a href="http://www.dribin.org/dave/keyboard/one_html/">here</a> . <br><br>  In addition to this, the USB standard introduces a serious limitation to the printed input devices connected to it, to 6 simultaneously pressed (non-modifying) keys.  Some manufacturers bypass this limitation by emulating the connection of multiple USB devices.  Honestly, I came across this restriction only in my youth, when there was no money for a MIDI keyboard, but I wanted to play a fat chord.  But so, note. <br><br><h2>  A slight pause for thought </h2><br><br><img src="https://habrastorage.org/storage2/d1d/573/ae5/d1d573ae5310aa865b0908bd1c3e33af.jpg"><br><img src="https://habrastorage.org/storage2/1c9/392/608/1c9392608649e3b35cd8728538cf5812.jpg"><br>  At different moments it seemed to me that there were too many keys (yes, yes, no matter how funny it sounds with just 50 keys!).  And when I ordered only 50 switches without any reserve, and when I tried to reach the extreme four keys on the layout with my little fingers, and when I began to think that the seventh column of keys would lead to the need to pull additional wire between the keyboard halves in addition to the cable.  On top of that, these originally planned keys should have been located Escape, Tab, Backspace and Enter, which are already on the keys under your thumbs.  Duplicate makes no sense.  And if you already get used to the new keyboard, so right away, without the ways of retreat. <br><br><h2>  Scheme </h2><br><br>  The scheme is so simple that it doesn't even make much sense to draw it. <br><img src="https://habrastorage.org/storage2/5e2/560/1a8/5e25601a85a7e85138e3ddc221da8b43.jpg"><br><br>  The columns and rows in the matrix correspond to the keys, the thumb block keys are the fourth row. <br>  We supply voltage from the speaker to all incoming legs of the switches of this speaker.  From the outgoing switch legs to the diode anode.  We connect the outputs from the cathodes of all switches in a line, and connect them to the input of a line. <br>  For the right half of the keyboard, 6 outputs and 4 inputs are required, on the left - 6 more outputs, and the inputs can be used the same.  It turns out the matrix 12x4, so much as 18 inputs and outputs, which is somewhat uneconomical.  I will use a 6 by 8 matrix, which is easy to imagine, as one half of the keyboard, located not on the left, but on the bottom of the other, for a total of 14 I / O ports. <br>  It turns out that in the left half of the keyboard will need to lead 10 lived.  The pin connectors I bought are just 10 lived, and they are exactly enough. <br><br>  The legs on the controller can be in two modes: input or output.  The input can be open, in this case, if it is not closed, it can make noise, and it is better to transfer it to the mode with the built-in pull-up resistor turned on, so that if it is not closed to ground, it will always be in state 1. Set the outputs By default, the state is 5V, and while reading a specific column, we lower it to 0V, so that when it is closed with an input, the latter changes to a state of 0, which means that the button is pressed.  Such a connection option leads to a certain misunderstanding in the form of the fact that the current ‚Äúflows‚Äù from the inputs to the outputs. <br>  There are other connection options, where everything is more or less logical, but they provide additional external elements, such as one for all outputs or several external resistors (to save ports with reading through the ADC), but it seems to me that if there is a controller with sufficient the number of ports, he himself has to cope with how he has some leg closed, so - the easiest option, although at first glance and not the most understandable. <br>  The legs of the microcontroller on Teensy are not all derived, and those that are derived - go to each other.  From the ‚Äúsolid‚Äù ports there is only B. Partially bred - F (no legs F2, F3), D (two legs on the bottom end of the board, do not have their own legs, and two more are aligned with I <sup>2</sup> C, C (there are only legs C6 and C7). <br><br>  On the microcontroller, we use the legs of PF0, PF1, PC6, PC7, PF4-PF7, we use the outputs, PB0-PB5 for the inputs (with a pull-up resistor).  We leave the legs of PD0 and PD1 under I <sup>2</sup> C, which will come in handy later for connecting the mouse / trackpoint.  We don‚Äôt touch the PD6 leg, because it is connected to an on-board LED that can be powered by the current applied to this leg and lower the voltage from 5V to ~ 1.7V. <br><br><h2>  Iron </h2><br><br><h3>  Pay </h3><br><br>  Textolite is intended for etching conductive tracks on it.  Since this is not necessary in my case, the foil will have to be removed from it.  This is not so easy to do, since it is much thicker and stronger than the one that we all used to remove from chocolate bars.  It is difficult from the very beginning - to hook a corner of this foil, then, if you take it off with thick stripes, you have to apply a lot of effort, and if you thin it, it tries to break, and you have to look again for a corner.  I was able to identify a fairly simple way: hook from the corner, and lead 1-1.5cm in a spiral to the center of the board. <br><img src="https://habrastorage.org/storage2/22b/333/420/22b333420d44a5e5a61533ae4268cfd4.jpg"><br>  Interesting patterns remain on the PCB, allowing you to understand exactly how the foil was removed. <br><img src="https://habrastorage.org/storage2/bbc/378/4b1/bbc3784b1a64a78aafbce8bd48f7c9ea.jpg"><br><br>  I highly recommend wearing gloves, and removing the foil with pasatizhami, otherwise scratches are inevitable. <br><br><h3>  Drilling </h3><br><br>  I made a sketch of how the switches should be located on the board (boards, because it turns out at least 4 pieces, and for the best layout on the PCB as much as 6 pieces).  In order for them to be fixed on it, the board needs to be drilled.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For each switch, there are 7 holes, two of 0.8mm each, two of 1.2mm each, two of 1.6mm each, and one central 4mm. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Drilling immediately on the printout is not very convenient, so I made a stencil from the old aluminum back cover of the mobile phone: </font></font><br><img src="https://habrastorage.org/storage2/19f/169/0b3/19f1690b387fb12f9c0c8981fc7ba5e3.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cutting and drilling aluminum is not easy, it heats, flies in all directions, therefore I recommend using special safety glasses. As during other operations. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is how the switch looks like it is inserted into the stencil. </font></font><br><img src="https://habrastorage.org/storage2/00f/d9a/b8f/00fd9ab8f1b142fc3696394edae2b81e.jpg"><br><img src="https://habrastorage.org/storage2/508/ce0/d12/508ce0d12e36a411a48491adea29180d.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alas, the cam chuck of a drill is designed for drillings with a tail of maximum diameter 3.4mm, but the 3.5mm drill bit is quite stable. To drill a 4mm hole, they had to make several circular movements. I do not recommend repeating this.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Originally drilled on a wooden substrate, and somewhere on the honeycomb hole, the 0.8mm drill broke under the root, because the textolite shifted relative to the substrate at the moment when the drill was lowered. Later he drilled so that there was nothing under the tectolite. </font></font><br><img src="https://habrastorage.org/storage2/c79/db8/e22/c79db8e2235d7c0c4945502520ee7141.jpg"><br><img src="https://habrastorage.org/storage2/823/015/678/823015678145f3c939ab86a9f634db54.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It turned out one is not too pleasant thing associated with the switches. If they are stuffed into holes that are not exactly drilled out, it can be deformed, and its tactile properties change, to the extent that it does not click, and can even stick. Drill holes wider. Later, I decided to drill with a conventional drill and a 4mm drill, but still half of these large openings would have to be board so that the switches would enter without much effort.</font></font><br><br>  It turned out this: <br><img src="https://habrastorage.org/storage2/31c/883/0a8/31c8830a831433cc73ce2be8bcfcf466.jpg"><br><img src="https://habrastorage.org/storage2/686/eb8/5c3/686eb85c3042a866988b648fcaa54e27.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Feels like - the switches sit in the board very tightly, do not stagger, everyone entered the board without much effort. </font><font style="vertical-align: inherit;">After soldering sit tight. </font><font style="vertical-align: inherit;">To be honest, a rather unexpected result for such handicraft work, is pleased with himself. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despite the apparent unevenness of the hole lines in 2.54mm pitch, the microcontroller and the IDC connector stood up effortlessly and tightly:</font></font><br><img src="https://habrastorage.org/storage2/2c7/e19/0ee/2c7e190ee1049c7be50a737a92c767af.jpg"><br><img src="https://habrastorage.org/storage2/c63/63a/b8e/c6363ab8ea63c66720ced5a13c788933.jpg"><br><img src="https://habrastorage.org/storage2/d9e/bfa/f30/d9ebfaf30dbd2f06cb13b2281bae0f4f.jpg"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Again diodes </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are two options, the first is to solder the diodes in a mounted manner, not the easiest option, considering how many wires will be soldered there. </font><font style="vertical-align: inherit;">The second option is to disassemble the switches, and instead of the local wire, designed to facilitate the wiring of a single-layer printed circuit board, insert a diode. </font><font style="vertical-align: inherit;">Yes, this is a definite work, but it should pay off by simplifying the mounted installation. </font><font style="vertical-align: inherit;">There is a third, correct option, buying switches with a diode right away, but the latter, for some unknown reason, are far from popular, and there is no place to buy them except to order a large batch directly from Cherry.</font></font><br><br><img src="https://habrastorage.org/storage2/ec5/6ed/c49/ec56edc499e1d7bd18d7b20fe1f8ded6.jpg"><br><img src="https://habrastorage.org/storage2/169/e74/76d/169e7476d4c6fd2febb310ada35548f6.jpg"><br><img src="https://habrastorage.org/storage2/8f2/520/3cb/8f25203cba439bd6cc635373df6da585.jpg"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cutting </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The boards need as much as 6 pieces. </font><font style="vertical-align: inherit;">Theoretically, it was possible to make two, but 1) the size of the tectolite pieces does not allow 2) even if allowed, it would turn out to be not very economical 3) there is an opportunity to play the position of the boards relative to each other during the assembly.</font></font><br><img src="https://habrastorage.org/storage2/f85/f31/aa7/f85f31aa711a38431d70a8d06d26ad08.jpg"><br><img src="https://habrastorage.org/storage2/430/d9c/cc3/430d9ccc3af0ecf20f1560934a39a81e.jpg"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Interboard connections </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order not to have to pull the wires between the keyboard halves, I used loops, similar to those used to connect hard disk drives to the motherboard, with only fewer wires, and IDC / BH connectors. </font><font style="vertical-align: inherit;">Of course, it would be more correct to use a twisted pair, but I need more than 8 wires, and the 8P8C connector is also not too compact (and the 10P10C and 10-core twisted pair is not so easy to find). </font><font style="vertical-align: inherit;">Another option would be to use the I / O port multiplexer on the I </font></font><sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></sup><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C </font><font style="vertical-align: inherit;">bus </font><font style="vertical-align: inherit;">, but I decided to postpone this improvement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, IDC connectors angular and straight I got completely different. </font><font style="vertical-align: inherit;">The straight line was not soldered in any way, and the legs fell out of it at the slightest heat, and the corner soldered well. </font><font style="vertical-align: inherit;">Externally did not differ anything.</font></font><br><img src="https://habrastorage.org/storage2/f29/fa6/73b/f29fa673b5c8fb31a87ee693d5cb52b1.jpg"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Soldering </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I can say one thing about soldering - this is not my fad. </font><font style="vertical-align: inherit;">Tyap-bluff, but it works.</font></font><br><img src="https://habrastorage.org/storage2/a91/492/6f0/a914926f0bbc1b1ea33af154a1f79d44.jpg"><br><br><h2>  Firmware </h2><br><br><h3>  Attempt at writing </h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, I got a piece of the keyboard, and it would be time to check if all this works as I expected. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A number of examples go to Teensy, including a USB HID (human interface device), in keyboard and mouse options. </font><font style="vertical-align: inherit;">From the first of these examples, the firmware has grown. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the original example, the calculation is based on the fact that the inputs with the switches are closed to the ground, and when the matrix is ‚Äã‚Äãconnected everything is a little different, voltage is periodically applied to a part of the legs, and during this period the condition of the other legs is read. </font><font style="vertical-align: inherit;">In order for the legs to work as outputs, you need to transfer them to this mode.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the general approximation, the order is as follows: we initialize the ports and USB; </font><font style="vertical-align: inherit;">In the cycle, we alternately apply voltage to the outputs, read the inputs, if the value at the input corresponds to the key pressed, and in the previous reading cycle it was not pressed, we send the key code via USB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I am not a big specialist in C, and when it comes to digging into macros, I‚Äôm getting a little lost, so the code can be a little awkward, but the general sense is to convey: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let the reader forgive my habit of making comments in English.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Firmware code</font></font></b> <div class="spoiler_text"><pre> #include &lt;avr / io.h&gt;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#include &lt;avr / pgmspace.h&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#include &lt;avr / interrupt.h&gt;</font></font><font></font>
 #include &lt;util / delay.h&gt;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#include "usb_keyboard.h"</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
#define CPU_PRESCALE (n) (CLKPR = 0x80, CLKPR = (n))</font></font><font></font>
<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uint8_t matrix [8] [8] = {</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
/ * B0 * / {KEY_TILDE, KEY_Q, 0, 0, KEY_W, KEY_E, KEY_R, KEY_T}, // Top row</font></font><font></font>
/*B1*/ {KEY_SLASH, KEY_A, 0, 0, KEY_S, KEY_D, KEY_F, KEY_G}, // Home row<font></font>
/*B2*/ {KEY_LEFT_BRACE, KEY_Z, 0, 0, KEY_X, KEY_C, KEY_V, KEY_B}, // Bottom row<font></font>
/*B3*/ {0 /*Fn*/, KEY_ENTER, 0, 0, KEY_TAB, KEY_ESC, KEY_SPACE},<font></font>
<font></font>
/*B6*/ {KEY_Y, KEY_U, 0, 0, KEY_I, KEY_O, KEY_P, KEY_EQUAL}, // Top row<font></font>
/*B5*/ {KEY_H, KEY_J, 0, 0, KEY_K, KEY_L, KEY_SEMICOLON, KEY_QUOTE}, // Home row<font></font>
/*B4*/ {KEY_N, KEY_M, 0, 0, KEY_COMMA, KEY_PERIOD, KEY_SLASH, KEY_RIGHT_BRACE}, // Bottom row<font></font>
/*D7*/ {KEY_SPACE, KEY_ESC, 0, 0, KEY_TAB, KEY_ENTER, 0 /*Fn*/}<font></font>
 };<font></font>
<font></font>
 int main (void)
 {<font></font>
  uint8_t state=0, prev_state[8] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};<font></font>
<font></font>
  setup_pins_and_usb();<font></font>
<font></font>
  while (1) {<font></font>
    // B0<font></font>
    PORTB = 0b11111110;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[0], matrix[0]);<font></font>
    prev_state[0] = state;<font></font>
    // B1<font></font>
    PORTB = 0b11111101;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[1], matrix[1]);<font></font>
    prev_state[1] = state;<font></font>
    // B2<font></font>
    PORTB = 0b11111011;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[2], matrix[2]);<font></font>
    prev_state[2] = state;<font></font>
    // B3<font></font>
    PORTB = 0b11110111;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[3], matrix[3]);<font></font>
    prev_state[3] = state;<font></font>
<font></font>
    // B6<font></font>
    PORTB = 0b10111111;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[4], matrix[4]);<font></font>
    prev_state[4] = state;<font></font>
    // B5<font></font>
    PORTB = 0b11011111;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[5], matrix[5]);<font></font>
    prev_state[5] = state;<font></font>
    // B4<font></font>
    PORTB = 0b11101111;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[6], matrix[6]);<font></font>
    prev_state[6] = state;<font></font>
    PORTB = 0b11111111;<font></font>
    // D7<font></font>
    PORTD = 0b00000000;<font></font>
    _delay_ms(5);<font></font>
    state = PINF;<font></font>
    read_row(state, prev_state[7], matrix[7]);<font></font>
    prev_state[7] = state;<font></font>
    PORTD = 0b10000000;<font></font>
   }
 }<font></font>
<font></font>
void read_row(uint8_t state, uint8_t prev_state, uint8_t keys[]) {<font></font>
  uint8_t mask, i;<font></font>
<font></font>
  mask = 1;<font></font>
  for (i=0; i&lt;8; i++) {<font></font>
    if(((state &amp; mask) &gt;&gt; i) == 0 &amp;&amp; ((prev_state &amp; mask) &gt;&gt; i) == 1 ) {<font></font>
      usb_keyboard_press(keys[i], 0);<font></font>
     }<font></font>
    mask = mask &lt;&lt; 1;<font></font>
   }
 }<font></font>
<font></font>
void setup_pins_and_usb() {<font></font>
  // set for 16 MHz clock<font></font>
  CPU_PRESCALE(0);<font></font>
<font></font>
  // Configure PB0-PB6, PD7 as outputs, high state<font></font>
  DDRB = 0b01111111;<font></font>
  DDRD = 0b10000000;<font></font>
  PORTB = 0b01111111;<font></font>
  PORTD = 0b10000000;<font></font>
<font></font>
  // Configure PF0, PF1, PF4-PF7 as inputs, pullup enabled<font></font>
  DDRF = 0x00;<font></font>
  PORTF = 0xFF;<font></font>
<font></font>
  // Initialize the USB, and then wait for the host to set configuration.<font></font>
  // If the Teensy is powered without a PC connected to the USB port,<font></font>
  // this will wait forever.<font></font>
  usb_init();<font></font>
  while (!usb_configured()) /* wait */ ;<font></font>
<font></font>
  // Wait an extra second for the PC's operating system to load drivers<font></font>
  // and do whatever it does to actually be ready for input<font></font>
  _delay_ms(1000);<font></font>
 }
</pre><br></div></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Checked - works. </font><font style="vertical-align: inherit;">Luck.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Firmware firmware </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can continue </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to make a fuss</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> here, but in the firmware lies no less subtleties than in the gland. And I got the idea to use ready-made firmware. From the network, the most noteworthy were two: </font></font><br> <a href="https://github.com/urbanus/clavis/tree/master/common"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clavis</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Used in the </font></font><a href="http://imgur.com/a/rBTpp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">same mod of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> old Wyse WY-85 terminal keyboard. In principle, it looks quite customizable, but out of the box there are not enough of some features that are in the second firmware. </font></font><br> <a href="https://github.com/tmk/tmk_keyboard"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMK Keyboard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Very firmware firmware, used in a </font></font><a href="https://github.com/tmk/tmk_keyboard/tree/master/keyboard"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dozen</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (if not dozens) of keyboard mods and homegrown keyboards. Out of the box has the following capabilities:</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- layering layouts (you can use a single layer for additional useful characters, like a typographical hyphen, etc.); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- emulation of mouse movements using keys; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- can send system key codes: Power Down, Sleep, Wake Up, Volume Down / Up, Mute, Next / Prev track, Play, Stop and others; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- transfer of multiple simultaneous keystrokes (not limited to the USB limit of 6 keys); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- customizable to the smallest details; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- works with keyboard "tricks", namely, it can use the same physical keys for different purposes depending on the type of pressing; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- firmware debug console. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At first there was a problem with sticking keys, but by the time when I finished everything, the problem was already solved. </font><font style="vertical-align: inherit;">My code can be found </font></font><a href="https://github.com/pirj/tmk_keyboard/tree/master/keyboard/hornet"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Layout</font></font></b> <div class="spoiler_text"><pre> #define KEYMAP (\ K00, K01, K02, K03, K04, K05, K40, K41, K42, K43, K44, K45, \ K10, K11, K12, K13, K14, K15, K50, K51, K52, K53, K54, K55, \ K20, K21, K22, K23, K24, K25, K60, K61, K62, K63, K64, K65, \ T30, T31, T32, T33, T34, T70, T71, T72, T73, T74 ) {\ {KC _ ## K00, KC _ ## K01, KC _ ## K02, KC _ ## K03, KC _ ## K04, KC _ ## K05}, \ {KC _ ## K10, KC _ ## K11, KC _ ## K12, KC _ ## K13, KC _ ## K14, KC _ ## K15}, \ {KC _ ## K20, KC _ ## K21, KC _ ## K22, KC _ ## K23, KC _ ## K24, KC _ ## K25} , \ {KC_0, KC _ ## T30, KC _ ## T31, KC _ ## T32, KC _ ## T33, KC _ ## T34}, \ \ {KC _ ## K40, KC _ ## K41, KC _ ## K42, KC_ ## K43, KC _ ## K44, KC _ ## K45}, \ {KC _ ## K50, KC _ ## K51, KC _ ## K52, KC _ ## K53, KC _ ## K54, KC _ ## K55}, \ { KC _ ## K60, KC _ ## K61, KC _ ## K62, KC _ ## K63, KC _ ## K64, KC _ ## K65}, \ {KC _ ## T70, KC _ ## T71, KC _ ## T72, KC_ # # T73, KC _ ## T74, KC_0} \} static const uint8_t PROGMEM keymaps [] [MATRIX_ROWS] [MATRIX_COLS] = {/ ** Layer 0: (lowercase char) * * `qwertyuiop = * \ asdfghjkl;  '* [zxcvbnm,.  /] * / KEYMAP (\ GRV, Q, W, E, R, T, Y, U, I, O, P, EQL, \ SLSH, A, S, D, F, G, H, J, K, L, SCLN, QUOT, \ LBRC, Z, X, C, V, B, N, M, COMM, DOT, BSLS, RBRC, \ FN0, FN1, FN2, FN3, FN4, FN9, FN8, FN7, FN6, FN5), / ** Layer 1: (symbols and navigation) * * 1 2 3 4 5 6 7 8 9 0 - * ‚Ü∞ ‚Üë ‚Ü≥ ‚§í ‚Üê ‚Üì ‚Üë ‚Üí * ‚Üê ‚Üì ‚Üí ‚§ì * / KEYMAP (\ NO, 1, 2, 3, 4, 5, 6, 7, 8, 9, 0, MINS, \ NO, NO, PGUP, UP, PGDN, HOME, LEFT, DOWN, UP, RGHT, SCLN, QUOT, \ NO, NO, LEFT, DOWN, RGHT, END, NO, NO, NO, NO, NO, NO, \ FN0, FN1, FN2, FN3, FN4, FN9, FN8, FN7, FN6, FN5)};  / * * Fn action definition * / // TODO: use [1] = KEYMAP (...) to prevent from changing the index of element?  static const uint16_t PROGMEM fn_actions [] = {ACTION_LAYER_TAP_KEY (1, KC_SPC), // FN0 = L1 symbols ACTION_MODS_TAP_KEY (MOD_LSFT, KD_KH_CH_CH_CH_CF_KC_SPC), // FN1 = Shift with tap Space ACTION_MODS_TKH tap Escape ACTION_MODS_TAP_KEY (MOD_LALT, KC_TAB), // FN3 = Alt with tap Tab ACTION_MODS_TAP_KEY (MOD_LGUI, KC_DEL), // FN4 = Means with Tap ), // FN6 = Shift with tap Enter ACTION_MODS_TAP_KEY (MOD_RCTL, KC_TICT), // FN7 = Ctrl with tap Backspace ACTION_MODS_TAP_KEY (MOD_RALT, KC_RALT), // FN8 = Ctrl with tap Backspace ACTION_MTPST (KC_RALT), // FN8 = Ctrl with tap Backspace ACTION_MTPST_KAP_KEY (MOD_RALT) Meta with tap Tab}; </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Matrix</b> <div class="spoiler_text"><pre> / * Column pin configuration
  * col: 0 1 2 3 4 5
  * pin: F0 F1 F4 F5 F6 F7
  * /
 static void init_cols (void)
 {
     DDRF = 0b00000000;
     PORTF = 0b11111111;
 }<font></font>
<font></font>
 static matrix_row_t read_cols (void)
 {
     return (PINF &amp; (1 &lt;&lt; 0)? 0: (1 &lt;&lt; 0)) |
            (PINF &amp; (1 &lt;&lt; 1)? 0: (1 &lt;&lt; 1)) |
            (PINF &amp; (1 &lt;&lt; 4)? 0: (1 &lt;&lt; 2)) |
            (PINF &amp; (1 &lt;&lt; 5)? 0: (1 &lt;&lt; 3)) |
            (PINF &amp; (1 &lt;&lt; 6)? 0: (1 &lt;&lt; 4)) |
            (PINF &amp; (1 &lt;&lt; 7)? 0: (1 &lt;&lt; 5));
 }<font></font>
<font></font>
 / * Row pin configuration
  * row: 0 1 2 3 4 5 6 7
  * pin: B0 B1 B2 B3 B6 B5 B4 D7
  * /
 static void unselect_rows (void)
 {
     // Hi-Z (DDR: 0, PORT: 0) to unselect
     DDRB = 0b01111111;
     DDRD = 0b10000000;
     PORTB = 0b01111111;
     PORTD = 0b10000000;
 }<font></font>
<font></font>
 static void select_row (uint8_t row)
 {
     // Output low (DDR: 1, PORT: 0) to select
     switch (row) {
         case 0: PORTB &amp; = ~ (1 &lt;&lt; 0);  break;
         case 1: PORTB &amp; = ~ (1 &lt;&lt; 1);  break;
         case 2: PORTB &amp; = ~ (1 &lt;&lt; 2);  break;
         case 3: PORTB &amp; = ~ (1 &lt;&lt; 3);  break;
         case 4: PORTB &amp; = ~ (1 &lt;&lt; 6);  break;
         case 5: PORTB &amp; = ~ (1 &lt;&lt; 5);  break;
         case 6: PORTB &amp; = ~ (1 &lt;&lt; 4);  break;
         case 7: PORTD &amp; = ~ (1 &lt;&lt; 7);  break;
     }
 }
</pre><br></div></div><br><br><h2>  Another pause for thought </h2><br><br>  I came across another <a href="http://deskthority.net/workshop-f7/this-week-s-new-design-t5173.html">very interesting</a> copy of a homemade keyboard, which differs from the others in its simplicity of design, namely the plate on which the switches are mounted. <br>  Not only are the contacts sticking up from the bottom of the board, they are still all hung with wires.  Need something like bottom cap.  The pieces of the board are scattered, and it is not an easy task to fasten them together securely and firmly on the posts I have bought for connecting the printed circuit boards and screws.  It would be ideal if it also served as a stand, giving the whole structure the desired slope. <br><br>  A network search showed that plexiglass has a number of unique qualities, such as low weight, plasticity when heated to 140 degrees, the possibility of cutting with a laser and a cutting machine, drilling, and also a very low cost. <br>  It seems that the textolite idea was the wrong engineering solution, and I bought a 1.5mm thick Plexiglas sheet. <br><img src="https://habrastorage.org/storage2/59f/4f1/6a4/59f4f16a4f19038db34fd55d2a9c9d76.jpg"><br><br>  Everything else, I tried it on, and it seemed to me unnecessarily large distance between the buttons under my thumbs, I decided to slightly reduce it, literally move a millimeter, but it will bring the far key closer to almost half a centimeter.  I tried to use the keys of the standard 1x size, it would be possible to compact a little more with them, but it was not so convenient to press them with the side surface of the thumb. <br><img src="https://habrastorage.org/storage2/1e6/e79/57b/1e6e7957bbe39f68489ab7c505a00051.jpg"><br><br><h2>  Housing </h2><br><br>  Many have already ceased to notice what the price tags and stands are made for the goods in the store, and they are usually made just from this very plexiglass.  There are two ways of bending, the first is heating with a blowtorch along the bend line, and bending along a wooden ruler.  It is fraught with bubbles in the material, fire, and, above all, low accuracy.  The second method is bending under its own weight along the heated wire.  It is a suitable way for a fairly thin plexiglass. <br><br><h3>  Flexion test </h3><br><br>  I needed: a meter of nichrome wire, four screws, a board.  Some guides on the Internet say that the nichrome wire stretches when heated, and it is imperative to use a stretching core.  According to my humble estimates, according to Wikipedia, the increase in the volume of nichrome is slightly less than a millimeter when heated to 200'C and the length of the wire is 30 cm. <br>  Before bending it is very important not to forget to remove the protective film from the Plexiglas. <br><img src="https://habrastorage.org/storage2/994/7d2/e25/9947d2e25ea28ef30abd527996cf8c8b.jpg"><br><br>  Attempts to heat the wire with a ceramic element of a soldering iron failed, as well as a universal power supply for 1A, turned on for 1.5V.  The resistance of a wire section of 30 cm length is about 1 Ohm, and at a current of 1A, a power of 1W is obtained, which, according to calculations, can heat the wire to 150'C for 500 seconds, and only if it does not cool down, but it will. <br>  I need something more powerful, and I took the old AT power supply and connected the ground and 5V wires to the ends.  The effect did not take long, the wire very quickly warmed to a temperature when a drop of water on it instantaneously evaporated. <br><img src="https://habrastorage.org/storage2/2c2/29f/a0d/2c229fa0d1ba9d0db1af439ec72392c4.jpg"><br><br>  The wire is still stretched, and it is so strong that it sags a couple of millimeters, which makes the fold line uneven, and on the sides it is slightly better attached to the sheet being bent, heats it more, even melting slightly.  For the test, of course, it will go, and those ‚Äústretchers‚Äù in the form of joiner dowels are enough, but to make it beautiful and smooth, you need something more reliable. <br><img src="https://habrastorage.org/storage2/172/f5d/562/172f5d5623defab0eb00048bbc74f8e4.jpg"><br><img src="https://habrastorage.org/storage2/fcf/44e/d44/fcf44ed4416ffaa85c86d668220b2505.jpg"><br><br>  The design turns out strong, it bends very weakly, the laptop sits on it like a glove. <br><img src="https://habrastorage.org/storage2/ec0/255/88c/ec025588c58e3b654fb0674a8ffa9220.jpg"><br><br><h3>  Wrist rest </h3><br><br>  I did not find an analogue of English wrist rest in Russian, so let it be ‚Äúemphasis‚Äù, although it is understood that this is the thing on which the brush rests when the wrists lie on it.  I got from the keyboard pad-arm my wife bought (worthy of a separate post), there was an emphasis for the keyboard, and for the mouse.  The latter did not use his wife‚Äôs demand, and therefore I did not fail to use it for my own purposes. <br><img src="https://habrastorage.org/storage2/d8b/5ea/301/d8b5ea301be2ae3c15bf56cdb73e9233.jpg"><br>  Since the emphasis is one and there are two halves of the keyboard, it will have to be cut in half.  Better yet, remove all scratching smooth surface staples. <br><img src="https://habrastorage.org/storage2/66c/a02/e1e/66ca02e1ee3d5acce56ab27982030ff7.jpg"><br><img src="https://habrastorage.org/storage2/6cf/860/8a6/6cf8608a678873c442ed1bc1cfc1b61b.jpg"><br><br>  And it is convenient to connect to the structure. <br><img src="https://habrastorage.org/storage2/fa4/5b3/c3a/fa45b3c3a34139c06b9b03d702307d23.jpg"><br>  The hand on this is comfortable, and you can find several positions in which it is completely relaxed. <br>  Inside - two layers of the gel, the inner is harder, and outside, under a layer of imitation leather, softer, and even slightly sticky. <br><br>  That the design did not slide on a table, I bought the special glued legs. <br><img src="https://habrastorage.org/storage2/b56/925/2be/b569252be38a0d0fc9fb294b81adb99a.jpg"><br><h3>  Cutting through </h3><br><br>  In order for the switches to stand on plexiglass, it is necessary to make a slot in it for them, and snap it.  The cuts are made on proprietary equipment, but this is done quickly and is not expensive. <br><img src="https://habrastorage.org/storage2/b89/dcf/280/b89dcf280ef1b11ff5c9c378d316df9d.jpg"><br><img src="https://habrastorage.org/storage2/978/e16/1c2/978e161c2e9dd0ee86915404049bad58.jpg"><br><br>  In the first version of the case of plexiglass, I made the holes a little larger than necessary, by about 0.3mm, and the switches slightly walked horizontally.  Version two gave me the opportunity to slightly adjust the key layout under my thumbs, not to use engraving (at the engraving site, the material becomes thinner by as much as a third), and actually reduce the size of the holes. <br>  With version two there was the following problem.  On the bottom (second version), the switches do not click (such small things are above and below in the middle of each switch).  At first I thought that I had cut the holes too much, but it turned out (!!!) that the 1.5mm acrylic sheet thickness can reach 1.8mm, and that the switches are designed for 1.5-1.68mm.  I did not expect such a setup, but I was lucky that I ordered four ‚Äúhalves‚Äù at once, and two of them turned out to be of normal thickness, and the switches clicked on them as well as possible. <br><img src="https://habrastorage.org/storage2/c2c/486/834/c2c48683445948d8e5fe8b735412b9ac.jpg"><br><img src="https://habrastorage.org/storage2/8e4/f10/ad8/8e4f10ad81feb01c5f7d56281fe9c181.jpg"><br><br><h3>  Softeners </h3><br><br>  Many people remember that mechanical keys make a lot of noise.  This is connected not only with the operation of the mechanism, but also with the fact that after the switch is triggered with a strong and quick press, the key goes all the way to the stop, and knocks on this stop.  To level this effect, there are special rubber rings that prevent contact.  There are many types of them, including in my set there were 3 different types. <br><img src="https://habrastorage.org/storage2/be2/7e8/09b/be27e809bccb873c3c6b42fef1ee0452.jpg"><br><br>  I decided to try everything, albeit limited in quantity.  Black went to the "home" line, red - up, blue - down.  Color keys and extreme columns of the ringlets did not get. <br><img src="https://habrastorage.org/storage2/c31/9a8/d1a/c319a8d1a2dd786d3469cce2f819a76e.jpg"><br><br><h3>  Controller mount </h3><br><br>  I had SP-3 interboard racks, and I tried to drill holes in plexiglass, but somehow they didn‚Äôt enter the hole even 5mm, and my exact drilling limit was 3.5mm, so I bit off their fasteners, drilled them along the axis, and attached the controller in just such a simple way, passing the wires of the twisted pair round. <br><img src="https://habrastorage.org/storage2/a93/247/4dc/a932474dcd7db5f85ef0569a89f1259c.jpg"><br><img src="https://habrastorage.org/storage2/385/a67/d6d/385a67d6d94bb562e18d5b6bc1ed7b23.jpg"><br><img src="https://habrastorage.org/storage2/155/06d/f4e/15506df4ed4630ab5a79f1e511545d5e.jpg"><br><br>  Keeps on just fine. <br><br>  Yes, of course I had to rewrite almost everything again, but having already some experience in this matter is already a little easier and faster.  I slightly changed the assignment of the inputs-outputs, so that it would be easier with loops and IDC connectors (PF0, PF1, PF4-PF7 for outputs, PB0-PB3 for inputs of the left half, PB4-PB6, PD7 for inputs of the right half). <br><img src="https://habrastorage.org/storage2/e9e/5c6/7e3/e9e5c67e33eea95b94fcb7a979b19a3c.jpg"><br><img src="https://habrastorage.org/storage2/307/077/b9d/307077b9d196a90e6a30979537c5ebb1.jpg"><br><br><h3>  Flexion </h3><br><br>  Trial bending was not so bad in principle, but I wanted to make the bend line more equal, and I attached a spring removed from the door lock with a latch. <br><img src="https://habrastorage.org/storage2/ead/ea7/ff1/eadea7ff13d321a4fbd784d0583bde30.jpg"><br><img src="https://habrastorage.org/storage2/5b2/6f1/0cc/5b26f10cc71a68f2b96251226c6957e3.jpg"><br><img src="https://habrastorage.org/storage2/cdc/310/dc1/cdc310dc1b50726084e361a6805cba49.jpg"><br><br><h3>  The inscriptions on the keys </h3><br><br>  Despite the fact that with a specific layout, I have not yet decided whether to use QWERTY, <a href="http://colemak.com/">Colemak</a> , <a href="http://workmanlayout.com/">Workman-P</a> or whatever, but I have already chosen the font for the keys, this is <a href="http://typodermicfonts.com/neuropol-nova/">Neuropol Nova</a> from Typodermic.  Selected because of futuristic, excellent design and the ability to make a stencil.  Everything else, the author <a href="https://twitter.com/typodermic/status/309018932692516864">kindly agreed</a> to use this commercial font for my purposes.  The stencil is cut in the same place as plexiglass, and looks like this: <br><img src="https://habrastorage.org/storage2/798/321/2d5/7983212d5d9772a07dd06285efdb8f8e.jpg"><br><br><h3>  Layout </h3><br><br>  The current layout: <br> <code>` qwertyuiop = <br></code> <br> <code>\ asdfghjkl ; ' <br></code> <br> <code>[ zxcvbnm , . / ] <br></code> <br><br>  Russian letters are on the same keys as usual.  The arrangement is standard, only the letter X has moved left to the left of I. <br><br>  A number of modifiers (color) includes both modifying keys and ordinary ones.  Modifiers work when pressed in combination, and when pressed once - the usual. <br><br>  Single: <br> <code>          <br></code> <br> <code>Spc Spc Esc Tab Del Tab AGr Bsp Ent Ent <br></code> <br><br>  Combination: <br> <code>Lr1 Sft Ctl Alt Met Met AGr Ctl Sft Lr1 <br></code> <br><br>  The second layer works in combination with red keys.  The shooter, in my opinion, they even bust.  Two options, for Vim fans - on the right (hjkl), and for WASD fans - on the left (dxcv actually). <br> <code>1 2 3 4 5 6 7 8 9 0 - <br></code> <br> <code>‚Ü∞ ‚Üë ‚Ü≥ ‚§í ‚Üê ‚Üì ‚Üë ‚Üí <br></code> <br> <code>‚Üê ‚Üì ‚Üí ‚§ì <br></code> <br><br><h2>  Results </h2><br><br><h3>  Labor costs </h3><br><br>  Soon the topic is read, but it's not done soon. <br>  If I had originally designed the design correctly, then in principle everything would take 10 hours. And so - two months to wait for some details, and another three months to build and refine all of this. <br><br><h3>  Finance </h3><br><br><table><tbody><tr><th>  Detail </th><th>  Price </th></tr><tr><td>  Teensy 2.0 microcontroller with legs </td><td>  780 </td></tr><tr><td>  Cherry MX MX1A-E1JW Switches (Blue) </td><td>  1110 </td></tr><tr><td>  Switch caps </td><td>  900 </td></tr><tr><td>  Plexiglass </td><td>  150 </td></tr><tr><td>  Cutting plexiglass </td><td>  350 </td></tr></tbody></table><br><br>  Total: 3290 rubles. <br><br>  I did not include such trifles as solder, wires, cable, plugs and diodes.  I got the last ones very inexpensively, despite the expensive delivery, but if you smudge by the total amount ordered, you get something like 25 kopecks per piece at a store price of 6 rubles. <br>  I got a free wrist stand, you can buy it for about $ 20. <br>  I spent quite a lot on tools, but this will come in handy more than once.  Some inexpensive ones (tweezers with heat-resistant plastic levers, which immediately melted at 200'C, a magnifying glass through which nothing can be seen, nippers that do not bite very much) were cheap, but served for a very short time. <br><br><h3>  Impressions </h3><br><br>  While typing on this keyboard is not so much.  Surely I will find something to improve in the layout.  In general, it is convenient, even very. <br>  I foresee comments like "what about the xxxx key?".  Only two layers are involved in my tmk_keyboard modification.  You can add at least 30 more, and stuff all possible keys there. <br>  For comments like ‚Äúhow will you press the xxx + yyy + zzz keyboard shortcuts?‚Äù I can answer that I specifically chose software not to torture my fingers (Linux, Awesome, Vim, Chromium + Vimium, Zathura).  The most difficult combination of those that I use is Ctrl + Meta + [1-9], combining several virtual desktops into the current one.  Now it works by pressing orange, green, lilac and pressing the number on the top row, it‚Äôs not very convenient, but I‚Äôll definitely figure out how to do it easier. <br><br><h3>  Improvements that I want to make in version 2 </h3><br><br>  Found a great I / O port expander NXP PCF8574AP in a DIP package.  It is possible to replace the interboard cable with a thin four-core wire.  I do not understand yet whether it is worth contacting I <sup>2</sup> C, according to rumors, the protocol is very slow, and a lot of time in the work of the firmware is spent on it.  As an option - use shift registers 74HC164 and 74HC165. <br><br>  There is a strong desire to replace Teensy with a bare AVR with the number of inputs and outputs sufficient for one half of the keyboard, and entrust the other half to PCFs.  There is another option to make on the basis of a microcontroller from Microchip, PIC18F25K50, it is even cheaper, and among other things, it does not need external quartz to work with USB. <br><br>  Make a printed circuit board, so that there is no this mounting, preferably thin and bending.  Ideally, all components, such as a controller, diodes, a capacitor, and a programming button, are already soldered onto it. <br><br>  Add a trackpoint on the Hall sensor, preferably between the HJNM keys, and three buttons under the mouse (it is possible to use the keyboard keys).  I still do not understand where it will be convenient for the hands to find them. <br><br>  Try transparent or red (after <a href="http://geekhack.org/index.php%3Ftopic%3D42189.0">this</a> note here) switches Cherry MX. <br><br>  Make a case of 1.5mm plywood instead of plexiglass.  Not so beautiful, but.  Plywood is easy to work, less fragile.  When properly treated, it is durable and resistant to moisture.  It is harder to bend, but with such a thickness should not be so hard.  On top of that, you can make the construction of several sheets, making slots and pins, so that it can be assembled, disassembled, on the principle of Lego.  There is confidence that the thickness of the plywood does not walk on the area of ‚Äã‚Äãthe sheet by + 20% in contrast to the Plexiglas. <br><br>  Make an inexpensive, adjustable in position and with a mount for both halves of the keyboard arm-arm mounted on a flat surface. <br><br>  PS <br>  And yes, of course, how could I forget! <br><img src="https://habrastorage.org/storage2/4ba/3f4/c39/4ba3f4c398ad2e8d50914439a52cf5f8.jpg"></div><p>Source: <a href="https://habr.com/ru/post/177347/">https://habr.com/ru/post/177347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../177331/index.html">In Kiev, Kiev Games Night was held on the topic "How to open your game dev studio"</a></li>
<li><a href="../177333/index.html">Is there life in the world of PostPC? Part 2: daily work in iOS</a></li>
<li><a href="../177335/index.html">Dropcam Review: HD Monitoring with iOS, Android and Web</a></li>
<li><a href="../177337/index.html">Talk about a startup</a></li>
<li><a href="../177343/index.html">How we built cellular communications in Cambodia: part 2, about people</a></li>
<li><a href="../177349/index.html">Budget solution for backup of the whole office</a></li>
<li><a href="../177351/index.html">RigidBot, a budget 3D printer not inferior to the leaders</a></li>
<li><a href="../177355/index.html">The secret visual information sharing scheme</a></li>
<li><a href="../177357/index.html">Uninterrupted operation (HA) for OpenStack MySQL + rabbitMQ services</a></li>
<li><a href="../177359/index.html">The digest of interesting news and materials from the world of ayti for the last week No. 53 (April 13 - 19, 2013)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>