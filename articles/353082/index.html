<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Desperate quad circle search</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Search for the mysterious mathematics on which the figure is based in iOS 


 This is a story about how one Figma engineer searched for the perfect an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Desperate quad circle search</h1><div class="post__text post__text-html js-mediator-article"><h3>  <font color="gray">Search for the mysterious mathematics on which the figure is based in iOS</font> </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/67d/858/d99/67d858d99e59b4f153c523d4005d52da.png"><br><br>  <i>This is a story about how one Figma engineer searched for the perfect answer to a programmer's task.</i> <br><br><hr><br>  In a famous interview in 1972, Charles Imz briefly answered a <a href="http://www.eamesoffice.com/the-work/design-q-a-text/">few fundamental questions about the nature of design</a> .  Answering the first question, he defined the design as ‚Äúthe layout of the elements to achieve a certain goal‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The rest of the answers are also very concise, right down to the metaphors.  But when Imza was asked about the role of design constraints, he stopped and gave the longest and most thoughtful answer for the entire interview: ‚ÄúOne of the few effective keys to the design problem is the designer‚Äôs ability to recognize as many constraints as possible;  his willingness and enthusiasm for working in these constraints. " <br><br>  Although I am not a designer by profession - I am a developer of <a href="https://www.figma.com/">Figma</a> , a web-based collaborative design tool - it‚Äôs easy to see that Imza‚Äôs comments apply to my work.  Instead of UI elements, I compose mathematical concepts in code to create tools and functions.  And the limitations of time, simplicity, support, and even aesthetics play a similar dominant role in my work. <br><a name="habracut"></a><br>  One recent project emphasizes these parallels particularly well.  I was assigned to somehow add to Figma support for an Apple figure with a fancy name ‚Äúsquircle‚Äù.  I began to study the topic. <br><br>  <b>The study turned into a real mathematical Odyssey, full of false starts, hidden problems, constraints, intelligence, tension - and resolution.</b>  In short, it was a story that, to a certain extent, every designer goes through almost every day. <br><br>  In order to give pleasure to mathematical geeks like me and to show the entire design process using mathematics, each step is described below: from the first square to the final result. <br><br><h1>  Quad circle: rounding operator </h1><br>  The story began long before I founded Figma, namely on June 10, 2013 - on the day of the release of iOS 7. The new OS had some kind of barely noticeable update: the application icons on the main screen became more rich, more organic.  Instead of a square with rounded corners, each icon turned into a <i>quad circle</i> (squircle, a combination of the words "square / rectangle" and "circle"). <br><br>  You ask, what's the difference?  To be honest, it is small: an ordinary rectangle with rounded corners is taken as a basis, but it is slightly processed with a file in the places where curves start.  Therefore, the transition from a straight line to a curved line becomes less sharp. <br><br>  If it is accurately formulated in the language of mathematics, then the quadric-circle has a continuous curvature of the perimeter, while a rounded square does not.  This may seem trivial, but it subconsciously does have a big impact: a quad circle does not look like a processed square;  it is perceived as a separate authorized entity, as a form of a smooth pebble on the bottom of the river - a single and elementary whole. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dbe/461/cb9/dbe461cb981dbb83e25db98377c1bc13.png"><br>  <i><font color="gray">1.1.</font></i>  <i><font color="gray">Comparison of a rounded square and quad circle: obviously, the difference is small</font></i> <br><br>  Industrial designers have long known how important rounding is for object perception.  Look closely at the corners of the Macbook or at the old-style case for wired headphones under a desk lamp.  Notice how difficult it is to find a position in which the corners throw sharply contrasting glare. <br><br>  The reason is the continuity of rounding, which are specially designed by designers.  It is not surprising that Apple, which has a unique experience in developing both software and hardware, ultimately applied the ideas of industrial design in the design of interfaces, making its icons look like physical things of their own production. <br><br><h1>  From form to formula </h1><br>  Of course, at Figma, we love iOS designers and we believe that our users should always have the right platform elements at hand.  To give them access to this new form when designing, you need to find the exact mathematical description.  Then we will begin to figure out how to embed this form in our tool. <br><br>  Fortunately, people are asking this question since the release of iOS 7. Of course, we are not the first to follow this path!  <a href="https://www.cocoanetics.com/2013/06/ios-7-icon-squircle/">The original fundamental work of</a> Mark Edwards contained a screenshot indicating that the shape of the icon is a special generalization of the ellipse called the superellipse.  The following mathematical formula describes circles, ellipses, and superellipses, depending on the choice of <i>a</i> , <i>b,</i> and <i>n</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e37/e73/cc1/e37e73cc191628cb2df5d290d3a751f5.png"><br>  <i><font color="gray">2.1.</font></i>  <i><font color="gray">Superellipse formula</font></i> <br><br>  Say, if you choose <i>n</i> = 2, <i>a</i> = 5 and <i>b</i> = 3, you get a normal ellipse with large semi-axes 5, oriented along the <i>x</i> axis, and small semi-axes 3, oriented along <i>y</i> .  If we leave <i>n</i> = 2 and choose <i>a</i> = <i>b</i> = 1, then we get an ideal circle of unit radius.  But if you choose <i>n</i> more than two, you get a super-ellipse - a rounded elliptical shape that begins to merge with the shape of the rectangle in which it is inscribed, where the angles become perfectly straight if <i>n</i> tends to infinity.  Initially it was assumed that Apple chose a form with <i>n</i> = 5. If you <a href="https://www.wolframalpha.com/input/%3Fi%3DParametricPlot%255B%257BSign%255BCos%255Bt%255D%255D%2B*%2BAbs%255BCos%255Bt%255D%255D%2B%255E%2B%25282%252F5%2529,%2BSign%255BSin%255Bt%255D%255D%2B*%2BAbs%255BSin%255Bt%255D%255D%2B%255E%2B%25282%252F5%2529%257D,%2B%257Bt,%2B0,%2B2%2B*%2BPi%257D%255D">try this formula</a> , you will see that it is really very close to that used in iOS 7+. <br><br>  If the true description were really so, then we could simply apply some reasonable number of Bezier curves ‚Äî and then neatly integrate the new concept into Figma.  But unfortunately, a <a href="https://applypixels.com/the-hunt-for-the-squircle/">careful subsequent analysis</a> showed that the superellipse formula does not quite fit (although these days true superellipses are <i>actually</i> used as other icons).  In fact, for all variants of <i>n</i> in the above equation there is a small but systematic discrepancy compared with the actual shape of the icon. <br><br>  This is the first dead end in history: we have an elegant, simple equation for something very similar to the quad-circle iOS, but it is fundamentally wrong.  But we must give our users the right equation. <br><br>  Moving forward requires serious effort, and again I am happy to harvest the crops sown by others.  One researcher, Mike Swanson of Juicy Bits, hypothesized that the angles of a quad circle are based on a sequence of Bezier curves.  He <a href="http://blog.mikeswanson.com/post/62341902567/unleashing-genetic-algorithms-on-the-ios-7-icon">applied a genetic algorithm</a> to optimize the similarity with the official form of Apple.  The results obtained correspond to the original, as proved by <a href="http://www.mani.de/backstage/%3Fp%3D483">an excellent direct comparison of</a> Manfred Schwind, who studied the iOS code that directly generates the icons.  Thus, we have two different approaches that give the same structure of Bezier curves: the quad-circles of iOS 7 have been cracked and double-checked by independent researchers, and we don't even need to calculate anything! <br><br><h1>  File in action </h1><br>  Two important details remain that prevent us from cloning the form directly into Figma. <br><br>  First, the surprising fact is that the version of the iOS formula (at least during the study) is made with some quirks - the corners are not quite symmetrical, but on the one hand there is a tiny straight segment that should not be here explicitly.  We do not need it, because it complicates both the code and the tests, it is easy to remove it by simply mirroring half the corner where the bug is missing. <br><br>  Secondly, when aligning the aspect ratio of a real rectangle from iOS, the shape of the icon changes dramatically from the quad circle we need to a completely different shape.  Designers will be unpleasant such a quirk, and it makes it clear to determine what forms "should" manifest under certain conditions. <br><br>  The most natural and useful behavior in the alignment of a quad circle would be the gradual disappearance of smoothing until there is no place for the transition between the round and straight parts of the angle.  Further alignment should reduce the radius of the rounded section, which corresponds to the current Figma behavior.  The Apple quad-circle formula here doesn‚Äôt help us much, because the rounding is done in a fixed way: it doesn‚Äôt give instructions on how to approach or move away from the old rectangle with rounded corners.  What we really need is a <i>parameterizable</i> rounding, where a certain parameter value fits very closely with the shape of Apple. <br><br>  As an additional bonus, if we can parameterize the transformation of a rectangle with rounded corners into a quad circle, then we can fully apply the same process in other places of Figma where rounding is used: stars, polygons and even corners in arbitrary hand-drawn vector networks.  Despite the complexity, it starts to look much more complete and valuable than just adding the quad quad iOS 7. Now we give designers an infinite variety of new forms to use in many situations, and one of them corresponds to the icon of the quad circle with which it all started. <br><br>  The requirement that our quad-circle rounding pattern be smoothly adjusted, but at the same time conforms to the shape of iOS 7 at a certain convenient point from the adjustment range - this is the first limitation in our history that has arisen and is difficult to satisfy.  For a ballerina, a similar task would be to design a whole leap over one photo in flight, so that at a certain point the phase of the jump would correspond to the photo.  Sounds damn hard.  So maybe you still need some kind of calculation? <br><br><h1>  Powerful tool: differential geometry of flat curves </h1><br>  Before plunging into the parametrization of quad-circles, let‚Äôs step back and blow away the dust from some formal tools that will help us analyze what is happening.  First of all, you need to decide <i>how</i> to describe a quadro-circle.  Previously, in the case of superellipses, we used the equation with <i>x</i> and <i>y</i> , where all points ( <i>x, y</i> ) on the plane satisfying the conditions of the equation derived the superellipse.  This is elegant in the case of a simple equation, but real quad-circles are a patchwork of connected Bezier curves, which leads to uncontrolled accumulation of equations. <br><br>  We can cope with this complication using a more explicit approach: take one variable <i>t</i> , restrict it to a finite interval and compare each value of <i>t</i> in this interval with a separate point on the perimeter of the quad circle (in fact, Bezier curves are almost always represented in this way).  If we concentrate only on one of the angles, thereby limiting our analysis to a curved line with a clear beginning and end, then we can choose such a mapping between <i>t</i> and an angle, so that <i>t</i> = 0 corresponds to the beginning of the line, <i>t</i> = 1 corresponds to the end of the line, and a smooth change in <i>t</i> from 0 to 1 smoothly traced the rounded portion of the corner.  In mathematical language, we describe our angle of the curve <i>r (t)</i> , which is structured as <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b18/65a/f61/b1865af61c8a16a9e85fa92e12a9190c.png"><br>  <i><font color="gray">4.1.</font></i>  <i><font color="gray">Bijection of a flat curve with [0,1]</font></i> <br><br>  where <i>x (t)</i> and <i>y (t)</i> are separate functions of <i>t</i> for the <i>x</i> and <i>y</i> components of r.  We can imagine <i>r (t)</i> as a peculiar history of the path, say, of your trip by car.  For each time point <i>t</i> between departure and arrival, you can estimate <i>r (t)</i> and get your car's position on the route.  From the path <i>r (t),</i> we can derive the speed <i>v (t)</i> and the acceleration <i>a (t)</i> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/e6e/793/e6ee6e793f60a17b7e5561245cf2218f.png"><br>  <i><font color="gray">4.2.</font></i>  <i><font color="gray">Speed ‚Äã‚Äãand acceleration of a flat curve</font></i> <br><br>  Finally, the mathematical curvature, which plays a major role in our history, in turn, can be expressed in terms of speed and acceleration: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/11e/466/2f5/11e4662f55dce10cd371c4a2a5fc1b4a.png"><br>  <i><font color="gray">4.3.</font></i>  <i><font color="gray">Unsigned curvature of plane curves</font></i> <br><br>  But what does this formula really mean?  Although it may look a bit complicated, the curvature has a simple geometric structure, originally due to Cauchy: <br><br><ol><li>  The center of curvature <i>C</i> at any point <i>P</i> along the curve lies at the intersection of the normal line to the curve in <i>P</i> and the other normal line taken infinitely close to <i>P.</i>  (As a note, a circle centered in <i>C</i> is called an oscillating circle in <i>P</i> , from the Latin verb <i>osculare</i> , which means ‚Äúkiss.‚Äù Isn't that wonderful?) </li><li>  The radius of curvature <i>R</i> is the distance between <i>C</i> and <i>P.</i> </li><li>  The curvature <i>Œ∫</i> is the reciprocal of <i>R.</i> </li></ol><br>  As shown above, the curvature <i>Œ∫ is</i> non-negative and does not differ by turning it right or left.  Since this difference is important to us, we form a <i>Œ∫</i> sign curvature <i>k</i> , assigning a positive sign if the curve turns to the right, and a negative sign if to the left.  This concept can also be compared with driving a car: at any point <i>t, the</i> sign curvature <i>k (t)</i> is simply the angle the steering wheel turns at time <i>t</i> , with a plus sign for turning right and minus for turning left. <br><br><h1>  Geometry taxis: parameterization of the arc length </h1><br>  With the introduction of curvature, only a few details remain to be settled.  First, let's imagine for a moment two cars moving along the corner of a quad;  one car accelerates sharply, and then it slows down all the time, while the other one evenly runs to the very end.  These two different ways of driving will give rise to very different path histories, even with the same trajectory.  We are concerned only with the shape of the corner, and not with the way to achieve it, so how can they lead to a common denominator?  Here the main thing when marking the points of history is not to use time, but the cumulative distance traveled, that is, the length of the arc.  That is, instead of asking the question ‚ÄúWhere was the car ten minutes away?‚Äù It‚Äôs better to answer the question ‚ÄúWhere was the car ten <i>miles</i> from the start of the trip?‚Äù.  This way of describing the trajectory captures only the geometry and nothing more. <br><br>  If we have some history of the path <i>r (t)</i> , we can always extract the arc length <i>s</i> as a function of the time <i>t of the</i> path, integrating the speed as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/098/095/f63/098095f63ce3fe92fae53236dcb08856.png"><br>  <i><font color="gray">5.1.</font></i>  <i><font color="gray">Arc length integral</font></i> <br><br>  If we can invert this relation and find <i>t (s)</i> , then we can substitute it in place of <i>t</i> in our history for the path <i>r (t)</i> to get the desired parametrization of the arc length <i>r (s)</i> .  Parameterization of the arc length for a path is equivalent to the history of the path of a car moving at unit speed, so it is not surprising that the speed <i>v (s) is</i> always the unit vector and the acceleration <i>a (s) is</i> always perpendicular to the speed.  Consequently, in the variant with parametrization along the arc length, the description of the curvature is simplified only to the magnitude of the acceleration. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/377/52d/7f8/37752d7f83255f5ad89be32ee0d3bc1e.png"><br>  <i><font color="gray">5.2.</font></i>  <i><font color="gray">Curvature in option with parameterization by arc length</font></i> <br><br>  And you can set the corresponding right or left character to form the signed curvature <i>k (s)</i> .  Obviously, most of the complications in the more general definition of curvature were simply the non-geometric content of the path history.  In the end, the curvature is a purely geometric quantity, so it is very nice to see that it looks simple in geometrical parametrization. <br><br><h1>  Design the curvature, calculate the curve </h1><br>  Now for another detail.  We have just figured out how to go from describing the history of the path <i>r (t)</i> to the description by the arc length parameter <i>r (s)</i> and how to extract the sign curvature <i>k (s)</i> from it.  But can we do the opposite?  Design a curvature profile - and draw a parent curve from it?  Let's look again at the analogy with the car: suppose that when we were driving at a constant unit speed throughout the route, we fixed the position of the steering wheel continuously throughout the journey.  If we take this steering data and then transfer it to another driver, will he be able to fully restore the route, if he correctly reproduces the steering wheel positions and drives at exactly the same speed?  Intuitively, we have enough information to restore the parental curve, but how does this calculation look mathematically?  Although a bit rough, but this is possible thanks to Euler through the parameterization of the arc length.  If we choose such a coordinate system so that the curve starts at the origin and is initially directed along the <i>x</i> axis, then <i>x (s)</i> and <i>y (s)</i> can be reconstructed from <i>k (s)</i> as follows: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a7e/372/fed/a7e372fedc1b9054f4ca7800175f27d1.png"><br>  <i><font color="gray">6.1.</font></i>  <i><font color="gray">Recovery of a curve by its curvature</font></i> <br><br>  Finally, notice the argument of the sine and cosine functions: this is the integral of the sign curvature.  Usually, trigonometric functions specify angles in radians as arguments.  So it is in our case: the integral from <i>a</i> to <i>b is the</i> signed curvature - this is the course in <i>b</i> minus the course in <i>a</i> .  Thus, if you take a rectangle and round the corner as you please, measure the curvature of the rounded part and integrate the result, in the end we will always get <i>œÄ / 2</i> . <br><br><h1>  Quadro Circle Anatomy </h1><br>  Having dealt with the details, apply these analytical tools to some real forms.  Let's start with the rounded corner of the rectangle, with the radius of the angle equal to one.  First we construct the angle itself, and then the curvature as a function of the arc length: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cae/abb/c44/caeabbc44f254c4ca87e5fa96e2c5666.png"><br>  <i><font color="gray">7.1.</font></i>  <i><font color="gray">Curvature Analysis of a Rounded Rectangle</font></i> <br><br>  Now we repeat the process for the corners of real Apple quadro circles ‚Äî and see that their curvature is very different: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e52/ee7/6b9/e52ee76b9618883bfcc721a73fda64a7.png"><br>  <i><font color="gray">7.2.</font></i>  <i><font color="gray">Analysis of the curvature of the quad-circle iOS 7</font></i> <br><br>  The curvature looks quite jagged, but this is not necessarily bad.  As we will see later, you can find a compromise between a smooth curve of curvature and a small number of Bezier curves, and there are only three in the corner of iOS.  As a rule, designers are ready to sacrifice a mathematically perfect curvature profile for the sake of reducing the number of Bezier curves.  Discarding the details, the overall picture appears on the right graph: the curvature rises, aligns in the middle, and then returns down. <br><br><h1>  Breakthrough: Parameterized Smoothing </h1><br>  Bingo!  In this last observation lies the key to how to parametrize the smoothing angle of our quad circle.  With zero smoothing, the curvature profile will look like a rounded rectangle: in the form of a tabletop.  As the smoothing gradually increases, the height of the tabletop remains unchanged, but its edges turn into steep slopes, forming an isosceles trapezoid profile (of course, still with a common <i>œÄ / 2</i> angle).  When smoothing approaches a maximum, the flat part of the trapezoid disappears - and we get a wide isosceles triangle, whose height corresponds to the height of the original table top. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b06/984/52c/b0698452cc33b5e467d5997d4bf68b0f.png"><br>  <i><font color="gray">8.1.</font></i>  <i><font color="gray">Curvature profiles for different values ‚Äã‚Äãof the smoothing parameter</font></i> <br><br>  Let us try to express this sketch of the curvature profile in mathematical terms, using <i>Œæ</i> as the smoothing parameter, which varies from zero to one.  To provide for use with other forms where there are no right angles, we will also introduce a rotation angle <i>Œ∏</i> , which in the case of a rectangle is <i>œÄ / 2</i> .  Combining them together, we can express a piecewise continuous function in three parts: one for lifting curvature, one for a flat top, and a third for descending: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/656/8bd/a0c/6568bda0c9a53f669f2b4d8f116dfc49.png"><br>  <i><font color="gray">8.2.</font></i>  <i><font color="gray">Parameterization of the curvature profile of a quad</font></i> <br><br>  Note that the first and third parts (ascent and descent) disappear when <i>Œæ</i> approaches zero, and the middle part (flat top) disappears when <i>Œæ</i> approaches unity.  Above, we have shown how to go from the curvature profile to the parent curve.  Let's try to do this on the first equation, which describes a line whose curvature starts from zero and increases steadily.  First, we make a simple inner integral: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/742/fc0/d64/742fc0d64dc1b3b80affdca51d61176f.png"><br>  <i><font color="gray">8.2.</font></i>  <i><font color="gray">The first integral of 6.1 as applied to equations 8.2</font></i> <br><br>  So far, everything is fine!  You can continue and form the following pair of integrals: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/747/6ca/d81/7476cad8162f2ce61dbaa9460a616714.png"><br>  <i><font color="gray">8.2.</font></i>  <i><font color="gray">The second integral of 6.1 as applied to equations 8.2 (Fresnel integral)</font></i> <br><br>  Alas, here we are stuck, because these integrals are not so simple.  If you have heard about the connection between trigonometric functions and exponents, you can guess that these integrals are related to the error function, which cannot be expressed by elementary functions.  The same applies to these integrals.  So what are we going to do?  The solution is beyond the scope of this article (see <a href="https://math.stackexchange.com/questions/83721/when-can-a-sum-and-integral-be-interchanged">this post</a> on Math StackExchange for a hint), but in this case, you can replace the sine and cosine in power series, and then change the sum and integral: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c1/627/2eb/3c16272eb356ea30d62383f1d550be1e.png"><br>  <i><font color="gray">8.4.</font></i>  <i><font color="gray">Fresnel integral expansion</font></i> <br><br>  Power series seems almost impassable, so let's take another step and explicitly write down the first few elements in each row, multiplying everything to simplify.  This gives the following several elements for the <i>x</i> and <i>y</i> forms: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ab/ee0/061/0abee0061862b35b466b088079436c56.png"><br>  <i><font color="gray">8.5.</font></i>  <i><font color="gray">Low order elements (n &lt;3) of 8.3</font></i> <br><br><h1>  Apotheosis of clothoid </h1><br>  This is a specific result!  We can actually draw a graph of this pair of equations (with a reasonable choice of <i>Œæ</i> , <i>Œ∏</i> and <i>R</i> ) - and get the contour as a function of <i>s</i> .  If we had an arbitrary number of elements and the ability to calculate sums, we would see that as <i>s</i> increases, the curve twists into a spiral, although this happens far from the area of ‚Äã‚Äãinterest. <br><br>  Repeating the thesis from the beginning of this article, we are again not the first to engage in such research.  Due to the linear curvature, which is very useful in practice, many have stumbled upon this curve in the past.  It is known as the Euler Spiral, the Cornu Spiral or Clothoid - and is widely used in the design of tracks, including highways and roller coasters. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ab/c0a/d35/4abc0ad35ec3d1c1be02251b1780cc50.gif"><br>  <i><font color="gray">9.1.</font></i>  <i><font color="gray">Clothoid to s = 5</font></i> <br><br>  If we use the decomposition only to <i>n</i> &lt;10, as indicated in 8.5, then we finally have everything we need to produce the first artifact.  This series is the ascending (first) part of equation 8.2, but it is easy to adapt to the descending (third) part, and we will link these parts together with an arc segment for the flat (second) part.  Such a method provides a mathematically perfect angle of a quad circle, which exactly corresponds to the curvature construction, first presented in equations 8.2.   ,        <i>Œæ</i> = 0,4: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05e/b0f/d33/05eb0fd33e720238f1929f4f38ea8a44.png"><br> <i><font color="gray">9.2.    Œæ = 0,4        </font></i> <br><br>      ,   ,     .        .      ,           Œæ ‚Äî      . <br><br>  ,     <i>s</i>       .  Figma          (   ‚Äî     ).          .         <i>x(s)</i>  <i>y(s)</i>     .  ,        . <br><br>  ,      ,          <i>Œæ</i> .       <i>Œæ</i> = 0,9: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/21b/455/0cb/21b4550cb832876508327101fb07acbe.png"><br> <i><font color="gray">9.3.    Œæ = 0,9        </font></i> <br><br>      . ,   ,          .  ,        ,       ( ).  ,  ,        .    . <br><br><h1>    </h1><br>   ,     ‚Äî        ,      . <br><br> -,  ,         ,   ,               <i>Œæ</i> .  ,    UI  c       .    ,  .   ,         .  ,   iOS    ,        ,           <i>Œæ</i> .  ,            ,          <i>Œæ</i> . <br><br> -,  ,          .   Apple (     )    ,        ‚Äî ,    ? <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thirdly, we have some incomprehensible technical limitations. They are not obvious from the very beginning, but become a serious problem of implementation. To understand them, consider a square of 100 √ó 100 pixels, with a standard rounding for a corner radius of 20px. This means that on each side of the square, 60px of straight segment remains. If we flatten a square into a 80 √ó 100px rectangle, then the straight section of the short side will be only 40px. What happens when we narrow the rectangle so much that we end with a straight fragment? Or if we continue to narrow it further into a rectangle, say, 20 √ó 100px? At the moment, Figma determines the maximum applicable value of the rounding of corners - and uses it. Thus, in a 20 √ó 100px rectangle there will be a rounding with a radius of 10px.</font></font><br><br><blockquote> <i>      R   Œæ  <i>p</i> ,   p(R,Œæ)     Œæ(R,p).</i> </blockquote><br>           ,   .     100√ó100px,   20px,      ,     12    .     36px   .       60√ó100px?     ,        ,       .     <i>Œæ</i> ,    ?    ,       . <br><br>  ,     :      <i>R</i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and the parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œæ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> consumes </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pixels, then the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p (R, Œæ)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> must be reversible in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œæ (R, p)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">This is a somewhat hidden limitation, which also excludes a solution of a high order nearby clothoid. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, we have a limit of usability: the change in smoothing should be at least somehow noticeable in the figure. </font><font style="vertical-align: inherit;">If we pull the smoothing parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œæ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> back and forth between zero and one, we would like to see the difference! </font><font style="vertical-align: inherit;">Imagine that all our work leads only to barely noticeable changes - this is unacceptable. </font><font style="vertical-align: inherit;">This is essentially a requirement of utility, and in fact this is the most important limitation.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The simpler the better </font></font></h1><br>     ,    ,     .      ,          .        . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ef/f62/538/9eff62538e3483fb3386ebc1a30f750f.png"><br> <i><font color="gray">11.1.          </font></i> <br><br>        . -,   1, 2  3   .       1,      . ,        1  <i>P1</i> ,  2  <i>P2</i>  ..,    1   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ba/2df/70a/0ba2df70abcbd4c38740131344a2385d.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2. Unsimplified curvature at point 1 in Fig. 11.1.</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reduction of a fraction is clearly visible if points 1‚Äì3 are lined up. We apply the same formula to point 4, indicating the coordinates in the reverse order:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/893/dcd/07e/893dcd07e86b48c7f68c95fb2817f879.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11.3. The simplified curvature at point 4 in Fig. 11.1</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ideally, the curvature will be the same as in the circular section, or</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1 / R</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which leads to another constraint. Finally, the values ‚Äã‚Äãof</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> d are</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fixed because of the fact that the end of this curve must coincide with the circular part and touch the points of contact. Therefore, the above curvature constraint simply gives us the value of</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> b</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cd7/983/a7d/cd7983a7d5b0b4a4838f054d85fb94ba.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 11.4. Solution for b in fig. 11.1, ensuring continuity of curvature</font></font></font></i> <br><br>         (        1),   <i>a</i>  <i>b</i> ,            .   ,       ,   <i>Œæ</i> = 0,6. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/77e/dff/b8d/77edffb8dd8246d58dbf9958df0e8763.png"><br><br>  ,         .  ,     <i>Œæ</i>  0  1     .       ,    <i>Œæ</i> = 0,1, 0,3, 0,5, 0,7  0,9  : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1b/c66/666/e1bc666669ba4e690579c2c5f26edc72.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Despite the good mathematical properties, the effect is barely noticeable. </font><font style="vertical-align: inherit;">Of course, this option is closer to the real product than the curve obtained earlier by reducing the number of clothoid. </font><font style="vertical-align: inherit;">If only to customize the formula for greater variability!</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Small touches </font></font></h1><br>       ,   . ,      ,    ,    <i>Œæ</i> .           .  ,  ,        . <br><br>   -   ,       .     ,    <i>Œ∏</i> ,    <i>R</i> ,  <i>q</i>    ,  <i>q</i>   : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/631/024/82c/63102482c3047f98051ebeec00c204cb.png"><br> <i><font color="gray">12.1.    </font></i> <br><br>     <i>p(R,Œæ)</i>   q   , : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ca/a0e/b9c/8caa0eb9c2d0e7838d2f923f674ac1e1.png"><br> <i><font color="gray">12.2.      </font></i> <br><br>  ,           ,      .     <i>a + b</i>   . ,     <i>c</i>  <i>d</i>  ,    <i>a + b</i> ,       :   <i>a</i>    <i>b</i> ?  ,     ,   <i>a = b</i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then we will finish with the definition of the parametrization of a Bezier curve, the angles and curvatures of which are shown below: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fe5/d35/7cc/fe5d357cccbf0840035ed29f7e9ba896.png"><br> <i><font color="gray"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.3. The shape of the angle and the curvature profile for a simple smoothing scheme</font></font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Such a visual variety already looks promising! Curves look attractive and whole. But the curvature profile is coarse. Now, if a little smooth peaks, then you get a serious candidate for the final release. Despite the weak profile, even in this simple family of forms there is an instance, very similar to the version of Apple‚Äôs quad circle. It is almost good enough to roll it out for our users with a clear conscience. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We now turn to the curvature profile, our last unsolved problem. Instead of evenly dividing the difference between </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b</font></font></i> ,     ,        a,   <i>b</i> ?      ,         .      : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b0/276/dd1/2b0276dd1ead2648d8bfded0463b6d22.png"><br> <i><font color="gray">12.4.          </font></i> <br><br>    ,    -     .   <i>Œæ</i> = 0,6      iOS,           .     :      ?  Nothing. <br><br><h1>    </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, it is useful to reflect on the process itself. This story has repeatedly confirmed the same thing - the strength and effectiveness of the simplest possible approach. In the worst case, we will get a base for comparison, if it does not work. His serious assessment will help determine the most important things that should be considered when finalizing the approach and further progress. And at best, like ours, the simplest approach already gives a fairly good result!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the end, I want to reflect on the difference between a good and a perfect product. </font><font style="vertical-align: inherit;">I'm a little embarrassed that I did not come up with a better curvature profile. </font><font style="vertical-align: inherit;">I am sure that it was possible to allocate more time, because there are many options for research. </font><font style="vertical-align: inherit;">From an intellectual point of view, it is a bit unpleasant that we received such a beautiful series of clothoid, but could not use it in the final version. </font><font style="vertical-align: inherit;">But there is a more important conclusion: the time constraints when working in a small company are very real - and the design that violates them cannot be considered good.</font></font></div><p>Source: <a href="https://habr.com/ru/post/353082/">https://habr.com/ru/post/353082/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353070/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ309 (April 2 - 8, 2018)</a></li>
<li><a href="../353072/index.html">Developing native extensions for Node.js</a></li>
<li><a href="../353074/index.html">About the main reason for the existence of modern JS frameworks</a></li>
<li><a href="../353076/index.html">React-testing-library library overview</a></li>
<li><a href="../353080/index.html">Misconceptions about automated testing</a></li>
<li><a href="../353084/index.html">Digital Signature Cloud Services</a></li>
<li><a href="../353088/index.html">We write the plugin for Unity correctly. Part 1: iOS</a></li>
<li><a href="../353090/index.html">IT asset management: how myths affect projects (Part 2)</a></li>
<li><a href="../353092/index.html">Digital events in Moscow from April 9 to 15</a></li>
<li><a href="../353094/index.html">ECO Flow in Vivado or working in netlist editing mode</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>