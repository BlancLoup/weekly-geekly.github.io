<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Close the site mirror from indexing correctly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello% habrauser%. 
 Today I will show how not to close the site mirror from indexing, and how to close it correctly. 

 Prehistory 
 I work as a webm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Close the site mirror from indexing correctly</h1><div class="post__text post__text-html js-mediator-article">  Hello% habrauser%. <br>  Today I will show how not to close the site mirror from indexing, and how to close it correctly. <br><br><h5>  Prehistory </h5><br>  I work as a webmaster in one large company for our city. <br>  We have made a client site for advertising and selling our products. <br>  The client chose a domain name in the <b>.RU</b> zone, and the site worked successfully for about a year.  The site is currently maintained and edited as necessary with us. <br>  After some time, the client wanted a second domain for the site, but in the zone <b>.</b> . <br>  He independently found ‚Äúprofessional <s>seo-specialists of</s> promoters‚Äù, whose website was in the first place in issuing Yandex according to certain requests. <br>  With them, he signed a contract, and monthly shipped a considerable amount of money in this seo-desk. <br>  After a couple of weeks, SEOs finally woke up, contacted us and got ftp access to the site, as well as the password from the admin site. <br><br><h5>  Began "optimization" </h5><br>  It all started with the fact that they did not understand the PHPShop site engine. <br>  They sent us a letter, we told them where it was being edited, in which file the tags they needed were found, and also in the appendix they gave some links to official documentation. <br><a name="habracut"></a><br>  The site itself is designed so that the skeleton of the layout of the main page is in the index.tpl file, and the html skeleton of the remaining inner pages is in the shop.tpl file.  The content itself is in the database and edited through the admin panel using a visual editor, or in the form of source html. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Seoshniki adjusted the layout as they needed, but on the main page they wanted to stick their copyright advertising. <br>  In the contract, by the way, it is indicated that it is impossible to remove this <u>indexed link to their website</u> . <br><br>  Grief-optimizers did not understand the elementary admin panel, stuffed the site with their <s>scripts with</s> crutches that interfered with the normal operation of the framework and went against the common sense.  The most innocuous - they made a static version of the main one, and put this static index.html next to index.php. <br><br>  Further, through their scripts, they made the redirection from index.php to index.html <br>  <i>What for?</i>  <i>Closing your eyes to the fact that everything is edited through the admin area, it is possible through htaccess and mod_rewrite to make such redirection at the web server level by writing a few lines and not to connect mod_php to output 301 header ...</i> <br><br>  It turned out that the surprise left by SEOs a month later, when the client wanted to change to the main information, and turned to us. <br><br>  I do everything by TZ, save, and slowly begin to go crazy. <br>  Climbed into the database - new information.  It is useful to pick the engine, and the debug shows that the information is given correctly.  I go to ftp, and I find 4 unfamiliar scripts in the root of the site, in the name of which there is the name of the seo-company. <br><br>  About an hour poked around in their code.  By the way, the php code of their scripts was awarded an honorable place on the <a href="http://govnokod.ru/">govnokod.ru</a> resource <a href="http://govnokod.ru/">.</a> <br><br>  I correct the jamb after them, transfer the work done by them from the static index.html to the engine database. <br><br><h5>  "We do not mind surprises" </h5><br>  After a couple of weeks, it turns out a new joint.  It is the one about which this thread. <br><br>  The client calls and maliciously says that we again did something on the site, and nothing works.  We are starting to understand the problem again in perplexity. <br><br>  We go to the main page of the mirror in the zone of the <b>Russian Federation</b> , and see the error 404. <br>  Again, we begin to be a little surprised at the ability to add people to work on level ground, and to ask the question ‚Äúhow?‚Äù. <br>  We go to the main domain in the zone. Ru (they promote it) - everything is fine. <br>  Again I climb to poking around in the code of the mountain optimizers. <br><br>  And ... I find the following code: <br>  <i>Domain names are not specifically disclosed, as well as keep silent what kind of seo company is so perverted</i> <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>]!=<span class="hljs-string"><span class="hljs-string">'domain.ru'</span></span>&amp;&amp;$_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_HOST'</span></span>]!=<span class="hljs-string"><span class="hljs-string">'www.domain.ru'</span></span>) { $page=file_get_contents_curl(<span class="hljs-string"><span class="hljs-string">'http://domain.ru/hjgjgjhgjh'</span></span>); $page=iconv(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>,<span class="hljs-string"><span class="hljs-string">'windows-1251'</span></span>,$page); header(<span class="hljs-string"><span class="hljs-string">'HTTP/1.1 404 Not Found'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,<span class="hljs-number"><span class="hljs-number">404</span></span>); $page=str_replace(<span class="hljs-string"><span class="hljs-string">'&lt;head&gt;'</span></span>,<span class="hljs-string"><span class="hljs-string">'&lt;head&gt;&lt;base href="http://domain.ru/"&gt;'</span></span>,$page); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $page; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'not found'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); }</code> </pre> <br><br>  facepalm.jpg <br><br>  As we can see, they didn‚Äôt want a mirror to fall into the Yandex index, and made a brutal crutch. <br><br>  I pull down their Hindu code, and do the following: <br><br>  Create a robots.php file, and write the following there: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> header(<span class="hljs-string"><span class="hljs-string">"Content-type: text/plain"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,         if(strpos($_SERVER['HTTP_HOST'], 'domain.ru') === false) { //      , : echo "User-agent: *\nDisallow: /\nHost: domain.ru"; //    ,        } else { //    domain.ru,       </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> User-agent: Yandex Disallow: /gbook/ID Disallow: /search/ Disallow: /highslide/ Disallow: /java/ Disallow: /license/ Disallow: /pageHTML/ Disallow: /tagcloud/ Disallow: /data/ Disallow: /capcha/ Disallow: /pages/ Host: domain.ru User-Agent: Slurp Disallow: / User-agent: * Disallow: /gbook/ID Disallow: */*.swf Disallow: /search/ Disallow: /highslide/ Disallow: /java/ Disallow: /license/ Disallow: /pageHTML/ Disallow: /tagcloud/ Disallow: /webstat/ Disallow: /data/ Disallow: /capcha/ Disallow: /pages/ Sitemap: http://domain.ru/sitemap.xml </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  The floor of the case is done, now we are deleting <b>robots.txt</b> , and we add such lines to the .htaccess file (mandatory condition apache + mod_rewrite): <br><pre> <code class="apache hljs"><span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">RewriteEngine</span></span></span></span> <span class="hljs-literal"><span class="hljs-literal">On</span></span> RewriteRule ^robots.txt$ robots.php</code> </pre><br><br>  <b>UPD: the</b> converted rule for nginx <i>I personally did not check, but it should work.</i> <i><br></i>  <i>If you write something in the comments - I will correct</i> <br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> = /robots.txt { <span class="hljs-attribute"><span class="hljs-attribute">rewrite</span></span><span class="hljs-regexp"><span class="hljs-regexp"> ^(.*)$</span></span> /robots.php; }</code> </pre><br><br>  Everything!  When robots request robots.txt, the server gives them a robots.php file <br><br>  PS I hope that if someone uses these curves to close the mirror, he will add it to his ‚Äúpiggy bank‚Äù of scripts for optimization. <br><br>  PPS It so happened that at the present time there are very few professional seo companies, and it turns out to be an eternal confrontation between ‚ÄúSEO developers‚Äù, some of them make a website, others break its functionality due to hand curves and misunderstanding. <br><br>  PPPS If anyone is interested, I can still point a link to that seo-desk <br><br>  Thanks for attention! <br><br>  <b>UPD:</b> Not for the purpose of anti-advertising, but as a precautionary measure: demis.ru - seoshniki-heroes of this thread. <br><br>  UPD: Another case.  Got to do something, went layout.  Already tired at their own expense and time to correct their shoals </div><p>Source: <a href="https://habr.com/ru/post/135921/">https://habr.com/ru/post/135921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135915/index.html">Backdoor in Active Directory # 2</a></li>
<li><a href="../135916/index.html">Manual: Pyramid for People - Table of Contents</a></li>
<li><a href="../135917/index.html">New C ++ World Map from Alenacpp</a></li>
<li><a href="../135919/index.html">Simple minimalist implementation of complex JavaScript applications</a></li>
<li><a href="../135920/index.html">Generating a list of IPv4 addresses on TCL and some number systems</a></li>
<li><a href="../135922/index.html">JRebel Quickstart</a></li>
<li><a href="../135926/index.html">How do you type important letters?</a></li>
<li><a href="../135927/index.html">Browser "Internet"</a></li>
<li><a href="../135928/index.html">Nokia introduced the Lumia 900 for AT & T</a></li>
<li><a href="../135929/index.html">Cut the Rope to HTML5! From the idea in Moscow to the announcement at CES</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>