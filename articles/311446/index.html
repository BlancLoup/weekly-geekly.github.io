<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adding support for Firebird DBMS to Laravel framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the time of writing the example (there will be a link later) of a web application in PHP using the Firebird DBMS, the question arose of choosing a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adding support for Firebird DBMS to Laravel framework</h1><div class="post__text post__text-html js-mediator-article">  At the time of writing the example (there will be a link later) of a web application in PHP using the Firebird DBMS, the question arose of choosing a framework for development using the MVC architectural model.  The choice of PHP frameworks is very large, but Laravel seemed to be the most convenient, simple and easily extensible.  However, this framework did not support Firebird from the DBMS box.  Laravel uses the PDO driver to work with the database.  Since there is a PDO driver for Firebird, this gave me the idea that it is possible to get Laravel to work with Firebird with some effort. <br><br>  <b>Laravel</b> is a free, open source web framework designed for development using the MVC architecture model (Model View Controller - Model View Controller).  Laravel is a convenient and easily extensible framework for building your web applications.  Out of the box, the Laravel framework supports 4 DBMSs: MySQL, Postgres, SQLite, and MS SQL Server.  In this article I will tell how to add another Firebird DBMS. <br><a name="habracut"></a><br><h2>  FirebirdConnection Connection Class </h2><br>  Each time you connect to a database, a specific connection instance is created using the Illuminate \ Database \ Connectors \ ConnectionFactory factory, depending on the type of DBMS that implements the Illuminate \ Database \ ConnectionInterface.  In addition, the factory creates a certain connector that, based on the configuration parameters, forms a connection string and passes it to the PDO connection designer.  The connector is created in the createConnector method.  We modify it a little so that it can create a connector for Firebird. <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConnector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (! <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($config[<span class="hljs-string"><span class="hljs-string">'driver'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'A driver must be specified.'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;bound($key = <span class="hljs-string"><span class="hljs-string">"db.connector.{$config['driver']}"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;make($key); } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($config[<span class="hljs-string"><span class="hljs-string">'driver'</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnector; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'pgsql'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostgresConnector; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'sqlite'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SQLiteConnector; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'sqlsrv'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlServerConnector; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'firebird'</span></span>: <span class="hljs-comment"><span class="hljs-comment">// Add support Firebird return new FirebirdConnector; } throw new InvalidArgumentException("Unsupported driver [{$config['driver']}]"); }</span></span></code> </pre> <br>  We define the Illuminate \ Database \ Connectors \ FirebirdConnector connector class a bit later.  In the meantime, we modify the createConnection method intended to create a connection that implements the Illuminate \ Database \ ConnectionInterface interface. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($driver, $connection, $database, $prefix = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, array $config = [])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;bound($key = <span class="hljs-string"><span class="hljs-string">"db.connection.{$driver}"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;make($key, [$connection, $database, $prefix, $config]); } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ($driver) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'mysql'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection($connection, $database, $prefix, $config); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'pgsql'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostgresConnection($connection, $database, $prefix, $config); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'sqlite'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SQLiteConnection($connection, $database, $prefix, $config); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'sqlsrv'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SqlServerConnection($connection, $database, $prefix, $config); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'firebird'</span></span>: <span class="hljs-comment"><span class="hljs-comment">// Add support Firebird return new FirebirdConnection($connection, $database, $prefix, $config); } throw new InvalidArgumentException("Unsupported driver [$driver]"); }</span></span></code> </pre><br>  Now let's move on to creating a connector for Firebird - class Illuminate \ Database \ Connectors \ FirebirdConnector.  You can take any of the existing connectors as a basis, for example, a Postgres connector and remake it under Firebird. <br><br>  To begin with, we will change the method for generating the connection string in accordance with the format of the string described in the <a href="http://php.net/manual/en/ref.pdo-firebird.connection.php">documentation</a> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDsn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $config)</span></span></span><span class="hljs-function"> </span></span>{ $dsn = <span class="hljs-string"><span class="hljs-string">"firebird:dbname="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($config[<span class="hljs-string"><span class="hljs-string">'host'</span></span>])) { $dsn .= $config[<span class="hljs-string"><span class="hljs-string">'host'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($config[<span class="hljs-string"><span class="hljs-string">'port'</span></span>])) { $dsn .= <span class="hljs-string"><span class="hljs-string">"/"</span></span> . $config[<span class="hljs-string"><span class="hljs-string">'port'</span></span>]; } $dsn .= <span class="hljs-string"><span class="hljs-string">":"</span></span> . $config[<span class="hljs-string"><span class="hljs-string">'database'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($config[<span class="hljs-string"><span class="hljs-string">'charset'</span></span>])) { $dsn .= <span class="hljs-string"><span class="hljs-string">";charset="</span></span> . $config[<span class="hljs-string"><span class="hljs-string">'charset'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($config[<span class="hljs-string"><span class="hljs-string">'role'</span></span>])) { $dsn .= <span class="hljs-string"><span class="hljs-string">";role="</span></span> . $config[<span class="hljs-string"><span class="hljs-string">'role'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $dsn; }</code> </pre><br>  The method that creates a PDO connection will be simplified in this case. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $config)</span></span></span><span class="hljs-function"> </span></span>{ $dsn = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDsn($config); $options = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getOptions($config); <span class="hljs-comment"><span class="hljs-comment">// We need to grab the PDO options that should be used while making the brand // new connection instance. The PDO options control various aspects of the // connection's behavior, and some might be specified by the developers. $connection = $this-&gt;createConnection($dsn, $config, $options); return $connection; }</span></span></code> </pre><br>  Connections for various DBMS used in Laravel inherit the class Illuminate \ Database \ Connection.  It is this class that encapsulates in itself all the possibilities for working with databases that are used in Laravel, in particular in ORM Eloquent.  In the heirs classes (for each type of DBMS), methods are implemented that return an instance of the class with a description of the grammar, which is required when building DML queries, and a grammar instance for DDL queries (used in migration), as well as helpers for adding the schema name to the table.  This class will look like this: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Query</span></span>\<span class="hljs-title"><span class="hljs-title">Processors</span></span>\<span class="hljs-title"><span class="hljs-title">FirebirdProcessor</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">DBAL</span></span>\<span class="hljs-title"><span class="hljs-title">Driver</span></span>\<span class="hljs-title"><span class="hljs-title">PDOFirebird</span></span>\<span class="hljs-title"><span class="hljs-title">Driver</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DoctrineDriver</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Query</span></span>\<span class="hljs-title"><span class="hljs-title">Grammars</span></span>\<span class="hljs-title"><span class="hljs-title">FirebirdGrammar</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">QueryGrammar</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Schema</span></span>\<span class="hljs-title"><span class="hljs-title">Grammars</span></span>\<span class="hljs-title"><span class="hljs-title">FirebirdGrammar</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">SchemaGrammar</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirebirdConnection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Connection</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Get the default query grammar instance. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Grammars\FirebirdGrammar */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultQueryGrammar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;withTablePrefix(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QueryGrammar); } <span class="hljs-comment"><span class="hljs-comment">/** * Get the default schema grammar instance. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Grammars\FirebirdGrammar */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultSchemaGrammar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;withTablePrefix(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SchemaGrammar); } <span class="hljs-comment"><span class="hljs-comment">/** * Get the default post processor instance. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Processors\FirebirdProcessor */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultPostProcessor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FirebirdProcessor; } <span class="hljs-comment"><span class="hljs-comment">/** * Get the Doctrine DBAL driver. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Doctrine\DBAL\Driver\PDOFirebird\Driver */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoctrineDriver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DoctrineDriver; } }</code> </pre><br>  The method to return an instance of the Doctrine driver is formally required, so we enter it, but I didn‚Äôt have a goal to work with Doctrine (only with Eloquent), so I did not implement it.  If you wish, you can do it yourself. <br><br>  The postprocessor Illuminate \ Database \ Query \ Processors \ FirebirdProcessor is intended for additional processing of query results, in particular, it helps to extract the record identifier from an INSERT query.  The definition of its implementation is completely copied from Illuminate \ Database \ Query \ Processors \ PostgresProcessor. <br><br><h2>  Grammar class for building DML queries </h2><br>  Now we come to the most interesting and important, namely to the description of the grammar for the construction of DML queries.  It is this class that is responsible for converting the expression written for the Laravel query builder to the SQL dialect used in your DBMS.  Knowing what a particular construct does in one DBMS, you can easily write this construct for Firebird.  In fact, the DML part of the SQL language is fairly standard and not significantly different for different DBMS, at least in terms of the queries that can be built using Laravel. <br><br>  Grammar DML queries are inherited from the class Illuminate \ Database \ Query \ Grammars \ Grammar.  The protected $ selectComponents property lists the parts of the SELECT query from which the query is built by the \ Illuminate \ Database \ Query \ Builder builder.  In the compileComponents method, these parts are traversed and for each of them a method is called with the name, which consists of the name of the query part and the prefix compile. <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile the components necessary for a select clause. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Builder $query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileComponents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $query)</span></span></span><span class="hljs-function"> </span></span>{ $sql = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;selectComponents <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $component) { <span class="hljs-comment"><span class="hljs-comment">// To compile the query, we'll spin through each component of the query and // see if that component exists. If it does we'll just call the compiler // function for the component which is responsible for making the SQL. if (! is_null($query-&gt;$component)) { $method = 'compile'.ucfirst($component); $sql[$component] = $this-&gt;$method($query, $query-&gt;$component); } } return $sql; }</span></span></code> </pre><br>  Knowing this fact, it becomes clear what needs to be modified and where.  Now it is time to create a heir to the class Illuminate \ Database \ Query \ Grammars \ Grammar to define the grammar of Firebird - Illuminate \ Database \ Query \ Grammars \ FirebirdGrammar.  We define the main distinctive features of Firebird. <br><br>  For a simple INSERT query, the main difference is the ability to return the newly added string using the RETURNING clause.  In Laravel, this is used to return the identifier of the newly added string.  However, MySQL does not have this capability, and therefore the compileInsertGetId method looks different for different DBMS.  Firebird supports the RETURNING clause, as well as the Postgres DBMS, and therefore this method can be taken from the grammar for Postgres.  It will look like this: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile an insert and get ID statement into SQL. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Builder $query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $values * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $sequence * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileInsertGetId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $query, $values, $sequence)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_null($sequence)) { $sequence = <span class="hljs-string"><span class="hljs-string">'id'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;compileInsert($query, $values) . <span class="hljs-string"><span class="hljs-string">' returning '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($sequence); }</code> </pre><br>  Perhaps the most basic difference for a SELECT query is the limit on the number of records returned by the query, which is often used in paged navigation.  For example, the following expression: <br><br><pre> <code class="php hljs">DB::table(<span class="hljs-string"><span class="hljs-string">'goods'</span></span>)-&gt;orderBy(<span class="hljs-string"><span class="hljs-string">'name'</span></span>)-&gt;skip(<span class="hljs-number"><span class="hljs-number">10</span></span>)-&gt;take(<span class="hljs-number"><span class="hljs-number">20</span></span>)-&gt;get();</code> </pre><br>  In different DBMS will look in SQL language very differently.  In MySQL, it looks like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre><br>  in postgres like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OFFSET</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br>  There are three options in Firebird.  Starting with version 1.5: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FIRST</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SKIP</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span></code> </pre><br>  Starting with version 2.0, another construction is added: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> goods <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span></code> </pre><br>  Starting with version 3.0, a construction from the SQL-2011 standard has been added: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> color <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OFFSET</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FIRST</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ONLY</span></span></code> </pre><br>  The most convenient and correct option, of course, is the option from the standard, but I wanted Laravel to support Firebird 2.5 and 3.0 at the same time, so we‚Äôll choose the second option.  In this case, the compileLimit and compileOffset methods will look like this: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile the "limit" portions of the query. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Builder $query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $limit * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileLimit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $query, $limit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($query-&gt;offset) { $first = (int) $query-&gt;offset + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'rows '</span></span> . (int) $first; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'rows '</span></span> . (int) $limit; } } <span class="hljs-comment"><span class="hljs-comment">/** * Compile the "offset" portions of the query. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Builder $query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $offset * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Builder $query, $offset)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($query-&gt;limit) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($offset) { $end = (int) $query-&gt;limit + (int) $offset; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'to '</span></span> . $end; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $begin = (int) $offset + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'rows '</span></span> . $begin . <span class="hljs-string"><span class="hljs-string">' to 2147483647'</span></span>; } }</code> </pre><br>  The next thing that distinguishes requests is the extraction of parts of the date, this is done using the dateBasedWhere method.  Firebird uses the standard EXTRACT function for this.  Taking this into account, our method will look as follows: <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile a date based where clause. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $type * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Query\Builder $query * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> array $where * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dateBasedWhere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($type, Builder $query, $where)</span></span></span><span class="hljs-function"> </span></span>{ $value = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;parameter($where[<span class="hljs-string"><span class="hljs-string">'value'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'extract('</span></span> . $type . <span class="hljs-string"><span class="hljs-string">' from '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($where[<span class="hljs-string"><span class="hljs-string">'column'</span></span>]) . <span class="hljs-string"><span class="hljs-string">') '</span></span> . $where[<span class="hljs-string"><span class="hljs-string">'operator'</span></span>] . <span class="hljs-string"><span class="hljs-string">' '</span></span> . $value; }</code> </pre><br>  That's all, all the main distinctive features were taken into account.  You can find the fully implemented class Illuminate \ Database \ Query \ Grammars \ FirebirdGrammar in the source codes attached to the article. <br><br><h2>  Grammar class for constructing DDL queries </h2><br>  We now turn to the more complex grammar used in the construction of DB schemas.  This grammar is used for so-called migrations (in Laravel terms).  Here, the differences between different DBMSs are much larger, starting from data types, ending with auto-increment fields.  In addition, you will need to rewrite queries here to a number of system tables to determine if there is a table or column. <br><br>  Grammar DDL queries are inherited from the class Illuminate \ Database \ Schema \ Grammars \ Grammar.  Create your grammar Illuminate \ Database \ Schema \ Grammars \ FirebirdGrammar.  The protected $ modifiers property lists the table field modifiers, for each of the modifiers listed in the array there should be a method that starts with modify, followed by the name of the modifier.  We build these methods by analogy with the grammar for MySQL, but taking into account the specifics of Firebird. <br><br><div class="spoiler">  <b class="spoiler_title">Column modifier support</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirebirdGrammar</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Grammar</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * The possible column modifiers. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $modifiers = [<span class="hljs-string"><span class="hljs-string">'Charset'</span></span>, <span class="hljs-string"><span class="hljs-string">'Collate'</span></span>, <span class="hljs-string"><span class="hljs-string">'Increment'</span></span>, <span class="hljs-string"><span class="hljs-string">'Nullable'</span></span>, <span class="hljs-string"><span class="hljs-string">'Default'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/** * The columns available as serials. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $serials = [<span class="hljs-string"><span class="hljs-string">'bigInteger'</span></span>, <span class="hljs-string"><span class="hljs-string">'integer'</span></span>, <span class="hljs-string"><span class="hljs-string">'mediumInteger'</span></span>, <span class="hljs-string"><span class="hljs-string">'smallInteger'</span></span>, <span class="hljs-string"><span class="hljs-string">'tinyInteger'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶  ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶ /** * Get the SQL for a character set column modifier. * * @param \Illuminate\Database\Schema\Blueprint $blueprint * @param \Illuminate\Support\Fluent $column * @return string|null */ protected function modifyCharset(Blueprint $blueprint, Fluent $column) { if (! is_null($column-&gt;charset)) { return ' character set '.$column-&gt;charset; } } /** * Get the SQL for a collation column modifier. * * @param \Illuminate\Database\Schema\Blueprint $blueprint * @param \Illuminate\Support\Fluent $column * @return string|null */ protected function modifyCollate(Blueprint $blueprint, Fluent $column) { if (! is_null($column-&gt;collation)) { return ' collate '.$column-&gt;collation; } } /** * Get the SQL for a nullable column modifier. * * @param \Illuminate\Database\Schema\Blueprint $blueprint * @param \Illuminate\Support\Fluent $column * @return string|null */ protected function modifyNullable(Blueprint $blueprint, Fluent $column) { return $column-&gt;nullable ? '' : ' not null'; } /** * Get the SQL for a default column modifier. * * @param \Illuminate\Database\Schema\Blueprint $blueprint * @param \Illuminate\Support\Fluent $column * @return string|null */ protected function modifyDefault(Blueprint $blueprint, Fluent $column) { if (!is_null($column-&gt;default)) { return ' default ' . $this-&gt;getDefaultValue($column-&gt;default); } } /** * Get the SQL for an auto-increment column modifier. * * @param \Illuminate\Database\Schema\Blueprint $blueprint * @param \Illuminate\Support\Fluent $column * @return string|null */ protected function modifyIncrement(Blueprint $blueprint, Fluent $column) { if (in_array($column-&gt;type, $this-&gt;serials) &amp;&amp; $column-&gt;autoIncrement) { return ' primary key'; } } // ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶  ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶ }</span></span></code> </pre><br></div></div><br>  The $ serials array lists the types (available in Laravel) for which the Increment modifier (auto-increment column) is available.  On the types available in Laravel worth staying separately.  The types available in Laravel are listed in the migration <a href="http://laravel.su/docs/5.2/migrations">documentation</a> in the ‚ÄúAvailable column types‚Äù section.  To convert the type available in Laravel to the data type of a specific DBMS within a grammar, methods are used that begin with the word type, followed by the type name. <br><br><div class="spoiler">  <b class="spoiler_title">Data Type Support</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a char type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeChar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"char({$column-&gt;length})"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a string type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"varchar({$column-&gt;length})"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a text type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'BLOB SUB_TYPE TEXT'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a medium text type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeMediumText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'BLOB SUB_TYPE TEXT'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a long text type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeLongText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'BLOB SUB_TYPE TEXT'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a integer type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $column-&gt;autoIncrement ? <span class="hljs-string"><span class="hljs-string">'INTEGER GENERATED BY DEFAULT AS IDENTITY'</span></span> : <span class="hljs-string"><span class="hljs-string">'INTEGER'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a big integer type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeBigInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $column-&gt;autoIncrement ? <span class="hljs-string"><span class="hljs-string">'BIGINT GENERATED BY DEFAULT AS IDENTITY'</span></span> : <span class="hljs-string"><span class="hljs-string">'BIGINT'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a medium integer type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeMediumInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $column-&gt;autoIncrement ? <span class="hljs-string"><span class="hljs-string">'INTEGER GENERATED BY DEFAULT AS IDENTITY'</span></span> : <span class="hljs-string"><span class="hljs-string">'INTEGER'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a tiny integer type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeTinyInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $column-&gt;autoIncrement ? <span class="hljs-string"><span class="hljs-string">'SMALLINT GENERATED BY DEFAULT AS IDENTITY'</span></span> : <span class="hljs-string"><span class="hljs-string">'SMALLINT'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a small integer type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeSmallInteger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $column-&gt;autoIncrement ? <span class="hljs-string"><span class="hljs-string">'SMALLINT GENERATED BY DEFAULT AS IDENTITY'</span></span> : <span class="hljs-string"><span class="hljs-string">'SMALLINT'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a float type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeFloat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;typeDouble($column); } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a double type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeDouble</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'double precision'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a decimal type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeDecimal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"decimal({$column-&gt;total}, {$column-&gt;places})"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a boolean type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeBoolean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'boolean'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for an enum type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeEnum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ $allowed = array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"'"</span></span> . $a . <span class="hljs-string"><span class="hljs-string">"'"</span></span>; }, $column-&gt;allowed); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"varchar(255) check (\"{$column-&gt;name}\" in ("</span></span> . implode(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $allowed) . <span class="hljs-string"><span class="hljs-string">'))'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a json type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeJson</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'varchar(8191)'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a jsonb type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeJsonb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'varchar(8191)'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a date type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'date'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a date-time type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeDateTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'timestamp'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a date-time type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeDateTimeTz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'timestamp'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a time type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeTime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'time'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a time type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeTimeTz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'time'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a timestamp type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeTimestamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($column-&gt;useCurrent) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'timestamp default CURRENT_TIMESTAMP'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'timestamp'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a timestamp type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeTimestampTz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($column-&gt;useCurrent) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'timestamp default CURRENT_TIMESTAMP'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'timestamp'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a binary type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeBinary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'varchar(8191) CHARACTER SET OCTETS'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a uuid type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeUuid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'char(36)'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for an IP address type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeIpAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'varchar(45)'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Create the column definition for a MAC address type. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $column * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">typeMacAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Fluent $column)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'varchar(17)'</span></span>; }</code> </pre> </div></div><br><table><tbody><tr><td><h3>  Note on auto-increment columns </h3><br>  Identity columns are available starting with Firebird 3.0.  Prior to version 3.0, a generator and a BEFORE INSERT trigger were used for similar functionality.  Example: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USERS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span>, ‚Ä¶ );</code> </pre><br>  Similar functionality can be obtained as follows: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USERS</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span>, ‚Ä¶ ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SEQUENCE</span></span> SEQ_USERS; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> TR_USERS_BI <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USERS</span></span> ACTIVE <span class="hljs-keyword"><span class="hljs-keyword">BEFORE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> (NEW.ID <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> NEW.ID = <span class="hljs-keyword"><span class="hljs-keyword">NEXT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VALUE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> SEQ_USERS; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre><br>  Laravel Migrations do not support schema objects other than tables.  Those.  creation and modification of sequences, and even more so triggers are not supported.  However, sequences are part of the functionality of a fairly large number of DBMS, including Postgres and MS SQL (starting from 2012).  How to add support for sequences in the Laravel migration will be described later in this article. <br></td></tr></tbody></table><br>  Now we add two methods that the query returns to check for the existence of a table and a column inside the table. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Compile the query to determine if a table exists. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileTableExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'select * from RDB$RELATIONS where RDB$RELATION_NAME = ?'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile the query to determine the list of columns. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $table * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileColumnExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($table)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"select TRIM(RDB\$FIELD_NAME) AS \"column_name\" from RDB\$RELATION_FIELDS where RDB\$RELATION_NAME = '$table'"</span></span>; }</code> </pre><br>  Add the compileCreate method for creating the CREATE TABLE statement.  The same method is used to create temporary GTT tables.  Strangely enough, even for Postgres, only one type of GTT is created - ON COMMIT DELETE ROWS, we also implement support for both types of GTT at once. <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile a create table command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $columns = implode(<span class="hljs-string"><span class="hljs-string">', '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getColumns($blueprint)); $sql = $blueprint-&gt;temporary ? <span class="hljs-string"><span class="hljs-string">'create temporary'</span></span> : <span class="hljs-string"><span class="hljs-string">'create'</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">' table '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint) . <span class="hljs-string"><span class="hljs-string">" ($columns)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;temporary) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;preserve) { $sql .= <span class="hljs-string"><span class="hljs-string">' ON COMMIT DELETE ROWS'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $sql .= <span class="hljs-string"><span class="hljs-string">' ON COMMIT PRESERVE ROWS'</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sql; }</code> </pre><br>  The class Illuminate \ Database \ Schema \ Blueprint does not contain the $ preserve property, so we will add it, as well as a method for installing it.  The Blueprint class is designed to generate a query or set of queries to support the creation, modification, and deletion of table metadata. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Blueprint</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶  /** * Whether a temporary table such as ON COMMIT PRESERVE ROWS * * @var bool */ public $preserve = false; // ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶  /** * Indicate that the temporary table as ON COMMIT PRESERVE ROWS. * * @return void */ public function preserveRows() { $this-&gt;preserve = true; } // ‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶  }</span></span></code> </pre><br>  Let us return to the grammar class Illuminate \ Database \ Schema \ Grammars \ FirebirdGrammar.  Add a method to it to create a table deletion operator. <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop table command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDrop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'drop table '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint); }</code> </pre><br>  There is another method in Laravel that only tries to delete a table if it exists.  This is done using the SQL statement DROP TABLE IF EXISTS.  Firebird does not have an operator with similar functionality, however we can emulate it using an anonymous block (EXECUTE BLOCK + EXECUTE STATEMENT). <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop table (if exists) command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropIfExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $sql = <span class="hljs-string"><span class="hljs-string">'EXECUTE BLOCK'</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">'AS'</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">'BEGIN'</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">" IF (EXISTS(select * from RDB\$RELATIONS where RDB\$RELATION_NAME = '"</span></span> . $blueprint-&gt;getTable() . <span class="hljs-string"><span class="hljs-string">"')) THEN"</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">" EXECUTE STATEMENT 'DROP TABLE "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint) . <span class="hljs-string"><span class="hljs-string">"';"</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">'END'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sql; }</code> </pre><br>  Now add methods to add and remove columns, constraints, and indexes. <br><br><div class="spoiler">  <b class="spoiler_title">Methods for adding and removing columns, constraints, and indexes</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile a column addition command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $table = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint); $columns = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;prefixArray(<span class="hljs-string"><span class="hljs-string">'add column'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getColumns($blueprint)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'alter table '</span></span> . $table . <span class="hljs-string"><span class="hljs-string">' '</span></span> . implode(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $columns); } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a primary key command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compilePrimary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $columns = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;columnize($command-&gt;columns); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'alter table '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint) . <span class="hljs-string"><span class="hljs-string">" add primary key ({$columns})"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a unique key command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileUnique</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $table = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint); $index = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($command-&gt;index); $columns = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;columnize($command-&gt;columns); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"alter table $table add constraint {$index} unique ($columns)"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a plain index key command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $columns = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;columnize($command-&gt;columns); $index = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($command-&gt;index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"create index {$index} on "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint) . <span class="hljs-string"><span class="hljs-string">" ({$columns})"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop column command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropColumn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $columns = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;prefixArray(<span class="hljs-string"><span class="hljs-string">'drop column'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapArray($command-&gt;columns)); $table = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'alter table '</span></span> . $table . <span class="hljs-string"><span class="hljs-string">' '</span></span> . implode(<span class="hljs-string"><span class="hljs-string">', '</span></span>, $columns); } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop primary key command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropPrimary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $table = $blueprint-&gt;getTable(); $index = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap(<span class="hljs-string"><span class="hljs-string">"{$table}_pkey"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'alter table '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint) . <span class="hljs-string"><span class="hljs-string">" drop constraint {$index}"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop unique key command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropUnique</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $table = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint); $index = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($command-&gt;index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"alter table {$table} drop constraint {$index}"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop index command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $index = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($command-&gt;index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"drop index {$index}"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop foreign key command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Blueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropForeign</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $table = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapTable($blueprint); $index = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap($command-&gt;index); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"alter table {$table} drop constraint {$index}"</span></span>; }</code> </pre><br></div></div><br>  You can test the performance of our classes by creating and running a migration with the following contents: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Schema</span></span>\<span class="hljs-title"><span class="hljs-title">Blueprint</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Migrations</span></span>\<span class="hljs-title"><span class="hljs-title">Migration</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateUsersTable</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Run the migrations. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Schema::create(<span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $table)</span></span></span><span class="hljs-function"> </span></span>{ $table-&gt;increments(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'email'</span></span>)-&gt;unique(); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'password'</span></span>); $table-&gt;rememberToken(); $table-&gt;timestamps(); }); } <span class="hljs-comment"><span class="hljs-comment">/** * Reverse the migrations. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">down</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Schema::drop(<span class="hljs-string"><span class="hljs-string">'users'</span></span>); } }</code> </pre><br>  As a result, run with the command: <br><br><pre> <code class="bash hljs">php artisan migrate</code> </pre><br>      DDL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"users"</span></span> ( <span class="hljs-string"><span class="hljs-string">"id"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GENERATED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"remember_token"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span>, <span class="hljs-string"><span class="hljs-string">"updated_at"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIMESTAMP</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"users"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">"users_email_unique"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UNIQUE</span></span> (<span class="hljs-string"><span class="hljs-string">"email"</span></span>);</code> </pre><br>      : <br><br><pre> <code class="bash hljs">php artisan migrate:reset</code> </pre><br><h3>    </h3><br>     Blueprint,          ,     ,   SequenceBlueprint       .    ,      ,       Blueprint. <br><br>   Firebird   :  ,    ,    NEXT VALUE FOR.       3.0.  ,      : <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * The sequence the blueprint describes. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $sequence; <span class="hljs-comment"><span class="hljs-comment">/** * Initial sequence value * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $start_with = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Increment for sequence * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $increment = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Restart flag that indicates that the sequence should be reset * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $restart = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>;</code> </pre><br>         ,      .    restart,       RESTART   ALTER SEQUENCE. <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Restart sequence and set initial value * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $startWith */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">restart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($startWith = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;restart = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;start_with = $startWith; }</code> </pre><br>     Blueprint     create  drop,    alter sequence. <br><br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Determine if the blueprint has a create command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">creating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commands <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $command) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($command-&gt;name == <span class="hljs-string"><span class="hljs-string">'createSequence'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Determine if the blueprint has a drop command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dropping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commands <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $command) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($command-&gt;name == <span class="hljs-string"><span class="hljs-string">'dropSequence'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($command-&gt;name == <span class="hljs-string"><span class="hljs-string">'dropSequenceIfExists'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Add the commands that are implied by the blueprint. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addImpliedCommands</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;restart || (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;increment !== <span class="hljs-number"><span class="hljs-number">1</span></span>)) &amp;&amp; ! <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;creating() &amp;&amp; ! <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;dropping()) { array_unshift(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commands, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createCommand(<span class="hljs-string"><span class="hljs-string">'alterSequence'</span></span>)); } } <span class="hljs-comment"><span class="hljs-comment">/** * Get the raw SQL statements for the blueprint. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Connection $connection * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\Grammars\Grammar $grammar * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toSql</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Connection $connection, Grammar $grammar)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addImpliedCommands(); $statements = []; <span class="hljs-comment"><span class="hljs-comment">// Each type of command has a corresponding compiler function on the schema // grammar which is used to build the necessary SQL statements to build // the sequence blueprint element, so we'll just call that compilers function. foreach ($this-&gt;commands as $command) { $method = 'compile'.ucfirst($command-&gt;name); if (method_exists($grammar, $method)) { if (! is_null($sql = $grammar-&gt;$method($this, $command, $connection))) { $statements = array_merge($statements, (array) $sql); } } } return $statements; }</span></span></code> </pre><br>    Illuminate\Database\Schema\SequenceBlueprint         . <br><br>        Illuminate\Database\Schema\Grammars\ FirebirdGrammar         {CREATE | ALTER | DROP} SEQUENCE. <br><br><div class="spoiler"> <b class="spoiler_title">  {CREATE | ALTER | DROP} SEQUENCE</b> <div class="spoiler_text"><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * Compile a create sequence command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\SequenceBlueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileCreateSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceBlueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $sql = <span class="hljs-string"><span class="hljs-string">'create sequence '</span></span>; $sql .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapSequence($blueprint); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;getInitialValue() !== <span class="hljs-number"><span class="hljs-number">0</span></span>) { $sql .= <span class="hljs-string"><span class="hljs-string">' start with '</span></span> . $blueprint-&gt;getInitialValue(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;getIncrement() !== <span class="hljs-number"><span class="hljs-number">1</span></span>) { $sql .= <span class="hljs-string"><span class="hljs-string">' increment by '</span></span> . $blueprint-&gt;getIncrement(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sql; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a alter sequence command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\SequenceBlueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileAlterSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceBlueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $sql = <span class="hljs-string"><span class="hljs-string">'alter sequence '</span></span>; $sql .= <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapSequence($blueprint); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;isRestart()) { $sql .= <span class="hljs-string"><span class="hljs-string">' restart'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;getInitialValue() !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { $sql .= <span class="hljs-string"><span class="hljs-string">' with '</span></span> . $blueprint-&gt;getInitialValue(); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($blueprint-&gt;getIncrement() !== <span class="hljs-number"><span class="hljs-number">1</span></span>) { $sql .= <span class="hljs-string"><span class="hljs-string">' increment by '</span></span> . $blueprint-&gt;getIncrement(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sql; } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop sequence command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\SequenceBlueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceBlueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'drop sequence '</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapSequence($blueprint); } <span class="hljs-comment"><span class="hljs-comment">/** * Compile a drop sequence command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Database\Schema\SequenceBlueprint $blueprint * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \Illuminate\Support\Fluent $command * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compileDropSequenceIfExists</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SequenceBlueprint $blueprint, Fluent $command)</span></span></span><span class="hljs-function"> </span></span>{ $sql = <span class="hljs-string"><span class="hljs-string">'EXECUTE BLOCK'</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">'AS'</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">'BEGIN'</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">" IF (EXISTS(select * from RDB\$GENERATORS where RDB\$GENERATOR_NAME = '"</span></span> . $blueprint-&gt;getSequence() . <span class="hljs-string"><span class="hljs-string">"')) THEN"</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">" EXECUTE STATEMENT 'DROP SEQUENCE "</span></span> . <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrapSequence($blueprint) . <span class="hljs-string"><span class="hljs-string">"';"</span></span> . <span class="hljs-string"><span class="hljs-string">"\n"</span></span>; $sql .= <span class="hljs-string"><span class="hljs-string">'END'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sql; } <span class="hljs-comment"><span class="hljs-comment">/** * Wrap a sequence in keyword identifiers. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> mixed $sequence * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapSequence</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sequence)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($sequence <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> SequenceBlueprint) { $sequence = $sequence-&gt;getSequence(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isExpression($sequence)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getValue($sequence); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;wrap(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tablePrefix . $sequence, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, now the addition of support for sequences in the Laravel migration is complete. </font><font style="vertical-align: inherit;">Let's see how it works, for this we slightly modify the migration given earlier.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Migration to test DDL over sequences</font></font></b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateUsersTable</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Migration</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Run the migrations. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   // CREATE SEQUENCE "seq_users_id" Schema::createSequence('seq_users_id'); //   // CREATE TABLE "users" ( // "id" INTEGER NOT NULL, // "name" VARCHAR(255) NOT NULL, // "email" VARCHAR(255) NOT NULL, // "password" VARCHAR(255) NOT NULL, // "remember_token" VARCHAR(100), // "created_at" TIMESTAMP, // "updated_at" TIMESTAMP // ); // ALTER TABLE "users" ADD PRIMARY KEY ("id"); // ALTER TABLE "users" ADD CONSTRAINT "users_email_unique" UNIQUE ("email"); Schema::create('users', function (Blueprint $table) { //$table-&gt;increments('id'); $table-&gt;integer('id')-&gt;primary(); $table-&gt;string('name'); $table-&gt;string('email')-&gt;unique(); $table-&gt;string('password'); $table-&gt;rememberToken(); $table-&gt;timestamps(); }); //   // ALTER SEQUENCE "seq_users_id" RESTART WITH 10 INCREMENT BY 5 Schema::sequence('seq_users_id', function (SequenceBlueprint $sequence) { $sequence-&gt;increment(5); $sequence-&gt;restart(10); }); } /** * Reverse the migrations. * * @return void */ public function down() { //   // DROP SEQUENCE "seq_users_id" Schema::dropSequence('seq_users_id'); //   // DROP TABLE "users" Schema::drop('users'); } }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can go further and make support for creating a BEFORE INSERT trigger and a sequence (generator) to support auto-increment fields in Firebird 2.5 and below. </font><font style="vertical-align: inherit;">But in most cases it is enough to get the next value of the sequence and pass it to the INSERT request.</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These changes are sufficient for developing web applications using the Firebird DBMS using the Laravel framework. </font><font style="vertical-align: inherit;">Of course, it would be nice to arrange it as a package and connect it to extend the functionality, as it is done with the rest of the modules Laravel.</font></font><br><br>  In the next article I will discuss how to create a small application using Laravel and Firebird DBMS.     Firebird   Laravel    ,     .     Laravel    Firebird    <a href=""></a> . <br><br><table><tbody><tr><td><h4>  Comment </h4><br>            <a href="https://github.com/jacquestvanzuydam/laravel-firebird">github.com/jacquestvanzuydam/laravel-firebird</a>  ,            Laravel.   <a href="https://habrahabr.ru/users/ellrion/" class="user_link">ellrion</a>     . <br></td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/311446/">https://habr.com/ru/post/311446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311432/index.html">Validation of MongoDB Attached Data to Yii2</a></li>
<li><a href="../311436/index.html">How to count the counters and not to lose count</a></li>
<li><a href="../311438/index.html">Security Week 39: hacking Yahoo, iOS 10 brute force backups, macromavie hiding from researchers</a></li>
<li><a href="../311440/index.html">Server management board - why and what is inside</a></li>
<li><a href="../311442/index.html">Google has sent out users about the possibility of changing the default search engine</a></li>
<li><a href="../311448/index.html">What are the prospects for Node.js after reunification - expert opinions</a></li>
<li><a href="../311452/index.html">Do-it-yourself online book with javascript</a></li>
<li><a href="../311456/index.html">"Combat algebra" or cryptography "according to GOST"</a></li>
<li><a href="../311458/index.html">Top 10 Free SharePoint Apps from Microsoft Store</a></li>
<li><a href="../311460/index.html">What is big data, part 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>