<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Neural network architecture for the implementation of the RL algorithm with the ability to specify simultaneously running actions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the classical neural network schemes for the implementation of the RL algorithm is as follows: 


 Where: inputs - inputs to the neural network...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Neural network architecture for the implementation of the RL algorithm with the ability to specify simultaneously running actions</h1><div class="post__text post__text-html js-mediator-article">  One of the classical neural network schemes for the implementation of the RL algorithm is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vx/y-/ez/vxy-ezv8r9wzknk0xrjx4b7cozg.png"></div><br>  Where: inputs - inputs to the neural network;  FC - (fully connected) hidden layer architecture or CNN - FC - hidden layer architecture (depending on what is supplied to the inputs);  outputs - network outputs.  Often the network outputs are softmax layer, which gives the probability of performing one of the actions from the set of all possible actions. <br><br>  The disadvantage of this architecture is that it is difficult to implement the choice of several simultaneous actions at once. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To solve this problem, an architecture with a mask layer is proposed.  The proposed architecture is as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fk/co/md/fkcomd9t7pidbqcp1ffvw4iobvu.png"></div><br>  This architecture is fully consistent with the classical architecture, but also includes an action mask layer.  The only way out of this architecture is the value of the action value (a group of simultaneous actions).  The action mask layer can be implemented in accordance with the pseudocode below: <br><a name="habracut"></a><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Layer</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, items, item_size, extra_size)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(items &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(item_size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>(extra_size &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) self.items = items self.item_size = item_size self.extra_size = extra_size <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self._expand_op = np.zeros((self.items, self.items*self.item_size), \ dtype=np.float32) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.items): self._expand_op[i,i*self.item_size:(i+<span class="hljs-number"><span class="hljs-number">1</span></span>)*self.item_size] = np.float32(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, inputs, ops)</span></span></span><span class="hljs-function">:</span></span> op_mask_part = inputs[:self.items*self.item_size] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.extra_size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: ext_part = inputs[self.items*self.item_size:] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: ext_part = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-comment"><span class="hljs-comment"># if ops in [-0.5, 0.5] or [-0.5 .. 0.5]: ops1 = np.add(ops, np.float(0.5)) # optional extended_op = np.matmul(ops1, self._expand_op) if self.extra_size &gt; 0: return np.concatenate((np.multiply(op_mask_part, extended_op), ext_part)) else: return np.multiply(op_mask_part,extended_op)</span></span></code> </pre> <br>  And the use of this code demonstrates the following code snippet: <br><br><pre> <code class="python hljs">items = <span class="hljs-number"><span class="hljs-number">5</span></span> item_size = <span class="hljs-number"><span class="hljs-number">10</span></span> extra_size = <span class="hljs-number"><span class="hljs-number">20</span></span> l = Layer(items=items, item_size=item_size, extra_size=extra_size) l.build() inputs = np.random.rand(items*item_size+extra_size) ops = np.random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, (items,), dtype=<span class="hljs-string"><span class="hljs-string">"int"</span></span>) ops = ops.astype(dtype=np.float32) - np.float32(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) result = l.call(inputs,ops)</code> </pre><br>  From the layer code it is clear that for each action a neural network learns to form some representation of the action as a series of weights.  And these views either go to the network after the mask layer or not.  Depending on the operation, these weights can be performed with the task of some operation on the whole group of action weights (not only multiplication by [0,1]).  In this way, a task is formed to calculate the value of a group of actions performed by the network.  (In the classic case, the softmax layer calculated the value of all actions, in the proposed architecture, the neural network calculates the value of a group of selected actions.) <br><br>  (For a definition of action value, see, for example, R.S. Sutton, E.G. Barto Training with reinforcements.) <br><br><h3>  Examples of the use of the proposed architecture </h3><br><h4>  Tetris game </h4><br>  The idea of ‚Äã‚Äãusing this architecture for playing Tetris is as follows.  At the inputs, we submit an image of a glass game Tetris (one pixel one square).  We group individual actions into action groups.  Evaluation of a single action for a neural network is a mask of the final position of a figure in a glass.  The shape is set by its squares in the action mask in the action mask layer in the neural network.  To select a group of actions, we choose the maximum assessment of the action (exit) from the list of all final positions of the current figure. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hn/ic/xq/hnicxqwntkfn4kfsm5nem3dwxya.png"></div><br>  Picture.  A field (blue cells) and a falling figure (light gray cells) are shown.  The final position of the figure is all possible positions of which the figure cannot move according to the rules of the game (not shown). <br><br><h4>  Agent modeling vehicle movement </h4><br>  In this case, each action of acceleration (several accelerations of acceleration), deceleration (several possible accelerations during deceleration), as well as several degrees of rotation, were simulated as elementary actions.  It is clear that a turn and one of the accelerations can be involved at the same time, or only one turn action or one acceleration action.  In this case, the architecture allows you to set several elementary actions at the same time to form a complex action. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cy/m2/z3/cym2z34jxlthfggjvtlwmteu3lc.png"></div><br>  Picture.  In addition to the field itself, to perform actions by a car model (on which the parking target is indicated by red-green lines), the inputs of the neural network (below) and action evaluation values ‚Äã‚Äãfor all possible actions in this model state are also displayed. <br><br><h3>  Other possible uses of architecture </h3><br>  Similarly, using Tetris architecture in a game can be used for other games, where the field can be given rows of figures and several actions at the same time (for example, moving around the playing field). <br><br>  In robotics, this architecture can play the role of a meta-network coordinating individual structural elements into a common ensemble. <br><br>  This architecture also allows you to use transfer learning to pre-train the CNN part, and vice versa at the beginning to train the RL part of the neural network, and then train the CNN part on the already trained RL network on model data.  In the example in the programming of the game, Tetris transfer transfer was applied with training at the beginning of the CNN part and FC part to the action mask layer (that is transferred to the resulting network).  In the task of parking, I also plan to apply the CNN training of the part after the training of the RL part (ie, the ‚Äúcherry‚Äù first). <br><br>  ‚Üí Program source code examples can be found by <a href="https://github.com/klizardin/AgentMetaOperations">reference.</a> </div><p>Source: <a href="https://habr.com/ru/post/454916/">https://habr.com/ru/post/454916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454900/index.html">How to make web forms on the site convenient and safe: development tools and designers</a></li>
<li><a href="../454904/index.html">Samsung opens a free online course on neural networks in computer vision tasks</a></li>
<li><a href="../454906/index.html">Rating sites additional education in IT: the results of the study "My Circle"</a></li>
<li><a href="../454912/index.html">By Dwarf Fortress Tarn Adams talks about game development.</a></li>
<li><a href="../454914/index.html">Use Yii2. We write another CMS or an attempt to significantly speed up development with minimal overhead</a></li>
<li><a href="../454918/index.html">How to combine backups of two retailers on SAP in 12 hours</a></li>
<li><a href="../454920/index.html">Frontend performance: parse important metrics</a></li>
<li><a href="../454922/index.html">Tales about foreign customers and their peculiarities of work in Russia after the law on PD</a></li>
<li><a href="../454926/index.html">Everything you know about word2vec is not true</a></li>
<li><a href="../454928/index.html">A way to bypass the Windows lock screen on RDP sessions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>