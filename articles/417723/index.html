<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the KOMPAS-3D API ‚Üí Lesson 11 ‚Üí Simple Text Labels</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous lessons of the cycle, we learned to display the text in the main title. Today we will talk about how to display text in the document i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the KOMPAS-3D API ‚Üí Lesson 11 ‚Üí Simple Text Labels</h1><div class="post__text post__text-html js-mediator-article">  In the previous lessons of the cycle, we learned to display the text in the main title.  Today we will talk about how to display text in the document itself.  We will consider the simplest examples, and we will show more complex techniques in the following lessons. <br><br><img src="https://habrastorage.org/webt/wz/do/cm/wzdocmvrzusasojdie12itkajtq.png"><br><br><a name="habracut"></a><br><blockquote><h4>  Content of the cycle of lessons ‚ÄúWorking with the API KOMPAS-3D‚Äù </h4><br><ol><li>  <a href="https://habrahabr.ru/company/ascon/blog/328088/">The basics</a> </li><li>  <a href="https://habrahabr.ru/company/ascon/blog/330588/">Drawing design</a> </li><li>  <a href="https://habrahabr.ru/company/ascon/blog/332554/">Correct connection to COMPAS</a> </li><li>  <a href="https://habrahabr.ru/company/ascon/blog/337288/">Title block</a> </li><li>  <a href="https://habrahabr.ru/company/ascon/blog/342030/">Graphic primitives</a> </li><li>  <a href="https://habrahabr.ru/company/ascon/blog/346772/">Save the document in various formats</a> </li><li>  <a href="https://habrahabr.ru/company/ascon/blog/350512/">Introduction to the settings</a> </li><li>  <a href="https://habr.com/company/ascon/blog/350516/">More sophisticated writing methods</a> </li><li>  <a href="https://habr.com/company/ascon/blog/359232/">Reading the caption cells</a> </li><li>  <a href="https://habr.com/company/ascon/blog/414701/">Special characters including string</a> </li><li>  <b>Simple text lettering</b> </li></ol></blockquote><br><h2>  <font color="#00B2FF">Text anchor point</font> </h2><br>  Text in KOMPAS is always displayed relative to some point, which is called the anchor point.  The text may be different relative to it.  In order to find out the position of the text relative to the anchor point, use the <b>ksGetTextAlign</b> method of the <b>ksDocument2D</b> interface.  Below is its prototype. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ksGetTextAlign ( <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> pText <span class="hljs-comment"><span class="hljs-comment">//   );</span></span></code> </pre> <br>  As a single parameter, it takes an integer pointer to the <i>"text"</i> object.  The method returns the <i>type of binding</i> , or <i>-1</i> in case of an error.  Valid types of bindings are shown in the table below. <br><br><img src="https://habrastorage.org/webt/x1/ar/kt/x1arktnxaiyg0pu4wxidqdqbzke.png"><br>  <i>Table of allowed types of bindings</i> <br><br>  To change the text binding, use the <b>ksDetment2D</b> interface's <b>ksSetTextAlign method</b> .  Below is its prototype. <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ksSetTextAlign</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pText, //   ¬´¬ª </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> align //  </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  If successful, this method returns the value <i>1</i> , and in case of error, it returns <i>zero</i> . <br><br><h2>  <font color="#00B2FF">Text output</font> </h2><br>  For simple text output, the <b>ksText</b> method of the <b>ksDocument2D</b> interface is <b>used</b> .  Below is a prototype of this method. <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ksText</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, //   </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ang, //   </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hStr, //    </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ksuStr, //  </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bitVector, //  BSTR s //  </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  Let us <b>analyze the</b> parameters of the <b>ksText</b> method.  The anchor point we discussed in the previous section. <br><br>  The <b>ang</b> parameter sets the angle in degrees between the text line and the horizontal line.  The angle is counted counterclockwise.  The figure below shows a line drawn at an angle of <i>45 ¬∞</i> . <br><br><img src="https://habrastorage.org/webt/f4/4s/qd/f44sqdinktxtkua8fe9qd_jvdf4.png"><br>  <i>String derived at an angle of 45 ¬∞</i> <br><br>  The <b>hStr</b> parameter sets the character size of the string in millimeters.  If the value of this parameter is <i>zero</i> , then the default size is used. <br><br>  The <b>ksuStr</b> parameter sets the stretching (narrowing) of the text.  The figure below shows several lines with different values ‚Äã‚Äãfor the <b>ksuStr</b> parameter. <br><br><img src="https://habrastorage.org/webt/eg/ph/bg/egphbgtc5ecognfjioff2r3c3dm.png"><br>  <i>Multiple lines with different stretch values</i> <br><br>  From this figure, you can see that ‚Äústretching 0‚Äù is equivalent to ‚Äústretching 1,‚Äù that is, the absence of any stretching. <br><br>  The <b>bitVector</b> parameter contains a set of flags defining the character outline.  Valid flags are listed in the table below. <br><br><img src="https://habrastorage.org/webt/yi/is/hb/yiishb0rg_-xvibw5cmm90uno3m.png"><br>  <i>Table of flags defining the character outline</i> <br><br>  In fact, there are other valid flags, but their work is manifested only in the construction of complex compound strings.  We will look at some of them in the next lesson. <br>  Remember - the output string must not contain the characters <i>@</i> , <i>$</i> , <i>&amp;</i> , <i>~</i> , <i>^</i> and <i>#</i> , as they are control characters.  We will talk about working with them in the next lessons of our cycle. <br>  If successful, the <b>ksText</b> method returns an integer pointer to the text.  This pointer can be passed, for example, to the <b>ksSetTextAlign</b> method to change the position of the text relative to the anchor point.  In the event of an error, the <b>ksText</b> method returns <i>zero</i> . <br><br><h2>  <font color="#00B2FF">Example</font> </h2><br>  Below is an example of a program that demonstrates the output of a string using the <b>ksText</b> method. <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">/  BSTR str = SysAllocString(L""); long itext; itext = Document2D-&gt;ksText(100, 100, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  11, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  str); SysFreeString(str); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    Document2D-&gt;ksSetTextAlign(itext, txta_Left); Document2D.Unbind(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   kompas-&gt;Visible = true; kompas.Unbind();</span></span></code> </pre><br>  For simplicity, in this example, the code responsible for the creation and execution of the document is omitted.  As a result of the work of this program, the text <i>‚ÄúLine‚Äù</i> is displayed in the document. <br><br><h2>  <font color="#00B2FF">Text size</font> </h2><br>  When outputting text to a document, it is helpful to know how much space it takes.  Text height is set by the <b>hStr</b> parameter of the <b>ksText</b> method.  But its length directly depends on the output string. <br><br>  To define it, use the <b>ksGetTextLengthFromReference</b> method of the <b>ksDocument2D</b> interface.  This method has only one parameter - an integer pointer to the text.  It returns the text length in millimeters. <br><br>  The <b>ksGetTextLengthFromReference</b> method <b>is</b> inconvenient in that it does not allow determining the length of a string before its output to a document.  To determine the length of a string that has not yet been output to the document, you need to use the <b>ksGetTextLength</b> method.  But before considering it, let's talk about styles. <br><br><h2>  <font color="#00B2FF">Text styles</font> </h2><br>  The KOMPAS system predetermines several styles for texts displayed in documents.  Each style corresponds to an integer.  The most commonly used styles are in the table below. <br><br><img src="https://habrastorage.org/webt/4p/sf/ny/4psfnyywguukemqayhjyzsu0tqi.png"><br>  <i>Most commonly used text styles</i> <br><br>  Not all styles are shown in this table: only a part of them.  A complete list of available constants can be found on the page <i>‚ÄúParameters Structures and Constants \ Constants \ Text Constants \ System Text Styles‚Äù of the</i> COMPASS documentation. <br><br><h2>  <font color="#00B2FF"><b>KsGetTextLength</b> method</font> </h2><br>  The <b>ksGetTextLength</b> method of the <b>ksDocument2D</b> interface allows <b>you</b> to determine the length of a string before it is output to a document.  Below is a prototype of this method. <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ksGetTextLength</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> BSTR text, // </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style //  </span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  The method returns the string length in millimeters.  Note: the method takes as its parameter the string itself, and not the pointer to the ‚Äútext‚Äù object.  This allows you to estimate the size of the string before it is displayed in the document. <br><br><h2>  <font color="#00B2FF">Example</font> </h2><br>  Consider an example of using the <b>ksGetTextLength</b> method.  Suppose we have a string and it needs to be placed in a rectangle of a certain length (this problem is solved much easier with the help of paragraphs, but about them in the next lessons).  If the string fits in it, then it is displayed completely.  If not, it is clipped and an ellipsis is placed at the end of it.  Below is the source code of the program that solves this problem. <br><br><pre> <code class="hljs ruby">const wchar_t FULLSTR[] = L<span class="hljs-string"><span class="hljs-string">"  !   !   !"</span></span>; const wchar_t DOTS[] = L<span class="hljs-string"><span class="hljs-string">"..."</span></span>; const long STYLE = <span class="hljs-number"><span class="hljs-number">1</span></span>; double maxSize = <span class="hljs-number"><span class="hljs-number">100.0</span></span>; BSTR str = SysAllocString(FULLSTR); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Document2D-&gt;ksGetTextLength(str, STYLE) &gt; maxSize) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   BSTR str_dots = SysAllocString(DOTS); double size_dots = Document2D-&gt;ksGetTextLength(str_dots, STYLE); SysFreeString(str_dots); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     maxSize -= size_dots; SysReAllocStringLen(&amp;str, str, SysStringLen(str) - <span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,     <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(Document2D-&gt;ksGetTextLength(str, STYLE) &gt; maxSize) SysReAllocStringLen(&amp;str, str, SysStringLen(str) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    size_t len = SysStringLen(str); SysFreeString(str); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     wchar_t *p = new wchar_t[len + wcslen(DOTS) + <span class="hljs-number"><span class="hljs-number">1</span></span>]; wcsncpy(p, FULLSTR, len); p[len] = L<span class="hljs-string"><span class="hljs-string">'\0'</span></span>; wcscat(p, DOTS); str = SysAllocString(p); delete [] p; } /<span class="hljs-regexp"><span class="hljs-regexp">/    Document2D-&gt;ksText(100, 100, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ 0, /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  str); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  SysFreeString(str); Document2D.Unbind(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   kompas-&gt;Visible = true; kompas.Unbind();</span></span></code> </pre><br>  The source string is specified in the <b>FULLSTR</b> constant.  The variable <b>maxSize</b> specifies the length of the rectangle in which to insert the string.  Later this value is specified, the size of the ellipsis is subtracted from it, which is stored in the <b>size_dots</b> variable.  If the line does not fit, one character is cut off from it until it fits in a rectangle of a given size.  This happens in a <b>while loop</b> . <br><br>  Pay attention to a very important point: when displaying a string, all parameters of the <b>ksText</b> method (except for the coordinates of the anchor point) have a <i>zero value</i> .  The fact is that the <b>ksGetTextLength</b> method <b>does</b> not know anything about these parameters, so it cannot take them into account when calculating the length of a string.  Thus, if non-zero values ‚Äã‚Äãof parameters of the <b>ksText</b> method are used in the output of the string, then the resulting string length may differ from that obtained by the <b>ksGetTextLength</b> method. <br><br>  <b>Conclusion</b> <br><br>  In this lesson, we learned how to display simple text labels using the <b>ksText</b> method.  This is not the only way to display text, but perhaps the easiest.  In the next lesson we will look at how to use this method to display complex compound strings.  And on the following we will consider more complex text output methods. <br><br>  <b>To be continued, stay tuned to the blog.</b> <br><br> <a href=""><img src="https://habrastorage.org/web/595/eee/f27/595eeef271b24830b3578751fcb52716.png"></a>  Sergey Norseev, Ph.D., author of the book ‚ÄúDevelopment of applications for COMPAS in Delphi‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/417723/">https://habr.com/ru/post/417723/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417709/index.html">Where and how do developers rate their employers? Services assessment companies in the IT industry</a></li>
<li><a href="../417711/index.html">What to read on Swift in Russian?</a></li>
<li><a href="../417715/index.html">Goodbye google maps</a></li>
<li><a href="../417717/index.html">What was the Earth like when it was as hot on it as promised in 2100?</a></li>
<li><a href="../417721/index.html">Graphic processors in solving modern IT problems</a></li>
<li><a href="../417725/index.html">How ‚ÄúFlant‚Äù Hires Employees</a></li>
<li><a href="../417727/index.html">Blue Origin has returned to Earth and reusable level, and the crew capsule</a></li>
<li><a href="../417729/index.html">The Intel Core i7-8086K (Part 2)</a></li>
<li><a href="../417731/index.html">Story of a single t61</a></li>
<li><a href="../417733/index.html">Java 9 tutorial for those who have to work with legacy code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>