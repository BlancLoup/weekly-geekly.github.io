<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenCL: we waited - version 1.1 from nVidia, but what's new?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A bit of history or the promised three years waiting 
 A little more than a year ago, Khronos Group introduced a new version of OpenCL 1.1 and nVidia ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenCL: we waited - version 1.1 from nVidia, but what's new?</h1><div class="post__text post__text-html js-mediator-article"><h4>  A bit of history or the promised three years waiting </h4><br>  A little more than a year ago, Khronos Group introduced a new version of OpenCL 1.1 and nVidia immediately boasted that it already had a pre-release driver ready to support the new standard.  Everything would be fine, but only the pre-release is not a working tool (there is enough of bugs in the official drivers, and so much for the test version), so the developers honestly waited for the release of the new version.  CUDA 4 was released, and OpenCL wasn‚Äôt and wasn‚Äôt.  Moreover, even the pre-release version of OpenCL was excluded from the new version of the drivers, i.e.  I had to choose between the old driver with CUDA 3 + OpenCL 1.1 or the new driver with CUDA 4 + OpenCL 1.0.  But today it is done!  Developers received a letter stating that the final version is already available in the official drivers of 280.13, although it is still a beta version, but not for long. <br><br>  So, I decided to remember what is so new and good in the new version, to share comments about why this or that function might be needed and whether there are any pitfalls you need to know about. <br><a name="habracut"></a><br><br><h4>  What's new in OpenCL 1.1 </h4><br>  Let's go through the list of the Khronos Group, and if I remember something that is not there, then I will add. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Host-thread safety </h5><br>  Thread safety is a useful thing, now we don‚Äôt need to think about what to call and how to synchronize.  As far as it is relevant - a good question, as long as one card is used, there is no particular sense.  When there are a lot of cards and for each stream, then yes, life becomes simpler. <br>  There is a truth here that there is one exception, which is usually not written about: the clSetKernelArg function is not thread-safe if it is called for the same kernel object (although for different, call it on health).  They did it either for the sake of speed (I don‚Äôt see much sense), or because there‚Äôs still no point in using the same object in different streams, but fact is a fact, so be careful. <br><br><h5>  Sub-buffer object </h5><br>  In fact, you can now split the buffer into several pieces and send the desired piece to the desired device.  Again, useful for the case of multiple video cards and improved portability.  Yes, and data integrity is preserved when you do not need to make a separate buffer for each card.  In general, it would be possible to manage, but it will come in handy. <br>  Small nuance (quite logical): you cannot simultaneously write to a sub-buffer and read from an intersecting sub-buffer or main buffer, in this case the result is not defined. <br><br><h5>  User events </h5><br>  The <b>clCreateUserEvent</b> and <b>clSetUserEventStatus</b> commands <b>have</b> <b>appeared</b> , which allow the user to create his own events.  Previously, it was possible to tie everything only to those events that occurred after the execution of OpenCL commands.  Again, you can do without it (just by adding new commands to the queue after an event), but it has become more convenient. <br><br><h5>  Event callbacks </h5><br>  The <b>clSetEventCallback</b> function has <b>appeared</b> , which registers user-defined functions called upon corresponding changes in the status of an event.  You can add several custom functions, but the order of their call is not defined.  I already like this addition, before I had to check the status of the event every few ms, now everything is convenient, and most importantly, the very few seconds are saved and the whole process is simplified.  Something I need to remind ActionScript :) <br><br>  By the way, another useful function can be <b>clSetMemObjectDestructorCallback</b> , which allows you to add a user-defined function that is called when the cl_mem object is deleted. <br><br><h5>  3-component vector </h5><br>  There used to be vectors with the size of 2, 4, 8, 16, only we all live in 3-dimensional space and three-dimensional vectors are a popular thing.  And if you use 4-dimensional, then you already lose the whole register, which is a great waste.  You can of course make your own, but they will not be processed by the built-in geometric functions of OpenCL.  It is certainly not scary, you can write your own (the question of whether there is hardware acceleration of built-in functions or not is still a mystery for me, I will have to be checked somehow), but that with native support will be more beautiful (more beautiful in my case = easier to maintain) is a fact. <br><br><h5>  Global work-offset which enable the kernels for the NDRange </h5><br>  Honestly, I always thought it was before.  Yes, and in the official documentation for both versions it is.  If anyone knows what has changed here, write off pliz. <br><br><h5>  Read, write and copy a 1D, 2D or 3D rectangular region of a buffer object </h5><br>  The <b>clEnqueueReadBufferRect, clEnqueueWriteBufferRect, and clEnqueueCopyBufferRect</b> functions appeared that allow you to copy a rectangular area of ‚Äã‚Äãthe buffer.  Those.  if you store a matrix or image in the buffer (the same matrix in essence) line by line, but you only need to get a part of it, you no longer need to read / copy / write the entire buffer or issue a command to each row, or you can simply specify the parameters of the matrix and OpenCL will do everything himself.  Personally, I have never had to do this, but it should be useful for large matrices. <br><br><h5>  Mirrored repeat addressing </h5><br>  If you store the image as a texture, then you can use <b>CLK_ADDRESS_MIRRORED_REPEAT</b> so that when you exit the border of the texture, the result is <b>displayed</b> as if it were reflected there.  And it works as many times as necessary, the reflections alternate. <br><br><h5>  Any various additions and improvements </h5><br>  <b>The CL_KERNEL_PREFERRED_WORK_GROUP_SIZE_MULTIPLE</b> argument to the <b>clGetKernelWorkGroupInfo</b> function should prompt a multiplier for the size of the group that is suitable for this device.  If I understand correctly, this piece will give us the size of the warp (so that the group size always includes several whole warps) and is intended for auto-tuning the application on different platforms.  But I have not tried it yet, so I could be wrong. <br><br>  <b>The CL_CONTEXT_NUM_DEVICES</b> argument for the <b>clGetContextInfo</b> function <b>tells</b> us how many devices are in context. <br><br>  One useful thing to find out in the program which version of OpenCL is used is <b>CL_VERSION_1_0 and CL_VERSION_1_1 macros</b> <br><br>  More standard extensions such as: <br>  <b>cl_khr_byte_addressable_store</b> <b><br></b>  <b>cl_khr_global_int32_base_atomics,</b> <b><br></b>  <b>cl_khr_global_int32_extended_atomics,</b> <b><br></b>  <b>cl_khr_local_int32_base_atomics,</b> <b><br></b>  <b>cl_khr_local_int32_extended_atomics</b> . <br>  And the prefix for embedded atomic operations was changed from <b>atom_</b> to <b>atomic_</b> . <br><br>  There are 2 new extensions: <br>  <b>cl_khr_gl_event and cl_khr_d3d10_sharing</b> . <br><br>  There are also several new commands: <br>  <b>get_global_offset</b> <b><br></b>  <b>minmag</b> <b><br></b>  <b>maxmag,</b> <b><br></b>  <b>async_work_group_strided_copy,</b> <b><br></b>  <b>vec_step,</b> <b><br></b>  <b>shuffle,</b> <b><br></b>  <b>shuffle2.</b> <br><br>  I would describe all the updates, but I want to sleep, I hope someone will find this list useful. <br><br>  PS: Again, I don‚Äôt have a single line of code in the post, I promise to fix it later, there are a lot of ideas about examples and tests, but for now we will live without it :) <br><br>  PS2: In the past, my post <a href="http://habrahabr.ru/blogs/hi/125398/">OpenCL: versatility and high performance, or not so simple?</a>  they asked about a book about OpenCL and then I had nothing to answer.  So, today I discovered that just a week ago the book <a href="http://www.amazon.com/OpenCL-Programming-Guide-Aaftab-Munshi/dp/0321749642/ref%3Dsr_1_1%3Fie%3DUTF8%26qid%3D1312511835%26sr%3D8-1">‚ÄúOpenCL Programming Guide‚Äù was published</a> .  I have not read it yet, but a quick look revealed that it looks quite interesting. </div><p>Source: <a href="https://habr.com/ru/post/125687/">https://habr.com/ru/post/125687/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125677/index.html">Different configs for production mode and debug mode. Two in one</a></li>
<li><a href="../125681/index.html">How WebsiteDefender Works</a></li>
<li><a href="../125683/index.html">This year will be published source Doom III</a></li>
<li><a href="../125684/index.html">Connecting the Community</a></li>
<li><a href="../125685/index.html">How to create a company with a short history of operating activities</a></li>
<li><a href="../125689/index.html">6,000,000,000 photos on Flickr</a></li>
<li><a href="../125690/index.html">Diablo 3 beta test starts</a></li>
<li><a href="../125693/index.html">Google Music Beta gives users two sets of cloud keys for their best friends.</a></li>
<li><a href="../125695/index.html">StructureMap - quick reference for work (2/3)</a></li>
<li><a href="../125697/index.html">Several patents. Part 1. Apple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>