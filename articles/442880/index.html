<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Virtual Check Points: Customization Checklist</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many clients who rent cloud resources from us use virtual Check Points. With their help, clients solve various tasks: someone controls the output of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Virtual Check Points: Customization Checklist</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/o2/xl/gk/o2xlgke6hdhz3btlzb10ynfm5r4.png"><br><br>  Many clients who rent cloud resources from us use virtual Check Points.  With their help, clients solve various tasks: someone controls the output of the server segment to the Internet or publishes their services for our equipment.  Someone needs to push all traffic through the IPS blade, while someone needs Check Point as a VPN gateway to access internal resources in the data center from the branches.  There are those who need to protect their infrastructure in the cloud in order to pass certification on FZ-152, but I will tell you about this separately. <br><br>  On duty, I am engaged in the support and administration of Check Points.  Today I will tell you what to consider when deploying a cluster of Check Points in a virtual environment.  I will touch on the moments of the level of virtualization, network, settings of Check Point itself and monitoring. <br>  I do not promise to discover America - there are many things in the recommendations and best practices of the vendor.  But nobody reads them), so they drove. <br><a name="habracut"></a><br><h3>  Cluster mode </h3><br>  We Check Point live in clusters.  The most frequent installation is a cluster of two nodes in active-standby mode.  If something happens to an active node, it becomes inactive, and a standby-node is activated.  Switching to a ‚Äúspare‚Äù node usually occurs due to synchronization problems between the cluster members, the state of the interfaces, the established security policy, simply because of the heavy load on the equipment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In a cluster of two nodes, we do not use active-active mode. <br><br>  If one of the nodes falls, the surviving node may simply not sustain a double load, and then we will lose everything.  If you really want active-active, then there should be at least 3 nodes in the cluster. <br><br><h3>  Network and virtualization settings </h3><br>  <b>On network equipment, multicast traffic is allowed between SYNC interfaces of cluster members.</b>  <b>If multicast traffic is not possible, then synchronization protocol (CCP) is used by broadcast.</b>  Nodes in the Check Point cluster synchronize with each other.  Change messages are transmitted from node to node through multicast.  Check Point has a non-standard multicast implementation (a non-multicast IP address is used).  Because of this, some equipment, such as the Cisco Nexus switch, does not understand these messages and therefore blocks them.  In this case, switch to broadcast. <br><br><img src="https://habrastorage.org/webt/od/yo/cz/odyoczg_ya75ovj4zfpquljfkdw.png"><br>  <i>Description of the problem with Cisco Nexus and its solutions on the vendor portal.</i> <br><br>  At the level of virtualization, we also allow the passage of multicast traffic.  If multicast is not allowed for cluster synchronization (CCP), then we use broadcast. <br><br>  In the Check Point console with the help of the command cphaprob -a if you can see the CPP settings and its mode of operation (multicast or broadcast).  To change the mode of operation, use the command cphaconf set_ccp broadcast. <br><br><img src="https://habrastorage.org/webt/e6/ki/7j/e6ki7jzhw6py2bo9rf3v5wbz3wy.png"><br><br>  <b>Cluster nodes must reside on different ESXi hosts.</b>  Everything is clear: when the physical host drops, the second node continues to work.  This can be achieved using DRS anti-affinity rules. <br><br>  <b>Sizes of the virtual machine on which Check Point will work.</b>  Recommendations vendor - 2 vCPU and 6 GB, but it is for the minimum configuration, for example, if you have a firewall running with a minimum bandwidth.  According to our implementation experience, when using several software blades, it is desirable to use at least 4 vCPU, 8 GB RAM. <br>  On the node, we allocate an average of 150 GB of disk.  When deploying a virtual Check Point, the disk is divided into partitions, and we can adjust how much space to allocate for System Swap, System Root, Logs, Backup and Upgrade. <br><br>  As System Root increases, the Backup and Upgrade partition also needs to be increased in order to keep the proportion between them.  If the proportion is not met, then the next backup may not fit the disk. <br><br>  <b>Disk Provisioning - Thick Provision Lazy Zeroed.</b>  Check Point generates many events and logs, 1000 entries appear every second.  It is better to reserve a place for them right away.  To do this, when creating a virtual machine, we allocate a disk using the Thick Provisioning technology;  there is a place in the physical storage at the time of the disk creation. <br><br>  Configured 100% reservation resources for Check Point when migrating between ESXi hosts.  We recommend that you reserve 100% of the resources so that the virtual machine to which Check Point is deployed does not compete for resources with other VMs on the host. <br><br>  <b>Other</b>  We use the Check Point version of the R77.30.  It is recommended to use RedHat Enterprise Linux version 5 (64-bit) as a guest OS on a virtual machine.  From network drivers - VMXNET3 or Intel E1000. <br><br><h3>  Check Point Settings </h3><br>  <b>The latest Check Point updates are installed on the gateways and the management server.</b>  Check for updates via CPUSE. <br><br><img src="https://habrastorage.org/webt/of/o_/dw/ofo_dw7xmv7s_ot1qgpz6svmkd0.png"><br><br>  With Verifier, we verify that the update package we are about to install does not conflict with the system. <br><br><img src="https://habrastorage.org/webt/f-/6z/cn/f-6zcnlkxh8vpat2cam5ciszoyi.png"><br><br><img src="https://habrastorage.org/webt/dr/y-/kp/dry-kpzjts8ky_7v-z-eonatnha.png"><br><br>  Verifier, of course, is a good thing, but there are nuances.  Some updates are incompatible with add-ons, but Verifier will not show these conflicts and allow for updates.  At the end of the update you will have an error, and only from it you will learn what prevents the update.  For example, this situation arose with the MABDA_001 (Mobile Access Blade Deployment Agent) update package, which solves the problem of launching the Java Plugin in browsers other than IE. <br><br>  <b>Configured daily automatic update of signatures for IPS and other software blades.</b>  Check Point releases signatures that can be used to detect or block new vulnerabilities.  Vulnerabilities are automatically assigned a severity level.  In accordance with this level and the set filter, the system decides whether to detect or block the signature.  Here it is important not to overdo the filters, periodically check and make adjustments so as not to block legitimate traffic. <br><br><img src="https://habrastorage.org/webt/0p/hh/p-/0phhp-2og69lvtrtq8mfnrcwbf4.png"><br>  <i>IPS profile, where we choose the action in relation to the signature in accordance with its parameters.</i> <br><br><img src="https://habrastorage.org/webt/n1/si/jb/n1sijbwodxv-p_ubudt8h_rqzne.png"><br>  <i>Policy settings for this IPS profile in accordance with the signature parameters: severity level, performance impact, etc.</i> <br><br>  <b>On the Check Point hardware, the NTP time synchronization protocol is configured.</b>  As <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%26solutionid%3Dsk104848">recommended</a> , Check Point should use an external NTP server to synchronize the time on the hardware.  This can be done through the gaia web portal. <br><br>  Inaccurately set time can lead to a cluster out of sync.  If the time is wrong, it is extremely inconvenient to look for the record of interest to us in the logs.  Each entry in the event logs is marked by a so-called timestamp. <br><br><img src="https://habrastorage.org/webt/ce/ve/2x/ceve2x6z2nfrpuvablszwwjmnmk.jpeg"><br><br><img src="https://habrastorage.org/webt/rd/dm/gj/rddmgjxuih_jftgacbqp96nzaja.png"><br><br>  <b>Configured Smart Event for notification of IPS, App Control, Anti-Bot, etc. operations.</b> This is a separate module with its own license.  If you have one, then with its help it is convenient to visualize information about the operation of all software blades and devices.  For example, attacks, the number of IPS attacks, the level of threat criticality, which prohibited applications are used by users, etc. <br><br><img src="https://habrastorage.org/webt/sm/ep/hi/smephijff9iy11roy-gkad-he7y.png"><br><br><img src="https://habrastorage.org/webt/px/ey/q8/pxeyq8x3j3uvpegh2vovripqtxi.png"><br>  <i>These are statistics for 30 days by the number of signatures and the degree of their criticality.</i> <br><br><img src="https://habrastorage.org/webt/qa/if/-y/qaif-yr2di_vhaskm2runvouki8.jpeg"><br>  <i>More information on detected signatures on each software blade.</i> <br><br><h3>  Monitoring </h3><br>  It is important to track at least the following parameters: <br><br><ul><li>  cluster status; </li><li>  availability of Check Point components; </li><li>  CPU load </li><li>  remaining disk space; </li><li>  free memory. </li></ul><br>  Check Point has a separate software blade - Smart Monitoring (separate license).  It can additionally monitor the availability of Check Point components, loads on individual blades, license status. <br><br><img src="https://habrastorage.org/webt/ql/oi/gz/qloigzwdx53cfz5blmpp8pugqnk.png"><br><br><img src="https://habrastorage.org/webt/om/su/2e/omsu2enoalcopmgatfhmmvchasc.png"><br>  <i>Schedule for load on Chek Point.</i>  <i>Splash - this customer sent push-notifications to 800 thousand customers.</i> <br><br><img src="https://habrastorage.org/webt/o4/dx/gf/o4dxgfya60iv0mj5hbfzwtqedxe.png"><br>  <i>The graph for the load on the Firewall blade in the same situation.</i> <br><br>  Monitoring can be configured through third-party services.  We, for example, also use Nagios, where we monitor: <br><br><ul><li>  network availability of equipment; </li><li>  availability of a cluster address; </li><li> CPU load by cores  When loading more than 70% comes an alert in the mail.  Such a high load may indicate specific traffic (vpn, for example).  If this is often repeated, then perhaps there are not enough resources and it is worth expanding the pool. </li><li>  free RAM  If less than 80% remains, then we will find out. </li><li>  disk loading on certain partitions, for example var / log.  If it scores soon, it must be expanded. </li><li>  Split Brain (at the cluster level).  We track the state when both nodes become active and synchronization between them disappears. </li><li>  High availability mode - we monitor that the cluster is operating in active-standby mode.  We look at the status of the node - active, standby, down. </li></ul><br><img src="https://habrastorage.org/webt/sa/6i/h6/sa6ih63oph6qaclqiwstgzclq2u.png"><br>  <i>Monitoring options in Nagios.</i> <br><br>  It is also worth monitoring the status of the physical servers on which ESXi hosts are deployed. <br><br><h3>  Backup </h3><br>  The vendor himself recommends making a snapshot immediately after installing the update (Hotfixies). <br><br>  Depending on the frequency of changes, a full backup is set once a week or a month.  In our practice, we do daily incremental copying of Check Point files and a full backup once a week. <br><br>  That's all.  These were the most basic points that need to be taken into account when deploying virtual Check Points.  But even the implementation of this minimum will help avoid problems with their work. </div><p>Source: <a href="https://habr.com/ru/post/442880/">https://habr.com/ru/post/442880/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442866/index.html">AI, trained on the basis of decades of culinary experiments, creates new dishes</a></li>
<li><a href="../442868/index.html">A brief excursion into the data center cooling system. Advantages and disadvantages</a></li>
<li><a href="../442870/index.html">The best of the world of Angular for the week - Digest number 2 (January 26 - March 7)</a></li>
<li><a href="../442876/index.html">Noise mapping with KSQL, Raspberry Pi and radio</a></li>
<li><a href="../442878/index.html">Complete the quest ‚ÄúObservation versus Freedom‚Äù and capture the trophies.</a></li>
<li><a href="../442882/index.html">[Video] "No need for pies" and three more project management ideas</a></li>
<li><a href="../442884/index.html">Already, technology allows you to talk to the car as a person</a></li>
<li><a href="../442888/index.html">Customize select on pure css</a></li>
<li><a href="../442890/index.html">CYOD? COPE? BYOD?</a></li>
<li><a href="../442894/index.html">Maybe we‚Äôll see ads in Google Images very soon.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>