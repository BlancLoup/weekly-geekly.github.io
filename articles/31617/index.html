<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intrusion Detection For PHP Applications With PHPIDS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will show how to configure PHPIDS . PHPIDS (PHP-Intrusion Detection System) is an easily used, well-structured, fast interlayer for analy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intrusion Detection For PHP Applications With PHPIDS</h1><div class="post__text post__text-html js-mediator-article">  This article will show how to configure <a href="http://php-ids.org/">PHPIDS</a> .  PHPIDS (PHP-Intrusion Detection System) is an easily used, well-structured, fast interlayer for analyzing the security of your applications.  IDS is not a layer for analyzing user input; it only recognizes when they try to attack your site.  based on a set of tested and tested rules, each attack is assigned a hazard rating.  This will allow you to easily save attack statistics or send notifications to the development team. <br><a name="habracut"></a><br><br>  <strong>Foreword</strong> <br>  Examples for this article were made on Debian Etch LAMP with Apache version 2 and PHP5, IP - 192.168.0.100. <br>  Apache user and group - www-data.  The path to php.ini is /etc/php5/apache2/php.ini.  The / var / www / web1 / web was used as the document root for the virtual host. <br><br>  <strong>Installing PHPIDS</strong> <br>  From the security images, I installed PHPIDS beyond document root, so I created / var / www / web1 / phpids: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then I installed PHPIDS (at the time of installation, the latest version was 0.4.7). <br><blockquote>  cd / tmp <br>  wget <a href="">php-ids.org/files/phpids-0.4.7.tar.gz</a> <br>  tar xvfz phpids-0.4.7.tar.gz <br>  cd phpids-0.4.7 <br>  mv lib / / var / www / web1 / phpids / <br>  cd / var / www / web1 / phpids / lib / IDS <br>  chown -R www-data: www-data tmp / <br></blockquote><br><br>  Next, I reconfigured Config.ini: <br><blockquote>  cd config / <br>  vi Config.ini <br></blockquote><br><br>  I use the default configuration, and all I have to do is change the paths. <br><blockquote>  ;  PHPIDS Config.ini <br><br>  ;  General configuration settings <br><br>  ;  !!! DO NOT PLACE THIS FILE INSIDE THE WEB-ROOT IF DATABASE CONNECTION DATA WAS ADDED !!! <br><br>  [General] <br><br>  filter_type = xml <br>  filter_path = /var/www/web1/phpids/lib/IDS/default_filter.xml <br>  tmp_path = / var / www / web1 / phpids / lib / IDS / tmp <br>  scan_keys = false <br><br>  exceptions [] = __utmz <br>  exceptions [] = __utmc <br><br>  ;  If you use the PHPIDS logger you can define specific configuration here <br><br>  [Logging] <br><br>  ;  file logging <br>  path = /var/www/web1/phpids/lib/IDS/tmp/phpids_log.txt <br><br>  ;  email logging <br><br>  ;  spam attempts, <br>  ;  see documentation <br>  recipients [] = test@test.com.invalid <br>  subject = "PHPIDS detected an intrusion attempt!" <br>  header = "From: info@php-ids.org" <br>  safemode = true <br>  allowed_rate = 15 <br><br>  ;  database logging <br><br>  wrapper = "mysql: host = localhost; port = 3306; dbname = phpids" <br>  user = phpids_user <br>  password = 123456 <br>  table = intrusions <br><br>  ;  If you would like <br><br>  [Caching] <br><br>  ;  caching: session | file | database | memcached | none <br>  caching = file <br>  expiration_time = 600 <br><br>  ;  file cache <br>  path = /var/www/web1/phpids/lib/IDS/tmp/default_filter.cache <br><br>  ;  database cache <br>  wrapper = "mysql: host = localhost; port = 3306; dbname = phpids" <br>  user = phpids_user <br>  password = 123456 <br>  table = cache <br><br>  ;  memcached <br>  ; host = localhost <br>  ; port = 11211 <br>  ; key_prefix = PHPIDS <br>  ; tmp_path = /var/www/web1/phpids/lib/IDS/tmp/memcache.timestamp <br><br><br>  <strong>Using PHPIDS</strong> <br><br>  Now we will create /var/www/web1/web/phpids.php that will use PHPIDS <br><blockquote>  set_include_path ( <br>  get_include_path () <br>  .  PATH_SEPARATOR <br>  .  '/ var / www / web1 / phpids / lib' <br>  ); <br><br>  require_once 'IDS / Init.php'; <br>  $ request = array ( <br>  'REQUEST' =&gt; $ _REQUEST, <br>  'GET' =&gt; $ _GET, <br>  'POST' =&gt; $ _POST, <br>  'COOKIE' =&gt; $ _COOKIE <br>  ); <br>  $ init = IDS_Init :: init ('/ var / www / web1 / phpids / lib / IDS / Config / Config.ini'); <br>  $ ids = new IDS_Monitor ($ request, $ init); <br>  $ result = $ ids-&gt; run (); <br><br>  if (! $ result-&gt; isEmpty ()) { <br>  // Take a look at the result object <br>  echo $ result; <br>  require_once 'IDS / Log / File.php'; <br>  require_once 'IDS / Log / Composite.php'; <br><br>  $ compositeLog = new IDS_Log_Composite (); <br>  $ compositeLog-&gt; addLogger (IDS_Log_File :: getInstance ($ init)); <br>  $ compositeLog-&gt; execute ($ result); <br>  } <br></blockquote><br><br>  After that enter <a href="http://192.168.0.100/phpids.php">192.168.0.100/phpids.php</a> in your browser and you will see a blank page. <br>  However, if you add different parameters, for example <a href="http://192.168.0.100/phpids.php%3Ftest%3D%2522%253EXXX%253Cscript%253Ealert">192.168.0.100/phpids.php?test=%22%3EXXX%3Cscript%3Ealert</a> (1)% 3C / script% 3E, PHPIDS will determine them and print the result in the browser <br><br><img src="https://habrastorage.org/getpro/habr/olpictures/753/00a/5a6/75300a5a6f23e84a5bf7d8069d3fcd8e.png" width="450" height="293" hspace="10" vspace="10"><br><br>  We will now make PHPIDS use in every script you make.  Of course, you do not have to modify every php file on your system.  We will tell php to run PHPIDS every time the script starts.  We do this using the auto_prepend_file parameter.  To do this, we will make a modification in php.ini or .htaccess file <br><blockquote>  auto_prepend_file = /var/www/web1/web/phpids.php <br>  or for .htaccess <br>  php_value auto_prepend_file /var/www/web1/web/phpids.php <br></blockquote><br>  Restart your Apache (for the case with the modification of php.ini) <br><br>  Create an info.php file with contents <br><blockquote>  phpinfo (); </blockquote><br>  Write in the browser <a href="http://192.168.0.100/info.php">192.168.0.100/info.php</a> and you will see the normal output of the phpinfo () command <br>  now add parameters, for example <a href="http://192.168.0.100/info.php%3Ftest%3D%2522%253EXXX%253Cscript%253Ealert">192.168.0.100/info.php?test=%22%3EXXX%3Cscript%3Ealert</a> (1)% 3C / script% 3E <br>  and you will see <br><br><img src="https://habrastorage.org/getpro/habr/olpictures/3c6/3f0/b86/3c63f0b8626a9ea352739434f991c329.png" width="450" height="293" hspace="10" vspace="10"><br><br>  PHPIDS will write this data to /var/www/web1/phpids/lib/IDS/tmp/phpids_log.txt <br><blockquote>  ‚Äú192.168.0.200‚Äù, 2008-06-04T17: 36: 08 + 02: 00,54, ‚Äúxss csrf id rfe lfi‚Äù, ‚ÄúREQUEST.test =% 5C% 22% 3EXXX% 3Cscript% 3Ealert% 281% 29% 3C% 2Fscript% 3E GET.test =% 5C% 22% 3EXXX% 3Cscript% 3Ealert% 281% 29% 3C% 2Fscript% 3E ", <br>  "% 2Finfo.php% 3Ftest% 3D% 2522% 253EXXX% 253Cscript% 253Ealert% 281% 29% 253C% 2Fscript% 253E" </blockquote><br><br>  Now, looking through the records.  You will see that the hacker was trying to do something with your application. <br><br>  To add another security level for your application, you can stop the script if PHPIDS detects an attack: <br>  we can add something like this <br>  die (' <h1>  Go away! </h1>  '); <br>  to the if (! $ result-&gt; isEmpty ()) {} section in the /var/www/web1/web/phpids.php script file <br><blockquote>  set_include_path ( <br>  get_include_path () <br>  .  PATH_SEPARATOR <br>  .  '/ var / www / web1 / phpids / lib' <br>  ); <br><br>  require_once 'IDS / Init.php'; <br>  $ request = array ( <br>  'REQUEST' =&gt; $ _REQUEST, <br>  'GET' =&gt; $ _GET, <br>  'POST' =&gt; $ _POST, <br>  'COOKIE' =&gt; $ _COOKIE <br>  ); <br>  $ init = IDS_Init :: init ('/ var / www / web1 / phpids / lib / IDS / Config / Config.ini'); <br>  $ ids = new IDS_Monitor ($ request, $ init); <br>  $ result = $ ids-&gt; run (); <br><br>  if (! $ result-&gt; isEmpty ()) { <br>  // Take a look at the result object <br>  echo $ result; <br>  require_once 'IDS / Log / File.php'; <br>  require_once 'IDS / Log / Composite.php'; <br><br>  $ compositeLog = new IDS_Log_Composite (); <br>  $ compositeLog-&gt; addLogger (IDS_Log_File :: getInstance ($ init)); <br>  $ compositeLog-&gt; execute ($ result); <br><br>  die (' <h1>  Go away! </h1>  '); <br>  } <br></blockquote><br><br>  If there is no attack, the script will continue execution, otherwise the hacker will see it. <br><img src="https://habrastorage.org/getpro/habr/olpictures/9e7/f13/ae1/9e7f13ae1f614803ecbd0ce145a543df.png" width="450" height="293" hspace="10" vspace="10"><br><br>  <strong><em>translator comment</em></strong> <br>  The above examples can be used on combat systems.  However, this would require some kind of conversion. <br><blockquote>  $ init = IDS_Init :: init ('/ var / www / web1 / phpids / lib / IDS / Config / Config.ini'); <br></blockquote><br>  since every time there is no need to load the settings file from the file, and replace it with the class written in advance </blockquote></div><p>Source: <a href="https://habr.com/ru/post/31617/">https://habr.com/ru/post/31617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../31616/index.html">Is there life on the Mac? Office: Part 2</a></li>
<li><a href="../316160/index.html">What does the November update Steam for indie developers mean?</a></li>
<li><a href="../316164/index.html">Progress does not stand still: OpenMP 4.5</a></li>
<li><a href="../316166/index.html">CTFzone write-ups - Going 300, going 500, OSINT sold</a></li>
<li><a href="../316168/index.html">Microsoft data center from Cheyenne switches to wind energy</a></li>
<li><a href="../316170/index.html">Lectures of the Technosphere. Preparatory course "Algorithms and data structures" (spring 2016)</a></li>
<li><a href="../316174/index.html">Security Week 47: Android bookmarks, Wi-Fi security, NTP vulnerability</a></li>
<li><a href="../31618/index.html">A small review of Ubuntu MID Edition 8.04</a></li>
<li><a href="../316180/index.html">The tale of backend, ruby ‚Äã‚Äãand rails</a></li>
<li><a href="../316184/index.html">Information Security of the Process Control System: Don Quixote in the Cyber ‚Äã‚ÄãWeaponry Era</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>