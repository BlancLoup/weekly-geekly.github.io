<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bolid integration in 1C or how we tamed the access control system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somewhere in 2009, when there was still no talk about the group of companies in its current form, i-Free rented space in the business center, first oc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bolid integration in 1C or how we tamed the access control system</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/477/958/1fb/4779581fbf8f410a95d4ae9057f8647a.gif"><br><br>  Somewhere in 2009, when there was still no talk about the group of companies in its current form, i-Free rented space in the business center, first occupying one room and expanding over the years. <br>  Branches in six countries of the world and placement ‚Äúwith difficulty‚Äù in four business centers of St. Petersburg are still ahead, but so far only 5 offices in different ends of the corridor and even on different floors.  The corridor is common to different tenants, the entrance to the BC is free.  Running to colleagues in another office, they often forgot to lock the door with a key.  Therefore, access control has become a necessity.  Thinking about the decision, and then the choice fell on the <a href="http://www.bolid.com/">car</a> . <br><a name="habracut"></a><br><br>  Why bolid?  There were no alternatives that were implemented in the business center, then they were ‚Äúextended‚Äù for themselves, simply because the necessary specialist was ‚Äúat hand‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We quickly decided to separate our system from the business center so that there would be no discussion about access and control of the ACS. <br>  After the appearance of a larger number of premises, they abandoned contact ‚Äútablets‚Äù in favor of more convenient contactless ones.  Em marine readers, flashcards appeared.  We bought "as many as 150 cards" and drove them into the system. <br>  Designed, assembled, setup finished, cards issued, daily work went. <br><br>  I will omit the pros, I will write about the cons, so that it is clear how and why we came to the current system. <br><br>  <b>So, the cons:</b> <br><br>  - for a simple issuance of a card, a specialist is required who has been trained to work with a very intricate Bolida interface and has appropriate access to the control program.  It means ‚Äúyou cannot go on vacation, you cannot be ill, it is forbidden to die under the penalty of the death penalty‚Äù; <br>  - very quickly it came to the understanding that cards need not only to be issued, but also changed.  With the growth of the company, over 200 employees lost at least 2 cards a week; <br>  - much more often, ‚Äúoh, I forgot today at home, give me a card‚Äù.  Up to a dozen a day; <br>  - and ‚Äúto us are guests from Beijing, 10 people, in the corridor, urgently need a card ... what do you mean once?  I need it! ‚Äù; <br>  - duplication of information input - the personnel officer enters information about the employee in 1C, the administrator - in AD, the ACS engineer - in Bolid.  Three times; <br>  - and also, the company pays for the meals of its employees, and all the time the idea was in the air "how can we eat it out on ration cards in our cafe"; <br>  ‚ÄúBut it would be nice to have such a report, but in our case all moves are logged ... what does it mean you cannot make a report?  it's a database ... ".  Reports from the car then were provided, but for the money.  And a very limited set of reports at the same time; <br><br>  <b>Implementation</b> <br><br>  The first step towards integration was the transfer of the Bolida database to the server.  Description of the database is, tried to connect from 1C - hurray!  The issue with the reports resolved.  What we want, and get this. <br><br>  As time went on, a power-on-card payment system was developed, a harbinger of the current one for <a href="http://na-lunch.ru/">Lunch.</a> <br>  The power supply system required the Mifare format, in order to organize on the card "wallet", we had to replace all the readers.  And it was the next stage. <br><br>  At some point, we grew out of ‚Äúour‚Äù business center, rented an additional two floors in another.  Connected remote premises on the local network, the benefit of Bolid posolyaet such architecture.  Much later even branches in Moscow, Ukraine, and Kazakhstan were connected to our system. <br><br>  Turnstiles at the entrance to the second BC remained a bottleneck - our readers Mifare had to hang onto other devices working with em marine.  If ‚Äúon the floors‚Äù we controlled the entrance to our premises on our own, then ‚Äúon the turnstiles‚Äù we had to regularly transfer lists of keys, new and locked.  Once a week, which created problems for the ‚Äúlosers‚Äù and new employees.  At some point, we managed to negotiate with remote business centers in parallel to put not readers, but our devices connected via the network.  And then the question of updating the keys became a matter of minutes, not days. <br><br>  At the same time, we actively studied Bolid from the inside, it turned out to be a rather flexible system.  Due to the internal macro language of the scenarios, we managed to discipline the employees: every day the script checked about 50 rooms for taking under protection, if the room was not protected, an alert was created for the person responsible for the disassembly of flights.  Plus additional amenities: setting under protection of several premises at once with a certain algorithm, or receiving comments from the security by e-mail, in case of alarming situations. <br><br>  As time passed, the transition to Mifare was finally over, and the torment with two cards from employees.  Reports on the access control system are already in 1C, corporate catering, too, it‚Äôs easy to ensure that the data from 1C get into the controllers themselves.  This is where the Orion Pro development kit came to our rescue. <br><br><img src="https://habrastorage.org/files/a51/6d2/54c/a516d254c613454085e7505fd95fab5f.png" alt="image"><br><br>  Using XML-RPC procedures, we were able to immediately update the data on the system controllers, quickly block keys or change employee access levels. <br><br>  Here is an example of how you can play around with the doors, if you have a similar system - the ControlAccess request sends a command to open the door, for this we need <a href="http://curl.haxx.se/download.html">Curl</a> and a request of the form: <br><br><div class="spoiler">  <b class="spoiler_title">ControlAccess</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="windows-1251"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">methodCall</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">methodName</span></span></span><span class="hljs-tag">&gt;</span></span>ControlAccess<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">methodName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">params</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">struct</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>ComPort<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span> //      ; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>PKUAddress<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span> //    2000\2000,   ; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>DeviceAddress<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span>111<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span> //     ; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>AggregateAddress<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span> // ,  2000-2     1; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Command<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span> //  0 ‚Äì    ,   ,      10 ; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>MethodNameForAnswer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>Result<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>IPSERVER<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>127.0.0.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> //     ; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>PORTSERVER<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span>8080<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">int</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">member</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">struct</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">params</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">methodCall</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br><br>  Save in test.txt send to the server access control, in our case it is local C: \ curl \ bin \ curl.exe -X POST -d @C: \ test.txt <a href="http://127.0.0.1/">127.0.0.1</a> : 8080 <br><br>  The lock is unlocked for the time set or until the door is opened, just do not expect that this action will remain unnoticed.  In the event log of Orion, we will see the record: DateTime - xx.xxx.xxx hh.mm.ss;  Event - Access granted (by button);  The door is the name;  Description - Login \ Exit;  The address is 1/0/111/1;  Access zone - registered in the controller. <br><br>  Soon our main business center was already small and did not satisfy current needs, for this purpose, three floors were built specially for us in the congress and exhibition center next door, in which our main office is now safely located. <br><br><img src="https://habrastorage.org/files/860/b40/89a/860b4089a85c4ca8b3f741bf2dd73518.png"><br><br>  In the course of our acquaintance with the current systems of the new business center, we again met Bolid: in the form of a fire, security system and access control system, we continued to build on it. <br><br>  Fees and relocation - a separate issue, but the result was worth <a href="http://officenext.nichost.ru/projects/%3Ftid%3D1275">it</a> . <br><br><img src="https://habrastorage.org/files/a78/626/429/a78626429bdd42679998be59edee56a6.jpg"><br><br>  The integration of the car into 1C significantly simplified administration, allowed the creation of automatic rules for changing access levels when moving an employee between departments and automatic blocking upon dismissal, but when replacing cards, operator intervention was still required. <br><br>  Here, using our <a href="http://www.smsdirect.ru/">SMS-Direct,</a> we connected the service of automatic replacement and blocking of cards, for this the employee needs to send code words, if skud block, then all available keys are blocked by the employee, if skud pin, then the code comes in response, which is needed later enter on the keyboard for authentication. <br><br>  The list of employees with phones is stored in 1C, the white list of phone numbers of employees is unloaded daily at the SMS-Direct node.  When you receive an SMS with the request, the phone number is checked according to the list, if not in the list, the answer is sent that it would be good to go to the HR department and check if everything is Ok - a random short number is generated and sent to 1C and the employee converts the pin to 1C key code for controllers: <br><br>  1234 = F300000000123401 <br>  4321 = 1B00000000432101 <br>  9876 = 9E00000000987601 <br>  4582 = 8200000000458201 <br>  123456 = 0500000012345601 <br><br>  If we analyze the last example, then 05 is a checksum, 000000 finishes up to 16 characters, 123456 is our short code, 01 is added to the end to all keys. <br><br><div class="spoiler">  <b class="spoiler_title">Cyclic checksum is obtained according to the rule of the company Dallas.</b>  <b class="spoiler_title">The calculation is as follows:</b> <div class="spoiler_text">  CRCTable: array [0..255] of byte = ( <br>  0.94,188,226,97,63,221,131,194,156,126,32,163,253,31,65, <br>  157,195,33,127,252,162,64,30,95,1,227,189,62,96,130,220, <br>  35,125,159,193,66,28,254,160,225,191,93,3,128,222,60,98, <br>  190,224,2,92,223,129,99,61,124,34,192,158,29,67,161,255, <br>  70,24,250,164,39,121,155,197,132,218,56,102,229,187,89,7, <br>  219,133,103,57,186,228,6,88,25,71,165,251,120,38,196,154, <br>  101,59,217,135,4,90,184,230,167,249,27,69,198,152,122,36, <br>  248,166,68,26,153,199,37,123,58,100,134,216,91,5,231,185, <br>  140,210,48,110,237,179,81,15,78,16,242,172,47,113,147,205, <br>  17,79,173,243,112,46,204,146,211,141,111,49,178,236,14,80, <br>  175,241,19,77,206,144,114,44,109,51,209,143,12,82,176,238, <br>  50,108,142,208,83,13,239,177,240,174,76,18,145,207,45,115, <br>  202,148,118,40,171,245,23,73,8,86,180,234,105,55,213,139, <br>  87,9,235,181,54,104,138,212,149,203,41,119,244,170,72,22, <br>  233,183,85,11,136,214,52,106,43,117,151,201,74,20,246,168, <br>  116,42,200,150,21,75,169,247,182,232,10,84,215,137,107,53); <br><br>  KeyCode: array [1..8] of byte; <br>  KeyCode [8]: = 0; <br><br>  For j: = 1 to 7 do <br>  KeyCode [8]: = CRCTable [KeyCode [8] xor KeyCode [j]]; <br></div></div><br><br>  Next, in 1C, a predefined access level is set with the antipassback enabled (so that the key is not entered 5 times) and the XML is sent to the kernel.  Orion, according to the access level, sends the keys to the necessary controllers, the controllers are waiting for our employee to appear.  Typically, the procedure for requesting a pin code takes less than a minute, after the employee has entered a pin code on the keyboard, the controller generates a signal to grant access and sends an employee authentication message to Orion.  In Orion, the monitoring of the raised key begins to the reader we need, using the ReadKeyCodeFromReader method, and the command is sent to turn on the relay 2 to give a signal to the user about the card‚Äôs ‚Äúleaning‚Äù, after receiving the code the relay is released (activating antipassback) and a request is sent in 1C, in which a short authentication code and new card code.  In 1C, the corresponding key replacement documents are created for this request.  The whole operation from sending an SMS to activating a card takes no more than a couple of minutes. <br><br>  The terminal to activate the cards is the C2000-2 controller and the reader and keyboard connected to it, plus a pack of unregistered cards.  We located one at the security post, the second in the HR department. <br><br><img src="https://habrastorage.org/files/049/730/16a/04973016a4f84e5dabfd4a072db7d345.png"><br><br>  Now, each employee can independently at any time replace the penetration and get into the office according to his access level, and even have lunch ‚Äúon penetration‚Äù a couple of hours after activation. <br>  If the form factor in the form of a card does not suit, any employee can take a leather keychain, a silicone bracelet or a sticker on the phone - which is more convenient for someone - and independently activate upon receipt, in the HR department by the same procedure. <br><br>  In the process of this automatic replacement, of course, there are too many intermediaries, and all this can be done on one device as a tablet with gsm and nfc or raspberry with a connected reader and gsm modem, but in the original data we had a Car, and it was important for us show the possibility of integration and automation of access control systems on the basis of it. <br><br>  <b>Conclusions and summary</b> <br><br>  These solutions helped us get rid of manual intervention in the access control system;  reduce to zero the risk of errors when assigning access levels and replacing \ issuing keys;  accelerate the issuance of new cards;  improve overall system security and integrate new services. <br><br>  After several years, our partner, a fairly large retail company in the FMCG field, asked for assistance in such integration into its infrastructure, which we successfully did, naturally, taking into account all the difficulties that we had to face when implementing the system in i-Free .  That is, now our solution has proved the possibility of rapid scaling in other companies, regardless of the specifics of the work and the number of employees. </div><p>Source: <a href="https://habr.com/ru/post/253551/">https://habr.com/ru/post/253551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../253537/index.html">Application Virtualization with Microsoft App-V for the Undecided</a></li>
<li><a href="../253539/index.html">Store design: multi-brand, personalization, microformats, integration with 1C and marketplaces</a></li>
<li><a href="../253545/index.html">How to catch what is not. Part one. Terms and Definitions</a></li>
<li><a href="../253547/index.html">Akka.NET Bootcamp</a></li>
<li><a href="../253549/index.html">Memo: Five-minute UX guide from Squarespace and MailChimp</a></li>
<li><a href="../253553/index.html">Checking Vim with PVS-Studio on GNU / Linux</a></li>
<li><a href="../253555/index.html">Akka.NET Bootcamp - Part 1: Starting Level Akka.NET</a></li>
<li><a href="../253557/index.html">Pwn2Own 2015: first results</a></li>
<li><a href="../253559/index.html">[case] Iteration on time or half a team?</a></li>
<li><a href="../253561/index.html">We start PHPUnit tests for the project on 1C-Bitrix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>