<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CRI-O - Docker alternative to launch containers in Kubernetes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many DevOps engineers and system administrators, especially those who have worked with Kubernetes, have already heard about the CRI-O project, entitle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CRI-O - Docker alternative to launch containers in Kubernetes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/59/e0/68/59e068eaa4df1768527655.png"><br><br>  Many DevOps engineers and system administrators, especially those who have worked with Kubernetes, have already heard about the <a href="http://cri-o.io/">CRI-O</a> project, entitled ‚Äúthe lightweight executable environment for containers in Kubernetes‚Äù.  Often, however, ideas about its purpose, capabilities, and status are very blurred ‚Äî due to the youth of the project, lack of practical experience and the growing number of changes in the standards for containers.  This article is an educational program about CRI-O, which tells about the appearance of the project, its features and current status. <a name="habracut"></a><br><br><h2>  Appearance history </h2><br>  Following the growing popularity of Linux containers, in mid-2015, the non-profit organization The Linux Foundation, with the assistance of CoreOS, Docker, Red Hat, and several other companies, <a href="https://www.nixp.ru/news/13486.html">presented</a> the Open Container Project, now known as the <a href="https://www.opencontainers.org/"><b>Open Container Initiative (OCI)</b></a> .  His goal is to create open industry standards for container formats and executable environments. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/59/e0/6a/59e06aff86db6866787732.png"><br><br>  It was assumed that the project will combine the base of competing products for containers, such as Docker runc and CoreOS appc, into common standards.  The actual result of the OCI activity was the <a href="https://www.nixp.ru/news/14118.html">release</a> last summer of version 1.0 for two standards: <br><br><ul><li>  for the executable container environment ( <b>Runtime Specification</b> , <a href="https://github.com/opencontainers/runtime-spec/">runtime-spec</a> ) - determines how the ‚Äúfilesystem bundle‚Äù is launched with the contents of the container (the reference implementation is the same runc); </li><li>  for the container image format ( <b>Image Specification</b> , <a href="https://github.com/opencontainers/image-spec">image-spec</a> ) - defines the format from which the container image will be unpacked into the filesystem bundle (for further launch). </li></ul><br>  At the same time and independently of the Open Container Initiative, but ‚Äúwith a focus on promoting standards for containers through OCI‚Äù, Red Hat set <b>about</b> creating the <b>Open Container Initiative Daemon OCID</b> , placing it in the <a href="https://github.com/kubernetes-incubator/cri-o">incubator</a> of the Kubernetes project and <a href="https://www.redhat.com/en/blog/running-production-applications-containers-introducing-ocid">announcing</a> in September 2016 . <br><br>  As part of OCID, Red Hat engineers were going to develop innovations in the field of containers: the executable environment, the distribution of images, storage, their signatures, etc.  At the same time, the project was positioned as ‚Äúnot competing with Docker‚Äù, because ‚Äúin reality it uses the same OCI runc executable environment that is used in the Docker Engine, the same image format and allows you to use <code>docker build</code> and related tools.‚Äù <br><br>  Even then, OCID was called the ‚Äúimplementation of the standard interface for the executable environment for containers in Kubernetes‚Äù, in which the UNIX philosophy followed, when one utility performs one task.  Therefore, the OCID functionality was immediately broken down into the following components: <br><br><ul><li>  OCI Container Runtime Environment (runc); </li><li>  <a href="https://github.com/opencontainers/runtime-tools">OCI Runtime Tools</a> <i>(developed in OCI toolkit for working with runtime-spec)</i> ; </li><li>  <a href="https://github.com/containers/image">containers / image</a> <i>(a set of Go language libraries for working with container images and registries - these features are also available through the console <a href="https://github.com/projectatomic/skopeo">skopeo</a> utility created in Red Hat for Project Atomic)</i> ; </li><li>  <a href="https://github.com/containers/storage">containers / storage</a> <i>(Go library, which provides methods for storing file system layers, container images and containers themselves; includes a wrapper with a console interface)</i> ; </li><li>  <a href="https://github.com/containernetworking/cni">CNI (Container Network Interface)</a> <i>(specification and libraries for managing network interfaces in containers - we‚Äôve written more about CNI in <a href="https://habrahabr.ru/company/flant/blog/329830/">this article</a> )</i> . </li></ul><br>  However, the <i>name</i> ‚ÄúOCID‚Äù, which directly refers to the OCI initiative, was not approved by the Open Container Initiative itself, since it did not belong to the list of official OCID projects.  And soon after the first announcement, at the <a href="https://thenewstack.io/oci-distances-ocid-container-project-now-named-cri-o/">request of OCI</a> , the project received a new name - <a href="http://cri-o.io/"><b>CRI-O</b></a> (‚ÄúCRI‚Äù stands for ‚ÄúContainer Runtime Interface‚Äù). <br><br>  Essentially, we can conclude that OCI has become a necessary forerunner for CRI-O, and in Red Hat they used the standardization trend, promoting it on the one hand and pursuing their goals <i>(low-level stack for Project Atomic and OpenShift)</i> on the other.  The Linux and Open Source community rather only won from this, having received competition and diversity among free products, and the OCI also stressed that their discontent was related solely to the name of the project, but not to its very purpose: <br><br><blockquote>  ‚ÄúThe Open Container Initiative (OCI) focuses on creating a formal specification for the executable environment and the container image format, since standardization in these areas will also contribute to other innovations.  Any other projects are currently beyond the scope of OCI, but we encourage our participants to continue working on the specification for the executable environment and the format of the images, since this is useful for the entire industry.  Innovation is happening quickly at the implementation level, and we intend to integrate all relevant improvements in the specification.  Our goal is to support the efficient growth and health of container technology and the entire Open Source community. ‚Äù </blockquote><br>  To this day, Red Hat continues to promote CRI-O in the world of IT professionals, as exemplified by the recent <i>(June 2017)</i> publication of " <a href="https://www.projectatomic.io/blog/2017/06/6-reasons-why-cri-o-is-the-best-runtime-for-kubernetes/">6 reasons why CRI-O is the best executable environment for Kubernetes</a> " on the Project Atomic blog.  As such reasons, the authors call: <br><br><ol><li>  An open project management scheme and its development within the parent Kubernetes community. </li><li>  "A truly open project", as evidenced by a pleasant <a href="https://github.com/kubernetes-incubator/cri-o/issues/332">comment</a> from an engineer from Intel: <br><img src="https://habrastorage.org/webt/59/e0/58/59e058bee8122193631973.png"><br>  ... as well as the activity of <a href="https://github.com/kubernetes-incubator/cri-o/graphs/contributors">contributors</a> , the transfer of some improvements to the code base of Kubernetes itself. </li><li>  The minimum code base (accessible for simple auditing and fairly reliable), the rest of the components to which are connected from other projects. </li><li>  Stability achieved through full orientation to Kubernetes, using upstream tests from K8s (node-e2e and e2e) before accepting patches (if the release of CRI-O breaks something in K8s, it is blocked), as well as its integration tests. </li><li>  Security, because  it has all the necessary Kubernetes functions like SELinux, Apparmor, seccomp, capabilities. </li><li>  The use of standardized components, since  The project follows OCI specifications. </li></ol><br>  Another example of technological evangelism in this direction is a very recent <i>(September 2017)</i> report ‚Äú <a href="https://medium.com/cri-o/understanding-container-standards-1e1448cbb92c">Understanding standards for containers</a> ‚Äù ( <a href="https://www.youtube.com/watch%3Fv%3Drlj0UZlvGp0">video</a> , <a href="https://docs.google.com/presentation/d/1OpsvPvA82HJjHN3Vm2oVrqca1FCfn0PAfxGZ2w_ZZgc/edit">slides</a> ) performed by Scott McCarty from Red Hat: <br><br><img src="https://habrastorage.org/webt/59/e0/6a/59e06a21dc39f170228761.png"><br><br>  But back to the technological component of CRI-O.  How does this project work? <br><br><h2>  CRI-O architecture and features </h2><br>  Today, thanks to the efforts of Red Hat, Intel, SUSE, Hyper and IBM <i>(all of them are listed among the main CRI-O development companies)</i> , we have an alternative to Docker for Kubernetes, which allows launching subnets using <b>any executable environment</b> for containers that are compatible with the specification Oci.  Officially, the well-known runc is supported, as well as Intel's <a href="https://clearlinux.org/documentation/clear-containers/clear-containers.html">Clear Containers</a> <i>(they are part of a more global <a href="https://clearlinux.org/">Clear Linux</a> project; last month they released their <a href="https://www.nixp.ru/news/14173.html">version 3.0</a> , rewritten to Go)</i> . <br><br>  <b>The CRI-O components</b> have not changed much since the OCID announcement: in addition to the executable environment (compatible with OCI), these are the old OCI Runtime Tools, containers / storage, containers / image, CNI, as well as a new small <a href="https://github.com/kubernetes-incubator/cri-o/tree/master/conmon">conmon</a> utility for monitoring containers out of memory errors (OOM) and log handling from the container process. <br><br>  The overall <b>CRI-O architecture</b> and its place in Kubernetes is as follows: <br><br><img src="https://habrastorage.org/webt/59/e0/56/59e0560fe8602563042772.png"><br><br>  <b>The principle of functioning of</b> Kubernetes in conjunction with CRI-O is reduced to the following scheme: <br><br><ul><li>  Kubernetes calls the <i>kubelet</i> to start the hearth, and the <i>kubelet</i> redirects this request to the CRI-O daemon via the <a href="">Kubernetes CRI</a> interface. </li><li>  CRI-O using the containers / image library takes the image from the registry. </li><li>  CRI-O, using the containers / storage library, unpacks the downloaded image into the container root file system (stored in COW). </li><li>  Having created rootfs for the container, CRI-O using the <i>generate</i> utility from the OCI Runtime Tools prepares a JSON file that conforms to the OCI runtime specification and contains a description of how to start the container. </li><li>  CRI-O runs an executable environment (for example, runc) using the generated specification. </li><li>  The container is in the field of view of monitoring performed by the conmon utility (a separate process in the system), which also serves logging for the container and records the completion code of the container process. </li><li>  The network for the hearth is configured using any of the CNI plugins. </li></ul><br><h2>  Status </h2><br>  <s>The latest public release of CRI-O is <a href="https://medium.com/cri-o/we-just-released-cri-o-1-0-0-rc3-73da5a79e72c">1.0.0-rc3</a> , released last week.</s>  <s>Among its changes are support for Minikube (to run CRI-O with a local cluster Kubernetes), limits for the size of the container log, support for quotas for overlay, the ability to run on tmpfs-based file systems.</s>  <s>His announcement ends with the phrase that "now we <b>are close to release 1.0</b> , as soon as the number of bugs decreases."</s>  <b>Updated:</b> October 16, 3 days after the publication of this article, the release of <a href="">CRI-O v1.0.0</a> , which is officially designed to work with Kubernetes 1.7, took place, and an update (RC1 of the next version) for K8s 1.8 is expected soon. <br><br>  The release of <a href="https://habrahabr.ru/company/flant/blog/338230/">Kubernetes 1.8</a> , which took place at the end of September, ‚Äúraised‚Äù <b>the support status of CRI-O to stable</b> , since all e2e tests were passed. <br><br>  To convert your Kubernetes installation from Docker to CRI-O, you will need: <br><br><ol><li>  Install and configure CRI-O ( <code>/etc/crio/crio.conf</code> , <code>/etc/containers/policy.json</code> , etc .; the service itself runs as a system service ‚Äî recommended in conjunction with systemd) on each node where the migration takes place . </li><li>  Correct the requirements of the <i>kubelet</i> service in systemd ( <code>/etc/systemd/system/kubelet.service</code> ) and configure its parameters ( <code>/etc/kubernetes/kubelet.env</code> ). </li><li>  Prepare a CNI plugin. </li><li>  Start the <i>crio</i> service and restart the <i>kubelet</i> . </li></ol><br>  More detailed instructions can be found <a href="">here</a> . <br><br><h2>  cri-containerd </h2><br>  Finally, it will be useful to mention the parallel activity on the part <b>of the Docker company</b> called <a href="https://github.com/kubernetes-incubator/cri-containerd"><b>cri-containerd</b></a> .  This is another open source implementation of the already mentioned Kubernetes CRI interface for those who have chosen containerd as the only executable environment for containers <i>(along with the same runc and CNI for solving the corresponding tasks)</i> .  With <b>alpha status</b> , cri-containerd supports Kubernetes 1.7+, passed all CRI validation tests and all node e2e tests. <br><br>  At a recent speech by Liu Lantao (Google) and Abhinandan Prativadi (Docker), it was announced that the beta version of this decision is expected by the end of the year ( <a href="https://www.slideshare.net/Docker/kubernetes-cri-containerd-integration-by-lantao-liu-google">report slides</a> ): <br><br><img src="https://habrastorage.org/webt/59/e0/66/59e0667a4a604168240289.png"><br><br><h2>  PS </h2><br>  And at the end of this article, I can not fail to quote a wonderful <a href="https://twitter.com/kelseyhightower/status/914884130797633538">quote from</a> Kelsey Hightower, well known in the DevOps community, at least thanks to ‚Äú <a href="https://github.com/kelseyhightower/kubernetes-the-hard-way">Kubernetes The Hard Way</a> ‚Äù: <br><br><blockquote>  <b>cri-o, containerd, rkt or docker?</b>  <b>I look forward to the day when the answer will be: "All the same."</b> </blockquote><br>  Read also in our blog: <br><br><ul><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/325358/">Why do you need containerd and why it was separated from Docker</a> ‚Äù; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/329136/">What is the essence of the Moby project and why did the main Docker repository suddenly become moby / moby?</a>  "; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/329830/">Container Networking Interface (CNI) - network interface and standard for Linux containers</a> ‚Äù; </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/331188/">Our experience with Kubernetes in small projects</a> " <i>(video of the report, which includes an introduction to the technical device Kubernetes).</i> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/340010/">https://habr.com/ru/post/340010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339998/index.html">TeaVM - a tool to create a web frontend for Java, Kotlin and Scala</a></li>
<li><a href="../340000/index.html">Evil XML with two encodings</a></li>
<li><a href="../340002/index.html">Introduction to frequently used features of ES6. Part 1</a></li>
<li><a href="../340006/index.html">And how do you create singletons in ruby?</a></li>
<li><a href="../340008/index.html">Security Week 41: Accenture has posted all on Amazon, a year of malvertization on Pornhub, a fresh attack on Office</a></li>
<li><a href="../340014/index.html">C ++ 17</a></li>
<li><a href="../340016/index.html">Social networks - will help or hinder when looking for a job?</a></li>
<li><a href="../340018/index.html">Is there an ideal personal task planner? Develop a modular scheduler</a></li>
<li><a href="../340020/index.html">Attify OS - distributive for testing for penetration of IoT</a></li>
<li><a href="../340022/index.html">DoubleLocker: the first encryptor using the accessibility service of the Android Accessibility Service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>