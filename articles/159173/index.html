<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ImapFilter - a powerful tool for sorting mail</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have to work daily with a large number of letters, and in order not to lose sight of important information, they need to be sorted. At first, a Thun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ImapFilter - a powerful tool for sorting mail</h1><div class="post__text post__text-html js-mediator-article">  I have to work daily with a large number of letters, and in order not to lose sight of important information, they need to be sorted.  At first, a Thunderbird set up on a working machine handled this task quite well, but I wanted to check mail not only at work, but also at home, and elsewhere ‚Äî in a word, in any convenient place if there was a desire and opportunity.  Thoughts began to appear about some kind of server solution.  It would seem - ‚Äúeverything is already stolen before us‚Äù (c) - a bunch of fetchmail + procmail + (exim / postfix / sendmail, etc.) + mutt is quite a working one and has a good reputation, but I didn‚Äôt need all the features of such powerful mail programs I wanted minimalism, simplicity and functionality. <br><a name="habracut"></a><br>  As probably many of you know, mutt initially knows how to work with the mail server using the imap protocol, and remarkably checks mail using its own resources (i.e., we no longer need fetchmail), it also knows how to send mail through third-party smtp- server (ie, MTA is also not needed), it remains only to solve the problem of mail filtering.  And here he comes to the rescue - imapfilter. <br><br>  Imapfilter, as the name implies, filters mail by connecting to an IMAP mail server.  The possibilities of this program are truly limitless, with its help you can do almost everything (create / delete / change folders, filter / copy / move / delete letters, set various flags, sort and search letters, etc.). <br><br>  The configuration file of the program is a set of rules written in the lua language (after viewing typical configuration examples and studying the manual, there should be no difficulties with writing your own rules). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  So, a little instruction on basic configuration. </h5><br>  Suppose we have a debian-like system.  Install the imapfilter package: <br><br><pre><code class="bash hljs">$ sudo apt-get install imapfilter</code> </pre> <br>  And after installation we create a .imapfilter folder in our home directory, and in it - a configuration file called ‚Äúconfig.lua‚Äù: <br><br><pre> <code class="bash hljs">$ mkdir ~/.imapfilter $ touch ~/.imapfilter/config.lua</code> </pre><br>  Now let's start editing the config.  Let the standard Nano be the editor: <br><br><pre> <code class="bash hljs">$ nano ~/.imapfilter/config.lua</code> </pre><br>  Anything that begins with a "-" in the configuration file is considered comments and, accordingly, is not processed. <br><br><pre> <code class="bash hljs">--  ( ),         -- timeout = 120 -- ,         (, imap-) -- options.namespace = <span class="hljs-literal"><span class="hljs-literal">false</span></span> --    -- account_name = IMAP { server = <span class="hljs-string"><span class="hljs-string">'mailserver.ru'</span></span>, username = <span class="hljs-string"><span class="hljs-string">'your_login'</span></span>, password = <span class="hljs-string"><span class="hljs-string">'your_pass'</span></span>, }</code> </pre><br>  Here, if necessary, you can add the fields 'ssl' and 'port', filling them with the necessary values. <br>  Next, we define a list of folders, and check the current status of the directory with incoming mail: <br><br><pre> <code class="bash hljs">mailboxes, folders = account_name:list_all() account_name:check_status()</code> </pre><br>  The <b>‚Äúlist_all ()‚Äù</b> option will return a list of all available directories and subdirectories in your mailbox, and the <b>‚Äúcheck_status ()‚Äù</b> option will respectively provide information about the total number of emails in your inbox, how many sent, how many unread messages (before filtering make sure that you have already created all the necessary directories for which you will be laying out your mail, or you can use the ‚Äúcreate_mailbox‚Äù function to create a new directory). <br>  Then we define the variable "results", which we will use in the future to filter mail: <br><br><pre> <code class="bash hljs">results = account_name.INBOX:select_all()</code> </pre><br>  Now you can go directly to the rules.  Roughly speaking, the usual rule would look something like this: <br><br><pre> <code class="bash hljs">res = results:contain_subject(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>) res:move_messages(account_name.folder)</code> </pre><br>  Where: <br><ul><li>  <b>res</b> is an arbitrary variable name that will be responsible for letters matching the condition; </li><li>  <b>results: contain_subject ('hello')</b> - this is the actual filtering process; </li><li>  <b>res: move_messages (account_name.folder)</b> - the action that will be performed on the letters. </li></ul><br>  You can filter letters by sender ( <b>contain_from</b> ), by recipient ( <b>contain_to</b> ), by subject ( <b>contain_subject</b> ), by field ‚ÄúCc‚Äù ( <b>contain_cc</b> ), by size ( <b>is_larger</b> and <b>is_smaller</b> ), by date ( <b>is_older</b> , for example, if the letter is older than then a certain number of days) and a bunch of other parameters (see the link at the bottom of the page). <br><br>  After filtering, messages can be copied ( <b>copy_messages</b> ), moved ( <b>move_messages</b> ), marked as read / unread / deleted, etc., and deleted ( <b>delete_messages</b> ) <br><br>  Well, as an example, consider the case when letters from user@domain.ru will be copied to the ‚Äúuser‚Äù folder in the ‚ÄúInbox‚Äù directory, letters with the ‚ÄúHello, world‚Äù subject will be moved to the ‚Äúspam‚Äù folder, and all letters in the work folder that are older than 10 days will be deleted. <br><br><pre> <code class="bash hljs">res = results:contain_from(<span class="hljs-string"><span class="hljs-string">'user@domain.ru'</span></span>) res:copy_messages(account_name.user) -- res = results:contain_subject(<span class="hljs-string"><span class="hljs-string">'Hello, world'</span></span>) res:move_messages(account_name.spam) -- old = account_name.work:is_older(10) account_name.work:delete_messages(old)</code> </pre><br>  In the filtering process, you can use several conditions at the same time, it is implemented using logical operators: <b>"+"</b> (logical "OR"), <b>"*"</b> (logical "AND") and <b>"-"</b> (logical "NOT"): <br><br><pre> <code class="bash hljs">res = results:contain_subject(<span class="hljs-string"><span class="hljs-string">'Hello, world'</span></span>)+ results:contain_from(<span class="hljs-string"><span class="hljs-string">'user@domain.ru'</span></span>) res:move_messages(account_name.spam)</code> </pre><br>  I think a further analogy is clear.  Imapfilter can also work with subdirectories in your mailbox (for example, Inbox / work / 1 or Inbox / work / 2).  In this case, when performing an action on a letter, the entry of the path to this subdirectory will be slightly different: <br><br><pre> <code class="bash hljs">res:move_messages(account_name[<span class="hljs-string"><span class="hljs-string">'work/1'</span></span>], results)</code> </pre><br>  In principle, this knowledge is already enough to sort mail for most tasks.  After completing the settings, you need to set the permissions accordingly: 700 on the .imapfilter directory and 600 on the config file: <br><br><pre> <code class="bash hljs">$ chmod 700 ~/.imapfilter $ chmod 600 ~/.imapfilter/config.lua</code> </pre><br>  After all the settings have been completed, launch imapfilter in debug mode and write a log with the following keys: <br><br><pre> <code class="bash hljs">imapfilter -l logfile.log -d</code> </pre><br>  A log file with the appropriate name will appear in the home folder of the program, and a file called ‚ÄúDebug. *****‚Äù, which will contain all the information on the actions of the program - there you can see what rule and how it worked. <br><br>  And finally, add the line to crontab <br><br><pre> <code class="bash hljs">* * * * * imapfilter</code> </pre><br>  so that our filter runs every minute and arranges mail beautifully in the right folders. <br><br>  <a href="http://manpages.ubuntu.com/manpages/hardy/man5/imapfilter_config.5.html">Here</a> you can see all the options and parameters that are available in the configuration file. <br><br>  That's all, thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/159173/">https://habr.com/ru/post/159173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159153/index.html">Trac and his friends Gitolite, Nginx and UWSGI</a></li>
<li><a href="../159155/index.html">Write CLI module for Zend Framework 2</a></li>
<li><a href="../159161/index.html">Animals on CSS3 transitions & transforms</a></li>
<li><a href="../159165/index.html">Guitar Tabs 2.0</a></li>
<li><a href="../159171/index.html">Autopsy Meizu MX</a></li>
<li><a href="../159177/index.html">Wheel speed counter squirrel</a></li>
<li><a href="../159179/index.html">Banned google</a></li>
<li><a href="../159183/index.html">A copyright harm report was removed from the site of one of the US Congress committees one day after publication.</a></li>
<li><a href="../159187/index.html">Google wants to be a wireless internet provider</a></li>
<li><a href="../159189/index.html">How do you set element styles if you do not use ‚Äúforeign‚Äù libraries</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>