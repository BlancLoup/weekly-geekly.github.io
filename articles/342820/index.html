<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we built the software-defined data center in the drawer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I woke up one day early and thought: why not build a data center? Own, on Intel NUC - mini-PCs, on which half of our Intel technology center spins. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we built the software-defined data center in the drawer</h1><div class="post__text post__text-html js-mediator-article">  I woke up one day early and thought: why not build a data center?  Own, on Intel NUC - mini-PCs, on which half of our Intel technology center spins. <br><br>  Our office is on the way from the office canteen, and someone blurted out what I was doing.  Therefore, colleagues began to come to neighing.  They dropped in, asked where I was hiding the data center, then laughed. <br><br>  On the third day, the laughter suddenly stopped, and many began to scratch their heads.  Because it turned out a mobile data center for demonstrations and training, which can be brought to the customer in a suitcase.  Or install on a tank. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/z8/go/mb/z8gombpzi_dxpulkv0vvxxyjxja.jpeg"><br><br>  The epic of the data center builder is below. <br><a name="habracut"></a><br><h2>  Task </h2><br>  In general, we often need entire data centers to train server core engineers and new software runs.  Server time is very expensive, and therefore usually have to learn from cats.  Once again ordering a window, we suddenly realized that right under our feet (literally) we have a lot of Intel NUC.  Intel gave them to us for the solutions center, which we opened at the beginning of the year.  And they just came up.  Ordinary consumer computers behave rather badly under constant load, require complex cooling, etc. For nukes inside i7, they are designed for a 90 percent load during the whole operation time (months and years), there is a very thoughtful heat sink.  I remembered how Apple wanted to make data-center racks, shoving four mac-mini in one rack unit, and decided: why not? <br><br>  All I need to combine the machines in the data center is a switch and good orchestrating software.  And VMware partner licenses are always there for demonstration.  And I undertook to build from them SDDC - a software-defined data center, where all the power and all virtual machines can be both a payload and parts of the infrastructure. <br><br>  Here‚Äôs how it looks in the VMware reference architecture: <br><br><img src="https://habrastorage.org/webt/ni/c0/a3/nic0a3dz4bgbdvvj-rehxjfalfg.png"><br><br>  Of course, it was not without excesses: at some point, my cleaning center collapsed my data center.  I had to rebuild again. <br><br><h2>  1. Hypervisors </h2><br>  The full stack of software-defined data center starts with hypervisors to receive virtual machines on physical ones.  These virtual machines will be quanta of the future software data center. <br><br>  They took the switch 10-port gigabit, 5 nukes.  And from the laptop connected to the switch and the machines. <br><br>  Connected, started to set.  ESXi itself was delivered easily.  But VMware did not assume that it could be installed on such a hell of iron, so the nuke‚Äôs network card fell out of supported hardware (if there ever was one there).  And in our data center is critical.  Because our computers are sticky to the network card, and not vice versa. <br><br>  We found the right driver in the old version of the distribution, added it to the new 6.5 Update 1. We installed it again - the network appeared.  For the same reason, the lack of a driver could not launch the SD-reader.  I had to use external flash drives to boot. <br><br><h2>  2. Management </h2><br>  The basic setting is over.  Deployed vCenter.  This is management software, it provides the integration of our nukes into a highly accessible, dynamically balanced cluster and allows you to manage resources.  We put it on one of the boxes, and it was time to deploy the hyper-convergent infrastructure in all its glory. <br><br><h2>  3. Software-defined storage system (SDS) </h2><br>  At this stage, we have virtual machines on the virtualization servers, but there is no unified storage system.  It is necessary to combine server disks or connect external shelves, plus to ensure that when you turn off any of the servers, the data are not lost.  That is, to deploy software-defined storage.  Because a separate stand with a flash factory for 20-50 million obviously did not climb into the drawer. <br><br>  The software-defined storage system in the VMware stack is vSAN.  It was configured smoothly in the spirit of ‚Äúnext-next-next-done‚Äù, even correctly identified the NVMe-disks under the cache (yes, imagine, we had them).  But there were problems with the configuration of the switch. <br><br>  We immediately knew that we would be trapped in one gigabit on the switch, and the vSAN in the recommended configuration should be 10, and better 2 to 10 ‚Äî he wants to change data very quickly inside the bus.  vSAN needs a Jumbo Frame - a large MTU of 9000 bytes, because the larger the transfer frame, the less overhead and it works faster.  At first, our modest 10-port Gigabit switch stubbornly refused to use the MTU settings.  A few cups of coffee later he resigned and even pleasantly surprised with performance - vSAN worked quite quickly, despite one gigabit interface in the backend. <br><br>  Next vSAN need at least two disks on the node.  On nuke just two.  Configuration: USB flash drive for downloading a hypervisor, one SSD over SATA 3.0 (Intel SSD DC S3520 with 480 GB capacity), the second M.2 - Intel SSD Pro 6000p with 128 GB capacity, which became a cache in vSAN.  Gathered easily. <br><br>  If, before this, the peeping colleagues warmly wished for success and left with a laugh, now many have become interested.  They came again and again, asked about the condition of the patient. <br>  Before me lay the next level - SDN, that is, a software-defined network.  This is when the same virtualization servers (in our case nukes) become components of the network infrastructure. <br><br>  Somewhere in the area, my cleaning center collapsed my data center: I simply chopped the power of the entire bundle and put the nukes in their place at the center of Intel solutions.  I was very worried, because SDS solutions do not like turning off all the nodes at all, and even with the load, but after switching on, everything went fine.  Looking ahead, I will say that at the very end, a colleague, who needed a socket, was once again so noted.  Also, everything went up okay, already with a full set of software. <br><br><h2>  4. Software defined network (SDN) </h2><br>  Began to deploy NSX from VMware.  It went easier, but not easy.  Slightly analyzed the packets - there were problems with proxying in our network (which was used to access nukes). <br><br>  Suddenly, it is nukes that are perfect as firewalls, routers, and balancers.  Previously, in offices, the old Pentiums-2 were used for this ‚Äî the second life of an old car. <br><br><h2>  5. Monitoring and reporting </h2><br>  Now we need monitoring.  And the fact that the data center without monitoring, right?  Began to install vRealize Operations.  It is also designed, hmm, for other tasks and for another hardware, so in the basic configuration I devoured half of my data center resources.  Turned down (this is not recommended in normal situations).  As a result, it collects data on how efficiently our data center is used, where and to which virtual clients more resources are issued than necessary (no), where what is happening.  He looks at the load on the hosts, makes an inventory and gives advice on where to change.  He also receives information from the iron through the sim provider: fans, temperature, disk status, recording delays, and so on.  Before equipment failure, it is able to migrate services and data from a dying server in the background - this thing is called Proactive HA.  For the sake of justice, the latter could not be configured - the wrong level of hardware, this is not a Dell or HP server. <br><br>  I must say that I began to leave the data center under load at night.  The nukes were warming themselves, and at first this frightened me ‚Äî I came in several times a day to touch them.  At home I would be exactly the kind of heater disturbed.  But colleagues from Intel said that everything was a bundle (hehe!), And I continued the experiments. <br><br><img src="https://habrastorage.org/webt/wb/p9/oc/wbp9ochhl_suplaigj10gzzkcju.jpeg"><br><br><h2>  6. Analysis of logs </h2><br>  The next link is a system for analyzing logs and any ‚Äúsmart analytics‚Äù - vRealize Log Insight.  There is nothing special to add, the product spun up and immediately started working, it was necessary only as a syslog server for all components of our software data center. <br><br><img src="https://habrastorage.org/webt/68/kk/3o/68kk3olcv4grapq74jpdxmocnzs.jpeg"><br><br><h2>  7. Self-service portal with gui </h2><br>  The next step is vRealize Automation.  All I need to say about him is that he again grabbed a bunch of resources.  It was developed normally, but loaded data center from five nyuk by 90%.  Also cut a bit and deployed the base portal on it. <br><br><h2>  Everything! </h2><br>  <b>Total - it turned out.</b>  It is now a training stand, a source of incessant jokes (‚ÄúWhere are the data center? And in your pocket!‚Äù, ‚ÄúWhy didn‚Äôt you backup? He eats 100% of resources!‚Äù, ‚ÄúWhen will we take the grid?‚Äù) And a demo unit.  You will not go to the customer with a half-rack, but with this - easily. <br><br>  Let me remind you that nukes still have a good built-in vibration protection (unlike normal servers) and are generally very well made, so they will survive: <br><br><img src="https://habrastorage.org/webt/dc/tr/tk/dctrtkhwppuvc87wkfqmhyqi5vq.jpeg"><br><br>  Backup in the end, I still put it fine, by the way. <br><br>  What is interesting for?  Well, in practice, on the same set of software (with a pair of replacements for cheaper licenses) and another hardware, you can fit a private data center in a semi-rack.  This is necessary for companies per 100 people, such as investment funds, who do not want to share their data outside, and this is often decided by expensive PAKs.  Or stand right in the office with soundproofing, which crammed servers, switches and oops. <br><br>  Oh yes!  And I earned an excellent achivka "data center builder."  And he won a beer. <br><br><h2>  For researchers </h2><br>  If someone wants to repeat our experience, below is the configuration of our stand, which is tested and works exactly. <br><br>  5 pieces of mini-PC Intel NUC Kit NUC7i7BNH, each has the following components: <br><ul><li>  2 Kingston HyperX Impact 16GB 2133MHz DDR4 CL13 SODIMM RAM modules </li><li>  128GB M.2 SSD Intel SSD Pro 6000p Series for cache </li><li>  SATA 3.0 SSD 480 GB Intel SSD DC S3520 Series for storage </li><li>  32GB SanDisk Ultra Fit USB Drive for hypervisor installation </li></ul><br><h2>  Links </h2><br><ul><li>  VMware vCloud Suite SDDC Management Platform.  <a href="https://www.vmware.com/ru/products/vsan.html">The suite</a> includes the following components: vSphere, vRealize Operations, vRealize Log Insight, vRealize Automation, vRealize Business for Cloud, SDS VMware vSAN. </li><li>  SDN <a href="https://www.vmware.com/ru/products/nsx.html">VMware NSX</a> </li><li>  <a href="https://www.intel.ru/content/www/ru/ru/products/boards-kits/nuc.html">Intel NUC</a> Mini PC </li><li>  Pro <a href="https://habrahabr.ru/company/croc/blog/278929/">software-defined data center</a> </li><li>  My mail is SSkryl@croc.ru </li></ul></div><p>Source: <a href="https://habr.com/ru/post/342820/">https://habr.com/ru/post/342820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342806/index.html">JARVIS for (not) iron man: how Perf will become an assistant for each Delivery manager</a></li>
<li><a href="../342810/index.html">Cutting hippo. Again about design and refactoring from Sandy Metz</a></li>
<li><a href="../342812/index.html">Selection of useful materials: Microservices on .NET Core</a></li>
<li><a href="../342814/index.html">Key Distribution Protocols on Symmetric Ciphers</a></li>
<li><a href="../342818/index.html">Use DevOps to turn IT into a strategic weapon.</a></li>
<li><a href="../342822/index.html">What happens in Kubernetes when starting the kubectl run? Part 2</a></li>
<li><a href="../342824/index.html">Log4j2 log aggregation by ELK</a></li>
<li><a href="../342826/index.html">Linux operating systems for different tasks</a></li>
<li><a href="../342830/index.html">How the leaders of the storage industry gathered at Prostor in Skolkovo (photo report)</a></li>
<li><a href="../342832/index.html">Avito iOS Meetup: Winter Edition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>