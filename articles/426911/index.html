<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GreyEnergy: the heir to BlackEnergy attacks the energy sector enterprises</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ESET specialists performed an analysis of sophisticated malware, not studied before, intended for targeted attacks on critical infrastructure enterpri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GreyEnergy: the heir to BlackEnergy attacks the energy sector enterprises</h1><div class="post__text post__text-html js-mediator-article">  ESET specialists performed an analysis of sophisticated malware, not studied before, intended for targeted attacks on critical infrastructure enterprises in Central and Eastern Europe.  The program, called GreyEnergy, has a conceptual similarity with BlackEnergy, malware that was used in attacks on Ukrainian energy companies in <a href="https://habr.com/company/eset/blog/274469/">December 2015</a> .  In addition, there are links indicating that GreyEnergy operators worked together with the TeleBots group, which is behind a series of destructive attacks. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dv/d5/8-/dvd58-ginvoshns9sbcaupqnvzy.jpeg"></div><br>  The report provides information on the activities of the GreyEnergy Group over the past years.  Note that we do not attribute attacks and malware development to any state.  According to our terminology, ‚ÄúART-group‚Äù is a set of technical indicators. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  In December 2015, the BlackEnergy group attacked the Ukrainian power complex using malicious programs from the BlackEnergy and KillDisk families.  This was the last known incident with the BlackEnergy software in real conditions.  After this attack, the group was transformed into at least two subgroups: TeleBots and GreyEnergy. <br><br>  TeleBots specializes in cyber sabotage by networked computer attacks (CNA).  On account of the group destructive attacks, including: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <a href="https://www.welivesecurity.com/2016/12/13/rise-telebots-analyzing-disruptive-killdisk-attacks/">a series of attacks</a> using the updated version of KillDisk for Windows and <a href="https://www.welivesecurity.com/2017/01/05/killdisk-now-targeting-linux-demands-250k-ransom-cant-decrypt/">Linux</a> in December 2016; </li><li>  <a href="https://habr.com/post/332058/">the</a> June 2017 <a href="https://habr.com/post/332058/">epidemic of NotPetya</a> using the complex <a href="https://habr.com/post/332472/">backdoor</a> implemented with the MEDoc accounting software; </li><li>  attack using <a href="https://habr.com/post/340890/">BadRabbit encoder</a> in October 2017. </li></ul><br>  ESET specialists have been monitoring the activity of the GreyEnergy Group for several years.  The group uses the same unique family of malware.  Malvari's architecture resembles the BlackEnergy family. <br><br>  In addition to the conceptual similarity of programs, there are other links indicating that GreyEnergy operators are working closely with the TeleBots group.  In particular, in December 2016, the GreyEnergy group launched a worm resembling NotPetya, and a more advanced version of this program appeared in June 2017 in the attack of TeleBots. <br><br>  It should be noted that GreyEnergy and TeleBots have different goals - GreyEnergy is interested mainly in industrial networks owned by enterprises of critical infrastructure, and, unlike TeleBots, is not limited to facilities in Ukraine. <br><br>  At the end of 2015, we first noticed the GreyEnergy malware targeting an energy company in Poland.  However, GreyEnergy attacks Ukrainian targets as well.  The group focuses on the energy sector, transport infrastructure and other high-ranking facilities.  At least one organization among the targets of BlackEnergy has been attacked by GreyEnergy.  GreyEnergy's last use is fixed in mid-2018. <br><br>  The GreyEnergy malware has a modular architecture; however, unlike <a href="https://habr.com/post/330730/">Industroyer</a> , we have not seen modules in its structure that can affect industrial control systems (ICS).  However, GreyEnergy operators at least once deployed a viper on the disk to disrupt workflows and hide traces of cyber attacks. <br><br>  One of the most interesting details found in the course of our research is that one of the samples of GreyEnergy was signed with a valid digital certificate.  Most likely, this certificate was stolen from a Taiwanese manufacturer of ICS-equipment.  In this regard, the GreyEnergy group followed in the footsteps of the <a href="https://www.welivesecurity.com/2010/07/22/a-few-facts-about-win32stuxnet-cve-2010-2568/">Stuxnet</a> authors. <br><br><h2>  GreyEnergy: work method </h2><br>  In the course of observing the activity of the GreyEnergy group, we saw mainly two initial infection vectors.  The first relates to organizations with web services located on the victims' own servers.  If the public web service runs on a server connected to the internal network, the attackers will try to compromise it in order to penetrate the network.  The second vector is targeted phishing with malicious email attachments. <br><br>  Malicious documents dump GreyEnergy mini, a lightweight backdoor of the first stage that does not require administrative privileges.  After a computer is compromised using GreyEnergy mini, attackers create a network map and collect passwords to obtain domain administrator rights.  With these privileges, attackers can control the entire network.  The GreyEnergy group uses fairly standard tools for these tasks: Nmap and Mimikatz. <br><br>  After an initial investigation of the network, attackers can deploy a flagship backdoor ‚Äî the main GreyEnergy.  Malicious software requires administrative rights, which must be obtained prior to the deployment of the main GreyEnergy.  According to our research, GreyEnergy operators install the main backdoor mainly on two types of endpoints: servers with a long continuous operation time and workstations used to manage ICS environments. <br><br>  In order to disguise communication with managers (C &amp; C) servers, attackers can install additional software on the internal servers of the compromised network so that each server acts as a proxy.  Such a proxy C &amp; C forwards requests from infected nodes within the network to an external C &amp; C server on the Internet.  "Communication" of several computers on a network with an internal server does not look as suspicious as it does with an external one.  The method can also be used to manage malware in different segments of a compromised network.  A similar method using internal servers as a proxy C &amp; C was observed in the <a href="https://securelist.com/the-mystery-of-duqu-2-0-a-sophisticated-cyberespionage-actor-returns/70504/">Duqu 2.0 ART campaign</a> . <br><br>  If the compromised organization has public web servers connected to the internal network, the attackers can deploy ‚Äúbackup‚Äù backdoors on these servers.  They are used to restore access to the network in the event that the main backdoors are detected and removed. <br><br>  All malware-related GreyEnergy C &amp; C servers use Tor. <br><br><img src="https://habrastorage.org/webt/xx/oq/go/xxoqgo-8cdke9obd1fcazkwa3cq.png"><br>  <i>Figure 1. Simplified diagram of the two network compromise scenarios used by the GreyEnergy group</i> <br><br><h2>  Greyenergy mini </h2><br>  GreyEnergy mini is a lightweight backdoor of the first stage, which was used by attackers to evaluate a compromised computer and provide the initial bridgehead on the network.  Normally, GreyEnergy mini was downloaded using a malicious document distributed in phishing emails.  GreyEnergy mini is also known as <a href="https://www.fireeye.com/blog/threat-research/2018/07/microsoft-office-vulnerabilities-used-to-distribute-felixroot-backdoor.html">FELIXROOT</a> . <br><br>  In September 2017, ESET discovered a Microsoft Word document in Ukrainian containing a malicious macro.  The decoy document mimics an interactive form to encourage the victim to turn on the macro and fill it in. <br><br><img src="https://habrastorage.org/webt/fw/vr/33/fwvr33hhjxbw8fufl_c6qpeluoo.png"><br>  <i>Figure 2. The decoy document used by the GreyEnergy group in September 2017</i> <br><br>  After enabling a macro, its code attempts to download and execute a binary file from a remote server. <br><br><img src="https://habrastorage.org/webt/lu/xi/c8/luxic8ibbi5mgwhz7rhefr978ak.png"><br>  <i>Figure 3. VBA malware (comments added by an ESET specialist)</i> <br><br>  Interestingly, the link that leads to the external image is embedded in the document body.  After opening the document, he tries to download this picture - in this way, attackers will know that the file is open.  The method allows you to track which targets included a malicious macro, and which - just opened the document. <br><br><img src="https://habrastorage.org/webt/0j/td/ot/0jtdotwwqqa9vzly3-cd92brvsa.png"><br>  <i>Figure 4. Link to external pattern- "tracker" in a malicious document</i> <br><br>  The downloaded executable file is a GreyEnergy mini dropper.  Dropper writes a malicious DLL to the <code>%APPDATA%</code> folder, using a randomly generated GUID as the name.  In addition, the dropper creates a <code>.LNK</code> file with an empty file name in the <code></code> folder in the Start menu with an entry that executes <code>rundll32.exe</code> with the path to the DLL as a command line argument.  This is the persistence method of GreyEnergy mini. <br><br>  The dropped DLL is the main module of the GreyEnergy mini;  it is disguised as a legitimate file pertaining to Microsoft Windows. <br><br><img src="https://habrastorage.org/webt/ly/yu/lg/lyyulg-m5vxpbdbsgqvyssghhww.png"><br>  <i>Figure 5. Backdoor DLL GreyEnergy mini disguises as a legitimate Windows DLL</i> <br><br>  To evaluate a compromised computer, malware collects as much information as possible and sends data to C &amp; C.  Data collection is performed using the WMI Query Language (WQL) and queries to the Windows registry.  The following data is collected: <br><br><ul><li>  computer name </li><li>  operating system version including service pack version </li><li>  default language </li><li>  Username </li><li>  current Windows user privileges, elevation, UAC level </li><li>  proxy settings </li><li>  information about the computer (manufacturer, model, type of system) </li><li>  Timezone </li><li>  installed security software (antivirus and firewall) </li><li>  list of users and domains </li><li>  list of installed programs obtained from the registry </li><li>  network information (IP addresses, DHCP server, etc.) </li><li>  list of running processes </li></ul><br>  Malicious software receives commands from the C &amp; C server.  The following commands are supported (below are the command IDs and their meanings): <br><br><ol><li>  collect computer information </li><li>  download and run the executable file from the temporary files folder </li><li>  run a shell command </li><li>  remove yourself from a compromised computer </li><li>  download and run the .BAT file from the temporary folder </li><li>  download file to local disk </li><li>  upload file </li></ol><br>  The configuration of malware in JSON format is embedded inside a binary file and encrypted using a custom algorithm.  Encrypted data contains four bytes at the beginning;  these bytes are used as the key for the XOR operation to decrypt the remaining data.  Most of the strings used by the malware are encrypted using this algorithm. <br><br><img src="https://habrastorage.org/webt/ra/1e/7q/ra1e7q7lgjkezdzs1cvknhtjytc.png"><br>  <i>Figure 6. Embedded configuration of GreyEnergy mini before and after decryption</i> <br><br>  All GreyEnergy mini configurations we saw include HTTPS and HTTP servers used as C &amp; C.  This allows attackers to switch to HTTP on targets, where the HTTPS connection is not supported by the network or firewall configuration. <br><br>  GreyEnergy mini bears similarities with other GreyEnergy malware.  In addition to this, both the GreyEnergy mini and the GreyEnergy main backdoor use the same C &amp; C servers. <br><br><h2>  GreyEnergy main backdoor </h2><br>  GreyEnergy is the main backdoor of this cyber group.  The malware samples analyzed here are written in C and compiled using Visual Studio, but without using the standard C runtime library (CRT) functions.  Packaged samples may contain a fake PE timestamp, but after unpacking, the timestamp is reset (January 1, 1970). <br><br><img src="https://habrastorage.org/webt/4g/30/bx/4g30bxseryscxui0m-0z3hrdrzo.png"><br>  <i>Figure 7. PE timestamp of the unpacked GreyEnergy sample</i> <br><br>  Interestingly, one of the first samples analyzed by GreyEnergy was signed by a certificate owned by Advantech.  It is a Taiwanese company producing industrial equipment and IoT.  Since we found that the same certificate was used to sign Advantech's clean, non-malware software, we believe it was stolen.  Note that the detected sample does not have a digital signature - this means that the signature became invalid when the certificate expired. <br><br><img src="https://habrastorage.org/webt/y4/qe/i8/y4qei8gt9buk4eftsr5_5bukgiy.png"><br>  <i>Figure 8. Advantech certificate used to sign the GreyEnergy malware sample</i> <br><br>  The certificate data is as follows: <br><br> <code>Serial Number: 15:f4:8f:98:c5:79:41:00:6f:4c:9a:63:9b:f3:c1:cc <br> Validity: <br> Not Before: Feb 10 00:00:00 2014 GMT <br> Not After : Feb 26 23:59:59 2017 GMT <br> SHA1 Fingerprint=97:53:AD:54:DF:6B:D6:73:E0:6C:00:36:3D:34:6A:06:00:7A:0A:9B</code> <br> <br>  We noticed that GreyEnergy is typically deployed in two modes: in memory only and with persistence of the DLL service.  The first mode is used when attackers are confident that the installation does not require special measures to ensure sustainability (for example, on servers with a long continuous operation time);  the second mode is when the malware must withstand any reboot. <br><br><h4>  Memory Only Mode </h4><br>  For this mode, the attackers place the DLL file in a specific folder, and then execute it using the Windows application <code>rundll32.exe</code> .  We observed that attackers use the Windows Sysinternals PsExec tool locally to execute <code>rundll32.exe</code> with the highest possible privileges ( <code>NT AUTHORITY\SYSTEM</code> ). <br><br>  Below is the command line used in the initial stage of executing GreyEnergy in memory only: <br><br> <code>cmd.exe /c "C:\Windows\System32\rundll32.exe "C:\Sun\Thumbs.db",#1 CAIAABBmAAAgAAAA8GFGvkHVGDtGRqcl3Z3nYJ9aXCm7TVZX8klEdjacOSU="</code> <br> <br>  In this example, <code>Thumbs.db</code> is the GreyEnergy DLL file, from which the function with the first sequence number is called by the <code>rundll32.exe</code> process.  The following command line example contains a sequence of bytes encrypted with base64, which is subsequently used as an AES-256 key to decrypt a small stub.  After that, the code in the "stub" starts a new copy of the <code>svchost.exe</code> process and injects the GreyEnergy payload.  At the final stage, the process of <code>rundll32.exe</code> GreyEnergy is completed, the malicious DLL file is protected from being deleted from the disk.  Therefore, the GreyEnergy payload will exist only in the context of the <code>svchost.exe</code> process memory. <br><br>  Apparently, the authors intended to develop malware in such a way that without a key in the command line it was impossible to decrypt the stub and payload. <br><br><img src="https://habrastorage.org/webt/rb/l5/vt/rbl5vtt2xe-e3ud4p9wxpuhsgz8.png"><br>  <i>Figure 9. The internal name of the GreyEnergy DLL for memory-only mode</i> <br><br>  If you use the ‚Äúonly in memory‚Äù mode, completing the corresponding <code>svchost.exe</code> process or restarting the computer is enough to remove GreyEnergy. <br><br><h4>  DLL service persistence </h4><br>  To use this method, the operators deploy a GreyEnergy dropper, which should run as administrator. <br><br>  The <code>ServiceDLL</code> registry key allows you to run the service DLL in the context of the <code>svchost.exe</code> process.  The function is not documented by Microsoft;  however, it is used by a number of malware families, including the Conficker worm. <br><br>  To ensure the persistence of the DLL service, the dropper searches for an already existing service and adds a new <code>ServiceDLL</code> registry key.  Since the method may break the system, the dropper initially performs a series of checks to select a service that satisfies a number of requirements. <br><br>  First, the dropper finds all Windows services that are currently stopped by running the following WQL query: <br><br> <code>Select * from Win32_Service where PathName Like '%%svchost%%' and State = 'Stopped'</code> <br> <br>  The following conditions may be added to the request: <br><br><ul><li>  <code>and StartMode = 'Disabled'</code> or <code>and StartMode = 'Manual'</code> </li><li>  <code>and ServiceType = 'Own Process'</code> or <code>and ServiceType = 'Share Process'</code> </li></ul><br>  Next, the dropper tries to select the desired service by checking the results and passing those that meet the following conditions: <br><br><ul><li>  service name contains <code>winmgmt</code> (Windows Management Instrumentation) or <code>BITS</code> (Background Intelligent Transfer Service) </li><li>  the dropper does not have access to the service or registry key </li><li>  <code>DependOnService</code> registry <code>DependOnService</code> not empty </li><li>  registry value for <code>ServiceDll</code> or <code>ImagePath</code> does not exist </li><li>  The service command line contains one of the following words: </li><li>  <code>DcomLaunch</code> , <code>LocalServiceNetworkRestricted</code> , <code>LocalServiceNoNetwork</code> , <code>LocalServicePeerNet</code> , <code>LocalSystemNetworkRestricted</code> , <code>NetworkServiceNetworkRestricted</code> , <code>secsvcs</code> , <code>wcssvc</code> </li></ul><br>  Upon detecting a service that meets these conditions, the malware resets the DLL file to the <code>system32</code> Windows directory and writes the <code>ServiceDLL</code> registry key.  The DLL name contains four randomly generated symbols, and <code>svc.dll</code> or <code>srv.dll</code> at the end.  In addition, the dropper forges the file time metadata by copying them from the existing <code>user32.dll</code> file. <br><br>  The latest version of the GreyEnergy dropper supports both 32-bit and 64-bit operating systems. <br><br><img src="https://habrastorage.org/webt/ih/kq/uu/ihkquuwr7ha_ggshsdfwgngg3sw.png"><br>  <i>Figure 10. DLL GreyEnergy DLL deployed by the DLL service persistence method</i> <br><br>  Dropper uses an interesting method of disguising a malicious DLL as a legitimate file.  In particular, the dropper copies the VERSIONINFO resource, which contains a detailed description of the executable file belonging to the Windows service in question, and writes this data into a malicious DLL.  For this purpose, the Windows API functions <code>BeginUpdateResource</code> / <code>UpdateResource</code> / <code>EndUpdateResource</code> .  Latest versions do not call these functions from the API;  their code is implemented in the malicious program itself in order to avoid dropping the DLL file onto a disk without a fake VERSIONINFO resource.  Presumably, this avoids the detection of some products for security.  The same dropper can create malicious DLL files with different descriptions on different computers.  Each sample deployed in this way will have a unique hash. <br><br>  If the malware is already present in the system, the dropper can update it using the named pipe. <br><br>  At the last stage, the dropper is deleted by overwriting the file with zeros and deleting from the disk.  Dropper also clears the <a href="https://en.wikipedia.org/wiki/USN_Journal">USN magazine</a> .  Actions are performed using the following shell commands: <br><br> <code>timeout 2 &gt; nul &amp; fsutil file setzerodata offset=0 length=%DROPPER_FILESIZE% "%DROPPER_PATH%" &amp; timeout 2 &amp; cmd /c del /F /Q "%DROPPER_PATH%" &amp; fsutil usn deletejournal /D %DROPPER_DRIVE%</code> <br> <br><h4>  Configuration and Communication </h4><br>  The persistence mode chosen by the operators does not affect the functionality of the malware, which remains unchanged with both methods. <br><br>  Malicious software contains an embedded configuration, encrypted with the AES-256 algorithm and compressed with LZNT1. <br><br>  The multicomponent MIME format is used for embedded malware configuration.  The authors did not implement their own parser for this format;  instead, they use the <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/oe/oe-imimemessagetree">IMimeMessage</a> and <a href="https://docs.microsoft.com/en-us/previous-versions/windows/desktop/oe/oe-imimebody">IMimeBody</a> COM interfaces.  Interestingly, the Microsoft documentation recommends not using these interfaces. <br><br><img src="https://habrastorage.org/webt/wr/uw/mb/wruwmbzmf4phjtbinjintm9ryfw.png"><br>  <i>Figure 11. GreyEnergy Embedded Configuration Example</i> <br><br>  For the external configuration, an identical MIME format is used;  however, the malware encrypts the external configuration in various ways.  It uses the Data Protection Application Programming Interface (DPAPI), in particular, the Windows API <code>CryptProtectData</code> and <code>CryptUnprotectData</code> functions.  The external configuration is saved in the following path <code>C:\ProgramData\Microsoft\Windows\%GUID%</code> , where <code>%GUID%</code> is a randomly generated GUID value based on the serial number of the C: drive volume. <br><br>  Some GreyEnergy samples contain a bit-obfuscated version of the configuration.  In particular, the <code>Type</code> fields of such configurations contain letters instead of option names. <br><br><img src="https://habrastorage.org/webt/wj/dl/7-/wjdl7-_lpzwki1oifgi_awjctxy.png"><br>  <i>Figure 12. An example of obfuscated GreyEnergy configuration</i> <br><br>  The configuration may contain the following values: <br><br><img src="https://habrastorage.org/webt/yo/_s/8e/yo_s8eqfgp-xgxf3mooreev9tmo.png"><br><br>  The malware removes itself from the infected system if the number of unsuccessful attempts exceeds the value of <code>MaxAttempts</code> , and the last successful connection was more than <code>Lifetime</code> days ago. <br><br>  Communication with C &amp; C is usually via HTTPS;  however, in some cases, the HTTP is also used.  The same MIME format is encapsulated in HTTP requests.  It is worth noting that the data is encrypted using AES-256 and RSA-2048. <br><br><img src="https://habrastorage.org/webt/b1/g8/6d/b1g86dydvt2stlutlwkgy79ydem.png"><br>  <i>Figure 13. GreyEnergy HTTP communication captured in Wireshark</i> <br><br>  If an HTTP is used, it is easier to identify a compromised machine on the network by analyzing its network traffic.  The malware samples studied have always used the following hard-coded user agents: <br><br><ul><li> <code>Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko</code> </li> <li> <code>Mozilla/5.0 (compatible, MSIE 11, Windows NT 6.3; Trident/7.0; rv:11.0) like Gecko</code> </li> </ul><br>  To help GreyEnergy operators identify infected computers, the malware sends the following WQL queries to a C &amp; C server: <br><br><ul><li> <code>SELECT Caption, Version, CSName, ProductType, CurrentTimeZone, LocalDateTime, OSLanguage, OSType FROM Win32_OperatingSystem</code> </li> <li> <code>SELECT MACAddress, IPAddress, IPSubnet, DHCPEnabled, DHCPServer, DNSDomain FROM Win32_NetworkAdapterConfiguration WHERE MACAddress IS NOT NULL</code> </li> </ul><br>  C &amp; C server responses are encrypted, but after decryption they contain the same MIME format with the following possible values: <br><img src="https://habrastorage.org/webt/go/am/pd/goampdwrvmb0ospdus377v4jvj8.png"><br><br>  GreyEnergy loads additional modules and payloads into memory using its own PE file downloader. <br><br><h4>  GreyEnergy Modules </h4><br>  Like many complex threats, the GreyEnergy malware has a modular architecture.  Its functionality can be expanded by adding additional modules.  The GreyEnergy module is a DLL file that is executed by calling a function with the first sequence number.  Each module, including the main module of GreyEnergy, accepts text commands with various parameters. <br><br>  GreyEnergy operators did not immediately send all modules to a compromised machine.  Typically, the malware downloads and executes the modules needed to perform specific tasks. <br><br>  We are aware of the existence of the following modules of GreyEnergy: <br><br>  <code>remoteprocessexec</code> - injects a binary PE file into the remote process <br>  <code>info</code> - collects system information, event logs, malware SHA-256 <br>  <code>file</code> - file system operations <br>  <code>sshot</code> - takes screenshots <br>  <code>keylogger</code> - intercepts keystrokes <br>  <code>passwords</code> - collect passwords saved in various applications <br>  <code>mimikatz</code> - <code>mimikatz</code> tool is used to collect Windows credentials <br>  <code>plink</code> - <code>plink</code> software used to create SSH tunnels <br>  <code>3proxy</code> - <code>3proxy</code> software used to create a proxy <br><br>  The <code>remoteprocessexec</code> module allows an attacker to execute arbitrary binaries in the context of existing processes.  For example, you can run Mimikatz or the port scanner in the context of Windows Explorer, without flushing them to disk.  To redirect standard output and process threads and process termination, the module intercepts five Windows API functions. <br><br><img src="https://habrastorage.org/webt/vn/c9/2a/vnc92aap-hqdl_ps_0r-tzj4ngc.png"><br>  <i>Figure 14. Windows API functions captured by the remoteprocessexec module</i> <br><br>  Since the dumped GreyEnergy DLL is unique for each infected machine, attackers can collect SHA-256 hashes using the information module.  The presence of hashes will allow you to track whether the file has been uploaded to publicly accessible web services, such as VirusTotal. <br><br><h4>  Reversal protection and anti-criminalistic methods </h4><br>  GreyEnergy uses several methods to complicate the analysis.  For example, a malware encrypts strings.  In some embodiments, the same algorithm is used as in GreyEnergy mini. <br><br>  However, in most samples GreyEnergy has a different encryption algorithm.  In particular, the first four bytes in the encrypted blob are not used as a key for XOR operations.  Instead, they are used to initialize the initial number of the algorithm for generating pseudo-random numbers ( <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B8%25D1%2585%25D1%2580%25D1%258C_%25D0%259C%25D0%25B5%25D1%2580%25D1%2581%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0">Mersenne's whirlwind</a> ), and then the key is the generated four bytes.  Before freeing a memory buffer containing a string of plain text, the malware rewrites the buffer with zeros. <br><br><img src="https://habrastorage.org/webt/on/px/a6/onpxa6j99a73zoqabotlcujmfyu.png"><br>  <i>Figure 15. Decompiled GreyEnergy string decoding function code</i> <br><br>  The malware intercepts the <code>DeleteFileA</code> and <code>DeleteFileW</code> in the import table of each binary PE file loaded into memory.  The hook replaces these functions with functions that safely erase files.  In particular, the file will be overwritten with zeros before deleting from disk.  Each payload or plugin will use such a function without having to embed it in each module. <br><br><img src="https://habrastorage.org/webt/h1/ii/9y/h1ii9yhj8un7_f4zsauhxcaf4wg.png"><br>  <i>Figure 16. Decompiled subroutine code that intercepts the DeleteFileA and DeleteFileW functions</i> <br><br><h2>  Instruments </h2><br>  The attackers used the port scanner Nmap as the main tool for mapping the internal networks of the victims.  In addition, we observed the use of a lightweight custom port scanner where Nmap was not possible. <br><br><img src="https://habrastorage.org/webt/6s/6p/wu/6s6pwugb_rufwoeytkhlkorgc_m.png"><br>  <i>Figure 17. Console output of the custom port scanner of the GreyEnergy group</i> <br><br>  Attackers actively use legitimate tools, such as <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/psexec">SysInternals PsExec</a> and <a href="https://sourceforge.net/p/winexe/wiki/Home/">WinExe</a> , for horizontal movement within compromised networks.  The WinExe tool, an open source analogue of WinExe, can be controlled from a Linux device, for example, from a compromised web server to Linux. <br><br>  It is worth noting that in addition to these tools, attackers use PowerShell scripts. <br><br><h2>  Web server backdoors </h2><br>  As mentioned earlier, the GreyEnergy group deploys additional backdoors to web servers, if these servers are accessible from the Internet.  We noticed that attackers use backdoors written in PHP for this purpose.  They use the public PHP PHP WSO webshell and c99shell. <br><br>  Attackers can modify an existing PHP script on a web server or deploy a new one.  The real php code of a backdoor usually hides several levels of obfuscation and encryption. <br><br><img src="https://habrastorage.org/webt/zo/ri/hz/zorihzdc7ajclfmonz_fcia53yy.png"><br>  <i>Figure 18. Obfuscated PHP backdoor code of the GreyEnergy group</i> <br><br>  The latest code level is protected by stream encryption.  The key generation of this cipher is based on the string from the cookie value provided by the attackers via an HTTP request.  Each such PHP-backdoor is encrypted with a separate key. <br><br><img src="https://habrastorage.org/webt/cs/8t/yh/cs8tyhnegnb6c1rk1avs7dxfgtk.png"><br>  <i>Figure 19. The final level that the PHP backdoor code decrypts</i> <br><br>  The obfuscation technique is used to prevent analysis, as well as to prevent the use of such a PHP backdoor by other cyber groups. <br><br><h2>  Proxy C &amp; C (triungulin) </h2><br>  As we mentioned earlier, attackers can use an internal server as a C &amp; C proxy. <br><br>  We found that attackers even created chains of C &amp; C proxy servers in which the first such server can redirect network traffic to the next and so on until it reaches the final destination on the Internet. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attackers use various methods to turn an internal server into a C &amp; C proxy. </font><font style="vertical-align: inherit;">To do this, they can directly use the GreyEnergy malware, additional third-party software or scripts. </font><font style="vertical-align: inherit;">In the first case, operators can compromise a Windows server with GreyEnergy, turn it into a C &amp; C proxy using the 3proxy and plink modules. </font><font style="vertical-align: inherit;">During the monitoring of GreyEnergy activity, we observed the installation of the following legitimate programs on the internal Linux servers:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> small proxy server 3proxy </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dante SOCKS server </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PuTTY Link (Plink) </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of third-party software, attackers can use internal web servers, installing their own scripts on them. PHP programming languages ‚Äã‚Äãand ASP are used. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In all cases that we have observed, the deployed PHP scripts were obfuscated and encrypted using the same type of obfuscation as in the backdoors for web servers. However, in this case, the cookie containing the decryption key is provided by the GreyEnergy malware itself. For this reason, operators should use a special configuration format for the server URL. </font></font><br><br><img src="https://habrastorage.org/webt/ms/tm/84/mstm84awqgzzm0rxykrmni1ocmw.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 20. The final level that decrypts the PHP backdoor code using the cookie value</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is interesting that the malware configuration contains the word </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B8%25D1%2583%25D0%25BD%25D0%25B3%25D1%2583%25D0%25BB%25D0%25B8%25D0%25BD"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">triungulin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on the way to the obfuscated php script of the proxy server. </font><font style="vertical-align: inherit;">It seems that this is the internal name of this method, used by GreyEnergy operators. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the malware has a built-in C &amp; C proxy in the configuration, it does not contain external C &amp; C servers. </font><font style="vertical-align: inherit;">Therefore, in order to find the external address of C &amp; C, you need to have both a sample of the malware and all associated PHP scripts. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We observed the use of the following PHP scripts:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> custom PHP proxy script </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">somewhat modified version of </font></font><a href="https://github.com/tennc/webshell/blob/master/xakep-shells/PHP/Antichat%2520Socks5%2520Server.php.php.txt"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Antichat Socks5 Server</font></font></a> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The custom PHP proxy script contains a URL with an external C &amp; C in the header. </font></font><br><br><img src="https://habrastorage.org/webt/z1/il/bq/z1ilbqnz3shhbn__app1xhpgtem.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 21. External C &amp; C server embedded in the custom PHP proxy script The custom PHP</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> script uses the OpenSSL and Curl libraries to redirect the request from the malware to an external C &amp; C server on the Internet. </font></font><br><br><img src="https://habrastorage.org/webt/ph/bc/20/phbc20w7dx91bjkhopbartak4cw.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 22. Custom PHP script code of the GreyEnergy group proxy server</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As mentioned above, attackers can use ASP scripts for the same purpose. In one case that we observed, an ASP script used a cookie provided by malware to decrypt only the real C &amp; C address using AES; the rest of the code was not encrypted or obfuscated. </font></font><br><br><img src="https://habrastorage.org/webt/y-/2k/tq/y-2ktq8-zcd2m9e70sobitai9se.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 23. ASP proxy code used by the GreyEnergy group</font></font></i> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C &amp; C servers with Internet access </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All GreyEnergy C &amp; C servers used Tor when they were active. </font><font style="vertical-align: inherit;">The C &amp; C infrastructure settings are similar to BlackEnergy, TeleBots and Industroyer, who also used Tor servers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Probably every C &amp; C server has an onion address, and attackers use it to access, control, or transfer data. </font><font style="vertical-align: inherit;">It appears that this is an OPSEC requirement, which adds an additional level of anonymity for attackers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESET experts have identified the C &amp; C servers used by the GreyEnergy malware over the past three years. </font><font style="vertical-align: inherit;">The list is given below in the section ‚ÄúIndicators of compromise‚Äù.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy vs. BlackEnergy </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The GreyEnergy and BlackEnergy malware families have the same structure, set of modules and functions. </font><font style="vertical-align: inherit;">Although the implementation of these functions is different, they are still comparable.</font></font><br><img src="https://habrastorage.org/webt/mn/zc/sj/mnzcsjrof8t61sfkfi3lzs15p8k.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moonraker petya </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In December 2016, the attackers launched a worm, which, in our opinion, was the predecessor of NotPetya (aka Petya, ExPetr, Nyetya, EternalPetya). The worm was used in attacks on a small number of objects and had limited distribution capabilities, and therefore was not widely known. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The worm is a DLL file named </font></font><code>msvcrt120b.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the Windows directory. The internal file name is </font></font><code>moonraker.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which is probably a reference to the </font></font><a href="https://en.wikipedia.org/wiki/Moonraker_(film)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">film</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and the bondian </font></font><a href="https://en.wikipedia.org/wiki/Moonraker_(novel)"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">novel of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> same </font><a href="https://en.wikipedia.org/wiki/Moonraker_(novel)"><font style="vertical-align: inherit;">name</font></a><font style="vertical-align: inherit;"> . In general, we called the program Moonraker Petya. </font></font><br><br><img src="https://habrastorage.org/webt/21/ez/o5/21ezo5wz4iwkebpqamk88nnuv3e.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 24. The internal name of the worm, as established in December 2016</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The PE timestamp in the DLL assumes that the file was compiled in December 2016, presumably just before installation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moonraker Petya contains the code after which the computer stops booting. In particular, it overwrites the value </font></font><code>ImagePath</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in registry keys </font></font><code>[HKEY_LOCAL_MACHINE\System\ControlSet001\Services\ACPI]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and</font></font><code>[HKEY_LOCAL_MACHINE\System\ControlSet002\Services\ACPI]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and erases the first sector of the system disk. Unlike NotPetya, Moonraker Petya does not contain code that directly interacts with the MBR and the operating system loader. Instead, the Moonraker Petya DLL contains an encrypted binary data blob. The malicious program expects a command line argument, which will later be used as a decryption key. After decryption and unzipping using the zlib library, the code is loaded into memory as a binary PE file and executed. We do not have a decryption key, but we have analyzed disk images of infected computers. They contained the MBR and bootloader code, which corresponds to the code found in the original Green Petya used by various cyber groups. We assume that the blob may contain the original Green Petya.</font></font><br><br><img src="https://habrastorage.org/webt/ok/4h/pk/ok4hpk-oion7dmngxdeo0ud8tka.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 25. A pop-up screen displayed after a reboot on computers infected with Moonraker Petya</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is interesting that the decryption in Moonraker Petya is very similar to the same process in GreyEnergy DLL files in memory-only mode. </font></font><br><br><img src="https://habrastorage.org/webt/mb/ef/mq/mbefmqjst4qziv5a8wxnrggyxky.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 26. Comparing the decompiled Moonraker Petya code (left) and GreyEnergy (right)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moonraker Petya can be distributed over a local area network using SysInternals PsExec. Malicious programs contain a binary file zlib in their resources. Later the binary is reset to the Windows directory with the file name </font></font><code>conhost.exe</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This malicious program is distributed similarly NotPetya: enumerates network nodes using different methods ( </font></font><code>WNetEnumResourceW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>GetIpNetTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>GetExtendedTcpTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>NetServerEnum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, TERMSRV-records using</font></font><code>CredEnumerateW</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), then connects to the network host using the function </font></font><code>WNetAddConnection2W</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and saves the malware as </font></font><code>\\%TARGET-HOST%\admin$\%MALWARE%</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. After this, Moonraker Petya executes the following command, which launches a malicious program on a remote computer using the reset PsExec: </font></font><br><br> <code>C:\Windows\conhost.exe \\%TARGET-HOST% -accepteula -s -d C:\Windows\System32\rundll32.exe "C:\Windows\msvcrt120b.dll", #1 %TIMEOUT% "USER1:PASSWORD1;USER2:PASSWORD2" "%DECRYPTIONKEY%"</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is important to note that the malware does not have credential functions using Mimikatz and does not contain EternalBlue. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In addition to the features listed, Moonraker Petya supports file encryption. The malware scans all files on hard drives, after which it attempts to encrypt them using the AES-256 algorithm. After the encryption process is complete, the malware can create a file </font></font><code>README.txt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with payment instructions.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The instruction contains a personal key encrypted with RSA-2048. In addition, it contains the same text and onion addresses as the original Green Petya. It seems that the attackers wanted to disguise the use of this malware under attack with Green Petya. </font></font><br><br><img src="https://habrastorage.org/webt/9f/i3/qu/9fi3quz_fckxngvtzjm6eay2svy.png"><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figure 27. Readme file with payment instructions generated by Moonraker Petya</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As a final step, Moonraker Petya tries to restart the computer.</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GreyEnergy is an important part of the arsenal of one of the most dangerous ART groups that has been attacking Ukrainian objects in the last few years. We view it as the successor to BlackEnergy, similarities and differences are listed in this post. The main reasons why we made this conclusion are a similar structure of malware, the choice of goals and methods of work. The transition from BlackEnergy to GreyEnergy took place at the end of 2015 - perhaps because the attackers had to update the set of malware after heightened attention to the BlackEnergy infrastructure.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An interesting part of the puzzle is the established fact of use in June 2016 of Moonraker Petya, which, according to our estimates, is the precursor of the destructive program NotPetya. </font><font style="vertical-align: inherit;">This may indicate that the TeleBots and GreyEnergy groups are collaborating or at least sharing code and some ideas. </font><font style="vertical-align: inherit;">However, we regard them as separate groups whose goals are somewhat different. </font><font style="vertical-align: inherit;">At the time of writing, we did not see TeleBots deliberate activities outside Ukraine, unlike GreyEnergy and BlackEnergy before it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In any case, GreyEnergy operators are a serious danger. </font><font style="vertical-align: inherit;">We continue to monitor GreyEnergy and TeleBots activity and encourage private and corporate users to use the most modern endpoint protection products.</font></font><br><br><h2>  Indicators of compromise </h2><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Detection by ESET products: </font></font></h4><br> <code>VBA/TrojanDownloader.Agent.EYV <br> Win32/Agent.SCT <br> Win32/Agent.SCM <br> Win32/Agent.SYN <br> Win64/Agent.SYN <br> Win32/Agent.WTD <br> Win32/GreyEnergy <br> Win64/GreyEnergy <br> Win32/Diskcoder.MoonrakerPetya.A <br> PHP/Agent.JS <br> PHP/Agent.JX <br> PHP/Agent.KJ <br> PHP/Agent.KK <br> PHP/Agent.KL <br> PHP/Agent.KM <br> PHP/Agent.KN <br> PHP/Agent.KO <br> PHP/Agent.KP <br> PHP/Agent.KQ <br> PHP/Agent.KR <br> PHP/Agent.KS <br> PHP/Agent.KT <br> PHP/Agent.KU <br> PHP/Agent.LC <br> PHP/Agent.NBP <br> PHP/Kryptik.AB <br> PHP/TrojanProxy.Agent.B <br> ASP/Agent.L <br> Win64/HackTool.PortScanner.A <br> Win64/Riskware.Mimikatz.A <br> Win64/Riskware.Mimikatz.AE <br> Win64/Riskware.Mimikatz.AH <br> Win32/Winexe.A <br> Win64/Winexe.A <br> Win64/Winexe.B</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy Document: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>177AF8F6E8D6F4952D13F88CDF1887CB7220A645</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy mini: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>455D9EB9E11AA9AF9717E0260A70611FF84EF900 <br> 51309371673ACD310F327A10476F707EB914E255 <br> CB11F36E271306354998BB8ABB6CA67C1D6A3E24 <br> CC1CE3073937552459FB8ED0ADB5D56FA00BCD43 <br> 30AF51F1F7CB9A9A46DF3ABFFB6AE3E39935D82C</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy Droppers: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>04F75879132B0BFBA96CB7B210124BC3D396A7CE <br> 69E2487EEE4637FE62E47891154D97DFDF8AAD57 <br> 716EFE17CD1563FFAD5E5E9A3E0CAC3CAB725F92 <br> 93EF4F47AC160721768A00E1A2121B45A9933A1D <br> 94F445B65BF9A0AB134FAD2AAAD70779EAFD9288 <br> A414F0A651F750EEA18F6D6C64627C4720548581 <br> B3EF67F7881884A2E3493FE3D5F614DBBC51A79B <br> EBD5DC18C51B6FB0E9985A3A9E86FF66E22E813E <br> EC7E018BA36F07E6DADBE411E35B0B92E3AD8ABA</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dumping GreyEnergy DLLs: </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>0B5D24E6520B8D6547526FCBFC5768EC5AD19314 <br> 10D7687C44BECA4151BB07F78C6E605E8A552889 <br> 2A7EE7562A6A5BA7F192B3D6AED8627DFFDA4903 <br> 3CBDC146441E4858A1DE47DF0B4B795C4B0C2862 <br> 4E137F04A2C5FA64D5BF334EF78FE48CF7C7D626 <br> 62E00701F62971311EF8E57F33F6A3BA8ED28BF7 <br> 646060AC31FFDDFBD02967216BC71556A0C1AEDF <br> 748FE84497423ED209357E923BE28083D42D69DE <br> B75D0379C5081958AF83A542901553E1710979C7 <br> BFC164E5A28A3D56B8493B1FC1CA4A12FA1AC6AC <br> C1EB0150E2FCC099465C210B528BF508D2C64520 <br> CBB7BA92CDF86FA260982399DAB8B416D905E89B <br> DF051C67EE633231E4C76EC247932C1A9868C14F <br> DFD8665D91C508FAF66E2BC2789B504670762EA2 <br> E2436472B984F4505B4B938CEE6CAE26EF043FC7 <br> E3E61DF9E0DD92C98223C750E13001CBB73A1E31 <br> E496318E6644E47B07D6CAB00B93D27D0FE6B415 <br> EDA505896FFF9A29BD7EAE67FD626D7FFA36C7B2 <br> F00BEFDF08678B642B69D128F2AFAE32A1564A90 <br> F36ECAC8696AA0862AD3779CA464B2CD399D8099</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy DLL (memory-only mode): </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>0BCECB797306D30D0BA5EAEA123B5BF69981EFF4 <br> 11159DB91B870E6728F1A7835B5D8BE9424914B9 <br> 6ABD4B82A133C4610E5779C876FCB7E066898380 <br> 848F0DBF50B582A87399428D093E5903FFAEEDCD <br> 99A81305EF6E45F470EEE677C6491045E3B4D33A <br> A01036A8EFE5349920A656A422E959A2B9B76F02 <br> C449294E57088E2E2B9766493E48C98B8C9180F8 <br> C7FC689FE76361EF4FDC1F2A5BAB71C0E2E09746 <br> D24FC871A721B2FD01F143EB6375784144365A84 <br> DA617BC6DCD2083D93A9A83D4F15E3713D365960 <br> E4FCAA1B6A27AA183C6A3A46B84B5EAE9772920B</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moonraker petya </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>1AA1EF7470A8882CA81BB9894630433E5CCE4373</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PHP and ASP scripts </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>10F4D12CF8EE15747BFB618F3731D81A905AAB04 <br> 13C5B14E19C9095ABA3F1DA56B1A76793C7144B9 <br> 1BA30B645E974DE86F24054B238FE77A331D0D2C <br> 438C8F9607E06E7AC1261F99F8311B004C23DEC3 <br> 4D1C282F9942EC87C5B4D9363187AFDC120F4DC7 <br> 4E0C5CCFFB7E2D17C26F82DB5564E47F141300B3 <br> 5377ADB779DE325A74838C0815EEA958B4822F82 <br> 58A69A8D1B94E751050DECF87F2572E09794F0F8 <br> 5DD34FB1C8E224C17DCE04E02A4409E9393BCE58 <br> 639BCE78F961C4B9ECD9FE1A8537733388B99857 <br> 7127B880C8E31FBEB1D376EB55A6F878BC77B21A <br> 71BA8FE0C9C32A9B987E2BB827FE54DAE905D65E <br> 78A7FBDD6ADF073EA6D835BE69084E071B4DA395 <br> 81332D2F96A354B1B8E11984918C43FB9B5CB9DB <br> 8CC008B3189F8CE9A96C2C41F864D019319EB2EE <br> 940DE46CD8C50C28A9C0EFC65AEE7D567117941B <br> A415E12591DD47289E235E7022A6896CB2BFDE96 <br> D3AE97A99D826F49AD03ADDC9F0D5200BE46AB5E <br> E69F5FF2FCD18698BB584B6BC15136D61EB4F594 <br> E83A090D325E4A9E30B88A181396D62FEF5D54D5 <br> ECF21EFC09E4E2ACFEEB71FB78CB1F518E1F5724</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Custom port scanner </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>B371A5D6465DC85C093A5FB84D7CDDEB1EFFCC56 <br> B40BDE0341F52481AE1820022FA8376E53A20040</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mimikatz </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SHA-1: </font></font><br> <code>89D7E0DA80C9973D945E6F62E843606B2E264F7E <br> 8B295AB4789105F9910E4F3AF1B60CBBA8AD6FC0 <br> AD6F835F239DA6683CAA54FCCBCFDD0DC40196BE</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WinExe </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-1: </font><font style="vertical-align: inherit;">Warning: most servers with these IP addresses were part of the Tor network, that is, using these indicators can lead to false positives.</font></font><br> <code>0666B109B0128599D535904C1F7DDC02C1F704F2 <br> 2695FCFE83AB536D89147184589CCB44FC4A60F3 <br> 3608EC28A9AD7AF14325F764FB2F356731F1CA7A <br> 37C837FB170164CBC88BEAE720DF128B786A71E0 <br> 594B809343FEB1D14F80F0902D764A9BF0A8C33C <br> 7C1F7CE5E57CBDE9AC7755A7B755171E38ABD70D <br> 90122C0DC5890F9A7B5774C6966EA694A590BD38 <br> C59F66808EA8F07CBDE74116DDE60DAB4F9F3122 <br> CEB96B364D6A8B65EA8FA43EB0A735176E409EB0 <br> FCEAA83E7BD9BCAB5EFBA9D1811480B8CB0B8A3E</code> <br> <br><font style="vertical-align: inherit;"></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Addresses of C &amp; C-servers GreyEnergy mini </font></font></h4><br> <code>https://82.118.236[.]23:8443/27c00829d57988279f3ec61a05dee75a <br> http://82.118.236[.]23:8080/27c00829d57988279f3ec61a05dee75a <br> https://88.198.13[.]116:8443/xmlservice <br> http://88.198.13[.]116:8080/xmlservice <br> https://217.12.204[.]100/news/ <br> http://217.12.204[.]100/news/ <br> http://pbank.co[.]ua/favicon.ico (IP: 185.128.40.90)</code> <br> <br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GreyEnergy C &amp; C Server Addresses (Active and IP Periods) </font></font></h4><br> <code>2015‚Äì2016 ‚Äì 109.200.202.7 <br> 2015‚Äì2015 ‚Äì 193.105.134.68 <br> 2015‚Äì2016 ‚Äì 163.172.7.195 <br> 2015‚Äì2016 ‚Äì 163.172.7.196 <br> 2016‚Äì2016 ‚Äì 5.149.248.77 <br> 2016‚Äì2016 ‚Äì 31.148.220.112 <br> 2016‚Äì2016 ‚Äì 62.210.77.169 <br> 2016‚Äì2016 ‚Äì 85.25.211.10 <br> 2016‚Äì2016 ‚Äì 138.201.198.164 <br> 2016‚Äì2017 ‚Äì 124.217.254.55 <br> 2017‚Äì2017 ‚Äì 46.249.49.231 <br> 2017‚Äì2017 ‚Äì 37.59.14.94 <br> 2017‚Äì2017 ‚Äì 213.239.202.149 <br> 2017‚Äì2017 ‚Äì 88.198.13.116 <br> 2017‚Äì2017 ‚Äì 217.12.202.111 <br> 2017‚Äì2017 ‚Äì 176.31.116.140 <br> 2017‚Äì2018 ‚Äì 185.217.0.121 <br> 2017‚Äì2018 ‚Äì 178.150.0.200 <br> 2018‚Äì2018 ‚Äì 176.121.10.137 <br> 2018‚Äì2018 ‚Äì 178.255.40.194 <br> 2018‚Äì2018 ‚Äì 193.105.134.56 <br> 2018‚Äì2018 ‚Äì 94.130.88.50 <br> 2018‚Äì2018 ‚Äì 185.216.33.126</code> </div><p>Source: <a href="https://habr.com/ru/post/426911/">https://habr.com/ru/post/426911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426899/index.html">Video of Data Science Meetup</a></li>
<li><a href="../426901/index.html">The world's fastest camera shoots 10 trillion frames per second</a></li>
<li><a href="../426903/index.html">Chengdu City wants to raise a reflecting satellite to illuminate the streets with a spot of sunlight of 10‚Äì80 km</a></li>
<li><a href="../426905/index.html">Release of PVS-Studio 6.26</a></li>
<li><a href="../426907/index.html">Typical corporate security issues that can be detected using Check Point Security CheckUP</a></li>
<li><a href="../426913/index.html">How are interviews done between reports and a small report on DevOops</a></li>
<li><a href="../426915/index.html">NASA Hackathon: Space Apps Challenge</a></li>
<li><a href="../426917/index.html">Cisco Intelligent, Secure Business Platform in the Digital Age</a></li>
<li><a href="../426919/index.html">Meet Microsoft Learn</a></li>
<li><a href="../426921/index.html">Oh, My Code: How to become successful in IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>