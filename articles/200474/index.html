<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to build Qt 5.1.1 using Visual Studio 2012 under XP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 This article is nothing supernatural. I just wanted to bring together all the nuances and problems that I encountered, related to the c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to build Qt 5.1.1 using Visual Studio 2012 under XP</h1><div class="post__text post__text-html js-mediator-article"><h5>  Introduction </h5><br>  This article is nothing supernatural.  I just wanted to bring together all the nuances and problems that I encountered, related to the construction of Qt in one article - all of a sudden someone will come in handy. <br><a name="habracut"></a><br>  The task was primarily to get rid of problems with sound under XP, by using dsengine as an alternative to a self-written audio playback plug-in (based on ffmpeg), and for Windows Vista + you can fully use wmfengine.  Therefore, the choice fell on version 5.1.1. <br>  I was also aiming to get a more advanced version of the C ++ 11 language, so I built it under Visual C ++ 11.0 (x86).  There are no problems with the x64 version of the library; it can be downloaded from the official website. <br>  Also in the title of the article there is ‚ÄúXP‚Äù - because it was on this operating system that problems arose. <br><br><h5>  So let's get started ... </h5><br><ol><li>  At first, everything is simple - we search on the official website on the downloads page ( <a href="http://qt-project.org/downloads">qt-project.org/downloads</a> ) to find the right option for us or immediately download the source code ( <a href="http://download.qt-project.org/official_releases/qt/5.1/5.1.1/single/">download.qt-project.org/official_releases/qt/5.1/5.1.1/single</a> ). </li><li>  Then unpack (the main thing in the way is better not to have any spaces). </li><li>  Further we look for all dependences, we read ( <a href="http://qt-project.org/wiki/Building_Qt_5_from_Git">qt-project.org/wiki/Building_Qt_5_from_Git</a> ) <br>  We understand what we need: <br><br><ul><li>  icu </li><li>  pthreads </li><li>  Ruby </li><li>  utilities from the folder in the gnuwin32 archive root </li><li>  Microsoft DirectX SDK (for compiling qt 5 DirectX SDK is required - it should not be installed if there is Microsoft Visual C ++ 2010 x86 / x64 redistributable - 10.0. ( <u>Number over 30319</u> )) </li></ul><br>  As a result, we get the following bat-file <b>vars32.bat</b> : <br><pre><code class="dos hljs"><span class="hljs-comment"><span class="hljs-comment">REM For fast compiling set CL=/MP REM include set INCLUDE=e:\share\_open_source_\icu-51.2-vs2012\include\;e:\share\_open_source_\pthreads\include\;%INCLUDE% REM lib set LIB=e:\share\_open_source_\icu-51.2-vs2012\lib\;e:\share\_open_source_\pthreads\lib\x86\;%LIB% REM tools set PATH=e:\share\_open_source_\icu-51.2-vs2012\bin\;C:\Ruby200-x64\bin;%CD%\gnuwin32\bin\;C:\Python27;C:\Perl64\bin;C:\Program Files (x86)\Microsoft DirectX SDK (June 2010)\Utilities\bin\x86;%CD%\qtbase\bin\;e:\share\_open_source_\pthreads\dll\x86\;%PATH%</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  For a successful build under XP <br><ul><li>  read the msdn article on how to compile ( <a href="http://blogs.msdn.com/b/vcblog/archive/2012/10/08/10357555.aspx">blogs.msdn.com/b/vcblog/archive/2012/10/08/10357555.aspx</a> </li><li>  check that we have Visual Studio has at least one update </li><li>  pay attention to typo in the paths (v7.1A) </li><li>  Do not forget about running the script for the utility nmake with the parameter </li><li>  we finish <b>vars32.</b>  <b>bat</b> : <br><pre> <code class="dos hljs"> ‚Ä¶ <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> nmake <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> "C:\Program Files (x86)\Microsoft Visual Studio <span class="hljs-number"><span class="hljs-number">11</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>\VC\vcvarsall.bat" x86 <span class="hljs-built_in"><span class="hljs-built_in">REM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> XP <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> INCLUDE=<span class="hljs-variable"><span class="hljs-variable">%ProgramFiles(x86)%</span></span>\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>A\Include;<span class="hljs-variable"><span class="hljs-variable">%INCLUDE%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">PATH</span></span>=<span class="hljs-variable"><span class="hljs-variable">%ProgramFiles(x86)%</span></span>\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>A\Bin;<span class="hljs-variable"><span class="hljs-variable">%PATH%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> LIB=<span class="hljs-variable"><span class="hljs-variable">%ProgramFiles(x86)%</span></span>\Microsoft SDKs\Windows\v7.<span class="hljs-number"><span class="hljs-number">1</span></span>A\Lib;<span class="hljs-variable"><span class="hljs-variable">%LIB%</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> CL=/D_USING_V110_SDK71_;<span class="hljs-variable"><span class="hljs-variable">%CL%</span></span></code> </pre><br><br></li><li>  Since this may not be sufficiently modifying the Qt configuration files: <br>  a) File <b>qtbase \ src \ corelib \ io \ qfilesystemengine_win.cpp</b> , line <b>574</b> , change to <br><pre> <code class="diff hljs"># if defined(Q_CC_MINGW) || (defined(Q_CC_MSVC) &amp;&amp; _MSC_VER &lt; 1700) || (defined(Q_CC_MSVC) &amp;&amp; _MSC_VER &gt;= 1700 &amp;&amp; defined(_USING_V110_SDK71_))</code> </pre><br><br>  Otherwise, because of the declared directive <b>_USING_V110_SDK71_</b> , it will not succeed <br>  b) The <b>qtbase \ qmake \ Makefile.win32</b> file <br>  in the variable <b>CFLAGS_BARE</b> add on <b>-DUNICODE -D_USING_V110_SDK71_</b> <br>  c) The <b>qtbase \ mkspecs \ win32-msvc2012 \ qmake.conf file</b> , to the QMAKE_CFLAGS variable: <br><pre> <code class="diff hljs">QMAKE_CFLAGS = -nologo -Zm200 -Zc:wchar_t -D_USING_V110_SDK71_</code> </pre><br>  , as well as <b>QMAKE_LFLAGS_CONSOLE</b> and <b>QMAKE_LFLAGS_WINDOWS</b> : <br><pre> <code class="diff hljs">QMAKE_LFLAGS_CONSOLE = /SUBSYSTEM:CONSOLE,5.01 QMAKE_LFLAGS_WINDOWS = /SUBSYSTEM:WINDOWS,5.01</code> </pre><br></li></ul></li><li>  Next we need to configure Qt.  To do this, we create <b>conf32.bat</b> and add the following line to it. <br><pre> <code class="dos hljs">configure -no-angle -mp -debug-and-release -no-audio-backend -opengl desktop -platform win32-msvc2012 -skip qtwebkit -skip qtwebkit-examples -skip qttranslations -icu -prefix "c:\dev\building_qt\bin\x86" -opensource -confirm-license -nomake tests -nomake examples</code> </pre><br><br>  -no-angle - since my project uses OpenGL ‚Äúdirectly‚Äù, I have problems with ANGLE (http://qt-project.org/wiki/Qt-5-on-Windows-ANGLE-and-OpenGL).  In short, as I understood it, this is an additional abstraction over the OpenGL API, that's why I had problems with entities of the same name. <br><ul><li>  -mp - same as CL = / MP - for faster compilation </li><li>  -no-audio-backend - without wmf media service </li><li>  -opengl desktop - build with opengl support for desktop applications </li><li>  -skip qtwebkit and -skip qtwebkit-examples - don‚Äôt spoil your mood collect them later, this is a developer bug </li><li>  -skip qttranslations - I excluded because if you take version icu version 50 then lrelease.exe will throw out an error.  This module in my opinion is not so important, therefore, we will also collect, but then. </li><li>  -prefix "c: \ dev \ building_qt \ bin \ x86" - path to the built libraries </li><li>  -nomake tests -nomake examples - exclude and save time (even on my work computer, an assembly without a webkit takes 30 minutes) </li></ul></li><li>  I also recommend using jom (http://qt-project.org/wiki/jom).  A small utility that distributes nmake work to threads whose number equals the number of cores.  For example, I have an i7 with ostensibly 8 cores - accordingly there will be 8 threads </li><li>  You can write it in the paths and use the convenient editor of environment variables <b>repidee</b> ( <a href="http://www.rapidee.com/ru/about">www.rapidee.com/ru/about</a> ).  Do not forget to restart the command line, so that the changes take effect </li><li>  And so the assembly.  Run cmd.exe in the root folder of the unpacked archive and type: <br><pre> <code class="dos hljs">vars32.bat &amp;&amp; conf32.bat</code> </pre><br>  Make sure that we have Qt configured as we need. <br></li><li>  We continue.  We drive in: <br><br>  if without webkit'a <br><pre> <code class="dos hljs">jom &amp;&amp; jom install</code> </pre><br><br>  if all at once (and go to sleep) <br><pre> <code class="dos hljs">jom &amp;&amp; jom install &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> qttranslations &amp;&amp; qmake &amp;&amp; jom install &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ..\qtwebkit &amp;&amp; qmake &amp;&amp; jom &amp;&amp; jom install</code> </pre><br><br><ul><li>  Run qmake (from qtbase / bin) to configure some module and get a makefile for nmake.  So you can for example download an additional module to configure and build. </li><li>  For qttranslations, we don‚Äôt forget about icu version 51. I can also notice that Qt applications may fall for this reason.  To check the correctness of icu operation, for example, you can try to call <i>QTextCodec :: codecForName (‚ÄúCP1251‚Äù)</i> , if you managed to get the codec, all is well. </li><li>  I had to finish qtwebkit / bridge api - the transfer of QtRuntimeObject parameters from JS to C ++ does not work, and apparently for a long time. </li><li>  If the application does not run under XP, then you need to see the dependencies via depends (http://www.dependencywalker.com/).  Most likely forgot about <b>msvcp110.dll</b> and <b>msvcr110.dll</b> . <br></li></ul><br></li></ol><br>  Thanks for attention!  I hope someone will come in handy.  My application works great. </div><p>Source: <a href="https://habr.com/ru/post/200474/">https://habr.com/ru/post/200474/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200462/index.html">5 reasons to teach children programming</a></li>
<li><a href="../200464/index.html">Comparison of SATA, SAS, SSD and RAID media with them</a></li>
<li><a href="../200466/index.html">iSCSI storage for the poor</a></li>
<li><a href="../200468/index.html">A simple solution for administering phones and tablets + an invitation to tests</a></li>
<li><a href="../200472/index.html">We write instagram-robot, put likes by tags</a></li>
<li><a href="../200476/index.html">Inventory servers without disgust</a></li>
<li><a href="../200478/index.html">Step-by-step guide to save related data Yii</a></li>
<li><a href="../200482/index.html">Rockstar sued Google</a></li>
<li><a href="../200486/index.html">Regarding the creation of the Russian-patriotic games</a></li>
<li><a href="../200490/index.html">Development of cross-platform mobile applications in Delphi # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>