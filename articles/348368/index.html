<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic font size change throughout an Android application using Configuration.fontScale</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear readers. 

 I wanted to share my thoughts about android development a bit. My task arose to make setting the font size in the applicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic font size change throughout an Android application using Configuration.fontScale</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear readers. <br><br>  I wanted to share my thoughts about android development a bit.  My task arose to make setting the font size in the application so that each user could choose the size for himself. <br><br>  Changing the font size decided to do throughout the application.  But using the <b>setTextSize</b> method in each activity is not an option, since  at one point, a new field will appear and it will be necessary to re-register the required size on it.  Therefore, the decision was to make an automatic change in all places. <br><a name="habracut"></a><br>  When I wrote this article, the essence was as follows: in the settings of the application, the font increase factor is stored.  This factor is applied to the actual font size in its own class, inherited from TextView.  But <a href="https://habrahabr.ru/users/ganster41/" class="user_link">Ganster41</a> suggested a better solution.  Therefore, first there will be a description of the original solution, and at the end there will be an implementation using <a href="https://developer.android.com/reference/android/content/res/Configuration.html">Configuration.fontScale</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Initial implementation </h4><br>  Let's start with the fact that in the right place of the application we add the functionality of selecting and saving the coefficient: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> new_coef = <span class="hljs-number"><span class="hljs-number">1.3f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  SharedPreferences settings = getSharedPreferences("MyAppSett", MODE_PRIVATE); Editor value_add = settings.edit(); //     value_add.putFloat("size_coef", new_coef); value_add.commit();</span></span></code> </pre> <br></div></div><br>  Naturally <b>new_coef</b> needs to be filled dynamically.  For example, when choosing a value on the slider. <br><br>  Further, this coefficient should be considered in the right place and with the help of it change the font size.  Every time reading it from the application settings, when activating a TextView, is not a very good solution.  Therefore, the coefficient will be read once when the application is activated and stored in a global variable.  To do this, add a new application class: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.Example.Test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Application; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.SharedPreferences; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> size_coef; <span class="hljs-comment"><span class="hljs-comment">//   //    public float getSizeCoef() { return size_coef; } //  @Override public void onCreate() { super.onCreate(); //    SharedPreferences settings = getSharedPreferences("MyAppSett", MODE_PRIVATE); size_coef= settings.getFloat("size_coef", 1f); } }</span></span></code> </pre><br></div></div><br>  Further, in the manifest file, we indicate our new class: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MyApp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre><br></div></div><br>  After that, you need to create another class, but based on the TextView: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.Example.Test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v7.widget.AppCompatTextView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.AttributeSet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.TypedValue; <span class="hljs-comment"><span class="hljs-comment">//     public final class MyTextView extends AppCompatTextView { //  public MyTextView(Context context, AttributeSet attrs) { super(context, attrs); InitSize(context); } //   private void InitSize(Context context) { //    Activity activity = (Activity) context; float koef = ((MyApp) activity.getApplication()).getSizeCoef(); float cur_size = getTextSize(); //     //      setTextSize(TypedValue.COMPLEX_UNIT_PX, cur_size * koef); } }</span></span></code> </pre><br></div></div><br>  Note that the <b>setTextSize</b> method <b>has the</b> first default parameter = <i>TypedValue.COMPLEX_UNIT_SP</i> .  Which means setting the font size in sp units.  In our case, <i>TypedValue.COMPLEX_UNIT_PX is</i> used.  This type must be specified to set the font size in pixels, since  <b>getTextSize</b> returns the current size in pixels. <br><br>  In principle, all the preparatory classes are ready.  It remains in the right place markup instead of TextView to specify your own class MyTextView: <br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.Example.Test.MyTextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/TextValue"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/TextColor"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/TextSize"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br></div></div><br>  As a result, when you open the activity for this text, the font size will be changed to the one that the user has selected.  With EditText, everything is done similarly. <br><br><h4>  Updated implementation </h4><br>  For myself, I decided to use the font size factor from <b>0.7f</b> to <b>1.45f</b> with an interval of <b>0.15f</b> .  Those.  these are 6 steps.  To select a specific value using <b>SeekBar</b> . <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SeekBar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/seekBar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:progress</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In the right place of the application (in the onCreate method) we implement the processing of the selected value on the SeekBar: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> start_value = <span class="hljs-number"><span class="hljs-number">0.7f</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    final float step = 0.15f; //   int size_coef; //  ... SeekBar seekBar = (SeekBar) findViewById(R.id.seekBar); ... if (seekBar != null) { seekBar.setProgress(select_coef); seekBar.setOnSeekBarChangeListener(new SeekBar.OnSeekBarChangeListener() { @Override public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) { size_coef = progress; //  } @Override public void onStartTrackingTouch(SeekBar seekBar) { } @Override public void onStopTrackingTouch(SeekBar seekBar) { } }); }</span></span></code> </pre><br>  The value selection processing on the slider is done.  Now you need to save the selected result and immediately change the font size (for example, by using the button): <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  SharedPreferences settings = getSharedPreferences("MyAppSett", MODE_PRIVATE); SharedPreferences.Editor value_add = settings.edit(); //     value_add.putInt("size_coef", size_coef); value_add.apply(); //     Resources res = getResources(); float oef = start_value + size_coef * step; //    Configuration configuration = new Configuration(res.getConfiguration()); configuration.fontScale = oef; res.updateConfiguration(configuration, res.getDisplayMetrics());</span></span></code> </pre><br>  Now when you change the activity will be the new font size in all places of the application.  But at the moment this size will be only until the application is restarted.  When you open the application, the font size of what is set in the android settings on the device will be set.  And accordingly, in order for the size we need in the application, it is necessary to reassign it.  To do this, we save the coefficient in the application parameters: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.Example.Test; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Application; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.SharedPreferences; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  @Override public void onCreate() { super.onCreate(); int size_coef; final float start_value = 0.7f; //    final float step = 0.15f; //   Resources res = getResources(); SharedPreferences settings = getSharedPreferences("MyAppSett", MODE_PRIVATE); try { //    size_coef = settings.getInt("size_coef", 2); } catch (Exception e) { size_coef = 2; //   } //    float new_value = start_value + size_coef * step; //     Configuration configuration = new Configuration(res.getConfiguration()); configuration.fontScale = new_value; res.updateConfiguration(configuration, res.getDisplayMetrics()); } }</span></span></code> </pre><br>  The default value is <i>2</i> , i.e.  in my formula, this is a font increase factor of 1 (0.7 + 0.15 * 2 = 1).  This class must be specified in the manifest: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".MyApp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre><br>  As a result, when you open the application, the font size will be changed in all places.  I redid my implementation from the first method to the second, which made it possible not to add my own classes for TextView, EditText, etc. <br><br>  Thank you all for your attention. </div><p>Source: <a href="https://habr.com/ru/post/348368/">https://habr.com/ru/post/348368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348358/index.html">10 Gigabit Ethernet: Newbie Tips</a></li>
<li><a href="../348360/index.html">OpenVPN OSPF between two servers, multiple tunnels</a></li>
<li><a href="../348362/index.html">Where in Siberia to talk about IT</a></li>
<li><a href="../348364/index.html">BitPaymer (FriedEx) coder created by Dridex banker trojan authors</a></li>
<li><a href="../348366/index.html">Personal experience with Firebase Cloud Firestore</a></li>
<li><a href="../348374/index.html">Translation of the book "Social Architecture": Chapter 5. Design, development, innovation</a></li>
<li><a href="../348376/index.html">pdbe is an assistant to the built-in python debugger and debugging process</a></li>
<li><a href="../348378/index.html">VDOM do it yourself</a></li>
<li><a href="../348380/index.html">8-bit computer with BASIC and VGA-out on the Arduino</a></li>
<li><a href="../348382/index.html">Is it true that PM does something useful and what it takes to become</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>