<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backdoor in active directory do it yourself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, we all know about mean users with UID = 0 in unix, which can be more than one. 

 Let's see how the same (and in fact, even more terrible) is orga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backdoor in active directory do it yourself</h1><div class="post__text post__text-html js-mediator-article">  So, we all know about mean users with UID = 0 in unix, which can be more than one. <br><br>  Let's see how the same (and in fact, even more terrible) is organized in the Windows infrastructure.  Of course, we are not going to talk about local Windows accounts, but about Active Directory, i.e.  let's talk about the domain administrator.  Or, even worse, about the enterprise administrator. <br><br>  So, the truth is number one: objects in active directory have attributes and access rights. <br>  Truth number two: these attributes can be changed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As it is easy to understand, we CAN make an account with fantastic rights to which no one can access.  However, he will be able to login, block, unblock, change his attributes and attributes of strangers. <br><br>  In the worst case, it will be a user with a magic SID- * 500, which Windows itself does not allow to delete.  (To do this, rename, and in its place put another user with the nickname Administrator and with full rights). <br><a name="habracut"></a><br>  Thus, we will get a formally clean little white fluffy domain, inside of which lives a big, fat ... m ... I do not even know who.  Well, let him be called the northern fur-bearing beast. <br><br>  Steps to perform: <br>  1) Create an account or rename an administrator.  Call her very ... weird.  For example, ExchangeLegacyReciver.  In the usual case, there is ExchangeLegacyInterop, so it‚Äôs very difficult to understand what it‚Äôs all about. <br>  2) Give her the appropriate name.  Like, Exchange Legacy Connection Reciver. <br>  3) Give her a password, specify ‚Äúthe password never expires‚Äù, etc. <br>  4) Include it in all the right groups.  In fact, to control the domain, it is enough to enter the Remote Desktop Users (or another group specified in the tcp-RDP properties) and the Enterprise Administrator.  The smaller <br><br>  Then the magic begins: <br><br>  1) Login under this account. <br>  2) We run ads * (if you don‚Äôt know what the stars are in place, you don‚Äôt need it. Those who know and understand what they are talking about, please don‚Äôt answer school hacker questions about the missing part) <br>  3) We are looking for ourselves in the right OU.  First of all we go to the properties and change the owner to some other account with sufficient rights (so that, if we make a mistake, we can change or delete it) <br>  4) Remove the inheritance checkbox, copy the attributes. <br>  And ... Well, you understand.  Remove all unnecessary.  Removing SYSTEM from those who have the right will lead to a strange situation: even an account cannot change its attributes via snap-ins, however, it can edit them through ads *;  add yourself full rights to yourself. <br>  5) Create a new System container in ou = Program data <br>  5) Move the object (right-click, move) to, for example, Program Data.  This place is never visible to anyone.  Those.  your object will exist ‚Äúsomewhere‚Äù where it will be visible only through ads * or similar utilities.  Alternatively, move simply to the domain root. <br>  6) Check the rights after the move (they like to append) <br>  7) do the trick with the container.  This will not allow outsiders not only to change the attributes or read them, but also to see the fact of existence. <br><br>  Consider, during all this - one mistake - and you are no longer the owner of yourself without the right to restore. <br><br>  Actually, one can say almost everything.  You can (checking that login, etc. is good), change the user's owner to himself.  Point chain closed.  Then only restore from backup.  The most funny thing is that other users with full rights will not even see you in the active directory.  Even in ads *. <br><br>  Then it remains only to securitize the main thing - this is group membership (one wrong step - and you are a corpse, recover from backup). <br><br>  So: <br><br>  1) Rename the group (through ads) to something your own.  For example, Builtin Security Principial. <br>  2) Create an Enterprise Administrator.  We include it in Builtin Security Principial. <br>  3) Move Builtin Security Principial to program data \ system <br>  4) make him a similar "magic" with the rights. <br>  5) PROFIT ??? <br><br>  See it will be.  Alas.  I did not manage to hide the membership until the end (although you can create a chain ...) However, when I try to remove you from the group members, there will be an error there is no such object on server. <br><br>  Wherein: <br><br>  1) enterprise and domain admins still have a right to exist.  The group is there, its rights are correct, the domain is working as expected (I did not check the installation of the ecchain, though). <br>  2) There is an account that is IMPOSSIBLE to see.  No  None of the ads * or anything else (you can see a strange container, but no more). <br>  3) Membership in groups at this account is not noticeable. <br><br>  A further level of stealth is to try to change the type of group and user to something else (for example, to a computer).  Not sure that this is possible, and that it will be adequately perceived by computers on the network. <br><br>  PS I apologize, I wrote messy as I look for a solution to the problems.  Tomorrow, if there is time, I will raise the virtual machine from 2008, check it out there in full. </div><p>Source: <a href="https://habr.com/ru/post/90990/">https://habr.com/ru/post/90990/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../90976/index.html">RIT ++, photos of the second day</a></li>
<li><a href="../90982/index.html">5 principles for reducing the likelihood of failure of an IT project</a></li>
<li><a href="../90985/index.html">Disabling Internet access to resources located on the facilities of the company "Makhost"</a></li>
<li><a href="../90986/index.html">Z Fang Gamepad Review</a></li>
<li><a href="../90987/index.html">Another blow of the Ukrainian operator ‚Äúlife :)‚Äù on its subscribers (‚Äúforced services‚Äù)</a></li>
<li><a href="../90993/index.html">Chobi Mini Digital Camera - the world's smallest camera</a></li>
<li><a href="../90994/index.html">About morals and games</a></li>
<li><a href="../90997/index.html">Launch of Visual Studio 2010 in St. Petersburg</a></li>
<li><a href="../91001/index.html">Using video to attract new Wikipedia editors</a></li>
<li><a href="../91002/index.html">Managing ISC DHCPd 4.x from scripts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>