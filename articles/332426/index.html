<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cisco CDR and Asterisk Telephony Analysis with Splunk</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today there is a classic, from the point of view of analytics, task - analysis of CDR telephony. In this article, we will describe how two different c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cisco CDR and Asterisk Telephony Analysis with Splunk</h1><div class="post__text post__text-html js-mediator-article">  Today there is a classic, from the point of view of analytics, task - analysis of CDR telephony.  In this article, we will describe how two different companies solved two completely different tasks.  Company X analyzed the Cisco CDR telephony, and company Y analyzed the CDR Asterisk telephony.  Why do we write about this in one article?  Because as a tool for analysis, both companies use <a href="http://tssolution.ru/splunk/">Splunk</a> , about which we <a href="https://habrahabr.ru/company/tssolution/blog/323814/">wrote a</a> lot <a href="https://habrahabr.ru/company/tssolution/blog/323814/">earlier</a> . <br><img src="https://habrastorage.org/web/c05/37f/a09/c0537fa09d23473cbc892610b84010ac.png"><br><br>  Under the cat you will find a detailed description of the tasks and their solutions with pictures and queries. <br><a name="habracut"></a><br><br><h2>  <b>Tasks</b> <br></h2><br>  <b>Company X</b> has about 30 departments, in which there are about 400 internal numbers and about 100,000 calls per month. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Company X wants to receive analytics of calls made by internal users both outside and among themselves.  It is necessary to receive information on the number of phone calls, the number of callers, the distribution of incoming and outgoing calls, the most calling subscribers inside / outside. </li><li>  Reports are required showing how employees from different departments interact with counterparties.  Often, such a task is difficult to solve objectively on the basis of surveys, and by analyzing phone calls you can get the most objective picture possible. </li><li>  It is necessary to assess the intensity of calls to understand the activity of the work of managers within the organization. </li></ul><br>  <b>Company Y</b> has a call center based on Asterisk telephony with 1 million calls per day and wants to receive analytics about its work.  Most of all, company Y wants to know the number of competitive calls (occupied by time slots) at a certain time quantum (for example, at each hour), with distribution to external flows.  Plus basic kpi, such as: average call duration, average call duration, percentage of answered calls, and so on. <br><br><h2>  <b>Problem solving</b> </h2><br>  In this article we will not talk about how to connect Splunk data and how to do field parsing (if that's what you are interested in, <a href="http://tssolution.ru/splunk/">write to us</a> - and we will make a separate article about it, but in fact, there is no rocket science).  We will show basic queries, graphics and dashboards. <br><br>  <b>Company X</b> <br>  Analytics across the organization: <br><br><img src="https://habrastorage.org/web/9dc/dc5/6dc/9dcdc56dc21e47698c8af798e070bebd.png"><br><br><img src="https://habrastorage.org/web/706/626/6fd/7066266fd630433ab81b9b4516ac09b3.png"><br><br>  This dashboard collected general analytics for the company as a whole, with various statistical indicators.  The dashboard is live, that is, it has various filters, and can also send the user to the next level of detail.  For example, when you click on a particular department or phone number, the user will see the analyst in the context of the selected segment. <br><br>  Analytics within a separate department: <br><br><img src="https://habrastorage.org/web/349/441/69e/34944169e824439f91833acfe29bc8c8.png"><br><br><img src="https://habrastorage.org/web/ab1/d19/fee/ab1d19fee74d40ca86330dbe2f8e3093.png"><br><br>  On this dashboard, the user sees the details for a specific department of the company, and can make a conclusion about the statistics of the interaction of the staff of this department with other internal departments, as well as external calls. <br><br>  User-specific analytics: <br><br><img src="https://habrastorage.org/web/57a/9f0/1b0/57a9f01b02f84fe5bb56f79a1ae450ef.png"><br><br>  This is the last level of detail, where we see information relating to a particular employee of the organization, and we can judge its activity. <br><br>  <b>Requests</b> <br><br>  In fact, all these graphs are built on fairly simple queries, the level of complexity is comparable to those we discussed in our previous <a href="https://habrahabr.ru/company/tssolution/blog/324136/">articles</a> .  Below is one of the most difficult: <br><br><pre><code class="python hljs">|inputlookup lookup.csv | where unit = <span class="hljs-string"><span class="hljs-string">"MGMI"</span></span> | table ext | join ext type=left [search index=test sourcetype = csv Department = <span class="hljs-string"><span class="hljs-string">"MGMI"</span></span> | stats count AS <span class="hljs-string"><span class="hljs-string">"colorig"</span></span> by callingPartyNumber| rename callingPartyNumber <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ext] | join ext type=left [search index=test sourcetype = csv DepartmentDest = <span class="hljs-string"><span class="hljs-string">"MGMI"</span></span> | stats count AS <span class="hljs-string"><span class="hljs-string">"coldest"</span></span> by originalCalledPartyNumber| rename originalCalledPartyNumber <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ext ] | eval C=<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isnull(colorig), <span class="hljs-number"><span class="hljs-number">0</span></span>,colorig) | eval D = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isnull(coldest), <span class="hljs-number"><span class="hljs-number">0</span></span>,coldest) | table ext CD |rename ext <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> C <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> D <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span></code> </pre> <br><img src="https://habrastorage.org/web/fd9/b0f/0d1/fd9b0f0d195c4ed68a93c7f5c454fcb9.png"><br><br>  <b>Company Y</b> <br><br>  Everything is much simpler here, since the call center has only one type of calls, and the company is more interested in only summary information.  However, the possibility of dorobotki and detailing is not excluded, for example, for a specific employee.  Below are the main Asteriska CDR based dashboards: <br><br><img src="https://habrastorage.org/web/180/d55/92b/180d5592bd9245d8b7c41aabe51a252e.png"><br><br><img src="https://habrastorage.org/web/e81/aec/574/e81aec5743444b47ba22ea5449e33419.png"><br><br>  The most interesting is the lowest chart, where the problem of calculating competitive sessions is solved. <br><br>  <b>Requests</b> <br><br>  Below is one of the most complex requests, just about competitive sessions: <br><br><pre> <code class="python hljs">index=<span class="hljs-string"><span class="hljs-string">"aster2"</span></span> dstchannel=<span class="hljs-string"><span class="hljs-string">"Beeline"</span></span> | concurrency duration=duration | timechart span=<span class="hljs-number"><span class="hljs-number">1</span></span>h max(concurrency) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Beeline | join _time type=left [search index=<span class="hljs-string"><span class="hljs-string">"aster2"</span></span> dstchannel=<span class="hljs-string"><span class="hljs-string">"MTS"</span></span> | concurrency duration=duration | timechart span=<span class="hljs-number"><span class="hljs-number">1</span></span>h max(concurrency) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MTS | join _time type=left [search index=<span class="hljs-string"><span class="hljs-string">"aster2"</span></span> dstchannel=<span class="hljs-string"><span class="hljs-string">"Megafon"</span></span> | concurrency duration=duration | timechart span=<span class="hljs-number"><span class="hljs-number">1</span></span>h max(concurrency) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Megafon | join _time type=left [search index=<span class="hljs-string"><span class="hljs-string">"aster2"</span></span> dstchannel=<span class="hljs-string"><span class="hljs-string">"TTK"</span></span> | concurrency duration=duration | timechart span=<span class="hljs-number"><span class="hljs-number">1</span></span>h max(concurrency) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TTK ]]]</code> </pre> <br><img src="https://habrastorage.org/web/fec/a91/5d5/feca915d52e040f5a919976c10e5f3b7.png"><br><br><h2>  <b>Conclusion</b> </h2><br><br>  We are happy to answer all your questions and comments on this topic.  Also, if you are interested in something specifically in this area, or in the field of machine data analysis in general, we are ready to refine the existing solutions for you, for your specific task.  To do this, you can write about it in the comments or simply send us a request through the form on <a href="http://tssolution.ru/splunk/">our website</a> . <br><br><h2>  PS </h2><br>  <b>On June 28, 2018,</b> ‚Äú <a href="http://tssolution.tilda.ws/study-splunk">Splunk Getting Started</a> ‚Äù will be taught <b>in Moscow</b> , where in 6 hours the participants will receive a theoretical base and practical skills for working in Splunk.  Learn more about learning and register at this <a href="http://tssolution.tilda.ws/study-splunk">link</a> . </div><p>Source: <a href="https://habr.com/ru/post/332426/">https://habr.com/ru/post/332426/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332412/index.html">Virtual site development pipeline and automation</a></li>
<li><a href="../332414/index.html">Announcement of the conference HolyJS 2017 Moscow: Two days of pure JS</a></li>
<li><a href="../332416/index.html">The experience of creating a real-time video sequencer on iOS</a></li>
<li><a href="../332418/index.html">Create a UWP application in SPL</a></li>
<li><a href="../332422/index.html">Integration of HostTracker with Slack. Site stability: how to keep everyone up to date</a></li>
<li><a href="../332428/index.html">TI SensorTag, Eclipse kura and web parts integration via Apache Camel</a></li>
<li><a href="../332430/index.html">VKontakte data center</a></li>
<li><a href="../332432/index.html">Kubernetes Network Performance Comparison</a></li>
<li><a href="../332434/index.html">Systems Management Analysis</a></li>
<li><a href="../332436/index.html">Bitfury Group conducted the first successful multi-hop transaction on the Lightning Network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>