<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do we with the help of mathematical statistics measure the quality of data in Yandeks.Gorode</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Flying in the plane Petka and 
 Vasily Ivanovich, Vasily Ivanovich shouts: 
 - Petka, devices! 
 Petka replies: 
 - Two hundred! 
 Vasily Ivanovich: 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do we with the help of mathematical statistics measure the quality of data in Yandeks.Gorode</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  Flying in the plane Petka and <br>  Vasily Ivanovich, Vasily Ivanovich shouts: <br>  - Petka, devices! <br>  Petka replies: <br>  - Two hundred! <br>  Vasily Ivanovich: <br>  - And what is "two hundred"? <br>  Petka: <br>  - And what about the "devices"? </blockquote><br>  Today our new service, <a href="http://gorod.yandex.ru/">Yandex.City</a> , is out of beta.  It appeared as a logical continuation of the Yandex. Reference Book, which was the only source of knowledge about organizations for all our services.  Its data is used in the J.Gorod application itself, on Yandex.Maps, in snippets on the search results page, for plotting routes in Maps and Navigator, determining the number in Yandex.Kite, choosing places of departure and arrival in Taxi.  It was possible to find places and organizations on many of our sites, but it‚Äôs not very convenient to choose there. <br><br>  We realized that users need a separate service for this.  But to understand and do is not the same thing.  In this post I want to talk about how we chose metrics in order to measure what happens, what unobvious discoveries have been waiting for us along the way, and in general why it is not easy to assess the quality of data across Russia or even individual cities. <br><br>  If you have your own business, and if you are a hired manager, it is very important for you to be able to measure business performance.  How do you understand that everything works well or badly?  How to check that changes led to improvement?  What will you base on when making decisions?  All this requires metrics - quantitative characteristics of the state of the system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="http://habrahabr.ru/company/yandex/blog/226517/"><img src="https://habrastorage.org/getpro/habr/post_images/78e/04c/8d7/78e04c8d781d78c298e8c05ece7f24e3.jpg"></a> <br>  The site search service on Yandex has a long history, and several teams had a hand in its creation.  It grows from the project adresa.yandex.ru.  Then Yandex integrated the ‚ÄúYellow Pages‚Äù business into it - this is how the Directory appeared.  About a year ago, the service team was greatly updated.  And he began to turn into Yandex.City.  I am in charge of the data production service in this team and today I will tell you about the metrics we have and how they help us make the best base of organizations in Russia. <br><a name="habracut"></a><br><br><h4>  How we chose metrics </h4><br>  In fact, once upon a time we lived without them at all.  The fact that we were able to develop some sort of evaluation system, which we began to focus on, was in itself a great achievement for the whole team.  At the next stage, we began to think about whether we have good metrics. <br><br>  One of our basic indicators was the number of <b>well-known service organizations</b> (POIs).  But on closer examination, this metric was quite meaningless.  It is certainly convenient and useful for operational management, because it is easy to read and understandable to everyone.  But we are making a product for users, and their happiness was not reflected in it. <br><br>  Judge for yourself, did the user become better at what we knew 50K organizations, and 60K organizations began to know?  Maybe.  And if we still do not know the 24-hour pharmacy nearest the house or the nearest ATM of the bank you need? <br><br>  But if we have chosen for ourselves the metrics of the number of organizations, then before answering a man‚Äôs question, we need to clarify one important point.  And whether to consider the organization this ATM?  And the Rospechat booth?  And a public toilet?  And the automatic kiosk for the sale of tickets on the subway or train? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b8/150/1de/7b81501deefdca003cf5d5def707cfe0.png"><br><br>  It seems that summarizing the user's needs, the product manager can answer these questions.  But there are many products and each has his own manager with his own data requirements.  How to bring them into a single and not contradictory order, given that each customer can not know all the details about the base? <br><br>  Realizing that you do not need to wait for someone to answer for me, I wrote a consolidated definition of the organization and put it in a public place.  At the bottom he added: ‚ÄúArguments to change this document should be sent to the next list of people.‚Äù  This made it possible to start work in parallel with endless discussions on how to live correctly. <br><br>  As we have already discussed above, the ‚Äútotal number of known organizations‚Äù metric is not the best, because it does not help us understand how well we solve the user's tasks.  And to do this is our main goal. <br><br>  Let's see how a set of metrics can describe our project.  Quite obvious metrics come to mind: <br><br><ul><li>  The above-mentioned number of organizations - both absolute and in comparison with the main competitors (including in certain categories). </li><li>  The number / proportion of irrelevant responses that were caused because the organization was not in the database.  Convenient metric, but difficult to measure, especially in the scale of our country. </li><li>  <b>Accuracy</b> - the proportion of organizations with the correct data among all organizations available in the system. </li><li>  <b>Completeness</b> - the proportion of organizations known to Yandex among all organizations in the real world. </li></ul><br>  And we chose the last two metrics as those that best reflect the quality of the system and the complexity of measurement that suits us. <br><br><h4>  How we considered metrics </h4><br>  It seems that life has improved: we have defined metrics, regularly measured them, thought through measures to improve them.  Live and be happy.  Inside the company, we are very willing to discuss metrics in terms of ‚Äúaccuracy should not be lower than X‚Äù or ‚Äúcompleteness should be not lower than Y‚Äù.  It seemed to everybody what precision is - and, of course, it should be as high as possible.  It is not very interesting what we consider an organization, what we consider a mistake, affecting accuracy, and so on. <br><br>  But when we analyzed how we actually measure accuracy, it turned out that different parties often understand this as slightly different.  And it would be possible to save many hours spent on lively meetings, if it immediately became clear - we speak different languages ‚Äã‚Äãand therefore we can not agree.  Our data is used by different Yandex services, and each service has its own requirements for accuracy.  But an amazing story: at the same time, they simply require ‚Äúdata with an accuracy not lower than X‚Äù.  The big surprise for everyone was that everyone understands accuracy very differently. <br><br>  As a result, we described several accuracy metrics that consistently strengthen one another. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dab/247/c10/dab247c103b11e217ad7cbd8ed0160f9.png"><br><br>  Due to this, we have seen that if our basic accuracy is used from the very beginning, our accuracy is really high (above 90%), then for the rest it can reach 50-60%.  And it is precisely the nesting of metrics into each other that allows us to consistently work on the quality of the base, moving from one metric to another. <br><br>  Naturally, all such measurements occur on random samples of organizations, and this entails another insidious error.  Often people forget that any indirect metric has an error.  That is, if six months ago, the accuracy of the measurements was 62%, and now, after performing a certain project, it has become 63%, then this does not mean anything, it‚Äôs too early to beat the drums.  Such a citation of statistical data is generally unprofessional, unless an error is simultaneously indicated. <br><br>  The second mistake when working with similar metrics is the use of some point metrics.  For example, depending on the significance of the error, a ‚Äúrating‚Äù is set from 1 to 5. Obtaining an acceptable estimation error with imputed metering costs is possible only in the case of a binary metric - that is, data on a particular organization is either accurate or not. <br><br>  As mentioned above, the measurement of metrics is based on random samples.  Random samples are manually checked by people, and based on this, the final metric is estimated.  The larger the sample, the higher the labor costs for its checking (markup).  In an ideal world that does not exist, the labor costs are worthless and the organization‚Äôs verification takes infinitely little time.  Therefore, there, in an ideal world, it would be logical to check the entire base and calculate the value of accuracy.  Then, by the way, I would not have to constantly make corrections for errors.  However, the reality makes its own adjustments and I want to determine the optimal sample size.  Mathematical statistics comes to the rescue. <br><br>  Suppose that we have in the database <i>N = 40 000</i> organizations.  We are interested in the size of the sample n, which must be marked out, so that on its basis we can make a reliable conclusion about the accuracy of the entire base.  Note that on the basis of selective markup, it will be possible to draw only a conclusion of the following form: <br><br>  <i>"The real accuracy of the base deviates from some number p by no more than Œ¥ with a probability of at least P".</i> <br><br>  So, we have three values: <i>n</i> is the sample size, <i>Œ¥</i> is the estimate error, <i>P</i> is the probability of this estimate.  Of course, we want to minimize our cost of marking up <i>n</i> organizations, minimize the error in estimating <i>Œ¥</i> and maximize the probability <i>P</i> , with which we can assert that the results obtained on the basis of the sample are applicable to the entire base as a whole.  But, as in the well-known joke ‚ÄúQuickly, efficiently, inexpensively - choose any two points‚Äù, we need to sacrifice something.  We will not sacrifice much of the probability <i>P</i> , otherwise the estimate obtained will reflect the real state of affairs only with a small probability, but why then was the measurement taken?  We agree on the probabilities <i>P</i> = 95% and the permissible error <i>Œ¥</i> = 5%.  And the size of the minimum sample is now not difficult to calculate.  And what can not but rejoice, it can be argued that it will be enough to mark out a sample of only 384 organizations! <br><br>  Suppose that we estimated a sample of size <i>n</i> = 384 organizations, and of these, <i>m</i> = 290 organizations turned out to be correct.  Then we have the following estimate: <img src="https://habrastorage.org/getpro/habr/post_images/b97/132/19c/b9713219c4a0a759c21b9fe09c34ce3d.png" width="74" height="13">  .  And the estimate error is <nobr>Œ¥</nobr> <nobr><img src="https://habrastorage.org/getpro/habr/post_images/cf9/dd1/abe/cf9dd1abef3167725912ce998836c16c.png" width="173" height="21"></nobr>  <nobr>%</nobr>  So we can say that our accuracy is <nobr>75.5 ¬± 4.3%</nobr> .  If we suddenly have requirements for reducing the error, it will be enough for us to additionally mark some more random number of organizations, the number of which is calculated on the basis of the presented requirements for the error. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fa1/e40/854/fa1e40854254f231294188aa245bc365.png"><br><br>  As already noted, when we receive, for example, <nobr>72.2 ¬± 4.5%</nobr> in the next measurement, we will not be able to say anything definite about whether our accuracy has increased or decreased. <br><br>  We now turn to the other defining metric of each directory - the metric of completeness.  Completeness is the proportion of real-world organizations represented in the directory.  So, if there are 10,000 organizations of interest to you in city <i>X</i> , and you only know 6,000 of them, then your completeness is 60%. <br><br>  This metric can be measured in an ‚Äúhonest‚Äù way only by visiting organizations in the real world ‚Äî that is, the metric itself is, in terms of labor costs, quite expensive.  Fortunately, for the same reasons as above, the random flow of just 384 organizations is enough for us to measure completeness with an acceptable margin of error. <br><br>  The measurement process itself is as follows.  The first thing we need to do is create a random selection of addresses (house numbers) based on the address database we have on our Maps.  Next, you need to visit each house and, according to the chosen definition, describe all the organizations present there. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/deb/392/c2e/deb392c2e33b898119bfa98c27f46cec.png"><br><br>  A random sample of the collected organizations is checked for presence in Yandex.City.  The estimate of the completeness and the error of this estimate are calculated using formulas that are already familiar to us. <br><br><h4>  findings </h4><br>  In addition to technical things, I want to highlight those managerial lessons that I learned during my work at Yandex.City. <br><br><ul><li>  [captain obvious] Metrics are needed to manage any process or project.  At the same time, if possible, they should be simple and understandable.  There is nothing wrong with complex metrics, but in the case of a large distributed team, there must necessarily be a simple metric shared by all team members. </li><li>  When evaluating any metric and comparing metrics at different points in time, it is important to understand the accuracy of this estimate. </li><li>  When estimating metrics on random samples, it is required to use binary metrics, since only such an approach allows achieving an acceptable accuracy of estimation with a relatively small number of measurements. </li><li>  If you bring some kind of metric, do not be lazy, find out exactly how it is calculated.  Ask for the source code, formula, description of the calculation algorithm, markup examples.  Find out sample sizes and how they were generated.  It may be a surprise that some offline metric, measured once a year, is usually considered on the data for the last month - that is, without regard to seasonality. </li></ul><br>  We considered two metrics - accuracy and completeness, which, on the one hand, allow us to adequately judge how well we reflect organizations from the real world in our system, and on the other hand, they are sufficiently comprehensible for the whole company and inexpensive to measure. <br><br>  Next time we will talk about how to measure the offline metric of completeness in cases where there is no good map for the city, which in our case means that we do not have address information and a full list of ‚Äúhouses‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/226517/">https://habr.com/ru/post/226517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226503/index.html">NASA sends a 3D printer to the ISS</a></li>
<li><a href="../226507/index.html">Forward to new heights of ignorance</a></li>
<li><a href="../226509/index.html">Situational analysis / pre-project development site</a></li>
<li><a href="../226513/index.html">Endurance SSD test: write 1 petabyte</a></li>
<li><a href="../226515/index.html">Benefits of Jelastic pricing over Amazon</a></li>
<li><a href="../226521/index.html">Introduction to complex queries in SQLAlchemy</a></li>
<li><a href="../226523/index.html">Record of the webinar "What's new in Kerio Operator 2.3"</a></li>
<li><a href="../226527/index.html">Ubuntu Phone activated on 10,000 devices</a></li>
<li><a href="../226531/index.html">The first Russian coins with a QR code</a></li>
<li><a href="../226535/index.html">How to honestly work as a freelancer in Belarus?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>