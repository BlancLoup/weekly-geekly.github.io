<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programming a random number generator on Ethereum</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing smart contracts for Ethereum, it is usually considered that it is unreliable to rely on the block hash as a source of randomness, as t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programming a random number generator on Ethereum</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/9o/vx/am/9ovxamyuhfsk0tn08ahrlxmmty4.png" alt="image"></p><br><p>  When developing smart contracts for Ethereum, it is usually considered that it is unreliable to rely on the block hash as a source of randomness, as the miner can influence the result by selecting the block hash (see <a href="http://solidity.readthedocs.io/en/develop/security-considerations.html%3Fhighlight%3Drandom">Private Information and Randomness</a> , <a href="http://solidity.readthedocs.io/en/develop/frequently-asked-questions.html%3Fhighlight%3Drandom">how?</a> ) </p><br><p>  How great is actually the opportunity for the miner to increase his chances of winning the game in which you need to guess the hash of the block with a certain number (or a certain number produced by the hash of the block)? </p><a name="habracut"></a><br><p>  The probability to guess a random number in the range from 0 to 9 is 1/10 </p><br><p>  Suppose for simplicity that the block hash is also a number from 0 to 9. </p><br><p>  That is, suppose we get a number from 0 to 9, depending on the hash of the block, or in other words we give the hash of the block to a number from 0 to 9. <br>  For example: </p><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">blockHashToNumberFrom0to9</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint blockNumber</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint</span></span></span><span class="hljs-function">)</span></span>{ uint random_number = uint(block.blockhash(blockNumber))%<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random_number; }</code> </pre> <br><p>  Suppose I am a miner with such computing power that every 5th block in the network is mine by me, i.e.  my chances are i'm going to mollify the next block 2/10. <br>  For example, one of the largest pools (see <a href="https://etherscan.io/stat/miner%3Frange%3D1%26blocktype%3Dblocks">https://etherscan.io/stat/miner?range=1&amp;blocktype=blocks</a> ), found a way for all pool members to agree on a total lotto rate, and try to influence the result.  In this case, of course, it is necessary to neglect the possible loss of income from mining. </p><br><p>  Let's say I made a bet, and I want to influence the result. </p><br><p>  If I just zamanyu block with a random hash, it does not affect the result, but suppose I, having calculated the first possible block, reject it, and the next blocks until I find the right one.  What are my chances that I will find two valid blocks with different hashes faster than the rest of the network will block the block (one) for this block number? </p><br><p>  My chances to find two blocks in a row: 2/10 * 2/10 = 4/100 </p><br><p>  What are the chances that my second unit will be exactly the one I need? </p><br><p>  We reason as follows: </p><br><p>  Chances that the same number will fall out 1/10 * 1/10 = 1/100 </p><br><p>  The chances that another number will fall out 1-1 / 100 = 99/100 </p><br><p>  Chances are that this number will turn out to be the one that is needed 99/100: 9 = 11/100 </p><br><p>  The chances that these events will coincide, that is, that I will find two blocks in a row before the rest of the network finds one and my second block will be the one I need: 4/100 * 11/100 = 44/10000 </p><br><p>  So, picking up the block myself, I increase my chances in the game by 44/10000: </p><br><p>  0.1 + 0.0044 = 0.1044 </p><br><p>  In other words, my chance of winning instead of 10% will be 10.44% </p><br><p>  Chances are that I will find the third valid block earlier than the rest of the network will find one and this block will turn out to be the one I need, etc.  are calculated in the same way: we add the odds in which the probability is displayed in fraction the numerator of which will be more by one, and the denominator is more by tens,  this will not increase the probability by more than 1/10000, in other words, when rounded to two decimal places, it will be the same number: ~ 10.44% <br>  For a player who mines every 10 blocks in the network: ~ 10.11% </p><br><p>  However, we proceeded from the fact that: "My chances are that I will find two valid blocks with different hashes faster than the rest of the network will block the block (one) for this block number? 2/10 * 2/10 = 4/100" This is the probability that in general, two blocks in a row will be found by this miner.  The likelihood that this will be done faster than the rest of the network will find one - even less. </p><br><p>  Accordingly, if the result is specified not by the hash of one block, but say by hashes of a certain number of consecutive blocks (say, we implement the 5 out of 36 lotto, where 36 two-digit digits are obtained from 72 consecutive blocks hashes), then the miner‚Äôs ability to influence the result is even less.  Thus, if we take hashes of several consecutive blocks as a source of randomness, the chances of a single miner to influence the result are so small that in most cases they can be ignored, even if we are talking about the cash prize (ETH). </p><br><p>  It would be interesting to have the opinion of the community how correct this argument is. </p><br><p>  UPD: <br>  It seems to me <a href="https://habrahabr.ru/post/345904/">an important point</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/345904/">https://habr.com/ru/post/345904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345892/index.html">MegaFon Big Data Challenge: big data against "deer", loneliness and much more</a></li>
<li><a href="../345894/index.html">Reiser4 code check with PVS-Studio static analyzer</a></li>
<li><a href="../345896/index.html">Flexible methodology for mobile development</a></li>
<li><a href="../345898/index.html">Dagger 2 for novice Android developers. Dagger 2. Advanced. Part 2</a></li>
<li><a href="../345900/index.html">Study of technical and social characteristics of mining pools</a></li>
<li><a href="../345906/index.html">Attribution using the Markov chain</a></li>
<li><a href="../345908/index.html">What to do on holidays: write robots for trading on the exchange in the scripting language TradeScript</a></li>
<li><a href="../345910/index.html">Securely sign Android builds from Jenkins</a></li>
<li><a href="../345912/index.html">Preparation for programming ESP8266 on micropython</a></li>
<li><a href="../345916/index.html">First-hand: how was the year on Habr√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>