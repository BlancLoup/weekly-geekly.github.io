<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kotlin aftertaste, part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last part, I talked about the Kotlin pitfalls, in this one I‚Äôll tell you what it outweighs. 

 I was asked several times, but what is so about ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kotlin aftertaste, part 2</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/331280/">last part,</a> I talked about the Kotlin pitfalls, in this one I‚Äôll tell you what it outweighs. <br><br>  I was asked several times, but what is so about Kotlin, which could lead to a transition from Java, what is its trick?  Yes, Kotlin introduced Null-safety and a large amount of syntactic sugar, covering some of the weak points of Java.  But this does not become a reason for the transition.  What could be?  New features and new philosophy. <br><br><img src="https://habrastorage.org/web/b80/fa8/129/b80fa81296f64d2c9e436c3e3c082e39.jpg"><br><a name="habracut"></a><br><h2>  New opportunities </h2><br><h3>  <a href="https://kotlinlang.org/docs/reference/null-safety.html">1. Null safety</a> </h3><br>  This is stated first.  This really makes the code more secure.  Yes, there is a problem when calling java.  It comes down to two options: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Calling third-party libraries.  It is treated either by explicitly declaring the type of variable to which the result is assigned, or by writing extension, which one often wants to do to straighten the call chain (an example will be at the end). </li><li>  Receiving a message from the outside world (REST, MQ, etc.).  Here comes Spring Validate. </li></ol><br><h3>  <a href="https://kotlinlang.ru/docs/reference/coroutines.html">2. Korutiny</a> </h3><br>  I myself have not used it yet, but apparently, this can greatly change the approach to multi-threaded programming.  UPD I corrected myself and wrote <a href="https://habrahabr.ru/post/339618/">an article about korutinah</a> . <br><br><h3>  <a href="https://kotlinlang.org/docs/tutorials/javascript/kotlin-to-javascript/kotlin-to-javascript.html">3. Compiling JavaScript</a> </h3><br>  Unfortunately, I have not tried it either.  At the time of the start of my project, it was only in beta, and I was not familiar with angular.  Now itching to try - a single module with DTO for the server and client side. <br><br><h2>  New philosophy </h2><br>  Kotlin's philosophy is <b>Concise</b> , <b>Safe</b> , <b>Interoperable</b> , <b>Tool-friendly</b> (from the official website and reports). <br><br><h3>  1. <b>Interoperable</b> </h3><br>  Java compatibility is truly 100% round-trip.  No matter what I did, everything worked fine. <br><br><h3>  2. <b>Tool-friendly</b> </h3><br>  I haven‚Äôt tried Eclipse, but Intellij is fine and continues to improve. <br><br><h3>  3. <b>Safe</b> </h3><br>  In my pragmatic view, this is the most important thing.  Concise, Interoperable, Tool-friendly are the minimum conditions for the survival of languages ‚Äã‚Äãon a JVM, otherwise they will lose Java. <br><br><h4>  Null-safety + mutability </h4><br>  For example, a local variable is a list of strings.  In java, the compiler knows only two options: <br><br><pre><code class="java hljs">List&lt;String&gt; list1; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;String&gt; list2;</code> </pre> <br>  The second option is found in isolated cases.  Usually, this is not the 8th Java, and this list is needed in an anonymous class. <br><br>  But Kotlin: <br><br><pre> <code class="hljs javascript">val list1: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt;? val list2: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt;? val list3: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; val list4: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt; val list5: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt;? val list6: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt;? val list7: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; val list8: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list9: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt;? <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list10: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt;? <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list11: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list12: List&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list13: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt;? <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list14: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt;? <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list15: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list16: MutableList&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>?&gt;</code> </pre><br>  What does this give?  Each type has its own guarantees and a set of operations allowed on it.  So, + = null can only be called on var list12: List &lt;String?&gt;, And add (null) on val list8: MutableList &lt;String?&gt; And var list16: MutableList &lt;String?&gt;. <br><br>  With each ad to write the full type will be expensive.  Therefore, there is a type inference: <br><br><pre> <code class="hljs scala"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> test = <span class="hljs-type"><span class="hljs-type">Random</span></span>().nextBoolean() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list1 = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (test) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> listOf(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list2 = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (test) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> listOf(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list3 = listOf(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list4 = listOf(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list5 = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (test) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> mutableListOf(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list6 = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (test) <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> mutableListOf(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list7 = mutableListOf(<span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list8 = mutableListOf(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list9 = list2?.filterNotNull() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list10 = list2 <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list11 = list2?.filterNotNull() ?: emptyList() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list12 = list2 ?: emptyList() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list13 = list2?.filterNotNull()?.toMutableList() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list14 = list2?.toMutableList() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list15 = list2?.filterNotNull()?.toMutableList() ?: mutableListOf() <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list16 = list2?.toMutableList() ?: mutableListOf()</code> </pre><br>  When you write code, do not want to declare the extra field as nullable, so that you don‚Äôt write later?  and?:, and most operations lead to immutable collections.  As a result, the code declares the narrowest states, which gives more stringent contracts and reduces the complexity of the program. <br><br><h4>  <b>Safe</b> support for other language features </h4><br><ol><li>  Naturally, you want to move away from the constructor without parameters and setters for the fields, since the constructor without parameters will create the non-compiled state of the object - null user login, for example. </li><li>  Language encourages the absence of local variables - there are no intermediate states. </li><li>  Cheaper DTO - <a href="https://kotlinlang.org/docs/reference/data-classes.html">data class</a> .  So we can weaken control over states when we transfer object in UI, without weakening contracts of model. </li><li>  Cheaper method overloading - <a href="https://kotlinlang.org/docs/reference/functions.html">the default settings</a> - there is no temptation to write a bunch of setters. <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Schedule</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">delay</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">delayTimeUnit</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TimeUnit</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TimeUnit</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SECONDS</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">? = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rateTimeUnit</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TimeUnit</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TimeUnit</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SECONDS</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">run</span></span></span><span class="hljs-class">: () -&gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unit</span></span></span><span class="hljs-class"> ) fun usage() { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Schedule(1)</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">println</span></span></span><span class="hljs-class">("</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Delay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">") } </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Schedule</span></span></span><span class="hljs-class">(100, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TimeUnit</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MILLISECONDS</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">println</span></span></span><span class="hljs-class">("</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Delay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> 100 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">milliseconds</span></span></span><span class="hljs-class">") } </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Schedule</span></span></span><span class="hljs-class">(1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rate</span></span></span><span class="hljs-class"> = 1) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">println</span></span></span><span class="hljs-class">("</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Delay</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">repeat</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">every</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">") } }</span></span></code> </pre><br></div></div></li></ol><br><h4>  What may appear </h4><br><ol><li>  Inline classes / Value classes.  Allows you to make wrapper classes around primitives, while compiling without this class.  It will be possible, for example, to make two types of lines: login and email, which will not be cast to each other.  Heard about it on jpoint. </li><li>  Truly immutable data.  Support at the level of syntax object variability.  The immutable object cannot contain references to non-immutable and somehow change them.  Took the third place in <a href="https://blog.jetbrains.com/kotlin/2017/06/kotlin-future-features-survey-results/">voting</a> for new language features. </li></ol><br><h3>  4. <b>Concise</b> (examples from my project, almost as is) </h3><br><h4>  There is no limit "one file - one class" </h4><br><div class="spoiler">  <b class="spoiler_title">Working with spring data looks like this for me (all in one file):</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Repository</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PayerRepository</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Payer, Int</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByApprenticeId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Payer&gt; } <span class="hljs-meta"><span class="hljs-meta">@Repository</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttendanceRepository</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">CrudRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">LessonAttendance, LessonAttendance.ID</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByDateBetween</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(from: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Date</span></span></span></span><span class="hljs-function"><span class="hljs-params">, to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Date</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;LessonAttendance&gt; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> AttendanceRepository.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">byMonth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(month: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Date</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;LessonAttendance&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> from = month.truncateToMonth() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> to = month.addMonths(<span class="hljs-number"><span class="hljs-number">1</span></span>).subtractDays(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> findByDateBetween(from, to) } <span class="hljs-comment"><span class="hljs-comment">// 10  inline fun &lt;reified T, ID: Serializable&gt; CrudRepository&lt;T, ID&gt;.find(id: ID): T { return findOne(id) ?: throw ObjectNotFound(id, T::class.qualifiedName) }</span></span></code> </pre><br></div></div><br><h4>  <a href="https://kotlinlang.org/docs/reference/extensions.html">Extensions.</a> </h4><br><div class="spoiler">  <b class="spoiler_title">We straighten the call to DateUtils</b> <div class="spoiler_text">  Kotlin <br><br><pre> <code class="hljs pgsql">fun isJournalBlocked(<span class="hljs-type"><span class="hljs-type">date</span></span>: <span class="hljs-type"><span class="hljs-type">Date</span></span>, forMonth: <span class="hljs-type"><span class="hljs-type">Date</span></span>) = forMonth &lt;= <span class="hljs-type"><span class="hljs-type">date</span></span>.subtractMonths(<span class="hljs-number"><span class="hljs-number">1</span></span>).subtractDays(<span class="hljs-number"><span class="hljs-number">10</span></span>) //   <span class="hljs-number"><span class="hljs-number">20</span></span>  fun <span class="hljs-type"><span class="hljs-type">Date</span></span>.subtractMonths(amount: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Date</span></span> = DateUtils.addMonths(this, -amount) //   <span class="hljs-number"><span class="hljs-number">8</span></span>  fun <span class="hljs-type"><span class="hljs-type">Date</span></span>.subtractDays(amount: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Date</span></span> = DateUtils.addDays(this, -amount)</code> </pre><br>  Java <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isJournalBlocked</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date date, Date forMonth)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date.compareTo(DateUtils.addDays(DateUtils.addMonths(forMonth, -<span class="hljs-number"><span class="hljs-number">1</span></span>), -<span class="hljs-number"><span class="hljs-number">1</span></span>)) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br>  It was necessary to store the sequence of changes of some parameters, for this I wrote the History interface for storing such a parameter and the extension SortedMap &lt;Date, out History&gt; to align the content after the changes: <br><br><div class="spoiler">  <b class="spoiler_title">Implementation</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">History</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">out T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> begin: Date <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> end: Date? <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">historyOf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: T <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">containsMonth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(date: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Date</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> month = date.truncateToMonth() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> begin &lt;= month &amp;&amp; (end == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || month &lt; end) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> SortedMap</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;Date, out History&lt;T&gt;</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { removeRepeatedNeighbors() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> navigableMap = TreeMap&lt;Date, History&lt;T&gt;&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) values.forEach { it.end = navigableMap.higherEntry(it.begin)?.value?.begin } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T&gt;</span></span></span><span class="hljs-function"> SortedMap</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;Date, out History&lt;T&gt;</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeRepeatedNeighbors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousHistory: T? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (history <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> values.toList()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (history.historyOf() == previousHistory) { remove(history.begin) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { previousHistory = history.historyOf() } } } <span class="hljs-comment"><span class="hljs-comment">//usage: fun setGroup(from: Date, group: ClassGroup) { val history = GroupHistory( this, group, from.truncateToMonth(), null ) groupsHistory[history.begin] = history groupsHistory.fix() this.group = groupsHistory.getValue(groupsHistory.lastKey()).group }</span></span></code> </pre><br></div></div><br><h4>  Collection operations </h4><br><div class="spoiler">  <b class="spoiler_title">Example 1</b> <div class="spoiler_text">  Kotlin <br><br><pre> <code class="hljs php">val apprentices: <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;ApprenticeDTO&gt; = apprenticeRepository.findAll() .map(::ApprenticeDTO) .sortedWith(compareBy({ it.lastName }, { it.firstName }))</code> </pre><br>  Java <br><br><pre> <code class="java hljs">List&lt;ApprenticeDTO&gt; apprentices = StreamSupport.stream( apprenticeRepository.findAll().spliterator(), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ).map(ApprenticeDTO::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>) .sorted(Comparator.comparing(ApprenticeDTO::getLastName) .thenComparing(Comparator.comparing(ApprenticeDTO::getFirstName))) .collect(Collectors.toList());</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Example 2</b> <div class="spoiler_text">  Kotlin <br><br><pre> <code class="hljs pgsql">val attendances: Map&lt;Pair&lt;<span class="hljs-type"><span class="hljs-type">Date</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>&gt;, <span class="hljs-type"><span class="hljs-type">Int</span></span>&gt; attendances = attendanceRepository .byMonth(month) .groupBy { it.date <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> it.<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>.id } .mapValues { it.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.count() } .toMap()</code> </pre><br>  Java <br><br><pre> <code class="java hljs">Map&lt;Pair&lt;Date, Integer&gt;, Integer&gt; attendances = attendanceRepository .byMonth(month) .stream() .collect(Collectors.groupingBy((it) -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pair&lt;&gt;(it.getDate(), it.getGroup().getId()))) .entrySet() .stream() .map(entry -&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Pair&lt;&gt;(entry.getKey(), entry.getValue().size())) .collect(Collectors.toMap(Pair::getFirst, Pair::getSecond));</code> </pre><br></div></div><br>  There are filterNot (more often you can use method reference), separate first and firstOrNull, etc ... And if something is missing, you add your extension (for example, I added a sum to the BigDecimal sheet). <br><br><h4>  <a href="https://kotlinlang.org/docs/reference/delegated-properties.html">Lazy</a> </h4><br>  When working with jsf, this is just a salvation.  Jsf often jerks the same field (and I go to the base for it), and in the case of a table with sorting, it expects to return exactly the same object as it did last time.  And most importantly, lazy is very easy to remove / insert. <br><br><h4>  <a href="https://kotlinlang.org/docs/reference/typecasts.html">Smart cast</a> + <a href="https://kotlinlang.org/docs/reference/sealed-classes.html">sealed class</a> </h4><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text">  Kotlin <br><br><pre> <code class="hljs kotlin"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rentForGroup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(month: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Date</span></span></span></span><span class="hljs-function"><span class="hljs-params">, group: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ClassGroup</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hall = group.hall <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hallRent = hall.rent(month) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (hallRent) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Monthly -&gt; hallRent.priceForMonth() / hall.groups(month).size <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> PercentOfRevenue -&gt; hallRent.priceForMonth(creditForGroup(month, group)) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Hourly -&gt; hallRent.priceForLessons(group.monthLessons(month)) } }</code> </pre><br>  Java <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rentForGroup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date month, ClassGroup group)</span></span></span><span class="hljs-function"> </span></span>{ Hall hall = group.getHall(); Rent hallRent = hall.rent(month); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hallRent <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Monthly) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((Monthly) hallRent).priceForMonth() / hall.groups(month).size(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hallRent <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> PercentOfRevenue) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((PercentOfRevenue) hallRent).priceForMonth(creditForGroup(month, group)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hallRent <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Hourly) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((Hourly) hallRent).priceForLessons(group.monthLessons(month)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsupportedOperationException(); } }</code> </pre><br></div></div><br><h4>  <a href="https://kotlinlang.org/docs/reference/inline-functions.html">Inline functions</a> </h4><br><div class="spoiler">  <b class="spoiler_title">In Java, this is simply impossible to do (unless you add an explicit parameter with a class).</b> <div class="spoiler_text"><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-type"><span class="hljs-keyword">reified</span></span></span></span><span class="hljs-function"><span class="hljs-type"> E : Throwable&gt;</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertFail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(expression: ()</span></span></span></span> -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Unit</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { expression() Assert.fail(<span class="hljs-string"><span class="hljs-string">"expression must fail with </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${E::class.qualifiedName}</span></span></span><span class="hljs-string">"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Throwable) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e !<span class="hljs-keyword"><span class="hljs-keyword">is</span></span> E) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e } } } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greenTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { assertFail&lt;ArrayIndexOutOfBoundsException&gt; { arrayOf(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)[<span class="hljs-number"><span class="hljs-number">3</span></span>] } }</code> </pre><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-type"><span class="hljs-keyword">reified</span></span></span></span><span class="hljs-function"><span class="hljs-type"> T, ID: Serializable&gt;</span></span></span><span class="hljs-function"> CrudRepository</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;T, ID&gt;</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">ID</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: T { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> findOne(id) ?: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> ObjectNotFound(id, T::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">qualifiedName</span></span></span><span class="hljs-class">) }</span></span></code> </pre><br></div></div><br><h4>  <a href="https://kotlinlang.org/docs/reference/basic-types.html">String literals.</a> </h4><br>  The difference is small, but the chances of being mistaken are much less, and you can copy-paste from Ineta without a headache. <br><br><div class="spoiler">  <b class="spoiler_title">regexp</b> <div class="spoiler_text">  Kotlin <br><br><pre> <code class="hljs python">val email = <span class="hljs-string"><span class="hljs-string">"""^([_A-Za-z0-9-+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,}))?$"""</span></span></code> </pre><br>  Java <br><br><pre> <code class="java hljs">String email = <span class="hljs-string"><span class="hljs-string">"^([_A-Za-z0-9-+]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,}))?$"</span></span></code> </pre><br></div></div><br>  In addition, very nice <a href="https://kotlinlang.org/docs/reference/basic-types.html">templates</a> . <br><br><h2>  Aftertaste </h2><br>  I have only one project at Kotlin, not counting small crafts.  So I can safely say one thing: Kotlin, Spring and the DDD elements support each other perfectly.  If you write on Kotlin as Java, you will feel only syntactic sugar (which is already nice), but if you abandon the classic bins, into which anyone can insert anything (which means there are practically no restrictions on states), then Kotlin will flourish. <br><br>  UPD <br>  <a href="https://habrahabr.ru/post/331280/">Kotlin aftertaste, part 1</a> <br>  <a href="https://habrahabr.ru/post/339618/">Aftertaste from Kotlin, part 3. Korutiny - we divide the processor time</a> </div><p>Source: <a href="https://habr.com/ru/post/337002/">https://habr.com/ru/post/337002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336988/index.html">Programming Contest: JSDash (Results)</a></li>
<li><a href="../336992/index.html">Mobile Applications Testing Cheat Sheet</a></li>
<li><a href="../336994/index.html">Getting rid of fragment state saving libraries using pure kotlin</a></li>
<li><a href="../336998/index.html">Fast rendering of ocean waves on mobile devices</a></li>
<li><a href="../337000/index.html">History of predictions of transitions from 1 500 000 BC. till 1995</a></li>
<li><a href="../337004/index.html">Andrei Ershov about the evolution of Future in Java and Scala on jug.msk.ru</a></li>
<li><a href="../337006/index.html">Microsoft Excel add-in development using Excel-DNA library</a></li>
<li><a href="../337008/index.html">Ansible Dynamic Inventory from DNS or how to waste time searching for standards</a></li>
<li><a href="../337010/index.html">Ideal OS: rebooting desktop operating systems (part 1)</a></li>
<li><a href="../337012/index.html">How to use multichannel support system in retail. Case Desk Client</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>