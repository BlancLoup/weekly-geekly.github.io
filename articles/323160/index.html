<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why do I need Refresh Token if there is Access Token?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, we at Voximplant improved authorization in the SDK. Looking at the results, I was somewhat saddened that instead of a simple and understanda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why do I need Refresh Token if there is Access Token?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/2aa/4b4/a8b/2aa4b4a8ba1c43b39a15a24f889184c9.jpg" align="left">  Recently, we at Voximplant improved authorization in the SDK.  Looking at the results, I was somewhat saddened that instead of a simple and understandable token there were two of them: access token and refresh token.  Not only do they have to be regularly updated, so they should also be documented and explained in the <a href="https://voximplant.com/blog/using-tokens-to-avoid-password-save/">training materials</a> .  Remembering that in <b>OAuth</b> two tokens are needed mainly because of the different services on which they are used (there is even a <a href="http://stackoverflow.com/questions/3487991/why-does-oauth-v2-have-both-access-and-refresh-tokens">stackoverflow</a> question), and we have one such service, I went a little bit wow and went to the second floor to shake the souls out of the developers.  The answer was unexpected.  It is not on stackoverflow.  But he is under the cut. <br><a name="habracut"></a><br><h2>  Why do we need tokens? </h2><br>  When developing applications that communicate with the server, the following steps usually come out: <br><img src="https://habrastorage.org/files/f79/ab0/126/f79ab01267d9490ea7901ca20008b725.png"><br><ol><li>  The application is developed by one developer, there is no identification, no authentication, no authorization (by the way, I recommend a great Habrastija on this topic from <a href="https://habrahabr.ru/company/dataart/blog/262817/">DataArt</a> ), requests go directly to the endpoints of the server, the developer is happy. <br><br></li><li>  A second developer, or tester, or customer appears.  It becomes important for the server to know who exactly is sending the request.  An identification step is added: a simple window ‚Äúintroduce yourself‚Äù before launching the application and shouts ‚Äúwho again went under three ones and broke everything?!?‚Äù <br><br></li><li>  When a team gets a little tired from ‚Äúwho came under three ones,‚Äù they will write a registration form with a login password on the backend, which will check for the uniqueness of the login.  In this form, the product will be developed before the first beta version. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  In the first beta version it turns out that storing the password in plain text on the device is somehow not very safe.  A spherical user in a vacuum has one password from most services, and really do not want to be extreme, through whom the user hacked email, contact and everything else.  Begin the search for a solution "to make it so that the password is not stored explicitly."  And after some time, the team comes to one or another option "auth token". </li></ol><br><h2>  Why do we need the first token </h2><br><img src="https://habrastorage.org/files/0bf/135/7db/0bf1357db54249bcb501c5c27ae9ec08.png" align="left">  There are many different tokens.  Ordinary, cryptographic, ‚Äúaccess key‚Äù, ‚Äúsession token‚Äù, different acquisition, use and revoke schemes.  At the same time, one of the key ideas is that if someone bad gets someone else's token, the most unpleasant thing that will happen is the access of the kidnapper to the service from which the token is stolen.  The thief will not receive the password, the one that is used for all services.  And the user, if he realizes that, besides him, someone else has access to the service, he can withdraw the token.  Then get yourself a new one, having a login and password. <br><br clear="all"><img src="https://habrastorage.org/files/f79/ab0/126/f79ab01267d9490ea7901ca20008b725.png"><br><h2>  Why do you need a second token </h2><br>  In OAuth 2 and some other authorization schemes (for example, <a href="https://voximplant.com/blog/using-tokens-to-avoid-password-save/">we</a> ) have not one, but two tokens.  The first, <b>access token</b> , is used when requesting the server (for example, when logging in).  He has two properties: he is reusable and short-lived.  Our, for example, lives 48 hours, and someone has 30 minutes.  Time is selected based on how the service is used.  The second, <b>refresh token</b> , is used to update a pair of access and refresh tokens.  It also has two properties opposite to the first token: it is disposable and long-lived.  Very long-lived, ours lives a month. <br><br>  The usage pattern for tokens is as follows: <br><img src="https://habrastorage.org/files/f79/ab0/126/f79ab01267d9490ea7901ca20008b725.png"><br><ul><li>  The user <a href="https://voximplant.com/docs/references/androidsdk/voximplantclient">logs</a> in to the application, passing the username and password to the server.  They are not stored on the device, and the server returns <a href="https://voximplant.com/docs/references/mobilesdk/android/com/zingaya/voximplant/VoxImplantCallback.LoginTokens.html">two tokens</a> and their lifetime </li><li>  The application saves tokens and uses <b>access token</b> for subsequent requests. </li><li>  When the <b>access token</b> lifetime comes to an end (the application can check the lifetime itself, or wait until the server uses the answer ‚Äúoh, everything‚Äù during the next use), the application <a href="https://voximplant.com/docs/references/androidsdk/voximplantclient">uses the</a> <b>refresh token</b> to refresh both tokens and continue using the new <b>access token</b> </li></ul><br>  Something like this is all explained in the OAuth documentation, on Wikipedia, in our documentation.  And such an explanation does not answer the question <b>what for?!?</b>  Why do we need two tokens, if you can do with one?  In the <a href="http://stackoverflow.com/questions/3487991/why-does-oauth-v2-have-both-access-and-refresh-tokens">question on stackoverflow,</a> several explanations of the level ‚Äúwell, access token can be stored less reliably than the refresh token and not be afraid to use outside HTTPS connections.  For example, store access token on the frontend, and refresh token on the backend ‚Äùor‚Äú refresh token is used to access a deliberately secure service, and then you can poke the access token into all sorts of suspicious places and not be afraid that it will be merged ‚Äù.  This may be reasonable for authorization through Facebook and subsequent use without HTTPS.  But we have HTTPS everywhere!  And we also have one service, ours.  Why <b>do we need a</b> second token? <br><br><h2>  Why <b>really</b> need a second token </h2><br><br><img src="https://habrastorage.org/files/f7a/d47/8e6/f7ad478e6567417dad30bdf7d67a92eb.png" align="right">  Everything turned out to be both simpler and more complicated than I thought.  Watch your hands: <br><br>  <b>Case 1: Bob recognized both Alice's tokens and did not use the refresh</b> <br><br>  In this case, Bob will get access to the service for a lifetime <b>access token</b> .  As soon as it expires, the application used by Alice will use the <b>refresh token</b> , the server will return a new pair of tokens, and those that Bob has learned will turn into a pumpkin. <br><br>  <b>Case 2: Bob recognized both Alice's tokens and took advantage of the refresh.</b> <br><br>  In this case, both Alice's tokens turn into a pumpkin, the application prompts her to log in with a login and password, the server returns a new pair of tokens, and those that Bob has learned will turn into a pumpkin again (there is a nuance with the device id that can return the same pair as in Bob. In this case, the following use of the refresh token will turn Bob's tokens into what is shown on the right). <br><br><img src="https://habrastorage.org/files/f14/107/c92/f14107c92e0343909b1c8e6a1de60fb7.png" align="left">  Thus, the refresh + access token scheme limits the time for which an attacker can access the service.  Compared with a single token that an attacker can use for weeks, and no one will know about it. </div><p>Source: <a href="https://habr.com/ru/post/323160/">https://habr.com/ru/post/323160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323148/index.html">ReactDoc - the first open source solution of the program "Common Frontal System"</a></li>
<li><a href="../323152/index.html">Some techniques of working in Bitrix on SQL and BASH</a></li>
<li><a href="../323154/index.html">Microservices: experience of use in a loaded project</a></li>
<li><a href="../323156/index.html">Interactive UX prototype: parsing on a real example</a></li>
<li><a href="../323158/index.html">RandLib. Library of probability distributions in C ++ 17</a></li>
<li><a href="../323162/index.html">Virtualization and Cloud Performance Testing</a></li>
<li><a href="../323164/index.html">Modern javascript or how to make your redux module ready for reuse</a></li>
<li><a href="../323168/index.html">How to write your own program for the controller ROBO TX</a></li>
<li><a href="../323170/index.html">How I set up new utilities for working with electronic signature in Linux</a></li>
<li><a href="../323172/index.html">Our servers and hacker attack on US Democrats: the continuation of the story</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>