<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We prepare WebP correctly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Habr is already saturated with articles on the subject of ‚Äúnew‚Äù image format of WebP ( description , comparison with JPEG2000 , comparison with BPG , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We prepare WebP correctly</h1><div class="post__text post__text-html js-mediator-article"><img src="https://./i/2016/2016-04-07.webp.png" alt="Webp" align="right" width="555" height="311">  Habr is already saturated with articles on the subject of ‚Äúnew‚Äù image format of WebP ( <a href="https://habrahabr.ru/company/io/blog/261651/">description</a> , <a href="https://habrahabr.ru/company/io/blog/258545/">comparison with JPEG2000</a> , <a href="https://habrahabr.ru/company/io/blog/261971/">comparison with BPG</a> , <a href="https://habrahabr.ru/post/275735/">usage</a> , <a href="https://habrahabr.ru/post/264491/">connection on the site</a> ).  Unfortunately, the following questions remain open: how to connect WebP correctly on the site so that ‚Äúeverything works‚Äù, and how much better (less) PNG / JPEG is.  In this post I will answer both questions. <br><br>  I assume that you are already aware of image optimization, know how to <a href="http://www.delphicdigital.com/blog/webp-smaller-web">convert images to WebP</a> , understand the difference between using JPEG and PNG on the site, know the tools of <a href="http://www.sno.phy.queensu.ca/~phil/exiftool/">ExifTool</a> , <a href="http://ruhighload.com/post/jpegtran">jpegtran</a> , <a href="https://github.com/mozilla/mozjpeg">mozjpeg</a> , <a href="https://github.com/kud/jpegrescan">JPEGrescan</a> , <a href="http://optipng.sourceforge.net/">optipng</a> , <a href="http://pmt.sourceforge.net/pngcrush/">pngcrush</a> , <a href="http://bjoern.hoehrmann.de/pngwolf/">pngwolf</a> , <a href="https://github.com/google/zopfli">zopflipng</a> and <a href="http://x128.ho.ua/pngutils.html">TruePNG</a> , and also distinguish pasteurization milk and <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25B7%25D0%25BE%25D0%25B3%25D0%25B5%25D0%25BB%25D0%25B8%25D1%258F">posterization of images</a> . <br><br>  If everything is so, then we get to the point. <br><a name="habracut"></a><br><h2>  Pros WebP </h2><br>  All sources mention a significant reduction in the size of images, which is PNG, that JPEG, if they are recoded into WebP.  In this case, transcoding should be performed with preservation of quality.  In <a href="https://xn--80aqc2a.xn--p1ai/">Airy.rf,</a> for three years now, automatic optimization of images without loss and with minor losses has been used (2 modes).  This allows you to quite accurately compare when WebP wins in comparison with the already optimized PNG (run through TruePNG, pngwolf and zopflipng) and JPEG (ExifTool, mozjpeg, translation to png), and when not. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On a test sample of 13,000 images, WebP showed a <strong>31% gain over already optimized PNG and JPEG files</strong> (580 MB vs. 837 MB).  WebP files are about a third smaller than the already optimized JPEG and PNG analogs.  Here you need to make a reservation that the PNG translation in WebP is lossless, and the JPEG translation is performed with minimal losses (quality 100), this allows you to automatically ship WebP for all browsers that understand it, without fear of something ‚Äú smash "at customers. <br><br>  In the overwhelming majority of cases, the WebP's gain over already optimized JPEGs (mozjpeg) was no more than 10%.  Exceptions were in those cases when it was impossible to safely cut out EXIF ‚Äã‚Äãdata (in particular, a palette) from JPEG files, and transferring them to WebP yielded significant gains.  Therefore, if you create JPEGs immediately in a ‚Äúnormal‚Äù scenario, then in most cases there will be no significant gain.  PNG files, even after optimization, are relatively good (30%) ‚Äúlose weight‚Äù if translated into WebP. <br><br>  More importantly, in relation to all optimized images only in 10% of cases (yes, a sample of 13000 images - it was only 10% of all optimized images) WebP "without loss" gave a gain in size.  <strong>For the remaining 90% there was no win</strong> (75% of them are JPEG files).  The numbers may still be due to a rigorous approach to optimizing lossless images: it is possible that fine-tuning WebP with ‚Äúsmall‚Äù quality losses will give visually ‚Äúthe same result‚Äù, but it will be smaller in size.  Unfortunately, in the automatic mode, it is impossible to estimate all 130 thousand images in order to understand how in each specific case lossy compression can be better.  The images themselves do not represent any patterns: they are background pictures and galleries of hundreds of sites. <br><br>  For reference, translating PNG to WebP <br><blockquote><pre>  cwebp -quiet -pass 10 -alpha_method 1 -alpha_filter best -m 6 -mt -lossless -q 100 </pre></blockquote><br>  JPEG to WebP translation <br><blockquote><pre>  cwebp -quiet -pass 10 -alpha_method 1 -alpha_filter best -m 6 -mt -q 100 </pre></blockquote><br>  An excellent illustration is the image to the article.  The original PNG occupied 15.6 Kb.  After optimization and posterization - 12.5 Kb.  lossless webp from it - 8 Kb. <br><br><h2>  Real WebP Usage </h2><br>  If you have already learned how to correctly convert or save images to WebP (the topic is for a separate article), then there remains the problem of connecting WebP to a site that has <a href="https://habrahabr.ru/post/264491/">already been raised here</a> (the game is worth the trouble, because Chrome browsers <a href="http://caniuse.com/">already account for more than 2/3 of the market</a> ).  On the browser side, options with JavaScript are possible (using the noscript tag, <a href="https://habrahabr.ru/users/ymatuhin/" class="user_link">ymatuhin</a> ): <br><br><blockquote><pre>  &lt;script async src = "simple-webp.min.js"&gt;
 &lt;noscript data-webp&gt;
	 &lt;img src = "example.png" alt = ""&gt;
 &lt;/ noscript&gt; </pre></blockquote><br>  And HTML5 (using picture, <a href="https://habrahabr.ru/users/pepelsbey/" class="user_link">pepelsbey</a> ): <br><br><blockquote><pre>  &lt;picture&gt;
	 &lt;source srcset = "opera.webp" type = "image / webp"&gt;
	 &lt;img src = "opera.jpg" alt = "The Oslo Opera House"&gt;
 &lt;/ picture&gt; </pre></blockquote><br>  The second option is generally safer (although it may cover fewer browsers). <br><br>  A ‚Äúbulletproof‚Äù server version is also possible, which reads the browser's <code>Accept</code> header and ships the corresponding image (all WebP images need to be saved with the .webp extension to their counterparts) to the browser that supports them (changes in the client code are not needed).  The easiest option for nginx looks like this: <br><br><blockquote><pre>  map $ http_accept $ x_airee_webp {
	 ~ * webp '.webp';
	 default '';
 }
 ...
 try_files $ uri $ x_airee_webp @ 404 </pre></blockquote><br>  More accurate options (with proper support for Vary and Cache-Control) are <a href="https://github.com/igrigorik/webp-detect/">maintained in the current state by Ilya Grigorik in the webp-detect project</a> (for all main web servers). <br><br><h2>  Thoughts for discussion </h2><br>  Summarizing the practical experience of using WebP: <strong>it makes sense to do it</strong> , especially for mobile browsers (you can ship images in ‚Äúpoor‚Äù quality for them and really win the page load time).  But first you need to configure the entire image optimization stack in ‚Äúnormal‚Äù ways: this will give a significant gain for all users.  After that, WebP support in your projects can be implemented literally ‚Äúin two clicks‚Äù (nginx configuration + conversion in the optimization process). <br><br>  Also, in my opinion, the use of WebP can "work wonders" when spot-optimizing some types of images (which JPEG and PNG do not cope well with) - for example, a large number of small details against large homogeneous areas.  And if you select the optimization parameters in the automatic mode for these types of images - it will be very cool. <br><br>  Considering ‚Äúdoubling‚Äù the size of the images on the disc, I consider them irrelevant: if you write WebP only in cases when the file is smaller and you optimize all the images, they will take up even less space.  And translating PNG images to WebP is significantly (at least an order of magnitude) less resource-intensive than PNG optimization (with an exhaustive search of compression options). <br><br>  I would be glad to see your thoughts and applied experience using images in WebP format. </div><p>Source: <a href="https://habr.com/ru/post/281124/">https://habr.com/ru/post/281124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281106/index.html">Transition to ReactiveCocoa v.4</a></li>
<li><a href="../281108/index.html">New Ubiquiti 4 Megapixel IP Camera Line - UniFi G3 Series</a></li>
<li><a href="../281110/index.html">ES5 JavaScript Guide</a></li>
<li><a href="../281112/index.html">Cybercontrol. How can Palantir catch snowdens?</a></li>
<li><a href="../281118/index.html">Dynamic ontology. How the Palantir engineers explain this to the CIA, the NSA and the military</a></li>
<li><a href="../281126/index.html">Breaking anatomy: Sony</a></li>
<li><a href="../281132/index.html">Webinar recording available: ‚ÄúWhat's new in Windows Server 2016‚Äù</a></li>
<li><a href="../281134/index.html">How ONLYOFFICE has reconciled two generations of Microsoft formulas</a></li>
<li><a href="../281136/index.html">Omsk! Welcome to the practical StudyJam for Android</a></li>
<li><a href="../281138/index.html">Bad package code for creating Toonz 2D animations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>