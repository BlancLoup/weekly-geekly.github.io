<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to security based on mandatory references (Capability-based security)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In most of today's operating systems, the security model is rooted in Unix, inheriting the assumption that the user can trust the programs that he run...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to security based on mandatory references (Capability-based security)</h1><div class="post__text post__text-html js-mediator-article">  In most of today's operating systems, the security model is rooted in Unix, inheriting the assumption that the user can trust the programs that he runs.  However, as practice shows, this statement is fundamentally wrong. <br><br>  Marc Stiegler <a href="http://www.skyhunter.com/marcs/capabilityIntro/authenticode.html">compares</a> this to the situation when you, hiring a cleaner, give him the Main And Single Key, which not only opens the room in which you need to do the cleaning, but opens all the doors, including  and a safe door with gold.  Those.  you have only two alternatives - either not to give this key to the cleaner - and then he will not be able to do his job, or to give and hope for his decency. <br><br>  The model of security based on mandatory references (capability-based security) offers a solution to this problem. <br><a name="habracut"></a><br>  The model is guided by the <a href="http://en.wikipedia.org/wiki/Principle_of_least_privilege">principle of minimum privileges</a> .  For example, by opening a file in a text editor, you give the editor only access to one specific file.  You still can not be sure that the program will edit the file as you expect it, but will not encrypt and require money for decryption - but the rates are now significantly lower. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      By default, any program (and ideally any piece of code) runs in the ideal sandbox ‚Äî it does not have access to the file system, the network, or other programs.  In some implementations, there is not even the right to allocate memory and consume processor resources! <br><br>  The program can go beyond the boundaries of the sandbox using a mandatory link (English capability, not to be confused with POSIX Capabilities) to external resources. <br><br>  To date, there is simply no Russian-language literature on this topic - so much so that in order to write this article, I had to invent a translation for the term ‚Äúcapability‚Äù myself.  So, get acquainted: <br><br>  A mandatory reference is a special form of reference that, firstly, identifies an object (and therefore a ‚Äúlink‚Äù), and secondly, defines operations that are valid on it (and therefore a ‚Äúmandatory‚Äù operation).  Mandatory references that refer to the same object, but specify different sets of valid operations, can coexist. <br><br>  The one who owns the mandatory reference can always perform any operations on the object that are allowed by this reference ‚Äî no additional checks are performed during the execution of operations.  All checks are done before the subject receives a mandatory reference - if he received it, this serves as proof that all checks by the subject have been passed. <br><br>  For comparison, the path to the file as a string identifies the object, but does not determine the operations allowed on it - therefore, every time an operation is performed on a file in the specified way, the OS must perform an access right check. <br><br>  On the other hand, an open file descriptor can be considered a mandatory reference.  The permission check is done before the descriptor is created, and the mode in which the file was opened is stored in the data structures associated with the descriptor. <br><br>  The terms ‚Äúresource‚Äù and ‚Äúsubject‚Äù can be found in the security literature based on mandatory references ( <a href="http://srl.cs.jhu.edu/pubs/SRL2003-02.pdf">PDF</a> ).  "Resource" is the role played by the object to which the mandatory reference points.  A ‚Äúsubject‚Äù is one who has a mandatory reference and can perform operations on a resource.  There is a many-to-many relationship between a subject and a resource: each subject can have an arbitrary number of mandatory references to different resources, an arbitrary number of subjects can refer to one resource. <br><br>  In <a href="http://www.cs.cornell.edu/slk/jkernel.html">some implementations,</a> ‚Äúsubject‚Äù and ‚Äúresource‚Äù are roles that the same objects can play depending on the context.  In <a href="http://citforum.ru/operating_systems/sos/glava_23.shtml">others</a> , these are heterogeneous objects, but a kind of resource is a channel of communication with another subject.  Anyway, objects can communicate with each other with the help of mandatory references - the object owning the link can send a message to the referenced object, as in the OOP.  In the future, for convenience of presentation, we will assume that objects are homogeneous ‚Äî  ‚ÄúSubject‚Äù and ‚Äúresource‚Äù are nothing more than situational roles. <br><br>  The model assumes that the internal state of objects is encapsulated and cannot be changed except by sending a message. <br><br><h2>  Mandatory links movement </h2><br>  An object can receive a mandatory link in a limited number of ways: <br><ol><li>  <b>As part of the initial conditions</b> ‚Äî during system initialization (for example, OS installation), some initial object graph is created, which is further developed according to the rules described here, but the initial graph can be created using cheat methods. </li><li>  <b>When creating a new object</b> , the operation of creating a new object returns a mandatory reference with the maximum amount of available permissions. </li><li>  <b>In a dowry</b> - by creating a child object, the parent can transfer to him a part of the powers available to him (pass in the arguments of the constructor in OOP terminology) </li><li>  <b>Through mutual friends</b> - if Alice does not have a link to Bob, then Carol can (if she wants!) Give her that link.  To do this, in OOP terminology, Carol sends a message to Alice, passing a reference to Bob as a parameter. <br>  This can only happen if Kerol has mandatory references to both Alice and Bob.  The link to Alice should allow the transfer of this message.  Carol cannot transfer authority to access Bob to a greater extent than she has (maybe to a lesser extent, but more on that later). </li></ol>  These rules allow us to represent the system under consideration as a graph of objects and formally analyze existing communication channels, as well as the places and conditions for the emergence of new connections. <br><br>  From the point of view of the model, a set of global variables (in any form, including the traditional file system) is a single object that is accessible to everyone.  The existence of such an object does not contradict the model, but is a hole in the security of the system.  The load of singletons and global access to the file system in the standard Java library has become a serious problem before the creators of the <a href="http://www.cs.cornell.edu/slk/jkernel.html">J-Kernel system</a> .  The same problems are present in the .NET platform. <br><br>  As you can see, the above rules describe how access rights can be distributed throughout the system, but do not describe how you can reduce previously granted rights.  Indeed, the security model based on mandatory references is based on the assumption that once granted rights cannot be selected.  This property is the reason for criticizing the model, but in fact is not a problem ( <a href="http://srl.cs.jhu.edu/pubs/SRL2003-02.pdf">PDF</a> ). <br><br>  Instead of giving the right to ‚Äúread the file,‚Äù the program is given the right to ‚Äúread the file until access has been withdrawn.‚Äù  This is implemented using proxy objects.  The following code illustrates this mechanism in a very simplified form: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">CapRevokeDemo</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  ,      interface IFile { char read(int index); int length { get; } } //  ,    interface IApplication { void openFile(IFile reader); } class FileAlreadyExistsException : Exception { } class FileNotFoundException : Exception { } class AccessRevokedException : Exception { } // ,       class FileManager { public FileManager() { files_ = new Dictionary&lt;string, IFile&gt;(); openedFiles_ = new Dictionary&lt;string,List&lt;FileProxy&gt;&gt;(); } public void addFile(string fileName, IFile reader) { if (files_.ContainsKey(fileName)) { throw new FileAlreadyExistsException(); } files_.Add(fileName, reader); } public void openFileInApplication(string fileName, IApplication app) { IFile reader; if(!files_.TryGetValue(fileName, out reader)) { throw new FileNotFoundException(); } FileProxy proxy = new FileProxy(reader); List&lt;FileProxy&gt; proxies; if(!openedFiles_.TryGetValue(fileName, out proxies)) { proxies = new List&lt;FileProxy&gt;(); openedFiles_.Add(fileName, proxies); } proxies.Add(proxy); app.openFile(proxy); } public void revokeAccessToFile(string fileName) { List&lt;FileProxy&gt; proxies; if(openedFiles_.TryGetValue(fileName, out proxies)) { foreach(FileProxy proxy in proxies) { proxy.revokeAccess(); } openedFiles_.Remove(fileName); } } // -,      . private class FileProxy : IFile { public FileProxy(IFile file) { file_ = file; } public char read(int index) { if(file_ == null) { throw new AccessRevokedException(); } return file_.read(index); } public int length { get { if(file_ == null) { throw new AccessRevokedException(); } return file_.length; } } public void revokeAccess() { file_ = null; } private IFile file_; } private Dictionary&lt;string, IFile&gt; files_; private Dictionary&lt;string, List&lt;FileProxy&gt; &gt; openedFiles_; } //   class Program { class DemoFile : IFile { public DemoFile(string data) { data_ = data; } public char read(int index) { return data_[index]; } public int length { get { return data_.Length; } } private string data_; } class DemoApp : IApplication { public void openFile(IFile file) { file_ = file; index_ = 0; } public void closeFile() { file_ = null; index_ = 0; } public void read() { char c = file_.read(index_++); System.Console.WriteLine("c = {0}", c); } private IFile file_ = null; private int index_ = 0; } public static void Main(string[] args) { try { FileManager manager = new FileManager(); manager.addFile("file", new DemoFile("SECRET")); DemoApp app = new DemoApp(); manager.openFileInApplication("file", app); app.read(); app.read(); app.read(); manager.revokeAccessToFile("file"); app.read(); } catch(Exception e) { System.Console.WriteLine("Exception: {0}", e.Message); } } } }</span></span></code> </pre> <br><br>  I want to note that from this approach it follows that the possibility of withdrawing access must be taken care of <b>in advance</b> .  If no measures were taken for this, then it is impossible to do this after the fact! <br><br>  Proxy objects can be used not only to limit access by time, but also by other parameters - you can provide access only to a piece of the file or, having read-write access, create a proxy object that allows read-only access.  Similarly, you can configure permissions that are specific to the subject area ‚Äî you can allow to leave comments in the document, but prohibit changing the contents of the document itself.  In traditional systems, these operations cannot be divided - at the OS level, they both look like a modification of a binary file. <br><br>  Proxy objects can be used recursively: one object delegates part of its rights to another, the second to the third, and so on.  At each step, only part of the rights is transferred, and the rest are cut off using proxy objects.  With each link, the amount of available privileges becomes less and less.  This is called <i>attenuation</i> of the access rights. <br><br><h2>  Counterfeit Security </h2><br>  Mandate reference must have an important property - security against forgery.  It should be impossible to ‚Äúguess‚Äù a mandatory reference that was not provided in accordance with the above rules. <br><br>  For descriptors, this property is incorrect within the framework of a single process: knowing the principle of generating descriptor codes, it is possible to generate the correct descriptor in reasonable time.  Those.  A plugin loaded into the host process can access data that could not be accessed via the host interface with the plugin. <br><br>  For file paths, this property is not satisfied in principle - it is enough to write in the code ‚ÄúC: \ Windows \ system32 \ drivers \ etc \ hosts‚Äù - and now, we already have a link to an important system file. <br><br>  How to protect mandatory references from fakes?  To ensure this <s>,</s> I know four basic approaches: <br><ol><li>  <b>Mandatory references as descriptors</b> - Subjects are processes.  All work with mandatory links is performed through the OS functions.  For each process, the OS keeps a list of mandatory references that are currently available to it.  A process can perform an operation on a capability link only if that link is in the corresponding list. </li><li>  <b>Cryptographic tools</b> - this approach does not give an absolute guarantee that it will be impossible to forge a link, but instead provides the necessary minimum complexity of a fake.  The program provides an encrypted credential reference to the OS functions, which verify its correctness and decrypt before use.  Due to the high overhead of encryption / decryption of mandatory references, this method is not used to implement security within the same machine, but is used in <a href="https://tahoe-lafs.org/trac/tahoe-lafs">network systems</a> . </li><li>  <b>Mandate links with passwords (English password-capabilities)</b> - a hybrid of the previous two methods (more <a href="http://c2.com/cgi/wiki%3FPasswordCapabilityModel">here</a> and <a href="http://dl.acm.org/citation.cfm%3Fid%3D545609">here</a> ).  The credential reference consists of authentication information and a password.  The password is a random sequence of bits generated by the system.  The probability of guessing a password is 2 <sup>-k</sup> , where k is the password length.  The system stores a dictionary associated password with identification information.  The mandatory reference is considered correct if the password in the mandatory reference matches the password in the dictionary. </li><li>  <b>Protection at the command / language level</b> ‚Äî the target machine's command system does not contain any commands at all that allow to interpret an arbitrary sequence of bits as a mandatory reference, or such commands are privileged and are available only to the kernel.  At the same time, the target machine can be either a real device ( <a href="http://en.wikipedia.org/wiki/System_250">Plessey System 250</a> , <a href="http://en.wikipedia.org/wiki/System/38">IBM System / 38</a> , RSRE FLEX Computer System) or a virtual machine (the <a href="http://www.cs.cornell.edu/slk/jkernel.html">J-Kernel</a> project is implemented on the basis of JVM) </li></ol><br><h2>  Serialization </h2><br>  For practical applicability, a system that implements security based on mandatory references must support serialization of the latter, and this is a very nontrivial task.  The system must ensure that the serialized image of the mandatory reference has not been tampered with, that the resource referred to by the link still exists, that the process performing deserialization is indeed a revival of the process that performed the serialization. <br><br>  The mechanism of <a href="http://c2.com/cgi/wiki%3FTransparentPersistence"><i>transparent</i> or <i>orthogonal persistence</i></a> proved to be an excellent solution to all these problems: the operating system takes all the care of preserving and restoring state to itself, and applications work with an abstract persistent single-level memory.  From time to time, the operating system saves a complete snapshot of the state of all processes to disk, and when loading it loads the last successfully saved version into memory.  Programs do not have direct disk access and cannot programmatically forge a serialized image on a disk. <br><br><h2>  Imprisonment </h2><br>  Suppose Alice wants to use a program created by Bob to process her data.  Bob wants no one else to have access to the insides of his program.  In addition, Bob may want to parameterize his program data.  This is a reason to provide Alice with a program not as an array of bytes with executable code, but as an object.  But Alice wants to be sure that this program will not transfer her confidential data to outsiders.  And objects can store links to other objects or have a changeable state that other objects can read, i.e.  the use of objects in this case is a danger to Alice‚Äôs safety. <br><br>  Imposing restrictions on an object passed to Alice that will make this object safe for Alice to use in this scenario is called object confinement. <br><br>  There is a <a href="http://www.erights.org/elib/capability/factory.html">patented solution</a> that allows to achieve imprisonment in the framework of the model described above.  However, as the authors of this solution themselves point out, a more elegant and simple solution will be the introduction of an attribute of transitive constancy, the correctness of which should be provided by the system.  This ensures that the program will simply have nowhere to write Alice's confidential data.  In this case, if Alice needs an object with a changeable state, then the object passed to it should be designed as a factory creating new objects from the data contained in the factory itself and the data provided by Alice. <br><br><h2>  Conclusion </h2><br>  The security model based on mandatory references allows you to securely interact with mutually suspicious components.  The model allows you to safely run a random code from an unknown source on your machine without fear of consequences - this is unthinkable for traditional systems.  The model can use any component of the system, with any privileges, while in traditional systems, to create new users and groups, administrative privileges are required. <br><br>  In my opinion, security based on mandatory references is most conveniently and elegantly implemented along with OOP, language-based security and orthogonal persistence.  I believe that the platform implementing all these concepts will write the next chapter in the OS evolution.  But so far, security based on mandatory references remains the lot of experimental operating systems.  I hope I managed to interest the reader in the idea of ‚Äã‚Äãmandatory references and thus bring the day when a similar project becomes a mass OS a bit closer. <br><br><h2>  References: </h2><br><ol><li>  <a href="http://www.skyhunter.com/marcs/capabilityIntro/index.html">Marc Stiegler et al.</a>  <a href="http://www.skyhunter.com/marcs/capabilityIntro/index.html">Introduction To Capability Based Security</a> </li><li>  <a href="http://www.cs.cornell.edu/slk/jkernel.html">J-Kernel</a> </li><li>  <a href="http://srl.cs.jhu.edu/pubs/SRL2003-02.pdf">Mark S. Miller et al.</a>  <a href="http://srl.cs.jhu.edu/pubs/SRL2003-02.pdf">Capability Myths Demolished [PDF]</a> </li><li>  <a href="http://citforum.ru/operating_systems/sos/glava_23.shtml">N. A. Olifer, W. G. Olifer.</a>  <a href="http://citforum.ru/operating_systems/sos/glava_23.shtml">Network operating systems.</a>  <a href="http://citforum.ru/operating_systems/sos/glava_23.shtml">Chapter 6. The Microkernel Mach</a> </li><li>  <a href="https://tahoe-lafs.org/trac/tahoe-lafs">Tahoe-lafs wiki</a> </li><li>  <a href="http://c2.com/cgi/wiki%3FPasswordCapabilityModel">Cunningham &amp; Cunningham, Inc.</a>  <a href="http://c2.com/cgi/wiki%3FPasswordCapabilityModel">wiki</a>  <a href="http://c2.com/cgi/wiki%3FPasswordCapabilityModel">Password Capability Model</a> </li><li>  <a href="http://dl.acm.org/citation.cfm%3Fid%3D545609">Ronald pose.</a>  <a href="http://dl.acm.org/citation.cfm%3Fid%3D545609">Password-capabilities:</a> </li><li>  <a href="http://www.cap-lore.com/CapTheory/ConfusedDeputy.html">Norm Hardy.</a>  <a href="http://www.cap-lore.com/CapTheory/ConfusedDeputy.html">The Confused Deputy (or why you might have been invented)</a> </li><li>  <a href="http://www.erights.org/elib/capability/factory.html">Mark S. Miller.</a>  <a href="http://www.erights.org/elib/capability/factory.html">The KeyKOS Factory</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/148743/">https://habr.com/ru/post/148743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148739/index.html">Overview of the gel printer Ricoh Aficio SG 3110 DNw</a></li>
<li><a href="../14874/index.html">Programming Language Verb</a></li>
<li><a href="../148740/index.html">President signs "law on black lists"</a></li>
<li><a href="../148741/index.html">Waterman Robot from School of Chemical Engineering and Technology</a></li>
<li><a href="../148742/index.html">The system of distribution of orders among the performers by the method of angels</a></li>
<li><a href="../148744/index.html">Leaflet 0.4 - a new version of the open JS-library for interactive maps</a></li>
<li><a href="../148745/index.html">How much is SDN?</a></li>
<li><a href="../148746/index.html">Android docking station Philips Fidelio or phone audio system</a></li>
<li><a href="../148749/index.html">Marissa Mayer started by making Yahoo free</a></li>
<li><a href="../14875/index.html">Cybersquatting in Asia is becoming more popular</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>