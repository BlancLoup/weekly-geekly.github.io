<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Temperature control in the house</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, ‚ÄúWeather Station with Ethernet and Tablet as a Display Device,‚Äù I talked about how I organized the collection, storage, proce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Temperature control in the house</h1><div class="post__text post__text-html js-mediator-article">  In the previous article, <a href="http://habrahabr.ru/post/213405/">‚ÄúWeather Station with Ethernet and Tablet as a Display Device,‚Äù</a> I talked about how I organized the collection, storage, processing and output of meteorological data in my home and beyond.  It was also mentioned there that the principles underlying the system allow building something wider than just collecting weather data, and an article about temperature control was announced.  It is time to fulfill the promise and tell about this very temperature control. <br><a name="habracut"></a><br><br><h4>  Introduction </h4><br>  Modern country house with independent heating usually implies the presence of a gas boiler.  In the most primitive version of the heating control is carried out in two ways: <br><ol><li>  For the task, so to speak, of the general thermophone in the house, the power that the boiler ‚Äúpumps‚Äù into the batteries is set.  Typically, the power adjustment is carried out in terms of the temperature of the water after the heating circuit. </li><li>  Since the rooms in the house are different (different windows, walls, sides of the world, etc.), they must also be heated in different ways.  In conditions when the heating circuit for the whole house is one, this goal is achieved by adjusting the water supply to the batteries themselves. </li></ol><br>  At the same time, modern boilers, as a rule, support external control.  The main purpose of this feature is to connect various kinds of thermostats, which allow to set the boiler power not in abstract degrees of water in batteries (the same water temperature figures can lead to completely different results depending on external conditions), but in terms of a much more understandable target temperature of the place where the regulator is installed.  ‚ÄúExternal control‚Äù can mean anything, but usually it is either some kind of proprietary protocol of a specific equipment manufacturer (as, for example, Bosch does), or one of the implementations of the OpenTherm protocol. <br>  The main problem of these thermostats for me is the price.  When the cost of the boiler is about 25,000 rubles, the regulator price of 9,000 rubles seems somewhat too high. <br>  As a result of bilateral consultations with the toad, an estimate was agreed upon, one and a half orders of magnitude lower than the cost of a typical commercial regulator, after which the development of options for the implementation of the homegrown regulator began. <br>  The following objectives were set for the regulator: <br><ol><li>  It must maintain the target temperature in the place whose temperature sensor is selected as the reference, with an accuracy of + -0.5 degrees </li><li>  It must allow the target temperature to be set. </li><li>  It should allow monitoring of the basic aspects of the regulator and the boiler itself. </li></ol><br><br><h4>  Opentherm </h4><br>  The study of building possibilities began with a study of the capabilities of the boiler in external control.  After removing the casing, a certain connector was found on which the jumper hung.  The study of the documentation for the boiler instilled hope that it is the very connector for external control.  Here we must mention the special zeal with which the Russian-language documentation was prepared for my Italian boiler Ferroli.  The documentation has a description of the connectors.  Opposite of me, the sacred inscription "Wednesday Unit" was listed.  Intuition insistently hinted that it was the work of translators who were unfamiliar with the subject area, we should look for English-language documentation (they should have been better translated into English).  After digging out PDFs with the English version of the boiler manual from the Internet, everything cleared up, opposite the same connector there was the text ‚ÄúRoom unit‚Äù.  There was also a ma-a-a-ah-ah icon, which with a certain amount of fantasy could be taken for the OpenTherm logo.  ‚ÄúThis is what you need‚Äù - I thought and began to plan atrocious experiments on the boiler (it was -25 outside the window, so it was time to burn the heater electronics). <br>  Here you need to make the necessary excursion into OpenTherm.  The protocol is not closed and not open.  Not closed because if you have a specification, no one will haunt you.  Not open because no one will give you a protocol specification.  Join the OpenTherm Alliance for $$$$$$$$, then get access to the body of the protocol.  Rummaging in the depths of the Internet, I got out the OT2.2 specification. <br>  On the physical layer, OpenTherm is two low-current open-voltage lines of the order of 42V.  The control device, being connected to them, can simultaneously feed and control the slave. <br>  The specification defines two protocol levels: OT / + and OT / Lite. <br>  The first is the protocol in the sense in which most people in IT understand this word.  Those.  it is a certain set of requests and responses that go between the control device (it‚Äôs the master unit, it‚Äôs the room unit, in our case, the controller) and the slave (it‚Äôs the slave unit, it‚Äôs the boiler).  The protocol is divided into the obligatory part, which includes the commands ‚Äúturn on / off the burner‚Äù, ‚Äúreport status‚Äù and ‚Äúset that water temperature after the heating circuit (the parameter is called setpoint)‚Äù.  In the optional - a bunch of others, ranging from controlling the modulation of the flame to the removal of gas flow, pressure and water velocity in the circuit.  In this case, the control device controls the voltage change in these lines, and the slave responds by changing the current. <br>  OT / Lite is a simpler thing.  If you are not smart enough to implement OT / +, you can simply generate a PWM signal, according to the duty cycle of which the boiler will control the setpoint setting. <br>  In addition, the specification also defines a test mode in which the lines are short-circuited.  In this mode, the boiler heats until it gets bored (read, until the upper bar of the water temperature is reached, which is installed on the boiler itself).  So the boiler works without an external regulator (so there was a jumper when opened there). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  OpenTherm, but not quite </h4><br>  Immediately dispel the intrigue and say that steer the boiler on OpenTherm did not work.  A pairing scheme was assembled and even a library was written that implements a fairly large part of OpenTherm, but the boiler stubbornly refused to be included in the OpenTherm control mode and did not respond.  More precisely, the microcontroller did not register anything as an answer.  Whether the boiler answered or not, it is impossible to say without an oscilloscope.  As soon as an understanding of this fact came, a USB oscilloscope was ordered (it‚Äôs also an eight-channel logic analyzer, a USB-blaster) for 40 evergreens (which, I have to say, is just a megavext!).  The oscilloscope, as it should be, had to go from China for an indefinite time and come somewhere in the spring, when the relevance of thermal control, hmm, is somewhat less than in winter.  Therefore, it was decided to use the same test feature of OpenTherm to control the boiler in order to at least see what the idea might be. <br><br><h4>  How to steer the boiler </h4><br>  Contemplation of the boiler during the long winter evenings led to the understanding that the logic of its operation is quite simple.  You set the temperature of the water (setpoint), say 55C.  It begins to warm up until the temperature reaches 60C.  It then turns off and on again when the water temperature reaches 50 ¬∞ C.  A sort of swing with hysteresis around the set value.  Having a "test feature", it is very easy to control the boiler using an external device so that it works exactly the same way as without it. <br>  Another consequence of the contemplation of the boiler - an understanding of what water temperature you need to put on it, depending on the temperature outside, so that the house plus or minus bast was comfortable. <br>  So, the boiler control consists of two algorithms: <br><ol><li>  Burner on-off algorithm depending on the desired setpoint and the current water temperature </li><li>  Algorithm for calculating setpoint based on available temperature data </li></ol><br>  Here it is necessary to make the necessary digression to the principle of operation of thermostats available on the market.  They come in two kinds: <br><ol><li>  Classic.  The principle of operation is colder than it should be - it is necessary to warm it, warmer - it is not necessary to warm it.  The second principle - if it is much colder, you need to be very warm. </li><li>  The so-called regulators c OTC (outdoor temperature compensation), i.e.  regulators with temperature compensation in the street.  These are crafted.  They allow the user to set the dependence of setpoint on the temperature outside.  Theoretically, they should steer the temperature in the house more carefully </li></ol><br>  Since I had data on the temperature both in the rooms and in the street, I could, in principle, realize the device with OTC.  In fact, both schemes were tested, and, confirmed by experiments, the second is more profitable. <br>  I want to remind you that as a result of the implementation of the weather station, weather data appeared on the air around my house.  The algorithm of the thermostat should be something like this: <br><ul><li>  Catch weather data from the air. </li><li>  To measure the temperature of the water in the heating circuit </li><li>  Based on the available data, calculate the target water temperature in the circuit </li><li>  Control the burner so as to maintain the target water temperature in the circuit </li></ul><br><h4>  Hardware </h4><br>  From the hardware it is required that it: <br><ol><li>  Received data from the air </li><li>  Allows you to set the target temperature in the house </li><li>  Displayed baseline indicators </li><li>  She was able to "short the line" control of the boiler </li><li>  Send data about your work and the work of the boiler back to the air, so that they can be caught by the central unit and then visualized </li></ol><br>  These requirements dictate the scheme. <br><img src="https://habrastorage.org/getpro/habr/post_images/50f/d90/4bb/50fd904bbd99621b8227c3c95fbca41e.png" alt="image"><br>  It is worth starting with the simplest part - part of the boiler control.  JP1 is the connector to which two boiler control lines are connected.  S1 is a toggle switch that short-circuits the control lines of the boiler and, thus, puts it into an autonomous mode (you never know what will happen to the controller).  Bridge D1-D4 is needed to ensure tolerance on the polarity of the connection to the boiler.  Optocoupler U1 acts as a relay and provides a galvanic isolation between the high-voltage line of the control of the boiler (remember, in the open state it is as much as 42V) and the TTL part of the circuit.  R2 is the limiting resistor needed to ensure that the current through the D5 pin (through which the control is performed) of the microcontroller is not too large.  In principle, this part could be replaced with low-current relays, but ... In the depths of the soul there is a hope that the boiler supports OT / + and will manage to manage it in a civilized way.  The real scheme of interfacing with the boiler is somewhat more complicated.  Here it is described only to the extent necessary to control the boiler in the closed / open mode. <br>  The temperature sensor DS18B20 is connected to pin 12 of the microcontroller.  A resistor R4 is connected between the DS18B20 data output and the power bus in accordance with the specifications. <br>  LCD screen based on the HD44780 controller - two lines of eight characters.  The classical connection scheme: Vcc - to the power bus, Vss - ground, the reference voltage for adjusting the contrast formed by the divider in the face of the building resistor R3 is applied to V0.  R3 can be tweaked once to taste and forget.  Conclusion R / W planted on the ground.  The remaining pins are connected as follows: RS-&gt; pins 11 of the controller, Enable -&gt; 10, DB4-&gt; 4, DB5-&gt; 7, DB6-&gt; 8, DB7-&gt; 9. <br>  The receiver is connected to pin 2, the transmitter to pin 3. <br>  A variable resistor forming the divider is connected to pin A0.  Based on the voltage at pin A0, the controller firmware will infer the target temperature in the house. <br><br><h4>  Software part </h4><br>  The algorithm works like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/621/e71/bcb/621e71bcb31eb80703956bb2c79bd6cb.png" alt="image"><br>  Basically, MK spends time waiting for messages on the air.  If the message did not arrive within the specified time, the algorithm still performs the main body (after all, during this time the temperature of the water in the circuit could change and perhaps it was time to turn the burner on or off). <br>  In parallel, the timer measures the voltage at A0, according to which the target temperature in the house is set.  Voltage 0 corresponds to a temperature of 18C, voltage Vcc corresponds to a temperature of 26C.  If the temperature changes, i.e.  the user is currently turning the knob, then the screen is updated, on which three parameters are always displayed: the target room temperature, the water temperature in the circuit, the target water temperature in the circuit at the current time. <br>  The target water temperature in the circuit is calculated by the following formula: <br>  Trrw = 20 + (Trr-To) + (Tr-Trr) * 30, where <br>  Trrw- target water temperature in the circuit <br>  Trr - target temperature in the house <br>  To - outside temperature <br>  Tr - the temperature in the house <br>  As you can see, there is some term of shift 20 (matched heuristically), the term OTC (Trr-To) which is greater, the greater the difference between the target temperature in the room and the temperature outside and the penalty for not reaching the target temperature in the room (Tr-Trr) * thirty. <br>  The implementation of the algorithm is rather trivial, you can understand it by looking at the sketch of the firmware. <br><div class="spoiler">  <b class="spoiler_title">Sketch</b> <div class="spoiler_text">  #include &lt;TimerTwo.h&gt; <br>  #include &lt;OneWire.h&gt; <br>  #include &lt;DallasTemperature.h&gt; <br>  #include &lt;VirtualWire.h&gt; <br>  #include &lt;EEPROM.h&gt; <br>  #include &lt;WirelessSensorPipe.h&gt; <br>  #include &lt;LiquidCrystal.h&gt; <br><br>  #define DEBUG <br>  #define INVALID_TEMPERATURE (1000) <br><br>  / * hardware configuration * / <br>  #define DSPIN 12 <br>  #define TRANSMITPIN 3 <br>  #define RECEIVEPIN 2 <br>  #define HEATERCONTROLPIN 5 <br>  #define TARGETTEMPCONTROLPIN A0 <br>  // LCD pin mapping <br>  #define LCDRS 11 <br>  #define LCDENABLE 10 <br>  #define LCDD4 4 <br>  #define LCDD5 7 <br>  #define LCDD6 8 <br>  #define LCDD7 9 <br><br>  #define RECEIVETIMEOUT 30 // wireless receive timeout <br><br>  bool heater_enabled = false; <br>  void enable_heater () <br>  { <br>  digitalWrite (HEATERCONTROLPIN, HIGH); <br>  heater_enabled = true; <br>  } <br><br>  void disable_heater () <br>  { <br>  digitalWrite (HEATERCONTROLPIN, LOW); <br>  heater_enabled = false; <br>  } <br><br>  float target_room_temperature, previous_target_room_temperature; <br>  / * reads target room temperature from the potentiometer and returns true if the value changed * / <br>  bool updateTargetRoomTemp () <br>  { <br>  uint16_t potentiometer_value = analogRead (TARGETTEMPCONTROLPIN); <br>  target_room_temperature = 22 + 4 / 1024.0 * potentiometer_value; <br>  if (fabs (target_room_temperature - previous_target_room_temperature) &lt;0.1) <br>  { <br>  return false; <br>  } <br>  previous_target_room_temperature = target_room_temperature; <br>  return true; <br>  } <br><br>  uint16_t cycle_counter = 0; <br>  void targetTempChangeChecker () <br>  { <br>  if (cycle_counter ++% 16 == 0) // max period of timer2 is 16ms, <br>  { <br>  if (updateTargetRoomTemp ()) <br>  updateOnScreenInfo (); <br>  } <br>  } <br><br>  #define OUTSIDE_SENSOR_ID 27327 <br>  #define ROOM_SENSOR_ID 13467 <br>  #define TEMPERATURE_HYSTERESIS 5 <br>  #define HEATER_MAX_TEMP 80 <br>  #define HEATER_MIN_TEMP 30 <br><br>  float room_temperature = INVALID_TEMPERATURE; <br>  float outside_temperature = INVALID_TEMPERATURE; <br>  float RW_temperature; <br>  float target_RW_temperature = 30; <br><br>  OneWire one_wire (DSPIN); <br>  DallasTemperature sensor (&amp; one_wire); <br>  void updateTargetRWTemperature () <br>  { <br>  sensor.requestTemperatures (); <br>  RW_temperature = sensor.getTempCByIndex (0); <br>  target_RW_temperature = 20 + (target_room_temperature - outside_temperature) + (target_room_temperature - room_temperature) * 30; <br>  target_RW_temperature = min (target_RW_temperature, HEATER_MAX_TEMP); <br>  target_RW_temperature = max (target_RW_temperature, HEATER_MIN_TEMP); <br>  } <br><br>  LiquidCrystal lcd (LCDRS, LCDENABLE, LCDD4, LCDD5, LCDD6, LCDD7); <br>  void updateOnScreenInfo () <br>  { <br>  char floatBuffer [7]; <br>  lcd.setCursor (0,0); <br>  lcd.print (F ("Room")); <br>  lcd.print (dtostrf (target_room_temperature, 2, 1, floatBuffer)); <br>  lcd.setCursor (0,1); <br>  lcd.print (F ("W")); <br>  lcd.print ((int) RW_temperature); <br>  lcd.print (F ("TW")); <br>  lcd.print ((int) target_RW_temperature); <br>  } <br><br>  WirelessSensorPipe pipe; <br>  void setup () <br>  { <br>  #ifdef DEBUG <br>  Serial.begin (9600); <br>  Serial.println (F ("Entered setup")); <br>  #endif <br>  pinMode (HEATERCONTROLPIN, OUTPUT); <br>  sensor.begin (); <br>  pipe.begin (TRANSMITPIN, RECEIVEPIN, 13); <br><br>  #ifdef DEBUG <br>  Serial.print (F ("Sensor id:")); <br>  Serial.println (pipe.id ()); <br>  #endif <br><br>  updateTargetRoomTemp (); <br>  updateTargetRWTemperature (); <br>  TimerTwo :: init (16384, targetTempChangeChecker); <br>  TimerTwo :: start (); <br><br>  lcd.begin (8, 2); <br>  } <br><br>  int current_transmission_phase = 0; <br>  void loop () <br>  { <br>  #ifdef DEBUG <br>  Serial.print (F ("Timestamp:")); <br>  Serial.println (millis () / 1000); <br><br>  Serial.print (F ("RW temperature:‚Äû)); <br>  Serial.println (RW_temperature); <br>  Serial.print (F (‚Äútarget_RW temperature:‚Äû)); <br>  Serial.println (target_RW_temperature); <br>  Serial.print (F (‚Äúoutside temperature:‚Äû)); <br>  Serial.println (outside_temperature); <br>  Serial.print (F (‚Äúroom temperature:‚Äû)); <br>  Serial.println (room_temperature); <br>  Serial.print (F (‚Äútarget room temperature:‚Äû)); <br>  Serial.println (target_room_temperature); <br><br>  // blink the LED to read <br>  // digitalWrite (13, HIGH); <br>  // delay (100); <br>  // digitalWrite (13, LOW); <br>  #endif <br>  updateTargetRoomTemp (); <br>  lcd.begin (8,2);  This is a temporary hack to get it off.  shall be removed. <br>  lcd.clear (); <br>  updateOnScreenInfo (); <br>  WirelessSensorPipe :: Packet packet; <br>  if (pipe.receive (packet, RECEIVETIMEOUT * 1000)) <br>  { <br>  if (packet.type == WirelessSensorPipe :: TEMPERATURE) <br>  { <br>  switch (packet.id) <br>  { <br>  case OUTSIDE_SENSOR_ID: <br>  outside_temperature = packet.value; <br>  break; <br>  case ROOM_SENSOR_ID: <br>  room_temperature = packet.value; <br>  break; <br>  } <br>  } <br>  return;  // we‚Äôre skipping the code.  If there is no one transmits <br>  } <br>  updateTargetRWTemperature (); <br>  if (RW_temperature&gt; = target_RW_temperature + TEMPERATURE_HYSTERESIS &amp;&amp; target_RW_temperature &lt;HEATER_MAX_TEMP) <br>  { <br>  disable_heater (); <br>  } <br>  if (RW_temperature &lt;= target_RW_temperature - TEMPERATURE_HYSTERESIS &amp;&amp; target_RW_temperature&gt; HEATER_MIN_TEMP) <br>  { <br>  enable_heater (); <br>  } <br><br>  switch (current_transmission_phase ++) <br>  { <br>  case 0: <br>  pipe.send (WirelessSensorPipe :: TEMPERATURE, room_temperature); <br>  break; <br>  case 1: <br>  pipe.send (WirelessSensorPipe :: HEATERSETPOINT, target_RW_temperature); <br>  break; <br>  case 2: <br>  pipe.send (WirelessSensorPipe :: HEATERRWTEMPERATURE, RW_temperature); <br>  break; <br>  case 3: <br>  pipe.send (WirelessSensorPipe :: HEATERTARGETROOMTEMPERATURE, target_room_temperature); <br>  break; <br>  case 4: <br>  pipe.send (WirelessSensorPipe :: HEATERFLAMEENABLED, heater_enabled); <br>  current_transmission_phase = 0; <br>  break; <br>  } <br>  } <br></div></div><br>  It is necessary to mention that the work with the screen brought the most problems.  Children's sores, like improper connection and initialization will not describe, but the problems associated with careless use of the timer, you can mention.  The fact is that the first timer implementations read A0, calculated the temperature, and unconditionally updated the screen.  The refresh rate was quite high - 2 Hz, and the screen refresh procedure is quite long.  This led to the fact that the main loop of the algorithm (which it spends most of the time trying to receive something from the air) was often and permanently interrupted by the timer handler.  This led to the fact that the software part of the receiver could not receive anything from the air, as it missed a lot during the distraction of the timer handler for execution.  In addition, the screen is occasionally crazy and needs to be reinitialized in order to bring it to life.  What is the reason for this behavior, I do not understand <br>  The second problem I encountered was that the first place where the controller was installed turned out to be a place of brutal radio shadow. <br>  These two problems have taken away from me a decent amount of evenings in trying to understand why the controller does not accept anything.  The most opposite thing is that eliminating any of them did not improve the situation, it was necessary to solve both of them at the same time, so for a long time I was in error of the type ‚Äúradio shadow is nothing to do with it‚Äù and ‚Äúeverything is fine with the receiving part‚Äù. <br>  Another very bad idea was the transfer of all monitored parameters en masse to the airwaves at each iteration of the algorithm.  The transmitted parameters include: room temperature, outdoor temperature (just repeat for control purposes), set target house temperature, calculated target water temperature, current water temperature, whether the boiler control circuit is closed or not.  Since the execution of one iteration of the algorithm takes about 30 seconds, twice a minute a lot of packets were being broadcast on the air, which increased the probability of collisions.  Therefore, we had to modify the firmware so that it sent only one parameter on the air in one iteration.  Thus, each parameter was updated every 3 minutes. <br><br><h4>  Part list </h4><br>  <a href="http://www.ebay.com/itm/310568454961">Arduino Pro Mini</a> - 100 rub apiece <br>  <a href="http://www.ebay.com/itm/310675487224">DS18B20</a> - 34 rub apiece <br>  <a href="http://www.ebay.com/itm/400492821250">Transmitter + 433MHz receiver</a> - 40 rub apiece <br>  <a href="http://chip-nn.ru/72.php">LCD WH0802A-NGG-CT</a> - 125 rub apiece <br>  <a href="http://chip-nn.ru/68.php">4N35</a> - 9 rub apiece <br>  <a href="http://chip-nn.ru/47.php">Diode Bridge DB107</a> - 5.5 rubles apiece <br>  Resistors - only 5 rubles <br>  Toggle switch (purchased offline) - 20 rubles <br>  <a href="http://chip-nn.ru/82.php">Building KR-606-PS</a> - 40 rubles <br>  The result - taking into account the solder, the breadboard, the wires and the amortization of the soldering iron - about 450 rubles.  If I had ordered an LCD on Ebay, it would have been another 80 rubles cheaper. <br><br><h4>  Testing, conclusions, plans </h4><br>  Photos of the controller and the boiler under the spoiler.  I apologize for the unevenly cut out window under the LCD. <br><div class="spoiler">  <b class="spoiler_title">A photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/735/fc2/b01/735fc2b01028ca4ef750e247a704c47f.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/cfa/e27/d20/cfae27d20a91b63629f7c6371cd8cc75.jpg" alt="image"><br></div></div><br>  But the DS18B20 is bolted to the boiler outlet <br><div class="spoiler">  <b class="spoiler_title">A photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/48b/be6/6c3/48bbe66c3143311cf5ed03bccdca26c0.jpg" alt="image"><br></div></div><br>  Photo of how the "control panel" looks on the same Strike. <br><div class="spoiler">  <b class="spoiler_title">A photo</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/267/89c/272/26789c27281ca765c91c4c24400ac81c.jpg" alt="image"><br></div></div><br>  As I said, two control schemes were implemented - the classical, i.e.  ‚ÄúNot hot enough?  Fry! ‚Äù, And with compensation for outdoor temperature. <br>  In principle, the first one satisfied the requirements initially imposed on the system of statistics, i.e.  provided the temperature in the room within half a degree from the target value.  However, the disadvantage was oscillations around this very target value with an amplitude of almost half a degree.  Those.  the temperature in the room oscillated around the target, and this oscillation clearly could not be caused by external factors, since they were stable. <br>  But the introduction of OTC gave an unexpected good result.  Work on the algorithm in accordance with the formula above stabilized the temperature in the range of -0.2 + 0.1 degrees from the target.  It should be noted that the dips of 0.2 degrees are not even connected with the features of the thermal control process, but with the fact that when someone opens hot water (for example, half an hour to wash) the boiler is engaged in providing hot water in the hot water circuit.  The heating circuit is not heated. <br><img src="https://habrastorage.org/getpro/habr/post_images/1ff/123/2fb/1ff1232fb4a9451cdc1ef6da0706a97d.png" alt="image"><br>  The controller in this mode has been operating for half a month, the flight is normal, there were no failures.  I can say that temperature control decently increases psychological comfort.  If earlier it was necessary at least every evening and morning to set the water temperature in accordance with the current temperature on the street, the forecast and the testimony of our own intuition, which required some effort, now we don‚Äôt even remember that we have a boiler ‚Äî it works and works. <br>  The plans were to dog OT / +, the benefit of the ordered oscilloscope came, I already found out with his help that I even sent the wrong direction to the boiler I generally keep silent.  In principle, the thermostat does not improve the work, but will allow you to shoot more diagnostics.  In addition, it is now a fundamental problem from the category of "who is who." </div><p>Source: <a href="https://habr.com/ru/post/214257/">https://habr.com/ru/post/214257/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214247/index.html">How the world's largest startup accelerator works</a></li>
<li><a href="../214249/index.html">The draft law on the restriction of Internet payments adopted in first reading</a></li>
<li><a href="../214251/index.html">Visiting hot Finnish guys, or what is the secret to the success of Finnish design?</a></li>
<li><a href="../214253/index.html">Conference ProfsoUX-2013 - review-classification + video</a></li>
<li><a href="../214255/index.html">Gentoo: configuring and connecting via / dev / loop filesystem with compression using Reiser4 as an example</a></li>
<li><a href="../214259/index.html">Notifications of endings of fabric tasks, with decorators and detailed information</a></li>
<li><a href="../214261/index.html">Dragon for MSI</a></li>
<li><a href="../214263/index.html">Send an application to the State Duma regarding the "" anti "terrorist" package of bills</a></li>
<li><a href="../214267/index.html">Imo.im messenger disables all protocols.</a></li>
<li><a href="../214269/index.html">European Commission: ‚ÄúFritupley? Then no in-app purchases! ‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>