<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with binary data using typed arrays</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="HTML5 brings new UX APIs to web development, extending new multimedia capabilities and real-time interoperability. Often this functionality is tied to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with binary data using typed arrays</h1><div class="post__text post__text-html js-mediator-article">  HTML5 brings new UX APIs to web development, extending new multimedia capabilities and real-time interoperability.  Often this functionality is tied to the use of binary file formats like MP3-audio, PNG-images <br>  or MP4 video.  The use of binary files is extremely important in this context, as it allows to reduce the requirements for the width of the channel, to achieve the necessary performance and at the same time remain compatible with the existing technologies.  Recently, web developers did not have direct access to the contents of these binary files or any other binary file formats. <br><br>  In this article, we will look at how web developers can remove this barrier using <br>  <a href="http://wiki.ecmascript.org/doku.php%3Fid%3Dstrawman:typed_arrays">Typed Arrays API</a> for JavaScript, and using the new API in the <a href="http://ie.microsoft.com/testdrive/HTML5/TypedArrays/">Binary File Inspector</a> demo on <a href="http://ietestdrive.com/">IE Test Drive</a> . <br><a name="habracut"></a><br>  The typed arrays available in the IE10 Platform Preview 4 allow web applications to work with a wide range of binary files and directly work with the binary content of the files supported by the browser.  Typed Arrays support has been added throughout IE10: in JavaScript, in XMLHttpRequest, in the File API and in the Stream API. <br><br><h2>  Binary File Inspector </h2><br>  The <a href="http://ie.microsoft.com/testdrive/HTML5/TypedArrays/">Binary File Inspector</a> example shows some of the new features that work with the combination of these functions.  You can view ID3 headers of music files, understand how raw data looks in video files, and also look at files of other formats like PCX images that can be supported. <br>  browser using javascript and canvas. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/661/360/a51/661360a51f46461ca4d93438ac603af0.png" alt="Binary File Inspector"><br><br>  In the example above, .mp4-video is rendered using the &lt;video&gt; element on the left, and the binary content of the file is displayed on the right in hexadecimal (HEX) format and as the corresponding ASCII characters.  In this example, you can see several MPEG-specific elements like ‚Äúftyp‚Äù for ‚Äúmp4‚Äù. <br><br><h2>  Typed Arrays and ArrayBuffers </h2><br>  Typed arrays provide an opportunity to look at raw binary contents through a particular typed representation.  For example, if we want to look at a binary data stream as a byte array, we can use Uint8Array (Uint8 describes an 8-bit unsigned integer, usually called a byte).  If we want to read raw data as an array of floating-point numbers, we can use Float32Array (Float32 describes a 32-bit floating-point number in accordance with the IEE754 standard).  The following types are supported: <br><table><tbody><tr><td>  <b>Array type</b> </td><td>  <b>Item size and description</b> </td></tr><tr><td>  Int8Array </td><td>  8-bit signed integer </td></tr><tr><td>  Uint8Array </td><td>  8-bit unsigned integer </td></tr><tr><td>  Int16Array </td><td>  16-bit signed integer </td></tr><tr><td>  Wint16array </td><td>  16-bit unsigned integer </td></tr><tr><td>  Int32array </td><td>  32-bit signed integer </td></tr><tr><td>  Uint32Array </td><td>  32-bit unsigned integer </td></tr><tr><td>  Float32rray </td><td>  32-bit IEEE754 floating point number </td></tr><tr><td>  Float64arry </td><td>  64-bit IEEE754 floating point number </td></tr></tbody></table><br>  Each type of array is a representation for an ArrayBuffer.  ArrayBuffer is a link to a binary data stream, but it does not represent any direct way to interact with data.  Creating TypedArray views for an ArrayBuffer provides access to read and write binary content. <br><br><br>  The example below creates a new ArrayBuffer from scratch and interprets its contents in various ways: <br><pre><code class="hljs pgsql">// <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> an <span class="hljs-number"><span class="hljs-number">8</span></span> byte buffer var buffer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ArrayBuffer(<span class="hljs-number"><span class="hljs-number">8</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> an <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Uint8s <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> put <span class="hljs-number"><span class="hljs-number">0x05</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> byte var uint8s = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Uint8Array(buffer); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (var i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">8</span></span>; i++) { uint8s[i] = <span class="hljs-number"><span class="hljs-number">5</span></span>; // fill <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> byte <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">0x05</span></span> } // Inspect the resulting <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> uint8s[<span class="hljs-number"><span class="hljs-number">0</span></span>] === <span class="hljs-number"><span class="hljs-number">5</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> byte has <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> uint8s.byteLength === <span class="hljs-number"><span class="hljs-number">8</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> - there are <span class="hljs-number"><span class="hljs-number">8</span></span> Uint8s // <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> the same buffer <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> an <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Uint32s var uint32s = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Uint32Array(buffer); // The same raw bytes are now interpreted differently uint32s[<span class="hljs-number"><span class="hljs-number">0</span></span>] === <span class="hljs-number"><span class="hljs-number">84215045</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> - <span class="hljs-number"><span class="hljs-number">0x05050505</span></span> == <span class="hljs-number"><span class="hljs-number">84215045</span></span></code> </pre> <br><br>  Thus, typed arrays can be used for such tasks as creating floating-point values ‚Äã‚Äãfrom their by-byte components of building data structures that require specific data composition, based on efficiency and compatibility considerations. <br><br><h2>  Typed Arrays for reading binary files </h2><br>  An important new script made possible by typed arrays is reading and displaying the contents of binary files that are not directly supported by the browser.  Together with the various typed arrays described above, Typed Arrays also provides a special DataView object that can be used to read and write the contents of an ArrayBuffer in an unstructured form.  This is well suited for reading new file formats that are usually built on top of mixed data types. <br><br>  Binary File Inspector uses DataView to read <a href="http://en.wikipedia.org/wiki/PCX">PCX</a> files and render them using a &lt;canvas&gt; element.  Below is a simplified version of what is being done in the demo to read the file header, including getting information about the width and height, DPI and color depth (bits-per-pixel). <br><br><pre> <code class="hljs pgsql">var buffer = getPCXFileContents(); var reader = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DataView(buffer); // <span class="hljs-keyword"><span class="hljs-keyword">Read</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the PCX file var <span class="hljs-keyword"><span class="hljs-keyword">header</span></span> = {}; // The first section <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> single bytes <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.manufacturer = reader.getUint8(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.version = reader.getUint8(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.encoding = reader.getUint8(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.bitsPerPixel = reader.getUint8(<span class="hljs-number"><span class="hljs-number">3</span></span>); // The next section <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Int16 <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> little-endian <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.xmin = reader.getInt16(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.ymin = reader.getInt16(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.xmax = reader.getInt16(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.ymax = reader.getInt16(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.hdpi = reader.getInt16(<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">header</span></span>.vdpi = reader.getInt16(<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br><br>  A code similar to the one above can be used to add support for rendering in the browser a wide range of new file types, including native image formats, additional video file formats, and data formats specific to a particular area. <br><br><h2>  Getting binary data through XHR and File API </h2><br>  Before we can use the Typed Arrays API to work with the contents of the files, we need to use the appropriate browser APIs to gain access to the raw data.  For access to files from the server, the XMLHttpRequest API has been expanded with the addition of support for various types of response (responseType).  So the answer in the form of ‚Äúarraybuffer‚Äù represents the contents of the resource requested from the server, in the form of an ArrayBuffer object for JavaScript.  Blob, text, and document responses are also supported. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> getServerFileToArrayBufffer(url, successCallback) { // <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> an XHR <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> var xhr = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XMLHttpRequest(); xhr.onreadystatechange = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr.readyState == xhr.DONE) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr.status == <span class="hljs-number"><span class="hljs-number">200</span></span> &amp;&amp; xhr.response) { // The <span class="hljs-string"><span class="hljs-string">'response'</span></span> property <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> an ArrayBuffer successCallback(xhr.response); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { alert("Failed to download:" + xhr.status + " " + xhr.statusText); } } } // <span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> the request <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the provided url xhr.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>("GET", url, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); // <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> the responseType <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'arraybuffer'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ArrayBuffer response xhr.responseType = "arraybuffer"; xhr.send(); }</code> </pre> <br>  In many cases, files can be selected by the user, for example, as an attachment to an email in a web client for mail.  The File API provides web developers with the ability to read the contents of files specified via the &lt;input&gt; element, when dragging or dragging or from another source (Blob, File).  To read the contents of a file in ArrayBuffer, a FileReader object is used and, like an XHR object, it is used asynchronously to make sure that reading from disk does not block the user interface. <br><br><pre> <code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readFileToArrayBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file, successCallback)</span></span></span></span> { // Create a FileReader var reader = new FileReader(); // Register <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'load'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-string"><span class="hljs-string">'error'</span></span> events reader.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { // The <span class="hljs-string"><span class="hljs-string">'result'</span></span> property returns an ArrayBuffer <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> readAsArrayBuffer var buffer = reader.result; successCallback(buffer); } reader.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(evt)</span></span></span></span> { // The <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> code indicates the reason <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> failure <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (evt.target.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.code == evt.target.<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>.NOT_READABLE_ERR) { alert(<span class="hljs-string"><span class="hljs-string">"Failed to read file: "</span></span> + file.name); } } // Begin a <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> of the file contents into an ArrayBuffer reader.readAsArrayBuffer(file); }</code> </pre> <br><br><h2>  Conclusion </h2><br>  Binary data is actively used by web browsers.  With the addition of support for Typed Arrays, XHR2 and File API in IE10, web applications can now also directly work with binary data, manipulate data at the byte-byte level, display additional binary data formats and extract additional data from existing media formats.  Try the <a href="http://ie.microsoft.com/testdrive/HTML5/TypedArrays/">Binary File Inspector</a> example on <a href="http://ietestdrive.com/">IE Test Drive</a> , and the Typed Arrays implementation in IE10. </div><p>Source: <a href="https://habr.com/ru/post/133998/">https://habr.com/ru/post/133998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133992/index.html">Droider Show # 18. "Apple" is not passed!</a></li>
<li><a href="../133993/index.html">Filling Bitrix through internal integration mechanisms with 1C without 1C</a></li>
<li><a href="../133994/index.html">Creating a PostgreSQL Load Tester</a></li>
<li><a href="../133996/index.html">And again about sorting: choose the best algorithm</a></li>
<li><a href="../133997/index.html">TES 5: Skyrim song bard</a></li>
<li><a href="../133999/index.html">Wanted.VC Digest # 24</a></li>
<li><a href="../134000/index.html">Tablets in the office: a change of mood in the headquarters of the CIO</a></li>
<li><a href="../134001/index.html">FINANCE.UA: our financial ports and information services</a></li>
<li><a href="../134002/index.html">New HP DL980 Servers</a></li>
<li><a href="../134003/index.html">Google developer dispels "full hardware acceleration" myths in Ice Cream Sandwich</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>