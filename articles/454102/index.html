<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using a random oracle on the example of the lottery</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One morning, I came across an article about a checked random number generator on the Waves platform blockchain. 

 The overall picture was clear, but ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using a random oracle on the example of the lottery</h1><div class="post__text post__text-html js-mediator-article">  One morning, I came across an article about a <a href="https://habr.com/ru/post/449340/">checked random number generator</a> on the Waves platform blockchain. <br><br>  The overall picture was clear, but the method of concrete implementation was not.  Some codes, signatures, what, where, why? <br><br>  Several consultations with the author of the oracle, as a result, it turned out to combine the logic of the draw (implemented in PHP) with the algorithm for obtaining a random number. <br><a name="habracut"></a><br><ol><li>  At the time of the start of the tournament / round, we request the first part of the code (R-code) from the oracle. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At this moment, there is no information about the number of players, nor about the number of prizes, nor about the size of the prize payouts and in general about the existence of the lottery.  The oracle, through a transaction, issues a personal random code, which can later be used only once and only to those who have requested it.  By the way, R-code can be ‚Äúpurchased‚Äù (meaning the cost of a request transaction + compensation to an oracle for a response transaction, this is an amount of about $ 0.015 at the current rate, the code itself is issued free of charge) in advance at once, so as not to wait for the receipt of a response transaction.  I made a small regularly updated buffer in the database. </li><li>  The tournament lasts a standard 60 blocks of the blockchain Waves platform, at the moment it is about 1 hour.  The tournament is considered to be held and closed, if after 60 blocks there will be at least two tickets in it, otherwise the activity of the tournament is extended to the next 60 blocks. </li><li>  Immediately after the tournament is closed, we form and send a transaction date (we also pay a commission of about $ 0.005 for it), if necessary, several, which contain all the conditions of the draw and an ordered list of players (tickets) from which we need to choose the winners. </li><li>  At this stage, we already have the first part of the code (R-code) plus the transaction date ID (TXID).  We send them to the signature of the oracle in the form of concatenation (R-code + TXID), again we pay a commission + compensation.  The Oracle checks the data for uniqueness and belonging, and in response it sends us the second part of the code (S-code) in the sha256 format, which is the starting point for the random number generator. </li><li>  To get a random number that indicates the number of the winning ticket, we convert the S-code from the sha256 binary data into a hexadecimal (HEX) representation.  Then from the resulting HEX string, we get a number.  We get the remainder of dividing the resulting number by the number of tickets (all_tickets) and add 1 to the result (to get the number 1 to all_tickets).  As a result, we get the serial number of the winner. </li><li>  If under the terms of the draw there are several winners, then we repeat the previous operations in an amount equal to the number of prizes.  At the same time, each time we delete a ticket from the list that has already won and reduce all_tickets by 1, and instead of S-code we indicate the previous received number. </li></ol><br>  Let us examine a concrete real-life example, tournament number 119: <br><br>  Total 7 tickets (all_tickets) <br>  Ticket price 50 coins (Bet) <br>  Game collection 10% (Fee) <br><br>  Under the terms of the lottery, 30% get into the prize, ie  in this case, 2 tickets must receive a prize, the size of which is calculated by the formula (Bet * all_tickets-Fee) / 2. <br><br>  1. Received R-code: <a href="https://wavesexplorer.com/tx/8t7M7eWnK1b5CF2Y2TVSqyuD3dg35Az71Cf9uCdaR1X9">RdbAiAhKhveAtR4eyTKq75noMxdcEoxbE6BvojJjM13VE</a> <br><br>  2. After the tournament is closed, we have a list of tickets in the form of pairs: number + address (the address of the wallet from which payment for participation in the tournament was paid).  Note that the addresses can be repeated, this means that one participant has bought several tickets in one tournament, this is not forbidden by the rules. <br><br>  Sent transaction date: <a href="https://wavesexplorer.com/tx/82JTMzhHM5xEA2fQ9Qscd5QAJU3DAd8nShLjdVHTer5S">82JTMzhHM5xEA2fQ9Qscd5QAJU3DAd8nShLjdVHTer5S</a> <br><br>  3. Requested S-code: <a href="https://wavesexplorer.com/tx/FTF3uRyaa4F2uAyD6z5a3CNbTXbQLc7fSR6CFNVjgZYV">FTF3uRyaa4F2uAyD6z5a3CNbTXbQLc7fSR6CFNVjgZYV</a> with a comment (R-code + TXID): <br>  RdbAiAhKhveAtR4eyTKq75noMxdcEoxbE6BvojJjM13VE 82JTMzhHM5xEA2fQ9Qscd5QAJU3DAd8nShLjdVHTer5S <br><br>  4. Received S-code: <a href="https://wavesexplorer.com/tx/Go8nx2f4uurHXmETTVcMKDWX9nh98t4TgjuKHmJ2uVSH">Ri89jHB4UXZDXY6gT1m4LBDXGMTaYzHozMk4nxiuqVXdC</a> <br><br>  5. Determined the winners. <br><br>  6. <a href="https://wavesexplorer.com/tx/5dVheZrRUDagoD65HErTQhJhJXLcFHcT8fqoFfgHDj2T">Sent payments</a> <br><br>  As a result, we have step-by-step fixation of the prize drawing procedure in the blockchain with the ability to check it at any time.  It‚Äôs almost impossible to juggle the results on the part of the organizer, at least it can‚Äôt be done inconspicuously. <br><br><pre><code class="plaintext hljs">determine the winner ‚Ññ 1 All_tickets: Index: 1 Ticket:139 Index: 2 Ticket:141 Index: 3 Ticket:143 Index: 4 Ticket:145 Index: 5 Ticket:147 Index: 6 Ticket:149 Index: 7 Ticket:151 1. bin -&gt; hex ( bin2hex(sha256(S-code)) ): Ri89jHB4UXZDXY6gT1m4LBDXGMTaYzHozMk4nxiuqVXdC -&gt; 0xdaf5802953dcb27f89972e38e8900b898733f6a613e6e1c6c5491362c1832596 2. hex -&gt; gmp number: 0xdaf5802953dcb27f89972e38e8900b898733f6a613e6e1c6c5491362c1832596 -&gt; 99037963059744689166154019807924045947962565922868104113173478160267437352342 3. gmp -&gt; modulo (mod=7): 99037963059744689166154019807924045947962565922868104113173478160267437352342 -&gt; 4 4. modulo -&gt; ticket: 4 -&gt; 145 determine the winner ‚Ññ 2 All_tickets: Index: 1 Ticket:139 Index: 2 Ticket:141 Index: 3 Ticket:143 Index: 4 Ticket:147 Index: 5 Ticket:149 Index: 6 Ticket:151 1. bin -&gt; hex ( bin2hex(sha256(previous hex)) ): daf5802953dcb27f89972e38e8900b898733f6a613e6e1c6c5491362c1832596 -&gt; 0x9560e77525e9ea2db92cdb8484dc52046ccafac7c719b8859ff55f0eb92834a0 2. hex -&gt; gmp number: 0x9560e77525e9ea2db92cdb8484dc52046ccafac7c719b8859ff55f0eb92834a0 -&gt; 67565829218838067182838043983962684143266386786567427968312120473742580659360 3. gmp -&gt; modulo (mod=6): 67565829218838067182838043983962684143266386786567427968312120473742580659360 -&gt; 1 4. modulo -&gt; ticket: 1 -&gt; 139 End.</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/454102/">https://habr.com/ru/post/454102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45409/index.html">Quick guide to customer management</a></li>
<li><a href="../454096/index.html">Digest of June IT events</a></li>
<li><a href="../454098/index.html">The merger of two white dwarfs can end with the appearance of a new neutron star</a></li>
<li><a href="../4541/index.html">The British government: ‚ÄúSave the Internet video!‚Äù</a></li>
<li><a href="../454100/index.html">Common code problems in microservices</a></li>
<li><a href="../454104/index.html">Cloud services to play on weak PCs, relevant in 2019</a></li>
<li><a href="../454106/index.html">With me - 15 ideas that can change your life, with you - 5 minutes of attention</a></li>
<li><a href="../454110/index.html">Development of an online store to preserve the nature of Kamchatka</a></li>
<li><a href="../454112/index.html">The history of the design levels Duke Nukem (with sketches of Levelrord)</a></li>
<li><a href="../454124/index.html">The book "Learning to code in JavaScript"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>