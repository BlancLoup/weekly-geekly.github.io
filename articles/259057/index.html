<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SMS chat on my knees</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It took us somehow SMS chat for a small group of users. The main requirements were reliability and ease of implementation. Available was a mediocre of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SMS chat on my knees</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/9ee/20c/963/9ee20c96342543a7901fc6bbd544139e.jpg" alt="image"><br><br>  It took us somehow SMS chat for a small group of users.  The main requirements were reliability and ease of implementation.  Available was a mediocre office computer with Windows XP on board, a USB modem Huawei E1550, a SIM card with a positive balance and an average enikeyschik. <br><br>  We wanted the following: engineers from among the operating personnel, taking up duty, are connected to the chat group and can exchange short text messages among themselves.  This is useful for solving problems related to several departments (relay workers and power engineers, for example).  When the presence in the group is not required - you can exit and do not receive messages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Theoretically, everything was simple.  We take a GSM modem, write a program that checks incoming messages on it, pulls out the necessary information from them, processes it and sends it to the list of connected subscribers. <br><a name="habracut"></a><br>  In practice, everything turned out differently.  Active google led us to several projects, including Habr.  But it turned out to be quite complicated.  For Delphi of us, no one really understands, and projects for Linux, we did not consider in principle - we have all Windows machines. <br><br>  The latest find was a program from the St. Petersburg company Headwind Solutions.  It is called ‚ÄúPersonal SMS Server‚Äù.  The program is paid, but there are 30 days of demo mode.  We started picking it. <br><br>  The program was very convenient and reliable.  Its main feature is that it eliminates the need to work with the modem directly.  She herself works with the GSM modem, checks incoming messages and sends outgoing ones.  If a new script arrives, it sends two parameters to it: the sender's number and the message text.  Everything else is decided by the script.  Already from the script, you can call the procedure for sending messages to the program.  There may be a lot of messages, the program itself will put them in a queue for sending and correctly transmit.  The script is written in VBS. <br><br>  The program, by the way, can work as a Windows service.  We first ignored this opportunity and in vain the service is more stable. <br><br>  We will not dwell on the program itself.  It has many customizable parameters, is simple and well described in the documentation on the developer‚Äôs website. <br><br>  More details on the chat script.  In addition to the script itself, in the same directory you will need to create three files: hlr.txt, vlr.txt and vlr_back.txt. <br>  The first file is filled with the numbers of subscribers with access to the chat.  The format is as follows: mobile number without a plus &lt;space&gt; subscriber ID. <br><br>  79111234567 Ivanov (power engineer) <br>  79111234568 Petrov (WDM) <br>  79111234569 Sidorov (RRL) <br><br>  The second and third files are left blank.  The second stores records of subscribers in the group, and the third file is used by the script to add / remove a subscriber from the group. <br><br>  The script supports three commands.  They begin with the sign # (lattice).  To enter the chat group you need to send an SMS to the number of the SIM card of the modem with the text # 1 to exit # 0.  To query the current list of users need to send #? <br>  Requests from subscribers who are not in the group are ignored. <br><br>  Incoming messages are processed as follows.  The subscriber's identifier is placed at the beginning of the original message (we have the employee's last name and his department), and then this message is transmitted to all subscribers from the vlr.txt file.  The sender receives a receipt for sending the message.  It duplicates its message and the number of subscribers to whom it has been sent.  A transfer receipt was added as a control measure.  If the receipt is received, it means that the chat is operational, there is money on the SIM card and the message has flown away to all the chat participants. <br><br>  I bring our program settings.  Parameters were selected for several years by trial and error: <br><br><img src="https://habrastorage.org/files/afd/fbf/677/afdfbf67739a483ea6f13e4e573b0146.png" alt="image"><br><br>  And the actual script: <br><br><div class="spoiler">  <b class="spoiler_title">VBS Chat Code</b> <div class="spoiler_text"><pre><code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'   ,       Number = WScript.Arguments(0) Message = WScript.Arguments(1) Message = Trim(Message) '  ,    FlagVlr = 0 FlagHlr = 0 FlagSymbol=0 Users = "" Count = 0 '        vlr = "vlr.txt" hlr = "hlr.txt" vlr_back = "vlr_back.txt" '      HLR Set objFSO = CreateObject("Scripting.FileSystemObject") Set filehlr = objFSO.OpenTextFile(hlr, 1) Do Until filehlr.AtEndOfStream sLine = filehlr.ReadLine() nSpace = InStr(sLine, " ") If nSpace &gt; 0 Then Number_hlr = Left(sLine, nSpace - 1) Name_hlr = Trim(Right(sLine, Len(sLine) - nSpace)) End If If (Number_hlr = Number) Then FlagHlr = 1 Name = Name_hlr End If If (Len(Users) = 2) Then Users = "" End If Loop filehlr.Close '      VLR Set objFSO = CreateObject("Scripting.FileSystemObject") Set filevlr = objFSO.OpenTextFile(vlr, 1) Do Until filevlr.AtEndOfStream sLine = filevlr.ReadLine() nSpace = InStr(sLine, " ") If nSpace &gt; 0 Then Users = Users &amp; ", " Number_vlr = Left(sLine, nSpace - 1) Name_vlr = Trim(Right(sLine, Len(sLine) - nSpace)) End If Count = Count + 1 If (Number_vlr = Number) Then FlagVlr = 1 Name = Name_vlr End If If (Len(Users) = 2) Then Users = "" End If Users = Users &amp; Name_vlr Loop filevlr.Close '           HLR  VLR If (FlagHlr = 0) Then Flaguser = 0 End If If (FlagHlr = 1) And (FlagVlr = 0) Then Flaguser = 1 End If If (FlagHlr = 1) And (FlagVlr = 1) Then Flaguser = 2 End If '     MessageAlreadyEnter = "    .   : " &amp; Users &amp; "." MessageNowInGroup = "  : " &amp; Users &amp; "." MessageEmpty = "   ." '        If (Count = 0) Then MessageNowInGroup = "   ." End If If (Count = 1) Then MessageAlreadyEnter = "    .    ." End If '    dlina = Len(Message) symbol = Trim(Message) symbol = Left(symbol, 1) If (symbol = "#") Then FlagSymbol = 1 End If '       If (Message = "#1") And (Flaguser = 1) Then FlagVlr = 0 FlagSymbol = 0 Set filevlr = objFSO.OpenTextFile(vlr, 1) Set filevlrback = objFSO.OpenTextFile(vlr_back, 2) rec = Number + " " + Name filevlrback.WriteLine(rec) Do Until filevlr.AtEndOfStream sw = filevlr.ReadLine() filevlrback.WriteLine(sw) Loop filevlr.Close filevlrback.Close Set filevlr = objFSO.OpenTextFile(vlr, 2) Set filevlrback = objFSO.OpenTextFile(vlr_back, 1) Do Until filevlrback.AtEndOfStream sw = filevlrback.ReadLine() filevlr.WriteLine(sw) Loop filevlr.Close filevlrback.Close ' =======        ======= Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = "    . " + MessageNowInGroup objMsg.Send() End If '      ,       If (Message = "#1") And (Flaguser = 2) Then FlagVlr = 0 FlagSymbol = 0 Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = "    . " + MessageNowInGroup objMsg.Send() End If '        If (Message = "#0") And (Flaguser = 1) Then FlagSymbol = 0 End If '       If (Message = "#0") And (FlagVlr = 1) Then FlagVlr = 0 FlagSymbol = 0 Set filevlr = objFSO.OpenTextFile(vlr, 1) Set filevlrback = objFSO.OpenTextFile(vlr_back, 2) Do Until filevlr.AtEndOfStream sLine = filevlr.ReadLine() nSpace = InStr(sLine, " ") If nSpace &gt; 0 Then Number_vlr = Left(sLine, nSpace - 1) Name_vlr = Trim(Right(sLine, Len(sLine) - nSpace)) rec = Number_vlr + " " + Name_vlr End If If (Number_vlr &lt;&gt; Number) Then filevlrback.WriteLine(rec) End If Loop filevlr.Close filevlrback.Close Set filevlr = objFSO.OpenTextFile(vlr, 2) Set filevlrback = objFSO.OpenTextFile(vlr_back, 1) Do Until filevlrback.AtEndOfStream rec = filevlrback.ReadLine() filevlr.WriteLine(rec) Loop filevlr.Close filevlrback.Close ' =======        ======= Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = "   ." objMsg.Send() End If '       If (Message = "#?") And (FlagVlr = 1) Then FlagVlr = 0 FlagSymbol = 0 Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = MessageNowInGroup objMsg.Send() End If '      If (FlagSymbol = 1) And (FlagHlr = 1) Then FlagVlr = 0 FlagSymbol = 0 Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = "  . : #1 - , #0 - , #? -  ." objMsg.Send() End If '    If (Message = "") And (FlagVlr = 1) Then FlagVlr = 0 Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = MessageEmpty objMsg.Send() End If '    If (FlagVlr = 1) Then Message = Trim(Message) Set objFSO = CreateObject("Scripting.FileSystemObject") Set filevlr = objFSO.OpenTextFile(vlr, 1) Set objSMSDriver = CreateObject("HeadwindGSM.SMSDriver") objSMSDriver.Connect() Do Until filevlr.AtEndOfStream sLine = filevlr.ReadLine nSpace = InStr(sLine, " ") If nSpace &gt; 0 Then Number_buffer = Left(sLine, nSpace - 1) Name_buffer = Trim(Right(sLine, Len(sLine) - nSpace)) If (Number_buffer &lt;&gt; Number) Then Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number_buffer objMsg.Body = Name &amp; ": " &amp; Message objMsg.Send() End If End If Loop filevlr.Close Count_receipt = Count - 1 ' =======   ======= Set objMsg = CreateObject("HeadwindGSM.SMSMessage") objMsg.To = Number objMsg.Body = "Message send to " &amp; Count_receipt &amp; " users. Text: '" &amp; Message &amp; "'" objMsg.Send() ' ======= /  ======= End If ' =======   ======= WScript.Quit</span></span></code> </pre> <br><br></div></div><br><br>  So we got a simple SMS chat, which is now working for the benefit of domestic engineers.  We hope that it will be useful to you. </div><p>Source: <a href="https://habr.com/ru/post/259057/">https://habr.com/ru/post/259057/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259041/index.html">How to make a small contest in one day</a></li>
<li><a href="../259047/index.html">OWASP TOP-10: a practical look at web application security: # 1 - injections</a></li>
<li><a href="../259051/index.html">That new versions of UEFI standards are prepared for us, part one, PI 1.4</a></li>
<li><a href="../259053/index.html">The second version of the Evernote SDK for Android: new Evernote features in your applications</a></li>
<li><a href="../259055/index.html">We test Spring Rest controllers: simpler, shorter, more reliable. Spring Security Test + JSON Matcher</a></li>
<li><a href="../259065/index.html">Digest news of the gaming industry</a></li>
<li><a href="../259067/index.html">Simple Web Service with Jetty Embedded</a></li>
<li><a href="../259069/index.html">Memory Optimization DataTable</a></li>
<li><a href="../259071/index.html">New to Wolfram SystemModeler: FMI Import</a></li>
<li><a href="../259073/index.html">Browser history sniffing using favicon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>