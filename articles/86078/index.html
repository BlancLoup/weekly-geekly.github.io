<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hands-on experience creating Dojo widgets. Optimize javascript code performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, habrasoobschestvo. 

 I want to share with you some useful, in my opinion, information that will be of interest to those who are developing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hands-on experience creating Dojo widgets. Optimize javascript code performance</h1><div class="post__text post__text-html js-mediator-article">  Good day, habrasoobschestvo. <br><br>  I want to share with you some useful, in my opinion, information that will be of interest to those who are developing or planning to start developing their <a href="http://dojotoolkit.org/">Dojo</a> widgets.  I want to immediately warn you that in this article I will not tell you how to gradually create your own Dojo widget (however, if the community is interested in this topic, I hope to present it in a separate article).  Instead, I want to highlight the main points and principles that everyone who is involved in developing Dojo widgets or has anything to do with this topic should know and take into account. <br><br> <a href="http://dojotoolkit.org/"><img src="http://upload.wikimedia.org/wikipedia/en/thumb/6/6b/Dojo.logo.svg/200px-Dojo.logo.svg.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="http://dojotoolkit.org/dojango/dojo-media/release/1.4.0-20100212/dtk/images/browsers.png" alt="image"></a> <br><a name="habracut"></a><br><h4>  Dojo widgets </h4><br>  I think it would not be superfluous to say a few words about the concept of widgets. <br>  The goal of the Dojo widgets is to encapsulate visual Web components for repeated reuse.  The Dojo widget is handled on the web browser side. <br>  The structure of the Dojo widgets is independent of the structure of the DOM objects.  Each Dojo widget has a unique widgetId and may contain none, or it may contain one or more DOM elements, as well as Dojo child widgets. <br><br>  A widget consists of several files.  A javascript file is required, while others are optional: <br><ul><li>  The JavaScript code file (* .js) contains the widget logic in JavaScript.  It manages visual elements using the DOM JavaScript objects API.  (Dojo has many useful libraries to simplify standard functions.) </li><li>  An HTML template (* .html) provides a basic representation of the widget in HTML.  If the template is very simple, you can present it as a line in the code file. </li><li>  The CSS style file (* .css) contains visual styles used by the HTML template and / or JavaScript code. </li><li>  Image files (* .gif, * .jpg, etc.) contain the images used by the widget. </li></ul><br><h4>  Practical experience in creating widgets. </h4><br><h5>  Software and declarative models for creating Dojo widgets </h5><br>  Dojo allows us to create widgets in two ways: declaratively and programmatically. <br>  Programmatically, we can instantiate a widget using JavaScript code: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> myWidget = <font color="#0000ff">new</font> WidgetClass({ <font color="#008000">//properties</font> },‚ÄùtargetNode‚Äù);</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">var</font> myWidget = <font color="#0000ff">new</font> WidgetClass({ <font color="#008000">//properties</font> },‚ÄùtargetNode‚Äù); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#008000"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">var</font> myWidget = <font color="#0000ff">new</font> WidgetClass({ //properties },‚ÄùtargetNode‚Äù); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">var</font> myWidget = <font color="#0000ff">new</font> WidgetClass({ <font color="#008000">//properties</font> },‚ÄùtargetNode‚Äù); <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> myWidget = <font color="#0000ff">new</font> WidgetClass({ <font color="#008000">//properties</font> },‚ÄùtargetNode‚Äù);</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  Declaratively widgets are created directly via markup: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">dojoType</font> = ‚Äú <font color="#ff0000">WidgetClass</font> ‚Äù <font color="#0000ff">&gt; &lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  Declarative declared widgets will be detected and instantiated <a href="http://docs.dojocampus.org/dojo/parser">by the dojo parser</a> immediately after the body.load event and before calling the functions from <a href="http://docs.dojocampus.org/dojo/addOnLoad">dojo.addOnLoad</a> .  Therefore, in order not to block the flow of execution, it is best to postpone the execution of resource-intensive tasks to addOnLoad wherever possible. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">dojoType</font> = ‚Äú <font color="#ff0000">myWidgetClass</font> ‚Äù <font color="#ff0000">postCreate</font> = ‚Äú <font color="#ff0000">slowFunction</font> ‚Äù <font color="#0000ff">&gt; &lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#008000">// Slow option:</font> </li><li>  slowFunction () {doSlowStuff ();} </li><li>  <font color="#008000">// Optimized version:</font> </li><li>  slowFunction () {dojo.addOnLoad (doSlowStuff ());} </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  The developers of Dojo clearly have a description of the interface with the help of special attributes of HTML tags, and not directly in the JS code.  In earlier versions of the library, it was the access to the declarative model, when in HTML code the developer described form using attributes, and after loading the browser Dojo replaced the descriptions with rendered elements.  Later, after a cardinal change of architecture and a transition to the 0.9 branch, and then in 1.x, it turned out that the program model is more familiar and, most importantly, faster, especially in complex forms.  And debugging seems simpler, and the possibilities are wider. <br><br><h5>  Widget startup </h5><br>  The final method for creating a widget is the startup () method.  This method is especially useful when we need to perform any actions after the widget has been completely initialized and rendered, but before it is displayed on the page.  For example, if we need to add any element to the widget or a new tab to the tab container of the widget, then we can easily do this in the startup method. <br>  The startup method will automatically be called by the parser in the case of a widget's declarative declaration, however, if we create the widget programmatically, we need to call this method manually. <br><br><h5>  Deferred performance of "heavy" functions. </h5><br>  As we all know very well, multi-threading in JavaScript is out of the question.  All JavaScript code will be executed in the same thread.  Therefore, the implementation of "heavy" (resource-intensive) tasks is better to postpone for the last moment. <br>  To do this, we can use timers in JavaScript, namely the setTimeout and setInterval functions, which allow us to organize deferred code execution after a specified period of time.  In this case, the execution of the deferred code is shifted to the execution queue of the JS engine, which makes it possible to complete the execution of more critical tasks. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  dojo.addOnLoad ( <font color="#0000ff">function</font> () { </li><li>  setTimeout ( <font color="#0000ff">function</font> () { </li><li>  <font color="#008000">// deferred code</font> </li><li>  }, 100); </li><li>  }); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  More details about using timers to optimize JavaScript code can be found <a href="http://www.nczonline.net/blog/2009/01/13/speed-up-your-javascript-part-1/">here</a> . <br><br><h5>  dojo.query </h5><br>  Use <a href="http://docs.dojocampus.org/dojo/query">dojo.query</a> to access the DOM.  Yes, dojo.query is much faster and has a laconic syntax than regular DOM APIs.  For example, this code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// list every node with the class "progressIndicator":</font> </li><li>  <font color="#0000ff">var</font> list = []; </li><li>  <font color="#0000ff">var</font> nodes = .getElementsByTagName ( <font color="#A31515">"*"</font> ); </li><li>  <font color="#008000">// iterate over every node in the document .... SLOOOW</font> </li><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> x = 0; x &lt;nodes.length; x ++) { </li><li>  <font color="#0000ff">if</font> (nodes [x] .className == <font color="#A31515">"progressIndicator"</font> ) { </li><li>  list.push (nodes [x]);  }} </li><li>  console.dir (list); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  using dojo.query looks like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  console.dir (dojo.query ( <font color="#A31515">".progressIndicator"</font> )); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  You can find more diverse examples of using dojo.query using different queries <a href="http://docs.dojocampus.org/dojo/query">here</a> . <br><br><h5>  dojo.behavior </h5><br>  Use <a href="http://docs.dojocampus.org/dojo/behavior">dojo.behavior</a> to add functionality.  dojo.behavior is a very simple and easy mechanism for ‚Äúadding‚Äù code to existing documents, which is based on dojo.query for selecting DOM elements and two simple API commands: <br>  dojo.behavior.add (), which adds a ‚Äúbehavior object‚Äù to the document, and dojo.behavior.apply (), which applies the added ‚Äúbehavior‚Äù. <br>  With examples of use can be found <a href="http://docs.dojocampus.org/dojo/behavior">here</a> . <br><br><h5>  Event Delegation </h5><br>  "Hanging" the same handlers on several different elements can be optimized using delegation.  The point of this optimization of event processing is to ‚Äúhang‚Äù one handler per common parent element and use the event object obtained in the handler arguments to access the event initiator. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "container"</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "1"</font> <font color="#0000ff">&gt;</font> 1 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "2"</font> <font color="#0000ff">&gt;</font> 2 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "3"</font> <font color="#0000ff">&gt;</font> 3 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "4"</font> <font color="#0000ff">&gt;</font> 4 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">div</font> <font color="#ff0000">id</font> <font color="#0000ff">= "5"</font> <font color="#0000ff">&gt;</font> 5 <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">div</font> <font color="#0000ff">&gt;</font> </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  Without delegation: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">for</font> ( <font color="#0000ff">var</font> i = 1; i &lt;6; i ++) { </li><li>  <font color="#0000ff">var</font> el = dojo.byId ( <font color="#A31515">""</font> + i); </li><li>  dojo.connect (el, <font color="#A31515">"onclick"</font> , <font color="#0000ff">function</font> () { </li><li>  alert ( <font color="#0000ff">this</font> .id); </li><li>  });  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  Using delegation: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  dojo.connect (dojo.byId ( <font color="#A31515">"container"</font> ), <font color="#A31515">"onclick"</font> , <font color="#0000ff">function</font> (evt) { </li><li>  <font color="#0000ff">var</font> el = evt.target; </li><li>  alert (el.id); </li><li>  }); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><br><h5>  On a note </h5><br>  And finally, general code optimization ideas using the Dojo framework: <br><ul><li>  dojo.parse is faster than running a DOM directly; </li><li>  adding elements to the DOM is detrimental to performance; </li><li>  Each widget is an extra load, so combine them where possible; </li><li>  organize deferred execution wherever possible; </li><li>  Dojo core features are optimized for performance, but widgets can be slow and resource intensive if you don‚Äôt give proper attention to all the details when you implement them; </li></ul><br>  In addition, the following critical factors should be kept in mind: <br><ul><li>  Scripts in the body slow down parsing the body; </li><li>  Loading resources blocks the body load event; </li><li>  Processing massive constructs of widgets to be parsed blocks <a href="http://docs.dojocampus.org/dojo/addOnLoad">addOnLoad</a> handlers; </li><li>  Massive (slow) addOnLoad handlers block the sequential execution of other handlers. </li></ul><br><h4>  Conclusion </h4><br>  Well, perhaps all that I wanted to dwell on in this article.  Of course, this article does not claim to be the complete or ‚Äúbest‚Äù guide to optimizing JS code and / or Dojo widgets, but I tried to focus on the most significant and frequently used principles.  I hope this article will be useful to anyone who uses or plans to start using the <a href="http://dojotoolkit.org/">Dojo JavaScript framework</a> . <br><br>  <b>upd</b> : Thanks for the karma - transferred to the Javascript blog. </div><p>Source: <a href="https://habr.com/ru/post/86078/">https://habr.com/ru/post/86078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86070/index.html">Tagline rating ‚ÄúTOP-100 leading studios of Russia 2010‚Äù started</a></li>
<li><a href="../86071/index.html">Disable two-hour autorebut in Windows 7 RC</a></li>
<li><a href="../86072/index.html">Castleproject MonoRail: Basics</a></li>
<li><a href="../86073/index.html">48 Tips for Lullabot Programmers</a></li>
<li><a href="../86074/index.html">Eclipse and Windows 64</a></li>
<li><a href="../86081/index.html">Few ideas</a></li>
<li><a href="../86082/index.html">Asus reader and a bit about SiPix technology</a></li>
<li><a href="../86083/index.html">Mantis + Subversion on your computer with Windows XP. Step-by-step instruction for convenient organization of work with the code</a></li>
<li><a href="../86085/index.html">Tests of gadgets and other stuff</a></li>
<li><a href="../86086/index.html">Where are trying to change this world for the better</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>