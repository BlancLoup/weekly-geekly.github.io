<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>There is nothing to blame on the mirror, if the curve is crooked</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the most depressing things for every programmer is the realization that all your time is spent not on creating something useful, but on elimina...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>There is nothing to blame on the mirror, if the curve is crooked</h1><div class="post__text post__text-html js-mediator-article">  One of the most depressing things for every programmer is the realization that all your time is spent not on creating something useful, but on eliminating problems that we ourselves create. <br><br>  This process is called debugging.  Every day, every programmer appears before the fact that when he writes code, he creates errors in the code.  And as soon as he realizes that his program is not working, he should look for problems that he himself has created. <br><br><a name="habracut"></a>  To solve such problems, the computer industry has created a huge number of tools that help you make sure that the program works correctly.  Programmers, for finding errors, use methods of <a href="http://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BF%25D1%2580%25D0%25B5%25D1%2580%25D1%258B%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">continuous integration</a> , <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">unit-testing</a> , <a href="http://ru.wikipedia.org/wiki/%25D0%25A3%25D1%2582%25D0%25B2%25D0%25B5%25D1%2580%25D0%25B6%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">statements</a> , <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D1%2582%25D0%25BB%25D0%25B0%25D0%25B4%25D1%2587%25D0%25B8%25D0%25BA">debuggers</a> , etc.  But mistakes still remain, and must be eliminated with the help of human thinking. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some programming languages, such as C, are extremely susceptible to such types of errors that appear and disappear randomly, and as soon as you begin to understand the reason for their appearance, they immediately disappear.  Such errors are often called the <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25B9%25D0%25B7%25D0%25B5%25D0%25BD%25D0%25B1%25D0%25B0%25D0%25B3">Heisenbags</a> , because as soon as you start looking for them, they disappear. <br><br>  Such errors can occur in any programming language, especially when writing a multi-tasking code, where the slightest delay in time can cause <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B3%25D0%25BE%25D0%25BD%25D0%25BA%25D0%25B8">a race condition</a> .  But in C there is another problem - a memory leak. <br><br>  However, that would not cause an error, the key steps in finding a problem are always the following: <br><ul><li>  Find the smallest pattern in which the error is fully reproduced.  With heisenbags, this can be difficult, but even a small percentage of the tests in which the error is reproduced are significant. </li><li>  Automate the test process.  Much better when you can run the test again and again.  You can even make it part of the program when the error is resolved - it will not allow the error to reappear. </li><li>  Search for a cause until its base is found.  Until you find the true cause of the error, you cannot say with certainty that you have fixed it.  With heisenbags, you can very easily get confused, believing that you have corrected a mistake, after it suddenly disappears after what you do in the search process. </li><li>  Correct the cause and check using step 2. </li></ul><br>  Recently, a story appeared in Hacker News - <a href="http://news.ycombinator.com/item%3Fid%3D1123147">If you have a heisenbag in C, then there is a problem in your compiler optimizer</a> .  This is a very wrong judgment. <br><br>  The compiler that you use is likely to be used by thousands of people, while your program is most likely used only by you.  Do you think that the compiler or your program is most stable? <br><br>  In fact, a sign of the programmer's inexperience is the fact that the first thing they do when looking for a mistake is blaming someone else.  It is very tempting to blame the computer, the operating system, the library you are using.  However, the real programmer is the one who can control his ‚ÄúI‚Äù and realize that the error is most likely his. <br><br>  Of course, there are errors in the code of other programmers.  There is no doubt that the library may not work, the operating system may do incomprehensible things, and the compiler to generate strange code.  But most of the time - this is your mistake, and this applies even if the error looks too strange. <br><br>  In the process of debugging, you often beat your head on your own code and repeat again and again the most impossible things that simply cannot happen to your code.  However, at one point, the impossible becomes possible and then you find a mistake. <br><br>  In the article above there is one definitely not complete example: <br><br>  ‚ÄúDisable the optimizer and check the program again.  If it works, then the problem is in the optimizer.  Play around with optimization levels by raising the level until the error starts playing. ‚Äù <br><br>  All you know when changing optimization levels is that the levels change regardless of whether an error occurs or not.  This does not tell you that the optimizer is working incorrectly.  You did not find the desired cause of the error. <br><br>  Since optimizers make manipulations with code to speed up their work, it is likely that, depending on the level of optimization, heisenbags may appear or disappear.  This does not mean that the optimizer is working incorrectly.  This is still, most likely, your mistake. <br><br>  Here is a specific example of a C program that contains an error that appears when the compiler optimization level changes, and shows the strange behavior of the program. <br><br> <code>#include &lt;stdlib.h&gt; <br> <br> int a() <br> { <br> int ar[16]; <br> ar[20] = (getpid() % 19 == 0); <br> } <br> <br> int main(int argc, char * argv[]) <br> { <br> int rc[16]; <br> rc[0] = 0; <br> a(); <br> return rc[0]; <br> }</code> <br> <br>  Compile this program using gcc on Mac OS X using the following Makefile (I saved the code in the odd.c file). <br><br> <code>CC=gcc <br> CFLAGS= <br> <br> odd: odd.o</code> <br> <br>  And here is an example of a script that runs the program 20 times and displays the result: <br><br> <code>#!/bin/bash <br> for i in {0..20} <br> do <br> ./odd ; echo -n "$? " <br> done <br> echo</code> <br> <br>  If you run this script, you will expect a string of zeros, since rc [0] never gets values ‚Äã‚Äãother than zero.  However, here is an example of the program: <br><br> <code>$ ./test <br> 0 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code> <br> <br>  If you are an experienced C programmer, you will see how I made a unit appear, and why it appears in different places.  But now let's try debugging the program with printf: <br><br> <code>[...] <br> rc[0] = 0; <br> printf( "[%d]", rc[0] ); <br> a(); <br> [...]</code> <br> <br>  Now when you run the program, the error will disappear. <br><br> <code>$ ./test <br> [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 <br> [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0 [0]0</code> <br> <br>  It looks weird, so you move printf to another place: <br><br> <code>[...] <br> rc[0] = 0; <br> a(); <br> printf( "[%d]", rc[0] ); <br> [...]</code> <br> <br>  and get the same strange result with the disappearance of the error.  And the same will happen if you disable the optimizer and even without printf the error will not appear: <br><br> <code>$ make CFLAGS=-O3 <br> gcc -O3 -c -o odd.o odd.c <br> gcc odd.o -o odd <br> <br> $ ./test <br> 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</code> <br> <br>  This all happens because f-a () allocates memory for 16 Integer elements.  And immediately writes down after the end of the array either 1 or 0, depending on whether the PID of the process is divided into 19 or not.  Ultimately, it is written to rc [0] due to its location on the stack. <br><br>  Adding printf or changing the optimization level changes the location of the code and excludes incorrect access to rc [0].  But be careful, the error did not go away.  The unit simply enrolled in another memory location. <br><br>  Because  C is very susceptible to this type of error, it is important to use good tools to check for such problems.  For example, the static code analyzer <a href="http://en.wikipedia.org/wiki/Splint_(programming_tool)">splint</a> and the memory analyzer <a href="http://valgrind.org/">valgrind</a> help eliminate a lot of nasty errors.  And you should develop your applications with the maximum level of errors and eliminate them all. <br><br>  Only if you do everything you need, can you begin to suspect someone else's code.  But even if you started to do it - check all the steps again to establish the true cause of the error.  Unfortunately, in most cases, most of the errors are yours. </div><p>Source: <a href="https://habr.com/ru/post/85884/">https://habr.com/ru/post/85884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85874/index.html">Weekly digest of new computer hardware (Release 1)</a></li>
<li><a href="../85875/index.html">Butterfly Effect</a></li>
<li><a href="../85876/index.html">Review of the PocketBook 360 e-book</a></li>
<li><a href="../85877/index.html">A couple of words about the development of sites under the contract</a></li>
<li><a href="../85882/index.html">6 floppy disks</a></li>
<li><a href="../85889/index.html">A selection of videos about creating a design layout and a site in Adobe Fireworks</a></li>
<li><a href="../85890/index.html">English is such English</a></li>
<li><a href="../85891/index.html">Bedside table do it yourself in 15 minutes</a></li>
<li><a href="../85892/index.html">Manage a homemade USB-HID LED using a .NET GUI shell</a></li>
<li><a href="../85894/index.html">Twitter reposting (or rss) to Haskell vkontakte.ru status</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>