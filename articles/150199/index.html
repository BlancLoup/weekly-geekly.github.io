<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing RESTful Web Service on Scala</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week on Habr√© there were two whole articles about the implementation of RESTful web services in Java. Well, let's not fall behind and write our v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing RESTful Web Service on Scala</h1><div class="post__text post__text-html js-mediator-article">  Last week on Habr√© there were two whole articles about the implementation of RESTful web services in Java.  Well, let's not fall behind and write our version on Scala, with monads and applicative functors.  Mature Scala developers are unlikely to find something new in this article, and Django lovers will generally say that they have this ‚Äúout-of-the-box‚Äù functionality, but I hope that it will be interesting for Java developers and curious people to read. <br><br><h4>  Training </h4><br>  We take the problem from the <a href="http://habrahabr.ru/post/150034">previous article</a> as a basis, but we will try to solve it so that the solution code fits on the screen.  At least 40-inch and fifth font.  In the end, in the 21st century it should be possible to solve simple tasks without megabytes of xml-configs and dozens of abstract factories. <br><br>  For those who do not want to follow the links I will clarify: we are going to implement the simplest RESTful service to access the customer database.  From the necessary functionality - the creation and deletion of objects in the database, as well as the paginal output of a list of all clients with the ability to sort by different fields. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As bricks from which we will build a house, we take: <br><ul><li>  <a href="http://www.scala-lang.org/">Scala</a> is not even a brick, but rather a foundation </li><li>  <a href="http://unfiltered.databinder.net/">Unfiltered</a> is an excellent library for handling HTTP requests, </li><li>  <a href="http://squeryl.org/">Squeryl</a> - library for database queries, </li><li>  <a href="http://jackson.codehaus.org/">Jackson</a> is a library for working with JSON, originally written for Java, but with a bang and with Scala types, </li><li>  <a href="https://code.google.com/p/scalaz/">Scalaz</a> is a library that allows you to write different funny characters like ‚äõ, ‚Ü¶ or ‚àÉ in the code, and at the same time realizes such useful abstractions as applicative functors, monoids, semigroups and Clayley arrows.  The latter, however, I have not yet had to use, but most likely this is due to the fact that I have not yet achieved the necessary degree of functional enlightenment. </li></ul><br>  In the course of the article, I will try to give enough explanations so that the code would be clear to people not familiar with Scala, but I do not promise that I will succeed. <br><a name="habracut"></a><br><br><h4>  To battle </h4><br><h5>  Data model </h5><br>  First we need to decide on the data model.  Squeryl allows you to set the model as a normal class, and in order not to write too much, we will use the same class for subsequent serialization in JSON. <br><br><pre><code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@JsonIgnoreProperties</span></span>(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"_isPersisted"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">id: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, firstName: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, lastName: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, email: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Option</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">], birthday: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Option</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Date</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KeyedEntity</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br>  Fields of type <code>Option[_]</code> correspond to nullable columns of the database.  Such fields can take two kinds of values: <code>Some(value)</code> , if the value is, and <code>None</code> , if it is not.  Using <code>Option</code> allows you to minimize the chances of a <code>NullPointerException</code> and is common practice in functional programming languages ‚Äã‚Äã(especially in those in which there is no concept of <code>null</code> at all). <br><br>  The <code>@JsonIgnoreProperties</code> excludes certain fields from JSON serialization.  In this case, the <code>_isPersisted</code> field, which Squeryl added, had to be excluded. <br><br><h5>  Database schema initialization </h5><br>  Those who worked with JDBC know that the first thing to do is to initialize the database driver class.  We will not deviate from this practice: <br><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">Class</span></span>.forName(<span class="hljs-string"><span class="hljs-string">"org.h2.Driver"</span></span>) <span class="hljs-type"><span class="hljs-type">SessionFactory</span></span>.concreteFactory = <span class="hljs-type"><span class="hljs-type">Some</span></span>(() =&gt; <span class="hljs-type"><span class="hljs-type">Session</span></span>.create(<span class="hljs-type"><span class="hljs-type">DriverManager</span></span>.getConnection(<span class="hljs-string"><span class="hljs-string">"jdbc:h2:test"</span></span>, <span class="hljs-string"><span class="hljs-string">"sa"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">H2Adapter</span></span>))</code> </pre><br>  In the first line we load the JDBC driver, and in the second we specify the Squeryl library which connection factory to use.  As a database we use light and fast <a href="http://www.h2database.com/">H2</a> . <br><br>  Now came the turn of the scheme: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DB</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Schema</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> customer = table[<span class="hljs-type"><span class="hljs-type">Customer</span></span>] } transaction { allCatch opt <span class="hljs-type"><span class="hljs-type">DB</span></span>.create }</code> </pre><br>  First, we indicate that our database contains one table corresponding to the <code>Customer</code> class, and then execute the DDL commands to create this table.  In real life, using automatic table creation is usually problematic, but for quick demonstration it is very convenient.  If tables in the database already exist, <code>DB.create</code> throw an exception, which we, thanks to <code>allCatch opt</code> , successfully ignore. <br><br><h5>  JSON serialization and deserialization </h5><br>  To begin with, let's initialize the JSON parser so that it can work with the data types adopted in Scala: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ObjectMapper</span></span>().withModule(<span class="hljs-type"><span class="hljs-type">DefaultScalaModule</span></span>)</code> </pre><br>  Now we define two functions for turning JSON strings into objects: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseCustomerJson</span></span></span></span>(json: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Customer</span></span>] = allCatch opt mapper.readValue(json, classOf[<span class="hljs-type"><span class="hljs-type">Customer</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readCustomer</span></span></span></span>(req: <span class="hljs-type"><span class="hljs-type">HttpRequest</span></span>[_], id: =&gt; <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">Customer</span></span>] = parseCustomerJson(<span class="hljs-type"><span class="hljs-type">Body</span></span>.string(req)) map (_.copy(id = id))</code> </pre><br>  The <code>parseCustomerJson</code> function <code>parseCustomerJson</code> JSON.  Thanks to the use of <code>allCatch opt</code> exceptions that occurred during the parsing process will be intercepted and as a result we will get <code>None</code> .  The second function, <code>readCustomer</code> , is directly related to the processing of an HTTP request ‚Äî it reads the request body, turns it into an object of type <code>Customer</code> and sets the <code>id</code> field to the specified value. <br><br>  It should be noted that it was not necessary to specify the type of the return value in both functions: the compiler has enough data to display the type without the programmer‚Äôs hints, but the explicitly specified type sometimes makes it easier for people to understand the code. <br><br>  The reverse process ‚Äî turning the <code>Customer</code> object (or <code>List[Customer]</code> ) into an HTTP response body ‚Äî is also not difficult: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResponseJson</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">o: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComposeResponse</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ContentType</span></span></span></span><span class="hljs-class"><span class="hljs-params">("application/json"</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">~&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResponseString</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">mapper.writeValueAsString(o</span></span></span><span class="hljs-class">)))</span></span></code> </pre><br>  In the future, we will simply return objects of type <code>ResponseJson</code> , and the Unfiltered framework will take care of turning it into the correct HTTP response. <br><br>  Another small touch is the generation of new customer identifiers.  The easiest, though not always the most convenient way is to use a UUID: <br><br><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nextId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">UUID</span></span>.randomUUID().toString</code> </pre><br><h5>  HTTP request processing </h5><br>  Now that most of the preparatory work has been done, we can proceed directly to the implementation of the web service.  I will not go into the details of the Unfiltered library device; I will only say that the simplest way to use it looks like this: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> service = cycle.<span class="hljs-type"><span class="hljs-type">Planify</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> =&gt; <span class="hljs-comment"><span class="hljs-comment">/* ,   */</span></span> }</code> </pre><br>  Our service will have two entry points: <code>/customer</code> and <code>/customer/[id]</code> .  Let's start with the second: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> req<span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-type"><span class="hljs-type">Seg</span></span>(<span class="hljs-string"><span class="hljs-string">"customer"</span></span> :: id :: <span class="hljs-type"><span class="hljs-type">Nil</span></span>)) =&gt; req <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">GET</span></span>(_) =&gt; transaction { <span class="hljs-type"><span class="hljs-type">DB</span></span>.customer.lookup(id) cata(<span class="hljs-type"><span class="hljs-type">ResponseJson</span></span>, <span class="hljs-type"><span class="hljs-type">NotFound</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">PUT</span></span>(_) =&gt; transaction { readCustomer(req, id) ‚àò <span class="hljs-type"><span class="hljs-type">DB</span></span>.customer.update cata(_ =&gt; <span class="hljs-type"><span class="hljs-type">Ok</span></span>, <span class="hljs-type"><span class="hljs-type">BadRequest</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">DELETE</span></span>(_) =&gt; transaction { <span class="hljs-type"><span class="hljs-type">DB</span></span>.customer.delete(id); <span class="hljs-type"><span class="hljs-type">NoContent</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-type"><span class="hljs-type">Pass</span></span> }</code> </pre><br>  In the first line, we indicate that this code wants to process only the URL of the form <code>/customer/[id]</code> and binds the passed identifier to the id variable (if the immutable variable can be called that at all).  In the following lines, we specify the behavior depending on the type of request.  Let us analyze, for example, the processing of the PUT method in steps: <br><ul><li>  <code>transaction { ... }</code> : we indicate that while the handler's body is running, a transaction should be opened, </li><li>  <code>readCustomer(req, id)</code> : use a previously written method that reads the request body and returns <code>Option[Customer]</code> </li><li>  <code>‚àò</code> : this symbol deserves special attention, in fact, it is synonymous with the map operation and allows you to apply any function to the contents of the Option, if the content is </li><li>  <code>DB.customer.update</code> : the same function that we want to use is an update of the entity in the database, </li><li>  <code>cata(_ =&gt; Ok, BadRequest)</code> : returns <code>Ok</code> if <code>Option</code> has a value or <code>BadRequest</code> if the request could not be parsed and we have <code>None</code> instead of the client. </li></ul><br>  Processing GET and DELETE requests is done in the same way. <br><br>  In the second half of the handler servicing requests to <code>/customer</code> , we will need two auxiliary functions: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> field: <span class="hljs-type"><span class="hljs-type">PartialFunction</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">Customer</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">TypedExpressionNode</span></span>[_]] = { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"id"</span></span> =&gt; _.id <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"firstName"</span></span> =&gt; _.firstName <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"lastName"</span></span> =&gt; _.lastName <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"email"</span></span> =&gt; _.email <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"birthday"</span></span> =&gt; _.birthday } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> ordering: <span class="hljs-type"><span class="hljs-type">PartialFunction</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">TypedExpressionNode</span></span>[_] =&gt; <span class="hljs-type"><span class="hljs-type">OrderByExpression</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"asc"</span></span> =&gt; _.asc <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"desc"</span></span> =&gt; _.desc }</code> </pre><br>  These functions will be used to create an <code>order by</code> part of the request and, most likely, having rummaged in the depths of Squeryl, they could have been written more simply, but this also suited me.  Handler code itself: <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> req<span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-type"><span class="hljs-type">Seg</span></span>(<span class="hljs-string"><span class="hljs-string">"customer"</span></span> :: <span class="hljs-type"><span class="hljs-type">Nil</span></span>)) =&gt; req <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">POST</span></span>(_) =&gt; transaction { readCustomer(req, nextId) ‚àò <span class="hljs-type"><span class="hljs-type">DB</span></span>.customer.insert ‚àò <span class="hljs-type"><span class="hljs-type">ResponseJson</span></span> cata(_ ~&gt; <span class="hljs-type"><span class="hljs-type">Created</span></span>, <span class="hljs-type"><span class="hljs-type">BadRequest</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">GET</span></span>(_) &amp; <span class="hljs-type"><span class="hljs-type">Params</span></span>(params) =&gt; transaction { <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">Params</span></span>._ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> orderBy = (params.get(<span class="hljs-string"><span class="hljs-string">"orderby"</span></span>) ‚àó first orElse <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-string"><span class="hljs-string">"id"</span></span>)) ‚àó field.lift <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> order = (params.get(<span class="hljs-string"><span class="hljs-string">"order"</span></span>) ‚àó first orElse <span class="hljs-type"><span class="hljs-type">Some</span></span>(<span class="hljs-string"><span class="hljs-string">"asc"</span></span>)) ‚àó ordering.lift <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageNum = params.get(<span class="hljs-string"><span class="hljs-string">"pagenum"</span></span>) ‚àó (first ~&gt; int) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageSize = params.get(<span class="hljs-string"><span class="hljs-string">"pagesize"</span></span>) ‚àó (first ~&gt; int) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> offset = ^(pageNum, pageSize)(_ * _) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> query = from(<span class="hljs-type"><span class="hljs-type">DB</span></span>.customer) { q =&gt; select(q) orderBy ^(orderBy, order)(_ andThen _ apply q).toList } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pagedQuery = ^(offset, pageSize)(query.page) getOrElse query <span class="hljs-type"><span class="hljs-type">ResponseJson</span></span>(pagedQuery.toList) } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> _ =&gt; <span class="hljs-type"><span class="hljs-type">Pass</span></span> }</code> </pre><br>  The part related to the POST request does not contain anything new, but then we have to process the request parameters and two incomprehensible symbols appear: <code>‚àó</code> and <code>^</code> .  The first (neatly, do not confuse it with the usual asterisk <code>*</code> ) is a synonym for <code>flatMap</code> and differs from <code>map</code> in that the function used must also return <code>Option</code> .  Thus, we can consistently perform several operations, each of which either returns a value successfully or returns <code>None</code> in case of an error.  The second operator is a bit more complicated and allows you to perform some operation only if all the variables used are not equal to <code>None</code> .  This allows us to perform sorting only if both the column and the direction are indicated, and split the result into pages only if both the page number and its size are specified. <br><br>  That's all, it remains only to start the server <br><br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">Http</span></span>(<span class="hljs-number"><span class="hljs-number">8080</span></span>).plan(service).run()</code> </pre><br>  and you can pick up curl, to check that everything works. <br><br><h4>  Conclusion </h4><br>  In my opinion, the resulting web service code is compact and fairly easy to read, and this is a very important feature.  Naturally, it is not perfect: for example, it was probably worth using <code>scala.Either</code> or <code>scalaz.Validation</code> for error <code>scalaz.Validation</code> , and someone might not like the use of Unicode operators.  In addition, quite complicated operations can sometimes be hidden behind external simplicity, and in order to understand how everything is arranged ‚Äúunder the hood‚Äù, it is necessary to tighten the convolutions.  Nevertheless, I hope that this article will encourage someone to take a closer look at Scala: even if you fail to apply this language in your work, you will surely learn something new. <br><br>  The code, as it should be, is laid out on <a href="https://github.com/rtimush/simple-rest/blob/master/src/main/scala/com/rtimushev/demo/rest/Boot.scala">GitHub</a> , and it differs from the one given in the article only by the presence of import and sbt-script for building. <br><br>  I almost forgot - I promised at the very beginning of the article that there will be monads and other vermin in the web service.  So, <code>flatMap</code> (aka <code>‚àó</code> ) is a monadic bind, and the operator <code>^</code> is directly related to applicative functors. <br><br>  And finally, if you are in Kharkov or Saratov and want to develop interesting things using Scala and Akka, write - we are looking for competent specialists. </div><p>Source: <a href="https://habr.com/ru/post/150199/">https://habr.com/ru/post/150199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150192/index.html">Windows 8 tells Microsoft about any installable programs.</a></li>
<li><a href="../150193/index.html">Cheat Sheet by SCJP. Part two</a></li>
<li><a href="../150194/index.html">Quality takeoff after the "fall". Or why "lay" many bytes</a></li>
<li><a href="../150197/index.html">A jury found Samsung guilty of infringing Apple patents</a></li>
<li><a href="../150198/index.html">Implementing Common Lisp Condition System on C #</a></li>
<li><a href="../150200/index.html">Be optimistic - depression leads to Alzheimer's disease</a></li>
<li><a href="../150201/index.html">Vulnerability in Kohana?</a></li>
<li><a href="../150203/index.html">My view on Scrum</a></li>
<li><a href="../150204/index.html">Solving the problem of installing Cloud9 ide on Ubuntu 12.04</a></li>
<li><a href="../150205/index.html">Recoding video from Intel Quick Sync Video - do it quickly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>