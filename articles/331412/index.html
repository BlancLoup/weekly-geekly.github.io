<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a compact and efficient javascript using RollupJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, more and more often, along with other javascript collectors, I began to meet rollupJS. And even began to use it for writing modules used in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a compact and efficient javascript using RollupJS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://rollupjs.org/logo.svg" alt="rollupjs" align="left" width="150"><br>  Recently, more and more often, along with other javascript collectors, I began to meet rollupJS.  And even began to use it for writing modules used in the company's main project.  Therefore, I want to share with you a translation of becoming about this compact and convenient collector. <br><br>  <i>Style - author.</i> <br><br>  Learn how to use Rollup as a more compact and efficient alternative to webpack and Browserify for combining JavaScript files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the end of this tutorial, we will configure Rollup to: <br><br><ul><li>  combining our script </li><li>  remove unused code </li><li>  transplaying it to work with old browsers, </li><li>  support for the use of Node modules in the browser, </li><li>  work with environment variables and </li><li>  optimizing our code to reduce the size of the output file </li></ul><br><h3>  Prerequisites </h3><br><ul><li>  Initial knowledge in javascript. </li><li>  An initial introduction to <a href="">ES2015 modules</a> also does not hurt. </li><li> You must have <code>npm</code> installed on your computer.  (You don't have it? Install Node.js <a href="https://nodejs.org/">here</a> .) </li></ul><br><h3>  What is a Rollup? </h3><br>  As the developers themselves describe: <br><blockquote>  Rollup is the next generation tool for batch processing JavaScript modules.  Build your application or library using ES2015 modules, then merge them into one file for efficient use in browsers and Node.js.  This is similar to using Browserify and webpack.  You can also call the Rollup a construction tool, which is on a par with tools like Grunt and Gulp.  However, it is important to note that, although you can use Grunt and Gulp to solve JavaScript batch processing tasks, these tools will use similar Rollup, Browserify, or webpack functionality. <br></blockquote><br><h3>  Why can Rollup help you? </h3><br>  What a Rollup can do exactly, duck, to form truly truly optimized files.  And if without boring and tedious formalities, then you can summarize it like this: compared to other tools for batch processing of JavaScript, Rollup will almost always create a smaller package, and do it faster. <br><br>  This is because Rollup is based on ES2015 modules that are more efficient than CommonJS modules used in Browserify and webpack.  In addition, Rollup is much easier to remove unused code from modules using <i>tree-shaking</i> , which ultimately means that only the code that we really need will be included in the final package. <br><br>  Tree-shaking becomes very effective when we use third-party libraries or frameworks that have dozens of available functions and methods.  If we use only one or two methods - for example, lodash or jQuery - then loading the library completely incurs a lot of extra overhead. <br><br>  Currently, Browserify and webpack include a lot of unused code when building.  But the Rollup does not do this - only what we actually use is included in the assembly. <br><br><div class="spoiler">  <b class="spoiler_title">UPDATE (2016-08-22)</b> <div class="spoiler_text">  To clarify: Rollup can use tree-shaking only on ES modules.  CommonJS modules, which, at the time of writing, are both lodash and jQuery, cannot be applied tree-shaking.  Nevertheless, tree-shaking is one of the advantages of the Rollup along with the main one in the form of a speed / performance ratio.  See also <a href="https://www.reddit.com/r/javascript/comments/4yprc5/how_to_bundle_javascript_with_rollup_stepbystep/d6qzgzm">Richard Harris‚Äôs explanation</a> and additional <a href="https://www.reddit.com/r/javascript/comments/4yprc5/how_to_bundle_javascript_with_rollup_stepbystep/d6qzmgh%3Fcontext%3D3">information by Nolan Lawson</a> . <br></div></div><habracut><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  Partly due to the effectiveness of Rollup, webpack 2 will have tree-shaking support. <br></div></div><br><h3>  How to use Rollup to process and build javascript files? </h3><br>  To show how effective Rollup is, let's take a look at creating an extremely simple project that uses Rollup to build JavaScript. <br><br><h4>  STEP 0: CREATING A PROJECT WITH JAVASCRIPT AND CSS. </h4><br>  First we need to have a code to work with.  In this tutorial, we‚Äôll work with a small application available on <a href="https://github.com/jlengstorf/learn-rollup">GitHub</a> . <br><br>  The folder structure looks like this: <br><br> <code>learn-rollup/ <br> ‚îú‚îÄ‚îÄ build/ <br> ‚îÇ ‚îî‚îÄ‚îÄ index.html <br> ‚îú‚îÄ‚îÄ src/ <br> ‚îÇ ‚îú‚îÄ‚îÄ scripts/ <br> ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ modules/ <br> ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ mod1.js <br> ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ mod2.js <br> ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ main.js <br> ‚îÇ ‚îî‚îÄ‚îÄ styles/ <br> ‚îÇ ‚îî‚îÄ‚îÄ main.css <br> ‚îî‚îÄ‚îÄ package.json</code> <br> <br>  You can install the application that we will work with during this tutorial by executing the following command in your terminal. <br><habracut><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Move to the folder where you keep your dev projects. cd /path/to/your/projects # Clone the starter branch of the app from GitHub. git clone -b step-0 --single-branch https://github.com/jlengstorf/learn-rollup.git # The files are downloaded to /path/to/your/projects/learn-rollup/</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  If you do not clone repo, be sure to copy the contents of <code>build/index.html</code> into your own code.  HTML is not covered in this manual. <br></div></div><br><h4>  STEP 1: INSTALL ROLLUP AND CREATE A CONFIGURATION FILE. </h4><br>  To get started, install the Rollup with the following command: <br><br><pre> <code class="bash hljs">npm install --save-dev rollup</code> </pre> <br>  Then create a new file with the name <code>rollup.config.js</code> in the <code>learn-rollup</code> folder.  Add the following to it. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'src/scripts/main.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dest</span></span>: <span class="hljs-string"><span class="hljs-string">'build/js/main.min.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'iife'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-string"><span class="hljs-string">'inline'</span></span>, };</code> </pre> <br>  Let's talk about each option in this configuration: <br><br><ul><li>  Entry is the file we want Rollup to process.  In most applications, this will be the main JavaScript file that initializes everything and is the entry point. </li><li>  Dest is the place where the processed scripts will be saved. </li><li>  Format - Rollup supports multiple output formats.  Since we work in a browser, we want to use <a href="http://benalman.com/news/2010/11/immediately-invoked-function-expression/">immediately called functions</a> (IIFE) <br><br><div class="spoiler">  <b class="spoiler_title">Footnote</b> <div class="spoiler_text">  This is a rather difficult concept to understand, but if in a nutshell, we want our code to be within its own scope, which prevents conflicts with other scripts.  IIFE is a <a href="http://skilldrick.co.uk/2011/04/closures-explained-with-javascript/">closure</a> that contains all of our code in its own scope. <br></div></div><br></li><li>  SourceMap is very useful for debugging to provide a source code map.  This option adds a map to the generated file, which simplifies this task. </li></ul><habracut><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  For more information on the <code>format</code> option, see the <a href="https://github.com/rollup/rollup/wiki/JavaScript-API">Rollup's Wiki</a> . <br></div></div><br>  ROLLUP CONFIGURATION CHECK <br><br>  After we have created the configuration file, we can verify that everything works by running the following command in our terminal: <br><br><pre> <code class="bash hljs">./node_modules/.bin/rollup -c</code> </pre> <br>  This will create a new folder called <code>build</code> in your project with a <code>js</code> subfolder that will contain our generated <code>main.min.js</code> file. <br><br>  We will see that the package was created correctly by opening <code>build/index.html</code> in our browser: <br><br><img src="https://habrastorage.org/web/bb4/54e/567/bb454e56731f496ba2cd15b6fe75180d.png" alt="image"><br><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  At this stage, only modern browsers will work without errors.  In order for this code to work with old browsers that do not support ES2015 / ES6, we need to add some plugins. <br></div></div><br>  PASSING THE GENERATED PACKAGE <br><br>  Using tree-shaking makes Rollup a powerful tool, and so there is no unused code from the modules we refer to in the output file.  For example, in <code>src/scripts/modules/mod1.js</code> there is a function <code>sayGoodbyeTo ()</code> , which is not used in our application - and since it is never used, Rollup does not include it in the final package: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-string"><span class="hljs-string">'use strict'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Says hello. * @param {String} name a name * @return {String} a greeting for `name` */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sayHelloTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> name </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> toSay = <span class="hljs-string"><span class="hljs-string">`Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${name}</span></span></span><span class="hljs-string">!`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> toSay; } <span class="hljs-comment"><span class="hljs-comment">/** * Adds all the values in an array. * @param {Array} arr an array of numbers * @return {Number} the sum of all the array values */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> addArray = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> result = arr.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">habracut</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// Import a couple modules for testing. // Run some functions from our imported modules. const result1 = sayHelloTo('Jason'); const result2 = addArray([1, 2, 3, 4]); // Print the results on the page. const printTarget = document.getElementsByClassName('debug__output')[0]; printTarget.innerText = `sayHelloTo('Jason') =&gt; ${result1}\n\n` printTarget.innerText += `addArray([1, 2, 3, 4]) =&gt; ${result2}`; }()); //# sourceMappingURL=data:application/json;charset=utf-8;base64,...</span></span></code> </pre><br></div></div><br>  In other build tools, this is not always the case, and the generated packages can be really large if we include a large library, such as <a href="https://lodash.com/">lodash</a> , to refer to one or two functions. <br><br>  For example, using the <a href="https://webpack.github.io/">webpack</a> , the <code>sayGoodbyeTo ()</code> function is <code>sayGoodbyeTo ()</code> , and the resulting packet is more than twice the size that the Rollup generates. <br><br><div class="spoiler">  <b class="spoiler_title">Footnote</b> <div class="spoiler_text">  However, it is important to remember that when we deal with such small test applications, doubling the file size does not take much time.  For comparison, at the moment this size is ~ 3KB vs. ~ 8KB <br></div></div><br><h4>  STEP 2: INSTALL BABEL, THAT WOULD USE NEW FEATURES OF JAVASCRIPT NOW </h4><br>  At the moment we have code that will only work in modern browsers, and will not work in some browsers, the version of which lags behind several versions - and this is not ideal. <br><br>  Fortunately, <a href="https://babeljs.io/">Babel</a> can help us.  This project allows <a href="https://scotch.io/tutorials/javascript-transpilers-what-they-are-why-we-need-them">you</a> to <a href="https://scotch.io/tutorials/javascript-transpilers-what-they-are-why-we-need-them">translate</a> new JavaScript features ( <a href="">ES6 / ES2015, etc.</a> ) into ES5, and this code will work in almost any browser that can still be used today. <br><br>  If you have never used Babel, your developer life will change forever.  Access to new JavaScript features makes language easier, cleaner and more enjoyable overall. <br><br>  So let's make it part of our build process so that we don‚Äôt think about it anymore. <br><br>  INSTALLATION OF NECESSARY MODULES <br><br>  First, we need to install the <a href="https://github.com/rollup/rollup-plugin-babel">Babel Rollup plugin</a> and the <a href="https://www.npmjs.com/package/babel-preset-es2015">corresponding Babel presets</a> . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Install Rollup's Babel plugin. npm install --save-dev rollup-plugin-babel # Install the Babel preset for transpiling ES2015. npm install --save-dev babel-preset-es2015 # Install Babel's external helpers for module support. npm install --save-dev babel-plugin-external-helpers</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  Babel presets are a collection of Babel plugins that indicate to Babel that we actually want to translate <br></div></div><br>  CREATING <code>.babelrc</code> . <br><br>  Then create a new file called <code>.babelrc</code> in the project root directory <code>(learn-rollup/</code> ).  Inside, add the following JSON: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"presets"</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"es2015"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">"modules"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } ] ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"external-helpers"</span></span> ] }</code> </pre><habracut><br>  This tells Babel which preset he should use during the transfer. <br><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  In earlier versions of npm (&lt;v <code>2.15.11</code> ) you may see an error with the <code>es2015-rollup</code> preset.  If you cannot upgrade <code>npm</code> , see <a href="https://github.com/jlengstorf/learn-rollup/issues/2">this problem</a> for an alternative <code>.babelrc</code> configuration. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">UPDATE (2016-11-13)</b> <div class="spoiler_text">  The <code>.babelrc</code> video uses outdated configuration.  See <a href="https://github.com/jlengstorf/learn-rollup/pull/17">this pull request for configuration changes</a> , and <a href="https://github.com/jlengstorf/learn-rollup/pull/37">this for changes</a> to <code>package.json</code> . <br></div></div><br>  UPDATE <code>rollup.config.js</code> . <habracut><br><br>  To add Babel to the Rollup, you need to update rollup.config.js.  Inside, we import the Babel plug-in, and then add it to a new configuration property called plugins, which will contain an array of plug-ins. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Rollup plugins import babel from 'rollup-plugin-babel'; export default { entry: 'src/scripts/main.js', dest: 'build/js/main.min.js', format: 'iife', sourceMap: 'inline', plugins: [ babel({ exclude: 'node_modules/**', }), ], };</span></span></code> </pre><br>  To avoid third-party scripting, we set the <code>exclude</code> property to ignore the <code>node_modules</code> directory. <br><br>  CHECK OUTPUT PACKAGE <br><br>  With everything installed and configured, we can do a rebuild package: <br><br><pre> <code class="bash hljs">./node_modules/.bin/rollup -c</code> </pre> <br>  When we look at the result, it looks <i>about the</i> same.  But there are a few key differences: for example, look at the <code>addArray ()</code> function: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addArray = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">arr</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = arr.reduce(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; };</code> </pre><habracut><br>  See how Babel transformed the <a href="https://strongloop.com/strongblog/an-introduction-to-javascript-es6-arrow-functions/">‚Äúfat‚Äù arrow for the function</a> <code>(arr.reduce ((a, b) =&gt; a + b, 0))</code> into a regular function. <br><br>  This is a transpilation in action: the result is the same, but the code is now supported in IE9. <br><br><div class="spoiler">  <b class="spoiler_title">Important</b> <div class="spoiler_text">  Babel also offers <a href="https://babeljs.io/docs/usage/polyfill/">babel-polyfill</a> , which makes things like <code>Array.prototype.reduce ()</code> available in IE8 and earlier versions. <br></div></div><br><h4>  STEP 3: ADDING THE ESLINT TO JAVASCRIPT CHECK FOR ERROR </h4><br>  It is always useful to use linter for your code, since it provides a consistent coding practice and helps to find complex errors, such as missing operator or parentheses. <br><br>  For this project we will use <a href="http://eslint.org/">ESLint</a> . <br><br>  INSTALLING THE MODULE <br><br>  To use ESLint, we need to install the <a href="https://github.com/TrySound/rollup-plugin-eslint">ESLint Rollup plugin</a> : <br><br><pre> <code class="bash hljs">npm install --save-dev rollup-plugin-eslint</code> </pre> <br>  GENERATION <code>.eslintrc.json</code> . <br><br>  To make sure that we get only the errors that we need, we must first configure ESLint.  Fortunately, we can automatically create most of this configuration by running the following command: <br><br><div class="spoiler">  <b class="spoiler_title">Terminal</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ./node_modules/.bin/eslint --init ? How would you like to configure ESLint? Answer questions about your style ? Are you using ECMAScript 6 features? Yes ? Are you using ES6 modules? Yes ? Where will your code run? Browser ? Do you use CommonJS? No ? Do you use JSX? No ? What style of indentation <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you use? Spaces ? What quotes <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you use <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> strings? Single ? What line endings <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you use? Unix ? Do you require semicolons? Yes ? What format <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> you want your config file to be <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>? JSON Successfully created .eslintrc.json file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /Users/jlengstorf/dev/code.lengstorf.com/projects/learn-rollup</code> </pre><br></div></div><br>  If you answer the questions as shown above, you will get the following result in <code>.eslintrc.json</code> : <br><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"env"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es6"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: <span class="hljs-string"><span class="hljs-string">"eslint:recommended"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"parserOptions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"module"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"indent"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"linebreak-style"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"unix"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"quotes"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"single"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"always"</span></span> ] } }</code> </pre><br></div></div><br>  TWEAK <code>.eslintrc.json</code> <br><br>  However, we have to make several adjustments to avoid errors for our project: <br><br><ol><li>  We use 2 spaces instead of 4. </li><li>  Later we will use a global variable called <code>ENV</code> , so we need to whitelist it. </li></ol><br>  Make the following changes to your <code>.eslintrc.json</code> setting - the <code>globals</code> property and the <code>indent</code> property setting: <br><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"env"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"es6"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"globals"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ENV"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: <span class="hljs-string"><span class="hljs-string">"eslint:recommended"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"parserOptions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"sourceType"</span></span>: <span class="hljs-string"><span class="hljs-string">"module"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"indent"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"linebreak-style"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"unix"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"quotes"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"single"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-string"><span class="hljs-string">"always"</span></span> ] } }</code> </pre><br></div></div><br>  UPDATE <code>rollup.config.js</code> <br><br>  Then import the ESLint plugin and add it to the Rollup configuration: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Rollup plugins import babel from 'rollup-plugin-babel'; import eslint from 'rollup-plugin-eslint'; export default { entry: 'src/scripts/main.js', dest: 'build/js/main.min.js', format: 'iife', sourceMap: 'inline', plugins: [ eslint({ exclude: [ 'src/styles/**', ] }), babel({ exclude: 'node_modules/**', }), ], };</span></span></code> </pre><br>  CHECK RESULTS IN CONSOLES <br><br>  When we run <code>./node_modules/.bin/rollup -c</code> , nothing seems to happen.  The fact is that the application code in its current form passes linter without problems. <br><br>  But if we introduce a problem, such as deleting a semicolon, we will see how ESLint helps: <br><br><pre> <code class="bash hljs">$ ./node_modules/.bin/rollup -c /Users/jlengstorf/dev/code.lengstorf.com/projects/learn-rollup/src/scripts/main.js 12:64 error Missing semicolon semi 1 problem (1 error, 0 warnings)</code> </pre><br>  Potentially, what may contain a hidden error is now immediately visible, including the file, row and column where the problem was found. <br><br>  Although this does not save us from all our errors when debugging, but it greatly speeds up this process, eliminating errors caused by obvious typos. <br><br><div class="spoiler">  <b class="spoiler_title">Footnote</b> <div class="spoiler_text">  Probably many of us spent numerous hours, catching mistakes, which in the end turned out to be something as stupid as the name with an error, it is difficult to exaggerate the increase in work efficiency from the use of the linter. <br></div></div><br><h4>  STEP 4: ADDING A PLUG FOR TREATING NON-ES MODULES </h4><br>  This is important if you use Node-style modules in your build.  Without using this plugin, you will receive an error message when connecting this library using <code>require</code> . <br><br>  ADDING NODE-MODULES AS A DEPENDENCE <br><br>  It would be easy to crack this sample project without reference to a third-party module, but it is not going to cut it in real projects.  Therefore, to make our Rollup setup really useful, let's make sure that we can also refer to third-party modules in our code. <br><br>  For simplicity, we will add a simple logger to our code using the <code>debug</code> package.  Start by installing it: <br><br><pre> <code class="bash hljs">npm install --save debug</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  Since this will be indicated in the main project, it is important to use --save, which will avoid an error in production where devDependencies will be ignored. <br></div></div><br>  Then, inside <code>src/scripts/main.js</code> , let's add simple logging: <br><br><div class="spoiler">  <b class="spoiler_title">main.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Import a couple modules for testing. import { sayHelloTo } from './modules/mod1'; import addArray from './modules/mod2'; // Import a logger for easier debugging. import debug from 'debug'; const log = debug('app:log'); // Enable the logger. debug.enable('*'); log('Logging is enabled!'); // Run some functions from our imported modules. const result1 = sayHelloTo('Jason'); const result2 = addArray([1, 2, 3, 4]); // Print the results on the page. const printTarget = document.getElementsByClassName('debug__output')[0]; printTarget.innerText = `sayHelloTo('Jason') =&gt; ${result1}\n\n`; printTarget.innerText += `addArray([1, 2, 3, 4]) =&gt; ${result2}`;</span></span></code> </pre><br></div></div><br>  When you start rollup, we get a warning: <br><br><pre> <code class="bash hljs">$ ./node_modules/.bin/rollup -c Treating <span class="hljs-string"><span class="hljs-string">'debug'</span></span> as external dependency No name was provided <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> external module <span class="hljs-string"><span class="hljs-string">'debug'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> options.globals ‚Äì guessing <span class="hljs-string"><span class="hljs-string">'debug'</span></span></code> </pre><br>  And if we run our index.html again, we will see that the console has an Error ReferenceError: <br><br><img src="https://habrastorage.org/web/e71/4ea/cb4/e714eacb40c347d1a2aafbe4141f609f.png" alt="image"><br><br>  Here, rubbish.  It did not work. <br><br>  This is due to the fact that CommonJS is used in the node Node modules, which is incompatible with Rollup.  To solve this problem, we need to add a couple of plugins to handle dependencies of Node and CommonJS modules. <br><br>  INSTALLING THESE MODULES <br><br>  To get around this problem, we need to add two plugins: <br><br><ol><li>  <code>rollup-plugin-node-resolve</code> , which allows you to load third-party modules from <code>node_modules</code> . </li><li>  <code>rollup-plugin-commonjs</code> , which provides support for connecting CommonJS modules. </li></ol><br>  Install both plugins with the following command: <br><br><pre> <code class="bash hljs">npm install --save-dev rollup-plugin-node-resolve rollup-plugin-commonjs</code> </pre><br>  UPDATE <code>rollup.config.js</code> <br><br>  Then import it into the Rollup configuration: <br><br><div class="spoiler">  <b class="spoiler_title">rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Rollup plugins import babel from 'rollup-plugin-babel'; import eslint from 'rollup-plugin-eslint'; import resolve from 'rollup-plugin-node-resolve'; import commonjs from 'rollup-plugin-commonjs'; export default { entry: 'src/scripts/main.js', dest: 'build/js/main.min.js', format: 'iife', sourceMap: 'inline', plugins: [ resolve({ jsnext: true, main: true, browser: true, }), commonjs(), eslint({ exclude: [ 'src/styles/**', ] }), babel({ exclude: 'node_modules/**', }), ], };</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  The <code>jsnext</code> property provides <a href="https://github.com/rollup/rollup/wiki/jsnext:main">simple migration of ES2015 modules for Node packages</a> .  The <code>main</code> and <code>browser</code> properties help the plugin decide which files to use for the package. <br></div></div><br>  CHECK RESULTS IN CONSOLES <br><br>  Run the rebuild with the command <code>./node_modules/.bin/rollup -c</code> , then check the browser again to see the result: <br><br><img src="https://habrastorage.org/web/bec/f8e/a9c/becf8ea9c0c5411296561951f0836871.png" alt="image"><br><br><h4>  STEP 5: ADDING A PLUGIN TO ENABLE THE REPLACEMENT OF A VARIABLE ENVIRONMENT </h4><br>  Environment variables add a lot of additional "chips" in the development and give us the opportunity to do such things as turning off / turning on logging, implementing only dev scripts and much more. <br><br>  So let's make sure that Rollup allows us to use them. <br><br>  ADDING TERMS FOR <code>ENV</code> IN <code>main.js</code> <br><br>  Let's use the environment variable and turn on logging only if we are not in production mode.  In <code>src/scripts/main.js</code> , change the way we initialize our <code>log()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Import a logger for easier debugging. import debug from 'debug'; const log = debug('app:log'); // The logger should only be disabled if we're not in production. if (ENV !== 'production') { // Enable the logger. debug.enable('*'); log('Logging is enabled!'); } else { debug.disable(); }</span></span></code> </pre><br>  However, after we rebuild our project <code>(./node_modules/.bin/rollup -c)</code> and see the browser, we will see that this gives us a <code>ReferenceError</code> for <code>ENV</code> . <br><br>  This should not be surprising, because we have not defined it anywhere.  But if we try something like <code>ENV = production ./node_modules/.bin/rollup -c</code> , it will not work anyway.  This is due to the fact that setting the variable environment in this way makes it available only to the Rollup, and not to the package created using the Rollup. <br><br>  We need to use a plugin to transfer our environment variables to the package. <br><br>  INSTALLING THESE MODULES <br><br>  Start by installing <code>rollup-plugin-replace</code> , which is essentially just a find-and-replace utility.  It can do many things, but for our purposes we will simply find the appearance of the environment variable and replace it with the actual value (for example, all occurrences of <code>ENV</code> will be replaced with ‚Äúproduction‚Äù in the assembly). <br><br><pre> <code class="bash hljs">npm install --save-dev rollup-plugin-replace</code> </pre><br><h3>  UPDATE <code>rollup.config.js</code> </h3><br>  Let's import it into <code>rollup.config.js</code> and add it to our list of plugins. <br><br>  The configuration is quite simple: we can simply add a list of key-value pairs, where the key is the string to replace, and the value is what it should replace. <br><br><div class="spoiler">  <b class="spoiler_title">rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Rollup plugins import babel from 'rollup-plugin-babel'; import eslint from 'rollup-plugin-eslint'; import resolve from 'rollup-plugin-node-resolve'; import commonjs from 'rollup-plugin-commonjs'; import replace from 'rollup-plugin-replace'; export default { entry: 'src/scripts/main.js', dest: 'build/js/main.min.js', format: 'iife', sourceMap: 'inline', plugins: [ resolve({ jsnext: true, main: true, browser: true, }), commonjs(), eslint({ exclude: [ 'src/styles/**', ] }), babel({ exclude: 'node_modules/**', }), replace({ exclude: 'node_modules/**', ENV: JSON.stringify(process.env.NODE_ENV || 'development'), }), ], };</span></span></code> </pre><br></div></div><br>  In our configuration, we describe ENV as process.env.NODE_ENV ‚Äî the usual way to set environment variables in Node applications ‚Äî or ‚Äúdevelopment‚Äù.  We use JSON.stringify () to get the value enclosed in double quotes. <br><br>  To eliminate problems with third-party code, we also set the exclude property to ignore our node_modules directory and all the packages it contains.  (Thanks to <a href="https://github.com/jlengstorf/learn-rollup/issues/3">@wesleycoder for that matter</a> ). <br><br>  CHECK RESULTS <br><br>  Make a build rebuild and check the browser.  Log in the console should not differ from what was previously.  This is good - it means that we used the default value. <br>  To make sure that the setting works, run the rebuild in production mode: <br><br><pre> <code class="bash hljs">NODE_ENV=production ./node_modules/.bin/rollup -c</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Note</b> <div class="spoiler_text">  On Windows, use <code>SET NODE_ENV = production ./node_modules/.bin/rollup -c</code> to avoid errors when working with environment variables.  If you have problems with this command, <a href="https://github.com/jlengstorf/learn-rollup/issues/30">see this problem</a> for more information. <br></div></div><br>  Make sure that after reloading the page nothing is written to the console: <br><br><img src="https://habrastorage.org/web/d46/c91/6d0/d46c916d00d7477f9aa4bdb24b1b6f46.png" alt="image"><br><br><h4>  STEP 6: ADDING UGLIFYJS, FOR COMPRESSION AND MINIFICATION OF GENERATED SCRIPT </h4><br>  ,      ,    UglifyJS      .      ,  ,   ,    ¬´¬ª  ‚Äî         ,        . <br><br>   <br><br>    <a href="https://github.com/mishoo/UglifyJS2/">UglifyJS</a>   ,   <code><a href="https://github.com/TrySound/rollup-plugin-uglify">rollup-plugin-uglify</a></code> . <br>    : <br><br><pre> <code class="bash hljs">npm install --save-dev rollup-plugin-uglify</code> </pre><br>  <code>rollup.config.js</code> <br><br>    Uglify    Rollup.      ,   uglification    : <br><br><div class="spoiler">  <b class="spoiler_title">rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Rollup plugins import babel from 'rollup-plugin-babel'; import eslint from 'rollup-plugin-eslint'; import resolve from 'rollup-plugin-node-resolve'; import commonjs from 'rollup-plugin-commonjs'; import replace from 'rollup-plugin-replace'; import uglify from 'rollup-plugin-uglify'; export default { entry: 'src/scripts/main.js', dest: 'build/js/main.min.js', format: 'iife', sourceMap: 'inline', plugins: [ resolve({ jsnext: true, main: true, browser: true, }), commonjs(), eslint({ exclude: [ 'src/styles/**', ] }), babel({ exclude: 'node_modules/**', }), replace({ ENV: JSON.stringify(process.env.NODE_ENV || 'development'), }), (process.env.NODE_ENV === 'production' &amp;&amp; uglify()), ], };</span></span></code> </pre><br></div></div><br>      <code>uglify ()</code> ,  <code>NODE_ENV</code>   ¬´production¬ª. <br><br>    <br><br>  ,   Rollup   : <br><br><pre> <code class="bash hljs">NODE_ENV=production ./node_modules/.bin/rollup -c</code> </pre><br>        ,     .   ,    <code>build/js/main.min.js</code> : <br><br><img src="https://hsto.org/web/247/3b0/cae/2473b0cae73849019b415fd186b058b7.png" alt="image"><br><br>     ~ 42 .     UglifyJS,     ~ 29  ‚Äî     30%      . <br><br>  ‚Üí <a href="https://code.lengstorf.com/learn-rollup-js/">Source</a> <br><br> <b><i> :</i></b> <br><br>    rollup     ,        webpack(      ), ,   ,      .   ,      ,   ,     (tree-shaking)  .        ,        ,       ,      . </habracut></habracut></habracut></habracut></habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/331412/">https://habr.com/ru/post/331412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331402/index.html">Accounting services site - customer pain</a></li>
<li><a href="../331404/index.html">Google and Apple against indie developers</a></li>
<li><a href="../331406/index.html">We start GSM network at home</a></li>
<li><a href="../331408/index.html">Create normal push notifications</a></li>
<li><a href="../331410/index.html">How semantic technologies improve online education: a project of scientists from the ITMO University</a></li>
<li><a href="../331414/index.html">Seminar "Trifle, but nice: 20 little things that will make the work in the server really comfortable", July 4, Moscow</a></li>
<li><a href="../331416/index.html">Stagnation is inevitable. CRM takes the fight</a></li>
<li><a href="../331418/index.html">We dot the microservices. Avito section on RHS ++ 2017 (Video)</a></li>
<li><a href="../331420/index.html">Z-order in 8D</a></li>
<li><a href="../331422/index.html">Welcome to Science Slam Digital July 7</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>