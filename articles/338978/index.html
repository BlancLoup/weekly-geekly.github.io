<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How the AI ‚Äã‚Äãsenses system was created in Thief: The Dark Project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúFeelings‚Äù in game development is a useful metaphor for understanding, creating and discussing the part of AI that collects information about importan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How the AI ‚Äã‚Äãsenses system was created in Thief: The Dark Project</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/58b/820/f7a/58b820f7ab417eb9452efeaf9719599f.jpg" alt="image"><br><br>  ‚ÄúFeelings‚Äù in game development is a useful metaphor for understanding, creating and discussing the part of AI that collects information about important objects in a simulated game environment.  Non-game characters in a realistic three-dimensional space are usually people, animals or other creatures with vision and hearing, so this metaphor is very convenient. <br><br>  But this development metaphor should not be taken too literally.  Despite the seeming physical nature of the AI ‚Äã‚Äãof the game world, this analogy is neither physical nor neurological.  The line between ‚Äúfeeling‚Äù and ‚Äúknowledge‚Äù in the game is blurred.  The feeling includes the idea of ‚Äã‚Äãawareness of the presence in the game of other elements of the game, as well as their assessment and knowledge of them.  Game logic can be tied directly to such elements. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The system of feelings in the game must be created in such a way that it obeys the needs of the game design and is effective in implementation.  The system should not be too complicated, it is enough to ensure the reliability and interesting gameplay.  The result of her work should be perceived by the player and clear to him.  Only a few AI games need a sense of taste, touch, or touch, and vision and hearing are mainly used.  When used correctly, feelings can become an invaluable tool for creating more interesting behaviors of simple finite automata. <br><br>  This article describes the approach to the design and implementation of a high-precision sensor system for AI in a first-person game with an emphasis on stealth.  The techniques described here are taken from the experience of developing AI for the <em>Thief: The Dark Project</em> , as well as from reading the <em>Half-Life</em> code.  The first part of the article sets out the basic concepts of AI feelings on the motivating example of <em>Half-Life</em> .  The second part sets out more stringent requirements for sensory systems in the design of stealth games and describes the system created for <em>Thief</em> . <br><a name="habracut"></a><br><h2>  Case Study: Half-Life </h2><br>  In <em>Half-Life,</em> stealth and feelings are not the main thing.  However, due to the strong emphasis on tactical combat, it requires a logical sensory system.  Therefore, this game is a great example for exploring the fundamentals of AI sensor systems.  AI in <em>Half-Life</em> has scope and hearing, as well as a system for managing information about detected objects.  The game has interesting examples of applying simple feelings to create compelling behaviors. <br><br>  In a simple sensory system, the AI ‚Äã‚Äãperiodically ‚Äúlooks‚Äù and ‚Äúlistens‚Äù to the world.  Unlike vision and hearing in the real world, where stimuli are received by the senses passively, whether an object wants to or not, in the game they are active events.  The AI ‚Äã‚Äãexplores the world based on its interests and decides according to a set of rules whether it sees and hears another element of the game.  Such checks emulate real feelings, while at the same time reducing the amount of work needed.  Most resources are spent on aspects that are important to game mechanics. <br><br>  For example, a periodically called base Half-Life sensor system is as follows: <br><br>  If I'm close to the player, then ... <br><br> <code><i>  <br> --       <br> --   ... <br> ----       <br> ----       <br> ----         , ... <br> ------    <br> ------     ,     ,  <br> ------     <br> --------  <br> ------ <br> --------  ,        -------- <br>   <br> <br>   <br> --   ... <br> ----     ... <br> ------       <br> ------    ... <br> -------- ,   ,   -  <br> ------    "" <br> -------- ,   ,   -  <br>  </i></code> <br> <br>  The first concept, illustrated by this pseudocode, is that feelings are closely related to the properties of the AI, with its relationship with the object and with the correspondence of the actions of the AI ‚Äã‚Äãto the player's actions.  This is partly due to the desire to optimize, but is implemented through game mechanics.  In the <em>half-life</em> game design, an AI character that is far away from the player is not important and does not need to feel the world.  Even when he is close to the player, the AI ‚Äã‚Äãonly needs to look at objects that later should cause him to react with fear or hatred. <br><br>  This logic also demonstrates the design of the visibility system as a combination of visibility distance, visibility cone, line of sight and eye position (Fig. 1).  Each AI has a limited two-dimensional field of view within which it emits rays in the direction of interesting objects.  Free reaching rays mean visibility of objects. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/523/ab7/2f4/523ab72f4c0ca9698dfacf42e6a8e3c7.jpg" width="332" height="313"><br>  <strong>Picture 1</strong> <br><br>  It is worth noting two important aspects.  First, sensory operations are performed in order, from less costly to more costly.  Secondly, for the sake of the player's pleasure, the vision system in the game is made so that the enemy sees the player only when he sees him.  In the game from the first person, the player weakly feels the body, and if the opponent notices the player earlier, this often seems to be cheating. <br><br>  The most interesting piece is the limitation of the ability of the AI ‚Äã‚Äãto see the player until the player sees the AI.  It is only needed to make the game exciting.  This is an example of how high-level game goals can be easily and elegantly achieved using elementary techniques in low-level systems. <br><br>  The logic of hearing is much simpler than that of sight.  The basic element of the hearing component is the definition and setting of what the audible sound conveys to the AI.  In the case of <em>Half-Life,</em> hearing is a rectilinear heuristic of the sound volume multiplied by the ‚Äúsensitivity of hearing‚Äù, resulting in the distance at which the AI ‚Äã‚Äãhears the sound.  More interesting is the demonstration of the ability to hear as a template for collecting general information about the world.  In this example, the AI ‚Äã‚Äã"hears" pseudo-sounds, that is, fictional smells emanating from nearby corpses. <br><br><h2>  Feelings as an important element of the gameplay: Thief </h2><br>  In <em>Thief: The Dark Project</em> and its followers, a slightly scripted game world is presented, in which the central mechanics of the game (stealth) conflict with the traditional gameplay of a 3D first-person game.  The <em>Thief</em> player moves cautiously, avoids conflicts and is punished for killing people.  At the same time he can easily die.  Gameplay focuses on changes in the AI‚Äôs knowledge of the player moving through the game‚Äôs space.  The player must move around the area filled with fixed, moving and patrolling AI, trying to stay unnoticed, hiding in the shadows and not making sounds.  Although the feelings of gaming AI are built on the same basic principles as in <em>Half-Life</em> , the mechanics of stealth, escape and unexpected attacks require a more sophisticated sensory system. <br><br>  The main requirement was the creation of a very flexible sensory system operating in a wide range of conditions.  On the surface, stealth gameplay focuses on the fictional themes of stealth, escape, take-over, light and shadow.  One of the aspects that make such gameplay interesting is the expansion of the ‚Äúgray zone‚Äù between security and the threat, which in most first-person games is very thin.  The game tends to maintain tension, keeping the player on the verge between different states, and then going all serious at the intersection of the zone.  This requires a wide range of feelings that do not have well-defined polar values ‚Äã‚Äãof "the player is seen" or "the player is not noticed." <br><br>  The second requirement is that the sense system must be activated much more often and for more objects than in a regular first-person shooter.  During the game, the player can change the state of the world in ways that the AI ‚Äã‚Äãshould notice, even when the player is not nearby.  Some aspects, such as hiding corpses, require a well-functioning system.  These two requirements create an interesting problem that conflicts with another essential requirement for game developers: game performance. <br><br>  Finally, it is necessary that both players and designers understand the input and output information of sensory systems, and that the output information matches the results expected from the input information.  This prompted the developers to create a solution with a limited amount of input data perceived by the player and discretely evaluated results. <br><br><h2>  Expansion of the range of feelings </h2><br>  At its core, the sensor system described here is very similar to that used in <em>Half-Life</em> .  It is a visibility system based on visibility cones and emitted rays and a simple hearing system that supports optimization, game mechanics and pseudo-sensory data.  As in <em>Half-Life</em> , most data collection is independent of the decision-making process that is performed based on this information.  In this system, some of the basic principles have been expanded and new ones have been added. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/751/4e3/ece/7514e3ece9dd0318c8d978ab3a0e7075.jpg" width="450" height="200"><br>  <strong>Figure 2. Main components and relationships</strong> <br><br>  The system design and data transfer through it are designed as a customizable, flexible system for collecting information that provides stable and clear output data. <br><br>  In this system, AI's feelings are due to ‚Äúawareness‚Äù.  Awareness is expressed in the form of a set of discrete states representing AI awareness of the presence, location and identification of the object of interest.  These discrete states are the only representation of the internals of the system available to the designer.  In the high-level AI, they correlate with the character's alertness.  In AI Thief, a set of states of alertness is similar to a set of awareness states.  The state of alertness of the AI ‚Äã‚Äãin various ways is transmitted to the sensor system to change its behavior. <br><br>  Awareness is stored in sensory connections that tie AI to another entity in the game or to a position in space.  These links contain important for the game details of sensory information (time, place, line of sight, etc.), as well as cached values ‚Äã‚Äãused to reduce the number of calculations between cycles of ‚Äúthinking‚Äù.  In principle, sensory communication is the main memory of AI.  Through verbal transmission and observation, sensory connections can be distributed between AIs with the control of knowledge distribution cascades by level.  After basic processing, they can also be controlled through the logic of the game. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/acc/0ef/77d/acc0ef77d89e535ce4b7bf361f19df49.jpg" width="432" height="449"><br>  <strong>Figure 3. Sensory communication</strong> <br><br>  Each object of interest in the game has its own visibility value, independent of the observer.  Depending on the state of the game and the nature of the object, the level of detail of this value and the update frequency are scaled, which allows reducing the processor time to calculate the value. <br><br>  Visibility is determined by the illumination, movement and visibility (size, distance from other objects) of the object.  Its value is closely related to the requirements of the game.  For example, the player's illumination is tied to the illumination of the floor under his feet, which gives him an objective and visual way to determine his own security level.  These values ‚Äã‚Äãand visibility in the form of their total amount are stored as analog values ‚Äã‚Äãin the interval 0..1. <br><br><h2>  Visibility cones </h2><br>  Instead of a single two-dimensional field of view for the senses, <em>Thief</em> implemented a set of three-dimensional cones of visibility going in order, defined as XY angle, Z angle, distance, set of parameters describing general visual acuity and sensitivity to different types of stimuli (for example, to movement and light) and their relation to the alertness of AI.  Visibility cones are located in the direction of rotation of the AI ‚Äã‚Äãhead. <br><br>  At any given point in time for the observed object, only the first cone of visibility, in which the object is located, is used in the calculations of the senses.  For simplicity and the ability to customize the gameplay, it is believed that each cone of visibility creates constant output data, regardless of which part of the cone of visibility the object is in. <br><br>  For example, the AI ‚Äã‚Äãshown in Figure 4 has five visibility cones.  The object at point A will be evaluated with cone number 3. The cone of visibility used to calculate the visibility awareness of the object at point B and point C is the cone number 1, in which the same visibility values ‚Äã‚Äãfor the object give the same result. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/214/303/5bf/2143035bf9749ea425e1ef8a7b996244.jpg" width="185" height="305"><br>  <strong>Figure 4. Visibility cones, top view</strong> <br><br>  When checking objects of interest in the world, the system of feelings first of all determines which of the cones is related to this object.  Then his own characteristic of visibility, along with the cone of visibility, is transmitted through the heuristic of "sight", which gives out the discrete value of awareness. <br><br>  Several visibility cones are used to implement aspects such as direct visibility, peripheral vision, or to distinguish objects that are directly ahead and on the same Z plane from those that are in front, but higher and lower.  Cone number 5 in the figure is a good example of using a low-level system to express a high-level concept.  The cone of "imaginary sight" looks back.  He is sensitive to movement and gives the AI ‚Äã‚Äãa ‚Äúspider scent‚Äù: the character senses when he is being moved too closely, even when the player is completely silent. <br><br><h2>  Information conveyor </h2><br>  The sense control system has the form of a series of components, each of which receives a limited and well-defined set of data, after which it produces an even more limited value.  The cost of processing each stage can be independently scaled according to the importance of the gameplay.  In terms of performance, such multiple scalable layers can be made incredibly efficient. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4f/e5b/096/e4fe5b096eb55d77e105a867e4a1af31.jpg" width="500" height="448"><br>  <strong>Figure 5. Conveyor Information</strong> <br><br>  The basic sensory system implements heuristics, which receive information about visibility, sound events, current awareness connections, data of configurations of designers and programmers, and the current state of AI, and the output shows one awareness value for each object of interest.  These heuristics can be viewed as a ‚Äúblack box‚Äù, which the AI ‚Äã‚Äãprogrammer constantly adjusts as the game develops. <br><br>  Vision is implemented by filtering the value of the object's visibility through the corresponding cone of visibility, which changes the result based on the properties of each AI.  In most cases, simple beam emission is used to check the line of sight.  In a more interesting case, for example, when calculating the visibility of a player, several rays are emitted, determining the spatial relationship of the AI ‚Äã‚Äãto the object when weighing the object's visibility. <br><br>  <em>Thief</em> uses a sophisticated sound system in which sounds that are emitted and unpublished are marked with semantic data and distributed throughout the 3D geometry of the world.  When the sound "reaches" the ears of the AI, it comes from the direction from which it would come in the real world, marked by weakened awareness values.  If the sound is speech, then sometimes it carries information from other AI.  Such sounds are added to other aspects that change the level of awareness (for example, the smell in the case of <em>Half-Life</em> ) as an attitude of awareness of a position in space. <br><br><h2>  Impulses awareness </h2><br>  After completing the operations of sight and hearing, their results in the form of an awareness level are transmitted to a method that receives periodic impulses from the raw signals of the senses and transforms them into a simple awareness relation, all the details of which are stored in the associated sensory connection.  Unlike the analog data used in the pipeline at this stage, the data in this process is completely discrete.  The result of this process is creating, updating, or resetting sensory connections with the correct awareness value. <br><br>  This process takes place in three stages.  First, the input values ‚Äã‚Äãof hearing and vision are compared.  One of them is declared dominant and becomes the value of awareness.  The auxiliary data created by each sense is cleared and combined into a total amount of sensory events. <br><br>  Secondly, if the awareness impulse has increased compared to the previous indicators, then it is passed through a time filter, which determines whether awareness will actually increase.  The time delay is a property of the current state only, not the target state.  This is how delays in reactions and indicators of a player's forgiveness are realized  After passing the time threshold, awareness passes to the target state without passing through intermediate states. <br><br>  Thirdly, if the new impulse value is lower than the current reading, the ‚Äúcapacitor‚Äù is used to smoothly and gradually reduce awareness.  Awareness decreases during a certain period of time, passing through all intermediate states.  This softens the behavior of the AI ‚Äã‚Äãafter only the object of interest is no longer felt by the senses, but the alertness of the AI ‚Äã‚Äãis not governed by this mechanism. <br><br>  If the object of interest no longer generates impulses, the degree of free knowledge that is scalable based on the AI ‚Äã‚Äãstate is added to the senses.  This mechanism creates the appearance of logical thinking from the AI, when the object disappears from the scope, allowing you to hide cheating from the player. <br><br><h2>  Conclusion </h2><br>  The system described in the article is designed for a single-player game with software rendering.  Therefore, the rendering system was available all the information about the objects of the game.  Unfortunately, in a game engine with a client-server architecture and exclusively hardware renderer, this may not be possible.  The calculation of the illumination area of ‚Äã‚Äãthe object may not be so straightforward.  Therefore, to implement such a system should be thoughtfully and carefully, because it will need information from other systems. <br><br>  In addition, despite its effectiveness, the system is designed to play, largely dependent on the data output from this system.  In Thief, it takes quite a large part of the time allocated in the CPU for all AI calculations.  Therefore, the system can take time away from the search for ways, tactical analysis and other decision-making processes. <br><br>  However, any game can benefit from the implementation of the sensory system.  When collecting and filtering information about the environment and correctly processing it, the sense system can be used to create interesting AI behaviors without significantly complicating decision state machines.  In addition, a reliable sensor system allows you to implement "pre-conscious" behavior with the help of managing and changing the basic knowledge input data.  Finally, a sensory system with a multitude of states gives the player an artificial opponent or ally, demonstrating diverse and complex reactions and behaviors that do not add unnecessary complexity to basic decision-making machines. <br><br><h2>  Further research </h2><br>  Due to the fact that the Dark Engine, on which <em>Thief was</em> created, depends heavily on the data, most of the concepts presented in the article and all configuration details can be explored independently using the tools posted on <a href="http://www.thief-thecircle.com/">http://www.thief-thecircle.com</a> . </div><p>Source: <a href="https://habr.com/ru/post/338978/">https://habr.com/ru/post/338978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338960/index.html">How I searched (and found!) The bugs in the kickico smartcontract</a></li>
<li><a href="../338966/index.html">Monitoring of engineering infrastructure in the data center. Part 3. Cooling system</a></li>
<li><a href="../338968/index.html">FlashMapper is an alternative to auto-mapper</a></li>
<li><a href="../338970/index.html">Changed the way to create chat bots in Viber</a></li>
<li><a href="../338974/index.html">National roaming in different countries of the world</a></li>
<li><a href="../338980/index.html">What is known about the attack on the supply chain CCleaner</a></li>
<li><a href="../338982/index.html">More Apple Surprises: Updated Posting Guidelines on the App Store</a></li>
<li><a href="../338984/index.html">Selenium and Node.js: we write reliable browser tests</a></li>
<li><a href="../338986/index.html">Sonata import bundle</a></li>
<li><a href="../338988/index.html">What is ERP-Platfoma</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>