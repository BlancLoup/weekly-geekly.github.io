<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3D to D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr! 

 I met language D at the 3rd year, but I decided to use it only one year later, when the book Alexandrescu was published. Immediatel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3D to D</h1><div class="post__text post__text-html js-mediator-article">  Good day, Habr! <br><br>  I met language D at the 3rd year, but I decided to use it only one year later, when the book Alexandrescu was published.  Immediately took to write laboratory, coursework.  The main problem was the lack of necessary libraries (graphics, convenient mathematics) or inconvenient installation.  Now much has changed, libraries are being written ( <a href="http://code.dlang.org/packages/gfm">gfm</a> , <a href="http://code.dlang.org/packages/dlib">dlib</a> , <a href="http://code.dlang.org/packages/dlangui">dlangui</a> , etc.), dub has appeared.  With one of these libraries I want to introduce in this post.  Her name is <a href="https://github.com/dexset">DES</a> .  She grew up from the institute's groundwork, therefore, perhaps, it will be useful for someone to study and / or become a catalyst for learning the language. <br><br>  Let's write a simple application that draws some abstract mesh on the screen. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/29b/a70/922/29ba70922d6447d9ac0550504e2d13f8.png"><br><br><a name="habracut"></a><br>  The first thing that is usually done is creating dub.json with the necessary settings. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"example"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"targetPath"</span></span>: <span class="hljs-string"><span class="hljs-string">"bin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"targetType"</span></span>: <span class="hljs-string"><span class="hljs-string">"executable"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sourcePaths"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"src"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"des"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=1.3.0"</span></span> } }</code> </pre> <br></div></div><br>  Read more about dub <a href="http://habrahabr.ru/post/218125/">here</a> . <br><br>  Create a couple of folders: <br><ul><li>  src - source will be here </li><li>  data - there will be a file with a shader </li></ul><br>  Let's do the source. <br><br><div class="spoiler">  <b class="spoiler_title">Src / main.d file</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> des.app; //      SDL: ,  , , ,  GL    <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>; //    <span class="hljs-type"><span class="hljs-type">void</span></span> main() { auto app = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> DesApp; //  ,  ,   ,     app.addWindow({ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MainWindow; }); //   <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( app.isRuning ) app.step(); //  ,     }</code> </pre><br></div></div><br>  The DesApp class initializes SDL, GL, redirects SDL events to windows, and stores windows as such. <br><br>  Let's move on to more interesting things. <br><br><div class="spoiler">  <b class="spoiler_title">Src / window.d file</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">module <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> des.app; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> draw; //  Sphere <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> camera; //  MCamera //    <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MainWindow : DesWindow { protected: MCamera cam; //       Sphere obj; // ,    /+   ,  DesApp    OpenGL       :  ,  GL,   +/ override <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prepare</span></span>() { cam = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MCamera; obj = newEMM!Sphere( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span> ); //       //      ,      <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>( draw, { obj.draw( cam ); } ); <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>( key, &amp;keyControl ); //         <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>( mouse, &amp;(cam.mouseReaction) ); //        <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span>( event.resized, (ivec2 sz) { cam.ratio = cast(<span class="hljs-type"><span class="hljs-type">float</span></span>)sz.w / sz.h; } ); } //     <span class="hljs-type"><span class="hljs-type">void</span></span> keyControl( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> KeyboardEvent ke ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ke.scan == ke.Scan.<span class="hljs-keyword"><span class="hljs-keyword">ESCAPE</span></span> ) app.quit(); //        DesApp,    } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: //  title , ,        this() { super( "example", ivec2(<span class="hljs-number"><span class="hljs-number">800</span></span>,<span class="hljs-number"><span class="hljs-number">600</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> ); } }</code> </pre><br></div></div><br>  Let's start the explanation with a strange construction <br><pre> <code class="hljs lisp">obj = newEMM!Sphere( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span> )<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br>  And let's start from afar.  In D, there is an unpleasant feature associated with the garbage collector: you cannot manage memory in a destructor.  And sometimes you want.  Yes, and the destructor is not called explicitly.  EMM - short for ExternalMemoryManager - external memory management.  This is the basic interface for almost all classes in the library.  External memory refers to objects that are difficult to deinitialize using GC.  For example, these are OpenGL buffers, pointers to SDL windows, and so on.  ExternalMemoryManager can store other child objects that implement this interface.  All salt in the destroy method, which calls selfDestroy and destroy for all child objects.  It turns out some object ownership model: when a parent is deinitialized, all child objects are deinitialized.  To add a new bar object as a child in foo, you need to write the following code: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> bar = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bar; foo.registerChildEMM( bar );</code> </pre><br>  This situation occurs frequently, and to shorten it was decided to put this into the ExternalMemoryManager interface method: <br><pre> <code class="hljs erlang-repl">auto bar = foo.newEMM!Bar();</code> </pre><br>  The newEMM method is parameterized by the class to be created and the list of arguments that are passed to the class constructor inside the method, then a new one is returned and registered as a child object. <br><br>  Let us turn to the signals.  DesWindow is a descendant from DesObject, in which the connect method is declared.  Each DesObject is the keeper of such a concept as SlotHandler.  When a Slot object is created from a delegate, the SlotHandler is also passed, without which this is impossible.  And already the Slot object is transmitted to the signal for registration.  The question may arise: ‚ÄúWhy not just write delegates to an array?‚Äù.  Such difficulties are introduced into the architecture for further convenience.  When we simply write a delegate to an array, everything is in order, the context reference is stored, the GC does not touch objects, but this is a different situation.  The object that implements the ExternalMemoryManager may still exist, but now the call to any of its methods is no longer appropriate after the call to destroy ().  For example, we can free the OpenGL buffer by this point, and the delegate in the signal will be recorded.  Not good.  SlotHandler is the impersonation of the context via the ExternalMemoryManager.  It is a child of any DesObject, and when it is deleted, it disconnects itself from all connected signals, so we don‚Äôt need to worry about it.  The signal has a connect method and we could write <br><pre> <code class="hljs kotlin">draw.connect( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.newSlot( { obj.draw( cam ); } );</code> </pre><br>  In any case, we need someone who can be blamed for the validity of the delegate context. <br><br>  ivec2 is just an alias for Vector! (2, int, "xy | wh | uv") ... <br><br>  Next file src / draw.d <br><div class="spoiler">  <b class="spoiler_title">He is a little more voluminous</b> <div class="spoiler_text"><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">draw</span></span></span><span class="hljs-class">;</span></span> import std.math; import des.math.linear; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,  import des.util.stdext.algorithm; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> amap   array( map ... ) import des.util.helpers; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> appPath --     import des.space; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> , SpaceNode,   import des.gl; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   OpenGL <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Sphere</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GLSimpleObject</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpaceNode</span></span></span><span class="hljs-class"> { /+   </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpaceNode</span></span></span><span class="hljs-class">     </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self_mtr</span></span></span><span class="hljs-class">    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">matrix</span></span></span><span class="hljs-class">     +/ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mixin</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpaceNodeHelper</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-symbol"><span class="hljs-symbol">protected:</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/    GLBuffer pos, ind; void prepareBuffers() { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/        auto loc = shader.getAttribLocations( "pos" ); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  createArrayBuffer  createIndexBuffer    GLSimpleObject,  GLObject   pos = createArrayBuffer; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     ind = createIndexBuffer; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/         setAttribPointer( pos, loc[0], 3, GLType.FLOAT ); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    vec3[] buf; vec3 sp( vec2 a, float R ) { return spheric(a) * R; } buf ~= amap!(a=&gt;a+vec3(0,0,0))( amap!(a=&gt;sp(a,R))( planeCoord( uivec2( resU, resV/</span></span><span class="hljs-number"><span class="hljs-number">2</span></span> ), vec2(<span class="hljs-number"><span class="hljs-number">0</span></span>,PI*<span class="hljs-number"><span class="hljs-number">2</span></span>), vec2(PI,PI/<span class="hljs-number"><span class="hljs-number">2</span></span>) ) ) ); buf ~= amap!(a=&gt;a-vec3(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>))( amap!(a=&gt;sp(a,R*<span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">9</span></span>))( planeCoord( uivec2( resU, resV/<span class="hljs-number"><span class="hljs-number">2</span></span> ), vec2(<span class="hljs-number"><span class="hljs-number">0</span></span>,PI*<span class="hljs-number"><span class="hljs-number">2</span></span>), vec2(PI/<span class="hljs-number"><span class="hljs-number">2</span></span>,PI) ) ) ); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    pos.setData( buf ); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ind.setData( triangleStripPlaneIndex( uivec2( resU+<span class="hljs-number"><span class="hljs-number">1</span></span>, resV+<span class="hljs-number"><span class="hljs-number">2</span></span> ), uint.max ) ); } /<span class="hljs-regexp"><span class="hljs-regexp">/    uint resU, resV; float R; public: this( float r, uint u, uint v ) { R = r; resU = u; resV = v; import std.file; super( newEMM!CommonShaderProgram( /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/          parseShaderSource( /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   1     readText( /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   appPath( "..", "data", "object.glsl" ) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       )))); prepareBuffers(); } void draw( Camera cam ) { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     shader.setUniform!col4( "col", col4(1,0,0,1) ); glEnable( GL_PRIMITIVE_RESTART ); glPrimitiveRestartIndex(uint.max); glPolygonMode( GL_FRONT_AND_BACK, GL_LINE ); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/         shader.setUniform!mat4( "prj", cam.projection.matrix * cam.resolve(this) ); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   drawElements( DrawMode.TRIANGLE_STRIP ); glDisable( GL_PRIMITIVE_RESTART ); } } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      vec2[] planeCoord( uivec2 res, vec2 x_size=vec2(0,1), vec2 y_size=vec2(0,1) ) { vec2[] ret; float sx = (x_size[1] - x_size[0]) /</span></span> res.u; float sy = (y_size[<span class="hljs-number"><span class="hljs-number">1</span></span>] - y_size[<span class="hljs-number"><span class="hljs-number">0</span></span>]) / res.v; foreach( y; <span class="hljs-number"><span class="hljs-number">0</span></span> .. res.y+<span class="hljs-number"><span class="hljs-number">1</span></span> ) foreach( x; <span class="hljs-number"><span class="hljs-number">0</span></span> .. res.x+<span class="hljs-number"><span class="hljs-number">1</span></span> ) ret ~= vec2( x_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] + sx * x, y_size[<span class="hljs-number"><span class="hljs-number">0</span></span>] + sy * y ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } vec3 spheric( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec2 c ) pure { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vec3( cos(cx) * sin(cy), sin(cx) * sin(cy), cos(cy) ); } uint[] triangleStripPlaneIndex( uivec2 res, uint term ) { uint[] ret; foreach( y; <span class="hljs-number"><span class="hljs-number">0</span></span> .. res.y-<span class="hljs-number"><span class="hljs-number">1</span></span> ) { ret ~= [ y*res.x, (y+<span class="hljs-number"><span class="hljs-number">1</span></span>)*res.x ]; foreach( x; <span class="hljs-number"><span class="hljs-number">1</span></span> .. res.x ) ret ~= [ y*res.x+x, (y+<span class="hljs-number"><span class="hljs-number">1</span></span>)*res.x+x ]; ret ~= term; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br></div></div><br>  And the data / object.glsl file <br><div class="spoiler">  <b class="spoiler_title">no frills</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">//### vert #<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">330</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec4 pos; uniform mat4 prj; <span class="hljs-type"><span class="hljs-type">void</span></span> main() { gl_Position = prj * pos; } //### frag #<span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-number"><span class="hljs-number">330</span></span> uniform vec4 col; <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> vec4 color; <span class="hljs-type"><span class="hljs-type">void</span></span> main() { color = col; }</code> </pre><br></div></div><br>  A little bit about the camera and SpaceNode.  In OpenGL to the 3rd version there was a concept of a stack of matrices, separately specific and matrix models.  Everything is a bit simpler here, although you can make the same stack if you wish.  Each SpaceNode contains a pointer to the parent SpaceNode and a transformation matrix from the local to the parent coordinate system.  The parent SpaceNode can also be null.  The camera is also a SpaceNode, but with some additional fields and methods.  The main difference is the presence of the method of resolve, which takes SpaceNode and returns the transformation matrix from the object's coordinate system to the camera's coordinate system.  For this, a separate Resolver class is used.  In fact, it can be used to look from any SpaceNode object to any other. <br><div class="spoiler">  <b class="spoiler_title">And the last src / camera.d</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">module camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> std.math; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> des.space; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> des.app; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MCamera : SimpleCamera { protected: vec3 orb; vec2 rot; <span class="hljs-type"><span class="hljs-type">float</span></span> rotate_coef = <span class="hljs-number"><span class="hljs-number">80.0</span></span>f; <span class="hljs-type"><span class="hljs-type">float</span></span> offset_coef = <span class="hljs-number"><span class="hljs-number">50.0</span></span>f; <span class="hljs-type"><span class="hljs-type">float</span></span> y_angle_limit = PI_2 - <span class="hljs-number"><span class="hljs-number">0.01</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: this() { super(); orb = vec3( <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span> ); look_tr.target = vec3(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); look_tr.up = vec3(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); near = <span class="hljs-number"><span class="hljs-number">0.001</span></span>; updatePos(); } //    <span class="hljs-type"><span class="hljs-type">void</span></span> mouseReaction( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MouseEvent ev ) { //   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ev.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> == MouseEvent.<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>.WHEEL ) moveFront( -ev.whe.y * <span class="hljs-number"><span class="hljs-number">0.1</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ev.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> == ev.<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>.MOTION ) { //      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ev.isPressed( ev.Button.LEFT ) ) { auto frel = vec2( ev.rel ) * vec2(<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); auto angle = frel / rotate_coef; addRotate( angle ); } //       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ev.isPressed( ev.Button.MIDDLE ) ) { auto frel = vec2( ev.rel ) * vec2(<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); auto <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> = frel / offset_coef * sqrt( orb.len ); moveCenter( <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> ); } } } protected: <span class="hljs-type"><span class="hljs-type">void</span></span> moveFront( <span class="hljs-type"><span class="hljs-type">float</span></span> dist ) { orb += orb * dist; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( orb.len2 &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) orb = orb.e; updatePos(); } <span class="hljs-type"><span class="hljs-type">void</span></span> addRotate( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec2 angle ) { rot = normRotate( rot + angle ); orb = vec3( cos(rot.x) * cos(rot.y), sin(rot.x) * cos(rot.y), sin(rot.y) ) * orb.len; updatePos(); } <span class="hljs-type"><span class="hljs-type">void</span></span> moveCenter( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec2 <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> ) { auto lo = (look_tr.matrix * vec4(<span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)).xyz; look_tr.target += lo; updatePos(); } <span class="hljs-type"><span class="hljs-type">void</span></span> updatePos() { pos = orb + look_tr.target; } vec2 normRotate( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec2 r ) { vec2 ret = r; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ret.y &gt; y_angle_limit ) ret.y = y_angle_limit; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ret.y &lt; -y_angle_limit ) ret.y = -y_angle_limit; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } }</code> </pre><br></div></div><br><br>  But in general, that's all.  Run the dub build and get the binary in the bin folder. <br><br>  It is clear that there is little information in the article, so I suggest that interested people collect the documentation. <br>  We focused on the documentation for the <a href="https://github.com/kiith-sa/harbored-mod">harbored-mod</a> project, so if you want to generate a dock using the built-in dmd function, the result will disappoint you. <br>  For unix systems, go to the ~ / .dub / packages / des-1.3.0 folder and run path / to / harbored-mod / bin / hmod and open doc / index.html in your favorite browser.  Just do not forget about the package descore, which should lie next to the des, for him in the same way going to the documentation. <br>  There are many interesting things, ranging from linear algebra, to logging and localization systems. <br><br>  By the way, this example is in the folder des- / example / object_draw. <br><br>  I hope someone will find this useful, thank you for your attention. </div><p>Source: <a href="https://habr.com/ru/post/248119/">https://habr.com/ru/post/248119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248105/index.html">Internet test drive "Mechatronics and Robotics". Need help from the Community</a></li>
<li><a href="../248111/index.html">We write fast and economical JavaScript code</a></li>
<li><a href="../248113/index.html">Krita: Green coordinates or how to make a kangaroo from a dragon</a></li>
<li><a href="../248115/index.html">The sound on the chip AY-3-8910 (or Yamaha YM2149F) comes from the ZX Spectrum on the PC via USB</a></li>
<li><a href="../248117/index.html">evalidate: secure processing of custom expressions</a></li>
<li><a href="../248121/index.html">Apple has blocked developer accounts in Crimea</a></li>
<li><a href="../248129/index.html">Art Feature Engineering in Machine Learning</a></li>
<li><a href="../248131/index.html">International isolation made Cuba an island of hackers</a></li>
<li><a href="../248133/index.html">Status + new hell of trolling on the Internet</a></li>
<li><a href="../248135/index.html">High DPI values ‚Äã‚Äãin Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>