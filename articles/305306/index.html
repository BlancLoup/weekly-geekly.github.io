<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a multi-channel full duplex walkie-talkie</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One day knock on our help for us - to make a service radio. After a long search, the client could not find a suitable solution, so he turned to VoxImp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a multi-channel full duplex walkie-talkie</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ac9/a66/877/ac9a66877f484a16976d60348e151098.jpg" align="left" width="380">  One day knock on our help for us - to make a service radio.  After a long search, the client could not find a suitable solution, so he turned to <a href="https://voximplant.ru/">VoxImplant</a> .  We wondered what he had in mind there and whether we could implement his idea on our platform.  We rarely managed to find a script that could not be done on it.  In general, we talked, we all listened carefully and went to write code.  The radio should have been able to connect to several channels at the same time (similarly to the frequencies in analog radio sets), and also to give an opportunity to talk to one of the connected channels + it was desirable to display the activity in the channel.  Under the cut a story about how we made this service for a few hours. <a name="habracut"></a><br><br><h3>  Scheme of work </h3><br>  It is always useful to draw a diagram before starting work.  As a result of this operation, we got something like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/580/0b3/0c3/5800b30c38a34d56bc1b161478ab2341.png"></div><br>  The logic is as follows: <br><br>  1. The SDK user makes the call, the script ( <a href="https://gist.github.com/aylarov/103a1f29b4e9a3eba7da1f7ad2a2d32a">WTGatekeeper</a> ) forwards the call to the conference <br>  2. Such a conference is created for each user and is required in order to connect the incoming sound from all channels to which the user subscribes and forward the outgoing sound to the selected channel. <br>  3. The local conference handles the signal events join_channel, leave_channel, choose_channel, and also sends channel_activity, channel_connected, channel_disconnected events (see <a href="https://gist.github.com/aylarov/c4ed0fcfb4c32904cf3b25d6bcca45a3">WTUserConf</a> script) towards the user. <br>  4. Conference channels (see <a href="https://gist.github.com/aylarov/394329194339aca2e942474ecb14bf9d">WTChannelConf</a> script) simply connect all incoming calls from local conferences 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Total it turns out that one conference is created for each user and for each channel. <br><br>  Customer functionality includes: <br><br><ul><li>  channel list with corresponding controls </li><li>  the ability to subscribe to the incoming sound from the channel </li><li>  button to select the channel, where we will talk </li><li>  push-to-talk button that activates sending outgoing audio to the selected channel </li></ul><br>  To speed up the process, we created a demo application using the <a href="http://voximplant.com/docs/references/websdk/">Web SDK</a> and ReactJS.  The result is such an interface: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/768/ac4/e5c/768ac4e5cdf349a5b3f4beaa78107283.png"></div><br>  To implement the visualization of voice activity in the connected channel, we used the built-in VAD platform.  For each call, you can hang up the handler of this event and transmit information about the activity to the client: <br><br><pre><code class="javascript hljs">call.addEventListener(CallEvents.MicStatusChange, handleChannelAudio); call.handleMicStatus(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleChannelAudio</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Send info about channel audio user_call.sendMessage(JSON.stringify({ event: "channel_activity", name: e.call.number().replace("channel_", ""), active: e.active })); }</span></span></code> </pre> <br>  The visualization of activity in the channel was done as follows: <br><br><img src="https://habrastorage.org/files/7d4/f42/bb2/7d4f42bb2f284d89b33d60b687b2a42c.png" width="350"><br>  Despite the fact that everything looks simple, the VoxImplant backend performs many tasks to ensure the operation of the service.  It was nice that we managed to set it all up quickly without dancing with a tambourine. <br><br><h3>  Look at the result </h3><br>  You can independently test the resulting service and chat in one of several available channels <a href="https://demos.voximplant.com/walkietalkie/">via this link</a> .  Use Chrome / Firefox / another browser with WebRTC support. </div><p>Source: <a href="https://habr.com/ru/post/305306/">https://habr.com/ru/post/305306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305294/index.html">Summer Homework: Top 10 Microsoft Virtual Academy Courses</a></li>
<li><a href="../305296/index.html">MIPT launched an online magistracy in modern combinatorics</a></li>
<li><a href="../305298/index.html">Pass a technical interview (Level 2)</a></li>
<li><a href="../305300/index.html">Improving user interaction paths through page transitions</a></li>
<li><a href="../305304/index.html">Accidents on server farms</a></li>
<li><a href="../305308/index.html">In the footsteps of Google I / O 2016 - the new Firebase: integration with Android</a></li>
<li><a href="../305312/index.html">Review of physics in Sonic games. Parts 5 and 6: the loss of rings and being under water</a></li>
<li><a href="../305314/index.html">It seems that Github is again unavailable in Russia ... and other sites</a></li>
<li><a href="../305316/index.html">Facebook Messenger will receive end-to-end encryption</a></li>
<li><a href="../305318/index.html">Photos from Varlamov. Honest business or misunderstood law</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>