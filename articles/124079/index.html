<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Graph Export to Microsoft Excel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear Habrovchane. 

 I am a beginner SharePoint developer, and today I would like to tell you about solving one interesting problem. It was ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Graph Export to Microsoft Excel</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear Habrovchane. <br><br>  I am a beginner SharePoint developer, and today I would like to tell you about solving one interesting problem.  It was necessary to make a web part for SharePoint, which should process the table with data, display the graph on the screen, and also be able to export the table and graph to Microsoft Excel.  Under the cut is my solution, snippets of the web part code and a link to the project. <br><a name="habracut"></a><br><h5>  Theoretical solution </h5><br><h6>  1. Construction of graphics on the page. </h6><br>  The most convenient way to do this is using <a href="http://habrahabr.ru/blogs/net/96774/">MS Chart Control</a> .  The process itself is quite simple (although, of course, it depends on the type of graphics you need).  The only requirement is that the first column in the table is the values ‚Äã‚Äãfor the x axis on the graph. <br><br><h6>  2. Export spreadsheet to Excel </h6><br>  There are many ways to export, but I decided to use the simplest (in my opinion).  As is known, in Office 2007/2010 for .docx, .xlsx, pptx files the Open XML format is used, that is, these files are a simple ZIP archive with XML files.  Working with ZIP archives is simple, and thus you can write data directly into XML files. <br>  However, it turned out that it was not so easy to write down a table with column names.  Excel writes numeric fields directly to sheet1.xml, and writes text fields to sharedStrings.xml, and only references to them are sent to sheet1.xml.  Fortunately, I found a <a href="http://www.codeproject.com/KB/office/OpenXML.aspx">wonderful project</a> that implements writing text values ‚Äã‚Äãto an xlsx file. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  3. Export graphics to Excel </h6><br>  Naturally, simply inserting a picture with a chart will not work, it should be a real Excel chart.  Google did not tell me anything worthwhile - either it doesn‚Äôt fit or it‚Äôs too difficult.  Having worked a bit with graphs in Excel, I noticed an interesting feature - if you specify data areas from which the graph will take values, and then change the cell value, the graph changes automatically.  The idea came by itself - to create an empty file with a chart, then write a table to it, then use XML editing to specify the data areas for the chart (in this project I had a dynamic table, so the dimensions were calculated in code). <br><br><h5>  Practical solution </h5><br>  For example, I decided to create a simple web part with a tablet, two buttons and a graph (it is initially hidden).  Since we will need to export the names of the table columns, it is necessary to enter them in the first line, and disable ShowHeader. <br><pre><code class="cs hljs">DataTable dt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataTable(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Page_Load</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>;i++ ) dt.Columns.Add(); dt.Rows.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span> }); dt.Rows.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"17"</span></span>, <span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-string"><span class="hljs-string">"8"</span></span> }); dt.Rows.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-string"><span class="hljs-string">"18"</span></span>, <span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-string"><span class="hljs-string">"10"</span></span> }); dt.Rows.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-string"><span class="hljs-string">"15"</span></span>, <span class="hljs-string"><span class="hljs-string">"6"</span></span>, <span class="hljs-string"><span class="hljs-string">"9"</span></span> }); dt.Rows.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>, <span class="hljs-string"><span class="hljs-string">"7"</span></span>, <span class="hljs-string"><span class="hljs-string">"10"</span></span> }); dt.Rows.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { <span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-string"><span class="hljs-string">"13"</span></span>, <span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-string"><span class="hljs-string">"7"</span></span> }); GridView1.DataSource = dt; GridView1.DataBind(); GridView1.Width = <span class="hljs-number"><span class="hljs-number">300</span></span>; GridView1.ShowHeader = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Now we make a conclusion of the schedule  We take into account that the data starts from the 2nd row, and the 1st column is the values ‚Äã‚Äãfor the X axis. <br><pre> <code class="cs hljs"> Series[] series = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Series[dt.Columns.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; series.Length; i++) { series[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Series(dt.Columns[i + <span class="hljs-number"><span class="hljs-number">1</span></span>].ColumnName); series[i].ChartType = SeriesChartType.Column; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = <span class="hljs-number"><span class="hljs-number">1</span></span>; k &lt; dt.Rows.Count; k++) series[i].Points.AddXY((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.Parse((<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)dt.Rows[k][<span class="hljs-number"><span class="hljs-number">0</span></span>])), <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.Parse((<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)dt.Rows[k][i + <span class="hljs-number"><span class="hljs-number">1</span></span>])); Chart1.Series.Add(series[i]); } ChartArea chartArea = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartArea(); chartArea.AxisX.Minimum = <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.Parse(dt.Rows[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>].ToString()); chartArea.AxisX.Maximum = <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>.Parse(dt.Rows[dt.Rows.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>].ToString()); Chart1.ChartAreas.Add(chartArea); Chart1.Width = <span class="hljs-number"><span class="hljs-number">300</span></span>; Chart1.Visible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  We proceed to export.  The first thing you need is a template (an empty file with a graph).  Create a new workbook in Excel, insert a graph, specify the data areas.  Save, close.  You can edit a little directly through xml - delete cached values, if the table is not of a fixed size - then you can substitute your numbers as data areas (I cheated so - then I simply replace these numbers with Replace with necessary ones).  The template should be thrown into the root folder of the Sharepoint node. <br>  Using the above <a href="http://www.codeproject.com/KB/office/OpenXML.aspx">project</a> , we are developing it for our purposes - first we will create a copy of the 1st row of the table (column names).  With the help of HashTable we will create links to this text data, and we will write the data in sharedStrings.xml. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> ArrayList </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStringTables</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataTable data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Hashtable lookupTable</span></span></span><span class="hljs-function">)</span></span> { ArrayList stringTable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList(); lookupTable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hashtable(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (DataRow row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.Rows) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (DataColumn column <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data.Columns) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (column.DataType == <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> val = (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)row[column]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!lookupTable.Contains(val)) { lookupTable.Add(val, stringTable.Count); stringTable.Add(val); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stringTable; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteStringTable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream output, ArrayList stringTable</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (XmlTextWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlTextWriter(output, Encoding.UTF8)) { writer.WriteStartDocument(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;sst xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" count=\""</span></span> + stringTable.Count.ToString() + <span class="hljs-string"><span class="hljs-string">"\" uniqueCount=\""</span></span> + stringTable.Count.ToString() + <span class="hljs-string"><span class="hljs-string">"\"&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> str <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> stringTable) { writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;si&gt;&lt;t&gt;"</span></span> + str + <span class="hljs-string"><span class="hljs-string">"&lt;/t&gt;&lt;/si&gt;"</span></span>); } writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/sst&gt;"</span></span>); } }</code> </pre> <br>  Now we will transform the data table into xml-code, simultaneously inserting references to text data.  We write everything in the sheet1.xml file. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteWorksheetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XmlTextWriter writer, DataTable dt, Hashtable lookupTable</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowsCount = dt.Rows.Count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnsCount = dt.Columns.Count; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> relPos = RowIndexToName(<span class="hljs-number"><span class="hljs-number">0</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;row r=\""</span></span> + relPos + <span class="hljs-string"><span class="hljs-string">"\" spans=\"1:"</span></span> + columnsCount.ToString()+<span class="hljs-string"><span class="hljs-string">"\"&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> column = <span class="hljs-number"><span class="hljs-number">0</span></span>; column &lt; columnsCount; column++) { relPos = RowColumnToPosition(<span class="hljs-number"><span class="hljs-number">0</span></span>, column); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;cr=\""</span></span> + relPos + <span class="hljs-string"><span class="hljs-string">"\" t=\"s\"&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> val = lookupTable[dt.Rows[<span class="hljs-number"><span class="hljs-number">0</span></span>][column]].ToString(); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;v&gt;"</span></span> + val + <span class="hljs-string"><span class="hljs-string">"&lt;/v&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/c&gt;"</span></span>); } writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/row&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> row = <span class="hljs-number"><span class="hljs-number">1</span></span>; row &lt; rowsCount; row++) { relPos = RowIndexToName(row); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;row r=\""</span></span> + relPos + <span class="hljs-string"><span class="hljs-string">"\" spans=\"1:"</span></span> + columnsCount.ToString() + <span class="hljs-string"><span class="hljs-string">"\"&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> column = <span class="hljs-number"><span class="hljs-number">0</span></span>; column &lt; columnsCount; column++) { relPos = RowColumnToPosition(row, column); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;cr=\""</span></span> + relPos + <span class="hljs-string"><span class="hljs-string">"\"&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> val = dt.Rows[row][column].ToString(); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;v&gt;"</span></span> + val + <span class="hljs-string"><span class="hljs-string">"&lt;/v&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/c&gt;"</span></span>); } writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/row&gt;"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteWorksheet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream output, DataTable dt, Hashtable lookupTable</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (XmlTextWriter writer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlTextWriter(output, Encoding.UTF8)) { writer.WriteStartDocument(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;worksheet xmlns=\"http://schemas.openxmlformats.org/spreadsheetml/2006/main\" xmlns:r=\"http://schemas.openxmlformats.org/officeDocument/2006/relationships\"&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> lastCell = RowColumnToPosition(dt.Rows.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>, dt.Columns.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;dimension ref=\"A1:"</span></span> + lastCell + <span class="hljs-string"><span class="hljs-string">"\" /&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;sheetViews&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;sheetView tabSelected=\"1\" workbookViewId=\"0\" /&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/sheetViews&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;sheetFormatPr defaultRowHeight=\"15\" /&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;sheetData&gt;"</span></span>); WriteWorksheetData(writer, dt, lookupTable); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/sheetData&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;pageMargins left=\"0.7\" right=\"0.7\" top=\"0.75\" bottom=\"0.75\" header=\"0.3\" footer=\"0.3\" /&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;drawing r:id=\"rId1\" /&gt;"</span></span>); writer.WriteRaw(<span class="hljs-string"><span class="hljs-string">"&lt;/worksheet&gt;"</span></span>); } }</code> </pre> <br>  It remains to remember to change the data area.  Since in the initial project I could have no more than five columns - I created a template with five columns, and then deleted the extra ones.  The number of rows is calculated simply from the table. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FieldEdit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream xmlFile, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rowsCount, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> columnsCount</span></span></span><span class="hljs-function">)</span></span> { XmlDocument document = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XmlDocument(); document.Load(xmlFile); XmlNodeList xmlColumns = document.GetElementsByTagName(<span class="hljs-string"><span class="hljs-string">"c:ser"</span></span>); XmlNode xmlChart = xmlColumns[<span class="hljs-number"><span class="hljs-number">0</span></span>].ParentNode; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = xmlColumns.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt; columnsCount - <span class="hljs-number"><span class="hljs-number">2</span></span>; i--) xmlColumns[i].ParentNode.RemoveChild(xmlColumns[i]); XmlNodeList xmlRows = document.GetElementsByTagName(<span class="hljs-string"><span class="hljs-string">"c:f"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; xmlRows.Count; i++) xmlRows[i].InnerText = xmlRows[i].InnerText.Replace(<span class="hljs-string"><span class="hljs-string">"15"</span></span>, rowsCount.ToString()); MemoryStream ms = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(); document.Save(ms); xmlFile.SetLength(ms.Length); xmlFile.Position = <span class="hljs-number"><span class="hljs-number">0</span></span>; document.Save(xmlFile); ms.Close(); }</code> </pre> <br>  And our file is ready!  We give it to the user for saving / loading using HttpContext.Current.Response. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] fileContent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> outFileName</span></span></span><span class="hljs-function">)</span></span> { HttpContext.Current.Response.ClearContent(); HttpContext.Current.Response.AddHeader(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/force-download"</span></span>); HttpContext.Current.Response.AddHeader(<span class="hljs-string"><span class="hljs-string">"Content-Disposition"</span></span>, String.Format(<span class="hljs-string"><span class="hljs-string">"attachment; filename={0}"</span></span>, outFileName.Replace(<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"_"</span></span>))); HttpContext.Current.Response.AddHeader(<span class="hljs-string"><span class="hljs-string">"Content-Length"</span></span>, fileContent.Length.ToString()); HttpContext.Current.Response.OutputStream.Write(fileContent, <span class="hljs-number"><span class="hljs-number">0</span></span>, fileContent.Length); HttpContext.Current.Response.OutputStream.Flush(); HttpContext.Current.Response.OutputStream.Close(); HttpContext.Current.Response.Flush(); HttpContext.Current.ApplicationInstance.CompleteRequest(); }</code> </pre> <br>  I did not publish all the code here - it is too big, and the entire project (with detailed comments and an empty template) can be downloaded <a href="http://narod.ru/disk/18839339001/ExcelChart.zip.html">here</a> . <br><br><h6>  Notes: </h6><br><ul><li>  Initially, the project was made for SP2007 in VS2008, and ported to 2010 specifically for Habr.  Therefore, not all features of the 2010 version are used. </li><li>  The code is written as an example, as simple as possible, without unnecessary (in this case) try-catch, etc.  The main thing was to show the idea, not the implementation. </li><li>  This method can be used not only with SharePoint, but it is the most common combination with Excel. </li><li>  I'm just learning, so I‚Äôm happy to hear your advice and indications of my mistakes. </li></ul><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/124079/">https://habr.com/ru/post/124079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124071/index.html">Using the Yandex.Metrika API to display statistics</a></li>
<li><a href="../124074/index.html">QAForum2011 - teaching in battle or TeamLab as Pavlov's dog</a></li>
<li><a href="../124075/index.html">Connecting a GPS receiver to a laptop and creating a GPS tracker</a></li>
<li><a href="../124077/index.html">We connect AdMob advertising in Marmalade (extension for Android OS)</a></li>
<li><a href="../124078/index.html">Creating a dynamic proxy object using the dynamic type</a></li>
<li><a href="../124080/index.html">Protection from unauthorized copying applications Blackberry PlayBook</a></li>
<li><a href="../124082/index.html">Installing SMS Linux (Slackware) on eBox-2300SX</a></li>
<li><a href="../124086/index.html">Chinese iPad 3</a></li>
<li><a href="../124088/index.html">QIWI Wallet no longer works with VKontakte rubles (earned again 07/19/11)</a></li>
<li><a href="../124089/index.html">Support for Web Sockets reverse proxying in Nginx</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>