<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating Android Development: the Beginning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Two weeks ago, the School of Development Process Automation (SHAPR) ended in St. Petersburg Yandex. 
 Looking ahead, I will say that the teachers mana...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating Android Development: the Beginning</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/09a/dc8/8b1/09adc88b1a914de4b4304e455a08cbcc.png" width="450" align="right"><br>  Two weeks ago, the <a href="http://academy.yandex.ru/events/autoschool/spb-2014/">School of Development Process Automation</a> (SHAPR) ended in St. Petersburg Yandex. <br>  Looking ahead, I will say that the teachers managed the most important thing: in less than three months, they ‚Äúspoiled‚Äù our perception of the development process, as promised at the beginning of the School.  Manual testing and assembly began to be terribly annoying, evoking thoughts like "and now, instead of performing routine operations, I could write beautiful code ...". <br><br>  You can read more about how they did it <a href="http://habrahabr.ru/company/yandex/blog/245869/">here</a> and a little more <a href="http://habrahabr.ru/company/yandex/blog/237017/">here</a> . <br><br>  In the practical part of the training, we implemented a web blog based on the technologies listed above. <br>  As an android developer, I was interested in the possibility of using these technologies and tools for organizing Continuous Integration for Android. <br>  Inspired by the <a href="http://habrahabr.ru/company/e-Legion/blog/244279/">report of Alexey</a> Korovyansky on MBLTDev, and, especially, the results of <a href="https://developers.google.com/google-test-automation-conference/2014/presentations">Google Test Automation Conference 2014</a> regarding the <a href="http://www.youtube.com/watch%3Fv%3D-xQCNf_5NNM%26list%3DPLSIUOFhnxEiDFckNDSjKWqOCtd8ksJrh4%26index%3D1">testing of Android applications</a> , I implemented a simplified analogue of our training project for another platform, transferring everything that I could and succeeded.  At this preface ends and begins the actual description of automation. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  1. Automated Testing </h1><br>  We say automation, we mean - tests;  we say tests, we mean - automation. <br>  Testing is often one of the most resource-intensive parts of the development process.  You can change the text on the button in a couple of minutes (including the IDE launch time), build the project in a couple of minutes - and then check for a few hours if the layout did not go in all the places where the button was used at all the screen resolutions.  If this process is not automated, of course. <br><br>  Fortunately, in December 2014, Google still pleased the android developers by <a href="https://code.google.com/p/android-test-kit/">including the</a> Espresso framework in the Android Support Repository.  Hooray!  Finally, we have a powerful, fairly stable tool for writing system tests, which is supported by the developer of the operating system (among other things, it gives hope that the tests will not sprinkle with the release of the new version of Android). <br>  About Espresso on Habr√© <a href="http://habrahabr.ru/post/212425/">has already been written</a> , so I‚Äôll confine myself to noticing that in the current version it allows you to synchronize operations in tests not only with UI Thread and AsyncTasks, but also with <a href="https://code.google.com/p/android-test-kit/wiki/EspressoSamples">arbitrary background operations</a> (http requests, for example).  An example of the implementation of system and integration tests can be found in my project on github, the link at the end of the article. <br><br><h1>  2. Automated build </h1><br>  In our enlightened age, there is probably no need to describe the benefits of using assembly systems. <br>  In SHAPR, we used Maven, but under Android Studio with its Gradle support ‚Äúout of the box,‚Äù something else is just uncomfortable to use. <br>  Tasks were used to run tests. <br><ul><li>  connectedAndroidTest - from the list of typical gradle tasks </li><li>  <a href="https://github.com/square/spoon">spoon</a> - appears when you install the appropriate plug-in.  Very useful development team Square under the guidance of the notorious Jake Wharton.  Allows you to run tests on several connected android devices at the same time, take screenshots of them, and much more </li></ul><br><div class="spoiler">  <b class="spoiler_title">Here are the test results in the interpretation of Gradle 2.2.1</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/4ed/16c/319/4ed16c319e3c421887107dc59e182a73.png" alt="image"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">And since the result of running tests for three devices (two virtual and one real) will simultaneously show Spoon.</b>  <b class="spoiler_title">Detail by clicking on a specific test is present</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d38/877/f8c/d38877f8c9544c75b8aed5457d6a87b6.png" alt="image"><br></div></div><br><h1>  3. Automated run tests </h1><br>  If by some miracle you are not using Maven or Gradle, then you can not read further - not a single server of continuous integration with your project will be friends. <br>  And if you use it, after several launches of several tens / hundreds of tests to the project, you have a great desire to have it all happen on its own, and, preferably, as far as possible from your processor :-).  This is where Jenkins comes to the rescue (TeamCity, Atlassian Bamboo, underline).  I used Jenkins, which we were taught in the Shapr.  About Jenkins and even directly his relationship with Android applications on Habr√© <a href="http://habrahabr.ru/post/205308/">is</a> also <a href="http://habrahabr.ru/post/205308/">written a</a> lot. <br>  In our case, in addition to the default plugins, we used <br><ul><li>  GitHub plugin, GIT plugin, GitHub API Plugin - to get code and capture events from github </li><li>  Gradle plugin - to run gradle tasks </li><li>  Android Emulator Plugin - to run an application on an emulator (then abandoned this idea in favor of spoon) </li><li>  HTML Publisher plugin - for publishing a description of the results of executing tests of an arbitrary format on the task page </li><li>  JUnit Plugin - to publish the results of unit tests </li></ul><br><div class="spoiler">  <b class="spoiler_title">The result is as follows</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/4c1/dce/c7a/4c1dcec7a3bd4376a0acd3709f98e873.png" alt="image"><br></div></div><br>  In general, the launch of tests on real devices and virtual images of <a href="https://www.genymotion.com/">genymotion</a> showed better results in speed, stability and realism than the standard Android emulator from Google, so I refused to use it in testing at the moment. <br><br><h1>  4. A few words about the separation of environments </h1><br>  We are talking about using different, for example, databases for testing and production.  To do this, the code must translate various settings.  In the model project this is implemented with the help of gradle build flavors, the variables are put into a separate file with constants, which the plug-in substitutes into the desired build. <br><br>  <strong>So, what is the partially automated development process for a model android application at the moment:</strong> <br>  1. The written code leaves on github. <br>  2. Jenkins catches a hook with github and runs the build on all android devices that are running / connected to the server / node <br>  3. According to the results of the assembly, Jenkins unsubscribes on github / sends a letter to the developer / lights a red or green light bulb above the door (underline the appropriate) <br>  4. If the build is successful, the installation file is uploaded to the test devices, and the handy testers receive a notification that they can start work (if necessary) <br>  5. It is even possible to automatically publish the assembled project to GooglePlay using the Google Play Android Publisher Plugin. <br><br>  <strong>TODO</strong> : Unfortunately, we have not yet had time to raise the <a href="http://nemo.sonarqube.org/">SonarQube</a> , although at the Shapr we managed to visually evaluate the usefulness and importance of code analysis tools.  Yes, and code coverage in the test project is not considered yet.  I did not have time to use the mechanism of dependency injection, which is very convenient for writing well-tested code - for Android, there is a wonderful <a href="https://square.github.io/dagger/">Dagger</a> library for this.  In general, there is more to do. <br><br>  Promised <strong><a href="https://github.com/mike-stetsenko/Twister-Blog-Android">link to a model project</a></strong> (a blog with the ability to add / remove posts / comments) and a dozen tests to it.  Do not judge the code too strictly, because in order to test it makes sense, it must break sometimes, right?  ;-) <br><br>  The project used libraries: <br><ul><li>  robospice </li><li>  retrofit and okhttp </li><li>  androidannotations </li><li>  cupboard </li><li>  well and of course espresso </li></ul><br>  Taking this opportunity, I want to sincerely thank our instructors at Shapr and Yandex as a whole. <br>  You once again made the world a little bit better.  Thank!  :-) </div><p>Source: <a href="https://habr.com/ru/post/250011/">https://habr.com/ru/post/250011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249999/index.html">I used dictation and voice control for a week and this is what happened</a></li>
<li><a href="../250001/index.html">The effect of drip transform in CSS</a></li>
<li><a href="../250005/index.html">Sticky effect</a></li>
<li><a href="../250007/index.html">10 bugs in Ruby / Ruby on Rails that are easy to fix</a></li>
<li><a href="../250009/index.html">Writing from scratch a quest for ASP.NET 5 (vNext) and Angular.js</a></li>
<li><a href="../250015/index.html">Stop using passwords in Plesk</a></li>
<li><a href="../250021/index.html">Getting rid of JavaScript in social buttons (Facebook, VK, Twitter, etc.)</a></li>
<li><a href="../250023/index.html">Limiting the number of attempts to enter a password in the authorization web form using Nginx or HAProxy using the example of WordPress</a></li>
<li><a href="../250025/index.html">Git game or in search of Linus Torvalds</a></li>
<li><a href="../250027/index.html">Export Favorites on Habr√© to PDF. Version 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>