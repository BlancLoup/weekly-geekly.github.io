<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cacti: Monitoring SMART</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Data recovery as a result of the "physical death" of the information carrier is not the most pleasant pastime in the life of any system administrator....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cacti: Monitoring SMART</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8a8/b26/074/8a8b26074461831b641787110fb3bb1c.jpg"><br><br>  Data recovery as a result of the "physical death" of the information carrier is not the most pleasant pastime in the life of any system administrator.  Consequently, the longer hours to correct the situation, and we have a lot of data, it is better to prevent it - by organizing monitoring. <br><br>  Hard and solid-state drives have built-in technology that allows you to make independent self-diagnostics - SMART, and we will work with it. <br>  <a title="S.M.A.R.T" href="http://ru.wikipedia.org/wiki/S.M.A.R.T.">SMART</a> is a technology for evaluating the state of a hard disk with built-in self-diagnostic equipment, as well as a mechanism for predicting the time of its failure. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      SMART is not a panacea for all ills, but certain information and some planning, through the data obtained, can be done on time, thereby making life a little easier. <br><br>  The source server is Linux CentOS 6, which functions as a file storage. <br><br>  Linux contains a group of packages called <b>Smartmontools</b> , which are a set of utilities for checking the status of disks.  Directly configuring a smartd daemon for regular testing and monitoring of SMART is beyond the scope of this article, those interested can independently find configuration examples on the Internet. <br><br>  We are also interested in the graphical display of key parameters, the anomalous change of which can sometimes be seen only visually.  And this will help us <b>Cacti</b> . <br><a name="habracut"></a><br>  <b>1) To begin with, we install the smartmontools package:</b> <br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">yum</span></span> provides <span class="hljs-string"><span class="hljs-string">"smartctl*"</span></span> <span class="hljs-comment"><span class="hljs-comment"># 1:smartmontools-5.43-1.el6.x86_64 : Tools for monitoring SMART capable hard disks # yum install smartmontools</span></span></code> </pre> <br>  After installation, you can check the disk parameters: <br><pre> <code class="bash hljs">smartctl -a DEVICE</code> </pre><br>  As a rule, instead of ‚ÄúDEVICE‚Äù there will be something like / dev / sda (first disk), / dev / sdb (second). <br>  Sometimes it is necessary to force SMART on the disk: <br><pre> <code class="bash hljs">smartctl -s on DEVICE</code> </pre><br>  Currently, SMART technology is not available for USB drives, despite the fact that the drive inside the box can give the necessary information. <br><br>  Getting SMART requires certain privileges, they are usually absent from the SNMPd daemon, so the main work on collecting intermediate data will be via the <b>CRON script</b> : <br><pre> <code class="bash hljs">cat /etc/snmp/smart-cronjob <span class="hljs-comment"><span class="hljs-comment"># where to keep the files STORE=/tmp/snmp # update smart parameters for devfull in /dev/sd?; do dev=`basename $devfull` /usr/sbin/smartctl -n idle -a $devfull &gt;$STORE/smart-$dev.TMP mv $STORE/smart-$dev.TMP $STORE/smart-$dev done</span></span></code> </pre><br>  Do not forget to create the directory / tmp / snmp and place the launch in CRON <br><pre> <code class="bash hljs">cat /etc/crontab |grep smart */5 * * * * root /etc/snmp/smart-cronjob</code> </pre><br>  This code is looking for devices "/ dev / sd?"  (/ dev / sda, / dev / sdb, etc.) and tries to write their SMART data to a file. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#ll /dev/sd? brw-rw---- 1 root disk 8, 0 Oct 25 14:42 /dev/sda brw-rw---- 1 root disk 8, 16 Oct 25 14:42 /dev/sdb brw-rw---- 1 root disk 8, 32 Oct 25 14:42 /dev/sdc brw-rw---- 1 root disk 8, 48 Oct 25 14:42 /dev/sdd brw-rw---- 1 root disk 8, 64 Oct 25 14:42 /dev/sde brw-rw---- 1 root disk 8, 80 Oct 25 14:42 /dev/sdf</span></span></code> </pre><br>  All SMART parameters have a sequence number.  The corresponding numbering will be used in the PERL script, instead of considering each parameter by itself. <br><img src="https://habrastorage.org/getpro/habr/post_images/791/94b/414/79194b414f679b383c546ea39ae6ad95.png"><br><br>  <a href="">Perl script to retrieve SMART parameters for SNMP (smart-generic)</a> <br><br>  We expose the script to execute: <br><pre> <code class="bash hljs">chmod +  /etc/snmp/smart-generic</code> </pre><br>  This script takes the SMART parameter number and displays the difference between the current value and the trashhold (threshold) for this parameter. <br><br>  It should be noted that, depending on the manufacturer, model or firmware version, trashholds may be different.  Therefore, the value itself does not represent a great interest, but unusual fluctuations or downward trends should be taken into account.  For temperature, as a rule, you need to get an instantaneous value. <br><br>  Add snmpd.conf <a href="">lines</a> (or others if you want to control ‚Äúyour‚Äù indicators. You can <a href="http://ru.wikipedia.org/wiki/S.M.A.R.T.">get a</a> general idea of ‚Äã‚Äãthe parameters <a href="http://ru.wikipedia.org/wiki/S.M.A.R.T.">in Wikipedia</a> ): <br><pre> <code class="bash hljs">extend smartdevices /etc/snmp/smart-generic devices extend smartdescriptions /etc/snmp/smart-generic description extend smart1 /etc/snmp/smart-generic 1 extend smart3 /etc/snmp/smart-generic 3 extend smart4 /etc/snmp/smart-generic 4 extend smart5 /etc/snmp/smart-generic 5 extend smart7 /etc/snmp/smart-generic 7 extend smart9 /etc/snmp/smart-generic 9 extend smart10 /etc/snmp/smart-generic 10 extend smart12 /etc/snmp/smart-generic 12 extend smart170 /etc/snmp/smart-generic 170 extend smart171 /etc/snmp/smart-generic 171 extend smart172 /etc/snmp/smart-generic 172 extend smart177 /etc/snmp/smart-generic 177 extend smart178 /etc/snmp/smart-generic 178 extend smart179 /etc/snmp/smart-generic 179 extend smart180 /etc/snmp/smart-generic 180 extend smart181 /etc/snmp/smart-generic 181 extend smart182 /etc/snmp/smart-generic 182 extend smart183 /etc/snmp/smart-generic 183 extend smart184 /etc/snmp/smart-generic 184 extend smart187 /etc/snmp/smart-generic 187 extend smart189 /etc/snmp/smart-generic 189 extend smartR190 /etc/snmp/smart-generic R190 extend smartR194 /etc/snmp/smart-generic R194 extend smart195 /etc/snmp/smart-generic 195 extend smart196 /etc/snmp/smart-generic 196 extend smart199 /etc/snmp/smart-generic 199 extend smart203 /etc/snmp/smart-generic 203 extend smart226 /etc/snmp/smart-generic 226 extend smart230 /etc/snmp/smart-generic 230 extend smart231 /etc/snmp/smart-generic 231 extend smart232 /etc/snmp/smart-generic 232 extend smart233 /etc/snmp/smart-generic 233 extend smart235 /etc/snmp/smart-generic 235 extend smart241 /etc/snmp/smart-generic 241</code> </pre><br><br>  Restart the daemon and check the output (you need to substitute your "SNMP_Community" and "host_name"): <br><pre> <code class="bash hljs">snmpwalk -v2c -c SNMP_Community host_name NET-SNMP-EXTEND-MIB::nsExtendOutLine NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="hljs-string"><span class="hljs-string">"smart1"</span></span>.1 = STRING: 101 NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="hljs-string"><span class="hljs-string">"smart1"</span></span>.2 = STRING: 101 ... NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="hljs-string"><span class="hljs-string">"smartdevices"</span></span>.1 = STRING: sda NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="hljs-string"><span class="hljs-string">"smartdevices"</span></span>.2 = STRING: sdb NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="hljs-string"><span class="hljs-string">"smartdescriptions"</span></span>.1 = STRING: WDC WD2003FYYS-... [01.01D01] 2 TB NET-SNMP-EXTEND-MIB::nsExtendOutLine.<span class="hljs-string"><span class="hljs-string">"smartdescriptions"</span></span>.2 = STRING: WDC WD2003FYYS-... [01.01D01] 2 TB</code> </pre><br>  <b>2. Cacti Templates</b> <br><br>  <a href="">The archive</a> contains the <a href="">main template</a> containing all the parameters on the same graph.  In a separate graph displayed temperature. <br><br>  To work, you must move the mapping file disk_smart.xml to / resource / snmp_queries / <br>  And import cacti_host_template_smart_parameters.xml into a cactus. <br><img src="https://habrastorage.org/getpro/habr/post_images/e47/159/e90/e47159e908fe68169bbc5901e31a4980.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/981/31d/535/98131d535e2f013fd84a014184a7dfa3.png"><br><br>  If everything is configured correctly, the status of the polled objects should appear when the ‚ÄúDisk SMART Parameters‚Äù is added to the Associated Data Queries device. <br><img src="https://habrastorage.org/getpro/habr/post_images/6e1/859/a43/6e1859a438e7e6b8eb9e5dea0cfb8f9a.png"><br>  Do not forget to choose the right template when creating graphs directly.  By default, graphics are built for SSD drives (AGILITY3), which is not entirely correct. <br><img src="https://habrastorage.org/getpro/habr/post_images/c91/a29/430/c91a294308ce3b8891c6b942efbc9310.png"><br><br>  <b>3. Examples of graphs:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/496/e16/eb4/496e16eb4261d4f630d81994dcef5be6.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/76c/fa8/530/76cfa8530bb34aab936602877db6ac7a.png"><br><br>  The article is based on the material <a href="http://www.pitt-pladdy.com/blog/_20091031-144604_0000_SMART_stats_on_Cacti_via_SNMP_/">SMART stats on Cacti (via SNMP)</a> </div><p>Source: <a href="https://habr.com/ru/post/173443/">https://habr.com/ru/post/173443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../173427/index.html">Simple solution for vertical shooting of devices and other tricks when creating reviews</a></li>
<li><a href="../173429/index.html">Rambler launches Themed Major</a></li>
<li><a href="../173431/index.html">Zpower: ultra compact? ultra expensive!</a></li>
<li><a href="../173433/index.html">Development Prospects: Singularity and "Reasonable Governance"</a></li>
<li><a href="../173437/index.html">Creating a single Exchange Address Book for two or more Active Directory forests</a></li>
<li><a href="../173445/index.html">Russian look at Tech Peaks: how to get the opportunity to run your startup in Trento</a></li>
<li><a href="../173447/index.html">JavaScript tail recursion emulation</a></li>
<li><a href="../173453/index.html">Git for Photos. Large Git Repositories</a></li>
<li><a href="../173455/index.html">Poll on the specifics of testing when developing applications for Android?</a></li>
<li><a href="../173459/index.html">Tumbler Sites, or Welcome to the FailOver Conference on April 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>