<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Acquaintance with the programming language Deluge. Creating an arbitrary function in the Zoho CRM system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In early 2015, I published an article about Zoho CRM , in which I described the functionality of this system, but did not consider the issues of its r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Acquaintance with the programming language Deluge. Creating an arbitrary function in the Zoho CRM system</h1><div class="post__text post__text-html js-mediator-article">  In early 2015, I published <a href="https://habrahabr.ru/company/trinion/blog/248281/">an article about Zoho CRM</a> , in which I described the functionality of this system, but did not consider the issues of its refinement.  Now I decided to tell about the revisions in more detail, since in practice this turned out to be very relevant.  I have been working with the system for more than a year, and it is often necessary to refine it for certain user requests. <br><br>  Refinements of the Zoho CRM system are made in the Deluge language, developed by Zoho itself.  Deluge is also integrated into the Zoho Creator product, but in this article we will look at using the language specifically in Zoho CRM. <br><br><a name="habracut"></a><br><h4>  What is a Deluge? </h4><br>  Definition from the site (translation from the site). <br><blockquote>  <i>Deluge (Data Enriched Language for the Universal Grid Environment) is an online programming language that helps add various types of business logic to arbitrary functions and make them more powerful.</i> <br></blockquote><br><h4>  Deluge and ZOHO CRM </h4><br>  In Zoho CRM, the <a href="https://www.zoho.com/creator/help/script/">Deluge</a> language is used when writing the so-called Custom function. <br><blockquote>  <i>Custom function is an arbitrary function that allows you to modify the behavior of the system in accordance with the wishes of users, without being tied to any predefined settings.</i> </blockquote><br>  Where do I propose to begin acquaintance with this language?  There are many examples of its use on the Zoho website, but I decided to give a real example from my practice.  A very simple and illustrative example in which the main points of working with a language and demonstration of its capabilities will be seen. <br> <a href="https://trinion.org/node/106"><img src="https://habrastorage.org/webt/ua/jt/j4/uajtj48_bch89gaathuqltr-sjg.jpeg" align="left"></a> <br><h4>  Example Description </h4><br>  We consider how to create a function that was implemented on one of the projects.  The feature is called Contacts Phone Validate.  The task of the function is to verify that the users have filled in the phone number of the contact person in Zoho CRM. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The function should work as follows: <br><br><ul><li>  the user enters the phone number of the contact person in Zoho CRM </li><li>  if the phone is entered in the wrong format, the system reports an error by sending an email </li><li>  if there is no error in the input format - the phone number is added to the system </li></ul><br>  The phone may be wrong for several reasons: <br><br><ul><li>  If it is entered in the wrong format </li><li>  If such a number is already in the system </li></ul><br>  So, let's look at this example, how the creation of an arbitrary function in the Zoho CRM system takes place by means of the Deluge language. <br><br>  The function is configured directly in the Zoho CRM user account and is available to users with rights to control the Workflow workflow. <br><br>  At once I want to draw your attention to the fact that in view of the non-ideal localization of the Zoho CRM system, we will consider setting up the function in English. <br><br><h4>  Add arbitrary function </h4><br>  Adding an arbitrary function includes the steps: <br><br><ul><li>  Function programming </li><li>  Associating a function with a Workflow Rules workflow rule </li></ul><br>  Consider in detail each of the stages. <br><br><h4>  1. Programming function </h4><br>  In order to program an arbitrary function, follow these steps: <br><br>  1. Go to Setup&gt; Automation&gt; Workflow&gt; Custom Function <br>  2. On the Custom Functions page, click Configure Custom Function <br>  3. Next, click Write your own. <br><br><img src="https://habrastorage.org/files/b45/fbe/768/b45fbe768d72425396d3c3adabb7e0d1.png"><br><br>  4. In the window that opens, do the following: <br><br><ul><li>  Specify the name of the function.  Our function will be called ContactsPhoneValidate.  Next, click on the link Edit Arguments. </li><li>  Select the system module in which the function will operate.  In our case, this is the Contacts module.  Match these functions with the field name or with the required value in the CRM module.  In our example, the function parameter is contactPhone, which corresponds to the Phone field in the Contacts module. </li></ul><br><img src="https://habrastorage.org/files/af1/f74/d9e/af1f74d9e4034c2cbc4817dda5088537.png"><br><br><ul><li>  Click Done </li></ul><br>  5. Write the required function in the Deluge Script Designer. <br><br>  In our example, the function looked like this.  We declare variables: <br><br><pre><code class="hljs sql">mapVariable=map();//    Map ( https://www.zoho.com/creator/<span class="hljs-keyword"><span class="hljs-keyword">help</span></span>/script/<span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-map.html ) errorType=<span class="hljs-string"><span class="hljs-string">""</span></span>; //     </code> </pre> <br>  We check the correctness of the input format and territorial affiliation: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.contactPhone.startsWith(("+7"))) //   +<span class="hljs-number"><span class="hljs-number">7</span></span>,     + { errorType="     7XXXXXXXXXX!"; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.contactPhone.startsWith(("+89"))) //    +<span class="hljs-number"><span class="hljs-number">89</span></span> { errorType=(" +89   ZOHO CRM!"); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.contactPhone.startsWith(("+84"))) //    +<span class="hljs-number"><span class="hljs-number">84</span></span> { errorType=(" +84   ZOHO CRM!"); //   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.contactPhone.startsWith("7")) //    <span class="hljs-number"><span class="hljs-number">7</span></span>   { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.contactPhone.length() != <span class="hljs-number"><span class="hljs-number">11</span></span>) //     <span class="hljs-number"><span class="hljs-number">11</span></span>  { errorType=("      11 !"); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { phoneType="RUSSIA"; //   } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>.contactPhone.startsWith(("+"))) //    +,    <span class="hljs-number"><span class="hljs-number">7</span></span>,    { phoneType="INTERNATIONAL"; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { errorType="  "; }</code> </pre><br>  Check for errors: <br><br><pre> <code class="hljs lua"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(errorType != <span class="hljs-string"><span class="hljs-string">""</span></span>) //     -   { mapVariable.put(<span class="hljs-string"><span class="hljs-string">"Phone error"</span></span>,<span class="hljs-string"><span class="hljs-string">"  "</span></span>); mapVariable.put(<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>,<span class="hljs-string"><span class="hljs-string">"-"</span></span>); sendmail //      email  [ from:zoho.loginuserid to:zoho.loginuserid subject:<span class="hljs-string"><span class="hljs-string">"Phone format error |   "</span></span> message:<span class="hljs-string"><span class="hljs-string">"  ! .   CRM!&lt;br&gt;Phone format is not correct! Look through the CRM manual!&lt;br&gt;Error message for phone number &lt;b&gt;"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactPhone + <span class="hljs-string"><span class="hljs-string">"&lt;/b&gt; is: "</span></span> + errorType + <span class="hljs-string"><span class="hljs-string">"!"</span></span> content <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>:HTML ] updateAccount = zoho.crm.updateRecord(<span class="hljs-string"><span class="hljs-string">"Contacts"</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactId.toString(),mapVariable); //      CRM }</code> </pre><br>  If the number is OK, then we check for duplicates: <br><br><pre> <code class="hljs lua"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> //       { contactPhone=<span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactPhone.replaceAll(<span class="hljs-string"><span class="hljs-string">"\D"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>); //     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(phoneType == <span class="hljs-string"><span class="hljs-string">"INTERNATIONAL"</span></span>) { contactPhone=<span class="hljs-string"><span class="hljs-string">"+"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactPhone; } mapVariable.put(<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactPhone); prevRecord = zoho.crm.searchRecords(<span class="hljs-string"><span class="hljs-string">"Contacts"</span></span>,<span class="hljs-string"><span class="hljs-string">"(Phone|=|"</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactPhone + <span class="hljs-string"><span class="hljs-string">")"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); //        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(prevRecord.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) //    { i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> each account <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prevRecord //       { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((((account).get(<span class="hljs-string"><span class="hljs-string">"CONTACTID"</span></span>)).toLong() != <span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactId) &amp;&amp; (i == <span class="hljs-number"><span class="hljs-number">0</span></span>)) //       { i=<span class="hljs-number"><span class="hljs-number">1</span></span>; mapVariable.put(<span class="hljs-string"><span class="hljs-string">"Phone error"</span></span>,<span class="hljs-string"><span class="hljs-string">"   !"</span></span>); mapVariable.put(<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>,<span class="hljs-string"><span class="hljs-string">"-"</span></span>); sendmail //           [ from:zoho.loginuserid to:zoho.loginuserid subject:<span class="hljs-string"><span class="hljs-string">"Duplicate Phone |  "</span></span> message:(((((((<span class="hljs-string"><span class="hljs-string">"   &lt;br&gt;Phone in Contact("</span></span> + (account).get(<span class="hljs-string"><span class="hljs-string">"CONTACTID"</span></span>)) + <span class="hljs-string"><span class="hljs-string">") is duplicated&lt;br&gt;Phone "</span></span>) + (account).get(<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>)) + <span class="hljs-string"><span class="hljs-string">"&lt;br&gt;Owner: &lt;a href='https://crm.zoho.com/crm/ShowSetup.do?tab=usersPermi&amp;subTab=viewUser&amp;userId="</span></span>) + (account).get(<span class="hljs-string"><span class="hljs-string">"SMOWNERID"</span></span>)) + <span class="hljs-string"><span class="hljs-string">"'&gt;"</span></span>) + (account).get(<span class="hljs-string"><span class="hljs-string">"Contact Owner"</span></span>)) + <span class="hljs-string"><span class="hljs-string">"&lt;/a&gt;&lt;br&gt;   "</span></span> content <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>:HTML ] } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { mapVariable.put(<span class="hljs-string"><span class="hljs-string">"Phone error"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>); } updateAccount = zoho.crm.updateRecord(<span class="hljs-string"><span class="hljs-string">"Contacts"</span></span>,<span class="hljs-built_in"><span class="hljs-built_in">input</span></span>.contactId.toString(),mapVariable); //   . }</code> </pre><br>  6. After writing the function, you need to check the code.  Click Save and Execute Script. You want to test the script by typing the values ‚Äã‚Äãof the arguments in the pop-up window.  If there are no errors, your script is ready to be associated with the Workflow workflow rule. <br><br><img src="https://habrastorage.org/files/5be/92a/5bc/5be92a5bcfc54bad90fb91eb46dfbe94.png"><br><br>  7. Click Save to save the script. <br><br><img src="https://habrastorage.org/files/272/130/a46/272130a460dc4a4085ac1a84f86b91c9.png"><br><br><h4>  2. Binding the function to the Workflow Rules workflow rule </h4><br>  To associate a custom function with a workflow rule, go to Setup&gt; Automation&gt; Workflow Rules, then click Create Rule. <br><br>  Do the following: <br><br>  1. Select the required module from the drop-down list (in our case, this is the Contacts module), set the name and description of the rule. <br><br><img src="https://habrastorage.org/files/364/132/7f7/3641327f756b499eb3921a1cc0e156a3.png"><br><br>  2. In the Rule Trigger section, select Create or Edit. <br><br><img src="https://habrastorage.org/files/609/2f8/57d/6092f857d85c4b1e95f0916ddc822fb8.png"><br><br>  3. In the section Rule Criteria set the criteria <br>  4. In the Actions section, select Call Custom Function. <br><br><ul><li>  Click + </li></ul><br><img src="https://habrastorage.org/files/356/bf0/012/356bf0012cf0462496ac4f4e927f78bc.png"><br><br><ul><li>  On the Configure Custom Function page, click on the Customized Functions link. </li></ul><br><img src="https://habrastorage.org/files/041/f77/9c9/041f779c9f62466aa7f547e5bce8aff9.png"><br><br><ul><li>  Select the desired previously created function.  We select the ontactsPhoneValidate function </li></ul><br>  5. Click Save. <br><br>  Now our function is associated with the Workflow workflow rule, and when entering the wrong phone format, or when duplicating a number, the user receives an error message. <br><br><h4>  Conclusion </h4><br>  We saw how to create a function in Zoho CRM using the Deluge language and how this function works within the system.  Creating a function in the Deluge language is not a complicated thing, which allows you to modify the behavior of the Zoho CRM system in accordance with your wishes and greatly expands the capabilities of the program. <br><br>  I will tell you about using Deluge in another Zoho product - Zoho Creator in the next article. <br><div style="text-align:center;"> <a href="https://trinion.org/"><img src="https://habrastorage.org/webt/-x/wa/fp/-xwafph06imnlkkgjpvgmp9dguq.png"></a> </div></div><p>Source: <a href="https://habr.com/ru/post/272421/">https://habr.com/ru/post/272421/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272409/index.html">Record of the webinar "Kerio Operator - Why is it VoIP?"</a></li>
<li><a href="../272411/index.html">PostgreSQL Document-Oriented API Design: Full-Text Search and Save Many Documents (Part 2)</a></li>
<li><a href="../272413/index.html">Security Week 49: Used certificates, data theft from children's toys, Microsoft blocks unwanted software</a></li>
<li><a href="../272417/index.html">How to cope with problems in an inherited project after 3 other teams</a></li>
<li><a href="../272419/index.html">Alloy Navigator: Co-pilot for IT Infrastructure</a></li>
<li><a href="../272423/index.html">Experience of developing an arcade for Android in C ++ and Qt</a></li>
<li><a href="../272425/index.html">Development of trading systems for FPGA: Pros, cons and analysis of the architecture of the existing library</a></li>
<li><a href="../272427/index.html">Dynamic lights and shadows in my 2d game</a></li>
<li><a href="../272429/index.html">Moore's Law and Storage Technology</a></li>
<li><a href="../272431/index.html">Mobile search inside apps ... which you don't have!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>