<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>All you wanted to know about protection from XSS in SAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 We haven‚Äôt published anything about SAP for a long time, and today we‚Äôll look at a vulnerability that affects any SAP solution from the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>All you wanted to know about protection from XSS in SAP</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br>  We haven‚Äôt published anything about SAP for a long time, and today we‚Äôll look at a vulnerability that affects any SAP solution from the old R / 3 to the new-fangled HANA.  The name of this vulnerability is cross-site scripting (XSS).  This article, contrary to our usual narrative about the search and exploitation of vulnerabilities, will be largely devoted to protection from this vulnerability. <br><br>  Crossite scripting is one of the most common vulnerabilities in general, and in SAP products in particular.  Thus, over 12 years, 628 XSS vulnerabilities were discovered in SAP, which makes up 22% of all vulnerabilities in SAP.  Only ERPScan researchers found 52 XSS vulnerabilities in SAP, and this was because more time was spent writing Advisory and bureaucratic issues than direct search for vulnerabilities.  More detailed information on all vulnerabilities can be studied in our study " <a href="https://erpscan.com/wp-content/uploads/publications/3000-SAP-notes-Analysis-by-ERPScan.pdf">Analysis of 3000 vulnerabilities in SAP</a> ", and we come to the main part. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/c00/8ef/ca0c008efbd4c698dc994995d6bc786a.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  <i>Ten most common vulnerabilities in SAP products</i> <br><br><h2>  Attack description </h2><br><br>  The danger of cross-site scripting is that this vulnerability allows an attacker to execute arbitrary JavaScript code within a user session.  This code can help get access to cookies, session tokens, and other critical information stored by the browser.  An attacker can gain access to a user session and get important business information, and in the worst case, gain complete control over the system.  With the help of XSS, you can also illegally replace the data displayed on the site, and conduct a phishing attack, etc. and etc.  I think you already know about XSS enough, but you cannot do without an introductory one. <br>  XSS is usually possible in the following cases: <br><ul><li>  The server does not escape special characters entered by the user - '"&amp; &lt;&gt;; </li><li>  The server allows you to send dangerous parameters as a value, which in turn allows you to execute JavaScript code from other sources. </li></ul><br><br>  Traditionally, the following types of cross-site scripting are distinguished: <br><br><h3>  Stored crossite scripting </h3><br><br>  In this type of malicious code should be stored on the server.  For example, an attacker can embed a code by changing the name of an object on the server (for example, the name of a file in the workflow system).  If the attack is successful, then when a legitimate user requests information about the file list, his browser will launch malicious code downloaded by the attacker. <br><br>  Once, a long time ago, we conducted a similar attack during one of the work on SAP security analysis.  In this organization, SAP SRM was used for bidding, so each supplier could post their documentation with information about services and pricing.  The system was vulnerable to stored cross-site scripting, so we were able to inject JavaScript code in the file name field.  When an employee from a purchasing department opened a folder with a list of files to see recently uploaded documents, the malicious code automatically started and the attacker got access to the employee‚Äôs account.  Using this account, he could get access to the tender documentation of competitors and get information about their services and prices, which allowed them to win the bid by adjusting their prices.  The vulnerability has been closed by SAP (SAP Security Note 1284360). <br><br>  Another example of stored cross-site scripting in SAP is the acclaimed <a href="https://erpscan.com/press-center/blog/sap-afaria-security-stored-xss-vulnerability-detailed-review/">XSS vulnerability in the SAP Afaria system</a> with a very interesting way of exploitation.  Vulnerability such as stored cross-site scripting is extremely dangerous and easy to operate, but is much less common than the reflected cross-site scripting, which is described below. <br><br><h3>  Mirrored Crossite Scripting </h3><br><br>  This type of vulnerability is more common.  In this case, the malicious code is not stored on the server, but is executed by the user at the moment when he opens a link of the following form: <br><br>  <a href="http://example.com/search.php%3Fq%3D">example.com/search.php?q=</a> <br><br>  To exploit the vulnerability, you need to send a link to the user.  This type of XSS is less powerful because it requires user interaction, but more popular than stored cross-site scripting, and there are hundreds of such vulnerabilities. <br><br>  As an example of a critically dangerous attack, you can embed JavaScript code and not only steal user session information stored in a cookie, but also exploit the ActiveX component installed on the victim‚Äôs computer.  Thus, it will be possible to get full access to his computer through one of the vulnerabilities in ActiveX.  As a result, you will get access to the corporate intranet and will be one step closer to the SAP server with all corporate data. <br><br><h3>  DOM-XSS </h3><br><br>  In this case, the attacker changes the DOM (Document Object Model) environment of the browser page so that one of the scripts on the page executes malicious JavaScript code. <br><br>  Consider this type in more detail using the example of a closed SAP Security Note 1788080 vulnerability. The bug exists because user input in the JSP script 'error_msg.jsp' is not filtered, which allows an attacker to embed JavaScript code into the page. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c95/d23/abd/c95d23abd88710f23b76619b59159aaa.png" alt="image"><br><br>  <i>An example of a page that is vulnerable to cross-site scripting</i> <br><br>  As we can see, an attacker can use the 'id' variable in order to inject code (line 15), because the value of the 'id' variable will be displayed to the user without changes (line 28). <br>  The exploit for this vulnerability is the following query: <br><br>  <a href="http://example1234567.com/dir/start/error_msg.jsp%3Fid%3D1111">example1234567.com/dir/start/error_msg.jsp?id=1111</a> "&gt; <br><br><h2>  General protective measures </h2><br><br>  To avoid such vulnerabilities, you should always screen / filter user input.  In our DOM XSS example, the variable 'ID' must be re-stored in the 'URLEncoder.encode ()' method, because its value is used as an HTTP request parameter. <br><img src="https://habrastorage.org/getpro/habr/post_images/69a/559/716/69a559716162e04eaf3229fccdd3ff65.png" alt="image"><br><br>  <i>Actions required to close a vulnerability</i> <br><br>  As a result, let's present some more tips on how to prevent the possibility of cross-site scripting at the development stage: <br><ul><li>  Never enter data from unverified sources (including any user input) into an HTML page; </li><li>  screen HTML snippets from unreliable sources before pasting them into HTML Element Content; </li><li>  escape HTML attributes from unreliable sources before pasting them into HTML Element Content; </li><li>  escape JavaScript code from unreliable sources before inserting JavaScript Data Values; </li><li>  screen JSON from unreliable sources before embedding it in HTML Element Content or using it in JSON.parse; </li><li>  Shield CSS snippets from unreliable sources before pasting them into HTML Style Property Values; </li><li>  screen URLs from unreliable sources before inserting them into the HTML URL Parameter Values; </li><li>  protect the system against the DOM XSS. </li></ul><br>  Also in browsers there are several mechanisms that can significantly reduce the risk of XSS attacks: <br><ul><li>  Use the 'HTTPOnly' flag for cookies - this security measure will prevent users from obtaining session data from cookies through JavaScript; </li><li>  set content security policy - this security measure will prohibit the use of javascript inside the domain; </li><li>  HTTPS Cookies Protection - Protect cookies when using the HTTPS protocol. </li></ul><br><br>  Now let's take a closer look at how to protect various SAP platforms from XSS attacks from the developer, administrator, and incident investigation specialist. <br><br><h2>  SAP NetWeaver ABAP Security </h2><br><br><h3>  From a developer‚Äôs point of view </h3><br><br>  For all Web applications where parameter entry is allowed, the encoding methods provided by the ICF handler should be used.  The implementation is available as an API in two versions: <br><ul><li>  Built-in function in ABAP ESCAPE (available in SAP_BASIS&gt; = 731); </li><li>  Deployment class in CL_ABAP_DYN_PRG. </li></ul><br>  In SAP NetWeaver version 7.0 enhancement package 3 and above (SAP_BASIS&gt; = 731), use the ABAP built-in ESCAPE () function.  More information is available in the ABAP keyword documentation for the ESCAPE () function. <br><table><tbody><tr><td>  HTML / XML </td><td>  out = escape (val = val format = cl_abap_format =&gt; e_xss_ml) </td></tr><tr><td>  Javascript </td><td>  out = escape (val = val format = cl_abap_format =&gt; e_xss_js) </td></tr><tr><td>  URL </td><td>  out = escape (val = val format = cl_abap_format =&gt; e_xss_url) </td></tr><tr><td>  CSS </td><td>  out = escape (val = val format = cl_abap_format =&gt; e_xss_css) </td></tr></tbody></table><br><br>  For versions SAP_BASIS 702, 720 and below, there is an implementation of ABAP OO in the class CL_ABAP_DYN_PRG. <br><br><table><tbody><tr><td>  Context </td><td>  Method </td></tr><tr><td>  HTML / XML </td><td>  out = CL_ABAP_DYN_PRG =&gt; ESCAPE_XSS_XML_HTML (val) </td></tr><tr><td>  Javascript </td><td>  out = CL_ABAP_DYN_PRG =&gt; ESCAPE_XSS_JAVASCRIPT (val) </td></tr><tr><td>  URL </td><td>  out = CL_ABAP_DYN_PRG =&gt; ESCAPE_XSS_URL (val) </td></tr><tr><td>  CSS </td><td>  out = CL_ABAP_DYN_PRG =&gt; ESCAPE_XSS_CSS (val) </td></tr></tbody></table><br><br>  Detailed information about these extensions in SAP Security Note 1582870. Now consider the features of protection against XSS with specific SAP-technologies. <br><br><h3>  For WebDynpro ABAP </h3><br><br>  For WebDynpro, ABAP does not need to worry about cross-site scripting.  Security is provided by the platform itself. <br><br><h3>  For Business Server Pages (BSP) </h3><br><br>  For BSP, page directives should be used.  For more information, refer to SAP Security Note 1600317 and SAP Security Note 1638779. The advantage of these BSP page attributes is that the BSP architecture ensures that the safest version of encoding is used. <br><br>  For BSP, use page directives: &lt;% <a href="https://habrahabr.ru/users/page/" class="user_link">page</a> language = "abap" forceEncode = "html | url | javascript | css"%&gt; <br>  After installing SAP Security Note 1600317, the existing page directives also use the updated BSP compiler, which supports HTML encoding of all the expressions entered on the page. <br><br>  In the following example, all input expressions use HTML encoding.  It affects only printed expressions on BSP pages and does nothing with the tag parameters. <br><br>  For example: <br><br> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h2> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h2> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <table><tbody><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> [CASE1] <br> <br> Username [CASE1] <br> <br> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> [CASE1] <br> <br> Username [CASE1] <br> <br> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code></code> </td> </tr></tbody></table> <code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <table><tbody><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr></tbody></table> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <table><tbody><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr><tr><td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> <td> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </td> </tr></tbody></table> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h2> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h2> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h3> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ul><li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> </ul> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h2> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h2> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <h2> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </h2> <code><code><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  <a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> <ol><li> <code><code><a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154"><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  </a><a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> Logging additional information <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm"><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  </a><a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> ABAP protection SAP Encoding Functions for AS ABAP <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html"><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  </a><a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> Java protection <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39"><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  </a><a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> SAP Encoding Functions for AS Java and JavaScript <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html"><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  </a><a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> Prevention of Cross-site Scripting SAP HANA protection <a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf">Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</a></code></code> </li> <li> <code><code><a href="https://websmp104.sap-ag.de/~sapdownload/011000358700001376952010E/Protecting-SAP-Apps.pdf"><code>&lt;%@page language="abap" forceEncode="html"%&gt; <br> &lt;% data: inputvalue type string. <br> inputvalue = request-&gt;get_form_field( 'x' ). <br> %&gt; <br> &lt;/html&gt; <br> <br> <br>               .    ,           (  ): <br> <br> &lt;%html=...%&gt;:  HTML &lt;%url=...%&gt;:  URL      URL &lt;%javascript=...%&gt;:  JavaScript &lt;%css=‚Ä¶%&gt; :  CSS &lt;%raw=...%&gt; ( ,     ,      ,  ) <br> <br>   BSP <br> <br>   BSP HTMLB   forceEncode  &lt;htmlb:content&gt;   ENABLED  ,      (  ). ENABLED ,          ,    :&lt;htmlb:content forceEncode="ENABLED|BACKWARDS_COMPATIBLE"&gt; <br> <br> ENABLED:      .       ,     ; BACKWARDS_COMPATIBLE:    .    ,   . <br> <br>  ,   htmlb:content   ,   .   : CLASSIC, DESIGN2002, DESIGN2003, DESIGN2008,    ,   (+).      CLASSIC  DESIGN2002 (, )       . <br> <br> &lt;htmlb:content forceEncode="ENABLED" design="DESIGN2003+DESIGN2008"&gt; <br></code> <br> <br>    ,   design=CLASSIC.            . <br> <br> Mixed BSP- HTML  HTMLB  <br> <br>  forceEncode  BSP  </a><a href="https://habrahabr.ru/users/page/" class="user_link">page</a>   forceEncode HTMLB       .       ,    ‚Äì    HTMLB.  ,   ,   HTML     BSP,     <br> <br>  Internet Transaction Server (ITS)  HTML Business <br> <br>  Internet Transaction Server (ITS)  HTML Business,    : <br> <br> xss_url_escape() xss_html_escape() xss_wml_escape() xss_css_escape() xss_js_escape() <br> HTML Business <br> <br>     ,   HTML-:  ,    (`)   ,    : <br> ~auto_html_escaping=1:   , ~new_xss_functions=1:      XSS. <br>            ~html_escaping_off=1/0,      . <br> ,      ,    SAP_BASIS: <br>   ITS ( &lt;= 6.40),     Internet Service   SE80.   ITS ( &gt;= 6.40),     GUI   SICF  : <br> <br>    7.20,     ~new_xss_functions,    XSS-    . <br> <br>       ,     ,    ,      .       ~html_escaping_off=‚ÄùX‚Äù,         .     , . SAP Security Note 1488500. <br> <br>  Business HTML (BHTML) <br> <br>  HTMLBusiness Template Library (, SAP_TemplateNonEditableField())           .     , . SAP Security Note 916255. <br> <br> <b>  </b> <br> <br>         ,  .   ,    . <br> <br>     <br> <br>     ,         XSS-: <br> <br> http/security_session_timeout = 900;  -   ,     . icf/set_HTTPonly_flag_on_cookies = 0;    HttpOnly   ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. <br> <br>   ,   RZ10,  (  Profile)   (, DEFAULT.PFL,        SAP-).  ,  ,    ,    <i>Extended maintenance</i>    .   ,   Copy. <br> <br>          <br> <br>  ,    ,  -  ,   -     -,    : <br>   <b>icm/HTTP/logging_0</b>   <b>icm/security_log</b> , <br> <br>   SAP NetWeaver J2EE <br> <br>        SAP NetWeaver J2EE <br> <br>     <br> <br>  AS Java      tc_sec_csi.jar.     ,     HTML/XML, JavaScript, CSS  URL.       StringUtils (com.sap.security.core.server.csi.util.StringUtils): <br> <br>    .        <a href="https://erpscan.com/wp-content/uploads/publications/Securing-SAP-Systems-from-XSS-vulnerabilities.pdf">Securing SAP from XSS vulnerabilities</a> <br> escapeScriptEndTag(String pStr) -  ,       javascript      ; escapeToHTML(String input) ‚Äì        (.  1) escapeToJS(String input) ‚Äì    JS declaration  ( .  5) escapeToURL(String input) ‚Äì  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(StringBuffer sb, String input, int maxLength) -  ,    URL ( 3).  ,     'disableScriptSignatures'. escapeToURL(String input, int maxLength) -  ,    URL (.  3).  ,     'disableScriptSignatures'. urlEncode(String s) ‚Äì     URLEncoder.encode <br> <br>   ,       . <br> <br>  1 (  ) <br> <br> <code>[CASE1] <br> <br> Username [CASE1] <br> <br></code> <br> <br>  2 (  ,    ‚Äì  URL) <br> <br> <code><a href="http://case3/"></a> <br> Click here <br> <br> <br>  3 ( - URL) <br> <br> <img src="http://[CASE3]"> <br></code> <br> <br>  4 (  SCRIPT',   ‚Äì   ) <br> <code><br></code> <br> <br>  5 ( ‚Äì declaration ) <br> <code><br></code> <br> <br>       XSSEncoder. <br>   - XSSEncoder (   : com.sap.security.core.server.csi.XSSEncoder). <br> <br>      : <br>   HTML / XML out = XSSEncoder.encodeHTML( in ) and XSSEncoder.encodeXML( val ); JavaScript out = XSSEncoder.encodeJavaScript( val ); URL out = XSSEncoder.encodeURL( val ); CSS out = XSSEncoder.encodeCSS( val ); <br> <br>      , . SAP Security Note 1590008. <br> <b>WebDynpro Java</b> <br>  WebDynpro Java,     XSS.    . <br> <b>SAP UI Development Kit for HTML5</b> <br>  SAP UI Development Kit  HTML5,      jQuery   /_core/src/main/js/jquery.sap.encoder.js. <br>      : <br>   HTML / XML jQuery.sap.encodeHTML(sValue) and jQuery.sap.encodeXML(sValue) JavaScript jQuery.sap.encodeJS(sValue) URL jQuery.sap.encodeURL(sValue) CSS jQuery.sap.encodeCSS(sValue) <br>    : <br> <br>       ,   : <br> Global_app_config/session_config/sessionTimeout = 900.  -   ,     . SystemCookiesDataProtection = true.    HttpOnly    ,        -   , ,    .   HTTPOnly,     Logon tickets         XSS-. ume.logon.httponlycookie= True. Logon tickets   ,       Single Sign-On  J2EE Engine.  ‚ÄúTrue‚Äù ,          HTTP     document.cookie (  XSS-) . SessionIPProtectionEnabled = True. ,    IP .       True, HTTP-       IP.     IP,   . <br> <br>      <br>  ,    ,  - XSS-,   -     -,    . <br> LogCLF = TRUE    http.properties  logging   CEF. ArchiveOldLogFiles = ON. Log Configurator      .      .    ,      .     ,    .    . HttpTrace= Enable.   HTTP-    ,  ConfigTool.     HTTP Provider Service,   ,      HttpTrace. <br>   SAP HANA XS <br> <br>  ,     XSS-    ‚Äì SAP HANA. <br> <br>     <br>     SAP HANA    SAPUI5. <br>     -  SAPUI5   ,    .  ,  int   int,  sap.ui.core  .  ‚Äì        ,   HTML: <br>     <br>       ,   : <br> sessiontimeout = 900.  -   ,     . HttpOnly    . <br> <br>      <br> <br>  ,    ,  - XSS-,   -     -,    . <br> <br>    HTTP (S) ,   SAP HANA,     -.     -    HTTP (S) ,   icm/http/logging _ 0: global _ auditing _ state = true.        global.ini,    .     ,          ,       XSS-.      SAP HANA Administration Console ‚Äì&gt; Security HDB ‚Äì&gt; Auditing Status menu. <br> <br>  <br> <br>   -  ,       XSS.  ,     ,   - SAP       .      XSS- ‚Äì           SAP.          SAP      XSS-.     XSS   SAP. <br> <br> ,         ( <a href="https://habrahabr.ru/users/chipik/" class="user_link">chipik</a> )          . <br> <br>  <br> <a href="http://help.sap.com/saphelp_nw70/helpdata/en/d8/4134420793ab04e10000000a1550b0/content.htm%3Fframeset%3D/en/ef/8cd7f51dfead42ab90537886104269/frameset.htm%26current_toc%3D/en/49/e98876e9865b4e977b54fc090df4ed/plain.htm%26node_id%3D154">Logging additional information</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/a6/87890ae991441b89bf418d0198ddcc/content.htm">ABAP protection SAP Encoding Functions for AS ABAP</a> <a href="http://help.sap.com/javadocs/nwce/current/se/com.sap.se/com/sap/security/core/server/csi/util/StringUtils.html">Java protection</a> <a href="http://help.sap.com/SAPhelp_nw70/helpdata/en/b5/b5b54ba97d4413987252fed5866603/content.htm%3Fframeset%3D/en/16/58ece980104b668cfe69b23dc925c3/frameset.htm%26current_toc%3D/en/44/6ad7e1e5254ddee10000000a1553f7/plain.htm%26node_id%3D39">SAP Encoding Functions for AS Java and JavaScript</a> <a href="https://sapui5.hana.ondemand.com/sdk/docs/guide/4de64e2e191f4a7297d4fd2d1e233a2d.html">Prevention of Cross-site Scripting SAP HANA protection</a> Protecting SAP¬Æ Applications Based on Java and ABAP‚Ñ¢ Against Common Attacks</code></code> </li> </ol></div><p>Source: <a href="https://habr.com/ru/post/275719/">https://habr.com/ru/post/275719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275709/index.html">C calls in Go: principle of operation and performance</a></li>
<li><a href="../275711/index.html">New call reporting for 3CX v14</a></li>
<li><a href="../275713/index.html">Mobile applications of Stepic.org for iOS and Android</a></li>
<li><a href="../275715/index.html">"Naked conductor runs under the car." About online translation</a></li>
<li><a href="../275717/index.html">Using SikuliX in the background on Cloud9</a></li>
<li><a href="../275723/index.html">News about C ++ products and JetBrains C ++ Night in St. Petersburg</a></li>
<li><a href="../275725/index.html">The Qt project changes the license and opens the code for some modules.</a></li>
<li><a href="../275727/index.html">Procedural generation of random gaming dungeons</a></li>
<li><a href="../275729/index.html">HTML / CSS / JavaScript Guide</a></li>
<li><a href="../275731/index.html">Sandelius method for random permutations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>