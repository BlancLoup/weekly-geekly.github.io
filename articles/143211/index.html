<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a lightbox for the touch interface on HTML5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Stephen Woods, a flickr frontend engineer, explains how to create a simple gesture-enabled lightbox and gives tips for improving the perception and pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a lightbox for the touch interface on HTML5</h1><div class="post__text post__text-html js-mediator-article">  Stephen Woods, a flickr frontend engineer, explains how to create a simple gesture-enabled lightbox and gives tips for improving the perception and performance of touch interfaces. <br><br><img src="https://habrastorage.org/storage2/68f/265/e6a/68f265e6ac3a250616620c5ab13f933c.jpg"><br><br>  <b>Prerequisite knowledge:</b> intermediate CSS, intermediate advanced JavaScript <br>  <b>Requirements:</b> Android or IOS device <br>  <b>Temporary costs:</b> 2-3 hours <br>  <a href="">Download source</a> <br>  <a href="http://www.netmagazine.com/files/tutorials/demos/2012/04/build-a-lightbox-for-a-responsive-html5-touch-interface/demo/demo.html">View demo</a> <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Lightbox widgets have become standard on the web since the first version of lightbox.js was released in 2005.  Lightbox creates a modal dialog box in order to view enlarged images, usually with the ‚ÄúNext‚Äù and ‚ÄúPrevious‚Äù buttons, to move between slides. <br><br>  Starting with a boom in using touch devices, websites have updated lightboxes to support the interaction of gestures with varying degrees of success.  In this tutorial, I'm going to show you how to create a simple gesture-enabled lightbox.  In the process, you will learn a little about improving the perceived performance of touch interfaces, as well as a few simple tricks to improve actual performance. <br><br>  Writing code for touch devices is significantly different from writing code for desktops.  You can (and should) combine as much code with desktop as possible, but there will always be significant differences between them. <br><br>  Comparative tests show that the most common sensory devices are comparable in performance to desktop computers around 1998.  They usually have about 256 MB of RAM, CPU performance on a par with the original iMac.  The methods that we use to ‚Äújust work‚Äù on the desktop will not work correctly on mobile phones and tablets.  Fortunately, these devices are usually well optimized for graphics, especially for moving elements on the screen.  IOS and Android 3.0+ devices have hardware graphics acceleration. <br>  In fact, you can think of these devices as crappy computers with decent graphics cards. <br><br>  We have interacted with our computers in the same way for the past 20 years.  We move the mouse pointer and click on the control buttons.  Buttons, closing blocks, links, and scroll bars are second nature to users and developers.  Touch interfaces represent a completely different set of conventions.  One of the most common is ‚Äúswipe‚Äù.  When "sliding" several elements are presented as if they are going in a row, and the user can use the "sliding" gesture to move between them. <br><br>  Gliding is such a common pattern that we don‚Äôt even have to tell users about it ‚Äî when the user sees something like a list, he instinctively tries to scroll through it. <br><br>  Often we cannot make our code run a little faster, especially when we are dealing with slow connections and slow devices.  But we can make the interface seem faster, focusing on perceptual optimizations. <br><br>  My favorite example of optimizing perceived performance is TiVo.  Thirteen years ago, when the first TiVo appeared, they were incredibly slow (16 MB of RAM and 54 MHz CPU!).  It could take a painfully long time for something to happen after something was pressed on the remote, especially if they were starting to play or record something.  However, no one ever complained that TiVo is slow.  In my opinion, this is because of the sound.  The most familiar part of the TiVo interface is the melody that sounded after you press any button.  That sound played instantly.  The engineers at TiVo made the sound load as quickly as possible, so that no matter what happens next, the user knew that the interface was not dead.  This short tune told users that their request was heard. <br>  In the network, we have developed an agreement that does the same thing: a loader (spinner).  After the click, a spinner appears immediately and in this way, the user receives a message that he has been heard.  In mobile phones, we must do otherwise. <br><br>  Gestures are not discrete actions, like clicks.  However, to make the interface seem fast, we need to give users some feedback.  As they are gesticulating, we move the interface in some way so that they know that we ‚Äúhear‚Äù them. <br><br><h4>  Instruments </h4><br>  Highly responsive interfaces require elements to move as quickly as possible.  In motion, we show the user that the interface responds to their request.  Using JavaScript animations is too slow for this.  Instead, we use CSS transformations and transitions: transformations for performance, and transitions for the animation to work without blocking the execution of JavaScript. <br>  In this tutorial, for all movements and animations, I will use CSS transforms and transitions. <br>  Another optimization that I want to use as much as possible is what I call the ‚Äúwrite-only DOM‚Äù.  Reading properties and values ‚Äã‚Äãfrom a DOM is complex and usually unnecessary.  For lightbox, I will try to combine all reads in the initialization phase.  After that, I will maintain state in JavaScript and, if necessary, do simple arithmetic. <br><br><h4>  Lightbox creation </h4><br>  For this tutorial we will create a page with several thumbnails.  Clicking (or tapping with the finger) on the thumbnails will launch the lightbox.  After that, in the lightbox, the user will be able to scroll through the image with his finger, and then touch the image to exit the lightbox. <br><br>  When creating an interface for gestures, be aware of the importance of perceived performance.  In a lightbox, this means that the slides should move because of a finger sliding on the screen.  When the user stops gesturing, the slides should move to the next position, or return to the previous one if there is not enough slip length. <br><br>  Return animation is critical.  Thanks to it, the user will never think that the interface is dead. <br><br><h4>  Start </h4><br>  Create the following files: <br> <code>lightbox/ <br> reset.css <br> slides.css <br> slides.html <br> slides.js</code> <br> <br><img src="https://habrastorage.org/storage2/224/9c5/da1/2249c5da127f40428700c55f4c35bd4a.jpg" title="The appearance of the thumbnail page" alt="   "><br><br><h4>  Template </h4><br>  HTML will be simple.  This is not just for the sake of a demo.  A complex DOM tree is by definition slower.  Styles, DOM element extraction, and visual effects are increasingly heavy with a more complex DOM tree.  Since we are aiming at ‚Äúcrappy computers,‚Äù every bit counts, so it‚Äôs important to keep everything simple from the start. <br><br>  I am using reset.css from Eric Meyer to start resetting CSS.  I also customize the viewport so that it does not scale. <br><br>  I turned off the native ‚Äúclick to zoom‚Äù so that it does not interfere with gestures.  Correct response to the click will be implemented in JavaScript.  ‚ÄúClick to zoom‚Äù deserves a separate lesson, so we will drop it now. <br><br>  On the JS side, I use zepto.js, a very lightweight platform with jQuery syntax.  In fact, there is no need for any platform, but this will speed up the work on some tasks a little.  For actual gesture interactions, we will use built-in APIs. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"main"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"welcome"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Welcome to an amazing carousel!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>This is an example of a nice touch interface<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"carousel"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.flickr.com/photos/protohiro/6664939239/in/photostream/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"427"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"640"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://farm8.staticflickr.com/7142/6664939239_7a6c846ec9_s.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.flickr.com/photos/protohiro/6664957519/in/photostream"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"424"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"640"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://farm8.staticflickr.com/7001/6664957519_582f716e38_s.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.flickr.com/photos/protohiro/6664955215/in/photostream"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"640"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"427"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://farm8.staticflickr.com/7019/6664955215_d49f2a0b18_s.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.flickr.com/photos/protohiro/6664952047/in/photostream"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"426"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"640"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://farm8.staticflickr.com/7017/6664952047_6955870ecb_s.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.flickr.com/photos/protohiro/6664948305/in/photostream"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"428"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-full-width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"640"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://farm8.staticflickr.com/7149/6664948305_fb5a6276e5_s.jpg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"zepto.min.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"slides.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//this code initializes the lightbox and shows it when the user //clicks on a slide $(document).ready(function(){ var lightbox = new saw.Lightbox('.carousel'); $(document).on('click', 'a', function(e){ e.preventDefault(); lightbox.show(this.href); }); }); </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h4>  Stylize Thumbnails </h4><br>  Now add some cute little thumbnails and some other visual effects: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">html</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#f1eee4</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: georgia; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#7d7f94</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#ba4a00</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.welcome</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">text-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">#fff</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.welcome</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">h1</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-class"><span class="hljs-selector-class">.welcome</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-webkit-box-sizing</span></span>: border-box; <span class="hljs-comment"><span class="hljs-comment">/* Safari/Chrome, other WebKit */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">-moz-box-sizing</span></span>: border-box; <span class="hljs-comment"><span class="hljs-comment">/* Firefox, other Gecko */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">box-sizing</span></span>: border-box; <span class="hljs-comment"><span class="hljs-comment">/* Opera/IE 8+ */</span></span> <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>:<span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>:<span class="hljs-number"><span class="hljs-number">10px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-number"><span class="hljs-number">5px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0,0,0,0.5); <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.carousel</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>:<span class="hljs-number"><span class="hljs-number">5px</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.carousel</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ul</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">li</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">70px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">70px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">overflow</span></span>: hidden; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: block; <span class="hljs-attribute"><span class="hljs-attribute">float</span></span>: left; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">5px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0,0,0,0.5), -<span class="hljs-number"><span class="hljs-number">1px</span></span> -<span class="hljs-number"><span class="hljs-number">1px</span></span> <span class="hljs-number"><span class="hljs-number">2px</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(255,255,255,1); }</code> </pre><br><br><h4>  Main lightbox </h4><br>  Lightbox JavaScript should do several different things: <br><ul><li>  Collect lightbox data and initialize </li><li>  Hide and show lightbox </li><li>  Create html for lightbox wrappers </li><li>  Create slides </li><li>  Handle gesture events </li></ul><br><br><h5>  Service functions </h5><br>  Instead of writing "-webkit-transform" and "translate3d" again and again, I will create several utility functions to do this work for me. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prefixify</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ua = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.navigator.userAgent; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ua.indexOf(<span class="hljs-string"><span class="hljs-string">'WebKit'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'-webkit-'</span></span> + str; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ua.indexOf(<span class="hljs-string"><span class="hljs-string">'Opera'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'-o-'</span></span> + str; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ua.indexOf(<span class="hljs-string"><span class="hljs-string">'Gecko'</span></span>) !== <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'-moz-'</span></span> + str; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node, left</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// node.css('left', left +'px'); node.css(prefixify('transform'), "translate3d("+left+"px, 0, 0)"); } function addTransitions(node){ node.css(prefixify('transition'), prefixify('transform') + ' .25s ease-in-out'); node[0].addEventListener('webkitTransitionEnd', function(e){ window.setTimeout(function(){ $(e.target).css('-webkit-transition', 'none'); }, 0) }) } function cleanTransitions(node){ node.css(prefixify('transition'), 'none'); }</span></span></code> </pre><br><br>  Our lightbox widget will be initialized when the page loads to speed up the processes.  Initialization is to find all the thumbnails on the page and create a data model.  We will wait for the lightbox to be provided to create HTML and attach event handlers. <br><br><h5>  Initialization </h5><br>  For lightbox, I use a constructor that takes a block selector as its only parameter. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//clean namespacing window.saw = (function($){ //the lightbox constructor function Lightbox (selector) { var container_node = $(selector), wrapper, chromeBuilt, currentSlide = 0, slideData =[], boundingBox = [0,0], slideMap = {}; function init(){ //init function } return { show: show, hide: hide }; } return { Lightbox:Lightbox }; }($));</span></span></code> </pre><br><br>  The ‚Äúinit‚Äù function captures all the ‚Äúli‚Äù tags, finds the thumbnails and writes information to the ‚ÄúslideData‚Äù array.  At the same time, I create a ‚ÄúslideMap‚Äù object that displays ‚Äúhref‚Äù thumbnails in the ‚ÄúslideData‚Äù array.  This allows me to quickly search for data on a click, without having to cycle through all the data in the array or decorate the DOM with additional information. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> slides = container_node.find(<span class="hljs-string"><span class="hljs-string">'li'</span></span>); slides.each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i, el</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thisSlide = {}, thisImg = $(el).find(<span class="hljs-string"><span class="hljs-string">'img'</span></span>); thisSlide.url = thisImg.attr(<span class="hljs-string"><span class="hljs-string">'src'</span></span>); thisSlide.height = thisImg.attr(<span class="hljs-string"><span class="hljs-string">'data-full-height'</span></span>); thisSlide.width = thisImg.attr(<span class="hljs-string"><span class="hljs-string">'data-full-width'</span></span>); thisSlide.link = $(el).find(<span class="hljs-string"><span class="hljs-string">'a'</span></span>).attr(<span class="hljs-string"><span class="hljs-string">'href'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//push the slide info into the slideData array while recording the array index in the slideMap object. slideMap[thisSlide.link] = slideData.push(thisSlide) - 1; }); }</span></span></code> </pre><br><br>  The rest of the initialization takes place in the "show" method. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//this is the function called from the inline script function show(startSlide){ if(!chromeBuilt){ buildChrome(); attachEvents(); } wrapper.show(); //keep track of the viewport size boundingBox = [ window.innerWidth, window.innerHeight ]; goTo(slideMap[startSlide]); }</span></span></code> </pre><br><br><h5>  Shell creation </h5><br>  The buildChrome function creates an HTML wrapper for the lightbox and then sets the semaphore so that the wrapper is not rebuilt every time the user hides or shows the lightbox.  For ease of use, I created a separate template function for the HTML itself: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wrapperTemplate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;div class="slidewrap"&gt;'</span></span>+ <span class="hljs-string"><span class="hljs-string">'&lt;div class="controls"&gt;&lt;a class="prev" href="#"&gt;prev&lt;/a&gt; | &lt;a class="next" href="#"&gt;next&lt;/a&gt;&lt;/div&gt;'</span></span>+ <span class="hljs-string"><span class="hljs-string">'&lt;/div&gt;'</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildChrome</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ wrapper = $(wrapperTemplate()).addClass(<span class="hljs-string"><span class="hljs-string">'slidewrap'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).append(wrapper); chromeBuilt = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br><br>  The final step in creating a shell is adding an event handler for the links ‚ÄúNext‚Äù and ‚ÄúPrevious‚Äù: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleClicks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ e.preventDefault(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> targ = $(e.target); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(targ.hasClass(<span class="hljs-string"><span class="hljs-string">'next'</span></span>)) { goTo(currentSlide + <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(targ.hasClass(<span class="hljs-string"><span class="hljs-string">'prev'</span></span>)){ goTo(currentSlide - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { hide(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attachEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ wrapper.on(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, handleClicks, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre><br><br>  The lightbox shell is now ready to work with multiple slides.  In my show function, I call goTo (), to load the first slide.  This function shows the slide identified by the parameters, but it also slowly creates the slides, in case I need them.  (Important: do not set the function "goTo" in lower case, because "goto" is a reserved word in JavaScript). <br><br><h5>  Slideshow </h5><br>  Now the slide on which I am looking is in the viewing area, and the previous and next slides are to the left and right of the visible screen area, respectively.  When the user taps the Next button, the current slide goes to the left, and is replaced by the next slide. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//for the slides, takes a "slide" object function slideTemplate(slide){ return '&lt;div class="slide"&gt;&lt;span&gt;'+slide.id+'&lt;/span&gt;&lt;div style="background-image:url('+slide.url.replace(/_s|_q/, '_z')+')"&gt;&lt;/div&gt;&lt;/div&gt;'; }</span></span></code> </pre><br><br>  I use it instead, because (at least for now) mobile browsers draw much slower than with a background image.  When working with mobile devices, speed is usually preferable.  Accessibility issues can easily be solved with the help of the " <a href="http://www.w3.org/TR/wai-aria/">ARIA Role</a> ". <br><br>  By itself, the ‚ÄúbuildSlide‚Äù function is more complex.  In addition to moving data through the slide template, the code must make the slides fit in the viewport.  This is a simple task of figuring out how much to scale an image if it doesn't fit.  We can allow the browser to handle resizing. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildSlide</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">slideNum</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thisSlide, s, img, scaleFactor = <span class="hljs-number"><span class="hljs-number">1</span></span>, w, h; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!slideData[slideNum] || slideData[slideNum].node){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thisSlide = slideData[slideNum]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = $(slideTemplate(thisSlide)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img = s.children(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//image is too big! scale it! if(thisSlide.width &gt; boundingBox[0] || thisSlide.height &gt; boundingBox[1]){ if(thisSlide.width &gt; thisSlide.height) { scaleFactor = boundingBox[0]/thisSlide.width; } else { scaleFactor = boundingBox[1]/thisSlide.height; } w = Math.round(thisSlide.width * scaleFactor); h = Math.round(thisSlide.height * scaleFactor); img.css('height', h + 'px'); img.css('width', w + 'px'); }else{ img.css('height', thisSlide.height + 'px'); img.css('width', thisSlide.width + 'px'); } thisSlide.node = s; wrapper.append(s); //put the new slide into the start poisition setPosition(s, boundingBox[0]); return s; }</span></span></code> </pre><br><br><img src="http://habrastorage.org/storage2/d4c/605/9d7/d4c6059d7460e3e14db8db2b890dcaf2.jpg" title="The first lightbox slide" alt="   "><br><br><h5>  goTo </h5><br>  ‚ÄúGoTo‚Äù moves the requested and adjacent slides to the viewing area. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">goTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">slideNum</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> thisSlide; <span class="hljs-comment"><span class="hljs-comment">//if the slide we are looking for doesn't exist, lets just go //back to the current slide. This has the handy effect of providing //"snap back" feedback when gesturing, the slide will just animate //back into position if(!slideData[slideNum]){ return; } thisSlide = slideData[slideNum]; //build adjacent slides buildSlide(slideNum); buildSlide(slideNum + 1); buildSlide(slideNum - 1); //make it fancy addTransitions(thisSlide.node); //put the current slide into position setPosition(thisSlide.node, 0); //slide the adjacent slides away if(slideData[slideNum - 1] &amp;&amp; slideData[slideNum-1].node){ addTransitions(slideData[slideNum - 1 ].node); setPosition( slideData[slideNum - 1 ].node , (0 - boundingBox[0]) ); } if(slideData[slideNum + 1] &amp;&amp; slideData[slideNum + 1].node){ addTransitions(slideData[slideNum + 1 ].node); setPosition(slideData[slideNum + 1 ].node, boundingBox[0] ); } //update the state currentSlide = slideNum; }</span></span></code> </pre><br><br>  At the moment, the lightbox is more or less functional.  We can go to the next and previous slide, we can hide and show it.  It would be ideal to know when we reach the first or last slide: you can, for example, display the gray controls.  This applies to both desktops and touch devices. <br><br><h4>  Adding gesture support </h4><br>  Most touch devices have built-in photo viewers.  These various applications, following the original iPhone photo viewer, created an agreement for the interfaces: sliding your finger to the left shows the next slide.  I have seen several implementations of such an interaction that do not give feedback at all - the slides are simply replaced when the gesture is completed.  The right approach is to give live feedback.  As the user slides his finger, the slides should move with him, and, depending on the direction, the next or previous slide should appear.  This creates the illusion that the user is pulling a strip of photos. <br><br><img src="http://habrastorage.org/storage2/6d7/2ad/f8c/6d72adf8c212a82f541dde3021cb20ae.jpg" title="Transition between slides" alt="  "><br><br><h5>  Handling touch events </h5><br>  Many libraries, including Zepto, include support for sensory events.  In general, I do not recommend using them.  When processing touch events, you update elements along with custom gestures.  When the delay is noticeable to the user, it causes a feeling of a slow interface.  One of the main reasons why we used libraries for events is to provide normalization in browsers.  All mobile browsers that support touch events have the same API. <br><br>  There are three sensory events that we consider in this example: ‚Äútouchstart‚Äù, ‚Äútouchmove‚Äù and ‚Äútouchend‚Äù.  There is also a touchcancel event when the gesture is interrupted for some reason (for example, a push message).  When developing you should process them correctly. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">attachTouchEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bd = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'html'</span></span>); bd.addEventListener(<span class="hljs-string"><span class="hljs-string">'touchmove'</span></span>, handleTouchEvents); bd.addEventListener(<span class="hljs-string"><span class="hljs-string">'touchstart'</span></span>, handleTouchEvents); bd.addEventListener(<span class="hljs-string"><span class="hljs-string">'touchend'</span></span>, handleTouchEvents); }</code> </pre><br><br>  The event handler receives a TouchEvent object.  The ‚Äútouchstart‚Äù and ‚Äútouchmove‚Äù events contain the ‚Äútouches‚Äù property, which is the object of the ‚ÄúTouch‚Äù array.  To slide a finger, only one property is needed: ‚ÄúclientX‚Äù.  It contains the value of the touch position relative to the upper left corner of the page. <br><br>  iOS devices support up to eleven simultaneous touches.  Android (before Ice Cream Sandwich) supports only one.  Most interactions require only one touch.  More complex gestures make you worry about multiple touches. <br><br><h5>  The "handleTouchEvents" function </h5><br>  First, we define several variables outside this function to support states: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> startPos, endPos, lastPos;</code> </pre><br><br>  The following branch is based on the property type of the event object: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleTouchEvents</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> direction = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//you could also use a switch statement if(e.type == 'touchstart') { } else if(e.type == 'touchmove' ) { } else if(e.type == 'touchend) { }</span></span></code> </pre><br><br>  The touchstart event starts at the beginning of any touch event, so use it to record where the gesture started, which will come in handy later.  Get rid of any transitions that may still be in the tags. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(e.type == <span class="hljs-string"><span class="hljs-string">'touchstart'</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//record the start clientX startPos = e.touches[0].clientX; //lastPos is startPos at the beginning lastPos = startPos; //we'll keep track of direction as a signed integer. // -1 is left, 1 is right and 0 is staying still direction = 0; //now we clean off the transtions if(slideData[currentSlide] &amp;&amp; slideData[currentSlide].node){ cleanTransitions(slideData[currentSlide].node); } if(slideData[currentSlide + 1] &amp;&amp; slideData[currentSlide + 1].node){ cleanTransitions(slideData[currentSlide + 1].node); } if(slideData[currentSlide - 1] &amp;&amp; slideData[currentSlide -1].node){ cleanTransitions(slideData[currentSlide -1].node); } } else if(e.type == 'touchmove' ) {</span></span></code> </pre><br><br>  In ‚Äútouchmove‚Äù, determine how much touch has passed along ‚ÄúclientX‚Äù, and then move the current slide to the same distance.  If the slide moves to the left, also move the next slide; if to the right, move the previous slide accordingly.  In this way, you only move two blocks, but this creates the illusion that the whole strip is moving. <br><br><pre> <code class="javascript hljs">}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(e.type == <span class="hljs-string"><span class="hljs-string">'touchmove'</span></span>){ e.preventDefault(); <span class="hljs-comment"><span class="hljs-comment">//figure out the direction if(lastPos &gt; startPos){ direction = -1; }else{ direction = 1; } //make sure the slide exists if(slideData[currentSlide]){ //move the current slide into position setPosition(slideData[currentSlide].node, e.touches[0].clientX - startPos); //make sure the next or previous slide exits if(direction !== 0 &amp;&amp; slideData[currentSlide + direction]){ //move the next or previous slide. if(direction &lt; 0){ //I want to move the next slide into the right position, which is the same as the //current slide, minus the width of the viewport (each slide is as wide as the viewport) setPosition(slideData[currentSlide + direction].node, (e.touches[0].clientX - startPos) - boundingBox[0]); }else if(direction &gt; 0){ setPosition(slideData[currentSlide + direction].node, (e.touches[0].clientX - startPos) + boundingBox[0]); } } } //save the last position, we need it for touch end lastPos = e.touches[0].clientX; }else if(e.type == 'touchend'){</span></span></code> </pre><br><br>  At the end of the slides, it is necessary to determine further behavior: go in a circle or stop on the last slide.  If you leave the user on the last slide, then when you try to scroll through the slide, you need to return him back to his position, thus giving the user feedback on why the slide has not changed. <br><br><img src="http://habrastorage.org/storage2/4e9/31c/5ef/4e931c5ef2a64c9bd0272c69c200793a.jpg" title="Last slide" alt=" "><br><br><pre> <code class="javascript hljs">}<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(e.type == <span class="hljs-string"><span class="hljs-string">'touchend'</span></span>){ <span class="hljs-comment"><span class="hljs-comment">//figure out if we have moved left or right beyond a threshold //(50 pixels in this case) if(lastPos - startPos &gt; 50){ goTo(currentSlide-1); } else if(lastPos - startPos &lt; -50){ goTo(currentSlide+1); }else{ //we are not advancing, so we need to "snap back" to the previous position addTransitions(slideData[currentSlide].node); setPosition(slideData[currentSlide].node, 0); if(slideData[currentSlide + 1] &amp;&amp; slideData[currentSlide + 1].node){ addTransitions(slideData[currentSlide + 1]); setPosition(slideData[currentSlide + 1].node, boundingBox[0]); } if(slideData[currentSlide - 1] &amp;&amp; slideData[currentSlide - 1].node){ addTransitions(slideData[currentSlide - 1]); setPosition(slideData[currentSlide - 1].node, 0 - boundingBox[0]); } } }</span></span></code> </pre><br><br>  Now all the main elements are in place.  You have a simple touch lightbox! <br><br>  <b>From the translator:</b> <br>  If you find any translation errors, please unsubscribe in private messages.  Thank. </div><p>Source: <a href="https://habr.com/ru/post/143211/">https://habr.com/ru/post/143211/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143205/index.html">Google has discovered the key technology Street View</a></li>
<li><a href="../143206/index.html">Welcome-email or How not to screw it up and not to lose a new client</a></li>
<li><a href="../143207/index.html">Dropquest 2012 will start next week</a></li>
<li><a href="../143208/index.html">Xscreensaver of hours on Esquire.ru</a></li>
<li><a href="../143209/index.html">Nokia claims compliance with 45 patents from HTC, RIM and Viewsonic</a></li>
<li><a href="../143212/index.html">Yota officially announces the launch of LTE in Moscow on May 10</a></li>
<li><a href="../143214/index.html">Google has updated the design features of Google Docs</a></li>
<li><a href="../143215/index.html">ThePirateBay will be banned in the UK</a></li>
<li><a href="../143216/index.html">Cyprus with five SIM cards: whose roaming is cheaper</a></li>
<li><a href="../143218/index.html">Andrei Breslav - Kotlin language for the Java platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>