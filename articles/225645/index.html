<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of Iframe applications on VK API. From the first cones to the two millionth audience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, in this post we will talk about how I created the Iframe application in a well-known social network. The post will be more narrative than infor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of Iframe applications on VK API. From the first cones to the two millionth audience</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9b5/5fd/f4f/9b55fdf4f1b6454f2c395ab9448ddfd7.jpg" alt="image" align="right"><br><img src="https://habrastorage.org/getpro/habr/post_images/19e/1ef/013/19e1ef013a36f4c094f1268661fbb819.jpg" alt="image" align="right"><br><img src="https://habrastorage.org/getpro/habr/post_images/27f/58a/e86/27f58ae86e9b95731befc73ef2e137aa.jpg" alt="image" align="right">  Hello, in this post we will talk about how I created the Iframe application in a well-known social network.  The post will be more narrative than informative, although I will try to answer many of the questions that put me in a stupor at the initial stage. <br><br>  I got acquainted with the Contact API relatively recently.  Then it seemed to me terribly complex and ambiguous, with a minimum of explanations and a complete lack of examples of use.  Now, pulling up knowledge in javaScript, I have absolutely no difficulties.  On the contrary, it is even pleasant that the developers in many ways thought for me. <br><br>  Working with the javascript API Vkontakte just to disgrace.  You just need to connect the xd_connection.js file, initialize the VK API, and make requests no more than three times per second.  It is also worth noting that, without any requests, Vk sends many necessary parameters to the Iframe as a flashVars object.  From it, you can pull out the user id, a token that simplifies user authorization on a third-party server, the interface language, and <a href="http://vk.com/pages%3Foid%3D-1%26p%3D%25D0%2594%25D0%25BE%25D0%25BA%25D1%2583%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F_API_%25D0%2592%25D0%259A%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B0%25D0%25BA%25D1%2582%25D0%25B5">other usefulness</a> . <br><a name="habracut"></a><br><h4>  First went </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/9e2/caa/4a4/9e2caa4a4b5602b15568b4690132ac85.png" alt="image" align="right">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the first application, I decided not to split hairs and do a psychological test with the subsequent posting of the result on the wall to the user.  Perhaps many now say fu and will not continue to read.  Frankly, I myself am not a fan of all this shamanism with psychoanalysis and astrology, however, as it turned out later, such applications quickly gain an audience.  But the tests were the sea, and it was necessary to come up with something flattering that would intrigue the users and encourage them to share the result on their wall.  And I decided to make a test for psychological salary.  You need to answer a few simple questions, after which the application suggests placing an entry with the result on your wall.  It is called " <a href="http://vk.com/real_zarplata">What kind of salary do you deserve?</a> ".  At the moment he has 1'700'000 installations. <br><br>  It took me three days to create.  And 90% of the time was spent forcing the posting on the wall to work.  A simple algorithm, based on the selected answers, calculated the result, sent a request to the server that generated the image (used the text to overlay the image using <a href="http://habrahabr.ru/post/43744/">this class</a> ) with the required salary and uploaded it to the server. <blockquote>  <b>Important:</b> do not forget in the settings of the application to choose which personal information you need access to.  In other words, what you will request through api, otherwise Vkontakte will not give you this information. <img src="https://habrastorage.org/getpro/habr/post_images/036/496/a91/036496a91a76f79f8c0f010c2df4cd80.png" alt="image"></blockquote>  Post looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a9/f2b/16d/0a9f2b16d736243fb4d748246986109f.jpg" alt="image"><br><br>  I decided to add a zest to the application and at the end I made a calculation of how much and what you can buy for your ‚Äúpsychological‚Äù salary. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a1/b50/776/9a1b507768819de6748a16f95e59e608.png" alt="image"><br><br><h4>  Moderation </h4><br>  When the application is created and enabled in the settings, it can be launched via a direct link by any user.  In order to get to the search and directory, it must be moderated.  To do this, leave as a pledge 10 votes (local currency VC) and wait.  Very often during the first moderation, the answer from technical support looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f7/ee1/45b/2f7ee145be89d34268f7335fb0126fe1.png" alt="image"><br><br><blockquote>  <b>Attention: to</b> clarify what exactly the moderators did not like with this answer will not work.  You will be politely told that they do not give such references. </blockquote>  In rare cases, technical support rejects the application and immediately tells you what needs to be corrected and even sends a screenshot.  Most likely, they have some sort of checklist with which they check applications.  My situation was saved by the addition of the ‚Äúabout application‚Äù button, which bears absolutely no meaning, however, after its appearance, the application was finally approved.  The pledge, by the way, was always returned. <br><br><blockquote>  <b>Important:</b> for the correct operation of the application without an SSL certificate is necessary.  Otherwise, the application will not open via https and you will lose half of the users.  <u>Self-signed certificate is not a solution</u> </blockquote><br><br><h4>  Takeoff </h4><br>  The case is left for small.  A friend involved in groups made several advertising posts, and then the application broke off as a chain: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/599/ea4/4b7/599ea44b7036a1615c960d910ebcb673.png" alt="image" align="right"><br><br>  For a week, attendance in itself jumped to 125 thousand a day.  Frankly, I did not expect such a load, so I had to even rent a server more powerful.  Inspired by this success, I did a few more tests on the finished platform.  they scored 1'300'00, 300'000 and 100'000 thousand installations today.  I see no point in talking about them, they are similar. <br><br>  The first rake that I stepped on was the php log file, which grew to <b>800GB</b> .  This happened due to several notice level errors that were logged each time the user passed the test. <br><br>  Interestingly, in the first month of existence, the test was popular with older audiences (25+), but a month later, schoolchildren seized the initiative. <br><br><blockquote>  For the sake of curiosity, I added the following question: ‚ÄúDo you think the dollar will rise in price tomorrow?‚Äù And began to keep statistics on it in order to predict the exchange rate by the mood of the population.  But it never came to this, so if anyone is interested, I can provide a database for analysis. </blockquote><br><br><h4>  Change the course </h4><br>  With all the virality of the tests, they have one big drawback - a small return to the audience.  For the second time, units will enter this application.  So I decided to make a game.  More precisely, I took the game 2048 Gabriele Cirulli as a basis, then nobody knew about it.  Despite the fact that the game opensource, I still asked permission from the <a href="http://gabrielecirulli.com/">author</a> personally. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6c5/609/ee5/6c5609ee56017191eb9e1e03defbc388.png" alt="image"><br><br>  Having received a positive response, I set to work.  A few days later, a game called " <a href="http://vk.com/stacker2048">Stacker 2048</a> " was moderated. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa5/0b7/505/aa50b7505344d7978c78ad49038e3f8e.png" alt="image"><br><br>  Suddenly, the second rake appeared.  The next morning, the application was hacked by the simplest XSS attack.  The fact that user data can not be trusted, then I simply did not know.  The schoolboy substituted the script instead of his name in the list of ‚ÄúTop 100‚Äù, as a result of which abusive alerts did not allow players to do anything.  In the process of plugging holes, I became acquainted with many types of tricks that juvenile Robinhood hackers are capable of, who, after making a mess of it, wrote to the PM that it was me because I stole the game.  I filled up the holes as they appeared.  There were SQL injection and CSRF vulnerabilities.  Once I demolished the entire database.  Someone even tried to put the server with the generated pictures, supplying a random string to the file generator 10 times per second.  Now, having stuffed the cones, I use the token and sessions for each user, transfer all the POST data with the request, attaching a hash of all the transmitted data, which is checked on the server.  Since then, nothing terrible, fortunately, no longer happens. <br><br>  The raked number three became the generated pictures.  If for 2048 the number of points for many users is the same and it is easier to store pictures with the results than to generate them again each time, then for tests the outcome is always different and there are a lot of pictures.  Therefore, you have to use the Cron scheduler to clean the folder with pictures every 10 minutes. <br><br>  At the moment, 180,000 people play in Stacker, and the user return rate is very high. <br><br><blockquote>  For Vkontakte games, there is a special starting traffic injection - adding an application to the category of new ones, to the very top.  It costs 1000 votes, while waiting for a month and a half in the queue and be sure to have in-app purchases in the app. </blockquote><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4de/494/f67/4de494f678ccc59443dec33f53e8986c.png" alt="image"><br><br><h4>  Monetization </h4><br>  As soon as attendance went uphill, I seriously thought about monetization of my applications.  There was no particular choice, since there are not so many affiliate programs working directly with Vkontakte.  I stopped at the preloader, which shows a short promotional video every time you log into the application, if the user falls under the target audience.  This is about 60% of the entire audience.  And advertisements in the style of those that contact shows itself.  With the current attendance, the income from my four applications averages 2000r per day.  To track attendance, I made a separate page, on which, using HTML canvas, I display the graphs of user activity. <br><br><h4>  Afterword </h4><br>  For me personally, such independent earnings became a breakthrough and an excellent incentive.  The more I do applications, the more ideas I get.  I plan in the near future to develop something more serious.  I hope this post was useful and interesting. </div><p>Source: <a href="https://habr.com/ru/post/225645/">https://habr.com/ru/post/225645/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225635/index.html">C ++ drivers for STM8L051F3</a></li>
<li><a href="../225637/index.html">Ideas underlying responsive emails</a></li>
<li><a href="../225639/index.html">Mikrotik and GNS3</a></li>
<li><a href="../225641/index.html">New Optional class in Java 8, not a panacea for NullPointerException</a></li>
<li><a href="../225643/index.html">Antenna for Wi-Fi on your knee in 10 minutes</a></li>
<li><a href="../225647/index.html">IText: we take out the text from PDF</a></li>
<li><a href="../225649/index.html">Creating a custom component based on a ListView</a></li>
<li><a href="../225651/index.html">How to teach a player to understand your application, not nullifying the work of artists, not offending programmers and not considering players mentally retarded</a></li>
<li><a href="../225653/index.html">MIDI Wavy: make controlled color music using Arduino and MIDI</a></li>
<li><a href="../225655/index.html">Syncthing sync + installer review on Raspberry Pi and Macbook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>