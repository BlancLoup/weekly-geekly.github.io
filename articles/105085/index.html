<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>QtCreator TODO Plugin. Continuation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I wrote about the plugin I developed that display a list of all the TODOs, FIXMEs, and so on comments in the current open document. Yest...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>QtCreator TODO Plugin. Continuation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/00/9e/009ed99d5b3d873b7291d75c5fad579c.png" alt="TODO Plugin"><br><br>  Some time ago I <a href="http://habrahabr.ru/blogs/qt_software/101311/">wrote</a> about the <a href="http://gitorious.org/qt-creator-todo-plugin">plugin</a> I developed that display a list of all the TODOs, FIXMEs, and so on comments in the current open document.  Yesterday I released a new version of this plugin, in which there were quite a few changes, here are the key ones: <br><ul><li>  Appeared settings </li><li>  Now you can add your search keywords and set the color and icon for their output. </li><li>  You can choose where to display information: in the standard window ‚ÄúBuild issues‚Äù or in a separate ‚ÄúTODO Output‚Äù. </li><li>  You can choose: continue to display information only about the current open file or collect information from the entire current project. </li><li>  Comments in languages ‚Äã‚Äãother than English are now displayed correctly. </li></ul><br>  During the development, I managed to dig up a few interesting things that might come in handy for other plugin developers, and I‚Äôll share it with the cat. <br><a name="habracut"></a><br><h4>  Settings </h4><br><img src="https://habrastorage.org/storage/habraeffect/ca/07/ca07b21a8eda9d2db215e26ad2c64ea4.png" alt="settings"><br><br>  The first thing I needed was to find out how to create a custom tab in the QtCreator settings, it seemed pretty simple, all it took was to add a new class inherited from the <i>Core :: IOptionsPage interface</i> , its declaration looks like this: <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SettingsPage</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Core::IOptionsPage { Q_OBJECT <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: SettingsPage(KeywordsList keywords = KeywordsList(), <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> projectOptions = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> paneOptions = <span class="hljs-number"><span class="hljs-number">0</span></span>, QObject *parent = <span class="hljs-number"><span class="hljs-number">0</span></span>); ~SettingsPage(); <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">id</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//    QString trName() const; //    (   ) QString category() const; //        QString trCategory() const; //    (   ) QString displayName() const; //    QIcon categoryIcon() const; //   QString displayCategory() const; //    QWidget *createPage(QWidget *parent); //      void apply(); //       "Apply"  "OK" void finish(); //        - "OK"  "Cancel" public slots: void settingsChanged(); private: SettingsDialog *dialog; //   bool settingsStatus; //  ? int projectOptions; //   int paneOptions; //   KeywordsList keywords; //    };</span></span></code> </pre> <br>  The tab widget I created in the designer there‚Äôs nothing complicated about a standard QlistWidget, a few QRadioButton and a bunch of buttons (see the image). <br>  The key here is the <i>apply ()</i> method, which is where the settings are saved. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It looks like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SettingsPage::apply() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (settingsStatus) { QSettings *settings = Core::ICore::instance()-&gt;settings(); <span class="hljs-comment"><span class="hljs-comment">//      settings-&gt;beginGroup("TODOPlugin"); //    projectOptions = dialog-&gt;currentFileRadioButtonEnabled() ? 0 : 1; //     paneOptions = dialog-&gt;todoOutputRadioButtonEnabled() ? 0 : 1; keywords = dialog-&gt;keywordsList(); settings-&gt;setValue("project_options", projectOptions); //   settings-&gt;setValue("pane_options", paneOptions); settings-&gt;setValue("keywords", qVariantFromValue(keywords)); settings-&gt;endGroup(); settings-&gt;sync(); //   (   ) QMessageBox::information(dialog, tr("Information"), tr("The TODO plugin settings change will take effect after a restart of Qt Creator.")); //           settingsStatus = false; } }</span></span></code> </pre><br>  In general, nothing complicated, just to remind you that in order to be able to transfer your own data types to QVariant, for them you need to define the operators: &lt;&lt; and &gt;&gt;, as well as register them in the MOC. <br><br><h4>  Build Issues Window </h4><br><img src="https://habrastorage.org/storage/habraeffect/5c/a6/5ca6bc3d83c5c1fc27677c290c9d6c4b.png" alt="taskwindow"><br><br>  Strictly speaking, it is called TaskWindow and can serve as standard output for any messages.  I decided to add the ability to display messages in this window on the strong advice of people from the Qt Developer Network community, which I also <a href="http://habrahabr.ru/blogs/nokia/97127/">wrote</a> about earlier.  You can access this window as follows, you need to connect the following heading to the project: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;projectexplorer/taskwindow.h&gt;</span></span></span></span></code> </pre><br>  And get a pointer to the window: <br><pre> <code class="cpp hljs">taskWindow = pluginManager-&gt;getObject&lt;ProjectExplorer::TaskWindow&gt;();</code> </pre><br>  Everything.  Now you can work with him, for this are the methods: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addCategory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;categoryId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;displayName)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Task &amp;task)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Task &amp;task)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearTasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString &amp;categoryId = QString())</span></span></span></span>;</code> </pre><br><br>  Categories are needed to identify exactly our messages. <br>  <i>Task</i> structure is simple and looks like this: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PROJECTEXPLORER_EXPORT</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Task</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TaskType { Unknown, Error, Warning }; Task() : type(Unknown), line(<span class="hljs-number"><span class="hljs-number">-1</span></span>) { } Task(TaskType type_, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;description_, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;file_, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> line_, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString &amp;category_) : type(type_), description(description_), file(file_), line(line_), category(category_) { } Task(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Task &amp;source) : type(source.type), description(source.description), file(source.file), line(source.line), category(source.category), formats(source.formats) { } ~Task() { } TaskType type; QString description; QString file; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> line; QString category; QList&lt;QTextLayout::FormatRange&gt; formats; };</code> </pre><br>  <b>Important:</b> In the spec, you need to specify the dependence of the plugin on ProjectExplorer <br><br><h4>  Progressbar </h4><br><img src="https://habrastorage.org/storage/habraeffect/5a/7f/5a7f574055f8b07f8f91270fab16a624.png" alt="progressbar" align="left">  To implement the progress bar, it took a bit of magic and nerves.  In order for the scan not to slow down the rest of the project load, I put it in a separate thread: <br><pre> <code class="cpp hljs"> QFuture&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; result = QtConcurrent::run(&amp;TodoPlugin::readCurrentProject, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre><br>  As it turned out, this beloved gray-green progress was specially tailored to work with a separate stream. <br><br>  In order to work with it, you need to add the following headings: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;coreplugin/progressmanager/progressmanager.h&gt; #include &lt;qtconcurrent/runextensions.h&gt;</span></span></span></span></code> </pre><br>  Adding a new progress bar happens like this: <br><pre> <code class="cpp hljs"> Core::ICore::instance()-&gt;progressManager()-&gt;addTask(result, tr(<span class="hljs-string"><span class="hljs-string">"Todoscan"</span></span>), <span class="hljs-string"><span class="hljs-string">"Todo.Plugin.Scanning"</span></span>);</code> </pre><br>  Work with it is done from the scan stream, this method: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TodoPlugin::readCurrentProject(QFutureInterface&lt;<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>&gt; &amp;future, TodoPlugin *instance) { QStringList filesList = instance-&gt;currentProject-&gt;files(ProjectExplorer::Project::ExcludeGeneratedFiles); <span class="hljs-comment"><span class="hljs-comment">//    future.setProgressRange(0, filesList.count()-1); //    for (int i = 0; i &lt; filesList.count(); ++i) { instance-&gt;readFile(filesList.at(i)); //    future.setProgressValue(i); //    } // SKIPPED }</span></span></code> </pre><br>  What is the magic you ask?  Notice, the function header and its call, two parameters are declared in the header, and only the second is passed in the call, the first is omitted.  The first parameter is inserted there with the code from the second required header (qtconcurrent / runextensions.h).  That's all the magic. <br><br><h4>  Conclusion </h4><br>  That's all for now, you can still download the plugin <a href="http://gitorious.org/qt-creator-todo-plugin">from here</a> , distributed under the BSD license - experiment with the health.  I will add that, under Windows it was not tested, due to the lack of on-line, I will be grateful for testing and bug reports. </div><p>Source: <a href="https://habr.com/ru/post/105085/">https://habr.com/ru/post/105085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../105075/index.html">Impressions of the past day developer Windows Phone 7</a></li>
<li><a href="../105078/index.html">New LJ Interface Element</a></li>
<li><a href="../105079/index.html">CodeFest - flew to spring</a></li>
<li><a href="../105081/index.html">3D glasses trick compatibility from Samsung and Panasonic</a></li>
<li><a href="../105082/index.html">Widget Yandex.Webmaster</a></li>
<li><a href="../105086/index.html">Ubuntu - Face control to log in</a></li>
<li><a href="../105087/index.html">Droider Chart. Release 20</a></li>
<li><a href="../105088/index.html">The Xmarks project (also called Foxmarks) is closing due to lack of funds</a></li>
<li><a href="../105089/index.html">Node-mysql-libmysqlclient v1.0.0</a></li>
<li><a href="../105090/index.html">Wikipedia switches to P2P video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>