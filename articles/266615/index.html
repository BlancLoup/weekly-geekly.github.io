<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous execution of PHP script on subprocesses</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear habrovchane. 

 Today I would like to talk about such non-trivial things as asynchronous (parallel) calculations in the PHP langu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous execution of PHP script on subprocesses</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/cf7/4af/71b/cf74af71b5b74c3ca00c8eaacc5cdb26.jpg"><br><br>  Good afternoon, dear habrovchane. <br><br>  Today I would like to talk about such non-trivial things as asynchronous (parallel) calculations in the PHP language. <br>  PHP itself is a scripting language that never claimed to be multi-threaded.  But the farther into the forest, the more serious tasks facing the developers, and the more they have to ‚Äúpervert‚Äù with a puff, because many companies simply fear and do not want to migrate to a more appropriate programming language for these tasks.  Therefore, we have to work with what they give. <br>  Details under the cut ... <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some time ago, I had a rather non-trivial task. <br>  In short, the project implemented about 20 very heavy modules for calculating the cost of goods. <br>  All this hung on several relational tables, each of the modules contained its own calculation rules and so on.  But it was necessary to issue all this to the client as a single package.  And this should have been done quickly.  Very fast.  Caching saved, but in very limited amounts, completely insufficient to meet the technical requirements. <br><br>  The algorithm was quite simple: the necessary arguments were given to the input, then all the modules were instantiated into the array, and the whole thing was calculated in the loop.  The answer was going to a single object and spat out on the client for post-processing. <br><br>  So, at a certain moment, we and the team reached a dead end, and realized that each new module adds not even a linear amount of processing time, but with some increasing progression. <br><br>  As you already guessed, it was suggested to parallelize the process in any way.  But with PHP, it's not easy, because he can't do this out of the box. <br><br>  Different solutions were tested: <br><ul><li>  <a href="http://php.net/manual/ru/class.thread.php">PHP: Thread</a> </li><li>  <a href="http://php.net/manual/ru/function.pcntl-fork.php">pcntl_fork ()</a> </li><li>  other various custom solutions </li></ul><br><br>  Unfortunately, in the end nothing came of it.  It was decided to minimize the project. <br><br>  But for me the question remained open, because the decision should be.  And even then we thought about some kind of ‚Äúsubprocesses‚Äù that the main script generates (analogous to the <i>exec ()</i> function). <br><br>  A lot of time has passed since then, I left the project a long time ago.  But just last week I had one very nontrivial task: to write a script that in a certain way would secure the current state of some entity and part of its heavy relational dependencies.  For this purpose, 2 classes are used that correctly prepare the data and store it in the database.  The problem is that there are about 2800 such objects. My script falls off <br><br><pre><code class="bash hljs">PHP Fatal error: Allowed memory size of &lt;over9000&gt; bytes exhausted.</code> </pre> <br>  For each package of 50 entities, on average, 190mb of memory is spent, with each new package the amount of used memory grew.  When the restrictions on the use of RAM were completely disabled, I received the same error plus Segmentation Fault. <br><br>  Those.  anyway, it was necessary to figure out how to avoid overflowing the RAM in the script, and try to make it a little bit faster.  First, we tried to figure out why the memory consumption increases from iteration to iteration.  It turned out that the legs grow out of the features of the symphonic ServiceContainer and EventDispatcher.  There in event all container is pushed, and then it becomes recursively.  Frankly speaking, it was all too lazy to bypass us, and my colleague suggested a rather elegant solution. <br><br>  The symfony2 component set has such a great thing as the <a href="http://symfony.com/doc/current/components/process.html">symfony process</a> component. <br>  This vunderwafl allows you to spawn a subprocess during the execution of the script and run it in CLI mode (like a regular console command). <br><br>  At first we just tried to ‚Äúbud off‚Äù one process at a time to limit the use of RAM.  But then they read at the docks that this thing can work asynchronously. <br><br>  It was decided to try it in the case.  The result was something like this (Below is an example from the Example repository on GitHub. The logic of the subprocesses themselves is very simple, but weighted): <br><br><div class="spoiler">  <b class="spoiler_title">Maincommand</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Example</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Input</span></span>\<span class="hljs-title"><span class="hljs-title">InputInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Output</span></span>\<span class="hljs-title"><span class="hljs-title">OutputInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Process</span></span>\<span class="hljs-title"><span class="hljs-title">Process</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainCommand</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setName(<span class="hljs-string"><span class="hljs-string">'example:main'</span></span>) -&gt;setDescription(<span class="hljs-string"><span class="hljs-string">'Run example command with optional number of CPUs'</span></span>) -&gt;addArgument(<span class="hljs-string"><span class="hljs-string">'CPUs'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'number of working CPUs'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InputInterface $input, OutputInterface $output)</span></span></span><span class="hljs-function"> </span></span>{ $channels = []; $maxChannels = $input-&gt;getArgument(<span class="hljs-string"><span class="hljs-string">'CPUs'</span></span>); $exampleArray = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getExampleArray(); $output-&gt;writeln(<span class="hljs-string"><span class="hljs-string">'&lt;fg=green&gt;Start example process&lt;/&gt;'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (count($exampleArray) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> || count($channels) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($channels <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $channel) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($channel <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Process &amp;&amp; $channel-&gt;isTerminated()) { <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>($channels[$key]); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($channels) &gt;= $maxChannels) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$item = array_pop($exampleArray)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $process = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Process(sprintf(<span class="hljs-string"><span class="hljs-string">'php index.php example:sub-process %s'</span></span>, $item), <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../../../'</span></span>); $process-&gt;start(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$process-&gt;isStarted()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>($process-&gt;getErrorOutput()); } $channels[] = $process; } $output-&gt;writeln(<span class="hljs-string"><span class="hljs-string">'&lt;bg=green;fg=black&gt;Done.&lt;/&gt;'</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getExampleArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $array = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">30</span></span>; $i++) { $name = <span class="hljs-string"><span class="hljs-string">'No'</span></span> . $i; $x1 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); $y1 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); $x2 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); $y2 = rand(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); $array[] = $name . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . $x1 . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . $y1 . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . $x2 . <span class="hljs-string"><span class="hljs-string">'.'</span></span> . $y2; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $array; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">SubProcessCommand</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Example</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>\<span class="hljs-title"><span class="hljs-title">Command</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Input</span></span>\<span class="hljs-title"><span class="hljs-title">InputInterface</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Output</span></span>\<span class="hljs-title"><span class="hljs-title">OutputInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SubProcessCommand</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setName(<span class="hljs-string"><span class="hljs-string">'example:sub-process'</span></span>) -&gt;setDescription(<span class="hljs-string"><span class="hljs-string">'Run example sub-process command'</span></span>) -&gt;addArgument(<span class="hljs-string"><span class="hljs-string">'item'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InputInterface $input, OutputInterface $output)</span></span></span><span class="hljs-function"> </span></span>{ $items = explode(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, $input-&gt;getArgument(<span class="hljs-string"><span class="hljs-string">'item'</span></span>)); $pointName = $items[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $x1 = $items[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $y1 = $items[<span class="hljs-number"><span class="hljs-number">2</span></span>]; $x2 = $items[<span class="hljs-number"><span class="hljs-number">3</span></span>]; $y2 = $items[<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// Used for mocking heavy execution. $sum = 0; for ($i = 1; $i &lt;= 30000000; $i++){ $sum += $i; } $distance = bcsqrt(pow(($x2 - $x1),2) + pow(($y2 - $y1),2)); $data = sprintf('Point %s: %s', $pointName, (string)$distance); file_put_contents(__DIR__.'/../../../output/Point'.$pointName , print_r($data, 1), FILE_APPEND); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">index.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; $application = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Application(); $application-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Example\Command\MainCommand()); $application-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Example\Command\SubProcessCommand()); $application-&gt;run();</code> </pre><br></div></div><br><br>  As a result, we have approximately the following picture: <br><img src="https://habrastorage.org/files/37c/09f/3a8/37c09f3a88f74fcfaaa299a7fbac8430.png"><br><br>  Frankly, I was very impressed with such features. <br>  I hope some of this article will help.  As an additional material I will leave here a link to the repository, where the example given above was implemented. <br><br>  <a href="https://github.com/iCubeDm/php-subprocess-example">Repository</a> <br><br>  Thanks for attention.  I will be glad to feedback and comments. <br><br>  <i>UPD</i> <br>  Many thanks to <a href="https://habrahabr.ru/users/almazdeldiablo/" class="user_link">AlmazDelDiablo</a> and <a href="https://habrahabr.ru/users/skvot/" class="user_link">skvot</a> for the reminder. <br>  This solution will work only if the project does not prohibit the <code>proc_open()</code> function on which the symfony process component is based. <br><br>  Updated htop screenshot.  Now there is data on the processes.  Thank you <a href="https://habrahabr.ru/users/hell0w0rd/" class="user_link">hell0w0rd</a> </div><p>Source: <a href="https://habr.com/ru/post/266615/">https://habr.com/ru/post/266615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266603/index.html">PYCON RUSSIA 2015: the final program</a></li>
<li><a href="../266607/index.html">Energy Efficiency Data Center: Water and Refrigerants</a></li>
<li><a href="../266609/index.html">Incoding Framework - Get started</a></li>
<li><a href="../266611/index.html">Layout letters: What is "kinetic email"</a></li>
<li><a href="../266613/index.html">Duck stories: duck looking for bugs</a></li>
<li><a href="../266617/index.html">Free realtime list of online users (Parse.com + Pubnub)</a></li>
<li><a href="../266619/index.html">Overview of alternatives Proof of Work. Part 2. Proof of Activity, Proof of Burn, Proof of Capacity and Generals</a></li>
<li><a href="../266623/index.html">Event-oriented Python backtesting step by step. Part 3</a></li>
<li><a href="../266625/index.html">Cisco internship program - Cisco International Internship Program. How it was</a></li>
<li><a href="../266627/index.html">Himself a virtual operator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>