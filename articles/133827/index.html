<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network game in NES (Dendy) implemented on Flash P2P</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More than a year and a half has passed since the launch of nesbox.com , all this time the idea to make a game for two over the Internet has not left m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network game in NES (Dendy) implemented on Flash P2P</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/296/3e6/0c6/2963e60c6d1e1b17e4f09cd6260ada7b.png" alt="image"><br><br>  More than a year and a half has passed since the launch of <a href="http://nesbox.com/">nesbox.com</a> , all this time the idea to make a game for two over the Internet has not left me.  If you are interested in how we came to the working version, welcome under cat. <br><a name="habracut"></a><br>  I'll start with how our emulator works.  For a comfortable game, it should work out ~ 50-60 frames per second.  For each frame we transmit the state of both joysticks, in the form of 2 bytes, in which the set bit is responsible for one of the joystick buttons, and the output is a full screen buffer 256x240, and a sound range of 44100/60 ~ = 735 samples. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/499/a57/f10/499a57f10c1f60ce7b0d2b2d46f57663.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you can see, the interface is the simplest, but in order to make it all work on the network, we need to send the joystick state of the first player to the second player, get its joystick state, and then start generating a screen frame with sound.  And this should happen 50-60 times per second. <br><br>  The first prototype was a scheme with a primitive C ++ server that received data about the joysticks via the Flash Sockets and sent them to both clients.  The prototype was quite working, but users who were near the <a href="http://nesbox.com/">nesbox.com</a> server could play on the network (ping ~ 60ms).  Were thought to post it in open source, so that people themselves collected it and launched it on their servers in the immediate vicinity.  But here Adobe releases <a href="http://en.wikipedia.org/wiki/Real_Time_Media_Flow_Protocol">RTMFP</a> protocol and <a href="http://labs.adobe.com/technologies/cirrus/">Cirrus</a> technology, which solves all our problems, and now we can connect both emulators via <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B4%25D0%25BD%25D0%25BE%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B3%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B5%25D1%2582%25D1%258C">P2P</a> , and the problem with ping disappears.  At least, people within the same city can comfortably play together. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/563/7ed/e76/5637ede765d8ffa438dca0401223af73.png" alt="image"><br><br>  Start working with Flash P2P is elementary, the whole process has already been described in Habr√©: <a href="http://habrahabr.ru/blogs/Flash_Platform/130526/">Adobe Flash Player and the transfer of streaming data without server involvement</a> , we will not repeat.  The general meaning is that we connect to the Cirrus server, get a 256-bit id, send them to each other.  Everything, now you can send data peer-to-peer, which is implemented in our emulator. <br><br>  To test this technology and play together on the Internet, I suggest choosing one of the 16,000 roms on <a href="http://nesbox.com/">nesbox.com</a> and running emulation.  Not all Roma workers, so choose the green with the tag <u>verified</u> . <br><br><img src="http://i28.fastpic.ru/big/2011/1202/77/d281d4de883ec0464cc470c3cf172b77.png" alt="image"><br><br>  Choose <u>two players via internet</u> . <br><br><img src="http://i31.fastpic.ru/big/2011/1202/ed/9146aad15ef9504a54f60600817c7aed.png" alt="image"><br><br>  Copy the resulting URL into the clipboard and send it to the second player.  If everything is in order with the configurations of your networks, the game will start in a few seconds, if not, you can test the connection here <a href="http://cc.rtmfp.net/">http://cc.rtmfp.net</a> . <br><br>  My dream came true (and not only mine, a lot of people asked for it), now you can play dandy on the network with your friend in a browser! <br><br>  Below are some links to popular games for two players.  All your questions and suggestions will answer in the comments. <br><br>  <a href="http://nesbox.com/game/battle-city/rom/4790d4c1c59af5ca9ae29744050a55d5">Battle city</a> <a href="http://nesbox.com/game/battle-city/rom/4790d4c1c59af5ca9ae29744050a55d5"><br><img src="http://i30.fastpic.ru/big/2011/1202/a6/31a43136dfebf068afb1c727e8fbc0a6.jpg" alt="image"><br></a> <br><br>  <a href="http://nesbox.com/game/battletoads-double-dragon-the-ultimate-team/rom/4d64399b9db0f6d094054b7e5be30220">Battletoads &amp; Double Dragon - The Ultimate Team</a> <a href="http://nesbox.com/game/battletoads-double-dragon-the-ultimate-team/rom/4d64399b9db0f6d094054b7e5be30220"><br><img src="http://i31.fastpic.ru/big/2011/1202/08/4dffd235c2414abbc212b8d59b2c2508.jpg" alt="image"><br></a> <br><br>  <a href="http://nesbox.com/game/contra/rom/4337dc8d257b14fa3174d76bcc8aa079">Contra</a> <a href="http://nesbox.com/game/contra/rom/4337dc8d257b14fa3174d76bcc8aa079"><br><img src="http://i27.fastpic.ru/big/2011/1202/4f/07cd17ce58d6e1856f9938b15b63a14f.png" alt="image"><br></a> <br><br>  <a href="http://nesbox.com/game/chip-n-dale-rescue-rangers/rom/72b3d684e771aff6c8d6a36bf7aaeb51">Chip 'n Dale Rescue Rangers</a> <a href="http://nesbox.com/game/chip-n-dale-rescue-rangers/rom/72b3d684e771aff6c8d6a36bf7aaeb51"><br><img src="https://habrastorage.org/getpro/habr/post_images/e6e/f75/a64/e6ef75a64477812c0a7a9b0187fc7840.jpg" alt="image"><br></a> </div><p>Source: <a href="https://habr.com/ru/post/133827/">https://habr.com/ru/post/133827/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133821/index.html">API creation</a></li>
<li><a href="../133823/index.html">How to become a successful freelancer</a></li>
<li><a href="../133824/index.html">Person rating of the Russian market of customized web development Tagline-2011</a></li>
<li><a href="../133825/index.html">Wikileaks will publish documents about companies that create technology to spy on people</a></li>
<li><a href="../133826/index.html">Viola-Jones method (Viola-Jones) as a basis for facial recognition</a></li>
<li><a href="../133828/index.html">Using OpenGL Shaders in QML</a></li>
<li><a href="../133830/index.html">Wireless Joys: Samsung CA750 Monitor Review</a></li>
<li><a href="../133835/index.html">We remove the Store button in the music player iOS 5</a></li>
<li><a href="../133836/index.html">Replacing the menu of calls in iOS with an alternative one</a></li>
<li><a href="../133839/index.html">The state search took place: an e-government or state search bot began walking on Runet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>