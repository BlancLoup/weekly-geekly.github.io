<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast roaming (802.11r) on a Lede-based WiFi network (aka OpenWRT)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. I decided to fix the result by writing an article. And the result of this - is the union of several WiFi access points to the network into one ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast roaming (802.11r) on a Lede-based WiFi network (aka OpenWRT)</h1><div class="post__text post__text-html js-mediator-article">  Hello.  I decided to fix the result by writing an article.  And the result of this - is the union of several WiFi access points to the network into one inseparable network, also called seamless.  The meaning of this action was that my "local" home network has grown to several WiFi points because of its (network) large area and the inability to achieve proper quality with just one point. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a72/a17/cbe/a72a17cbef7fffc2bade93807367f986.png" alt="image"><br><a name="habracut"></a><br>  The first and head-on solution was to install several more WiFi APs with the same BSSID and it looked like everything worked, but as it turned out, not everything turned out.  For example, my Android based phone normally digested this situation by jumping from point to point when the signal was lost from one and the signal was detected from another, but the users of the wonderful iPhone had a problem with this, the device completely refused to disconnect from the point already missing from the radius of action and connect to a new, albeit with a bold signal.  Well, as it should be for this contingent (no hostility - just dry facts), the stench began that everything around G. my wonderful telephone could not work with this junk.  And I began to look for methods to combat this. <br><br>  My searches led me to the <a href="https://en.wikipedia.org/wiki/IEEE_802.11r-2008">802.11r</a> standard.  In which we are promised full transparency for WiFi devices on the network of several APs.  And even Apple <a href="https://support.apple.com/en-au/HT202628">confirms</a> that it can. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, for the sake of peace of mind and apple lovers we will master a new discipline.  A cursory study of theory and practice showed that hostapd seems to be able to do this miracle.  All my routers have long been on Lede (who does not know, this is the former OpenWRT) well, as if in this regard, the setting should not have created problems.  But as always, not everything is so simple, or I am tight :) <br><br>  To begin with, the default wpad-mini package is installed in the lede, it contains the main support for the WiFi AP with the minimum possible in order to work.  I do not like this alignment.  Therefore it is necessary to replace the package with wpad. <br><br>  In the simplest case, you need to run the command: <br><br><pre><code class="hljs sql">opkg <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> wpad</code> </pre> <br>  the package will pull in everything you need and replace wpad-mini.  Ideally, it‚Äôs not bad to just re-assemble the firmware image with ImageBuilder. <br><br>  After installing the package, you need to configure it.  If you are using the luci interface, then in the WiFi network settings in the Wireless Security section a tick will appear. <br><br><img src="https://habrastorage.org/files/650/957/a57/650957a57c8445a7a5df0f35712f6e29.JPG"><br><br>  By enabling which we are provided with a bunch of fields to configure the roaming function between APs. <br>  If you do not have luci or you prefer to tune the piece of iron by changing cofigs, then the same is done with the line: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">option</span></span> ieee80211r <span class="hljs-string"><span class="hljs-string">'1'</span></span></code> </pre> <br>  in the <i>config</i> section of the <i>wifi-iface</i> configuration file <i>/ etc / config / wireless</i> .  I hope there is no need to explain that this needs to be done on all APs involved in roaming. <br><br>  It was the easiest.  But then the fun began. <br><br>  In order to explain to all points that they need to be somehow configured in one roaming.  All the manuals that I managed to find persistently boil down to setting up this whole case using RADIUS authorization.  But I don‚Äôt have RADIUS either and I don‚Äôt need it, as I think most of us do.  So I had to experiment. <br><br>  Let's run through the fields that we have to fill in luci: <br><br>  <b>NAS ID</b> - as I understood the identifier of the current access point in the RADIUS server.  And it is not needed in the absence of the latter, but Luci does not allow to save the settings, if this field is not filled.  Well, let's fill it up.  Usually everyone is recommended to enter the MAC address of the device without separators there. <br><br>  <b>Mobility Domain</b> - specific identifier of your network.  Must be one for all roaming points.  It is a 16bit number in hexadecimal form (HEX). <br><br>  <b>External R0 Key Holder List</b> - this is where <i>NAS ID</i> will be involved, and they said it is needed only for RADIUS.  Or does this feature not participate without RADIUS?  Explain who in the know?  Here I added as many lines as I have access points to the network.  In the format: <i>MAC address, NAS-ID, 128-bit key in the form of a HEX string</i> <br>  Example: <code>12:fe:ed:6d:bf:ea, 12feed6dbfea, 8a7fcc966ed0691ff2809e1f38c16996</code> <br>  And so several times with each access point, I used the same key.  Also, if anyone knows how to? <br><br>  <b>External R1 Key Holder List</b> is an analogue of the previous section, only instead of a NAS-ID is some R1KH-ID. <br><br>  I filled it out like this: <code>12:fe:ed:6d:bf:ea, 12:fe:ed:6d:bf:ea, 8a7fcc966ed0691ff2809e1f38c16996</code> <br><br>  The result was something like this: <br><br><img src="https://habrastorage.org/files/b25/87e/cb6/b2587ecb65064f52a4a07f2899cbe795.JPG"><br><br>  In the form of a config, it all looks like this: <br><br><pre> <code class="hljs 1c"> option ieee80211r '1' option mobility_domain '4f57' option pmk_r1_push '1' list r0kh '12:fe:ed:6d:bf:ea,12feed6dbfea,8a7fcc966ed<span class="hljs-number"><span class="hljs-number">0691</span></span>ff<span class="hljs-number"><span class="hljs-number">2809</span></span>e1f38c<span class="hljs-number"><span class="hljs-number">1699</span></span>6' list r0kh 'e8:94:f6:e5:46:72,e894f6e<span class="hljs-number"><span class="hljs-number">5467</span></span>2,8a7fcc966ed<span class="hljs-number"><span class="hljs-number">0691</span></span>ff<span class="hljs-number"><span class="hljs-number">2809</span></span>e1f38c<span class="hljs-number"><span class="hljs-number">1699</span></span>6' list r1kh '12:fe:ed:6d:bf:ea,12:fe:ed:6d:bf:ea,8a7fcc966ed<span class="hljs-number"><span class="hljs-number">0691</span></span>ff<span class="hljs-number"><span class="hljs-number">2809</span></span>e1f38c<span class="hljs-number"><span class="hljs-number">1699</span></span>6' list r1kh 'e8:94:f6:e5:46:72,e8:94:f6:e5:46:72,8a7fcc966ed<span class="hljs-number"><span class="hljs-number">0691</span></span>ff<span class="hljs-number"><span class="hljs-number">2809</span></span>e1f38c<span class="hljs-number"><span class="hljs-number">1699</span></span>6' option nasid '12feed6dbfea' option r1_key_holder '12feed6dbfea'</code> </pre><br>  Having saved and rebooted all devices, it was not at first glance that everything continued to work.  Nothing has changed on my Android Phone.  The owners of the iPhone are satisfied so far - we'll be watching.  WiFi The analyzer still sees my network as a few points, but in addition to WPA-PSK authorization, FT-PSK was added. <br><br>  I wrote an article in order not to lose myself, and to get criticism and help in understanding what was done :) I would be grateful for any comments. </div><p>Source: <a href="https://habr.com/ru/post/327166/">https://habr.com/ru/post/327166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327152/index.html">Mikrotik L2TP / IPSec for NAT: ipsec, error failed to pre-process ph2 packet</a></li>
<li><a href="../327158/index.html">7 Barriers to Implementing Flexible Methodologies in Large Organizations</a></li>
<li><a href="../327160/index.html">SQL query for PHP (Version 0.2)</a></li>
<li><a href="../327162/index.html">Detect and track multiple objects in a video stream on an FPGA</a></li>
<li><a href="../327164/index.html">Genres and settings of mobile games - statistics for April 2017</a></li>
<li><a href="../327168/index.html">Autonumber in four languages. Part 2</a></li>
<li><a href="../327170/index.html">Yii2-advanced: Flexible configuration of Yii2 RBAC (roles, permissions, rules)</a></li>
<li><a href="../327172/index.html">"SQL Server 2017": Now with Python support</a></li>
<li><a href="../327176/index.html">Dispelling the myths about the Qt meta-object compiler</a></li>
<li><a href="../327178/index.html">The digest of interesting materials for the mobile developer # 200 (April 17-23)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>