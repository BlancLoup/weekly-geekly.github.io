<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the simplest plugin for ReSharper</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The goal: to write, test and deploy a simple plug-in for R #, containing custom Quick-Fix and Context Action. 

 Article layout: 


1. Setting up the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the simplest plugin for ReSharper</h1><div class="post__text post__text-html js-mediator-article">  The goal: to write, test and deploy a simple plug-in for R #, containing custom Quick-Fix and Context Action. <br><br>  Article layout: <br><ol><li>  <a href="https://habr.com/ru/post/270155/">Setting up the development environment</a> </li><li>  <a href="https://habr.com/ru/post/270155/">Example # 1: the simplest plug-in extension</a> </li><li>  <a href="https://habr.com/ru/post/270155/">Plug-in installation</a> </li><li>  <a href="https://habr.com/ru/post/270155/">Debugging, tips</a> </li><li>  <a href="https://habr.com/ru/post/270155/">Example 2: code modification using the R # API</a> </li><li>  <a href="https://habr.com/ru/post/270155/">Functional testing of plugins with R # API</a> </li></ol><br>  Cast: <br><blockquote>  Visual Studio 2015 <br>  ReSharper Ultimate 10 <br></blockquote><br>  Interested I invite under kat. <br><a name="habracut"></a><br><a name="P1"></a><h3>  1. Setting up the development environment </h3><br>  In order not to interfere with the work of the main instance of Visual Studio, in which we will write code, it is best to immediately prepare a separate ‚Äúecosystem‚Äù for our future plugin.  We start by <a href="http://resharper-support.jetbrains.com/hc/en-us/articles/206104048-Where-can-I-download-an-old-previous-ReSharper-version-">downloading the</a> so-called.  ‚ÄúChecked build‚Äù is an R # Ultimate build with extended diagnostic information, and the rest is identical natural. <br>  We also need a Visual Studio Experimental Instance - in some way a ‚Äúprofile‚Äù containing all user settings from the location of the windows to the installed extensions (aha!).  Profiles are isolated from each other exactly at the settings level, and Studio executable files are not copied anywhere.  For VS2015, it is possible to manage profiles using the CreateExpInstance.exe utility, but we have an even easier way.  Run the previously installed installer checked build'a, go to Options - Experimental Hive and enter the name of the new profile, which will later be used to install the developed plugin, and the clever R # this profile will create and install it there too.  Exactly, it is possible to install your own set of extensions in each profile, including its own version of R #, which facilitates testing plug-ins for several versions at once.  As already mentioned, the profiles are independent of each other, so your Visual Studio working profile will not be affected. <br><br>  To launch Studio with a new profile, you need a shortcut like: <br><blockquote>  "X: \ Microsoft Visual Studio 14.0 \ Common7 \ IDE \ devenv.exe" / rootSuffix YourHive /ReSharper.Internal <br></blockquote><br>  Here, YourHive is the name of a previously created profile, and the /ReSharper.Internal parameter starts R # in <a href="https://www.jetbrains.com/resharper/devguide/Extensions/InternalMode.html">development mode</a> , thereby turning on useful features, such as exception notifications generated inside plugins. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="P2"></a><h3>  2. Example number 1: the simplest extension-stub </h3><br>  R # offers various ways to modify and generate code, including Quick-Fix, Context Action, Refactoring, etc.  It seemed to me that the most simple to implement is Quick-Fix, so we will begin with it.  Quick-Fixes are R # commands known to any user with icons in the form of a yellow / red light bulb in an Alt + Enter pop-up menu, such as "Remove unused variable", "Initialize property from constructor", etc .: <br><img src="https://habrastorage.org/files/ba8/1de/849/ba81de849c95439e99d8a995e5ce713d.png"><br><br><br>  So, open our main studio copy (not experimental), and create a new project Class Library.  Install R # SDK: <br><blockquote>  Install-Package JetBrains.ReSharper.SDK <br></blockquote><br><div class="spoiler">  <b class="spoiler_title">About versions of R #, R # SDK and backward compatibility, or rather, its absence</b> <div class="spoiler_text">  At the time of this writing, the latest released version of JetBrains.ReSharper.SDK is version 10.0.20151101.194233, corresponding to R # 10. JetBrains <a href="https://www.jetbrains.com/resharper/devguide/Extensions/PlatformVersioning.html">does not provide</a> compatibility between major and minor versions of products, so the plug-in assembled in SDK 9.1 is not guaranteed in R # 9.2 and etc.  Hereinafter SDK 10 will be used, which means support only R # 10 and the impossibility of installation and correct operation in R # 9.2.  At the same time, there are no obstacles to reassemble all the code considered in the article under the SDK 9.2, thereby obtaining the plug-in working in R # 9.2 - verified. <br></div></div><br>  Let's place the following class in our project: <br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">QuickFix</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleFix</span></span> : <span class="hljs-title"><span class="hljs-title">QuickFixBase</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimpleFix</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NotInitializedLocalVariableError error</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Action&lt;ITextControl&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecutePsiTransaction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISolution solution, IProgressIndicator progress</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Text =&gt; <span class="hljs-string"><span class="hljs-string">"SimpleFix"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsAvailable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IUserDataHolder cache</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br>  Please note that any Quick-Fix must have at least one such constructor with an input parameter of type SomeError / SomeWarning.  The type of the parameter and determines for which error in the code Quick-Fix will be available in the drop-down menu.  Our Quick-Fix will be available when using a non-initialized local variable: <br><img src="https://habrastorage.org/files/88b/469/e3d/88b469e3dc4d482398ed71346b9ed7da.png"><br><br>  The R # SDK defines several hundreds of error classes available in the JetBrains.ReSharper.Daemon.CSharp.Errors namespace.  Classes corresponding to compilation errors have the error postfix in the name, various non-critical improvements - the warning postfix.  The whole next section, we will suffer with the deployment of our Quick-Fix. <br><br><a name="P3"></a><h3>  3. Installing the plugin </h3><br>  Let's add one more class to our project: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ZoneMarker</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ZoneMarker</span></span> { }</code> </pre><br>  Zones is a new functionality of R # SDK, which appeared in version 9.0, and <a href="https://www.jetbrains.com/resharper/devguide/Platform/Zones/HowTo.html">is still</a> being developed.  In particular, with the help of a zone it is indicated for which product from the R # Platform composition the extension being developed is intended.  Fortunately, at the moment it is enough for us to restrict ourselves to the stub class. <br><blockquote>  Important: ZoneMarker must be in the same namespace as the SimpleFix class created earlier, or above. </blockquote><br>  The next nuance - the distribution and installation of the plug-in in R # 9+ is done only through NuGet-packages.  To create the correct package, add a file with the .nuspec extension and the following contents to the project: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">metadata</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>PaperSource.ReSharper.HelloWorld<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authors</span></span></span><span class="hljs-tag">&gt;</span></span>You<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">authors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">owners</span></span></span><span class="hljs-tag">&gt;</span></span>You<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">owners</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requireLicenseAcceptance</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requireLicenseAcceptance</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> ,  id    !<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span>habrahabr.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Wave"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">metadata</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bin\Debug\PluginV10.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dotFiles\"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bin\Debug\PluginV10.pdb"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dotFiles\"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">package</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Important points: <br>  1. Dependence on the Wave package is required.  Wave is a new distribution model of R # Platform, which, in addition to R #, includes dotPeek, dotTrace, etc ... Without going into details: <br><blockquote>  ReSharper 9.0 - Wave 1.0; <br>  ReSharper 9.1 - Wave 2.0; <br>  ReSharper 9.2 - Wave 3.0; <br>  ReSharper 10.0 - Wave 4.0; <br></blockquote><br>  For versions of R # that are not listed in the &lt;dependency&gt; tag, the plug-in will be absent in the Extention Manager ‚Äî hence, unavailable for installation.  To specify multiple versions, you must use an entry of the form [A, B), while "[" means "inclusive", etc. <br><br>  2. The name of the plug-in specified in the &lt;id&gt; tag must contain a period.  That is simply a must, and that‚Äôs all!  <a href="https://www.jetbrains.com/resharper/devguide/Extensions/Packaging.html">The recommended</a> format is ‚ÄúCompany.Package‚Äù. <br><br>  After installing <a href="https://docs.nuget.org/consume/command-line-reference">NuGet.exe,</a> open the Package Manager Console and execute the command: <br><blockquote>  nuget pack "PaperSource.ReSharper.HelloWorld \ package.nuspec" <br></blockquote><br>  The finished .nupkg file will appear in the folder of your solution (or use the -OutputDirectory parameter to create a package in the folder you need).  You can ignore warnings like "Issue: Assembly outside lib folder."  To install the plug-in, in our experimental instance of Visual Studio, go to ReSharper - Options - Extention Manager and specify the path to the folder with the .nupkg file. <br><br>  The moment of truth: open ReSharper - Extention Manager, look for our plugin by name through search, install.  If everything is done correctly - SimpleFix will be available: <br><img src="https://habrastorage.org/files/88b/469/e3d/88b469e3dc4d482398ed71346b9ed7da.png"><br><br>  Known installation problems: <br><ul><li>  The plugin is not in the Extention Manager; </li><li>  The plug-in can be installed, but Quick-Fix does not appear in the right place. </li></ul><br>  In both cases, I would advise you to start by checking the .nuspec file, and then reading the official manual for <a href="https://www.jetbrains.com/resharper/devguide/Extensions/Troubleshooting.html">finding errors</a> .  By the way, the so-called.  installer logs at the approximate% LOCALAPPDATA% \ JetBrains \ Shared \ v02 \ InstallerLogXXX address for me every time turned out to be useless.  Even in the case of a successful installation, a lot of information is written to the logs about any exceptions thrown in, and it‚Äôs difficult to understand what causes the installation error. <br><br><a name="P4"></a><h3>  4. Debugging, useful tips </h3><br>  In order to go through the debugger through the extension code, it is sufficient through the Debug - Attach to Process to join the denenv.exe process of the experimental instance. <br><br>  Any plugin must be installed via the Extension Manager.  When making changes to the code, a guaranteed way to deploy these changes is a similar update / reinstallation.  However, there is an exception to this rule: if new files / classes were not added to the code, and there were no changes to the integration points with the studio (for example, the type of error for the already existing quick-fix was not changed), it is not necessary to reinstall the plugin.  It is enough to replace the plugin assembly with a new version.  R # stores assemblies with plug-ins deep in their depths, and in order not to dive into them once again, you should use MSBuild target, which copies the assembly where necessary after compilation.  To do this, in the .csproj file we place the following code: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HostFullIdentifier</span></span></span><span class="hljs-tag">&gt;</span></span>ReSharperPlatformVs14YourHive<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HostFullIdentifier</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The &lt;HostFullIdentifier&gt; tag is manually populated and has the following format: {Host} {Visual Studio version} {Visual Studio instance}.  The version shown in the listing will work for R # Ultimate, VS 2015 and a profile called YourHive.  If you specify an incorrect HostFullIdentifier, when you build the project, all possible HostFullIdentifier options will be displayed in Output. <br><br><a name="P5"></a><h3>  5. Example 2: code modification using the R # API </h3><br>  ‚ÄúWhat do we all stubs?  Let's get the real code, the code! ‚Äù- in this section we will write a simple plugin that honestly reads and modifies the syntactic tree of the R # code.  I wanted to show you something that does not duplicate the functionality of R #, while being both quite simple and applicable in practice.  And that's what managed to come up.  Suppose we have a method that returns a List type, and for some reason we want to quickly replace in the return statement the value null with the empty collection corresponding to the method signature.  For example: <br><img src="https://habrastorage.org/files/0f6/12b/e4a/0f612be4a4304d4298cc4e95b927a69f.png"><br><br>  It was: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FooText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre><br>  It became: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FooText</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(); }</code> </pre><br>  We got a special case of the Null Object pattern.  Of course, I agree that null and the empty collection differ semantically and one could talk about the pros / cons of this approach, but this is not part of the objectives of this article.  Therefore, we turn to the technical implementation.  You may notice that the source code is correct (using'and omitted) - from the point of view of the compiler and R # there is no need to issue even a warning here.  Therefore, the Quick-Fix mechanism discussed above will not work for us, and we use Context Action - a much more flexible tool that allows you to assign user actions to almost any part of the code: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ContextAction(Group = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C#"</span></span></span><span class="hljs-meta">, Name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Empty Collection Action"</span></span></span><span class="hljs-meta">, Description = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"something new"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmptyCollectionContextAction</span></span> : <span class="hljs-title"><span class="hljs-title">ContextActionBase</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ICSharpContextActionDataProvider Provider { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmptyCollectionContextAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICSharpContextActionDataProvider provider</span></span></span><span class="hljs-function">)</span></span> { Provider = provider; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Text { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } = <span class="hljs-string"><span class="hljs-string">"Return empty collection"</span></span>; }</code> </pre><br>  Context Action visibility is managed in the same way as Quick-Fix by overriding the IsAvailable method: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsAvailable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IUserDataHolder cache</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> method = Provider.GetSelectedElement&lt;IMethodDeclaration&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> insideOfMethod = method != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (insideOfMethod) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> returnsNull = ReturnsNullOrEmpty(); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isGenericList = HasCorrectReturnType(method); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnsNull &amp;&amp; isGenericList; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  Determining that we are inside a method is quite simple (see code).  Next, we need to determine the following: <br><br><ul><li>  are we on a suitable return statement; </li><li>  Does the method return a suitable type? </li></ul><br>  Checking the return: <br><div class="spoiler">  <b class="spoiler_title">ReturnsNullOrEmpty ()</b> <div class="spoiler_text"><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReturnsNullOrEmpty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> returnStatement = Provider.GetSelectedElement&lt;IReturnStatement&gt;(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (returnStatement != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { ICSharpExpression <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> = returnStatement.Value; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.ConstantValue.IsPureNull(CSharpLanguage.Instance); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br></div></div><br>  The return type of the method is more complicated.  Check whether the returned type is a generic List, or inherited from it (for other collections, the principle is the same): <br><div class="spoiler">  <b class="spoiler_title">HasCorrectReturnType () - option number 1</b> <div class="spoiler_text"><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasCorrectReturnType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMethodDeclaration method</span></span></span><span class="hljs-function">)</span></span> { IDeclaredType declaredType = method.DeclaredElement.ReturnType <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IDeclaredType; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (declaredType == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || declaredType.IsVoid()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ISubstitution sub = declaredType.GetSubstitution(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sub.IsEmpty()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; IType parameterType = sub.Apply(sub.Domain[<span class="hljs-number"><span class="hljs-number">0</span></span>]); IMethod declaredElement = method.DeclaredElement; IType realType = declaredElement.Type(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> predefinedType = declaredElement.Module.GetPredefinedType(); ITypeElement generic = predefinedType.GenericList.GetTypeElement(); IType sampleType = EmptySubstitution.INSTANCE .Extend(generic.TypeParameters, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IType[] { parameterType }) .Apply(predefinedType.GenericList); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isGenericList = realType.IsImplicitlyConvertibleTo(sampleType, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CSharpTypeConversionRule(declaredElement.Module)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isGenericList; }</code> </pre><br></div></div><br>  There is a simpler option, but not so flexible - compare types by CLR name: <br><div class="spoiler">  <b class="spoiler_title">HasCorrectReturnType () - option number 2</b> <div class="spoiler_text"><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasCorrectReturnType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IMethodDeclaration method</span></span></span><span class="hljs-function">)</span></span> { IDeclaredType declaredType = method.DeclaredElement.ReturnType <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IDeclaredType; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (declaredType == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || declaredType.IsVoid()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ITypeElement element = declaredType.GetTypeElement(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fullName = element.GetClrName().FullName; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isGenericList = fullName == <span class="hljs-string"><span class="hljs-string">"System.Collections.Generic.List`1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isGenericList; }</code> </pre><br></div></div><br>  Finally, the most delicious thing is to replace null with the new List &lt;Foo&gt; (): <br><div class="spoiler">  <b class="spoiler_title">ReplaceType ()</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Action&lt;ITextControl&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExecutePsiTransaction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ISolution solution, IProgressIndicator progress</span></span></span><span class="hljs-function">)</span></span> { ReplaceType(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReplaceType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IMethodDeclaration method = Provider.GetSelectedElement&lt;IMethodDeclaration&gt;(); IType type = method.DeclaredElement.ReturnType; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> typePresentableName = type.GetPresentableName(CSharpLanguage.Instance); CSharpElementFactory factory = CSharpElementFactory.GetInstance(Provider.PsiModule); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> code = <span class="hljs-string"><span class="hljs-string">$"new </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{typePresentableName}</span></span></span><span class="hljs-string">()"</span></span>; ICSharpExpression newExpression = factory.CreateExpression(code); IReturnStatement returnStatement = Provider.GetSelectedElement&lt;IReturnStatement&gt;(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); returnStatement.SetValue(newExpression); }</code> </pre><br></div></div><br>  I didn‚Äôt intend to comment on the above listings to vent all the pain in one place: writing or parsing the code in R # API ... not easy.  There are gaps in the documentation, few examples are available, even the XML comments on the code are missing.  You have to suffer with each developed method and actively use the debugger.  I emphasize that the debugger when working with R # API becomes the most important tool for traveling through the syntax tree.  Serious help is also a search for key classes in GitHub - a certain number of code samples can be found. <br><br><a name="P6"></a><h3>  6. Functional testing of plugins using R # API </h3><br>  One of the great features of the R # API is the ability to implicitly deploy an instance of R # in memory, feed it a piece of text (by applying the Quick-Fix or Context Action being tested to the text), and then compare the converted text with the expected one.  And all this by writing a small amount of code comparable to writing the simplest unit tests.  By the way, R # uses NUnit.  Go! <br><br>  Add to the solution with our plugin another project that will contain tests.  Install the JetBrains.ReSharper.SDK.Tests package.  To create a minimal working example, you need to create the following file structure in the project: <br><img src="https://habrastorage.org/files/ad6/dea/760/ad6dea760cc74a409c526dfd87b19552.png"><br><br>  This structure is not <a href="https://www.jetbrains.com/resharper/devguide/Extensions/Plugins/Testing/ProjectStructure.html">canonical</a> , but easier to deploy and closer to the traditional structure of the C # solution.  The nuget.config and TestEnvironment.cs files are required: <br><div class="spoiler">  <b class="spoiler_title">nuget.config</b> <div class="spoiler_text"><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clear</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jb-gallery"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://jb-gallery.azurewebsites.net/api/v2/curated-feeds/TestNuggets/"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nuget.org"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.nuget.org/api/v2/"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disabledPackageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clear</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disabledPackageSources</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageRestore</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"enabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">add</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"automatic"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"False"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packageRestore</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">TestEnvironment.cs</b> <div class="spoiler_text"><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">assembly: RequiresSTA</span></span>] [ZoneDefinition] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestEnvironmentZone</span></span> : <span class="hljs-title"><span class="hljs-title">ITestsZone</span></span>, <span class="hljs-title"><span class="hljs-title">IRequire</span></span>&lt;<span class="hljs-title"><span class="hljs-title">PsiFeatureTestZone</span></span>&gt;{ } [SetUpFixture] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReSharperTestEnvironmentAssembly</span></span> : <span class="hljs-title"><span class="hljs-title">ExtensionTestEnvironmentAssembly</span></span>&lt;<span class="hljs-title"><span class="hljs-title">TestEnvironmentZone</span></span>&gt; { }</code> </pre><br></div></div><br>  With the preparations finished, we proceed directly to writing tests.  Classes containing Context Action tests must inherit from CSharpContextActionExecuteTestBase: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">TestFixture</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EmptyCollectionContextActionTests</span></span> : <span class="hljs-title"><span class="hljs-title">CSharpContextActionExecuteTestBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">EmptyCollectionContextAction</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ExtraPath =&gt; <span class="hljs-string"><span class="hljs-string">"EmptyCollectionContextActionTests"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> RelativeTestDataPath =&gt; <span class="hljs-string"><span class="hljs-string">"EmptyCollectionContextActionTests"</span></span>; [Test] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test01</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DoTestFiles(<span class="hljs-string"><span class="hljs-string">"Test01.cs"</span></span>); } }</code> </pre><br>  You have already seen the Test01.cs file in the screenshot; this is the source file with the code to which our Context Action will be applied.  Test01.cs.gold - a kind of ‚Äúexpected output‚Äù, the expected code after applying the Context Action.  A test is considered passed if applying the Context Action to Test01.cs, we get Test01.cs.gold. <br>  When writing your own tests, you need to determine the values ‚Äã‚Äãof the ExtraPath and RelativeTestDataPath properties, setting them equal to the name of the folder containing the source and the gold file.  There is no need to compile these files, so they need to boldly set BuildAction: None and add R # to the blacklist to get rid of imaginary error messages.  As for the contents of the source and gold files, for the Context Action it is necessary to specify the position of the caret when the context action is called, this is done using the {caret} instruction: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">N</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">C</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FooMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {caret}<span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } }</code> </pre><br><br>  The corresponding gold file: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">N</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">C</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FooMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { caret}<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); } } }</code> </pre><br>  If during the test (source file + Context Action)! = Gold-file, the test will fall, and a tmp-file will be created in the same folder containing the actual result of applying the Context Action. <br><br>  We run the test for execution, and ... I will immediately go to the list of problems and ways to solve them: <br><br><ol><li>  The exception ‚Äúfile does not exist‚Äù is the simplest, we check the folder structure and the corresponding values ‚Äã‚Äãof the properties ExtraPath, RelativeTestDataPath; </li><li>  The test fails with the exception in SetUpFixture - we check the location and contents of the nuget.config and TestEnvironment.cs files; </li><li>  Exception ‚ÄúThe test output differs from the gold file‚Äù - we study the created tmp-file, run the test with a debugger; </li><li>  The tmp file instead of the code contains one line ‚ÄúNOT AVAILABLE‚Äù - perhaps there is no caret symbol {caret} inside the source file, or Context Action threw an exception while working; </li><li>  The most interesting case is that the test always passes successfully, regardless of the contents of the source and gold files.  At the same time falls - if you delete the source file.  I came across such an unpleasant behavior when I inherited a test for Context Action from ContextActionTestBase and did not set the ExtraPath property. </li></ol><br><br>  That's all.  A complete, workable example is available on <a href="https://github.com/ilya-chumakov/PaperSource.ReSharper.HelloWorld">GitHub</a> .  I hope that it will take you much less time to develop my first plug-in than it took me =) <br><br>  <b>UPD: useful links:</b> <br>  <a href="https://www.jetbrains.com/resharper/devguide/README.html">ReSharper DevGuide</a> <br>  <a href="https://devnet.jetbrains.com/community/resharper/resharper_open_api%3Fview%3Ddiscussions">JetBrains Developer Community -&gt; ReSharper Open API / SDK</a> <br>  <a href="https://groups.google.com/forum/">Google Groups: resharper-plugins</a> </div><p>Source: <a href="https://habr.com/ru/post/270155/">https://habr.com/ru/post/270155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270145/index.html">Street magic in scripts or what connects Groovy, Ivy and Maven?</a></li>
<li><a href="../270147/index.html">PHP html generation</a></li>
<li><a href="../270149/index.html">Microsoft raises prices for its software in the Russian Federation</a></li>
<li><a href="../270151/index.html">Top 10 articles on user eXperience for beginners to understand in an hour what it is</a></li>
<li><a href="../270153/index.html">XVB - Virtual PBX: Customization</a></li>
<li><a href="../270159/index.html">Significance of SPF</a></li>
<li><a href="../270161/index.html">Plugin for gulp - collect files in pieces</a></li>
<li><a href="../270163/index.html">As we for the first time in Ukraine held a security event on a grand scale</a></li>
<li><a href="../270165/index.html">Isolate the demons with systemd or ‚Äúyou don't need a docker for this!‚Äù</a></li>
<li><a href="../270167/index.html">Overview of the first elastic data warehouse Snowflake Elastic Data Warehouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>