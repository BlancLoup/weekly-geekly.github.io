<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How players rip Spelunky's reality fabric with shotguns</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Boom, boom, boom," shoots a shotgun , aiming ... it seems that nowhere? There is a plasma gun on the ground, and a ghost is flying to the right, but ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How players rip Spelunky's reality fabric with shotguns</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/458/aa8/a62/458aa8a62b31874d2e5b6040dda7ff2f.jpg" alt="image"></div><br>  <a href="https://twitter.com/jseakle/status/1061549584143519746">"Boom, boom, boom," shoots a shotgun</a> , aiming ... it seems that nowhere?  There is a plasma gun on the ground, and a ghost is flying to the right, but there are no enemies in front of the player, and although the ghost can be <a href="https://www.eurogamer.net/articles/2013-11-29-incredible-spelunky-player-reveals-how-to-kill-the-ghost">killed</a> , the player doesn‚Äôt aim at him.  And this is the world record in <i>Spelunky</i> (compares with its records) for a set of the most money?  And the part from which people are delighted includes shooting a shotgun into empty space?  Hm <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Very few games are <a href="https://en.wikipedia.org/wiki/Solved_game">really decided</a> , there is always something to learn.  For example, for 33 years, <a href="https://waypoint.vice.com/en_us/article/wj4pny/the-33-year-quest-for-the-perfect-run-of-super-mario-bros-is-almost-over%3Futm_source%3Dwptwitterus">people have been trying to achieve the ideal speeding of the first <i>Super Mario Bros.</i></a>  But over time, the bar rises higher and higher, and to overcome it, you need more and more effort.  Movement forward consists of jerks and discoveries, a wild combination of research and happy accidents. <br><br>  I played hundreds of hours in <i>Spelunky</i> and I know its basics: running, jumping, whip, bomb, death.  I know that there are strange, intricate strategies to achieve mastery in <i>Spelunky</i> , for setting world records.  This is normal.  But nothing in the video shown above does not make sense in my eyes, so I closed them, but his strangeness began to torment me.  I <i>need to</i> know what's going on in it. <br><br>  It turns out that it makes sense.  The explanation is confusing, it seems, this is some kind of manipulation of the code, which the fans of the game are still trying to figure out.  They were discovered by the self-proclaimed "scientists" <i>Spelunky</i> .  This is a living testimony to how the <i>Spelunky</i> community flourished seven years after the game was released on the Xbox 360. A sequel called <i>Spelunky 2</i> will be released in 2019, but in the meantime <i>Spelunky</i> continues to reap its benefits. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Whether it's glitch or not, even the game developers are impressed with fan-made commitment. <br><br>  ‚ÄúWhat the <i>Spelunky</i> community managed to do with the game is far beyond what we could have imagined,‚Äù says designer Derek Yu in the last episode <a href="http://thespelunkyshowlike.libsyn.com/06-making-spelunky-2-with-derek-yu">of the <i>Spelunky</i> Showlike podcast</a> .  "I do not understand.  For me, this is already a bust [laughs] It makes no sense.  The researchers have already climbed into the stratosphere, and I can't see them from here.  And it's great. " <br><br>  The scene of world records for collecting the largest amount of money in <i>Spelunky</i> <a href="https://mossranking.com/wrprog.php%3Fcat%3D1">has been running non-stop since 2013</a> , a new record is set every few months.  Since the summer of 2016, Kinnijup, one of the gods <i>Spelunky</i> , has dominated the scene, again and again overtaking its own records.  (Do not drop your jaw in surprise as you watch <a href="https://www.youtube.com/watch%3Fv%3D-uvJZBugA8Q"><i>Spelunky</i> finish AGDQ this year</a> .) <br><br><h2>  Don't fall for duplication </h2><br>  A few years ago, the community discovered a <i>Spelunky</i> glitch with duplication.  If you put the jewelry on each other and collect them at the same time, then some of them will be taken twice.  This is especially important for passages to the maximum account (that is, money);  Glitch means that theoretically you can raise more money than the game has created in the world, and opens up the possibility of new world records.  But the glitch is not yet fully understood, and it is difficult to reproduce.  All that the community knew was that if you collect money in a pile, they are <i>sometimes</i> duplicated.  At other times this does not happen. <br><br>  According to ContraMuffin, the student of <i>Spelunky</i> "scientist", the principle of "put money in a heap and hope for the best" was confessed in the community.  At that time, the attitude towards duplication was controversial. <br><br>  ‚ÄúOnce the discussion of duplication was taboo,‚Äù says the <i>Spelunky</i> d_tea player.  ‚ÄúIt was a big advantage, but we didn‚Äôt know how it worked.‚Äù <br><br>  At the beginning of this fall, everything changed: ContraMuffin and other scientists began to discuss the issue of duplication.  True randomness in video games is very rare, so you just have to figure out how it works.  Most developers are not eager to help players exploit the glitches of the code, so the identification of patterns falls on the shoulders of the community. <br><br>  Another member of the community named Spef noticed something strange: if you hang a rope (a tool to quickly move around the game world), the glitch disappears - there are no more duplicates.  This hinted that there were some specific actions that could affect the overall result. <br><br>  And then the real testing began. <br><br>  ‚ÄúWe have taken steps to ensure that our tests are consistent and reproducible, even though we have not yet understood how duplicates are made,‚Äù says ContraMuffin.  ‚ÄúWe all have a penchant for science, so we have mastered the scientific method well.  Making repeated experiments, we quickly realized that duplication is a constant and reproducible process.  Therefore, he had some kind of pattern that we have not yet been able to find. ‚Äù <br><br>  Some of the tests were recorded on video, and now help illustrate the gradual growth of understanding. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  This is a controlled environment, and not one of the half-randomly generated <i>Spelunky</i> levels.  Stone block, heaps of gold, and nothing more.  No other items, no enemies.  Nothing prevents experiments. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  (This video is specially slow; ContraMuffin studied the game frame by frame.) <br><br>  In 24 hours, we managed to learn a few facts and learn how to reproduce the glitch on an ongoing basis, despite the fact that the principles underlying it remained vague.  At that time, it was thought that the order of their selection was the most important factor for the implementation of duplication of items. <br><br>  ‚ÄúWe began to call this order‚Äú first order ‚Äù,‚Äù says ContraMuffin.  ‚ÄúAt first, we believed that the priority was in the order of rendering objects, so we gave the whole phenomenon the name‚Äú duplicate rendering ‚Äù.‚Äù <br><br>  So what happens here?  All this is rather confusing, but let me explain.  When you pick up a <i>Spelunky</i> item, it disappears.  When you pick up a bunch of things at the same time, they all disappear.  But what is important is what is happening inside the game.  When you pick up an item, the code marks it for deletion, but the item is not removed immediately;  in fact, this step is performed later, in the same frame that the game renders.  This small gap creates new opportunities. <br><br>  When you touch an item, it is added to the list of items that the game plans to destroy.  The game means that the players touch the item, receive an appropriate reward, the item is marked for deletion and disappears from the game.  It seems that all these actions occur simultaneously, but if you slow down the execution, it turns out that this is not so. <br><br>  If you put items in a pile, the game will be confused, which of them need to be deleted. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Let's say you piled four jewels in a heap.  When you raise them, they are marked in the code of the game for deletion.  But the glitch leads to the fact that only two jewels are removed, while the rest are preserved.  That is, we received two additional jewels! <br><br>  It is important that the glitch is repeated.  These two ‚Äúbonus‚Äù jewels are now marked for deletion, but the glitch works again and only <i>one is</i> destroyed.  That is, we got another extra jewel.  At this stage, the game processes the last jewel, marks it for deletion, and it finally disappears. <br><br>  That is, we "squeezed" seven out of four jewels. <br><br><h2>  Community rebirth </h2><br>  While ContraMuffin and other researchers studied the phenomenon, the community of fans has already taken the bull by the horns.  Thanks to a better understanding of duplication, records have increased significantly.  Now the question was not a slight excess of the previous record - they were simply <i>beaten</i> again and again.  People found ways to better exploit discoveries in their walkthroughs. <br><br>  The discovery greatly changed the approach of players to the game.  In the past it was almost not important where the money fell;  it was only important to raise them.  Now their location was of great importance, because for duplication you need to drag money into one heap.  If the money fell into a strange place from which they cannot be pulled out, then a problem arises.  Each level turned into a puzzle. <br><br>  This explains why in the video at the beginning of the article the player constantly pushes money into piles.  But this does not explain why he shoots a shotgun into the void, and it was because of the shotgun that I began to study this topic. <br><br>  To understand this, we need to go deeper.  Much deeper.  Everything will become very strange. <br><br><h2>  Room filled with noise </h2><br>  After a lot of testing runs, other important aspects came to light.  The existence of a rope does not prevent duplication, but slightly reduces its size.  Removing the rope allowed the duplication glitch to process each jewel in a heap.  In addition, it was not only the ropes!  The presence of some other things <i>also</i> influenced the duplication, while other objects did not affect him at all.  Two other scientists <i>Spelunky</i> , Dan and samcv, called this unexpected and strange effect "noise". <br><br>  ContraMuffin and Spef, who discovered the strange influence of the rope, conducted a series of tests with noise, hoping to reduce its size and increase the likelihood of duplication.  Scientists have discovered two types of noise: universal and local.  Objects with universal influence affect the likelihood of duplication in all levels.  Remember that rope reduces chances of duplication?  It creates a general noise!  (Scientists even managed to determine its quantitative value! Each rope rope is one noise unit, and the total rope length is seven noise units.) Some objects that create general noise can be destroyed, others can be picked up, which for some reason eliminates the noise they make. <br><br>  Another discovery shed light on this riddle.  The game regularly displays certain objects on the screen in front of the jewels, and it gives priority to those objects that scientists have classified as noise.  It didn't seem like a coincidence. <br><br>  ‚ÄúThe idea that certain objects should have been created in front of certain objects, but after other objects, seems very similar to the concept of layers in digital art and photo editing,‚Äù says ContraMuffin.  "Therefore, I called this concept" layers "." <br><br>  Gradually, observing how <i>Spelunky</i> ties the noise to different objects, the scientists managed to categorize the way the game perceives layers.  <a href="https://docs.google.com/document/d/13mXQVCkpHxYF96LL-Ji7c5LQ1mjFHPbdeei-Nt0w-lQ/edit">The entire list is listed in this document.</a> <br><br>  It was more important to understand not every layer, but to realize their very existence. <br><br>  In Photoshop, you can optionally move the various layers of the image.  In <i>Spelunky, the</i> layers are predefined by the programmer who created the structure of the game's code.  But what if there was a way to change the logic of the game and its layers from the game itself? <br><br>  So we made a full circle, allowing us to explain the riddle from the beginning of the article: the reason why to achieve the world record in <i>Spelunky</i> you have to endlessly shoot a shotgun. <br><br>  The secret level of City of Gold with a lot of money is <i>Spelunky's</i> treasury.  There is <i>so</i> much money in City of Gold that it is critically important to maximize the duration of the presence in it and the number of duplicates.  But the mummies run by the level, which after death leave bandages in their place.  Mummy bandages add a lot of noise, and it‚Äôs very important that they cannot be destroyed or raised.  Where there is noise, there are problems with the duplication glitch.  The solution, as you might guess, is a shotgun. <br><br>  Why? <br><br><h2>  History of thousands of bullets </h2><br>  One October evening, ContraMuffin traditionally tested the killing of mummies and looked at what could be learned about the noise caused by mummy bandages. <br><br>  ‚ÄúI tested the killing of mummies from a shotgun.  And he noticed something curious - if I shot jewels in the temple, the bullets flew over them.  In the same scenario, in the mines [another <i>Spelunky</i> level], the bullets when passing by the jewels were drawn under them. ‚Äù <br><br>  ContraMuffin discovered a way to manipulate <i>Spelunky</i> code by creating bullets in the world.  Boom Boom Boom.  Thanks to this, it was possible to change the layers of visibility of the game, as in Photoshop.  This technique was called ‚Äúinsert switching‚Äù, with its help you can change the priority order of displaying objects, and hence their duplication.  It causes the layers to move down and up. <br><br>  ‚ÄúWe can choose which items will be duplicated and which ones will be used as noise,‚Äù he says. <br><br>  To switch inserts worked, you need to create 1000 objects, and when shooting from a shotgun, new objects are created.  ( <a href="https://twitter.com/mcclure111/status/1061679175038353408">Here's a nice Twitter post</a> that explains the technical details. <br><br>  ‚Äú1,000 spawns of any item will do,‚Äù says ContraMuffin.  ‚ÄúTheoretically, you can swing the whip 1000 times, and it will work.  Of course, no one tested it, because there are more interesting activities than standing in the game and clicking a whip 1000 times.  But that is why shotguns are preferred for this ‚Äî they create a multitude of bullets and clouds of smoke. ‚Äù <br><br>  ‚ÄúIn essence, we want the jewels to have a higher priority of duplication than the mummy bandages,‚Äù says a <i>Spelunky</i> d_tea player who pulled me into the game.  ‚ÄúThat is, when the bullets are in front of the cannon, everything created at the level has a lower priority, and when the bullets are under the cannon, then everything is created with the highest priority.‚Äù <br><br>  Voila <br><br>  <i>That is why the</i> player constantly shoots a shotgun.  He moves the <i>Spelunky</i> layers, and heightens the priority of duplicate items, ensuring their maximum value.  The riddle is solved. <br><br>  The first record of passing <i>Spelunky</i> to the maximum number of points was set on February 2, 2013 by the vardulon player; he scored $ 2,126,925. Gradually, over the course of days, months and years, the values ‚Äã‚Äãgrew.  But it was a slow, methodical movement of players, which improved the perfect result over and over again.  Over the past few months, explosive changes have occurred on the scene, and although the god <i>Spelunky</i> Kinnijup set most of the new records - he recently reached $ 5,534,700, other players have felt the new opportunities, and this part of the community has become the most active and competitive. <br><br>  While I was writing this article, the world record went from d_tea to Kinnijup, and I would not be surprised if he was beaten again. <br><br>  At such moments, the headlines of most articles talk about high-class players.  It `s naturally.  They manage to do tricks that look so impressive, and remind us how imperfect our skills are even in those games in which we consider ourselves to be masters.  But journalists are missing out on a process that actually led these players to do such tricks.  Not all game researchers are high-level players, and fame often bypasses them. <br><br>  What players like d_tea and Kinnijup are doing is amazing, but all this would have been impossible without the hard, monotonous work of ContraMuffin, Spef and countless other participants in similar communities. <br><br>  All this reminded me of the opening of 2016 - the <a href="https://www.youtube.com/watch%3Fv%3Dkpk2tdsPh0A">famous ‚Äúhalf press on A‚Äù in <i>Super Mario 64</i></a> , when the brains of many people (including mine) literally exploded from a detailed explanation of the nuances of the high-level game.  Honestly, when I watch this video, I feel dizzy.  But the people were infuriated by the concept of ‚Äúhalf clicks on A‚Äù also because they do not realize how much research is needed to understand their favorite games.  <i>Super Mario 64</i> is still unsolved. <br><br>  People are accustomed to get involved in "another cool game," because it is so amazing and new.  But games are strange creatures, these are ideas glued together with tape.  Even after the credits at the end, they can teach us a lot, and then people like <i>Spelunky</i> scientists take up the work.  Understanding that in new games is special and interesting is only the very beginning. </div><p>Source: <a href="https://habr.com/ru/post/432074/">https://habr.com/ru/post/432074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432062/index.html">AI development on the example of the game Dicey Dungeons</a></li>
<li><a href="../432064/index.html">How to escape from the "hares". Instructions for dealing with ultraviolet</a></li>
<li><a href="../432068/index.html">How to facilitate learning English: 5 useful services</a></li>
<li><a href="../432070/index.html">Briefly about redux-saga channels</a></li>
<li><a href="../432072/index.html">Three types of memory leaks</a></li>
<li><a href="../432076/index.html">Uncalled function slows down the program 5 times</a></li>
<li><a href="../432078/index.html">Traffic at the end of the tunnel or DNS in pentest</a></li>
<li><a href="../432080/index.html">Misconceptions players in assessing risks. Control random number generator in development</a></li>
<li><a href="../432082/index.html">Microsoft AI chatbot released a collection of clothes for China</a></li>
<li><a href="../432084/index.html">How we organized the competition of shifts between production workers (as in the USSR)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>