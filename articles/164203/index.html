<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Diameter. The basic protocol. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="He promised to talk about Diameter. We will begin, but I must warn you, I will write with free text, the probability of simplification and omission of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Diameter. The basic protocol. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/358/351/236/35835123669769b16d370c5241174a9c.jpg" align="left">  He promised to talk about Diameter.  We will begin, but I must warn you, I will write with free text, the probability of simplification and omission of a number of important points is high.  The goal is a review article and the very first acquaintance with the protocol, and the details can be found in the standards.  Examples will be from cellular. <br><br>  <b>UPDATE:</b> At the request of <a href="http://habrahabr.ru/users/ploop/" class="user_link">ploop</a> , thanks for the valuable comment.  Diameter is a protocol of the AAA family, and is a development of RADIUS.  It is intended mainly for the evaluation of services in communication networks.  In particular, in 3G networks it is used to evaluate data transmission services, and in IMS \ LTE the protocol is one of the main control elements. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Introduction </h5><br><br>  The first document that described the requirements for the new protocol was published in 1998 as part of the IETF; Pat R. Calhoun (Sun), Glen Zorn (MS), Ping Pan (IBM) became its authors. <br>  The draft authors' team changed from version to version, they moved from one company to another, and finally, in 2003, RFC 3588 was released, but always the first name is Pat R. Calhoun.  In 3588, the Diameter base model was described, which included the Accounting functionality and allowed developers to create new applications for the protocol based on it.  And most recently, in October 2012, RFC 3588 was deprecated, and replaced by RFC6733, in which nothing fundamentally changed, backward compatibility was preserved, the changes are described in the document itself and are beyond the scope of the article. <br><br>  An important feature of the protocol is its extensibility and the ability to create not only its own attributes, but also applications.  An example of an application is the RFC 4006 Diameter Credit Control Application, the development of which began in 2003, and the final RFC was released in 2005. Next, the 3GPP committee pushed away from RCF 3588 and created a number of applications, such as 3GPP 32.299 Diameter charging applications, which is a consequence of the development of RFC 4006 DCCA . <br><br>  These three sources will suffice to consider the possibilities of Diameter, in many respects it will be a retelling of the recommendations.  Below I will provide links to some open specifications.  In addition to the open, I came across a proprietary implementation of the Diameter application.  As a result, I cannot assess the real number of implementations, versions and applications.  But I can say for sure that today, to provide almost any subscriber with the mobile services, Diameter is used in one form or another.  And with the development of 3G, IMS, LTE, the percentage of penetration will tend to 100%. <br><br><h5>  Basic protocol </h5><br><br>  The basic protocol implements the requirements for AAA protocols, the details of which are reflected in RFC2989, and describes the process of establishing a connection, checking compatibility, rules for sending messages and their routing, disconnecting. <br>  TCP and SCTP can be used as transport.  Protocol security should be provided at the transport level, recommendations also state that the protocol should not be used without TLS, DTLS or IPsec.  In a trusted network, of course, it is possible to do without them, in particular, if the internal network of the enterprise can be considered reliable. <br><br>  The specification defines several types of Diameter nodes. <br>  To understand the role of nodes, it is necessary to introduce two terms, which will be discussed in more detail below. <br>  <b>Session</b> - monitors the status of the subscriber and includes those and only those messages that relate to a single subscriber. <br>  <b>Connection</b> - controls the state of communication between the Diameter nodes. <br><br>  The session is determined by the AVP SessionID, and this identifier is pass-through for all nodes participating in the processing session of the subscriber. <br><br><h6>  Customer </h6><br>  The client is usually a network device that directly processes subscriber traffic. <br><br><h6>  Server </h6><br>  The role of the server is quite understandable; it must monitor the state of subscriber sessions. <br><br><h6>  Agent. </h6><br>  DIAMETER agents are intermediate nodes between the client and the server and perform traffic management functions.  For example, they can aggregate messages from devices on one site, act as a load balancer, modify Diameter packets, act as security gateways when moving from a trusted network to a public one. <br><br>  Functionally, agents are divided into several types. <br><br><h5>  Relay agent (DRL) </h5><br>  Nodes of this type receive Diameter messages from network devices and redirect them to the following nodes based on the data contained in the messages based on Realm and the list of known neighbors.  Relay can be used to aggregate messages from multiple nodes located in the same geographical area. <br><br>  Relay does not modify the meaningful fields in the message body, so they can work with any type of Diameter application, however, when establishing a connection, they must announce Relay Application Id. <br><br><h5>  Proxy agent. </h5><br>  Proxy are very similar to Relay, but they can modify the Diameter message payload.  For example, to control access to certain services, modify field values, and so on.  Most often, Relay and Proxy are combined into one entity, since  Proxy without conversion rules is a Relay agent. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79d/456/f24/79d456f24b3364a119b491f722eb013e.png" alt="Relay \ Proxy"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/77d/d22/94a/77dd2294a88a9be97a5d396315a8695a.png" alt="Session, Connection, Relay \ Proxy"><br><br><h5>  Redirect agent (DRD) </h5><br>  DRD is used if the routing rules for the Diameter messages must be controlled from one point.  DRD receives the request, determines the node to which it should be sent, and tells the DRL where to redirect it. <br>  On charts, everything looks much simpler. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/87e/58a/0c9/87e58a0c9026eb4b39887f652bc5e0f4.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a9a/c1b/8b3/a9ac1b8b3c3bd4747372beed5cf6a48a.png"><br><br><h5>  Translation Agents (TLA) </h5><br>  And the most interesting (from my point of view) class of nodes is Diameter - Protocol translators.  They are used if the physical devices are incompatible at the AAA protocol layer.  For example, implement conversion from RADIUS to Diameter and back.  Or support conversion between 2 incompatible Diameter versions.  TLAs must provide transactional and stateful storage of the session during its processing. <br>  TLA should only be announced by those ApplicationIDs whose support is implemented, since  only in this case the agent will be able to correctly process the incoming message. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47a/d4f/21c/47ad4f21c47564b192d8dfd9f96447ef.png"><br><br><h5>  Package structure </h5><br>  Packages traditionally consist of a header and a payload (in the form of AVP - Attribute-Value Pair). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/077/11c/ddd/07711cddd6b7006dd91059f0a0b4d879.png"><br><br>  The purpose of the first three fields is clear. <br>  <b>Command-Code</b> - the code of the command that is transmitted in the package. <br>  <b>Application-Id</b> - pointer to the type of application <br>  <b>Hop-by-Hop Identifie</b> r - the unique number of the request within the connection, the answer must have the same number, this field can be modified if necessary by agents. <br>  <b>End-to-End Identifie</b> r is another request identifier, but unlike Hop-by-Hop, it must remain unique within the session, and agents must not change it. <br>  Next comes the payload in the form of AVP (Attribute Value Pairs). <br><br>  The structure of AVP is also very simple. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/96a/55a/24296a55ad10fc301c74b195eff98363.png"><br><br>  <b>AVP Code</b> - attribute code, described in the recommendation. <br>  Behind the code are service bits, data length, and an optional Vendor-ID field. <br>  Then the data itself comes with a certain length. <br>  The data in turn may contain other AVP sets, the AVP structure is perfectly described by ASN.1. <br><br>  On this finish. <br><br>  In the next part, we will take a look at how the protocol works. Instead of the narrative, we will analyze the message exchange by stages: connection establishment, Diameter processing, and connection termination.  And the most interesting - consider the extensibility of the protocol and its applications. </div><p>Source: <a href="https://habr.com/ru/post/164203/">https://habr.com/ru/post/164203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164191/index.html">A set of useful tools for working with DNS</a></li>
<li><a href="../164193/index.html">What is TCHAR, WCHAR, LPSTR, LPWSTR, LPCTSTR (etc)</a></li>
<li><a href="../164195/index.html">How to do without dyndns</a></li>
<li><a href="../164197/index.html">Go to Puppet or how not to spoil the soup</a></li>
<li><a href="../164201/index.html">Hackathon through the eyes of the participant and the winner</a></li>
<li><a href="../164205/index.html">ION Piano Apprentice - controller for Garage Band</a></li>
<li><a href="../164207/index.html">"It works - do not touch." Should I break the rules?</a></li>
<li><a href="../164213/index.html">How do you feel about anonymity on the Internet?</a></li>
<li><a href="../164215/index.html">Wireless data transmission, ISM range</a></li>
<li><a href="../164217/index.html">Introduction to developing games for Windows 8 using XNA and MonoGame</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>