<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optional dependencies are not needed.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will discuss PHP packages and used alcohol dependencies. Rather, the so-called optional or proposed dependencies (optional dependencie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optional dependencies are not needed.</h1><div class="post__text post__text-html js-mediator-article">  In this post we will discuss <i><abbr title="PHP Package"><a href="https://packagist.org/explore/">PHP packages</a></abbr></i> and <s>used alcohol</s> dependencies.  Rather, the so-called optional or proposed dependencies (optional dependencies, suggest / dev-dependencies), which are defined in composer.json. <br><br><h4>  What is addiction? </h4><br>  To begin with, let‚Äôs deal with what dependence is and what it is all about.  There is the following code: <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Gaufrette</span></span>\<span class="hljs-title"><span class="hljs-title">Adapter</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Gaufrette</span></span>\<span class="hljs-title"><span class="hljs-title">Adapter</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> \<span class="hljs-title"><span class="hljs-title">MongoGridFS</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GridFS</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $gridFS; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MongoGridFS $gridFS)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;gridFS = $gridFS; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key)</span></span></span><span class="hljs-function"> </span></span>{ $file = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;find($key); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($file) ? $file-&gt;getBytes() : <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre> <br>  The GridFS class is part of the Gaufrette <a href="https://github.com/KnpLabs/Gaufrette">abstract filesystem library</a> , which I have changed to some extent.  To determine all dependencies of this piece of code, we must ask ourselves the following questions: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  What do you need to make this code work? </li></ul><br><a name="habracut"></a><br>  But you need to think about this: <br><br><ol><li>  What version of PHP will you need to run to get no errors? </li><li>  Perhaps you will need to install some specific version? </li><li>  What PHP extensions will be needed? </li><li>  What PEAR libraries do I need to install? </li><li>  What packages are missing? </li></ol><br>  Returning to the GridFS class, the PHP version must be at least 5.3, because neimspaces are used.  Also, the class <code>\MongoGridFS</code> , which is a mongo extension to PHP and is available only from version 0.9.0 of this extension.  Everything seems to create composer.json: <br><br><pre> <code class="javascript hljs">{ ..., <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"php"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=5.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-mongo"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=0.9.0"</span></span> } .. }</code> </pre><br>  This list is enough and now it seems like nothing stops us from using this class in our applications ... Alas, this is not so. <br><br><h4>  Valid list of dependencies knplabs / gaufrette </h4><br>  As I said before, GridFS is part of the Gaufrette library, which provides an abstract file system layer for storing files on various types of file systems without worrying about the details of the file system used.  Take a look at the composer.json of this library: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"knplabs/gaufrette"</span></span>, <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"php"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=5.3.2"</span></span> }, <span class="hljs-string"><span class="hljs-string">"require-dev"</span></span>: { ... }, <span class="hljs-string"><span class="hljs-string">"suggest"</span></span>: { ... <span class="hljs-string"><span class="hljs-string">"amazonwebservices/aws-sdk-for-php"</span></span>: <span class="hljs-string"><span class="hljs-string">"to use the legacy Amazon S3 adapters"</span></span>, <span class="hljs-string"><span class="hljs-string">"phpseclib/phpseclib"</span></span>: <span class="hljs-string"><span class="hljs-string">"to use the SFTP"</span></span>, <span class="hljs-string"><span class="hljs-string">"doctrine/dbal"</span></span>: <span class="hljs-string"><span class="hljs-string">"to use the Doctrine DBAL adapter"</span></span>, <span class="hljs-string"><span class="hljs-string">"microsoft/windowsazure"</span></span>: <span class="hljs-string"><span class="hljs-string">"to use Microsoft Azure Blob Storage adapter"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-zip"</span></span>: <span class="hljs-string"><span class="hljs-string">"to use the Zip adapter"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-apc"</span></span>: <span class="hljs-string"><span class="hljs-string">"to use the APC adapter"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-curl"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-mbstring"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-mongo"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span>, <span class="hljs-string"><span class="hljs-string">"ext-fileinfo"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> }, ... }</code> </pre><br>  And here he is, the first surprise!  Almost everything that turned out about dependencies earlier is no good, because the library says that it just needs PHP version not lower than 5.3.2, and everything else - to your taste, optionally or only for dev purposes - call it what you want . <br><br>  Of course, people who have been using Composer or Packagist for a long time have become accustomed to such things.  But this is just the wrong approach.  As we found out earlier, ext-mongo is a <i>true</i> dependency of the GridFS class, but composer.json tells us the opposite. <br><br>  All this means is that if we want to use this class in our project, it is not enough just to use the <code>knplabs/gaufrette</code> .  I also made ext-mongo necessary in my project, which is a mistake: it is not my project that requires the mongo extension, but the <code>knplabs/gaufrette</code> .  Moreover, how can I find out which version of ext-mongo to choose?  Those dependencies that are listed in the suggest block do not talk about it, forcing me to choose. <br><br><h4>  It's just another package. </h4><br>  <code>knplabs/gaufrette</code> not the only one who acts in this way, presenting real dependencies as suggested.  It is convenient for package owners to add different classes that users may need.  Or not needed.  Therefore, if the use of these classes is optional, then their dependencies are also optional.  However, package owners forget that dependencies are never optional.  They are always required, because the code simply does not work without them. <br><br><h4>  Decision </h4><br>  What should package developers do in this case?  Separate them.  In the case of <code>knplabs/gaufrette</code> this means that there must be a <code>knplabs/gaufrette</code> package containing all the common code needed to abstract from the file system.  And then each individual adapter, such as the GridFS, should live in its package, for example, <code>knplabs/gaufrette-mongo-gridfs</code> .  And he will already have his dependencies: <br><br><pre> <code class="javascript hljs">{ ..., <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"php"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=5.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"knplabs/gaufrette"</span></span>: <span class="hljs-string"><span class="hljs-string">"~0.1"</span></span> <span class="hljs-string"><span class="hljs-string">"ext-mongo"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=0.9.0"</span></span> } }</code> </pre><br>  And everything, nowhere there are hidden dependencies, they are all necessary. <br><br>  The <code>knplabs/gaufrette</code> in turn, no longer has dependencies at all, and the packages with adapters are just proposed: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"php"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=5.3.2"</span></span> }, <span class="hljs-string"><span class="hljs-string">"suggested"</span></span>: { <span class="hljs-string"><span class="hljs-string">"knplabs/gaufrette-mongo-gridfs"</span></span>: <span class="hljs-string"><span class="hljs-string">"For storing files using Mongo GridFS"</span></span>, ... } }</code> </pre><br>  This approach has a number of advantages: <br><br><ul><li>  The main package becomes more stable.  There is no reason to change anything, since all the variable parts are inside adapters. </li><li>  Different packages may have different developers.  For example, <code>knplabs/gaufrette-mongo-gridfs</code> can be modified by someone who knows MongoDB very well. </li><li>  Users do not need to keep track of updates to parts of the library that they do not use. </li><li>  Users will not have to manually add additional dependencies to their projects. </li></ul><br>  Next time, adding the proposed dependencies to your package, think about whether it is a valid dependency in this package?  Then split the package and specify this dependency in it as necessary.  If all the code in the main package works without this proposed dependency, then it can be specified as suggested. </div><p>Source: <a href="https://habr.com/ru/post/219837/">https://habr.com/ru/post/219837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219819/index.html">Brain Overclock or Internal Consciousness Virtualization</a></li>
<li><a href="../219821/index.html">DevCon 2014: announcement of the second wave of speakers and reports</a></li>
<li><a href="../219823/index.html">Panoramas of the Arctic appeared on Yandex.Maps</a></li>
<li><a href="../219827/index.html">Camera and microscope - how to do it</a></li>
<li><a href="../219831/index.html">Ubuntu 14.04 LTS (Trusty Tahr) is available for download!</a></li>
<li><a href="../219839/index.html">The right to access the Internet</a></li>
<li><a href="../219841/index.html">New JIT available: now with SIMD support</a></li>
<li><a href="../219845/index.html">OpenVPN successfully compromised through Heartbleed</a></li>
<li><a href="../219847/index.html">NASA is testing an inflatable aerodynamic brake for landing humans on Mars</a></li>
<li><a href="../219849/index.html">NASA: a planet has been discovered on which water in a liquid state can potentially be</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>