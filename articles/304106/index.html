<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>dlang-requests - type python-requests, only for D (part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 

 In the second part of the article I will describe the use of the dlang-requests library for less standard cases. 



 Request and Respons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>dlang-requests - type python-requests, only for D (part 2)</h1><div class="post__text post__text-html js-mediator-article">  Good day! <br><br>  In the second part of the <a href="https://habrahabr.ru/post/304072/">article I</a> will describe the use of the dlang-requests library for less standard cases. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Request and Response </h2><br>  At a lower level of the library is the Request structure, which provides all the functionality of the library. <br><br>  Request, among other methods, has get and post methods used by getContent () and postContent (), described in the first part.  The parameters of their call are the same as the parameters for getContent () and postContent ().  Why is it needed, this structure? <br><br>  To begin, I will describe how through its methods you can control the execution of queries. <br><ul><li>  verbosity - setting it to 0,1,2 allows you to increase the detail of the output in stdout. <br><div class="spoiler">  <b class="spoiler_title">An example of an increase in verbosity</b> <div class="spoiler_text"><pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rq = Request(); rq.verbosity = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rs = rq.get(<span class="hljs-string"><span class="hljs-string">"http://httpbin.org/get"</span></span>, [<span class="hljs-string"><span class="hljs-string">"a"</span></span>:<span class="hljs-string"><span class="hljs-string">"b"</span></span>]); writeln(rs.responseBody); }</code> </pre> <br><pre> <code class="bash hljs">&gt; GET /get?a=b HTTP/1.1 &gt; Connection: Keep-Alive &gt; User-Agent: dlang-requests &gt; Accept-Encoding: gzip, deflate &gt; Host: httpbin.org &gt; &lt; HTTP/1.1 200 OK &lt; server: nginx &lt; date: Sat, 25 Jun 2016 13:37:20 GMT &lt; content-type: application/json &lt; content-length: 229 &lt; connection: keep-alive &lt; access-control-allow-origin: * &lt; access-control-allow-credentials: <span class="hljs-literal"><span class="hljs-literal">true</span></span> &lt; 229 bytes of body received &gt;&gt; Connect time: 143 ms and 666 Œºs &gt;&gt; Request send time: 304 Œºs &gt;&gt; Response recv time: 144 ms and 121 Œºs { <span class="hljs-string"><span class="hljs-string">"args"</span></span>: { <span class="hljs-string"><span class="hljs-string">"a"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }, <span class="hljs-string"><span class="hljs-string">"headers"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Accept-Encoding"</span></span>: <span class="hljs-string"><span class="hljs-string">"gzip, deflate"</span></span>, <span class="hljs-string"><span class="hljs-string">"Host"</span></span>: <span class="hljs-string"><span class="hljs-string">"httpbin.org"</span></span>, <span class="hljs-string"><span class="hljs-string">"User-Agent"</span></span>: <span class="hljs-string"><span class="hljs-string">"dlang-requests"</span></span> }, <span class="hljs-string"><span class="hljs-string">"origin"</span></span>: <span class="hljs-string"><span class="hljs-string">"xxx.xxx.xxx.xxx"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://httpbin.org/get?a=b"</span></span> }</code> </pre> </div></div><br></li><li>  timeout - sets the timeout for I / O operations and connection setup. <br><div class="spoiler">  <b class="spoiler_title">An example of setting a timeout.</b> <div class="spoiler_text"> <code>auto rq = Request(); <br> rq.timeout = 30.seconds; <br></code> <br></div></div><br></li><li>  maxRedirects.  Controls the allowable amount of redirects when executing queries. <br><div class="spoiler">  <b class="spoiler_title">An example of limiting the number of redirects</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rq = Request(); rq.verbosity = <span class="hljs-number"><span class="hljs-number">2</span></span>; rq.maxRedirects = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rs = rq.get(<span class="hljs-string"><span class="hljs-string">"https://httpbin.org/absolute-redirect/3"</span></span>); writeln(rs.code); }</code> </pre><br>  Conclusion: <br><pre> <code class="bash hljs">&gt; GET /absolute-redirect/3 HTTP/1.1 &gt; Connection: Keep-Alive &gt; User-Agent: dlang-requests &gt; Accept-Encoding: gzip, deflate &gt; Host: httpbin.org &gt; &lt; HTTP/1.1 302 FOUND &lt; server: nginx &lt; date: Sat, 25 Jun 2016 13:54:16 GMT &lt; content-type: text/html; charset=utf-8 &lt; content-length: 283 &lt; connection: keep-alive &lt; location: http://httpbin.org/absolute-redirect/2 &lt; access-control-allow-origin: * &lt; access-control-allow-credentials: <span class="hljs-literal"><span class="hljs-literal">true</span></span> &lt; 283 bytes of body received &gt;&gt; Connect time: 505 ms and 705 Œºs &gt;&gt; Request send time: 247 Œºs &gt;&gt; Response recv time: 145 ms and 626 Œºs &gt; GET /absolute-redirect/2 HTTP/1.1 &gt; Connection: Keep-Alive &gt; User-Agent: dlang-requests &gt; Accept-Encoding: gzip, deflate &gt; Host: httpbin.org &gt; &lt; HTTP/1.1 302 FOUND &lt; server: nginx &lt; date: Sat, 25 Jun 2016 13:54:16 GMT &lt; content-type: text/html; charset=utf-8 &lt; content-length: 283 &lt; connection: keep-alive &lt; location: http://httpbin.org/absolute-redirect/1 &lt; access-control-allow-origin: * &lt; access-control-allow-credentials: <span class="hljs-literal"><span class="hljs-literal">true</span></span> &lt; 283 bytes of body received &gt;&gt; Connect time: 135 ms and 621 Œºs &gt;&gt; Request send time: 128 Œºs &gt;&gt; Response recv time: 136 ms and 689 Œºs &gt; GET /absolute-redirect/1 HTTP/1.1 &gt; Connection: Keep-Alive &gt; User-Agent: dlang-requests &gt; Accept-Encoding: gzip, deflate &gt; Host: httpbin.org &gt; &lt; HTTP/1.1 302 FOUND &lt; server: nginx &lt; date: Sat, 25 Jun 2016 13:54:16 GMT &lt; content-type: text/html; charset=utf-8 &lt; content-length: 251 &lt; connection: keep-alive &lt; location: http://httpbin.org/get &lt; access-control-allow-origin: * &lt; access-control-allow-credentials: <span class="hljs-literal"><span class="hljs-literal">true</span></span> &lt; 251 bytes of body received &gt;&gt; Connect time: 2 Œºs &gt;&gt; Request send time: 140 Œºs &gt;&gt; Response recv time: 136 ms and 279 Œºs 302</code> </pre><br></div></div><br></li><li>  authenticator - allows you to manage authorization in requests. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rq = Request(); rq.verbosity = <span class="hljs-number"><span class="hljs-number">2</span></span>; rq.authenticator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicAuthentication(<span class="hljs-string"><span class="hljs-string">"user"</span></span>, <span class="hljs-string"><span class="hljs-string">"passwd"</span></span>); rs = rq.get(<span class="hljs-string"><span class="hljs-string">"http://httpbin.org/basic-auth/user/passwd"</span></span>); assert(rs.code==<span class="hljs-number"><span class="hljs-number">200</span></span>); }</code> </pre><br></div></div><br></li><li>  bufferSize - sets the size of the read buffer (in bytes). </li><li>  proxy - allows you to set a proxy for requests in the form <pre>  http: // host: port / </pre></li></ul><br><br><h2>  Content streaming </h2><br>  The python-requests feature is streaming - the user receives a response from the server not at the end, but in the process of receiving the document.  For receiving and processing large documents, this method can help save memory.  python-requests allows you to receive a document as an iterator.  For D, it was natural to use InputRange.  In this case, we can use the answer not only for data acquisition, but also for direct use with algorithms working with InputRange. <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.format; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rq = Request(); rq.useStreaming = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; rq.verbosity = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rs = rq.get(<span class="hljs-string"><span class="hljs-string">"https://api.github.com/search/repositories?order=desc&amp;sort=updated&amp;q=language:D"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( rs.code == <span class="hljs-number"><span class="hljs-number">200</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> stream = rs.receiveAsRange(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !stream.empty ) { writefln(<span class="hljs-string"><span class="hljs-string">"portion of %d bytes received"</span></span>.format(stream.front.length)); stream.popFront; } } }</code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">conclusion</b> <div class="spoiler_text"><pre> <code class="bash hljs">&gt; GET /search/repositories?order=desc&amp;sort=updated&amp;q=language:D HTTP/1.1 &gt; Connection: Keep-Alive &gt; User-Agent: dlang-requests &gt; Accept-Encoding: gzip, deflate &gt; Host: api.github.com &gt; &lt; HTTP/1.1 200 OK &lt; server: GitHub.com &lt; date: Sat, 25 Jun 2016 15:45:28 GMT &lt; content-type: application/json; charset=utf-8 &lt; transfer-encoding: chunked &lt; content-encoding: gzip &lt; x-github-request-id: B077660C:560B:7F2F21:576EA717 &lt; 277 bytes of body received &lt; 1370 bytes of body received portion of 751 bytes received portion of 2988 bytes received portion of 4632 bytes received portion of 6002 bytes received portion of 7474 bytes received portion of 9106 bytes received portion of 10246 bytes received portion of 11356 bytes received portion of 12290 bytes received portion of 12870 bytes received portion of 63904 bytes received</code> </pre><br></div></div><br>  Here you can see that the element type for stream is an array of bytes.  Therefore, in the following character-number counting code, the use of a joiner is required: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.ascii; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.algorithm; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rq = Request(); rq.useStreaming = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> stream = rq.get(<span class="hljs-string"><span class="hljs-string">"https://api.github.com/search/repositories?order=desc&amp;sort=updated&amp;q=language:D"</span></span>).receiveAsRange; writeln(stream.joiner.filter!isDigit.count); }</code> </pre> <br>  In addition to processing large documents on the fly, streaming provides the easiest way to save documents to disk. <br><br>  Streaming is valid not only for GET requests, but also for any requests that return a document along with code 200. <br><br><h2>  Methods PUT / DELETE / HEAD ... </h2><br>  All the methods listed so far ultimately use the Request.exec (method) template method, which, in addition to the template parameter controlling the HTTP method, accepts all those combinations of parameters that were mentioned earlier. <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.ascii; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.range; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.algorithm; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rq = Request(); rq.useStreaming = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> rs = rq.exec!<span class="hljs-string"><span class="hljs-string">"HEAD"</span></span>(<span class="hljs-string"><span class="hljs-string">"https://api.github.com/search/repositories?order=desc&amp;sort=updated&amp;q=language:D"</span></span>); rs.code.writeln; rs.responseHeaders. byKeyValue. take(<span class="hljs-number"><span class="hljs-number">5</span></span>). each!(p=&gt;writeln(p.key, <span class="hljs-string"><span class="hljs-string">": "</span></span>, p.value)); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Conclusion</b> <div class="spoiler_text">  200 <br>  x-frame-options: deny <br>  cache-control: no-cache <br>  x-xss-protection: 1;  mode = block <br>  vary: Accept-Encoding <br>  content-type: application / json;  charset = utf-8 <br></div></div><br><br>  In the same way, you can call any HTTP methods. <br><br>  This concludes the second part of the article. <br><br>  Just in case, once again, the link to the project page on <a href="https://github.com/ikod/dlang-requests">Github</a> <br><br>  Good luck to everyone and enjoy programming! </div><p>Source: <a href="https://habr.com/ru/post/304106/">https://habr.com/ru/post/304106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304096/index.html">Gobetween Exec discovery + Elasticsearch. L4 balancing with Data Node Discovery</a></li>
<li><a href="../304098/index.html">Geographer Package - First Working Version</a></li>
<li><a href="../304100/index.html">Installing Emercoin blockchain with a web wallet on RedHat / CentOS 7 and Ubuntu 16.04</a></li>
<li><a href="../304102/index.html">War for anonymity, we open new fields</a></li>
<li><a href="../304104/index.html">Every blind admin himself</a></li>
<li><a href="../304108/index.html">The world's first football robots managed via Twitter</a></li>
<li><a href="../304110/index.html">Features of the JIT compilers in HotSpot JVM - meeting with Doug Hawkins, St. Petersburg</a></li>
<li><a href="../304112/index.html">Let me introduce the Shadow DOM API based on slots.</a></li>
<li><a href="../304114/index.html">Day zero patient</a></li>
<li><a href="../304116/index.html">Augmented reality and socialization of people at a new level</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>