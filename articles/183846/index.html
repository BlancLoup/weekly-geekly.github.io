<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use a component from a standard Android application in our project.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The power of Android is in its openness. The source code of any favorite application (if it is not one of Google Apps) or a component can be not only ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use a component from a standard Android application in our project.</h1><div class="post__text post__text-html js-mediator-article">  The power of Android is in its openness.  The source code of any favorite application (if it is not one of Google Apps) or a component can be not only studied, but also bolted to your project for the joy of yourself and users.  Moreover, its design and behavior will be familiar and familiar to users.  In this article, I will show how to do this.  We will select the component we want to borrow, find it in the source, examine it, add it to our library and connect it to our application. <br><br><img src="https://habrastorage.org/storage2/d17/4fb/590/d174fb59060536e8dc371c87f22a3409.png" alt="image"><br><a name="habracut"></a><br><br><h4>  Choose a component </h4><br>  To begin with, we‚Äôll choose what attracts our view so strongly in one of the standard Android applications.  In my case, this is a circular timer in the clock application.  It looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/0e4/765/08d/0e476508dda77c50bb4a3de99bbb3313.png" alt="image"><br><br>  But I want to use it not as a timer, but as an indicator of progress. <br><br><h4>  Find the source </h4><br>  The next step is to find the source code of this particular component among many other sources in Android applications.  All of these sources can be found at <a href="http://grepcode.com/project/repository.grepcode.com/java/ext/com.google.android/android-apps/">http://grepcode.com/project/repository.grepcode.com/java/ext/com.google.android/android-apps/</a> <br><br>  Select the latest version (at the time of writing this is 4.2.2_r1), go to ‚Äúcom / android‚Äù and look for the desired application.  In my case, this is "deskclock".  We run through the list of classes and ... we are lucky - there is a class with a talking name CircleTimerView.  However, instead of the class description - ‚ÄúTODO: Insert description here.  (generated by isaackatz) ¬ªThis class inherits View - it will be the key class of our library. <br><br><h4>  Create a library </h4><br>  You can skip this paragraph if the component you decide to add to the application is small.  For example, as in my case.  But for example, still do it through the library.  We start favorite IDE, we create the new project, having noted "Mark project as a library". <br><br>  Copy the found class to the library (or directly to the project).  Is there a lot of critical mistakes in the class?  And right!  We have copied only the class, which will be the point of contact between our application and all classes added to our library from the sources of the standard application. <br><br>  We look at what our class depended on before we pulled it out of its usual habitat.  In my case, these are the Utils, Stopwatches and the R constants box <br><br>  Copy the Utils class and see a lot of dependencies on other classes already in it.  Now you can either connect all the classes he needs, and then all the classes that are needed by these ... But it is better to just leave from the utilitarian class only those methods that we need.  Throwing out everything except getTimeNow () and calculateRadiusOffset (), removing extra imports is great. <br><br>  From the Stopwatches class, only three constants are used and, running ahead, I will say that I will not need them, as well as the method that uses them. <br><br>  Out of the R box, we take the data about indents and color, and here it‚Äôs impossible to just copy the class - it is generated automatically, based on resources.  We'll have to add resources.  You can find them in the source code at the address ‚Äúpackages / apps‚Äù, select the application being prepared, go to the res / values ‚Äã‚Äãfolder, copy the files ‚Äúcolors.xml‚Äù and ‚Äúdimens.xml‚Äù to the similar folder of our library project. <br><br>  Let's fix the imports in the main class and the library is ready.  Nearly.  Two added files should be cleaned, leaving there only the necessary data, and also add other versions of these files for different devices.  For the implementation of the latter, you need to find in the source code all files with such names in folders with the names ‚Äúvalues- *‚Äù and copy them to the library.  Thus, for example, on the tablet indents will be more than on the phone. <br><br><h4>  We connect the library to our application </h4><br>  Now the sweetest thing is to see the result of the work in action.  We open the project of our application, which needs this component so much, we connect the created library, we throw the com.android.deskclock.CircleTimerView element on the markup, and this is what we see when the application starts: <br><br><img src="https://habrastorage.org/storage2/ba0/096/c29/ba0096c29f90603e55bd4d2cd8154453.png" alt="image"><br><br>  Great, this is a white circle, almost what we wanted.  It remains only to bring it into action - you need a code that will make our circle be cool. <br><br>  Again we climb into the source, looking for an activity or a fragment that uses a component that we lent.  In my case, this is StopwatchFragment.  After a brief study of this fragment, it becomes clear that for a simple demonstration of the operation of an element, it is enough to write three lines: <br><br> <code>final CircleTimerView circleTimerView1 = <br> (CircleTimerView) findViewById(R.id.circleTimerView1);</code> <br> <br> <code>circleTimerView1.setIntervalTime(10000);</code> <br> <br> <code>circleTimerView1.startIntervalAnimation();</code> <br> <br>  Run the application again and see the desired (at least, me) result: <br><br><img src="https://habrastorage.org/storage2/d17/4fb/590/d174fb59060536e8dc371c87f22a3409.png" alt="image"><br><br>  Now everything is as it should be, which means it's time to say thanks to the Android development team.  It's about adding the text of the Apache License Agreement version 2.0 license to your application.  For example, display it by clicking the button in the settings. <br><br><h4>  What's inside? </h4><br>  Yes, everything is already working as it should, but we almost did not look at the code that we took.  Of course, this can not be done - the source code from the Android development team and the devil from the component is unlikely to pop up, but by studying the code, you can improve it, and learn the most useful things yourself. <br><br>  In the class from my example, everything is simple: all the rendering is in the onDraw (Canvas canvas) method, to call a redraw - postInvalidate ().  To keep the circle animation continuous, invalidate () is called directly in onDraw (...). <br><br>  <b>UPDATE</b> Now I experienced a component in the field - the fears about calling invalidate () from onDraw (...) were confirmed: having performed the recalculation and drawing, the component immediately accepted to repeat this action and so it goes on continuously. <br>  Drawing, of course, turns out smooth, but it uses 700 MHz processor, the phone quickly consumes energy and even the curtain of notifications slows down.  And this is probably the first time when my Galaxy Nexus began to noticeably heat up. <br>  To fix this is quite simple: not always we need to update the timer continuously.  Here it is necessary to take into account how much time must pass in order for the change to be visually noticeable.  For example, we start counting 5 seconds in this component on a high-resolution tablet, then it makes sense to do a continuous update.  Or is it a two-hour timer on a low-resolution phone?  We can perform at least 10 redraws per second, but they will not be visually noticeable. <br><br>  If necessary, you can rewrite the component to fit your needs (for example, under the progress indicator) or inherit it and redefine the necessary methods. <br><br><h4>  What's next? </h4><br>  We were lucky - the component from the example did not use anything that is not in the API of level 7 (Android 2.1), otherwise we would have to solve this unpleasant problem.  About it - next time. <br><br><h4>  Thanks to all </h4><br>  If someone read this article to the end, remembered a beautiful component from a favorite standard Android application and added it to my project - I am pleased that my work was not in vain. </div><p>Source: <a href="https://habr.com/ru/post/183846/">https://habr.com/ru/post/183846/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183834/index.html">Cache in multiprocessor systems. Cache coherence MESI protocol</a></li>
<li><a href="../183836/index.html">Integration of mobile application design. Part 1: Android</a></li>
<li><a href="../183838/index.html">What would happen if Hemingway wrote in JavaScript</a></li>
<li><a href="../183842/index.html">Call Center from birth to death</a></li>
<li><a href="../183844/index.html">Work with sound in Adobe Premiere Pro CS 6</a></li>
<li><a href="../183848/index.html">Beautiful CSS3 menu</a></li>
<li><a href="../183850/index.html">Musical rehearsals: now and through the Internet</a></li>
<li><a href="../183852/index.html">Convenient music download from vkontakte</a></li>
<li><a href="../183854/index.html">Introduction to Spring Frameworks: Spring MVC</a></li>
<li><a href="../183856/index.html">STM32F3DISCOVERY, accelerometers, stepper motors and a bit of magic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>