<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Let's play in CacheGraph?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose you have a website. Suppose you optimized it for the most "can not", but still wants more. 
 Personally, I wanted to, but for a long time did ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Let's play in CacheGraph?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/06f/ae4/f08/06fae4f08e416c5ff52878411a984f7d.jpg" alt="image" align="left">  Suppose you have a website.  Suppose you optimized it for the most "can not", but still wants more. <br>  Personally, I wanted to, but for a long time did not work. <br>  When I defeated the inhibition of the database by caching requests, the inhibition of blocks was done by caching blocks, and I could not cache entire pages ... <br>  The site of course began to work much faster, but it began to slow down already ... memkeshed? <br><a name="habracut"></a><br><br><h2>  How many database queries did you have? </h2><br>  Probably after the start of using query caches was not enough. <br>  And how many requests do you have to caches? <br>  The following applies only to systems using multiple memcached servers.  If you do not have memory, or one server - the effect will be minimal. <br><br><h2>  A bit of background </h2><br>  As philosophers say, everything develops in a spiral. <br>  Three years ago I was an ordinary game developer in a small studio, I sat for optimization 70% of the time catching delays with VTun. <br>  As you know - one of the main problems of video game development is <i>DIP</i> minimization.  If in Russian, you are rendering something on a video card, while the processor is waiting for synchronization or a response, in general idle ... <br>  It turned out that to render the monster on 10k triangles and on 1k triangles in time is the same. <br>  There were many different ways and tricks to avoid synchronization, or to reduce delays ... <br>  One of the assistants in this business was SceneGraph - the rendering tree. <br>  The essence is simple - whenever possible we render similar objects together in order to change fewer different variables between rendering. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Three years have passed, I am sitting on a habr and reading how Facebook has been copying my memobook ... <br>  Suddenly, the eyes catch on the expression ... <i><u>and implement an application</u></i> <br>  Here I was hooked ... <br><br>  How do template engines usually work? <br>  They take a pattern and ON THE QUEUE they replace the necessary places with the values ‚Äã‚Äãthat were previously set ON THE QUEUE. <br><br>  Imagine the following <br><br><pre>  &lt;a href='{OBJECT_HREF}'&gt; {OBJECT_LABEL} &lt;/a&gt; </pre><br>  and it is desirable to cycle 100 times ... <br>  We will also assume that we take variables from the cache. <br>  Will this be mmmm 200 requests? <br>  If with different <a href="http://habrahabr.ru/blogs/webdev/43539/">tricky tags</a> (thanks again <a href="http://habrahabr.ru/users/smira/" class="user_link">smira</a> ) - then 400+ <br>  If you don‚Äôt like the task, and you would put the entire block in the cache - then let's assume that we have 5 such blocks on the page, and one suddenly decided to regenerate ... <br><br>  Let's make a render of our page, as the game engines love to do - a <b>lot of passing</b> ... <br>  Passage1 - we collect the template, we collect the used keys, we replace their ‚Äúplaces‚Äù in the template with some anchors ... <br>  Pass 2 - with one bundle (muti-get) we request all keys. <br>  Passage 3 - collect key tags, one pack requested. <br>  Pass 3 - we determine which cache is alive, which is not.  For inanimate packs run run1 <br><br><h2>  How it works </h2><br>  We have 5 blocks, 100 elements in each. <br>  In pass 2 we request 5 keys - the values ‚Äã‚Äãof 5 blocks <br>  In passage3 we request their tags (we will consider them more than five) <br>  we assume that two blocks are expired <br>  Pass 3 starts pass 1 for two blocks.  Next will be pass 2 which will immediately request 200 keys from two blocks ... <br><br>  The result is if all the blocks are ‚Äúalive‚Äù instead of 10 (5 blocks + 5 tags) requests are made 2, 5 in a pack. <br>  If the block cache is dead, we make two requests (100 values ‚Äã‚Äã+ 100 tags (if any)) instead of 200 ... <br><br>  But how would this wrap up. <br>  You can wrap it in a normal tree.  In the Count.  In CacheGraph. <br>  We go around the tree, collect unknown keys, as long as they are there, request a pack and crawl on the tree further. <br>  At the end of a large str_replace of anchors in the template for the values ‚Äã‚Äãobtained (or another traversal of the tree with the substitution of values, like who you like) <br><br>  The result is minimization of calls to asynchronous sources, minimization of timeout for synchronization and response.  Acceleration of work. <br>  VERY serious acceleration of work in some tasks <br><br>  Bonus: if the cached items are made standalone, then the tree can be serialized and bypassed for example C ++ ... <br>  In the case of the expiration of the cache lifetime, again with a bundle, you can run php with a request to generate standalone blocks ... <br><br><h2>  What can I personally say about this? </h2><br>  <i>Went somehow Kashchei Immortal to drown.</i>  <i>He rushed into the turbulent river from the highest bridge ... Then under the train ... Then he jumped off the skyscraper ... Then he leaped into the pool with hydrochloric acid ... Then he swallowed cyanide ... He played <a href="http://www.kashey.ru/">Kashchei</a> , in general, as he could!</i> <i><br></i> </div><p>Source: <a href="https://habr.com/ru/post/47756/">https://habr.com/ru/post/47756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../47747/index.html">Gift wrapping like geeks</a></li>
<li><a href="../47752/index.html">Unit tests and inheritance</a></li>
<li><a href="../47753/index.html">On the architecture of the distributed blogosphere</a></li>
<li><a href="../47754/index.html">How I fought with Microsoft Word!</a></li>
<li><a href="../47755/index.html">What software development methodology does your company use?</a></li>
<li><a href="../47762/index.html">30+ great toys made by designers</a></li>
<li><a href="../47763/index.html">Christmas game on rapper Syavu</a></li>
<li><a href="../47764/index.html">TANK</a></li>
<li><a href="../47766/index.html">Best startups of December</a></li>
<li><a href="../47767/index.html">‚ÄúCitizen, submit a check for MP3‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>