<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to the Zend Framework (continued)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the story of the Zend Framework. In the first part of the article, the concept of the MVC software architecture was described, the structu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to the Zend Framework (continued)</h1><div class="post__text post__text-html js-mediator-article">  We continue the story of the Zend Framework.  In the <a href="http://habrahabr.ru/post/31168/">first part of the</a> article, the concept of the MVC software architecture was described, the structure of a typical web application based on the Zend Framework was considered, and a demo implementation of the controller and a view based on it was made.  In the second part, the theme of the model will be revealed and an example of the application's interaction with the database is given. <a name="habracut"></a><br><br>  <b>Posted by:</b> Rob Allen, <a href="http://akrabat.com/">akrabat.com</a> <br>  <b>Original:</b> <a href="http://akrabat.com/zend-framework-tutorial/">akrabat.com/zend-framework-tutorial</a> <br>  <b>Translation:</b> Alexander Musayev, <a href="http://musayev.com/">musayev.com</a> <br><br><h4>  Database </h4><br>  Now that the control part of our application and the visualization code are separated, it‚Äôs time to do a model.  Remember that a model is a basic part of an application that implements its main functions.  Therefore, in our case, the model performs work with the database.  We use the Zend Framework class <code>Zend_Db_Table</code> , designed to search, insert, update and delete records in a database table. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Customization </h4><br>  To use <code>Zend_Db_Table</code> , you will need to tell him which database, what username and password he will use.  Taking into account that this information is preferably not to be hammered into the code, we will use the configuration file for its storage. <br><br>  Zend Framework provides for this purpose the <code>Zend_Config</code> class, which provides flexible object-oriented access to configuration files in INI and XML formats.  Stop your choice on the ini file: <br><br> <code>zf-tutorial/application/config.ini:</code> <br> <br><pre> <code class="hljs lua">[general] db.adapter = PDO_MYSQL db.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.host = localhost db.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.username = rob db.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.password = <span class="hljs-number"><span class="hljs-number">123456</span></span> db.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.dbname = zftest</code> </pre> <br>  (Of course, you will need to use your own database access parameters, not the ones shown in the example.) <br><br>  Using <code>Zend_Config</code> will be very simple: <br><br><pre> <code class="php hljs">$config = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Zend_Config_Ini(<span class="hljs-string"><span class="hljs-string">'config.ini'</span></span>, <span class="hljs-string"><span class="hljs-string">'section'</span></span>);</code> </pre> <br>  In this case, <code>Zend_Config_Ini</code> loads one section from the INI file (in the same way, if necessary, you can load any other section).  The possibility of naming sections is implemented so that unnecessary data is not needlessly loaded.  <code>Zend_Config_Ini</code> uses a dot in the parameter names as a hierarchical separator, making it possible to group related parameters.  In our <code>config.ini</code> file, the <code>host</code> , <code>username</code> , <code>password</code> and <code>dbname</code> parameters will be grouped in the <code>$config-&gt;db-&gt;config</code> object. <br><br>  We will load the configuration file from the bootstrap file ( <code>index.php</code> ): <br><br> <code>zf-tutorial/index.php:</code> <br> <br><pre> <code class="php hljs">... Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Controller_Front'</span></span>); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Config_Ini'</span></span>); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Registry'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// load configuration $config = new Zend_Config_Ini('./application/config.ini', 'general'); $registry = Zend_Registry::getInstance(); $registry-&gt;set('config', $config); // setup controller ...</span></span></code> </pre> <br>  After loading the necessary classes for work ( <code>Zend_Config_Ini</code> and <code>Zend_Registry</code> ), a section of the <code>application/config.ini</code> configuration file is loaded into the <code>$config</code> object under the name <code>general</code> .  Next, the <code>$config</code> object is included in the registry, which provides access to it from the entire application. <br><br>  <b>Note:</b> In this example, there is no real need to store <code>$config</code> in the registry.  This is done as an example of the operation of a ‚Äúreal‚Äù application, in the configuration file of which you may have to store something more than the database access parameters.  When using the registry, also note that the data in it is available at the global level, and that if used carelessly, this can cause potential conflict situations within the application. <br><br><h5>  Using Zend_Db_Table </h5><br>  In order to use the <code>Zend_Db_Table</code> class, we will need to pass into it the database access parameter that was just loaded.  To do this, you need to create a <code>Zend_Db</code> object and register it with the <code>Zend_Db_Table::setDefaultAdapter()</code> function.  Below is the corresponding code snippet in the primary boot file: <br><br> <code>zf-tutorial/index.php:</code> <br> <br><pre> <code class="php hljs">... Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Controller_Front'</span></span>); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Config_Ini'</span></span>); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Registry'</span></span>); &lt;b&gt;Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Db'</span></span>); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Db_Table'</span></span>);&lt;/b&gt; <span class="hljs-comment"><span class="hljs-comment">// load configuration $config = new Zend_Config_Ini('./application/config.ini', 'general'); $registry = Zend_Registry::getInstance(); $registry-&gt;set('config', $config); &lt;b&gt;// setup database $db = Zend_Db::factory($config-&gt;db-&gt;adapter, $config-&gt;db-&gt;config-&gt;toArray()); Zend_Db_Table::setDefaultAdapter($db);&lt;/b&gt; // setup controller ...</span></span></code> </pre> <br><h5>  Creating a table </h5><br>  We will use the MySQL database, so the SQL query for creating the table will look like this: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> album ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> auto_increment, artist <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, title <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">100</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) );</code> </pre> <br>  This query can be executed through any MySQL client, for example, phpMyAdmin or a standard console utility. <br><br><h5>  Adding a test record </h5><br>  Add a few test records to the table to check the functionality of the main page, on which they should later be displayed. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> album (artist, title) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'James Morrison'</span></span>, <span class="hljs-string"><span class="hljs-string">'Undiscovered'</span></span>), (<span class="hljs-string"><span class="hljs-string">'Snow Patrol'</span></span>, <span class="hljs-string"><span class="hljs-string">'Eyes Open'</span></span>);</code> </pre> <br><h4>  Model </h4><br>  <code>Zend_Db_Table</code> is an abstract class, so on its basis it is necessary to create a heir class specialized in our task.  The name of a new class does not matter in principle, but such classes should be called like the corresponding DB tables (this will increase the level of self-documenting of the code).  Thus, for our <code>album</code> table, the class name will be <code>Album</code> . <br><br>  In order to pass to <code>Zend_Db_Table</code> name of the table that it will manage, you must assign this value to the protected property of the <code>$_name</code> class.  It should be noted that in the <code>Zend_Db_Table</code> class, by default, a key auto-increment table field with the name <code>id</code> always used.  If necessary, the value of the name of this field can also be changed. <br><br>  The <code>Album</code> class will be stored in the model directory. <br><br> <code>zf-tutorial/application/models/Album.php:</code> <br> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Album</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Zend_Db_Table</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $_name = <span class="hljs-string"><span class="hljs-string">'album'</span></span>; }</code> </pre> <br>  Nothing complicated, is it?  Given that our needs in this case are quite small, the basic functionality of <code>Zend_Db_Table</code> will be enough to fully satisfy them.  If, in your tasks, you need to implement more complex operations of interaction with the database, then the class of the model is exactly the place where the corresponding code should be placed. <br><br><h4>  Album list </h4><br>  Now that we have configured the database, we can proceed to the main task of the application and display several entries.  This should be implemented in the <code>IndexController</code> class.  Each action function inside <code>IndexController</code> interacts with the <code>album</code> table through the class <code>Album</code> .  Therefore, it makes sense to load it when the controller is initialized inside the <code>init()</code> function. <br><br> <code>zf-tutorial/application/controllers/IndexController.php:</code> <br> <br><pre> <code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;baseUrl = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getBaseUrl(); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Album'</span></span>); } ...</code> </pre> <br>  <b>Note:</b> This code snippet shows an example of using the <code>Zend_Loader::loadClass()</code> method to load non-standard classes.  This works, because the model directory (in which the loadable <code>Albums</code> class is stored) was added by us to <code>include_path</code> . <br><br>  Create a list of albums from the database using <code>indexAction()</code> : <br><br> <code>zf-tutorial/application/controllers/IndexController.php:</code> <br> <br><pre> <code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;title = <span class="hljs-string"><span class="hljs-string">"My Albums"</span></span>; $album = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Album(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;albums = $album-&gt;fetchAll(); } ...</code> </pre> <br>  The <code>fetchAll()</code> function returns a <code>Zend_Db_Table_Rowset</code> object, which will allow us to generate a list of all the records in a template file of the form: <br> <code>zf-tutorial/application/views/scripts/index/index.phtml:</code> <br> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'header.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;title); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; &lt;p&gt;&lt;a href=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;baseUrl; ?&gt;/index/add"</span></span>&gt;Add <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> album&lt;/a&gt;&lt;/p&gt; &lt;table&gt; &lt;tr&gt; &lt;th&gt;Title&lt;/th&gt; &lt;th&gt;Artist&lt;/th&gt; &lt;th&gt; &lt;/th&gt; &lt;/tr&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;albums <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $album) : <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;tr&gt; &lt;td&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape($album-&gt;title);<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/td&gt; &lt;td&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape($album-&gt;artist);<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/td&gt; &lt;td&gt; &lt;a href=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;baseUrl; ?&gt;/index/edit/id/&lt;?php echo $album-&gt;id;?&gt;"</span></span>&gt;Edit&lt;/a&gt; &lt;a href=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;baseUrl; ?&gt;/index/delete/id/&lt;?php echo $album-&gt;id;?&gt;"</span></span>&gt;Delete&lt;/a&gt; &lt;/td&gt; &lt;/tr&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endforeach</span></span>; <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;/table&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'footer.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  By the address <code><a href="http://localhost/zf-tutorial/"></a> localhost/zf-tutorial</code>  <code><a href="http://localhost/zf-tutorial/"></a> localhost/zf-tutorial</code> should now display a list of our two albums. <br><br><h4>  Adding a new album </h4><br>  We now turn to the function of adding a new disk to the database.  This task consists of two parts: <br><ul><li>  display of the form through which the user will enter data; </li><li>  Adding data taken from the form to the database. </li></ul><br>  We implement the listed operations in the <code>addAction()</code> action <code>addAction()</code> : <br><br> <code>zf-tutorial/application/controllers/IndexController.php:</code> <br> <br><pre> <code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;title = <span class="hljs-string"><span class="hljs-string">"Add New Album"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;isPost()) { Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Filter_StripTags'</span></span>); $filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Zend_Filter_StripTags(); $artist = $filter-&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'artist'</span></span>)); $artist = trim($artist); $title = trim($filter-&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($artist != <span class="hljs-string"><span class="hljs-string">''</span></span> &amp;&amp; $title != <span class="hljs-string"><span class="hljs-string">''</span></span>) { $data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'artist'</span></span> =&gt; $artist, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $title, ); $album = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Album(); $album-&gt;insert($data); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_ redirect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">// set up an "empty" album $this-&gt;view-&gt;album = new stdClass(); $this-&gt;view-&gt;album-&gt;id = null; $this-&gt;view-&gt;album-&gt;artist = ''; $this-&gt;view-&gt;album-&gt;title = ''; // additional view fields required by form $this-&gt;view-&gt;action = 'add'; $this-&gt;view-&gt;buttonText = 'Add';&lt;/b&gt; } ...</span></span></code> </pre> <br>  Notice how at the beginning of the function it was determined whether there was a transfer of the data of their form.  If the data from the form has been submitted, we retrieve the <code>artist</code> and <code>title</code> values, and process them with the HTML tag filter <code>Zend_Filter_StripTags</code> .  Further, if the rows have a non-empty value, we use the <code>Album()</code> class to add a new record to the database table.  After adding an album, the user is redirected back to the main page using the <code>_redirect()</code> controller method. <br><br>  The last thing you need to do is prepare an HTML form for the view template.  Looking ahead, it can be noted that the form for editing records will look identical to the form for adding them.  Therefore, we use a common template file ( <code>_form.html</code> ), which will be used in <code>add.phtml</code> and <code>edit.phtml</code> : <br><br>  Template page for adding a new album: <br><br> <code>zf-tutorial/application/views/scripts/index/add.phtml:</code> <br> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'header.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;title); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'index/_form.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'footer.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br> <code>zf-tutorial/application/views/scripts/index/_form.phtml:</code> <br> <br><pre> <code class="php hljs">&lt;form action=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;baseUrl ?&gt;/index/&lt;?php echo $this-&gt;action; ?&gt;"</span></span> method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;div&gt; &lt;label <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>=<span class="hljs-string"><span class="hljs-string">"artist"</span></span>&gt;Artist&lt;/label&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> name=<span class="hljs-string"><span class="hljs-string">"artist"</span></span> value=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;escape(trim($this-&gt;album-&gt;artist));?&gt;"</span></span>/&gt; &lt;/div&gt; &lt;div&gt; &lt;label <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>=<span class="hljs-string"><span class="hljs-string">"title"</span></span>&gt;Title&lt;/label&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> name=<span class="hljs-string"><span class="hljs-string">"title"</span></span> value=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;escape($this-&gt;album-&gt;title);?&gt;"</span></span>/&gt; &lt;/div&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"formbutton"</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"id"</span></span> value=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;album-&gt;id; ?&gt;"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"add"</span></span> value=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;escape($this-&gt;buttonText); ?&gt;"</span></span> /&gt; &lt;/div&gt; &lt;/form&gt;</code> </pre> <br>  It turned out quite simple code.  Given that we intend to use <code>_form.phtml</code> also when editing records, we use the <code>$this-&gt;action</code> variable instead of hard-coding the name of the necessary action.  In the same way, the variable is set to the inscription on the button to transfer data from the form. <br><br><h4>  Editing an album </h4><br>  Editing an album is in many respects identical to adding a new record, so the code turns out to be similar: <br><br> <code>zf-tutorial/application/controllers/IndexController.php:</code> <br> <br><pre> <code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;title = <span class="hljs-string"><span class="hljs-string">"Edit Album"</span></span>; $album = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Album(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;isPost()) { Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Filter_StripTags'</span></span>); $filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Zend_Filter_StripTags(); $id = (int)<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $artist = $filter-&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'artist'</span></span>)); $artist = trim($artist); $title = trim($filter-&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'title'</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($artist != <span class="hljs-string"><span class="hljs-string">''</span></span> &amp;&amp; $title != <span class="hljs-string"><span class="hljs-string">''</span></span>) { $data = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'artist'</span></span> =&gt; $artist, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; $title, ); $where = <span class="hljs-string"><span class="hljs-string">'id = '</span></span> . $id; $album-&gt;update($data, $where); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_redirect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;album = $album-&gt;fetchRow(<span class="hljs-string"><span class="hljs-string">'id='</span></span>.$id); } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// album id should be $params['id'] $id = (int)$this-&gt;_request-&gt;getParam('id', 0); if ($id &gt; 0) { $this-&gt;view-&gt;album = $album-&gt;fetchRow('id='.$id); } } // additional view fields required by form $this-&gt;view-&gt;action = 'edit'; $this-&gt;view-&gt;buttonText = 'Update'; } ...</span></span></code> </pre> <br>  It is worth noting that in cases where the data was not transferred to the script from the form, we can get the <code>id</code> parameter from the <code>params</code> property of the <code>Request</code> object using the <code>getParam()</code> method. <br><br>  The template code is shown below: <br><br> <code>zf-tutorial/application/views/scripts/index/edit.phtml:</code> <br> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'header.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;title); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'index/_form.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'footer.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><h4>  Refactoring </h4><br>  Of course, your attention could not escape the fact that <code>addAction()</code> and <code>editAction()</code> very similar, and the templates for adding and editing records are generally identical.  It is logical to assume the need for code refactoring.  Solve this problem on your own, as an additional practical exercise. <br><br><h4>  Deleting an album </h4><br>  In order to complete the development of the application, you will need to add a function to delete records.  We have links to remove albums opposite each item in the list.  The first solution that comes to mind is to delete the records immediately after clicking on one of these links.  But this is the wrong approach.  Recall that according to the HTTP specification, you should not perform irreversible actions using the GET method.  In such cases, it is recommended to use POST.  An example of this is the work of Google Accelerator. <br><br>  We must request confirmation before deleting records and delete them only after it is received.  The code that implements these actions is somewhat similar to the function-actions already existing in our application: <br><br> <code>zf-tutorial/application/controllers/IndexController.php:</code> <br> <br><pre> <code class="php hljs">... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;title = <span class="hljs-string"><span class="hljs-string">"Delete Album"</span></span>; $album = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Album(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;isPost()) { Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Filter_Alpha'</span></span>); $filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Zend_Filter_Alpha(); $id = (int)<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $del = $filter-&gt;filter(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getPost(<span class="hljs-string"><span class="hljs-string">'del'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($del == <span class="hljs-string"><span class="hljs-string">'Yes'</span></span> &amp;&amp; $id &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $where = <span class="hljs-string"><span class="hljs-string">'id = '</span></span> . $id; $rows_affected = $album-&gt;delete($where); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $id = (int)<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_request-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($id &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// only render if we have an id and can find the album. $this-&gt;view-&gt;album = $album-&gt;fetchRow('id='.$id); if ($this-&gt;view-&gt;album-&gt;id &gt; 0) { // render template automatically return; } } } // redirect back to the album list unless we have rendered the view $this-&gt;_redirect('/'); } ...</span></span></code> </pre> <br>  The same method of determining the method of accessing the script and selecting the required operation (deleting the record or issuing a confirmation form) is used.  In the same way as in the case of adding and editing, deletion is performed via <code>Zend_Db_Table</code> using the <code>delete()</code> method.  At the end of the function, a user is redirected to a page with a list of albums.  Thus, if one of the parameter <code>_redirect()</code> checks fails, it returns to the original page without the help of repeated access to <code>_redirect()</code> inside the function. <br><br>  The template is a simple form: <br> <code>zf-tutorial/application/views/scripts/index/delete.phtml:</code> <br> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'header.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;h1&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;escape(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;title); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/h1&gt; &lt;b&gt;<span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;album) :<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;form action=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;baseUrl ?&gt;/index/delete"</span></span> method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;p&gt;Are you sure that you want to delete <span class="hljs-string"><span class="hljs-string">'&lt;?php echo $this-&gt;escape($this-&gt;album-&gt;title); ?&gt;'</span></span> by <span class="hljs-string"><span class="hljs-string">'&lt;?php echo $this-&gt;escape($this-&gt;album-&gt;artist); ?&gt;'</span></span>? &lt;/p&gt; &lt;div&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"hidden"</span></span> name=<span class="hljs-string"><span class="hljs-string">"id"</span></span> value=<span class="hljs-string"><span class="hljs-string">"&lt;?php echo $this-&gt;album-&gt;id; ?&gt;"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"del"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Yes"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"del"</span></span> value=<span class="hljs-string"><span class="hljs-string">"No"</span></span> /&gt; &lt;/div&gt; &lt;/form&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span> &lt;p&gt;Cannot find album.&lt;/p&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span>;<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span>&lt;/b&gt; <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;render(<span class="hljs-string"><span class="hljs-string">'footer.phtml'</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><h4>  Troubleshooting </h4><br>  If there are difficulties in accessing any actions other than <code>index</code> / <code>index</code> , most likely the reason is that the class router cannot correctly determine which directory your website is in.  This situation may occur if the URL of the site does not match the path to its directory relative to the root directory opened for access from the network. <br>  If the above code does not match your case, you must set the <code>$baseURL</code> variable to the correct value for your server: <br><br> <code>zf-tutorial/index.php:</code> <br> <br><pre> <code class="php hljs">... <span class="hljs-comment"><span class="hljs-comment">// setup controller $frontController = Zend_Controller_Front::getInstance(); $frontController-&gt;throwExceptions(true); $frontController-&gt;setBaseUrl('/mysubdir/zf-tutorial'); $frontController-&gt;setControllerDirectory('./application/controllers'); ...</span></span></code> </pre> <br>  The value <code>/mysubdir/zf-tutorial/</code> will need to be replaced with the actual path to the <code>index.php</code> file.  For example, if your URL to <code>index.php</code> looks like <code><a href="http://localhost/~ralle/zf-tutorial/index.php"></a> localhost/~ralle/zf-tutorial/index.php</code>  <code><a href="http://localhost/~ralle/zf-tutorial/index.php"></a> localhost/~ralle/zf-tutorial/index.php</code> , the correct value for the <code>$baseUrl</code> variable is <code>/~ralle/zf-tutorial/</code> . <br><br><h4>  Conclusion </h4><br>  With this, the construction of a simple but full-featured MVC application can be considered complete.  I hope this review was helpful and informative for you.  Any comments on the original text can be sent to the author of the article at rob@akrabat.com.  Comments related to the Russian translation, send to musayev@yandex.ru. <br><br>  This article is only a superficial review of the Zend Framework, in which there are a great many other classes besides those listed here.  For detailed familiarization with them you should refer to the corresponding resources: <br><ul><li>  Official documentation ‚Üí <a href="http://framework.zend.com/manual">framework.zend.com/manual</a> </li><li>  Wiki with additional materials ‚Üí <a href="http://framework.zend.com/wiki">framework.zend.com/wiki</a> </li><li>  Wiki for developers ‚Üí <a href="http://framework.zend.com/developer">framework.zend.com/developer</a> </li><li>  Original article in English, and code examples on the author‚Äôs website ‚Üí <a href="http://akrabat.com/zend-framework-tutorial/">akrabat.com/zend-framework-tutorial</a> </li></ul><br>  The translation used materials from the free encyclopedia Wikipedia.org. </div><p>Source: <a href="https://habr.com/ru/post/31173/">https://habr.com/ru/post/31173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../31172/index.html">Briefing trendwatching.com "5 most interesting trends in 2007."</a></li>
<li><a href="../311720/index.html">WordCamp Europe in Vienna and the WordPress Development Vector</a></li>
<li><a href="../311722/index.html">All about Cisco FastLocation</a></li>
<li><a href="../311726/index.html">libsodium: Public-key authenticated encryption or how I decrypted the message without the private key</a></li>
<li><a href="../311728/index.html">Proof of Fermat's Big Theorem for a cube, as a key</a></li>
<li><a href="../311730/index.html">OpenGL ES 2.0. Deferred lighting</a></li>
<li><a href="../311732/index.html">Docker in production: ‚ÄúWhen you eat it, you are at least not disgusted, especially if you know how to cook‚Äù</a></li>
<li><a href="../311734/index.html">Implementation of alpha testing and alpha lab in projects</a></li>
<li><a href="../311736/index.html">Report from Moscow Python Meetup September 22</a></li>
<li><a href="../311738/index.html">Backup and restore mail from the cloud using Veeam Backup for Microsoft Office 365</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>