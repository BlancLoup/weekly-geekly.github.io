<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Detailed anatomy of a simple XBMC plugin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 A similar article on Habr√© has already been published , but it focused on parsing the site with a video ‚Äî the business logic of the plug-in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Detailed anatomy of a simple XBMC plugin</h1><div class="post__text post__text-html js-mediator-article"><h4>  Foreword </h4><br>  A similar article on Habr√© has already been <a href="http://habrahabr.ru/post/166097/">published</a> , but it focused on parsing the site with a video ‚Äî the business logic of the plug-in, so to speak, and the issues of interaction with XBMC were touched on in passing.  I want to talk about what turns the Python script (hereinafter - Python) into an XBMC plugin. <a name="habracut"></a><br>  This plugin is designed to view video podcasts from <a href="http://www.cnet.com/">www.cnet.com</a> in normal or high quality, depending on the settings.  The plugin has nothing to do with the CNET podcast viewer plugin available in the official XBMC repository.  It is written entirely from 0 as an educational project as part of the independent study of the actual writing of plug-ins to XBMC.  The plugin does not claim to be useful to a wide audience, nor to particularly outstanding software solutions.  However, it is fully working, and it contains most of the elements inherent in ‚Äúserious‚Äù plugins: an XML file with metadata, the main script, an external imported module, a settings panel, localization files, resource files (pictures).  I hope that the plugin and this article will serve as a starting point for both beginner plugin writers and experienced Python programmers who will want to join in writing plugins for XBMC. <br><br>  Fully plugin can be downloaded <a href="http://yadi.sk/d/lBTJXwu2968my">from here</a> . <br><br>  Note: hereinafter, the term ‚Äúservice‚Äù is used in relation to some files and folders.  This means that XBMC searches for such folders and files without directly referring to them in the plugin code.  ‚ÄúService‚Äù! = ‚ÄúRequired‚Äù, and simpler plug-ins may not contain any service files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  general information </h4><br>  To write XBMC plugins, Python is used.  XBMC under Windows is compiled with version 2.7, and under Linux, as I understand it, the version of Python depends on the installed developer libraries used in the build.  In any case, when writing the plug-in code, it is necessary to focus on the syntax and capabilities of Python 2.7. <br>  Python in XBMC is full-featured: almost the entire standard library is present, except, perhaps, Tkinter / ttk / tix (which are obviously redundant here).  To interact with XBMC, 5 modules have been added: xbmc, xbmcgui, xbmcplugin, xbmcaddon and xbmcvfs, which together make up the XBMC Python API.  A quick reference on the modules can be found <a href="http://mirrors.xbmc.org/docs/python-docs/">here</a> .  Unfortunately, in the help there are inaccuracies. <br>  In addition, the print statement instead of the console writes to the XBMC log with the Notice level, which can be used when debugging, for example, to display the values ‚Äã‚Äãof variables. <br>  A little about terminology: XBMC developers initially used the term ‚Äúaddon‚Äù (addon) for any additions, which, in turn, are divided into plug-ins (content sources), scripts (programs), scrappers (information downloads to media content) and others.  However, over time, the concept of "addon" and "plugin" are messed up, and now they are often used to refer to any add-on. <br><br><h4>  IDE Setup </h4><br>  As already mentioned, XBMC plugins are written in Python.  A program in this language is essentially a text file that you can work with in any text editor, starting with Windows Notepad and ending with ‚Äúadvanced options‚Äù, like Notepad ++.  However, for writing any more or less complicated code, it is better to use IDE (Integrated Development Environment), which offers a number of conveniences: code highlighting, autocompletion of keywords, code browser, brief help on objects, etc. Many Python programmers often use a bunch Eclipse + PyDev, but personally I prefer the more lightweight PyScripter, which has almost all the functions of a full-fledged IDE, except, perhaps, code folding.  True, the project has not developed since 2012, but for Python 2.x its capabilities are more than enough. <br>  To facilitate the development of plug-ins on Python in the IDE, good people (including me) have compiled a <a href="https://github.com/romanvm/xbmcstubs/">set of Python plug-in modules</a> that simulate real XBMC Python API modules.  These modules need to be added to the project import paths (‚ÄúProperties‚Äù&gt; ‚ÄúPYTHONPATH‚Äù&gt; ‚ÄúSource folders‚Äù in Eclipse / PyDev or ‚ÄúExtra Python Path ...‚Äù in PyScripter), and we get Profit - code completion and brief reference for classes start working, methods and other elements of the XBMC Python API. <br><br>  Attention: these are just stub modules that do not contain useful code, and an attempt to start the program that references them directly from the IDE will lead to unpredictable results.  However, those who wish can add a debugging code to these modules that simulates the behavior of real functions and XBMC Python API methods. <br><br><h4>  Plugin structure </h4><br>  My "educational" plugin has the following structure: <br><pre><code class="bash hljs">addon.xml changelog.txt default.py fanart.jpg icon.png License.txt \resources\ settings.xml \language\ \English strings.po \Russian\ strings.po \Ukrainian\ strings.po \lib\ feeds.py \thumbnails\</code> </pre> <br>  Now more about the appointment of all these files and folders. <br><br><h4>  addon.xml </h4><br>  addon.xml is a plugin service file from which the built-in XBMC plugin cataloger takes all the necessary information.  This is the only mandatory file of the plug-in, and some types of plug-ins (scrapers, repositories, etc.) may not contain any program code or other service files at all. <br><br><div class="spoiler">  <b class="spoiler_title">File contents:</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"plugin.video.cnet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.0.1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"CNET Video Podcasts"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">provider-name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Roman_V_M"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requires</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">addon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xbmc.python"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requires</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  ()  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.pluginsource"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span><span class="hljs-tag">&gt;</span></span>video<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"xbmc.addon.metadata"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">summary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span>CNET Video Podcasts<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">summary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">summary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span>- CNET<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">summary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">summary</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"uk"</span></span></span><span class="hljs-tag">&gt;</span></span>—ñ- CNET<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">summary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span>Addon for watching CNET video podcasts from XBMC.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span>   - CNET  XBMC.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"uk"</span></span></span><span class="hljs-tag">&gt;</span></span>   —ñ-—ñ CNET  XBMC.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span>all<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addon</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Now more about the content.  To display line numbers, open the file in a text editor that supports this feature. <br><br>  Lines 3-6 contain basic information about the plug-in: a unique identifier that matches the name of the plug-in folder;  version;  the name displayed in the XBMC interface;  plugin author (s). <br><br>  Lines 8-10 contain information about external dependencies ‚Äî other components necessary for the operation of the plug-in.  As you can see, this plugin requires only XBMC Python API version 2.1.  This version is supported in XBMC 13.x (Gotham). <br>  If your plugin requires any other plugin to work, we indicate it here in the same tag.  For example, if for your plugin for some reason you need the Youtube plugin, in the section you need to add the following tag: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">addon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"plugin.video.youtube"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.0.0"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  In theory, missing dependencies should be installed automatically when the plugin is installed. <br><br>  Lines 12-14 contain information about the type of plugin.  <code>extension point="xbmc.python.pluginsource"</code> means that this is the source plugin for the content, <code>library="default.py"</code> indicates the starting script of the plugin, and video means that it is a video plugin.  If the plugin provides access to different content, in the tag you can specify the types of available content separated by spaces.  Possible values: video, music and image.  These values ‚Äã‚Äãdetermine in which section this plugin will be displayed: ‚ÄúVideo‚Äù, ‚ÄúMusic‚Äù or ‚ÄúPhoto‚Äù.  Plugin to access different types of content can be displayed in several sections. <br>  As already mentioned, "xbmc.python.pluginsource" means that it is a plugin source of content.  That is, using the terminology of the XBMC developers, this is the real plugin, unlike scripts and other types of add-ons.  The main difference between source plugins and script plugins (software plugins) is that the source plugin presents the user with multimedia content in the form of multi-level lists (directories) containing folders (virtual and / or real) and files (local and / or in the network), while the script may have an arbitrary interface (within the limits of the API capabilities) or not at all.  In the case of a software script, the parameter in double quotes would look like ‚Äúxbmc.python.script‚Äù and in the tag <pre> <code class="hljs markdown"><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <code><a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main()</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code> </pre> <code><code class="xml">   executable, . .: <br> &lt;extension point="xbmc.python.script" library="default.py"&gt; &lt;provides&gt;executable&lt;/provides&gt; &lt;/extension&gt;</code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <code><a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           ____,      . <br> <br> <b class="spoiler_title"> :</b> # -*- coding: utf-8 -*- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    _ADDON_NAME = 'plugin.video.cnet' _addon = xbmcaddon.Addon(id=_ADDON_NAME) _addon_id = int(sys.argv[1]) _addon_url = sys.argv[0] _addon_path = _addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(_addon_path, 'resources', 'lib')) import feeds #       def _string(string_id): return _addon.getLocalizedString(string_id).encode('utf-8') #  URL-encoded    def get_feed_name(): paramstring = sys.argv[2] if paramstring: feed_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_name = '' return feed_name #  RSS- def rss_parser(url): listing = [] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[2:], links[2:]): title = title.toxml().replace('&lt;title&gt;&lt;![CDATA[', '').replace(']]&gt;&lt;/title&gt;', '') link = link.toxml().replace('&lt;link&gt;', '').replace('&lt;/link&gt;', '') listing.append([title, link]) return listing #      ( ). def feed_list(addon_id, addon_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list_item.setProperty('fanart_image', fanart) # URL,        . url = addon_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_id, url, list_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_id, xbmcplugin.SORT_METHOD_LABEL_IGNORE_THE) #   xbmcplugin.endOfDirectory(addon_id) #    . switch_view() #         . def switch_view(): skin_used = xbmc.getSkinDir() if skin_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast_list(addon_id, fanart, thumb, listing): for item in listing: #   . list_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_item.setProperty('fanart_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_id, item[1], list_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_id) def main(): #   . thumbpath = os.path.join(_addon_path, 'resources', 'thumbnails') fanart = os.path.join(_addon_path, 'fanart.jpg') #        . feed = get_feed_name() #      XBMC ( ),     . if feed: #       . quality = _addon.getSetting('quality') #   . listing = rss_parser(url=feeds.FEEDS[feed][quality]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % _ADDON_NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[feed]['thumb']) #   . podcast_list(addon_id=_addon_id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (_ADDON_NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (_string(100501), _string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % _ADDON_NAME, xbmc.LOGNOTICE) #     . feed_list(addon_id=_addon_id, addon_url=_addon_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if __name__ == '__main__': main()</code> <br> <br>   .   . <br> <br>  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. <br> <br>  : <br> <br> 11:   .      ,   addon.xml,    (      ). <br> <br> 12:    Addon     . <br> <br> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . <br> <br> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . <br>   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . <br> <br> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. <br>   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(__file__)   ,  os.getcwd()   . ,  ,     ,  XBMC. <br> <br> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî <a href="http://www.cnet.com/podcasts">www.cnet.com/podcasts</a> ‚Äî     ,     ‚Äî ,     ,        . <br> <br> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . <br> <br> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . <br>   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . <br> :            ,     .         URL,   plugin://. <br> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . <br> <br> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). <br> <br> 52‚Äî64:       cnet.com ‚Äî  ,   .   . <br> <br> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). <br> <br> 59:     .  ,       ,         . <br> <br> 61:      .            . ,            . <br> <br> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . <br> <br> 65:   .   ,         ,    . <br> <br> 67:  XBMC,    . <br> <br> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . <br>  ,      .       ‚Äî  Youtube. <br> <br> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . <br> <br> 80‚Äî89:    ,      .     ,    feed_list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         _string(),        XBMC.     . <br> <br> \resources <br>  \resources ‚Äî ,        . <br> <br> settings.xml <br> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . <br> <br> <b class="spoiler_title"> :</b> <code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</code> <br> <br>          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). <br>     settings.xml         ¬´ <a href="http://yadi.sk/d/NvfFuXYw92paL">XBMC Addon Developers Guide</a> ¬ª ( ).       ,       ,         . <br>        XML   \userdata\addon_data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code> <pre> <code class="hljs markdown"><code><code class="python"><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> ),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code></code> <h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> </h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> <h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> </h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> <h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> </h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> <h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> </h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> <h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> </h4> <code class="hljs markdown"><code><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code></code> <div class="spoiler"> <code class="hljs markdown"><code><b class="spoiler_title"><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br>  : # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main() </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</b></code></code> <div class="spoiler_text"> <code class="hljs markdown"><code class="xml">   executable, . .: <br> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">point</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"xbmc.python.script"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">library</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"default.py"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>executable<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">provides</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <code><a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           <span class="hljs-strong"><span class="hljs-strong">____</span></span>,      . <br> <br> <b class="spoiler_title"> :</b> # -<span class="hljs-emphasis"><span class="hljs-emphasis">*- coding: utf-8 -*</span></span>- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME = 'plugin.video.cnet' <span class="hljs-emphasis"><span class="hljs-emphasis">_addon = xbmcaddon.Addon(id=_</span></span>ADDON<span class="hljs-emphasis"><span class="hljs-emphasis">_NAME) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id = int(sys.argv[1]) _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url = sys.argv[0] _</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_path = _</span></span>addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'lib')) import feeds #       def <span class="hljs-emphasis"><span class="hljs-emphasis">_string(string_</span></span>id): return <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getLocalizedString(string_</span></span>id).encode('utf-8') #  URL-encoded    def get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name(): paramstring = sys.argv[<span class="hljs-string"><span class="hljs-string">2</span></span>] if paramstring: feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_</span></span>name = '' return feed<span class="hljs-emphasis"><span class="hljs-emphasis">_name #  RSS- def rss_</span></span>parser(url): listing = [<span class="hljs-string"></span><span class="hljs-string"></span>] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[<span class="hljs-string"><span class="hljs-string">2:</span></span>], links[<span class="hljs-string"><span class="hljs-string">2:</span></span>]): title = title.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="xml"><span class="xml">&lt;![CDATA[', '').replace(']]&gt;</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">title</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') link = link.toxml().replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '').replace('<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>', '') listing.append([<span class="hljs-string"><span class="hljs-string">title, link</span></span>]) return listing #      ( ). def feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_</span></span>item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item.setProperty('fanart_</span></span>image', fanart) # URL,        . url = addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_</span></span>id, url, list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_</span></span>id, xbmcplugin.SORT<span class="hljs-emphasis"><span class="hljs-emphasis">_METHOD_</span></span>LABEL<span class="hljs-emphasis"><span class="hljs-emphasis">_IGNORE_</span></span>THE) #   xbmcplugin.endOfDirectory(addon<span class="hljs-emphasis"><span class="hljs-emphasis">_id) #    . switch_</span></span>view() #         . def switch<span class="hljs-emphasis"><span class="hljs-emphasis">_view(): skin_</span></span>used = xbmc.getSkinDir() if skin<span class="hljs-emphasis"><span class="hljs-emphasis">_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_</span></span>used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id, fanart, thumb, listing): for item in listing: #   . list<span class="hljs-emphasis"><span class="hljs-emphasis">_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_</span></span>item.setProperty('fanart<span class="hljs-emphasis"><span class="hljs-emphasis">_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_</span></span>id, item[<span class="hljs-string"><span class="hljs-string">1</span></span>], list<span class="hljs-emphasis"><span class="hljs-emphasis">_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_</span></span>id) def main(): #   . thumbpath = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'resources', 'thumbnails') fanart = os.path.join(<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>path, 'fanart.jpg') #        . feed = get<span class="hljs-emphasis"><span class="hljs-emphasis">_feed_</span></span>name() #      XBMC ( ),     . if feed: #       . quality = <span class="hljs-emphasis"><span class="hljs-emphasis">_addon.getSetting('quality') #   . listing = rss_</span></span>parser(url=feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">quality</span></span>]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[<span class="hljs-string"><span class="hljs-string">feed</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'thumb'</span></span>]) #   . podcast<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (<span class="hljs-emphasis"><span class="hljs-emphasis">_string(100501), _</span></span>string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % <span class="hljs-emphasis"><span class="hljs-emphasis">_ADDON_</span></span>NAME, xbmc.LOGNOTICE) #     . feed<span class="hljs-emphasis"><span class="hljs-emphasis">_list(addon_</span></span>id=<span class="hljs-emphasis"><span class="hljs-emphasis">_addon_</span></span>id, addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url=_</span></span>addon<span class="hljs-emphasis"><span class="hljs-emphasis">_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_name_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ == '_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_main_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_': main()</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  : </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 11:   .      ,   addon.xml,    (      ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 12:    Addon     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_file_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_)   ,  os.getcwd()   . ,  ,     ,  XBMC. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî </span></span><a href="http://www.cnet.com/podcasts"><span class="hljs-emphasis"><span class="hljs-emphasis">www.cnet.com/podcasts</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ‚Äî     ,     ‚Äî ,     ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :            ,     .         URL,   plugin://. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 52‚Äî64:       cnet.com ‚Äî  ,   .   . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 59:     .  ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 61:      .            . ,            . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 65:   .   ,         ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 67:  XBMC,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  ,      .       ‚Äî  Youtube. </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> 80‚Äî89:    ,      .     ,    feed_</span></span>list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         <span class="hljs-emphasis"><span class="hljs-emphasis">_string(),        XBMC.     . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> \resources </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">  \resources ‚Äî ,        . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><b class="spoiler_title"><span class="hljs-emphasis"><span class="hljs-emphasis"> :</span></span></b><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><code class="xml"><span class="hljs-emphasis"><span class="hljs-emphasis">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</span></span></code><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis"> </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">     settings.xml         ¬´ </span></span><a href="http://yadi.sk/d/NvfFuXYw92paL"><span class="hljs-emphasis"><span class="hljs-emphasis">XBMC Addon Developers Guide</span></span></a><span class="hljs-emphasis"><span class="hljs-emphasis"> ¬ª ( ).       ,       ,         . </span></span><br><span class="hljs-emphasis"><span class="hljs-emphasis">        XML   \userdata\addon_</span></span>data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code> </div></div></pre> <code><code class="xml">   executable, . .: <br> &lt;extension point="xbmc.python.script" library="default.py"&gt; &lt;provides&gt;executable&lt;/provides&gt; &lt;/extension&gt;</code> <br>      ¬´¬ª. -       ¬´¬ª, ¬´¬ª  ¬´¬ª (video, music  image   <code><a href="http://wiki.xbmc.org/index.php%3Ftitle%3DAddon.xml"></a> <code class="python">),       -    ,     runtime- (  ). <br> <br>        . <br> <br>  16‚Äî22         .      XBMC.   23 ,      . <br> <br></code> icon.png <br> icon.png ‚Äî     () ,     XBMC.   ‚Äî PNG 256x256           . <br> <br> fanart.jpg <br> fanart.jpg ‚Äî     (),         .   ‚Äî JPG 1280x720 . :         (). ,  ¬´¬ª , /  . <br> <br> changelog.txt <br>   changelog.txt       . <br> <br> License.txt <br>  License.txt    .    ,       .  ,    ,          XBMC. <br> <br> default.py <br>  default.py ‚Äî   .   ¬´default.py¬ª  ,         (   library=   extension),    default.py, ‚Äî ,  . <br>      -  PEP 8,   ,           ____,      . <br> <br> <b class="spoiler_title"> :</b> # -*- coding: utf-8 -*- # Name: plugin.video.cnet # Licence: GPL v.3: http://www.gnu.org/copyleft/gpl.html #      import sys, os, urllib2, socket, xml.dom.minidom #    XBMC import xbmc, xbmcplugin, xbmcaddon, xbmcgui #    _ADDON_NAME = 'plugin.video.cnet' _addon = xbmcaddon.Addon(id=_ADDON_NAME) _addon_id = int(sys.argv[1]) _addon_url = sys.argv[0] _addon_path = _addon.getAddonInfo('path').decode('utf-8') #    sys.path.append(os.path.join(_addon_path, 'resources', 'lib')) import feeds #       def _string(string_id): return _addon.getLocalizedString(string_id).encode('utf-8') #  URL-encoded    def get_feed_name(): paramstring = sys.argv[2] if paramstring: feed_name = feeds.NAMES[paramstring.replace('?feed=', '')] else: feed_name = '' return feed_name #  RSS- def rss_parser(url): listing = [] try: HEADER = {'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:18.0) Gecko/20100101 Firefox/20.0'} request = urllib2.Request(url, None, HEADER) rss = xml.dom.minidom.parse(urllib2.urlopen(request, None, 3)) except urllib2.URLError, socket.timeout: pass else: titles = rss.getElementsByTagName('title') links = rss.getElementsByTagName('link') for title, link in zip(titles[2:], links[2:]): title = title.toxml().replace('&lt;title&gt;&lt;![CDATA[', '').replace(']]&gt;&lt;/title&gt;', '') link = link.toxml().replace('&lt;link&gt;', '').replace('&lt;/link&gt;', '') listing.append([title, link]) return listing #      ( ). def feed_list(addon_id, addon_url, fanart, thumbpath, feeds): names = dict.keys(feeds) for name in names: thumb = os.path.join(thumbpath, feeds[name]['thumb']) #   . list_item = xbmcgui.ListItem(name, thumbnailImage=thumb) #  . . list_item.setProperty('fanart_image', fanart) # URL,        . url = addon_url + '?feed=' + name.replace(' ', '').replace('*', '') #     . isFolder=True ,    (). xbmcplugin.addDirectoryItem(addon_id, url, list_item, isFolder=True) #   --  ,  . xbmcplugin.addSortMethod(addon_id, xbmcplugin.SORT_METHOD_LABEL_IGNORE_THE) #   xbmcplugin.endOfDirectory(addon_id) #    . switch_view() #         . def switch_view(): skin_used = xbmc.getSkinDir() if skin_used == 'skin.confluence': xbmc.executebuiltin('Container.SetViewMode(500)') #  "". elif skin_used == 'skin.aeon.nox': xbmc.executebuiltin('Container.SetViewMode(512)') #  "-" #   . def podcast_list(addon_id, fanart, thumb, listing): for item in listing: #   . list_item = xbmcgui.ListItem(item[0], thumbnailImage=thumb) #  . . list_item.setProperty('fanart_image', fanart) #    . isFolder=False ,     . xbmcplugin.addDirectoryItem(addon_id, item[1], list_item, isFolder=False) #  . xbmcplugin.endOfDirectory(addon_id) def main(): #   . thumbpath = os.path.join(_addon_path, 'resources', 'thumbnails') fanart = os.path.join(_addon_path, 'fanart.jpg') #        . feed = get_feed_name() #      XBMC ( ),     . if feed: #       . quality = _addon.getSetting('quality') #   . listing = rss_parser(url=feeds.FEEDS[feed][quality]) if listing: #   . xbmc.log('%s: Started - Opening podcasts List' % _ADDON_NAME, xbmc.LOGNOTICE) thumb = os.path.join(thumbpath, feeds.FEEDS[feed]['thumb']) #   . podcast_list(addon_id=_addon_id, fanart=fanart, thumb=thumb, listing=listing) else: #      ( ),      xbmc.log('%s: Failed to retrieve %s feed data!' % (_ADDON_NAME, feed), xbmc.LOGERROR) #        XBMC. xbmc.executebuiltin('Notification(%s,%s)' % (_string(100501), _string(100502))) else: #     XBMC ( ),     , xbmc.log('%s: Started - Opening feeds List' % _ADDON_NAME, xbmc.LOGNOTICE) #     . feed_list(addon_id=_addon_id, addon_url=_addon_url, fanart=fanart, thumbpath=thumbpath, feeds=feeds.FEEDS) if __name__ == '__main__': main()</code> <br> <br>   .   . <br> <br>  11‚Äî15 ‚Äî   .        ,      , ,   ,    PEP 8. <br> <br>  : <br> <br> 11:   .      ,   addon.xml,    (      ). <br> <br> 12:    Addon     . <br> <br> 13:  runtime-  (handle).  ‚Äî   ,    2-      XBMC.            addDirectoryItem().        .    ,   -   -   ,   -    () ,                 XBMC API.      ,  .     XBMC       (  ) -  3    sys.argv:   URL, runtime- (,   ),       URL-encoded . -,   ,    ,    sys.argv    .    ,  runtime-    ,  addDirectoryItem(),  -   .   URL     . <br> <br> 14:   URL .  URL      ''plugin://'' + ( ) + ''/''.  URL     : "plugin://plugin.video.cnet/".  URL        (   )   ,  .  , ,   , XBMC  ,    ( ‚Äî )        . ,  ,   . <br>   (),  ,         .  ,       ¬´¬ª, ¬´¬ª  ¬´¬ª XBMC    ¬´ ¬ª,      ,         ,  .            -  ,      ‚Äî    ,   ‚Äî   ,    . ,    (- ) ‚Äî                XBMC.    ¬´¬ª ,               (  ) .           .  addDirectoryItem()        ,    .    . <br> <br> 15:  getAddonInfo('path')     ,    , ,      ,     .       :  Windows,       (   ,   ASCII),     ,            (exeption).    ,    Windows   .        decode('utf-8').  ,     ,           Windows. <br>   getAddonInfo('path') ‚Äî    (   XBMC)    .  os.path.dirname(__file__)   ,  os.getcwd()   . ,  ,     ,  XBMC. <br> <br> 18‚Äî19:    feeds   /resources/lib.      cnet.com,  URL        (dictionary). , ,      ‚Äî <a href="http://www.cnet.com/podcasts">www.cnet.com/podcasts</a> ‚Äî     ,     ‚Äî ,     ,        . <br> <br> 22‚Äî23:      .  .getLocalizedString()         ,           UTF-8.     ,  ,  ,   ,     . <br> <br> 26‚Äî32: -      URL-encoded .       - ,   .    ,       XBMC              URL-encoded .          URL     (. )  URL-encoded   . <br>   . ,     plugin.video.acme,        ,   ,        .      ¬´Action¬ª  ¬´Movies¬ª    plugin://plugin.video.acme/?=Movies&amp;=Action.      addDirectoryItem      (   ). ,           plugin.video.acme,    sys.argv[2]    ¬´?=Movies&amp;=Action¬ª.   ,        ,  ,    :   XBMC  .    XBMC       (,    ),    , ,      (,     ¬´Action¬ª  ¬´Movies¬ª).        . <br> :            ,     .         URL,   plugin://. <br> :             xbmcplugin.addDirectoryItem,    -  ,  isFolder=False.  isFolder=True XBMC    ,       . <br> <br> 35‚Äî49:  RSS-     .      XML   - .         ,      -            (, , ). <br> <br> 52‚Äî64:       cnet.com ‚Äî  ,   .   . <br> <br> 57:          xbmcgui.ListItem.           ,   .    ,  ,  ,          ()   (). <br> <br> 59:     .  ,       ,         . <br> <br> 61:      .            . ,            . <br> <br> 63:      .      ,   sys.argv[1]. ,      - . ,       addDirectoryItem()  .  isFolder=True  XBMC,     ‚Äî  , . .         ,       .   url      ,  ,                 . <br> <br> 65:   .   ,         ,    . <br> <br> 67:  XBMC,    . <br> <br> 69:     ().   ,  ,      ( ,  ),         ,   ,     ,     .  Container.SetViewMode()          ,      MyVideoNav.xml, MyMusicNav.xml  MyPics.xml    ,    . <br>  ,      .       ‚Äî  Youtube. <br> <br> 72‚Äî77:    .         .  500   ¬´¬ª   Confluence,   512 ‚Äî  ¬´-¬ª  ¬´Aeon-Nox¬ª.         . <br> <br> 80‚Äî89:    ,      .     ,    feed_list(),   ,  URL           isFolder     False, . .    (  )  ,   . <br> :    isFolder=False        ,          ,      xbmcplugin.addDirectoryItem. ,             (     ).  xbmcplugin.addDirectoryItem  . <br> <br> 92‚Äî119:   . ,     .        . <br> <br> 101:    ,     .       ,       ,  . <br> <br> 114:       XBMC.         _string(),        XBMC.     . <br> <br> \resources <br>  \resources ‚Äî ,        . <br> <br> settings.xml <br> settings.xml ‚Äî  ,     ,   XML,    ,      ¬´¬ª.         ¬´¬ª    . <br> <br> <b class="spoiler_title"> :</b> <code class="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;settings&gt; &lt;category label="128"&gt; &lt;setting id="quality" type="labelenum" label="100500" values="HD|SD" default="HD" /&gt; &lt;/category&gt; &lt;/settings&gt;</code> <br> <br>          ‚Äî  (labelenum)      (HD  SD).  label=      ,        ,       .           id="" (.  101 default.py). <br>     settings.xml         ¬´ <a href="http://yadi.sk/d/NvfFuXYw92paL">XBMC Addon Developers Guide</a> ¬ª ( ).       ,       ,         . <br>        XML   \userdata\addon_data\     XBMC.  Windows ,  , %AppData%\XBMC,  Linux ‚Äî $HOME/.xbmc. <br> <br> \language <br>  \language  .  ,    ,  ,     ,     strings.po.      \English, \Russian  \Ukrainian, . .     ,    . ,   ,      \English    . ,          ,     . <br> <br> <b class="spoiler_title">    strings.po:</b> <code class="bash"># XBMC Media Center language file msgid "" msgstr "" "Content-Type: text/plain; charset=UTF-8\n" "Content-Transfer-Encoding: 8bit\n" "Language: ru\n" msgctxt "#100500" msgid "Quality:" msgstr ":" msgctxt "#100501" msgid "Access error!" msgstr " !" msgctxt "#100502" msgid "Failed to retrieve the feed data." msgstr "     ."</code> <br> <br>  ,    .po GNU Gettext.  XBMC    Gettext:      .mo,        ,    msgctxt.     :  XBMC        XML,        <a href="http://www.transifex.net/">www.transifex.net</a>          . -,        .po   ,     Gettext. <br>    ,     getLocalizedString()    msgctxt.     :    XBMC +   . ,          .  ,           , ,  ,   ,      .        . <br>        <a href="http://kodi.wiki/view/Language_support"></a> ,      . ,      . <br>                ,         settings.xml      . <br>  ,            XBMC,         .              . <br> <br> \lib <br>   \lib     ,   .  \lib  .     ,        :     ,      . . ,      . ,  , ,     ,  ,   ,    . <br> <br> \thumbnails <br>   \thumbnails      cnet.com.   \lib,    ,           . <br> <br>  <br>     .         XBMC.        (    XBMC   "  ").           print   xbmc.log(). <br>        XBMC. <br>  , XBMC      Eclipse + PyDev.      <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DHOW-TO:Debug_Python_Scripts_with_Eclipse"></a> . <br> <br>  <br>        XBMC .    ,     ,    .        ¬´¬ª   . <br>   ,     ,    ,      . <br> <br>   <br> ,   ,   Wiki XBMC: <a href="http://wiki.xbmc.org/index.php%3Ftitle%3DCategory:Addon_Development">http://wiki.xbmc.org/index.php?title=Category:Addon_Development</a> <br>  ¬´XBMC Addon Developers Guide¬ª: <a href="http://yadi.sk/d/NvfFuXYw92paL">yadi.sk/d/NvfFuXYw92paL</a> <br>     XBMC Python API: <a href="http://mirrors.xbmc.org/docs/python-docs">mirrors.xbmc.org/docs/python-docs</a> <br> <br> PS <br> Post factum   .       .   XBMC     ,      .          . <br> <br>  <br> <a href="http://habrahabr.ru/post/193704/">   XBMC   :  I ‚Äî    </a> .</code> </div><p>Source: <a href="https://habr.com/ru/post/193374/">https://habr.com/ru/post/193374/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193364/index.html">Our bicycle startup</a></li>
<li><a href="../193366/index.html">Build a career in a large organization. Tips & tricks</a></li>
<li><a href="../193368/index.html">7 ways to improve the design process of responsive design</a></li>
<li><a href="../193370/index.html">Run LendWings. Part 1. Belarusian swamp</a></li>
<li><a href="../193372/index.html">Methods for determining the location of the user</a></li>
<li><a href="../193376/index.html">Google Apps script: getting data from Flurry</a></li>
<li><a href="../193378/index.html">Installing and configuring TeamSpeak 3 servers on VDS</a></li>
<li><a href="../193380/index.html">Guide to designing relational databases (7-9 part of 15) [translation]</a></li>
<li><a href="../193382/index.html">Intel announced Quark, the processor for the "Internet of things"</a></li>
<li><a href="../193384/index.html">Eleven for Skype: now do not need to record anything</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>