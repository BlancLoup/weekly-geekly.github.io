<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with sound and library SuperPowered</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have a task: I need to develop an application that will record from a microphone, then change (accelerate or pitch shifting), save the effect in the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with sound and library SuperPowered</h1><div class="post__text post__text-html js-mediator-article">  I have a task: I need to develop an application that will record from a microphone, then change (accelerate or pitch shifting), save the effect in the file itself and send the resulting MP3 file to the application server.  This task turns out to be complex.  And also min-sdk = 9 want. <br><a name="habracut"></a>  To record sound, so that it is simpler, the <a href="http://developer.android.com/reference/android/media/MediaPlayer.html">MediaPlayer</a> class suggests itself from the start.  Writes from the microphone, while immediately compressed, AAS for example.  For reference (if suddenly someone does not know): the MP3 encoder in Android is not;  there litsuha commercial, but there is only <b>de</b> encoder MP3, respectively.  can not be recorded immediately in MP3, but you can only play, for which a decoder is needed. <br>  Everything would be fine, but only in order to be able to do something with sound, namely, to impose any effect, it is required to record it in its original, so to speak, form, i.e.  not compressed to MP3 or AAC, namely in PCM / WAVE format.  And besides, when playing it is necessary to ‚Äúdisplay‚Äù the overlapping effect in real time so that you can adjust it by ear.  And for this, the MediaPlayer class is no longer suitable, since  he writes only in compressed form, and to impose acceleration when playing is an intractable, given the minimum KFOR.  Modzhno add yourself work: record in MediaPlayer in AAC, for example, and then unpack AAC to PCM / WAVE, which is not provided in Android and therefore will also have to look for a solution.  And again: once again put the battery on the process of unpacking, which is greedy for computing resources, against writing down the option immediately uncompressed, well, the user will not like to spend his valuable time on this process (he may not know why, he will have to wait) . <br>  From all this it follows that the recording should be carried out using a bunch of other classes: <a href="http://developer.android.com/reference/android/media/AudioRecord.html">AudioRecord</a> - he writes, and <a href="http://developer.android.com/reference/android/media/AudioTrack.html">AudioTrack</a> - and reproduces and acceleration on it is not a problem during playback. <br>  However, in practice, with these classes of problems is also enough.  Firstly: AudioRecord writes PCM data right away, I need it, but it doesn‚Äôt create the WAVE header itself, i.e.  he writes RAW PCM, and then somehow this data can be used not only in AudioTrack, you need to add code to create this header;  plus you should not forget to skip the first 44 bytes (header size) when playing, so that AudioTrack does not try to play them.  Secondly: all the gestures on recording and playback should be carried out in separate streams, which does not simplify the development. <br>  However, I will give an example of a separate recorder based on AudioRecord, since for the most part it is still not mine, but copied from the depths of SO (includes creating a header and can be useful to someone): <br><div class="spoiler">  <b class="spoiler_title">Audiorecorder</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.annotation.SuppressLint; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.AudioFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.AudioRecord; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.MediaRecorder; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.stanko.tools.DeviceInfo; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.stanko.tools.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.RandomAccessFile; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioRecorder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * INITIALIZING : recorder is initializing; * READY : recorder has been initialized, recorder not yet started * RECORDING : recording * ERROR : reconstruction needed * STOPPED: reset needed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> State {INITIALIZING, READY, RECORDING, ERROR, STOPPED}; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> RECORDING_UNCOMPRESSED = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> RECORDING_COMPRESSED = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">// The interval in which the recorded samples are output to the file // Used only in uncompressed mode private static final int TIMER_INTERVAL = 120; // Toggles uncompressed recording on/off; RECORDING_UNCOMPRESSED / RECORDING_COMPRESSED private boolean isUncompressed; // Recorder used for uncompressed recording private AudioRecord mAudioRecorder = null; // Recorder used for compressed recording private MediaRecorder mMediaRecorder = null; // Stores current amplitude (only in uncompressed mode) private int cAmplitude= 0; // Output file path private String mFilePath = null; // Recorder state; see State private State state; // File writer (only in uncompressed mode) private RandomAccessFile mFileWriter; // Number of channels, sample rate, sample size(size in bits), buffer size, audio source, sample size(see AudioFormat) private short nChannels; private int nRate; private short nSamples; private int nBufferSize; private int nSource; private int nFormat; // Number of frames written to file on each output(only in uncompressed mode) private int nFramePeriod; // Buffer for output(only in uncompressed mode) private byte[] mBuffer; // Number of bytes written to file after header(only in uncompressed mode) // after stop() is called, this size is written to the header/data chunk in the wave file private int nPayloadSize; /** * * Returns the state of the recorder in a RehearsalAudioRecord.State typed object. * Useful, as no exceptions are thrown. * * @return recorder state */ public State getState() { return state; } /* * * Method used for recording. * */ private AudioRecord.OnRecordPositionUpdateListener updateListener = new AudioRecord.OnRecordPositionUpdateListener() { public void onPeriodicNotification(AudioRecord recorder) { mAudioRecorder.read(mBuffer, 0, mBuffer.length); // Fill buffer try { mFileWriter.write(mBuffer); // Write buffer to file nPayloadSize += mBuffer.length; if (nSamples == 16) { for (int i=0; i&lt;mBuffer.length/2; i++) { // 16bit sample size short curSample = getShort(mBuffer[i*2], mBuffer[i*2+1]); if (curSample &gt; cAmplitude) { // Check amplitude cAmplitude = curSample; } } } else { // 8bit sample size for (int i=0; i&lt;mBuffer.length; i++) { if (mBuffer[i] &gt; cAmplitude) { // Check amplitude cAmplitude = mBuffer[i]; } } } } catch (IOException e) { Log.e(this, "Error occured in updateListener, recording is aborted"); stop(); } } public void onMarkerReached(AudioRecord recorder) { // NOT USED } }; /** * * * Default constructor * * Instantiates a new recorder, in case of compressed recording the parameters can be left as 0. * In case of errors, no exception is thrown, but the state is set to ERROR * */ @SuppressLint("InlinedApi") public AudioRecorder(boolean uncompressed, int audioSource, int sampleRate, int channelConfig, int audioFormat) { try { isUncompressed = uncompressed; if (isUncompressed) { // RECORDING_UNCOMPRESSED if (audioFormat == AudioFormat.ENCODING_PCM_16BIT) { nSamples = 16; } else { nSamples = 8; } if (channelConfig == AudioFormat.CHANNEL_IN_MONO) { nChannels = 1; } else { nChannels = 2; } nSource = audioSource; nRate = sampleRate; nFormat = audioFormat; nFramePeriod = sampleRate * TIMER_INTERVAL / 1000; nBufferSize = nFramePeriod * 2 * nSamples * nChannels / 8; if (nBufferSize &lt; AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat)) { // Check to make sure buffer size is not smaller than the smallest allowed one nBufferSize = AudioRecord.getMinBufferSize(sampleRate, channelConfig, audioFormat); // Set frame period and timer interval accordingly nFramePeriod = nBufferSize / ( 2 * nSamples * nChannels / 8 ); Log.w(this, "Increasing buffer size to " + Integer.toString(nBufferSize)); } mAudioRecorder = new AudioRecord(audioSource, sampleRate, channelConfig, audioFormat, nBufferSize); if (mAudioRecorder.getState() != AudioRecord.STATE_INITIALIZED) throw new Exception("AudioRecord initialization failed"); mAudioRecorder.setRecordPositionUpdateListener(updateListener); mAudioRecorder.setPositionNotificationPeriod(nFramePeriod); } else { // RECORDING_COMPRESSED mMediaRecorder = new MediaRecorder(); mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC); mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.MPEG_4); if (DeviceInfo.hasAPI10()) mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AAC); else mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.DEFAULT); } cAmplitude = 0; mFilePath = null; state = State.INITIALIZING; } catch (Exception e) { if (e.getMessage() != null) { Log.e(this, e.getMessage()); } else { Log.e(this, "Unknown error occured while initializing recording"); } state = State.ERROR; } } /** * Sets output file path, call directly after construction/reset. * * @param output file path * */ public void setOutputFile(File file){ setOutputFile(file.getAbsolutePath()); } public void setOutputFile(String argPath) { try { if (state == State.INITIALIZING) { mFilePath = argPath; if (!isUncompressed) { mMediaRecorder.setOutputFile(mFilePath); } } } catch (Exception e) { if (e.getMessage() != null) { Log.e(this, e.getMessage()); } else { Log.e(this, "Unknown error occured while setting output path"); } state = State.ERROR; } } /** * * Returns the largest amplitude sampled since the last call to this method. * * @return returns the largest amplitude since the last call, or 0 when not in recording state. * */ public int getMaxAmplitude() { if (state == State.RECORDING) { if (isUncompressed) { int result = cAmplitude; cAmplitude = 0; return result; } else { try { return mMediaRecorder.getMaxAmplitude(); } catch (IllegalStateException e) { return 0; } } } else { return 0; } } /** * * Prepares the recorder for recording, in case the recorder is not in the INITIALIZING state and the file path was not set * the recorder is set to the ERROR state, which makes a reconstruction necessary. * In case uncompressed recording is toggled, the header of the wave file is written. * In case of an exception, the state is changed to ERROR * */ public void prepare() { try { if (state == State.INITIALIZING) { if (isUncompressed) { if ((mAudioRecorder.getState() == AudioRecord.STATE_INITIALIZED) &amp; (mFilePath != null)) { // write file header Log.w(this,"prepare(): nRate: "+nRate+" nChannels: "+nChannels); mFileWriter = new RandomAccessFile(mFilePath, "rw"); mFileWriter.setLength(0); // Set file length to 0, to prevent unexpected behavior in case the file already existed mFileWriter.writeBytes("RIFF"); // 4 mFileWriter.writeInt(0); // 4 Final file size not known yet, write 0 mFileWriter.writeBytes("WAVE"); // 4 mFileWriter.writeBytes("fmt "); // 4 mFileWriter.writeInt(Integer.reverseBytes(16)); // 4 Sub-chunk size, 16 for PCM mFileWriter.writeShort(Short.reverseBytes((short) 1)); // 2 AudioFormat, 1 for PCM mFileWriter.writeShort(Short.reverseBytes(nChannels)); // 2 Number of channels, 1 for mono, 2 for stereo mFileWriter.writeInt(Integer.reverseBytes(nRate)); // 4 Sample rate mFileWriter.writeInt(Integer.reverseBytes(nRate*nSamples*nChannels/8)); // 4 Byte rate, SampleRate*NumberOfChannels*BitsPerSample/8 mFileWriter.writeShort(Short.reverseBytes((short)(nChannels*nSamples/8))); // 2 Block align, NumberOfChannels*BitsPerSample/8 mFileWriter.writeShort(Short.reverseBytes(nSamples)); // 2 Bits per sample mFileWriter.writeBytes("data"); // 4 mFileWriter.writeInt(0); // 4 Data chunk size not known yet, write 0 mBuffer = new byte[nFramePeriod*nSamples/8*nChannels]; state = State.READY; } else { Log.e(this, "prepare() method called on uninitialized recorder"); state = State.ERROR; } } else { mMediaRecorder.prepare(); state = State.READY; } } else { Log.e(this, "prepare() method called on illegal state"); release(); state = State.ERROR; } } catch(Exception e) { if (e.getMessage() != null) { Log.e(this, e.getMessage()); } else { Log.e(this, "Unknown error occured in prepare()"); } state = State.ERROR; } } /** * * * Releases the resources associated with this class, and removes the unnecessary files, when necessary * */ public void release() { if (state == State.RECORDING) { stop(); } else { if ((state == State.READY) &amp; (isUncompressed)) { try { mFileWriter.close(); // Remove prepared file } catch (IOException e) { Log.e(this, "I/O exception occured while closing output file"); } (new File(mFilePath)).delete(); } } if (isUncompressed) { if (mAudioRecorder != null) { mAudioRecorder.release(); } } else { if (mMediaRecorder != null) { mMediaRecorder.release(); } } } /** * * * Resets the recorder to the INITIALIZING state, as if it was just created. * In case the class was in RECORDING state, the recording is stopped. * In case of exceptions the class is set to the ERROR state. * */ public void reset() { try { if (state != State.ERROR) { release(); mFilePath = null; // Reset file path cAmplitude = 0; // Reset amplitude if (isUncompressed) { mAudioRecorder = new AudioRecord(nSource, nRate, nChannels+1, nFormat, nBufferSize); } else { mMediaRecorder = new MediaRecorder(); mMediaRecorder.setAudioSource(MediaRecorder.AudioSource.MIC); mMediaRecorder.setOutputFormat(MediaRecorder.OutputFormat.THREE_GPP); mMediaRecorder.setAudioEncoder(MediaRecorder.AudioEncoder.AMR_NB); } state = State.INITIALIZING; } } catch (Exception e) { Log.e(this, e.getMessage()); state = State.ERROR; } } /** * * * Starts the recording, and sets the state to RECORDING. * Call after prepare(). * */ public void start() { if (state == State.READY) { if (isUncompressed) { nPayloadSize = 0; mAudioRecorder.startRecording(); mAudioRecorder.read(mBuffer, 0, mBuffer.length); } else { mMediaRecorder.start(); } state = State.RECORDING; } else { Log.e(this, "start() called on illegal state"); state = State.ERROR; } } /** * * * Stops the recording, and sets the state to STOPPED. * In case of further usage, a reset is needed. * Also finalizes the wave file in case of uncompressed recording. * */ public void stop() { if (state == State.RECORDING) { if (isUncompressed) { mAudioRecorder.stop(); mAudioRecorder.setRecordPositionUpdateListener(null); try { mFileWriter.seek(4); // Write size to RIFF header mFileWriter.writeInt(Integer.reverseBytes(36+nPayloadSize)); mFileWriter.seek(40); // Write size to Subchunk2Size field mFileWriter.writeInt(Integer.reverseBytes(nPayloadSize)); mFileWriter.close(); Log.w(this, "Recording stopped successfully"); } catch(IOException e) { Log.e(this, "I/O exception occured while closing output file"); state = State.ERROR; } } else { mMediaRecorder.stop(); } state = State.STOPPED; } else { Log.e(this, "stop() called on illegal state"); state = State.ERROR; } } /* * * Converts a byte[2] to a short, in LITTLE_ENDIAN format * */ private short getShort(byte argB1, byte argB2) { return (short)(argB1 | (argB2 &lt;&lt; 8)); } }</span></span></code> </pre> </div></div><br>  Example of use when recording: <br><div class="spoiler">  <b class="spoiler_title">Audiothread</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/* * Thread to manage live recording/playback of voice input from the device's microphone. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] sampleRates = {<span class="hljs-number"><span class="hljs-number">44100</span></span>, <span class="hljs-number"><span class="hljs-number">22050</span></span>, <span class="hljs-number"><span class="hljs-number">16000</span></span>, <span class="hljs-number"><span class="hljs-number">11025</span></span>, <span class="hljs-number"><span class="hljs-number">8000</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> usedSampleRate; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AudioThread</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Thread</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> File targetFile; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"AudioThread"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Give the thread high priority so that it's not canceled unexpectedly, and start it */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AudioThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> File file)</span></span></span><span class="hljs-function"> </span></span>{ targetFile = file; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Log.i(TAG, <span class="hljs-string"><span class="hljs-string">"Running Audio Thread"</span></span>); Looper.prepare(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { usedSampleRate = sampleRates[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (audioRecorder != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) audioRecorder.release(); audioRecorder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioRecorder(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, AudioSource.MIC, usedSampleRate, AudioFormat.CHANNEL_IN_MONO, AudioFormat.ENCODING_PCM_16BIT); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((++i &lt; sampleRates.length) &amp;&amp; !(audioRecorder.getState() == AudioRecorder.State.INITIALIZING)); Log.i(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"usedSampleRate: "</span></span> + usedSampleRate + <span class="hljs-string"><span class="hljs-string">" setOutputFile: "</span></span> + targetFile); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { audioRecorder.setOutputFile(targetFile); <span class="hljs-comment"><span class="hljs-comment">// start the recording audioRecorder.prepare(); audioRecorder.start(); // if error occurred and thus recording is not started if (audioRecorder.getState() == AudioRecorder.State.ERROR) { Toast.makeText(getBaseContext(), "AudioRecorder error", Toast.LENGTH_SHORT).show(); } } catch (NullPointerException ignored){} // audioRecorder became null since it was canceled Looper.loop(); } }</span></span></code> </pre></div></div><br>  To play: <br><div class="spoiler">  <b class="spoiler_title">playerPlayUsingAudioTrack</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/* * Thread to manage playback of recorded message. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bufferSize; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> byteOffset; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fileLengh; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">playerPlayUsingAudioTrack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File messageFileWav)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (messageFileWav == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || !messageFileWav.exists() || !messageFileWav.canRead()) { Toast.makeText( getBaseContext(), <span class="hljs-string"><span class="hljs-string">"Audiofile error: exists(): "</span></span> + messageFileWav.exists() + <span class="hljs-string"><span class="hljs-string">" canRead(): "</span></span> + messageFileWav.canRead(), Toast.LENGTH_SHORT).show(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// is previous thread alive? if (audioTrackThread!=null){ audioTrackThread.isStopped = true; audioTrackThread = null; } bufferSize = AudioRecord.getMinBufferSize(sampleRate, AudioFormat.CHANNEL_IN_MONO, AudioFormat.ENCODING_PCM_16BIT) * 4; audioTrackThread = new StoppableThread(){ @Override public void run() { audioTrack = new AudioTrack( AudioManager.STREAM_MUSIC, sampleRate, AudioFormat.CHANNEL_OUT_MONO, AudioFormat.ENCODING_PCM_16BIT, bufferSize, AudioTrack.MODE_STREAM); fileLengh = (int) messageFileWav.length(); sbPlayerProgress.setMax(fileLengh / 2); int byteCount = 4 * 1024; // 4 kb final byte[] byteData = new byte[byteCount]; // Reading the file.. RandomAccessFile in = null; try { in = new RandomAccessFile(messageFileWav, "r"); int ret; byteOffset = 44; audioTrack.play(); isPaused = false; isPlayerPlaying = true; while (byteOffset &lt; fileLengh) { if (this.isStopped) break; if(isPlayerPaused || this.isPaused) continue; in.seek(byteOffset); ret = in. read(byteData, 0, byteCount); if (ret != -1) { // Write the byte array to the track audioTrack.write(byteData, 0, ret); audioTrack.setPlaybackRate(pitchValue); byteOffset += ret; } else break; } } catch (Exception e) { //IOException, FileNotFoundException, NPE for audioTrack e.printStackTrace(); } finally { if (in != null) try { in.close(); } catch (IOException ignored) { } } } }; audioTrackThread.start(); }</span></span></code> </pre></div></div><br>  In general, it turns out to record, reproduce - it turns out, the type of pitch effect is obtained - audioTrack.setPlaybackRate (pitchValue) - this variable is tied to my SeekBar and the user can change its value during playback and like to hear the effect.  It is not clear how to save the effect of the selected level in the file ... You need to see something on C / NDK to sculpt specialized. <br>  But in general there are surprises and besides this: who has acc.  experience, he knows that all sorts of devices from Samsung, HTC and other brands are not 100% generic Android compatible.  Each brand has its own ‚Äúimprovements‚Äù at the OS source level, because of which the code documented in Google will not work at all, or as expected, and this is especially related to the media, and therefore various kinds of crutches are required to be built for these devices. <br>  For example, on Samsung, problems with streaming audio playback, i.e.  using the MediaPlayer class and specifying an HTTP link to the MP3 file for the source (namely, the audio files uploaded to the application server are then planned to play), Samsung will play it randomly - then play, then not play, although any other devices with the same application source code and other identical conditions will always play normally, and the crutch consists in loading the file in parts in a separate stream and feeding it to playback as if it were a locally recorded file.  And Samsung, and, unlike others, was taught to swallow perfect pauses in MP3, well, when there is perfect silence (even the wave form is not drawn in the editor), they just skip them, which is why the 5-minute report is reproduced first unnatural, and secondly, the original duration is broken, for example, it‚Äôs not 5 minutes, but 4 or less (depending on the length of pauses between phrases).  No other devices do this.  Crutch: add white noise to pause. <br>  On some NTS models, there are problems with recording audio, when recording using the MediaPlayer works fine, but via AudioTrack it does not.  In fact, there is a problem with recording the accumulated buffer, just updateListener (see AudioRecoder code) does not work, on other devices this lisner works, but on the NTS - no, well, is it necessary to differ somehow?  Well, here it is.  A crutch can also be built here, but other problems will emerge + there are other problems on various other brands, for example, non-support of the 48 kHz or 44.1 kHz sampling rate or different combinations of recording settings, such as mono do not write, but only stereo, others .  In general, this topic in android is still a batthert and somehow I do not want to find all new incompatible devices and to fence all new crutches for them. <br>  The funny thing is that any Chinese smartphones, except, of course, brands like Meizu, will be more compatible with Android compared to market brands, because  they stupidly do not bother with customizing the OS, well, or they have no money for it. <br><br>  And so, once again, when looking for some more solutions on this subject, preferably very alternative, and not wrappers around the two classes mentioned (I have not mentioned SoundPool yet, but this class is simply not suitable for solving my problem due to its limitations ), I stumbled upon the <a href="http://superpowered.com/">SuperPowered</a> .  SKD is given for free, you just need to register, cross-platform, which is important, since I just need the application for both AOS and iOS. <br>  I looked at the demo video on the site, to put it mildly I was inspired (and in real life I was just as <s>crazy ofigel</s> ), I registered, downloaded KFOR and sample. <br>  The first thing I want to mention is AndroidStudio in the span, because  ‚ÄúSuddenly‚Äù the project turned out to be sharpened by the NDK and AS had problems with it, spending time on solving which I had absolutely no desire (well, I didn‚Äôt master AS to import the project normally).  Therefore, the project was opened in Eclipse without problems and without problems it was launched, since earlier I downloaded and installed the NDK (indicating the path to which the AS did not help much). <br>  Samlp I launched on the corpse, by today's standards - the NTS HD2 with MIUI installed on it with the bucket version 2.3.5.  The device in work shows itself to be still a brake even on completely lightweight devices, even on ordinary ones, where lists with pictures are simply displayed.  Antutu on it gives some completely ridiculous numbers and advises to throw it away, and after the next upgrade it generally stupidly hangs and hangs the phone so that you have to remove the battery.  For that on this device one can clearly see who knows about the existence of the ViewHolder, and who does not. <br>  So, this sample started on it without problems and works without even hints of lags!  Those.  I made sure that yes, this bibla is really Low Latency!  Yes, and the application itself is cool - you can feel like a DJ for a couple of minutes, I spent a week with him, ‚Äúas with a written sack,‚Äù rushing around with joy. <br>  However, having dug deeper, my joys subsided, because  I found that under Android there everything was limited to this sample, although for iOS there are much more examples, and in order to fully use this library, you have to write JNI yourself, which I don‚Äôt know and, in fact, I am writing this article with the goal that interested users will develop this topic.  I myself am not a sishnik, but in principle I added by analogy a few more effects to those three that are there, however, they add a little interesting things, but they work, plus a small fix added - when you go to the background and return to the sample, pad due to the fact that playback did not stop: <br><div class="spoiler">  <b class="spoiler_title">SuperpoweredExample.h</b> <div class="spoiler_text"><pre> <code class="hljs erlang-repl">#include <span class="hljs-string"><span class="hljs-string">"SuperpoweredExample.h"</span></span> #include &lt;jni.h&gt; #include &lt;stdlib.h&gt; #include &lt;stdio.h&gt; #include &lt;android/log.h&gt; static void playerEventCallbackA(void *clientData, SuperpoweredAdvancedAudioPlayerEvent event, void *value) { if (event == SuperpoweredAdvancedAudioPlayerEvent_LoadSuccess) { SuperpoweredAdvancedAudioPlayer *playerA = *((SuperpoweredAdvancedAudioPlayer **)clientData); playerA-&gt;setBpm(<span class="hljs-number"><span class="hljs-number">126.0</span></span>f); playerA-&gt;setFirstBeatMs(<span class="hljs-number"><span class="hljs-number">353</span></span>); playerA-&gt;setPosition(playerA-&gt;firstBeatMs, false, false); }; } static void playerEventCallbackB(void *clientData, SuperpoweredAdvancedAudioPlayerEvent event, void *value) { if (event == SuperpoweredAdvancedAudioPlayerEvent_LoadSuccess) { SuperpoweredAdvancedAudioPlayer *playerB = *((SuperpoweredAdvancedAudioPlayer **)clientData); playerB-&gt;setBpm(<span class="hljs-number"><span class="hljs-number">123.0</span></span>f); playerB-&gt;setFirstBeatMs(<span class="hljs-number"><span class="hljs-number">40</span></span>); playerB-&gt;setPosition(playerB-&gt;firstBeatMs, false, false); }; } static void openSLESCallback(SLAndroidSimpleBufferQueueItf caller, void *pContext) { ((SuperpoweredExample *)pContext)-&gt;process(caller); } static const SLboolean requireds[<span class="hljs-number"><span class="hljs-number">2</span></span>] = { SL_BOOLEAN_TRUE, SL_BOOLEAN_TRUE }; SuperpoweredExample::SuperpoweredExample(const char *path, int *params) : currentBuffer(<span class="hljs-number"><span class="hljs-number">0</span></span>), buffersize(params[<span class="hljs-number"><span class="hljs-number">5</span></span>]), activeFx(<span class="hljs-number"><span class="hljs-number">0</span></span>), crossValue(<span class="hljs-number"><span class="hljs-number">0.0</span></span>f), volB(<span class="hljs-number"><span class="hljs-number">0.0</span></span>f), volA(<span class="hljs-number"><span class="hljs-number">1.0</span></span>f * headroom) { pthread_mutex_init(&amp;mutex, NULL); // This will keep our player volumes and playback states in sync. for (int n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; NUM_BUFFERS; n++) outputBuffer[n] = (float *)memalign(<span class="hljs-number"><span class="hljs-number">16</span></span>, (buffersize + <span class="hljs-number"><span class="hljs-number">16</span></span>) * sizeof(float) * <span class="hljs-number"><span class="hljs-number">2</span></span>); unsigned int samplerate = params[<span class="hljs-number"><span class="hljs-number">4</span></span>]; playerA = new SuperpoweredAdvancedAudioPlayer(&amp;playerA , playerEventCallbackA, samplerate, <span class="hljs-number"><span class="hljs-number">0</span></span>); playerA-&gt;open(path, params[<span class="hljs-number"><span class="hljs-number">0</span></span>], params[<span class="hljs-number"><span class="hljs-number">1</span></span>]); playerB = new SuperpoweredAdvancedAudioPlayer(&amp;playerB, playerEventCallbackB, samplerate, <span class="hljs-number"><span class="hljs-number">0</span></span>); playerB-&gt;open(path, params[<span class="hljs-number"><span class="hljs-number">2</span></span>], params[<span class="hljs-number"><span class="hljs-number">3</span></span>]); playerA-&gt;syncMode = playerB-&gt;syncMode = SuperpoweredAdvancedAudioPlayerSyncMode_TempoAndBeat; roll = new SuperpoweredRoll(samplerate); filter = new SuperpoweredFilter(SuperpoweredFilter_Resonant_Lowpass, samplerate); flanger = new SuperpoweredFlanger(samplerate); whoosh = new SuperpoweredWhoosh(samplerate); gate = new SuperpoweredGate(samplerate); echo = new SuperpoweredEcho(samplerate); reverb = new SuperpoweredReverb(samplerate); //stretch = new SuperpoweredTimeStretching(samplerate); mixer = new SuperpoweredStereoMixer(); // Create the OpenSL ES engine. slCreateEngine(&amp;openSLEngine, <span class="hljs-number"><span class="hljs-number">0</span></span>, NULL, <span class="hljs-number"><span class="hljs-number">0</span></span>, NULL, NULL); (*openSLEngine)-&gt;Realize(openSLEngine, SL_BOOLEAN_FALSE); SLEngineItf openSLEngineInterface = NULL; (*openSLEngine)-&gt;GetInterface(openSLEngine, SL_IID_ENGINE, &amp;openSLEngineInterface); // Create the output mix. (*openSLEngineInterface)-&gt;CreateOutputMix(openSLEngineInterface, &amp;outputMix, <span class="hljs-number"><span class="hljs-number">0</span></span>, NULL, NULL); (*outputMix)-&gt;Realize(outputMix, SL_BOOLEAN_FALSE); SLDataLocator_OutputMix outputMixLocator = { SL_DATALOCATOR_OUTPUTMIX, outputMix }; // Create the buffer queue player. SLDataLocator_AndroidSimpleBufferQueue bufferPlayerLocator = { SL_DATALOCATOR_ANDROIDSIMPLEBUFFERQUEUE, NUM_BUFFERS }; SLDataFormat_PCM bufferPlayerFormat = { SL_DATAFORMAT_PCM, <span class="hljs-number"><span class="hljs-number">2</span></span>, samplerate * <span class="hljs-number"><span class="hljs-number">1000</span></span>, SL_PCMSAMPLEFORMAT_FIXED_16, SL_PCMSAMPLEFORMAT_FIXED_16, SL_SPEAKER_FRONT_LEFT | SL_SPEAKER_FRONT_RIGHT, SL_BYTEORDER_LITTLEENDIAN }; SLDataSource bufferPlayerSource = { &amp;bufferPlayerLocator, &amp;bufferPlayerFormat }; const SLInterfaceID bufferPlayerInterfaces[<span class="hljs-number"><span class="hljs-number">1</span></span>] = { SL_IID_BUFFERQUEUE }; SLDataSink bufferPlayerOutput = { &amp;outputMixLocator, NULL }; (*openSLEngineInterface)-&gt;CreateAudioPlayer(openSLEngineInterface, &amp;bufferPlayer, &amp;bufferPlayerSource, &amp;bufferPlayerOutput, <span class="hljs-number"><span class="hljs-number">1</span></span>, bufferPlayerInterfaces, requireds); (*bufferPlayer)-&gt;Realize(bufferPlayer, SL_BOOLEAN_FALSE); // Initialize and start the buffer queue. (*bufferPlayer)-&gt;GetInterface(bufferPlayer, SL_IID_BUFFERQUEUE, &amp;bufferQueue); (*bufferQueue)-&gt;RegisterCallback(bufferQueue, openSLESCallback, this); memset(outputBuffer[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, buffersize * <span class="hljs-number"><span class="hljs-number">4</span></span>); memset(outputBuffer[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, buffersize * <span class="hljs-number"><span class="hljs-number">4</span></span>); (*bufferQueue)-&gt;Enqueue(bufferQueue, outputBuffer[<span class="hljs-number"><span class="hljs-number">0</span></span>], buffersize * <span class="hljs-number"><span class="hljs-number">4</span></span>); (*bufferQueue)-&gt;Enqueue(bufferQueue, outputBuffer[<span class="hljs-number"><span class="hljs-number">1</span></span>], buffersize * <span class="hljs-number"><span class="hljs-number">4</span></span>); SLPlayItf bufferPlayerPlayInterface; (*bufferPlayer)-&gt;GetInterface(bufferPlayer, SL_IID_PLAY, &amp;bufferPlayerPlayInterface); (*bufferPlayerPlayInterface)-&gt;SetPlayState(bufferPlayerPlayInterface, SL_PLAYSTATE_PLAYING); } SuperpoweredExample::~SuperpoweredExample() { for (int n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; NUM_BUFFERS; n++) free(outputBuffer[n]); delete playerA; delete playerB; delete mixer; pthread_mutex_destroy(&amp;mutex); } void SuperpoweredExample::onPlayPause(bool play) { pthread_mutex_lock(&amp;mutex); if (!play) { playerA-&gt;pause(); playerB-&gt;pause(); } else { bool masterIsA = (crossValue &lt;= <span class="hljs-number"><span class="hljs-number">0.5</span></span>f); playerA-&gt;play(!masterIsA); playerB-&gt;play(masterIsA); }; pthread_mutex_unlock(&amp;mutex); } void SuperpoweredExample::onCrossfader(int value) { pthread_mutex_lock(&amp;mutex); crossValue = float(value) * <span class="hljs-number"><span class="hljs-number">0.01</span></span>f; if (crossValue &lt; <span class="hljs-number"><span class="hljs-number">0.01</span></span>f) { volA = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f * headroom; volB = <span class="hljs-number"><span class="hljs-number">0.0</span></span>f; } else if (crossValue &gt; <span class="hljs-number"><span class="hljs-number">0.99</span></span>f) { volA = <span class="hljs-number"><span class="hljs-number">0.0</span></span>f; volB = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f * headroom; } else { // constant power curve volA = cosf(M_PI_2 * crossValue) * headroom; volB = cosf(M_PI_2 * (<span class="hljs-number"><span class="hljs-number">1.0</span></span>f - crossValue)) * headroom; }; pthread_mutex_unlock(&amp;mutex); } void SuperpoweredExample::onFxSelect(int value) { __android_log_print(ANDROID_LOG_VERBOSE, <span class="hljs-string"><span class="hljs-string">"SuperpoweredExample"</span></span>, <span class="hljs-string"><span class="hljs-string">"FXSEL %i"</span></span>, value); activeFx = value; } void SuperpoweredExample::onFxOff() { filter-&gt;enable(false); roll-&gt;enable(false); flanger-&gt;enable(false); whoosh-&gt;enable(false); gate-&gt;enable(false); echo-&gt;enable(false); reverb-&gt;enable(false); } #define MINFREQ <span class="hljs-number"><span class="hljs-number">60.0</span></span>f #define MAXFREQ <span class="hljs-number"><span class="hljs-number">20000.0</span></span>f static inline float floatToFrequency(float value) { if (value &gt; <span class="hljs-number"><span class="hljs-number">0.97</span></span>f) return MAXFREQ; if (value &lt; <span class="hljs-number"><span class="hljs-number">0.03</span></span>f) return MINFREQ; value = powf(<span class="hljs-number"><span class="hljs-number">10.0</span></span>f, (value + ((<span class="hljs-number"><span class="hljs-number">0.4</span></span>f - fabsf(value - <span class="hljs-number"><span class="hljs-number">0.4</span></span>f)) * <span class="hljs-number"><span class="hljs-number">0.3</span></span>f)) * log10f(MAXFREQ - MINFREQ)) + MINFREQ; return value &lt; MAXFREQ ? value : MAXFREQ; } void SuperpoweredExample::onFxValue(int ivalue) { float value = float(ivalue) * <span class="hljs-number"><span class="hljs-number">0.01</span></span>f; switch (activeFx) { // filter case <span class="hljs-number"><span class="hljs-number">1</span></span>: filter-&gt;setResonantParameters(floatToFrequency(<span class="hljs-number"><span class="hljs-number">1.0</span></span>f - value), <span class="hljs-number"><span class="hljs-number">0.2</span></span>f); filter-&gt;enable(true); flanger-&gt;enable(false); roll-&gt;enable(false); whoosh-&gt;enable(false); gate-&gt;enable(false); echo-&gt;enable(false); reverb-&gt;enable(false); break; // roll case <span class="hljs-number"><span class="hljs-number">2</span></span>: if (value &gt; <span class="hljs-number"><span class="hljs-number">0.8</span></span>f) roll-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.0625</span></span>f; else if (value &gt; <span class="hljs-number"><span class="hljs-number">0.6</span></span>f) roll-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.125</span></span>f; else if (value &gt; <span class="hljs-number"><span class="hljs-number">0.4</span></span>f) roll-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.25</span></span>f; else if (value &gt; <span class="hljs-number"><span class="hljs-number">0.2</span></span>f) roll-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.5</span></span>f; else roll-&gt;beats = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f; roll-&gt;enable(true); filter-&gt;enable(false); flanger-&gt;enable(false); whoosh-&gt;enable(false); gate-&gt;enable(false); echo-&gt;enable(false); reverb-&gt;enable(false); break; // echo case <span class="hljs-number"><span class="hljs-number">3</span></span>: flanger-&gt;enable(false); filter-&gt;enable(false); roll-&gt;enable(false); whoosh-&gt;enable(false); gate-&gt;enable(false); echo-&gt;setMix(value); echo-&gt;enable(true); reverb-&gt;enable(false); break; // whoosh case <span class="hljs-number"><span class="hljs-number">4</span></span>: flanger-&gt;enable(false); filter-&gt;enable(false); roll-&gt;enable(false); whoosh-&gt;setFrequency(floatToFrequency(<span class="hljs-number"><span class="hljs-number">1.0</span></span>f - value)); whoosh-&gt;enable(true); gate-&gt;enable(false); echo-&gt;enable(false); reverb-&gt;enable(false); break; // gate case <span class="hljs-number"><span class="hljs-number">5</span></span>: flanger-&gt;enable(false); filter-&gt;enable(false); roll-&gt;enable(false); whoosh-&gt;enable(false); echo-&gt;enable(false); if (value &gt; <span class="hljs-number"><span class="hljs-number">0.8</span></span>f) gate-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.0625</span></span>f; else if (value &gt; <span class="hljs-number"><span class="hljs-number">0.6</span></span>f) gate-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.125</span></span>f; else if (value &gt; <span class="hljs-number"><span class="hljs-number">0.4</span></span>f) gate-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.25</span></span>f; else if (value &gt; <span class="hljs-number"><span class="hljs-number">0.2</span></span>f) gate-&gt;beats = <span class="hljs-number"><span class="hljs-number">0.5</span></span>f; else gate-&gt;beats = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f; gate-&gt;enable(true); reverb-&gt;enable(false); break; // reverb case <span class="hljs-number"><span class="hljs-number">6</span></span>: flanger-&gt;enable(false); filter-&gt;enable(false); roll-&gt;enable(false); whoosh-&gt;enable(false); echo-&gt;enable(false); gate-&gt;enable(false); reverb-&gt;enable(true); reverb-&gt;setRoomSize(value); break; // flanger default: flanger-&gt;setWet(value); flanger-&gt;enable(true); filter-&gt;enable(false); roll-&gt;enable(false); whoosh-&gt;enable(false); gate-&gt;enable(false); echo-&gt;enable(false); }; } void SuperpoweredExample::process(SLAndroidSimpleBufferQueueItf caller) { pthread_mutex_lock(&amp;mutex); float *stereoBuffer = outputBuffer[currentBuffer]; bool masterIsA = (crossValue &lt;= <span class="hljs-number"><span class="hljs-number">0.5</span></span>f); float masterBpm = masterIsA ? playerA-&gt;currentBpm : playerB-&gt;currentBpm; double msElapsedSinceLastBeatA = playerA-&gt;msElapsedSinceLastBeat; // When playerB needs it, playerA has already stepped this value, so save it now. bool silence = !playerA-&gt;process(stereoBuffer, false, buffersize, volA, masterBpm, playerB-&gt;msElapsedSinceLastBeat); if (playerB-&gt;process(stereoBuffer, !silence, buffersize, volB, masterBpm, msElapsedSinceLastBeatA)) silence = false; roll-&gt;bpm = flanger-&gt;bpm = gate-&gt;bpm = masterBpm; // Syncing fx is one line. if (roll-&gt;process(silence ? NULL : stereoBuffer, stereoBuffer, buffersize) &amp;&amp; silence) silence = false; if (!silence) { filter-&gt;process(stereoBuffer, stereoBuffer, buffersize); flanger-&gt;process(stereoBuffer, stereoBuffer, buffersize); whoosh-&gt;process(stereoBuffer, stereoBuffer, buffersize); gate-&gt;process(stereoBuffer, stereoBuffer, buffersize); echo-&gt;process(stereoBuffer, stereoBuffer, buffersize); reverb-&gt;process(stereoBuffer, stereoBuffer, buffersize); }; pthread_mutex_unlock(&amp;mutex); // The stereoBuffer is ready now, let's put the finished audio into the requested buffers. if (silence) memset(stereoBuffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, buffersize * <span class="hljs-number"><span class="hljs-number">4</span></span>); else SuperpoweredStereoMixer::floatToShortInt(stereoBuffer, (short int *)stereoBuffer, buffersize); (*caller)-&gt;Enqueue(caller, stereoBuffer, buffersize * <span class="hljs-number"><span class="hljs-number">4</span></span>); if (currentBuffer &lt; NUM_BUFFERS - <span class="hljs-number"><span class="hljs-number">1</span></span>) currentBuffer++; else currentBuffer = <span class="hljs-number"><span class="hljs-number">0</span></span>; } extern <span class="hljs-string"><span class="hljs-string">"C"</span></span> { JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_SuperpoweredExample(JNIEnv *javaEnvironment, jobject self, jstring apkPath, jlongArray offsetAndLength); JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onPlayPause(JNIEnv *javaEnvironment, jobject self, jboolean play); JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onCrossfader(JNIEnv *javaEnvironment, jobject self, jint value); JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onFxSelect(JNIEnv *javaEnvironment, jobject self, jint value); JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onFxOff(JNIEnv *javaEnvironment, jobject self); JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onFxValue(JNIEnv *javaEnvironment, jobject self, jint value); } static SuperpoweredExample *example = NULL; // Android is not passing more than <span class="hljs-number"><span class="hljs-number">2</span></span> custom parameters, so we had to pack file offsets and lengths into an array. JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_SuperpoweredExample(JNIEnv *javaEnvironment, jobject self, jstring apkPath, jlongArray params) { // Convert the input jlong array to a regular int array. jlong *longParams = javaEnvironment-&gt;GetLongArrayElements(params, JNI_FALSE); int arr[<span class="hljs-number"><span class="hljs-number">6</span></span>]; for (int n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; n++) arr[n] = longParams[n]; javaEnvironment-&gt;ReleaseLongArrayElements(params, longParams, JNI_ABORT); const char *path = javaEnvironment-&gt;GetStringUTFChars(apkPath, JNI_FALSE); example = new SuperpoweredExample(path, arr); javaEnvironment-&gt;ReleaseStringUTFChars(apkPath, path); } JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onPlayPause(JNIEnv *javaEnvironment, jobject self, jboolean play) { example-&gt;onPlayPause(play); } JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onCrossfader(JNIEnv *javaEnvironment, jobject self, jint value) { example-&gt;onCrossfader(value); } JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onFxSelect(JNIEnv *javaEnvironment, jobject self, jint value) { example-&gt;onFxSelect(value); } JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onFxOff(JNIEnv *javaEnvironment, jobject self) { example-&gt;onFxOff(); } JNIEXPORT void Java_com_example_SuperpoweredExample_MainActivity_onFxValue(JNIEnv *javaEnvironment, jobject self, jint value) { example-&gt;onFxValue(value); }</code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">SuperpoweredExample.cpp</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#ifndef</span></span> <span class="hljs-type"><span class="hljs-type">Header_SuperpoweredExample</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">Header_SuperpoweredExample</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;<span class="hljs-type"><span class="hljs-type">SLES</span></span>/<span class="hljs-type"><span class="hljs-type">OpenSLES</span></span>.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;<span class="hljs-type"><span class="hljs-type">SLES</span></span>/<span class="hljs-type"><span class="hljs-type">OpenSLES_Android</span></span>.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;math.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;pthread.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredExample.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredAdvancedAudioPlayer.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredFilter.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredRoll.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredFlanger.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredMixer.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredWhoosh.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredGate.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredEcho.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredReverb.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> <span class="hljs-comment"><span class="hljs-comment">"SuperpoweredTimeStretching.h"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">NUM_BUFFERS</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">HEADROOM_DECIBEL</span></span> <span class="hljs-number"><span class="hljs-number">3.0</span></span>f static const float headroom = powf(<span class="hljs-number"><span class="hljs-number">10.0</span></span>f, -<span class="hljs-type"><span class="hljs-type">HEADROOM_DECIBEL</span></span> * <span class="hljs-number"><span class="hljs-number">0.025</span></span>); class <span class="hljs-type"><span class="hljs-type">SuperpoweredExample</span></span> { public: <span class="hljs-type"><span class="hljs-type">SuperpoweredExample</span></span>(const char *path, int *params); ~<span class="hljs-type"><span class="hljs-type">SuperpoweredExample</span></span>(); void process(<span class="hljs-type"><span class="hljs-type">SLAndroidSimpleBufferQueueItf</span></span> caller); void onPlayPause(bool play); void onCrossfader(int value); void onFxSelect(int value); void onFxOff(); void onFxValue(int value); private: <span class="hljs-type"><span class="hljs-type">SLObjectItf</span></span> openSLEngine, outputMix, bufferPlayer; <span class="hljs-type"><span class="hljs-type">SLAndroidSimpleBufferQueueItf</span></span> bufferQueue; <span class="hljs-type"><span class="hljs-type">SuperpoweredAdvancedAudioPlayer</span></span> *playerA, *playerB; <span class="hljs-type"><span class="hljs-type">SuperpoweredRoll</span></span> *roll; <span class="hljs-type"><span class="hljs-type">SuperpoweredFilter</span></span> *filter; <span class="hljs-type"><span class="hljs-type">SuperpoweredFlanger</span></span> *flanger; <span class="hljs-type"><span class="hljs-type">SuperpoweredStereoMixer</span></span> *mixer; <span class="hljs-type"><span class="hljs-type">SuperpoweredWhoosh</span></span> *whoosh; <span class="hljs-type"><span class="hljs-type">SuperpoweredGate</span></span> *gate; <span class="hljs-type"><span class="hljs-type">SuperpoweredEcho</span></span> *echo; <span class="hljs-type"><span class="hljs-type">SuperpoweredReverb</span></span> *reverb; <span class="hljs-type"><span class="hljs-type">SuperpoweredTimeStretching</span></span> *stretch; unsigned char activeFx; float crossValue, volA, volB; pthread_mutex_t mutex; float *outputBuffer[<span class="hljs-type"><span class="hljs-type">NUM_BUFFERS</span></span>]; int currentBuffer, buffersize; }; <span class="hljs-symbol"><span class="hljs-symbol">#endif</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">MainActivity</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.SuperpoweredExample; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.annotation.SuppressLint; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.res.AssetFileDescriptor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.AudioManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.RadioButton; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.RadioGroup; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.RadioGroup.OnCheckedChangeListener; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.SeekBar; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.SeekBar.OnSeekBarChangeListener; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> playing =<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; RadioGroup group1; RadioGroup group2; OnCheckedChangeListener rgCheckedChanged = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OnCheckedChangeListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCheckedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RadioGroup group, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> checkedId)</span></span></span><span class="hljs-function"> </span></span>{ RadioButton checkedRadioButton = (RadioButton)group.findViewById(checkedId); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> delta = group==group2 ? <span class="hljs-number"><span class="hljs-number">4</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (group==group1){ group2.setOnCheckedChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); group2.clearCheck(); group2.setOnCheckedChangeListener(rgCheckedChanged); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { group1.setOnCheckedChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); group1.clearCheck(); group1.setOnCheckedChangeListener(rgCheckedChanged); } onFxSelect(group.indexOfChild(checkedRadioButton)+delta); } }; <span class="hljs-meta"><span class="hljs-meta">@SuppressLint</span></span>(<span class="hljs-string"><span class="hljs-string">"NewApi"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.main); <span class="hljs-comment"><span class="hljs-comment">// Get the device's sample rate and buffer size to enable low-latency Android audio output, if available. AudioManager audioManager = (AudioManager) this.getSystemService(Context.AUDIO_SERVICE); String samplerateString=null, buffersizeString=null; try { samplerateString = audioManager.getProperty(AudioManager.PROPERTY_OUTPUT_SAMPLE_RATE); } catch (NoSuchMethodError ignored){} try { buffersizeString = audioManager.getProperty(AudioManager.PROPERTY_OUTPUT_FRAMES_PER_BUFFER); } catch (NoSuchMethodError ignored){} if (samplerateString == null) samplerateString = "44100"; if (buffersizeString == null) buffersizeString = "512"; // Files under res/raw are not compressed, just copied into the APK. Get the offset and length to know where our files are located. AssetFileDescriptor fd0 = getResources().openRawResourceFd(R.raw.lycka), fd1 = getResources().openRawResourceFd(R.raw.nuyorica); long[] params = { fd0.getStartOffset(), fd0.getLength(), fd1.getStartOffset(), fd1.getLength(), Integer.parseInt(samplerateString), Integer.parseInt(buffersizeString) }; try { fd0.getParcelFileDescriptor().close(); } catch (IOException e) {} try { fd1.getParcelFileDescriptor().close(); } catch (IOException e) {} SuperpoweredExample(getPackageResourcePath(), params); // Arguments: path to the APK file, offset and length of the two resource files, sample rate, audio buffer size. // crossfader events final SeekBar crossfader = (SeekBar)findViewById(R.id.crossFader); crossfader.setOnSeekBarChangeListener(new OnSeekBarChangeListener() { public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) { onCrossfader(progress); } public void onStartTrackingTouch(SeekBar seekBar) {} public void onStopTrackingTouch(SeekBar seekBar) {} }); // fx fader events final SeekBar fxfader = (SeekBar)findViewById(R.id.fxFader); fxfader.setOnSeekBarChangeListener(new OnSeekBarChangeListener() { public void onProgressChanged(SeekBar seekBar, int progress, boolean fromUser) { onFxValue(progress); } public void onStartTrackingTouch(SeekBar seekBar) { onFxValue(seekBar.getProgress()); } public void onStopTrackingTouch(SeekBar seekBar) { onFxOff(); } }); group1 = (RadioGroup)findViewById(R.id.radioGroup1); group1.setOnCheckedChangeListener(rgCheckedChanged); group2 = (RadioGroup)findViewById(R.id.radioGroup2); group2.setOnCheckedChangeListener(rgCheckedChanged); // // fx select event // group.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() { // public void onCheckedChanged(RadioGroup radioGroup, int checkedId) { // RadioButton checkedRadioButton = (RadioButton)radioGroup.findViewById(checkedId); // onFxSelect(radioGroup.indexOfChild(checkedRadioButton)); // group2.clearCheck(); // } // }); // group2.setOnCheckedChangeListener(new RadioGroup.OnCheckedChangeListener() { // public void onCheckedChanged(RadioGroup radioGroup, int checkedId) { // RadioButton checkedRadioButton = (RadioButton)radioGroup.findViewById(checkedId); // onFxSelect(radioGroup.indexOfChild(checkedRadioButton)+4); // group.clearCheck(); // } // }); } public void SuperpoweredExample_PlayPause(View button) { // Play/pause. playing = !playing; onPlayPause(playing); Button b = (Button) findViewById(R.id.playPause); b.setText(playing ? "Pause" : "Play"); } private native void SuperpoweredExample(String apkPath, long[] offsetAndLength); private native void onPlayPause(boolean play); private native void onCrossfader(int value); private native void onFxSelect(int value); private native void onFxOff(); private native void onFxValue(int value); static { System.loadLibrary("SuperpoweredExample"); } @Override protected void onDestroy() { super.onDestroy(); onPlayPause(false); } }</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">main.xml</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android1</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/playPause"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_alignParentTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SuperpoweredExample_PlayPause"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/play"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SeekBar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/crossFader"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/playPause"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radioGroup1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/crossFader"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:checked</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/flanger"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/filter"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/roll"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/echo"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radioGroup2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radioGroup1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_centerHorizontal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio4"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/whoosh"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/gate"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radio6"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/reverb"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RadioGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SeekBar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/fxFader"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_alignParentLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_below</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/radioGroup2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android1:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"15dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RelativeLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>     ,   ,     : <br> ‚Äî  ,  ,     WAVE/ (      JNI   ,        iOS); <br> ‚Äî         /  (      JNI   ,        iOS); <br> ‚Äî SuperpoweredAdvancedAudioPlayer     pitch shift       ( ); <br> ‚Äî   SuperpoweredAdvancedAudioPlayer     ,      . <br><br>       SDK  ,   : <br> ‚Äî    WAV-  MP3,      ,        LAME  . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
        : <br> ‚Äî    SuperpoweredAdvancedAudioPlayer             Samsung  HTC; <br> ‚Äî    SDK   . <br><br>     , ,      JNI     SDK,    ,     .         ,   ,     ! </div><p>Source: <a href="https://habr.com/ru/post/246491/">https://habr.com/ru/post/246491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246481/index.html">Quick Rollback in Veeam Backup & Replication: a new mode for fast recovery of virtual machine disks</a></li>
<li><a href="../246483/index.html">Google's Quantum Online Sandbox</a></li>
<li><a href="../246485/index.html">Administer the server through a single console</a></li>
<li><a href="../246487/index.html">Peace, friendship and chewing on the digital services market</a></li>
<li><a href="../246489/index.html">Contest of games with gamepad support</a></li>
<li><a href="../246495/index.html">Interview with David Allen</a></li>
<li><a href="../246497/index.html">6 games in 6 weeks - the fifth game</a></li>
<li><a href="../246499/index.html">Investments: How to get started on the Chicago Stock Exchange</a></li>
<li><a href="../246503/index.html">Using different VCS repositories in PhpStorm</a></li>
<li><a href="../246507/index.html">How to remain an expert in a changing world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>