<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I got the key to Diablo III Beta</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In YouTube thisIsHorosho videos recently began to appear keys to the Diablo III Beta. In the 7-minute video for a second, the key is shown, who first ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I got the key to Diablo III Beta</h1><div class="post__text post__text-html js-mediator-article">  In YouTube <a href="http://www.youtube.com/user/ThisIsHorosho">thisIsHorosho</a> videos recently began to appear keys to the Diablo III Beta.  In the 7-minute video for a second, the key is shown, who first activates it, then it wins.  This is how the key looks like on a still frame: <br><img src="https://habrastorage.org/storage2/850/37c/ff9/85037cff9f6f44ac6a94f1bfda7daf2c.png"><br><br>  Have you thought about the same thing about me? <br><br><a name="habracut"></a><br>  Only 10 keys. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Key 1</b> <br>  I did not know about the first key, and probably nobody knew.  Someone was lucky. <br><br>  <b>Key 2</b> <br>  The simplest bot was ready for the second video, which once every 10 seconds updates the page with the added video and, if a new video appears, the modal window in the form of an alert reports this.  It turned out that after 4 hours youtube detects the bot and asks him to enter recaptcha, and then every hour asks to enter it.  It is not very convenient, but I didn‚Äôt really want to spend time and write in a normal way, as I expected the second key to appear somehow differently, for example, in green letters.  I missed the second key, but when I saw the same gray numbers and letters, the same font, the same size, on the same white background and even the same three lines, I decided to make a normal bot. <br><br>  <b>Key 3</b> <br>  By the third video, the bot used youtube api, the quota for the number of requests for which it was allowed to scan every 5 seconds for 12 hours. <br><br>  The algorithm was simple: <br><ol><li>  Every 5 seconds do GET to <a href="http://gdata.youtube.com/feeds/api/users/ThisIsHorosho/uploads%3Fmax-results%3D1%26fields%3DopenSearch:totalResults,entry/id">http://gdata.youtube.com/feeds/api/users/ThisIsHorosho/uploads?max-results=1&amp;fields=openSearch:totalResults,entry/id</a> and get the total amount of the user's video and the link to the latest video . <br></li><li>  If the number of videos has changed, then from the last link we get videoId: 3J1CYzzZjNc </li><li>  Make a GET to <a href="http://www.youtube.com/get_video_info%3Fvideo_id%3D3J1CYzzZjNc">http://www.youtube.com/get_video_info?video_id=3J1CYzzZjNc</a> and get the url encoded parameters </li><li>  We take the parameter url_encoded_fmt_stream_map - this is url encoded direct links to videos of different formats and quality.  The link only works for the IP from which the request came.  You can get a nice link <a href="https://habr.com/ru/post/140938/">http://oo.preferred.lhr14s07.v2.lscache8.c.youtube.com/videoplayback?sparams=cpid,</a> id,ipbits,itag,ratebypass,source,expire&amp;fexp=906929,907720 <a href="https://habr.com/ru/post/140938/">, 904821 &amp; itag = 18, &amp; ip = 88.0.0.0 &amp; signature = BA6D9C66CA9DF74931C899ABC3816E6FFB3AF2B5.326CFD03BDE8430990DEE9E8DC62046FAC43C62B</a> &amp; sver = <a href="https://habr.com/ru/post/140938/">3 &amp; ratebypass = yes &amp; source = youtube</a> &amp; expire = <a href="https://habr.com/ru/post/140938/">1332983106 &amp; key = yt1 &amp; ipbits = 8 &amp; cp = U0hSR1lTUV9FUENOMl9RTVVCOmNpbEFrX1hXTllx &amp; id = dc9d42633cd98cd7</a> </li><li>  A bot, downloading a movie, starts analyzing the video using the vlc library, which understands mp4 from the box, flv, webm. </li><li>  Scanning the frames after 1 second, we find and save those on which the serial number is supposedly located.  We scan in 4 streams, each its own 1/4 part of the video. </li><li>  User, i.e.  I can only see the screenshots found and enter the key </li></ol><br>  So, an alert popped up, announcing the release of a new video, I logged in to battle.net, after 10 seconds the video was downloaded, after another 10 a screenshot with a serial number appeared: <br><img src="https://habrastorage.org/storage2/cb1/c6b/ece/cb1c6bece88283f240b4db20b387b428.png"><br>  I introduced it and ... it was already used.  Error analysis showed that youtube api data is updated with a delay of up to 5 minutes!  When the bot discovered a new video, it was already too late.  Some of the other bots or users of the F5 strangers are lucky. <br><br>  <b>Key 4</b> <br>  By the fourth video, the bot was finalized: now it uses about 100 proxy servers (1 stream per proxy server), which scan gdata every 5 seconds.  Tests showed that about 20 proxies just instantly report the release of a new video, the rest pull up in a minute, it was excellent.  Unlike gdata, direct links appear immediately for any IP, so here without a proxy, the bot simply downloads video in 20 streams (it worked even in 1000 streams, youtube turns out to allow).  The download speed has increased.  The scanning algorithm was improved: the bot firstly scans the second part of the clip in 4 threads (in all previous videos the serial key appeared at the end of the clip), and then in 4 threads the first part.  For reliability, the scanning step was reduced to 500 ms, other parameters were also slightly weakened. <br><br>  So, an alert popped up, announcing the release of a new video.  I did not have time to go to battle.net as the video had already downloaded (10 seconds) and a screenshot with a serial number appeared: <br><img src="https://habrastorage.org/storage2/fb9/ae9/25f/fb9ae925f874b45d408b7a0e7e9aac47.png"><br><br>  I was glad that I took into account the possibility of his appearance in two lines.  With shaking hands, I somehow wrote and activated it!  It took about 20 seconds. It was very lucky with the scan, the algorithm almost immediately showed the serial number, while the full scan lasted 30 seconds.  In this video, as it turned out, there were two keys that seemed consistent, I entered the second one.  Congratulations to the one who activated the first! <br><br>  <b>5 more keys left</b> <br>  You can modify the algorithm: run the scan with the start of the download, the algorithm becomes more complicated, but you will win 10 seconds. You can also recognize the serial number and automatically enter it in battle.net.  Then the key can be entered even in 5 seconds. <br><br>  Everything was written in Java using HttpComponents (http-protocol) and VLCj (video processing) <br><br>  PS Diablo III is cool <br><br>  <b>UPDATE</b> <br>  It was interesting to write the bot itself, so I regard the time spent 20 hours as time spent on entertainment, and not as 20 hours, during which one could earn much more money than the key itself costs.  In my free time I relax or study something new, but I do not work, but here is pleasant with useful.  The game has not yet passed. <br><br>  <b>Algorithm</b> <br>  I specifically did not immediately specify the algorithm for determining the serial number for two reasons.  Having learned an absolutely accurate algorithm, the authors of ThisIsHorosho will quickly make the key unrecognizable, and I will do a disservice to those who also write the bot.  Although I admit that there are no such people, but as the same, judging by the comments, in 3 minutes serials are introduced, really press F5 while waiting ... <br><br>  Well, since there are many questions about the algorithm ... The main thing is that the algorithm must be very fast.  The main idea is immediately visible from the screenshot with the serial number. <br><br><ol><li>  We take a picture from the frame and save it with a size of 640x320, VLCj allows you to save pictures with any resolution, even if the video has a different one.  All points close to the color of the text are black, everything else is white.  As a result, we get black and white pictures.  A couple of these pictures are inserted in this article. </li><li>  For each screenshot, we consider the statistics of white and black dots.  We declare the background to those where the number of white points is more than 92%, and 94% was enough in the tests, but this is with a margin.  On the frames with the background we are looking for a serial. </li><li>  We retreat from the frame from the edges by 30 pixels, since the serial appears closer to the center, but never from the edge.  The remaining field is divided into 20x20 squares, in each of which we count the number of black dots. </li><li>  Squares with the number of black dots from 10% to 60% are declared squares with letters - this is taking into account the fact that the letter can only half fall into the square and with some margin. </li><li>  Frames containing a continuous sequence of at least 6 squares with letters horizontally and 3 squares vertically are declared frames with a serial number.  Save them to the folder. </li></ol><br><br>  As a result, only pictures with text similar to the serial number appear: <br><img src="https://habrastorage.org/storage2/91c/5ab/71e/91c5ab71efab22161f67a9c1e60e24b0.png"><br><br>  In practice, there are not many of them, so finding the right one is easy. <br><br>  <b>Work with VLCj</b> <br>  Working with VLCj is very simple.  First, I read the documentation at <a href="http://www.capricasoftware.co.uk/vlcj/tutorial1.php">www.capricasoftware.co.uk/vlcj/tutorial1.php</a> , then I <a href="http://www.capricasoftware.co.uk/vlcj/tutorial1.php">played a</a> little with the MediaPlayer class, but it was somehow buggy, in general, I stopped to call direct functions from the LibVlc library - it is faster and more buggy. <br><br>  First create the library <br> <code>LibVlc libvlc = LibVlcFactory.factory().create();</code> <br> <br>  Then we create an array of 8 pieces AnalyzerThread (of type Runnable) (each 1/8 of the video time), which we transfer to Executors.newFixedThreadPool (4) in this order: 4, 5, 6, 7, 0, 1, 2, 3. Those.  first, the second part of the video will be scanned, and then the first.  Each AnalyzerThread has this code: <br><br><pre> <code class="java hljs">System.out.println(<span class="hljs-string"><span class="hljs-string">"Run section "</span></span> + num); libvlc_media_player_t p_mi = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; libvlc_media_t media = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// prepare //libvlc_instance_t instance = libvlc.libvlc_new(0, new String[0]); libvlc_instance_t instance = libvlc.libvlc_new(2, new String[]{"--vout", "dummy"}); p_mi = libvlc.libvlc_media_player_new(instance); libvlc.libvlc_audio_toggle_mute(p_mi); media = libvlc.libvlc_media_new_path(instance, fileName); libvlc.libvlc_media_player_set_media(p_mi, media); libvlc.libvlc_media_player_play(p_mi); Thread.sleep(msPlayerWait); libvlc.libvlc_media_player_pause(p_mi); // start snapshoting int block = blockFrom; for (long msTime = msFrom; msTime &lt;= msTo; msTime += msInBlock, block++) { String path = snapshotPath + File.separator + "snap-" + String.format("%03d.png", block); libvlc.libvlc_media_player_set_time(p_mi, msTime); int r = libvlc.libvlc_video_take_snapshot(p_mi, 0, path, picWidth, picHeight); if (r != 0) System.out.println("SNAPSHOT FAILED: block=" + block + ", returnCode=" + r); else analyzeImage(path); } } finally { if (p_mi != null) libvlc.libvlc_media_player_stop(p_mi); if (media != null) libvlc.libvlc_media_release(media); if (p_mi != null) libvlc.libvlc_media_player_release(p_mi); System.out.println("Close section " + num); }</span></span></code> </pre><br><br>  The analyzeImage function just determines whether the key is in the screenshot or not, if it is, it saves it in a special folder. </div><p>Source: <a href="https://habr.com/ru/post/140938/">https://habr.com/ru/post/140938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140932/index.html">Google Drive will be launched in early April</a></li>
<li><a href="../140933/index.html">PlayStation 4 may not be compatible with games from previous PS versions.</a></li>
<li><a href="../140934/index.html">Promotional action Drei.AT and Dropbox. And again + 2GB for your account</a></li>
<li><a href="../140935/index.html">Brief Description of the CImg Library</a></li>
<li><a href="../140936/index.html">Lumix GF3 - Hack</a></li>
<li><a href="../140939/index.html">The answer to Python vs Ruby</a></li>
<li><a href="../140940/index.html">Multi-threaded file upload in S3</a></li>
<li><a href="../140941/index.html">Wifi on the ring line of the Moscow metro - rapid test</a></li>
<li><a href="../140942/index.html">XBOX 360 xk3y. Part 1 - Overview, features and equipment</a></li>
<li><a href="../140943/index.html">Search for inaccurate matches, search for input errors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>