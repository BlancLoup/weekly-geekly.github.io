<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adaptive multi-level menu of the site with self-registered items based on the AngularJS directive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a well-founded opinion that someone else‚Äôs code found on the Internet is much better than handwritten; it has already been tested by thousand...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adaptive multi-level menu of the site with self-registered items based on the AngularJS directive</h1><div class="post__text post__text-html js-mediator-article">  There is a well-founded opinion that someone else‚Äôs code found on the Internet is much better than handwritten;  it has already been tested by thousands of lazy developers.  Actually, therefore, when I faced the task described in the title of the article, I decided not to reinvent the wheel, but to find a ready-made solution.  To my surprise, I didn‚Äôt find anything suitable for my inquiries based on angulyar on either English-speaking or Russian-language resources.  Therefore, it was decided to write the code independently and share it with the public. <br><br>  <u>The menu features implemented in this article:</u> <br><ol><li>  The entire menu filling is hidden under the hood of the directive.  When html page layout, only a DOM element with a directive is specified, which improves the readability of the code. </li><li>  The menu has the ability to create items with an infinite level of nesting. </li><li>  The active page in the menu is highlighted not only at the first level, but also at any nesting level. </li><li>  The ability to register a menu item at the stage of application configuration. </li><li>  The ability to display / hide specific menu items depending on the access rights of the current user. </li></ol><br>  <b>The source code of the directive can be found <a href="https://github.com/EugeneSnihovsky/angular-navbar">here</a></b> . <br><a name="habracut"></a><br>  Naturally, I didn‚Äôt write everything from scratch, so the following is a <u>list of borrowed materials</u> : <br><br><div class="spoiler">  <b class="spoiler_title">View list</b> <div class="spoiler_text"><ol><li>  <b><a href="https://angularjs.org/">AngularJS</a></b> is a superheroic Google framework that implements the <a href="https://ru.wikipedia.org/wiki/Model-View-ViewModel">MVVM</a> application architecture design pattern. </li><li>  <b><a href="https://github.com/angular-ui/ui-router">UI-router</a></b> is an Angulyarovsky module, without which designing <a href="http://www.cyberguru.ru/dotnet/asp-net/state-objects.html">state-</a> based applications is unthinkable. </li><li>  <b><a href="https://github.com/Narzerus/angular-permission">Angular-permission</a></b> is the Angulyarovsky module (only works in conjunction with ui-router), which simplifies access control and authorization on the client side. </li><li>  <b><a href="http://getbootstrap.com/">Bootstrap 3</a></b> is a CSS framework that speeds up the layout of responsive pages. </li><li>  <b><a href="https://github.com/Swiip/generator-gulp-angular">Yeoman-</a></b> generator is a console utility for automatic construction of the project structure. </li><li>  <b><a href="http://bower.io/">Bower</a></b> is a package manager that simplifies the installation and update of project dependencies. </li><li>  <b><a href="">Gulp</a></b> - the stream collector of projects on JS. </li><li>  <b><a href="https://nodejs.org/">NodeJS</a></b> is a server-side development environment. </li></ol><br>  <b>PS</b> : points 5-8 are optional, but they significantly simplify the life of a modern front-end developer. <br></div></div><br>  The first unpleasant surprise for me was the reproducibility of the project.  The world of web-development is not in place, every day there are new versions of the above products and my menu, which was lazily written in a project that was overlooked a couple of months ago, completely refused to work in a project that was recently collected.  Below is a list of problems that I encountered. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">View problems</b> <div class="spoiler_text"><ol><li>  The latest version of the UI-router falls out with an error if there are fields in the params object with values ‚Äã‚Äãthat equate to logical negation (false, 0, undefined, null, or an empty string).  I did not find a solution to the problem, so I rolled back to the latest workable version ‚Äú0.2.13‚Äù. </li><li>  Yeoman generator offers a fairly convenient structure of the future application.  In the root directory, in addition to the service directory, a src directory with the project itself is created.  It contains the main html page and three directories: <br><img src="https://habrastorage.org/getpro/habr/post_images/83a/7a6/bcb/83a7a6bcb8e0761cbbb6e5b01efefdab.jpg" alt="project structure"><br>  <b>app</b> - directory with application states (it is recommended to allocate a folder for each state). <br>  <b>assets</b> - a folder with static content. <br>  <b>components</b> - a folder for application elements that can be used many times (in our case, these are directives, services, factories, providers, etc.). <br>  In accordance with this structure, the Yeoman generator sets up gulp for monitoring changes and connecting files to the running application (everything is done automatically, no need to connect the dependencies to the html page manually). <br>  In the latest version of the generator, the components folder was moved to the app directory and, accordingly, the gulp settings were changed.  In order for our project to see the components folder and not give an error on the absence of the navbar module in the developer‚Äôs console, edit the following files in the gulp folder: <br><ul><li>  <b>inject.js</b> script <br><br>  <i>we</i> add an element to the <i>injectScripts</i> array <br><pre><code class="javascript hljs">options.src + <span class="hljs-string"><span class="hljs-string">'/components/**/*.js'</span></span></code> </pre> <br>  add an element to the <b>injectStyles</b> array <br><pre> <code class="javascript hljs">options.src + <span class="hljs-string"><span class="hljs-string">'/components/**/*.css'</span></span></code> </pre><br></li><li>  script <b>watch.js</b> - add the following rules: <br><br><pre> <code class="javascript hljs">gulp.watch(options.src + <span class="hljs-string"><span class="hljs-string">'/components/**/*.css'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isOnlyChange(event)) { browserSync.reload(event.path); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gulp.start(<span class="hljs-string"><span class="hljs-string">'inject'</span></span>); } }); gulp.watch(options.src + <span class="hljs-string"><span class="hljs-string">'/components/**/*.js'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(isOnlyChange(event)) { gulp.start(<span class="hljs-string"><span class="hljs-string">'scripts'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { gulp.start(<span class="hljs-string"><span class="hljs-string">'inject'</span></span>); } }); gulp.watch(options.src + <span class="hljs-string"><span class="hljs-string">'/components/**/*.html'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ browserSync.reload(event.path); });</code> </pre><br></li></ul><br></li><li>  Since the directive is written in the bootstrap, then, naturally, it requires its components, in particular, the jQuery library.  When creating the project, Yeoman will ask about the need to connect jquery, bootstrap and how to work with it (Angulyar ui-bootstrap or AngularStrap directives, the official use of bootstrap with jQuery or pure CSS).  There is a small catch.  When installing, even before selecting the above options, you will be prompted to add to the jQuery project.  Be sure to select this option, otherwise we will remain without important dependencies and everything will break. <br>  <b>PS</b> : actually fix the moment is not difficult.  Just need to podshamanit the directive code itself and you can do without jQuery at all, but, as they say, ‚Äúit works - do not touch (c)‚Äù. <br><br></li><li>  If there is a desire to indulge in the project with Google's <a href="https://material.angularjs.org/">angular-material</a> , which Yeoman proposes to include in the project, you need to know that in this case the old version of the library will be connected, for which the documentation from the official site is not suitable.  Therefore, the correct option would be to connect the library using bower with the --save option. </li></ol><br></div></div><br>  With the organizational moments finished, we proceed to the writing of the directive itself. <br>  For convenience, we will move the <b>html-template</b> directive to a separate file. <br><br><div class="spoiler">  <b class="spoiler_title">Show template</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-mouseleave</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"closeMenu($event)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navbar-header"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"button"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navbar-toggle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"collapseMenu($event)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sr-only"</span></span></span><span class="hljs-tag">&gt;</span></span>Toggle navigation<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon-bar"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon-bar"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"icon-bar"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"link-kukuri"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ui-sref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{::sref}}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-letters</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{::name}}"</span></span></span><span class="hljs-tag">&gt;</span></span>{{::name}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navbar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"collapse navbar-collapse"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-expanded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"navCollapsed"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nav navbar-nav navbar-right"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"items in navbar"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{::menuClass(items.name, 'firstLevel')}} list-status"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!items.name.pop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ui-sref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{items.state}}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-mouseenter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"closeOnMoveMenu()"</span></span></span><span class="hljs-tag">&gt;</span></span>{{items.name}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"items.name.pop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dropdown-toggle dropdown-toggle-firstLevel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dropdown-toggle</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">aria-expanded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"expandMenu($event)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-mouseenter</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"expandMenu($event)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-mouseleave</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"closeSubMenu($event)"</span></span></span><span class="hljs-tag">&gt;</span></span> {{::items.name[0]}}<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"caret"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"items.name.pop"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dropdown-menu"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ng-include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'submenu.template'"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/ng-template"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submenu.template"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-repeat</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"items in items.name"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"$index !== 0"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"{{::menuClass(items.name)}} sub-menu"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"sub-link"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"!items.name.pop"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ui-sref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"{{::items.state}}"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-mouseenter</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"closeOnMoveSubMenu($event)"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {{::items.name}}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"#"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"items.name.pop"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"dropdown-toggle"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data-toggle</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"dropdown"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-click</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"expandSubMenu($event)"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-mouseenter</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"expandSubMenu($event)"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {{::items.name[0]}} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-if</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"items.name.pop"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"dropdown-menu"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ng-include</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"'submenu.template'"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  In fact, this is a modification of the standard menu from the bootstrap documentation with a few nuances: <br><br><div class="spoiler">  <b class="spoiler_title">Show features</b> <div class="spoiler_text"><br><ol><li>  The list of menu items is generated using the <i>ng-repeat</i> directive, which clones the prepared html template, substituting data from the menu item array, which is defined in the current directive's scopes, into it.  I note that the template uses the so-called one-time assignment ( <i>one time binding</i> ), the syntax of which is two points near the variable (for example <i>{{:: name}}</i> ).  The fact is that for each variable an angular creates a separate listener (watcher), which checks its change with each digest (checking for changes of all variables in the current scopa as long as their values ‚Äã‚Äãchange, at the end DOM is drawn with new values) .  Since our menu items are constant, it makes sense to draw them once, reducing the number of listeners and increasing productivity. <br><br></li><li>  Nested subclauses are collected recursively using <i>ng-include</i> .  The recursive part of the template is stored in the script tag with the <i>type = "text / ng-template"</i> attribute.  The browser does not know this type of script and does not handle this part of the DOM, but the ng-include directive inserts only the contents of the script in the right place, which allows the browser to handle the DOM element normally. <br>  The nesting itself is controlled by the <i>ng-if</i> directive, which checks whether the current element is an array of items or a string with the name of the item.  The check is carried out using the so-called ‚Äú <a href="https://learn.javascript.ru/class-instanceof">duck typing</a> ‚Äù, if we have an array before us, then it has array methods (push, pop, etc.), the access to which without () will return a function that equates to a logical true.  If we have a string before us, such a call to the array method will return undefined. <br><br></li><li>  There is an unspoken rule for working with angular directives, which says: "The directive should not change the elements of a DOM tree outside its element."  The work of the drop-down menu items requires listeners who will track the events of a click, a hover and an cursor leave the item.  It would be possible to use the usual search for elements by the selectors of the DOM elements of the tree and hang listeners on them.  But in a large project, there is a possibility that someone else will use identical selector names.  The consequences of such an event are unpredictable :) For such cases, the directives <i>ng-click, ng-mouseenter</i> and <i>ng-mouseleave are provided</i> , which were hung on the corresponding elements. </li></ol><br></div></div><br>  Next, briefly consider the <b>css file</b> : <br><br><div class="spoiler">  <b class="spoiler_title">Show CSS</b> <div class="spoiler_text">  @import url (http://fonts.googleapis.com/css?family=Gloria+Hallelujah); <br>  .navbar-brand { <br>  font-family: "Gloria Hallelujah", Verdana, Tahoma; <br>  font-size: 23px; <br>  } <br>  .sub-menu { <br>  background-color: # 333; <br>  } <br>  .sub-menu&gt; a { <br>  color: # 9d9d9d! important; <br>  padding-left: 10px! important; <br>  } <br>  .dropdown-menu { <br>  padding: 0px; <br>  margin-left: -1px; <br>  margin-right: -1px; <br>  min-width: 90px! important; <br>  } <br>  .dropdown-submenu { <br>  position: relative; <br>  } <br>  .dropdown-submenu&gt; .dropdown-menu { <br>  top: 0; <br>  right: 100%; <br>  margin-top: 6px; <br>  margin-left: -1px; <br>  -webkit-border-radius: 0 6px 6px 6px; <br>  -moz-border-radius: 0 6px 6px 6px; <br>  border-radius: 0 6px 6px 6px; <br>  } <br>  .dropdown-submenu: hover&gt; a: after { <br>  border-left-color: #ffffff; <br>  } <br>  .dropdown-submenu.pull-left { <br>  float: none; <br>  } <br>  .dropdown-submenu.pull-left&gt; .dropdown-menu { <br>  left: -100%; <br>  margin-left: 10px; <br>  -webkit-border-radius: 6px 0 6px 6px; <br>  -moz-border-radius: 6px 0 6px 6px; <br>  border-radius: 6px 0 6px 6px; <br>  } <br>  .dropdown-submenu&gt; a: before { <br>  display: block; <br>  content: ""; <br>  float: left; <br>  width: 0; <br>  height: 0; <br>  border-style: solid; <br>  border-color: transparent #cccccc transparent transparent; <br>  margin-top: 7px; <br>  margin-left: -5px; <br>  margin-right: 10px; <br>  } <br>  .dropdown-submenu-big&gt; a: before { <br>  border-width: 4.5px 7.8px 4.5px 0; <br>  } <br>  .dropdown-submenu-small&gt; a: before { <br>  margin-right: 7px; <br>  border-left: 5px solid transparent; <br>  border-right: 5px solid transparent; <br>  border-top: 5px solid #ccccc; <br>  } <br>  .dropdown-menu: hover, <br>  .dropdown-toggle: focus, <br>  li&gt; [aria-expanded = "true"], <br>  .navbar-brand: hover, <br>  .sub-menu&gt; a: hover, <br>  .list-status: hover, <br>  .nav .open&gt; a { <br>  color: #fff! important; <br>  background-color: # 004444! important; <br>  } <br>  .menu-active, <br>  .menu-active&gt; a { <br>  font-weight: bold! important; <br>  text-decoration: underline; <br>  } <br>  .navbar-cheat { <br>  width: 100%; <br>  height: 45px; <br>  } <br>  .sub-link: before { <br>  display: block; <br>  content: ""; <br>  float: left; <br>  width: 12px; <br>  height: 5px; <br>  } <br>  / * Kukuri * / <br>  .link-kukuri { <br>  font-family: "Gloria Hallelujah"; <br>  outline: none; <br>  text-decoration: none! important; <br>  position: relative; <br>  font-size: 23px; <br>  line-height: 2; <br>  color: # c5c2b8; <br>  display: inline-block; <br>  } <br>  .link-kukuri: hover { <br>  color: # c5c2b8; <br>  } <br>  .link-kukuri: hover :: after { <br>  -webkit-transform: translate3d (100%, 0.0); <br>  transform: translate3d (100%, 0.0); <br>  } <br>  .link-kukuri :: before { <br>  content: attr (data-letters); <br>  position: absolute; <br>  z-index: 2; <br>  overflow: hidden; <br>  color: # 424242; <br>  white-space: nowrap; <br>  width: 0%; <br>  -webkit-transition: width 0.4s 0.0s; <br>  transition: width 0.4s 0.0s; <br>  } <br>  .link-kukuri: hover :: before { <br>  width: 100%; <br>  } <br>  .link-kukuri: focus { <br>  color: # 9e9ba4; <br>  } <br></div></div><br>  Nothing special, the code for the menu ‚Äúborrowed‚Äù <a href="http://www.bootply.com/nZaxpxfiXz">here</a> , the animation of the logo is <a href="https://dribbble.com/shots/2069400--Kukuri-text-hover-effect">here</a> . <br><br>  So slowly, we got to the most interesting part, for the sake of which this article was conceived - the code of the directive menu on an angular. <br><br>  <b>File navbar.module.js</b> <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.module(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>, [<span class="hljs-string"><span class="hljs-string">'ui.router'</span></span>]); })();</code> </pre><br>  Let's start with the programming culture.  The angular itself is designed in such a way that it will not allow you to mess up much, but it is considered good practice to use strict ' <a href="https://learn.javascript.ru/strict-mode">use strict</a> ' mode and wrap the module code into an anonymous function. <br>  You may ask why such a large amount of functionality is rendered into a separate file?  Everything is very simple.  One of the advantages of an angular is its modularity, which makes it easy to transfer pieces of functionality from one project to another.  In this case, we declare a separate module ' <i>navbar</i> ', on which in the future you can hang directives, controllers, factories and other joys. <br><br>  At the same time, when transferring the functionality to another project, it will be enough just to connect the ' <i>navbar</i> ' module depending on it.  All other dependencies attached to it do not require ads and will be pulled automatically. <br>  Separately, I note that the second argument when declaring a module is an array of dependencies that are required for its operation.  In this case, it is ' <i>ui-router</i> '.  If there are no dependencies, you must specify an empty array, otherwise it will not be possible to export the module to another application. <br>  Quite often, it is required to carry out pre-launch settings of the application, which are performed before the launch of directives, controllers and services.  Such operations are performed in the <i>config</i> section (performed once the application is initialized) and in the <i>run</i> section (performed every time it switches to the state in which it is described).  It is very convenient to keep the code of these settings in the above file. <br><br>  <b>File navbar.directive.js</b> : <br><br><div class="spoiler">  <b class="spoiler_title">Show navbar.directive.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.module(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>) .directive(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$document, $state, navbarList, navPermission</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">restrict</span></span>: <span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-attr"><span class="hljs-attr">scope</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'@'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sref</span></span>: <span class="hljs-string"><span class="hljs-string">'@'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'/components/navbar.directive/navbar.template.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">link</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scope, elem</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> openedMenu = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, openedSubMenu = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, username = navPermission.getUser($state.params); <span class="hljs-comment"><span class="hljs-comment">//   DOM        bootstrap elem.addClass('navbar navbar-inverse navbar-fixed-top'); elem.attr('role', 'navigation'); //             scope  if(username) { navPermission.acceptPermission(navbarList.list, username); } scope.navbar = navbarList.list; // /         scope.collapseMenu = function ($event) { var navbar = elem.find('#navbar'), expanded = navbar.hasClass('in'); navbar.attr('aria-expanded', !expanded); scope.navCollapsed = (expanded) ? '' : 'in'; closeAllMenu(); stopBubleAndPropagation($event); }; //          ,     scope.menuClass = function (item, level) { var status = false, activePage = getActivePage($state.current.name), currentPage = (item.pop) ? item[0] : item, classList = (level === 'firstLevel') ? 'dropdown dropdown-firstLevel ' : 'menu-item dropdown dropdown-submenu ', activeClass = (currentPage === activePage || isActive(item, activePage, status) ) ? 'menu-active' : ''; if(item.pop) { return classList + activeClass; } else { return activeClass; } }; //           () function getActivePage(state, currentList) { var name; if(!currentList) { currentList = scope.navbar; } for(var i = (currentList[0].name) ? 0 : 1; i &lt; currentList.length; i++) { if(currentList[i].state === state) { return currentList[i].name; } else if(currentList[i].name.pop) { name = getActivePage(state, currentList[i].name); } } return name; } // ,      function isActive (item, activePage, status) { if(item.pop) { for(var i = 1; i &lt; item.length; i++) { if(item[i].name.pop) { status = isActive(item[i].name, activePage, status); } else if(item[i].name === activePage) { return true; } } } else if(item === activePage) { return true; } return status; } //          ( , ..     ) scope.expandMenu = function ($event) { var clickedElem = $($event.currentTarget), parentClicked = $($event.currentTarget.parentElement), expanded = clickedElem.attr('aria-expanded'), isOpened = parentClicked.hasClass('open'), attrExpanded = (expanded === 'false'), allOpenedMenu = parentClicked.parent().find('.open'), smallWindow = window.innerWidth &lt; 768, eventMouseEnter = $event.type === 'mouseenter', subMenuAll = elem.find('.dropdown-submenu'); if(!smallWindow || !eventMouseEnter) { allOpenedMenu.removeClass('open'); clickedElem.attr('aria-expanded', attrExpanded); if(isOpened &amp;&amp; !eventMouseEnter) { parentClicked.removeClass('open'); } else { parentClicked.addClass('open'); openedMenu = clickedElem; //** } } subMenuAll.removeClass('dropdown-submenu-small dropdown-submenu-big'); if(smallWindow) { subMenuAll.addClass('dropdown-submenu-small'); } else { subMenuAll.addClass('dropdown-submenu-big'); } stopBubleAndPropagation($event); }; //           scope.closeOnMoveMenu = function () { var smallWindow = window.innerWidth &lt; 768; if(openedMenu &amp;&amp; !smallWindow) { var clickedLink = openedMenu, clickedElement = clickedLink.parent(); clickedElement.removeClass('open'); clickedLink.attr('aria-expanded', false); openedMenu = null; } }; //     (   92 ) scope.expandSubMenu = function ($event) { var elemClicked = $($event.currentTarget.parentElement), smallWindow = window.innerWidth &lt; 768, eMouseEnter = $event.type === 'mouseenter', sameElement = elemClicked.hasClass('open'); if(!smallWindow || !eMouseEnter) { //     if(!sameElement &amp;&amp; !eMouseEnter || !eMouseEnter || !sameElement) { elemClicked.parent().find('.open').removeClass('open'); } if(!sameElement) { elemClicked.addClass('open'); openedSubMenu = elemClicked; } } stopBubleAndPropagation($event); }; //          (  :)) scope.closeOnMoveSubMenu = function ($event) { var smallWindow = window.innerWidth &lt; 768; if(openedSubMenu &amp;&amp; !smallWindow) { var clickedElement = openedSubMenu, savedList = clickedElement.parent(), currentList = $($event.target).parent().parent(); if(savedList[0] === currentList[0]) { clickedElement.removeClass('open'); openedSubMenu = null; } } }; scope.closeMenu = closeMenu; //         var $body = $document.find('html'); elem.bind('$destroy', function() { $body.unbind(); //      }); //     -     $body.bind('click', closeMenu); function closeMenu ($event) { var elemClicked = $event.relatedTarget || $event.target; if(isClickOutNavbar(elemClicked)) { closeAllMenu(); } } //     ,  ,       function isClickOutNavbar(elem) { if($(elem).hasClass('dropdown-firstLevel')) { return false; } if(elem.parentElement !== null) { return isClickOutNavbar(elem.parentElement); } else { return true; } } //        function closeAllMenu() { elem.find('.open').removeClass('open'); elem.find('[aria-expanded=true]').attr('aria-expanded', false); } //          function stopBubleAndPropagation($event) { $event.stopPropagation(); $event.preventDefault(); } } }; }); })();</span></span></code> </pre><br></div></div><br>  Immediately, I note that I am not proud of the code described in the directive.  He is not of great interest, because  it just describes the functionality of opening / closing menus for different screen resolutions and the assignment of the necessary classes depending on the type of item.  Two recursive functions carry more or less useful information: checking the user's click outside the menu (line 181) and checking whether the menu item is active (line 70). <br><br>  <u>I note that done right from my point of view:</u> <br><ol><li>  The directive has an isolated scop in which the <i>name</i> and <i>sref</i> parameters are <i>forwarded</i> through the element attributes.  Those.  in a big project, there is less chance of getting into trouble. </li><li>  Complex constructions (finding the element, checking the attribute) are rendered into variables.  The name of variables and functions indicates their purpose. <br>  A good practice is to assign a name in the form of <a href="https://learn.javascript.ru/variable-names">camel notation</a> .  Also, if the code declares several variables in a row, it makes no sense to constantly write var, you can simply list the variables separated by commas, or even better specify each of them with a new line.  This improves the readability of the code. <br></li></ol><br>  <u>What is done wrong:</u> <br><ol><li>  The code is too complex, some functions can be divided into more simple ones.  The basic rule is: mentally pronounce what the function does and if the letter ‚ÄúAND‚Äù jumps in the phrase, it means that the function should be divided into a simpler one. </li><li>  Too trivial comments.  A good code should speak for itself what it does.  Comments require either difficult moments in understanding, or those parts of the code where you have chosen a more complex solution instead of a simple one, since  something in simple did not suit you. <br>  In this case, the comments are written to make it easier for the reader to grasp the essence of the issue. </li></ol><br>  <b>File navbar.provider.js</b> <br><br>  So, our directive is implemented and works, but where to get the list of menu items?  It is possible to describe an array of items in the directive itself, but this is inconvenient at the subsequent addition / deletion of application states.  Each time you have to go into the array of directive points, look for the right place in it and add a new one.  And when deleting a state, you can forget about the presence of an item in the menu, which will lead to errors when a user tries to visit the page. <br>  The way out of the situation is obvious - it is necessary to register each menu item directly next to the description of a specific state.  There is a small nuance.  The order of initializing the Angulyarov application is as follows: <br><br><ol><li>  connection of the registered modules of an angular (module), </li><li>  registration of providers (provider), </li><li>  processing of the config section (performed once when the application is initialized), </li><li>  register factory, service, value, constant, </li><li>  processing of the run section (performed every time the state changes), </li><li>  registration of controllers and directives. </li></ol><br>  Based on the queue, the <i>config</i> section is suitable for us, for which only the <i>provider</i> is available.  You can reach the provider from any part of the application simply by connecting its name depending on it.  At the config stage, the provider is available by its name with the addition ‚Äú <i>Provider</i> ‚Äù, that is, for example, if our provider <i>name</i> is <i>navbarList</i> , then in the config section it will be available under the name <i>navbarListProvider</i> . <br>  The code of our provider is presented below: <br><br><div class="spoiler">  <b class="spoiler_title">Show navbar.provider.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.module(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>) .provider(<span class="hljs-string"><span class="hljs-string">'navbarList'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = []; <span class="hljs-comment"><span class="hljs-comment">//       this.add = function (obj) { //        if(obj.location) { if(obj.location.place.length !== obj.location.priority.length || !obj.location.place.pop || !obj.location.priority.pop) { console.log('Warning! Bad location params for menu "' + obj.name + '". Skip item'); return; } } //          if(!obj.location) { var name = obj.name; for(var i = 0; i &lt; list.length; i++) { //        var currentName = (list[i].name.pop) ? list[i].name[0] : list[i].name; if(currentName === name) { console.log('Warning! Duplicate menu "' + name + '". Skip item'); return; } } list.push(obj); list.sort(sortByPriority); return; } //  ,        var place = obj.location.place.shift(), priority = obj.location.priority.shift(); for(i = 0; i &lt; list.length; i++) { //   ,  i    JS var currentSubName = (list[i].name.pop) ? list[i].name[0] : null; if(place === currentSubName) { list[i].name = changeExistPart(obj, list[i].name); if(priority !== list[i].priority) { console.log('Warning! Priority of menu "' + list[i].name + '" has been changed from "' + list[i].priority + '" to "' + priority + '"'); list[i].priority = priority; list.sort(sortByPriority); } return; } currentName = list[i].name; if(place === currentName) { console.log('Warning! Duplicate submenu "' + place + '". Skip item'); return; } } //      ,       list.push( { name: [place, makeOriginalPart(obj)], priority: priority } ); list.sort(sortByPriority); }; //           function changeExistPart(obj, list) { var place = obj.location.place.shift(), priority = obj.location.priority.shift(), //      searchName = (place) ? place : obj.name; for(var i = 1; i &lt; list.length; i++) { var currentName = (list[i].name.pop) ? list[i].name[0] : list[i].name; if(searchName === currentName) { if(!list[i].name.pop || (!place &amp;&amp; list[i].name.pop) ) { console.log('Warning! Duplicate menu "' + searchName + '". Skip item'); return list; } else { list[i].name = changeExistPart(obj, list[i].name); if(priority !== list[i].priority) { console.log('Warning! Priority of menu "' + list[i].name + '" has been changed from "' + list[i].priority + '" to "' + priority + '"'); list[i].priority = priority; list.sort(sortByPriority); } return list; } } } if(!place) { delete obj.location; list.push(obj); } else { list.push({ name: [place, makeOriginalPart(obj)], priority: priority }); } list.sort(sortByPriority); return list; } //   ,       function makeOriginalPart (obj) { var place = obj.location.place.shift(), priority = obj.location.priority.shift(); if(place) { var menu = { priority: priority, name: [place, makeOriginalPart(obj)] }; } else { delete obj.location; menu = obj; } return menu; } //       function sortByPriority(a, b) { return a.priority - b.priority; } //      angularJS this.$get = function () { return { list: list, add: this.add }; }; }); })();</span></span></code> </pre><br></div></div><br>  <i>$ get</i> is a utility function, which, in our case, returns the method of adding an item to the <i>add</i> menu and the list menu itself, which is stored in the <a href="https://learn.javascript.ru/closures">closure</a> . <br><br>  The <b>add</b> function accepts an object with the following fields as input: <br><br><ol><li>  <i>priority</i> - the numerical value of the priority by which the list is sorted </li><li>  <i>permission</i> is an optional object containing one of two fields: <br><ul><li> <i>except</i> ‚Äî    , </li><li> <i>only</i> ‚Äî    , </li></ul></li><li> <i>location</i> ‚Äî  ,   : <br><ul><li> <i>place</i> ‚Äî  ,     , </li><li> <i>priority</i> ‚Äî    ,        , </li></ul></li><li> <i>name</i> ‚Äî    . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The function of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">is simple. First there is a validation of the object received at the input, then a search is made for a place to insert the current item. If no match is found, the recursive function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">makeOriginalPart ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is called </font><font style="vertical-align: inherit;">, which returns the newly created part of the menu; if a match is found, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">changeExistPart ()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is called </font><font style="vertical-align: inherit;">, which recursively goes to the next nesting level as long as there are matches in the name of the items from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">place</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After each addition of an item, the menu is sorted by the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">priority</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When writing the provider code, the </font><i><font style="vertical-align: inherit;">else if</font></i><font style="vertical-align: inherit;"> constructions were not specifically used.</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Instead, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">return was</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> added at the end of the condition </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">I consider this step justified, since </font><font style="vertical-align: inherit;">it improves the readability of the code. </font><font style="vertical-align: inherit;">In general, the provider code has been repeatedly optimized. </font><font style="vertical-align: inherit;">Who cares, below I attach the first version.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">See the first version of the provider</font></font></b> <div class="spoiler_text"><div class="spoiler">  <b class="spoiler_title">Attention!</b> <b class="spoiler_title">   .</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.module(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>) .provider(<span class="hljs-string"><span class="hljs-string">'navbarList'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = []; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.add = addMenu; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addMenu</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj, nestedMenu, currentList</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(currentList) { list = currentList; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(list.length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { list.push(makeOriginalPart(obj)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!obj.location || !obj.location.place) { <span class="hljs-comment"><span class="hljs-comment">//  .    place==priority isDuplicate(obj.name, list); list.push(obj); list.sort(sortByPriority); return; } else if(obj.location.place.length &gt; 0){ var searchName = obj.location.place.shift(), priority = (obj.location.priority) ? obj.location.priority.shift() : null; for(var i = (nestedMenu) ? 1 : 0; i &lt; list.length; i++) { var currentName = (list[i].name.pop) ? list[i].name[0] :list[i].name; if(currentName === searchName) { if(list[i].name.pop) { //       if(!nestedMenu) { nestedMenu = [list]; } var sublistName = list[i].name.shift(); list[i].name.sort(sortByPriority); list[i].name.unshift(sublistName); list[i].name.priority = priority; //    nestedMenu.push(list[i].name); addMenu(obj, nestedMenu, list[i].name); return; } else { console.log('Warning! Duplicate menu', currentName); } } } if(nestedMenu) { var last = nestedMenu.length - 1; nestedMenu[last].push({ name: [searchName, makeOriginalPart(obj, null, nestedMenu[last]) ], priority: priority }); } } else { last = nestedMenu.length - 1; nestedMenu[last].push(makeOriginalPart(obj, null, nestedMenu[last])); } if(nestedMenu) { // changeExistPart      nestedMenu[nestedMenu.length - 1].sort(sortByPriority); list = changeExistPart(nestedMenu); } else { if(priority) { //  .    place==priority obj.location.priority.unshift(priority); } obj.location.place.unshift(searchName); list.push(makeOriginalPart(obj, null, list)); list.sort(sortByPriority); } } function changeExistPart(nestedMenu) { if(nestedMenu.length &gt; 1) { var subList = nestedMenu.pop(), priority = subList.priority, searchName = subList[0], last = nestedMenu.length - 1; for(var i = 1; i &lt; nestedMenu[last].length; i++) { var currentName = (nestedMenu[last][i].name.pop) ? nestedMenu[last][i].name[0] : ''; if(searchName === currentName){ nestedMenu[last][i].name = subList; nestedMenu[last][i].priority = priority; return changeExistPart(nestedMenu); } } return changeExistPart(nestedMenu); //   .       } else { return nestedMenu[0]; } } function makeOriginalPart(obj, menu, currentList){ if(!menu) { isDuplicate(obj.name, currentList); menu = { name: obj.name, priority: obj.priority, state: obj.state, permissions: obj.permissions }; } if(obj.location.place.length &gt; 0) { var currentLocation = obj.location.place.pop(), priority = (obj.location.priority) ? obj.location.priority.pop() : null, currentMenu = { priority: priority, name: [currentLocation, menu] }; return makeOriginalPart(obj, currentMenu); } else { return menu; } } function isDuplicate(name, list) { if(!list || list.length &lt; 1) { return; } for(var i = (list[0].name) ? 0 : 1; i &lt; list.length; i++) { var currentName = (list[i].name.pop) ? list[i].name[0] : list[i].name; if(currentName === name) { console.log('Warning! Duplicate menu', currentName); } } } function sortByPriority(a, b) { return a.priority - b.priority; } this.$get = function () { return { list: list, add: this.add }; }; }); })();</span></span></code> </pre><br></div></div><br></div></div><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File navbar.permission.js</font></font></b> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watch navbar.permission.js</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.module(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>) .factory(<span class="hljs-string"><span class="hljs-string">'navPermission'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Permission, $q</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//          function getUser(params) { var users = Permission.roleValidations, names = Object.keys(users), promisesArr = []; for(var i = 0; i &lt; names.length; i++) { var current = names[i], validUser = $q.when( users[current](params) ); promisesArr.push(validUser); } return $q.all(promisesArr).then(function (users) { for(var i = 0; i &lt; users.length; i++) { if(users[i]) { return names[i]; } } return null; }); } //   ,      ,   -    function acceptPermission (list, username) { if(!username.then) { return changeList(list, username); } else { return username.then(function (username) { return changeList(list, username); }); } } //        ,      function changeList(list, username) { for(var i = (list[0].name) ? 0 : 1; i &lt; list.length; i++) { if(list[i].permissions) { if(list[i].permissions.except) { var except = list[i].permissions.except; for(var j = 0; j &lt; except.length; j++) { if(except[j] === username) { list.splice(i--, 1); } } } else if(list[i].permissions.only) { var only = list[i].permissions.only, accessDenided = true; for(j = 0; j &lt; only.length; j++) { if(only[j] === username) { accessDenided = false; } } if(accessDenided) { list.splice(i--, 1); } } } else if(list[i].name.pop) { list[i].name = changeList( list[i].name, username); if(list[i].name.length === 1 ) { list.splice(i--, 1); } } } return list; } //     return { getUser: getUser, acceptPermission: acceptPermission }; }); })();</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu filtering script depending on the access level defined by the angular-permission module. </font><font style="vertical-align: inherit;">The code is moved to a separate factory to increase readability and modularity (not everyone needs this functionality). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The factory consists of two methods:</font></font><br><br><ol><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acceptPermission</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - we recursively </font><i><font style="vertical-align: inherit;">walk</font></i><font style="vertical-align: inherit;"> through the array of menu items and delete forbidden ones.</font></font></li><li> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getUser</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a method for determining the current user role. </font><font style="vertical-align: inherit;">Obviously, in a real project, the user role can be defined not only locally, but also on the server. </font><font style="vertical-align: inherit;">Therefore, the user role is defined asynchronously using </font></font><a href="http://habrahabr.ru/post/189084/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">promises</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File navbar.decorator.js</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In fact, everything that I have planned is implemented, let's see how it works. </font><font style="vertical-align: inherit;">Below is an example of the code of the declaration of the state " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Persian cat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " with the registration of this submenu item in the chain of sublevels " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">living creatures</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " =&gt; " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mammals</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " =&gt; " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cats</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ". </font><font style="vertical-align: inherit;">The item is available to all users except ‚Äú </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">anonymous</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù and ‚Äú </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">banned</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù.</font></font><br><br><pre> <code class="javascript hljs">.config(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$stateProvider, navbarListProvider</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    $stateProvider .state('persianCat', { url: '/ ', templateUrl: 'app/cats/persianCat.html', controller: 'persianCatCtrl', permissions: { except: ['anonymous', 'banned'], redirectTo: 'login' } }); //     navbarListProvider.add({ state: 'persianCat', name: ' ', permissions: { except: ['anonymous', 'banned'] }, priority: 20, location: { place: [' ', '', ''], priority: [10, 10, 10] } }); });</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It seems that everything works, but, you see, it is ugly? </font><font style="vertical-align: inherit;">Almost all the information needed to declare a menu item is duplicated when a state is declared. </font><font style="vertical-align: inherit;">To merge everything together we will use the function as a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">decorator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which was kindly provided by the developers of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UI-router</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> module </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In fact, the decorator creates a wrapper around an existing function and allows you to change its functionality. </font><font style="vertical-align: inherit;">Below is the decoration code of our ‚Äú </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.state</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚Äù </font><font style="vertical-align: inherit;">method </font><font style="vertical-align: inherit;">, which allows us to process the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menu</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> field </font><font style="vertical-align: inherit;">from the object passed to the state:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Watch navbar.decorator.js</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ angular.module(<span class="hljs-string"><span class="hljs-string">'navbar'</span></span>) .config(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$stateProvider, navbarListProvider</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    state     $stateProvider.decorator('state', function (obj) { var menu = obj.menu, permissions = (obj.data) ? obj.data.permissions : null; //           -    if(!menu) { return; } menu.state = obj.name; //        if(permissions) { menu.permissions = {}; if(permissions.except) { menu.permissions.except = permissions.except; } else if(permissions.only) { menu.permissions.only = permissions.only; } else { delete menu.permissions; } } //       menu navbarListProvider.add(menu); }); }); })();</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now the announcement of our state with registration in the menu looks like this: </font></font><br><br><pre> <code class="javascript hljs">.config(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$stateProvider</span></span></span><span class="hljs-function">) </span></span>{ $stateProvider .state(<span class="hljs-string"><span class="hljs-string">'persianCat'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/ '</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'app/cats/persianCat.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">controller</span></span>: <span class="hljs-string"><span class="hljs-string">'persianCatCtrl'</span></span>, <span class="hljs-attr"><span class="hljs-attr">permissions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">except</span></span>: [<span class="hljs-string"><span class="hljs-string">'anonymous'</span></span>, <span class="hljs-string"><span class="hljs-string">'banned'</span></span>], <span class="hljs-attr"><span class="hljs-attr">redirectTo</span></span>: <span class="hljs-string"><span class="hljs-string">'login'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">menu</span></span>: { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-attr"><span class="hljs-attr">priority</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">location</span></span>: { <span class="hljs-attr"><span class="hljs-attr">place</span></span>: [<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>], <span class="hljs-attr"><span class="hljs-attr">priority</span></span>: [<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>] } } }); });</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agree - more elegant. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally, a small life hack: create in your projects for each state not only a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate folder</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but also a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">separate Angulean module</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and connect it to the dependency list. </font><font style="vertical-align: inherit;">This will significantly reduce your time when removing / transferring states from the project. </font><font style="vertical-align: inherit;">It will be enough to remove the module from the list of dependencies and the folder with the state.</font></font><br><br>  <i>Thank you for your attention, good luck to all.</i> </div><p>Source: <a href="https://habr.com/ru/post/259347/">https://habr.com/ru/post/259347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259337/index.html">XMPP sucks</a></li>
<li><a href="../259339/index.html">Integration of OTRS v4 with Active Directory. Configure Single Sign On Authentication</a></li>
<li><a href="../259341/index.html">Microsoft will force users to update Windows 10</a></li>
<li><a href="../259343/index.html">DDA for cat</a></li>
<li><a href="../259345/index.html">Kerio Operator 2.4 saves costs and increases employee productivity</a></li>
<li><a href="../259349/index.html">How I stopped worrying and loved React</a></li>
<li><a href="../259351/index.html">What would you choose? Exercise on the choice of applications from the App Store</a></li>
<li><a href="../259353/index.html">Webix 2.4. Door to summer</a></li>
<li><a href="../259355/index.html">Automatic generation of meaningful unique texts</a></li>
<li><a href="../259357/index.html">Weather station not on Arduino, or Working with timers and GPIO interrupts in OpenWRT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>