<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal work with VCS / SCM within the framework of automation with FutoIn CID</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For some modern programmers, there are no version control systems other than Git, but in practice Subversion is still in demand, and Mercurial has its...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal work with VCS / SCM within the framework of automation with FutoIn CID</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/6cf/9eb/dee/6cf9ebdee6444af8b525a848931b7066.png" alt="use cases" title="use cases"></p><br><p>  For some modern programmers, there are no version control systems other than Git, but in practice Subversion is still in demand, and Mercurial has its ardent supporters.  <a href="https://rhodecode.com/insights/version-control-systems-2016">Quick search</a> in reinforcements. </p><br><p>  As a result, DevOps of not single-project companies are faced with the need to automate work with very different systems.  In this case, each has its own nuances and inevitably there are hidden errors in the scenarios that shoot at the most inopportune moment.  There is a need for predictable behavior with minimal ‚Äúflexibility‚Äù rather than a colorful bouquet of possibilities. </p><a name="habracut"></a><br><h2 id="interfeys">  Interface </h2><br><p>  The <a href="https://habrahabr.ru/post/325764/">article</a> introducing the <a href="https://github.com/futoin/cid-tool">FutoIn CID</a> has already described the implicit work with different VCS.  In version v0.7, an explicit command interface and a new functionality were added to automate the creation and merging of branches: </p><br><p>  In general, the interface itself with the comments below: </p><br><pre><code class="hljs xml">cid vcs checkout [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_ref</span></span></span><span class="hljs-tag">&gt;</span></span>] [--vcsRepo=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_repo</span></span></span><span class="hljs-tag">&gt;</span></span>] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs commit <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">commit_msg</span></span></span><span class="hljs-tag">&gt;</span></span> [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">commit_files</span></span></span><span class="hljs-tag">&gt;</span></span>...] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs merge <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_ref</span></span></span><span class="hljs-tag">&gt;</span></span> [--no-cleanup] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs branch <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_ref</span></span></span><span class="hljs-tag">&gt;</span></span> [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs delete <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_ref</span></span></span><span class="hljs-tag">&gt;</span></span> [--vcsRepo=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_repo</span></span></span><span class="hljs-tag">&gt;</span></span>] [--cacheDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs export <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_ref</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dst_dir</span></span></span><span class="hljs-tag">&gt;</span></span> [--vcsRepo=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_repo</span></span></span><span class="hljs-tag">&gt;</span></span>] [--cacheDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs tags [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag_pattern</span></span></span><span class="hljs-tag">&gt;</span></span>] [--vcsRepo=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_repo</span></span></span><span class="hljs-tag">&gt;</span></span>] [--cacheDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs branches [<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">branch_pattern</span></span></span><span class="hljs-tag">&gt;</span></span>] [--vcsRepo=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_repo</span></span></span><span class="hljs-tag">&gt;</span></span>] [--cacheDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cache_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs reset [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>] cid vcs ismerged <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcs_ref</span></span></span><span class="hljs-tag">&gt;</span></span> [--wcDir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wc_dir</span></span></span><span class="hljs-tag">&gt;</span></span>]</code> </pre> <br><p>  If we step back from the slogans about the ideological superiority of decentralized version control systems, then the bottom line in the development of any well-off project remains the same client-server model with additional buns on the client side.  The second obvious point is the smooth "emulation" of the client-server model in distributed systems and the complexity of the implementation of the inverse.  This is the reason for the logic of work - mandatory implicit synchronization with the server. </p><br><p>  This implies the following correspondence table: </p><br><table><thead><tr><th>  CID </th><th>  Git </th><th>  Mercurial </th><th>  Subversion </th></tr></thead><tbody><tr><td> <code>cid vcs checkout</code> </td> <td>  <code>git clone/fetch</code> + <code>git checkout</code> </td><td>  <code>hg pull</code> + <code>hg checkout</code> </td><td> <code>svn checkout/switch</code> </td> </tr><tr><td> <code>cid vcs commit</code> </td> <td>  <code>git commit</code> + <code>git push</code> </td><td>  <code>hg commit</code> + <code>hg push</code> </td><td> <code>svn commit</code> </td> </tr><tr><td> <code>cid vcs merge</code> </td> <td>  <code>git merge</code> + <code>git push</code> </td><td>  <code>hg merge</code> + <code>hg push</code> </td><td>  <code>svn merge</code> + <code>svn commit</code> </td></tr><tr><td> <code>cid vcs branch</code> </td> <td>  <code>git checkout -b</code> + <code>git push</code> </td><td>  <code>hg branch</code> + <code>hg push</code> </td><td> <code>svn copy</code> </td> </tr><tr><td> <code>cid vcs delete</code> </td> <td>  <code>git branch -D</code> + <code>git push -f --delete</code> </td><td>  <code>hg checkout</code> + <code>hg commit --close-branch</code> + <code>hg push</code> </td><td> <code>svn remove</code> </td> </tr><tr><td> <code>cid vcs export</code> </td> <td>  <code>git fetch/clone --mirror --depth=1</code> + <code>git archive | tar</code> <code>git archive | tar</code> </td><td>  <code>hg archive --type files</code> + <code>.hg*</code> cleanup </td><td> <code>svn export</code> </td> </tr><tr><td> <code>cid vcs tags</code> </td> <td> <code>git ls-remote</code> </td> <td> <code>hg tags</code> </td> <td> <code>svn ls {repo}/tags</code> </td> </tr><tr><td> <code>cid vcs branches</code> </td> <td> <code>git ls-remote</code> </td> <td> <code>hg branches</code> </td> <td> <code>svn ls {repo}/branches</code> </td> </tr><tr><td> <code>cid vcs reset</code> </td> <td>  <code>git merge --abort</code> + <code>git reset --hard</code> </td><td>  <code>hg update --clean</code> + <code>hg purge -I **/*.orig</code> </td><td> <code>svn revert -R .</code> </td> </tr><tr><td> <code>cid vcs ismerged</code> </td> <td> <code>git branch -r --merged HEAD</code> </td> <td> <code>hg merge --preview</code> </td> <td> <code>svn mergeinfo --show-revs eligible</code> </td> </tr></tbody></table><br><p>  It seems to be quite understandable for all the brevity.  It is worth noting that: </p><br><ol><li>  SVN relies on a merger with no explicit indication of revisions ‚Äî know what you're doing. </li><li>  In Hg, there is no deletion of branches, and bookmarks look more like a crutch. </li><li>  Of course, at least on these three systems the world has come together with a wedge, it is possible to add support for any other through the plug-in mechanism. </li></ol><br><h2 id="nemnogo-primerov">  Few examples </h2><br><p>  All examples without further ado: a small comment, a sequence of commands as it is, and a visual result. </p><br><h3 id="-podgotovitelnye-raboty">  &gt; Preparatory work </h3><br><p>  Again we use pure Debian Jessie.  Let's make a Git repository, add the file README.txt and LICENSE, make the second branch develop. </p><br><pre> <code class="bash hljs">sudo apt-get install -y python-pip sudo pip install futoin-cid VCS_REPO_DIR=<span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/repo VCS_REPO=git:<span class="hljs-variable"><span class="hljs-variable">${VCS_REPO_DIR}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prep_cache_dir</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> repo=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cache_dir=$(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$repo</span></span> | sed -e <span class="hljs-string"><span class="hljs-string">'s,[/:@],_,g'</span></span>) [ -d <span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> ] &amp;&amp; cid vcs reset --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> 1&gt;&amp;2 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> } <span class="hljs-comment"><span class="hljs-comment"># set -x is too verbose function cid() { echo '$' cid "$@" 1&gt;&amp;2 $(which cid) "$@" } rm ${VCS_REPO_DIR} wc $(prep_cache_dir ${VCS_REPO}) -rf cid tool exec git -- init --bare ${VCS_REPO_DIR} cid vcs checkout --vcsRepo=${VCS_REPO} --wcDir=wc # Commit All echo 'Info' &gt; wc/README.txt cid vcs commit 'Initial commit' --wcDir=wc # Commit specific file(s) echo 'License' &gt; wc/LICENSE cid vcs commit 'Adding license' LICENSE --wcDir=wc cid vcs branch develop --wcDir=wc</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/9b0/1dd/a78/9b01dda787b5427483a0d380f9cbb397.png" alt="prepare" title="prepare"></p><br><h3 id="-job-story-1-kogda-nachinaetsya-rabota-nad-novoy-fichey-trebuetsya-avtomaticheskoe-sozdanie-vetki-chtoby-uporyadochit-naimenovanie">  &gt; Job Story ‚Ññ1: when work begins on a new feature, automatic branch creation is required to streamline the name </h3><br><p>  <em>Note: it is assumed that the developers can not create branches on their own or this is not welcomed, and the trigger in some way works in the tracker.</em> </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_feature_start</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> repo=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> feature=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cache_dir=$(prep_cache_dir <span class="hljs-variable"><span class="hljs-variable">$repo</span></span>) cid vcs checkout develop --vcsRepo=<span class="hljs-variable"><span class="hljs-variable">$repo</span></span> --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> cid vcs branch feature-<span class="hljs-variable"><span class="hljs-variable">${feature}</span></span> --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list_branches</span></span></span></span>() { <span class="hljs-comment"><span class="hljs-comment"># Remote case cid vcs branches --vcsRepo=${VCS_REPO} # Local case cid vcs branches --wcDir=wc } on_feature_start "${VCS_REPO}" '123_one' on_feature_start "${VCS_REPO}" '234_two' list_branches</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/207/6f0/9d5/2076f09d56094ce596f623b2d049e984.png" alt="case #1" title="case # 1"></p><br><h3 id="-job-story-2-kazhduyu-noch-kazhdyy-kommit-trebuetsya-slivat-develop-release-vetku-v-vetku-feature-develop-chtoby-izbezhat-rashozhdeniy-i-obespechit-soblyudenie-processa">  &gt; Job Story ‚Ññ2: every night (every commit), you need to merge the develop (release) branch into the feature (develop) branch to avoid discrepancies and ensure that the process is respected </h3><br><p>  <em>Note: this workflow is considered to be ideologically correct [and safe], although rebase makes a more sterile and understandable history.</em> </p><br><p>  Branch preparation: </p><br><pre> <code class="bash hljs">cid vcs checkout develop --wcDir=wc <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Info 2'</span></span> &gt; wc/README.txt cid vcs commit <span class="hljs-string"><span class="hljs-string">'Commit 2'</span></span> --wcDir=wc cid vcs checkout feature-234_two --wcDir=wc <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Info 3'</span></span> &gt; wc/README.txt cid vcs commit <span class="hljs-string"><span class="hljs-string">'Conflict 3'</span></span> --wcDir=wc</code> </pre> <br><p><img src="https://habrastorage.org/files/4d0/dc0/1c9/4d0dc01c94fc4a87b21a88844f3b5cbf.png" alt="case #2 prepare" title="case # 2 prepare"></p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sync_branches</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> repo=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cache_dir=$(prep_cache_dir <span class="hljs-variable"><span class="hljs-variable">$repo</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> logfile=$(realpath <span class="hljs-variable"><span class="hljs-variable">$2</span></span>) cid vcs checkout develop --vcsRepo=<span class="hljs-variable"><span class="hljs-variable">$repo</span></span> --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> <span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> <span class="hljs-comment"><span class="hljs-comment"># Release -&gt; Develop echo &gt;$logfile for b in $(cid vcs branches 'release*'); do echo -n "Merging $b into develop: " &gt;&gt;$logfile cid vcs merge $b &amp;&amp; \ echo 'OK' &gt;&gt;$logfile || \ echo 'FAIL' &gt;&gt;$logfile done # Develop -&gt; Feature for b in $(cid vcs branches 'feature*'); do echo -n "Merging develop into $b: " &gt;&gt;$logfile cid vcs checkout $b &amp;&amp; \ cid vcs merge develop &amp;&amp; \ echo 'OK' &gt;&gt;$logfile || \ echo 'FAIL' &gt;&gt;$logfile done popd } sync_branches "${VCS_REPO}" merge.log cat merge.log</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/cbf/4b2/455/cbf4b2455958452b86aa3c49b0d98ed1.png" alt="case #2" title="case # 2"></p><br><p>  <em>Error <strong>expected</strong> - we specifically created a conflict, but a typo in it - no.</em>  <em>Will be fixed in the next release.</em> </p><br><h3 id="-job-story-3-posle-reliza-udalyat-vse-vklyuchyonnye-feature-vetki-chtoby-ne-zasoryat-prostranstvo-imyon">  &gt; Job Story ‚Ññ3: after release, delete all enabled feature branches so as not to clutter up the namespace </h3><br><p>  <em>Note: for Hg and SVN there is nothing to worry at all, but for Git there is a risk of losing commits - therefore it is advisable to have a read-only mirror for the story.</em> </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove_merged</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> repo=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cache_dir=$(prep_cache_dir <span class="hljs-variable"><span class="hljs-variable">$repo</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> logfile=$(realpath <span class="hljs-variable"><span class="hljs-variable">$2</span></span>) cid vcs checkout develop --vcsRepo=<span class="hljs-variable"><span class="hljs-variable">$repo</span></span> --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> <span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> &gt;<span class="hljs-variable"><span class="hljs-variable">$logfile</span></span> <span class="hljs-comment"><span class="hljs-comment"># Removed merged into develop for b in $(cid vcs branches 'feature*'); do if ! cid vcs ismerged $b; then continue fi echo -n "Removing $b: " &gt;&gt;$logfile cid vcs delete $b &amp;&amp; \ echo 'OK' &gt;&gt;$logfile || \ echo 'FAIL' &gt;&gt;$logfile done popd } # Merge first branch cid vcs checkout develop --wcDir=wc cid vcs merge feature-123_one --wcDir=wc # Try cleanup remove_merged "${VCS_REPO}" delete.log cat delete.log</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/2b1/899/1fe/2b18991fe5114524911cdaf3f6ce64fb.png" alt="case #3" title="case # 3"></p><br><h3 id="-job-story-4-s-zadannoy-periodichnostyu-generirovat-fayly-i-otpravlyat-v-vcs-chtoby-imet-celostnuyu-istoriyu-izmeneniy">  &gt; Job Story ‚Ññ4: at specified intervals, generate files and send to VCS in order to have a complete change history </h3><br><p>  <em>Examples: a) downloadable files in a commercial blog or news site have a certain value, Subversion becomes extremely relevant to increase the integrity and efficiency of archiving b) an example of constantly updated <a href="https://github.com/firehol/blocklist-ipsets">black lists of addresses of active attacks</a> , without the participation of FutoIn CID.</em> </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_file</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> repo=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cache_dir=$(prep_cache_dir <span class="hljs-variable"><span class="hljs-variable">$repo</span></span>) cid vcs checkout develop --vcsRepo=<span class="hljs-variable"><span class="hljs-variable">$repo</span></span> --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> <span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> date &gt; Timestamp.txt cid vcs commit <span class="hljs-string"><span class="hljs-string">'Updated timestamp'</span></span> Timestamp.txt <span class="hljs-built_in"><span class="hljs-built_in">popd</span></span> } update_file <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${VCS_REPO}</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/f73/432/4c1/f734324c194640df9b1b4a9b90484a34.png" alt="case #4" title="case # 4"></p><br><h3 id="-job-story-5-kazhduyu-noch-trebuetsya-obnovlyat-zavisimosti-vo-vseh-proektah-chtoby-vsegda-ispolzovat-aktualnye-versii">  &gt; Job Story ‚Ññ5: every night, you need to update the dependencies in all projects to always use the current version </h3><br><p>  <em>Note: there may be a bunch of other variations of automated processing of the list of projects.</em> </p><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_project_deps</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> repo=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> cache_dir=$(prep_cache_dir <span class="hljs-variable"><span class="hljs-variable">$repo</span></span>) cid vcs checkout develop --vcsRepo=<span class="hljs-variable"><span class="hljs-variable">$repo</span></span> --wcDir=<span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> <span class="hljs-built_in"><span class="hljs-built_in">pushd</span></span> <span class="hljs-variable"><span class="hljs-variable">$cache_dir</span></span> date &gt; Timestamp.txt <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(cid tool detect); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-variable"><span class="hljs-variable">$t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> npm*|composer*|bundler*) cid tool <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> <span class="hljs-variable"><span class="hljs-variable">$t</span></span> -- update ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> cid vcs commit <span class="hljs-string"><span class="hljs-string">'Updated dependencies'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">popd</span></span> } update_project_deps <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${VCS_REPO}</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/737/855/0a2/7378550a289346d991f095a0b003f5b1.png" alt="case #5" title="case # 5"><br>  <em>No npm / composer / bundler files were added to the example in order not to clutter up.</em> </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  In general, FutoIn CID does not impose any technological processes, but only provides a single lightweight interface to the VCS / SCM for the vast creative work of the admin, DevOps and even the developer on the command line. </p><br><p>  Of course, the interface has not fully settled yet, backward compatible changes are possible.  Any problems found, suggestions and suggestions are <a href="https://github.com/futoin/cid-tool/issues">welcome</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/326928/">https://habr.com/ru/post/326928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326912/index.html">"Computer as a device for communication" or how the future of the Internet was seen in 1968</a></li>
<li><a href="../326914/index.html">Welcome to Android Devs Meetup April 26</a></li>
<li><a href="../326916/index.html">Ten main reasons that make a programmer unhappy</a></li>
<li><a href="../326920/index.html">Yii 1.1.18</a></li>
<li><a href="../326926/index.html">Where to start programming in add. education? Or SmallBasic and all-all-all</a></li>
<li><a href="../326930/index.html">Recovering data from a damaged RAID 50 array</a></li>
<li><a href="../326932/index.html">How often the light is chopped, and how does it end for business</a></li>
<li><a href="../326936/index.html">Pseudo-toning of images: eleven algorithms and sources</a></li>
<li><a href="../326940/index.html">Development of a component for creating collages</a></li>
<li><a href="../326942/index.html">Connect to the webinar: "Azure Stack TP3 Technical Overview." Beginning April 27 at 11:00 (Moscow time)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>