<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deploying Magento 2 Development Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the light of the released new version of Magento - 2.2.0 , I decided to share my personal experience of deploying applications based on this platfo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deploying Magento 2 Development Applications</h1><div class="post__text post__text-html js-mediator-article"><p>  In the light of the released new version of Magento - <a href="http://devdocs.magento.com/guides/v2.2/release-notes/ReleaseNotes2.2.0CE.html">2.2.0</a> , I decided to share my personal experience of deploying applications based on this platform.  The article describes the deployment of the application for the development of modules, and not for the operation of the store (as they say, techies from the techie). </p><br><p><img src="https://habrastorage.org/webt/59/cb/a5/59cba5fa05ee5151575553.png" alt="image"></p><a name="habracut"></a><br><h4>  Introduction </h4><br><p>  After quite a long evolution of the scripts automating the deployment of Magento, I got the following set, which I designed as a sample project: <a href="https://github.com/flancer32/sample_mage2_app">flancer32 / sample_mage2_app</a> .  The project brings up an application for developing a public module <em>"flancer32 / mage2_ext_login_as</em> " (posted on <a href="https://packagist.org/packages/flancer32/mage2_ext_login_as">Packagist'a</a> ) and "private" module " <em>flancer32 / sample_mage2_mod_repo</em> " (available only with <a href="https://github.com/flancer32/sample_mage2_mod_repo">GitHub</a> 'a). </p><br><p>  The scripts were created and tested under Ubuntu 16.04 / PHP 7.0.22 / Composer 1.5.2.  Programs used in scripts (php, composer, mysql, patch, ...) must be installed globally. </p><br><p> Composer access to the corresponding repositories must be configured ( <a href="https://github.com/flancer32/sample_mage2_module">Magento</a> and <a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">Github</a> - file <code>~/.composer/auth.json</code> ): </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"http-basic"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"repo.magento.com"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"ab8303e79d1b86ac2676cda700bb93eb"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"00037fe23c3501389f08c7eaaab0cfda"</span></span> } }, <span class="hljs-attr"><span class="hljs-attr">"github-oauth"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"github.com"</span></span>: <span class="hljs-string"><span class="hljs-string">"9cde8d93840271c509d95707db07a9e1ef374014"</span></span> } }</code> </pre><br><p>  Please create your own access parameters and not use the values ‚Äã‚Äãfrom the example. </p><br><h5>  Application Components </h5><br><p>  In the most general case, the Magento application consists of the following parts: </p><br><ul><li>  Magento 2 platform (standard modules); </li><li>  Own web application modules (including theme); </li><li>  Database; </li><li>  Media data; </li><li>  Configuration; </li></ul><br><h5>  Deployment sequence </h5><br><p>  The composition of the application sets the sequence of routine actions, which is generally reduced to the following: </p><br><ul><li>  configuring the deployment process; </li><li>  deployment of Magento2 platform; </li><li>  installation of web application modules; </li><li>  database initialization; </li><li>  initialization of media files; </li><li>  finalization (setting permissions to files, etc.); </li></ul><br><h4>  Types of scripts </h4><br><p>  All deployment is performed using shell scripts, which can be divided into three groups: </p><br><ul><li>  head script ( <code>deploy.sh</code> ); </li><li>  configuration ( <code>cfg.work.sh</code> ); </li><li>  Worker (performs some part of the deployment work) </li></ul><br><p>  Scripts are not written in the style of <em>user friendly</em> , but rather in the style of <em>friendly user</em> - checking input parameters and compatibility of the requested modes of operation with each other is minimized.  It is assumed that the user who runs the deployment script with the parameters, understands what they mean and how they are compatible with each other. </p><br><h5>  Head script </h5><br><p>  <a href="">deploy.sh</a> </p><br><p>  Its task is to determine the application deployment mode, load the deployment configuration, and run the working scripts in accordance with the specified mode.  Startup parameters <code>deploy.sh</code> : </p><br><pre> <code class="hljs pgsql">$ sh deploy.sh -h Magento2 application deployment script. <span class="hljs-keyword"><span class="hljs-keyword">Usage</span></span>: sh deploy.sh -d [<span class="hljs-keyword"><span class="hljs-keyword">work</span></span>|live] -h -m [developer|production] -E -S <span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>: -d: Web application deployment mode ([<span class="hljs-keyword"><span class="hljs-keyword">work</span></span>|live], <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">work</span></span>); -h: This output; -m: Magento <span class="hljs-number"><span class="hljs-number">2</span></span> itself deployment mode ([developer|production], <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: developer); -E: Existing DB will be used <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'work'</span></span> mode); -S: Skip <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> initialization (Web UI should be used <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> init DB);</code> </pre> <br><p>  Deploying an application without initializing the database (the database is initialized via the Web UI): </p><br><pre> <code class="hljs ruby">$ sh deploy.sh -S</code> </pre> <br><p>  Deploy an application while preserving the existing database (when redeploying, for example): </p><br><pre> <code class="hljs ruby">$ sh deploy.sh -E</code> </pre> <br><p>  Deploying the Magento 2 translation application in production mode (if we are developing an API, for example): </p><br><pre> <code class="hljs ruby">$ sh deploy.sh -m production</code> </pre> <br><p>  The <code>live</code> deployment mode is designed when the application is deployed for use as a store and is not considered in this example. </p><br><h5>  Configuration script </h5><br><p>  <a href="">cfg.init.sh</a> </p><br><p>  Application deployment parameters are written in the usual shell script as environment variables.  The template ( <code>cfg.init.sh</code> ) containing all available variables is copied manually into the configuration file corresponding to the deployment mode ( <code>cfg.work.sh</code> or <code>cfg.live.sh</code> ) and filled in with the appropriate parameters. </p><br><div class="spoiler">  <b class="spoiler_title">Configuration template</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">#!/usr/bin/env bash # filesystem permissions LOCAL_OWNER="owner" LOCAL_GROUP="www-data" # Magento <span class="hljs-number"><span class="hljs-number">2</span></span> installation <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> # see http://devdocs.magento.com/guides/v2<span class="hljs-number"><span class="hljs-number">.0</span></span>/install-gde/install/cli/install-cli-install.html#instgde-install-cli-magento ADMIN_EMAIL="admin@store.com" ADMIN_FIRSTNAME="Store" ADMIN_LASTNAME="Admin" ADMIN_PASSWORD="..." ADMIN_USE_SECURITY_KEY="0" ADMIN_USER="admin" BACKEND_FRONTNAME="admin" BASE_URL="http://mage2.host.org:8080/" CURRENCY="USD" DB_HOST="localhost" DB_NAME="mage2" DB_PASS="..." DB_USER="www" <span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span>="en_US" SECURE_KEY="..." SESSION_SAVE="files" TIMEZONE="UTC" USE_REWRITES="0" USE_SECURE="0" USE_SECURE_ADMIN="0"</code> </pre> </div></div><br><h5>  Working script </h5><br><p>  The work scripts contain a nearly identical header, allowing </p><br><div class="spoiler">  <b class="spoiler_title">fix the place of the script in the hierarchy of other scripts</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"># <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> directory <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> script was launched (<span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) DIR_CUR="$PWD" # Root directory (relative <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> shell script, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the execution <span class="hljs-type"><span class="hljs-type">point</span></span>) # http://pubs.opengroup.org/onlinepubs/<span class="hljs-number"><span class="hljs-number">9699919799</span></span>/utilities/V3_chap02.html#tag_18_06_02 DIR_ROOT=${DIR_ROOT:=`cd "$( dirname "<span class="hljs-meta"><span class="hljs-meta">$0</span></span>" )/../../" &amp;&amp; pwd`}</code> </pre> </div></div><br><p>  and </p><br><div class="spoiler">  <b class="spoiler_title">define the running script separately / in the package and load the config if needed</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">MODE=${MODE} IS_CHAINED="yes" # <span class="hljs-string"><span class="hljs-string">'yes'</span></span> - this script <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> launched <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> chain <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> other scripts, <span class="hljs-string"><span class="hljs-string">'no'</span></span>- standalone launch; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z "$MODE" ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> MODE="work" IS_CHAINED="no" fi # <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">exists</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> deployment config (db <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span>, Magento installation opts, etc.). FILE_CFG=${DIR_ROOT}/cfg.${MODE}.sh <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f "${FILE_CFG}" ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ "${IS_CHAINED}" = "no" ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> # this <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> standalone launch, <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> deployment <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>; echo "There is deployment configuration in ${FILE_CFG}." . ${FILE_CFG} fi <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ "${IS_CHAINED}" = "no" ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> # this <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> standalone launch w/o deployment <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; echo "There is no expected configuration in ${FILE_CFG}. Aborting..." cd ${DIR_CUR} <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> fi fi</code> </pre> </div></div><br><h4>  Configuring the deployment process </h4><br><p>  Everything is simple here - a configuration script is launched that sets the appropriate environment variables: </p><br><pre> <code class="hljs bash">FILE_CFG=<span class="hljs-variable"><span class="hljs-variable">${DIR_ROOT}</span></span>/cfg.<span class="hljs-variable"><span class="hljs-variable">${MODE}</span></span>.sh <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${FILE_CFG}</span></span></span><span class="hljs-string">"</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"There is deployment configuration in </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${FILE_CFG}</span></span></span><span class="hljs-string">."</span></span> . <span class="hljs-variable"><span class="hljs-variable">${FILE_CFG}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"There is no expected configuration in </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${FILE_CFG}</span></span></span><span class="hljs-string">. Aborting..."</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${DIR_CUR}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 255 <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><h4>  Deploying Magento2 Platforms </h4><br><p>  <a href="">deploy / bin / app / mage.sh</a> : </p><br><p>  By and large, it all comes down to creating in the appropriate directory ( <code>work</code> ) </p><br><pre> <code class="hljs lua">DIR_MAGE=${DIR_ROOT}/${MODE} # root folder <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Magento application ... # (re)<span class="hljs-built_in"><span class="hljs-built_in">create</span></span> root folder <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> application deployment <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -d <span class="hljs-string"><span class="hljs-string">"${DIR_MAGE}"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"${MODE}"</span></span> = <span class="hljs-string"><span class="hljs-string">"${MODE_WORK}"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> echo <span class="hljs-string"><span class="hljs-string">"Re-create '${DIR_MAGE}' folder."</span></span> rm -fr ${DIR_MAGE} # <span class="hljs-built_in"><span class="hljs-built_in">remove</span></span> Magento root folder mkdir -p ${DIR_MAGE} # ... <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> it fi <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> mkdir -p ${DIR_MAGE} # just <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> folder <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exist fi echo <span class="hljs-string"><span class="hljs-string">"Magento will be installed into the '${DIR_MAGE}' folder."</span></span></code> </pre> <br><p>  applications through Composer: </p><br><pre> <code class="hljs sql">composer <span class="hljs-keyword"><span class="hljs-keyword">create</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">project</span></span> <span class="hljs-comment"><span class="hljs-comment">--repository-url=https://repo.magento.com/ magento/project-community-edition=2.2.0 ${DIR_MAGE}</span></span></code> </pre> <br><p>  Thus, the root directory for the web server configuration is: <code>${DIR_ROOT}/work</code> </p><br><h4>  Installing web application modules </h4><br><p>  <a href="">deploy / bin / app / own / work.sh</a> </p><br><p>  This part of the process depends on the deployment mode.  First, the application deployment descriptor is configured ( <code>work/composer.json</code> ) - here it is important to pay attention to the version of Composer (for example, <code>composer config minimum-stability</code> does not work on older versions): </p><br><pre> <code class="hljs cmake">echo <span class="hljs-string"><span class="hljs-string">"Configure composer.json"</span></span> composer config minimum-stability dev echo <span class="hljs-string"><span class="hljs-string">"Add custom repositories"</span></span> composer config repositories.local '{<span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"artifact"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"../deploy/repo/"</span></span>}' <span class="hljs-comment"><span class="hljs-comment"># relative to root Mage dir</span></span></code> </pre> <br><p>  then the necessary versions of the necessary modules are installed: </p><br><pre> <code class="hljs pgsql">echo "Add own modules" # <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> module <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Packagist composer require flancer32/mage2_ext_login_as:dev-master # <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> private/<span class="hljs-built_in"><span class="hljs-built_in">public</span></span> GitHub repo &amp; install module <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> this repo composer config repositories.sample_repo vcs https://github.com/flancer32/sample_mage2_mod_repo composer require flancer32/sample_mage2_mod_repo:dev-master # <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> zipped module <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> repository (see deploy/repo/sample_mage2_mod_zip<span class="hljs-number"><span class="hljs-number">-0.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.zip) composer require flancer32/sample_mage2_mod_zip</code> </pre> <br><p>  In this case, we connected two modules to the application for development: </p><br><ul><li>  flancer32 / mage2_ext_login_as </li><li>  flancer32 / sample_mage2_mod_repo </li></ul><br><p>  It remains to indicate to the IDE that these modules are under version control: </p><br><p><img src="https://habrastorage.org/webt/59/cb/a6/59cba673516f7945022909.png" alt="image"></p><br><p>  Optionally, patches can be applied both to third-party modules (as in the case of <code>flancer32/sample_mage2_mod_zip</code> installed from a zip) and to the source files of Magento itself (Magento Team has recently significantly improved the work with edits, but it‚Äôs still necessary to apply the known pill ", which was not included in the extreme release): </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Apply patches"</span></span> patch vendor/flancer32/sample_mage2_mod_zip/etc/module.xml <span class="hljs-variable"><span class="hljs-variable">${DIR_DEPLOY}</span></span>/patch/mod_sequence.patch</code> </pre> <br><p>  In this case, the <a href="https://github.com/flancer32/sample_mage2_app/blob/master/deploy/patch/mod_sequence.patch">third-</a> party <code>flancer32/sample_mage2_mod_zip</code> module is <code>flancer32/sample_mage2_mod_zip</code> to which the boot order is <a href="">added</a> : </p><br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Flancer32_SampleZip"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">setup_version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sequence</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Flancer32_SampleRepo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sequence</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4>  Database Initialization </h4><br><p>  <a href="">deploy / bin / app / db / work.sh</a> <br>  Also depends on the deployment mode and on the startup keys <code>deploy.sh</code> .  Possible option when you need to recreate the database: </p><br><pre> <code class="hljs sql"> echo "<span class="hljs-keyword"><span class="hljs-keyword">Drop</span></span> DB <span class="hljs-string"><span class="hljs-string">'${DB_NAME}'</span></span>.<span class="hljs-string"><span class="hljs-string">" mysqladmin -f -u"</span></span>${DB_USER}<span class="hljs-string"><span class="hljs-string">" -p"</span></span>${DB_PASS}<span class="hljs-string"><span class="hljs-string">" -h"</span></span>${DB_HOST}<span class="hljs-string"><span class="hljs-string">" drop "</span></span>${DB_NAME}<span class="hljs-string"><span class="hljs-string">" echo "</span></span><span class="hljs-keyword"><span class="hljs-keyword">Create</span></span> DB <span class="hljs-string"><span class="hljs-string">'${DB_NAME}'</span></span>.<span class="hljs-string"><span class="hljs-string">" mysqladmin -f -u"</span></span>${DB_USER}<span class="hljs-string"><span class="hljs-string">" -p"</span></span>${DB_PASS}<span class="hljs-string"><span class="hljs-string">" -h"</span></span>${DB_HOST}<span class="hljs-string"><span class="hljs-string">" create "</span></span>${DB_NAME}<span class="hljs-string"><span class="hljs-string">" echo "</span></span>DB <span class="hljs-string"><span class="hljs-string">'${DB_NAME}'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> created.<span class="hljs-string"><span class="hljs-string">" # Full list of the available options: # http://devdocs.magento.com/guides/v2.0/install-gde/install/cli/install-cli-install.html#instgde-install-cli-magento php ${DIR_MAGE}/bin/magento setup:install \ --admin-firstname="</span></span>${ADMIN_FIRSTNAME}<span class="hljs-string"><span class="hljs-string">" \ --admin-lastname="</span></span>${ADMIN_LASTNAME}<span class="hljs-string"><span class="hljs-string">" \ --admin-email="</span></span>${ADMIN_EMAIL}<span class="hljs-string"><span class="hljs-string">" \ --admin-user="</span></span>${ADMIN_USER}<span class="hljs-string"><span class="hljs-string">" \ --admin-password="</span></span>${ADMIN_PASSWORD}<span class="hljs-string"><span class="hljs-string">" \ --base-url="</span></span>${BASE_URL}<span class="hljs-string"><span class="hljs-string">" \ --backend-frontname="</span></span>${BACKEND_FRONTNAME}<span class="hljs-string"><span class="hljs-string">" \ --key="</span></span>${SECURE_KEY}<span class="hljs-string"><span class="hljs-string">" \ --language="</span></span>${<span class="hljs-keyword"><span class="hljs-keyword">LANGUAGE</span></span>}<span class="hljs-string"><span class="hljs-string">" \ --currency="</span></span>${CURRENCY}<span class="hljs-string"><span class="hljs-string">" \ --timezone="</span></span>${TIMEZONE}<span class="hljs-string"><span class="hljs-string">" \ --use-rewrites="</span></span>${USE_REWRITES}<span class="hljs-string"><span class="hljs-string">" \ --use-secure="</span></span>${USE_SECURE}<span class="hljs-string"><span class="hljs-string">" \ --use-secure-admin="</span></span>${USE_SECURE_ADMIN}<span class="hljs-string"><span class="hljs-string">" \ --admin-use-security-key="</span></span>${ADMIN_USE_SECURITY_KEY}<span class="hljs-string"><span class="hljs-string">" \ --session-save="</span></span>${SESSION_SAVE}<span class="hljs-string"><span class="hljs-string">" \ --cleanup-database \ --db-host="</span></span>${DB_HOST}<span class="hljs-string"><span class="hljs-string">" \ --db-name="</span></span>${DB_NAME}<span class="hljs-string"><span class="hljs-string">" \ --db-user="</span></span>${DB_USER}<span class="hljs-string"><span class="hljs-string">" \ --db-password="</span></span>${DB_PASS}<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br><p>  or simply connect the application to an existing database: </p><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">php</span></span> <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento setup:install \ --admin-firstname=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ADMIN_FIRSTNAME}</span></span></span><span class="hljs-string">"</span></span> \ --admin-lastname=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ADMIN_LASTNAME}</span></span></span><span class="hljs-string">"</span></span> \ --admin-email=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ADMIN_EMAIL}</span></span></span><span class="hljs-string">"</span></span> \ --admin-user=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ADMIN_USER}</span></span></span><span class="hljs-string">"</span></span> \ --admin-password=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ADMIN_PASSWORD}</span></span></span><span class="hljs-string">"</span></span> \ --backend-frontname=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${BACKEND_FRONTNAME}</span></span></span><span class="hljs-string">"</span></span> \ --key=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SECURE_KEY}</span></span></span><span class="hljs-string">"</span></span> \ --session-save=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${SESSION_SAVE}</span></span></span><span class="hljs-string">"</span></span> \ --db-host=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_HOST}</span></span></span><span class="hljs-string">"</span></span> \ --db-name=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_NAME}</span></span></span><span class="hljs-string">"</span></span> \ --db-user=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_USER}</span></span></span><span class="hljs-string">"</span></span> \ --db-password=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_PASS}</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><p>  After connecting the application to the database, you can make the tuning of the database  For example: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Additional DB setup."</span></span> MYSQL_EXEC=<span class="hljs-string"><span class="hljs-string">"mysql -u </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_USER}</span></span></span><span class="hljs-string"> --password=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_PASS}</span></span></span><span class="hljs-string"> -D </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DB_NAME}</span></span></span><span class="hljs-string"> -e "</span></span> <span class="hljs-variable"><span class="hljs-variable">${MYSQL_EXEC}</span></span> <span class="hljs-string"><span class="hljs-string">"REPLACE INTO core_config_data SET value = '1', path ='fl32_loginas/controls/customers_grid_action'"</span></span></code> </pre><br><p>  In version 2.2.0, it is possible to register <a href="http://devdocs.magento.com/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-set.html">configuration parameters</a> via the CLI, but not only these parameters can be set directly in the database (for example, set tax rates). </p><br><h4>  Initializing Media Files </h4><br><p>  In general, when deploying a store with a theme, initialization of media files is required (from a backup or cloned from a reference server).  You may skip this step when developing modules.  Skip it. </p><br><h4>  Finalize </h4><br><p>  The finalization can be divided into two parts: specific to the deployment mode and general. </p><br><p>  <a href="">deploy / bin / app / final / work.sh</a> </p><br><p>  Depending on the mode, you can translate the application to developer / production mode, enable / disable the cache, compile the code: </p><br><pre> <code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${OPT_MAGE_RUN}</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"developer"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento deploy:mode:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> developer php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento cache:<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento setup:di:compile <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento deploy:mode:<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> production <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><p>  and run the commands of the installed modules: </p><br><pre> <code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${OPT_USE_EXIST_DB}</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"no"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento fl32:init:catalog php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento fl32:init:customers php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento fl32:init:sales <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><p>  In the end, it is advisable to run cron at least once and re-index (to reduce the abuse in the admin area): </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">php</span></span> <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento indexer:reindex php <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span>/bin/magento cron:run</code> </pre> <br><p>  <a href="">deploy / bin / final.sh</a> </p><br><p>  The overall finalization of the deployment includes the installation of file permissions: </p><br><pre> <code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCAL_OWNER}</span></span></span><span class="hljs-string">"</span></span> ] || [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCAL_GROUP}</span></span></span><span class="hljs-string">"</span></span> ] || [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DIR_MAGE}</span></span></span><span class="hljs-string">"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Skip file system ownership and permissions setup."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Set file system ownership (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCAL_OWNER}</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${LOCAL_GROUP}</span></span></span><span class="hljs-string">) and permissions to '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${DIR_MAGE}</span></span></span><span class="hljs-string">'..."</span></span> chown -R <span class="hljs-variable"><span class="hljs-variable">${LOCAL_OWNER}</span></span>:<span class="hljs-variable"><span class="hljs-variable">${LOCAL_GROUP}</span></span> <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span> find <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> d -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> chmod 770 {} \; find <span class="hljs-variable"><span class="hljs-variable">${DIR_MAGE}</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> chmod 660 {} \; <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-comment"><span class="hljs-comment"># setup permissions for critical files/folders chmod u+x ${DIR_MAGE}/bin/magento chmod -R go-w ${DIR_MAGE}/app/etc</span></span></code> </pre> <br><h4>  Conclusion </h4><br><p>  The process of deploying an application based on Magento 2 described in the article is not universal and can be modified depending on the project. </p><br><p>  As mentioned in ancient times, the next version of Windows can be started to use after the release of the second service pack.  All involved - with the release of Magento 2.2.0!  And Magento Team - perseverance and optimism in this hopelessly lost struggle with the irresistible complexity of the code and the treachery of the requirements !!! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/338866/">https://habr.com/ru/post/338866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338856/index.html">Become a hacker: from ‚ÄúTest lab‚Äù to ‚ÄúCorporate laboratories‚Äù</a></li>
<li><a href="../338858/index.html">How to make gif-animation for Behance and Dribbble?</a></li>
<li><a href="../338860/index.html">We attack DHCP part 2. DHCP + WiFi = MiTM</a></li>
<li><a href="../338862/index.html">DPI-digest: information security, virtualization and regulation</a></li>
<li><a href="../338864/index.html">We attack DHCP part 3. DHCP + Apple = MiTM</a></li>
<li><a href="../338868/index.html">Non-standard clustering 4: Self-Organizing Maps, subtleties, improvements, comparison with t-SNE</a></li>
<li><a href="../338870/index.html">Optimizing TensorFlow on modern Intel architectures</a></li>
<li><a href="../338872/index.html">Startups from Russia: ITMO University Digest</a></li>
<li><a href="../338874/index.html">What is the difference between designing a metro station and designing a cottage?</a></li>
<li><a href="../338876/index.html">Koadic - like Empire, only without powershell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>