<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A tale about how I disassembled Supaplex and almost wrote a clone with 3D graphics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think most people who caught the days of DOS and the early Windows 9x played or at least heard about such a wonderful game like Supaplex. For me per...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A tale about how I disassembled Supaplex and almost wrote a clone with 3D graphics</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/5ca/431/478/5ca43147885a436cbe43496f080a989c.jpg" alt="Picture to attract attention"><br><br>  I think most people who caught the days of DOS and the early Windows 9x played or at least heard about such a wonderful game like Supaplex.  For me personally, this is a legend game.  I still remember with trepidation the long winter evenings spent in an attempt to go through some difficult level on the old 286th. <br><br>  It so happened that I am a programmer.  And not just a programmer, but a computer game programmer.  So, somewhere in 2008, I started writing the ‚ÄúKruze murderer‚Äù engine (or whatever was cool at that time, I don‚Äôt remember).  About a year later, I had an insight that my man-hours for a project of the Unreal Engine level would not be enough.  And I decided to make an easy, ‚Äúcasual‚Äù version of the engine and write a couple of simple toys on it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My choice fell on the Supaplex clone.  True, at that time there were already several clones for Windows and other platforms, so it was not interesting to just write everything from scratch.  But a seditious thought crawled into my head: what if to disassemble the original Supaplex and make a game with logic ‚Äúidentical to the natural‚Äù.  Such a task seemed extremely tempting, and I took up its implementation.  I ordered a 3D model from one good friend of a freelancer, and while he was busy modeling, I began to study the patient.  Immediately I warn you that I don‚Äôt remember many details and can forget or lie something, after all, it was quite a long time ago. <br><a name="habracut"></a><br><h1>  Disassembling </h1><br>  A little running ahead, I note that everything I have left on this project (disassembler scripts, prototype sources) I put on the github.  Look for the link at the end of the article. <br><br>  It all started with the fact that the executable file is either packaged or encrypted.  After an unsuccessful search for something that could unpack it (although I didn‚Äôt look very carefully), it was decided to write my unpacker.  Probably cycling in my blood.  I don‚Äôt remember thoroughly how it worked, but the idea was to emulate CPU instructions to the point when the program started successfully, after which the contents of the memory were saved to disk as an EXE file.  This wonderful decompressor can be found in the materials for the article. <br><br>  I used IDA for disassembling.  As far as I remember, I had to re-create the database several times, so instead of it, I used an idc script that appends names to characters.  You can also find it on the githaba.  If you were interested in digging in the Supaplex guts, but it was difficult to understand the jumble of assembly instructions, this script will help a lot (even if you do not have an IDA, you can use the shifts specified there in any other disassembler). <br><br>  As I was disassembling, I started compiling C ++ - pseudocode, trying to understand what this or that section of the assembler code does.  I dealt with the most complex and incomprehensible blocks with the help of a samopisny debugger, which tracked hit in certain sections of the Supaplex code during the game and informed me about it.  In this way, I tested the hypotheses about the purpose of some sites.  At a later stage, I began to rewrite parts of the code in C ++, continuing to access other parts of the original, which allowed us to verify the correctness of the disassembly of each block. <br><br>  The result of all this was the almost pure C ++ code of game logic, with a small inset of goto and variables with strange names like byte_403C3.  You will also find it in the materials for the article. <br><br><h1>  3D version </h1><br>  The prototype looks like this: <br><br><img src="https://habrastorage.org/files/edd/204/f32/edd204f32f9d4e378a5cd6b3a3f7e137.jpg" alt="Screenshot"><br><br>  A little bit about the engine.  The code of the engine itself is quite voluminous, although it is simple and non-functional to ugliness.  The original, ‚Äúbig‚Äù engine was written using the Qt library.  Then for some reason I decided to give it up (I don‚Äôt remember the details) and wrote my own replacement for the Qt classes. <br><br>  For drawing old OpenGL with extensions is used.  There is an interesting detail in the engine: if I remember correctly, at that time OpenGL 2.0 and GLSL were not very common (at least my laptop with an Intel video card did not know how).  I took from Mesa (open-source implementation of OpenGL) a compiler from GLSL to assembler shaders.  As a result, shaders are written in GLSL, but the engine even works on very old hardware. <br><br>  The game has no menu or at least some user interface.  In the resources lies the original levels. Dat from Supaplex.  By default, the game starts at the first level, but if you create the file level.cfg in the directory with the binary and write the level number (from 1 to 111) there, the game will start at the selected level.  The control is the same as in the original - the arrows move the character (by the way, his name is Murphy) in the selected direction, the space + arrow eats the object in the specified direction without moving the character, prolonged retention of the space sets the red disk (if you have them, of course) .  Pressing Esc leads to instant suicide (hello, Roskomnadzor!). <br><br><h1>  Sources </h1><br>  At the time of development, I used the SVN repository.  I perezalil all in Git and a little bit ‚Äúcombed‚Äù the code so that it was going not only on Windows, but also on Linux with OSX.  Everything is available on github: <a href="https://github.com/zapolnov/superplex3d_prototype">github.com/zapolnov/superplex3d_prototype</a> , going to CMake.  There are also binaries for particularly impatient. <br><br>  I do not plan to develop this project yet.  I translate all my code into public domain, all art is available under the CC Attribution-NonCommercial-ShareAlike license.  Sounds and music downloaded from these your Internet and their license is unknown to me. <br><br>  For obvious reasons, the disassembled code of the game logic (supaplex_game.cpp, as well as its version in the disassembly directory) is provided for informational purposes only, after reading it, you must burn or eat, and forget everything that you see there. </div><p>Source: <a href="https://habr.com/ru/post/246027/">https://habr.com/ru/post/246027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246017/index.html">Information objects or the reason for one misconception</a></li>
<li><a href="../246019/index.html">Single Page Application in Cloud Storage</a></li>
<li><a href="../246021/index.html">Install and configure CA Infrastructure Management. Part one. Performance management</a></li>
<li><a href="../246023/index.html">Mobile game on Unity. The first pancake ...</a></li>
<li><a href="../246025/index.html">Grab full control over someone else's Digital Ocean cloud (Doorkeeper vulnerability)</a></li>
<li><a href="../246029/index.html">Dnipropetrovsk Ciklum Speakers' Corner with Igor Kryzhanovsky: UX is not UI. ‚ÄúThe Art of Washing the Elephant‚Äù, December 18</a></li>
<li><a href="../246031/index.html">More features with the new version of products DevExpress 14.2</a></li>
<li><a href="../246037/index.html">2 powerful psychological techniques for a significant increase in conversion</a></li>
<li><a href="../246039/index.html">Onto-engineer: from the creation of the world to the generation of entities</a></li>
<li><a href="../246041/index.html">Rails or Sinatra: the best of both worlds?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>