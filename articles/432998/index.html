<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Christmas story</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We want to share a story that happened on one of our projects on New Year's Eve. The essence of the project is that it automates the work of doctors i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Christmas story</h1><div class="post__text post__text-html js-mediator-article">  We want to share a story that happened on one of our projects on New Year's Eve.  The essence of the project is that it automates the work of doctors in medical institutions.  During the patient's visit, the doctor records information on a dictaphone, then the audio recording is transcribed.  After the transcription process - i.e.  making audio recordings into text - a medical document is compiled according to the relevant standards and sent back to the clinic where the audio recording came from, where the sending doctor receives it, checks and approves  After passing the mandatory checks, the document is sent to the final patients. <br><a name="habracut"></a><br>  All medical institutions using the product can be divided into two large groups: <br><br><ul><li>  Hosting in the data center of our client, who is fully responsible for the performance of the application, both for the software and for the hardware.  For example, if disk space runs out, or there is not enough server performance on the CPU; </li><li>  Self-hosted: they place all the equipment directly at themselves and are responsible for its performance.  Our client provides them with the application and its support. </li></ul><br>  This is how our team interacts with end servers hosted directly in our client‚Äôs cloud. <br><br><img src="https://habrastorage.org/webt/fu/dh/qb/fudhqbrny8p_r3wcs4swokhglqw.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We have access to these servers to carry out all the planned work and maintenance that is required. <br><br>  The second group is self-hosted clients - for them the client cloud acts as a gateway through which we connect to these servers.  We have limited rights in this case, and often we cannot perform any operations due to security settings.  We connect to the servers via RDP - Remote Desktop Protocol on Windows OS.  Naturally, this all works through VPN. <br><br>  Here we must bear in mind that each server represented in the diagram is in fact a bundle of an application server and a database server.  On the database server, MS SQL Server DBMS and SSRS reporting service are installed respectively.  Moreover, the MSSQL Server version is different in all clinics: 2008, 2012, 2014. In addition to the versions themselves, different Service Packs and patches are installed everywhere.  In general, a complete zoo. <br><br>  We have an IIS web server and ElasticSearch installed on the application server.  ElasticSearch is a search engine, which also implements full-text search. <br>  The main entity in terms of our product is ‚Äújob‚Äù (job).  Work is an abstract entity that binds together all the information related to a particular patient's reception.  This information includes: <br><br><ul><li>  data about the doctor; </li><li>  patient information; </li><li>  information about the visit; </li><li>  audio file (doctor's speech); </li><li>  documents (several versions); </li><li>  work processing history; </li><li>  information about the department, etc. </li></ul><br>  This diagram shows a simplified database schema, from which you can see the relationships between the main tables.  This is only the base part, in fact in the database of more than 200 tables. <br><br><img src="https://habrastorage.org/webt/sc/ke/hl/sckehlss-czi3bz2kagmfecrroy.png"><br><br>  A little about the clinic where the incident happened: <br><br><ul><li>  1500-2000 works per day; </li><li>  1000+ active users (doctors + secretaries); </li><li>  Self-hosted. </li></ul><br>  DB: <br><br><ul><li>  Size: 800+ Gb (750K + works, 2M + documents); </li><li>  DBMS: MS SQL Server 2008 R2; </li><li>  Recovery Model: Simple. </li></ul><br>  Here I want to make a little explanation.  There are 3 recovery models in SQL Server: simple, bulk-logged, and full.  I will not speak about the third now, I will explain about the first and second.  The main difference is that in the simple model, we do not keep a transaction history in the log ‚Äî once the transaction has been committed, the record from the transaction log will be deleted.  When using the full recovery mode, the entire history of data changes is stored in the transaction log.  What does this give us?  In case of some unforeseen situation, when we need to roll back the database from the backup, we can return not only to some specific backup, but we can return to any point in time, up to a certain transaction, i.e. In backups, not only is a certain state of the database at the time of backup, but also the whole is a history of data changes. <br><br>  I think it‚Äôs not worth explaining that the simple mode is used only in development, on test servers and its use in production is unacceptable.  Not at all. <br><br>  But the clinic, apparently, had its own thoughts on this subject;) <br><br><h3>  Start </h3><br>  A few days later, the New Year, everyone is preparing for the holiday, buying presents, decorating Christmas trees, holding corporate parties and are waiting for a long weekend. <br><br><h6>  December 22 (Friday) 1 day </h6><br>  <strong>14:31</strong> The client said that he had not received another daily report.  The report arrives at the mail twice a day on a schedule; it is needed to control the sending of data to an external integration system, which is not too critical. <br><br>  There could be several reasons: <br><br><ol><li>  Problems with SMTP, letters simply were not delivered (changed the password, for example, and did not tell anyone); </li><li>  Problems on the server side of the report; </li><li>  Something is wrong with the database. </li></ol><br>  <strong>16:03 The</strong> clinic sometimes changes the password to SMTP, without warning anyone about it, so after finishing the current tasks, we calmly check the report manually by launching through the web interface ‚Äî we get an error that indicates problems in the database. <br><br>  An example of an error that we received when running the report. <br><br><pre><code class="plaintext hljs">SQL Server detected a logical consistency-based I/O error: incorrect checksum (expected: 0x9876641f; actual: 0xa3255fbf). It occurred during a read of page (1:876) in database ID 7 at offset 0x000000006d8000 in file 'D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\MSSQL\DATA\ServerLive.mdf'.</code> </pre> <br>  This indicates that there are damaged pages in the database.  We had a slight feeling of anxiety. <br><br>  <strong>20:53</strong> In order to assess the extent of damage, we launch the database check using the special command <strong><em>DBCC CHECKDB</em></strong> .  Depending on the size of the damage, the verification team can take quite a long time, so we launch the command in the night.  Here we are lucky that this happened on Friday afternoon, that is, we had at least the whole weekend to solve this problem. <br><br>  At that moment the situation was as follows: <br><br><img src="https://habrastorage.org/webt/dp/nq/jm/dpnqjm7rvkmtjtxoc534js439zq.png"><br><br><h6>  December 23 (Saturday) 2nd day </h6><br>  <strong>10:02</strong> In the morning, we find out that checking the database using CHECKDB has stopped - this was due to the lack of free disk space, since  the tempdb temporary database is actively used in the verification process, and at some point the free disk space just ran out. <br><br>  Therefore, instead of checking the entire database, we decide to immediately launch a public check.  To do this, use the <strong><em>DBCC CHECKTABLE command</em></strong> . <br><br>  <strong>10:46</strong> We decide to start with the JobHistory table, which is probably damaged, because it was used to generate the report.  This table, as can be understood from the title, keeps the history of all works, i.e., transitions of work between stages. <br><br>  Run <strong><em>DBCC CHECKTABLE ('dbo.JobHistory')</em></strong> . <br><br>  Checking this table reveals damaged tables in the database, which in principle was expected. <br><br>  <strong>12:00</strong> At the moment, if the database used the full recovery model, we could restore the damaged pages from the backup, and that would be the end of it, but our database was in simple mode.  Therefore, the only option for repairing damage is to launch the same command with the special parameter <strong><em>REPAIR_ALLOW_DATA_LOSS</em></strong> .  In this case, data loss is possible. <br><br>  We start.  The check again fails - we get an error that the recovery of this table is impossible until the linked tables are restored.  The history table refers to the work table (Jobs) by the foreign key, therefore, we conclude that there is also damage in the main work table (Jobs). <br><br>  <strong>13:30</strong> The next step is to check the Jobs table, while hoping that the damage is in the index, not in the data.  In this case, it will be enough for us to simply rebuild the index for data recovery. <br><br>  <strong>17:33</strong> After a while, we discover that our server is unavailable via RDP.  It was probably turned off, the check was not completed, the work was suspended.  We inform the clinic that the server is unavailable, please raise it. <br><br>  Light anxiety takes very specific forms. <br><br><h6>  December 24 (Sunday) 3rd day </h6><br>  <strong>14:31</strong> Closer to the dinner server is raised, re-start checking the Jobs table. <br>  <strong><em>DBCC CHECKTABLE ('dbo.Jobs')</em></strong> <br><br>  <strong>16:05</strong> Verification is not complete, the server is unavailable.  Again. <br><br>  After some time, the server is again unavailable, before we could complete the check of the table.  At this moment, the IT clinic service performs a series of server checks.  We are waiting for the completion of work. <br><br>  Due to holidays, communication between us and the client was slow - we were waiting for answers to questions for several hours. <br><br><h6>  December 25 (Monday - Christmas) 4th day </h6><br>  <strong>16:00</strong> The next day, the server was raised, the client has Christmas, and we again start checking the table, but this time we exclude the indexes from the check, and leave only the data check.  And after a while the server is again unavailable. <br><br>  What is going on? <br><br>  At this moment, thoughts begin to creep in that this is not just a coincidence, and there is a suspicion that it could be damage at the level of iron (a hard disk fell down).  We assume that there are bad sectors on the disk and when the check tries to read data from these sectors, the system crashes.  We inform on the assumption to the client. <br><br>  The client runs a disk check on the host machine. <br><br>  <strong>17:19</strong> IT clinic service reported that the virtual machine file is damaged - this is bad! ( <br>  We still can not work, and wait for the signal when they fix the problem and we can continue our work. <br><br><h6>  December 26 (Tuesday) 5th day </h6><br>  <strong>14:05</strong> IT clinic service starts another disk recovery process.  We were told that we can run CHECKTABLE in parallel to check the table.  We start the scan again - the virtual is crashing again, we inform the client that the virtual machine file is still damaged. <br><br>  These days all communications with the customer are very slow with a huge time lag due to holidays. <br><br><h6>  December 27 (Wednesday) 6th day </h6><br>  <strong>14:00</strong> Run the disk check using Windows tools - <strong>checkdisk</strong> inside the virtual machine - no problems identified. <br>  The database is in the Simple mode, so the chances of correcting the current database by means of the DBMS tend to zero, since  we are unable to repair individual damaged pages. <br>  We begin to consider the option of rolling back and restoring the database from backup. <br>  We check the backups of the database and find out that backups were not made using DBMS tools, the last backup was in 2014, i.e.  There are no backups.  Why not done - a separate question, it is the responsibility of the clinic to ensure the health and safety of the database. <br><br>  There is a high probability that it will not be possible to restore the current database, we begin to consider other options for rollback. <br><br>  Let's take a closer look at the situation with backups in the clinic. <br><br>  Backup situation: <br><br><ul><li>  There is no backup database (!!!) </li><li>  There is no snapshot of a virtual machine either (!?) </li><li>  But there are disk backups (full + inc) </li></ul><br>  The database is on disk D, respectively, they made weekly full backups and daily incremental backups. <br><br><ul><li>  every Friday at 20:00 full backup </li><li>  every day incremental backup </li><li>  there is a full backup from the 15th and 22nd </li><li>  there are daily backups up to the 21st </li></ul><br>  Those.  in principle, we can roll back to the state before the problem occurs. <br>  We are waiting for the update from the clinic to start rolling back the database from the backup. <br><br>  At the same time, the clinic sent a request to an iron supplier (HP) marked ‚Äúurgent‚Äù. <br><br><h6>  December 28 (Thursday) 7th day </h6><br>  <strong>13:13 The</strong> IT service of the clinic begins setting up a new virtual machine, since  Fix the damage in the file of the old virtual machine does not work. <br><br>  <strong>19:09</strong> A new virtual <strong>machine is</strong> available with SQL Server installed. <br>  The next step is to restore the database from the disk backup.  To begin with, we decide to roll back to the 22nd, if the problem is still present, then we roll back to the 21st, 20th, and so on, until we reach a working state. <br><br>  It was the 28th in the courtyard, we are at a corporate party, and here we are informed that the clinic has problems with restoring the backup, because the backups are EMPTY! <br><br>  Here is the news! <br><br>  During the recovery of the backup of disk D from the 21st, it turns out that it is empty, like all the others.  Directly backups Schr√∂dinger obtained - they seem to be as it is, but at the same time, they are not.  It is not completely clear how this happened at all, but, as far as we were able to understand, the problem is not enough space on the disk to store disk backups.  They allocated 500 Gb backups for storage, but at the time of the incident the database already weighed 800 Gb, therefore, in principle, the backup could not be passed successfully.  Those.  backups were regularly done on a schedule, but due to lack of space, they ended up with an error and were therefore empty, and the IT-service of the clinic did not even bother to check that everything was fine with them.  Do not do it this way. <br><br><h6>  December 29 (Friday) 8th day </h6><br>  <strong>13:11</strong> Discussion of further action.  Possible options: <br><br><ul><li>  Trying to copy the database files (.ldf + .two files) - the chances of success are very low; </li><li>  Trying to make a backup database - again, the chances are very small; </li><li>  Set up replication - may work. </li></ul><br>  On the new server, 1 Tb disk was allocated, which is obviously not enough if we try to backup and restore from it, because  in the worst case, without compression, the backup will take up as much space as the original database, i.e.  800 Gb. <br>  Please add space on the new server and proceed to copying the database files. <br>  A database has been created on the new server and the database schema has been restored - this will allow at least to process new jobs.  The clinic will at least be able to accept new patients using this system. <br><br>  <strong>14:36</strong> Therefore, we proceed to option number one, although we don‚Äôt expect much success. <br>  Stop the SQL Server, start copying the data file (mdf) and log (ldf). <br><br>  <strong>16:13</strong> After one and a half, the log file was copied successfully (48 Gb), and 50 GB of data file were already copied (795 of 846 GB left).  At this speed, it will take about 12 hours to complete the copy. <br><br>  <strong>16:30</strong> Old database server turned off while copying a file, which is quite expected. <br><br>  <strong>17:09</strong> Therefore, we move on to the next option ‚Äî setting up replication; in this case, we can specify which data will be replicated, that is, we can first exclude obviously damaged tables and copy the intact data first, and then transfer the problem tables in parts.  But this option, unfortunately, also does not work, since we cannot even create a publication with certain tables due to database damage. <br>  Consider more options for transferring data. <br><br>  <strong>20:01</strong> In the end, we start simply to transfer data from the old to the new server in a regular manner by importing and exporting in order of priority. <br><br>  <strong>21:35</strong> First, the most critical data, then archived and less critical data (~ 300 GB).  In the first wave of exports, less than 300 GB of data remained.  Table Documents is also excluded (300GB).  Run the copy process in the night. <br><br><h6>  December 30 (Saturday) 9th day </h6><br>  <strong>15:00 We</strong> continue to transfer data.  Jobs table is not available at all.  The main part of the tables was copied by this time. <br>  But without <strong>Jobs,</strong> it's all useless, because it is the main link between all the data and gives them meaning and value from a business point of view.  Without it, we simply have a fragmented set of data that we can‚Äôt use. <br><br>  Also at this point the restoration of the database schema is complete. <br><br>  <strong>Consequences of the incident:</strong> <br><br>  By this moment we have a huge loss of live data. <br>  Those.  Formally, we have some data in the database, but, in fact, there is no way to use them or link them together, so we can talk about complete data loss. <br>  More than 750,000 patient admissions have been lost. <br><br>  This is really sad! <br><br><ul><li>  This is a huge blow to the reputation of our client, which can turn into big business problems for them when entering into new contracts and finding new customers. </li><li>  The loss of such amount of data for the clinic can face serious problems and fines, because  this is confidential data containing medical confidentiality and, in a direct sense, people's lives depend on it. </li></ul><br>  We began to think what we can do in this situation.  Began to sort through the system to find clues. <br><br>  <strong>15:16</strong> Analyzing all aspects of the system, we understand that we can try to extract the missing data from the ElasticSearch index.  The fact of the matter is that due to the incorrect configuration of the ElasticSearch indexes, it stores not only the fields by which full-text search is performed, but everything, that is, in fact, there is a complete copy of the data and we can theoretically extract data from there about jobs and put them back into our database.  It is hoped that the data will still be restored. <br><br>  A bug that you can put a monument! <br><br><img src="https://habrastorage.org/webt/oy/62/nt/oy62ntr-iiercftfvwmd_gzoide.png"><br><br>  <strong>18:00 The</strong> utility for data extraction was quickly written and after a few hours we are convinced that the approach works and the data will be restored. <br><br>  <strong>20:00</strong> Started restoring works from ElasticSearch with the help of a written utility.  The approach worked, data about the work can be restored.  In parallel, we begin to extract the latest versions of the document for each work. <br><br><h6>  December 31 (Sunday - New Year) 10th day </h6><br>  <strong>14:09</strong> During the night, 188,811 works were restored. <br><br>  <strong>20:13</strong> Seeing our success, the clinic decides to postpone the transfer of the server to the HP service in order to give us time to extract the maximum data from the old server. <br>  With such news, we met the New Year)) <br><br><h6>  January 01 (Monday) 11th day </h6><br>  <strong>11:23</strong> Preparation for launching the system after the incident: <br><br><ul><li>  reconfigured IIS on the App server; </li><li>  migrated all the necessary services to work with the new database server; </li><li>  restored triggers, stored procedures, functions. </li></ul><br>  <strong>14:28</strong> Then they began to copy a table of documents, which was skipped during the initial transfer due to its large size. <br>  - The old DB server has shut down again.  It is obvious that the Documents table is also damaged; it is with it that all information on patients is stored.  Fortunately, it is not completely damaged, we can make requests to it, and when a request to us returns a damaged record, at this moment the server crashes and turns off.  Part of the data in this case we can extract. <br><br>  Accordingly, we signal the client, they raise the server, and in parallel we continue to prepare the new database for the launch of the system. <br><br>  <strong>18:01</strong> Restoring all integrity constraints after transferring the main part of the data. <br><br>  <strong>22:02</strong> Restoring constraints completed.  We just carried the raw data to the maximum.  The presence of integrity constraints would greatly complicate our task. <br><br><h6>  January 02 (Tuesday) 12th day </h6><br>  <strong>05:52</strong> Old DB server turned off again while copying the document.  He is promptly picked up so that we can continue to work. <br><br>  <strong>09:00</strong> Batch managed to recover about 200.000 documents (approximately 20%) <br>  We started using different recovery methods: sorting by different columns to retrieve data from the end or beginning of the table, until we hit some damaged part of the table. <br><br>  <strong>13:42</strong> Started copying archival works in the table - it is, fortunately, not damaged. <br><br>  <strong>17:08</strong> Restored all archival work (491,380 pieces). <br><br>  The system is ready to launch: users can create and process new jobs. <br><br>  Unfortunately, due to partial damage to the table of documents, you can not just transfer all the data from it, as with other tables, because  The table is partially damaged.  Therefore, when you try to retrieve all the data, the request falls with an error when you try to read damaged pages.  Therefore, we extract the data point-wise, using different sorts and sample size: <br><br><ul><li>  Sort by different fields (ID, DateTime); </li><li>  Sort ascending, descending; </li><li>  Work with small groups of lines (1000, 100); </li><li>  Retrieving jobs by id. </li></ul><br><br><h6>  January 03 (Wednesday) 13th day </h6><br>  <strong>08:58</strong> Continued the process of recovering documents.  Documents were restored only for active, unfinished work.  By this time 1000 works (active) without documents. <br><br>  <strong>11:38</strong> Moved all SQL Jobs <br><br>  <strong>13:17</strong> 5 works without documents, 231 work is missing, but there is an audio file, you need to resynchronize. <br><br><h6>  January 4 (Thursday) 14th day </h6><br>  Started manual restoration and verification of remaining work. <br>  The system works, monitoring and correction of errors in online mode. <br><br><h6>  January 05 (Friday) 15th day </h6><br>  Reports are scheduled for migration to SSRS. <br>  Transfer to the new server is impossible, because  In the clinic, an older version of SQL Server was installed and the database could not be moved from the old server. <br><br>  Options: <br><br><ul><li>  Upgrade SQL Server from 2008 to 2008 R2; </li><li>  Customize everything from scratch. </li></ul><br>  It was decided to wait for the update of SQL Server. <br><br>  <strong>09:21</strong> Background restoration of documents for completed works started - the process is long and will take several days. <br><br>  <strong>13:28</strong> Change the priority of the recovery of documents by department. <br><br>  <strong>18:18</strong> Clinic gave access to SMTP, mail setup <br><br><h3>  Result: </h3><br><ul><li>  Almost all data was recovered (only 5 works were lost); </li><li>  Recommendations on database maintenance were issued to prevent such situations; </li><li>  Configured database backups using SQL Server; </li><li>  Additional monitoring for back-ups from our side, alerts in case of file. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/432998/">https://habr.com/ru/post/432998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432988/index.html">Eighth Webmaster. Live on Habr√©</a></li>
<li><a href="../432990/index.html">Edison Wooden Lamp with voice control. Issue price of $ 5</a></li>
<li><a href="../432992/index.html">Put on headphones and died: we deal with the strange death of a schoolboy in Rembau</a></li>
<li><a href="../432994/index.html">Vivaldi 2.2 - Quantity, turning into quality</a></li>
<li><a href="../432996/index.html">Some dictionary internals in CPython (and PyPy)</a></li>
<li><a href="../433000/index.html">Compiling Kotlin: JetBrains VS ANTLR VS JavaCC</a></li>
<li><a href="../433002/index.html">Go yourself on ... or the rules of communication in a team</a></li>
<li><a href="../433004/index.html">Reliable cloud migration strategy in 2019: 7 tips</a></li>
<li><a href="../433008/index.html">USB devices - "sudden" threat</a></li>
<li><a href="../433010/index.html">There is an idea: permissions system for npm-packages</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>