<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Oracle 12c Data Redaction. Hiding information from unprivileged users</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task of sharing data access in information systems always arises. One way or another, it needs to be addressed. If access to the database is possi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Oracle 12c Data Redaction. Hiding information from unprivileged users</h1><div class="post__text post__text-html js-mediator-article">  The task of sharing data access in information systems always arises.  One way or another, it needs to be addressed.  If access to the database is possible only from the application server, then you can assign this responsibility to it.  But almost always there is a need for direct access to data, for example, for analysts or system supplier personnel. <br>  The article discusses the possibility of partial concealment of information, access to which is strictly limited.  Immediately remember about the <abbr title="About personal data">152-FZ</abbr> . <br><a name="habracut"></a><br>  Starting with version 8, there is a <a href="http://www.oracle.com/technetwork/database/security/virtual-private-database/oracle-virtual-private-database-1964778.html">Virtual Private Database (VPD)</a> in Oracle Database.  VPD allows, depending on different conditions, to hide part of the table or view records from users.  The disadvantage stems from the merits - concealment is possible only for full records.  This is done by adding additional conditions in the where part of the sql query. <br><br>  In Oracle 12c, the ability to change the values ‚Äã‚Äãof fields returned by the sql query (in whole or in part) is added, depending on the conditions.  This feature is called <a href="http://docs.oracle.com/cd/E16655_01/network.121/e17729/redaction.htm">Oracle Data Redaction</a> and consists of applying a special <a href="http://docs.oracle.com/cd/E16655_01/network.121/e17729/redaction_config.htm">policy</a> . <br><br>  All management of Data Redaction is concentrated in the <a href="http://docs.oracle.com/cd/E16655_01/appdev.121/e17602/d_redact.htm">DBMS_REDACT</a> package.  It is important that to apply a policy to an object, you do not need to have any access to the object itself.  <b>EXEMPT REDACTION POLICY</b> privileges <b>are</b> not covered by this mechanism. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider the use of Data Redaction in the following example: <br><br>  There is a table CLIENT_INFO containing personal data - date of birth, phone, email and credit card number.  In the database there is a role R_VIP, whose owners see the full information.  The rest should see the edited version. <br><div class="spoiler">  <b class="spoiler_title">table and test record</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> CLIENT_INFO ( <span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NUMBER</span></span>, F_NAME VARCHAR2(<span class="hljs-number"><span class="hljs-number">64</span></span>), <span class="hljs-comment"><span class="hljs-comment">/* */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span> VARCHAR2(<span class="hljs-number"><span class="hljs-number">64</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> S_NAME VARCHAR2(<span class="hljs-number"><span class="hljs-number">64</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> BIRTHDAY <span class="hljs-built_in"><span class="hljs-built_in">DATE</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> PHONE VARCHAR2(<span class="hljs-number"><span class="hljs-number">32</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> EMAIL VARCHAR2(<span class="hljs-number"><span class="hljs-number">64</span></span>), <span class="hljs-comment"><span class="hljs-comment">/* email */</span></span> CCARD VARCHAR2(<span class="hljs-number"><span class="hljs-number">32</span></span>), <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">"CLIENT_INFO_PK"</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">"ID"</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> CLIENT_INFO <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">to_date</span></span>(<span class="hljs-string"><span class="hljs-string">'15-05-1986'</span></span>, <span class="hljs-string"><span class="hljs-string">'DD-MM-YYYY'</span></span>), <span class="hljs-string"><span class="hljs-string">'79763334589'</span></span>, <span class="hljs-string"><span class="hljs-string">'ivan@dom2.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'5767881897856776'</span></span>);</code> </pre> </div></div><br>  Create a policy called redact_client_info and add a rule according to which the date of birth is replaced by the first number: <br><div class="spoiler">  <b class="spoiler_title">policy</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> DBMS_REDACT.ADD_POLICY( object_schema =&gt; <span class="hljs-string"><span class="hljs-string">'TEST'</span></span>, object_name =&gt; <span class="hljs-string"><span class="hljs-string">'CLIENT_INFO'</span></span>, column_name =&gt; <span class="hljs-string"><span class="hljs-string">'BIRTHDAY'</span></span>, policy_name =&gt; <span class="hljs-string"><span class="hljs-string">'redact_client_info'</span></span>, function_type =&gt; DBMS_REDACT.PARTIAL, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> function_parameters =&gt; <span class="hljs-string"><span class="hljs-string">'Md01Y'</span></span>, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> expression =&gt; <span class="hljs-string"><span class="hljs-string">'SYS_CONTEXT(''SYS_SESSION_ROLES'',''R_VIP'') = ''FALSE'''</span></span> <span class="hljs-comment"><span class="hljs-comment">/*  -     R_VIP */</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; /</code> </pre></div></div><br>  Add a condition to the policy to show only the last 5 digits of the phone: <br><div class="spoiler">  <b class="spoiler_title">policy</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> DBMS_REDACT.ALTER_POLICY( object_schema =&gt; <span class="hljs-string"><span class="hljs-string">'TEST'</span></span>, object_name =&gt; <span class="hljs-string"><span class="hljs-string">'CLIENT_INFO'</span></span>, column_name =&gt; <span class="hljs-string"><span class="hljs-string">'PHONE'</span></span>, policy_name =&gt; <span class="hljs-string"><span class="hljs-string">'redact_client_info'</span></span>, function_type =&gt; DBMS_REDACT.REGEXP, <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> regexp_pattern =&gt; <span class="hljs-string"><span class="hljs-string">'\d+(\d{5})$'</span></span>, regexp_replace_string =&gt; <span class="hljs-string"><span class="hljs-string">'******\1'</span></span>, regexp_position =&gt; DBMS_REDACT.RE_BEGINNING, regexp_occurrence =&gt; DBMS_REDACT.RE_ALL, expression =&gt; <span class="hljs-string"><span class="hljs-string">'SYS_CONTEXT(''SYS_SESSION_ROLES'',''R_VIP'') = ''FALSE'''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> =&gt; DBMS_REDACT.ADD_COLUMN ); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; /</code> </pre></div></div><br>  Add a condition to hide the email domain in the policy: <br><div class="spoiler">  <b class="spoiler_title">policy</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> DBMS_REDACT.ALTER_POLICY( object_schema =&gt; <span class="hljs-string"><span class="hljs-string">'TEST'</span></span>, object_name =&gt; <span class="hljs-string"><span class="hljs-string">'CLIENT_INFO'</span></span>, column_name =&gt; <span class="hljs-string"><span class="hljs-string">'EMAIL'</span></span>, policy_name =&gt; <span class="hljs-string"><span class="hljs-string">'redact_client_info'</span></span>, function_type =&gt; DBMS_REDACT.REGEXP, regexp_pattern =&gt; DBMS_REDACT.RE_PATTERN_EMAIL_ADDRESS, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> regexp_replace_string =&gt; DBMS_REDACT.RE_REDACT_EMAIL_DOMAIN, <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> expression =&gt; <span class="hljs-string"><span class="hljs-string">'SYS_CONTEXT(''SYS_SESSION_ROLES'',''R_VIP'') = ''FALSE'''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> =&gt; DBMS_REDACT.ADD_COLUMN ); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; /</code> </pre></div></div><br>  Finally, we mask the credit card number: <br><div class="spoiler">  <b class="spoiler_title">policy</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> DBMS_REDACT.ALTER_POLICY( object_schema =&gt; <span class="hljs-string"><span class="hljs-string">'TEST'</span></span>, object_name =&gt; <span class="hljs-string"><span class="hljs-string">'CLIENT_INFO'</span></span>, column_name =&gt; <span class="hljs-string"><span class="hljs-string">'CCARD'</span></span>, policy_name =&gt; <span class="hljs-string"><span class="hljs-string">'redact_client_info'</span></span>, function_type =&gt; DBMS_REDACT.REGEXP, regexp_pattern =&gt; DBMS_REDACT.RE_PATTERN_CC_L6_T4, regexp_replace_string =&gt; DBMS_REDACT.RE_REDACT_CC_MIDDLE_DIGITS, expression =&gt; <span class="hljs-string"><span class="hljs-string">'SYS_CONTEXT(''SYS_SESSION_ROLES'',''R_VIP'') = ''FALSE'''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">action</span></span> =&gt; DBMS_REDACT.ADD_COLUMN ); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; /</code> </pre></div></div><br>  Execute select from a user who does not have the R_VIP role: <br><pre> <code class="sql hljs">SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> f_name, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, birthday, email, phone, ccard <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test.client_info; F_NAME NAME BIRTHDAY EMAIL PHONE CCARD <span class="hljs-comment"><span class="hljs-comment">---------- ---------- --------------- --------------- --------------- ----------------   01-MAY-86 ivan@xxxxx.com ******34589 576788XXXXXX6776</span></span></code> </pre><br>  And from a user with this role: <br><pre> <code class="sql hljs">SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> f_name, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, birthday, email, phone, ccard <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> test.client_info; F_NAME NAME BIRTHDAY EMAIL PHONE CCARD <span class="hljs-comment"><span class="hljs-comment">---------- ---------- --------------- --------------- --------------- ----------------   15-MAY-86 ivan@dom2.ru 79763334589 5767881897856776</span></span></code> </pre><br>  As a result, all the records are visible in the queries, but the values ‚Äã‚Äãof the fields for the user not having the R_VIP role are changed. <br><br>  Plus the use of Data Redaction in preserving the semantics of data, but at the same time the unsuitability of specific values ‚Äã‚Äãfor unauthorized use. <br><br><h3>  Important addition </h3><br>  In the course of further discussion and study of the work of this mechanism, it became clear that the data is masked only during the withdrawal.  That is, in the where part, open data is used.  And as a result, you can get all the open data by substituting your function in where: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> (s varchar2(<span class="hljs-number"><span class="hljs-number">128</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> f(ds varchar2) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> varchar2 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRAGMA</span></span> AUTONOMOUS_TRANSACTION; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>(ds); <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>; return ds; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; SQL&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, email <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> client_info c <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> f(email) <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> <span class="hljs-string"><span class="hljs-string">'%dom%'</span></span>; NAME EMAIL <span class="hljs-comment"><span class="hljs-comment">---------- ---------------  ivan@xxxxx.com SQL&gt; select * from log; S ---------------- ivan@dom2.ru ivan@gmail.com</span></span></code> </pre><br></div><p>Source: <a href="https://habr.com/ru/post/185768/">https://habr.com/ru/post/185768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185754/index.html">Unlocking AES-NI on Lenovo U310</a></li>
<li><a href="../185756/index.html">4K video of Saturn and its satellites</a></li>
<li><a href="../185760/index.html">Infinite non-repeating textures using Van's mosaic</a></li>
<li><a href="../185764/index.html">Device file UEFI BIOS, part and a half: UEFI Platform Initialization</a></li>
<li><a href="../185766/index.html">Vkontakte iOS SDK v2</a></li>
<li><a href="../185770/index.html">QLiveBittorrent - console bittorrent client for viewing files before downloading</a></li>
<li><a href="../185772/index.html">Technology companies recognize sarcasm</a></li>
<li><a href="../185774/index.html">UEFI BIOS File Device Part Two: UEFI Firmware Volume and its contents</a></li>
<li><a href="../185778/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ64 (June 30 - July 6, 2013)</a></li>
<li><a href="../185782/index.html">VDS in the Netherlands Intel Xeon X3440 / 2-3 GB RAM / 220 GB HDD RAID1 / 25Mbps Unmetered - $ 29 / month</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>