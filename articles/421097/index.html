<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>UIViewController composition and navigation between them (and not only)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to share the experience that we have successfully used for several years in our iOS applications, 3 of which are currently in t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>UIViewController composition and navigation between them (and not only)</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/x7/yt/ll/x7ytllwqwgvgxy2rvtmdwj3qkia.png"></p><br><p>  In this article I want to share the experience that we have successfully used for several years in our iOS applications, 3 of which are currently in the Appstore.  This approach has proven itself well and recently we have segregated it from the rest of the code and designed it into a separate library <a href="https://github.com/saksdirect/route-composer">RouteComposer</a> which will be discussed here. </p><a name="habracut"></a><br><p>  <a href="https://github.com/saksdirect/route-composer">https://github.com/saksdirect/route-composer</a> </p><br><p>  But, for a start, let's try to figure out what is meant by the composition of the controller view in iOS. </p><br><p> Before proceeding to the explanations, I remind you that in iOS most often is meant by a view controller or a <code>UIViewController</code> .  This is a class inherited from the standard <code>UIViewController</code> , which is the basic MVC pattern controller that Apple recommends using for developing iOS applications. </p><br><p>  You can use alternative architectural patterns such as MVVM, VIP, VIPER, but the <code>UIViewController</code> will also be involved in them <code>UIViewController</code> way or another, which means that this library can be used with them.  The essence of a <code>UIViewController</code> used to control a <code>UIView</code> , which most often represents a screen or a significant part of the screen, processes events from it and displays some data in it. </p><br><p><img src="https://habrastorage.org/webt/5v/ia/-3/5via-37-mfc9leww-hwfvcu20eg.png"></p><br><p>  All <code>UIViewController</code> can be conditionally divided into <strong>Regular View Controllers</strong> , which are responsible for some visible area on the screen, and <strong>Container View Controllers</strong> , which, in addition to displaying themselves and some of their controls, can also display child view controllers integrated into them in one way or another. . </p><br><p>  The standard container view controllers supplied with Cocoa Touch can be considered: <code>UINavigationConroller</code> , <code>UITabBarController</code> , <code>UISplitController</code> , <code>UIPageController</code> and some others.  Also, the user can create his own custom container view view controllers following the Cocoa Touch rules described in the Apple documentation. </p><br><p>  The process of introducing standard view viewers into a container view view controllers, as well as integrating view viewers into a view view stack, we will call the <strong>composition</strong> in this article. </p><br><p>  Why the standard solution for the composition of the view controllers was not optimal for us and we developed a library to facilitate our work. </p><br><p>  Let's consider to begin with the composition of some standard container view view controllers for example: </p><br><h3 id="primery-kompozicii-v-standartnyh-konteynerah">  Composition examples in standard containers </h3><br><h4 id="uinavigationcontroller"> <code>UINavigationController</code> </h4> <br><p><img src="https://habrastorage.org/webt/zx/fc/su/zxfcsucgp6qusx4kkkfccphmzz0.png"></p><br><pre> <code class="hljs bash"><span class="hljs-built_in"><span class="hljs-built_in">let</span></span> tableViewController = UITableViewController(style: .plain) //        <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> navigationController = UINavigationController(rootViewController: tableViewController) // ... //        <span class="hljs-built_in"><span class="hljs-built_in">let</span></span> detailViewController = UIViewController(nibName: <span class="hljs-string"><span class="hljs-string">"DetailViewController"</span></span>, bundle: nil) navigationController.pushViewController(detailViewController, animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) // ... //     navigationController.popToRootViewController(animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br><h4 id="uitabbarcontroller"> <code>UITabBarController</code> </h4> <br><p><img src="https://habrastorage.org/webt/vi/2t/bx/vi2tbxjzyl9xs_rhrcpbx9p9lp8.png"></p><br><pre> <code class="hljs objectivec">let firstViewController = <span class="hljs-built_in"><span class="hljs-built_in">UITableViewController</span></span>(style: .plain) let secondViewController = <span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let tabBarController = UITabBarController() //         tabBarController.viewControllers = [firstViewController, secondViewController] //        tabBarController.selectedViewController = secondViewController</span></span></code> </pre> <br><h4 id="uisplitviewcontroller"> <code>UISplitViewController</code> </h4> <br><p><img src="https://habrastorage.org/webt/gs/jx/ll/gsjxllx4rm_tjpukwtawibmffsg.png"></p><br><pre> <code class="hljs objectivec">let firstViewController = <span class="hljs-built_in"><span class="hljs-built_in">UITableViewController</span></span>(style: .plain) let secondViewController = <span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span>() <span class="hljs-comment"><span class="hljs-comment">//   let splitViewController = UISplitViewController() //        splitViewController.viewControllers = [firstViewController] //        splitViewController.showDetailViewController(secondViewController, sender: nil)</span></span></code> </pre> <br><h3 id="primery-integracii-kompozicii-vyu-kotrollerov-v-stek">  Examples of integration (composition) twist controllers into the stack </h3><br><h4 id="ustanovka-vyu-kontrolera-rutom">  Installing a view of the controller by the root </h4><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>: UIWindow = <span class="hljs-comment"><span class="hljs-comment">//... window.rootViewController = viewController window.makeKeyAndVisible()</span></span></code> </pre> <br><h4 id="modalnaya-prezentaciya-vyu-kontrolera">  Modal presentation of the view controller </h4><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">window</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.rootViewController</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.present</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">splitViewController</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">animated</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">animated</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">completion</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">nil</span></span>)</code> </pre> <br><h3 id="pochemu-my-reshili-sozdat-biblioteku-dlya-kompozicii">  Why we decided to create a library for composition </h3><br><p>  As can be seen from the examples above, there is no single way to integrate normal viewers of controllers into containers, as there is no single way to build a stack of viewers.  And, if you want to slightly change the layout of your application or its navigation method, as you need significant changes to the application code, you will also need links to container objects so that you can insert your view controllers, etc. into them.  That is, the standard way itself implies a fairly large amount of work, as well as the presence of references to twist checkers for generating actions and the presentation of other checkers. </p><br><p>  All this is given a headache by the various ways of deep linking to the application (for example, using Universal links), since you have to answer the question: <em>what if the controller of which you need to show the user as he clicked the link in the safari is already shown, or I twist the controller who has to show it has not yet been created</em> , forcing you to walk through the tree with a view of the controllers and write code from which sometimes the eyes bleed and which any iOS developer tries to hide.  In addition, unlike the Android architecture where each screen is built separately, in iOS, to show some part of the application immediately after launching, you may need to build a large enough stack of view controllers that will be hidden under the one that you show on request. </p><br><p>  It would be great to simply call methods like <code>goToAccount()</code> , <code>goToMenu()</code> or <code>goToProduct(withId: "012345")</code> when a user clicks a button or when an application <code>goToProduct(withId: "012345")</code> universal link from another application and does not think about integrating this controller view into the stack, knowing that the creator of this twist controller has already provided this implementation. </p><br><p>  In addition, often, our applications consist of a huge number of screens developed by different teams, and to get to one of the screens in the development process, you need to go through another screen that may not yet have been created.  In our company, we used the approach we call the <em>Petri dish</em> .  That is, in the development mode, the developer and the tester can see a list of all application screens and he can go to any of them (of course, some of them may require some input parameters). </p><br><p><img src="https://habrastorage.org/webt/5l/wx/cv/5lwxcvup0mtdaedrgjsxokbsdti.png"></p><br><p>  You can interact with them and test them individually, and then assemble them into the final application for production.  Such an approach greatly facilitates development, but, as you have seen from the examples above, the composition hell begins when you need to keep in the code several ways of integrating the controller's twist into the stack. </p><br><p>  It remains to add that this will all be multiplied by N as soon as your marketing team expresses a desire to conduct A / B testing on live users and check which navigation method works better, for example, a tab bar or a hamburger menu? </p><br><ul><li><del>  Let's cut off Susanin's legs </del>  Let's show 50% of Tab Bar users and the Hamburger menu to others and in a month we will tell you which users see more of our special offers? </li></ul><br><p>  I will try to tell you how we approached the solution of this problem and eventually allocated it to the RouteComposer library. </p><br><h3 id="susanin-route-composer"><del>  Susanin </del>  Route composer </h3><br><p>  After analyzing all the scenarios of composition and navigation, we tried to abstract the code given in the examples above and identified 3 main entities of which the <a href="https://github.com/saksdirect/route-composer">RouteComposer</a> library ‚Äî <code>Factory</code> , <code>Finder</code> , <code>Action</code> ‚Äî consists and operates.  In addition, the library contains 3 auxiliary entities that are responsible for the small tuning that may be required during the navigation process - <code>RoutingInterceptor</code> , <code>ContextTask</code> , <code>PostRoutingTask</code> .  All these entities must be configured in a chain of dependencies and transferred to <code>Router</code> y - the object that will build your stack of view controllers. </p><br><p>  But, about each of them in order: </p><br><h4 id="factory">  Factory </h4><br><p>  As the name implies <code>Factory</code> is responsible for creating a view controller. </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController</span></span> }</code> </pre> <br><p>  It is also important to discuss the concept of <strong>context</strong> .  The context within the library, we call all that I might need to twist the controller in order to be created.  For example, in order to show the controller a view showing the details of the product, it is necessary to transfer some productID to it, for example, as a <code>String</code> .  The essence of the context can be anything: an object, a structure, a block, or a tuple.  If your controller does not need anything to be created - the context can be specified as <code>Any?</code>  and set to <code>nil</code> . </p><br><p>  For example: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFactory</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Factory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with productID: UUID)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> productViewController = <span class="hljs-type"><span class="hljs-type">ProductViewController</span></span>(nibName: <span class="hljs-string"><span class="hljs-string">"ProductViewController"</span></span>, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) productViewController.productID = productID <span class="hljs-comment"><span class="hljs-comment">//  ,      `ContextAction`,     return productViewController } }</span></span></code> </pre> <br><p>  From the implementation above, it becomes clear that this factory will load the controller image from the XIB file and set the transferred productID to it.  In addition to the standard <code>Factory</code> protocol, the library provides several standard implementations of this protocol in order to save you from writing banal code (in particular, given in the example above). </p><br><p>  Further, I will refrain from giving descriptions of the protocols and examples of their implementations, since you can get acquainted with them in detail by downloading the example supplied with the library.  There are various implementations of factories for ordinary viewers of controllers and containers, as well as ways to configure them. </p><br><h4 id="action">  Action </h4><br><p>  The essence of <code>Action</code> is a description of how to integrate the view of the controller, which will be built by the factory, onto the stack.  After the creation, the controller cannot simply hang in the air and, therefore, each factory must contain an <code>Action</code> as can be seen from the example above. </p><br><p>  The most commonplace implementation of <code>Action</code> is a modal controller presentation: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> PresentModally: Action { func <span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(viewController: UIViewController, <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> existingController: UIViewController, animated: <span class="hljs-type"><span class="hljs-type">Bool</span></span>, completion: @escaping (_: ActionResult) -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { guard existingController.presentedViewController == nil <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { completion(.failure("\(existingController) is already presenting a view controller.")) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } existingController.present(viewController, animated: animated, completion: { completion(.continueRouting) }) } }</code> </pre> <br><p>  The library contains the implementation of most of the standard methods for integrating view controllers onto a stack, and you probably don‚Äôt have to create your own until you use a custom container view view controller or presentation method.  But creating custom actions should not cause problems if you look at examples. </p><br><h4 id="finder">  Finder </h4><br><p>  The <code>Finder</code> entity answers the router to the question <em>- Has the controller already created such a twist and is it already on the stack?</em>  <em>Perhaps nothing is needed to be created and it is enough to show what is already there?</em>  . </p><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Finder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">ViewController</span></span>: <span class="hljs-type"><span class="hljs-type">UIViewController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">Context</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findViewController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with context: Context)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">ViewController?</span></span> }</code> </pre> <br><p>  If you store references to all the controllers you create with a view, then in your <code>Finder</code> implementation you can simply return a reference to the controller view you want.  But more often it is not so, because the application stack, especially if it is large, changes quite dynamically.  In addition, you can have several identical controllers twist in a stack showing different entities (for example, several ProductViewControllers showing different products with different productID), therefore the <code>Finder</code> implementation may require custom implementation and search for the corresponding controller twist.  The library facilitates this task by providing <code>StackIteratingFinder</code> as an extension to <code>Finder</code> , a protocol with the appropriate settings to simplify this task.  In the implementation of <code>StackIteratingFinder</code> you only need to answer the question - is this controller view the controller that the router is looking for at your request? </p><br><p>  An example of such an implementation: </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductViewControllerFinder</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StackIteratingFinder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(options: <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span> = .currentAndUp) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.options = options } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isTarget</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> productViewController: ProductViewController, with productID: UUID)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> productViewController.productID == productID } }</code> </pre> <br><h3 id="vspomogatelnye-suschnosti">  Helper Entities </h3><br><h4 id="routinginterceptor"> <code>RoutingInterceptor</code> </h4> <br><p>  <code>RoutingInterceptor</code> allows you to perform some actions with the <code>RoutingInterceptor</code> before starting the composition and tell the router whether the view controllers can be integrated into the stack.  The most commonplace example of such a task is authentication (but not at all commonplace in implementation).  For example, you want to show a controller view with user account details, but for this, the user must be logged in to the system.  You can implement <code>RoutingInterceptor</code> and add it to the configuration of the controller of user details and check inside: if the user is logged in - allow the router to continue navigation, if not - show the controller view that prompts the user to login and if this action is successful - allow the router to continue navigation or cancel her if the user refuses to login. </p><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginInterceptor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoutingInterceptor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> destination: AppDestination, completion: @escaping </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">: InterceptorResult)</span></span></span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Void</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> !<span class="hljs-type"><span class="hljs-type">LoginManager</span></span>.sharedInstance.isUserLoggedIn <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... //  LoginViewController       completion(.success)  completion(.failure("User has not been logged in.")) // ... return } completion(.success) } }</span></span></code> </pre><br><p>  The implementation of such a <code>RoutingInterceptor</code> with comments is contained in the example supplied with the library. </p><br><h4 id="contexttask"> <code>ContextTask</code> </h4> <br><p>  The <code>ContextTask</code> , if you provide it, can be applied separately to each controller in the configuration, regardless of whether it was just created by the router or was found on the stack, and you just want to update the data in it and set some default Parameters (for example, show the close or not show button). </p><br><h4 id="postroutingtask"> <code>PostRoutingTask</code> </h4> <br><p>  The implementation of <code>PostRoutingTask</code> will be called by the router after successfully completing the integration of the controller <code>PostRoutingTask</code> have <code>PostRoutingTask</code> stack.  In its implementation, it is convenient to add various analytics or pull various services. </p><br><p>  <strong>In more detail with the implementation of all the described entities can be found in the documentation for the library as well as in the attached example.</strong> </p><br><p>  PS: The number of auxiliary entities that can be added to the configuration is unlimited. </p><br><h3 id="konfiguraciya">  Configuration </h3><br><p>  All the entities described are good in that they break up the composition process into small, interchangeable and well-trusting blocks. </p><br><p>  We now turn to the most important thing - to the configuration, that is, the connection of these blocks together.  In order to collect these blocks among themselves and combine them into a chain of steps, the library provides the builder class <code>StepAssembly</code> (for containers, <code>ContainerStepAssembly</code> ).  Its implementation allows stringing the composition blocks into a single configuration object as beads on a thread, as well as specifying dependencies on the configurations of other controllers.  What to do with the configuration in the future is up to you.  You can feed it to the router with the necessary parameters and it will build a stack of controllers for you, you can save it to the dictionary and later use it by key - it depends on your specific task. </p><br><p>  Consider a trivial example: Suppose that by clicking on a cell in the list or when the application receives a universal link from a safari or email client, we need to show the product controller with a certain productID in a modal view.  At the same time I twist the product controller to be built inside a <code>UINavigationController</code> , so that it can show its name and close the button on its control panel.  In addition, this product can only be shown to users who are logged in, otherwise invite them to log in. </p><br><p>  If you analyze this example without using the library, it will look something like this: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ProductArrayViewController: UITableViewController { let products: [<span class="hljs-type"><span class="hljs-type">UUID</span></span>]? let analyticsManager = AnalyticsManager.sharedInstance //  UITableViewControllerDelegate override func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } //   LoginInterceptor guard !LoginManager.sharedInstance.isUserLoggedIn <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //    LoginViewController         `showProduct(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: productID)` <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } showProduct(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: productID) } func showProduct(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> productID: String) { //   ProductViewControllerFactory let productViewController = ProductViewController(nibName: "ProductViewController", bundle: nil) //   ProductViewControllerContextTask productViewController.productID = productID //   NavigationControllerStep  PushToNavigationAction let navigationController = UINavigationController(rootViewController: productViewController) //   GenericActions.PresentModally present(alertController, animated: navigationController) { [weak self]   . ProductViewControllerPostTask self?.analyticsManager.trackProductView(productID: productID) } } }</code> </pre> <br><p>  This example does not include the implementation of universal links, which will require isolating the authorization code and saving the context where the user should be sent after, as well as the search, suddenly the user clicked the link, and this product has already been shown to him, which ultimately makes the code quite hard to read. </p><br><p>  <strong>Consider the configuration of this example using the library:</strong> </p><br><pre> <code class="hljs pgsql">let productScreen = StepAssembly(finder: ProductViewControllerFinder(), factory: ProductViewControllerFactory()) //  : .adding(LoginInterceptor()) .adding(ProductViewControllerContextTask()) .adding(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) //  : .<span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(PushToNavigationAction()) .<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(NavigationControllerStep()) // NavigationControllerStep -&gt; StepAssembly(finder: NilFinder(), factory: NavigationControllerFactory()) .<span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(GeneralAction.presentModally()) .<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(GeneralStep.<span class="hljs-keyword"><span class="hljs-keyword">current</span></span>()) .assemble()</code> </pre> <br><p>  To translate this into human language: </p><br><ul><li>  Check that the user is logged in, and if not offer him a login </li><li>  If the user is successfully logged in, continue </li><li>  Search for product view controller provided by <code>Finder</code> </li><li>  If found, make visible and finish. </li><li>  If not found, create a <code>UINavigationController</code> , integrate into it a view controller created by <code>ProductViewControllerFactory</code> using <code>PushToNavigationAction</code> </li><li>  <code>GenericActions.PresentModally</code> <code>UINavigationController</code> using <code>GenericActions.PresentModally</code> from the current controller <code>GenericActions.PresentModally</code> </li></ul><br><p>  Configuration requires some study as well as many complex solutions, such as the concept of <code>AutoLayout</code> and, at first glance, it may seem complicated and redundant.  However, the number of tasks solved by the given code fragment covers all aspects from authorization to deep-linking, and the breakdown into sequence of actions makes it possible to easily change the configuration without the need to make changes to the code.  In addition, the implementation of <code>StepAssembly</code> will help you avoid problems with an unfinished chain of steps, and type control will help you with problems with the incompatibility of input parameters for different controller views. </p><br><p>  Consider the pseudo-code of the complete application in which in a certain <code>ProductArrayViewController</code> list of products is displayed and, if the user selects this product, shows it depending on whether the user is logged in or not, or offers to log in and shows after successful login: </p><br><p>  <strong>Configuration objects</strong> </p><br><pre> <code class="hljs pgsql">// `RoutingDestination`    .          . struct AppDestination: RoutingDestination { let finalStep: RoutingStep let context: <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span>? } struct <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> { //     ,             static func productDestination(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> productID: <span class="hljs-type"><span class="hljs-type">UUID</span></span>) -&gt; AppDestination { let productScreen = StepAssembly(finder: ProductViewControllerFinder(), factory: ProductViewControllerFactory()) .<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(LoginInterceptor()) .<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(ProductViewControllerContextTask()) .<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(ProductViewControllerPostTask(analyticsManager: AnalyticsManager.sharedInstance)) .<span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(PushToNavigationAction()) .<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(NavigationControllerStep()) .<span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(GenericActions.PresentModally()) .<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>(CurrentControllerStep()) .assemble() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> AppDestination(finalStep: productScreen, context: productID) } }</code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductArrayViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UITableViewController { let products: [UUID]? //... // DefaultRouter -  Router   </span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">  UIViewController   let router = DefaultRouter</span></span></span></span>() <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) { guard let productID = products[indexPath.row] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } router.navigate(to: Configuration.productDestination(with: productID)) } }</code> </pre> <br><p> <strong>  </strong> </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@UIApplicationMain</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIResponder</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">UIApplicationDelegate { //... func application</span></span></span></span>(_ application: UIApplication, <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> url: URL, sourceApplication: String?, <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>: Any) -&gt; Bool { guard let productID = UniversalLinksManager.parse(url: url) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DefaultRouter().navigate(to: Configuration.productDestination(with: productID)) == .handled } }</code> </pre><br><p>              . </p><br><p>             . ,          , ,           ‚Äî       ProductArrayViewController,      UINavigationController   HomeViewController ‚Äî         <code>StepAssembly</code>  <code>from()</code> .     <code>RouteComposer</code> ,      (     ).  ,      <code>Configuration</code>               .     ,      A/B ,         . </p><br><h3 id="vmesto-zaklyucheniya">  Instead of conclusion </h3><br><p>   ,      3       .     ,  ,       .   <code>Fabric</code> , <code>Finder</code>  <code>Action</code>            .   ,     ‚Äî              ,    ,       .          ,      . </p><br><p> ,      ,      objective c       Cocoa Touch,             .     iOS  9  12. </p><br><p>            <code>UIViewController</code>  (MVC, MVVM, VIP, RIB, VIPER  ..) </p><br><p>      ,   ,     ,   .         .            . </p><br><p>      . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/421097/">https://habr.com/ru/post/421097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421087/index.html">How to configure the web application warm on Go for Gitlab on VDS</a></li>
<li><a href="../421089/index.html">Russian providers have figured out how to pass on to Google part of the cost of the ‚ÄúSpring package‚Äù</a></li>
<li><a href="../421091/index.html">How we reduced the time to develop scoring models five times by switching to Python</a></li>
<li><a href="../421093/index.html">How I study the Spring framework - part 2 (help for beginners is the work of the beginners themselves)</a></li>
<li><a href="../421095/index.html">Under the new bill on pre-trial blocking can get 19 million sites</a></li>
<li><a href="../421099/index.html">Is it hard to concentrate? Maybe it's not your fault</a></li>
<li><a href="../421101/index.html">"Calendar of the tester" for August. Read the book</a></li>
<li><a href="../421103/index.html">First look at Mavic 2: fly longer, quieter, faster</a></li>
<li><a href="../421105/index.html">Situation: Spotify makes direct deals with musicians - labels are unhappy</a></li>
<li><a href="../421107/index.html">Disassemble and review qualified certificates using Python / Tkinter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>