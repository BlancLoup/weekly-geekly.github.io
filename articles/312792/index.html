<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Enum-switch antipattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I often see an interesting pattern in the code. It lies in the fact that to describe a small set of objects, an enum is created, and then in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Enum-switch antipattern</h1><div class="post__text post__text-html js-mediator-article">  Recently, I often see an interesting pattern in the code.  It lies in the fact that to describe a small set of objects, an enum is created, and then in different places of the code, the values ‚Äã‚Äãfrom the enumeration are processed using the switch operator. <br><br>  What does the implementation of this template look like and how is it dangerous?  Let's see. <br><a name="habracut"></a><br><h2>  Task Description </h2><br>  Suppose a team is developing a text editor and is going to implement support for several programming languages ‚Äã‚Äãin it.  Of course, not everyone, because there are not enough resources for this, and there will not be much point in it. <br><br>  An enumeration is created to store the list of supported languages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">enum language</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Language { Java, CSharp, TSQL }</code> </pre> <br></div></div><br>  For the work of the editor in different places you need to get some parameters that depend on a specific language.  For this, the following functions are created: <br><br><div class="spoiler">  <b class="spoiler_title">GetExtensions (Language lang)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExtensions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Language lang</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (lang) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.Java: { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); result.Add(<span class="hljs-string"><span class="hljs-string">"java"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.CSharp: { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); result.Add(<span class="hljs-string"><span class="hljs-string">"cs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.TSQL: { List&lt;String&gt; result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); result.Add(<span class="hljs-string"><span class="hljs-string">"sql"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">" "</span></span> + lang + <span class="hljs-string"><span class="hljs-string">"  "</span></span>); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">IsCaseSensitive (Language lang)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsCaseSensitive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Language lang</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (lang) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.Java: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.CSharp: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.TSQL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">" "</span></span> + lang + <span class="hljs-string"><span class="hljs-string">"  "</span></span>); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">GetIconFile (Language lang)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIconFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Language lang</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (lang) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.Java: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"bean.svg"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.CSharp: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"cs.svg"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.TSQL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"tsql.svg"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">" "</span></span> + lang + <span class="hljs-string"><span class="hljs-string">"  "</span></span>); } }</code> </pre><br></div></div><br>  Throwing an exception at the end forces the compiler, which needs to ensure the guaranteed result of each function, and the C # compiler cannot control the completeness of the set of values ‚Äã‚Äãcovered by the switch operator.  And if the default icon for any new programming language can be thought up in advance, then it is impossible to determine in advance whether an unknown language is case-sensitive, and what extension its source codes will have, so an exception is thrown. <br><br>  As a result, at first a fairly simple picture emerges.  All supported languages ‚Äã‚Äãare collected in one place.  Where it is necessary to define something depending on the language, a switch is inserted.  One developer to implement support for 2-3 languages ‚Äã‚Äãat the same time is very easy.  But later with the support and development of the program based on this template, there will be serious problems. <br><br><h2>  Disadvantages of using enum-switch </h2><br>  The fact is that such an approach creates god objects.  The enum itself and each switch play the role of god objects.  Any change associated with one of the programming languages ‚Äã‚Äãsupported by the editor will require making a change to all god objects.  By working on Java support, you can break code related to C # or TransactSQL. <br><br>  It will not be possible to distribute languages ‚Äã‚Äãbetween several developers, so that each implements support in our editor of any one separate language.  Developers will have to make changes to the same files, and combining the improvements can easily break the working code. <br><br>  The complexity of adding support for a new language will constantly grow, because the size of switch statements will increase, and it will be more and more difficult to control them.  Such a program cannot be called quality, because good programs should eventually become better, simpler and cheaper in development and support. <br><br>  Using the enum-switch approach, developers connect entities with rigid connections, which in reality are practically unrelated to each other.  There can be nothing in common between TransactSQL and Java except that someone wanted to open them in one text editor.  But in the program code, TransactSQL and Java ended up in the same enum type. <br><br>  This is a manifestation of the god-object anti-pattern. <br><br>  However, this pattern can be found manifestation and other antipatterns.  The developers of a text editor do not participate in the development of programming languages, they are only engaged in the implementation of the logic of their own software product.  Therefore, for the editor, language features are external data that it should be able to process.  Here this data is part of the code.  That is, it turned out a kind of hardcoding.  If Java is released, in which the source files will have an extension from one letter J, then you will have to redo the editor and check if other languages ‚Äã‚Äãare broken. <br><br>  So, the parameters of the individual instances of the set described in the program are the data that should be separated as much as possible from the code that implements the behavior of the program. <br><br>  The switch statement often specifies a connection between entities from different sets.  In our example, this is the connection between a programming language and an icon.  However, the relationship between entities is also an entity, and it should be treated as with all other data, for example, stored in a table column.  If it is not possible to use external storage, then at least write the link to the Dictionary. <br><br><div class="spoiler">  <b class="spoiler_title">Dictionary</b> <div class="spoiler_text"><pre> <code class="cs hljs">Dictionary&lt;Language, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; icons = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Language, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); icons[Language.Java] = <span class="hljs-string"><span class="hljs-string">"bean.svg"</span></span>; icons[Language.CSharp] = <span class="hljs-string"><span class="hljs-string">"cs.svg"</span></span>; icons[Language.TSQL] = <span class="hljs-string"><span class="hljs-string">"tsql.svg"</span></span>;</code> </pre><br></div></div><br>  At the same time, the switch statement has another unpleasant side effect.  It not only sets the connection between objects, but is itself a connection.  To make it clear what this is about, consider the following example: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (lang) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.TSQL: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> Language.PLSQL: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sql.svg"</span></span>; ... }</code> </pre><br>  Two SQL dialects are assigned an icon sql.svg.  Now, the language has not only an icon, but also an implicit property, which means that the TransactSQL and PL-SQL languages ‚Äã‚Äãshould have the same icons.  A developer who wants to change the icon for PL-SQL will decide whether he should change the icon for TransactSQL.  In most cases, this is undesirable. <br><br>  And finally, the enum-switch antipattern contributes to the manifestation of an error like ‚ÄúThis value from enum is not provided‚Äù, because it is difficult to control when adding a new value to enum full coverage in all switch statements. <br><br><h2>  There is an exit </h2><br>  What should be done to avoid the use of this template? <br><br>  <s>In any incomprehensible situation, start the interface.</s>  In order not to use enum, get the interface.  The interface should return information about the properties of an object from the described set.  Add a name to this interface that was previously stored in a constant in enum. <br><br><div class="spoiler">  <b class="spoiler_title">Interface</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">Language</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsCaseSensitive</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIconFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">List&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetExtensions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br></div></div><br>  The creation of specific objects that implement this interface, assign a separate class provider. <br><br><div class="spoiler">  <b class="spoiler_title">Provider</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LanguageProvider</span></span> { <span class="hljs-function"><span class="hljs-function">List&lt;Language&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSupportedLanguages</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... } <span class="hljs-function"><span class="hljs-function">Language </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DetectLanguageByFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileName</span></span></span><span class="hljs-function">)</span></span> { ... } <span class="hljs-function"><span class="hljs-function">Language </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDefaultLanguage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... } }</code> </pre><br></div></div><br>  To store descriptions of objects, you can use any framework.  You can hard-code parameters, you can take values ‚Äã‚Äãfrom the database, from configuration files, download from an external resource, beat the default object configuration.  The provider implementation will not affect the operation of classes using the objects created by the provider. <br><br>  Now remove all functions that contain switch, if you had them.  You will no longer need them, because the code does not process specific objects, but their properties. <br><br>  In the example above, after the text editor supports 10‚Äì15 different programming languages, adding another language will be reduced to listing the settings from the list of already implemented ones.  After all, although there are a lot of programming languages, most of the nuances that affect the editing of source codes are common. <br><br><h2>  Why do I need enum </h2><br>  Why is it that in most programming languages ‚Äã‚Äãthere is such a type as enum? <br><br>  It is convenient to use it if you do it with some caution.  First of all, the enum can be applied where the number of objects is small.  Each developer determines the permissible limit at his discretion.  I wouldn‚Äôt merge more than 20 constants into enum. <br><br>  The described set should consist of objects, the differences between which can be parameterized.  For example, the days of the week differ from each other only in the sequence number, so they are well described in terms of the enum.  And here any weather phenomena to enumerate in enum rather not worth it, because they have very little in common. <br><br>  The set of enumerated objects must be either fixed, in which new values ‚Äã‚Äãno longer appear, or internal, which is fully defined and used only within one program. <br><br>  Typical examples of the use of enum: <br><br><ul><li>  enum Boolean {True, False} </li><li>  days of the week month </li><li>  finite state machine </li></ul></div><p>Source: <a href="https://habr.com/ru/post/312792/">https://habr.com/ru/post/312792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312778/index.html">OpenShift v 3 III. OpenShift Origin 1.3</a></li>
<li><a href="../312780/index.html">Joanna Hoffman - Steve Jobs's ‚ÄúGuardian Angel‚Äù</a></li>
<li><a href="../312782/index.html">Basics of Auto Layout - Concept, structure, application</a></li>
<li><a href="../312784/index.html">NPM module support in backend as a service Scorocode</a></li>
<li><a href="../312786/index.html">October 22 in Moscow - a jitter for Java seniors: meeting with the CEO and the Crossover team</a></li>
<li><a href="../312794/index.html">The digest of interesting materials for the Mobile Developer # 175 (October 10-16)</a></li>
<li><a href="../312796/index.html">Donald Knut: How the ‚ÄúArt of Programming‚Äù was created (33,38,39 / 97)</a></li>
<li><a href="../312800/index.html">Introducing 3CX V15 SP2 with Debian Linux 8 support</a></li>
<li><a href="../312806/index.html">How neural networks are now used: from research projects to entertainment services</a></li>
<li><a href="../312808/index.html">Project AirGig: Broadband Power Line Access</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>