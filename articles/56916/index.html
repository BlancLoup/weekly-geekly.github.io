<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ejabberd + AD + Shared Roster</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 To begin with, we have: a small network on ~ 150 machines, mainly with Windows XP, a domain raised naturally on Windows 2k3 and a normal ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ejabberd + AD + Shared Roster</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  To begin with, we have: a small network on ~ 150 machines, mainly with Windows XP, a domain raised naturally on Windows 2k3 and a normal machine (or server) on which gentoo linux is installed (optionally MySQL). <br><br>  Task: Install a jabber server, make a shared roster, with groups from AD, attach an icq gate to it and put the jabber clients on the working machines. <br><a name="habracut"></a><br>  <strong>Install ejabberd</strong> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before you start to put ejabberd you need to make sure that we have everything, then he may need it, namely: <br><br><ul><li>  GNU Make </li><li>  Gcc </li><li>  libexpat 1.95 or higher </li><li>  Erlang / OTP R10B-9 or higher </li><li>  OpenSSL 0.9.6 or higher, for STARTTLS, SASL and SSL encryption.  Optional, highly recommended. </li><li>  Zlib 1.2.3 or higher, for Stream Compression support (XEP-0138).  Optional. </li><li>  GNU Iconv 1.8 or higher, for the IRC Transport (mod_irc).  Optional.  Not needed on systems with GNU Libc. </li></ul><br><br>  We will be collecting ejabberd from svn, as in a stable version I could not put the shared roster.  To do this, we do: <br><br> <code><a href="http://svn.process-one.net/ejabberd"></a> user$ svn checkout svn.process-one.net/ejabberd <br></code> <br><br>  Putting it, just do not forget to include in the assembly parameter - enable-odbc <br><br> <code>user$ cd ejabberd/trunk/src/ <br> user$ ./configure --enable-odbc <br> user$ make <br> user$ sudo make install <br></code> <br><br>  If there are not any errors that are not popping up, we go further, the next step will probably be to assemble a module for the shared roster.  The source of the module itself is still here <a href="">mod_shared_roster_ldap.erl</a> <br><br> <code><a href=""></a> user$ wget -c www.ejabberd.im/files/contributions/mod_shared_roster_ldap.erl <br> user$ erlc -I ejabberd/trunk/src/ mod_shared_roster_ldap.erl <br></code> <br><br>  If you get such messages, do not worry. <br><br> <code>./mod_shared_roster_ldap.erl:19: Warning: behaviour gen_mod undefined <br> ./mod_shared_roster_ldap.erl:289: Warning: variable 'User' is unused <br></code> <br><br>  Well, copy the new module in the heap to the rest <br><br> <code>user$ sudo cp mod_shared_roster_ldap.beam /lib/ejabberd/ebin/ <br></code> <br><br>  <strong>Ejabberd setup</strong> <br><br>  ‚ÄúTurning‚Äù into the root ( <em>sudo -i || su</em> ) and crawling into / etc / ejabberd /, where we are interested in a file called <em>ejabberd.cfg</em> , open it with our favorite editor and begin to edit.  I quote my config, with a few comments that will be escaped by %%: <br><br> <code>override_global. <br> override_local. <br> override_acls. <br> <br> {loglevel, 4}. <br> <br> %%   ,      <br> ,       admin@domain %% <br> {watchdog_admins, ["admin@domain"]}. <br> %%  ,    ejabberd,       <br> cartman.           hostname %% <br> {hosts, ["cartman"]}. <br> {listen, <br> [ <br> %%       %% <br> {5222, ejabberd_c2s, [ <br> {access, c2s}, <br> {shaper, c2s_shaper}, <br> {max_stanza_size, 65536} <br> ]}, <br> %%      ,     . SSL %% <br> {5223, ejabberd_c2s, [ <br> {access, c2s}, <br> {shaper, c2s_shaper}, <br> %%    ,     %% <br> {certfile, "/etc/ejabberd/cert/ejabberd.pem"}, tls, <br> {max_stanza_size, 65536} <br> ]}, <br> %%      jabber  %% <br> {5269, ejabberd_s2s_in, [ <br> {shaper, s2s_shaper}, <br> {max_stanza_size, 131072} <br> ]}, <br> %%       ,     pyucq-t %% <br> {8888, ejabberd_service, [ <br> {access, all}, <br> {shaper_rule, fast}, <br> {ip, {127, 0, 0, 1}}, <br> %%     %% <br> {hosts, ["icq.cartman"], <br> %% ,        pyicq-t %% <br> [{password, "123456"}]} <br> ]}, <br> <br> %%    ejabberd,        %% <br> {5280, ejabberd_http, [ <br> http_poll, <br> web_admin <br> ]} <br> <br> ]}. <br> <br> %%    ldap %% <br> {auth_method, ldap}. <br> %%  ,     domain.local %% <br> {ldap_servers, ["domain.local"]}. <br> {ldap_uids, [{"sAMAccountName"}]}. <br> {ldap_base, "dc=domain,dc=local"}. <br> %%       ,      root,  ""  "" Users,   ldap (   ?) %% <br> {ldap_rootdn, "cn=root,cn=Users,dc=domain,dc=local"}. <br> %%   %% <br> {ldap_password, "123456"}. <br> %%    ,     jabber (  ) %% <br> {shaper, normal, {maxrate, 10000}}. <br> {shaper, fast, {maxrate, 500000}}. <br> %%  ,     admin %% <br> {acl, admin, {user, "admin", "cartman"}}. <br> %%   ,   %% <br> {acl, admin, {user, "admin2", "cartman"}}. <br> {acl, local, {user_regexp, ""}}. <br> {access, max_user_sessions, [{10, all}]}. <br> {access, local, [{allow, local}]}. <br> %%     ,       ,      jabber  %% <br> {access, c2s, [{deny, blocked}, <br> {allow, all}]}. <br> {access, c2s_shaper, [{none, admin}, <br> {normal, all}]}. <br> {access, s2s_shaper, [{fast, all}]}. <br> {access, announce, [{allow, admin}]}. <br> {access, configure, [{allow, admin}]}. <br> {access, muc_admin, [{allow, admin}]}. <br> {access, muc, [{allow, all}]}. <br> {access, pubsub_createnode, [{allow, all}]}. <br> %%  ,       AD %% <br> {access, register, [{deny, all}]}. <br> <br> {language, "ru"}. <br> <br> {modules, <br> [ <br> {mod_adhoc, []}, <br> {mod_announce, [{access, announce}]}, % recommends mod_adhoc <br> {mod_caps, []}, <br> {mod_configure,[]}, % requires mod_adhoc <br> {mod_disco, []}, <br> {mod_echo, [{host, "echo.localhost"}]}, <br> {mod_last, []}, <br> {mod_muc, [ <br> {access, muc}, <br> {access_create, muc}, <br> {access_persistent, muc}, <br> {access_admin, muc_admin} <br> ]}, <br> %%   ,      ,   ,   . %% <br> {mod_muc_log, [ <br> {access, muc}, <br> {access_create, muc}, <br> {access_admin, muc_admin}, <br> {access_log, muc}, <br> {outdir, "/var/log/muc_log"}, <br> {top_link, {"http://cartman/", "JABBER SERVER"}} <br> ]}, <br> {mod_offline, []}, <br> {mod_privacy, []}, <br> {mod_private, []}, <br> {mod_pubsub, [ % requires mod_caps <br> {access_createnode, pubsub_createnode}, <br> {plugins, ["default", "pep"]} <br> ]}, <br> {mod_register, [ <br> {welcome_message, {"Welcome", <br> "Hi! Welcome to this Jabber server."}}, <br> %%  ,     ,   ,   ,     ,        . %% <br> {registration_watchers, ["admin@cartman"]}, <br> {access, register} <br> ]}, <br> {mod_roster, []}, <br> {mod_stats, []}, <br> {mod_time, []}, <br> %%    vcard  AD,         %% <br> {mod_vcard_ldap, <br> [{host, "users.cartman"}, <br> {ldap_vcard_map, <br> [{"NICKNAME", "%u", []}, <br> {"GIVEN", "%s", ["givenName"]}, <br> {"MIDDLE", "%s", ["initials"]}, <br> {"FAMILY", "%s", ["sn"]}, <br> {"FN", "%s", ["displayName"]}, <br> {"EMAIL", "%s", ["mail"]}, <br> {"ORGNAME", "%s", ["company"]}, <br> {"ORGUNIT", "%s", ["department"]}, <br> {"CTRY", "%s", ["c"]}, <br> {"LOCALITY", "%s", ["l"]}, <br> {"STREET", "%s", ["streetAddress"]}, <br> {"REGION", "%s", ["st"]}, <br> {"PCODE", "%s", ["postalCode"]}, <br> {"TITLE", "%s", ["title"]}, <br> {"URL", "%s", ["wWWHomePage"]}, <br> {"DESC", "%s", ["description"]}, <br> {"TEL", "%s", ["telephoneNumber"]}]}, <br> {ldap_search_fields, <br> [{"User", "%u"}, <br> {"Name", "givenName"}, <br> {"Family Name", "sn"}, <br> {"Email", "mail"}, <br> {"Phone", "telephoneNumber"} <br> ]}, <br> {ldap_search_reported, <br> [{"Full Name", "FN"}, <br> {"Nickname", "NICKNAME"}, <br> {"Email", "EMAIL"}]} <br> ]}, <br> %%  shared_roster.        department,     AD %% <br> {mod_shared_roster_ldap, <br> [{ldap_groupattr,"department"}, <br> {ldap_groupdesc,"department"}, <br> %%        ,       ,    AD  JabberUsers,    "" Users.     ,      JabberUsers %% <br> {ldap_rfilter, "(&amp;(memberOf=CN=JabberUsers,CN=Users,DC=klondike,DC=local) (|(userAccountControl=66050)(userAccountControl=66048)))"}, <br> {ldap_memberattr,"sAMAccountName"}, <br> {ldap_userdesc,"cn"} <br> ] <br> }, <br> {mod_version, []} <br> ]}. <br></code> <br><br>  In the trailer everything is ready, but let's also add ssl certificates (bang come in handy) <br><br> <code>mkdir /etc/ejabberd/cert <br> cd /etc/ejabberd/cert <br> openssl req -new -x509 -newkey rsa:1024 -days 3650 -keyout privkey.pem -out server.pem <br> openssl rsa -in privkey.pem -out privkey.pem <br> cat privkey.pem &gt;&gt; ejabberd.pem <br> rm privkey.pem <br></code> <br><br>  <strong>Install and configure pyicq-t</strong> <br><br>  We will not collect it from snv || svc || git, as in gentoo it is in time, and quite working (the main thing is not to forget to include USE = ‚Äúwebinterface‚Äù, although someone like you) just do: <br><br> <code>user$ sudo emerge net-im/pyicq-t <br></code> <br><br>  Everything is just further, we govern it (its) congig, which I have located in ** / etc / jabber / pyicq-t.xml. This is what mine looks like: <br><br> <code>&lt;pyicqt&gt; <br> &lt;jid&gt;icq.cartman&lt;/jid&gt; <br> &lt;spooldir&gt;/var/spool/jabber&lt;/spooldir&gt; <br> &lt;pid&gt;/var/run/jabber/pyicq-t.pid&lt;/pid&gt; <br> &lt;mainServer&gt;127.0.0.1&lt;/mainServer&gt; <br> &lt;mainServerJID&gt;cartman&lt;/mainServerJID&gt; <br> &lt;website&gt;http://cartman/&lt;/website&gt; <br> &lt;supportJid&gt;admin@cartman&lt;/supportJid&gt; <br> &lt;port&gt;8888&lt;/port&gt; <br> &lt;webport&gt;12345&lt;/webport&gt; <br> &lt;secret&gt;123456&lt;/secret&gt; <br> &lt;lang&gt;ru&lt;/lang&gt; <br> &lt;encoding&gt;cp-1251&lt;/encoding&gt; <br> &lt;icqServer&gt;login.icq.com&lt;/icqServer&gt; <br> &lt;icqPort&gt;5190&lt;/icqPort&gt; <br> &lt;usemd5auth/&gt; <br> &lt;sessionGreeting&gt;Welcome to icq gate of Cartman server&lt;/sessionGreeting&gt; <br> &lt;enableShutdownMessage/&gt; <br> &lt;customShutdownMessage&gt;Sorry but icq gete will be shutdown.&lt;/customShutdownMessage&gt; <br> &lt;registerMessage&gt;You have succsefull registed&lt;/registerMessage&gt; <br> &lt;crossChat/&gt; <br> &lt;enableAutoInvite/&gt; <br> &lt;xstatusessupport/&gt; <br> &lt;detectunicode&gt;1&lt;/detectunicode&gt; <br> &lt;admins&gt; <br> &lt;jid&gt;admin@cartman&lt;/jid&gt; <br> &lt;/admins&gt; <br> &lt;reactor&gt;epoll&lt;/reactor&gt; <br> &lt;!--&lt;xdbDriver&gt;xmlfiles&lt;/xdbDriver&gt;--&gt; <br> &lt;xdbDriver&gt;mysql&lt;/xdbDriver&gt; <br> &lt;xdbDriver_mysql&gt; <br> &lt;username&gt;pyicqt&lt;/username&gt; <br> &lt;password&gt;12345678&lt;/password&gt; <br> &lt;database&gt;pyicqt&lt;/database&gt; <br> &lt;server&gt;localhost&lt;/server&gt; <br> &lt;format&gt;encrypted&lt;/format&gt; <br> &lt;/xdbDriver_mysql&gt; <br> &lt;avatarsOnlyOnChat/&gt; <br> &lt;/pyicqt&gt; <br></code> <br><br>  I‚Äôm probably not going to comment on it, in the very config comments it‚Äôs very much <br>  the good ones, the only thing I notice is, 8888 is <br>  the port by which it is screwed to Jaber, by the way we are in <br>  The jabber config file was registered, 123456 is the password for the gate to jabber to access, we remove the saving of information from the * .xml files and transfer it to MySQL, below I will show you how. <br><br>  I will not tell you how to install MySQL and run it, and how to create a user and database too.  In general, we already have a working MySQL with the pyicqt database, with full permissions for the user pyicqt, who log in using the password 12345678. Next, for the gentry drives, we climb into the <em>/usr/lib/python2.5/site-packages/pyicq-</em> folder <em>t / tools /</em> and do the following <br><br> <code>user$ mysql -u pyicqt -D pyicqt -p <br> mysql&gt; \. db-setup.mysql <br></code> <br><br>  Well, let's try to run it all?  We start ejabberd first, we will do it through ejabberdctl and immediately launch pyicq-t <br><br> <code>user$ sudo ejabberdctl start <br> user$ sudo /etc/init.d/pyicq-t start <br></code> <br><br>  And we start watching the jabber logs: <br><br> <code>user$ sudo tail -F /var/log/ejabberd/ejabberd.log <br></code> <br><br>  If not some terrible error does not arise - all good.  We are starting to customize clients. <br><br>  <strong>Configuring and installing clients</strong> <br><br>  In principle, I felt many guishny clients (I myself have been using mcabber for a long time), and <br>  decided that the client machines that are equipped with Windows XP will <br>  set up either PSI or Spark, since PSI is more evolving and it is only <br>  Jabber client and Spark is the only client that has an MSI package.  Which one <br>  you will decide, decide for yourself, I personally will show how I set them, naturally through politicians in AD. <br><br>  Psi <br><br>  That, in principle, is not good, I used Python to kill the configs <br>  on client machines, so it must be installed on each <br>  (this is done easily - it has the MSI package, and put it on, through AD).  Then we simply set ourselves PSI, add our account, check how everything works, how groups appeared, in which users are offline, we set up PSI.  When done, just close it.  Now we climb into <em>* C: \ Documents and Settings \% USERNAME% \ PsiData \ profiles \ default \ accounts.xml</em> and edit it, look for the line <em>admin @ cartman</em> (somewhere in the box) (admin is the account under which you entered jabber , and your account in AD) and replace <em>admin</em> with <em>QWERTYUIOP</em> , save, and rename it to <em>accounts_old</em> .  The next step is to create a ball, with read permissions for everyone, I‚Äôll assume it will be <em>\\ server4 \ psi_install</em> and <em>dump</em> <em>C: \ Documents and Settings \% USERNAME% \ PsiData</em> and <em>C: \ Program Files \ Psi</em> (read permissions should be at all).  We climb into <em>\\ server4 \ psi_install \ PsiData \ profiles \ default</em> and copy the Python script with the name <em>psi_settings.py there</em> , and here it is: <br><br><ol><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li><li> <code><font color="black">#!/usr/env/bin python <br> # -*- coding: utf-8 -*- <br> import os <br> import re <br> import sys <br> username = os.getenv('USERNAME') <br> find_accountname = re.compile('^\s{0,3}&lt;jid type="QString" &gt;(.+)@cartman&lt;/jid&gt;$') <br> change_username = re.compile('QWERTYUIOP') <br> fr = open('accounts_old', 'r') <br> fw = open('accounts.xml', 'w+') <br> for i in fr.readlines(): <br> if find_accountname.search(i): <br> i = change_username.sub(username, i) <br> fw.write(i) <br> fr.close() <br> fw.close()</font></code> </li> </ol><br><br>  <em>the script is poor, wrote in a hurry</em> <br><br>  So, as most of our users are working with limited rights, I decided that they would run PSI from their own directory which is <em>C: \ Documents and Settings \% USERNAME% *.</em>  <em>We climb into the snap-in in Group Policy -&gt; User Configuration -&gt; Windows Configuration -&gt; Scripts (login / logout) and select Login to System.</em>  <em>Click show files and create a file with the name * copy_psi.cmd</em> and change its contents: <br><br> <code>@Echo off <br> IF EXIST "C:\Python25\python.exe" ( <br> IF NOT EXIST "C:\Documents and Settings\%USERNAME%\Psi\psi.exe" ( <br> xcopy \dc\Soft\ezotrank\psi_ad\* "C:\Documents and Settings\%USERNAME%" /E /C <br> cd "C:\Documents and Settings\%USERNAME%\PsiData\profiles\default" <br> python psi_settings.py <br> reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v psi_run /d "C:\Documents and Settings\%USERNAME%\Psi\psi.exe" <br> ) <br> ) <br></code> <br><br>  Well, like everything, close, add to the GP and go to smoke. <br><br>  Spark. <br><br>  What I didn‚Äôt like right away is that it is written in Java, which loves RAM very much, but it is very focused on the corporate market segment, and probably works very well with OpenFire (in principle, and this and that is the brainchild of some people), especially with the paid version .  What I liked the most is the built-in feature with a screenshot.  It‚Äôs easy to install it at all with <a href="http://www.igniterealtime.org/projects/spark/index.jsp">spark</a> and set it up using AD. <br><br>  <em>Some notes:</em> <br><br>  <em>The web muzzle of the Hedgehog will be located at <a href="http://cartman/">cartman</a> : 5280 / admin login</em> <em><br></em>  <em>and the password is the admin which we registered in ejabberd.cfg ie admin @ cartman</em> <br><br>  <em>Web muzzle pyicq-t <a href="http://cartman/">cartman</a> : 12345</em> </div><p>Source: <a href="https://habr.com/ru/post/56916/">https://habr.com/ru/post/56916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../56905/index.html">In iTunes on Russian accounts earned Genius</a></li>
<li><a href="../56907/index.html">New word</a></li>
<li><a href="../56910/index.html">Media and media. Two concepts - two styles of work</a></li>
<li><a href="../56911/index.html">iCloud - first acquaintance</a></li>
<li><a href="../56915/index.html">Meet: Minoru - the first 3D webcam</a></li>
<li><a href="../56917/index.html">We work with TypeMock Isolator</a></li>
<li><a href="../56918/index.html">Conficker woke up</a></li>
<li><a href="../56919/index.html">Apple closes .Mac HomePage July 7, 2009</a></li>
<li><a href="../56920/index.html">Swiss poster</a></li>
<li><a href="../56922/index.html">Augmented Reality</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>