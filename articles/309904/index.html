<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Backing up domain controllers with Veeam</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Microsoft Active Directory is a standard in infrastructure where user authentication and centralized management is required. It is almost impossible t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Backing up domain controllers with Veeam</h1><div class="post__text post__text-html js-mediator-article">  Microsoft Active Directory is a standard in infrastructure where user authentication and centralized management is required.  It is almost impossible to imagine how system administrators would do their job without this technology.  However, the use of Active Directory not only brings great benefits, but also imposes great responsibility, requiring considerable time and understanding of the work processes.  Therefore, I bring to your attention a few articles that will tell you how to successfully backup and restore Active Directory using Veeam solutions.  In particular, I will explain how Veeam helps to make copies of domain controllers (DC) or individual AD objects and, if necessary, restore them. <br><br>  And I will begin by telling you in today's post about the possibilities for backing up physical and virtual domain controllers provided by Veeam, and what needs to be remembered during backup.  For details - under the cat. <br><br><img src="https://habrastorage.org/files/cfb/bf1/479/cfbbf14792fe4d219b0a5714a9a516bc.png"><br><a name="habracut"></a><br>  Active Directory services are designed for redundancy, so familiar backup rules and tactics need to be adapted accordingly.  In this case, it will be wrong to use the same backup policy that already works for SQL or Exchange servers.  Here are a few recommendations that can help with the development of backup policy for Active Directory: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Find out which domain controllers in your environment play the role of FSMO (Flexible Single Master Operations). <br>  <b>Useful: a</b> simple command to check from the command line: <b>&gt; netdom query fsmo</b> <br>  When performing a full domain recovery, it is best to start with the domain controller with the largest number of FSMO roles ‚Äî usually a server with the role of an emulator of the primary domain controller (PDC).  Otherwise, after recovery, you will have to reassign the corresponding roles manually (using the ntdsutil seize command). <br><br></li><li>  If you want to protect individual objects, then you do not need to backup all controllers available on the production site.  To restore individual objects, one copy of the Active Directory database (ntds.dit file) will suffice. <br><br></li><li>  It is always possible to reduce the risk of accidentally or intentionally deleting or modifying AD objects.  We can recommend the delegation of administrative authority, restriction of access with elevated rights, as well as replication to the reserve site with a pre-set delay. <br><br></li><li>  It is usually recommended to back up domain controllers alternately and so that it does not overlap with DFS replication.  Although modern solutions know how to solve this problem. <br><br></li><li>  If you are using a VMware virtual environment, a domain controller may be unavailable over the network (for example, it is located in the DMZ zone).  In this situation, Veeam will switch to a connection through VMware VIX and will be able to handle this controller. </li></ol><br><br><h3>  If you have a virtual DC </h3><br>  Since Active Directory services consume a small portion of system resources, domain controllers usually become first candidates for virtualization.  To protect a virtualized controller with Veeam, you need to install and configure Veeam Backup &amp; Replication. <br><br>  <b>Important!</b>  The solution works with a VM domain controller on Windows Server 2003 SP1 and higher, the minimum supported forest functional level is Windows 2003. The account must be granted Active Directory administrator rights ‚Äî you can work under the account of the administrator of an enterprise or a domain. <br>  The process of installing and configuring Veeam Backup &amp; Replication has already been covered several times - for example, in a <a href="https://youtu.be/b4BqC_WXARk">video</a> prepared by a Veeam system engineer, so we‚Äôll do without details.  Suppose everything is set up and ready to go.  Now we need to create a task for the backup of the domain controller.  The setup process is quite simple: <br><br><ol><li>  Run the backup job creation wizard. <br><br></li><li>  Select the desired domain controller. <br><br></li><li>  Define a retention policy for the backup chain. <br><br></li><li>  Enable data processing based on the state of the applications (Fig. 1) to ensure consistency at the transaction level for the OS and applications running on the VM (including the database for Active Directory data and the SYSVOL directory).  To do this, select the option <b>Enable application-aware image processing</b> (AAIP). <br><br>  AAIP - Veeam technology, which provides backup VM based on the state of applications.  It searches for guest OS applications, collects their metadata, ‚Äúfreezes‚Äù using appropriate mechanisms (Microsoft VSS Writers), prepares a recovery procedure using VSS for applications that will be performed when the restored VM is first launched, and truncates transaction logs if successful. complete backup.  If AAIP is not enabled, the guest OS of the domain controller will not understand that it has been backed up and protected.  Therefore, after a while, you may find an internal warning in the <i>Event ID 2089: backup latency interval</i> server logs (i.e., no backup was performed during the archiving delay interval). <br><br></li><li>  Set the schedule for the job or run it manually. <br><br></li><li>  Verify that the task completed successfully. <br><br><img src="https://habrastorage.org/files/9fc/20d/750/9fc20d750e07406a9a14ca4493501f53.png"><br></li><li>  Find the newly created backup file in the repository - that's it! </li></ol><br>  You can optionally back up your backup to the cloud using the Veeam Cloud Connect service provider (VCC).  It can also be transferred to another backup repository using backup archiving tasks or a tape archiving functionality.  The most important thing is that now the backup is stored in a safe place, and from it at any time you can restore the necessary data. <br><br><h3>  If you have physical DC </h3><br>  Honestly, I hope that you keep up with the times, and in your company domain controllers have long been virtualized.  If this is not the case, then I hope that you regularly update them and they work on relatively modern versions of Windows Server OS ‚Äî Windows Server 2008 (R2) and higher.  (On the nuances of working with older systems will be a separate article). <br><br>  So, you have one or more physical domain controllers running under Windows Server 2008 R2 and higher, and you want to protect them.  In this case, you need Veeam Endpoint Backup, a solution specifically designed to protect the data of physical computers and servers.  Veeam Endpoint Backup copies the necessary data from a physical machine and saves it to a backup file.  In the event of an accident, you can recover data "on bare metal" or perform recovery at the level of the logical disk.  In addition, you can restore individual objects using Veeam Explorer for Microsoft Active Directory. <br><br>  Do the following: <br><br><ol><li>  Download Veeam Endpoint Backup FREE and copy the installer to the correct server. <br><br></li><li>  Run the installation wizard, accept the license agreement and install the program. <br><br>  <b>Note:</b> to install automatically, use the <a href="https://helpcenter.veeam.com/endpoint/15/installation_unattended.html">appropriate instructions.</a> <br><br></li><li>  Create a backup task by selecting the desired mode.  The easiest and recommended way is to back up the entire computer.  Using the file-level mode, select the Operating system as the copy object.  In this case, the program will copy all the files necessary for recovery "on bare metal".  The Active Directory database and the SYSVOL directory will also be saved.  More can be read, for example, <a href="https://habrahabr.ru/company/veeam/blog/261481/">in this post.</a> <br><br><img src="https://habrastorage.org/files/9e0/442/b70/9e0442b70a7b4f5785136d268fe2eb2a.png"><br><br>  <b>Note:</b> If Veeam Backup &amp; Replication is already installed in your environment, and you want to use the existing Veeam repository to store backups of physical machines, you can reconfigure it directly from Veeam Backup &amp; Replication.  To do this, on the desired repository, right-click, hold down the CTRL key, and in the dialog that opens, allow access to the repository by selecting the desired option.  If necessary, enable encryption there, selecting Encrypt backups stored in this repository. <br><br><img src="https://habrastorage.org/files/336/e78/65e/336e7865ef6e413d9f7b7e68130ac74c.png"><br><br></li><li>  Run the task and make sure that it passed without errors: <br><br><img src="https://habrastorage.org/files/aa4/f05/117/aa4f0511724a4ff1b10c8019777b1da2.png"></li></ol><br>  That's all: backup is done, the domain controller is protected.  Go to the repository and find the desired backup or backup chains. <br><br><img src="https://habrastorage.org/files/f33/a29/b88/f33a29b88d584bf5ba3e09df3c928776.png"><br><br>  If you have configured the Veeam Backup &amp; Replication repository as a target backup storage, the newly created backups will be displayed in the Backups&gt; Disk infrastructure panel, Endpoint Backups item. <br><br><img src="https://habrastorage.org/files/b67/802/677/b678026774474e3c9054ebf7be6e9135.png"><br><br><h3>  Instead of conclusion </h3><br>  Of course, a successful backup is a good start, but not all.  Obviously, a backup is worth nothing if you cannot restore data from it.  Therefore, in the next article I will talk about various scenarios for restoring Active Directory, including restoring a domain controller, as well as restoring individual deleted and modified objects using Microsoft‚Äôs own tools and Veeam Explorer for Active Directory. <br><br><ul><li>  <a href="https://habrahabr.ru/company/veeam/blog/281050/">Veeam Endpoint Backup FREE 1.5 Review</a> </li><li>  <a href="https://habrahabr.ru/company/veeam/blog/268737/">Article on Habr√© about backup using Veeam Endpoint Backup</a> </li><li>  <a href="https://www.veeam.com/ru/videos/v9-what-is-it-rus-8169.html">Video review Veeam Availability Suite 9.0</a> (in Russian) </li><li>  <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/">About settings for backup based on application status</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/309904/">https://habr.com/ru/post/309904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309888/index.html">Key skills of a successful Agile team or how to make Agile work?</a></li>
<li><a href="../309892/index.html">Configuring automatic password retrieval for VPN on Mikrotik</a></li>
<li><a href="../309898/index.html">PCI Express 4.0, cables and everything</a></li>
<li><a href="../309900/index.html">While the thunder did not strike, or Continuity and GOST R 53647.4-2011 / ISO / PAS 22399: 2007</a></li>
<li><a href="../309902/index.html">11 texts to help sort out big data</a></li>
<li><a href="../309906/index.html">Application of nonlinear dynamics and Chaos theory to the task of developing a new audio data compression algorithm</a></li>
<li><a href="../309908/index.html">IBM specialists want to stop the epidemic of Escherichia coli.</a></li>
<li><a href="../309910/index.html">Scala or not Scala? That is the question</a></li>
<li><a href="../309912/index.html">Poll. The current state of automated testing 2016</a></li>
<li><a href="../309914/index.html">The history of programming languages: how Fortran allowed users to communicate with the computer on "you"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>