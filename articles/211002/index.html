<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About security in Meteor and not only (part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the development of applications framework Meteor, there are a number of techniques and tools designed to ensure security. In the first part we wil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About security in Meteor and not only (part 1)</h1><div class="post__text post__text-html js-mediator-article">  For the development of applications framework Meteor, there are a number of techniques and tools designed to ensure security.  In the first part we will talk about more well-known things - hiding the server part of the code, autopublish / insecure packages, hiding collection fields during publishing and the built-in account system, looking inside the Meteor.users collection.  In the <a href="http://habrahabr.ru/post/211020/">second</a> , about the loginToken issued to the client, the allow / deny rules when the database is modified by the client, trusted and untrusted code, server methods, HTTPS, force-ssl and browser-policy (Content Security Policy and X-Frame-Options), the built-in data validation mechanism (the check () function and the audit-arguments-check package). <br><a name="habracut"></a><br>  Everything described below applies to the current version of Meteor 0.7.0.1 with Meteorite installed.  By the way, if the examples of this article will not work in a newer version of Meteor, using Meteorite, examples of this article can also be viewed by specifying the --release key at startup: <br><pre><code class="bash hljs">$ mrt --release 0.7.0.1</code> </pre> <br><br><h4>  Hiding the server part of the code </h4><br>  Let's begin, perhaps, with the simplest - separation of client and server parts of the code.  Although Meteor allows for the sharing of code by the client and server, it only makes sense to do so when it‚Äôs really necessary.  In addition to structuring the project itself, which one way or another will be needed as its volume grows, and reducing the amount of data transferred to the client, this allows you to hide the server-side code. <br>  The server, client, client / compatibility, public, private, lib, tests subdirectories (and main. * Files) are handled in a special way.  This is described in sufficient detail in the documentation: <a href="http://docs.meteor.com/">docs.meteor.com/#structuringyourapp</a> .  For code running only on the server, the server directory is intended, the files from which are not transferred to the client.  Similarly, the code from the files in the client directory is not uploaded to the server. <br>  Some code, such as declarations of collections, must be accessible to both the client and the server.  Such code can be placed in subdirectories with any names other than the reserved ones (you can also place it in lib, the difference is that files from this directory are loaded before others). <br>  In this example, we will place collection declarations in the collections subdirectory. <br>  Create a new application: <br><pre> <code class="bash hljs">$ mrt create littlesec</code> </pre><br>  And delete the automatically created files: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> littlesec $ rm littlesec.*</code> </pre><br>  Create the server, client, collections subdirectories.  In collections, add the file test.js with the announcement of the test collection: <br><pre> <code class="javascript hljs">Test = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Meteor.Collection(<span class="hljs-string"><span class="hljs-string">'test'</span></span>);</code> </pre><br>  Actually, the project can already be launched: <br><pre> <code class="bash hljs">$ mrt</code> </pre><br>  And open in browser: <a href="http://localhost/">localhost</a> : 3000 <br>  We will see only a blank page, but the Test object, even if it is empty, will already be accessible from the console: <br><pre> <code class="javascript hljs">&gt; Test.find().count() <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Add the home.html file to the client subdirectory: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>littlesec<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> {{&gt; home}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"home"</span></span></span><span class="hljs-tag">&gt;</span></span> {{#each test}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span>_id:'{{_id}}' name:'{{name}}' value:'{{value}}'<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> {{else}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Collection Test is empty<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> {{/each}} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">template</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And home.js: <br><pre> <code class="javascript hljs">Template.home.test = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Test.find({}); }</code> </pre><br>  In the server subdirectory, the startup.js file: <br><pre> <code class="javascript hljs"> Meteor.startup(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Test.find({}).count()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> testValues = [ {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'First'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Second'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Third'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>} ]; testValues.forEach( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">testValue</span></span></span><span class="hljs-function">) </span></span>{ Test.insert(testValue); }); } });</code> </pre><br>  Now the test collection is available to both the client and the server, and the server code is not transferred to the client.  The _id field is a database identifier that is automatically generated when a new record is inserted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the moment, the collection is available to absolutely everyone for both reading and writing, which can be checked from the console: <br><pre> <code class="javascript hljs">&gt; Test.findOne({})</code> </pre><br>  AND: <br><pre> <code class="javascript hljs">&gt; Test.insert({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Fourth'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>})</code> </pre><br><br><h4>  Removing autopublish / insecure packages <br></h4><br>  We got full access to the collection declared by us thanks to the autopublish and insecure packages connected by default to the project when creating them.  The first one ‚Äúpublishes‚Äù all existing collections on the server, the second one gives full rights to change them.  This greatly facilitates familiarity with Meteor and rapid prototyping, but, of course, is unacceptable in real life, therefore: <br><pre> <code class="bash hljs">$ mrt remove autopublish $ mrt remove insecure</code> </pre><br>  The Test object in the browser is still available, but there is no more data: <br><pre> <code class="javascript hljs">&gt; Test.find().count() <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Now, in the normal mode, without autopublish, the client gets access to the server data, the server must publish them, and the client must subscribe. <br>  Add a collection to the server / startup.js file (it can be placed both outside the function added by Meteor.startup () and inside it; the difference will be in the moment the publication is created - it is important that the published collection already exists): <br><pre> <code class="javascript hljs">Meteor.publish(<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Test.find(); } );</code> </pre><br>  If you publish the collection while the autopublish package is still connected to the project, a warning message will be displayed at the start of Meteor: <br><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">I20140131</span></span><span class="hljs-number"><span class="hljs-number">-11</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>:<span class="hljs-number"><span class="hljs-number">07.343</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>)? ** <span class="hljs-type"><span class="hljs-type">You've</span></span> set up some <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> subscriptions with </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Meteor</span></span></span><span class="hljs-class">.publish(), but </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">I20140131</span></span></span><span class="hljs-class">-11:36:07.388(4)? ** you still have autopublish turned on. &lt;..&gt;</span></span></code> </pre><br><br>  Add the following subscription to the client / home.js file: <br><pre> <code class="javascript hljs"> Meteor.subscribe(<span class="hljs-string"><span class="hljs-string">'test'</span></span>);</code> </pre><br>  Now the data in the browser has appeared again, however, there is no more right to change them: <br><pre> <code class="javascript hljs">&gt; Test.insert({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Fifth'</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span>}) <span class="hljs-string"><span class="hljs-string">"BDgB258TovmqS7YbY"</span></span> insert failed: Access denied</code> </pre><br>  Note that the record is first inserted into the local collection, its identifier is returned (‚ÄúBDgB258TovmqS7YbY‚Äù), and this record is displayed in the browser, then an error message is received from the server, and the insertion into the local collection is ‚Äúrolled back‚Äù.  The display in the browser takes place thanks to the delay compensation mechanism, and the error occurs due to the allow / deny rules checking (about them later);  Without the insecure package, no default changes are allowed. <br><br><h4>  Hiding fields when publishing <br></h4><br>  The collection does not necessarily publish in full.  Until now, all fields from the server collection were displayed.  You can, for example, hide the _id field, this will limit the possibility of data manipulation, since on the client side you need to specify the record identifier (see also the data change restriction by_id) or other fields, such as implemented in the Meteor collection. users (see below): <br><pre> <code class="javascript hljs">Meteor.publish(<span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> projection = {<span class="hljs-attr"><span class="hljs-attr">_id</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Test.find({}, {<span class="hljs-attr"><span class="hljs-attr">fields</span></span>: projection} ); <span class="hljs-comment"><span class="hljs-comment">// return Test.find(); } );</span></span></code> </pre><br>  Hide the _id field in this way, unfortunately, does not work out - it is probably used to establish the correspondence between the server and local collections.  In the current version, this will lead to an error, just returned an empty collection before. <br>  Of course, hiding the fields will also have a positive effect on the amount of data transferred. <br><br><h4>  Meteor Account System </h4><br>  All of the above applies to unauthorized users.  And what opportunities appear if the user is authorized? <br>  Add to the project support for Meteor account system: <br><pre> <code class="bash hljs">$ mrt add accounts-base $ mrt add accounts-ui $ mrt add accounts-google</code> </pre><br>  In addition to accounts-google, there are official packages for a number of authorization providers, including Facebook, Twitter, Github, and others.  Informal packages are supported by other providers, for example, Vkontakte. <br>  Use in the home.html ready template user authorization button: <br><pre> <code class="html hljs xml">{{loginButtons}}</code> </pre><br>  And currentUser to display user information: <br><pre> <code class="html hljs xml">{{currentUser._id}} {{currentUser.profile.name}}</code> </pre><br>  And, using the step-by-step instruction that will be displayed when you first click on the button, register your application with Google, after which we will be able to immediately authorize the user. <br>  Add a package to support Facebook: <br><pre> <code class="bash hljs">$ mrt add accounts-facebook</code> </pre><br>  Then we register the second user. <br>  Accounts are stored in the Meteor.users collection, but if we access it in the browser, we will see only one document, although there are already two users registered: <br><pre> <code class="javascript hljs">&gt; Meteor.users.find().count() <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  The fact is that by default (if the autopublish package is disabled, everything is a bit more complicated with it) the client has access only to a part of the fields of his own document of this collection: <br><pre> <code class="javascript hljs">&gt; Meteor.users.findOne()) {<span class="hljs-string"><span class="hljs-string">"_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"8fLXBYpNGLqDwAahg"</span></span>,<span class="hljs-string"><span class="hljs-string">"profile"</span></span>:{<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt; &gt;"</span></span>}}</code> </pre><br>  The same document is available through the variable Meteor.user, and its identifier is Meteor.userId () <br><pre> <code class="javascript hljs">&gt; Meteor.user() {<span class="hljs-string"><span class="hljs-string">"_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"8fLXBYpNGLqDwAahg"</span></span>,<span class="hljs-string"><span class="hljs-string">"profile"</span></span>:{<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt; &gt;"</span></span>}}</code> </pre><br>  There is also a corresponding function (helper) Handlebars currentUser, with which we display information about the current user. <br><br>  If you look into the sources of the accounts-base package, the Meteor.users collection is created on the server as follows: <br><pre> <code class="javascript hljs">Meteor.users = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Meteor.Collection(<span class="hljs-string"><span class="hljs-string">"users"</span></span>, {<span class="hljs-attr"><span class="hljs-attr">_preventAutopublish</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>});</code> </pre><br>  And published as follows: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Publish the current user's record to the client. Meteor.publish(null, function() { if (this.userId) { return Meteor.users.find( {_id: this.userId}, {fields: {profile: 1, username: 1, emails: 1}}); } else { return null; } }, /*suppress autopublish warning*/{is_auto: true});</span></span></code> </pre><br>  If the user is authorized, this.userId contains his identifier, according to which the profile subdocument, username field and emails subdocument are returned from the database (the last two are not populated by default).  Otherwise, no data will be published.  This means that by default an authorized user has access to only a part of the fields and only his own document from the database. <br><br>  The link to the image of a Google user from the social network is stored in the subdocument services.google.picture, and you can access the image from Facebook using the identifier services.facebook.id.  To get access to them, they need to be additionally published, for example, like this (add to server / startup.js): <br><pre> <code class="javascript hljs">Meteor.publish(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userId) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> projection = { <span class="hljs-string"><span class="hljs-string">'services.google.picture'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'services.facebook.id'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'services.vk.photo'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Meteor.users.find( { <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userId }, { <span class="hljs-attr"><span class="hljs-attr">fields</span></span>: projection } ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } });</code> </pre><br>  And the link to the picture is in home.html: <br><pre> <code class="html hljs xml"> {{#if currentUser.services.facebook}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://graph.facebook.com/{{currentUser.services.facebook.id}}/picture/?type=square"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- small || normal || large || square --&gt;</span></span> {{else}}{{#if currentUser.services.google}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{{currentUser.services.google.picture}}</span></span></span><span class="hljs-tag">&gt;</span></span> {{else}}{{#if currentUser.services.vk}} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{{currentUser.services.vk.photo}}</span></span></span><span class="hljs-tag">&gt;</span></span> {{/if}}{{/if}}{{/if}}</code> </pre><br>  Selected fields are now available to the client: <br><pre> <code class="javascript hljs">&gt; Meteor.users.findOne() { <span class="hljs-string"><span class="hljs-string">"_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"8fLXBYpNGLqDwAahg"</span></span>, <span class="hljs-string"><span class="hljs-string">"profile"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt; &gt;"</span></span> }, <span class="hljs-string"><span class="hljs-string">"services"</span></span>: { <span class="hljs-string"><span class="hljs-string">"facebook"</span></span>: { <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;  Facebook&gt;"</span></span> } } }</code> </pre><br>  Instead of explicitly specifying the fields, you could publish the entire user document by specifying projection = {} or the subdocument services, specifying projection = {services: 1}.  However, in this case, the client will receive obviously unnecessary data for it, such as accessToken or loginTokens. <br>  If you need to display information about other users, you can publish the selected fields of all documents in the collection, for example, by adding one more to the existing publications: <br><pre> <code class="javascript hljs">Meteor.publish(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> projection = { <span class="hljs-string"><span class="hljs-string">'profile.name'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Meteor.users.find( { }, { <span class="hljs-attr"><span class="hljs-attr">fields</span></span>: projection } ); });</code> </pre><br>  The result will be the union of all publications, and now all users, including unauthorized, will have the names of all registered users, and the current user will have additional fields of his document: <br><pre> <code class="javascript hljs">Meteor.users.find().fetch() [ { <span class="hljs-string"><span class="hljs-string">"_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"8fLXBYpNGLqDwAahg"</span></span>, <span class="hljs-string"><span class="hljs-string">"profile"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt; &gt;"</span></span> } }, { <span class="hljs-string"><span class="hljs-string">"_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"kL7Fkuk29ci4vz8q4"</span></span>, <span class="hljs-string"><span class="hljs-string">"profile"</span></span>: { <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt; &gt;"</span></span> }, <span class="hljs-string"><span class="hljs-string">"services"</span></span>: { <span class="hljs-string"><span class="hljs-string">"google"</span></span>:{ <span class="hljs-string"><span class="hljs-string">"picture"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;  &gt;"</span></span> } } } ]</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/211002/">https://habr.com/ru/post/211002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210990/index.html">LoveQA. Badoo's first mini-conference for testers</a></li>
<li><a href="../210992/index.html">Overview of dedicated servers Kimsufi and SoYouStart</a></li>
<li><a href="../210994/index.html">Undergraduate Computer Science (AI) / Software Engineering. Hurry to get a grant</a></li>
<li><a href="../210996/index.html">Making Twitter Cards with galleries and cats</a></li>
<li><a href="../210998/index.html">Interview with Greenheart Games. Indie with character</a></li>
<li><a href="../211004/index.html">E-commerce trends: What is most important for an online store? Part 1</a></li>
<li><a href="../211008/index.html">Impact of Motorola Mobility Absorption by IBM-Lenovo Alliance</a></li>
<li><a href="../211012/index.html">Transparent encryption of network folders in the corporate space</a></li>
<li><a href="../211014/index.html">HGST HelioSeal - a promising platform for the next decade</a></li>
<li><a href="../211016/index.html">Pocket PaaS with Dokku</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>