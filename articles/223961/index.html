<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Steam Protocol 2 and Steam Files - Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Source Pirate Kit and all-all-all ... 
 Back in 2007, the author of one of the most remarkable programs, the Source Pirate Kit ( SPK ), completely los...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Steam Protocol 2 and Steam Files - Introduction</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/000/dca/198/000dca198a459957c5d705d59a8bc514.png" alt="Steam Logo" align="left"><br><h6>  Source Pirate Kit and all-all-all ... </h6><br>  Back in 2007, the author of one of the most remarkable programs, the <b>Source Pirate Kit</b> ( <b>SPK</b> ), completely lost the sources of his project along with the rest of the documents - his hard drive died where it was all kept.  The purpose of the program to some will be clear from the name (someone even came across it) - the creation of Standalone-versions of games on the <b>Half-Life</b> and <b>Half-Life 2</b> engines (to put it simply - pirate).  Everything in the program was good, but with the loss of the source code, it went into oblivion and the ability to somehow tweak the algorithm of its work - the whole program was a monolithic EXE file and all the necessary auxiliary programs were connected with resources and unpacked if necessary.  But - the main functionality was hidden in the program itself ... <br><a name="habracut"></a><br><h6>  Start of development </h6><br>  After seeing this sad news, I, who studied programming amateur for only 2 years, decided to at least try to correct the situation.  At that time I was not working for the public - the project was done ‚Äúfor myself‚Äù, without publishing it anywhere.  While working on it, I gradually studied programming more deeply - I wrote at that time in the <b>Borland Delphi 7</b> environment (do not shout that C ++ is ideal for such tasks - it‚Äôs hard for me even now to jot out a normal user interface, even using QtCreator ).  There were disappointments, shoals, etc., but the project gradually grew, eventually getting closer to the state when it could be published on the web ... <br><br><h6>  First publication and initial development </h6><br>  And then came the moment of truth - in the second half of 2007, I published the first version of the program on the resource, where the Anti-Steam-movement was the most active in our region - <b>csmania.ru</b> (this year the resource stopped working, apparently the administrators abandoned it completely ).  I immediately ran into a lot of jambs and bugs - I myself was not really worried about testing programs at that time (don‚Äôt forget that I learned programming in general at that time).  This gave me an additional incentive to work on the project - after all, if someone found bugs, then it still needs someone!  Since then, work on the project was in full swing, gradually covering new areas - first I studied WinAPI, then Assembler (x86), network programming, cryptography and a lot more, going in addition to these areas and not only ... For all the time, the original project evolved from the simplest program without a bunch of jambs to a serious program with support for simple scripts, powerful architecture and complete independence from third-party tools - all the functionality was implemented exclusively by my code.  The name was also changed - instead of the <b>Source Pirate Kit</b> , the <b>Universal</b> <b>Pirate Kit</b> was used, since the program was very flexible and could work with any games - it was only necessary to correctly write a couple of files for the program. <br><br><h6>  Further development </h6><br>  Since all games based on <b>Half-Life</b> and <b>Half-Life 2</b> , were distributed through <a href="http://ru.wikipedia.org/wiki/Steam">Steam</a> , at a certain stage it was decided to look - and how does it work? <br>  Even at the <b>Universal Pirate Kit</b> development stage, I studied and sorted out ‚Äúunder the bone‚Äù the formats used by Steam for storing game files - <a href="http://ru.wikipedia.org/wiki/Grid_Cache_File"><i>GCF (Grid Cache File, Game Cache File)</i></a> and <i>NCF (Not-Cache File)</i> .  A further development was the attempt to create such files from scratch.  This project was implemented almost to the full - even Steam accepted the upgraded and created files.  True, the format was not dismantled at 100% - there is one tricky checksum in it, which I could not overcome.  Because of it, Steam saw that the file was upgraded and pumped it ... <br>  The next step was to try to understand - ‚Äúhow does Steam load game content?‚Äù.  In the course of working on this issue, I studied the TCP / IP protocol stack, I became acquainted with the Wireshark and IDA Pro programs ... Back in the beginning, I came across another <a href="http://cs.rin.ru/forum/viewforum.php%3Ff%3D20">remarkable resource</a> , whose team also worked on this problem.  There I met a lot of great people, communicated very closely with them, and together we were able to overcome all these protocols! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h6>  New projects </h6><br>  In the course of studying the network protocols of Steam, I (and not only me) had the idea to create at least my own servers, similar to those with which the official client communicates.  This idea was very well received in the Russian community and I began to develop (in parallel with the study of the protocols themselves). <br>  Somewhere in the middle of the process with protocols, another crazy idea arose - ‚Äúwhy not write your client, since we are writing our own server?  All the same, it will be necessary then to separately ‚Äúbreak‚Äù the game in order to play it ... " <br>  Thus was born another project - <b>SteamLite</b> .  It became the pinnacle of my creative work of those times - the modular structure was implemented in it (the following modules were written - UI, FileFormats_ {GCF, NCF}, GameConvertor, Network, Viewer).  It was possible to download files from official servers (not all files, many were protected by additional protections on the server side), make and apply patches for them, view and even edit (!!!) the contents of files without unpacking them, automatic ‚Äúcrack‚Äù of the game when its launch and much more ... Everything would be fine, but this project (as well as server development) ‚Äúturned down‚Äù and never reached the first normal release due to some of the reasons described below. <br><br><h5>  Global bummer, gentlemen ... </h5><br>  For all the time of work on these projects (and this is 2007-2011), VALVE did not sit idly by and came up with disgusting for us - a new file format and new network protocols.  At the same time, the protection of the games themselves was slightly changing - the main ‚Äúsagging‚Äù of work on full-fledged pirated versions of games was caused by the release of <i>Half-Life 2: Episode 2</i> with its achievements. <br>  The result of all this was that with the official release of the new file format and the new network protocol (Steam 3) I personally abandoned the whole thing - the desire to disassemble it all from 0 disappeared after the very first attempts - <a href="http://ru.wikipedia.org/wiki/Protocol_Buffers">Protocol Buffers</a> were used everywhere, which made it difficult to analyze network packets.  And I am glad that other teams have not abandoned work on the new protocol ‚Äúin the closet‚Äù - at the moment everything seems to be working, but nobody is sitting on their own servers / clients ... <br><br><h5>  And what is the essence, sir? </h5><br>  At the moment I have knowledge of the Steam server infrastructure (at least for the previous version of the protocol), the server-client interaction protocols themselves, the formats of the files used.  Some of the formats are used now - for example, BLOB files, ContentDescription Record (CDR), VDF. <br>  I have a desire to publish data on the work on all this heap of formats and protocols, since at the moment this data is also widely available.  I just want to sort out all the features in more detail, as well as write sensible articles on this topic for Russian-speaking users. <br>  Here is a sample list of articles that will be published: <br><ul><li>  Steam Protocol v2 - structure, description and analysis of server code; </li><li>  Steam Files - analysis of various file formats.  It will be divided into several parts (GCF + NCF, BLOB + CDR + CDF). </li></ul><br>  If these articles are needed by the community, they will be published. <br><br>  PS: I will be glad to hear reasonable criticism in terms of presentation and content - the first article, no experience in writing them. </div><p>Source: <a href="https://habr.com/ru/post/223961/">https://habr.com/ru/post/223961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223947/index.html">STM32 and LCD via I2C</a></li>
<li><a href="../223949/index.html">Android development application for working with OBDII protocol</a></li>
<li><a href="../223953/index.html">Ancient philosophers and modern scientists</a></li>
<li><a href="../223955/index.html">Li-Ion Battery Operation</a></li>
<li><a href="../223957/index.html">What language can you learn by asking questions to the search engine? Yandex Workshop</a></li>
<li><a href="../223965/index.html">Windows 8.1 with Bing challenges Android: one gig of RAM is again enough</a></li>
<li><a href="../223969/index.html">Motocoin - cryptocurrency with human mining</a></li>
<li><a href="../223971/index.html">Dynamic Adding Properties in the Java Language</a></li>
<li><a href="../223973/index.html">Hacking the D-Link DSP-W215 Smart Plug. Again</a></li>
<li><a href="../223975/index.html">Statistics of sales of applications in the Windows Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>