<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Debian on Iomega StoreCenter Ix2-200 or do a full-fledged servachok from a network drive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somehow, at work, there was a need to organize a repository in the network for documentation of any different kind. Requirements: reliability, small s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Debian on Iomega StoreCenter Ix2-200 or do a full-fledged servachok from a network drive</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/88e/940/fed/88e940fedc1d569e3df4f76308bf1c13.jpg"><br><br>  Somehow, at work, there was a need to organize a repository in the network for documentation of any different kind.  Requirements: reliability, small size, volume of several terabytes.  My choice was on the Network Attached Storage of the Iomega StoreCenter Ix2-200.  In the process of market research, it turned out that this device uses a trimmed version of Debian Lenny, and it is possible to install a full-fledged Debian Squeeze.  Thereby get all the features provided by this OS. <br><br>  So, the device was purchased, I overlaid with the documentation found on the Internet and proceeded to install the Debian Squeeze OS for the armel architecture.  Unfortunately, the available documentation was in English, not complete and not accurate, in general, there was room for thought.  In addition, for the initial boot and reinstall of the OS, a rather specific RS-232 cable was required. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a result, my experiment (successful) was described under the cut, the necessary pieces of the instructions of others were translated, and the experimental information I received is presented. <br><br><a name="habracut"></a><br><br><h4>  About cable </h4><br>  For installation, we need an interface cable that uses the rs-232 protocol with an ordinary DB9 on the one hand and an extraordinary (I don't know if it has its own name) connector on the other.  I myself am confused from which side they approach the soldering iron, so I turned to my colleagues, who soldered to me this: <br>  <i>UPD from 01/19/2012</i> : As I was told, the connector from the other end (not DB9) is called BLS-04.  Some technical details about the cable <a href="http://habrahabr.ru/blogs/linux/135992/">here</a> . <br><img src="https://habrastorage.org/storage2/791/551/f4f/791551f4f7985d71de7b1ae61296da01.jpg"><br><br><h5>  Pinout: </h5><br><pre> Pin 1 VCC (3.3V) 
 Pin 2 TxD 
 Pin 3 gnd 
 Pin 4 RxD 

 Pin 1 is signed "JP1" </pre><br><br>  Instead, the original instructions recommend using a <a href="http://www.ftdichip.com/Products/Cables/USBTTLSerial.htm">TTL-232-R-3V3-AJ</a> cable.  It is better than mine because on the computer side it is plugged into USB, and everything around me does not fonit (when the board touched the computer case, there was great noise), but worse than that, I couldn‚Äôt buy it with little blood in Moscow. <br>  Therefore, made their own. <br><br>  <i>UPD from 01/19/2012</i> : Other interface cable options are written in the comments, for which many thanks to their authors. <br><br><h4>  Iomega Storcenter ix2-200 Features </h4><br><h5>  Iron parameters: </h5><br><pre>  CPU 1.0 GHz Marvell Kirkwood 88F6281 
 RAM 256 MB Zentel / Hynix 
 Flash ROM 32 MB Hynix 
 Gigabit Marvell Alaska 88E81116R network 
 USB 3x USB 2.0 ports
 Internal HDD Two SATA-II drives
 HDD Capacity Supplied with 1/2/4 TB total volume options </pre><br><br><h5>  Serial Connection Parameters: </h5><ul><li>  Speed: 115200 baud </li><li>  parity: no (none) </li><li>  flow control (flow control): xon / xoff </li><li>  8 data bits </li><li>  1 stop bit (stop bit) </li></ul><br><h4>  Pro installation files </h4><br>  Files (uImage - the kernel and uInitrd - initrd.img) for downloading the NAS installer can be taken from partitions on one of the hard drives installed inside, from a USB flash drive or over a network from a tftp server.  I chose the last option and used <a href="http://tftpd32.jounin.net/">tftpd32</a> (there is also a 64-bit version of tftpd64 in the same place) under the working Windows and net-ftp / tftp-hpa under the home gent. <br><br>  Download the notorious files <a href="http.ru.debian.org/debian/dists/squeeze/main/installer-armel/current/images/kirkwood/netboot/marvell/openrd/">from here</a> and throw in the directory from which the tftp-server distributes. <br><br>  We start the terminal (putty, hyperterminal, etc.) in the listening mode of the corresponding port (in my case it was COM1), having correctly set the parameters of the serial connection (see above). <br><br>  We connect NAS: <br><ol><li>  to a computer with a tftp server over the network </li><li>  to the computer from which we will manage the installation via the rs-232 cable (it may coincide with item 1) </li><li>  to electricity </li></ol><br>  If everything went well, then we see the following picture in the terminal: <br><img src="https://habrastorage.org/storage2/7f5/dc4/689/7f5dc4689148d79e94d8864ad9662549.gif"><br><br>  We stop autoloading at the right time by pressing any key and proceed to the next step. <br><br><h4>  Installer download </h4><br>  Enter the following commands: <br><pre>  setenv mainlineLinux yes
 setenv arcNumber 1682
 saveenv
 reset
</pre><br>  Thus, we set the configuration parameters so that the NAS boots from the kernel we need and restarts the device. <br><br>  Ship the installer kernel: <br>  For TFTP: <br><pre>  setenv serverip 192.168.1.2
 setenv ipaddr 192.168.1.147
 tftpboot 0x01100000 uInitrd
 tftpboot 0x00800000 uImage </pre><br>  192.168.1.2 - the address of the tftp server, 192.168.1.147 - the address assigned by the NAS. <br><br>  For flash drives (FAT only): <br><pre>  usb start
 fatload usb 0: 1 0x01100000 / uInitrd
 fatload usb 0: 1 0x00800000 / uImage </pre><br><br><h4>  Install debian </h4><br>  I will not describe the standard Debian installer in detail, since this has been done a lot before me.  For example, in the <a href="http://www.debian.org/releases/stable/armel">official manual</a> .  I will dwell only on the following fine points in the order of occurrence during installation. <br><br><h5>  Partitioning </h5><br>  I have done it this way: each of the two two-hard drive hard drives is divided into two sections: 230 megabytes and all the rest.  The 230 MB partitions on the first and second disks are used under / boot and the root partition, respectively.  As the output df -hT below shows, the size of 200 megabytes is quite redundant. <br>  The second sections on each of the disks are combined into a software raid 1 (mirroring) and LVM is created on it. <br><br>  df -hT: <br><pre> F. System Type Size Isp Isp% mounted on
 / dev / sda1 ext2 223M 18M 194M 9% / boot
 / dev / sdb1 ext4 230M 79M 140M 36% /
 / dev / mapper / vg-home
               ext4 1,8T 267G 1,6T 15% / home
 / dev / mapper / vg-opt
               ext4 938M 18M 873M 2% / opt
 / dev / mapper / vg-tmp
               ext2 893M 17K 845M 1% / tmp
 / dev / mapper / vg-usr
               ext4 4,6G 782M 3,6G 18% / usr
 / dev / mapper / vg-var
               ext4 19G 802M 17G 5% / var
</pre><br>  There is also / dev / mapper / vg-swap at 512MB (double the number of operatives). <br><br>  I broke into sections deep into the night, hardly coming to my senses after the night of December 31 to January 3, so it turned out, obviously, far from ideal.  But it was frankly lazy to redo it.  Now, having already thought, I would do this: <br><br>  1) The root and / boot can NOT be on the raid and \ or lvm, so they are created as ordinary partitions on hard drives.  At the same time, since everything else will be on raids - the root and / boot partitions must lie on different disks and be of equal size.  150 megabytes should be enough for the root and especially for / boot.  Although / boot can most likely be with ext [3-4], there is no point in journaling, since the data will be written there only when the kernel is updated. <br>  I'm not sure if this is necessary, but it is better to do / boot on sda1. <br>  2) / tmp and swap should not be done on raid 1. Raid 0 should be created for them, it has its own volume group on it and already has / tmp and swap sections per gigabyte and 512 megabytes, respectively. <br>  3) We give the rest of the free space on both screws for raid 1, create lvm on it, and breaking up the sections as you prefer. <br><br>  I want to note that the proposed partitioning scheme is focused on network storage intended for backups, i.e.  basic requirement is reliability.  If you plan to store movies \ music, i.e.  that is easily pumped out of the Internet, the main section (I have this / home, but it may well be / var, for example) should lie on raid 0. <br><br><h4>  Kernel transform </h4><br>  Unfortunately, the bootloader in this device does not know how to use the standard vmlinuz-2.6.32-5-kirkwood and initrd.img-2.6.32-5-kirkwood, and the Debian installer does not know anything about our device and does not flush the kernel to the right place. .  Therefore, we ourselves need to convert it to the desired format and feed the loader. <br><br>  This is done by the following two commands (in / boot): <br><pre> mkimage -A arm -O linux -T kernel -C none -a 0x00008000 -e 0x00008000 -n "Debian kernel" -d vmlinuz-2.6.32-5-kirkwood uImage
 mkimage -A arm -O linux -T ramdisk -C gzip -a 0x0 -e 0x0 -n "Debian InitRD" -d initrd.img-2.6.32-5-kirkwood uInitrd
</pre><br><br>  Unfortunately, I don‚Äôt remember if mkimage is installed by default, if not, then it can be supplied from the uboot-mkimage package. <br>  It is executed either at the end of the installation, or later, by rebooting into rescue mode, typing at the start instead of <br><pre> setenv bootargs console = ttyS0,115200n8 base-installer / initramfs-tools / driver-policy = most
</pre>  this <br><pre> setenv bootargs console = ttyS0,115200n8 rescue / enable = true
</pre><br><br><h4>  Automatic download </h4><br>  After installing the system, so that our <s>NAS</s> server loads as it should, we prescribe the following parameters at startup: <br><pre> setenv bootargs_console console = ttyS0,115200 root = / dev / sdb1
 setenv bootcmd_sata 'ide reset;  ext2load ide 0: 1 0x01100000 / uInitrd;  ext2load ide 0: 1 0x00800000 / uImage '
 setenv bootcmd 'setenv bootargs $ (bootargs_console);  run bootcmd_sata;  bootm 0x00800000 0x01100000 '
 saveenv
</pre><br><br>  And, finally, we are loading into our full-fledged system, rebooting, or giving the command: <br><pre> run bootcmd
</pre><br><br><h4>  Notes </h4><br><h5>  Harmless bug </h5><br>  A similar error message will appear in the kernel logs at boot time: <br><pre> kernel: [6.327359] uncorrectable error:
 kernel: [96.499883] uncorrectable error:
 kernel: [96.503342] end_request: I / O error, dev mtdblock0, sector 8 </pre><br><br>  This is perfectly normal, as it turned out from deep googling.  It is connected, as I understand it, with some problems in the uboot bootloader, or maybe not.  The main thing is that everything works fine with this error.  Now, if the error was about mtdblock1, then it would be bad. <br><br><h5>  Iron monitoring </h5><br>  I would very much like to monitor the temperature of the device, especially since it writes it at boot, but sensors-detect at a certain stage hangs the system tightly.  Saves only power off and on.  In the logs while quiet.  Only smartmontools work, allowing you to see the temperature of hard drives. <br><br><h4>  Used materials </h4><br>  nas-central wiki: <br>  <a href="http://iomega.nas-central.org/wiki/Category:Ix2-200">Ix2-200</a> <br>  <a href="http://iomega.nas-central.org/wiki/Ix2-200_Debian_Installation">Ix2-200 Debian Installation</a> <br><br>  <a href="http://www.cyrius.com/debian/kirkwood/openrd/install.html">Installing Debian on OpenRD from syrius</a> </div><p>Source: <a href="https://habr.com/ru/post/135992/">https://habr.com/ru/post/135992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135986/index.html">"World Record" - a mini-game from the developers of the "invisible keyboard"</a></li>
<li><a href="../135988/index.html">New typography for the web. Microsoft demonstrates OpenType features</a></li>
<li><a href="../135989/index.html">What working environment do you usually use?</a></li>
<li><a href="../135990/index.html">WPF layout: Measure and Arrange</a></li>
<li><a href="../135991/index.html">We will be more constructive. Ministry of Defense of the Russian Federation</a></li>
<li><a href="../135993/index.html">Die, agent, die!</a></li>
<li><a href="../135999/index.html">History of an audit</a></li>
<li><a href="../136000/index.html">JobGalaxy: the fastest job search in RuNet</a></li>
<li><a href="../136001/index.html">Twitter can predict epidemics before doctors</a></li>
<li><a href="../136002/index.html">The company Razer introduced the game tablet "Project Fiona"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>