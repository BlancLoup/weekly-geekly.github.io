<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The OSX / Keydnap malware is distributed using the trusted application Transmission</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last month, we wrote about OSX / Keydnap malware , which specializes in stealing the contents of the Apple OS X keychain (keychain). It also provides ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The OSX / Keydnap malware is distributed using the trusted application Transmission</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a6d/65f/6d4/a6d65f6d4b544110a1d733fa117cda5f.jpeg" align="left">  Last month, we <a href="https://habrahabr.ru/company/eset/blog/305608/">wrote</a> about <b>OSX / Keydnap malware</b> , which specializes in stealing the contents of the Apple OS X keychain (keychain).  It also provides attackers with remote access to a compromised computer (backdoor).  At the time of the writing of the last analysis, it was not clear to ESET how the victims were compromised by OSX / Keydnap.  We assumed that attackers could use for this attachment when distributing phishing messages, as well as post malware on illegitimate websites. <br><br>  However, this time, we discovered Keydnap's distribution method using a legitimate website.  The backdoor executable file is distributed using a BitTorrent client‚Äôs recompiled version of the open-source client called Transmission.  At the same time, its download was possible from the legitimate website of the application, and the application itself was digitally signed. <br><a name="habracut"></a><br>  After ESET experts notified the Transmission developers about this problem, they promptly took steps to remove the malicious file from the web server and began investigating the incident in order to find out the reason for the publication of the malicious file.  At the time of writing our analysis, it was impossible to say exactly when this file became available for download from the official resource.  According to the digital signature information, the distribution kit of the application was signed on August 28, 2016 and was distributed, apparently, the next day.  Thus, we recommend that all users who have downloaded the Transmission version 2.92 application, between August 28 and August 29, inclusive, check for malware infection by checking the presence of the following files and directories in it. <br><br><ul><li>  /Applications/Transmission.app/Contents/Resources/License.rtf </li><li>  /Volumes/Transmission/Transmission.app/Contents/Resources/License.rtf </li><li>  $ HOME / Library / Application Support / com.apple.iCloud.sync.daemon / icloudsyncd </li><li>  $ HOME / Library / Application Support / com.apple.iCloud.sync.daemon / process.id </li><li>  $ HOME / Library / LaunchAgents / com.apple.iCloud.sync.daemon.plist </li><li>  / Library / Application Support / com.apple.iCloud.sync.daemon / </li><li>  $ HOME / Library / LaunchAgents / com.geticloud.icloud.photo.plist </li></ul><br>  The presence of one of the above files or directories indicates that the system has been infected with Keydnap malware.  It should also be noted that the name of the malicious image of the application corresponds to <i>Transmission2.92.dmg</i> , while the legitimate name is <i>Transmission-2.92.dmg</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Similar to KeRanger </h3><br>  In March 2016, Palo Alto Networks <a href="https://habrahabr.ru/company/eset/blog/278725/">published</a> information about the discovery of the first extortionist for OS X. In fact, Keydnap uses a similar method for its distribution. <br><br>  In both cases, the malicious code snippet was added to the code of the main function of the Transmission application.  The application code that is responsible for dumping to the disk and launching the malicious payload is very similar in both cases. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/dca/279/2f4/dca2792f475e4dd6b3479289a4ccf89a.png"></div><br>  <i><font color="#999999">The main Transmission function with malicious code that launches OSX / KeRanger for execution.</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/321/1eb/dfa/3211ebdfa88c48d0a1a2d395d62794ba.png"></div><br>  <i><font color="#999999">The main Transmission function with malicious code that launches OSX / Keydnap for execution.</font></i> <br><br>  As in the case of KeRanger, the malicious distribution package of the Transmission application was signed with a digital certificate.  This certificate is different from the original one, but was also issued by Apple and can be used to bypass the anti-virus protection of the Gatekeeper tool. <br><br><blockquote>  # Malicious Transmission.app $ codesign -dvvv /Volumes/Transmission/Transmission.app Executable = / Volumes / Transmission / Transmission.app / Contents / MacOS / Transmission Identifier = org.m0k.transmission Format = app bundle with Mach-O thin ( x86_64) CodeDirectory v = 20200 size = 6304 flags = 0x0 (none) hashes = 308 + 3 location repo vs embedded Hash type = sha1 size = 20 CandidateCDHash sha1 = 37ffe70260919ee 70e9f2a601d5ad00e2dd5a011 Hash choices = sha1 CDHash = 37fep vs 304 ‚Ç¨ 285,200,002e2dd5a011 Hash choices = sha1 CDHash = 37feh 286886009ee : <b>Shaderkin Igor (836QJ8VMCQ)</b> Authority = Developer ID Certification Authority = Apple Root CA Signed Time = Aug 28, 2016, 12:09:55 PM Info.plist entries = 38 TeamIdentifier = <b>836QJ8VMCQ</b> Sealed Resources version = 2 rules = 12 files = 331 Internal requirements count = 1 size = 212 </blockquote><br><blockquote>  # Clean Transmission.app $ codesign -dvvv /Volumes/Transmission/Transmission.app <br>  Executable = / Volumes / Transmission / Transmission.app / Contents / MacOS / Transmission Identifier = org.m0k.transmission Format = app bundle with Mach-O thin (x86_64) CodeDirectory v = 20200 size = 6304 flags = 0x0 (none) hashes = 308 + 3 location = embedded Hash type = sha1 size = 20 Candidate CD Hash Mar 6, 2016, 3:01:41 PM Info.plist entries = 38 TeamIdentifier = <b>5DPYRBHEAR</b> Sealed Resources version = 2 rules = 12 files = 328 Internal requirements count = 1 size = 180 <br></blockquote><br>  ESET specialists notified Apple of a compromised digital certificate. <br><br>  In addition to the malware distribution method that is similar in both cases, Keydnap and KeRanger also use the same URL pattern when working with the C &amp; C server. <br><br><ul><li>  KeRanger: / osx / ping? User_id =% s &amp; uuid =% s &amp; model =% s </li><li>  Keydnap: / api / osx? Bot_id =% s &amp; action = ping &amp; data =% s (parameters are transmitted as data of a HTTP HTTP POST request, encrypted using RC4) </li></ul><br><h3>  Keydnap updated to version 1.5 </h3><br>  When sending data to a C &amp; C server, Keydnap also notifies it of its internal version of the malware.  In the new instance of Keydnap, we found the version number 1.5.  The code for this instance was still packaged using the modified UPX wrapper described in our previous <a href="https://habrahabr.ru/company/eset/blog/305608/">post</a> .  Earlier, on the Github resource, our experts <a href="https://github.com/eset/malware-research/blob/master/keydnap/keydnap_upx.patch">placed a</a> special patch for unpacking the malware file, which also works with the new version. <br><br>  A major change in the code in the new version is the presence of a Tor anonymous network client there.  This allows Keydnap to work with managing C &amp; C servers that use the onion domains of the Tor network, without using the Tor2Web method, for example, the onion.to resource. <br><br>  The new version of Keydnap also contains in its code an additional command with the identifier 10, which allows the C &amp; C server to set a new URL for it and save it to disk. <br><br>  The key of the RC4 algorithm, which is used to encrypt the HTTP protocol POST data and decrypt the response, has also been changed.  Now it corresponds to the value "u-4 &amp; LpZ! 6Kgu ^ = $ a". <br><br>  The following URL of the C &amp; C server is hard-wired into the body of the Keydnap version: hxxp: //t4f2cocitdpqa7tv.onion/api/osx. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9ce/bf5/c09/9cebf5c09b994036bc1d2efb15358334.png"></div><br><h3>  Compromise Indicators (IoC) </h3><br><blockquote>  <i>Distributive (package) of a compromised application</i> <br>  SHA-1: 07272d863ab77113e38e6ce3878c2162feb4893e <br>  File name: Transmission2.92.dmg <br>  ESET Detection: OSX / Keydnap.C </blockquote><br><blockquote>  <i>OSX / Keydnap dropper</i> <br>  SHA-1: e0ef6a5216748737f5a3c8d08bbdf204d039559e <br>  File Name: Transmission <br>  ESET Detection: OSX / TrojanDropper.Agent.A </blockquote><br><blockquote>  <i>OSX / Keydnap backdoor</i> <br>  SHA-1: 8ca03122ee73d3e522221832872b9ed0c9869ac4 <br>  ESET Detection: OSX / Keydnap.C <br>  C &amp; C Server Address: hxxp: //t4f2cocitdpqa7tv.onion <br>  Version: 1.5 </blockquote></div><p>Source: <a href="https://habr.com/ru/post/308928/">https://habr.com/ru/post/308928/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308918/index.html">Unity from the perspective of the artist in the development of cross-platform games</a></li>
<li><a href="../308920/index.html">Elo rating in two player games</a></li>
<li><a href="../308922/index.html">The main developer of the site Kremlin.ru Artem Geller on the creation of the service and work with the presidential administration</a></li>
<li><a href="../308924/index.html">The suicide squad. How was the world premiere prepared?</a></li>
<li><a href="../308926/index.html">Webpack + React. How to reduce the bundle 15 times</a></li>
<li><a href="../308930/index.html">Accelerate npm scripts</a></li>
<li><a href="../308932/index.html">Creating and managing the FQDN of the 3CX server name</a></li>
<li><a href="../308934/index.html">New practical courses on JavaScript and ES6</a></li>
<li><a href="../308936/index.html">UDL support</a></li>
<li><a href="../308938/index.html">Errors of questionnaires. Error 2: questionnaire wording. 13 cases of misunderstanding and manipulation in the survey (part 1)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>