<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How does the web-spider</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose we face the following task: to collect information about advertisements from various sites in different categories. In the future, this inform...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How does the web-spider</h1><div class="post__text post__text-html js-mediator-article">  Suppose we face the following task: to collect information about advertisements from various sites in different categories.  In the future, this information will be used to monitor and analyze the market, notifying about any events in this market.  It looks like the creation of a mini-search engine. <br><br>  In fact, we have 4 subsystems: <br>  1. Launch service for plugins that collect and retrieve information <br>  2. Temporary data storage <br>  3. Data Index <br>  4. Applications for working with extracted data, for example, report generator <br><br>  Consider each system in sequence. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Overview of Subsystems </h4><br><br><h5>  1. Startup service for plugins </h5><br>  It is a service that, according to the existing schedule, launches plug-ins from its library.  In case of an error of a separate plug-in, the service performs certain actions (logging, developer notification by e-mail, restart, plug-in shutdown, etc.) <br><br><h5>  2. Temporary data storage </h5><br>  The auxiliary system provides storage and access to pages downloaded from the Internet.  We cannot explicitly use the SQL database: data is downloaded from the Internet by continuous streams, there are a lot of them and they appear very quickly, besides, they are constantly accessed (read, modified, deleted), also in several streams and high frequency  There was an attempt to use NoSQL-databases, but they also could not withstand the load.  As a result, hybrid storage was made: information about the records is stored in the SQL database, and the HTML content itself is in large files.  Periodically, a special plugin ‚Äúcuts out‚Äù deleted pages from these files. <br><br><h5>  3. Data Index </h5><br>  An index is required for quick access to data.  Suppose we are going to view the number of ads in a particular category for the selected date.  To make a similar sample from the database and temporary storage each time is very expensive for server resources.  In addition, some data will be redundant.  Therefore, an index is built, where only IDs of ads and their categories for each day are entered. <br><br><h5>  4. Applications for working with extracted data </h5><br>  It's all clear.  These are applications with which the end user works.  The collected data, thanks to the built indexes, can now be quickly and conveniently viewed.  This can be a web application where the user selects report templates and selection criteria and receives data in the form of tables or graphs.  Maybe it will be daily letters to managers, reflecting the categories of ads in which there is increased activity. <br><br><h4>  Data production pipeline </h4><br><br>  Imagine getting data in the form of a pipeline. <br>  1. <b>A set of web spiders that download search results from source sites.</b>  These are the pages to which the search bot does not usually get (with the exception of SEO pages, but the number of ads in them is likely to be incomplete and contains only the most popular categories).  For each site you will have to write your own plugin with your own query logic.  Sometimes this is a GET request with parameters in the querystring, sometimes you have to send POST or even send parameters via cookies.  To write such a plugin will help any HTTP-analyzer built into the browser.  The task of the plug-in that downloads the search results is to cover all categories of ads on the site, visit all of its pages and save the contents to a temporary repository.  In order to avoid looping when moving through paging (paging - moving through the result pages), it is recommended to compare the page content with the previous one. <br><br>  2. The next stage of the pipeline is a <b>plugin that extracts from the loaded pages links to pages with a detailed description of the</b> advertisement (product, service, depending on the specialization of the site).  Here you can try to analyze all the links and select the necessary ones from them or go in a simple way and enter your description of such a link for each site.  The easiest way is to use your XPath expression to extract links from each site.  The plugin extracts the links, saves them to the database and marks the pages with the results as processed.  Additionally, the plugin can check if the page is an error message or that the search result has not found any results. <br>  In case you have a question for what you need to store pages with search results, I‚Äôll tell you what it is for.  There are very large sites, downloading of which takes a long time, and plug-ins are often forced to restart as a result of an error.  Errors will be, they may be related to the operation of the site, the performance of your server, network errors.  In this case, it is logical to continue the download from the place where the plugin was interrupted.  In case something has changed on the site and the links to the pages with details cannot be retrieved, it will be enough just to change the XPath or the extraction algorithm and restart the plugin.  It will quickly process all stored pages without re-downloading. <br><br>  3. Next comes the ‚Äúuniversal‚Äù plugin.  It <b>receives a list of links to pages with details and downloads them</b> , saving the pages in temporary storage.  In general, all pages (with search results and details) have a period of obsolescence, after which they are considered invalid and will be deleted.  And their processing is made from the old to the newer.  After processing, they are marked as processed.  Download links, in case of failure, are marked with the time of the download attempt so that you can try again later.  The cause of the error may be temporary unavailability of the server or proxy.  To download from individual sites may need a proxy.  Well, we should not forget about the load on the server of the data source site, it is necessary to send requests no more than 1 time per second. <br><br>  4. Having the page with the details of the ad, it remains only <b>to extract the necessary information from HTML</b> .  For this, you will again have to write your own plugin for each site or come up with a more intelligent universal one.  In the simplest case, you can again use XPath for each field of the document.  For parsing HTML, a library like HtmlAgilityPack is suitable.  The extracted information must be placed in a universal format (for example, XML) and passed on to the pipeline. <br><br>  5. From the set of xml-files with all the data, you can manage them in accordance with the tasks set, for example, <b>to build the corresponding index</b> , which specific applications will already use. <br><br><h4>  Conclusion </h4><br>  I very briefly introduced you to the real-life system, which is used for different verticals of sites.  In fact, when creating this system, which has been developing for 4 years, a lot of pitfalls appeared.  If this topic is met with a respected community with interest, I will write something more detailed on this topic. <br><br></div><p>Source: <a href="https://habr.com/ru/post/125754/">https://habr.com/ru/post/125754/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125748/index.html">Why did vSphere nearly become more expensive than RHEV 5 times?</a></li>
<li><a href="../125749/index.html">Google+ Crossposting on WordPress</a></li>
<li><a href="../125750/index.html">Intel Partner Program One Year Later: New Opportunities for Software Developers</a></li>
<li><a href="../125751/index.html">Search for a path on a hexagonal grid</a></li>
<li><a href="../125752/index.html">Geoffrey Moore's Double Penetration Theory</a></li>
<li><a href="../125756/index.html">The Noun Project: a free icon for every object in the world</a></li>
<li><a href="../125758/index.html">When your emails get spammed</a></li>
<li><a href="../125759/index.html">Tips for organizing and maintaining corporate Twitter</a></li>
<li><a href="../125760/index.html">Review of HTC Sensation</a></li>
<li><a href="../125765/index.html">Vkontakte for iPhone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>