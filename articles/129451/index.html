<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ZRouter - we shove FreeBSD into a DLINK router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of weeks ago 
 I ran around the Habra like mad in search of a recipe (how to revive the dead DIR-620 router). 
 The main problem was that the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ZRouter - we shove FreeBSD into a DLINK router</h1><div class="post__text post__text-html js-mediator-article">  A couple of weeks ago <br>  I ran around the Habra like mad in search of a recipe (how to revive the dead DIR-620 router). <br>  The main problem was that the native 620 firmware did not accept the Verizon U175 modem.  And after several DDWRT firmwares, I finally found the very one that ditched it and turned it into a <s>vegetable</s> switch stupid. <br>  But what happened next read under the cut <br><a name="habracut"></a><br>  Trips to local specialists were not crowned with success, some tried to connect to the console but failed, they recommended to change the chip itself on the programmer, others said that Bobby had died completely.  But still it was a pity to part with their blood 50dol.  And I ordered a DCA-510 cable in one of the online stores (this is again the whole story) and re-soldered it to fit my needs. <br>  Further, using the visual <a href="http://habrahabr.ru/blogs/DIY/123699/">aid</a> and the scheme: <img src="https://habrastorage.org/storage1/cb513ffc/390c8bb1/00643ac1/b1bf4e01.gif"><br>  and made myself access to the u-boot. <br>  After that, I managed to install on it a DD-WRT from ASUS rt-n13u which I installed for the first time.  But this time I already had a console and a desire to experiment with FreeBSD. <br><br>  FreeBSD is a start. <br>  At first, I was on the Internet on the <a href="http://wiki.freebsd.org/FreeBSD/mips/RT3052F">wiki</a> where the compilation of the BDD kernel was done for this chip.  Skompilil tried, well, it starts up and looks for a bootp. <br>  But further searches led me to the site <a href="http://zrouter.org/">zrouter.org.</a> On which I was lucky to download the very firmware that will be discussed. <br>  To begin, following the <a href="http://zrouter.org/projects/zrouter/wiki/QuickStart">advice of the</a> site do the points: <br><ul><li>  Download zrouter ( <b>hg clone <a href="http://zrouter.org/hg/zrouter/">zrouter.org/hg/zrouter</a></b> ) </li><li>  Downloading the latest FreeBSD build ( <b>hg clone <a href="http://zrouter.org/hg/FreeBSD/head">zrouter.org/hg/FreeBSD/head</a></b> ) </li></ul><br><br>  Next, I created the start.sh file: <br> <code>#!/bin/sh <br> export FREEBSD_SRC_TREE=/usr/home/zrouter/head/head <br> export OBJ_DIR=/home/zrouter/obj <br> exec ./menu.sh <br></code> <br>  just for easy start via <b>screen</b> <br>  Further, in the best traditions of FreeBSD, a text interface appears. <br><img src="https://habrastorage.org/storage1/c6ae677a/1ba7e3fb/57d0905b/c7f043a0.png"><br>  With the choice of parameters of the platform and build 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      for DIR-620, chose Device -&gt; DIR-620, Target -&gt; zImage respectively <br>  So far, I do not recommend using Save \ Load items, as due to them, my build did not reach the end of falling out with an error: <br> <code>==&gt; building zrouter !!! <br> "Makefile.inc1", line 139: Unknown target mipsel:mips. <br> "Makefile", line 280: warning: "(MAKEOBJDIRPREFIX=/usr/obj//usr/home/andriyj/zrouter/zrouter/tmp/ make TARGET=mips TARGET_ARCH=mipsel TARGET_CPUARCH=mips ZROUTER_ROOT=/usr/home/andriyj/zrouter/zrouter WITHOUT_ASSERT_DEBUG=yes WITHOUT_ATM=yes WITHOUT_CLANG=yes WITHOUT_INFO=yes WITHOUT_INSTALLLIB=yes WITHOUT_IPX=yes WITHOUT_LOCALES=yes WITHOUT_MAN=yes WITHOUT_NLS=yes WITHOUT_PROFILE=yes WITHOUT_RESCUE=yes WITHOUT_SSP=yes -DNO_CLEAN WITHOUT_JAIL=yes WITHOUT_INET6=yes WITHOUT_INET6_SUPPORT=yes WITHOUT_MAN=yes WITHOUT_INFO=yes WITHOUT_NLS=yes WITHOUT_CDDL=yes WITHOUT_NIS=yes WITHOUT_BLUETOOTH=yes NOENABLE_WIDEC=yes -DNOENABLE_WIDEC WITHOUT_KERBEROS=yes WITHOUT_KERBEROS_SUPPORT=yes -C /usr/src buildenvvars)" returned non-zero status <br> "Makefile", line 288: Need an operator <br> "Makefile", line 288: Need an operator <br> "Makefile", line 288: Need an operator <br> "Makefile", line 288: Need an operator <br> "Makefile", line 288: Need an operator <br> "Makefile", line 288: Need an operator <br> "Makefile", line 288: Need an operator <br> make: fatal errors encountered -- cannot continue <br></code> <br>  Click on Build and look forward to creating an image. <br>  Next, raise the tftp and try to boot. <br><h4>  Firmware </h4><br>  Since I already had DDWRT on my router and didn‚Äôt really want to demolish it, I first used point 4 U-boot followed by tftp test.bin and bootm, but I didn‚Äôt want to load the packed kernel (it gave an error when checking lzma).  Then, following the advice found in the open spaces, <a href="http://www.dd-wrt.com/">www.dd-wrt.com</a> tried to load according to item 1. And the load of the packed kernel went.  But stubbornly not seen rootfs. <br>  Gathering arrogance, I wrote directly to the developer: <a href="http://www.facebook.com/arybalko">Oleksandra Rybalko</a> .  In conversation and samples with which we spent the next few hours (more precisely, about 3 days but worked in the evenings for a maximum of 1-2 hours). <br>  As a result, it turned out that the ZRouter kernel is looking for rootfs at the address in flash memory and not RAM.  After flashing the router on point 2 of the U-boot, I finally got the coveted FreeBSD. <br><br><h4>  Customization </h4><br>  The web interface is very simple, I would even say spartan. <br>  In the settings were found as befits: DHCP, PPTP, PPPoE, 3G, Wifi (temporarily disabled). <br>  Actually their configuration is the same for any such things, regardless of the firmware and manufacturer. <br>  It is worth noting, however, that the Update button does not save data.  This is done by the Save settings button in the main menu. <br>  Further setting 3G modem-a (I had to change only the link to the device /dev/cuaU0.0), save the settings (required), reboot (required). <br>  The modem went up with a bang. <br><br><h4>  Results, rake that does not necessarily occur </h4><br>  Results <br>  1. The firmware works (actually through it now and the Internet on which I write here) <br>  2. There are problems with Wifi (according to the developer‚Äôs claims, it‚Äôs working at about 60%, but it‚Äôs not yet configured in the browser) <br>  3. 3G modems are determined with a bang (at least from the tried firmware Dlink original, DDWRT, ZRouter, only the latter normally identified my Verizon U175 <br><br>  Rake: <br>  1. Be sure to use the fresh kernel from the ZRouter repositories. <br>  2. Be sure to flash and do not try to run from RAM <br>  3. Update does not record data, so it is necessary to forcibly record everything through the menu. <br><br>  PS <br>  I thank for the working router: <br>  - <a href="http://www.facebook.com/arybalko">www.facebook.com/arybalko</a> <br>  - <a href="http://zrouter.org/">Collective zrouter.org</a> <br>  - Interlocutors from #zrouter channel on IRC EFNet <br>  UPD: For those who want to support the project <br>  Wallets: <br>  - Z105679867090 <br>  - U364832937482 <br>  - R959084523149 <br>  - E366383023429 </div><p>Source: <a href="https://habr.com/ru/post/129451/">https://habr.com/ru/post/129451/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129441/index.html">Bootstrap Fund launched - a new type of incubator / fund / business club</a></li>
<li><a href="../129442/index.html">New version of ABBYY TextGrabber: two in one</a></li>
<li><a href="../129443/index.html">The secrets of numerology in the invitation of Apple</a></li>
<li><a href="../129445/index.html">FreeRTOS: mutexes and critical sections</a></li>
<li><a href="../129446/index.html">MultiWAN on the DIR-320</a></li>
<li><a href="../129452/index.html">Why can I stop writing on Habrahabr</a></li>
<li><a href="../129454/index.html">Userscripts. Go deep</a></li>
<li><a href="../129455/index.html">LGDC # 2 in November. We invite to participate</a></li>
<li><a href="../129456/index.html">Citizens! Give a chance to support</a></li>
<li><a href="../129458/index.html">Color cipher for recording information in genes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>