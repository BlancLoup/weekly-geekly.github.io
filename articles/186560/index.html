<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Viewing images from the L15 format of the Electro-L satellite</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear Habarusery. 
 As you know, photos from the Electro-L satellite are laid out on FTP in two formats. 
 One is the well-known jpg, which is n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Viewing images from the L15 format of the Electro-L satellite</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear Habarusery. <br>  As you know, photos from the Electro-L satellite are laid out on FTP in two formats. <br>  One is the well-known jpg, which is not interesting to us. <br>  The second, <a href="http://habrahabr.ru/post/169887/">as</a> <a href="https://geektimes.ru/users/zelenyikot/" class="user_link">Zelenyikot</a> <a href="http://habrahabr.ru/post/169887/">wrote</a> <br><blockquote>  The ‚Äúsecret‚Äù format is available only to meteorologists.  There is no software in the network that allows you to open and view it.  True, I was assured that from the point of view of the picture, there is the same thing as on JPEG, and the additional information is just text ‚Äî everyone there, altitude, temperature, speed ... </blockquote><br>  Here we try to read it. <br>  I could not read the additional information, but the picture is quite readable, and it differs somewhat from the one in JPG, in the number of bits per single channel.  If there are 8 of them in JPG (256 shades of gray), then in L15 there are 10 of them (1024 shades of gray). <br><a name="habracut"></a><br><br>  If the image in the file is not encrypted, then it should contain the image size.  Let's hope that it is not encrypted. <br>  Image sizes from satellite photos in jpg format 2784x2784.  Transferring 2784 to HEX, we get 0A E0.  This sequence must be inverted and look for E0 0A <br>  Found <code>e0 0a 00 00 e0 0a 00 00 10 00</code> <br>  By grouping this data into 4 bytes and displaying as a decimal, we get <code>2784 2784 16</code> <br><br>  From the end of the block inserted slightly to the end of the file 0xEC8800 (15501312) bytes. <br>  15501312 / (2784 * 2784) = 2.  From these results, assume that one pixel is described by two bytes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But before you try to read the image you need to understand how to find the place from which it begins. <br>  Two days of searching in the L15 files or the direct address of the region with the image or a plot close to it, or the displacement to this address did not lead to success. <br>  Therefore, we will look for this area "in the forehead", reading the file bit by bit until the number 2784 or 11136 is encountered (this is the resolution of the images from the RGB channels). <br>  After that, we check whether this number is repeated again, and, if it repeats, we check whether the next number is 16. <br>  If everything is correct, congratulations, we found the beginning of the picture. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Find_Image_Pos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE *EL_Data,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *res_out)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> int_data; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> resolution; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> filepos; filepos=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!feof(EL_Data)) { fseek(EL_Data,filepos,SEEK_SET); fread((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)&amp;int_data,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>),<span class="hljs-number"><span class="hljs-number">1</span></span>,EL_Data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(int_data==<span class="hljs-number"><span class="hljs-number">2784</span></span>||int_data==<span class="hljs-number"><span class="hljs-number">11136</span></span>) { resolution=int_data; fread((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)&amp;int_data,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>),<span class="hljs-number"><span class="hljs-number">1</span></span>,EL_Data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(int_data==resolution) { fread((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>*)&amp;int_data,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>),<span class="hljs-number"><span class="hljs-number">1</span></span>,EL_Data); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(int_data==<span class="hljs-number"><span class="hljs-number">16</span></span>) { *res_out=resolution; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ftell(EL_Data); } } } filepos++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  The method is a crutch, but so far no errors were given <br><br>  Now you need to read this image and somehow display it or save it to a file.  Since I didn‚Äôt work with images, I decided to use the <a href="http://ru.wikipedia.org/wiki/Portable_anymap">Portable anymap</a> format to speed up the process and facilitate the code. <br><pre> <code class="cpp hljs">    <span class="hljs-number"><span class="hljs-number">2</span></span>       . <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Save_Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FILE *EL_Data,FILE *EL_Image,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pos,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> resolution)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> P5 char header[50]; sprintf(header,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"P5\n%i %i\n1024\n"</span></span></span><span class="hljs-meta">,resolution,resolution); fwrite(&amp;header,strlen(header),1,EL_Image); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> fprintf(EL_Image,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"P2\n%i %i\n1024\n"</span></span></span><span class="hljs-meta">,resolution,resolution); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> int progress=-1; int max=0; int x=0,y=0; int pixel=0; fseek(EL_Data,pos,SEEK_SET); for(y=0;y</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;resolution;y++) { if(progress&lt;(y*100/resolution)) { progress=(y*100/resolution); cout&lt;&lt;progress&lt;&lt;"%"&lt;&lt;endl; } for(x=0;x&lt;resolution;x++) { fread(&amp;pixel,2,1,EL_Data); #ifdef P5 fwrite(&amp;pixel,1,1,EL_Image); #else fprintf(EL_Image,"%i\n",pixel); #endif if(pixel&gt;max) max=pixel; } } cout&lt;&lt;"100 %"&lt;&lt;endl; cout&lt;&lt;"max="&lt;&lt;max&lt;&lt;endl; }</span></span></span></span></code> </pre><br>  In the P5 format, pixels whose brightness is greater than 255 (that is, greater than the 1st byte) turn black. <br><br>  Result: <br>  P2: <br><img src="http://habrastorage.org/storage2/d6d/5e7/aac/d6d5e7aacb9fc743b3f3247c89622811.jpg"><br>  P5 <br><img src="http://habrastorage.org/storage2/646/42a/7fe/64642a7fe9507588972834878fc198b4.jpg"><br><br>  And lastly, the code that connects the above functions <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt;; #include &lt;stdio.h&gt; #include &lt;tchar.h&gt; #include &lt;stdlib.h&gt; #include &lt;windows.h&gt; //#define P5 using namespace std; long Find_Image_Pos(FILE *EL_Data,int *res_out); void Save_Image(FILE *EL_Data,FILE *EL_Image,long pos,int resolution); int _tmain(int argc, _TCHAR* argv[]) { FILE *EL_Data,*EL_Image; if(argc==1) return 0; EL_Data=_wfopen(argv[1],L"rb"); if(!EL_Data) return 0; wchar_t out_file[300]; #ifdef P5 wsprintf(out_file,L"%s.P5.pgm",argv[1]); EL_Image=_wfopen(out_file,L"wb"); #else wsprintf(out_file,L"%s.P2.pgm",argv[1]); EL_Image=_wfopen(out_file,L"wt"); #endif if(!EL_Image) return 0; int resolution=0; long pos=Find_Image_Pos(EL_Data,&amp;resolution); if(!pos) return 0; Save_Image(EL_Data,EL_Image,pos,resolution); fclose(EL_Image); fclose(EL_Data); return 0; }</span></span></span></span></code> </pre><br><br>  Images with a color depth of 10 bits per channel can be used to create HDRi images.  However, this is a topic for a separate topic. <br><br>  UPD: There is a suspicion that text data is stored in wchar format.  I'll have to check ... </div><p>Source: <a href="https://habr.com/ru/post/186560/">https://habr.com/ru/post/186560/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186540/index.html">New version of Cubieboard2 Allwinner A20 (Cortex-A7 Dual-Core)</a></li>
<li><a href="../186546/index.html">Raspberry Picrowave: very, very smart microwave</a></li>
<li><a href="../186552/index.html">The digest of news from the world of mobile development for the last week ‚Ññ20 (July 8 - 14, 2013)</a></li>
<li><a href="../186554/index.html">I, the pirate (chapters 3-5)</a></li>
<li><a href="../186558/index.html">Astrid Task Manager closes. Comparison of alternatives</a></li>
<li><a href="../186564/index.html">Index the sky</a></li>
<li><a href="../186568/index.html">Automatic notification of changes in the status of postal parcels via SMS</a></li>
<li><a href="../186570/index.html">Using ncurses in PHP</a></li>
<li><a href="../186572/index.html">A simple technique for building product filters using MongoDb and MapReduce</a></li>
<li><a href="../186574/index.html">About coffee and about the Web, or why PHP is a bicycle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>