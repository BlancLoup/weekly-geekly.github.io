<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tutorial on the Unreal Engine. Part 10: How to create a simple FPS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="First-person shooter (FPS) is a genre in which a player uses a weapon and looks at the world through the eyes of a character. FPS games are extremely ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tutorial on the Unreal Engine. Part 10: How to create a simple FPS</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a19/9a2/a29/a199a2a290c03ade030b9156035a526f.jpg" alt="image"></div><br>  First-person shooter (FPS) is a genre in which a player uses a weapon and looks at the world through the eyes of a character.  FPS games are extremely popular, as seen by the success of franchises such as <i>Call of Duty</i> and <i>Battlefield</i> . <br><br>  Unreal Engine was originally created to develop FPS, so it is logical to use it to create such a game.  In this tutorial you will learn the following: <br><br><ul><li>  Create a Pawn with a first-person view that can move and look around </li><li>  Create weapons and tie them to player pawn </li><li>  Shoot bullets using direct tracing (also known as ray tracing) </li><li>  Damage the actors </li></ul><a name="habracut"></a><br><blockquote>  <em>Note:</em> This article is the tenth part of a series of tutorials dedicated to the Unreal Engine: </blockquote><br><ul><li>  <a href="https://habrahabr.ru/post/344394/">Part 1: Introduction to the engine</a> </li><li>  <a href="https://habrahabr.ru/post/344446/">Part 2: Blueprints</a> </li><li>  <a href="https://habrahabr.ru/post/344522/">Part 3: Materials</a> </li><li>  <a href="https://habrahabr.ru/post/344600/">Part 4: UI</a> </li><li>  <a href="https://habrahabr.ru/post/344690/">Part 5: How to create a simple game</a> </li><li>  <a href="https://habrahabr.ru/post/344840/">Part 6: Animation</a> </li><li>  <a href="https://habrahabr.ru/post/345018/">Part 7: Sound</a> </li><li>  <a href="https://habrahabr.ru/post/345110/">Part 8: Particle Systems</a> </li><li>  <a href="https://habrahabr.ru/post/346498/">Part 9: Artificial Intelligence</a> </li><li>  <a href="https://habrahabr.ru/post/347036/">Part 10: How to create a simple FPS</a> </li></ul><br><h2>  Getting Started </h2><br>  Download the <a href="">project blank</a> and unpack it.  Go to the project folder and open <em>BlockBreaker.uproject</em> .  You will see the following scene: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/535/c08/f9d/535c08f9d8b1e4bce036d479d3b746ce.jpg"></div><br>  The green wall consists of many goals.  When they are dealt damage, they turn red.  When their health reaches zero, they disappear.  Red button re-sets all targets. <br><br>  First you need to create a pawn player. <br><br><h2>  Making Pawn Player </h2><br>  Go to the <em>Blueprints</em> folder and create a new <em>Blueprint Class</em> .  Select <em>Character</em> as the parent class and name it <em>BP_Player</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57d/1a6/3f0/57d1a63f0f1ee41ed797ccaa72a0a067.jpg"></div><br>  <em>Character</em> is a type of Pawn, but with additional functionality, for example, with the <em>CharacterMovement</em> component. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ba/2ec/dbc/8ba2ecdbc419d4280b367b0ea8e3c908.jpg"></div><br>  This component automatically handles movement, such as walking and jumping.  We just call the appropriate function, so Pawn moves.  In this component, you can also set variables, such as walking and jumping speeds. <br><br>  To make Pawn move, we need to know when a player presses the movement key.  To do this, we will tie the movement to the keys <em>W</em> , <em>A</em> , <em>S</em> and <em>D.</em> <br><br><blockquote>  <em>Note:</em> If you are unfamiliar with bindings, you can read about them in the part of the tutorial on <a href="https://habrahabr.ru/post/344446/">Blueprints</a> .  Key binding, we determine which keys will perform the action. </blockquote><br><h3>  Creating motion bindings </h3><br>  Select <em>Edit \ Project Settings</em> and open <em>Input</em> settings. <br><br>  Create two <em>Axis Mappings</em> called <em>MoveForward</em> and <em>MoveRight</em> .  MoveForward will drive forward and backward.  MoveRight - moving left and right. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ca/cab/f49/4cacabf49c368e10e9ec02e03b1cabe8.jpg"></div><br>  For <em>MoveForward,</em> replace the key with <em>W.</em>  After that, create another key and select <em>S.</em>  Change the <em>Scale</em> for <em>S</em> to <em>-1.0</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/01f/cd9/aec/01fcd9aecb816edda31c0885c44da856.jpg"></div><br><blockquote>  <em>Note:</em> If you want to learn more about the <em>Scale</em> field, read the <a href="https://habrahabr.ru/post/344446/">Blueprints</a> tutorial.  The section " <em>Axis value and input scale</em> " says what it is and how to use it. </blockquote><br>  Later we will multiply the scale value by the forward pawn vector.  This will give us a vector directed <em>forward</em> with a <em>positive</em> scale.  If the scale is <em>negative</em> , then the vector will be directed <em>backwards</em> .  With the help of the resulting vector it will be possible to move Pawn forward and backward. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d49/043/79d/d4904379dfaaf4798c532ad5b82a3e93.jpg"></div><br>  Now we need to do the same for moving left and right.  Change the key for <em>MoveRight</em> to <em>D.</em>  Then create a new key and select A for it.  Change <em>Scale</em> for <em>A</em> to <em>-1.0</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c6/09b/891/5c609b8911acc6b9e864b1488d947c70.jpg"></div><br>  Now that we have set up bindings, we need to use them for movement. <br><br><h3>  Implementation of the movement </h3><br>  Open <em>BP_Player</em> , and then open Event Graph.  Add a <em>MoveForward</em> event (the one listed in the <em>Axis Events</em> list).  This event will be executed in each frame, even if you do not press anything. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c5/ef5/bc3/0c5ef5bc3aba52b4b786600cf981c44b.jpg"></div><br>  It will also output an <em>Axis Value</em> , which is equal to the <em>Scale</em> values ‚Äã‚Äãpreviously specified.  It will feed output <em>1</em> when you press <em>W</em> and <em>-1</em> when you press <em>S.</em>  If you do not press the keys, then the output will be <em>0</em> . <br><br>  Next you need to order the pawn to move.  Add the <em>Add Movement Input</em> and connect it as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bc/157/422/6bc157422b5a43c39862279e6c9539aa.jpg"></div><br>  <em>Add Movement Input</em> will receive the vector and multiply it by the <em>Scale Value</em> .  This transforms it in the appropriate direction.  As we use <em>Character</em> , the <em>CharacterMovement</em> component will move Pawn in that direction. <br><br>  Now we need to specify the direction of movement.  Since we want to move forward, we can use the <em>Get Actor Forward Vector</em> .  This will return the vector directed forward.  Create it and connect as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7f3/7f0/bed/7f37f0bed678ddb24c390bfa7eb9470c.jpg"></div><br>  Summarize: <br><br><ol><li>  <em>MoveForward</em> runs every frame and passes <em>Axis Value</em> to the output.  This value will be equal to <em>1</em> when you press on <em>W</em> and <em>-1</em> when you press on <em>S.</em>  If you do not press any of these keys, then the output will be <em>0</em> . </li><li>  <em>Add Movement Input</em> multiplies <em>the forward</em> pawn <em>vector</em> by the <em>Scale Value</em> .  Due to this, depending on the key pressed, the vector will be directed forward or backward.  If you do not press the keys, the vector will have no direction, that is, the pawn will not move. </li><li>  The <em>CharacterMovement</em> component receives the result from the <em>Add Movement Input</em> , and then moves Pawn in that direction. </li></ol><br>  <em>Repeat the</em> process for <em>MoveRight</em> , but replace <em>Get Actor Forward Vector</em> with <em>Get Actor Right Vector</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4fe/814/620/4fe8146207bb3dad436ee00784717079.jpg"></div><br>  To test the movement you need to set the default pawn in game mode. <br><br><h3>  Default pawn job </h3><br>  Click on <em>Compile</em> and return to the main editor.  Open the <em>World Settings</em> panel and locate the <em>Game Mode</em> section.  Change the <em>Default Pawn Class</em> to <em>BP_Player</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f89/7c4/256/f897c42563c641396a71fcb693f5f185.jpg"></div><br><blockquote>  <em>Note:</em> if you do not have the World Settings panel, go to the Toolbar and select <em>Settings \ World Settings</em> . </blockquote><br>  Now when you start the game you will automatically use <em>BP_Player</em> .  Click on <em>Play</em> and use the <em>W</em> , <em>A</em> , <em>S</em> and <em>D</em> keys to move through the level. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/054/ca2/7e5/054ca27e573cc1752cad0f28c5b03f99.gif"></div></div></div><br>  Now we will create bindings to rotate the head. <br><br><h2>  Creating overview bindings </h2><br>  Open <em>Project Settings</em> .  Create two more <em>Axis Mappings</em> called <em>LookHorizontal</em> and <em>LookVertical</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21b/08e/af5/21b08eaf57b175a8efe1a8a1c82b2c22.jpg"></div><br>  Replace the key for <em>LookHorizontal</em> with <em>Mouse X.</em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/170/6d9/94d/1706d994da3b16bafb1835ddacd6b7aa.jpg"></div><br>  This binding will produce a positive value when you move the mouse <em>to the right</em> , and vice versa. <br><br>  Now change the key for <em>LookVertical</em> to <em>Mouse Y.</em> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e50/dc8/345/e50dc8345b9cccf3e589d5ea0d4bd969.jpg"></div><br>  This binding will produce a positive value when you move the mouse <em>up</em> , and vice versa. <br><br>  Now we need to create logic to look around. <br><br><h3>  Implementation of the review </h3><br>  If Pawn does not have a <em>Camera</em> component, Unreal automatically creates a camera for you.  By default, the camera will use a rotation <em>controller</em> . <br><br><blockquote>  <em>Note:</em> if you want to learn more about controllers, then study our tutorial " <a href="https://habrahabr.ru/post/346498/">Artificial Intelligence</a> ". </blockquote><br>  Despite the fact that the controllers are not physical, they still have their own turn.  This means that you can direct the view of Pawn and the camera in different directions.  For example, in a third-person game, the character and the camera do not always look in the same direction. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee3/cdf/bad/ee3cdfbad8f4ac05eac25ec282dd62d5.gif"></div></div></div><br>  To rotate the camera in the game from the first person it is enough for us to change the rotation of the controller. <br><br>  Open a <em>BP_Player</em> and create a <em>LookHorizontal</em> event. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d5/983/6f1/2d59836f1f40ffde2d1bbb52cad4e282.jpg"></div><br>  To make the camera turn left or right, we need to adjust the <em>yaw (yaw)</em> .  Create an <em>Add Controller Yaw Input</em> and connect it as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1fb/64f/ee5/1fb64fee56c28d57106a7f95911b74d2.jpg"></div><br>  Now when the mouse moves horizontally, the controller will turn left or right.  Since the camera uses the rotation of the controller, it will also rotate. <br><br>  Repeat the process for <em>LookVertical</em> , but replace <em>Add Controller Yaw Input</em> with <em>Add Controller Pitch Input</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6bc/a7b/bf0/6bca7bbf0c4104a8b62f33acc99e618a.jpg"></div><br>  If you start the game now, you will notice that the vertical movement of the camera is <em>inverted</em> .  This means that when you move the mouse <em>up, the</em> camera will look <em>down</em> . <br><br>  If you prefer a non-inverted control, then multiply the <em>Axis Value</em> by <em>-1</em> .  This inverts the <em>Axis Value</em> , which inverts the slope of the controller. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c24/a65/8c3/c24a658c3fe341acb7977b1a6665a2a2.jpg"></div><br>  Click on <em>Compile</em> and click <em>Play</em> .  Take a look around with your mouse. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd3/7de/e96/dd37dee96383bde68d5d90c2636cd220.gif"></div></div></div><br>  Now that all the movement and review are ready, it's time to create a weapon! <br><br><h2>  Making weapons </h2><br>  Remember that when creating a Blueprint Class, you can choose a parent class?  You can also choose your own Blueprints as parents.  This is useful when there are different types of objects with common functionality or attributes. <br><br>  Suppose we need to create different types of cars.  You can create a base car class that contains variables such as speed and color.  Then you can create classes (child) that will use the base class of the car as the parent.  Each child class will contain the same variables.  Now you have an easy way to create machines with different speeds and colors. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69f/9e6/635/69f9e6635cb9cefb060f8aa8c65753f2.jpg"></div><br>  The same way you can create weapons.  To do this, you must first create a base class. <br><br><h3>  Creating a base weapon class </h3><br>  Return to the main editor and create a <em>Blueprint Class of</em> type <em>Actor</em> .  Call it <em>BP_BaseGun</em> and open it. <br><br>  Now we will create several variables defining the properties of the weapon.  Create the following <em>float</em> variables: <br><br><ul><li>  <em>MaxBulletDistance: the</em> maximum range of each bullet </li><li>  <em>Damage: the</em> amount of damage caused by a bullet when hit by an actor </li><li>  <em>FireRate: the</em> gap (in seconds) between shots of bullets with weapons </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/448/a22/cc0/448a22cc03928a2bc14fb05ab701ce89.jpg"></div><br><blockquote>  <em>Note:</em> the default values ‚Äã‚Äãfor all variables are zero, which is quite appropriate for a tutorial.  However, if you want the new weapon classes to have a different default value, then you need to set it in <em>BP_BaseGun</em> . </blockquote><br>  Now we need a physical representation of this weapon.  Add the <em>Static Mesh</em> component and name it <em>GunMesh</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b05/16f/393/b0516f393e97fe55cbc3885c28a0ecb8.jpg"></div><br>  Don't worry about choosing a static mesh yet.  We will deal with this in the next section, where we will create a child weapon class. <br><br><h3>  Creating a child class weapon </h3><br>  Click on <em>Compile</em> and return to the main editor.  To create a child class, <em>right-click</em> on <em>BP_BaseGun</em> and select <em>Create Child Blueprint Class</em> . <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbe/a7c/070/cbea7c070f14cac296ac42daf1ca8dac.gif"></div></div></div><br>  Call it <em>BP_Rifle</em> and open it.  Open <em>Class Defaults</em> and set the following values ‚Äã‚Äãto variables: <br><br><ul><li>  <em>MaxBulletDistance:</em> 5000 </li><li>  <em>Damage:</em> 2 </li><li>  <em>FireRate:</em> 0.1 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4df/e54/999/4dfe54999a0c289268aca05ea1e7c949.jpg"></div><br>  This means that the maximum path of each bullet will be equal to <em>5000</em> .  If it hits the actor, it will deal <em>2</em> damage.  When shooting bursts, the interval before each shot will be equal to not less than <em>0.1</em> seconds. <br><br>  Now we need to specify the mesh that will be used by the weapon.  Select the <em>GunMesh</em> component and select <em>SM_Rifle</em> for <em>Static Mesh</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/c34/ed5/618c34ed5b56963e64a7c5b330d7f419.jpg"></div><br>  Now the weapon is ready.  Click on <em>Compile</em> and close <em>BP_Rifle</em> . <br><br>  Now we will create our own camera component.  He will give us more convenient control of the location of the camera.  He will also allow us to attach the weapon to the camera so that it is always in front of the camera. <br><br><h2>  Camera creation </h2><br>  Open the <em>BP_Player</em> and create the <em>Camera</em> component.  Call it <em>FpsCamera</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d5/1b1/487/1d51b14873a35992ccb2b38b45fb21da.jpg"></div><br>  The default position is quite low, because of which the player may feel small.  Change the <em>location of</em> the <em>FpsCamera</em> camera to <em>(0, 0, 90)</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/10e/bb1/db8/10ebb1db8f1ebc666ea203e80cae21eb.jpg"></div><br>  By default, the Camera components do not use a controller rotation.  To fix this, go to the Details panel and turn on <em>Camera Settings \ Use Pawn Control Rotation</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b9/7ae/225/4b97ae2258946ea1fe3407486708a1e8.jpg"></div><br>  Now we need to set the place where the weapon should be. <br><br><h2>  Setting the weapon's location </h2><br>  We can use the <em>Scene</em> component to create a weapon location.  These components are ideal for setting locations because they contain only Transforms.  Select <em>FpsCamera</em> and create the <em>Scene</em> component.  This way it attaches to the camera.  Call it <em>GunLocation</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66f/057/451/66f057451e1be4d77cfad2581cbbabf6.jpg"></div><br>  Due to the fact that we have attached <em>GunLocation</em> to <em>FpsCamera</em> , the weapon will always maintain its position relative to the camera.  Thus, we will always see the weapon in front of the camera. <br><br>  Now assign the <em>location of the</em> component <em>GunLocation</em> values <em>(30, 14, -12)</em> .  So we will place the weapon in front and slightly to the side of the camera. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ed/a36/26f/7eda3626f28fd76de6b20234b2256b8d.jpg"></div><br>  Then we set the <em>rotation</em> values <em>(0, 0, -95)</em> .  When we attach the weapon, it will seem that it is always directed to the center of the screen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56d/148/582/56d14858278425f7cf0e7e90a75175b8.jpg"></div><br>  Now we need to create a weapon and attach it to <em>GunLocation</em> . <br><br><h3>  Creating and attaching weapons </h3><br>  Find the <em>Event BeginPlay</em> and create a <em>Spawn Actor From Class</em> .  Set the <em>Class</em> to <em>BP_Rifle</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/061/d51/dca/061d51dca101a6f683ab8a0ec01496a2.jpg"></div><br>  Since we will need to use the weapon later, we will store it in a variable.  Create a variable of type <em>BP_BaseGun</em> and name it <em>EquippedGun</em> . <br><br><blockquote>  It is important that the variable <em>does not</em> have type <em>BP_Rifle</em> , because the player can have different types of weapons, and not just one.  If you create a different type of weapon, we will not be able to store it in a variable of type <em>BP_Rifle</em> .  It will look like we are trying to shove a circle into a rectangular hole. <br><br>  Choosing the <em>BP_BaseGun</em> type for a variable, we created a large ‚Äúhole‚Äù suitable for many ‚Äúshapes‚Äù. </blockquote><br>  Now set <em>EquippedGun</em> to <em>Return Value</em> <em>Spawn Actor From Class</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc5/ea4/b2b/bc5ea4b2be85b9b86f40f414fbc51564.jpg"></div><br>  To attach a weapon, we can use <em>AttachToComponent</em> .  Create it and set the <em>Location Rule</em> and <em>Rotation Rule</em> to <em>Snap to Target</em> .  Thanks to this, the weapon will have the same location and rotation as the parent. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/204/111/20a/20411120aaad3107b00da7b31bd0bb67.jpg"></div><br>  Now create a link to <em>GunLocation</em> and connect everything as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53e/b06/713/53eb06713169f07cdb472d2c87e29343.jpg"></div><br>  Summarize: <br><br><ol><li>  When creating a <em>BP_Player,</em> it will create an instance of <em>BP_Rifle.</em> </li><li>  <em>EquippedGun</em> will store the link to the created <em>BP_Rifle</em> for future use. </li><li>  <em>AttachToComponent</em> attaches a weapon to <em>GunLocation</em> </li></ol><br>  Click on <em>Compile</em> and click <em>Play</em> .  Now, when creating a player, a weapon will be created!  When cornering, the weapon will always be in front of the camera. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bba/56e/81a/bba56e81aff12133547ec2e5678c6c9f.gif"></div><br>  Now the fun begins: we will shoot!  To check whether a bullet hit somewhere, we can use <em>direct tracing</em> . <br><br><h2>  Shooting bullets </h2><br>  Tracing lines is a function that obtains start and end points (forming a line).  She checks each point on a straight line (from beginning to end) until something hits it.  In games for checking hit of a bullet, this method is most often used. <br><br>  Since shooting is a weapon function, it must be performed in a weapon class, not a player.  Open <em>BP_BaseGun</em> and create a function <em>Shoot</em> . <br><br>  Then create two <em>Vector</em> inputs and name them <em>StartLocation</em> and <em>EndLocation</em> .  These will be the starting and ending points of the direct trace (which we will transmit from the <em>BP_Player</em> ). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/76b/c33/465/76bc3346558cff77ef595311d70a9deb.jpg"></div><br>  Tracing lines can be performed using <em>LineTraceByChannel</em> .  This node checks hits using a <em>Visibility</em> or <em>Camera</em> collision channel.  Create it and connect as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/546/3dc/820/5463dc82033abcd8128c8cbbb96a4f4a.jpg"></div><br>  Now we need to check if the tracing of the lines falls into something.  Create a <em>Branch</em> and connect it like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02c/a4c/5a1/02ca4c5a1721b6c1fffb66ca2ac791f3.jpg"></div><br>  When hit, the <em>Return Value</em> will return <em>true</em> and vice versa. <br><br>  To give the player visual feedback on where the bullet hit, you can use the particle effect. <br><br><h3>  Creating bullet particles </h3><br>  First we need to get the location of the hit trace.  <em>Drag Left</em> <em>Out Out</em> on the graph.  In the menu, select <em>Break Hit Result</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a2/c09/b81/2a2c09b8195dcfc61104b4809100c7a0.jpg"></div><br>  So we will create a node with different contacts related to the results of the direct trace. <br><br>  Create a <em>Spawn Emitter at Location</em> and set the <em>Emitter Template</em> to <em>PS_BulletImpact</em> .  Then connect its <em>Location</em> to the <em>Location of the</em> <em>Break Hit Result</em> node. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/48a/f75/e6f/48af75e6f48b6650b53150c22939b16e.jpg"></div><br>  Here is what it will look like: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4be/bf8/874/4bebf88743ad612fc6c7e0bc36f2d315.jpg"></div><br>  Summarize: <br><br><ol><li>  When performing a <em>Shoot,</em> it performs a straight line trace with the transmitted starting and ending point. </li><li>  If the hit is fixed, <em>Spawn Emitter at Location</em> will create a <em>PS_BulletImpact</em> at the hit point. </li></ol><br>  Now that the shooting logic is complete, we need to use it. <br><br><h3>  Call the function Shoot </h3><br>  First we need to create a key bindings for shooting.  Click on <em>Compile</em> and open the <em>Project Settings</em> .  Create a new <em>Axis Mapping</em> called <em>Shoot</em> .  Select the <em>Left Mouse Button</em> key for it and close the <em>Project Settings</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee9/c8b/de7/ee9c8bde7d4f26690475ef2db31b8221.jpg"></div><br>  Then open the <em>BP_Player</em> and create a <em>Shoot</em> event. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/382/bf5/e26/382bf5e26f48c569ca915ae32ecd30c8.jpg"></div><br>  To check whether the player presses the <em>Shoot</em> key, it is enough for us to check whether the <em>Axis Value</em> value is equal to one ( <em>1</em> ).  Create selected nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b3/972/add/3b3972addb482164027385de42e72215.jpg"></div><br><br>  Then create a link to <em>EquippedGun</em> and call its function <em>Shoot</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c08/d87/159/c08d87159ae10883c881879647b0b41c.jpg"></div><br>  Now we need to calculate the start and end points for tracing a straight line. <br><br><h3>  Calculate direct trace points </h3><br>  In many FPS the bullet flies from the camera, and not from the weapon.  This is done because the camera is already perfectly aligned with the gun.  Therefore, if we shoot from the camera, the bullet is guaranteed to fly to where the cursor is. <br><br><blockquote>  <em>Note:</em> some games still implement the shooting of weapons.  However, for shooting exactly at the sight, additional calculations are required. </blockquote><br>  Create a link to <em>FpsCamera</em> and connect it to <em>GetWorldLocation</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e7/b87/425/5e7b8742558e21bd2ef0c37a7f2c44c2.jpg"></div><br>  Now we need an end point.  Do not forget that the weapon has a variable <em>MaxBulletDistance</em> .  This means that the end point must be at a distance of <em>MaxBulletDistance</em> units from the camera.  To implement this, create highlighted nodes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c03/c3f/3d4/c03c3f3d4fbb95738888a96f5b5a61c5.jpg"></div><br>  Then connect everything as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/483/ad1/544/483ad1544f1c790e33bba95e1615beff.jpg"></div><br>  Summarize: <br><br><ol><li>  When a player presses or holds the <em>left mouse button</em> , the weapon will fire a bullet with a starting point in the <em>camera.</em> </li><li>  The bullet will fly the distance specified in <em>MaxBulletDistance</em> </li></ol><br>  Click on <em>Compile</em> and then on <em>Play</em> .  Hold down the <em>left mouse button</em> to start shooting. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/824/8d1/f94/8248d1f948334196470e4fdc0bca21bd.gif"></div></div></div><br>  While the weapon shoots in each frame.  This is too fast, so in the next stage we will reduce the frequency of firing weapons. <br><br><h2>  Reduced shooting frequency </h2><br>  First, we need a variable to determine if a player can shoot.  Open <em>BP_Player</em> and create a <em>boolean</em> variable named <em>CanShoot</em> .  Set it to <em>true</em> by default.  If <em>CanShoot</em> is <em>true</em> , then the player can shoot, and vice versa. <br><br>  Replace the <em>Branch</em> section with the following: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/de3/ab2/974/de3ab2974872be4808cac417dc0ed34b.jpg"></div><br>  Now the player can shoot only if the <em>Shoot</em> key is pressed and the <em>CanShoot</em> variable is <em>true</em> . <br><br>  Now add the selected nodes: <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e80/d71/40c/e80d7140cfa2489e799072e4c4dc1ba7.jpg"></a> </div><br>  Changes: <br><br><ol><li>  A player can shoot only when holding down the <em>left mouse button</em> , and when <em>CanShoot</em> is <em>true</em> </li><li>  When a player fires a bullet, the variable <em>CanShoot is set</em> to <em>false</em> .  This will not allow the player to shoot again. </li><li>  <em>CanShoot</em> will be set to <em>true</em> again after the time specified in <em>FireRate</em> </li></ol><br>  Click on <em>Compile</em> and close the <em>BP_Player</em> .  Click <em>Play</em> and check the new shooting frequency. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a56/1d5/8cd/a561d58cdef8f9e4ce41764b1495226b.gif"></div></div></div><br>  Now we will teach the target and the button to respond to bullets.  This can be done by adding <em>damage to</em> them. <br><br><h2>  Damage application </h2><br>  Every actor in Unreal has the ability to take damage.  However, you can choose for yourself <i>how the</i> actor will react to it. <br><br>  For example, a fighting game character will lose health when taking damage.  However, some objects, such as a balloon, may not be healthy.  Then you can program the ball so that it explodes when receiving damage. <br><br>  In order to manage the damage the actor takes, we first need to apply the damage.  Open <em>BP_BaseGun</em> and add <em>Apply Damage</em> at the end of the <em>Shoot</em> function. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42b/994/920/42b994920cc251cc60fc4eb5976a043d.jpg"></div><br>  Now we need to specify which actor we want to do damage.  In our case, this is the actor into which the direct trace falls.  Connect the <em>Damaged Actor</em> with the <em>Hit Actor</em> node <em>Break Hit Result</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d47/5e0/317/d475e0317bc36d50a7e4f522325eed87.jpg"></div><br>  Finally, we need to specify the amount of damage done.  Get the link to <em>Damage</em> and connect it to <em>Base Damage</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3fa/fda/802/3fafda8022c71feb230c289a9898390e.jpg"></div><br>  Now, when you call <em>Shoot,</em> it will cause damage to actors who are traced in a straight line.  Click on <em>Compile</em> and close <em>BP_BaseGun</em> . <br><br>  Now we need to process how the actor takes damage. <br><br><h3>  Damage handling </h3><br>  First we will process how the damage gets to the target.  Open <em>BP_Target</em> and create an <em>Event AnyDamage</em> .  This event is executed when the actor takes <em>non-zero</em> damage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42b/73d/257/42b73d2576fc7e0852839ae5e95ce61e.jpg"></div><br>  Now call the <em>TakeDamage</em> function and connect the <em>Damage</em> pins.  This will subtract health from the target's <em>Health</em> variable and update the target color. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0f6/bdd/d90/0f6bddd90b1910c6e9c85dfe388a942d.jpg"></div><br>  Now that the target takes damage, it loses health.  Click on <em>Compile</em> and close <em>BP_Target</em> . <br><br>  Now we need to handle how the button takes damage.  Open the <em>BP_ResetButton</em> and create an <em>AnyDamage event</em> .  Then call the <em>ResetTargets</em> function. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38b/a00/e92/38ba00e9250fa4f67d0b703e1340cad3.jpg"></div><br>  This will restore all targets when taking damage with a button.  Click on <em>Compile</em> and close the <em>BP_ResetButton</em> . <br><br>  Click on <em>Play</em> and start shooting at targets.  If you want to restore the target, then shoot the button. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/88b/313/e87/88b313e87f8c2ef8fee5ce5a57407092.gif"></div></div><br><h2>  Where to go next? </h2><br>  The finished project can be downloaded <a href="">from here</a> . <br><br>  Although the FPS created in this tutorial is very simple, you can easily expand it.  Try to create more weapons with different types of shooting frequency and damage.  You can even try adding a recharge feature! </div><p>Source: <a href="https://habr.com/ru/post/347036/">https://habr.com/ru/post/347036/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347026/index.html">Introduction to modern network balancing and proxying</a></li>
<li><a href="../347028/index.html">Toaster statistics for 2017</a></li>
<li><a href="../347030/index.html">Four nuances of successful recruitment: what every startup should know</a></li>
<li><a href="../347032/index.html">Two-factor authentication is simple, using the example of JaCarta U2F</a></li>
<li><a href="../347034/index.html">New in Unity 2017.3. Compiling scripts into separate build files</a></li>
<li><a href="../347038/index.html">Technopark, Technosphere, Technotrek: Alumni Projects</a></li>
<li><a href="../347040/index.html">New items for designers and developers: fresh utilities, plugins and tools. Release 6th</a></li>
<li><a href="../347042/index.html">Kubeflow: a new project for working with machine learning in Kubernetes</a></li>
<li><a href="../347044/index.html">Step to quantum supremacy: Intel's 49-qubit quantum computer</a></li>
<li><a href="../347046/index.html">In the administration of Trump offered to nationalize 5G-network</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>