<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Node.js and JavaScript instead of the old web</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 This article is about an experimental general technology stack. It does not just duplicate my report at the OdessaSJS 2016 conference...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Node.js and JavaScript instead of the old web</h1><div class="post__text post__text-html js-mediator-article"><h2>  Introduction </h2><br><p>  This article is about an experimental general technology stack.  It does not just duplicate my report at the <a href="http://odessajs.org/">OdessaSJS 2016</a> conference, but contains everything that the report did not fit due to lack of time and the exceptional scale of the topic.  I even re-recorded the report in the voice of the text of the article and you can listen to it, not read it.  I already spoke on this topic at <a href="http://en.whu.edu.cn/">Wuhan University</a> (China), and at the <a href="http://fiot.kpi.ua/ru/%3Fp%3D2953">Kiev Polytechnic Institute I</a> conducted a series of seminars in 2015-2016.  The basic idea is that the problems of technology fragmentation can be solved by designing the entire technological stack, focusing on the data structures, syntax and protocol of the interaction of components.  Most issues of incompatibility will disappear by itself.  Even if this approach will be alternative and experimental, its task will be accomplished if it outlines the way and demonstrates the fundamental possibility of creating a simple and elegant general-purpose solution.  This idea is a natural continuation of the <a href="https://nodejs.org/en/">Node.js</a> approach when we reduce the number of languages ‚Äã‚Äãand technologies in the system by developing both the client and the server in JavaScript.  Despite the experimentation, the JSTP protocol is already used in commercial products, for example, for interactive television by SinceTV, where it allows you to connect tens of millions of users simultaneously.  This decision received a prize for innovation in the field of television at the international competition Golden Panda Awards 2015 in Chendu (China).  There are implementations in the field of server cluster management, solutions are being prepared for medicine, interactive games, e-commerce and services. </p><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/926UKzrVrqk%3Ffeature%3Doembed&amp;xid=25657,15700002,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjIHGtSc_qdhgkBvGrAk3BrlayHwg" frameborder="0" allowfullscreen=""></iframe><br><p>  <a href="http://www.slideshare.net/tshemsedinov/metarhia-nodejs-macht-frei">Slides</a> / <a href="https://soundcloud.com/timurshemsedinov/nodejs-macht-frei">Audio Version</a> </p><br><a name="habracut"></a><br><h2>  Performance </h2><br><p>  Good afternoon, my name is Timur Shemsedinov, I am the architect of SinceTV, the author of the Impress Application Server for Node.js, a researcher at the Institute of System Technologies and a teacher at the KPI.  Today's topic is not so much about the node, but rather about the development of the idea that formed the basis of the node. </p><br><p>  Anyone who has developed applications not only for the web can easily compare the complexity of the technological stack, the volume of problems encountered and, ultimately, the speed of development, with projects of similar complexity for mobile devices or window applications for desktops, supercomputers or embedded hardware, programming for servers and industrial automation, data processing or other industries programming applications. </p><br><p>  Every step on the web is a struggle, every minute is a pain, every line is a compromise or a patch.  There are many articles on the Internet that chaos has swept through the old web and good experts spend weeks on the simplest tasks, such as moving the button 3 pixels up or catching a wandering bug in the zoo of browsers.  For example, an article from the Medium <a href="https://medium.com/%40pistacchio/i-m-a-web-developer-and-i-ve-been-stuck-with-the-simplest-app-for-the-last-10-days-fb5c50917df">‚ÄúI'm a web developer and I've been stuck with the app for the last 10 days‚Äù</a> translated in Habr√© <a href="https://habrahabr.ru/post/277323/">‚ÄúI‚Äôm a web developer and for 10 days I can‚Äôt write a simple application</a> . <a href="https://habrahabr.ru/post/277323/">‚Äù</a> </p><br><p>  What is the problem?  How can we identify and recognize it?  Are there any other ways?  And can we move in an evolutionary rather than revolutionary way, solving problems in parts?  This will be discussed further, and in the whole series of reports and articles that I and our entire team are preparing, and to which I invite you to discuss. </p><br><p>  The old web has really plunged into a state in which all decisions are temporary, there is nothing stable and living without corrections for more than a year.  If you just leave the system unchanged, it will quickly become unusable.  This is due to the many dependencies that have been developed at different times and by different people who have never imagined that these software modules will be used together.  Everything in the old web was created by chance, without a single plan, and even the authors are not going to follow the standards.  This is a global fragmentation of technology, otherwise it could not be, but now we are already seeing design errors, examples of success and analogues in the outside web, and I want to offer a fairly simple solution.  This way will not break your whole life, but still radical enough to be perceived without shocks. </p><br><p>  Imagine that we give up HTTP, HTML, CSS, DOM, URL, XMLHttpRequest, AJAX, JSON, JSONP, XML, REST, Server-Sent Events, CORS, Cookie, MIME, WebSocket, localStorage, indexedDB, WebSQL, and everything else except for one thing, we‚Äôll leave JavaScript and make absolutely everything that is necessary for developing applications out of it.  At first glance, this may seem strange, but then I will show how we do it.  It will be a holistic technology stack on JavaScript alone and you will like it.  Of course, we will involve other technologies to create the application execution environment, but all these insides will be hidden from the application developer. </p><br><p>  So, <b>we will begin to design an</b> experimental technological stack by defining a wide range of its applications, which will determine the set of technologies and requirements for them.  We will consider the generally accepted ways of implementation and identify their critical shortcomings, after which we will think about possible replacement options. </p><br><p>  We want to develop application software for information systems in the following areas: business, economics, education, medicine, corporate information systems and organizational and management systems, electronic commerce, personal and group communication, social networks, gaming applications, television and other media . </p><br><p>  These systems should be: </p><br><ul><li>  distributed (including many client terminal devices and many servers), </li><li>  highly loaded (potentially scalable to work with billions of simultaneously connected user devices), </li><li>  interactive (supporting two-way interactivity close to real time), </li><li>  safe (both anonymous and providing a sufficient level of identification and trust for individual operations), </li><li>  flexibly changing (modifying screens, functions and data structures on the fly, without reinstalling and restarting). </li></ul><br><p>  With the help of what technologies we can develop such applications today, we will list: </p><br><ul><li>  windowed and locally installed applications (for Linux, MacOS, Windows) using AWT, SWING, WinForms, WPF, Qt, etc. </li><li>  mobile applications (iOS, Android, and others) </li><li>  web applications, including those adapted for mobile versions of browsers </li><li>  <a href="https://developers.google.com/web/progressive-web-apps/%3Fhl%3Den">Progressive Web App</a> (fullscreen applications running in a hidden browser) </li><li>  <a href="http://nwjs.io/">NW.js</a> and <a href="http://electron.atom.io/">Electron</a> </li></ul><br><p>  In other words, the same application has to be implemented several times on a different technological stack, for different operating systems and mobile platforms.  The same interface, the same functions need not only to be implemented several times, but also to make changes synchronously, keeping all client applications up to date.  For the web, on the contrary, one application, but it pulls a pocket browser with all its technology stack, protocols, renderer and problems. </p><br><p>  The web could be a cross-platform solution, but what kind of technology do we have in the old web: </p><br><p>  <b>Let's start with HTTP.</b>  I think it is no secret to anyone that he is blocking, i.e.  through one connection that the browser has established, only one request to the server can be sent at a time and the connection waits for the server to respond.  Because in HTTP there is no numbering of requests, just the usual, primitive, the simplest numbering is not, and an open connection is waiting.  After all, if you send a second request, then having received the answer, it will not be clear whether this is the answer to the first request or to the second.  Not to mention the transfer of the answer parts that would be mixed.  But when loading the application, you need to make a lot of requests and the browser establishes the second connection for the second request, then the third ... In most browsers this number is limited to 6 simultaneous connections, i.e.  it is impossible to make more parallel queries, neither for static loading, nor for AJAX.  Unless, of course, you build a crutch, create multiple subdomains, and scatter requests for subdomains, because the restriction on 6 connections from the browser is tied to the host.  But these tens and hundreds of connections use the network inefficiently. </p><br><p> In general, TCP assumes reliable delivery and long-term interaction, but HTTP breaks the connection very often, it simply does not know how to effectively re-use already established connections and constantly breaks them and creates new ones.  There is, of course, Keep Alive, but not only is it specified, it must be supported by the web server, browser, and developers must know about it, properly form the headers and process them.  Usually something is missing, then the administrator without a hand, the developers have not heard about this possibility, and browsers have features, as it turned out, and Keep Alive does not work very efficiently, because of the departure from the specification, the server often cannot agree with the browser and the connection does not go into keep alive mode.  I already gave a talk about it and wrote an article a year ago, ‚Äú <a href="https://habrahabr.ru/post/264851/">How to fix a mistake in Node.js and unintentionally raise productivity by 2 times.</a> ‚Äù The behavior of HTTP can be traced in the developer‚Äôs tools that are in the browser.  Optimization in HTTP is a separate task, out of the box it is not and it does not matter to everyone. </p><br><p>  Establishing a TCP connection is a difficult task; it takes longer than transferring information over an already open socket.  And in addition to TCP, when new connections are made, HTTP re-sends headers, including cookies.  And we know that HTTP headers do not cling to gzip, along with cookies in large projects there are tens and hundreds of kilobytes of headers.  Every time, and at carefree people also the statics all get out with sending a cookie in each request.  All the same does not matter. </p><br><p>  HTTP has a lot of problems, they were tried to be solved using Websocket, SSE, SPDY, HTTP / 2, QUIC, but they all depend on countless things inherited from the old web and none of these technologies achieved acceptable characteristics nor broad support.  You can condense the existing traffic, make multiplexing inside other transport, but the traffic structure will not change, it will be all the same HTML, AJAX, JSON, because the task was to repair the transport so that nothing broke and all the same applications continued to go through it .  But the goal has not been achieved, everything is difficult, it is not being introduced massively and the increase in speed is not very noticeable during implementation.  Radically and comprehensively no one tried to solve the problem. </p><br><p>  For games, instant messengers and other interactive applications, now there is only one live option - this is Websocket, but this layer cake from the protocols has reached the limit.  IP packet, based on TCP streaming with the establishment of long connections, on top of HTTP - it is again a packet with a permanent disconnect and on top of Websocket - and it is streaming, with long connections.  And all this can go via SSL.  And each layer adds its own headers and converts data, especially when moving from batch to streaming and from streaming to packet.  This is like a mockery, honestly. </p><br><p>  Therefore, games and instant messengers often do not have sufficient interactivity, they podglyuchivayut, there is no necessary responsiveness in delivery, a lot of overhead and delays, and the bandwidth required to achieve is not so easy.  Here are interactive applications and got stuck in development, especially due to the fact that there is no wide access to good means of transparent scaling of web sockets into tens of millions of simultaneous connections.  Everyone who needs to go beyond tens of thousands of compounds already does it for himself, there is no good recipe. </p><br><p>  It's time to admit that HTTP is full of problems and crutches, it was designed by semi-literate CERN physicists in IT who didn‚Äôt use their specialty in the past century to send articles with links and is not suitable for applications, especially for interactive applications with intensive data exchange. </p><br><p>  <b>HTML is of course an excellent language</b> for page layout, but least suitable for complex user-friendly graphical user interfaces.  The speed of the DOM and the lack of transactional change in interfaces lead to web applications sticking.  It‚Äôs hard to come up with something more redundant and slow to represent user interfaces in memory and dynamically modifying screens.  This is solved in Shadow DOM, React, Angular, Web components, but there are still more problems than solutions. </p><br><p>  <b>A little more about scaling</b> .  REST, which promised everyone a transparent solution, instead took the opportunity to work with the state, and did not make the promise.  We have a situation where no one uses REST, but oh well, few people understand what it is, but everyone says that they have a REST API.  Do URLs Identify Objects or Methods?  PUT, PATCH and DELETE are used?  Is the sequence of API calls unimportant?  Who through REST work payments, shopping cart, chat, reminders?  Mostly all AJAX APIs, which need to be called.  And the problem with scaling as it was, and is solved every time anew. </p><br><p>  <b>There are too many problems</b> in order to go further in detail, let us briefly summarize the main ones now: </p><br><ul><li>  Platforms for application software systems are fragmented </li><li>  Archaic web technologies no longer satisfy us. </li><li>  The frameworks and tools are totally unstable and incompatible. </li><li>  Old Web protocols have greater redundancy and kill the performance of your servers. </li><li>  Solid security issues and patches </li></ul><br><p>  As a result, our software quickly becomes outdated, we get constant problems with the integration of systems.  We are not able to use our achievements, the reuse of the code is extremely complicated, we are doomed to Sisyphean labor, constantly reworking the same thing. </p><br><p>  <b>What we need:</b> </p><br><ul><li>  Server Application Runtime </li><li>  Runtime applications for custom computers </li><li>  Mobile Application Runtime </li><li>  Inter-process communication on RPC and MQ principles with support for introspection, event streams and streaming binary data </li><li>  Database management system with global addressing space, distribution and sharding out of the box </li><li>  New naming and identification conventions for data and users </li></ul><br><p>  This is no longer a web of web pages, but a network of applications and databases. <br>  And now I will show that it is possible.  I don‚Äôt say that this is what needs to be done, but our team will demonstrate the fundamental possibility on the prototype. </p><br><p>  <b>Metarhia is a new technological stack</b> that: </p><br><ul><li>  experimental (only to demonstrate the new approach), </li><li>  alternative (should not care about compatibility), </li><li>  in open source (it can be freely distributed and used free of charge even in commercial projects, it is possible to participate in the development and send requests for revision to the community). </li></ul><br><p>  Now let's <b>get closer to JavaScript</b> , it also has an excellent syntax for describing data structures, including hashes, arrays, scalar values, functions, and expressions.  And we need a universal network protocol that would correspond to the data structures of the language and eliminate unnecessary data repacking.  We need an end-to-end protocol and the same serialization format, one for the whole technology stack, in the database, in the client‚Äôs memory, in the server‚Äôs memory and during the transfer between processes.  So why do we need JSON, XML, YAML and others, if such a format can be a subset of the JavaScript language.  At the same time, we do not invent any standard or formal grammar, we already have everything.  By and large, preparations for parsers are already implemented in all languages ‚Äã‚Äãand platforms.  Moreover, if we <b>take V8 and force it to be a parser of network packets</b> , we get statistical optimization, hidden classes and an order of magnitude faster parsing than JSON.  I will publish performance tests later in order not to overload this, and so voluminous, report. </p><br><p>  <b>Let the protocol become the central core</b> to which all the components of the system cling.  But the protocol is not enough, we need a launch environment, both client and server.  Developing the ideas of Node.js, we want not only the language, but also the startup environment to be almost identical on the server and on the client.  The same API, which allows you to access the functions of the platform, such as the network, file system, input / output devices.  Of course, this API should not be uncontrollably accessible to applications, but must have security restrictions.  The memory area and file system should be virtual, closed sandboxes, not having a message with the rest of the launch environment.  All libraries should not be loaded by the programs themselves, but implemented by the launch environment as DI through control inversion (IOC).  Application rights should be controlled, but management should not be escalated to the user, because he is not able to make an adequate decision on access rights.  The user is inclined to either prohibit everything, being guided by paranoia or allowing everything, being guided by carelessness. </p><br><p>  <b>We also need a DBMS</b> that will store data in the same JavaScript format.  We need a language for describing data models (or schemas).  We need a query language for data structures.  As the syntax of these two query languages, we can take the same JavaScript syntax.  And in the end, we need a language for describing two kinds of interfaces, network APIs and user interfaces GUI.  A subset of the same JavaScript is great for both of us. </p><br><p>  Now we can list the <b>components</b> of the <b>Metarhia</b> technology stack: </p><br><ul><li>  JSTP - JavaScript Transfer Protocol </li><li>  Impress Application Server - Application Server, Server Runtime </li><li>  GS - Global Storage - Globally Distributed Database Management System </li><li>  Console - application browser, thin client or application execution environment </li></ul><br><p>  <b>JavaScript Transfer Protocol</b> is not only a presentation format, but also a protocol that has special constructions, headers, packages, delimiters, in general, everything that provides an implementation of transparent for applications interaction over the network.  JSTP unites client and server parts so that they become one integral application.  You can share interfaces and make function calls in exactly the same way as if the functions were located locally.  With the only restriction that locally functions can be synchronous and asynchronous, and functions shared over a network are always asynchronous, i.e.  the data is not returned via return, but through a callback, which is taken as the last argument, as is customary in JavaScript.  JSTP also supports broadcasting events over the network, wrapped in a network analogue of EventEmitter.  JSTP has a lot of features, but for now I‚Äôll give you only its main features and advantages: </p><br><ul><li>  Built-in support for interactivity (support for event-based interaction), </li><li>  Simple and clear format known to all (no need to invent another serialization standard), </li><li>  Asynchronous calls (not blocking the principle of using one connection with multiplexing), </li><li>  Bidirectional interaction, as close as possible to real time, </li><li>  Reactive interaction principle (code in reactive style can be distributed), </li><li>  Optimizing parsing of network packets using the V8 hidden class mechanism </li><li>  Using metadata, models (data schemes), introspection and scaffolding. </li></ul><br><p>  Now more about the last paragraph.  Metadata will allow us not only to make the system more flexible, but also to optimize it further, besides the fact that we are already using V8 optimization for parsing JSTP.  In most serialization formats, the names of the fields are also transferred, in JSON they occupy, according to rough estimates, from 20% to 40% of the total data transferred, in XML this percentage is much higher than half.  Field names are needed only for imaginary human readability, although how often do people read XML or JSON?  For JSTP, there are two options for serialization, this is a full form and an abbreviated one, built on the basis of arrays with positional key storage.  In other words, we once transmit the schema, field names, their types, other auxiliary metadata from which we build a prototype on the client.  Then we get multiple instances of objects <b>serialized into arrays</b> , i.e.  field names are not transmitted, and the structure of the array positionally corresponds to the structure of the prototype, which has getters and setters.  We simply assign the prototype to the array, it remains an array, but we can work with this instance through the field names.  Example of conceptual code here: <a href="">metarhia / JSQL / Examples / filterArray.js</a> </p><br><p>  <b>Scaffolding and introspection are</b> used when building a transparent connection between a client and a server (and generally between any processes, two servers or two clients).  When connected, we take away metadata describing shared interfaces with methods and their parameters and build proxies on the opposite side that structurally repeat the remote API.  Such a proxy can be used locally, actually working with a remote interface.  Metaprogramming and dynamic interpretation of metamodels are used to work with the subject area, which I have already done a lot of articles and reports ( <a href="https://habrahabr.ru/post/227753/">in 2014</a> and even <a href="https://habrahabr.ru/post/137446/">in 2012</a> ), but I will definitely prepare materials on metaprogramming in the new technological stack. </p><br><p>  Now the basic ideas of the technological stack of Metarhia and JSTP, as its basic component, become clear: </p><br><ul><li>  Focus on data structures, not algorithms, </li><li>  Minimizing data transformation: one format for permanently storing data on disk or in a database, presenting data in memory on server and client, serialization and protocol for transmission over the network, for describing data schemas, for describing user interfaces, for a data query language , for integration and data exchange between applications and systems. </li></ul><br><p>  As Linus Torvalds says, "Bad programmers are worried about the code. Good programmers are worried about data structures."  And Eric Raymond expressed it more precisely: "Smart data structures and stupid code work much better than the other way around." </p><br><p>  Now for short JSTP examples: </p><br><ul><li>  Serialization of data structure: {name: 'Marcus Aurelius', birth: '1990-02-15'} </li><li>  Full object serialization: {name: 'Marcus Aurelius', birth: '1990-02-15', age: () =&gt; {...}} </li><li>  Metadata: {name: 'string', birth: 'Date'} </li><li>  Summary positional serialization: ['Marcus Aurelius', '1990-02-15'] </li><li>  Network packet: {call: [17, 'interface'], method: ['Marcus Aurelius', '1990-02-15']] </li></ul><br><p>  Compare the description of the same data in XML, CLEAR, JSON and JSTP: </p><br><div class="spoiler">  <b class="spoiler_title">XML example</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">oilPump</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PT004"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">displacement</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"constant"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"63"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">control</span></span></span><span class="hljs-tag">= </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"automatic"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"working"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flowMeter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">substance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fluid"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">recording</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"off"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">role</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"master"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">period</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"00:30"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dataOutput</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Parent.FT002.Verification"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">outlet</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pressure</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"180"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">working</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failureSensors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>Seatings<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span>none<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>Flap01<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span>open<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>Flap02<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span>closed<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>overload<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span>Joint<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">module</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span>detach<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indication</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span>OK<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">row</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failureSensors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">oilPump</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">CLEAR example</b> <div class="spoiler_text"><pre> <code class="hljs css">1: <span class="hljs-selector-tag"><span class="hljs-selector-tag">PT004</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:OilPump</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Displacement</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[constant]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Value</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[63]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Control</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[automatic]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Status</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[working]</span></span> 2: <span class="hljs-selector-id"><span class="hljs-selector-id">#FlowMeter</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Substance</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[fluid]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Recording</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[off]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Role</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[master]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Period</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[00:30]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">DataOutput</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[Parent.FT002.Verification]</span></span> 2: <span class="hljs-selector-id"><span class="hljs-selector-id">#Outlet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Pressure</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[180]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Status</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[working]</span></span> 2: <span class="hljs-selector-id"><span class="hljs-selector-id">#FailureSensors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Table</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Module,Indication,Status]</span></span> 3: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Seatings,none,OK]</span></span> 3: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Flap01,open,OK]</span></span> 3: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Flap02,closed,overload]</span></span> 3: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Joint,detach,OK]</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">JSON example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"PT004"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"OilPump"</span></span>, <span class="hljs-string"><span class="hljs-string">"displacement"</span></span>: <span class="hljs-string"><span class="hljs-string">"constant"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-string"><span class="hljs-string">"control"</span></span>: <span class="hljs-string"><span class="hljs-string">"automatic"</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-string"><span class="hljs-string">"working"</span></span>, <span class="hljs-string"><span class="hljs-string">"flowMeter"</span></span>: { <span class="hljs-string"><span class="hljs-string">"substance"</span></span>: <span class="hljs-string"><span class="hljs-string">"fluid"</span></span>, <span class="hljs-string"><span class="hljs-string">"recording"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-string"><span class="hljs-string">"role"</span></span>: <span class="hljs-string"><span class="hljs-string">"master"</span></span>, <span class="hljs-string"><span class="hljs-string">"period"</span></span>: <span class="hljs-string"><span class="hljs-string">"00:30"</span></span>, <span class="hljs-string"><span class="hljs-string">"dataOutput"</span></span>: <span class="hljs-string"><span class="hljs-string">"Parent.FT002.Verification"</span></span> }, <span class="hljs-string"><span class="hljs-string">"outlet"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pressure"</span></span>: <span class="hljs-number"><span class="hljs-number">180</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"working"</span></span>, <span class="hljs-string"><span class="hljs-string">"failureSensors"</span></span>: [ [<span class="hljs-string"><span class="hljs-string">"Module"</span></span>, <span class="hljs-string"><span class="hljs-string">"Indication"</span></span>, <span class="hljs-string"><span class="hljs-string">"Status"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Seatings"</span></span>, <span class="hljs-string"><span class="hljs-string">"none"</span></span>, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Flap01"</span></span>, <span class="hljs-string"><span class="hljs-string">"open"</span></span>, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Flap02"</span></span>, <span class="hljs-string"><span class="hljs-string">"closed"</span></span>, <span class="hljs-string"><span class="hljs-string">"overload"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Joint"</span></span>, <span class="hljs-string"><span class="hljs-string">"detach"</span></span>, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>] ] } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">JSTP Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"PT004"</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"OilPump"</span></span>, <span class="hljs-attr"><span class="hljs-attr">displacement</span></span>: <span class="hljs-string"><span class="hljs-string">"constant"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">63</span></span>, <span class="hljs-attr"><span class="hljs-attr">control</span></span>: <span class="hljs-string"><span class="hljs-string">"automatic"</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>:<span class="hljs-string"><span class="hljs-string">"working"</span></span>, <span class="hljs-attr"><span class="hljs-attr">flowMeter</span></span>: { <span class="hljs-attr"><span class="hljs-attr">substance</span></span>: <span class="hljs-string"><span class="hljs-string">"fluid"</span></span>, <span class="hljs-attr"><span class="hljs-attr">recording</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">role</span></span>: <span class="hljs-string"><span class="hljs-string">"master"</span></span>, <span class="hljs-attr"><span class="hljs-attr">period</span></span>: <span class="hljs-string"><span class="hljs-string">"00:30"</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataOutput</span></span>: <span class="hljs-string"><span class="hljs-string">"Parent.FT002.Verification"</span></span>, }, <span class="hljs-attr"><span class="hljs-attr">outlet</span></span>: { <span class="hljs-attr"><span class="hljs-attr">pressure</span></span>: <span class="hljs-number"><span class="hljs-number">180</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">"working"</span></span>, <span class="hljs-attr"><span class="hljs-attr">failureSensors</span></span>: [ [<span class="hljs-string"><span class="hljs-string">"Module"</span></span>, <span class="hljs-string"><span class="hljs-string">"Indication"</span></span>, <span class="hljs-string"><span class="hljs-string">"Status"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Seatings"</span></span>, <span class="hljs-string"><span class="hljs-string">"none"</span></span>, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Flap01"</span></span>, <span class="hljs-string"><span class="hljs-string">"open"</span></span>, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Flap02"</span></span>, <span class="hljs-string"><span class="hljs-string">"closed"</span></span>, <span class="hljs-string"><span class="hljs-string">"overload"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Joint"</span></span>, <span class="hljs-string"><span class="hljs-string">"detach"</span></span>, <span class="hljs-string"><span class="hljs-string">"OK"</span></span>] ] } }</code> </pre> </div></div><br><p>  Example JSTP minimized using a data scheme: </p><br><pre> <code class="javascript hljs">[<span class="hljs-string"><span class="hljs-string">"PT004"</span></span>,<span class="hljs-string"><span class="hljs-string">"OilPump"</span></span>,<span class="hljs-string"><span class="hljs-string">"constant"</span></span>,<span class="hljs-number"><span class="hljs-number">63</span></span>,<span class="hljs-string"><span class="hljs-string">"automatic"</span></span>,<span class="hljs-string"><span class="hljs-string">"working"</span></span>, [<span class="hljs-string"><span class="hljs-string">"fluid"</span></span>,<span class="hljs-string"><span class="hljs-string">"off"</span></span>,<span class="hljs-string"><span class="hljs-string">"master"</span></span>,<span class="hljs-string"><span class="hljs-string">"00:30"</span></span>,<span class="hljs-string"><span class="hljs-string">"Parent.FT002.Verification"</span></span>], [<span class="hljs-number"><span class="hljs-number">180</span></span>,<span class="hljs-string"><span class="hljs-string">"working"</span></span>,[[<span class="hljs-string"><span class="hljs-string">"Module"</span></span>,<span class="hljs-string"><span class="hljs-string">"Indication"</span></span>,<span class="hljs-string"><span class="hljs-string">"Status"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Seatings"</span></span>,<span class="hljs-string"><span class="hljs-string">"none"</span></span>,<span class="hljs-string"><span class="hljs-string">"OK"</span></span>],[<span class="hljs-string"><span class="hljs-string">"Flap01"</span></span>,<span class="hljs-string"><span class="hljs-string">"open"</span></span>,<span class="hljs-string"><span class="hljs-string">"OK"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Flap02"</span></span>,<span class="hljs-string"><span class="hljs-string">"closed"</span></span>,<span class="hljs-string"><span class="hljs-string">"overload"</span></span>], [<span class="hljs-string"><span class="hljs-string">"Joint"</span></span>,<span class="hljs-string"><span class="hljs-string">"detach"</span></span>,<span class="hljs-string"><span class="hljs-string">"OK"</span></span>]]]]</code> </pre> <br><p>  And now attention, the simplest <b>JSTP parser on Node.js</b> looks like this: </p><br><pre> <code class="javascript hljs">api.jstp.parse = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sandbox = api.vm.createContext({}); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> js = api.vm.createScript(<span class="hljs-string"><span class="hljs-string">'('</span></span> + s + <span class="hljs-string"><span class="hljs-string">')'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> js.runInNewContext(sandbox); };</code> </pre> <br><p>  there are only 5 lines, and its use is simple and obvious: </p><br><pre> <code class="javascript hljs">api.fs.readFile(<span class="hljs-string"><span class="hljs-string">'./person.record'</span></span>, (e, s) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> person = api.jstp.parse(s); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir(person); });</code> </pre> <br><p>  Now let's look at a more complex JSTP example, with functions and expressions: </p><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">name</span></span>: [<span class="hljs-string"><span class="hljs-string">'Marcus'</span></span>, <span class="hljs-string"><span class="hljs-string">'Aurelius'</span></span>].join(<span class="hljs-string"><span class="hljs-string">' '</span></span>), <span class="hljs-attr"><span class="hljs-attr">passport</span></span>: <span class="hljs-string"><span class="hljs-string">'AE'</span></span> + <span class="hljs-string"><span class="hljs-string">'127095'</span></span>, <span class="hljs-attr"><span class="hljs-attr">birth</span></span>: { <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-string"><span class="hljs-string">'1990-02-15'</span></span>), <span class="hljs-attr"><span class="hljs-attr">place</span></span>: <span class="hljs-string"><span class="hljs-string">'Rome'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> difference = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>() - birth.date; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(difference / <span class="hljs-number"><span class="hljs-number">31536000000</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: { <span class="hljs-attr"><span class="hljs-attr">country</span></span>: <span class="hljs-string"><span class="hljs-string">'Ukraine'</span></span>, <span class="hljs-attr"><span class="hljs-attr">city</span></span>: <span class="hljs-string"><span class="hljs-string">'Kiev'</span></span>, <span class="hljs-attr"><span class="hljs-attr">zip</span></span>: <span class="hljs-string"><span class="hljs-string">'03056'</span></span>, <span class="hljs-attr"><span class="hljs-attr">street</span></span>: <span class="hljs-string"><span class="hljs-string">'Pobedy'</span></span>, <span class="hljs-attr"><span class="hljs-attr">building</span></span>: <span class="hljs-string"><span class="hljs-string">'37'</span></span>, <span class="hljs-attr"><span class="hljs-attr">floor</span></span>: <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">room</span></span>: <span class="hljs-string"><span class="hljs-string">'158'</span></span> } }</code> </pre> <br><p>  As you can see, functions can refer to the fields of the object itself, but for this you need to slightly modify the parser: </p><br><pre> <code class="javascript hljs">api.jstp.parse = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sandbox = vm.createContext({}); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> js = vm.createScript(<span class="hljs-string"><span class="hljs-string">'('</span></span> + s + <span class="hljs-string"><span class="hljs-string">')'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> exported = js.runInNewContext(sandbox); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> exported) { sandbox[key] = exported[key]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exported; };</code> </pre> <br><p>  My development team and independent developers are currently preparing the <b>JSTP SDK</b> for more than a dozen languages, and for some there are already several alternative implementations.  Testing the functionality and performance of JSTP we will conduct in the near future.  On the specification page below there are collected links, but not all, the links will be updated: <a href="https://github.com/metarhia/JSTP">https://github.com/metarhia/JSTP</a> </p><br><p>  Now there are such implementations: </p><br><ul><li>  JavaScript for Browser </li><li>  JavaScript for Node.js and Impress Application Server </li><li>  C and C ++ for STL and Qt </li><li>  Swift and Objective-C for iOS </li><li>  Java for Android and JavaEE </li><li>  C # for .NET </li><li>  Python, Haskell, PHP, GoLang </li></ul><br><h2>  Links </h2><br><ul><li>  Metarhia <a href="https://github.com/metarhia">https://github.com/metarhia</a> </li><li>  JSTP <a href="https://github.com/metarhia/JSTP">https://github.com/metarhia/JSTP</a> </li><li>  Impress <a href="https://github.com/metarhia/Impress">https://github.com/metarhia/Impress</a> </li><li>  Global Storage <a href="https://github.com/metarhia/GlobalStorage">https://github.com/metarhia/GlobalStorage</a> </li><li>  Console <a href="https://github.com/metarhia/Console">https://github.com/metarhia/Console</a> </li></ul><br><h2>  Conclusion </h2><br><p>  And next time I will talk about other components of the technology stack.  Despite the seeming simplicity of solutions, there is still a lot to be done.  I promise to periodically publish the results and conduct tests on the loads and reliability, comparison with analogues in functionality and efficiency.  So far I can not recommend all this for mass implementation, but in the winter of 2016-2017 we will release the SDK with examples.  A few dozen people work on this in a specially created R &amp; D center at the Kiev Polytechnic Institute with the support of SinceTV.  If you follow the project, I hope that it will still be useful to you.  Even partial implementation has already yielded results.  Thank you for your attention. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/306584/">https://habr.com/ru/post/306584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306570/index.html">Low cost VDS hosting in Russia and its technical support</a></li>
<li><a href="../306572/index.html">iOS 10: Notification Content Extension</a></li>
<li><a href="../306574/index.html">Study: What will happen if you tell users how you target advertising?</a></li>
<li><a href="../306580/index.html">Docker Volume plugin for Nutanix on AOS 4.7</a></li>
<li><a href="../306582/index.html">Rust: & and ref in patterns</a></li>
<li><a href="../306586/index.html">Rating of countries in which it is more favorable to deploy a server farm</a></li>
<li><a href="../306588/index.html">Our development centers around the country with "teleports" to any city</a></li>
<li><a href="../306590/index.html">Fast TCP Sockets on Erlang</a></li>
<li><a href="../306592/index.html">How to sell: how the seller should work</a></li>
<li><a href="../306594/index.html">In search of mutual understanding: ‚Äúbad advice‚Äù for customers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>