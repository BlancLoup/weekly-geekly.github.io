<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Correct YML for Yandex.Market. Programmer's Look</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many online stores fall into Yandex.Market, not all stay there for long. One of the conditions of presence in the NM-e - the presence of the correct p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Correct YML for Yandex.Market. Programmer's Look</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/post/216985/"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/f7d/5ee/6db/f7d5ee6db5e67391274e645643161581.png"></a> <br clear="right">  Many online stores fall into Yandex.Market, not all stay there for long.  One of the conditions of presence in the NM-e - the presence of the correct price in a special format YML. <br><br>  Checking this price for errors and the elimination of those - the whole story.  Until it is formed by all the rules - the entrance to this realm of dumping is ordered.  And when you bring the document to the mind, you can experience a lot of unforgettable emotions. <br><br>  This article is an attempt to summarize the mistakes that programmers encounter for the first time creating tools (be it a stand-alone script or a plugin for CMS) for generating a YML file.  Those who dealt with this wonderful format before, the article will not be so interesting, because all the bumps are full.  However, all of a sudden and veterans of the struggle for their place under the sun of Yandex will learn something new for themselves.  And then they will share their own front-line experience. <br><a name="habracut"></a><br><h1>  Error classification </h1><br><ol><li><h2>  Irrelevant errors </h2><br><ul><li>  <strong>Wrong encoding.</strong>  The first thing that stumbled in the good old days.  Most engines work on UTF-8, while NM once required only the Windows favorite encoding.  Rumor has it that the capricious Yashu could have been fired up - to pretend that they agree to the godless cp1251 when approving a store, after ‚Äúcustoms give the go-ahead‚Äù - quietly replace the price with racially faithful Unicode.  What is interesting - CSV (as an unwanted alternative to YML) Yandex.Market accepts exclusively in UTF-8 :) </li></ul><br>  All other rakes are still there. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li><h2>  XML specification errors </h2><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/aa5/a31/b35/aa5a31b35a0a5bba9955e79249f35d6f.png"><br clear="left">  YML is a special case of XML.  So, must comply with its basic rules.  We do not forget about the obligatory presence of <strong>&lt;? Xml?&gt;</strong> And <strong>&lt;! DOCTYPE&gt;</strong> , we monitor the correct nesting of tags, we replace the "magnificent five" ( <strong>"</strong> , <strong>&amp;</strong> , <strong>&lt;</strong> , <strong>&gt;</strong> , <strong>'</strong> ) with their mnemonic equivalents. <br><br>  Moreover, in the mnemonics themselves, the <strong>&amp;</strong> symbol on its mnemonic <strong>&amp; amp;</strong>  no need to change, and then some kind of infinite recursion can happen.  Before applying the <em>htmlspecialchars</em> function to the text (for the &lt;description&gt; element, for example), it should be noted that mnemonics may already be present there;) <br><br></li><li><h2>  Critical YML Errors </h2><br>  Now your price is kosher XML, but Yandex flatly refuses to accept it.  We understand further. <br><br><ul><li>  <strong>Errors in the use of elements.</strong>  We reread 3 times (and even better - 5) attentively official documentation, do not forget about global tags (&lt;yml_catalog&gt;, &lt;shop&gt;), monitor the correct spelling of names, do not deal with gag in the form of inventing nonexistent tags in the specification, we arrange the entire hierarchy by yml-sko feng shui, we specify the parameters, etc. <br><br></li><li><img align="right" src="https://habrastorage.org/getpro/habr/post_images/343/6a0/e7e/3436a0e7e5e3e0c1daaa5361343109a4.png"><br clear="left">  <strong>Lack of required items.</strong>  The most frequent mistakes of beginners and not so beginners.  Especially often this pops up when forming an <em>offer</em> .  An optional tag for one kind of description may be required for another.  For example, &lt;vendor&gt;.  You can run into this if earlier a <em>simplified description</em> was applied to the product, and then suddenly decided to remake it on <em>vendor.model</em> . <br><br></li><li>  <strong>Not canonical element order.</strong>  Very mean mistake, downright blow in the gut for those who are facing it for the first time.  The situation where Yandex calmly insists that such a position in the line is something <em>wrong</em> , and there is nothing suspicious in the specified place and it is not visible at all (and, googling forums and meditating on documenting the effect does not) any white heat. <br>  A casket just opens - the elements should go exactly in the order in which they are listed in the specification.  Here in the <em>simplified description,</em> first the name of the product, and then the manufacturer.  And in <em>vendor.model</em> first manufacturer, and then the name of the product.  And by no means the opposite. <br><br></li><li>  <strong>Repeat products by ID.</strong>  What touches, this error is given out by Yandex in two different ways at once (so that no one is confused) - first, elements with incorrect identifiers are listed, and then the list of duplicate offers goes. <br>  With a fright one can decide that there are 2 times more mistakes than in reality.  And if everything is clear with duplicates, the uninitiated still have to guess what the incorrect identifiers are incorrect. <br><br></li></ul></li><li><h2>  Nonfatal YML Errors </h2><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/da5/ad3/7c6/da5ad37c6ff0b5d3318b8c054eedd002.png"><br clear="left">  Yandex is almost gratified.  Work a little more. <br><br><ul><li>  <strong>Invalid URLs.</strong>  Often these are links, for example, containing whitespace characters or Russian letters.  In general, many engines in the database tables usually have fields that store direct links to product pages.  What is characteristic, in almost all CMS among these links is a lot of garbage and therefore usually have to generate it yourself. <br><br></li><li>  <strong>The price is 0.</strong> Here, the programmer needs to consult with the content manager.  Or filter zero prices, but then the goods, where they forgot to specify the cost, will not be remembered soon.  Or do not filter and let the content manager in the future with the claims of Yandex himself understand. <br><br></li><li>  <strong>Invalid links to pictures.</strong>  Well, it's about the same story as the wrong URL.  Images registered in the database often do not exist in nature.  Before you make another &lt;picture&gt; - check the file.  If the picture is available, but there are unfortunate spaces in the title - encode links in <em>RFC3986</em> (the <em>rawurlencode</em> function will <em>help</em> you). <br><br></li></ul><br></li><li><h2>  Other errors </h2><br>  OK, all the flaws are totally eliminated and the yml-price fed to Yandex is not spat back.  Wait a moment to relax, in a couple of days a ‚Äúletter of happiness‚Äù may come from the NM managers, who are notified that: <br><br><ul><li>  Product line is glossy from another store.  Particularly serious crime punishable to the fullest extent of the law. </li><li>  In your price list, we persistently searched and found duplicates! </li><li>  And by the way, some links are not there. </li><li>  What idiot created this categorization? </li><li>  As a photo of products are used plugs. </li><li>  Same photos of different products.  Well, so what with the fact that on the official website of the manufacturer is the same? </li><li>  And some pictures are not from your site at all. </li><li>  In the murky waters of the elements &lt;description&gt; swims "fish." </li><li>  The store has a 100% prepayment, but why <em>not a</em> gug in the body of the <em>optional</em> &lt;sales_notes&gt; element? </li><li>  Ah, do you have only one ‚Äúunder the order‚Äù out of 500 products?  And why does he have aviable = 'true', and not 'false'? </li><li>  You have, dear, delivery for 3 days, and according to our concepts, the product is considered ‚Äúaffordable‚Äù if delivered within 2 days. </li><li>  ... and so on. </li></ul><br>  And therefore, your shop is still suspended from being present in the Yandex.Market trade universe for a week to forever. <br><br>  By and large, such errors are beyond the competence of coders.  They are responsible for other specially trained people - content managers, SEO-Schnick, marketers, or anyone else there have loaded to monitor the content of the site.  However, programmers can sometimes help here.  For example, filtering image stubs (by defining them by standard names) or not missing product descriptions, for some reason beginning with the words ‚Äú <em>Lorem ipsum</em> ‚Äù and ‚Äú <em>bla bla bla</em> ‚Äù. <br></li></ol><br><br><h1>  How and where to check for errors </h1><br>  It is easiest to catch all these numerous lapses in this order. <br><br><ul><li>  <strong>XML errors.</strong>  Note to the hostess - duplicate the yml-files with the xml extension, at least during the testing period (and then it can be useful).  In browsers and text editors, yml documents are opened as dull textuals, which makes them inconvenient for viewing and analysis.  In the wilds of XML, it‚Äôs much easier to navigate: there is always a fun highlighting of tags + elements that can be ‚Äúcollapsed‚Äù according to their hierarchical structure + the browser will helpfully tell where the specification mismatches.  In general, tracking YML errors is easier by opening it as XML. <br><br></li><li>  <strong>Check in Yandex Market.</strong>  Well, the last word - for Yandex.  After registering the store, check the file in their validator and eliminate the errors that are issued until the bitter end. <br><br></li></ul><br><h1>  Links </h1><br>  <strong>Yandex:</strong> <br><br>  <a href="http://help.yandex.ru/partnermarket/yml/">Official YML specification</a> <br>  <a href="http://partner.market.yandex.ru/legal/tt/">Requirements for data transfer method</a> <br>  <a href="">Validator</a> <br>  <a href="">Questions and answers</a> <br>  <a href="http://legal.yandex.ru/market_adv_rules/">Requirements for promotional materials</a> <br><br>  <strong>Habrahabr:</strong> <br><br>  <a href="http://habrahabr.ru/post/99755/">Yandex.Market - to be or not?</a> <br>  <a href="http://habrahabr.ru/post/159937/">Placement of goods on Yandex.Market.</a>  <a href="http://habrahabr.ru/post/159937/">Typical problems and their solutions</a> <br>  <a href="http://habrahabr.ru/post/110403/">Night grunts about Yandex, Market and interfaces in general</a> <br><br><h1>  Poll </h1></div><p>Source: <a href="https://habr.com/ru/post/216985/">https://habr.com/ru/post/216985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../216975/index.html">Telegram: 35 million active users, 8 billion messages per month</a></li>
<li><a href="../216977/index.html">Obama has prepared a bill on the termination of a complete record of conversations of citizens</a></li>
<li><a href="../216979/index.html">Watch the AppSummit conference online</a></li>
<li><a href="../216981/index.html">The creators of the site with pirated Android applications face 5 years in prison</a></li>
<li><a href="../216983/index.html">Static sites in the cloud storage</a></li>
<li><a href="../216991/index.html">Registration of sites: now for 1000 rubles</a></li>
<li><a href="../216993/index.html">Ethernet Network Processor: Architectural Innovations for SDN Implementation in Huawei S12700 Agile Switches</a></li>
<li><a href="../216997/index.html">Reflections on the standard JavaScript library. Core.js</a></li>
<li><a href="../216999/index.html">Sony Xperia Z1 Compact: tested in humans</a></li>
<li><a href="../217003/index.html">The human body is like a gadget</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>