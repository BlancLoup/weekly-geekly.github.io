<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Starting the React and TypeScript component library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most of my work, I write backends, but the other day there was a task to start a library of components on React. A few years ago, when the React versi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Starting the React and TypeScript component library</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/57/zc/nc57zcknvdousryimpgxxqsiz1i.jpeg"></div><br><p>  Most of my work, I write backends, but the other day there was a task to start a library of components on React.  A few years ago, when the React version was as small as my experience in front-end development, I already took an approach to the projectile and it turned out clumsily and clumsily.  Taking into account the maturity of the current React ecosystem and my growing experience, I was inspired this time to do everything well and conveniently.  As a result, I had a blank for the future library, and in order not to forget anything and collect everything in one place, this cheat sheet article was written, which should also help those who do not know where to start.  Let's see what I did. </p><a name="habracut"></a><br><p>  <strong><em>TL / DR: Code for a ready-to-start library can be viewed on <a href="https://github.com/jmorozov/react-library-example">github</a></em></strong> </p><br><p>  The problem can be approached from two sides: </p><br><ol><li>  Find a ready-made starter-kit, boilerplate or cli generator </li><li>  Collect everything yourself </li></ol><br><p>  The first method is good for a quick start when you absolutely do not want to deal with configuring and connecting the necessary packages.  Also, this option is suitable for beginners who do not know where to start and what should be the difference between the library and the regular application. </p><br><p>  At first I went the first way, but then I decided to update the dependencies and fasten a couple more packages, and then all kinds of errors and inconsistencies rained down.  As a result, he rolled up his sleeves and did everything himself.  But I will mention the library generator. </p><br><h2 id="create-react-library">  Create react library </h2><br><p>  Most developers who deal with React have heard about a convenient React application starter that allows you to minimize project configuration and provides reasonable defaults - <a href="https://github.com/facebook/create-react-app">Create React App</a> (CRA).  In principle, it could be used for the library ( <a href="https://habr.com/ru/post/326090/">there is an article on the Habr√©</a> ).  However, the project structure and approach to the development of the ui-kit is slightly different from the usual SPA.  We need a separate directory with component sources (src), a sandbox for their development and debugging (example), a documenting and demonstration tool ("showcase") and a separate directory with files prepared for export (dist).  Also, library components will not be added to the SPA application, but will be exported through an index file.  Thinking about it, I went searching and quickly discovered a similar CRA package - <a href="https://github.com/transitive-bullshit/create-react-library">Creat React Library</a> (CRL). </p><br><p>  CRL, like CRA, is an easy-to-use CLI utility.  Using it, you can generate a project.  It will contain: </p><br><ul><li>  configured <a href="https://rollupjs.org/guide/en/">Rollup</a> to build cjs and es modules and a source map with support for css modules </li><li>  <a href="https://babeljs.io/">babel</a> for transpilation in ES5 </li><li>  <a href="https://jestjs.io/">Jest</a> for tests </li><li>  TypeScript (TS) as an option we would like to use </li></ul><br><p>  To generate the library project, <a href="https://medium.com/devschacht/introducing-npx-an-npm-package-runner-a72a658cd9e6">we</a> can do it ( <a href="https://medium.com/devschacht/introducing-npx-an-npm-package-runner-a72a658cd9e6">npx</a> allows us not to install packages globally): </p><br><pre><code class="bash hljs">npx create-react-library</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">We answer the proposed questions.</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wd/ql/qq/wdqlqqfmjrgntiqz6zphcdyccdw.png" alt="CLR questions"></p></div></div><br><p>  And as a result of the utility, we get the generated and ready-to-work project of the component library. </p><br><div class="spoiler">  <b class="spoiler_title">With a certain structure</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vs/d4/l2/vsd4l2o2g1wn3n0folb_yr30ui8.png" alt="Clr tree"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">And then something went wrong ...</b> <div class="spoiler_text"><p>  Dependencies are a bit outdated today, so I decided to update them all to the latest versions using <a href="https://www.npmjs.com/package/npm-check">npm-check</a> : </p><br><pre> <code class="bash hljs">npx npm-check -u</code> </pre> <br><p>  Another sad fact is that the sandbox application in the <code>example</code> directory is generated in js.  You will have to manually rewrite it to TypeScript, adding <code>tsconfig.json</code> and some dependencies (for example, <code>typescript</code> itself and basic <code>@types</code> ). </p><br><p>  Also, the <code>react-scripts-ts</code> package is declared <code>deprecated</code> and is no longer supported.  Instead, you should install <code>react-scripts</code> , because for some time now CRA (whose package is <code>react-scripts</code> ) supports TypeScript from the box (using Babel 7). </p><br><p>  As a result, I did not master the pulling of the <code>react-scripts</code> to my idea of ‚Äã‚Äãthe library.  As far as I remember, the Jest from this package required the <code>isolatedModules</code> compiler option, which went against my desire to generate and export <code>d.ts</code> from the library (all this is somehow related to the limitations of Babel 7, which is used by Jest and <code>react-scripts</code> to compile TS )  So I made an <code>eject</code> for <code>react-scripts</code> , looked at the result and redid everything with my hands, which I will write about later. </p></div></div><br><h2 id="tsdx">  tsdx </h2><br><p>  Thanks to the user <a href="https://habr.com/ru/users/stanego/" class="user_link">StanEgo</a> , who spoke about an excellent alternative to Create React Library - <a href="https://github.com/palmerhq/tsdx">tsdx</a> .  This cli-utility is also similar to CRA and in one command will create the basis for your library with configured Rollup, TS, Prettier, husky, Jest and React.  And React comes as an option.  Simple enough to do: </p><br><pre> <code class="bash hljs">npx tsdx create mytslib</code> </pre> <br><p>  And as a result, the necessary fresh versions of the packages will be installed and all settings made.  Get a CRL-like project.  The main difference from CRL is Zero-config.  That is, the Rollup config is hidden from us in tsdx (just like CRA does). </p><br><p>  Having quickly run through the documentation, I did not find the recommended methods for a finer configuration or something like eject as in CRA.  Having looked at the issue of the project, I discovered that <a href="https://github.com/palmerhq/tsdx/issues/110">so far there is no such possibility</a> .  For some projects, this can be critical, in which case you will have to work a little with your hands.  If you don‚Äôt need it, then tsdx is a great way to get started quickly. </p><br><h2 id="beryom-upravlenie-v-svoi-ruki">  Take control into our own hands </h2><br><p>  But what if you go the second way and collect everything yourself?  So, let's start from the beginning.  Run <code>npm init</code> and generate <code>package.json</code> for the library.  Add some information about our package there.  For example, we will write the minimum versions for node and npm in the <code>engines</code> field.  The collected and exported files will be placed in the <code>dist</code> directory.  We indicate this in the <code>files</code> field.  We are creating a library of react components, so we rely on users to have the necessary packages - we <code>peerDependencies</code> in the <code>peerDependencies</code> field the minimum required versions of <code>react</code> and <code>react-dom</code> . </p><br><p>  Now install the <code>react</code> and <code>react-dom</code> packages and the necessary types (since we will be sawing components on TypeScript) as devDependencies (like all the packages in this article): </p><br><pre> <code class="bash hljs">npm install --save-dev react react-dom @types/react @types/react-dom</code> </pre> <br><p>  Install TypeScript: </p><br><pre> <code class="bash hljs">npm install --save-dev typescript</code> </pre> <br><p>  Let's create configuration files for the main code and tests: <code>tsconfig.json</code> and <code>tsconfig.test.json</code> .  Our <code>target</code> will be in <code>es5</code> , we will generate <code>sourceMap</code> , etc.  A complete list of possible options and their meanings can be found in the <a href="https://www.typescriptlang.org/docs/handbook/compiler-options.html">documentation</a> .  Do not forget to <code>include</code> source directory in the <code>include</code> , and add the <code>node_modules</code> and <code>dist</code> directories in the <code>exclude</code> .  In <code>package.json</code> specify in the <code>typings</code> field where to get the types for our library - <code>dist/index</code> . </p><br><p>  Create the <code>src</code> directory for the source components of the library.  Add all sorts of little things, like <code>.gitignore</code> , <code>.editorconfig</code> , a file with a license and <code>README.md</code> . </p><br><h3 id="rollup">  Rollup </h3><br><p>  We will use Rollup for assembly, as suggested by CRL.  The necessary packages and config, I also spied on the CRL.  In general, I heard the opinion that Rollup is good for libraries, and Webpack for applications.  However, I did not configure Webpack (what CRA does for me), but Rollup is really good, simple and beautiful. </p><br><p>  Install: </p><br><pre> <code class="bash hljs">npm install --save-dev rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve rollup-plugin-peer-deps-external rollup-plugin-postcss rollup-plugin-typescript2 rollup-plugin-url @svgr/rollup</code> </pre> <br><p>  In <code>package.json</code> add the fields with the distribution of the collected library bundles, as <code>rollup</code> recommends to us - <a href="https://github.com/rollup/rollup/wiki/pkg.module">pkg.module</a> : </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"jsnext:main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Create the configuration file rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typescript <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-typescript2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> commonjs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-commonjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> external <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-peer-deps-external'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> postcss <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-postcss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-node-resolve'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-url'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> svgr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@svgr/rollup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pkg <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./package.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.tsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.main, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.module, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ external(), postcss({ <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), url(), svgr(), resolve(), typescript({ <span class="hljs-attr"><span class="hljs-attr">rollupCommonJSResolveHack</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clean</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), commonjs() ] };</code> </pre> </div></div><br><p>  The config is a js file, or rather an exported object.  In the <code>input</code> field, specify the file in which the exports for our library are registered.  <code>output</code> - describes our expectations on the output - in what format module to compile and where to put it. </p><br><div class="spoiler">  <b class="spoiler_title">Next comes the field with a list and configuration of plugins</b> <div class="spoiler_text"><ul><li>  <a href="https://www.npmjs.com/package/rollup-plugin-peer-deps-external">rollup-plugin-peer-deps-external</a> - allows you to exclude <code>peerDependencies</code> from the <code>bundle</code> to reduce its size.  This is reasonable, because <code>peerDependencies</code> is expected from the library user. </li><li>  <a href="https://github.com/egoist/rollup-plugin-postcss">rollup-plugin-postcss</a> - integrates <a href="https://github.com/postcss/postcss">PostCss</a> and Rollup.  Here we disable css-modules, include css in the export package from our library, minimize it and enable the creation of sourceMap.  If you do not export any css other than that used by the library components, then <code>extract</code> can be avoided - the necessary css in the components will be added to the head tag on the page as necessary in the end.  However, in my case, it is necessary to distribute some additional css (grid, colors, etc.), and the client will have to explicitly connect the css-bundle library to itself. </li><li>  <a href="https://github.com/rollup/rollup-plugin-url">rollup-plugin-url</a> - allows you to export various resources, such as pictures </li><li>  <a href="https://github.com/smooth-code/svgr">svgr</a> - transforms svg into React components </li><li>  <a href="https://github.com/rollup/rollup-plugin-node-resolve">rollup-plugin-node-resolve</a> - defines the location of third-party modules in node_modules </li><li>  <a href="https://www.npmjs.com/package/rollup-plugin-typescript2">rollup-plugin-typescript2</a> - connects the TypeScript compiler and provides the ability to configure it </li><li>  <a href="https://github.com/rollup/rollup-plugin-commonjs">rollup-plugin-commonjs</a> - converts commonjs dependency modules to es modules so that they can be included in bundle </li></ul></div></div><br><p>  Add a command in the <code>scripts</code> <code>package.json</code> field to build ( <code>"build": "rollup -c"</code> ) and start the assembly in watch-mode during development ( <code>"start": "rollup -c -w &amp;&amp; npm run prettier-watch"</code> ) . </p><br><h3 id="pervyy-komponent-i-eksportnyy-fayl">  The first component and export file </h3><br><p>  Now let's write the simplest react component to check how our assembly works.  Each component in the library will be placed in a separate directory in the parent directory - <code>src/components/ExampleComponent</code> .  This directory will contain all the files associated with the component - <code>tsx</code> , <code>css</code> , <code>test.tsx</code> and so on. <br>  Let's create some styles file for the component and <code>tsx</code> file of the component itself. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class ExampleComponent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Props { <span class="hljs-comment"><span class="hljs-comment">/** * Simple text prop **/</span></span> text: string; } <span class="hljs-comment"><span class="hljs-comment">/** My First component */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Props</span></span></span><span class="hljs-class">&gt; </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { text } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Example Component: {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Coool!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ExampleComponent;</code> </pre> </div></div><br><p>  Also, in <code>src</code> you need to create a file with types that are common to libraries, where a type will be declared for css and svg (peeped at CRL). </p><br><div class="spoiler">  <b class="spoiler_title">typings.d.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default CSS definition for typescript, * will be overridden with file-specific definitions by rollup */</span></span> declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.css'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content: { [className: string]: string }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> content; } interface SvgrComponent extends React.FunctionComponent&lt;React.SVGAttributes&lt;SVGElement&gt;&gt; {} declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgUrl: string; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgComponent: SvgrComponent; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> svgUrl; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { svgComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactComponent }; }</code> </pre> </div></div><br><p>  All exported components and css must be specified in the export file.  We have it - <code>src/index.tsx</code> .  If some css is not used in the project and is not specified as part of those imported into <code>src/index.tsx</code> , then it will be thrown out of the assembly, which is fine. </p><br><div class="spoiler">  <b class="spoiler_title">src / index.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent, Props } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./export.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ExampleComponent, Props };</code> </pre> </div></div><br><p>  Now you can try to build the library - <code>npm run build</code> .  As a result, <code>rollup</code> starts and collects our library into bundles, which we will find in the <code>dist</code> directory. </p><br><p>  Next, we add some tools to improve the quality of our development process and its result. </p><br><h3 id="zabyvaem-o-formatirovanii-koda-s-prettier">  Forgetting code formatting with Prettier </h3><br><p>  I hate in a code-review to point out formatting that is careless or non-standard for a project, and even more so argue about it.  Such flaws should naturally be fixed, but developers should focus on what and how the code does, rather than how it looks.  These fixes are the first candidate for automation.  There is a wonderful package for this task - <a href="https://prettier.io/">prettier</a> .  Install it: </p><br><pre> <code class="bash hljs">npm install --save-dev prettier</code> </pre> <br><p>  Add a config for a little refinement of formatting rules. </p><br><div class="spoiler">  <b class="spoiler_title">.prettierrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxBracketSameLine"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"printWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bracketSpacing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> </div></div><br><p>  You can see the meaning of the available rules in the <a href="https://prettier.io/docs/en/options.html">documentation</a> .  WebStrom after creating the configuration file itself will suggest using <code>prettier</code> when starting formatting through the IDE.  To prevent formatting from wasting time, add the <code>/node_modules</code> and <code>/dist</code> directory to the exceptions using the <code>.prettierignore</code> file (the format is similar to <code>.gitignore</code> ).  Now you can run <code>prettier</code> by applying formatting rules to the source code: </p><br><pre> <code class="bash hljs">prettier --write <span class="hljs-string"><span class="hljs-string">"**/*"</span></span></code> </pre> <br><p>  In order not to run the command explicitly each time with your hands and to be sure that the code of the other project developers will also be <code>prettier</code> formatted, we add the <code>prettier</code> run on the <code>precommit-hook</code> for files marked as <code>staged</code> (via <code>git add</code> ).  For this, we need two tools.  Firstly, it is <a href="https://github.com/typicode/husky">hasky</a> , responsible for executing any commands before committing, pushing, etc.  And secondly, it is <a href="https://github.com/okonet/lint-staged">lint-staged</a> , which can run different linters on <code>staged</code> files.  We need to execute only one line to deliver these packages and add launch commands to <code>package.json</code> : </p><br><pre> <code class="bash hljs">npx mrm lint-staged</code> </pre> <br><p>  We can not wait for formatting before committing, but make sure that <code>prettier</code> constantly works on modified files in the process of our work.  Yes, we need another package - <a href="https://github.com/Qard/onchange">onchange</a> .  It allows you to monitor file changes in the project and immediately execute the necessary command for them.  Install: </p><br><pre> <code class="bash hljs">npm install --save-dev --save-exact onchange</code> </pre> <br><p>  Then we add to the <code>scripts</code> field commands in <code>package.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"prettier-watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange 'src/**/*' -- prettier --write {{changed}}"</span></span></code> </pre> <br><p>  On this, all disputes about formatting in the project can be considered closed. </p><br><h3 id="izbegaem-oshibok-s-eslint">  Avoiding Errors with ESLint </h3><br><p>  <a href="https://eslint.org/">ESLint</a> has long become the standard and can be found in almost all js and ts projects.  He will help us too.  In ESLint configuration, I trust CRA, so just take the necessary packages from CRA and plug it into our library.  In addition, add configs for TS and <code>prettier</code> (to avoid conflicts between <code>ESLint</code> and <code>prettier</code> ): </p><br><pre> <code class="bash hljs">npm install --save-dev eslint eslint-config-react-app eslint-loader eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks @typescript-eslint/eslint-plugin @typescript-eslint/parser babel-eslint eslint-config-prettier eslint-plugin-prettier</code> </pre> <br><p>  <code>ESLint</code> using the configuration file. </p><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-app"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier/@typescript-eslint"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/no-empty-interface"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-function-return-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-member-accessibility"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span> } }</code> </pre> </div></div><br><p>  Add the command <code>lint</code> - <code>eslint src/**/* --ext .ts,.tsx --fix</code> to the <code>scripts</code> field from <code>package.json</code> .  Now you can run eslint through <code>npm run lint</code> . </p><br><h3 id="testiruem-s-jest">  Testing with Jest </h3><br><p>  To write unit tests for library components, install and configure <a href="https://jestjs.io/">Jest</a> , a testing library from facebook.  However, since  we compile TS not through babel 7, but through tsc, then we need to install the <a href="https://kulshekhar.github.io/ts-jest/">ts-jest</a> package too: </p><br><pre> <code class="bash hljs">npm install --save-dev jest ts-jest @types/jest</code> </pre> <br><p>  In order for jest to properly accept imports of css or other files, you need to replace them with mokami.  Create the <code>__mocks__</code> directory and create two files there. <br>  <code>styleMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {};</code> </pre> <br><p>  <code>fileMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'test-file-stub'</span></span>;</code> </pre> <br><p>  Now create the jest config. </p><br><div class="spoiler">  <b class="spoiler_title">jest.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">preset</span></span>: <span class="hljs-string"><span class="hljs-string">'ts-jest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">testEnvironment</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleNameMapper</span></span>: { <span class="hljs-string"><span class="hljs-string">'\\.(css|less|sass|scss)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/styleMock.ts'</span></span>, <span class="hljs-string"><span class="hljs-string">'\\.(gif|ttf|eot|svg)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/fileMock.ts'</span></span> } };</code> </pre> </div></div><br><p>  We will write the simplest test for our <code>ExampleComponent</code> in its directory. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.test.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'is truthy'</span></span>, () =&gt; { expect(ExampleComponent).toBeTruthy(); }); });</code> </pre> </div></div><br><p>  Add the <code>test</code> - <code>npm run lint &amp;&amp; jest</code> command to the <code>scripts</code> field of <code>package.json</code> .  For reliability, we will also drive the linter.  Now you can run our tests and make sure they pass - <code>npm run test</code> .  And so that the tests do not fall into <code>dist</code> during assembly, add the <code>exclude</code> field in the <code>Rollup</code> config plugin to the <code>exclude</code> field - <code>['src/**/*.test.(tsx|ts)']</code> .  Specify running tests in <code>husky pre-commit hook</code> before running <code>lint-staged</code> - <code>"pre-commit": "npm run test &amp;&amp; lint-staged"</code> . </p><br><h3 id="razrabatyvaem-dokumentiruem-i-lyubuemsya-komponentami-s-storybook">  Designing, documenting, and admiring components with a Storybook </h3><br><p>  Each library needs good documentation for its successful and productive use.  As for the library of interface components, not only I want to read about them, but also to see how they look, and it‚Äôs best to touch and change them.  To support such a Wishlist, there are several solutions.  I used to use a <a href="https://github.com/styleguidist/react-styleguidist">Styleguidist</a> .  This package allows you to write documentation in markdown format, as well as insert examples of the described React components into it.  Further, the documentation is collected and from it a site-showcase-catalog is obtained, where you can find the component, read the documentation about it, find out about its parameters, and also poke a wand into it. </p><br><p>  However, this time I decided to take a closer look at his competitor - <a href="https://storybook.js.org/">Storybook</a> .  Today it seems more powerful with its plugin system.  In addition, it is constantly evolving, has a large community, and <a href="https://medium.com/storybookjs/storybook-docs-sneak-peak-5be78445094a">will soon</a> also begin to generate its documentation pages using markdown files.  Another advantage of the Storybook is that it is a sandbox - an environment for isolated component development.  This means that we do not need any full-fledged sample applications for component development (as CRL suggests).  In the storybook we write <code>stories</code> - ts-files in which we transfer our components with some input <code>props</code> to special functions (it is better to look at the code to make it clearer).  As a result, a showcase application is built from these <code>stories</code> . </p><br><p>  Run the script that initializes the storybook: </p><br><pre> <code class="bash hljs">npx -p @storybook/cli sb init</code> </pre> <br><p>  Now make friends with TS.  To do this, we need a few more packages, and at the same time we will put a couple of useful add-ons: </p><br><pre> <code class="bash hljs">npm install --save-dev awesome-typescript-loader @types/storybook__react @storybook/addon-info react-docgen-typescript-loader @storybook/addon-actions @storybook/addon-knobs @types/storybook__addon-info @types/storybook__addon-knobs webpack-blocks</code> </pre> <br><p>  The script created a directory with the <code>storybook</code> configuration - <code>.storybook</code> and an example directory that we mercilessly delete.  And in the configuration directory we change the extension <code>addons</code> and <code>config</code> to <code>ts</code> .  We add addons to the <code>addons.ts</code> file: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-actions/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-links/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/register'</span></span>;</code> </pre> <br><p>  Now, you need to help the storybook using the webpack config in the <code>.storybook</code> directory. </p><br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ config }</span></span></span><span class="hljs-function">) =&gt;</span></span> { config.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(ts|tsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'awesome-typescript-loader'</span></span>) }, <span class="hljs-comment"><span class="hljs-comment">// Optional { loader: require.resolve('react-docgen-typescript-loader') } ] }); config.resolve.extensions.push('.ts', '.tsx'); return config; };</span></span></code> </pre> </div></div><br><p>  We‚Äôll tweak the <code>config.ts</code> config a bit, adding decorators to connect add-ons to all our stories. </p><br><div class="spoiler">  <b class="spoiler_title">config.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addDecorator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withInfo } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-info'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withKnobs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// automatically import all files ending in *.stories.tsx const req = require.context('../src', true, /\.stories\.tsx$/); function loadStories() { req.keys().forEach(req); } configure(loadStories, module); addDecorator(withInfo); addDecorator(withKnobs);</span></span></code> </pre> </div></div><br><p>  We will write our first <code>story</code> in the component directory <code>ExampleComponent</code> </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.stories.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { storiesOf } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stories = storiesOf(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); stories.add(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; &lt;ExampleComponent text={text('text', 'Some text')} /&gt;, { info: { inline: true }, text: ` ### Notes Simple example component ### Usage ~~~js &lt;ExampleComponent text="Some text" /&gt; ~~~ ` });</code> </pre> <br><p>  We used addons: </p><br><ul><li>  <a href="https://www.npmjs.com/package/%40storybook/addon-knobs">knobs</a> - allows you to change props in the component displayed in the Storybook in real-time mode.  To do this, wrap props in special functions in stories </li><li>  <a href="https://www.npmjs.com/package/%40storybook/addon-info">info</a> - allows you to add documentation and description of props to the story page </li></ul></div></div><br><p>  Now note that the storybook initialization script added the storybook command to our <code>package.json</code> .  Use it to run the <code>npm run storybook</code> .  The Storybook will assemble and start at <code>http://localhost:6006</code> .  Do not forget to add to the exception for the <code>typescript</code> module in the <code>Rollup</code> config - <code>'src/**/*.stories.tsx'</code> . </p><br><h3 id="razrabatyvaem">  We are developing </h3><br><p>  So, having surrounded yourself with many convenient tools and preparing them for work, you can begin to develop new components.  Each component will be placed in its directory in <code>src/components</code> with the name of the component.  It will contain all the files associated with it - css, the component itself in the tsx file, tests, stories.  We start the storybook, create stories for the component, and write documentation for it there.  We create tests and test.  Import-export of the finished component is written in <code>index.ts</code> . </p><br><p>  In addition, you can log in to <code>npm</code> and publish your library as a new npm package.  And you can connect it directly from the git repository from both master and other branches.  For example, for my workpiece, you can do: </p><br><pre> <code class="bash hljs">npm i -s git+https://github.com/jmorozov/react-library-example.git</code> </pre> <br><p>  So that in the library consumer application in the <code>node_modules</code> directory there is only the contents of the <code>dist</code> directory in the assembled state, you need to add the <code>"prepare": "npm run build"</code> command to the <code>scripts</code> field <code>"prepare": "npm run build"</code> . </p><br><p>  Also, thanks to TS, auto-completion in the IDE will work. </p><br><h2 id="podvodim-itogi">  To summarize </h2><br><p>  In mid-2019, you can pretty quickly start developing your library of components on React and TypeScript, using convenient development tools.  This result can be achieved both with the help of an automated utility, and in manual mode.  The second way is preferred if you need current packages and more control.  The main thing is to know where to dig, and with the help of an example in this article, I hope this has become somewhat easier. </p><br><p>  You can also take the resulting workpiece <a href="https://github.com/jmorozov/react-library-example">here</a> . </p><br><p>  Among other things, I do not pretend to be the ultimate truth and, in general, am engaged in front-end insofar as.  You can choose alternative packages and configuration options and also succeed in creating your component library.  I would be glad if you share your recipes in the comments.  Happy coding! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/461439/">https://habr.com/ru/post/461439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../46143/index.html">Python 3.0 released</a></li>
<li><a href="../461431/index.html">‚ÄúLoves and dislikes‚Äù: DNS over HTTPS</a></li>
<li><a href="../461433/index.html">Using Identity Server 4 in Net Core 3.0</a></li>
<li><a href="../461435/index.html">Emotion recognition using a convolutional neural network</a></li>
<li><a href="../461437/index.html">370 light bulbs</a></li>
<li><a href="../46144/index.html">We work in DVD Studio Pro. Part I.</a></li>
<li><a href="../461441/index.html">Reports on the state of storage using R. Parallel computing, graphs, xlsx, email and all this</a></li>
<li><a href="../461443/index.html">Post-analysis: what is known about the latest attack on the SKS Keyserver crypto key server network</a></li>
<li><a href="../461447/index.html">The epic about system administrators as an endangered species</a></li>
<li><a href="../461449/index.html">PhpStorm 2019.2: PHP 7.4 Typed Properties, Duplicate Finder, EditorConfig, Shell Scripts, and More</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>