<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Method of measuring the effective value of voltage using MK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this post we will discuss one of the options for measuring the effective value of voltage and frequency of the network on an 8-bit PIC18 microcontr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Method of measuring the effective value of voltage using MK</h1><div class="post__text post__text-html js-mediator-article"> In this post we will discuss one of the options for measuring the effective value of voltage and frequency of the network on an 8-bit PIC18 microcontroller.  If desired, the method can be transferred to any other MK, up to all your favorite ARDUINO (if they support the implementation of timer interrupts with a frequency of 5-10 kHz). <br>  Also, the considered method allows to measure the frequency of the mains voltage without the use of external additional means, such as comparators.  But, at the same time, one has to sacrifice either the time resources of the MC or the accuracy of the frequency measurement. <br><a name="habracut"></a>  Why is it important to measure the actual value, and not any other, for example, mean straight?  Most of the ‚ÄúChinese‚Äù electronic voltmeters measure the mains voltage according to the rectified average value.  The measurement technique is as follows: for the period of the mains voltage, a sample of N amplitude values ‚Äã‚Äãof the voltage is made, the results are added (without a sign), divided by N (averaged), after which the result is multiplied by a factor <br><img src="https://habrastorage.org/storage3/59d/9b0/63c/59d9b063c299b5398e2b5cae80f5f470.jpg"><br>  The indicated coefficient determines the dependence of the effective value of the sinusoidal (!) Signal on the average rectified one. <br>  This method of measurement is simple, does not require a lot of microcontroller resources (both temporary and memory resources).  The main disadvantage of this measurement technique is a large measurement error on non-sinusoidal signals. <br>  As everyone knows, the change in the mains voltage signal is subject to a sinusoidal law (due to the use of synchronous generators at a power plant), with a frequency of signal change of 50 Hz (60 Hz).  However, in practice, due to the influence of third-party factors (mainly connecting to the network of powerful non-linear loads), as well as the use of inverters with quasi-sinusoidal output voltage (see figure), the sinusoid voltage is either significantly distorted or replaced by rectangular pulses.  In such cases, the above measurement method will give a very large error (for example, in quasi-sinusoidal inverters, the output voltage measured by a ‚ÄúChinese‚Äù voltmeter may be 180‚Äì200V, while the actual voltage will be 220V). <br><img src="https://habrastorage.org/storage3/772/895/998/77289599897f8e2331a19e455d16b02e.png"><br><br>  For example, stress at my home <br><img src="https://habrastorage.org/storage3/e52/a10/7ad/e52a107aded893dd38add43d568ad437.png"><br>  Why is it important to measure the actual value of the voltage (current)?  Because it is the effective (also called effective) values ‚Äã‚Äãof voltage and current that determine the operation of the electrical system (roughly speaking, the electric heater generates heat in direct proportion to the effective values ‚Äã‚Äãof voltage and network current). <br>  The effective value of the measured periodic value is calculated by the formula <br><img src="https://habrastorage.org/storage3/0d4/483/1b0/0d44831b05a61ff14f727899023d3900.jpg"><br>  Or after sampling we get <br><img src="https://habrastorage.org/storage3/ee3/dd6/536/ee3dd653613eafcc6dbbfe7c2103224f.jpg"><br>  Those.  we need to sample a series of values ‚Äã‚Äãfor the period of the mains voltage, sum up the values ‚Äã‚Äãof the squares of the sampling points, divide by the number of points per period (when determining the number of sampling points, do not forget about the Kotelnikov-Shannon theorem), and take the square root of the result. <br>  It seems to be nothing complicated, if not for but: <br>  1) Each period, the sample points are recruited again, which increases the measurement error; <br>  2) In a real network, near zero voltage, both ‚Äúzero shelves‚Äù and repeated zero-voltage transitions can occur, which will significantly introduce an error in the measurement. <br>  We will struggle with the first item by measuring the sum of the squares of the sample points for each half-period, after which we will sum the n-th sum of squares with (n + 1) -th and throw away the (n-1) -th. <br>  We will struggle with the second item by introducing voltage-insensitive zones (we will enter the limits of the zero-crossing voltage from the positive and negative sides), usually 5-10 V in both directions, as well as dead-frequency zones in frequency (we will limit the allowed frequency of the voltage signal). <br><br>  Thus, we obtain the calculated value of the effective value of the mains voltage for the period at each half period of the mains voltage. <br><img src="https://habrastorage.org/storage3/51d/949/9d2/51d9499d2ee0312233cd65c70bace71b.jpg"><br>  The voltage frequency is calculated by the formula: <br><img src="https://habrastorage.org/storage3/8f8/e49/2a7/8f8e492a7683b049bdaacd8607e61f15.jpg"><br>  where Fd is the sampling frequency (for convenience and to increase the accuracy of frequency measurement, it is chosen equal to 10 kHz (sampling period is 100 Œºs)). <br>  Now we will consider the block diagram of the measuring part (in the real scheme we should add filtering and protective elements). <br><img src="https://habrastorage.org/storage3/156/bdf/ac2/156bdfac28ba637656e679d161a71aad.png"><br>  <b>Attention!</b>  In this method of measurement, the galvanic isolation of the microcontroller from the network is not implemented.  The galvanic connection is implemented on the side of the digital data interface from the microcontroller. <br>  A differential operational amplifier with a voltage divider supported by half of the reference voltage (2.048 V) is installed at the input.  Since, to reduce the size it is better to use low-power resistors, we install them at least 3 pieces.  equal in resistance - to increase the total breakdown voltage of resistors.  In this case, it is necessary to calculate the power loss at the maximum input voltage (P = U ^ 2 / R) - so that it does not exceed the permissible power of the resistors.  The shoulders of the differential amplifier are also equal.  Then, the voltage at point 1 is calculated by the formula: <br><img src="https://habrastorage.org/storage3/da8/7f5/78e/da87f578ecdd25b3b3655f9270c9bd2b.jpg"><br>  And the voltage at point 1 will be: <br><img src="https://habrastorage.org/storage3/eb2/421/7f0/eb24217f0ec111a48e2e8d0f3e9b5850.jpg"><br>  Also, half of the reference voltage is applied to one of the ADC channels.  This allows continuous positioning (for example, once per period) to determine the position of the zero level of the measured voltage. <br>  Those.  we managed with an unipolar powering op amp, and our input signal at point 1 varies from 0 to Uop.  This method gives fairly accurate results, compared, for example, with the rectification voltage using diodes. <br>  The calculation of the divider and the ADC coefficient is as follows: <br><img src="https://habrastorage.org/storage3/757/92f/60f/75792f60f50ba17cbe0c1fc003c72f4e.jpg"><br>  where A and B are the ADC measurements (minus the measured value of the signal zero - AN1) for the current and previous half periods;  N1, N2 - the number of measurements for the current and previous half periods;  Nad - ADC digit capacity;  U'op is the reference voltage minus the non-linearity (insensitivity) zones of the operational amplifier (usually 0.6 V). <br>  Calculation of the divider is conveniently carried out considering the signal to be constant, reduced to the amplitude of a sinusoidal, and not sinusoidal.  Then the effective value of the signal is equal to the amplitude and equal to the value of each measurement. <br>  For example, you need to calculate the divider to measure the maximum value of 420V AC: <br><img src="https://habrastorage.org/storage3/194/25e/703/19425e70339f2b39c59875160db9b432.jpg"><br>  The resistance Ra is selected in the range from 500 kŒ© to 1500 kŒ©.  For the selected resistance Ra, Rb is calculated. <br>  As a result, the algorithm for calculating the effective value of voltage and frequency takes the form: <br><img src="https://habrastorage.org/storage3/7c1/9c8/164/7c19c81641c0307ebe6236b396834839.png"><br>  In this case, part of the cost calculations (division, extraction of the root) can be transferred from the interruption to the main program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When calculating effective values ‚Äã‚Äãon an 8-bit MC, it is advisable to use integer methods (using scale factors) without resorting to floating-point calculations, and also to simplify as far as possible arithmetic operations (division, removal of a square root, etc.).  This greatly saves resources MK. </div><p>Source: <a href="https://habr.com/ru/post/193022/">https://habr.com/ru/post/193022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193000/index.html">Artificial Intelligence and Why My Computer Doesn't Understand Me?</a></li>
<li><a href="../193004/index.html">Alternative .sortable - a new solution for sorting the list on jQuery</a></li>
<li><a href="../193008/index.html">Happy Tester!</a></li>
<li><a href="../193016/index.html">New cloud storage feature: creating links to download files</a></li>
<li><a href="../193018/index.html">Why is the majority not always right?</a></li>
<li><a href="../193024/index.html">Base GeoIP - countries and cities, September 2013</a></li>
<li><a href="../193026/index.html">We invite you to participate in the Intel Software Conference 2013</a></li>
<li><a href="../193028/index.html">Google introduces end-to-end encryption between data centers</a></li>
<li><a href="../193030/index.html">Dell Solutions Forum 2013: registration is open!</a></li>
<li><a href="../193032/index.html">Fujitsu OASYS 30AFII Japanese Text Editor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>