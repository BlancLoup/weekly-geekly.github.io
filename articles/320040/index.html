<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Firebase: farewell to illusions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Marketing has become part of the development world. By the number of stars on GitHub, it is determined which of the similar solutions are cooler, and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Firebase: farewell to illusions</h1><div class="post__text post__text-html js-mediator-article">  Marketing has become part of the development world.  By the number of stars on GitHub, it is determined which of the similar solutions are cooler, and by the number of tweets, we can predict which technology will be developed in the next six months.  In such circumstances, we risk becoming victims of HYIP, which we did in <a href="http://livetyping.com/">Live Taiping</a> , taking <a href="https://firebase.google.com/">Firebase</a> as the Holy Grail, which can solve all problems at once: collecting statistics, integrating chats, choosing a database, quickly developing MVP.  When I ran into this service in battle, I realized that my understanding of Firebase was so different from reality that my understanding of the field of application of technology became a real revelation for me.  I want to share this understanding and how to use Firebase right after all. <br><br><img src="https://habrastorage.org/files/d7d/37c/122/d7d37c122f6b439abf7c5a7465f6b7c1.png"><br><a name="habracut"></a><br>  I had a desire to work with Firebase a long time ago, but I was waiting for a suitable project.  And waited: MVP office reservation system.  Since this is a MVP, the business logic of the backend is rather primitive.  In addition, a mobile application on iOS will be connected to Firebase.  It looks like an ideal case for using the service, but during the implementation I had to face some problems, which will be discussed further. <br><br>  But first I would like to eliminate all misunderstandings.  Here are two things you need to learn to work with Firebase: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  This is not a backend, but a database.  You can forget about those wonderful examples of applications on Firebase without the server side, this is still unattainable; </li><li>  This is NoSQL with all its advantages and disadvantages. </li></ol><br>  Choose a solution for storing data based on the nature of the data itself.  Firebase has its drawbacks: <br><br><ul><li>  its scope is much smaller than that of a NoSQL solution; </li><li>  Firebase severely limits you when retrieving data and, if necessary, writing data to several places at the same time; </li><li>  far from all data structures is convenient to work in Firebase. </li></ul><br>  But the tool that allows you to quickly start developing MVP and having even a lot of advantages, it‚Äôs a pity to dump it.  And weak spots can be patched if they bother you. <br><br><h3>  Preamble </h3><br>  Imagine that you are developing a reservation system for a hotel chain. <br><br><img src="https://habrastorage.org/files/216/ddd/530/216ddd530d2a4771b3a85561ffbed571.png"><br><br>  There are such entities: <br><br><ul><li>  hotel </li><li>  number </li><li>  customer </li><li>  booking </li></ul><br>  It is clear how to implement this in a SQL database: four tables with links, and the trick is done. <br><br>  How to implement it on NoSQL (Firebase)?  You can try to put entities into each other: <br><br><pre><code class="hljs">{ ‚Äú‚Äù: { ‚Ä¶ ‚Äú‚Äù: { ‚Äú‚Äù: { ??? }, ... } } }</code> </pre> <br>  Then questions begin to arise: is it worth it to invest all bookings in the number?  and where to invest customers?  Etc.  The problem with NoSQL is often that the data has to be duplicated. <br><br>  There is a second option: try to use NoSQL in a way similar to SQL and create objects for each entity in the root, and maintain connections by storing the id of other objects. <br><br>  Probably, it is easier to deal with these problems in other NoSQL databases, but I did not find solutions for my tasks in Firebase. <br><br>  Whichever option you prefer, they have the same problem: the inability to make a complex sample of data.  What if you want to get a list of bookings for a specific customer?  These reservations may be invested in different rooms and hotels, and if the structure is flat, then Firebase will not be able to filter data by several parameters (this issue was even discussed on <a href="http://stackoverflow.com/questions/26700924/query-based-on-multiple-where-clauses-in-firebase">StackOverflow</a> ).  In general, if you want to make a selection of the client and the date of booking, Firebase SDK will not help you. <br><br>  You can try to solve this problem on the backend, but then you have to download a sample of data filtered by one parameter and filter it further yourself.  This is unacceptable. <br><br><img src="https://habrastorage.org/files/b29/dc4/27b/b29dc427b74344cea1e93988375d8243.png"><br><br><h3>  What to do? </h3><br>  Do not use Firebase for complex data sampling.  Your own Node.js backend and one of the tools below can help us with this. <br><br><h3>  Elasticsearch </h3><br><img src="https://habrastorage.org/files/96f/2e7/82d/96f2e782d3b844f4b82fc711d9af0da5.png"><br><br>  This is a search engine with JSON REST API using <a href="https://ru.wikipedia.org/wiki/Lucene">Lucene</a> and written in Java.  Details can be read on the <a href="https://www.elastic.co/products/elasticsearch">official website</a> , and we will immediately begin to consider it in conjunction with Firebase. <br><br><h4>  Installation </h4><br>  You need to put ElasticSearch on the server (it will be easy to do this according to the instructions).  After you need to integrate it with Firebase, namely, create a search index from the Firebase database.  I used the <a href="https://github.com/firebase/flashlight">official integration from Firebase</a> .  To start, you need to download the repository, install dependencies and fill in the config with the keys for Firebase. <br><br>  In this solution, I found several drawbacks: <br><br><ol><li>  This is a separate application on Node.js, and is difficult to associate with the backend; </li><li>  creating the right index for ElasticSearch is not easy, and one cannot synchronize the data with the Firebase database; </li><li>  field types are assigned automatically. </li></ol><br>  Feel them on such a simple example.  You have a list of buildings with their description and coordinates.  ElasticSearch requires that the fields responsible for the geographic coordinates of buildings be declared as such in advance, at the stage of creating a search index.  The integration of the engine with Firebase does not give control over this process, but simply synchronizes all the data, automatically determining the types of data. <br><br>  ElasticSearch is free and takes place on its service-controlled - that's a plus.  But at the same time there are a number of problems with deploem and security that need to be thought out in advance. <br><br>  Example: The port used by Elastic Search for external queries is open.  This creates a vulnerability, since the same port is used to record and manage search indexes.  A possible result of such an oversight is the removal of the search index or the entry of its data into it.  Therefore, initially this port is open only for requests from the same machine on which ElasticSearch is installed. <br><br>  We conclude: the question of how to implement the interaction between the user, ElasticSearch and the backend, falls on the developer‚Äôs shoulders. <br><br><h3>  Algolia </h3><br><img src="https://habrastorage.org/files/def/013/49d/def01349de7148e5a7a22e14fd8cd665.png"><br>  SaaS search solution.  Paid, but with a free plan.  Price and other details can be found on the <a href="https://www.algolia.com/">official website</a> . <br><br>  Integration with Firebase is implemented using the <a href="https://github.com/algolia/algoliasearch-client-javascript">official js-library</a> .  The installation and launch process is described in detail in the readme, and everything worked for me on the first attempt. <br><br>  The integration looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> algoliasearch = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'algoliasearch'</span></span>); ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = algoliasearch(config.algolia.applicationID, config.algolia.apiKey); <span class="hljs-comment"><span class="hljs-comment">//  Algolia var indexRooms = client.initIndex('rooms'); //    Algolia rooms.once('value', initInde); // rooms ‚Äî  reference    Firebase function initIndex(dataSnapshot) { var objectsToIndex = []; //      Algolia var values = dataSnapshot.val(); //   snapshot'a for (var key in values) { //   room if (values.hasOwnProperty(key)) { var firebaseObject = values[key]; firebaseObject.objectID = key; // id   Algolia      Firebase objectsToIndex.push(firebaseObject); //    } } indexRooms.saveObjects(objectsToIndex, function(err, content) { if (err) { console.log('error'); return; } console.log('success'); return; }); }</span></span></code> </pre><br>  As a result, we get a search index in Algolia containing all the objects of rooms from Firebase.  Please note that during import data can be processed additionally, for example, pull up the name of the hotel from another object in the database. <br><br>  After we have created the index, we are not going to update it entirely, therefore, in the future, we monitor the events in Firebase and process them: <br><br><pre> <code class="javascript hljs">rooms.on(<span class="hljs-string"><span class="hljs-string">'child_added'</span></span>, addOrUpdateObjectRooms); rooms.on(<span class="hljs-string"><span class="hljs-string">'child_changed'</span></span>, addOrUpdateObjectRooms); rooms.on(<span class="hljs-string"><span class="hljs-string">'child_removed'</span></span>, removeIndexRooms);</code> </pre><br>  The only downside to using Algolia is that you have to pay for SaaS.  But for MVP, a free tariff should be enough, and a large-scale project on a Firebase will occur to very few people (I hope). <br><br>  In contrast to this dubious minus, we get a comfortable admin panel with access to analytics, a search index and the nuances of search queries. <br>  An important advantage is the presence of the <a href="https://github.com/algolia/algoliasearch-client-javascript">SDK for everything and everyone</a> - from mobile platforms to backend frameworks.  I didn‚Äôt go into the essence, but the iOS developer said: this is more convenient than REST. <br><br>  I advise you to try Algolia exactly: integration with Firebase is better, installation is easier, and in the appendage we get a console with analytics and SDK.  I ignored the technical details and did not analyze the performance and speed, it is a complex and separate topic. <br><br><h3>  Results </h3><br>  The benefits of this rather simple system are tangible.  We get: <br><br><ul><li>  Firebase for storing data, all read operations and simple noncompetitive requests; </li><li>  Node.js for all competitive requests and complex business logic + Algolia / ElasticSearch services; </li><li>  Algolia / ElasticSearch for searching and complex data selection. </li></ul><br>  There are all the advantages of Firebase, without the disadvantages of having to duplicate data or organize complex and slow samples on Node.js.  In this scenario, you can easily implement a booking system or any other task that requires transactions and complex data samples.  For example, you can first pick up a room for a specific day for two people, with air conditioning and a balcony, and then book it and not be afraid that the room has already been occupied or will be occupied again.  Some data, however, will have to be duplicated, but only in the search index itself, and not in the database. <br><br>  With proper use of Firebase, it becomes an acceptable solution for accessing and storing data.  Always remember that data is primary, and if you choose the wrong data structure or way to work with them, you will face serious problems in development. <br><br>  I am waiting in the comments of your stories about the integration of Firebase and comments on the article.  Thank! </div><p>Source: <a href="https://habr.com/ru/post/320040/">https://habr.com/ru/post/320040/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320026/index.html">"Friday format": where to grow technical specialists</a></li>
<li><a href="../320030/index.html">Intel Software Guard Extensions tutorial. Part 5, development of the enclave</a></li>
<li><a href="../320032/index.html">Hardware or software write blockers - which is more reliable?</a></li>
<li><a href="../320034/index.html">Is React Native good?</a></li>
<li><a href="../320036/index.html">Installation and basic configuration of nginx and php-fpm for developing projects locally in Ubuntu 16.04</a></li>
<li><a href="../320042/index.html">Grant Proposal course: how to find the right words to attract attention and money to your development</a></li>
<li><a href="../320044/index.html">Caching data in web applications. Using memcached</a></li>
<li><a href="../320046/index.html">Authorization in Laravel, through social networks (Ulogin). Simple, flexible and efficient.</a></li>
<li><a href="../320048/index.html">Summary building information model: a practical lesson on OpenBIM technology</a></li>
<li><a href="../320052/index.html">Android Shortcuts Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>