<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple charger for 2S batteries on STM32F030</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some amount of 2S batteries of different capacity accumulated, which need to be recharged in ‚Äúfield conditions‚Äù from 12 volt batteries or USB. I decid...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple charger for 2S batteries on STM32F030</h1><div class="post__text post__text-html js-mediator-article">  Some amount of 2S batteries of different capacity accumulated, which need to be recharged in ‚Äúfield conditions‚Äù from 12 volt batteries or USB.  I decided to make a charger on a microcontroller, at the same time adding the function of recharging the phone from the same batteries (using the simplest step-down converter on MP1584EN).  The scheme had to be redone in the process, so the view is not very presentable turned out. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1a8/a10/bb9/1a8a10bb939644c2b5bd838b6f56d165.JPG" alt="image"></div><a name="habracut"></a><br>  Functionally, the charger is the simplest combined buck-boost converter (500 kilohertz), with control of the charging current.  All are controlled by the STM32F030F4P6, measuring the voltage on the battery, the balanced output (the junction point of two battery cells), the input and charging current, and also generating PWM pulses for key management.  Indication - the simplest, using a two-color LED. <br><br>  Scheme: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/751/c52/725/751c527253c341259120e6168eca938d.png" alt="image"><br><br>  ‚Üí <a href="https://github.com/vasimv/Recharger">Code for firmware (project Eclipse + GNU ARM plugin)</a> <br><br>  Due to the simplicity, there is no battery cell balancing function (only control over recharging), so periodically it is necessary to balance the battery on a normal charger.  You also can not connect to the input at the same time a 12 volt battery and USB power, since these inputs are trivially closed (you could probably plug a pair of diodes into the USB connector circuit and the 12 volt input, but somehow did not immediately think). <br><br>  When a 12 volt source is connected, the buck converter works on Q1-L1-D5, and when power is applied to the USB connector, Q1 is simply constantly open, while the boost circuit is engaged on the Q3-L1-D4.  The current is measured by a shunt at R23-R24 (two resistors in parallel are needed, since one resistor of size 0805 can overheat). <br><br>  The output converter (for powering USB devices) is a ready-made Chinese module on the MP1584EN, only I had to solder to the second pin of this chip in order to be able to turn it off to avoid overdischarge. <br><br>  Initially I used rather low-power transistors FDV303N / FDV304P as key ones, but quickly discovered that their resistance in the open state was too high and they periodically even independently soldered off the board due to overheating.  I had to purchase and supply more powerful ones (IRLML2246 and IRLML6346). <br><br>  Update: I printed a primitive case, it turned out 132x42x40 - I made a decent margin to fit batteries with long ends (in the photo, for example - 2.2 Ah * 35C battery). <br><br><img src="https://habrastorage.org/files/05b/052/ebb/05b052ebb5dd4243aabff8afc924f428.PNG"><br><br><img src="https://habrastorage.org/files/121/e1e/44d/121e1e44d49647bd9370bf57f522a778.PNG"><br></div><p>Source: <a href="https://habr.com/ru/post/399719/">https://habr.com/ru/post/399719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../399707/index.html">Rumor: Fitbit, a manufacturer of smart watches and bracelets, plans to buy its competitor Pebble for $ 40 million</a></li>
<li><a href="../399709/index.html">What kind of disease: acquired immunodeficiency syndrome</a></li>
<li><a href="../399711/index.html">Scientists are looking for ways to regenerate human body tissue in the intestinal genes</a></li>
<li><a href="../399713/index.html">Vladimir Putin in a message to the federal assembly drew attention to the IT sector</a></li>
<li><a href="../399717/index.html">Germanium can replace silicon in transistors and bring them to a new level</a></li>
<li><a href="../399721/index.html">I'm dad engineer</a></li>
<li><a href="../399723/index.html">Great features in a compact package, or Video Bridge from Dadzhet</a></li>
<li><a href="../399725/index.html">Amazon Go - store without cash registers and queues</a></li>
<li><a href="../399727/index.html">Australian schoolchildren recreated the drug, which Martin Shkreli raised the price 56 times</a></li>
<li><a href="../399729/index.html">NASA is developing a satellite to refuel and maintain other satellites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>