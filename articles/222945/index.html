<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As we developed "Spetskor" - a super-custom mobile application for civilian reporters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are pleased to present habrasoobshchestvu mobile application for civilian journalists "Spetskor", with which you can take photos and video reports ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As we developed "Spetskor" - a super-custom mobile application for civilian reporters</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/083/d86/bee/083d86bee15e388f615ce345023ae751.png" align="left">  We are pleased to present habrasoobshchestvu mobile application for civilian journalists "Spetskor", with which you can take photos and video reports and promote them under the auspices of "Komsomolskaya Pravda".  The main creator is Komsomolskaya Pravda Publishing House, IT minions and developers are we, EastBanc Technologies.  The project was <a href="http://www.kp.ru/daily/26224.4/3107161/">announced</a> by Komsomolskaya Pravda at the end of April 2014, at the same time the first competitions were launched.  For our part, we decided to share the technical details of the implementation of the application.  In our opinion, it will be interesting for readers, because rarely in one project there are so many non-trivial technological and business problems at the same time. <br><br>  "Spetskor" refers to a multi-platform client-server applications with an administrative interface.  The client part is implemented on iOS and Android mobile platforms and contains the following functionality: <br><br><a name="habracut"></a><ul><li>  creation of photo and video reports; </li><li>  participation in tasks; </li><li>  view a shared report feed; </li><li>  receiving push notifications, setting the types of notifications received; </li><li>  the ability to share content in their accounts on social networks. </li></ul><br>  The server part consists of the following parts: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  administrative interface; </li><li>  API for mobile applications; </li><li>  a service for processing media content and publishing content on social networks; </li><li>  service for sending push notifications. </li></ul><br>  The business goal of the project is the creation of a managed network of civilian reporters using an application that will allow journalists and editors of Komsomolskaya Pravda to interact effectively.  To achieve this goal, it was necessary to give an opportunity to target and segment information by categories and topics, and users - by regions of Russia. <br><br>  Initially, the following requirements for the server part were formulated: <br><br><ul><li>  scalability; </li><li>  definition of user geolocation; </li><li>  photo and video processing; </li><li>  integration with popular social networks. </li></ul><br>  Additional technical requirements: <br><br><ul><li>  MongoDB </li><li>  OpenShift Private Cloud </li><li>  Python and TurboGears 2 for the implementation of server-side functionality </li><li>  Twitter Bootstrap for admin interface. </li></ul><br><h4>  How the application works </h4><br><h5>  Administrative Interface Sections: </h5><br><ul><li>  list of social networks, adding and blocking social networks; </li><li>  a list of cities, adding a city, viewing information about the city; </li><li>  font list, add and remove fonts.  It is possible to add a custom font in TTF format; </li><li>  list of skins (themes for reportage), adding and editing skin; </li><li>  headings list, adding headings.  A rubric is a set of skins with additional properties containing the name of the rubric; </li><li>  a list of related hashtags for posting to social networks; </li><li>  list of tasks, adding a task.  The task is similar to a rubric, but it can be assigned to specific dates, cities, and even to individual users;  for tasks push notifications are sent; </li><li>  list of news, add news.  News contains textual and graphical information and can be tied to cities and users; </li><li>  news feed is a tool for moderation and awarding users.  Can also be used to remove reports.  For each report links to publications in social networks; </li><li>  user list - all users of the application are displayed here.  From the user's page, you can go to the tape of his reports, assign an award.  You can assign the user a news item or a task, and a push notification will be sent to him.  If the user has already published content to social networks, then links to his profiles in these networks will be shown.  Also, the user can be blocked; </li><li>  list of managers, add manager.  Creating accounts for employees of Komsomolskaya Pravda responsible for the content and work with users in a particular region.  Rights are assigned to managers in such a way that they can create tasks and news only for a given set of cities.  Also, managers are responsible for moderating content. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c14/068/91a/c1406891af869cea715f9b4af9c3a2cc.png" align="left"><h4>  The process in terms of "Komsomolskaya Pravda" </h4><br>  KP employees who are responsible for the operation of the ‚ÄúSpecialcore‚Äù application are called managers.  Each manager is responsible for a specific geographic region. <br><br>  The main responsibilities of Komsomolskaya Pravda managers are creating content for a mobile application.  Through the administrative panel, managers add tasks and rubrics, fill them with skins.  For customization of skins, they can add different fonts. <br>  When there is at least one skin in a rubric or task, it becomes available in the mobile application, and users create their own reports using existing skins. <br>  Reportings are sent to the server, processed and fall into the tape available to the manager.  Depending on the task or heading that may be tied to a specific region, as well as from the geographical coordinates of the reportage for headings that have no geographic restrictions, the reportage will be checked by the manager who is responsible for the corresponding region. <br><br>  The manager plays the role of moderator of reports, publishing the best in the general tape and awarding awards.  Reports that have been published are made available in the feed in a mobile application. <br><br>  Information about the award comes to the author of the report in the form of news, as well as in the form of a push-notification, if the appropriate type of notification is enabled in the settings of the mobile application. <br><br>  In addition to skins and headings, managers can create news to talk about important events and the results of competitions.  In addition, news is automatically generated for awarding and awarding titles to reporters. <br><br>  One of the interesting tasks in creating an administrative interface for Komsomolskaya Pravda managers was the implementation of the ability to create and edit a skin.  To do this, our colleagues developed a fully-featured WYSIWYG editor: all changes in properties are immediately displayed on the edit page as a skin preview.  Using Javascript and CSS, the skin is displayed exactly as it will appear on mobile devices. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e1/42d/b56/8e142db56b881677b5c78e79f01da05f.png" align="right"><h4>  The process from the point of view of users of "Spetskor" </h4><br>  The user takes a photo or video, selects which category he wants to publish the report in, selects the desired skin in the category, fills in the report fields (title, subtitle, city, comment) and presses the ‚ÄúPublish‚Äù button.  Before publication, the user can select the list of social networks in which he wants to additionally publish his report. <br><br>  The user does not need to register in the application, and if he does not want to share the report in his accounts on social networks, he does not need to login even in them.  In the application "Spetskor" user can upload videos and photos completely anonymously.  If the user is logged in to a social network, then the server will receive information about his account, and the author‚Äôs name and avatar will be displayed in the general tape of the published reports. <br><br>  To make a report for the task, the user must first open the task, and press the ‚ÄúParticipate‚Äù button in it, then in the list of available skins when creating the report, only skins from the selected task will be shown.  Of course, the user can refuse to complete the task at any time. <br><br><h5>  Example </h5><br>  The administrator responsible for the Siberian Federal District creates one task for Novosibirsk, Krasnoyarsk, Omsk and Tomsk.  For example, shoot a video about how the Olympic flame is carried through these cities.  For each city, the time interval is indicated when this task will be relevant. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/421/890/bd5/421890bd59c3028e4a9b5d954e3aa9b9.png"><br><br>  Users who will be within 50 km of the site during the task will receive a push notification of the task.  A wave of tasks will travel across all programmed cities in accordance with the time zone and the time when the torch will be carried in the city. <br><br>  Next, the user goes to the scene and removes the report (we will discuss this in more detail later), selects and applies the skin, optionally publishes them in his personal accounts in social networks.  The report is sent to the server, where it is waiting for processing and moderation. <br><br>  After processing, the report is displayed in the ‚ÄúMy feed‚Äù report, but if the report has been moderated and approved, it becomes available in the general tape. <br><br>  This is how the processes behind the scenes look approximately.  Refer to the implementation details. <br><br><h4>  Server side architecture </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/49e/8c8/fc5/49e8c8fc5a358dafff6bce14807949be.png"><br><br><h4>  How information storage is organized </h4><br>  All information from mobile devices is stored in the MongoDB database.  The main tasks for which the choice of DBMS was critical in our project are: <br><br><ul><li>  user selection by region; </li><li>  selection of reports by region; </li><li>  selection of tasks / rubrics by region; </li><li>  storing large amounts of binary data; </li><li>  scaling; </li><li>  speed. </li></ul><br>  In MongoDB, work with geoindexes is implemented, and this greatly simplified the implementation of work with geodata in our application. <br><br>  One of the options for implementing a MongoDB cluster configuration is replication.  This allows you to distribute the load between multiple copies of the database (meeting the requirements for scalability). <br><br>  To work with binary data, we used the MongoDB part called GridFS, which allows you to store binary data inside the database.  To increase the speed of working with binary data, we store them in different collections. <br><br><h4>  How clustered load </h4><br>  One of the customer's requirements was that the back-end for simplicity, support and expansion was secured in the OpenShift-platform, which allows you to automatically scale resources depending on the load.  If the server is heavily loaded, then <a href="https://www.openshift.com/products/architecture">OpenShift</a> itself can raise another instance of this server. <br><br>  In our case, one server consists of the following parts: <br><ul><li>  administrative interface; </li><li>  API for mobile applications; </li><li>  a service for processing media content and publishing content on social networks; </li><li>  service for sending push notifications. </li></ul><br>  Services for processing media content and sending push notifications are processes that find and process data in the database for processing.  When increasing the load, OpenShift raises additional server instances, it increases the number of services, and they may try to process the same information.  Using the atomic operation in MongoDB, the findAndModify process sets a special status to the content being processed, thereby prohibiting its use by other processes. <br><br>  Installing an application in OpenShift occurs via a push command to the remote Git repository where the application is created.  OpenShift supports hooks, for example, there is a hook called when installing an application.  We use this hook so that the database does not pass the initial initialization with each update of the application. <br><br><h4>  API and geolocation </h4><br>  Since tasks and rubrics in an application can often be limited to geographic regions, it is important to understand the location of a user to determine his access rights, as well as to send notifications.  To determine the coordinates of the user, the application requests rights to access geolocation data and, in the case of obtaining permission from the user, receives the coordinates and sends them to the server.  If the user has prohibited the application from receiving geolocation information from the smartphone‚Äôs operating system, and the application cannot send data to the server, the coordinates are determined using geoip services.  At the request of the application is determined by the approximate position of the user at the place of registration of his provider. <br><br>  To determine the location of the user who has banned geolocation in the settings, we used 2 services: <br><br><ul><li> <a href="http://dev.maxmind.com/geoip/legacy/geolite/">MaxMind Geolite</a> is a local database of the ratio of IP addresses and their geographical location (there are problems with accuracy in the Russian Federation and the CIS): </li><li>  <a href="http://ip-api.com/">ip-api.com</a> is an online service that <a href="http://ip-api.com/">locates</a> with higher accuracy.  There is a serious limitation on the number of requests, so information caching is used. </li></ul><br><h4>  Media Processing Service </h4><br>  A media content processing service is a process that runs independently of the remaining parts.  The main objectives of this process are to select content from a database with a certain status, process and save the processed data back to the database.  Media content processing consists of two parts: video processing and photo processing. <br><br><h5>  How video processing is implemented </h5><br>  Video processing is carried out using a third-party avconv program (further development of the ffmpeg application). <br><br>  Reporting video may consist of several pieces.  It is removed on the principle of Vine / Instagram: while you hold your finger on the screen, the shooting goes as soon as you let go - it is interrupted.  Mounting the pieces directly on the device is a very resource-intensive process, so the final installation takes place on the server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/710/378/1a0/7103781a06c53cccb76a6fef4a1e4e2f.png"><img src="https://habrastorage.org/getpro/habr/post_images/bca/183/324/bca183324e0b58c130ef7d5f1f016226.png"><img src="https://habrastorage.org/getpro/habr/post_images/f90/e74/ec7/f90e74ec722633e8e4b5647d76f5bfdb.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7cc/c21/c09/7ccc21c0950ef3a907e10a559367f31d.png"><img src="https://habrastorage.org/getpro/habr/post_images/44b/37c/ad4/44b37cad49434af585d2bf36657c77bd.png"><img src="https://habrastorage.org/getpro/habr/post_images/7c4/af1/3a0/7c4af13a0d70856ce0bdbc77b1694693.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e0/e9a/f4c/6e0e9af4c8ff3eea1369b73b014f6d84.png"><img src="https://habrastorage.org/getpro/habr/post_images/ce6/0aa/237/ce60aa23786f5755b9256c04fe224bcb.png"><br><br>  Video can be shot from two cameras - front and rear, you can switch between them in the process of shooting.  The permissions of a video shot on different smartphones are different.  However, when publishing, we create clips 640 * 640.  The overall video processing process includes the following steps: <br><br><ol><li>  We determine the angle of rotation of the video (information is taken from the metadata of the video file). </li><li>  We overturn in the necessary orientation. </li><li>  Apply crop (crop). </li><li>  Perform scaling. </li><li>  Overlay the skin. </li><li>  After processing all the pieces, we glue them together in one clip - all this is done on the server, without the ‚Äúmanual‚Äù work and human participation. </li></ol><br><br>  Everything, we publish. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/bcd/4be/54cbcd4beec0ef2444a935d6463bb072.png"><img src="https://habrastorage.org/getpro/habr/post_images/011/1fb/a27/0111fba2766c1897020f731a88114607.png"><br><br><h4>  How image processing is implemented </h4><br>  With photo processing everything is simpler: images are processed using the Pillow library. <br>  The mobile application sends the original photo to the server, as well as information about the report.  In general, the steps of processing a photo report are similar to video processing. <br><br><h4>  How is the load on the social network implemented </h4><br>  The application provides support for downloading reports to the main social networks: VKontakte, Odnoklassniki, Twitter, Facebook, Instagram, YouTube. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6fa/edc/3c9/6faedc3c9b9e8a90c561b64a713910f6.png"><br><br><h5>  Uploading reports in the user's social network </h5><br>  If a user decides to share his report on social networks, he needs to select in the application which network he wants to share the report.  Further, the process will be as follows: <br><br><ol><li>  The user is authorized in the selected social network. </li><li>  The user is asked for permission to access the profile and publish it in his tape on behalf of the Specialcore application. </li><li>  If the user allows, the mobile application receives Access Token and sends it to the server </li><li>  The server requests a user profile for a token and stores some user data in the database: first name, last name, and a link to the avatar. </li></ol><br>  After the user uploads his report to the server and the media content of the report has been processed, the process of downloading the report in the social network is launched directly.  If this is a video report, then it can be downloaded on Vkontakte, Facebook, YouTube.  If the user has selected one of these social networks, and also has chosen Twitter or Odnoklassniki, then video will be uploaded to video hosting social networks, and a link to video will be uploaded to Twitter / Odnoklassniki.  All networks are available for photo reporting except YouTube. <br><br><h5>  Uploading reports in the customer's social network </h5><br>  In addition to the publication of the report in the user accounts of social networks, the report will be uploaded to the private Twitter-and YouTube-accounts of the customer.  For this, separate applications were created in social networks.  To upload to Twitter, user authorization is not needed (tokens with which publications are made do not have a statute of limitations).  And to upload to YouTube, you need a primary user authorization (we made it in the application‚Äôs admin panel), during which the server receives 2 keys from YouTube: access_token and refresh_token.  Access Token is a key that is used to upload videos to YouTube and is valid for a certain period of time.  Refresh Token is needed to generate a new Access Token when required. <br><br>  Refresh Token has no statute of limitations and may become outdated only when the user withdraws the publication rights from this application.  Another nuance associated with YouTube: the number of videos uploaded through the API is limited, a total of 2,000 videos.  Therefore, the server maintains a publication count and organizes the ability to add multiple YouTube accounts.  To publish the video server will choose the account in which the least published clips are published. <br><br>  In addition to private accounts, there is the same pair of public accounts.  There reports are published only after passing moderation. <br><br>  In the report, you can use hashtags.  Some social networks when publishing content allow you to specify them separately.  The user can specify hashtags in the comments to the report, and the customer manager, in addition, can provide tags with a task or a heading. <br><br><h4>  Service for sending push notifications </h4><br>  Since our app is released on iOS and Android, we support both the Apple Push Notification Service and Google Cloud Messaging. <br><br>  The standard practice is this: first, the application requests from the mobile device an identifier of the ability to display push notifications.  At this time, the operating system itself asks the user if he wants to accept them. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c45/c19/d78/c45c19d78df8261b1d8d12f06ed2cf6c.png"><br><br>  We did not agree to just ‚Äúoff‚Äù or ‚Äúon‚Äù for all app notifications.  It was necessary to customize the process, because someone from the users wants to learn about new tasks, someone wants to get new reports, someone wants to get a notification that their report is published, and others do not need it. <br><br>  We decided to work with the task using the settings and configuration of the server.  If the user has agreed to receive push notifications, then he has the opportunity to configure which types of notifications he wants to receive: <br><br><ul><li>  about new reports in the general tape, </li><li>  about news and tasks </li><li>  about awards assigned to the user. </li></ul><br><h4>  Total </h4><br>  Let's be honest: it was an exciting experience in product development, not just from a technical point of view, but based on a global idea - to create a huge network of citizen journalists across the country, take civic journalism to a professional level, giving them the resources to promote Russia . <br><br>  The application is running.  For example, for "Night at the Museum" <a href="http://kirov.kp.ru/daily/26232.5/3114855/">civilian reporters have already received fees</a> .  If you live in the capital, then right now you can compete for fame and money by creating interesting reports on the topic <a href="http://msk.kp.ru/daily/26232/3115375/">‚ÄúHeat in Moscow‚Äù</a> , and for Novosibirsk ‚ÄúKomsomolskaya Pravda‚Äù gives a chance to become rich and famous by <a href="http://www.kp.ru/daily/26231/3113836/">going to a photo hunt in the city zoo</a> (countrymen, hurry, pictures of the white bear Shilka - a safe option!). <br><br>  Download "Spetskor" in <a href="https://play.google.com/store/apps/details%3Fid%3Dru.eastbanctech.reporter">Google Play</a> and <a href="https://itunes.apple.com/ru/app/speckor/id860491829">AppStore</a> . </div><p>Source: <a href="https://habr.com/ru/post/222945/">https://habr.com/ru/post/222945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222933/index.html">Poll - Open data of the Ministry of Finance</a></li>
<li><a href="../222935/index.html">Create music from anything</a></li>
<li><a href="../222939/index.html">From Imagine Cup to a startup</a></li>
<li><a href="../222941/index.html">Ruby 2.1 in detail (Part 1)</a></li>
<li><a href="../222943/index.html">Caesar III Reverse Engineering (Part 2, Drawing the City)</a></li>
<li><a href="../222947/index.html">Update on the popularity of CMS-systems, analytics systems and online consultants in RuNet for the 2nd quarter</a></li>
<li><a href="../222951/index.html">Joint experiment of Yandex.Mail and Nginx teams: does SPDY really speed up the Internet?</a></li>
<li><a href="../222953/index.html">Experience one engineering investigation</a></li>
<li><a href="../222955/index.html">Brainstorming is not as effective as it seems</a></li>
<li><a href="../222957/index.html">How to speed up the program on Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>