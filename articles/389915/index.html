<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RandomRace.ru - radio direction finding for dummies (start)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Where did the idea come from 
 One old friend of mine undertook to discuss his new venture with me - we all once took a great interest in adventure ra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RandomRace.ru - radio direction finding for dummies (start)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f4b/8d5/885/f4b8d58852c146b1b2d6673696688fd0.JPG"><br><h4>  Where did the idea come from </h4><br>  One old friend of mine undertook to discuss his new venture with me - we all once took a great interest in adventure races, of which there are <a href="http://www.adventureraces.ru/">many</a> in our area, but this didn‚Äôt give a person a quiet life of predictability of the classic adventure race - control points (CP) are arranged by people, which means they can be a little bit to predict. <br>  This is how <i>RandomRace.ru</i> appeared (RR for short). <br><br>  So, the main idea of ‚Äã‚Äãthe RR is to launch racing gearboxes on the balls into the air, at some random height the balls will burst, and the gearboxes will fall on parachutes.  KP will give their GPS coordinates to the race server, and participants will then search for them.  In principle, the competition rules are designed so that KP probes are returned to the organizers by the participants.  Naturally, except for those probes that have distinguished themselves by an increased randomness and flew away somewhere <s>in the</s> far.  Such CPs have to be found by the organizers on their own.  It so happened that as a result I took up the technical solution of the ‚Äúlast 100 meters‚Äù problem, when the organizers arrived at the place, I really wanted to find the command post, and the coordinates are inaccurate.  To this end, it was intended to use a direction finding - each probe carries a radio transmitter, and the organizers carry a direction finder. <br><a name="habracut"></a><br><br><h5>  General requirements for the transmitter: </h5><br>  - low weight and volume <br>  - powered by a lithium-polymer cell (battery from a cell phone) <br>  - battery life of at least a day <br>  - low price, because  the probability of losing the device is considerable 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  General requirements for the receiver: </h5><br>  - moderate weight and volume <br>  - directional antenna <br>  - sound and visual indication of the signal level <br>  - battery life of at least 2 hours <br>  - receiver detection range - from 100 meters in the forest. <br><br>  Later, our team began to take part in the <a href="https://www.balloonchallenge.org/teams/15">Global Balloon Space Challenge</a> , as well as in other events, and, of course, the lighthouses were used in all cases. <br><br><h4>  Frequencies and antennas </h4><br>  The standard frequencies of ‚Äúfox hunting‚Äù had to be abandoned due to the size of the antennas, and as a result of pensive thinking it was decided to use the frequency of 433 MHz.  Conditionally unlicensed, does not require large antennas, there are a number of transmitters and receivers for this range on sale.  The transmitter antenna must be omnidirectional, the receiver antenna, on the contrary, narrowly directed.  In the case of a transmitter, there was no particular choice - a spring antenna or a printed one.  For the receiver, the choice is wider - the frame, the classic "fox" frame + pin, double or triple square, yoga, wave channel.  The next evening on the <a href="http://caxapa.ru/433688.html">forum, Sahara</a> and painful meditations led to the conclusion that it was a double square.  This is a compromise between the distinct size, simplicity and quality of reception.  The size of the entire antenna is about 18 * 18 * 8 cm. The front square is an open vibrator, the back, slightly larger, closed reflector.  The receiver board was mounted at the rupture of the vibrator.  The geometry of such antennas is desirable to withstand as accurately as possible.  Material for the manufacture of the antenna - brake tube for "Lada" and a few pieces of plexiglass, produced in the storeroom. <br><img src="https://habrastorage.org/files/84f/5c6/c21/84f5c6c21dbb43668c2d0a6ac5f33187.jpg"><br><br>  Two squares of the tube are held by a diagonal part and two corner trapezoidal plates in the corners.  The entire structure is reliably tightened with cable ties.  For the manufacture of parts, I printed the drawings in real scale and pasted them on plexiglass.  Then I drilled holes and cut out the contours with an electric jigsaw.  Despite my concerns, the antenna turned out pretty tough, but at the same time plexiglass turned out to be too fragile material and quickly broke.  The second time non-metal parts of the antenna were made on the same drawings on a laser cutter from plywood (thanks, <a href="http://fablab.spbstu.ru/">fablab-polytechnic</a> ).  A pistol grip and relief holes were added to the drawings.  To protect against water, plywood was coated with acrylic spray varnish. <br><br><h4>  We learn to cook them </h4><br>  For all the electronics in the project, microcontrollers from the STM8 series were used - not the most popular, but I like them.  The low price that in this project is one of the main conditions, rich peripherals, the ability to power the MK directly from a Li-Po battery, the overall simplicity and good demo boards - that‚Äôs what attracts me to these chips.  It is also worth noting the simplicity of the boards, because  MK is sewn on 1 wire (sometimes 2 - you still need a reset).  The hardware debugger works on the same interface. <br>  To flash the STM8 microcontroller, you need a compatible programmer.  The programmer can be purchased separately, but it is easier and cheaper to get one of the boards of the STM8 series ‚Äî something_DISCOVERY.  To use the programmer built into the board, you must unsolder 2 jumpers and wire the pins from the board to the target device.  Personally, I use the programmer, which is regularly broken off from STM8S-DISCOVERY, and for mass flashing - a special adapter with two crocodiles and two probes from the tester.  Unfortunately, gcc is not ported to the STM8 core, you have to use free versions of paid compilers.  In my case, this is raisonance, the development environment is stvd. <br><br><h4>  The first version of electronics </h4><br><h5>  Transmitter </h5><br>  For the first version of the device, Telecontrolli modules were purchased.  For transmitters - RT4-433 (later RT14-433).  At first it seemed like a good option.  To control the modules in the transmitter, one of the cheapest MCUs, STM8S003F3, was used, in an SO-16 package that is convenient for soldering.  The circuit is banal - the MCU itself, an obligatory capacitor, a filter capacitor in the power circuit, a radio module, an LED and a resistor to it.  About once a second, the transmitter emits about a half-second am-modulated pulse with a frequency of 200 Hz and blinks an LED.  This variation of the lighthouse experienced several trials and incarnations. <br>  Self-made lute boards were applied, <br><img width="400" src="https://habrastorage.org/files/794/f47/936/794f479367dd4ae89282649e87403d38.jpg"><br><br>  Chinese software with seeedstudio; <br><img width="400" src="https://habrastorage.org/files/b37/436/a51/b37436a513c443e4896d4e0fe2d21946.jpg"><br><br>  Antennas - springs and printing. <br><img width="400" src="https://habrastorage.org/files/34b/a14/a1d/34ba14a1dc4b46f1abde985274f8fef8.jpg"><br>  There were also experiments with different LEDs and different currents - for example, there was a thought that abrupt short flashes of an unnatural blue color from inside a transparent container could help to find a container in the forest at night.  Radio modules also varied, depending on the market conditions for radio components. <br><br><h5>  Receiver </h5><br><img src="https://habrastorage.org/files/3ba/26b/1ad/3ba26b1adf2448109ce6fe52570cecc5.png"><br>  For the direction-finding receiver, RRQ14-433 modules from the same Telecontrolli were used.  The module has two outputs - the received data and the analogue AGC level, also known as RSSI.  On the STM8S903C microcontroller both were set up, but the data output was just in case, the signal on it was ignored by the firmware.  The RSSI was polled continuously using the built-in ADC controller.  The signal level indication should be twofold - on the one hand, visually, with moderately large figures, visible both during the day and at night.  On the other hand, you need to attach the sound - so that you do not have to constantly look at the indicator.  Well, Hollywood traditions are like that - it should squeak.  The controller was again from the STM8S family, but the other is the STM8S903, equipped with a built-in reference voltage source, which is needed to measure RSSI.  A two-digit 7-meter LED indicator was assigned to the indicator role.  Classic arduin-like circuits with a mountain of resistors, dynamic indication and other things I didn‚Äôt want to fence at all, so the integrated LED driver STP16CP05 went into action.  This is a 16-channel shift register with current stabilization at each output, and the current value is set by one resistor for all outputs at once.  16 channels - just 2 digits of 7 segments + decimal points.  The indicator itself is simply an indicator of distinct size with a common anode.  I made the sound at the last moment from the player headphones that came to hand.  Headphones were connected through a resistor (so as not to torment the MK with large currents), to the direct and inverse outputs of the MK timer.  Since the radio module requires 5V, it was necessary to raise the supply voltage (2-cell model LiPo at 800mAh) and put the LDO on 5V (it is not on the diagram). <br><img src="https://habrastorage.org/files/244/eba/b16/244ebab1695c475080eca266124b4bc1.jpg"><br>  The controller firmware continuously measures the RSSI level, tries to find peaks there at the moment of receiving a radio signal, recalculate them in some ‚Äúparrots‚Äù and bring them to the indicator.  The same parrots are converted into the duration of periodic "beeps."  At 0 parrots, the direction finder is silent, at 99 it beeps continuously.  The transmitter firmware was reworked 100,500 times, mainly due to a distinct recount of the RSSI.  I won't show the code from there to anyone, you can't frighten people like that. <br><br><h4>  First damn.kom </h4><br><img src="https://habrastorage.org/files/632/4f9/40b/6324f940bbeb4832ba930bd39c37c169.jpg"><br>  The first tests and competitions using the ‚Äúfind me‚Äù system were generally successful; the direction finder allowed us to find a fallen probe a couple of times in the forest.  The antenna showed acceptable direction, the probes, as expected, can be heard on the radio.  The detection distance in the forest is also within reason.  One of the unpleasant discoveries was that the parameters of the transmitter modules rather ‚Äúwalk‚Äù from instance to instance - both frequency and power.  Different modules squeaked on channels 32-42, with the expected 34. The RSSI level on the receiver also behaved somewhat strange, but some shamanism in the algorithm of the receiver made it possible to see on the indicator some value similar to the signal level of the transmitter in some parrots.  In anticipation of the production of the next batch, it suddenly became clear that the key modules for the whole project, the transmitter modules, had risen in price greatly and in general almost disappeared from sale.  In anguish, I sadly rummaged in the treasures of aliexpress, without much hope of finding a replacement. <br><br><h4>  And here. </h4><br><br>  And here follows a <a href="https://geektimes.ru/post/270170/">sequel.</a> <br><br>  References: <br>  Continued: <a href="https://geektimes.ru/post/270170/">geektimes.ru/post/270170</a> <br>  About the same in English: <a href="http://www.randomrace.ru/2015/gsbc/preparation/transmitter/eng/">www.randomrace.ru/2015/gsbc/preparation/transmitter/eng</a> <br>  RandomRace: <a href="http://randomrace.ru/">randomrace.ru</a> (upcoming competitions: <a href="http://www.randomrace.ru/2016/spring/">www.randomrace.ru/2016/spring</a> ) <br>  Sources of all firmware: <a href="https://sourceforge.net/projects/randomracebeacon/">sourceforge.net/projects/randomracebeacon</a> <br>  GBSC: <a href="https://www.balloonchallenge.org/teams/15">www.balloonchallenge.org/teams/15</a> </div><p>Source: <a href="https://habr.com/ru/post/389915/">https://habr.com/ru/post/389915/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../384641/index.html">Portable hiking weather station MiniBTH2 / 2M</a></li>
<li><a href="../384681/index.html">Selection of pedometers not on the wrist: choose non-obvious models</a></li>
<li><a href="../384737/index.html">Created the first optical chip of non-volatile memory with stable performance</a></li>
<li><a href="../385187/index.html">Homemade cloud Acer BYOC Application Overview</a></li>
<li><a href="../389911/index.html">LightSail-B successfully deployed sail</a></li>
<li><a href="../389917/index.html">Electronic multitool Power-flash drive</a></li>
<li><a href="../389919/index.html">eReader Prestigio: unity and struggle of opposites of one reader</a></li>
<li><a href="../389921/index.html">Elon Musk refused to sell to a Model X client after criticizing himself</a></li>
<li><a href="../389923/index.html">Flight to Mars in 2025, a visit to the ISS and a Tesla truck: that Ilon Musk promised at StartmeupHK 2016</a></li>
<li><a href="../389927/index.html">Review and comparative testing of PC "Elbrus 401 ‚Äë PC". Part Three - Development Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>