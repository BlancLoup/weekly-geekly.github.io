<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix, we connect any piece of hardware with a MIB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The construction of FTTB has begun and the new equipment of the Edge-core manufacturer has appeared. Naturally I wanted to fasten a new iron to Zabbix...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix, we connect any piece of hardware with a MIB</h1><div class="post__text post__text-html js-mediator-article">  The construction of FTTB has begun and the new equipment of the Edge-core manufacturer has appeared.  Naturally I wanted to fasten a new iron to Zabbix.  Earlier, I acted simply - set the snmpwalk on the piece of iron and analyzed the data.  This path is quite long, as the result obtained can be under several megabytes of text and it is rather difficult to find the necessary values.  But there is another way - to use the device MIB.  But Zabbix does not know how to work directly with MIB files.  What to do? <br>  On the forum, Zabiks found a wonderful utility <a href="http://www.zabbix.com/forum/showthread.php%3Ft%3D15088">SNMP Builder for Zabbix</a> .  With its help, you can make a basic device template with its MIB and then handles it to the normal state. <br>  I'll tell you how to do this on the example of equipment Edge-core. <br><br><a name="habracut"></a><br><br><h3>  Utility installation </h3><br>  You can download it from <a href="http://yangho.byethost22.com/wiki/doku.php%3Fid%3Dblog:snmp_builder">the developer blog of</a> this utility or directly <a href="http://github.com/giapnguyen/snmpbuilder">here</a> .  The blog has a brief instruction on its installation and use.  But I will repeat it briefly. <br>  1. Download the archive.  The archive contains a directory and a single snmp_builder.php file. <br>  2. Unpack the archive into the directory with the frontend. <br>  3. Open snmp_builder.php and, if necessary, adjust the path to the location of the mib files. <br> <code>define('MIBS_ALL_PATH', '/home/zabbix/public_html/snmp_builder/mibs:/usr/share/snmp/mibs');</code> <br> <br>  4. Add the Snmp Builder menu item to the ‚ÄúAdministration‚Äù menu of the frontend. <br>  To do this, open include / menu.inc.php and in the area of ‚Äã‚Äã203 lines (in my version it was not 203 lines) change the code to <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#A31515">'label'</font> =&gt;S_NOTIFICATIONS <br> ), <br> array( <font color="#A31515">'url'</font> =&gt; <font color="#A31515">'locales.php'</font> , <br> <font color="#A31515">'label'</font> =&gt;S_LOCALES <br> ), <br> array( <font color="#A31515">'url'</font> =&gt; <font color="#A31515">'snmp_builder.php'</font> , <br> <font color="#A31515">'label'</font> =&gt; <font color="#A31515">'SNMP Builder'</font> <br> ), <br> array( <font color="#A31515">'url'</font> =&gt; <font color="#A31515">'instal.php'</font> , <br> <font color="#A31515">'label'</font> =&gt;S_INSTALLATION, <br> <font color="#A31515">'sub_pages'</font> =&gt;array( <font color="#A31515">'setup.php'</font> , <font color="#A31515">'warning.php'</font> ) <br> ) <br> )</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Creating a template </h3><br><br>  First we look for iron MIB.  The manufacturer, unlike Siemens, did not hide its MiBs.  I freely downloaded them from the official website <a href="http://www.edge-core.ru/download.asp%3Fc%3DC">www.edge-core.ru</a> . <br>  Next, the downloaded mib is placed in any of the directories indicated in paragraph 3. <br>  Open in the Administration / Snmp Builder menu. <br>  We will see a similar picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/930/940/5c3/9309405c3e91251d4740a1bc53226578.jpg"><br><br>  In the <strong>Template</strong> list, select the template in which we will add new items.  I created a new blank template in advance.  In the <strong>MIB</strong> list, select the mib of our device, in the <strong>Server</strong> field enter the device ip, in the <strong>Community</strong> field enter the snmp community string of the device.  If everything is correct, then we get the above picture.  There may be a situation when there are not enough embedded mibs. <br><img src="https://habrastorage.org/getpro/habr/post_images/587/668/a4c/587668a4c73e8814fb9b2261989ceec7.jpg"><br><blockquote>  .Cannot find module (CISCO-SMI): At line 21 in / home / zabbix / public_html / snmp_builder / mibs / CISCO-IP-IF-MIB mib Cannot find module (CISCO-SMI): At line 21 in / home / zabbix /public_html/snmp_builder/mibs/CISCO-IP-IF-MIB.mib </blockquote><br>  As can be seen from the text, there is not enough CISO-SMI mib, as they say, Google in the mouth and we are looking for a not getting MIB, after finding it we place it in the MIB search paths indicated in paragraph 3 above.  We repeat the operation until the errors about the missing mibs disappear. <br><br>  In some cases (in mine as well), you need to adjust the snmp_builder.php code starting from line 315 <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">foreach</font> (glob($path. <font color="#A31515">"/*.mib"</font> ) <font color="#0000ff">as</font> $filename){ <br> <font color="#0000ff">if</font> (preg_match( <font color="#A31515">'/^'</font> .preg_quote($path, <font color="#A31515">'/'</font> ). <font color="#A31515">'\/(.+)\.mib$/'</font> ,$filename,$matches)){ <br> $result=exec( <font color="#A31515">"cat "</font> .$filename. <font color="#A31515">"| grep -i 'DEFINITIONS.*::=.*BEGIN'|awk '{print $1}'"</font> ); <br> $cmbMibs-&gt;addItem($result,$result); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  If everything described above helped, you will see the OID tree <br><img src="https://habrastorage.org/getpro/habr/post_images/f4a/bf0/462/f4abf046211882590b8192a9f84ca2f9.jpg"><br><br>  In this tree, select the desired table and it will appear at the top.  In this table, it is enough to select the desired parameters by clicking on either the field or the column header to select all the parameters of this column.  The selected items and their parameters are displayed at the bottom of the screen.  You can delete them either one by one by clicking on the line with the parameter or all at once by pressing <strong>Clear List</strong> .  If the added elements suit you then click the <strong>Save</strong> button.  After clicking elements from the bottom table will be added as new item to the existing selected template. <br><br>  Repeat this operation until all the necessary elements are selected. <br><br>  I added interface description counters and their status for the selected switch.  The state of the STP protocol was also added (interface state, port number root, device weight and number of topology changes), etc. <br><br>  After adding all the necessary topics to us, it would be very nice to edit them.  By default, the polling interval of all items is 60 seconds, which is clearly unnecessary.  For non-critical data, such as host name, firmware version, interface alias, you can set an interval of 84600 seconds (24 hours). <br>  With counters, the situation is a bit more complicated: an acceptable polling interval for interfaces, in my opinion, is 300 seconds and you need to change the storage format ‚Äúto delta per second‚Äù. <br><br>  With the value ‚ÄúStpPortState‚Äù, it is also necessary to convert the values ‚Äã‚Äãinto a human-readable form. <br>  To begin, let's configure the conversion of digital values ‚Äã‚Äãto text in the Administration / General Options / Conversion of values ‚Äã‚Äãof the code-value pair we pull from the MIB <br><img src="https://habrastorage.org/getpro/habr/post_images/af4/4a6/0fd/af44a60fd4d845670a52007db0f2e80b.jpg"><br><br>  In the setting item we choose <br><img src="https://habrastorage.org/getpro/habr/post_images/965/663/a01/965663a0137229095f0fb8ba6b7754a8.jpg"><br><br>  At a minimum, you need to add a simple ping check to the template. <br><img src="https://habrastorage.org/getpro/habr/post_images/d6f/815/445/d6f815445d63eebe0d397712d0b94e98.jpg"><br><br>  On this check, you need to hang a trigger that will work in the event that the piece of iron is not available for more than 90 seconds. <br><img src="https://habrastorage.org/getpro/habr/post_images/c66/3a8/4b6/c663a84b6328704c7d314d7064f3ad7e.jpg"><br><br>  You can draw graphs of loading interfaces by IfOctets OutOctets counters <br><img src="https://habrastorage.org/getpro/habr/post_images/c0d/e64/6bf/c0de646bf8efa6cc65db17949cfc6dcd.jpg"><br><br>  The following triggers and graphics are made by analogy. <br>  For example, I added triggers that work when the interface loads by more than 80%, when the interface role changes in STP, with a low runtime. <br><br>  I hope that this information will help you add any hardware that has a MIB to the Zabbix monitoring system. <br><br><h6>  PS: This is a continuation of my articles on zabbix: <a href="http://sersad.habrahabr.ru/blog/83460/">article 3</a> , <a href="http://habrahabr.ru/blogs/sysadm/82465/">article 2</a> , <a href="http://habrahabr.ru/blogs/sysadm/81630/">article 1</a> </h6><br></div><p>Source: <a href="https://habr.com/ru/post/85156/">https://habr.com/ru/post/85156/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85144/index.html">Free field game</a></li>
<li><a href="../85148/index.html">The most popular "engines" were the slowest</a></li>
<li><a href="../85150/index.html">Presentation of the innovative service OnLive! in las vegas</a></li>
<li><a href="../85151/index.html">Internet.Money (Ukraine) secretly curtail work</a></li>
<li><a href="../85155/index.html">The Karachay-Balkarian Wikipedia written in six months starts with 900 articles.</a></li>
<li><a href="../85163/index.html">Install additional cooling Zalman</a></li>
<li><a href="../85164/index.html">We write specifications. Part 1. Tools - begin with a simple</a></li>
<li><a href="../85165/index.html">Entertaining task</a></li>
<li><a href="../85166/index.html">Design pattern "Linker" / "Composite"</a></li>
<li><a href="../85167/index.html">Study and understanding of the universe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>