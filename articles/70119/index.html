<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Text at any cost: RTF</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, we continue our research on the subject of obtaining text from various data formats. Not so long ago, we learned how to pull out text from a zip...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Text at any cost: RTF</h1><div class="post__text post__text-html js-mediator-article">  Well, we continue our research on the subject of obtaining text from various data formats.  Not so long ago, we learned how to pull out text from a <a href="http://habrahabr.ru/blogs/php/69417/">zipped-xml-based file</a> (odt and docx), and also, from the beginning of this week, from <a href="http://habrahabr.ru/blogs/php/69568/">pdf</a> .  Today we will continue with the promised rtf. <br><br>  Rich Text Format (also known as rtf), <s>you might think, rather forgotten, though</s> not a very complex format for presenting text data.  Well, relatively simple to get the text, but for its history: from its first version to the current 1.9.1 - it acquired under 300 pages of official documentation and a huge number of add-ons, which will most of all interfere with us when getting plain text.  Let's try to get around them ... <a name="habracut"></a><br><br><h4>  What's inside? </h4><br>  As it happened, let's look inside the rtf file and see what's inside: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/a6b/123/d6f/a6b123d6f60f50cfb7793fe48982f103.gif"><br><br>  What do we see?  <s>I see our favorite poem "Sail".</s>  We see initially text 8-bit data format.  It already pleases - when in the source data the text, it is much easier to understand what is happening.  Now let's see how to read this very data.  For this, I will tell a little theory on the topic. <br><br>  We assume that rtf consists of <i>control words</i> that can be <i>grouped</i> into nested sets.  The control word begins with a backslash ( <code>\</code> ), the group is wrapped in curly braces ( <code>{</code> and <code>}</code> ). <br><br>  The control word consists of a sequence of letters of the English alphabet (from <code>a</code> to <code>z</code> ) and can be completed with a numerical parameter (possibly negative).  Alternatively, a word may contain one non-alphanumeric ascii symbol.  Anything that does not fall under these rules is not part of the control word.  Thus, the sequence of the form <code>\rtf1\ansi\ansicpg1251</code> is easily divided into three words <code>rtf</code> with parameter 1 (major-format version), <code>ansi</code> (current encoding) and <code>ansicpg</code> with parameter 1251 (current code page numbered 1251 - i.e. Windows-1251). <br><br>  Grouped sets define the scope of control words.  Thus, control words described inside curly braces work only inside them and all child subsets.  In order to properly work out what words are taking place now - it is required to maintain a stack of control words.  When opening a curly bracket, create a new array element on the stack, into which you immediately add the data of the previous stack layer; when you close the bracket, delete the topmost layer. <br><br>  It is also worth noting that some control words can be closed by adding the parameter zero, rather than creating a new subgroup.  For example, the following options are equivalent: <code>This is {\b bold} text</code> , <code>This is \b bold \b0 text</code> = <code>This is <b>bold</b> text</code> . <br><br><h4>  Where to get the text? </h4><br>  We got acquainted with the device of a new format for us, now we will ask ourselves, and where to get the text.  Everything is not as difficult as it may seem - the text should be taken where the current sequence is not identified as the control word.  With a couple of exceptions, naturally. <br><br>  Firstly, it is worth noting that the original encoding of the rtf file is ANSI, therefore, without any frills, only English text will be preserved.  We are at least interested in the Russian text, and even better than Unicode, aren't they?  What is true, the truth is - rtf though the old format, but amiss to preserve both of them. <br><br>  So, in rtf'e there is the possibility of using the second half of the ASCII table, that is from 128 and higher.  Given the current encoding (above the control word <code>\ansicpg</code> ), of course.  For this, a sequence of the form <code>\'hh</code> was entered into the RTF, where hh is the binary hex code of the character from the ASCII table. <br><br>  Well, the second, more interesting option is unicode-encoded data.  For them, the concisely short keyword <code>\uABCD</code> with the digital parameter ABCD is included in the format.  ABCD in this case is the unicode character code in the decimal number system.  Everything is simple again, as you can see. <br><br>  Simple, but not so.  In rtf, there is another keyword <code>\ucN</code> , which is closely related to Unicode.  The fact is that the RTF format very zealously maintains compatibility with old devices on which you may have to open this file.  As an option, a similar device (well, for example, a computer with Windows 3.11 :) will not be able to read Unicode, what should it do?  To do this, after each unicode character encrypted with the <code>\u</code> keyword, you can specify from zero to several characters that should be displayed if the rtf-viewer is unable to display or parse the current data (according to the documentation, if the viewer cannot display correctly data, he should skip them). <br><br>  In this regard, most modern editors, after a unicode-control word, put a question symbol as a sign that needs to be shown instead of the current character.  But options are also possible, for example: <code>Lab\u915GValue</code> .  Let us ask ourselves - how many characters you want to display, if you can not show Unicode.  Again, everything is not very difficult - the above keyword <code>\ucN</code> as a parameter N just provides this value.  Those.  Before the Unicode data, there is something like <code>\uc1</code> that will tell us to skip one character after unicode. <br><br><h4>  Let's read! </h4><br>  It seems that the data we have accumulated will be enough to read our first rtf-files.  Go: <br><br><blockquote><ol><li>  <font color="#000000">function</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ s</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ failAt</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#0000ff">"*"</font> <font color="#339933">,</font> <font color="#0000ff">"fonttbl"</font> <font color="#339933">,</font> <font color="#0000ff">"colortbl"</font> <font color="#339933">,</font> <font color="#0000ff">"datastore"</font> <font color="#339933">,</font> <font color="#0000ff">"themedata"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">for</font> <font color="#009900">(</font> <font color="#000088">$ i</font> <font color="#339933">=</font> <font color="#cc66cc">0</font> <font color="#339933">;</font> <font color="#000088">$ i</font> <font color="#339933">&lt;</font> <font color="#990000">count</font> <font color="#009900">(</font> <font color="#000088">$ failAt</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$ i</font> <font color="#339933">++</font> <font color="#009900">)</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">!</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ s</font> <font color="#009900">[</font> <font color="#000088">$ failAt</font> <font color="#009900">[</font> <font color="#000088">$ i</font> <font color="#009900">]</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#b1b100">return</font> <font color="#009900">false</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">return</font> <font color="#009900">true</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#000000">function</font> rtf2text <font color="#009900">(</font> <font color="#000088">$ filename</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ text</font> <font color="#339933">=</font> <font color="#990000">file_get_contents</font> <font color="#009900">(</font> <font color="#000088">$ filename</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(!</font> <font color="#990000">strlen</font> <font color="#009900">(</font> <font color="#000088">$ text</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#b1b100">return</font> <font color="#0000ff">""</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ document</font> <font color="#339933">=</font> <font color="#0000ff">""</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ stack</font> <font color="#339933">=</font> <font color="#990000">array</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ j</font> <font color="#339933">=</font> <font color="#339933">-</font> <font color="#cc66cc">1</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">for</font> <font color="#009900">(</font> <font color="#000088">$ i</font> <font color="#339933">=</font> <font color="#cc66cc">0</font> <font color="#339933">;</font> <font color="#000088">$ i</font> <font color="#339933">&lt;</font> <font color="#990000">strlen</font> <font color="#009900">(</font> <font color="#000088">$ text</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$ i</font> <font color="#339933">++</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ c</font> <font color="#339933">=</font> <font color="#000088">$ text</font> <font color="#009900">[</font> <font color="#000088">$ i</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">switch</font> <font color="#009900">(</font> <font color="#000088">$ c</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">" <font color="#000099">\\</font> "</font> <font color="#339933">:</font> </li><li>  <font color="#000088">$ nc</font> <font color="#339933">=</font> <font color="#000088">$ text</font> <font color="#009900">[</font> <font color="#000088">$ i</font> <font color="#339933">+</font> <font color="#cc66cc">1</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">==</font> <font color="#0000ff">'\\'</font> <font color="#339933">&amp;&amp;</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#000088">$ document</font> <font color="#339933">. =</font> <font color="#0000ff">'\\'</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">==</font> <font color="#0000ff">'~'</font> <font color="#339933">&amp;&amp;</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#000088">$ document</font> <font color="#339933">. =</font> <font color="#0000ff">''</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">==</font> <font color="#0000ff">'_'</font> <font color="#339933">&amp;&amp;</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#000088">$ document</font> <font color="#339933">. =</font> <font color="#0000ff">'-'</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">==</font> <font color="#0000ff">'*'</font> <font color="#009900">)</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#0000ff">"*"</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#009900">true</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">==</font> <font color="#0000ff">"'"</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ hex</font> <font color="#339933">=</font> <font color="#990000">substr</font> <font color="#009900">(</font> <font color="#000088">$ text</font> <font color="#339933">,</font> <font color="#000088">$ i</font> <font color="#339933">+</font> <font color="#cc66cc">2</font> <font color="#339933">,</font> <font color="#cc66cc">2</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ document</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; #"</font> <font color="#339933">.</font> <font color="#990000">hexdec</font> <font color="#009900">(</font> <font color="#000088">$ hex</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">";"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ i</font> <font color="#339933">+ =</font> <font color="#cc66cc">2</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">&gt; =</font> <font color="#0000ff">'a'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ nc</font> <font color="#339933">&lt;=</font> <font color="#0000ff">'z'</font> <font color="#339933">||</font> <font color="#000088">$ nc</font> <font color="#339933">&gt; =</font> <font color="#0000ff">'A'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ nc</font> <font color="#339933">&lt;=</font> <font color="#0000ff">'Z'</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ word</font> <font color="#339933">=</font> <font color="#0000ff">""</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ param</font> <font color="#339933">=</font> <font color="#009900">null</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">for</font> <font color="#009900">(</font> <font color="#000088">$ k</font> <font color="#339933">=</font> <font color="#000088">$ i</font> <font color="#339933">+</font> <font color="#cc66cc">1</font> <font color="#339933">,</font> <font color="#000088">$ m</font> <font color="#339933">=</font> <font color="#cc66cc">0</font> <font color="#339933">;</font> <font color="#000088">$ k</font> <font color="#339933">&lt;</font> <font color="#990000">strlen</font> <font color="#009900">(</font> <font color="#000088">$ text</font> <font color="#009900">)</font> <font color="#339933">;</font> <font color="#000088">$ k</font> <font color="#339933">++,</font> <font color="#000088">$ m</font> <font color="#339933">++</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000088">$ nc</font> <font color="#339933">=</font> <font color="#000088">$ text</font> <font color="#009900">[</font> <font color="#000088">$ k</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">&gt; =</font> <font color="#0000ff">'a'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ nc</font> <font color="#339933">&lt;=</font> <font color="#0000ff">'z'</font> <font color="#339933">||</font> <font color="#000088">$ nc</font> <font color="#339933">&gt; =</font> <font color="#0000ff">'A'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ nc</font> <font color="#339933">&lt;=</font> <font color="#0000ff">'Z'</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ param</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ word</font> <font color="#339933">. =</font> <font color="#000088">$ nc</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">else</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">&gt; =</font> <font color="#0000ff">'0'</font> <font color="#339933">&amp;&amp;</font> <font color="#000088">$ nc</font> <font color="#339933">&lt;=</font> <font color="#0000ff">'9'</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ param</font> <font color="#339933">. =</font> <font color="#000088">$ nc</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">elseif</font> <font color="#009900">(</font> <font color="#000088">$ nc</font> <font color="#339933">==</font> <font color="#0000ff">'-'</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ param</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ param</font> <font color="#339933">. =</font> <font color="#000088">$ nc</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">else</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#b1b100">else</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#000088">$ i</font> <font color="#339933">+ =</font> <font color="#000088">$ m</font> <font color="#339933">-</font> <font color="#cc66cc">1</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ toText</font> <font color="#339933">=</font> <font color="#0000ff">""</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">switch</font> <font color="#009900">(</font> <font color="#990000">strtolower</font> <font color="#009900">(</font> <font color="#000088">$ word</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"u"</font> <font color="#339933">:</font> </li><li>  <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; # x"</font> <font color="#339933">.</font> <font color="#990000">dechex</font> <font color="#009900">(</font> <font color="#000088">$ param</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#0000ff">";"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ ucDelta</font> <font color="#339933">=</font> <font color="#339933">@</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#0000ff">"uc"</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000088">$ ucDelta</font> <font color="#339933">&gt;</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ i</font> <font color="#339933">+ =</font> <font color="#000088">$ ucDelta</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"par"</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">"page"</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">"column"</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">"line"</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">"lbr"</font> <font color="#339933">:</font> </li><li>  <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#0000ff">" <font color="#000099">\ n</font> "</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"emspace"</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">"enspace"</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">"qmspace"</font> <font color="#339933">:</font> </li><li>  <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#0000ff">""</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"tab"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#0000ff">" <font color="#000099">\ t</font> "</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"chdate"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">date</font> <font color="#009900">(</font> <font color="#0000ff">"mdY"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"chdpl"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">date</font> <font color="#009900">(</font> <font color="#0000ff">"l, j F Y"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"chdpa"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">date</font> <font color="#009900">(</font> <font color="#0000ff">"D, j M Y"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"chtime"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">date</font> <font color="#009900">(</font> <font color="#0000ff">"H: i: s"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"emdash"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; mdash;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"endash"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; ndash;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"bullet"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; # 149;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"lquote"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; lsquo;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"rquote"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; rsquo;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"ldblquote"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; laquo;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"rdblquote"</font> <font color="#339933">:</font> <font color="#000088">$ toText</font> <font color="#339933">. =</font> <font color="#990000">html_entity_decode</font> <font color="#009900">(</font> <font color="#0000ff">"&amp; raquo;"</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">default</font> <font color="#339933">:</font> </li><li>  <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">[</font> <font color="#990000">strtolower</font> <font color="#009900">(</font> <font color="#000088">$ word</font> <font color="#009900">)</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#990000">empty</font> <font color="#009900">(</font> <font color="#000088">$ param</font> <font color="#009900">)</font> ?  <font color="#009900">true</font> <font color="#339933">:</font> <font color="#000088">$ param</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ document</font> <font color="#339933">. =</font> <font color="#000088">$ toText</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#000088">$ i</font> <font color="#339933">++;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"{"</font> <font color="#339933">:</font> </li><li>  <font color="#990000">array_push</font> <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#339933">,</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#339933">++</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">"}"</font> <font color="#339933">:</font> </li><li>  <font color="#990000">array_pop</font> <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000088">$ j</font> <font color="#339933">-;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">case</font> <font color="#0000ff">'\ 0'</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">'\ r'</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">'\ f'</font> <font color="#339933">:</font> <font color="#b1b100">case</font> <font color="#0000ff">'\ n'</font> <font color="#339933">:</font> <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">default</font> <font color="#339933">:</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> rtf_isPlainText <font color="#009900">(</font> <font color="#000088">$ stack</font> <font color="#009900">[</font> <font color="#000088">$ j</font> <font color="#009900">]</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#000088">$ document</font> <font color="#339933">. =</font> <font color="#000088">$ c</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">break</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">return</font> <font color="#000088">$ document</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote>  You can get the code with comments on <a href="https://github.com/rembish/TextAtAnyCost">GitHub</a> . <br><br><h4>  Conclusion </h4><br>  What do we have in the end?  This code will do right with most rtf files, but there are several ways to improve it.  Firstly, it is worth adding additional clipping to non-text data - I only have to cut off fonts, color palette, theme, binary data, as well as everything marked as ‚Äúdon‚Äôt read me if you can't‚Äù ( <code>\*</code> ).  Secondly, it is worthwhile to parse the encoding and code page in order to more accurately display keywords like <code>\'hh</code> . <br><br>  What's next?  Further I would like to touch on the formats of e-books, such as fb2, epub and the like.  In this regard, I would like to ask for help from the readers: first, what other formats of e-books are worth seeing, and secondly, where you can find more files of the formats you specified.  Thank you in advance :) <br><br>  <b>References:</b> <ul><li>  <a href="http://latex2rtf.sourceforge.net/RTF-Spec-1.0.txt">latex2rtf.sourceforge.net/RTF-Spec-1.0.txt</a> </li><li>  <a href="http://www.microsoft.com/downloads/details.aspx%3FFamilyId%3DDD422B8D-FF06-4207-B476-6B5396A18A2B%26displaylang%3Den">www.microsoft.com/downloads/details.aspx?FamilyId=DD422B8D-FF06-4207-B476-6B5396A18A2B&amp;displaylang=en</a> </li><li>  <a href="http://habrahabr.ru/blogs/php/69568/">Text at any cost: PDF</a> </li><li>  <a href="http://habrahabr.ru/blogs/php/69417/">Text at any cost: DOCX and ODT</a> </li><li>  <a href="http://habrahabr.ru/blogs/php/72745/">Text at any cost: WCBFF and DOC</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/70119/">https://habr.com/ru/post/70119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70111/index.html">Ice. First piece of ice</a></li>
<li><a href="../70113/index.html">Get caught WiFi is big and small</a></li>
<li><a href="../70114/index.html">Augmented Reality</a></li>
<li><a href="../70117/index.html">3 Things That Annoy Me in American Style Letters</a></li>
<li><a href="../70118/index.html">Big and strong hard-rider</a></li>
<li><a href="../70121/index.html">Use SQL Server Dynamic Management Views and Functions (DMV and DMF)</a></li>
<li><a href="../70123/index.html">Cross-platform game on MonoTouch</a></li>
<li><a href="../70125/index.html">Sheraton hotels are already using Windows 7 and multitouch</a></li>
<li><a href="../70128/index.html">Radio without batteries</a></li>
<li><a href="../70134/index.html">VIA EPIA-P720, Pico-ITX format motherboard, loses 1080p without straining too much</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>