<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LockerGoga: what exactly happened with Norsk Hydro</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Photos, source - www.msspalert.com 


 On the night from Monday to Tuesday (at about 23:00 UTC on 03/18/2019), Norsk Hydro experts noticed a malfuncti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LockerGoga: what exactly happened with Norsk Hydro</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/av/ct/qp/avctqp5o4hco2o_xndkw0drfgpu.jpeg"><br><br>  <em>Photos, source - <a href="">www.msspalert.com</a></em> </p><br><p>  On the night from Monday to Tuesday (at about 23:00 UTC on 03/18/2019), <a href="https://ru.wikipedia.org/wiki/Norsk_Hydro">Norsk Hydro</a> experts noticed a malfunction in the network and a number of systems.  It soon became clear that the failures were caused by the massive infection of the systems by the cryptographer, which very quickly spread through the infrastructure objects.  After identifying the threat, the security service began the isolation process, but the malware had spread so deeply across the infrastructure that it had to transfer part of the production to manual control ("rollback" to the procedures adopted before the computerization of the production processes).  The investigation into the attack required the involvement of local authorities and law enforcement agencies (National Security Authority / NorCERT, Norwegian Police Security Service, National Criminal Investigation Service), as well as a number of commercial companies.  Restoration of the infrastructure is not yet completed, and individual production (for example, extrusion of aluminum profiles) is still operating at half the capacity. </p><br><p>  Despite the fact that the investigation of the incident is not over and it is difficult to predict the time of its completion, according to the facts, you can understand the mechanism of action of the attackers and analyze what Norsk Hydro did right and what did not, and how it was still possible to improve the defense. </p><a name="habracut"></a><br><h2 id="sostoyanie-kompanii-posle-ataki">  State of the company after the attack </h2><br><p>  Norsk Hydro is a fairly large company: its facilities are located in 40 countries of the world, and the total number of employees exceeds 35,000 people.  The volume of information systems and computers, which came under attack, is also large.  From information from representatives of the company, voiced at a joint <a href="http://webtv.hegnar.no/presentation.php%3FwebcastId%3D97819442">press conference</a> with the authorities, and daily news on the investigation and recovery on the website (updated on 03/22/2019), it follows that: </p><br><ul><li>  no local incidents at work or human injuries; </li><li>  as a result, all the plants were successfully isolated, the processes were transferred to manual control, where it is possible (in aluminum extrusion factories, it was possible to adjust the working capacity by only 50%); </li><li>  mobile devices and some PCs function normally, cloud mail functions correctly; </li><li>  there is no complete picture of the number of failed PCs and servers, varying degrees of destruction of infrastructure facilities; </li><li>  there is no access to systems containing data on orders, but there is the necessary amount of information that is required for the production of orders; </li><li>  there are no assumptions about intruders; the most likely hypothesis about the malware used for the attack is LockerGoga encryption; </li><li>  The company has a well-established backup process, and rolling back to previously made backups is the main recovery strategy; </li><li>  the company has cyber risk insurance that they plan to use to cover the damage from the attack. </li></ul><br><p>  It is important to note how Norsk Hydro behaved during the attack.  The company acted as openly as possible: at the time of problems with the main site, it launched a temporary one, informed the public through an account on Facebook, notified representatives of the stock market about its situation and held a press conference on the first day of the attack. </p><br><p><img src="https://habrastorage.org/webt/5u/87/hf/5u87hftny53by1ywyav3bzxjcw8.jpeg"><br><br>  <em>Warning for Norsk Hydro employees that they should not connect any devices to the network due to cyber attacks.</em>  <em>Photo, source - <a href="https://www.reuters.com/article/us-norsk-hydro-cyber/aluminum-maker-hydro-battles-to-contain-ransomware-attack-idUSKCN1R00NJ">www.reuters.com</a></em> </p><br><h2 id="chto-predstavlyaet-soboy-vredonos-lockergoga">  What is LockerGoga Malware? </h2><br><p>  About attacks using LockerGoga for the first time became known to the general public at the end of January 2019. Then the consulting company Altran suffered from it, but the technical details of the attack were published very little.  Norsk Hydro was attacked with the help of several versions of the malware, which in their mechanics are similar (with the exception of certain features) to the samples used in the January attack. </p><br><p>  Malware executables are signed by the same certificate issued by Sectigo (formerly Comodo CA) as the samples used in the attack on Altran (probably a fake company <a href="https://uk.globaldatabase.com/company/alisa-ltd">ALISA LTD</a> with 2 owners and 2 shares of 1 GBP each).  At the moment the certificate has been revoked, however during the attack it was valid. </p><br><p>  Apparently, each malware sample was generated uniquely under the company under attack, which is noted in the sample analysis by <a href="https://twitter.com/GossiTheDog/status/1108423887602282498">researchers</a> . </p><br><p>  All identified samples do not have the ability to self-replicate (unlike WannaCry and NotPetya) and must be run on the attacked node.  The most likely hypothesis of the spread of malware over the Norsk Hydro network is the use of AD group policies to create tasks or services with malicious content.  With high probability, this means that at the stage of penetration, another VPO was used, with the help of which it was possible to obtain administrative privileges in the domain.  One of the possible mechanisms may be phishing followed by theft of passwords or Kerberos tickets from the memory of a compromised host. </p><br><p> During the infection process, the executable file of the malware is copied to the <code>%TEMP%</code> directory and runs with elevated privileges.  After that, it launches a large number of child processes, distributing file encryption to them according to the collected list.  Judging by the behavior of the available samples, not only files with extensions of office documents, databases and other work files ( <code>doc, dot, wbk, docx, dotx, docb, xlm, xlsx, xltx, xlsb, xlw, ppt, pot, pps, pptx, potx, ppsx, sldx, pdf</code> ), but also other files on the C: \ drive (for example, dll libraries) with variations depending on the sample.  The child process <a href="https://twitter.com/_qaz_qaz/status/1108441356836503553">generates</a> a key / iv pair using the RNG, then uses the AES algorithm to rewrite the file with encrypted data, encrypts the key / iv pair with the public key, adds the encrypted key pair to the file, and renames the file, adding <code>.LOCKED</code> to the extension.  This behavior allows more utilization of the processor of the infected computer with encryption tasks and performing the entire process faster. </p><br><p>  The parent process also creates a text file on the desktop requesting redemption (README_LOCKED.txt with variations in the name), changes the passwords of local users (this behavior probably depends on the version of the sample, i.e., only local administrators can encrypt the password) and forced exit from user session.  In some versions, the ability to disable the network interface of the computer. </p><br><p>  Thus, in some cases, the infected PC may simply not boot (if critical components of the OS kernel are encrypted) or the user will not be able to log in to view the ransom requirements, which is more typical for wipers. </p><br><p>  The ransom demand (an example is shown below) does not contain the addresses of the wallets or the ransom amounts, but only postal addresses for interacting with intruders.  In different versions of malicious samples, mailing addresses are different in the request. </p><br><pre> <code class="plaintext hljs">Greetings! There was a significant flaw in the security system of your company. You should be thankful that the flaw was exploited by serious people and not some rookies. They would have damaged all of your data by mistake or for fun. Your files are encrypted with the strongest military algorithms RSA4096 and AES-256. Without our special decoder it is impossible to restore the data. Attempts to restore your data with third party software as Photorec, RannohDecryptor etc. will lead to irreversible destruction of your data. To confirm our honest intentions. Send us 2-3 different random files and you will get them decrypted. It can be from different computers on your network to be sure that our decoder decrypts everything. Sample files we unlock for free (files should not be related to any kind of backups). We exclusively have decryption software for your situation DO NOT RESET OR SHUTDOWN ‚Äì files may be damaged. DO NOT RENAME the encrypted files. DO NOT MOVE the encrypted files. This may lead to the impossibility of recovery of the certain files. To get information on the price of the decoder contact us at: AbbsChevis@protonmail.com IjuqodiSunovib98@o2.pl The payment has to be made in Bitcoins. The final price depends on how fast you contact us. As soon as we receive the payment you will get the decryption tool and instructions on how to improve your systems security</code> </pre> <br><p>  The malware does not use any C &amp; C infrastructure, the only communication channel with the attacker is email.  Also, the malware does not try to hide the traces of its activity.  In connection with a similar implementation of the ransom mechanism, as well as the actual disabling of encrypted PCs, it can be assumed that the purpose of LockerGoga is similar to the WannaCry and NotPetya malware.  However, this or not, at the moment it is impossible to say. </p><br><h2 id="chto-bylo-sdelano-pravilno-a-chto-net">  What was done right and what didn't </h2><br><p>  After disclosing information about high-profile cyber attacks, it is often possible to see articles and various materials telling about what the victims of the attack did wrong.  In the case of Norsk Hydro, the situation is different, the company did not show noticeable failures in the organization of infrastructure (production did not stop) and is well in the process of responding to the attack, namely: </p><br><ul><li>  The company is as open as possible with investors and the public to inform about the progress in eliminating the attack.  An indirect indicator of a positive reaction may be the stock price on the stock exchange: despite a slight drop (3.6%) of shares on March 23, there are prerequisites for their further stable growth. </li><li>  It was possible to quickly isolate production facilities in order to ensure that production on them was not affected. </li><li>  There are proven processes that allow production facilities to operate in manual mode (at least most of the production). </li><li>  A backup process has been established, which will greatly facilitate the restoration of infrastructure nodes after the incident. </li><li>  There are backup communication channels (cloud mail) that allow employees to interact even in case of problems on the basic infrastructure. </li><li>  The company uses cyber risk insurance that will help repair some of the damage from the attack. </li></ul><br><p>  At the same time, Norsk Hydro unnecessarily relied on the antivirus solution installed on it.  According to researchers, some of the malware samples were not detected by <a href="https://twitter.com/malwrhunterteam/status/1104082562216062978">any</a> antivirus solution at the beginning of March; at the time of the attack, the number of solutions that identified samples as malicious was also small.  In addition, the certification authority revoked the malware certificate too late - after the attack began.  Also, for some objects, the segmentation of the industrial infrastructure from the office infrastructure was probably not adequately performed. </p><br><p>  To identify the attack in the early stages would help constant monitoring: </p><br><ul><li>  privileged account activity; </li><li>  group policy changes; </li><li>  creating new services and tasks of the scheduler; </li><li>  password change events for privileged accounts, incl.  and local administrators; </li><li>  activities similar to Pass-the-Hash and Pass-the-Ticket attacks; </li></ul><br><p>  Such monitoring should be carried out by an internal monitoring service (using SIEM-like solutions and behavioral analysis systems) and / or an external SOC / CSIRT. </p><br><p>  After all, early detection will help to save significant funds to eliminate the effects of the attack. </p><br><h1 id="upd-26032019">  Upd.  03/26/2019 </h1><br><p>  Researchers from the company Alert Logic <a href="https://blog.alertlogic.com/halting-the-lockergoga-ransomware/">found a</a> bug in the malware.  The attackers did not anticipate exception handling in the event that when collecting a list of files for encryption, the malware stumbles upon a link (* .lnk) that has errors (incorrect network path or no association with the RPC endpoint, according to the study).  This can happen when collecting files from the folder "Recent Items".  In this case, the main process is terminated by the operating system and it doesn't even get to encryption.  Probably, this can partly explain the uneven degree of damage to the company's nodes. </p><br><h1 id="ssylki">  Links </h1><br><ol><li>  <a href="https://www.bleepingcomputer.com/news/security/new-lockergoga-ransomware-allegedly-used-in-altran-attack/">https://www.bleepingcomputer.com/news/security/new-lockergoga-ransomware-allegedly-used-in-altran-attack/</a> </li><li>  <a href="https://www.nrk.no/norge/skreddersydd-dobbeltangrep-mot-hydro-1.14480202">https://www.nrk.no/norge/skreddersydd-dobbeltangrep-mot-hydro-1.14480202</a> </li><li>  <a href="http://webtv.hegnar.no/presentation.php%3FwebcastId%3D97819442">http://webtv.hegnar.no/presentation.php?webcastId=97819442</a> </li><li>  <a href="https://www.hydro.com/">https://www.hydro.com/</a> </li><li>  <a href="https://twitter.com/GossiTheDog/status/1107986706089811968">https://twitter.com/GossiTheDog/status/1107986706089811968</a> </li><li>  <a href="https://twitter.com/malwrhunterteam/status/1104082562216062978">https://twitter.com/malwrhunterteam/status/1104082562216062978</a> </li><li>  <a href="https://twitter.com/_qaz_qaz/status/1108441356836503553">https://twitter.com/_qaz_qaz/status/1108441356836503553</a> </li><li>  <a href="https://www.bleepingcomputer.com/news/security/lockergoga-ransomware-sends-norsk-hydro-into-manual-mode/">https://www.bleepingcomputer.com/news/security/lockergoga-ransomware-sends-norsk-hydro-into-manual-mode/</a> </li><li>  <a href="https://www.bloomberg.com/news/articles/2019-03-19/hydro-says-victim-of-extensive-cyber-attack-impacting-operations-jtfgz6td">https://www.bloomberg.com/news/articles/2019-03-19/hydro-says-victim-of-extensive-cyber-attack-impacting-operations-jtfgz6td</a> </li><li>  <a href="https://blog.talosintelligence.com/2019/03/lockergoga.html">https://blog.talosintelligence.com/2019/03/lockergoga.html</a> </li><li>  <a href="https://www.nozominetworks.com/blog/breaking-research-lockergoga-ransomware-impacts-norsk-hydro/">https://www.nozominetworks.com/blog/breaking-research-lockergoga-ransomware-impacts-norsk-hydro/</a> </li><li>  <a href="https://www.joesecurity.org/blog/2995389471535835488">https://www.joese.org/blog/2995389471535835488</a> </li><li>  <a href="https://doublepulsar.com/how-lockergoga-took-down-hydro-ransomware-used-in-targeted-attacks-aimed-at-big-business-c666551f5880">https://doublepulsar.com/how-lockergoga-took-down-hydro-ransomware-used-in-targeted-attacks-aimed-at-big-business-c666551f5880</a> </li><li>  <a href="https://securityaffairs.co/wordpress/82684/malware/lockergoga-ransomware-spreads.html">https://securityaffairs.co/wordpress/82684/malware/lockergoga-ransomware-spreads.html</a> </li><li>  <a href="https://www.bbc.com/news/technology-47624207">https://www.bbc.com/news/technology-47624207</a> </li><li>  <a href="https://www.bbc.com/news/technology-47624207">https://uk.globaldatabase.com/company/alisa-ltd</a> </li><li>  <a href="https://blog.alertlogic.com/halting-the-lockergoga-ransomware/">https://blog.alertlogic.com/halting-the-lockergoga-ransomware/</a> </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/445034/">https://habr.com/ru/post/445034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445022/index.html">How I made friends with the PlayStation 2 and the PlayStation Portable (spoiler - combined into one emulator)</a></li>
<li><a href="../445024/index.html">Turn DSLogic Basic into DSLogic Plus</a></li>
<li><a href="../445026/index.html">Model of atom to molecule</a></li>
<li><a href="../445028/index.html">Smart Stethoscope - Startup Project from ITMO University Accelerator</a></li>
<li><a href="../445030/index.html">You may not need Kubernetes</a></li>
<li><a href="../445036/index.html">What was the first iPhone?</a></li>
<li><a href="../445038/index.html">Leaks of secret information found in 100,000 repositories on GitHub</a></li>
<li><a href="../445040/index.html">We build models, ‚Äúsell‚Äù management knowledge management and correct the survivor‚Äôs mistake.</a></li>
<li><a href="../445042/index.html">Delphic programmer success story from Ulan-Ude</a></li>
<li><a href="../445044/index.html">Go application in production systems. Validators</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>