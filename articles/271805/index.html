<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jira Automation on Groovy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In large organizations, it is often necessary to fasten any additional functionality to JIRA that is not in the standard delivery: automation, integra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jira Automation on Groovy</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/82f/e4e/cae/82fe4ecae31342d8805e7cec2f377031.gif" alt="image"></div><br>  In large organizations, it is often necessary to fasten any additional functionality to JIRA that is not in the standard delivery: automation, integration with other systems, and other customizations.  Often this is solved by third-party plug-ins, in the <b>Atlassian Market a</b> huge amount of them.  But what if there is no suitable plug-in?  Obviously write your own.  Another option for the extension is plugins that add the ability to use your own scripts in JIRA: <a href="https://marketplace.atlassian.com/plugins/com.onresolve.jira.groovy.groovyrunner">ScriptRunner</a> (Groovy), <a href="">Jira Scripting Suite</a> (SIL), <a href="https://marketplace.atlassian.com/plugins/com.keplerrominfo.jira.plugins.jjupin">JJupin</a> (Jython). <br><br>  In this article I will tell about the most popular and functional of them - <a href="https://scriptrunner.adaptavist.com/">ScriptRunner</a> from <a href="http://www.adaptavist.com/">Adaptavist</a> . <a name="habracut"></a><br><br>  ScriptRunner allows you to write your own Groovy scripts that can directly use the JIRA Java API.  Those.  you have almost the same functionality as when creating your plug-ins.  Only writing extensions on Groovy is much nicer: no messing around with xml-configs, maven-pain and dependency problems, just code.  JIRA has a fairly rich and well documented Java API.  Unlike the Rest API, the Java API can do everything that can be done through a web interface and even more.  <a href="http://www.groovy-lang.org/">Groovy</a> is a scripting language with a Java-like syntax.  It is compiled into Java bytecode and executed by the JVM, works with Java libraries as native, supports both static and dynamic typing and <a href="http://www.groovy-lang.org/closures.html">closures</a> .  Unfortunately, ScriptRrunner for the 4th version has become paid, keep this in mind. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  ScriptRunner </h3><br>  Starting with the third version of the plugin, all scripts must be located in one specific directory ( <i>% scriptroot%</i> ).  By default, this is the <i>&lt;jira-app-dir&gt; / scripts</i> directory.  You can change it by editing the <i>-Dplugin.script.roots</i> parameter in jvm args, like this: <pre><code class="bash hljs">-Dplugin.script.roots=<span class="hljs-string"><span class="hljs-string">"/home/jira/jira-data/scripts/"</span></span></code> </pre>  Learn more about how to add or change parameters in jvm args <a href="https://confluence.atlassian.com/jira/setting-properties-and-options-on-startup-120007.html">here</a> . <br><br>  In ScriptRunner there are several basic types of custom scripts, which differ in purpose and application: <br><br>  <b>PostFunction</b> .  It is executed after transferring the issue to another status.  Binds to a specific transition. <br>  <b>Validator</b> .  Validation of data when trying to convert the issue to another status.  Allows or denies status transfer.  Binds to a specific transition. <br>  <b>Conditions</b> .  A Boolean expression that determines whether status translation can be made.  If not, hide the button to change the status.  Binds to a specific transition. <br>  <b>Listener</b> .  Responds to IssueEvent events.  For example, to create or update issue.  You can specify which events to respond to and in which projects. <br>  <b>JQL Functions</b> .  JQL function for search issue. <br><br>  Any script can be executed directly in the browser window, through the admin panel, which is very convenient for testing small scripts.  Let's write the first script and run it.  Install the plugin on your JIRA test instance, if you have not already done so.  Go to <b>Administration&gt; Add-ons&gt; ScriptRunner&gt; Script Console</b> .  As you can see, the Run button unambiguously hints that the code in the console can be run directly from here.  Praise to the gods, in the third version the console window received syntax highlighting and it became a little more difficult to make a mistake!  Pay attention to the <b>File / Script</b> tabs on the right: you can execute the script by pointing to it with respect to <i>% scriptroot%</i> .  Paste this code into the window, replacing the issue key with the actual one in your instance: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.component.ComponentAccessor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.IssueManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.MutableIssue IssueManager issueManager = ComponentAccessor.getIssueManager() <span class="hljs-comment"><span class="hljs-comment">//  PRJ-1    issue. MutableIssue curIssue = issueManager.getIssueObject("PRJ-1") String result = curIssue.key + ": " + curIssue.summary</span></span></code> </pre><br>  As a result of the script, the contents of the last variable in the script are displayed, in this case it is the result <br><img src="https://habrastorage.org/files/420/48e/b5e/42048eb5ea55473baa1cabcdfc2d8ee6.gif"><br><br><h3>  Setting up the working environment </h3><br>  You can skip this section if you are going to write only very small scripts.  In other cases, of course, it will be more convenient to conduct development in the IDE with code completion, debug mode, version control system, and other goodies.  As an IDE, IntelliJ IDEA will suit us, it supports Groovy right out of the box.  So, we need to install <a href="https://www.jetbrains.com/idea/download">IntelliJ IDEA</a> (suitable for Community Edition), <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java SDK</a> and <a href="http://www.groovy-lang.org/download.html">Groovy</a> .  Install IDEA and create a new project (File&gt; New Project).  Select the Groovy project, specify the path to the JDK and to Groovy. <br><div class="spoiler">  <b class="spoiler_title">New project</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/fd2/690/ae9/fd2690ae9d5a4d349ed0064d5867c6da.gif"></div></div><br>  Now we need to connect the JIRA libraries so that code completion is available.  The easiest option is to copy the <i>classes</i> and <i>lib</i> folders from <i>&lt;jira-app-dir&gt; / atlassian-jira / WEB-INF to yourself</i> .  The best option is to download the source from the official site.  Open the project settings: <b>File&gt; Project Structure&gt; Project Settings&gt; Libraries</b> .  Add the <i>classes</i> and <i>lib</i> folders to the project: <br><div class="spoiler">  <b class="spoiler_title">Project Libraries</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/09e/2b6/cf7/09e2b6cf7e7849c7b66278dd093013dd.gif"></div></div><br>  Now let's configure remote debugging.  To enable debug mode in JIRA, you need to add a parameter to jvm args: <pre> <code class="bash hljs">-agentlib:jdwp=transport=dt_socket,server=y,<span class="hljs-built_in"><span class="hljs-built_in">suspend</span></span>=n,address=8000</code> </pre>  After that, open the configuration <b>Run&gt; Edit Configurations</b> , add a new Remote Config.  On the Configuration tab, enter the name of the configuration, for example, ‚ÄúJira Debug‚Äù and specify the host where your JIRA is located.  Naturally, the port number for debugging should be the same as you specified it in the address parameter in jvm args. <br><br>  We are checking.  Create a script in the root of your project.  Copy this script to the JIRA instance in the <i>% scriptroot%</i> folder.  Start debugging: click Run&gt; Debug 'Jira Debug'.  You will see the message: <i>Connected to the target VM, address:% your_host%, transport: 'socket'.</i>  In the Script Console, enter the name of your script and click Run.  You should see something like this: <br><div class="spoiler">  <b class="spoiler_title">Groovy debugging</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1c2/3f5/b8f/1c23f5b8f59944108de08826dcf857c4.gif"></div></div><br>  Keep in mind that JIRA will not respond until you release debugging, i.e.  you definitely need a separate instance for debugging.  By the way, in IDEA you can use the Groovy Console ( <b>Tools&gt; Groovy Console</b> ) to check the Groovy code. <br><br><h3>  Scripts </h3><br>  Components with corresponding names are used to work with entities in the JIRA API, here are some of them: IssueManager, ProjectManager, UserManager, SearchService, CustomFieldManager, CommentManager.  Their copies can be obtained through ComponentAccessor, below you will see it in the examples.  IDEA will help you in finding the right method with code completion, and <a href="https://developer.atlassian.com/jiradev/jira-apis">JIRA Java API documentation</a> with a description.  You can find out the ID of an entity through the interface of JIRA itself, just find links to edit or view it, in most cases the url will contain the ID you need.  Remarkably, there are a lot of examples of working with JIRA in Java online and almost always this code will work on Groovy without changes. <br><br>  Perhaps the most common task in scripts is to change the issue.  Let's write a code that changes the summary and some custom field. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.crowd.embedded.api.User <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.ComponentManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.component.ComponentAccessor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.event.type.EventDispatchOption <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.CustomFieldManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.IssueManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.ModifiedValue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.MutableIssue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.fields.CustomField <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.util.DefaultIssueChangeHolder <span class="hljs-comment"><span class="hljs-comment">//  - ComponentManager componentManager = ComponentManager.getInstance() IssueManager issueManager = ComponentAccessor.getIssueManager() CustomFieldManager customFieldManager = componentManager.getCustomFieldManager() //   User curUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser() //  issue    MutableIssue curIssue = issueManager.getIssueObject("PRJ-1") // 1.     Summary. //       issue. curIssue.summary = "New summary" //   issue  Jira. //  ,      event IssueUpdated,    ,   . //     issue,   issue,         . issueManager.updateIssue(curUser, curIssue, EventDispatchOption.ISSUE_UPDATED, false) // 2.    . (1) //     . CustomField cfReleaseVersion = customFieldManager.getCustomFieldObjectByName("Release Version") //         event curIssue.setCustomFieldValue(cfReleaseVersion, "3.5") issueManager.updateIssue(curUser, curIssue, EventDispatchOption.ISSUE_UPDATED, false) // 3.    . (2) //     id. CustomField cfUpdateVersion = customFieldManager.getCustomFieldObject("customfield_13500") // ""   ,    event       issue. cfUpdateVersion.updateValue(null, curIssue, new ModifiedValue(null, "2.4"), new DefaultIssueChangeHolder())</span></span></code> </pre><br>  Further a couple of examples with comments. <br><div class="spoiler">  <b class="spoiler_title">Search issue by JQL request</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.crowd.embedded.api.User <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.bc.issue.search.SearchService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.component.ComponentAccessor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.Issue <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.IssueManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.web.bean.PagerFilter IssueManager issueManager = ComponentAccessor.getIssueManager() SearchService searchService = ComponentAccessor.getComponent(SearchService.class) User curUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser() <span class="hljs-comment"><span class="hljs-comment">// JQL-   issue,      String JqlQuery = "created &gt; -2d" def parseResult = searchService.parseQuery(curUser, JqlQuery) def searchResult = searchService.search(curUser, parseResult.getQuery(), PagerFilter.getUnlimitedFilter()) def IssuesByJql = searchResult.issues.collect { issueManager.getIssueObject(it.id) } return IssuesByJql</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Link creation between issue</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.crowd.embedded.api.User <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.ComponentManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.component.ComponentAccessor <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.IssueManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.link.IssueLinkManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.link.IssueLinkType <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.atlassian.jira.issue.link.IssueLinkTypeManager IssueManager issueManager = ComponentAccessor.getIssueManager() IssueLinkManager issueLinkManager = ComponentManager.getInstance().getIssueLinkManager() IssueLinkTypeManager issueLinkTypeManager = (IssueLinkTypeManager) ComponentManager.getComponentInstanceOfType(IssueLinkTypeManager.class) User curUser = ComponentAccessor.getJiraAuthenticationContext().getLoggedInUser() <span class="hljs-comment"><span class="hljs-comment">//      IssueLinkType duplicateLinkType = issueLinkTypeManager.getIssueLinkTypesByName("Duplicate")?.first() if (duplicateLinkType != null) { def issue_1 = issueManager.getIssueObject("PRJ-1") def issue_2 = issueManager.getIssueObject("PRJ-2") //   PRJ-1 duplicates PRJ-2 issueLinkManager.createIssueLink(issue_1.id, issue_2.id, duplicateLinkType.id, null, curUser) }</span></span></code> </pre></div></div><br><br>  In the WorkFlow scripts (PostFunction, Validator, Condition) access to the current issue can be obtained through the <i>issue</i> variable, it will be bind by the ScriptRunner.  Lissener organized a little differently.  You need to create your class that inherits <b>AbstractIssueEventListener</b> . <br>  The simplest Lissener looks like this: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> Listeners <span class="hljs-comment"><span class="hljs-comment">//      %scriptroot%/Listeners import com.atlassian.jira.event.issue.AbstractIssueEventListener import com.atlassian.jira.event.issue.IssueEvent import com.atlassian.jira.issue.Issue import org.apache.log4j.Level import org.apache.log4j.Logger class SimpleListener extends AbstractIssueEventListener { Logger log = Logger.getLogger(this.class.simpleName) @Override void workflowEvent(IssueEvent event) { this.customEvent(event) } @Override void customEvent(IssueEvent event) { Issue curIssue = event.issue log.setLevel(Level.DEBUG) log.debug("Event catch: ${event.eventTypeId} fired for ${curIssue.key} (${curIssue.issueTypeObject.name}).") } }</span></span></code> </pre><br><h3>  Conclusion </h3><br>  On Groovy, you can perform http requests, read data from a database, send emails, use the JIRA Java API and standard Java libraries.  In ScriptRunner itself there are still many features that I did not mention in the article: scripted fields, unit tests, embedded scripts and much more.  If you plan to upgrade JIRA to version 7 (or are already using it), please note that you can only install the fourth paid version of ScriptRunner on it.  But all the basic functions are available in the 2nd and 3rd free versions.  The above scripts were tested on JIRA 6.4.12 (Java 8) and ScriptRunner 3.0.16. <br><br><h3>  Resources </h3><br>  <a href="https://scriptrunner.adaptavist.com/">ScriptRunner official website</a> <br>  <a href="https://marketplace.atlassian.com/plugins/com.onresolve.jira.groovy.groovyrunner/server/overview">ScriptRunner on the Atlassian Marketplace</a> <br>  <a href="http://www.groovy-lang.org/">Groovy official website</a> <br>  <a href="https://developer.atlassian.com/jiradev/jira-apis">JIRA API documentation</a> <br>  <a href="http://igorpopov.io/2014/11/24/rocking-with-jira-script-runner/">Article Rocking With Jira ScriptRunner</a> (careful, outdated code in some places) <br>  <a href="https://jamieechlin.atlassian.net/wiki/display/GRV/Script%2BRunner">Old ScriptRunner documentation (for versions prior to 3.0)</a> </div><p>Source: <a href="https://habr.com/ru/post/271805/">https://habr.com/ru/post/271805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../271793/index.html">Black Friday at hosters</a></li>
<li><a href="../271795/index.html">Use TSQL to play Baldu</a></li>
<li><a href="../271797/index.html">COUNT (*)</a></li>
<li><a href="../271799/index.html">An example of express analysis of the performance of storage using the free service Mitrend</a></li>
<li><a href="../271803/index.html">Google spam confession</a></li>
<li><a href="../271809/index.html">Investigation of the installation error Visual Studio 2015</a></li>
<li><a href="../271811/index.html">Development of fast mobile applications on Android. Part two</a></li>
<li><a href="../271813/index.html">New Acquisition Options and Free Visual Studio 2015 Offers</a></li>
<li><a href="../271815/index.html">Today‚Äôs world is amd64, armv7 and aarch64. Everything else is dead, Jim</a></li>
<li><a href="../271817/index.html">"Black Friday" or "Buy Nothing Day"? Your choice? Do not buy dedicated servers in the Netherlands at a 30% discount in addition?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>