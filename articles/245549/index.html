<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multiple versions of php on the same server. suphp</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the next topic, the question from bondbig 'a was: ‚ÄúTell us better how to write down two versions of php on one server (5.3 and 5.5, for example).‚Äù ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multiple versions of php on the same server. suphp</h1><div class="post__text post__text-html js-mediator-article">  In the next topic, the <a href="http://habrahabr.ru/users/bondbig/" class="user_link">question</a> from <a href="http://habrahabr.ru/users/bondbig/" class="user_link">bondbig</a> 'a was: ‚ÄúTell us better how to write down two versions of php on one server (5.3 and 5.5, for example).‚Äù general concept. <br><br>  suphp is a module for apache, which is called instead of mod_php and was originally designed to run apache from different users.  This was designed to prevent an attacker from hacking into 1 site from gaining access to all sites on the server (after all, by default, apache runs from one user to all sites on the server).  But it can be adapted to our tasks. <br><br>  I will not compare suphp with mtm-itk, I will only say that the company in which I work uses suphp on virtual hosting servers (yes, I work in a hosting provider), it applies successfully and I have never had any complaints about this module. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I also want to note that if you take the server from CentOS 6, execute all the commands from this post and at the end everything will work as it should, then this does not mean that the server is ready for sale.  You need to reset the server and do everything ‚Äúby analogy, but fine,‚Äù and not in the same way. <br>  So we need: <br><ul><li>  Server </li><li>  apache </li><li>  At least 2 versions of php installed on the server </li><li>  mod_suphp </li><li>  Put it all together </li></ul><br>  1) Since I have an extra battle server, I will take a virtual machine, install Centos 6 minimal into it and enter the following into the console from the root: <br><pre><code class="bash hljs">yum -y update yum -y groupinstall <span class="hljs-string"><span class="hljs-string">"Development Tools"</span></span> yum -y install epel-release yum -y install httpd-devel httpd php php-common php-gd php-xml php-mbstring libxml2-devel libapreq2 libapreq2-devel wget vim screen links</code> </pre> <br>  Thus, we will update the system, connect the <a href="https://fedoraproject.org/wiki/EPEL">epel</a> repository to it, install apache, php (5.3) and build tools from source codes. <br><br>  2) Now we need to install the second version of php.  As you might guess, I will do this from the source codes: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/src/ wget http://ru2.php.net/get/php-5.6.2.tar.gz/from/this/mirror -O php.tar.gz tar xfz php.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php-5.6.2/ ./configure &amp;&amp; make install</code> </pre><br>  In my case, everything went well, and php 5.6 rose to / usr / local / bin /. <br><br>  You do not need to collect everything yourself.  You can use the package manager of the distribution kit, an alternative package manager (for example, <a href="http://habrahabr.ru/post/47590/">Nix</a> ) or Orthodox to build a package.  In any case, if you do it on a combat server, then at least you need to add options to ./configure. <br><br>  3) Install suphp: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/src/ wget http://www.suphp.org/download/suphp-0.7.2.tar.gz tar xfz suphp-0.7.2.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> suphp-0.7.2 autoreconf -f -i ./configure --with-apr=/usr/bin/apr-1-config &amp;&amp; make install</code> </pre><br>  (Note as to the previous item). <br><br>  4) We configure apache: we connect the module, we register Wirth.  hosts \ folders, set the necessary variables (on whose behalf to run, which php versions to use). <br><div class="spoiler">  <b class="spoiler_title">httpd.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">cat &gt; /etc/httpd/conf/httpd.conf &lt;&lt; EOF ServerRoot <span class="hljs-string"><span class="hljs-string">"/etc/httpd"</span></span> Listen 80 LoadModule authz_host_module modules/mod_authz_host.so LoadModule mime_magic_module modules/mod_mime_magic.so LoadModule headers_module modules/mod_headers.so LoadModule mime_module modules/mod_mime.so LoadModule dir_module modules/mod_dir.so LoadModule rewrite_module modules/mod_rewrite.so LoadModule suphp_module modules/mod_suphp.so suPHP_Engine on suPHP_AddHandler application/x-httpd-php5 <span class="hljs-comment"><span class="hljs-comment">#  2   suphp.conf,   suPHP_AddHandler application/x-httpd-php56 TypesConfig /etc/mime.types User apache Group apache DirectoryIndex index.php MIMEMagicFile conf/magic DocumentRoot "/var/www/html" &lt;Directory "/var/www/html"&gt; #  "    ",     suPHP_UserGroup apache apache Options Indexes FollowSymLinks Order allow,deny Allow from all &lt;/Directory&gt; EOF</span></span></code> </pre></div></div><br><br>  5) Config suphp.  It is worth paying attention to the handlers section, namely, it indicates the path to your interpreters and their "names".  The rest is intuitive.  More in the <a href="http://www.suphp.org/DocumentationView.html%3Ffile%3DCONFIG">documentation</a> : <br><div class="spoiler">  <b class="spoiler_title">suphp.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">cat &gt; /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/etc/suphp.conf &lt;&lt; EOF [global] logfile=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/suphp.log loglevel=info webserver_user=apache docroot=/ errors_to_browser=<span class="hljs-literal"><span class="hljs-literal">false</span></span> env_path=<span class="hljs-string"><span class="hljs-string">"/bin:/usr/bin"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">umask</span></span>=0022 min_uid=1 [handlers] application/x-httpd-php5=<span class="hljs-string"><span class="hljs-string">"php:/usr/bin/php-cgi"</span></span> application/x-httpd-php56=<span class="hljs-string"><span class="hljs-string">"php:/usr/local/bin/php-cgi"</span></span> EOF</code> </pre></div></div><br><br>  6) Now, in accordance with all the above, we will create 2 test directories in which we will have different versions of php.  Management through the .htaccess file, or rather the ‚ÄúAddHandler‚Äù directive in it: <div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="bash hljs">mkdir -p /var/www/html/53 &amp;&amp; mkdir -p /var/www/html/56 &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;?php phpinfo(); ?&gt;"</span></span> &gt; /var/www/html/53/index.php &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;?php phpinfo(); ?&gt;"</span></span> &gt; /var/www/html/56/index.php &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"AddHandler application/x-httpd-php5 .php"</span></span> &gt; /var/www/html/53/.htaccess &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"AddHandler application/x-httpd-php56 .php"</span></span> &gt; /var/www/html/56/.htaccess &amp;&amp; chown -R apache:apache /var/www/html</code> </pre></div></div><br><br>  On this by and large everything.  Restart apache, stop iptables (that we could enter the browser from our PC) and check that everything works. <pre> <code class="bash hljs">service httpd restart service iptables stop links2 -dump http://localhost/53 | grep <span class="hljs-string"><span class="hljs-string">'PHP Version'</span></span> links2 -dump http://localhost/56 | grep <span class="hljs-string"><span class="hljs-string">'PHP Version'</span></span></code> </pre><br><br>  Once again, this is not a hautushka, but only a general concept of exemplary actions. </div><p>Source: <a href="https://habr.com/ru/post/245549/">https://habr.com/ru/post/245549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245533/index.html">Containers for Windows: 10 years before Microsoft</a></li>
<li><a href="../245535/index.html">Private library: information etiquette, preparation for large projects, lean manufacturing, space exploration</a></li>
<li><a href="../245537/index.html">Crowdsourcing translation of OWASP Testing Guide 4.0 has been launched into 30+ languages ‚Äã‚Äã(including Russian)</a></li>
<li><a href="../245539/index.html">Embedding into the Linux kernel: intercepting system calls</a></li>
<li><a href="../245545/index.html">Birch's hypothesis - Swinnerton-Dyer</a></li>
<li><a href="../245553/index.html">How we assemble DDBP: huge flywheels in data centers and emergency reserve facility for responsible objects</a></li>
<li><a href="../245557/index.html">Some interesting and useful things for web developer # 35</a></li>
<li><a href="../245559/index.html">New Year Promotion from Payler and Polonium Arts</a></li>
<li><a href="../245563/index.html">What is the connection between a worm about a millimeter in length and OpenCL?</a></li>
<li><a href="../245565/index.html">Deploy4Me - a service that deployed itself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>