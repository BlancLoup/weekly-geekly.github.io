<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We cross with the hedgehog: OpenJDK-11 + GraalVM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! In the light of not the oldest news about the Oracle policy regarding licensing of Java, the issue of avoiding Oracle versions in the direct...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We cross with the hedgehog: OpenJDK-11 + GraalVM</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  In the light of not the oldest news about the Oracle policy regarding licensing of Java, the issue of avoiding Oracle versions in the direction of <b>OpenJDK is</b> becoming more acute.  Odanko in OracleLabs has long been doing a very cool thing called <a href="https://graalvm.org/">GraalVM</a> , which is a cool <abbr title="Just in time">JIT</abbr> compiler written in Java, as well as runtime to run code in languages ‚Äã‚Äãsuch as JavaScript, Ruby, Python, C, C ++, Scala, Kotlin, R, Clojure.  Impressive, right?  But not about the coolness of the polyglot environment, I want to tell you.  It will be about the complexity of sticking the latest build of the grail into the OpenJDK 11 ecosystem and a bit about performance, quite a bit ... <br><a name="habracut"></a><br><h3>  First there was the word </h3><br>  The story of my acquaintance with <b>graalvm</b> began on the <a href="https://jokerconf.com/">joker</a> in 2017.  There, <a href="https://2017.jokerconf.com/en/2017/talks/ghdvtsu3y60qai68waayi/">Chris Seaton</a> spoke in great detail about the insides of the compiler and showed the <abbr title="Ahead of time">AOT</abbr> magic of compilation on the example of using native-image from the delivery of the grail (this is such a joke that compiles your Java code into the native binary). <br><br>  After that report, I had been training for a very long time to compile the native binaries of my pet project, put crutches and rakes in order to start reflection in all places (if it‚Äôs not okay!) And finally came across unresolved IO problems (something it didn‚Äôt take off with zookeeper there, now I don‚Äôt remember what).  I spat on native-image :-( <br><br>  Year 2018, the same joker and the same graalvm in the super-detailed report from Oleg Shelayev about AOT. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Everything looks so great in reports and presentations, and there is a pet project on the disk ... it's time to uncover the terminal, swing the fresh release candidate Grail and go into battle!  We'll touch jit. <br><br><h3>  Hello world </h3><br>  Touching and kicking fresh JIT (at the time of writing this article is version <b>ce-1.0.0-rc14</b> ) we will use the example of a piece of code to test performance from <a href="https://www.graalvm.org/docs/examples/java-performance-examples/">https://graalvm.org</a> - our first example. <br><br>  What is the java project (even <i>Hello World</i> ) without any build system?  That's right, only the one on which they learn to cook javac.  Dzhavak we will not cook, let Dzhavakom taxis maven. <br><br>  So, meet, pom.xml: <br><br><div class="spoiler">  <b class="spoiler_title">pom.xml</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.mycompany.app<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>my-app<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--&lt;packaging&gt;jar&lt;/packaging&gt;--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0-SNAPSHOT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>my-app<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://maven.apache.org<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">java.version</span></span></span><span class="hljs-tag">&gt;</span></span>11<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">java.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graalvm.version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0-rc14<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graalvm.version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>jdk11<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activation</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdk</span></span></span><span class="hljs-tag">&gt;</span></span>11<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jdk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activation</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-dependency-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.10<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>copy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span>process-test-classes<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>copy-dependencies<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">outputDirectory</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.directory}/lib<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">outputDirectory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-jar-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span>com.mycompany.app.App<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mainClass</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">archive</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-compiler-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.8.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">release</span></span></span><span class="hljs-tag">&gt;</span></span>${java.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">release</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>junit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>junit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>4.12<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>test<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.graalvm.compiler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>compiler<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${graalvm.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.graalvm.truffle<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>truffle-api<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${graalvm.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.graalvm.sdk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graal-sdk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${graalvm.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.graalvm.js<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>js<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${graalvm.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.graalvm.js<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>js-scriptengine<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${graalvm.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  The project file structure looks like this: <br><br><img src="https://habrastorage.org/webt/al/pt/xo/alptxo8pj7z5hsiqw0udg-kni7u.png"><br><br>  The class code is <b><i>com.mycompany.app.App</i></b> (copy-paste of the example from graalvm.org): <br><br><div class="spoiler">  <b class="spoiler_title">App.java</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.mycompany.app; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ITERATIONS = Math.max(Integer.getInteger(<span class="hljs-string"><span class="hljs-string">"iterations"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ String sentence = String.join(<span class="hljs-string"><span class="hljs-string">" "</span></span>, args); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iter = <span class="hljs-number"><span class="hljs-number">0</span></span>; iter &lt; ITERATIONS; iter++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ITERATIONS != <span class="hljs-number"><span class="hljs-number">1</span></span>) System.out.println(<span class="hljs-string"><span class="hljs-string">"-- iteration "</span></span> + (iter + <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">" --"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> total = <span class="hljs-number"><span class="hljs-number">0</span></span>, start = System.currentTimeMillis(), last = start; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10_000_000</span></span>; i++) { total += sentence.chars().filter(Character::isUpperCase).count(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i % <span class="hljs-number"><span class="hljs-number">1_000_000</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> now = System.currentTimeMillis(); System.out.printf(<span class="hljs-string"><span class="hljs-string">"%d (%d ms)%n"</span></span>, i / <span class="hljs-number"><span class="hljs-number">1_000_000</span></span>, now - last); last = now; } } System.out.printf(<span class="hljs-string"><span class="hljs-string">"total: %d (%d ms)%n"</span></span>, total, System.currentTimeMillis() - start); } } }</code> </pre><br></div></div><br>  Code <i><b>module-info.java</b></i> : <br><br><div class="spoiler">  <b class="spoiler_title">module-info.java</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> com.mycompany.app {}</code> </pre><br></div></div><br>  Hmm, empty ... And it is empty for the reason that I want to show you how custom java (about custom java later) will be cursed with undeclared modules that are needed by our application. <br><br><h4>  The first pancake ... </h4><br>  not lumpy  Let's build our project and run it.  Putting it like this: <br><a name="build"></a><br><pre> <code class="bash hljs">mvn clean package</code> </pre> <br><br>  Run: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$JAVA_HOME</span></span>/bin/java -XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler -Diterations=10 -jar target/my-app-1.0-SNAPSHOT.jar In 2017 I would like to run ALL languages <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> one VM.</code> </pre><br>  There are two important points here: <abbr title="Java Virtual Machine Compiler Interface">JVMCI</abbr> is an experimental piece that appeared in Java from version 9, so we need: <br><br><ul><li>  Enable experimental virtual machine options - <pre>  -XX: + UnlockEperimentalVMOptions </pre></li><li>  enable that experimental virtual machine (starting with nine there is a grail in openjdk, not the latest version, but still) - -XX: + UseJVMCICompiler </li></ul><br><div class="spoiler">  <b class="spoiler_title">Startup Result</b> <div class="spoiler_text">  - iteration 1 - 1 (1466 ms) <br>  2 (461 ms) <br>  3 (463 ms) <br>  4 (138 ms) <br>  5 (151 ms) <br>  6 (159 ms) <br>  7 (266 ms) <br>  8 (128 ms) <br>  9 (144 ms) <br>  total: 69999993 (3481 ms) <br>  - iteration 2 - 1 (233 ms) <br>  2 (169 ms) <br>  3 (121 ms) <br>  4 (205 ms) <br>  5 (170 ms) <br>  6 (152 ms) <br>  7 (227 ms) <br>  8 (158 ms) <br>  9 (108 ms) <br>  total: 69999993 (1644 ms) <br>  - iteration 3 - 1 (98 ms) <br>  2 (102 ms) <br>  3 (98 ms) <br>  4 (102 ms) <br>  5 (95 ms) <br>  6 (96 ms) <br>  7 (101 ms) <br>  8 (95 ms) <br>  9 (97 ms) <br>  total: 69999993 (990 ms) <br>  - iteration 4 - 1 (109 ms) <br>  2 (114 ms) <br>  3 (97 ms) <br>  4 (98 ms) <br>  5 (100 ms) <br>  6 (103 ms) <br>  7 (125 ms) <br>  8 (108 ms) <br>  9 (100 ms) <br>  total: 69999993 (1056 ms) <br>  - iteration 5 - 1 (98 ms) <br>  2 (100 ms) <br>  3 (105 ms) <br>  4 (97 ms) <br>  5 (95 ms) <br>  6 (99 ms) <br>  7 (95 ms) <br>  8 (123 ms) <br>  9 (98 ms) <br>  total: 69999993 (1010 ms) <br>  - iteration 6 - 1 (99 ms) <br>  2 (95 ms) <br>  3 (102 ms) <br>  4 (99 ms) <br>  5 (96 ms) <br>  6 (100 ms) <br>  7 (99 ms) <br>  8 (99 ms) <br>  9 (104 ms) <br>  total: 69999993 (993 ms) <br>  - iteration 7 - 1 (100 ms) <br>  2 (104 ms) <br>  3 (95 ms) <br>  4 (96 ms) <br>  5 (97 ms) <br>  6 (95 ms) <br>  7 (94 ms) <br>  8 (108 ms) <br>  9 (108 ms) <br>  total: 69999993 (1000 ms) <br>  - iteration 8 - 1 (100 ms) <br>  2 (106 ms) <br>  3 (99 ms) <br>  4 (95 ms) <br>  5 (97 ms) <br>  6 (97 ms) <br>  7 (101 ms) <br>  8 (99 ms) <br>  9 (101 ms) <br>  total: 69999993 (1012 ms) <br>  - iteration 9 - 1 (105 ms) <br>  2 (97 ms) <br>  3 (98 ms) <br>  4 (96 ms) <br>  5 (99 ms) <br>  6 (96 ms) <br>  7 (94 ms) <br>  8 (98 ms) <br>  9 (105 ms) <br>  total: 69999993 (993 ms) <br>  - iteration 10 - 1 (107 ms) <br>  2 (98 ms) <br>  3 (99 ms) <br>  4 (100 ms) <br>  5 (97 ms) <br>  6 (101 ms) <br>  7 (98 ms) <br>  8 (103 ms) <br>  9 (105 ms) <br>  total: 69999993 (1006 ms) <br></div></div><br>  What do we see here?  And we see that the first iteration is the longest (3.5 seconds), this JIT warms up.  And then everything is more or less smooth (within one second). <br><br>  And what if we give Java the latest version of the Grail?  No sooner said than done: <br><br><pre> <code class="bash hljs">java -XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler -Diterations=10 --module-path=target/lib --upgrade-module-path=target/lib/compiler-1.0.0-rc14.jar -jar target/my-app-1.0-SNAPSHOT.jar In 2017 I would like to run ALL languages <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> one VM.</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Fresh Grail Run Result</b> <div class="spoiler_text">  - iteration 1 - 1 (1789 ms) <br>  2 (547 ms) <br>  3 (313 ms) <br>  4 (87 ms) <br>  5 (88 ms) <br>  6 (87 ms) <br>  7 (83 ms) <br>  8 (92 ms) <br>  9 (87 ms) <br>  total: 69999993 (3259 ms) <br>  - iteration 2 - 1 (241 ms) <br>  2 (161 ms) <br>  3 (152 ms) <br>  4 (195 ms) <br>  5 (136 ms) <br>  6 (129 ms) <br>  7 (154 ms) <br>  8 (176 ms) <br>  9 (109 ms) <br>  total: 69999993 (1553 ms) <br>  - iteration 3 - 1 (109 ms) <br>  2 (103 ms) <br>  3 (113 ms) <br>  4 (172 ms) <br>  5 (141 ms) <br>  6 (148 ms) <br>  7 (111 ms) <br>  8 (102 ms) <br>  9 (101 ms) <br>  total: 69999993 (1211 ms) <br>  - iteration 4 - 1 (96 ms) <br>  2 (96 ms) <br>  3 (104 ms) <br>  4 (98 ms) <br>  5 (96 ms) <br>  6 (97 ms) <br>  7 (98 ms) <br>  8 (96 ms) <br>  9 (95 ms) <br>  total: 69999993 (972 ms) <br>  - iteration 5 - 1 (97 ms) <br>  2 (93 ms) <br>  3 (99 ms) <br>  4 (97 ms) <br>  5 (97 ms) <br>  6 (97 ms) <br>  7 (95 ms) <br>  8 (98 ms) <br>  9 (94 ms) <br>  total: 69999993 (965 ms) <br>  - iteration 6 - 1 (96 ms) <br>  2 (95 ms) <br>  3 (96 ms) <br>  4 (99 ms) <br>  5 (102 ms) <br>  6 (94 ms) <br>  7 (99 ms) <br>  8 (115 ms) <br>  9 (109 ms) <br>  total: 69999993 (1001 ms) <br>  - iteration 7 - 1 (98 ms) <br>  2 (96 ms) <br>  3 (99 ms) <br>  4 (98 ms) <br>  5 (118 ms) <br>  6 (98 ms) <br>  7 (95 ms) <br>  8 (99 ms) <br>  9 (116 ms) <br>  total: 69999993 (1017 ms) <br>  - iteration 8 - 1 (95 ms) <br>  2 (99 ms) <br>  3 (99 ms) <br>  4 (106 ms) <br>  5 (101 ms) <br>  6 (101 ms) <br>  7 (93 ms) <br>  8 (97 ms) <br>  9 (108 ms) <br>  total: 69999993 (993 ms) <br>  - iteration 9 - 1 (102 ms) <br>  2 (95 ms) <br>  3 (97 ms) <br>  4 (125 ms) <br>  5 (94 ms) <br>  6 (101 ms) <br>  7 (100 ms) <br>  8 (95 ms) <br>  9 (96 ms) <br>  total: 69999993 (1008 ms) <br>  - iteration 10 - 1 (97 ms) <br>  2 (97 ms) <br>  3 (99 ms) <br>  4 (112 ms) <br>  5 (102 ms) <br>  6 (96 ms) <br>  7 (96 ms) <br>  8 (98 ms) <br>  9 (96 ms) <br>  total: 69999993 (988 ms) <br></div></div><br>  The result, as we see, is not very different. <br><br>  I forgot.  We did not try to run the same thing without the new JIT compiler.  We will do: <br><br><pre> <code class="bash hljs">java -Diterations=10 -jar target/my-app-1.0-SNAPSHOT.jar In 2017 I would like to run ALL languages <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> one VM.</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Results without a modern JIT compiler</b> <div class="spoiler_text">  - iteration 1 - 1 (372 ms) <br>  2 (271 ms) <br>  3 (337 ms) <br>  4 (391 ms) <br>  5 (328 ms) <br>  6 (273 ms) <br>  7 (239 ms) <br>  8 (271 ms) <br>  9 (250 ms) <br>  total: 69999993 (2978 ms) <br>  - iteration 2 - 1 (242 ms) <br>  2 (253 ms) <br>  3 (253 ms) <br>  4 (240 ms) <br>  5 (245 ms) <br>  6 (275 ms) <br>  7 (273 ms) <br>  8 (263 ms) <br>  9 (234 ms) <br>  total: 69999993 (2533 ms) <br>  - iteration 3 - 1 (237 ms) <br>  2 (235 ms) <br>  3 (234 ms) <br>  4 (246 ms) <br>  5 (242 ms) <br>  6 (238 ms) <br>  7 (244 ms) <br>  8 (243 ms) <br>  9 (253 ms) <br>  total: 69999993 (2414 ms) <br>  - iteration 4 - 1 (244 ms) <br>  2 (249 ms) <br>  3 (245 ms) <br>  4 (243 ms) <br>  5 (232 ms) <br>  6 (256 ms) <br>  7 (321 ms) <br>  8 (303 ms) <br>  9 (249 ms) <br>  total: 69999993 (2599 ms) <br>  - iteration 5 - 1 (246 ms) <br>  2 (242 ms) <br>  3 (248 ms) <br>  4 (256 ms) <br>  5 (280 ms) <br>  6 (233 ms) <br>  7 (235 ms) <br>  8 (266 ms) <br>  9 (246 ms) <br>  total: 69999993 (2511 ms) <br>  - iteration 6 - 1 (292 ms) <br>  2 (368 ms) <br>  3 (339 ms) <br>  4 (251 ms) <br>  5 (267 ms) <br>  6 (259 ms) <br>  7 (289 ms) <br>  8 (262 ms) <br>  9 (357 ms) <br>  total: 69999993 (3058 ms) <br>  - iteration 7 - 1 (284 ms) <br>  2 (258 ms) <br>  3 (248 ms) <br>  4 (247 ms) <br>  5 (266 ms) <br>  6 (247 ms) <br>  7 (242 ms) <br>  8 (314 ms) <br>  9 (265 ms) <br>  total: 69999993 (2656 ms) <br>  - iteration 8 - 1 (239 ms) <br>  2 (238 ms) <br>  3 (257 ms) <br>  4 (282 ms) <br>  5 (244 ms) <br>  6 (261 ms) <br>  7 (253 ms) <br>  8 (295 ms) <br>  9 (256 ms) <br>  total: 69999993 (2575 ms) <br>  - iteration 9 - 1 (273 ms) <br>  2 (243 ms) <br>  3 (239 ms) <br>  4 (240 ms) <br>  5 (250 ms) <br>  6 (285 ms) <br>  7 (266 ms) <br>  8 (285 ms) <br>  9 (264 ms) <br>  total: 69999993 (2617 ms) <br>  - iteration 10 - 1 (245 ms) <br>  2 (264 ms) <br>  3 (258 ms) <br>  4 (253 ms) <br>  5 (239 ms) <br>  6 (260 ms) <br>  7 (251 ms) <br>  8 (250 ms) <br>  9 (256 ms) <br>  total: 69999993 (2538 ms) <br></div></div><br>  The result is different and decent. <br><br>  C2 does not give any optimizations on hot pieces of code - each iteration with the same time. <br><br>  Graal is able to optimize hot chunks of code and in the long term gives a good performance boost. <br><br><h4>  For what? </h4><br>  This is probably the main question that you need to ask yourself and others (team members) when you want to add a new feature, a new tool, a new virtual machine, a new JIT to the project ... <br><br>  My story, as stated above, began with Joker 2017, then there were many attempts to master AOT, and now I taste JIT's charms for Java on java. <br><br>  A pet project on disk is a kind of business process engine, where processes are drawn by application developers in the UI in the browser, and they have the opportunity to write scripts in JS that will run on the JVM. <br><br>  In future versions, Java promises to remove nashorn, GraalVM is gradually nearing release ... <br><br>  Well, the answer to the question is: <br><br><ol><li>  we want runtime for start of JS (and not only) </li><li>  want speed jit </li><li>  we want the launch of pet-project applications to be in appearance as before on 8-ke (without <pre>  --module-path </pre>  and <pre>  --upgrade-module-path </pre>  but with a fresh build of grail) </li></ol><br><h4>  Jlink </h4><br>  The first two points in the list of answers to the above question are clear enough, let's deal with the last. <br><br>  The fact is that developers, admins, devops, people are lazy and do not like doing extra work (I am also like this), they are trying to automate everything and pack it into a ready-made bundle, which can be run as a simple binary.  Well, the problem is, let's solve it. <br><br>  A relatively new tool from the world of Java 9+ comes to our aid, and its name is <a href="https://docs.oracle.com/en/java/javase/11/tools/jlink.html">jlink</a> .  We try to pack our application with all the necessary libs in the bundle: <br><a name="link"></a><br><pre> <code class="bash hljs">jlink --module-path target/classes:target/lib:<span class="hljs-variable"><span class="hljs-variable">$JAVA_HOME</span></span>/jmods --add-modules com.mycompany.app --launcher app=com.mycompany.app/com.mycompany.app.App --compress 2 --no-header-files --no-man-pages --strip-debug --output <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre><br>  How many parameters of all sorts, we describe the main: <br><ul><li><pre>  --module-path target / classes: target / lib: $ JAVA_HOME / jmods </pre></li><li><pre>  --add-modules com.mycompany.app </pre></li><li><pre>  --launcher app = com.mycompany.app / com.mycompany.app.App </pre></li><li><pre>  --output test </pre></li></ul><br>  You can ask Google‚Äôs uncle about the remaining parameters, all of which are aimed at reducing the final size of the bundle. <br><br>  Let's look at the result: <br><br><img src="https://habrastorage.org/webt/tf/v-/cj/tfv-cjfkbpoap3fabh6frpehidu.png"><br><br>  Inside the test / bin / app is a simple sh-script that runs our application on the java that is next to the app: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh JLINK_VM_OPTIONS="-Diterations=10" #     ,       DIR=`dirname $0` $DIR/java $JLINK_VM_OPTIONS -m com.mycompany.app/com.mycompany.app.App $@</span></span></code> </pre><br>  Run <b>test / bin / app</b> on C2: <br><br><pre> <code class="bash hljs">./<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>/bin/app In 2017 I would like to run ALL languages <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> one VM.</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text">  - iteration 1 - 1 (315 ms) <br>  2 (231 ms) <br>  3 (214 ms) <br>  4 (297 ms) <br>  5 (257 ms) <br>  6 (211 ms) <br>  7 (217 ms) <br>  8 (245 ms) <br>  9 (222 ms) <br>  total: 69999993 (2424 ms) <br>  - iteration 2 - 1 (215 ms) <br>  2 (215 ms) <br>  3 (223 ms) <br>  4 (224 ms) <br>  5 (217 ms) <br>  6 (208 ms) <br>  7 (208 ms) <br>  8 (222 ms) <br>  9 (222 ms) <br>  total: 69999993 (2164 ms) <br>  - iteration 3 - 1 (206 ms) <br>  2 (226 ms) <br>  3 (234 ms) <br>  4 (211 ms) <br>  5 (212 ms) <br>  6 (213 ms) <br>  7 (210 ms) <br>  8 (245 ms) <br>  9 (223 ms) <br>  total: 69999993 (2216 ms) <br>  - iteration 4 - 1 (222 ms) <br>  2 (233 ms) <br>  3 (220 ms) <br>  4 (222 ms) <br>  5 (221 ms) <br>  6 (219 ms) <br>  7 (222 ms) <br>  8 (216 ms) <br>  9 (220 ms) <br>  total: 69999993 (2215 ms) <br>  - iteration 5 - 1 (231 ms) <br>  2 (230 ms) <br>  3 (221 ms) <br>  4 (226 ms) <br>  5 (227 ms) <br>  6 (223 ms) <br>  7 (215 ms) <br>  8 (216 ms) <br>  9 (219 ms) <br>  total: 69999993 (2234 ms) <br>  - iteration 6 - 1 (227 ms) <br>  2 (218 ms) <br>  3 (221 ms) <br>  4 (254 ms) <br>  5 (222 ms) <br>  6 (212 ms) <br>  7 (214 ms) <br>  8 (222 ms) <br>  9 (222 ms) <br>  total: 69999993 (2241 ms) <br>  - iteration 7 - 1 (217 ms) <br>  2 (225 ms) <br>  3 (222 ms) <br>  4 (223 ms) <br>  5 (227 ms) <br>  6 (221 ms) <br>  7 (219 ms) <br>  8 (226 ms) <br>  9 (219 ms) <br>  total: 69999993 (2217 ms) <br>  - iteration 8 - 1 (218 ms) <br>  2 (242 ms) <br>  3 (219 ms) <br>  4 (218 ms) <br>  5 (224 ms) <br>  6 (226 ms) <br>  7 (223 ms) <br>  8 (220 ms) <br>  9 (219 ms) <br>  total: 69999993 (2228 ms) <br>  - iteration 9 - 1 (234 ms) <br>  2 (218 ms) <br>  3 (217 ms) <br>  4 (217 ms) <br>  5 (225 ms) <br>  6 (222 ms) <br>  7 (216 ms) <br>  8 (226 ms) <br>  9 (214 ms) <br>  total: 69999993 (2212 ms) <br>  - iteration 10 - 1 (226 ms) <br>  2 (230 ms) <br>  3 (215 ms) <br>  4 (238 ms) <br>  5 (225 ms) <br>  6 (218 ms) <br>  7 (218 ms) <br>  8 (215 ms) <br>  9 (228 ms) <br>  total: 69999993 (2233 ms) <br></div></div><br>  Now on graalvm (by defining the necessary flags to run in the variable <i>JLINK_VM_OPTIONS</i> ): <br><a name="run"></a><br><div class="spoiler">  <b class="spoiler_title">test / bin / app</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh JLINK_VM_OPTIONS="-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler -Diterations=10" DIR=`dirname $0` $DIR/java $JLINK_VM_OPTIONS -m com.mycompany.app/com.mycompany.app.App $@</span></span></code> </pre><br></div></div><br>  Result: <br><br><pre> <code class="bash hljs">Error occurred during initialization of boot layer java.lang.module.FindException: Module jdk.internal.vm.ci not found</code> </pre><br>  Well, they came ... And now let's remember that we are working with java 11 in a modular environment, we are building the application as a module, and haven't told anyone about the modules we used.  It is time to be corrected. <br><br>  New version of module-info.java: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span> com.mycompany.app { <span class="hljs-keyword"><span class="hljs-keyword">requires</span></span> jdk.internal.vm.compiler; <span class="hljs-keyword"><span class="hljs-keyword">requires</span></span> org.graalvm.sdk; <span class="hljs-keyword"><span class="hljs-keyword">requires</span></span> org.graalvm.truffle; <span class="hljs-keyword"><span class="hljs-keyword">requires</span></span> transitive org.graalvm.js; <span class="hljs-keyword"><span class="hljs-keyword">requires</span></span> transitive org.graalvm.js.scriptengine; }</code> </pre><br>  <a href="https://habr.com/ru/post/445978/">We collect</a> , delete the test directory, <a href="https://habr.com/ru/post/445978/">link it</a> . <br><br>  Result: <br><br><pre> <code class="bash hljs">Error: automatic module cannot be used with jlink: icu4j from file:///home/slava/JavaProjects/graal-js-jdk11-maven-demo/target/lib/icu4j-62.1.jar</code> </pre><br>  What kind of "automatic module kennot biusd"?  And this <b>jlink</b> tells us that either <b>icu4j</b> does not contain module-info.class.  What is needed for such a class to appear inside the specified location: <br><br><ul><li>  understand the list of modules used by the module and create <i>module-info.java</i> , define all packages that should be visible from the outside </li><li>  compile module-info.java for either </li><li>  put the compiled module-info.java into the jar with liby </li></ul><br>  Go! <br><br>  The module-info.java file with all its contents will be generated by <b>jdeps</b> from the openjdk-11 for us: <br><br><img src="https://habrastorage.org/webt/lm/yy/-d/lmyy-dyami2mcxaolpgois1b78c.png"><br><br>  Compile module-info.java for any icu4j: <br><br><img src="https://habrastorage.org/webt/l1/--/m_/l1--m_vmdasd1tjwqfmugjvct0g.png"><br><br>  Update the jarnik by pushing <b>module-info.class</b> into it: <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$JAVA_HOME</span></span>/bin/jar uf target/lib/icu4j-62.1.jar -C target/modules module-info.class</code> </pre><br>  <a href="https://habr.com/ru/post/445978/">Link</a> , <a href="https://habr.com/ru/post/445978/">run</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Result</b> <div class="spoiler_text">  - iteration 1 - 1 (1216 ms) <br>  2 (223 ms) <br>  3 (394 ms) <br>  4 (138 ms) <br>  5 (116 ms) <br>  6 (102 ms) <br>  7 (120 ms) <br>  8 (106 ms) <br>  9 (110 ms) <br>  total: 69999993 (2619 ms) <br>  - iteration 2 - 1 (166 ms) <br>  2 (133 ms) <br>  3 (142 ms) <br>  4 (157 ms) <br>  5 (119 ms) <br>  6 (134 ms) <br>  7 (153 ms) <br>  8 (95 ms) <br>  9 (85 ms) <br>  total: 69999993 (1269 ms) <br>  - iteration 3 - 1 (86 ms) <br>  2 (81 ms) <br>  3 (87 ms) <br>  4 (83 ms) <br>  5 (85 ms) <br>  6 (100 ms) <br>  7 (87 ms) <br>  8 (83 ms) <br>  9 (85 ms) <br>  total: 69999993 (887 ms) <br>  - iteration 4 - 1 (84 ms) <br>  2 (86 ms) <br>  3 (88 ms) <br>  4 (91 ms) <br>  5 (85 ms) <br>  6 (88 ms) <br>  7 (87 ms) <br>  8 (85 ms) <br>  9 (85 ms) <br>  total: 69999993 (864 ms) <br>  - iteration 5 - 1 (94 ms) <br>  2 (86 ms) <br>  3 (84 ms) <br>  4 (83 ms) <br>  5 (85 ms) <br>  6 (86 ms) <br>  7 (84 ms) <br>  8 (84 ms) <br>  9 (83 ms) <br>  total: 69999993 (854 ms) <br>  - iteration 6 - 1 (83 ms) <br>  2 (89 ms) <br>  3 (87 ms) <br>  4 (87 ms) <br>  5 (86 ms) <br>  6 (86 ms) <br>  7 (91 ms) <br>  8 (86 ms) <br>  9 (85 ms) <br>  total: 69999993 (865 ms) <br>  - iteration 7 - 1 (87 ms) <br>  2 (86 ms) <br>  3 (88 ms) <br>  4 (90 ms) <br>  5 (91 ms) <br>  6 (87 ms) <br>  7 (85 ms) <br>  8 (85 ms) <br>  9 (86 ms) <br>  total: 69999993 (868 ms) <br>  - iteration 8 - 1 (84 ms) <br>  2 (85 ms) <br>  3 (86 ms) <br>  4 (84 ms) <br>  5 (84 ms) <br>  6 (88 ms) <br>  7 (85 ms) <br>  8 (86 ms) <br>  9 (86 ms) <br>  total: 69999993 (852 ms) <br>  - iteration 9 - 1 (83 ms) <br>  2 (85 ms) <br>  3 (84 ms) <br>  4 (85 ms) <br>  5 (89 ms) <br>  6 (85 ms) <br>  7 (88 ms) <br>  8 (86 ms) <br>  9 (83 ms) <br>  total: 69999993 (850 ms) <br>  - iteration 10 - 1 (83 ms) <br>  2 (84 ms) <br>  3 (83 ms) <br>  4 (82 ms) <br>  5 (85 ms) <br>  6 (83 ms) <br>  7 (84 ms) <br>  8 (94 ms) <br>  9 (93 ms) <br>  total: 69999993 (856 ms) <br></div></div><br>  HOORAY!  We made it!  Now we have a banned application in the form of a running sh-script with its java, with all the necessary modules (including fresh graalvm), with preference and young ladies. <br><br><h4>  PS </h4><br>  Java does not get bored and gives new food for the mind with each release.  Try new features, experiment, share experiences.  I hope I‚Äôm going to write an article soon about how I messed up part of a pet project with a grail (there vert.x, asynchrony and js-scripts will be interesting). <br><br>  And yet ... this is my first article on Habr√©, please do not hit hard. </div><p>Source: <a href="https://habr.com/ru/post/445978/">https://habr.com/ru/post/445978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445966/index.html">Note frontend-architect # 1. You just can not take and use Redux</a></li>
<li><a href="../445970/index.html">How LANIT equipped engineering and IT systems dealing center in Sberbank</a></li>
<li><a href="../445972/index.html">Plowed bigdata field in medicine and pharmaceuticals</a></li>
<li><a href="../445974/index.html">How to promote a beginner and do not break anything</a></li>
<li><a href="../445976/index.html">PhpStorm 2019.1: Debugging Twig and Blade templates, searching for dead code, improved autocompletion, and more</a></li>
<li><a href="../445980/index.html">We program voice control of a kopter with use of Node.js and ARDrone</a></li>
<li><a href="../445984/index.html">Pacsafe, thunderstorm pickpockets</a></li>
<li><a href="../445986/index.html">Customer Development as a life philosophy</a></li>
<li><a href="../445988/index.html">Own temporary mail: telegram bot</a></li>
<li><a href="../445992/index.html">Nauchpop on minimum salary: optical illusions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>