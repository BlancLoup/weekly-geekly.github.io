<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Turn Java / JVM application into a daemon</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do you often write a shell script and batch file to run your jvm application, and how often do you copy from another project? 



 You can use the app...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Turn Java / JVM application into a daemon</h1><div class="post__text post__text-html js-mediator-article">  Do you often write a shell script and batch file to run your jvm application, and how often do you copy from another project? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/341/fea/70d/341fea70d831429b9c3067492b32969e.jpg"></div><br><a name="habracut"></a><br>  You can use the <a href="https://github.com/mojohaus/appassembler">appassembler-maven-plugin</a> to generate scripts to launch our program and create a daemon from it.  The plugin does all the routine work on configuring <a href="http://wrapper.tanukisoftware.com/doc/english/product-overview.html">java service wrapper</a> , generating scripts and building the application for us. <br><br>  But we will simplify our lives and use an automated solution for creating skeleton maven artifacts to build our demons.  The com.github.igor-suhorukov plugin generator: daemon-archetype for maven, which <a href="http://central.maven.org/maven2/com/github/igor-suhorukov/daemon-archetype/0.1/">is available in the central repository</a> and on <a href="https://github.com/igor-suhorukov/daemon-archetype">github</a> .  And under the hood is still appassembler-maven-plugin! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All that needs to be done to create the daemon skeleton is to execute the create command interactively and then configure what happened for the project: <br><br><pre><code class="bash hljs">mvn archetype:generate -DarchetypeGroupId=com.github.igor-suhorukov -DarchetypeArtifactId=daemon-archetype -DarchetypeVersion=0.1</code> </pre> <br>  Important note!  The java service wrapper daemon stops with a SIGINT signal, so in order to properly release resources, you must register your Runtime.getRuntime (). AddShutdownHook (...). <br><br><h1>  Configuration of the daemon-archetype plugin. </h1><br>  The parameters groupId, artifactId, version do not deserve special attention, since they are required by any archetype plugin and this is what will be in the corresponding pom.xml tags. <br><br>  With the <b>entry-point-class</b> parameter, you must specify the fully qualified class name, the public static void main (String []) method of which the daemon will call upon startup.  In the case of a java application, you can specify a class with the main method both from the main-artifact * project dependency and from the current project's src / main / java directory. <br><br>  The parameters <b>main-artifact-artifactId, main-artifact-groupId, main-artifact-version</b> indicate a dependency that contains an <b>entry-point-class</b> .  The assembly also packs transitive dependencies for main-artifact *. <br><br>  <b>launcher-name</b> defines the name of the daemon script in the bin directory. <br><br><h1>  Example: gitblit server git daemon. </h1><br>  For the test, create a daemon running the git server.  Having executed the command in the console, or specifying the same parameters in the interactive mode: <br><br><pre> <code class="bash hljs">mvn archetype:generate -DarchetypeGroupId=com.github.igor-suhorukov -DarchetypeArtifactId=daemon-archetype -DarchetypeVersion=0.1 -DgroupId=com.github.igor-suhorukov -DartifactId=gitblit-launcher -Dversion=1.0-SNAPSHOT -Dpackage=com.github.igor-suhorukov -Dentry-point-class=com.github.igorsuhorukov.groovy.GroovyMain -Dlauncher-name=launcher -Dmain-artifact-artifactId=groovy-grape-aether -Dmain-artifact-groupId=com.github.igor-suhorukov -Dmain-artifact-version=2.4.5.4 -DinteractiveMode=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br><img src="https://habrastorage.org/files/937/e0a/df2/937e0adf2bc94f8080543de85e703c9d.png"><br><br>  After we edit the resulting pom.xml, add the following configuration fragment to the program and daemon tags: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">commandLineArguments</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">commandLineArgument</span></span></span><span class="hljs-tag">&gt;</span></span>https://raw.githubusercontent.com/igor-suhorukov/git-configuration/master/gitblit.groovy <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">commandLineArgument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">commandLineArguments</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Execute the command: <br><br><pre> <code class="bash hljs">mvn package</code> </pre> <br>  After building in the target directory, there will be an archive with the daemon: gitblit-launcher-1.0-SNAPSHOT-daemon.tgz and two archives in tgz and zip format with the usual scripts to run the console application gitblit-launcher-1.0-SNAPSHOT-assembly.tgz, gitblit- launcher-1.0-SNAPSHOT-assembly.zip. <br><br>  In our example, the jar file from <b><a href="">com.github.igor-suhorukov will be packaged in a daemon build: groovy-grape-aether: 2.4.5.4</a></b> .  The daemon will start the JVM with the indication of the main class <b>com.github.igorsuhorukov.groovy.GroovyMain</b> and pass the parameter to it the path to the Groovy script <b><a href="https://raw.githubusercontent.com/igor-suhorukov/git-configuration/master/gitblit.groovy">raw.githubusercontent.com/igor-suhorukov/git-configuration/master/gitblit.groovy</a></b> . <br><br>  The Groovy script downloads gitblit.war from the project repository, unpacks it into the user's home directory and replaces the path to the repository repository in the gitblit configuration.  After that, it starts the jetty server and gitblit inside it. <br><br><div class="spoiler">  <b class="spoiler_title">gitblit.groovy</b> <div class="spoiler_text"><pre> <code class="hljs coffeescript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.github.igorsuhorukov.smreed.dropship.MavenClassLoader @Grab(group=<span class="hljs-string"><span class="hljs-string">'org.codehaus.plexus'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>=<span class="hljs-string"><span class="hljs-string">'plexus-archiver'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'2.10.2'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.codehaus.plexus.archiver.zip.ZipUnArchiver @Grab(group=<span class="hljs-string"><span class="hljs-string">'org.codehaus.plexus'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>=<span class="hljs-string"><span class="hljs-string">'plexus-container-default'</span></span>, version=<span class="hljs-string"><span class="hljs-string">'1.6'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.codehaus.plexus.logging.<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.ConsoleLogger @Grab(group = <span class="hljs-string"><span class="hljs-string">'org.eclipse.jetty'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> = <span class="hljs-string"><span class="hljs-string">'jetty-runner'</span></span>, version = <span class="hljs-string"><span class="hljs-string">'9.3.7.RC1'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.eclipse.jetty.runner.Runner def gitblit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(MavenClassLoader.using(<span class="hljs-string"><span class="hljs-string">'http://gitblit.github.io/gitblit-maven'</span></span>).resolveArtifact(<span class="hljs-string"><span class="hljs-string">'com.gitblit:gitblit:war:1.7.1'</span></span>).getFile()) File gitblitDirectory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(System.getProperty(<span class="hljs-string"><span class="hljs-string">'user.home'</span></span>), gitblit.getName().replace(<span class="hljs-string"><span class="hljs-string">'.war'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!gitblitDirectory.exists()){ gitblitDirectory.mkdir() ZipUnArchiver unArchiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipUnArchiver() unArchiver.setSourceFile(gitblit) unArchiver.enableLogging(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConsoleLogger(ConsoleLogger.LEVEL_DEBUG,<span class="hljs-string"><span class="hljs-string">"Logger"</span></span>)) unArchiver.setDestDirectory(gitblitDirectory) unArchiver.extract() def dataPath = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(System.getProperty(<span class="hljs-string"><span class="hljs-string">'user.home'</span></span>), <span class="hljs-string"><span class="hljs-string">'.gitblit_data'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!dataPath.exists()){ dataPath.mkdir() } def webXml = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(gitblitDirectory.getAbsoluteFile(), <span class="hljs-string"><span class="hljs-string">'WEB-INF/web.xml'</span></span>) webXmlText = webXml.text webXml.withWriter { w -&gt; w &lt;&lt; webXmlText.replace(<span class="hljs-string"><span class="hljs-string">'${contextFolder}/WEB-INF/data'</span></span>, dataPath.getAbsolutePath()) } } Runner.main([gitblitDirectory] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> String[])</code> </pre></div></div><br>  You can see a screencast with an example of the creation and operation of a demon. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/2-hDDJmUAh8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  You can create a daemon and scripts to build an application with just one command. </div><p>Source: <a href="https://habr.com/ru/post/307868/">https://habr.com/ru/post/307868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307858/index.html">An example of autocomplete implementation using PostgreSQL tsearch2 FTS engine</a></li>
<li><a href="../307860/index.html">Testing under the SCRUM. Thorns, rakes and successes</a></li>
<li><a href="../307862/index.html">Hardware acceleration of corporate computing</a></li>
<li><a href="../307864/index.html">Go 1.7 release</a></li>
<li><a href="../307866/index.html">Report on attending a YouTube conference in Kiev or Why video content has become a part of life</a></li>
<li><a href="../307870/index.html">Who is to blame and what to do if an IT person is bored at work. Poll results</a></li>
<li><a href="../307874/index.html">Russian and foreign sites for collective financing</a></li>
<li><a href="../307876/index.html">What's new in MS Azure</a></li>
<li><a href="../307878/index.html">Long live Wi-Fi positioning in Enterprise</a></li>
<li><a href="../307880/index.html">Codefreeze and continuous delivery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>