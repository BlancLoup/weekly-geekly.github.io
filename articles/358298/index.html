<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do I generate an XML statform for customs and about combining FCS with tax</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started when it came. Mysterious letter from the Vladimir (?!) Customs. Inside, there was a requirement to provide statistical data on trade wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do I generate an XML statform for customs and about combining FCS with tax</h1><div class="post__text post__text-html js-mediator-article">  It all started when it came.  Mysterious letter from the Vladimir (?!) Customs.  Inside, there was a requirement to provide statistical data on trade with Belarus and Kazakhstan for the entire last year.  And the link to the decree of the sovereign, as it should be. <br><blockquote>  ‚ÄúFor now, if you are bargaining with the countries of the customs union, please accept the answer.  To whom, where, what has sold.  All without a write and write especially the number of the CCD do not forget.  The eye of the sovereign is not a drowsy eye.  The electronic systems of dogs with iron behind you, negligent, are now monitored, therefore not sly.  Remember the deadline. ‚Äù </blockquote><br><img src="https://habrastorage.org/webt/fg/7t/zc/fg7tzcyrdzjgqy1qvysfmpifspi.jpeg"><br><br>  The accountants ran in, the managers started to fuss.  They did not hear about the decree of the century, there was no such sadness for them.  It turned out that it was necessary to register on the Federal Customs Service website a year ago and transfer data on all trade operations with EAEU countries on a monthly basis ( <i>otherwise, an administrative fine of up to 50 thousand rubles for each form. See <a href="http://www.consultant.ru/document/cons_doc_LAW_209907/">N 510-FZ of 12/28/2016</a></i> ). <br><a name="habracut"></a><br><h3>  Customs and Tax: Twins </h3><br><blockquote>  <i>- This one doesn't fit.</i>  <i>But there was such a switch, domestic ...</i> <i><br></i>  <i>- We have one "China", only "China" we sell.</i> <br>  <b>Overheard at the Mitinsky radio market</b> <i>(June 2018)</i> <br></blockquote><br>  In this story I was struck by the sender of the letter.  Vladimir is a small green city, far from external borders and major airports, in the heart of the Non-Black Earth and suddenly customs.  It sounds unusual, as a naval base in the Belarusian marshes. <br><br>  On the other hand, the process of "customs" of all Russia is logical.  There was virtually no production left in the country and imports became the main source of goods.  In these circumstances, the role of customs is difficult to overestimate.  On the agenda is full tracking of the chain from the border to the counter.  Here the number of the "beast" is the CCD - the cargo customs declaration.  I pulled the number of GTE and here are all the data on the product - price, weight, quantity, etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Things are easy - to organize the access of the tax authorities to the customs bases.  And this is solved! <br><br>  In December 2017, there were even rumors about the upcoming merger of the tax department and the Federal Customs Service (FCS), which were dispelled in February 2018 by Igor Shuvalov, now former Deputy Prime Minister. <br><br>  However, the physical integration of the structures is not required - the process of integrating the information systems of the departments has already been launched after the reassignment of the FCS to the Ministry of Finance and Andrei Belyaninov resigned from the post of head of the customs service in 2016. <br><br>  The current head of the FCS, Vladimir Bulavin, Colonel-General of the FSB, by the way, according to Interfax, announced in November 2017 the creation of a two-tier intellectual platform: <i>‚ÄúThe first level is operational, the second is analytical.</i>  <i>The intellectual platform will receive information from the created tracking system.</i>  <i>In accordance with this information, we will control ourselves in the sense of how objectively the participant of foreign economic activity told us and declared the customs value, country of origin, code of the product mix, weight characteristics</i> . <i>‚Äù</i> <br><br>  As it seems, statistical declaring is one of the elements of this system of tracking the movement of goods.  As the introduction of the notorious online cash registers.  The level of state automation is growing, and is there any benefit to entrepreneurs? <br><br>  According to a study by Magram Market Research, conducted in February 2018, the majority of respondents (56%) noted that the replacement of CCP had no effect on the effectiveness of their business.  But the head of the Federal Tax Service Mikhail Mishustin noted that after half a year of work of companies on a new technology, business shows revenues one and a half times more than before the reform. <br><br>  It is worth noting that the information system of statistical declaration is interstate, and by filling in the statistical form you automatically subscribe to the ‚Äúletters of happiness‚Äù of your foreign counterparty and vice versa.  Unless, of course, he buys the product is not on an individual. <br><br><h3>  How to transfer the stat.form </h3><br>  Let's return to our sheep.  By joint efforts at the company, we found out that in order to transfer statistical data, it is necessary to register on the FTS website and enter the ‚ÄúPersonal Account of the Foreign Economic Activity Participant‚Äù.  The button with flags - the service " <a href="https://edata.customs.ru/FtsPersonalCabinetWeb/Services/About/Stat">Statistical Declaration</a> " (Submission of the invoice with EP) <br><br><img src="https://habrastorage.org/webt/3m/7l/sc/3m7lsclkqavaugzllszt_weuwue.jpeg"><br><br>  <b>Then there are two alternatives</b> : either we use the pens to drive in the requisites and an unrealistically huge list with the product nomenclature, or we load the file prepared in advance in the unknown simple mortal format of three letters - XML. <br><br>  We send the form in electronic form with electronic signature.  The form is registered and assigned a unique number. <br><br>  In the absence of EDS, it is necessary to print the form from the site and send it already by registered letter or bring it personally to the customs of the region where the importer / exporter is registered for tax purposes.  (Not our case). <br><br>  They began to dig deeper, how to unload data from "1C".  It turned out the program "1C: Accounting 8" with the included service "1C-Reporting" as if it allows you to send the statform via the Internet directly, without going to the portal of the FCS.  But in the original ancient ‚Äú1C‚Äù seven it is impossible, at the most - exporting the file to Excel.  (It is <i>impossible to get off the sevens, there are so many sophisticated ones there - like an inoperable fragment in the head of a fighter.</i> ) <br><br>  And there is a little time: already 3 months of the new year have passed, not counting the whole of last year.  Appealed to the partners in the customs clearance - a logistics company, but they flatly refused to help.  Who are they after that ?! <br><br>  Accountants found on the Internet a third-party company.  Its employees generated XML for download and asked for 3,000 rubles for each month of the report. <br><br>  The question arose: what to do next? <br><br>  I tried to distance myself as much as possible from this task.  The topic is boring accounting.  However, how much string does not curl ... They came as a crowd.  A terrible longing rolled at me when listening to the details of this, in general, uncomplicated, history. <br><br>  It lasted absolutely until the moment when someone uttered the magic word "Alta"!  They continued to speak, and in my thoughts I was already transported to the beginning of the "zero". <br><br><h3>  "Contrabass" is not only a musical instrument </h3><br><blockquote>  The customs house was located in a long gray building of Brezhnev times of glass and concrete, probably a former scientific research institute.  The dining room huddled at the far end and office workers walked for lunch.  And hefty customs officers caught a wheelbarrow, packed into it and drove the same 100 meters with a breeze.  To go - to lose a lot! </blockquote><br>  Wow, "Alta" still exists!  There were two, two main customs programs.  The girl with whom I was then in a romantic relationship, worked as a specialist in customs clearance.  From her, I learned something about customs, in particular, that people in uniform and businessmen (brokers, declarants, customs clearance specialists) work under the same roof. <br><br>  Customs officers are in full view, for they are on guard of state interests.  In confirmation of this, each customs officer has a "lichku" -a art print with a personal number.  This sacred crimson seal, glowing in the ultraviolet, is affixed to the documents upon release of the cargo: customs clearance. <br><br>  But it is the private owners who work directly with clients, doing all the black paper work.  Theoretically, a person from the street can try to clear their own customs clearance of their goods, bypassing brokers, but this is practically impossible.  And all of their documentation customs clearance specialists are slaughtered in Alta.  Without it, they are like no hands.  (The second similar program, if memory serves, was called "Declarant Plus.") <br><br>  Once, customs officers ran into our company, see a sample of contractual products for the Federal Customs Service.  I was genuinely surprised how unexpectedly these hefty guys in dark green uniform, with thick and bass voices, occupied the whole office space!  The technical director was like a little gnome surrounded by big and good bears. <br><br><h3>  Demo </h3><br>  And it was Alto that the employee from the attracted company advised the accountants to establish.  With the blessing of the Alta Soft manager, they downloaded and installed a free demo version from the official site.  And the demo scored the entire disk of the accounting company. <br><br>  And now, for some reason, it was I who had to explain how to feed the Excel file from 1C to the program and get the desired XML at the output. <br><br>  In my opinion, this is a rare blasphemy to use a powerful and expensive program as a sort of primitive converter.  To the credit of the creators of Alta, this perversion could not be accomplished.  Well, there is no direct import from Excel. <br><br>  True, there was a ‚Äúplaceholder‚Äù program, just for such data manipulations.  All is well, but the total cost of the subscription was prohibitive.  Moreover, all these programs did not solve the desired problem by 100%. <br><br>  And the task seemed primitive - to generate XML from ‚Äú1C‚Äù data, observing certain conditions. <br><br>  The most logical for me is to transfer the arrows to the incoming aunt of the ‚Äú1C‚Äù programmer and forget about it.  But I went the other way.  I was affected by memories of past love or something else, however, I suddenly decided to quickly write a script for generating XML.  Of course on the good old PHP.  Took it up with debugging for two days. <br><br><h3>  PHP script for XML generation </h3><br>  The scheme is simple: we unload the Excel file with the nomenclature of goods from ‚Äú1C‚Äù, open it in Excel and resave it as text separated by tabs.  Now he is ready for feeding php-script. <br><br>  In the browser, an employee fills out a form, attaches a file, and presses a button to generate XML.  The script parses the text file, adds data from the form and generates the required XML. <br><br>  So, first you need to score data for the supplier and the recipient.  Since  The recipients are basically the same - we remember their details, like the sender's data, into the database. <br><br>  For a sample of XML, we take a file from those generated for money reports.  We are checking with the annexes to the <a href="http://www.consultant.ru/cons/cgi/online.cgi%3Freq%3Ddoc%26base%3DLAW%26n%3D190255%26div%3DLAW%26dst%3D100083%252C0%26rnd%3D0.3311946596860884">Decree of the Government of the Russian Federation dated December 7, 2015 No. 1329</a> . <br><br>  In addition, there are additional fields.  I filled them in accordance with the finished XML file generated by this company.  Basically everything is clear, for example, ‚ÄúComposition of vehicles (tractor with semi-trailer or trailer)‚Äù, etc.  But what NSF is and why it is ‚Äúmissing‚Äù remains a mystery.  Sock blue-violet?  Left as is.  (Probably there is a format description on the customs site, it‚Äôs very lazy to go there.) <br><br>  To feed the customs site was successful - do not forget to save XML in UTF-8 encoding.  Glory to the <s>CPSU</s> iconv! <br><br><h3>  Underwater pebbles </h3><br>  As always, in practice it turned out to be more difficult.  Go through the main points. <br><br>  The data to be unloaded directly on the goods is the HS code, product name, price, amount, weight, CCD, country of origin. <br><br>  <b>The HS code</b> is a classifier used for carrying out customs operations.  The code length is 10 digits.  Paste as is. <br><br>  <b>The name of the goods</b> is how the goods are called in the accounting program.  In my opinion, this is a field for customs on the drum, the TN VED code is important to it. <br><br>  <b>The price is</b> needed in rubles and dollars.  The price in dollars is calculated.  The joke is that the dollar is needed at the rate of the Central Bank on the day of shipment.  And do not try to fool customs - the site tracks the currency corridor in the reporting month! <br><br>  Here comes the API of the Central Bank of the Russian Federation.  We transfer http-request with date (DD / MM / YYYY). <br><br> <code>http://www.cbr.ru/scripts/XML_daily.asp?date_req=16/12/2014</code> <br> <br>  In response, we get XML.  Parse it and here is the USD rate for the day you need, with 4 decimal places. <br><br>  <i>Apparently there is a limit on the frequency of requests to the Central Bank website, during the testing of the script, error messages were issued.</i>  <i>After a while, everything worked again.</i> <br><br>  <b>Country of origin</b> - encoded in two Latin letters.  I had to write a separate function, the benefit of the necessary countries a bit.  We look at the alpha 2 alphabetic code on the site: <a href="https://www.alta.ru/information/oksm/">https://www.alta.ru/information/oksm/</a> <br><br>  The classifier of the countries of the Customs Union is great and powerful, only he knows that ‚ÄúKM‚Äù is the Union of Comoros: the island of Anjouan, and ‚ÄúMO‚Äù is the Special Administrative Region of China Macau, and not the Moscow Region at all.  By the way, when you fill out a form in some of your fields, a useful tool with a list of currencies, countries, etc. pops up in your Personal Account. <br><br>  <b>DGT</b> - cargo customs declaration.  The most important and unpleasant, for the "gray" schemes, thing.  It calculates the legality of the goods.  A CCD consists of three, sometimes four groups of digits broken by slashes: <br><br><ol><li>  customs code; </li><li>  the date of acceptance of the CCD (DDMMYY); </li><li>  the serial number of the customs declaration (starts from one from each calendar year); </li><li>  item number in the cargo customs declaration. </li></ol><br>  For XML, we use only the first three groups.  It seemed simple - parseys and insert into XML with separate tags, having previously processed.  However, the site of customs began to swear at some positions.  It turned out that the code of the customs authority (MOT) should always be eight-digit.  If the maintenance code consists of 5 numbers, we add an additional one in front of it: 417 - Kyrgyzstan, 112 - Belarus, 398 - Kazakhstan. <br><br>  How to calculate: Kazakh MOTs start with a five, Belarusian with a two, Kyrgyz with a one.  Like so. <br><br>  <b>Example of the CCD</b> : <i>10130050/280514/0004575</i> . <br><br><img src="https://habrastorage.org/webt/2m/7g/ni/2m7gni4r00bpeosnsw5brqnjhvk.jpeg"><br><br>  <b>Weight of goods</b> .  Weights are substituted in kilograms.  From the end of April 2018, the customs site began to track the corridor of the weights of a group of goods by the TN VED code.  And give an error if the weight of a position is lower or higher than the average.  Sky-high technology in action! <br><br>  Depending on the HS code, it is sometimes necessary to specify the quantity and units. <br><br><h3>  XML loading </h3><br>  The generated XML file is downloaded to the local computer.  We upload it to the customs website through a link to download XML.  The name of the downloaded XML file should be changed to understandable, because  after importing to the Personal Account, the form will be named accordingly. <br><br><img src="https://habrastorage.org/webt/fj/3v/p_/fj3vp_dasgtimzybc0nfivfe-a0.jpeg"><br><br>  Then be sure to go to the loaded form on the icon "Edit" and click the button "Check".  Errors will be displayed in red, and exclamation marks will appear in the problem fields. <br><br><img src="https://habrastorage.org/webt/gb/_7/zw/gb_7zwygvnsrakbp1qmj-5wfqbq.jpeg"><br><br>  Go to the tab "Information about products" and carefully check: <br><br><img src="https://habrastorage.org/webt/u5/uh/94/u5uh94rtjrmgepl3bntryt9rj14.jpeg"><br><br>  Send the form with the button ‚ÄúSend‚Äù in the Actions column.  After this, nothing can be fixed.  After some time, a registration number will be assigned to the form. <br><br>  What is important is that the register of characters of the sender‚Äôs company name must match the register in the electronic signature.  For example, the company in XML is called <i>‚ÄúRomashka‚Äù LLC</i> , and the EOC is issued to <i>‚ÄúDaisy‚Äù LLC</i> - the system will send an error when sending the form. <br><br><h3>  Script work example </h3><br>  Who is interested to see the generation of the report in action - I posted <a href="http://www.aslan4.com/statforma-tamozhnia-online">an example script</a> on the site. <br><br>  You can feed the script data and get the XML "humpback" for the site of customs.  In a text file with a commodity nomenclature we must preserve the structure of the table.  The site has a sample in Excel. <br><br>  In the future, there is a thought to configure from ‚Äú1C‚Äù the unloading of all possible data fields with details, amount and other.  This will allow the site to fill out nothing, except for the course. </div><p>Source: <a href="https://habr.com/ru/post/358298/">https://habr.com/ru/post/358298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358282/index.html">Messenger problems: vanishing messages in Signal for Mac are not permanently deleted</a></li>
<li><a href="../358284/index.html">1000 + 1 way to determine if all items in the list are the same.</a></li>
<li><a href="../358286/index.html">DevConf: promising highload databases</a></li>
<li><a href="../358292/index.html">Apollo graphql client - developing applications on react.js without redux</a></li>
<li><a href="../358296/index.html">Tea, coffee, cookies and a pleasant atmosphere. We invite everyone to the next Hiring Tournament in Moscow</a></li>
<li><a href="../358300/index.html">What are you, what work, summer is coming soon - soon our OpenHack</a></li>
<li><a href="../358304/index.html">Theory of Computation. Introduction to state machines</a></li>
<li><a href="../358306/index.html">Useful techniques for working with arrays in JavaScript</a></li>
<li><a href="../358312/index.html">Xerox PARC has manufactured a self-destruct chip</a></li>
<li><a href="../358314/index.html">On the issue of delays and durations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>