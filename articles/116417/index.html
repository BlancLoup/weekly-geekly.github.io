<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Getting started with the Facebook SDK for iOS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, an important element of the application is the ability to tell your friends, colleagues, and the whole world what you are doing, where and why....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Getting started with the Facebook SDK for iOS</h1><div class="post__text post__text-html js-mediator-article"> Today, an important element of the application is the ability to tell your friends, colleagues, and the whole world what you are doing, where and why.  Social networks help us in this.  Networks, in turn, try to facilitate the work of the programmer and create their SDK.  We will now look at the Facebook SDK for the iOS platform. <br><br>  When I started to deal with the Facebook SDK about a year ago, there was also a version called facebook-iphone-sdk.  She is still working.  But I began to notice strange glitches in the application and decided to check whether something new had happened.  This project turned out to be conserved, and now it is recommended that developers use facebook-ios-sdk, where, as stated, it is still easier.  And as it turned out, they did not lie. <br><a name="habracut"></a><br><br>  Download the SDK from here - <a href="https://github.com/facebook/facebook-ios-sdk">https://github.com/facebook/facebook-ios-sdk</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Xcode 4.0 users can directly download the SDK from the development environment.  To do this, open Organizer, go to the Repositories section, and after the plus sign in the lower left corner, select Checkout or Clone Repository. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/311/05b/f26/31105bf26701b3704da7ce5f048b40a7.png" alt="image"><br><br>  In the Sample directory there is a demo application, which we will refine a little and deal with it on the way.  But he immediately had a problem when trying to start it.  Some project parameters interfere with its compilation in the new Xcode4 and an error is reported about the wrong architecture.  It is necessary to enter the project parameters and just kill everything in the Architecture section and then restore the project to only two parameters: <br>  Architectures - Standard (arms6, arms7) <br>  BaseSDK - Latest iOS (iOS 4.3) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3b/afa/0e9/e3bafa0e9d9cbd67c9c6a038913218bf.png" alt="image"><br><br>  If it didn‚Äôt work, then below I‚Äôm attaching a working draft. <br><br>  After that, our project starts being built, starts up in the simulator and immediately ‚Äúcrashes‚Äù, signaling to the console - ‚Äú2011-03-29 11: 49: 02.301 DemoApp [3098: 207] missing app id!‚Äù.  All because we did not specify the id of our application. <br><br>  Go to <a href="http://www.facebook.com/developers/">http://www.facebook.com/developers/</a> and either choose your existing application or click the button "+ Create a new application."  After a simple registration, the system will notify you, among other things, the ‚Äúapplication ID‚Äù.  He and only we need it in the new version of the SDK.  In the file DemoAppViewController.m we can see the following text: <br><br> <code><a href="http://www.facebook.com/developers/createapp.php"></a> // Your Facebook APP Id must be set before running this example <br> // See www.facebook.com/developers/createapp.php <br> // Also, your application must bind to the fb[app_id]:// URL <br> // scheme (substitue [app_id] for your real Facebook app id). <br> static NSString* kAppId = nil;</code> <br> <br>  Replace nil with our application id.  Do not forget that this is a string.  Let FOR EXAMPLE our id be 11111111111 <br><br> <code>static NSString* kAppId = @"11111111111";</code> <br> <br>  Go to the configuration file Resources / DemoApp-Info.plist and replace the fb value [your-app-id] in the picture with our fb11111111111 - and you should not be confused by the brackets, you need to put the value without them! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/676/91f/366/67691f3662c43dd60ef7d52e1a096585.png" alt="image"><br><br>  Everything!  Now we have a fully working application.  We can run and learn what it can do.  Immediately after launching, we see an invitation to enter.  After typing the email and password, a screen appears asking us if we allow this application to access our data.  Click Allow and get into a very minimal design of the program.  Let's stop on this to find out how it all works now. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/53d/b4d/ee5/53db4dee5100a4f4fd9f7fe06b83e7b7.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/aee/46d/f65/aee46df655b9b51549c93853ab85dd27.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/aca/a30/92f/acaa3092f37d61d64099387752031ff8.png" alt="image"><br><br>  First, take a look at the XIB file. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/341/7ce/a4c/3417cea4c7e0bc6668d18df6e4a01768.png" alt="image"><br><br>  It is extremely simple - 5 buttons.  When you start the application, only FBLoginButton is shown - it is controlled by the class of the same name, which is added to the project.  Take a look at the viewDidLoad method <br><br> <code>/** <br> * Set initial view <br> */ <br> (void)viewDidLoad { <br> //  facebook <br> _facebook = [[Facebook alloc] initWithAppId:kAppId]; <br> [self.label setText:@"Please log in"]; <br> //      <br> _getUserInfoButton.hidden = YES; <br> _getPublicInfoButton.hidden = YES; <br> _publishButton.hidden = YES; <br> _uploadPhotoButton.hidden = YES; <br> _fbButton.isLoggedIn = NO; <br> [_fbButton updateImage]; <br> }</code> <br> <br>  Notice how simple the Facebook class object is now initialized - you need the application id and that's it. <br><br> <code>_facebook = [[Facebook alloc] initWithAppId:kAppId];</code> <br> <br>  when the button is pressed, the method is called: <br><br> <code>/** <br> * Called on a login/logout button click. <br> */ <br> - (IBAction)fbButtonClick:(id)sender { <br> if (_fbButton.isLoggedIn) { <br> [self logout]; <br> } else { <br> [self login]; <br> } <br> }</code> <br> <br>  And if we have not logged in yet, we call the method: <br><br> <code>/** <br> * Show the authorization dialog. <br> */ <br> - (void)login { <br> [_facebook authorize:_permissions delegate:self]; <br> }</code> <br> <br>  where _permissions is setting permissions for various actions on facebook.  In our example, we ask for permissions when initializing our controller. <br><br> <code>- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil { <br> <br> ... <br> _permissions = [[NSArray arrayWithObjects: <br> @"read_stream", @"offline_access",nil] retain]; <br> } <br> <br> ... <br> }</code> <br> <br>  according to the documentation here - <a href="http://developers.facebook.com/docs/authentication/permissions/">http://developers.facebook.com/docs/authentication/permissions/</a> , read_stream is the right to read the tape, and offline_access is the ability of your application to remain attached for much longer.  Without this right, access tokens will burn quickly enough.  We will return to this topic later.  By the way, it was the confirmation of these rights that was requested from us when we pressed the Allow button above. <br><br>  The second important point here is that we have identified ourselves, our class, (self) as a delegate and will receive messages from the facebook object as they become available. <br><br>  Another very important point relates to how we return to our application after authorization.  Remember, we entered some parameters above into the Resources / DemoApp-Info.plist file.  And if we look at the DemoAppAppDelegate.m file, we will see a small method there, which is responsible for returning to our application. <br><br> <code>- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url { <br> return [[controller facebook] handleOpenURL:url]; <br> }</code> <br> <br>  Thus, to summarize.  If you make an application from scratch, then for the SDK to work successfully you should <br><br>  1. Specify the app ID in the code <br>  2. Specify the app ID in the parameters file of your application. <br>  3. In * AppDelegate.m of your application implement the method <br><br> <code>- (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url { <br> return [[controller facebook] handleOpenURL:url]; <br> }</code> <br> <br>  Without the last two items, you will not be returned to your application after the login window. <br><br>  Depending on what you returned to the application with, one of the three methods that we have registered as a delegate is called. <br> <code>/** <br> * ,    . <br> */ <br> - (void)fbDidLogin { <br> [self.label setText:@"logged in"]; <br> _getUserInfoButton.hidden = NO; <br> _getPublicInfoButton.hidden = NO; <br> _publishButton.hidden = NO; <br> _uploadPhotoButton.hidden = NO; <br> _fbButton.isLoggedIn = YES; <br> [_fbButton updateImage]; <br> } <br> <br> /** <br> * ,     . <br> */ <br> -(void)fbDidNotLogin:(BOOL)cancelled { <br> NSLog(@"did not login"); <br> } <br> <br> /** <br> * ,    logout  . <br> */ <br> - (void)fbDidLogout { <br> [self.label setText:@"Please log in"]; <br> _getUserInfoButton.hidden = YES; <br> _getPublicInfoButton.hidden = YES; <br> _publishButton.hidden = YES; <br> _uploadPhotoButton.hidden = YES; <br> _fbButton.isLoggedIn = NO; <br> [_fbButton updateImage]; <br> }</code> <br> <br>  Since we successfully logged in, all our other buttons appeared on the screen.  You can study for yourself what they do;  we will return to them in more detail later.  For example, the ‚ÄúCall Graph API‚Äù button will show you your first and last name, and the ‚ÄúCall REST API‚Äù button will show you the first and last name of a person in id = 4, namely Mike Zuckerberg.  Attempts to find out who is hiding under id = 1 were unsuccessful and the application crashed.  So, anyone can explore this question on their own.  And while I was writing the last paragraph I had to press the Login button again at least several times.  What can be done so that once logged in to the application, you do not need to log in to facebook again.  Now this will do.  All we need to do is save the values ‚Äã‚Äãof two variables in NSUserDefaults.  viewDidLoad will look like this here: <br><br> <code>- (void)viewDidLoad { <br> _facebook = [[Facebook alloc] initWithAppId:kAppId]; <br> <br> _facebook.accessToken = [[NSUserDefaults standardUserDefaults] stringForKey:@"AccessToken"]; <br> _facebook.expirationDate = (NSDate *) [[NSUserDefaults standardUserDefaults] objectForKey:@"ExpirationDate"]; <br> <br> if ([_facebook isSessionValid] == NO) { <br> [self.label setText:@"Please log in"]; <br> _getUserInfoButton.hidden = YES; <br> _getPublicInfoButton.hidden = YES; <br> _publishButton.hidden = YES; <br> _uploadPhotoButton.hidden = YES; <br> _fbButton.isLoggedIn = NO; <br> [_fbButton updateImage]; <br> } else { <br> [self.label setText:@"logged in"]; <br> _getUserInfoButton.hidden = NO; <br> _getPublicInfoButton.hidden = NO; <br> _publishButton.hidden = NO; <br> _uploadPhotoButton.hidden = NO; <br> _fbButton.isLoggedIn = YES; <br> [_fbButton updateImage]; <br> } <br> }</code> <br> <br>  we check whether the session is valid (isSessionValid) with the accessToken and expirationDate parameters saved in our NSUserDefaults.  If yes, then we are already logged in and can perform further actions. <br><br>  we add to the fbDidLogin and fbDidLogout methods respectively <br><br>  fbDidLogin - write parameters <br><br> <code>[[NSUserDefaults standardUserDefaults] setObject:self.facebook.accessToken forKey:@"AccessToken"]; <br> [[NSUserDefaults standardUserDefaults] setObject:self.facebook.expirationDate forKey:@"ExpirationDate"];</code> <br> <br>  fbDidLogout - reset them <br><br> <code>[[NSUserDefaults standardUserDefaults] setObject:nil forKey:@"AccessToken"]; <br> [[NSUserDefaults standardUserDefaults] setObject:nil forKey:@"ExpirationDate"];</code> <br> <br>  We run our application, log in, check our name - everything is fine.  Without pressing Logout, we stop our application and start it again - we see that we are still on Facebook - we check our name - everything works.  Let me remind you that it was for this that we were right in asking for the right @ "offline_access".  This version of the project can be downloaded below. <br><br>  And in conclusion of today's article, let's see how the query mechanism and response processing work. <br><br>  Facebook is urging us to use the GRAPH API, rather than using the old REST API, which is nonetheless still supported.  On this page ( <a href="http://developers.facebook.com/docs/reference/api/">http://developers.facebook.com/docs/reference/api/</a> ) we can see examples of using the GRAPH API and see the output of information for you.  In the demo program, facebook uses this request: <br><br> <code>- (IBAction)getUserInfo:(id)sender { <br> [_facebook requestWithGraphPath:@"me" andDelegate:self]; <br> }</code> <br> <br>  for example, they show what the output will be with such a request <br>  <a href="https://graph.facebook.com/btaylor">graph.facebook.com/btaylor</a> <br><br>  { <br>  "Id": "220439", <br>  "Name": "Bret Taylor", <br>  "First_name": "Bret", <br>  "Last_name": "Taylor", <br>  "Link": " <a href="http://www.facebook.com/btaylor">www.facebook.com/btaylor</a> ", <br>  "Username": "btaylor", <br>  "Gender": "male", <br>  "Locale": "en_US" <br>  } <br><br>  This means that we will receive an NSDictionary in response and will be able to get our full name using the key ‚Äúname‚Äù.  After we sent the request and assigned the recipient of the response, we need to make the methods responsible for receiving the response.  For receiving an unprocessed (raw) response is responsible <br><br> <code>- (void)request:(FBRequest *)request didReceiveResponse:(NSURLResponse *)response { <br> NSLog(@"received response"); <br> }</code> <br> <br>  and the parsed answer accepts: <br><br> <code>- (void)request:(FBRequest *)request didLoad:(id)result { <br> if ([result isKindOfClass:[NSArray class]]) { <br> result = [result objectAtIndex:0]; <br> } <br> if ([result objectForKey:@"owner"]) { <br> [self.label setText:@"Photo upload Success"]; <br> } else { <br> [self.label setText:[result objectForKey:@"name"]]; <br> } <br> };</code> <br> <br>  The answer (result) can be a number, string, array or dictionary.  If the answer came to us at once as NSArray, then several answers came to us at once and we need to break them down into separate answers.  In this case, when we asked to tell who we are (me) are, the answer comes to the NSDictionary and there is no owner key, and therefore this line is called: <br> <code>[self.label setText:[result objectForKey:@"name"]];</code> <br> <br>  Let's complicate things.  For example, I want to get in the application information about what the user likes.  Change the request according to the documentation for: <br><br> <code>- (IBAction)getUserInfo:(id)sender { <br> [_facebook requestWithGraphPath:@"me/likes" andDelegate:self]; <br> } <br></code> <br><br>  If you look at the Facebook site for the output of this request, you will see that the answer is the NSDictionary with only one data key.  It will correspond to an array of NSDictionary objects with the keys ‚Äúname‚Äù, ‚Äúcategory‚Äù, ‚Äúid‚Äù, ‚Äúcreated_time‚Äù.  It is also important not to forget to add ‚Äúuser_likes‚Äù to the requested rights, otherwise an empty NSDictionary object will return to our response! <br><br>  To accept this answer, we will rewrite our method. <br><br> <code>- (void)request:(FBRequest *)request didLoad:(id)result { <br> if ([result isKindOfClass:[NSArray class]]) { <br> result = [result objectAtIndex:0]; <br> } <br> if ([result objectForKey:@"owner"]) { <br> [self.label setText:@"Photo upload Success"]; <br> } else if ([result objectForKey:@"data"]){ <br> NSArray *likes = [result objectForKey:@"data"]; <br> NSString *text=@"You don't like Steve"; <br> for (NSDictionary* mylike in likes) { <br> NSString *mylikeName = [mylike objectForKey:@"name"]; <br> if ([mylikeName isEqualToString:@"Steve Jobs"]) { <br> text=@"You like Steve"; <br> break; <br> } <br> } <br> [self.label setText:text]; <br> } <br> };</code> <br> <br>  If we received the answer in the form of NSDictionary, and there is a value by the key ‚Äúdata‚Äù, then we go through this array, looking into each object and check if there are any pages among the facebook pages that the user likes, with the name Steve Jobs.  I was so, so the application gave me "You like Steve". <br><br>  I‚Äôll stop on this for now, although I would like to tell you what interesting options there are for forming a message on the wall from the application.  But apparently it will be next time. <br><br>  <a href="">The project is original</a> , but with amendments in the properties to run in Xcode4 <br><br>  <a href="">Project</a> with added ability to save session <br><br>  <a href="">Project</a> with a modified request <br><br>  Only you will need to put your appID in them :) <br><br>  ps and I also love formatting code on Habr√© :) </div><p>Source: <a href="https://habr.com/ru/post/116417/">https://habr.com/ru/post/116417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116412/index.html">Jabber and Twitter via IRC</a></li>
<li><a href="../116413/index.html">Flying robots juggle the ball</a></li>
<li><a href="../116414/index.html">TeamLab: store and edit documents directly on the corporate portal</a></li>
<li><a href="../116415/index.html">DIY tuning: remove the 3G modem inside the laptop</a></li>
<li><a href="../116416/index.html">Yii 1.1.7</a></li>
<li><a href="../116419/index.html">Architecture Orchard CMS. Basic concepts</a></li>
<li><a href="../116420/index.html">Amazon launches free file and music storage</a></li>
<li><a href="../116421/index.html">The rules of good tone when working in "Photoshop"</a></li>
<li><a href="../116422/index.html">VIM plugins that you should know about, part 2: repeat.vim</a></li>
<li><a href="../116424/index.html">Internet architect Paul Baran died at the age of 84</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>