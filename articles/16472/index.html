<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>django.newforms: Using</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Occasionally working on my personal project, I got to the task of making a form ... A form for adding a place. The problem is that it is not quite typ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>django.newforms: Using</h1><div class="post__text post__text-html js-mediator-article">  Occasionally working on my personal project, I got to the task of making a form ... A form for adding a place.  The problem is that it is not quite typical.  I decided to write about this article, which will help to penetrate deeper into newforms for beginners. <br><a name="habracut"></a><br>  It all started simply with this code: <br><br><pre> from django import new forms as forms &lt;br /&gt;
 class AddPlaceForm (forms.Form):
     title = forms.CharField (max_length = 50)
     category = forms.IntegerField ()
     text = forms.CharField (widget = forms.Textarea)
     tags = forms.CharField (max_length = 50))
     city ‚Äã‚Äã= forms.IntegerField ()
     metrostation = forms.IntegerField (null = True)
     adress = forms.CharField (max_length = 255)
</pre><br><br>  But then a thought appeared, but not one: <ul><li>  I che, mlyat, quite moron check all these numbers? </li><li>  I, mlyat, absolutely moron handles to hammer all values ‚Äã‚Äãinto the form? </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All these thoughts concern the category, metrostation and city fields.  The issue of validating values ‚Äã‚Äãwas solved easily.  A new field class has been created and a clean () method has been added to it, which looks like this: <br><br><pre>     def clean (self, value):
	 from my.site.models import Category
	 try:
		 item = Category.objects.get (pk = value)
        	 return item
	 except ObjectDoesNotExist:
		 raise forms.ValidationError (u'Invalid input ')
</pre><br><br>  In addition to all the charms, in clean_data ['category'] we will already have an object ready for use.  Further grief followed, it is necessary to create this for each field object.  Plus, I still haven't solved the problem with automatic filling with values.  Therefore, it was decided to create a universal class. <br><br><pre>  class SelectFromModel (forms.Field):
     widget = forms.Select ()
     def __init __ (self, objects, * args, ** kwargs):
         self.objects = objects
         super (SelectFromModel, self) .__ init __ (* args, ** kwargs)
         self.loadChoices ()
     def loadChoices (self):
         choices = ()
         for object in self.objects.order_by ('title'):
             choices + = ((object.id, object.title),)
         self.widget.choices = choices
     def clean (self, value):
         value = int (value)
         for cat_id, cat_title in self.widget.choices:
             if cat_id == value:
                 return self.objects.get (pk = cat_id)
         raise forms.ValidationError (u'Invalid input ')

 Accordingly the form
 class AddPlaceForm (forms.Form):
     title = forms.CharField (max_length = 50)
     category = SelectFromModel (objects = Category.objects.all ())
     text = forms.CharField (widget = forms.Textarea)
     # More on this later
     tags = TagField ()
     city ‚Äã‚Äã= SelectFromModel (objects = City.objects.all ())
     metrostation = SelectFromModel (objects = MetroStation.objects.all ())
     adress = forms.CharField (max_length = 255)
</pre><br><br>  So, what is this, and most importantly "nahto."  I created a descendant of a regular field in which I defined the default widget as forms.Select (which is the usual drop-down list), the data in which is loaded automatically when the field is created.  At the same time, we do not lose flexibility ... We even add.  For example, order_by ('title') in the fill cycle is superfluous (but I did it purposefully, in order not to add sorting each time when creating the field).  What is the flexibility.  Even when defining a form (more precisely, a form field), we define a circle of objects for which we want the user to make a choice.  More precisely, we pass the object request to the object by which to select these objects (LazyLoad).  Also, the flexibility lies in the fact that we can easily change the widget to something similar to Select (which, in principle, is planned in the future). <br><br>  Next came the question with the tag field.  It will be used in many forms, so it was decided to put it in a separate class, since it is planned to modernize it (autocompletion, tag separation methods, etc.).  Principle, here's the code: <br><br><pre>  class TagField (forms.CharField):
     def clean (self, value):
         from daparty.site.models import Tag, TagCynonym
         tags = value.split (',')
         resoult = []
         for tag in tags:
             tag = tag.strip (). lower ()
             # We are looking in existing tags or create
             dbtag = Tag.objects.get_or_create (title = tag)
             resoult.append (dbtag)
         return resoult
</pre><br><br>  In fact, we simply see if there is such a tag in the database, if not - create, if there is, select and give the list as a cleaned result.  You also need to think about how to do the reverse operation on the machine (tag objects in a string), but let it be homework (in order to hide the author‚Äôs incompetence in this matter :).  Many may also notice the TagCynonym class.  I am still thinking about how to make more intelligent the comparison of different tags (porno - porno). <br><br>  References: <br><ul><li>  <a href="http://www.djangoproject.com/documentation/newforms/">Newforms documentation</a> </li><li>  <a href="http://rt.daparty.ru/2007/11/django-newforms.html">Original</a> </li></ul><br><br>  <b>UPD:</b> That's interesting, for what they lower karma?) Probably PHP lovers))) </div><p>Source: <a href="https://habr.com/ru/post/16472/">https://habr.com/ru/post/16472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../164707/index.html">Drupal: we write the parser for Feeds</a></li>
<li><a href="../164709/index.html">Work with Freebase from .NET</a></li>
<li><a href="../16471/index.html">Keyboard for disabled</a></li>
<li><a href="../164711/index.html">Simulation of life in the Darwinbots system. I. First acquaintance</a></li>
<li><a href="../164717/index.html">Optimize SQL Server performance using indexes</a></li>
<li><a href="../164721/index.html">Porting Qt4 application to Qt5</a></li>
<li><a href="../164725/index.html">Experience creating a game for smartphones</a></li>
<li><a href="../164727/index.html">How to add realism to path tracing</a></li>
<li><a href="../164729/index.html">Tricks sysadmins</a></li>
<li><a href="../164731/index.html">Solve 9 Windows Server 2008 management tasks using PowerShell. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>