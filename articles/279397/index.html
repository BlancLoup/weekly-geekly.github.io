<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Anatomy of document editors: a common code for online and offline versions of ONLYOFFICE editors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If someone asked us what day it is today, we would answer that today is the Big Day. The day when we finally release the desktop editors ONLYOFFICE . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Anatomy of document editors: a common code for online and offline versions of ONLYOFFICE editors</h1><div class="post__text post__text-html js-mediator-article">  If someone asked us what day it is today, we would answer that today is the Big Day.  The day when we finally release the <a href="http://www.onlyoffice.com/ru/download-desktop.aspx%3Futm_medium%3Dblog%26utm_source%3Ddesktop_release%26utm_campaign%3Dhabr">desktop editors ONLYOFFICE</a> .  Those that work without a browser / Internet and send the document directly to the printer. <br><br>  Yes, we are the guys who for a long time were engaged exclusively in online editors, and then made offline applications.  First, despite the growing popularity of online editors, most users continue to prefer desktops.  Secondly, we ourselves have long wanted to get away from the limitations of the browser and speed up the work with editors. <br><br>  The main feature of our desktop editors in their relationship with online editors - they are united by a common source code.  In this article we will explain a little why we decided to make desktops in this way and reveal the secrets of their anatomy, namely - how they differ from the online version, how they are arranged and what we plan to change in the future. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/aba/283/798/aba283798f51479885a0dcbb5151759b.png"><br><a name="habracut"></a><br><h1>  What are the advantages of offline editors to online </h1><br><br>  In this still a bit of the introductory part of the text, we recall that we really love online editors, but not always.  Some moments are very sad.  Look at the confused face of a user who just tried to copy something from his document, but was faced with an urgent recommendation to use the keyboard?  And this poor fellow who just wanted to print, and now downloads pdf?  Or is it unfortunate with chopped off the Internet?  In general, everyone has already guessed where we are going.  Desktop editors have undoubted advantages, and here are the ones: <br><br><ul><li>  The possibility of local work, even in the absence of the Internet (we hope this will never happen to you); <br></li><li>  Use of computer resources.  We can realize many things better, many functions work faster. <br></li><li>  Local fonts.  Fonts will be taken from the user's computer, that is, if the user adds a new font to his computer, then the next time the editor starts, it will also pick it up.  In the case of online editors, the fonts must first be installed on the server. <br></li><li>  The ability to directly send a document to print.  In online, the seal of a document is understood as saving it in pdf.  After that, the user must take action to send the document to the printer. <br></li><li>  Full use of the clipboard. <br></li><li>  Local spell checker.  It's just faster than the online version, in which the word for verification is sent to the spellchecking server. <br></li><li>  Localization of the language.  In the desktop version, the language for checking is set automatically, while online you have to choose the language for checking spelling of individual words and paragraphs. <br></li><li>  The ability to go Online-Offline-Online when disconnecting and then connecting the Internet. <br></li></ul><br>  So, we were sure that we wanted to make desktops.  But we had to answer the question: how? <br><br><h1>  Methodology </h1><br><br>  <b>Variant which we refused</b> : native applications.  Although we also believe that nothing could be cooler than the native application, force majeure circumstances forced us to abandon this idea due to the complexity and cost of its implementation. <br><br>  If we chose this option, we would need to rewrite the code of the editors and the entire visualization.  In addition, in the future there would be a question of synchronizing updates with the web version of the editors.  We would get two codes that do the same thing and would do double work, correcting something in each of them. <br><br>  <b>The variant that we chose</b> is to use the existing js code of the ONLYOFFICE editors.  The advantages of this approach are obvious - the development is not so complicated, and the update and the web version, and the desktop are convenient, since the code is the same. <br><br>  <b>What we wanted</b> : <br><br>  1. One js / c ++ communication code. <br><br>  2. Cross-platform GUI. <br><br>  3. To have the opportunity in the future to switch to the native drawing scheme.  The editor code itself remains javascript, but at the same time we should be able to redo the drawing (which is the main brake on the application). <br><br>  <b>What we have chosen</b> : <br><br>  1. In order to fulfill the first requirement, we needed a browser engine for all platforms.  Since we are very familiar with V8, which, by the way, is used on the server for assembling versions of files, we were originally going to take Chromium in one form or another. <br><br>  2. Here, too, did not think long.  Qt is very common and convenient.  Plus, again, there was experience with this library. <br><br>  3. For now these are only plans.  But the point is that js - the editor is spinning separately, implementing all the functionality, and the display, measurement of the text would be native.  By the way, this is how we already have a mobile application for iOS. <br><br><h1>  Little about drawing </h1><br><br>  As long as the native rendering is only in the plans, we needed a conditional cross-platform WebView.  We had a few ideas. <br><br>  <b>Options:</b> <br><br>  <u>1. Out-of-the-box solutions</u> that we could use, since we still chose Qt, i.e.  either <u>QWebView</u> or <u>QWebEngineView</u> . <br><br>  Of course, if we were to stop at one of them, the main advantages would be that all the main work has already been done for us.  It would seem nice, but the disadvantages are still outweighed. <br><br>  QWebView is no longer developed by developers, it is very, very slow and works in the same process as the application.  For us, this was critical, because the designers wanted a ‚Äútab-based‚Äù interface, which implies opening and working in several documents at once.  Thus, if a problem occurred in one document, it would lead to problems in all tabs. <br><br>  QWebEngineView is a fairly new control, actively developing and based on Chromium.  It works in its process and is much faster than QWebView.  But he did not fit.  First, because of the impossibility of normal operation with native code in the process in which the js code works.  Such communication is organized through webkets, which is inconvenient.  Secondly, on 4K monitors, for some reason, drawing began to slow down. <br><br>  2. <u>Pure Chromium</u> .  Pros - speed and full functionality.  The recently released Visual Studio Code from Microsoft, implemented in just this way, made serious attention to this method. <br><br>  3. <u>Chromium Embedded Framework</u> .  This is a convenient Chromium wrapper, with regularly laid out collected versions (cefbuilds.com).  Plus - much easier than the second paragraph.  Minus - we lose some of the functionality (many are wrapped and issued as API, but not all). <br><br>  We rejected the standard approaches immediately, but options 2 and 3 approached us.  Of these, we chose a simpler solution, that is, the Chromium Embedded Framework.  As a result, cef-based implemented CefWebView, fully satisfying our needs. <br><br>  <b>Scheme of the application</b> <br><br>  The resulting application works as follows: <br><br><img src="https://habrastorage.org/files/f53/67c/f37/f5367cf378494cb2ba4b217de03b514d.png"><br><br>  That is: when creating a V8 context, we embed our object, thereby gaining access to the native code from js.  Further, if it is necessary to transfer data to another process (for example, to ui), we use the interprocess interaction mechanism built into the cef by sending messages.  Similarly, we send messages from other processes to the js process. <br><br><h1>  Xcode for MacOS </h1><br><br>  And yet, not all eventually implemented as planned.  For example, an application under MacOS was made not on Qt, but using XCode. <br><br>  The fact is that we use QTabWidget for tabs with editors, and under MacOS it is quite slow.  This is essentially a simple drag-and-drop of tabs, but in order for everything to work fine, it was necessary to implement this control from scratch.  We did not want to do this.  Still, we have a little native interface, and it was much more convenient to develop for MacOS using Xcode. <br><br><h1>  Results </h1><br><br>  We got what we planned.  The application works under all systems and does it with dignity.  It is convenient and suitable for those who want to work offline, and at the same time suggests the possibility of connecting portals, which will allow you to use collaborative editing tools and work on documents together with other team members. <br><br>  For us, this is an interesting new field of activity and more opportunities to do what we love (to constantly improve something).  Future plans?  A lot of them.  First of all, you need to correct the bugs of the editor (JS code), add the necessary functionality (footnotes, table of contents, summary tables, animation, 3D effects).  And then - go to the native drawing. <br><br>  PS You can download the application from our <a href="http://www.onlyoffice.com/ru/download-desktop.aspx%3Futm_medium%3Dblog%26utm_source%3Ddesktop_release%26utm_campaign%3Dhabr">official site</a> .  And (almost forgot!) - ONLYOFFICE desktop editors are free for personal use.  ONLYOFFICE cloud solution users who have paid for a subscription for 1 or 3 years can get desktop applications for free.  For users of the server version of ONLYOFFICE Enterprise Edition - 25 licenses for desktop applications are already included in the subscription price. </div><p>Source: <a href="https://habr.com/ru/post/279397/">https://habr.com/ru/post/279397/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279383/index.html">Work with VK API when creating a game for VKontakte</a></li>
<li><a href="../279385/index.html">Work with events in Laravel. Sending push notifications when publishing an article</a></li>
<li><a href="../279389/index.html">Azure-IaaS-Digest number 3 (March)</a></li>
<li><a href="../279393/index.html">Parallel noise and random number functions for OpenCL cores</a></li>
<li><a href="../279395/index.html">Windows 2008 R2 on HP DL380 G4p</a></li>
<li><a href="../279403/index.html">Update KB3035583 can automatically update Windows 7 to Windows 10</a></li>
<li><a href="../279405/index.html">Register for the ‚ÄúEasy Cloud Protection of Corporate Network with Low Total Cost of Ownership‚Äù webinar</a></li>
<li><a href="../279407/index.html">Is Grounded in a 2D Platform: How to find out if a character is worth it?</a></li>
<li><a href="../279409/index.html">Parsers to all! Analyzing and testing existing HTML parsers</a></li>
<li><a href="../279411/index.html">Sports betting fraud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>