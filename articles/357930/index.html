<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making the PC turn on cotton per evening</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 In childhood, watching many American films, was delighted with the way the actors turned off the light in the room "clapping their hands", ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making the PC turn on cotton per evening</h1><div class="post__text post__text-html js-mediator-article"><h4>  <b>Foreword</b> </h4><br>  In childhood, watching many American films, was delighted with the way the actors turned off the light in the room "clapping their hands", I always wanted the same thing at home.  In recent years, the PC has become an integral part of my life: coming home and having lost your shoes, the first step is to turn on your ‚Äúiron horse‚Äù and wait for it to load.  Of course, in recent years, with the advent of SSD, this expectation has been minimized, but nevertheless, along with the approach to the computer, some time is lost.  Yes, and actually why bother to go into the room at all, beat the button with your feet, if you can do some kind of remote way to turn on "my charms." <br><br>  Actually, over time, two ‚Äúdreams‚Äù merged: to turn on the PC for cotton.  At the moment I am studying at the university and the time has come to do coursework on circuitry, and the teacher said that you can make it in hardware and not on paper, which is more interesting in my opinion.  Thus, the chance to ‚Äúkill two birds with one stone‚Äù turned up - to implement the old idea and pass the course project.  The initial idea was to make some device that can be placed on the case, power it from the power supply, connect it to the button via a relay and clap the loop.  As a result, they decided to move away a little from this idea by expanding it a bit: the system will now consist of two blocks connected via Bluetooth.  One block will pick up the clap and send a special signal to the second block, the second block will receive this signal and close the relay. <br><a name="habracut"></a><br><h4>  <b>Where to begin</b> </h4><br>  First of all, it was necessary to decide on which hardware to implement my project.  The choice fell on the Arduino platform.  Why precisely Arduino?  In this article, I will not list the technical characteristics of this platform at least because it is not about this.  Actually the answer to this question lies in three reasons: <br><br><ul><li>  Cheapness - in China, microcontrollers with this platform can be found for $ 5 or even less </li><li>  Ease of use - on the Internet a lot of guides on this platform and to understand them is easy </li><li>  A huge number of all kinds of sensors </li></ul><br>  The latter way is important for those who want to do something else with their microcontroller.  After all, the next day you can screw something else on the board, reflash it and it will perform completely different tasks.  In general, back to our topic. <br>  Actually make a list of what we need for this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  2x Arduino Uno R3 - one for each unit </li><li>  2x Bluetooth HC-05 - Again, one for each unit, and the main thing is HC-05, because only they support the Master and Slave modes </li><li>  The microphone is a simple electret microphone, it costs only a penny. </li><li>  Relay </li><li>  2x LEDs - red and green </li><li>  Any wiring, resistors, etc. </li><li>  And of course the soldering iron </li></ul><br><h4>  <b>Getting started</b> </h4><br><h5>  Consider our microcontroller </h5><br><img src="https://habrastorage.org/getpro/geektimes/post_images/7b6/948/8ec/7b69488ec1909f0dba154eed2dda87b9.jpg" alt="image"><br><br>  As you can see, it has analog pins signed with the letter A (for example, A0), inputs for external power, outputs for power supply + 5V and + 3.3V, digital pins, outputs to the ground, etc. <br><br>  You can connect it to your computer via USB, the benefit comes with a cable.  And even if you don‚Äôt have one, you can buy it at any electronics store.  To work directly with Arduino there is their own very convenient IDE, which can be obtained from the <a href="https://www.arduino.cc/">official site</a> . <br><br><h6>  In order to continue to work with Arduino, you must still tell at least a little about it. </h6><br>  Microcontrollers for Arduino are distinguished by the presence of a bootloader pre-flashed in them.  Using this bootloader, the user loads his program into the microcontroller without using traditional individual hardware programmers.  The loader connects to the computer via the USB interface (if it is on the card) or using a separate UART-USB adapter.  Bootloader support is built into the Arduino IDE and runs in one click. <br><br>  In case of overwriting the bootloader or buying a microcontroller without a bootloader, the developers provide the opportunity to flash the bootloader into the microcontroller on their own.  For this, the Arduino IDE has built-in support for several popular low-cost programmers, and most Arduino boards have a pin-in connector for in-circuit programming (ICSP for AVR, JTAG for ARM). <br><br>  The Arduino programming language is a standard C ++ (using the AVR-GCC compiler) with some special features. <br>  Programs written by the Arduino programmer are sketches (or sometimes sketches - barbarism from an English sketch) and are saved in files with the ino extension.  These files are processed by the Arduino preprocessor before compilation.  It is also possible to create and connect standard C ++ files to the project. <br><br>  So, after downloading the Arduino IDE from the official site and installing it, open it and see it: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/009/f66/183/009f66183dcbac7c1a2d3ab6ad20743e.jpg" alt="image"><br><br>  Our sketch is divided into 2 blocks - setup () and loop ().  The first block is written what should be initially initialized when the controller is turned on in the network.  In the second - the actual code itself, which will be executed continuously.  Actually all this follows from the names of these blocks. <br><br><h5>  <b>First block</b> </h5><br>  First of all, it was necessary to assemble and connect a microphone.  In fact, the electret microphone that we bought is a kind of two-leg capacitor: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/4f2/944/6e5/4f29446e5f9ebc3ffacf12db1dac9faa.jpg" alt="image"><br><br>  The leg with the characteristic three stripes, as in the image above, is the ‚Äúminus‚Äù of the microphone, respectively, the second leg is the ‚Äúplus‚Äù, the main thing is not to confuse, otherwise the microphone will not work.  Actually a good googling, it turned out that in the first place you simply wouldn‚Äôt connect a microphone, and secondly the signal would be very weak, that is, you would most likely need an operational amplifier.  On the seller‚Äôs website, where the microphone was bought, there was such a scheme: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/8c9/fa6/05f/8c9fa605f36983049253335061350bc2.gif" alt="image"><br><br>  Without amplifiers, just an RC circuit, I thought I wasn‚Äôt, I‚Äôll collect and see if it works or not.  The blessing of the house lay the necessary resistors and a capacitor.  Also for the reliability of the connection, so that it does not dangle on the wires in the air, take the PCB, which is also sold in any store of radio components.  It turned out something like this: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/db6/0fd/58b/db60fd58b30891b2defb60cb23499a00.jpg" alt="image"><br><br>  It may not be very neat, but the main thing to work remains to be checked.  Our microphone now has 3 legs: + 5V, GND (ground) and analog output.  Connect these legs, respectively, to 5V, GND and A0 input of the controller.  Iii after a lot of trial and error, everything turned out!  The microphone really works.  The Arduino ADC outputs values ‚Äã‚Äãfrom 0 to 1024. It remains to connect two LEDs for at least some visual interaction with the system.  It is impossible to connect the LED directly to the power supply; otherwise, we will burn it.  To avoid this, we hang on the "+" LED resistor 220 OM. Usually a short leg is a minus, and a long leg is a plus.  So the ‚Äú-‚Äù LED is connected to the GND output on the board, and the ‚Äú+‚Äù to the digital output.  Since we have 2 LEDs, we‚Äôll make a common ground for them, connect red to 13 pin and green to 12th.  When registering at least some sound will turn on a red LED.  If we register the sound first, then silence for some time, and then the sound again, then we light the green LED.  In fact, everything is simple.  And in practice it turned out too. The sketch itself turned out like this: <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MIC A0 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// ,    int ClapMargin = 9; //  ( ) int mic_prev = 0; int SilenceLen=1500; //  int NextClapLen = 2500; //,     .  int SkipLen = 800; //   void setup() { analogReference(INTERNAL);//     1.1     Serial.begin(9600); pinMode(12, OUTPUT); pinMode(13, OUTPUT); } int ReadNext() { int result; int d; d = analogRead(MIC); // result = abs(mic_prev-d); //   mic_prev = d; //   return result; //  } int WaitForClap(int WaitLen) { int d, i; i = 0; //  do { d = ReadNext(); //  i++; //  if (d &gt; ClapMargin) { //   Serial.println(d); return d; //   } if ( (WaitLen != -1) &amp;&amp; (i &gt;= WaitLen) ) { //    WaitLen  WaitLen   -1 return 0; // 0 } } while (1); } //-   SkipLen  void Skip(int SkipLen) { int i; for (i=0; i&lt;SkipLen; i++) { ReadNext(); } } void loop() { int d1, d2; if(WaitForClap(-1)&gt; ClapMargin)//  { digitalWrite(12, HIGH);//   Serial.println("raz"); Skip(SkipLen); d1 = WaitForClap(SilenceLen); //  Serial.println(d1); if (d1 == 0) { digitalWrite(12, HIGH); Skip(500); d2 = WaitForClap(NextClapLen); // 2  if (d2 &gt; ClapMargin) { digitalWrite(12, LOW);//   digitalWrite(13, HIGH);//   delay(1000); } } } digitalWrite(12, LOW);//   digitalWrite(13, LOW); Skip(SkipLen); }</span></span></span></span></code> </pre> <br>  So, we learned to catch the necessary signal, it remains to inform the second block about the presence of cotton.  To do this, we need Bluetooth modules.  I took the Bluetooth hc-05 shield, which looks like this: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/80e/ea9/8ad/80eea98ad0899f0cb1c69396a1a143b2.jpg" alt="image"><br><br>  Simply we connect it to our Uno pin to pin, so we connect the module itself and duplicate the outputs of our board.  It should look something like this (Shields can be in several different variations, the essence is the same): <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/217/86b/7f7/21786b7f78506d968d3e597f51a9916c.jpg" alt="image"><br><br>  Also on the Bluetooth Shield you can see a lever that has two positions: H and L. H-mode Master (Master), L-mode Slave (Slave).  In this case, put the lever on the Master.  So, having connected the bluetooth module, we can connect our LEDs and a microphone to the same pins from above.  In general, with this block finished, go to the next. <br><br><h5>  <b>Second block</b> </h5><br>  In the second block, we will need an electromagnetic relay, a double external socket, a wire for connecting to a 220 V electrical network, and another Bluetooth Shield HC-05. <br><br>  Shield is connected to the board in exactly the same way, the only difference will be that the lever must be set to L - SLave mode. <br>  One outlet will be constantly energized to power the unit, the second will be shorted to the relay, so it will be possible, then supply the mains voltage to it, then remove it. <br><br>  So we connect the relay.  The principle of its operation is simple and consists in the following: 2 of the legs of the relay are wound on an inductor, applying voltage to it creates an electromagnetic field, which attracts the so-called anchor inside the relay, thereby closing the circuit.  Removing the voltage from the coil, the anchor returns to its original state, breaking the circuit.  Thus, the relay is a kind of key. <br><br>  So, we need a relay, which, when applied to a 5V coil, will close the circuit to us.  In this case, you need to choose a relay that can pass the currents necessary to turn on the PC.  Given that most modern PCs consume from 450 W to 1000 W, we are more than enough relay passing through a current of 6 Amps.  In the nearest electronics store, this Chinese tianbo hjr-3ff-sz was acquired: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/51f/f71/46e/51ff7146e35627840afb6d7ea585b3a9.jpg" alt="image"><br><br>  As you can see, he has 5 legs, 2 of which are on the coil, it remains only to find out which ones.  To do this, google it and find the following scheme: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/a0d/92c/856/a0d92c856483e1f17c6dfdc88d94dac3.jpg" alt="image"><br><br>  Connect the 2nd leg to the GND board, and the 5th to the 13th digital output.  The socket itself is connected to the 1st and 3rd leg of the electromagnetic relay so that the initial state of the socket is turned off.  The block is ready, it remains only to load the sketch.  Code for this block: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt;//    Bluetooth #include &lt;Wire.h&gt; #define rxPin 2 #define txPin 3 SoftwareSerial btSerial(rxPin, txPin); void setup() { // put your setup code here, to run once: // Bluetooth Serial.begin(9600); pinMode(rxPin, INPUT); pinMode(txPin, OUTPUT); btSerial.begin(38400); pinMode(13, OUTPUT);// 13     } void loop() { // put your main code here, to run repeatedly: if(btSerial.available()) { char c=(char)btSerial.read(); Serial.println(c); digitalWrite(13, !digitalRead(13));// ,    ,    13  } }</span></span></span></span></code> </pre><br>  We also upgrade the code for the first block, adding the pairing of bluetooth to each other: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt; #include &lt;Wire.h&gt; #define MIC A0 // ,    int ClapMargin = 9; //  ( ) int mic_prev = 0; int SilenceLen=1500; //  int NextClapLen = 2500; //,     .  int SkipLen = 800; //   #define rxPin 2 #define txPin 3 SoftwareSerial btSerial(rxPin, txPin); void setup() { // put your setup code here, to run once: analogReference(INTERNAL);//     1.1     Serial.begin(9600); pinMode(12, OUTPUT);// 12  13    pinMode(13, OUTPUT); // define pin modes for tx, rx pins: // Bluetooth      bluetooth  pinMode(rxPin, INPUT); pinMode(txPin, OUTPUT); btSerial.begin(38400); Serial.println("Serial started"); digitalWrite(12, HIGH);//   btSerial.println("AT"); while (!btSerial.available()); while (btSerial.available() &gt; 0) char c = btSerial.read(); btSerial.println("AT+INIT"); while (!btSerial.available()); while (btSerial.available() &gt; 0) char c = btSerial.read(); btSerial.println("AT+INQ"); while (!btSerial.available()); while (btSerial.available() &gt; 0) char c = btSerial.read(); btSerial.println("AT+LINK=2014,5,191146");//2014,5,191146 -    while (!btSerial.available()); while (btSerial.available() &gt; 0) char c = btSerial.read(); digitalWrite(12, LOW);// } int ReadNext() { int result; int d; d = analogRead(MIC); // result = abs(mic_prev-d); //   mic_prev = d; //   return result; //  } int WaitForClap(int WaitLen) { int d, i; i = 0; //  do { d = ReadNext(); //  i++; //  if (d &gt; ClapMargin) { //   Serial.println(d); return d; //   } if ( (WaitLen != -1) &amp;&amp; (i &gt;= WaitLen) ) { //    WaitLen  WaitLen   -1 return 0; // 0 } } while (1); } //-   SkipLen  void Skip(int SkipLen) { int i; for (i=0; i&lt;SkipLen; i++) { ReadNext(); } } void loop() { int d1, d2; if(WaitForClap(-1)&gt; ClapMargin)//  { digitalWrite(12, HIGH); Serial.println("raz"); Skip(SkipLen); d1 = WaitForClap(SilenceLen); //  Serial.println(d1); if (d1 == 0) { digitalWrite(12, HIGH); Skip(500); d2 = WaitForClap(NextClapLen); // 2  if (d2 &gt; ClapMargin) { digitalWrite(12, LOW);//   digitalWrite(13, HIGH);//   btSerial.print('1');//       Bluetooth delay(1000); } } } digitalWrite(12, LOW);//   digitalWrite(13, LOW); Skip(SkipLen); }</span></span></span></span></code> </pre><br><h4>  <b>Result</b> </h4><br>  So the bluetooth is connected, the microphone is working, the LEDs are working, the cotton is identified, the signal to the second unit is transmitted, all that remains is to carefully assemble it into the enclosures and configure the BIOS to turn on when power is applied. <br><br>  Here's what happened: <br><br>  1st unit (power output on the side of the case, on the top visible green and red LEDs and a microphone). <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/0c4/6ee/332/0c46ee3326496e2a32190a6fa766e8e3.jpg" alt="image"><br><br>  2nd unit (power is also displayed on the side of the case, on top of 2 sockets, one is constantly powered to power the microcontroller through the adapter for the phone, the second is for connecting the PC itself). <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/f5b/b40/a86/f5bb40a86c3211f1cd5c8aad28c3c85c.jpg" alt="image"><br><br>  We look at the result: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/0AQHzKgaKm8%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjWeVxj5lh3VKYNV5p9YJH5pLiaZA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  <b>Results</b> </h4><br><ul><li>  Arduino is awesome.  Cheap microcontrollers, a lot of sensors, a lot of various guides on the Internet, as well as the C ++ language </li><li>  Such a thing you can really do yourself in the evening, the main thing is to buy everything in advance </li><li>  This device can be used not only to turn on the PC, but also to turn on other electrical devices, such as lamps.  And this is a big plus </li><li>  This idea can be expanded, for example, by creating many such devices, connecting them into a single network, and managing it via Bluetooth using a smartphone, well, it is so, for the future <br></li></ul></div><p>Source: <a href="https://habr.com/ru/post/357930/">https://habr.com/ru/post/357930/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../357918/index.html">I2C sniffer</a></li>
<li><a href="../357920/index.html">Arduino <-> STM32 HAL, or there and back</a></li>
<li><a href="../357922/index.html">As I wrote code for Arduino using Python</a></li>
<li><a href="../357924/index.html">Keyboard layout indicator in the form of a color cube on the table using Arduino</a></li>
<li><a href="../357928/index.html">On power up</a></li>
<li><a href="../357932/index.html">Running line on Arduino + control from the smartphone</a></li>
<li><a href="../357934/index.html">LED cube 8x8x8, interesting and beautiful</a></li>
<li><a href="../357936/index.html">Smart Redmond SkyPlug RSP-100S Socket Analysis of the design and the electrical circuit diagram. Identifying deficiencies</a></li>
<li><a href="../357942/index.html">Heavy industry removal</a></li>
<li><a href="../357944/index.html">Attack of BitErrant with SHA-1 collisions: create different .exe with the same .torrent file</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>