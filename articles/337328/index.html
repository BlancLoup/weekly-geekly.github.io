<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we taught the Yandex.Taxi application to predict a destination</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Imagine: you open the app to once again order a taxi to the place you often visit, and, of course, in 2017 you expect that all you need to do is to sa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we taught the Yandex.Taxi application to predict a destination</h1><div class="post__text post__text-html js-mediator-article">  Imagine: you open the app to once again order a taxi to the place you often visit, and, of course, in 2017 you expect that all you need to do is to say ‚ÄúCall‚Äù, and the taxi will immediately leave you.  And where you wanted to go, in how many minutes and on which machine - all this application will learn thanks to the history of orders and machine learning.  In general, everything is like in jokes about the perfect interface with a single button ‚Äúdo well‚Äù, better than which only the screen with the words ‚Äúeverything is already well‚Äù.  It sounds great, but how to bring this reality closer? <br><br><img src="https://habrastorage.org/web/9d5/87f/ba7/9d587fba773a438189e912e5d33ab51d.jpg"><br><br>  The other day we released a new application Yandex. Taxi for iOS.  In the updated interface, one of the accents is made on the choice of the end point of the route (‚Äúpoint B‚Äù).  But the new version is not just a new UI.  By the launch of the update, we significantly reworked the destination forecasting technology, replacing the old heuristics with a classifier trained on historical data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As you understand, the buttons ‚Äúdo well‚Äù in machine learning are not there either, so a seemingly simple task turned into a rather exciting case, as a result of which, we hope, we managed to make life a little easier for users.  Now we continue to closely monitor the work of the new algorithm and will continue to change it so that the quality of the forecast is more stable.  At full capacity, we will launch in the next few weeks, but under the cut are already ready to talk about what is happening inside. <br><br><a name="habracut"></a><h2>  Task </h2><br>  When choosing a destination, in the ‚Äúwhere‚Äù field we have the opportunity to offer the user literally 2-3 options on the main screen and several more - if he goes to the point B selection menu: <br><br><img src="https://habrastorage.org/web/366/647/daf/366647dafa8f446890084078307a286a.jpeg" width="233"><img src="https://habrastorage.org/web/a5a/e9f/922/a5ae9f922f464181b09e417232a983c6.jpeg" width="233"><img src="https://habrastorage.org/web/335/ed7/8a1/335ed78a1712464a97b67a42d251132e.jpeg" width="233"><br><br>  If our prediction is correct, the user does not need to type in the address, and in general there is reason to rejoice that the application is able to remember at least a little its preferences.  It was for these prompts that a model was developed which, based on the user's travel history, tries to predict exactly where he is most likely to go now. <br><br>  Before building a model based on machine learning, the following strategy was implemented: all points from the history are taken, ‚Äúidentical‚Äù points (with the same address or close) merge, different points are given different points for different locations (if the user went to this point, he went from this point, went to this point in some time window, and so on).  Then the locations with the highest points are selected and recommended to the user.  As I have already said, historically this strategy worked well, but the prediction accuracy could be improved.  And most importantly - we knew how. <br><img src="https://habrastorage.org/web/342/428/6bd/3424286bdd7d4b45ae71e4e4528b8927.png"><br><h5>  <sub><sup>‚ÄúOld‚Äù heuristics and a trained classifier can give different predictions: in this figure, the size of the circle shows how high this point is in the list of recommendations on a particular day and specific time.</sup></sub>  <sub><sup>Please note that the trained algorithm in this example offered several additional locations (green circles).</sup></sub> </h5><br>  Our task was to use the re-ranking of the most probable ‚Äúpoints B‚Äù on top of the ‚Äúold‚Äù strategy using machine learning.  The general approach is this: first, we award points, as before, then we take the top n for these points (where n is obviously more than what we need to recommend), and then re-rank it and the user will only show the three most likely points B. Exact number The candidates in the list are, of course, determined in the course of optimization so that both the quality of candidates and the quality of re-ranking are as high as possible.  In our case, the optimal number of candidates turned out to be 20. <br><br><h2>  About quality assessment and results </h2><br>  First, the quality must be divided into two parts: the quality of candidates and the quality of ranking.  The quality of candidates is how well selected candidates are, in principle, correctly rearranged.  And the quality of ranking is how well we predict the destination point, provided that it is among the candidates. <br><br>  Let's start with the first metric, that is, the quality of candidates.  It is worth noting that only about 72 percent of orders selected point B (or very close to it geographically) was present earlier in history.  This means that the maximum quality of candidates is limited to this number, since we cannot yet recommend points to which a person has never traveled.  We selected heuristics with assignment of points so that when selecting the top 20 candidates for these points the correct answer was contained in 71% of cases.  With a maximum of 72%, this is a very good result.  We were completely satisfied with this quality of candidates, so we didn‚Äôt touch this part of the model, although, in principle, we could.  For example, instead of heuristics, it was possible to train a separate model.  But since the heuristics-based search engine has already been technically implemented, we were able to save on development only by selecting the necessary coefficients. <br><br>  Let's go back to the quality of re-ranking.  Since we can show one, two, or a maximum of three points on the main screen of the trip order, we are interested in the proportion of cases when the correct answer was in the top-1, top-2 and top-3 ranking lists, respectively.  In machine learning, the share of correct answers in the top k of the ranking list (of all correct answers) is called recall @ k.  In our case, we are interested in recall @ 1, recall @ 2 and recall @ 3.  In this case, the ‚Äúcorrect answer‚Äù in our problem is only one (up to closely spaced points), which means that this metric will just show the proportion of cases when the real ‚Äúpoint B‚Äù falls in the top 1, top 2 and top 3 of our algorithm . <br><br>  As a basic ranking algorithm, we took the sort by the number of points and obtained the following results (in percent): recall @ 1 = 63.7;  Recalling @ 2 = 78.5 and recall @ 3 = 84.6.  Note that the percentages here are a fraction of those cases where the <i>correct answer in the candidates was generally present</i> .  At some point a logical question arose: perhaps simple sorting by popularity already gives good quality, and all the ideas of sorting by points and using machine learning are superfluous?  But no, such an algorithm showed the worst quality: recall @ 1 = 41.2;  recall @ 2 = 64.6;  recall @ 3 = 74.7. <br><br>  Remember the original results and proceed to discuss the machine learning model. <br><br><img src="https://habrastorage.org/web/bba/aca/d1c/bbaacad1c8634c87851903b0e1c84b41.png"><br><h5>  <sub><sup>The proportion of cases where the actual destination was among the first k recommendations</sup></sub> </h5><br><h2>  What model was built </h2><br>  To begin, we describe the mechanism for finding candidates.  As we have already said, on the basis of statistics on user‚Äôs trips to different places, points are awarded.  A point earns points if trips are made to or from it;  and significantly more points get those points to which the user traveled from the place where he is now, and even more points if this happened around the same time.  Further, the logic is clear. <br><br>  We now turn to the model for re-ranking.  Since we want to maximize recall @ k, in the first approximation we want to predict the likelihood of the user going to a certain place and rank the places by probability.  ‚ÄúAs a first approximation,‚Äù because these arguments are true only with a very accurate estimate of probabilities, and when errors appear in them, recall @ k can be better optimized by another solution.  A simple analogy: in machine learning, if we know for sure all probability distributions, the best classifier is <a href="https://en.wikipedia.org/wiki/Bayes_classifier">Bayesian</a> , but since in practice distributions are reconstructed from data approximately, often other classifiers work better. <br><br>  The classification task was posed as follows: the objects were couples (history of the user's previous trips; candidate for recommendations), where positive examples (class 1) were couples in which the user did go to this point B, negative examples (class 0) were pairs in which the user eventually went to another place. <br><br>  Thus, if you were a hardened formalist, the model did not estimate the likelihood that a person would go to a specific point, but the shifted probability that a given ‚Äústory-candidate‚Äù pair is relevant.  However, sorting by this value is as meaningful as sorting by the probability of a trip to a point.  It can be shown that with an excess of data, these will be equivalent sorts. <br><br>  We trained the classifier to minimize log loss, and as a model, we used the <a href="https://yandex.ru/company/technologies/matrixnet/">Matrixnet</a> actively used in Yandex (gradient boosting over decision trees).  And if everything is clear with MatrixNet, then why was log loss optimized? <br><br>  Well, first, the optimization of this metric leads to the correct estimates of probability.  The reason why this happens is rooted in mathematical statistics, in <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%25BC%25D0%25B0%25D0%25BA%25D1%2581%25D0%25B8%25D0%25BC%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25B4%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25B1%25D0%25B8%25D1%258F">the maximum likelihood method</a> .  Let the probability of a single class at the i-th object be <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-msubsup" id="MJXp-Span-2"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-4" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.059ex" height="1.817ex" viewBox="-38.5 -520.7 886.3 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> p_i </script>  and the true class is <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-5"><span class="MJXp-msubsup" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-8" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.939ex" height="1.817ex" viewBox="0 -520.7 834.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="693" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> y_i </script>  .  Then, if we consider the outcomes independent, the likelihood of the sample (roughly speaking, the probability of obtaining exactly the outcome that was obtained) is equal to the following product: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-9"><span class="MJXp-mtext" id="MJXp-Span-10">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">o</span><span class="MJXp-msubsup" id="MJXp-Span-14"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15" style="margin-right: 0.05em;">d</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-16" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">i</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-18"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19" style="margin-right: 0.05em;">p</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.59em;"><span class="MJXp-mrow" id="MJXp-Span-21"><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-24" style="vertical-align: -0.4em;">i</span></span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">i</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-26">1</span><span class="MJXp-mo" id="MJXp-Span-27" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-28"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-30" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-msubsup" id="MJXp-Span-31"><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-33" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-34">(</span><span class="MJXp-mn" id="MJXp-Span-35">1</span><span class="MJXp-mo" id="MJXp-Span-36">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-39" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-40">)</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="21.472ex" height="3.383ex" viewBox="0 -1039.5 9244.9 1456.5" role="img" focusable="false" style="vertical-align: -0.969ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-72" x="753" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-6F" x="1205" y="0"></use><g transform="translate(1690,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="736" y="-213"></use></g><g transform="translate(2555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><g transform="translate(503,521)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="693" y="-342"></use></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-430"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-28" x="3749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-31" x="4138" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-2212" x="4861" y="0"></use><g transform="translate(5862,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-213"></use></g><g transform="translate(6709,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-29" x="0" y="0"></use><g transform="translate(389,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-28" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-31" x="389" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-2212" x="890" y="0"></use><g transform="translate(1179,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="693" y="-342"></use></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-29" x="2503" y="0"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> \ prod_ {i} p_i ^ {y_i} (1-p_i) ^ {(1-y_i)} </script></p>  Ideally, we would like to have such <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-42"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-44" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.059ex" height="1.817ex" viewBox="-38.5 -520.7 886.3 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> p_i </script>  to get the maximum of this expression (because we want our results to be as credible as possible, right?).  But if one prologicarizes this expression (since the logarithm is a monotonic function, then we can maximize it instead of the original expression), then we get <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-45"><span class="MJXp-mtext" id="MJXp-Span-46">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">u</span><span class="MJXp-msubsup" id="MJXp-Span-49"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-51" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-msubsup" id="MJXp-Span-52"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-54" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-55">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">n</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-58"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-60" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-62" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-64">1</span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67" style="margin-right: 0.05em;">y</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-68" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">n</span><span class="MJXp-mo" id="MJXp-Span-72" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-73">1</span><span class="MJXp-mo" id="MJXp-Span-74" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-77" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-78" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="34.107ex" height="2.66ex" viewBox="0 -832 14684.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-75" x="719" y="0"></use><g transform="translate(1292,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="1242" y="-213"></use></g><g transform="translate(2514,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-6C" x="3349" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-6E" x="3648" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-28" x="4248" y="0"></use><g transform="translate(4638,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-29" x="5485" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-2B" x="6097" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-28" x="7098" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-31" x="7487" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-2212" x="8210" y="0"></use><g transform="translate(9211,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="693" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-29" x="10046" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-6C" x="10435" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-6E" x="10734" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-28" x="11334" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-31" x="11724" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-2212" x="12446" y="0"></use><g transform="translate(13447,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMAIN-29" x="14295" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> \ sum_i y_i ln (p_i) + (1-y_i) ln (1-p_i) </script>  .  And this is already known to us log loss, if you replace <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-79"><span class="MJXp-msubsup" id="MJXp-Span-80"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81" style="margin-right: 0.05em;">p</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-82" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.059ex" height="1.817ex" viewBox="-38.5 -520.7 886.3 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/yandex/blog/337328/&amp;xid=25657,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiTZc_KOIkEAFUNGiOD90w_QpKL-w#MJMATHI-69" x="712" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> p_i </script>  on their predictions and multiply the whole expression by minus one. <br><br>  Secondly, we, of course, trust the theory, but just in case, we tried to optimize various loss functions, and the log loss showed the largest recall @ k, so everything eventually came together. <br><br>  We talked about the method, the function of the error, too, one important detail remained: the signs by which we trained our classifier.  We used more than a hundred different signs to describe each ‚Äúhistory candidate‚Äù pair.  Here are some examples: <br><img src="https://habrastorage.org/web/060/79e/f29/06079ef29d434917b9d4419869c6f3d4.png"><br>  And finally, about the results: after re-ranking using the model we built, we obtained the following data (again, in percent): recall @ 1 = 72.1 (+8.4);  recall @ 2 = 82.6 (+4.1);  recall @ 3 = 88 (+3,4).  Not bad at all, but improvements are possible in the future due to the inclusion of additional information in the signs. <br><br>  You can look at an example of how the new prediction algorithm will look to the user: <br><img src="https://habrastorage.org/web/4cd/a98/d7e/4cda98d7ee7d49e09b7bd3433080e48e.png"><h2>  Future plans </h2><br>  Of course, there are many experiments to improve the model.  There will be the addition of new data to build recommendations, including the interests of the user, as well as the alleged ‚Äúhome‚Äù and ‚Äúwork‚Äù from Yandex Crypt and related features, and an experiment comparing the various classification methods in this task.  For example, Yandex already has not only used exclusively within the MatrixNet team, but also gaining popularity in Yandex and beyond its <a href="https://habrahabr.ru/company/yandex/blog/333522/">CatBoost</a> .  At the same time, of course, we are interested in comparing not only our own developments, but also other implementations of popular algorithms. <br><br>  In addition, as already mentioned at the beginning of the post, it would be great if the application itself understood when, where, and on which car we needed to go.  Now it‚Äôs hard to say how it is possible to accurately guess the order parameters and settings of the application suitable for the user from historical data, but we are working in this direction, we will make our application more ‚Äúsmart‚Äù and able to adapt to you. </div><p>Source: <a href="https://habr.com/ru/post/337328/">https://habr.com/ru/post/337328/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337314/index.html">Object to iterate, iterator and generator</a></li>
<li><a href="../337316/index.html">Accidental deletion of root files</a></li>
<li><a href="../337318/index.html">Our way to the green cart</a></li>
<li><a href="../337320/index.html">Dagger2 and architectural component "ViewModel"</a></li>
<li><a href="../337324/index.html">FullStack 2017 in London: details</a></li>
<li><a href="../337330/index.html">What programming language to choose to work with data?</a></li>
<li><a href="../337334/index.html">How to name a brand: 5 options. Choose the best</a></li>
<li><a href="../337336/index.html">About choosing a name for the game</a></li>
<li><a href="../337338/index.html">How to determine the mobile operator and home region by phone number</a></li>
<li><a href="../337340/index.html">The last countdown - Google has fun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>