<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple chroma RGB color component</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More and more often we see the use of chromakey in the most unexpected places. It was a long thought to try to realize something of my own. 

 What is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple chroma RGB color component</h1><div class="post__text post__text-html js-mediator-article">  More and more often we see the use of chromakey in the most unexpected places.  It was a long thought to try to realize something of my own. <a name="habracut"></a><br><br>  What is a chromakey, for those who are not familiar?  Chroma Key is an image matching technology widely used in film-video-television production.  As the "key" colors are most often used poisonous green and bright-blue, just by the fact that such shades are not found in the spectrum of the complexion and the human hair.  For very dark scenes, such as underground caves, use bright orange as the key color. <br><br>  After thinking for a while and, having come from the far and not the simplest option using the HSL model, something universal did not work out right away.  I must say, this "some" time was very decently drawn out.  And here, quite unexpectedly, the idea occurred to try with a simple version, simply by discarding one of the components and making an alpha channel according to its meaning.  The green channel was taken as a basis, as one of the most frequently used in similar tasks. <br>  The line of thought was: <br>  - we have a total of 256 gradations of each channel <br>  - all that is approximately below the 30th value can be attributed to the ‚Äúblack‚Äù green <br>  - the variant where the green component is dominant is almost certainly green (there are still gradations of gray, close to gray, etc.) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having a random image from the internet <br><br><img src="https://habrastorage.org/storage2/055/c5c/cd3/055c5ccd31d6928578e3f7abbc7b56ed.jpg"><br>  (taken at <a href="">vid8o.files.wordpress.com/2011/01/chromakey.jpg?w=620</a> ) <br><br>  and similarly taken background <br><br><img src="https://habrastorage.org/storage2/2be/bca/246/2bebca24651df4c42addd3ece319448c.jpg"><br>  (I do not know who belongs) <br><br>  let's go to implement the algorithm for a 24-bit image and an 8-bit mask (alpha channel): <br><br><pre><code class="cpp hljs">byte <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> black_threshold = <span class="hljs-number"><span class="hljs-number">30</span></span>; byte* chroma_p = chroma_data; byte* alpha_p = alpha_data; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt; size; ++counter) { byte b = *chroma_p++; byte g = *chroma_p++; byte r = *chroma_p++; <span class="hljs-comment"><span class="hljs-comment">// ,      if (g &gt; r &amp;&amp; g &gt; b) { //     ,       if (g &lt; black_threshold) *alpha_p++ = 255; else { //         byte m = g - max(r, b); *alpha_p++ = 255 - m; } } }</span></span></code> </pre> <br><br>  Run, we get: <br><br>  mask <br><img src="http://habrastorage.org/storage2/f5d/009/bed/f5d009bedf49e82c26d84b6bd482d1f1.jpg"><br><br>  and mask overlay image on our background <br><img src="http://habrastorage.org/storage2/caa/5cf/840/caa5cf840b9abd45f200fa98475679f0.jpg"><br><br>  As a result, our implementation shows a pretty good, but very rough result.  In particular, we see green fog on the resulting image.  Let's look at the mask histogram: <br><br><img src="http://habrastorage.org/storage2/7e9/138/ec0/7e9138ec0757feb15eaabf8e93bd31db.jpg"><br><br>  We see that the main part of the mask in the field of transparency lies in the range of 17-100.  Therefore, we stretch the interval of values ‚Äã‚Äã100-255 to the interval 0-255, ‚Äúkilling‚Äù the veil, and we get just such a histogram <br><br><img src="http://habrastorage.org/storage2/d86/94a/89e/d8694a89e147bbd072b8e935d82ce9a0.jpg"><br><br>  and such a mask, more similar to the one we need <br><br><img src="http://habrastorage.org/storage2/96a/80a/592/96a80a5920441b07bed8305e8ec1b5fb.jpg">  . <br><br>  As a result, we got rid of the shroud we did not need. <br><br><img src="http://habrastorage.org/storage2/e1a/a89/c82/e1aa89c82783ceee448b66920260bee5.jpg">  , <br><br>  but we see the remaining halo around the mask and the green ‚Äúflare‚Äù of the tone, which we naturally looked at against the original green background and looks completely alien to our new background.  In general, the result was cheap, but a number of questions remained.  How to deal with the halo?  You can try to narrow the mask with convolution, or try to somehow stretch the mask histogram. <br><br>  But I still do not know how to deal with light, therefore, there is enough food for further work.  Criticism, tips and advice are welcome. <br><br>  I would also appreciate links to such works, including their implementation using GPU, OpenCV, etc. <br><br>  UPD 1: doubled the size of the processed image and masks </div><p>Source: <a href="https://habr.com/ru/post/158479/">https://habr.com/ru/post/158479/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158465/index.html">Apple began to encourage employees to work on personal projects</a></li>
<li><a href="../158467/index.html">Starts sales of Samsung Galaxy Camera in USA and UK</a></li>
<li><a href="../158469/index.html">Monitoring the activity of VK groups. We process data on VKScript</a></li>
<li><a href="../158471/index.html">Hacking bezdny.net</a></li>
<li><a href="../158473/index.html">Opera extension: search open site 1.1</a></li>
<li><a href="../158481/index.html">Prototype voice shopping list for WP8, Win8, Android with a backend in Azure in 2.5 hours</a></li>
<li><a href="../158483/index.html">We draw a clear icon of the house in 32x32 (ala FatCow)</a></li>
<li><a href="../158487/index.html">"Yandex" closes the "Bar"</a></li>
<li><a href="../158493/index.html">Radio Wave Theory: Analog Modulation</a></li>
<li><a href="../158495/index.html">HTML5 Canvas: rotate and translate by example</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>