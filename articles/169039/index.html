<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What do Win32 / Redyms and TDL4 have in common?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since the beginning of 2013, we began to track an interesting family of Trojans - Win32 / Redyms. This threat is notable in that it uses the technique...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What do Win32 / Redyms and TDL4 have in common?</h1><div class="post__text post__text-html js-mediator-article">  Since the beginning of 2013, we began to track an interesting family of Trojans - Win32 / Redyms.  This threat is notable in that it uses the technique of replacing the results of search queries of popular search engines.  We found that it was <b>most prevalent in the United States and Canada</b> .  It is in these countries that the cybercrime market offers the highest prices for redirecting (clicks) a user from popular search engines to malicious or advertising resources. <br><br><a name="habracut"></a>  Our lead analyst <a href="https://twitter.com/matrosov">Alexander Matrosov</a> performed an in-depth analysis of Win32 / Redyms.  As a result, the similarity of this malicious code with another program, Win32 / Agent.TJO, which is also known as part of the Olmarik / TDL4 family, was discovered.  Win32 / Agent.TJO is a user mode Trojan based on the clicker mechanism of one of the TDL4 components.  Both TDL4, and Win32 / Agent.TJO, and Win32 / Redyms use similar mechanisms for managing network traffic, which is transmitted by the browser.  To control traffic, the bot intercepts several functions from the Microsoft Windows Socket Provider library (mswsock.dll): <br><br><img src="https://habrastorage.org/storage2/705/b98/35d/705b9835d7549597058b8ce39f5ba9aa.png"><br><img src="https://habrastorage.org/storage2/811/dac/b10/811dacb10a316e13590794958f34acab.png"><br><img src="https://habrastorage.org/storage2/257/8ff/015/2578ff0155ddbc46223f6f0bdacd4612.png"><br>  Fig.  Interception functions of the library mswsock.dll. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All three families of these malicious programs use the same methods of intercepting functions, as well as interaction with the C &amp; C manager encrypted using the RC4 encryption algorithm. <br><br>  The graph of the function responsible for interacting with the C &amp; C server is as follows: <br><br><img src="https://habrastorage.org/storage2/426/840/19a/42684019aede20c83e6c68b9dcf7b12e.png"><br>  Fig.  Graph work function C &amp; C. <br><br>  Another interesting feature of Win32 / Redyms was found in the Domain Generation Algorithm (DGA), which selects C &amp; C servers for interaction.  This algorithm is based on simple alphabetic permutations and other changes, in accordance with the original constant.  The pictures below show the reconstruction of this algorithm in python, as well as the usual decompiled code. <br><br><img src="https://habrastorage.org/storage2/ce1/c47/b13/ce1c47b133f94d8d8642754431f2001c.png"><br>  Fig.  Reconstructed python code DGA function. <br><br><img src="https://habrastorage.org/storage2/b47/6ff/3fe/b476ff3fe5a1cde8741748eb38a6d78f.png"><br>  Fig.  Decompiled code DGA function. <br><br><img src="https://habrastorage.org/storage2/e36/c34/300/e36c34300bdde64845e6f1e1cb0205b1.png"><br>  Fig.  List of C &amp; C servers of malicious code. <br><br>  The first domain names from the list shown in the figure above were registered in mid-December 2012 - early January 2013. This indirectly indicates that Win32 / Redyms was distributed from the end of December. <br><br>  Win32 / Redyms implements the introduction of its malicious code into all active processes.  If the embedded code detects that it is running in the browser application, it creates a special thread in the process, and also intercepts functions from the mswsock.dll library. <br><br><img src="https://habrastorage.org/storage2/209/94f/8e8/20994f8e862f27a315b43c78a9383fe7.png"><br>  Fig.  A piece of Win32 / Redyms malicious code that creates a special stream in the browser process. <br><br>  The embedded code intercepts network activity in the running browser process and tries to find search engines from the list shown in the figure below. <br><br><img src="https://habrastorage.org/storage2/bb7/f22/afe/bb7f22afe0c9217bef1838d42f87bb03.png"><br>  Fig.  List of search engines that tracks malicious code. <br><br>  If it detects a search engine activity, all search queries are redirected to the command C &amp; C server, and the URL links themselves that were issued during the search query are replaced in accordance with those obtained from C &amp; C.  The URL verification code is based on the interception of the WSPSend () function, which uses AVL trees as a structure for storing data.  To work with AVL tree structures, the malicious code uses the RTL_GENERIC_TABLE structure from kernel32.dll.  TDL4 uses the same ideas in the user mode component cmd.dll. </div><p>Source: <a href="https://habr.com/ru/post/169039/">https://habr.com/ru/post/169039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169029/index.html">.NET Framework: What version are you using?</a></li>
<li><a href="../169031/index.html">The digest of interesting news and materials from the world of PHP over the past two weeks, number 10 (01/26/2013 - 02.11.2013)</a></li>
<li><a href="../169033/index.html">Is the MVC pattern a dead end for application development?</a></li>
<li><a href="../169035/index.html">Key figures of the IT labor market (January 2012 - January 2013)</a></li>
<li><a href="../169037/index.html">PocketBook SURFpad Review</a></li>
<li><a href="../169043/index.html">Leap Motion. Unpacking and small overview</a></li>
<li><a href="../169047/index.html">How to quickly create a survey on your site using Google forms?</a></li>
<li><a href="../169049/index.html">Manage Network Folders with PowerShell</a></li>
<li><a href="../169051/index.html">Responsive design using camera</a></li>
<li><a href="../169055/index.html">Optical flux calculation using the Lucas-Canada method. Theory</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>