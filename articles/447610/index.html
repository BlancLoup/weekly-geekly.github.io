<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to take control of network infrastructure. Chapter three Network security Part three</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is the fifth in a series of articles "How to take control of network infrastructure." The contents of all articles in the series and link...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to take control of network infrastructure. Chapter three Network security Part three</h1><div class="post__text post__text-html js-mediator-article">  <i>This article is the fifth in a series of articles "How to take control of network infrastructure."</i>  <i>The contents of all articles in the series and links can be found <a href="https://habr.com/ru/post/447008/">here</a></i> . <br><br>  This part will focus on Campus security audits (Office) &amp; Remote access VPN segments. <br><br><img src="https://habrastorage.org/webt/oy/cg/wa/oycgwahgeyicedrvuo175vsvpwc.jpeg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It may seem that the design of an office network is simple. <br><br>  Indeed, we take L2 / L3 switches, connect them together.  Next, we make an elementary configuration of wilan, default gateways, we raise simple routing, connect WiFi controllers, access points, install and configure ASA for remote access, rejoice that it all worked.  In principle, as I wrote in one of the previous <a href="https://habr.com/ru/post/434750/">articles in</a> this cycle, I can design and configure an office network to ‚Äúwork somehow‚Äù, can almost every student who has listened (and mastered) two semesters of a course on a telecom. <br><br>  But the more you learn, the less elementary this task begins to seem.  For me personally, this topic, the theme of office network design, does not seem simple at all, and in this article I will try to explain why. <br><br>  In short, you need to take into account quite a few factors.  Often these factors are in conflict with each other and you have to look for a reasonable compromise. <br>  This uncertainty is the main difficulty.  So, speaking of security, we have a triangle with three vertices: security, convenience for employees, the price of the solution. <br>  And every time you have to find a compromise between these three. <br><a name="habracut"></a><br><h2>  Architecture </h2><br>  As an example of architecture for these two segments, I, as in previous articles, recommend the <a href="https://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Security/SAFE_RG/SAFE_rg/chap1.html">Cisco SAFE</a> model: <a href="https://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Security/SAFE_RG/SAFE_rg/chap5.html">Enterprise Campus</a> , <a href="https://www.cisco.com/c/en/us/td/docs/solutions/Enterprise/Security/SAFE_RG/SAFE_rg/chap6.html">Enterprise Internet Edge</a> . <br><br>  These are somewhat outdated documents.  I cite them here, because fundamentally the schemes and approach have not changed, but I like the presentation more than in the <a href="https://www.cisco.com/c/en/us/solutions/enterprise/design-zone-security/landing_safe.html">new documentation</a> . <br><br>  Without encouraging you to use Cisco solutions, I still find it useful to carefully study this design. <br><br>  This article, as usual, in no way claiming to be complete, is rather an addition to this information. <br><br>  At the end of the article, we will analyze the design of the Cisco SAFE for the office in terms of the concepts outlined here. <br><br><h2>  General principles </h2><br>  The design of an office network, of course, must meet the general requirements, which were discussed <a href="https://habr.com/ru/post/434750/">here</a> in the chapter ‚ÄúCriteria for assessing the quality of design‚Äù.  In addition to price and security, which we intend to discuss in this article, there are still three criteria that we must take into account when designing (or when making changes): <br><br><ul><li>  scalability </li><li>  managability </li><li>  availability </li></ul><br>  Much of what has been discussed for <a href="https://habr.com/ru/post/435138/">data centers is</a> also fair for the office. <br><br>  But still, the office segment has its own specifics, which is critical from a security point of view.  The essence of this specificity is that this segment is created to provide network services to employees (as well as partners and guests) of the company, and, as a result, at the topmost level of problem consideration we have two tasks: <br><br><ul><li>  protect company resources from malicious actions that may come from employees (guests, partners) and from the software they use.  This also includes protection from unauthorized connection to the network. </li><li>  protect the systems and data of the users themselves </li></ul><br>  And this is only one side of the problem (or rather one vertex of the triangle).  On the other side is the convenience of the user and the price of the applied solutions. <br><br>  Let's start by looking at what the user expects from a modern office network. <br><br><h2>  Facilities </h2><br>  Here is how I think ‚Äúnetwork amenities‚Äù for an office user: <br><br><ul><li>  Mobility </li><li>  The ability to use the entire spectrum of familiar devices and operating systems </li><li>  Easy access to all necessary company resources </li><li>  Availability of Internet resources, including various cloud services </li><li>  "Quick work" network </li></ul><br>  All this applies to both employees and guests (or partners), and this is the task of the company's engineers, based on authorization, to differentiate access for different groups of users. <br><br>  Let's take a closer look at each of these aspects. <br><br><h3>  Mobility </h3><br>  It is about the opportunity to work and use all the necessary company resources from anywhere in the world (of course, where the Internet is available). <br><br>  This fully applies to the office.  This is convenient when from anywhere in the office you have the opportunity to continue working, for example, to receive mail, to communicate in a corporate messenger, to be available for a video call ... Thus, this allows you, on the one hand, to solve some issues through "live" communication (for example, to participate in rallies), and on the other hand, to be always online, keep abreast of and quickly solve some urgent high-priority tasks.  It is very convenient and, indeed, improves the quality of communications. <br><br>  This is achieved by the correct design of the WiFi network. <br><br><blockquote>  <b>Comment</b> <br><br>  Here the question usually arises, is it enough to use only WiFi?  Does this mean that you can stop using the Ethernet ports in the office?  If we are talking only about users, and not about servers, which, nevertheless, it is reasonable to connect with an ordinary Ethernet port, then the general answer is: yes, you can restrict yourself to WiFi.  But there are nuances. <br><br>  There are important user groups that require a separate approach.  These are, of course, administrators.  In principle, the WiFi connection is less reliable (in terms of traffic loss) and less speedy than a normal Ethernet port.  This can be significant for administrators.  In addition, network administrators, for example, in principle, can have their own dedicated Ethernet network for out-of-band connectivity. <br><br>  Perhaps there are other groups / departments in your company for which these factors are also important. <br><br>  There is another important point - telephony.  Perhaps for some reason you do not want to use Wireless VoIP and want to use IP phones with a normal Ethernet connection. <br><br>  In general, in those companies in which I worked, there was usually the possibility of both a WiFi connection and an Ethernet port. </blockquote><br>  I wish mobility was not limited to office only. <br><br>  To enable work from home (or any other place with accessible Internet), a VPN connection is used.  At the same time, it is desirable that employees do not feel the difference between working from home and remote work, which implies the presence of the same access.  We will discuss how to organize this a bit later in the chapter ‚ÄúA single centralized system of authentication and authorization‚Äù. <br><br><blockquote> <b>Comment</b> <br><br>  Most likely, you will not be able to fully provide the same quality of services for remote work, which you have in the office.  Let's assume that you use the Cisco ASA 5520 as a VPN gateway. According to the <a href="https://www.cisco.com/c/en/us/products/security/asa-5500-series-next-generation-firewalls/data_sheet_c78-345385.html">data sheet,</a> this device can ‚Äúdigest‚Äù only 225 Mbps of VPN traffic.  That is, of course, in terms of bandwidth, a VPN connection is very different from working from the office.  Also, if for some reason, delay, loss, jitter (for example, you want to use office IP telephony) for your network services are essential, you also will not get the same quality as if you were in the office.  Therefore, speaking of mobility, we must remember the possible limitations. </blockquote><br><h3>  Easy access to all company resources </h3><br>  This task should be solved together with other technical departments. <br>  The ideal situation is when the user needs to authenticate only once, and after that he gets access to all necessary resources. <br>  Providing easy access without compromising security can significantly improve work efficiency and reduce the stress level of your colleagues. <br><blockquote>  <b>Remark 1</b> <br><br>  Convenience of access is not only about how many times you have to enter a password.  If, for example, in accordance with your security policy, to connect from the office to the data center, you must first connect to the VPN gateway, and you lose access to office resources, this is also very, very inconvenient. <br></blockquote><blockquote>  <b>Remark 2</b> <br><br>  There are services (for example, access to network equipment), where we usually have our dedicated AAA servers and this is the norm when in this case you have to authenticate several times. <br></blockquote><br><h3>  Availability of Internet resources </h3><br>  The Internet is not only entertainment, but also a set of services that can be very useful for work.  There are also purely psychological factors.  A modern person through the Internet with many virtual threads is connected with other people, and, in my opinion, there is nothing bad if he continues to feel this connection even during work. <br><br>  From the point of view of loss of time, there is nothing terrible if an employee, for example, has Skype running, and he will spend 5 minutes talking with a loved one if necessary. <br><br>  Does this mean that the Internet should always be available, does this mean that employees can open access to all resources and not control them in any way? <br><br>  No, it does not mean, of course.  The level of openness of the Internet can be different for different companies - from complete closeness to complete openness.  We will discuss ways to control traffic later in the sections on protection. <br><br><h3>  The ability to use the full range of familiar devices </h3><br>  It is convenient when, for example, you have the opportunity to continue to use all of your usual means of communication and at work.  There is no difficulty in technically realizing this.  For this you need WiFi and a guest wilan. <br><br>  It is also good if you can use the operating system you are used to.  But, in my observation, usually, it is allowed only to managers, administrators and developers. <br><br><blockquote>  <b>Example</b> <br><br>  You can, of course, follow the path of restrictions, prohibit remote access, prohibit connections from mobile devices, restrict all static Ethernet connections, restrict Internet access, withdraw cell phones and gadgets at the gateway without fail ... and some organizations with elevated security requirements, and perhaps in some cases this may be justified, but ... agree that it looks like an attempt to stop the progress in a single organization.  Of course, I would like to combine the possibilities offered by modern technologies with an adequate level of security. </blockquote><br><h3>  "Quick work" network </h3><br>  The data transfer rate is technically made up of many factors.  And the speed of your connection port is usually not the most important of them.  Slow operation of the application is not always associated with network problems, but now we are only interested in the network part.  The most common problem of "slowing down" the local network is associated with packet loss.  This usually occurs when there is a bottleneck effect or L1 (OSI) problems.  Less often, with some designs (for example, when the firewall acts as the default gateway on your subnets and thus all traffic goes through it), the performance of the equipment may not be enough. <br><br>  Therefore, when choosing equipment and architecture, you need to correlate the speed of end ports, trunks and equipment performance. <br><br><blockquote>  <b>Example</b> <br><br>  Suppose you are using switches with 1 gigabit ports as switches for the access level.  Between themselves, they are connected via Etherchannel 2 x 10 gigabits.  As the default gateway, you use a firewall with gigabit ports, to connect which to the L2 office network you use 2 gigabit ports integrated into an Etherchannel. <br><br>  This architecture is quite convenient in terms of functionality, since  all traffic passes through the firewall, and you can comfortably manage access policies, and apply complex traffic control algorithms and prevent possible attacks (see later), but from a capacity and performance point of view, this design certainly has potential problems.  For example, 2 hosts that download data (at a port speed of 1 gigabit) can completely download 2 gigabit connectivity to the firewall, and thus lead to degradation of the service for the entire office segment. </blockquote><br>  We looked at one vertex of the triangle, now let's consider how we can provide security. <br><br><h2>  Means of protection </h2><br>  So, of course, usually, our desire (or rather, the desire of our leadership) is to achieve the impossible, namely, to provide maximum convenience with maximum security and minimum price. <br><br>  Let's look at what methods we have to provide protection. <br><br>  For the office, I would highlight the following: <br><br><ul><li>  zero trust design approach </li><li>  high level of protection </li><li>  network visibility </li><li>  unified centralized authentication and authorization system </li><li>  host checking </li></ul><br>  Next, we dwell a little more on each of these aspects. <br><br><h3>  Zero trust </h3><br>  IT world is changing very quickly.  Literally over the past 10 years, the emergence of new technologies and products has led to a major revision of the concepts of security.  Ten years ago, from a security point of view, we segmented the network into a trust, dmz and untrust zone, and the so-called ‚Äúperimeter defense‚Äù was applied, where there were 2 lines of defense: untrust -&gt; dmz and dmz -&gt; trust.  Also, protection is usually limited to access lists based on L3 / L4 (OSI) headers (IP, TCP / UDP ports, TCP flags).  Everything related to higher levels, including L7, was left at the mercy of the OS and protection products installed on the final hosts. <br><br>  Now the situation has changed dramatically.  The modern concept of <a href="https://doubleoctopus.com/security-wiki/network-architecture/zero-trust/">zero trust</a> is based on the fact that it is no longer possible to consider internal systems, that is, inside the perimeter, the systems are trusted, and the concept of perimeter itself has become blurred. <br>  In addition to connecting to the Internet, we also have <br><br><ul><li>  remote access VPN users </li><li>  various personal gadgets brought by laptops connected via office wifi </li><li>  other (branch) offices </li><li>  cloud infrastructure integration </li></ul><br>  What does the Zero Trust approach look like in practice? <br><br>  Ideally, only the traffic that is required should be allowed, and if we are talking about the ideal, then the control should be not only at the L3 / L4 level, but at the application level. <br><br>  If, for example, you have the opportunity to pass all traffic through the firewall, then you can try to get closer to the ideal.  But this approach can significantly reduce the total bandwidth of your network, and besides, filtering by application does not always work well. <br><br>  When controlling traffic on a router or L3 switch (using standard ACLs), you encounter other problems: <br><br><ul><li>  This is only L3 / L4 filtering.  Nothing prevents an attacker from using permitted ports (for example, TCP 80) for his application (not http) </li><li>  difficult ACL management (difficult to analyze ACL) </li><li>  this is not a statefull firewall, that is, you need to explicitly allow reverse traffic </li><li>  in the case of switches, you are usually quite rigidly limited by the size of the TCAM, which, if you use the ‚Äúonly allow what you need‚Äù approach, can quickly become a problem </li></ul><br><blockquote>  <b>Comment</b> <br><br>  Speaking about reverse traffic, we must remember that we have the following opportunity (Cisco) <br><br>  permit tcp any any established <br><br>  But we must understand that this line is equivalent to two lines: <br>  permit tcp any any ack <br>  permit tcp any any rst <br><br>  Which means that even if there was no initial TCP segment with a SYN flag (that is, a TCP session did not even start to be established), this ACL will miss the packet with the ACK flag, which an attacker can use to transfer data. <br><br>  That is, this line in no way turns your router or L3 switch into a statefull firewall. </blockquote><br><h3>  High level of protection </h3><br>  In the <a href="https://habr.com/ru/post/435138/">article</a> in the section on data centers, we considered the following methods of protection. <br><br><ul><li>  stateful firewalling (default) </li><li>  ddos / dos protection </li><li>  application firewalling </li><li>  threat prevention (antivirus, anti-spyware, and vulnerability) </li><li>  URL filtering </li><li>  data filtering (content filtering) </li><li>  file blocking (file types blocking) </li></ul><br>  In the case of the office, the situation is similar, but the priorities are slightly different.  Office availability (availabilty) is usually not as critical as in the case of a data center, while the probability of ‚Äúinternal‚Äù malicious traffic is much higher. <br>  Therefore, the following methods of protection for this segment become critical: <br><br><ul><li>  application firewalling </li><li>  threat prevention (anti-virus, anti-spyware, and vulnerability) </li><li>  URL filtering </li><li>  data filtering (content filtering) </li><li>  file blocking (file types blocking) </li></ul><br>  Although all of these protection methods, with the exception of application firewalling, have traditionally been and continue to be solved on end hosts (for example, installing antivirus programs) and using proxy, modern NGFW also provide these services. <br><br>  Security equipment vendors strive to create comprehensive protection, so along with protection on the local box, various cloud technologies and end-point protection / EPP are offered.  So, for example, from the <a href="https://www.fairline.com.tw/data/editor/files/01%2520%2520Gartner%2520-%2520Magic%2520Quad%2520-%2520Endpoint%2520Protection%2520Platforms%25201-2018.pdf">Gartner Magic Quadrant (Gartner Magic Quadrant) for 2018,</a> we see that Palo Alto and Cisco have their own EPP (PA: Traps, Cisco: AMP), but they are not among the leaders. <br><br>  The inclusion of these protections (usually through the purchase of licenses) on the firewall is, of course, not mandatory (you can go the traditional way), but it has some advantages: <br><br><ul><li>  in this case, a single point of application of protection methods appears, which improves visibility (see the next topic). </li><li>  if there is an unprotected device in your network, then it still falls under the ‚Äúumbrella‚Äù of firewall protection </li><li>  using protection on the firewall in conjunction with protection on the end hosts, we increase the probability of detecting malicious traffic.  For example, using threat prevention on local hosts and on the firewall increases the likelihood of detection (assuming, of course, that these solutions are based on different software products) </li></ul><br><br><blockquote>  <b>Comment</b> <br><br>  If, for example, you use Kaspersky as an antivirus on both the firewall and on the end hosts, then this, of course, will not greatly increase your chances of preventing a virus attack on your network. </blockquote><br><h3>  Network visibility </h3><br>  <a href="https://blog.gigamon.com/2017/11/01/what-is-network-visibility/">The basic idea</a> is simple - to ‚Äúsee‚Äù what is happening on your network, both in real time and historical data. <br><br>  I would divide this ‚Äúvision‚Äù into two groups: <br><br>  <b>Group one:</b> what your monitoring system usually provides you. <br><br><ul><li>  equipment loading </li><li>  loading channels </li><li>  memory usage </li><li>  disk usage </li><li>  change routing table </li><li>  link status </li><li>  availability of equipment (or hosts) </li><li>  ... </li></ul><br>  <b>Group Two:</b> security related information. <br><br><ul><li>  various statistics (for example, by applications, by URL traffic, which types of data were downloaded, user data) </li><li>  what was blocked by security policies and for what reason, namely <br><ul><li>  prohibited application </li><li>  prohibited based on ip / protocol / port / flags / zones </li><li>  threat prevention </li><li>  url filtering </li><li>  data filtering </li><li>  file blocking </li><li>  ... </li></ul></li><li>  DOS / DDOS attack statistics </li><li>  unsuccessful authentication and authorization attempts </li><li>  statistics on all of the above security policy violations </li><li>  ... </li></ul><br>  In this security chapter, we are interested in the second part. <br><br>  Some modern firewalls (from my Palo Alto practice) provide a good level of visibility.  But, of course, the traffic that interests you should go through this firewall (in this case, you have the ability to block traffic) or mirror the firewall (used only for monitoring and analysis), and you must have licenses to enable all these services. . <br><br>  There is, of course, an alternative path, or rather a traditional path, for example, <br><br><ul><li>  Session statistics can be collected through netflow and then use special utilities for data analysis and data visualization. </li><li>  threat prevention - special programs (anti-virus, anti-spyware, firewall) on end hosts </li><li>  URL filtering, data filtering, file blocking - on proxy </li><li>  tcpdump can also be analyzed using, for example, <a href="https://habr.com/ru/company/cisco/blog/268207/">snort</a> </li></ul><br>  You can combine these two approaches, complementing the missing functions or duplicating them to increase the likelihood of detecting an attack. <br><br>  Which approach to choose? <br>  It strongly depends on the qualifications and preferences of your team. <br>  And there, and there are pros and cons. <br><br><h3>  Unified centralized authentication and authorization system <br></h3><br>  With a good design, mobility, which we discussed in this article, assumes that you have the same access, working from the office or from home, from the airport, from a cafe or any other point (with the limitations that we discussed above).  It would seem, what's the problem? <br>  In order to better understand the complexity of this task, let's consider a typical design. <br><br><blockquote>  <b>Example</b> <br><br><ul><li>  You broke all the staff into groups.  You have decided to grant access by groups. </li><li>  Inside the office, you control access to the office firewall </li><li>  Traffic from the office to the data center you control on the firewall of the data center </li><li>  You use Cisco ASA as a VPN gateway and you use local ACL ACLs to control the traffic that enters your network from remote clients. </li></ul><br>  Now, suppose you are asked to add additional access to a specific employee.  In this case, you are asked to add access only to him and more to anyone in his group. <br><br>  To do this, we must create a separate group for this employee, that is, <br><br><ul><li>  on ASA create a separate IP pool for this employee </li><li>  add a new ACL on the ASA and bind it to this remote client </li><li>  create new security policy on the office and data center firewalls </li></ul><br>  Well, if this event is rare.  But in my practice there was a situation when employees participated in different projects, and this set of projects for some of them changed quite often, and it was not 1 -2 people, but dozens.  Of course, there was something to change. <br><br>  This was resolved as follows. <br><br>  We decided that the only source of truth that determines all employee access is LDAP.  We created all sorts of groups that define sets of accesses and we tied each user to one or several groups. <br><br>  So for example, suppose there were groups <br><br><ul><li>  guest (internet access) </li><li>  common access (access to shared resources: mail, knowledge base, ...) </li><li>  accounting </li><li>  project 1 </li><li>  project 2 </li><li>  data base administrator </li><li>  linux administrator </li><li>  ... </li></ul><br>  And if one of the employees was involved, both in project 1 and project 2, and he needed the access needed to work in these projects, then this employee was tied to the following groups: <br><br><ul><li>  guest </li><li>  common access </li><li>  project 1 </li><li>  project 2 </li></ul><br>  How now to turn this information into accesses on network equipment? <br><br>  Cisco ASA Dynamic Access Policy (DAP) (see <a href="https://www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/108000-dap-deploy-guide.html">www.cisco.com/c/en/us/support/docs/security/asa-5500-x-series-next-generation-firewalls/108000-dap-deploy-guide .html</a> ) the solution is suitable for this task. <br><br>  Briefly about our implementation, during the identification / authorization process, the ASA receives from LDAP a set of groups corresponding to a given user and ‚Äúcollects‚Äù from several local ACLs (each of which corresponds to a group) a dynamic ACL with all the necessary access that fully corresponds to our wishes. <br><br>  But this is only for VPN connections.  In order to make the situation the same for both employees connected via VPN and those in the office, the next step was taken. <br><br>  When connecting from the office, users using the 802.1x protocol got into either the guest wilan (for guests), or the wilan with shared access (for company employees).  Further, to obtain specific access (for example, to projects in the data center), employees had to connect via VPN. <br><br>  To connect from the office and from home used different tunnel groups on the ASA.  This is necessary so that for people who connect from the office, traffic to shared resources (used by all employees, such as mail, file servers, ticket system, dns, ...) does not go through ASA, but through the local network.  Thus, we did not load ASA with excess traffic, including high-intensity traffic. <br><br>  Thus, the problem was solved. <br>  We got <br><br><ul><li>  the same set of access, both for connections from the office and for remote connection </li><li>  no degradation of service when working from the office associated with the transmission of high-intensity traffic through the ASA </li></ul><br>  What is the advantage of this approach? <br>  In the administration of access.  Access is easily changed in one place. <br>  For example, if an employee leaves a company, you simply remove him from LDAP, and he automatically loses all access. <br></blockquote><br><h3>  Host checking </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the possibility of a remote connection, we get the risk of allowing not only an employee of the company to the network, but also all the malicious software that is most likely present on his computer (for example, home), and moreover, through this software we may open our network to the attacker using this host as a proxy. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is reasonable for a remotely connected host to apply the same security requirements as a host located in the office. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This includes the ‚Äúcorrect‚Äù version of the OS, anti-virus, anti-spyware, and firewall software and updates. Usually, this feature exists on the VPN gateway (for ASA, see, for example, </font></font><a href="https://community.cisco.com/t5/security-documents/how-to-configure-anyconnect-host-scan/ta-p/3118732"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is also wise to apply the same methods of analyzing and blocking traffic (see ‚ÄúHigh level of protection‚Äù), which, in accordance with your security policy, applies to office traffic. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is reasonable to proceed from the assumption that now your office network is not limited to an office building and the hosts located in it.</font></font><br><br><blockquote>  <b>Example</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A good reception is to provide each employee who needs remote access with a good, convenient laptop and demand to work, both in the office and from home, only from him. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This not only increases the security level of your network, but is also really convenient and usually perceived by employees positively (if it is a really good and convenient laptop).</font></font></blockquote><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> About sense of proportion and balance </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In principle, this is a conversation about the third vertex of our triangle - about the price. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's look at a hypothetical example.</font></font><br><br><blockquote>  <b>Example</b> <br><br>     200 .         . <br><br>                    .  security ,      (anti-virus, anti-spyware, and firewall software),          . <br><br>      (  )         10-  ,    ‚Äî  NGFW , , Palo Alto  7K (c 40  ),      , , High Availability . <br><br> , ,             security . <br><br> ,        . <br><br> ,  10    ,    (   )      . <br><br> , 200 ‚Ä¶ <br> ? , . <br><br>        ‚Ä¶ <br> ,     -  ,       .      ‚Äî  ,     , ,      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Is this example exaggerated? The next chapter will answer this question. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you are on your network, you do not see anything of the article reviewed in this article, then this is the norm </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For each case, you need to find a reasonable compromise between convenience, price and security. Often NGFW is not even required in your office, L7 protection on the firewall is not required. Enough to provide a good level of visibility and alerts, and this can be done using open source products, for example. Yes, your reaction to the attack will not be instant, but the main thing is that you will see it, and if you have the right processes in your department, you will be able to quickly neutralize it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And let me remind you that according to the intention of the cycle of these articles, you are not engaged in designing a network, you are just trying to improve what you got.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SAFE office architecture analysis </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pay attention to this red square, with which I have allocated a place in the diagram from the </font></font><a href="https://www.cisco.com/c/dam/en/us/solutions/collateral/enterprise/design-zone-security/safe-architecture-guide-secure-campus.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAFE Secure Campus Architecture Guide</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that I would like to discuss here. </font></font><br><br><img src="https://habrastorage.org/webt/jp/lt/wq/jpltwq3cyzx54oyxtz7-hwy6s9u.png" alt="image"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is one of the key places of architecture and one of the most important uncertainties.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I have never set up or worked with FirePower (from the Cisco firewall product line ‚Äî only with ASA), so I will consider it like any other firewall, for example, like Juniper SRX or Palo Alto, assuming that it has the same features .</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> From conventional designs, I see only 4 possible uses of the firewall with this connection: </font></font><br><br><ul><li>        ,      transparent  (      ,     L3 ) </li><li>        -  ( SVI ),    L2 </li><li>     VRF,    VRF   ,    VRF  ACL   </li><li>         ,      </li></ul><br><blockquote> <b> 1</b> <br><br>    ,        . </blockquote><blockquote> <b> 2</b> <br><br>     PBR ( service chain),   ,       ,   ,      . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the description of the streams in the document, we see that all the traffic goes through the firewall, that is, in accordance with the design of Cisco, the fourth option disappears. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's first consider the first two options. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With these options, all traffic goes through the firewall. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we look at the </font></font><a href="https://www.cisco.com/c/en/us/products/collateral/security/firepower-ngfw/data_sheet-c78-736661.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data sheet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we look at the </font></font><a href="https://itprice.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cisco GPL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and see that if we want the total bandwidth for our office to have at least 10 to 20 gigabits, then we should buy the 4K version.</font></font><br><br><blockquote> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> When I talk about the total bandwidth, I mean traffic between subnets (and not within the same Vilana).</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the GPL, we see that for the HA Bundle with Threat Defense, the price, depending on the model (4110 - 4150), varies from ~ 0.5 - 2.5 million dollars. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is, our design begins to resemble the previous example. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Does this mean that this design is wrong?</font></font><br>  No, it does not mean.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cisco provides you with the best possible protection based on the product line it has. But this does not mean that it is a ‚Äúmast-doo‚Äù for you. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In principle, this is a common question that arises when designing an office or a data center, and this only means that you need to look for a compromise. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, not all traffic is allowed through the firewall, and in this case, the third option seems pretty nice to me, or (see the previous section), you may not need Threat Defense or you don't need a firewall at all in this network segment, and you just need to passive monitoring with the use of paid (not expensive) or open source solutions, or firewall is needed, but another vendor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usually there is always this uncertainty and there is no definite answer as to which solution is best for you.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This is the complexity and beauty of this task. </font></font></div><p>Source: <a href="https://habr.com/ru/post/447610/">https://habr.com/ru/post/447610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447594/index.html">Custom instruments: when signpost is not enough</a></li>
<li><a href="../447598/index.html">We write the game "Memory Cards" on Swift</a></li>
<li><a href="../447604/index.html">Equal teeth, C ++ and math - how are they related? Talk with Align</a></li>
<li><a href="../447606/index.html">CLRium # 5 Garbage Collector: Peter - Sold Out</a></li>
<li><a href="../447608/index.html">The evolution of CI in the mobile development team</a></li>
<li><a href="../447612/index.html">Space data center. Text translation of server startup into the stratosphere</a></li>
<li><a href="../447614/index.html">You can not solve this problem at the interview</a></li>
<li><a href="../447616/index.html">Connecting "Aquastorozh" to "smart home" on Z-Wave</a></li>
<li><a href="../447618/index.html">Kanopy streaming service database has leaked up to 40 million log records of movies viewed by users</a></li>
<li><a href="../447626/index.html">Generator of large transaction graphs with criminal activity patterns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>