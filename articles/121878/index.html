<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visual cryptography for color images</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I came across Habr√© for a couple of posts about hiding data in BMP files ( one and two ) and decided to share my experience in this field. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visual cryptography for color images</h1><div class="post__text post__text-html js-mediator-article">  Recently I came across Habr√© for a couple of posts about hiding data in BMP files ( <a href="http://habrahabr.ru/blogs/programming/115673/">one</a> and <a href="http://habrahabr.ru/blogs/infosecurity/114875/">two</a> ) and decided to share my experience in this field.  This time we will hide the color image, and we will use three more images as containers. <br><a name="habracut"></a><br><br><h4>  A few words about BMP </h4><br>  The BMP file consists of a header - a structure of several tens of bytes containing the main image parameters (dimensions, color depth, etc.), a palette - an array describing the colors used in the image, and a data area containing a sequence of image pixel codes .  The palette is not obligatory - in most BMP files there is no palette, and the data area contains a description of all the color components of each pixel of the image in the RGB format (that is, the quantitative values ‚Äã‚Äãof red, green, and blue). <br><br><h4>  Method Description </h4><br>  As input images, 24-bit bitmap images are used, in which each color has 8 bits of information.  We will hide the data using the <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25B5%25D0%25B3%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%258F">LSB</a> method. <br>  The essence of the algorithm is that the secret image is divided into three color primitives (that is, shades of red, green and blue), and then each primitive is written to the low-order bits of one of the image containers.  Thus, after encryption, each container will contain one color component of the secret image. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Image encryption </h4><br>  To determine which of the images to hide the R-component, which one - G, and which one - B, before starting the algorithm, the quantitative value of each of the three shades in each image container is determined.  Next, the containers are selected in such a way that the difference in the colors of the container and the color primitive of the secret image is minimal. <br>  Then, from each color primitive, two high-order bits are taken and written to the low-order bits of the corresponding color in the corresponding container.  The two lower bits in the two remaining colors are reset.  The operation is repeated for each pixel. <br><br><h5>  The code of the function that writes the color primitive to the container </h5><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CombineColorsRGB</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Color secretColor, Color containerColor, HidingColor hidingColor</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> r1 = secretColor.R; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> g1 = secretColor.G; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b1 = secretColor.B; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> r2 = containerColor.R; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> g2 = containerColor.G; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b2 = containerColor.B; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> secretBits = m_secretBits; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalBits = <span class="hljs-number"><span class="hljs-number">8</span></span> - m_secretBits; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (hidingColor) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HidingColor.R: r1 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r1 &gt;&gt; originalBits); r2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((r2 &gt;&gt; secretBits) &lt;&lt; secretBits); r2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r1 | r2); g2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((g2 &gt;&gt; secretBits) &lt;&lt; secretBits); b2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((b2 &gt;&gt; secretBits) &lt;&lt; secretBits); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HidingColor.G: g1 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g1 &gt;&gt; originalBits); g2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((g2 &gt;&gt; secretBits) &lt;&lt; secretBits); g2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g1 | g2); r2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((r2 &gt;&gt; secretBits) &lt;&lt; secretBits); b2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((b2 &gt;&gt; secretBits) &lt;&lt; secretBits); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HidingColor.B: b1 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b1 &gt;&gt; originalBits); b2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((b2 &gt;&gt; secretBits) &lt;&lt; secretBits); b2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b1 | b2); r2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((r2 &gt;&gt; secretBits) &lt;&lt; secretBits); g2 = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)((g2 &gt;&gt; secretBits) &lt;&lt; secretBits); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } Color col = Color.FromArgb(r2, g2, b2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> col; }</code> </pre> <br>  This function is performed for each color of each pixel of the secret image. <br>  In our case, m_secretBits = 2. <br><br>  Secret Image: <br><img src="http://habrastorage.org/storage/80985a64/13a63ccf/87d7b4cd/87b5f633.png"><br><br>  A set of source images for encryption: <br><img src="http://habrastorage.org/storage/8225833f/d42f00f7/269865db/387bb059.png"><br><br><img src="http://habrastorage.org/storage/becff99a/6189a6c2/ba8e1bec/991cda64.png"><br><br><img src="http://habrastorage.org/storage/c2386b0a/dacd6692/1ac8df21/db04de35.png"><br><br>  The same images, but already with a secret image encrypted in them: <br><img src="http://habrastorage.org/storage/70f26bfb/e8334d40/b08d1830/6be7fb13.png"><br><br><img src="http://habrastorage.org/storage/81ea8f5d/1856ca20/70796e41/06dd41c2.png"><br><br><img src="http://habrastorage.org/storage/d8527ba5/72e8561d/c6e60fb5/c4cee209.png"><br><br>  As seen in the images, visually distortions are not noticeable.  I apologize that the images are small - regretted traffic.  On large images, distortions are also not noticeable - believe me. <br><br><h4>  Image Recovery </h4><br>  The next step is to restore the hidden image.  To do this, take the first pixel from each image-container.  We make the two low-order bits of each color in these pixels with the high-order bits and add the corresponding color components (since the low-order bits of an unencrypted color were zeroed during encryption, then only one color component in each container will have a non-zero value).  Thus, we will restore the color of the corresponding pixel of the secret image (with some error).  Then repeat this operation for all pixels and get the recovered secret image. <br><br><h5>  The code of the function that restores the secret image from the containers </h5><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSecretColorRGB</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Color color1, Color color2, Color color3</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> r1 = color1.R; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> g1 = color1.G; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b1 = color1.B; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> r2 = color2.R; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> g2 = color2.G; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b2 = color2.B; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> r3 = color3.R; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> g3 = color3.G; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b3 = color3.B; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> secretBitsDigit = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Math.Pow(<span class="hljs-number"><span class="hljs-number">2.0</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)m_secretBits)) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> originalBits = <span class="hljs-number"><span class="hljs-number">8</span></span> - m_secretBits; <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> r = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(((r1 &amp; secretBitsDigit) &lt;&lt; originalBits) + ((r2 &amp; secretBitsDigit) &lt;&lt; originalBits) + ((r3 &amp; secretBitsDigit) &lt;&lt; originalBits)); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> g = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(((g1 &amp; secretBitsDigit) &lt;&lt; originalBits) + ((g2 &amp; secretBitsDigit) &lt;&lt; originalBits) + ((g3 &amp; secretBitsDigit) &lt;&lt; originalBits)); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> b = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(((b1 &amp; secretBitsDigit) &lt;&lt; originalBits) + ((b2 &amp; secretBitsDigit) &lt;&lt; originalBits) + ((b3 &amp; secretBitsDigit) &lt;&lt; originalBits)); Color col = Color.FromArgb(r, g, b); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> col; }</code> </pre><br>  This function is performed for each triples of the corresponding pixels of the image containers. <br><br>  Secret image after recovery: <br><img src="http://habrastorage.org/storage/03c87a49/433604ff/10ac2cc8/2ed3a3aa.png"><br><br>  But what happens if at least one of the images does not contain the necessary encrypted data: <br><img src="http://habrastorage.org/storage/f4852159/b6c7fac6/63557731/a96042df.png"><br>  The same result will be obtained if, before recovery, to play with scaling images. <br><br>  But if you resave images in JPEG with medium quality, and then again in BMP, then this will almost not cause additional distortion: <br><img src="http://habrastorage.org/storage/d072405c/6f261170/232f2857/f001d16f.png"><br><br><h4>  Results </h4><br>  To recover the image encoded by the described method, it is necessary to use all three container images obtained as a result of encryption.  Otherwise, instead of the reconstructed image, we get only color noise. <br>  The obvious disadvantage of the method is the distortion of the colors of the secret image during encryption (after all, only two high-order bits of eight are used).  Of course, no one bothers us to increase the number of encrypted bits, but this will already affect the quality of the image containers. </div><p>Source: <a href="https://habr.com/ru/post/121878/">https://habr.com/ru/post/121878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121867/index.html">Google invests $ 280 million in alternative energy</a></li>
<li><a href="../121870/index.html">The reasons for the migration of IT people from Russia or the top vacancies with the need to move</a></li>
<li><a href="../121871/index.html">20 years in Russia!</a></li>
<li><a href="../121872/index.html">Is it possible to learn from an entrepreneur?</a></li>
<li><a href="../121875/index.html">Exchange of IT services: publish offers, place orders</a></li>
<li><a href="../121882/index.html">Digital paradise in each district. Governor Tkachev announced yesterday on Twitter a program for the development of free Internet for WiFi in the Krasnodar Territory</a></li>
<li><a href="../121884/index.html">9 most important points when selling</a></li>
<li><a href="../121885/index.html">We use php-cgi in our applications</a></li>
<li><a href="../121888/index.html">What dreams of orange carts</a></li>
<li><a href="../121890/index.html">How to find out which ports on the switches are no longer used</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>