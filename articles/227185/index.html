<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development for Microsoft SQL Server: Unix way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 Medium and large projects, in which the whole or a significant part of the business logic is implemented in the stored procedures of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development for Microsoft SQL Server: Unix way</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  Medium and large projects, in which the whole or a significant part of the business logic is implemented in the stored procedures of the DBMS, have a number of inconveniences in managing the code of the modules.  Namely: <br><ul><li>  Lack of versioning and tracking code changes; </li><li>  Difficulties in synchronization of test and working infrastructure; </li><li>  The scarcity of search, navigation, and code review tools. </li></ul><br>  Yes, there are commercial products that solve these problems in whole or in part, however, in the opinion of the author, they do it not effectively and not elegantly.  In view of this, the mapping of modules and database structure to the file system is implemented, using <a href="http://fuse.sourceforge.net/">FUSE</a> (Filesystem in Userspace), in the <a href="https://github.com/AlexandrMov/SQLFuse">SQLFuse</a> project.  Now followers of the <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D0%25BE%25D1%2581%25D0%25BE%25D1%2584%25D0%25B8%25D1%258F_UNIX">Unix way</a> will be able to go here. <br><br>  Consider the sequence of actions for mounting an experimental database. <br><a name="habracut"></a><br><h4>  Preparing to mount </h4><br>  To build and mount the following software is needed: <br><ul><li>  <i>FUSE</i> module Linux kernel; </li><li>  <i>FreeTDS</i> driver; </li><li>  Necessary software for assembly.  Usually called in popular Linux distributions as <i>base-devel</i> , which includes the <i>gcc</i> compiler, the <i>make</i> tool, and so on; </li><li>  GNU Bison and Flex. </li></ul><br>  Ensure that the <em>FUSE</em> kernel module is loaded: <br><pre><code class="bash hljs">modprobe -a fuse</code> </pre> <br>  After the software is installed, you need to clone the git repository: <br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/AlexandrMov/SQLFuse.git</code> </pre> <br>  Building the project is done by the teams: <br><pre> <code class="bash hljs">make clean make</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Customization </h4><br>  If the compilation and build is successful, then you need to configure the <i>sqlfuse.conf</i> configuration file, which is located in the <i>conf</i> directory of the cloned repository: <br><pre> <code class="hljs pgsql"> #   ,     [<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>] #   maxconn=<span class="hljs-number"><span class="hljs-number">1</span></span> #  ,     <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> appname=SQLFuse #    [AdventureWorks2008R2] #    / <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> servername=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">.50</span></span> #   dbname=AdventureWorks2008R2 #  ,   sqlfuse.auth.conf auth=advauth</code> </pre><br>  The <i>auth</i> parameter refers to the group name defined in the <i>sqlfuse.auth.conf</i> file: <br><pre> <code class="hljs objectivec"> <span class="hljs-meta"><span class="hljs-meta">#    [advauth] #   username=fuse #   password=123</span></span></code> </pre><br>  Instead of the <i>auth</i> parameter in the <i>sqlfuse.auth.conf</i> file, the definition of <i>username</i> and <i>password</i> in the <i>sqlfuse.conf</i> file is <i>allowed</i> .  This is not done on purpose, as the <s>author is paranoid</s> when editing connection profiles, someone can peek at the user's password. <br><blockquote>  When specifying a server instance, for example, <i>SQLServer \ SQLEXPRESS</i> , the <i>"\"</i> character can be <i>omitted</i> .  This is also true for the <i>username</i> parameter if you need to log in via Active Directory. </blockquote><br>  Do not forget that the <a href="http://msftdbprodsamples.codeplex.com/releases/view/59211">AdwentureWorks2008R2</a> database must be connected, and the selected user has all the necessary rights to modify the SQL Server modules. <br><br><h4>  Known Issues </h4><br>  If you have problems with encodings, then try using the <em>to_codeset</em> and <em>from_codeset parameters to</em> specify the direction of conversion: <br><pre> <code class="hljs">from_codeset=UTF-8 to_codeset=CP1251</code> </pre><br>  When an error occurs: <br> <code>Heterogeneous queries require the ANSI_NULLS and ANSI_WARNINGS options to be set for the connection. This ensures consistent query semantics. Enable these options and then reissue your query.</code> <br>  Use the <em>ansi_npw = true</em> parameter to force the inclusion of the <em>QUOTED_IDENTIFIER, ANSI_NULLS, ANSI_WARNINGS, ANSI_PADDINGS options</em> to <em>ON</em> : <br><br><h4>  Mounting </h4><br>  Create the <i>advworks</i> folder in the root of the cloned <a href="https://github.com/AlexandrMov/SQLFuse">SQLFuse</a> repository and mount our database into it: <br><pre> <code class="bash hljs">mkdir advworks ./sqlfuse -o profilename=AdventureWorks2008R2 ./advworks</code> </pre><br>  You can use the -d option to keep track of errors generated by SQL Server: <br><pre> <code class="bash hljs">./sqlfuse -d -o profilename=AdventureWorks2008R2 ./advworks &amp;&gt; ./advworks.log &amp;</code> </pre> <br><br><h4>  Basic actions on modules </h4><br>  Let me give you an example of a few simple actions on server objects. <br><ul><li>  View and navigate through the database structure in <em>MidnightCommander</em> : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a5e/775/b99/a5e775b99fa9d277598a1b90f0776e29.png"></div><br><br></li><li>  Creating a new field in the <em>Person.Person</em> table and deleting it: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"COLUMN TestColumn NVARCHAR(50) NOT NULL"</span></span> &gt; ./Person/Person/TestColumn rm ./Person/Person/TestColumn</code> </pre><br></li><li>  Copying the procedure from the <em>HumanResources</em> scheme to the <em>dbo</em> scheme: <br><pre> <code class="bash hljs">cp ./HumanResources/uspUpdateEmployeeLogin ./dbo/uspUpdateEmployeeLogin</code> </pre> <br></li><li>  Search procedure by name in all schemes: <br><pre> <code class="bash hljs">find ./ -maxdepth 2 -iname *Employee* -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">print</span></span></code> </pre> </li></ul><br>  Thus, management and navigation through the modules becomes like in the usual file directories: version control systems, patches and favorite code editors can be used, that is, the whole Unix philosophy is evident for SQL Server. <br><blockquote>  keep in mind that <em>truncate</em> is not supported yet, which means execute the command <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">" NOT NULL"</span></span> &gt;&gt; TestColumn</code> </pre>  will not work.  Although the operation was blocked at the file system level, it was still not recommended to do this, as it can lead to a re-creation of the column and data loss! <br><br>  <strong>Always save the original modules before editing!</strong> <br></blockquote><br>  If you make a mistake in the description of the module or a disconnection occurred, the file system will return the error <em>-EFAULT</em> (‚Äú <em>Invalid</em> address‚Äù). <br><br><h4>  Supported Modules </h4><br>  At the time when the post was written, SQLFuse supported the following modules for <strong>reading / writing</strong> : <br><ul><li>  Stored procedures, functions; </li><li>  Restrictions CHECK, DEFAULT; </li><li>  Columns and triggers. </li></ul><br>  <em>Schemes, tables, views</em> are available <strong>only for reading</strong> .  <em>FOREIGN KEY, PRIMARY KEY and indexes</em> restrictions are <strong>not displayed at all</strong> .  When there will be more free time I will add this functionality. <br><br>  It was necessary to slightly simplify the syntax of T-SQL, in order to avoid confusion and more flexible module management.  Everything remains the same, except that redundancy in the table description has been removed in the definition of constraints and columns.  Definitions will look like this: <br><ul><li>  Columns: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*ALTER TABLE Person.Person ADD/ALTER/DROP*/</span></span> COLUMN TestColumn DATETIME <span class="hljs-comment"><span class="hljs-comment">-- ...</span></span></code> </pre> </li><li>  CHECK limit: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*ALTER TABLE Person.Person ADD/DROP*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHECK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> CK_Test <span class="hljs-keyword"><span class="hljs-keyword">CHECK</span></span> <span class="hljs-comment"><span class="hljs-comment">-- ...</span></span></code> </pre> </li><li>  DEFAULT constraint: <br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*ALTER TABLE Person.Person ADD/DROP*/</span></span> DEFAULT (GETDATE()) FOR (TestColumn) <span class="hljs-comment"><span class="hljs-comment">-- ...</span></span></code> </pre> </li></ul><br>  In parts where the instructions about the target table are commented out, SQLFuse will make the substitution of the necessary code automatically, based on the location of the module file.  The name of the module, which is defined in the text of the file, does not matter, it will be replaced with the name of the file, schema and / or table as necessary.  In the texts of the modules there can not be several packages of commands,  <em>GO</em> <br><br><h4>  Epilogue or what's next? </h4><br>  As free time comes, plans to implement: <br><ul><li>  Support for constraints and indexes, as well as manipulation of tables, views, and diagrams; </li><li>  Logging of SQL commands and outputting them through a channel or just a file; </li><li>  Saving backups when manipulating modules, support for rollback in case of errors; </li><li>  In the next post, describe the formation of table definitions, and the transformation of the structure into SQL scripts. </li></ul><br>  Who is interested in the idea and who wants to take part in the development - welcome: all the source code is available under the GPLv3 license.  The author will be glad to any comments and suggestions. <br><br>  PS I can tell you about the experience of developing a user-mode file system at FUSE, if anyone is interested. <br><br><h4>  Data sources </h4><br><ul><li>  The AdventureWorks2008R2 database is <a href="http://msftdbprodsamples.codeplex.com/releases/view/59211">http://msftdbprodsamples.codeplex.com/releases/view/59211</a> ; </li><li>  The GPLv3 license is <a href="http://www.gnu.org/licenses/gpl-3.0.html">http://www.gnu.org/licenses/gpl-3.0.html</a> ; </li><li>  FreeTDS - <a href="http://freetds.org/">http://freetds.org/</a> ; </li><li>  GNU Bison - <a href="http://www.gnu.org/software/bison/">http://www.gnu.org/software/bison/</a> ; </li><li>  Flex - <a href="http://flex.sourceforge.net/">http://flex.sourceforge.net/</a> ; </li><li>  FUSE - <a href="http://fuse.sourceforge.net/">http://fuse.sourceforge.net/</a> ; </li><li>  Wikipedia article on Unix Way - <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D0%25BE%25D1%2581%25D0%25BE%25D1%2584%25D0%25B8%25D1%258F_UNIX">http://ru.wikipedia.org/wiki/Philosofiya_UNIX</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/227185/">https://habr.com/ru/post/227185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227173/index.html">Smartphones and electronic inks: a difficult symbiosis</a></li>
<li><a href="../227175/index.html">Make the site work on touch devices.</a></li>
<li><a href="../227177/index.html">10 years ago, the first flight of a private spacecraft</a></li>
<li><a href="../227181/index.html">The use of sinter pastes in modern power semiconductor devices</a></li>
<li><a href="../227183/index.html">Comparison of geolocation binary databases and their drivers: GeoIP, Sypex Geo, TabGeo</a></li>
<li><a href="../227189/index.html">Hola: principles of work</a></li>
<li><a href="../227193/index.html">Creating offline maps for iOS applications</a></li>
<li><a href="../227195/index.html">Reflections on the blues - once again about exception handling</a></li>
<li><a href="../227197/index.html">Porting a Windows 8.1 application to Windows Phone 8.0 with troubleshooting</a></li>
<li><a href="../227199/index.html">Modern aspects of the presentation of texts in the analysis of natural language: classical and alternative approaches</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>