<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tale of vintage icons. Riddle of 18 colors. Transparent and inverse colors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Few people now do not care about extra kilobytes or two. But there are such people, and just for such a person's zadrota , this note was written. ) 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tale of vintage icons. Riddle of 18 colors. Transparent and inverse colors</h1><div class="post__text post__text-html js-mediator-article">  Few people now do not care about extra kilobytes or two.  But there are such people, and just for such a person's <s>zadrota</s> , this note was written.  ) <br><br>  In those single instances when I needed to write down an expressive icon (.ico) of the application and at the same time I had to save bytes, I used the following hack: I recorded the image in 16-color mode - but!  - not in the usual fixed palette, but in adaptive. <br><br>  What does this give?  Icon 48x48, 1-bit transparency, 256 colors = 3774 bytes, it is also in 16 colors = 1662 bytes.  Winning - 2 kilobytes, with a slight drop in image quality. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/7r/hi/ph/7rhiphjjh6lvnh-k1qtcfdhzpmm.png"><br><br>  Example.  From left to right: <br><br><ul><li>  256-color original </li><li>  fixed standard 16-color palette (and here I picked up the hatching for a couple of minutes so that the image had at least some decent look) </li><li>  adaptive 16-color palette + hatching (dithering). </li></ul><br>  How it works?  Oddly enough, the 16-color icon always carries a palette.  That is, 99.9% of vintage icons carry exactly the same 64-byte color table (4 bytes per color).  And yes, it turns out it can be reprogrammed. <br><a name="habracut"></a><br>  Unfortunately, I am not familiar with the program that I can fully work with this kind of icons.  Therefore, here‚Äôs a recipe for ‚Äúdefective‚Äù to concoct a similar icon: take IrfanView, load a picture into it: either a 16-color pre-prepared or reduce the number of colors right in it: menu - image - reduce color depth ... - 16 colors.  Now: menu - save as ... - select the .ico format.  Everything?  No, not everything: Irfan View does not know how to work with transparency, it will have to be manually restored in another program.  Microangelo Studio can download and edit such icons (alas, it does not allow creating a library from them, just like creating such icons from scratch).  We load the icon into Microangelo and ... maybe we will immediately get a window with a warning about the ‚Äúincorrect palette‚Äù - what this means in practice will be explained later.  Using the ‚Äúfill‚Äù and ‚Äúpencil‚Äù tools we mark the transparent zones;  we write down;  is ready! <br><br>  That was what I did before, ten years ago.  Now, after carefully looking at the Microangelo palette, I have questions.  What is this strange palette, 18 colors?  How can you store 18 colors in a file?  The number is not round, gentlemen programmers do not do that;  it's just not convenient for them.  )) It can be seen that there are 16 solid colors in the palette and two service colors: ‚Äútransparent‚Äù and ‚Äúinverse‚Äù.  What kind of "inverse"?  - if such a color occurs, it displays the negative of what lies under it;  this is most often used in cursors;  and the cursor ‚Äî in fact and in terms of the file structure ‚Äî is also an icon.  But how are all these colors stored?  If ordinary image points are packed in 4 bits (16 colors), then transparency can be stored only as a separate bitmask (1 bit for each image point).  Okay, so where is the inversion stored?  Another mask, or what?  Not economical, but possible ... Let's count. <br><br>  Icon 48x48, 16 colors, 1 image.  The file size is 1662 bytes.  What's in it?  I have little idea of ‚Äã‚Äãthe subtleties, but try to estimate.  The main part, the image itself: 48 * 48/2 = 1152 bytes.  Palette: 16 * 4 = 64 bytes.  Transparency mask 48 * 48/8 = 288 bytes.  Header .ico, officially = 6 bytes.  Description of the frame (1 pc.) From the documentation = 16 bytes.  Total: 1152 + 64 + 288 + 6 + 16 = 1526. Probably there is something else there, because the actual file size is larger - but this is not important;  another thing is important, the remainder of the ‚Äúdissimilarity‚Äù is small: 136 bytes, and it clearly does not allow placing another bit mask of 288 bytes in size.  So ... the inverse color is somehow embedded in the picture itself.  Maybe now you can guess yourself how they did it? <br><br>  And they did it, apparently, as follows: in the original Windows (it seems, starting from Win 95OSR2 fully, and in Win XP and newer - already partially), in icons and cursors, strictly speaking - there was no real transparent color.  If the alpha mask showed: the current point of the cursor / icon is ‚Äútransparent‚Äù - the color under the cursor / icon was taken and XOR was (exclusive or); or maybe there was just a subtraction) - attention!  - with the current point color taken from the icon palette. <br><br>  What is the result?  If it was the first color (black in a fixed palette), XOR did with the background ‚Äúnothing‚Äù - the color became just transparent.  If it was the last color (white in the fixed palette), the color changed completely, turned into negative.  This is the whole secret of how the ‚Äú18 colors‚Äù were stored ... That is, once again: ‚Äútransparent‚Äù = black (+) alpha mask, ‚Äúinverse‚Äù = white (+) alpha mask.  And now - let's talk about the "glitches". <br><br>  The above-mentioned warning of Microangelo says: ‚Äúyou do not have full-fledged white and black colors in the palette, working with transparency will be incorrect!‚Äù.  Indeed, our adaptive palette can easily do without black or white colors.  How, then, will work transparency?  Oh, exactly as we expect: some color will be taken from the palette (for example, green), ‚Äúopened‚Äù (XOR) with a background, and we will get a beautiful purple color instead of transparency.  )) Or another example - the place of the last color in the palette accidentally got black: and the ‚Äúinversion‚Äù turned into normal full transparency. <br><br><img src="https://habrastorage.org/webt/ri/69/um/ri69um6yqmwzvzwbbtywqwimqpg.png"><br><br>  <i>Example: on the left a standard palette, on the right reprogrammed.</i>  <i>On the left, transparency (P) and inversion (I) work as it should;</i>  <i>on the right - obviously not.</i> <br><br>  However, we can observe all these charms of icons only in original Windows.  Modern operating systems, such as Win 10, ignore the colors of the palette, and the bit mask ‚Äútransparency‚Äù always works just like transparency in its pure form: there is no XOR, and there is no inversion, respectively.  However, in the cursor display mechanism, there is still compatibility - a full-fledged good old economical scheme works there;  "Warm, lamp", and ... very few people understand and need. <br><br><img src="https://habrastorage.org/webt/o_/r9/lo/o_r9lonhiwt4dyhaecuvewmsapw.png"><br><br>  <i>Example: different display of the same icons in Windows XP and in Windows 7.</i> </div><p>Source: <a href="https://habr.com/ru/post/422495/">https://habr.com/ru/post/422495/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422483/index.html">MIS. Inserts and removed organs</a></li>
<li><a href="../422485/index.html">How to save money when starting a business in the USA: company registration, office, accounting and promotion</a></li>
<li><a href="../422487/index.html">A quick guide to variables in CSS (reasons for usage, syntax and examples)</a></li>
<li><a href="../422491/index.html">Money decides. "We have three developers, but we do not know how to work"</a></li>
<li><a href="../422493/index.html">Kubernetes (k8s) + Helm + GitLab CI / CD. Properly deployed</a></li>
<li><a href="../422497/index.html">ICANN published a detailed guide on what to expect during a KSK update in the root zone.</a></li>
<li><a href="../422499/index.html">Once again about web components ...</a></li>
<li><a href="../422501/index.html">New technological processes for the production of microcircuits are more often postponed - why?</a></li>
<li><a href="../422507/index.html">PHP 7.3. What's new</a></li>
<li><a href="../422509/index.html">Summary of the book "Never Eat Alone"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>