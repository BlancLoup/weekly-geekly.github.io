<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Translating the D-Link DIR-320 into a 3G router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am more than sure that many have seen such headlines more than once. But every time you read them, it turns out that you need to buy some of the wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Translating the D-Link DIR-320 into a 3G router</h1><div class="post__text post__text-html js-mediator-article">  I am more than sure that many have seen such headlines more than once.  But every time you read them, it turns out that you need to buy some of the world's most proven modem, and besides, luck should be favorable to you.  But the most common problem is that there is no such modem that would not hang after a certain time.  The longest interval that I saw is 8 (eight) hours.  As a result, many people reject such an idea and give up, and if there is no way without a router, then an old PC is adapted for this purpose, and they also install Windows (as a rule, XP, well, or what will be at hand). <br>  Since the PC, and especially Windows, is not an option for me and I didn‚Äôt have the ‚Äúmodem‚Äù at hand, I had to find a solution. <br>  If continuation is interesting, I ask under "kat". <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  As it probably became clear to many from the preface, I was faced with the task of making a small and very stable 3G router. <br>  What is required for this: <br><ul><li>  Router DIR-320 (was available) </li><li>  3G modem </li><li>  External antenna </li></ul><br><h4>  Research and goal setting </h4><br>  So, before you do something yourself, I began by analyzing numerous forums and communities.  At each forum there were branches with a description of the very miracle of modems and an infinite number of related problems.  Some were mega stable, but with an unacceptably low speed, others were pleased with the performance, but after 30 minutes they ‚Äúhung‚Äù tightly.  All this is very sad. <br><br>  Before going to the ‚Äúbins of the homeland‚Äù for an old PC, I decided to analyze the facts and independently investigate the problem. <br><br>  For primary experiments, I decided to use a stationary PC with Linux.  After setting up the 3G connection, using the available Huawei E173, I launched the ping + wget command at intervals of 10 minutes.  The connection lasted about 4 (four) hours, after which the modem stopped responding to the PPP commands, while AT worked.  I conducted the same experiment with AnyDATA ADU-500A (this is a modem from the list of "those").  Oddly enough, it ended all the same, only after 5 hours. <br>  Any attempts to revive, did not bring the long-awaited result, only the complete de-energizing saved the situation. <br>  Once again, I decided to reboot the modem and it dawned on me, and why not just put out the USB port.  No sooner said than done: <br><ol><li>  Find a modem from the list of all USB devices: <br><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> `ls /sys/bus/usb/devices/*/product`; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">\t`cat </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">`"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br></li><li>  Turn off the port for 5 seconds and then turn it on: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> ‚Äú<span class="hljs-built_in"><span class="hljs-built_in">suspend</span></span>‚Äù | sudo tee /sys/bus/usb/devices/1-1/power/level sleep 5 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"on"</span></span> | sudo tee /sys/bus/usb/devices/1-1/power/level</code> </pre><br></li></ol><br>  The experiment showed that everything is fine restarts.  And the connection can be established again.  From this point on, it became extremely clear what to do. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Taking four firmware for the router: D-Link, Asus, OpenWRT, or DD-WRT, I began to repeat the experiment, but bad luck, surprisingly, none of the firmware had USB power management capability.  At first, I thought it was a 2.4.x core problem.  But the same problem with 2.6.  Moreover, after rebooting the router, the modem remained initialized.  The conclusion suggested itself, you need to disassemble the router. <br>  Attentive inspection and ‚Äúdialing‚Äù of the board showed that the ‚Äú+ 5V‚Äù power leg is connected directly to the power supply.  This does not suit me and needs to be done to upgrade the board and the power source. <br><br>  The moment of choosing the distribution kit has come.  This wonderful router has very little RAM and did not want any unnecessary services to consume it, be it httpd, FTP, SAMBA or anything else.  It was decided to build a distribution based on OpenWRT independently, with a minimum of pre-installed packages and services. <br><br>  But before proceeding with the assembly of the distribution kit and the upgrade of the router, work was underway to select the target modem / operator and external antenna. <br><br>  After reviewing the coverage map of different operators, I came to the conclusion that the most suitable is MTS.  In addition to the coverage map, I really liked the fact that they can make all the statistics and management from a fairly convenient WEB interface.  Having bought their best modem, with the promised maximum of 14.7 Mbit / s and at least 3 Mbit / s, I began my adventure. <br>  Perhaps someone will be interested: <br><ul><li>  3G modem (was purchased by <a href="http://www.mts.com.ua/rus/wm_d300.php">MTS WeTelecom WM-D300</a> ) </li><li>  Directional antenna CDMA-450 (not bad, according to the seller, <a href="http://3gstar.com.ua/Antenna-cdma450Mgc-usileniem-17Db-MTSkonnekt-kabel-perehodnik-p-323.html">some unknown manufacturer</a> ) </li></ul><br>  After the purchase began trying to connect to this modem.  And as always, a number of questions arose: <br><ol><li>  It is aggressively displayed as a CD-ROM. </li><li>  No word on the Internet about this modem, the maximum that was found this <a href="http://imbecyle.livejournal.com/432989.html">mention of the previous model (WM-D200)</a> </li></ol><br>  The dmesg analysis showed that the CD-ROM is mounted as SCSI, it suggested that it should be disabled exactly as SCSI, no usb_modeswitch does not work here, and in fact are not needed. <br>  Of course, he immediately wrote his software, which did it.  But the non-flowing thought, that someone already wrote this and most likely it already exists in the ports / portage or somewhere else, made it search.  The first pass through the folder with man'ami showed that there is a wonderful package sdparm.  Having established and checked, it became clear - this is what is needed. <br>  Since now everything has fallen into place and there are no more questions left, you can get to work. <br><br><h4>  Build openwrt </h4><br>  All steps are performed in the Linux console.  Please note, the release of Backfire is chosen due to the fact that this is the latest release with the 2.4 kernel.  This is very important, since the 2.6 kernel itself is very demanding on both processor performance and system resources. <br><ul><li>  Download the source OpenWRT: <pre> <code class="bash hljs">svn co svn://svn.openwrt.org/openwrt/branches/backfire openwrt-backfire</code> </pre></li><li>  Go to the folder with the source <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> openwrt-backfire</code> </pre></li><li>  We update all packages <pre> <code class="bash hljs">./scripts/feeds update -a</code> </pre></li><li>  Add from sdparm packages <pre> <code class="bash hljs">./scripts/feeds install sdparm</code> </pre></li><li>  Open the setup menu <br><pre> <code class="bash hljs">make menuconfig</code> </pre></li><li>  Choose a platform of interest <pre> <code class="markdown hljs">Target System (Broadcom BCM947xx/953xx [2.4])</code> </pre></li><li>  We build packages of interest to us (by default they are not included even as modules) <pre> <code class="markdown hljs"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> sdparm........................ Read or modify SCSI or USB disk parameters <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> chat................................. Establish conversation with a modem <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> comgt............................... Option/Vodafone 3G/GPRS control tool <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> kmod-scsi-generic........................ Kernel support for SCSI generic <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> kmod-usb-core............................................ Support for USB <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> kmod-usb-ohci............................... Support for OHCI controllers <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> kmod-usb-serial..................... Support for USB-to-Serial converters <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> kmod-usb-storage..................................... USB Storage support <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> kmod-usb2................................... Support for USB2 controllers</code> </pre></li><li>  All other items are left unchanged. </li><li>  Exit the configurator menu with saving </li><li>  We collect tools <pre> <code class="bash hljs">make tools/install -j`grep -c processor /proc/cpuinfo` make toolchain/install -j`grep -c processor /proc/cpuinfo`</code> </pre></li><li>  Open the Linux kernel configuration menu <pre> <code class="bash hljs">make kernel_menuconfig</code> </pre></li><li>  Customize MTD <pre> <code class="markdown hljs">[*] Support 2-chip flash interleave</code> </pre></li><li>  Exit the configurator menu with saving </li><li>  Putting OpenWRT <pre> <code class="bash hljs">make -j`grep -c processor /proc/cpuinfo`</code> </pre></li><li>  After the firmware is assembled, it needs to be flashed into the device.  There are lots of instructions on this topic ( <a href="http://www.dd-wrt.com/wiki/index.php/%25D0%259F%25D1%2580%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B2%25D0%25BA%25D0%25B0_DIR-320">for example, on the DD-WRT website</a> ) </li></ul><br><h4>  Firmware check </h4><br>  After the firmware has been ‚Äúflooded‚Äù and the router has rebooted, connect a modem to it and connect the router via Ethernet to your PC.  Configure on the interface (in my case this is eth0) of your PC with the IP address by running the command: <pre> <code class="bash hljs">ifconfig eth0 inet 192.168.1.2/24</code> </pre><br>  Next, connect to the router via Telnet.  To do this, run the following command from the console: <br><pre> <code class="bash hljs">telnet -l root 192.168.1.1</code> </pre><br>  Login will be made automatically without a password request.  This is fundamentally not true.  To correct the situation, set the password by running the command in the console: <br><pre> <code class="bash hljs">passwd</code> </pre><br>  Execute the " <i>exit</i> " <i>command</i> to exit the <b>telnet</b> session. <br>  Log in via <b>ssh</b> : <br><pre> <code class="bash hljs">ssh root@192.168.1.1</code> </pre><br>  The next step is to verify that the modem has been recognized by the kernel by running the command in the console: <pre> <code class="bash hljs">grep <span class="hljs-string"><span class="hljs-string">"^P\:.*22de.*6803"</span></span> /proc/bus/usb/devices</code> </pre><br>  The result of this command is a string with the VID and PID of the modem.  Otherwise, check what was not done according to the instructions. <br><br><h4>  Upgrading the router's hardware </h4><br>  To control the power of the USB port, you need a free processor foot.  But since this is not an engineering board, but an end product, this option is not suitable.  By luck, this router has a lot of LED indicators on the front panel.  One of them we can fully adapt to our needs.  In my case, the choice fell on an indicator with a printer icon, since it corresponded to the USB LED on proc-fs (/ proc / diag / led / usb). <br><br>  Power management will be provided by an additional charge with the minimum required set of parts.  Here is its scheme: <br><img src="https://habrastorage.org/storage2/404/9f7/9b0/4049f79b01bef30cf06cf8a977e98edf.png"><br>  A couple of words about the scheme.  Both transistors work as keys.  When a logical unit is fed to the ‚ÄúCTRL‚Äù input, the VT1 transistor will open, which in turn will lead to the opening of the VT2 transistor and the supply voltage will be fed to the USB port.  As such, the calculations were not made, therefore, the scheme can not be considered optimal.  For example, the transistor VT1, just was the only NPN transistor in the field of reach, in fact, like the resistors. <br><br>  There was neither time nor desire for the manufacture of a printed circuit board, so I managed a small piece of the circuit board.  Here is the final version: <br><img src="https://habrastorage.org/storage2/39a/1a6/425/39a1a6425ce2a6880e438158f5c09125.png"><br>  <i><u>Green inscriptions mark ports of the same name on the schematic.</u></i>  <i><u>Resistor R4, soldered directly to the leg of the LED.</u></i> <br><br>  Step-by-step modification instructions: <br><ul><li>  De-energize the router and disassemble it. </li><li>  Remove unnecessary R48 - this resistor connects the LED with the processor leg <br><img src="https://habrastorage.org/storage2/10d/f45/527/10df4552745b2745ed5346da95d21719.png"><br></li><li>  Remove the fuse F1 - this fuse should provide protection in case of a short circuit on the USB power lines.  I do not know his face value, but I applied it in my scheme (R3).  Please note that the yellow labels indicate the places where the control board is connected. <br><img src="https://habrastorage.org/storage2/227/da1/25f/227da125fadc9813836dc4a180e2fee8.png"><br></li><li>  Remove the protective coating from the conductor, leading the signal from the processor to the resistor R48.  To this conductor, the control board's CTRL port must be soldered <br><img src="https://habrastorage.org/storage2/5cb/a2e/dd9/5cba2edd97297b9066e5688fdd4b2632.png"><br></li><li>  Stick the control board to the place that is most convenient for you.  It turned out that I liked the free area, just below the antenna jack.  In this case, the length of the connecting wires will be the shortest <br><img src="https://habrastorage.org/storage2/8f5/6f8/e61/8f56f8e61961da594cf206f90f0dfc85.png"><br></li><li>  Solder the resistor R4 directly to the anode of the LED, as indicated in the photo.  Also pay attention to connecting connecting wires. <br><img src="https://habrastorage.org/storage2/f92/d1e/e63/f92d1ee6358149b327a9f2942782a968.png"><br></li><li>  Complete the installation of the connecting wires <br><img src="https://habrastorage.org/storage2/151/9dd/ca6/1519ddca6410f4a8752576caf252924a.png"><br></li><li>  Final result <br><img src="https://habrastorage.org/storage2/945/bb0/68c/945bb068c1d717120d70d2278cbee965.png"><br></li><li>  Collect and turn on the router </li></ul><br><h4>  Upgrade router software </h4><br>  This is the last step on the path to "happiness."  We will need to write a number of new scripts and make changes to existing ones.  So, everything is in order. <br>  Connect to the router via ssh, since all the following steps will be performed directly on it. <br><br><h5>  Creation of utilities for USB management </h5><br>  Navigate to the / etc / ppp folder.  Many will be interested in why this particular folder was chosen as the target.  The answer is simple, historically.  I think / usr / local / sbin will be more suitable, but essentially it does not change <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/ppp</code> </pre><br><ul><li>  Create usb-up.sh.  This script will power up the USB port. <pre> <code class="bash hljs">$ cat usb-up.sh <span class="hljs-comment"><span class="hljs-comment">#!/bin/sh logger -t "USB PwrCtrl" "Turn-on USB power" echo 1 &gt; /proc/diag/led/usb</span></span></code> </pre></li><li>  Create a script to reboot the USB port. <pre> <code class="bash hljs">$ cat resetusb.sh <span class="hljs-comment"><span class="hljs-comment">#!/bin/sh logger -t "USB PwrCtrl" "Turn-off USB power" echo 0 &gt; /proc/diag/led/usb # Sleep in 3 sec is an optional, but may be useful for some modem types #sleep 3 logger -t "USB PwrCtrl" "Turn-on USB power" echo 1 &gt; /proc/diag/led/usb</span></span></code> </pre></li><li>  Create a script to check for the existence of the pppd process. <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh if ps | grep -q /usr/sbin/pppd; then logger -t "PPP watcher" "PPP alive" else logger -t "PPP watcher" "No PPP daemon" /etc/ppp/resetusb.sh fi</span></span></code> </pre></li><li>  Make the scripts executable <pre> <code class="bash hljs">chmod a+x /etc/ppp/*.sh</code> </pre></li><li>  Add the correct processing modem connection to USB.  Note that in OpenWRT, by default, there is no udev, but hotplug ‚Äúdemon‚Äù is used instead. <pre> <code class="bash hljs">$ cat /etc/hotplug.d/usb/11-modem <span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Copyright (C) 2013 Sergey Shcherbakov &lt;shchers@gmail.com&gt; case "$ACTION" in add) (grep -q "^P\:.*22de.*6803" /proc/bus/usb/devices) &amp;&amp; { logger -t "WM-D300" "Detected ZeroCD of WM-D300 modem" # Checking ZeroCD status while [ "$(sdparm -q --command=ready /dev/scsi/host0/bus0/target0/lun0/generic)" != "Ready" ]; do logger -t "WM-D300" "ZeroCD yet not ready" # Workaround for bug with multiple calls of scripts (/usr/bin/lsusb | grep -q 22de:6801) &amp;&amp; { logger -t "WM-D300" "Seems that script called twice and device already initialized" return 0 } sleep 2 done logger -t "WM-D300" "ZeroCD ready and will be ejected" /usr/bin/sdparm --command=eject /dev/scsi/host0/bus0/target0/lun0/generic } (grep -q "^P\:.*22de.*6801" /proc/bus/usb/devices) &amp;&amp; [ ! -c /dev/usb/tts/0 ] &amp;&amp; { logger -t "WM-D300" "Updating USB Serial driver with D200/D300 vendor and product ID" rmmod usbserial &amp;&amp; insmod usbserial vendor=0x22de product=0x6801 } (grep -q "^P\:.*22de.*6801" /proc/bus/usb/devices) &amp;&amp; [ -c /dev/usb/tts/2 ] &amp;&amp; ! (ifconfig 3g-wan 1&gt;/dev/null 2&gt;/dev/null) &amp;&amp; { logger -t "WM-D300" "All modem interfaces installed, turning on WAN" ifdown wan &amp;&amp; ifup wan } ;; remove) ! (grep -q "^P\:.*22de.*6801" /proc/bus/usb/devices) &amp;&amp; { logger -t "WM-D300" "Modem disconnected, turning off WAN interface" ifdown wan } ;; esac</span></span></code> </pre></li></ul><br><h5>  Making changes to existing scripts </h5><br><ul><li>  Disable the default WAN interface by executing <pre> <code class="bash hljs">sed -i <span class="hljs-string"><span class="hljs-string">'s/interface\ wan$/interface\ wan_dflt/'</span></span> /etc/config/network</code> </pre></li><li>  Add a new WAN interface descriptor with <a href="http://wiki.openwrt.org/doc/uci/network">settings for 3G</a> <pre> <code class="markdown hljs">$ cat /etc/config/network ‚Ä¶ config interface wan option ifname ppp0 option device /dev/usb/tts/0 option service evdo option proto 3g option username 'mobile' option password 'internet' option pppd_options 'noipdefault maxfail 3' option connect '/etc/ppp/usb-up.sh' option disconnect '/etc/ppp/resetusb.sh' option keepalive 20</code> </pre></li><li>  In order to add an automatic inclusion of the USB port when the router is initialized, you need to modify the standard /etc/init.d/usb script by adding the /etc/ppp/usb-up.sh script call at the end of the start () function <pre> <code class="bash hljs">$ cat /etc/init.d/usb ‚Ä¶ <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span></span>() { ... <span class="hljs-comment"><span class="hljs-comment"># Turn-on power on USB /etc/ppp/usb-up.sh } ‚Ä¶</span></span></code> </pre></li><li>  Additionally, you can modify, but not necessarily, the Chat script (/etc/chatscripts/evdo.chat).  In fact, it should work even without changes, but I preferred to brush it a little.  Here is my option: <pre> <code class="markdown hljs">ABORT BUSY ABORT 'NO CARRIER' ABORT ERROR ABORT 'NO DIAL TONE' ABORT 'NO DIALTONE' ABORT 'NO ANSWER' REPORT CONNECT TIMEOUT 10 '' AT OK ATDT#777 CONNECT ''</code> </pre></li><li>  Add a task to Cron that will check for the presence of a pppd process every five minutes.  To do this, call the command ‚Äúcrontab -e‚Äù and add the following line: <pre> <code class="bash hljs">*/5 * * * * /etc/ppp/check.sh</code> </pre></li><li>  Allow cron execution and run it <pre> <code class="bash hljs">/etc/init.d/cron <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> &amp;&amp; /etc/init.d/cron start</code> </pre></li><li>  I will not give you the WiFi setting, since it is fairly standard and <a href="http://wiki.openwrt.org/doc/uci/wireless">well described on the official OpenWRT website</a> </li></ul><br>  That's all, more changes will not be.  I recommend restarting the router, although 3G should come to life in five minutes. <br><br><h4>  Instead of an epilogue </h4><br>  Home trials lasted 41 days.  As a result, a single failure throughout the entire period.  Expected stability achieved. <br>  Before being sent to the ‚Äúfields‚Äù, bandwidth tests were conducted in a Kiev apartment.  The disappointment took by surprise, the maximum reached did not exceed 1 Mbit / s, while only on large files.  The minimum ping was within 220ms.  Deciding not to stop testing, I went out of town.  The level was at the maximum, while the CDMA Rev.B indicator no longer burned.  In fact, I was not warm at 14Mbps, but I expected to see at least 1Mbps already achieved.  But the next disappointment was not long in coming, the maximum reached was already about 350 Kbps. <br>  On this, all experiments with the modem from the MTS were discontinued.  Return it failed.  But the seller has exchanged the antenna for a model capable of working in conjunction with Intertelecom and PeopleNET modems.  What I was extremely happy, and let the modem be in the collection, someday come in handy. </div><p>Source: <a href="https://habr.com/ru/post/184940/">https://habr.com/ru/post/184940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184926/index.html">How to use Fullscreen API</a></li>
<li><a href="../184928/index.html">The network posted 34-gigapixel panorama of Prague</a></li>
<li><a href="../184930/index.html">Post-mortem: Baldur's Gate: Enhanced Edition</a></li>
<li><a href="../184934/index.html">Review Parrot Asteroid Tablet - the most "car" Android</a></li>
<li><a href="../184938/index.html">The administration of VKontakte with the attackers blocking popular communities</a></li>
<li><a href="../184942/index.html">Building scalable applications in TypeScript. Part 1 - Asynchronous Module Loading</a></li>
<li><a href="../184946/index.html">Why I refused to use the Vkontakte API</a></li>
<li><a href="../184950/index.html">Turning on the server using a mobile phone from the outside world</a></li>
<li><a href="../184952/index.html">Build CLDC HotSpot Implementation for ARM</a></li>
<li><a href="../184954/index.html">Windows 8.1 (aka Blue) Preview available for download</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>