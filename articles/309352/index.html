<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Internet on magnets 4 - Divide the magnet into pieces</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my articles on the Internet on Magnets, I suggested publishing universal magnets with which you can download a file from any p2p network ( Gnutella...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Internet on magnets 4 - Divide the magnet into pieces</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/309352/"><img align="left" src="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo.svg"></a>  In my articles on the Internet on <a href="https://ru.wikipedia.org/wiki/Magnet-%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BA%25D0%25B0">Magnets,</a> I suggested publishing universal <a href="https://ru.wikipedia.org/wiki/Magnet-%25D1%2581%25D1%2581%25D1%258B%25D0%25BB%25D0%25BA%25D0%25B0">magnets</a> with which you can download a file from any p2p network ( <a href="https://ru.wikipedia.org/wiki/Gnutella">Gnutella</a> , <a href="https://ru.wikipedia.org/wiki/Gnutella2">Gnutella2</a> , <a href="https://ru.wikipedia.org/wiki/EDonkey2000_(%25D1%2581%25D0%25B5%25D1%2582%25D1%258C)">Edonkey2000</a> , <a href="https://ru.wikipedia.org/wiki/Direct_Connect">DirectConnect</a> , <a href="https://ru.wikipedia.org/wiki/BitTorrent_(%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB)">BitTorrent</a> ).  They can be obtained either by using the <a href="http://rhash.anz.ru/">rhash</a> program, or by mixing different magnets and links to a file on the page of the <a href="https://ivan386.github.io/magnet-converter/magnet-converter.htm">Magnet Converter</a> service.  But there is a problem that not many clients for p2p networks are loyal to an arbitrary order of parameters in a magnet.  I decided to write a script that corrects this situation on all pages of the Internet. <br><br>  Under the cat you will find JavaScript code with comments and a test link. <br><a name="habracut"></a><br>  So.  Create a folder ‚Äúmagnet-converter‚Äù in which the files will be: <br><br><h4>  File " <a href="">manifest.json</a> ": </h4><br>  So that the script could be connected as a Chrome extension. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Magnet Splitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Splits universal magnet links to suitable for different p2p clients"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"content_scripts"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"matches"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"http://*/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://*/*"</span></span> ], <span class="hljs-string"><span class="hljs-string">"js"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"insert.js"</span></span> ], <span class="hljs-string"><span class="hljs-string">"run_at"</span></span>: <span class="hljs-string"><span class="hljs-string">"document_end"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"web_accessible_resources"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"magnet-converter.user.js"</span></span> ] }</code> </pre> <br><h4>  File " <a href="">insert.js</a> ": </h4><br>  Insert the script on the page. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> script = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'script'</span></span>); script.type = <span class="hljs-string"><span class="hljs-string">'text/javascript'</span></span>; script.src = chrome.extension.getURL(<span class="hljs-string"><span class="hljs-string">"magnet-converter.user.js"</span></span>); script.async = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(script);</code> </pre> <br><h4>  File " <a href="">magnet-converter.user.js</a> " </h4><br>  The script itself.  It can be connected as a custom script <a href="https://ru.wikipedia.org/wiki/Greasemonkey">Greasemonkey</a> and Tampermonkey.  Also, the owner of the site that publishes universal magnets can connect it to their pages. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ==UserScript== // @name Magnet Splitter // @description Splits universal magnet links to suitable for different p2p clients. // @author ivan386 // @license MIT // @version 1.1 // @run-at document-end // @include http://*/* // @include https://*/* // ==/UserScript== javascript:</span></span></code> </pre> <code>/*</code> <br> <h4>  <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D1%2583%25D0%25BA%25D0%25BC%25D0%25B0%25D1%2580%25D0%25BA%25D0%25BB%25D0%25B5%25D1%2582">Bookmarklet</a> </h4><br><br>  This script can be copied and saved to bookmarks (from ‚Äújavascript:‚Äù to ‚Äúvoid ();‚Äù inclusive). <br><br>  For the script to work correctly in the bookmarklet: <br>  1. use only inline comments <br>  2. end instructions with a semicolon <br>  3. put a space after else at the end of the line <br> <code>*/</code> <pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-string"><span class="hljs-string">'use strict'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">try_decode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ data = <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(data); }<span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e){<span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(e)} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; }</code> </pre> <code>/*</code> <br>  We disassemble the magnet into pieces <br> <code>*/</code> <pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detect_ipfs_hash</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, file</span></span></span><span class="hljs-function">) </span></span>{ url.replace(<span class="hljs-regexp"><span class="hljs-regexp">/\/ipfs\/([123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz]+)/</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">all, hash</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.hash) file.hash = {}; file.hash.ipfs = hash; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_urn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">urn_name, urn_data, file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.hash) file.hash = {}; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (urn_name){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:sha1:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* sha1   (Base32) */</span></span> file.hash.sha1 = urn_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:ed2k:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* ed2k   (Hex) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:ed2khash:"</span></span>: file.hash.ed2k = urn_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:aich:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* Advanced Intelligent Corruption */</span></span> file.hash.aich = urn_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:btih:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* BitTorrent Info Hash (Hex, Base32) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (urn_data.length &lt; <span class="hljs-number"><span class="hljs-number">40</span></span>) file.hash.btih = base32_to_hex(urn_data); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> file.hash.btih = urn_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:ipfs:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* InterPlanetary File System  */</span></span> file.hash.ipfs = urn_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:tree:tiger:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* Tiger Tree Hash (TTH)  (Base32) */</span></span> file.hash.tree_tiger = urn_data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"urn:bitprint:"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* [SHA1].[TTH] (Base32) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sha1_tth = urn_data.split(<span class="hljs-string"><span class="hljs-string">"."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sha1_tth &amp;&amp; sha1_tth.length == <span class="hljs-number"><span class="hljs-number">2</span></span>){ file.hash.sha1 = sha1_tth[<span class="hljs-number"><span class="hljs-number">0</span></span>]; file.hash.tree_tiger = sha1_tth[<span class="hljs-number"><span class="hljs-number">1</span></span>]; file.hash.bitprint = urn_data; }; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.urns) file.urns = []; file.urns.push(urn_name+urn_data); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_magnet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">params, file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file) file = {}; params.replace(<span class="hljs-regexp"><span class="hljs-regexp">/([a-z0-9\.]+)=((([a-z0-9\.]+:)*)([^&amp;]+))&amp;?/gmi</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">all, name, data, urn, _, urn_data</span></span></span><span class="hljs-function">)</span></span>{ data = try_decode(data); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (name){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"dn"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* (Display Name) ‚Äî  . */</span></span> file.name = data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"xl"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* (eXact Length) ‚Äî    . */</span></span> file.size = data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"br"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/*  -       . */</span></span> file.bitrate = data; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"tr"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* (TRacker) ‚Äî    BitTorrent . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.trackers) file.trackers = []; file.trackers.push(data); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"mt"</span></span>: file.collection = file.collection || []; file.collection.push(data); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"x.do"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/*     . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.description_url) file.description_url = []; file.description_url.push(data); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"fl"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/*    . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.torrent_file_url) file.torrent_file_url = []; file.torrent_file_url.push(data); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"as"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* (Acceptable Source) ‚Äî -    . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"ws"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* Web Seed -        . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.url) file.url = []; file.url.push(data); detect_ipfs_hash(data, file); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"xs"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* (eXact Source) ‚Äî      P2P . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.xurl) file.xurl = []; file.xurl.push(data); detect_ipfs_hash(data, file); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"xt"</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* URN,   */</span></span> parse_urn(urn, urn_data, file); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"x.ed2k.p"</span></span>: (file.hash_list = file.hash_list || {}).ed2k = data.split(<span class="hljs-string"><span class="hljs-string">":"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file; }</code> </pre> <code>/*</code> <br> <h4>  Here the magnet is assembled for the torrent. </h4><br><br>  Torrent client needs first of all <a href="https://ru.wikipedia.org/wiki/BitTorrent_(%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25BE%25D0%25BB)">bittorrent info hash (btih)</a> . <br>  It follows first and is required for this type of magnet. <br><br>  <u>Magnet example:</u> <br> <code>magnet:?xt=urn:btih:16253d9beb0df49fe30bacc62ea10ba63939f0f8&amp;dn=ruwiki-20141114-pages-meta-current.xml.bz2&amp;tr=http%3A%2F%2Furl2torrent.net%3A6970%2Fannounce&amp;ws=http%3A%2F%2Fdumps.wikimedia.org%2Fruwiki%2F20141114%2Fruwiki-20141114-pages-meta-current.xml.bz2&amp;fl=http://torcache.net/torrent/16253D9BEB0DF49FE30BACC62EA10BA63939F0F8.torrent</code> <br> <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">torrent_magnet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> magnet = [<span class="hljs-string"><span class="hljs-string">"magnet:?"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file &amp;&amp; file.hash &amp;&amp; file.hash.btih) { magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:btih:"</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.hash.btih)); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.name) { magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;dn="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.name)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.trackers) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.trackers.length; i++){ magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;tr="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.trackers[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.url){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.url.length; i++){ magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;ws="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.url[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.torrent_file_url){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.torrent_file_url.length; i++){ magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;fl="</span></span>); magnet.push(file.torrent_file_url[i]); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> magnet.join(<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <code>/*</code> <br> <h4>  This feature collects a magnet for DirectConnect (DC ++) clients. </h4><br><br>  For them, <a href="https://ru.wikipedia.org/wiki/TTH">tree tiger hash (TTH) is</a> required.  Some clients understand urn: bitprint which also contains TTH but urn: tree: tiger: must understand everything. <br>  If there are no other parameters, DC ++ will open a TTH file search window. <br><br>  <u>Magnet example:</u> <br> <code>magnet:?xt=urn:tree:tiger:JNOANHGPELY63I2OMSPQ3J73AS2P4AWB5MTBJCQ&amp;xl=2981763794&amp;dn=ruwiki-20141114-pages-meta-current.xml.bz2&amp;xs=http://cache.freebase.be/u24iyrp3wtlry5kjh7sacblft2lam62u&amp;x.do=https%3A%2F%2Fdumps.wikimedia.org%2Fruwiki%2F20141114%2F&amp;xs=dchub://allavtovo.ru</code> <br> <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dc_magnet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> magnet = [<span class="hljs-string"><span class="hljs-string">"magnet:?"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file &amp;&amp; file.hash &amp;&amp; file.hash.tree_tiger) { magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:tree:tiger:"</span></span>); magnet.push(file.hash.tree_tiger); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.size) { magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;xl="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.size)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.name) { magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;dn="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.name)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.xurl){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.xurl.length; i++){ magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;xs="</span></span>); magnet.push(file.xurl[i]); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.description_url){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.description_url.length; i++){ magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;x.do="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.description_url[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> magnet.join(<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <code>/*</code> <br> <h4>  Here is going to ed2k link. </h4><br><br>  At the moment, the magnets from Edonkey2000 customers understood only <a href="https://ru.wikipedia.org/wiki/AMule">aMule</a> .  Therefore, we are collecting a standard link for this network ed2k. <br><br>  <u>Link example:</u> <br> <code>ed2k://|file|ruwiki-20141114-pages-meta-current.xml.bz2|2981763794|0218392e98873112284de6913efee0df|s=http%3A%2F%2Fdumps.wikimedia.org%2Fruwiki%2F20141114%2Fruwiki-20141114-pages-meta-current.xml.bz2|/</code> <br> <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ed2k_link</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> link = [<span class="hljs-string"><span class="hljs-string">"ed2k://|file"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file &amp;&amp; file.hash &amp;&amp; file.name &amp;&amp; file.size &amp;&amp; file.hash.ed2k) { link.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.name)); link.push(file.size); link.push(file.hash.ed2k); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash.aich) link.push(<span class="hljs-string"><span class="hljs-string">"h="</span></span> + file.hash.aich); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash_list &amp;&amp; file.hash_list.ed2k) link.push(<span class="hljs-string"><span class="hljs-string">"p="</span></span> + file.hash_list.ed2k.join(<span class="hljs-string"><span class="hljs-string">":"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.url) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.url.length; i++) link.push(<span class="hljs-string"><span class="hljs-string">"s="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.url[i])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.collection) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.collection.length; i++) link.push(<span class="hljs-string"><span class="hljs-string">"f="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.collection[i])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.xurl){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sources = []; file.xurl.map( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xurl</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matches = (<span class="hljs-regexp"><span class="hljs-regexp">/ed2kftp\:\/\/([^\/]+)\/[a-z0-9]+\/[0-9]+\//gmi</span></span>).exec(xurl); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (matches) sources.push(matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]); } ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( sources.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) link.push(<span class="hljs-string"><span class="hljs-string">"/|sources,"</span></span> + sources.join(<span class="hljs-string"><span class="hljs-string">","</span></span>)); } link.push(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> link.join(<span class="hljs-string"><span class="hljs-string">"|"</span></span>); } }</code> </pre> <code>/*</code> <br> <h4>  Full magnet </h4><br><br>  This magnet can be used by any p2p client if it contains the hashes it needs.  But only <a href="https://ru.wikipedia.org/wiki/Shareaza">Shareaza is</a> coping with this task. <br><br>  <u>Magnet example:</u> <br> <code>magnet:?xt=urn:ed2k:0218392e98873112284de6913efee0df&amp;xl=2981763794&amp;dn=ruwiki-20141114-pages-meta-current.xml.bz2&amp;xt=urn:bitprint:U24IYRP3WTLRY5KJH7SACBLFT2LAM62U.JNOANHGPELY63I2OMSPQ3J73AS2P4AWB5MTBJCQ&amp;xt=urn:btih:16253d9beb0df49fe30bacc62ea10ba63939f0f8&amp;tr=http%3A%2F%2Furl2torrent.net%3A6970%2Fannounce&amp;ws=http%3A%2F%2Fdumps.wikimedia.org%2Fruwiki%2F20141114%2Fruwiki-20141114-pages-meta-current.xml.bz2&amp;x.do=https%3A%2F%2Fdumps.wikimedia.org%2Fruwiki%2F20141114%2F&amp;fl=http%3A%2F%2Ftorcache.net%2Ftorrent%2F16253D9BEB0DF49FE30BACC62EA10BA63939F0F8.torrent&amp;xs=http://cache.freebase.be/u24iyrp3wtlry5kjh7sacblft2lam62u&amp;xs=dchub://allavtovo.ru</code> <br> <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">full_magnet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file, as</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> magnet = [<span class="hljs-string"><span class="hljs-string">"magnet:?"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash.btih){ magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:btih:"</span></span>); magnet.push(file.hash.btih); amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash.sha1 &amp;&amp; file.hash.tree_tiger){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:bitprint:"</span></span>); magnet.push(file.hash.sha1); magnet.push(<span class="hljs-string"><span class="hljs-string">"."</span></span>); magnet.push(file.hash.tree_tiger); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(file.hash.sha1){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:sha1:"</span></span>); magnet.push(file.hash.sha1); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(file.hash.tree_tiger){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:tree:tiger:"</span></span>); magnet.push(file.hash.tree_tiger); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash.ed2k){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:ed2k:"</span></span>); magnet.push(file.hash.ed2k); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.size) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xl="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.size)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.name) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"dn="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.name)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash.aich){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:aich:"</span></span>); magnet.push(file.hash.aich); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash.ipfs){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt=urn:ipfs:"</span></span>); magnet.push(file.hash.ipfs); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.urns){ file.urns.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">urn</span></span></span><span class="hljs-function">)=&gt;</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xt="</span></span>); magnet.push(urn); }) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.trackers){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.trackers.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"tr="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.trackers[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.url){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.url.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> || !(file.hash &amp;&amp; file.hash.btih)) magnet.push(<span class="hljs-string"><span class="hljs-string">"as="</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> magnet.push(<span class="hljs-string"><span class="hljs-string">"ws="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.url[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.bitrate){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"br="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.bitrate)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.description_url){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.description_url.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"x.do="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.description_url[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.torrent_file_url){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.torrent_file_url.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"fl="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.torrent_file_url[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.collection){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.collection.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"mt="</span></span>); magnet.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.collection[i])); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.hash_list &amp;&amp; file.hash_list.ed2k){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"x.ed2k.p="</span></span>); magnet.push(file.hash_list.ed2k.join(<span class="hljs-string"><span class="hljs-string">":"</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.xurl){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; file.xurl.length; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (amp) magnet.push(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> amp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; magnet.push(<span class="hljs-string"><span class="hljs-string">"xs="</span></span>); magnet.push(file.xurl[i]); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( magnet.length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> magnet.join(<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <code>/*</code> <br>  In the past, <a href="https://en.wikipedia.org/wiki/Base32">Base32</a> btih encoding was used in torrent magnets.  Now used <a href="https://en.wikipedia.org/wiki/Hexadecimal">HEX</a> .  Shareaza uses Base32 in its old-fashioned way and this function converts btih back to HEX. <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base32_to_hex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">base32</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* http://tools.ietf.org/html/rfc4648 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!base32) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> number = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bit_pos = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> detector = <span class="hljs-regexp"><span class="hljs-regexp">/[2-7a-z]/gmi</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hex_str = []; base32.replace(detector, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">letter</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> val = <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(letter, <span class="hljs-number"><span class="hljs-number">36</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val &lt;= <span class="hljs-number"><span class="hljs-number">7</span></span>) val += <span class="hljs-number"><span class="hljs-number">24</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> val -= <span class="hljs-number"><span class="hljs-number">10</span></span>; number = ((number &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>) | val) &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>; bit_pos += <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; bit_pos &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span>;){ bit_pos -= <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hex_num = (number &gt;&gt; bit_pos) &amp; <span class="hljs-number"><span class="hljs-number">15</span></span>; hex_str.push(hex_num.toString(<span class="hljs-number"><span class="hljs-number">16</span></span>)); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hex_str.join(<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <code>/*</code> <br> <h4>  Bonus: <a href="https://ru.wikipedia.org/wiki/.torrent">Micro Torrent</a> </h4><br><br>  If the universal magnet has a sha1 hash using it we can generate a micro torrent file.  This is a torrent in which only one hour which includes the entire file.  The sha1 hash of this part is identical in sha1 to the hash of the file itself.  This torrent can be obtained from a magnet that allows you to fumble small files on the BitTorrent network without the need to create a full torrent file.  Also, a micro torrent can be transferred via the BitTorrent network to a large torrent file completely and not just the info part. <br> <code>*/</code> <pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raw_length</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">encodedURI</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index = encodedURI.indexOf(<span class="hljs-string"><span class="hljs-string">"%"</span></span>); index&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; (++count) ; index = encodedURI.indexOf(<span class="hljs-string"><span class="hljs-string">"%"</span></span>, index+<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> encodedURI.length-count*<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*  bencode   */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push_string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string, to_list</span></span></span><span class="hljs-function">)</span></span>{ to_list.push(raw_length(string)); to_list.push(<span class="hljs-string"><span class="hljs-string">":"</span></span>); to_list.push(string); }</code> </pre> <code>/*</code> <br> <h4>  Function build micro torrent file. </h4><br><br>  In order to collect it we need: sha1 file hash, file size, file name.  Parameters in the info part of the micro torrent are written alphabetically by parameter name.  This reduces the variability of the assembly torrent file and increases the likelihood of obtaining the same btih from the same magnet.  UTorrent has a limit on the minimum size of the part, so if the file is less than 16384 bytes, the size of the part is set equal to this number. <br><br>  <u>Example:</u> <br> <code>data:application/x-bittorrent;,d4:infod6:lengthi10826029e4:name23:mediawiki-1.15.1.tar.gz12:piece%20lengthi10826029e6:pieces20:%bc%6f%a7%90%b7%73%88%92%c6%b4%15%fc%76%65%8a%97%67%63%71%5de8:url-listl68:http%3A%2F%2Fdownload.wikimedia.org%2Fmediawiki%2F1.15%2Fmediawiki-1.15.1.tar.gzee</code> <br> <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_micro_torrent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.name &amp;&amp; file.size &amp;&amp; file.hash &amp;&amp; file.hash.sha1){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> torrent = [<span class="hljs-string"><span class="hljs-string">"data:application/x-bittorrent;,d"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.trackers &amp;&amp; file.trackers.length&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){ torrent.push(<span class="hljs-string"><span class="hljs-string">"8:announce"</span></span>); push_string(file.trackers[<span class="hljs-number"><span class="hljs-number">0</span></span>], torrent); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.trackers.length&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>){ torrent.push(<span class="hljs-string"><span class="hljs-string">"13:announce-listl"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; file.trackers.length&gt;i; i++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tracker = <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(file.trackers[i])); push_string(tracker, torrent); } torrent.push(<span class="hljs-string"><span class="hljs-string">"e"</span></span>); } } torrent.push(<span class="hljs-string"><span class="hljs-string">"4:infod"</span></span>); torrent.push(<span class="hljs-string"><span class="hljs-string">"6:length"</span></span>); torrent.push(<span class="hljs-string"><span class="hljs-string">"i"</span></span>); torrent.push(file.size); torrent.push(<span class="hljs-string"><span class="hljs-string">"e"</span></span>); torrent.push(<span class="hljs-string"><span class="hljs-string">"4:name"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(file.name); push_string(name, torrent); torrent.push(<span class="hljs-string"><span class="hljs-string">"12:piece%20length"</span></span>); torrent.push(<span class="hljs-string"><span class="hljs-string">"i"</span></span>); torrent.push(file.size &lt; <span class="hljs-number"><span class="hljs-number">16384</span></span> ? <span class="hljs-number"><span class="hljs-number">16384</span></span> : file.size); torrent.push(<span class="hljs-string"><span class="hljs-string">"e"</span></span>); torrent.push(<span class="hljs-string"><span class="hljs-string">"6:pieces"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sha1 = file.hash.sha1; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sha1.length &lt; <span class="hljs-number"><span class="hljs-number">40</span></span>) sha1 = base32_to_hex(sha1); sha1 = sha1.replace(<span class="hljs-regexp"><span class="hljs-regexp">/[0-9A-Fa-f]{2}/g</span></span>,<span class="hljs-string"><span class="hljs-string">"%$&amp;"</span></span>); push_string(sha1, torrent); torrent.push(<span class="hljs-string"><span class="hljs-string">"e"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.url &amp;&amp; file.url.length&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){ torrent.push(<span class="hljs-string"><span class="hljs-string">"8:url-listl"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; file.url.length&gt;i; i++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(file.url[i])); push_string(url, torrent); } torrent.push(<span class="hljs-string"><span class="hljs-string">"e"</span></span>); } torrent.push(<span class="hljs-string"><span class="hljs-string">"e"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> torrent.join(<span class="hljs-string"><span class="hljs-string">""</span></span>); } }</code> </pre> <code>/*</code> <br>  Function to insert new links to the page. <br> <code>*/</code> <pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert_link_after</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sibling, href, class_name</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> new_link = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">"A"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (href) new_link.href = href; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (class_name) new_link.className = class_name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sibling.parentNode.insertBefore(new_link, sibling.nextSibling); }</code> </pre> <code>/*</code> <br> <h4>  Go </h4><br><br>  We look through the links and look for magnets in them.  Links are moved in the reverse order as we add new ones and the array of links increases automatically.  Now I didn‚Äôt check it but I used to end up on an endless loop on it. <br> <code>*/</code> <pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> links = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"A"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = links.length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; i--){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> link = links[i]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> magnet_index = link.href.indexOf(<span class="hljs-string"><span class="hljs-string">"magnet:?"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> magnet_link; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (magnet_index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ magnet_index = link.href.indexOf(<span class="hljs-string"><span class="hljs-string">"magnet%3A%3F"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( magnet_index &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> ) magnet_link = try_decode(link.href.substr(magnet_index)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> magnet_link = link.href.substr(magnet_index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (magnet_index &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = parse_magnet(magnet_link); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( file.name ){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> spliter = <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file.name + <span class="hljs-string"><span class="hljs-string">"#magnet"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( link.href.indexOf( spliter ) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> ){ <span class="hljs-comment"><span class="hljs-comment">/* URL + magnet     . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.url) file.url = []; file.url.push(link.href.split( spliter )[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-string"><span class="hljs-string">"/"</span></span> + file.name); } } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> link_functions = { <span class="hljs-string"><span class="hljs-string">"micro-torrent"</span></span>: make_micro_torrent, <span class="hljs-string"><span class="hljs-string">"torrent-magnet"</span></span>:torrent_magnet, <span class="hljs-string"><span class="hljs-string">"dc-magnet"</span></span>: dc_magnet, <span class="hljs-string"><span class="hljs-string">"ed2k-link"</span></span>: ed2k_link, <span class="hljs-string"><span class="hljs-string">"full-magnet"</span></span>: full_magnet}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> link_functions){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> href = link_functions[name](file); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (href){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = insert_link_after(link, href, name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( name == <span class="hljs-string"><span class="hljs-string">"micro-torrent"</span></span> ){ <span class="hljs-comment"><span class="hljs-comment">/*   download       . */</span></span> a.setAttribute(<span class="hljs-string"><span class="hljs-string">"download"</span></span>, (file.name) + <span class="hljs-string"><span class="hljs-string">".micro.torrent"</span></span>); } } } } }</code> </pre> <code>/*</code> <br>  Text links set through styles.  You can also enter pictures in the form of a <a href="https://ru.wikipedia.org/wiki/Data:_URL">Data URI</a> . <br> <code>*/</code> <pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.head.appendChild(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'style'</span></span>)).appendChild(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createTextNode(<span class="hljs-string"><span class="hljs-string">` [class*='-magnet'], .ed2k-link, .micro-torrent{ margin-left: 1em } a[class*='-magnet']:before, .ed2k-link:before, .micro-torrent:before{ content: attr(class) }`</span></span>)) })(); <span class="hljs-keyword"><span class="hljs-keyword">void</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><h4>  Installation </h4><br><br><ol><li>  Copy the folder ‚Äúmagnet-converter‚Äù with the contents to a local disk. </li><li>  In the Chrome browser, open ‚Äúchrome: // extensions /‚Äù or ‚ÄúMain Menu&gt; Additional Tools&gt; Extensions‚Äù </li><li>  Put a tick "Developer Mode" </li><li>  Click "Download unpacked extension ..." </li><li>  We find and select the folder ‚Äúmagnet-converter‚Äù with scripts. </li><li>  Click OK. </li></ol><br><h4>  Test </h4><br><br>  Link for the test script: <br><br> <a href=""><img src="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo-mini.svg" alt="image"></a>  <a href="">Test</a> <br><br>  The result should look like this: <br><br> <code><img src="https://ivan386.github.io/magnet-uri-logo/magnet-uri-logo-mini.svg" alt="image">  full-magnet ed2k-link dc-magnet torrent-magnet micro-torrent</code> <br>  There will be 5 additional links for different p2p clients. <br><br><h4>  Conclusion </h4><br>  I hope that the developers of p2p clients will add a code so that the universal magnet is recognized by the client correctly and there is no need to divide it. <br><br><h4>  References: </h4><br>  <a href="https://habrahabr.ru/post/136764/">Magnet Internet 1 - Magnet</a> <br>  <a href="https://habrahabr.ru/post/141307/">Magnet Online 2 - Hypertext</a> <br>  <a href="https://habrahabr.ru/post/273713/">Internet Magnets 3 - P2P Website and Forum</a> <br>  <a href="https://habrahabr.ru/post/309352/">Internet on magnets 4 - Divide the magnet into pieces</a> <br>  <a href="https://habrahabr.ru/post/330666/">Internet Magnets 5 - Lighthouses and Messages (Personal, Public, and Updates)</a> </div><p>Source: <a href="https://habr.com/ru/post/309352/">https://habr.com/ru/post/309352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309342/index.html">We invite you on October 19, Moscow to the IX conference "Embedded Technologies 2016. Industrial Internet of Things"</a></li>
<li><a href="../309344/index.html">Contact Service Desk. Where do customers care more: in IT services or repair of air conditioners?</a></li>
<li><a href="../309346/index.html">IT news. August</a></li>
<li><a href="../309348/index.html">Spam protection at 8800 in FreePBX</a></li>
<li><a href="../309350/index.html">Ecosystem R as a tool for automating business tasks</a></li>
<li><a href="../309354/index.html">History of Programming Languages: Jumble and JavaScript Consolidation</a></li>
<li><a href="../309356/index.html">Agile or Lean: Aha aha, what's the difference?</a></li>
<li><a href="../309360/index.html">Igor Ilyunin: ‚ÄúThe customer asked to assemble a team that he did not find in Silicon Valley‚Äù</a></li>
<li><a href="../309362/index.html">And here is IoT</a></li>
<li><a href="../309364/index.html">Cloud Technology Myths. Part 3: Talking about "iron"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>