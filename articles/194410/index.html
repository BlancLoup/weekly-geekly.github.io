<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Algorithm X or what is common between the wooden puzzle and the dancing Link?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 Once at a party a puzzle came into my hands, in which out of 25 identical figures it was required to assemble a cube. I was busy with her a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Algorithm X or what is common between the wooden puzzle and the dancing Link?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage3/475/9e9/9e5/4759e99e5dc9552b98a1e59508255d8a.gif"></div><br><br><h2>  Foreword </h2><br>  Once at a party a puzzle came into my hands, in which out of 25 identical figures it was required to assemble a cube.  I was busy with her almost the whole evening, and as you can guess, absolutely to no avail.  However, I could not give up just like that. <br><br>  You can not do it yourself - force the computer.  No sooner said than done.  As a result, a whiming algorithm had to work all night to find all 4 unique solutions.  In the process of google solutions for comparison, I found the program <a href="http://burrtools.sourceforge.net/">Burr Tools</a> , which coped with this task in 3 minutes on my laptop. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Such a difference in speed made me figure out how this problem is being solved and a whole class of similar ones. <br><br><a name="habracut"></a><br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/b97/a32/e1e/b97a32e1e52f65969600557a4eb81134.jpg"></div><br><br><div class="spoiler">  <b class="spoiler_title">Puzzle description 25N puzzle cube</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage3/c89/bd6/fff/c89bd6fffe9d1edc27e2d36536f06784.png" align="right"><br>  25 ‚Äúvoluminous‚Äù type N pentaminos are provided to you. <br>  Each pentamine consists of five cubes. <br>  From these figures it is required to make a cube of size 5 √ó 5 √ó 5. <br></div></div><br><br>  This puzzle is a classic representative <a href="http://en.wikipedia.org/wiki/Exact_cover_problem">of the exact coverage problem</a> . <br><div class="spoiler">  <b class="spoiler_title">Mathematical wording</b> <div class="spoiler_text">  Suppose that we have given the set X, and the set of its subsets S. Then the task is to select from the set S, a subset S * such that every element of X is contained in exactly one element S *. <br></div></div><br>  The formulation of the problem can be presented by the following example.  You come to the store for collectible cards.  What decks you should buy to build a complete collection without duplicate cards? <br><br>  For such a task, there is <a href="http://en.wikipedia.org/wiki/Knuth%2527s_Algorithm_X">Algorithm X of Donald Knuth</a> .  But before proceeding to the consideration of the algorithm, let's see how to reduce our puzzle with the creation of a cube to the problem of exact coverage. <br><br><h2>  Task formalization </h2><br>  For simplicity, we will solve a similar problem of folding from a four flat corners of a larger corner.  If the figure is folded, then each square of the figure belongs to one and only one corner, which, you see, already sounds very similar to the formulation of the problem of complete coverage. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/70c/16a/25f/70c16a25f1a0184ab407a34ffdb33250.png"></div><br><br>  Let us denote by numbers all small squares of a large figure, and letters all possible positions of a small corner inside it (here, for the sake of clarity, some ‚Äúbad‚Äù positions of the corners are deliberately thrown out, which precisely cannot be present in the solution).  The combination of 12 squares is exactly what we will try to cover with the provisions of AL.  The task can also be presented in the form of a table ( <a href="http://en.wikipedia.org/wiki/Incidence_matrix">matrix of incidence</a> ).  The columns will correspond to the squares, the rows to the positions of the corner, and the unit at the intersection of the column and the line is placed if the corresponding position of the corner covers the corresponding box. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/3af/28e/bb2/3af28ebb2849bf9adb6376043fd13f9e.png"></div><br><br><div class="spoiler">  <b class="spoiler_title">Task statement through matrix</b> <div class="spoiler_text">  Let us be given a matrix <i>S</i> consisting of zeros and ones.  It is required to remove a certain number of rows from this matrix so that in the remaining matrix each column contains exactly one unit. <br></div></div><br><br>  Slightly less obvious are the problem of complete coverage of a puzzle in which all the pieces are different, or a game like sudoku.  The reader is invited to independently figure out how to formalize these situations (if anything, the <a href="http://en.wikipedia.org/wiki/Exact_cover">answer</a> is in <a href="http://en.wikipedia.org/wiki/Exact_cover">Wikipedia</a> ). <br><br><h2>  Algorithm X </h2><br>  Algorithm X consists of several steps that reduce the task to the original, but with fewer columns / rows.  Moreover, it should be noted that the algorithm branches at a certain step.  In other words, it is still busting, but smart :-) <br><br><h4>  Step 1. Select any column <i>c</i> in the matrix <i>S</i> </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/3eb/17d/1df/3eb17d1df3c8af5d86114c9a72805164.png"></div><br>  Selecting a column in a geometric language means selecting a square that has not yet been covered.  In our case, it will be a square 24. <br><br><h4>  Step 2. Fork the algorithm for each row <i>r</i> , such that <i>S <sub>r, c</sub> = 1</i> </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/d84/a81/9fd/d84a819fd303e0a4fe33ce1638f52776.png"></div><br>  The square 24 can be closed both by position A and by position D. We have no prerequisites to choose this or that, therefore we consider both options separately.  This is a step where options are searched.  To reduce their number, often in step 1, they choose not an arbitrary column, but a column containing the smallest number of ones. <br><br><h4>  Step 3. For the selected row <i>r</i> , all columns <i>j are considered</i> , such that <i>S <sub>r, j</sub> = 1</i> </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/734/93f/ec8/73493fec80d984c1d4702fa22e5f4c58.png"></div><br>  Select line A and put it on our solution stack.  Now we need to select all the squares, which occupies the position A. <br><br><h4>  Step 4. For all nonzero elements of columns <i>j,</i> delete the rows in which they are located, and then the columns <i>j</i> themselves </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/72c/0c9/4a9/72c0c94a90485e06338d874b05494d8b.png"></div><br>  All rows that have non-zero elements in the selected columns can no longer participate in the construction of this branch of the solution.  In other words, we get rid of all the positions of the corner that intersect (have common squares) with position A. Moreover, since we have already covered squares 24, 33, 34 (row A is already on the stack), we do not need to take care of them next, and the corresponding columns are also deleted. <br><br><h4>  Step 5. Go to Step 1 with a reduced matrix. </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/9cc/bdb/812/9ccbdb812aa63b0a2577eef37fcb50f8.png"></div><br>  After deleting the rows and columns, we got a smaller table.  And from the point of view of geometry, we obtained the problem of covering a smaller figure, and the remaining lines automatically correspond to the possible positions of the corners in this figure. <br><br><div class="spoiler">  <b class="spoiler_title">Anecdote about the saucepan</b> <div class="spoiler_text">  Physics and mathematics are asked to boil water in a saucepan.  Both solve the problem in the same way: they take water into a saucepan, put it on the stove and turn it on.  After that, they are asked to boil the water that is already in the saucepan.  The physicist puts the saucepan on the stove and turns it on.  The mathematician pours water into the sink and says: "Now let's solve the previous problem." <br></div></div><br><br><h4>  End of algorithm </h4><br>  After the transition to step 1, we may have special situations. <br><br>  <i>Situation 1.</i> We cannot select a column, because there are no columns left in the matrix.  This means that we have covered all the available squares, therefore, we have found a solution to the problem.  The contents of the stack can be added to the list of solutions found. <br><br>  <i>Situation 2.</i> We chose a column, but there is not a single unit in it, for example, column 44 in the last picture.  This means that for the selected square there is not a single position of the corner that could cover it.  Therefore, this branch has no solution.  A special case of this situation is that there are no rows left in the matrix.  It is worth noting that by selecting the column with the smallest number of units in step 1, we will always get an empty column as soon as it appears. <br><br>  Since, for the iteration of the algorithm, we deliberately get rid of one row and one column, the number of rows and columns decreases, and sooner or later we come to situation 1 or situation 2. <br><br><img src="https://habrastorage.org/storage3/d32/c99/313/d32c9931362c351cae698f888d2818a0.png" align="right"><br><h2>  Dancing links </h2><br>  For fast operation of the algorithm, you must be able to quickly remove rows and columns from the matrix.  If you store the matrix in the form of a two-dimensional array, then this is quite problematic.  On the other hand, the resulting matrix is ‚Äã‚Äãalmost always very <a href="http://en.wikipedia.org/wiki/Sparse_array">sparse</a> (in particular, the matrix for the problem with pentamino contains only 4% of units), and therefore it is convenient to represent it as a two-dimensional doubly connected list.  Such a representation allows us to obtain all nonzero elements of a row or column in the shortest time. <br><br>  Finally, having such a list at your disposal, it is very convenient to delete columns and rows, and going back along the branch, restore them. <br><br><pre><code class="hljs erlang-repl">//   node-&gt;next-&gt;prev = node-&gt;prev; node-&gt;prev-&gt;next = node-&gt;next; //   node-&gt;next-&gt;prev = node; node-&gt;prev-&gt;next = node;</code> </pre> <br><br>  It is on this idea that Knut's <a href="http://en.wikipedia.org/wiki/Dancing_Links">dancing links</a> method is based.  (By the way, if you type in Google the name of this method in the singular "dancing link", then there will be a lot of gifs with the main character Legend of Zelda in the pictures.) <br><br><h2>  Puzzle solution </h2><br>  The final solution code of the original puzzle can be viewed on the <a href="">githab</a> (most of the code is the preparation of the matrix and the function of checking solutions for identity).  On my laptop, the program in 5 seconds finds 4 unique solutions (not turning to each other by turns and reflections) and for another 50 seconds makes sure that there are no others.  It was nice to realize that your implementation is faster than the Burr Tools solution. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/7b1/a65/a5c/7b1a65a5c1aa8b6a66a6176a21ba0000.png"></div><br>  One of the optimization of the algorithm was to leave only 2 principal positions of the pentamen closing the cube (0, 0, 0), since its other possible positions are rotations and reflections.  This reduced the number of brute force options by 6 times.  (Actually, it is enough to leave one position, but this needs additional substantiation). <br><br>  A solution to this (and other puzzles) can be found on <a href="http://puzzlewillbeplayed.com/Pentominoes/N-5x5x5.html">puzzlewillbeplayed.com</a> .  And those who read to the end - a bonus in the form of visualization of a piece of the algorithm.  Perhaps, this animation will justify the adjective ‚Äúdancing‚Äù in the title of the algorithm. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/kWiMnXP7g-4%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253&amp;usg=ALkJrhjwTxuBRaDFPFwmJykGfmq4svwACg" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/194410/">https://habr.com/ru/post/194410/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194398/index.html">Roskomnadzor entered Facebook in the registry of banned sites</a></li>
<li><a href="../194402/index.html">Home automation</a></li>
<li><a href="../194404/index.html">Development of IM for the competition of Pavel Durov using Xamarin</a></li>
<li><a href="../194406/index.html">Fractals in prime numbers</a></li>
<li><a href="../194408/index.html">Budget UHF RFID reader and its development</a></li>
<li><a href="../194412/index.html">We protect the system. Or how to configure and use port knocking</a></li>
<li><a href="../194416/index.html">The Little Giant of Big Computing ‚Äî an Overview of the IBM WorkPad z50 PDA</a></li>
<li><a href="../194420/index.html">A podcast for a million. Success story and walkthrough</a></li>
<li><a href="../194422/index.html">Facebook fulfilled the requirements of Roskomnadzor, avoiding blocking in Russia</a></li>
<li><a href="../194424/index.html">This is how the editor in the new version of WordPress can look</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>