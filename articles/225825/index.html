<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Aptly - create your own repository</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My organization is writing software under Linux. 
 The software is designed to work at retail outlets that are geographically distributed. 
 Initially...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Aptly - create your own repository</h1><div class="post__text post__text-html js-mediator-article">  My organization is writing software under Linux. <br>  The software is designed to work at retail outlets that are geographically distributed. <br>  Initially, the software was provided to clients as a set of deb packages for different distributions and architectures with a list of packages that need to be installed as dependencies before installing these deb files. <br>  I want to tell you what was the path of evolution from distributing files via ftp to creating a repository and launching a configuration management system and starting implementation of a continuous integration server. <br><a name="habracut"></a><br><h4>  Origin of life </h4><br>  So, software is a commercial development that is written in Qt, everything is built for two architectures (i386 and amd64) and for several distributions.  At the moment, the following are defined: the last two or three Debian releases and the last two LTS from Ubuntu.  Plus, there are several versions (currently three) that are used by customers. <br>  Three versions turned out this way: when buying software, the client is offered support and, for quite reasonable money, providing new versions of software.  Changing minor versions is free of charge, regardless of the availability of support.  Major - or in the presence of support, or sold again only at a discount. <br><br>  While there were few versions, and the number of installations by customers was small, it was quite possible to manage with ftp.  It looked like this: after assembling all source codes in deb packages, a set of files for each client (depending on version) was archived and laid out for each client on ftp in its own section.  Over time, the ftp accumulated a mass of identical tar-s of different clients, which had to be removed from time to time. <br>  As time went on, customers were added, customer networks grew in size, and updating the software version on the points was another task, especially considering that 99% of the Internet points were (and still are) GPRS. <br><br>  By the way, about collecting packages.  Skipty, which collected deb packages, were originally written ‚Äú300 years ago‚Äù on some manual in English and IMHO is not entirely correct.  The following articles have helped to brush and wash the scripts (for which I want to say thanks to their authors): <br><ul><li>  <a href="http://habrahabr.ru/post/40183/">We collect deb-package</a> </li><li>  <a href="http://habrahabr.ru/post/50540/">Become a manager</a> </li><li>  <a href="http://habrahabr.ru/post/78094/">How to build binary deb package: howto detailed</a> </li></ul><br><h4>  Beginning of evolution </h4><br>  Needless to say, the question was raised about distributing the collected packages in a more appropriate way.  ‚ÄúAnd then Ostap suffered‚Äù (c), decided to do everything correctly, so that minimal time was spent on routine operations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The reprepro is the software that supported the repository.  At that time, the opportunities he provided were quite enough. <br><br>  Further, based on the experience of updating, configuring a large number of computers, I wanted to have a configuration management tool.  Google and Habr were called to help.  Acquainted with ansible, chef, puppet and other systems, the names of which I do not remember.  By understandability of configs, documentation, threshold of entry, and a combination of other parameters, the <a href="http://ru.wikipedia.org/wiki/Puppet">puppet</a> was taken into service.  The foreman was bolted to the puppet.  And happiness has come. <br><br>  Not much time passed and I wanted something more different as a control of the repository.  Reprepro suited everyone except being able to store different versions of the same package in the same repository: to be able to quickly roll back to a specific version in the event of some kind of regression, or to quickly put the required version and test the behavior of a particular version on a specific data set on certain hardware configurations. <br><br>  As an example: one client detected an application crash while working with documents.  Their data set on developers' computers flew without questions, everything was opened and without dropping it worked remarkably well.  We assembled a stand, installed the same linux, the same software version, again everything works and does not fall.  They began to arrive as paranoidly as possible - they collected another machine as close as possible to the client‚Äôs machine, disk, memory, processor, monitor resolution, and lo and behold!  repeated the fall.  Began to understand: found that the essence of the monitor resolution, or rather not in the resolution as such, but in the ratio of the parties.  The developers and the first test machine the ratio of the monitor was 16: 9, and the second test 4: 3.  As a result, calculate that one line in qss results in a drop.  That was, of course, a big surprise.  So this is what this example is for.  At the time of these tests, there was no such repository and on each assembled machine I had to copy deb packages in the old fashioned way through scp, install dependencies with pens, then install the packages themselves and then check.  Instead of installing in a couple of minutes via aptitude with all dependencies. <br><br>  I had to google.  As a result, the <a href="https://wiki.debian.org/HowToSetupADebianRepository">article was</a> nagged.  Began to deal with the options described in it.  I managed to look at: <br><ul><li>  DAK - did not master at all.  I started it from her because ‚Äúofficial solution‚Äù, but to my shame I couldn‚Äôt understand what to do with the project tree that git pulled me.  Therefore, I didn‚Äôt strain myself and continued to read further. </li><li>  The second product that I noticed was mini-dak.  And as if everything is clear from the configuration and the description is more or less clear.  I just stopped the impossibility to make the names of the repositories (what is called suite in terms of mini-dak) such as I want.  For example, I want to get the repository path like this: <pre>  deb http: // SERVER_NAME / squeeze-evolution-beta non-free </pre>  But I can't, because somewhere in the depth of the scripts a name of the variable with the signs ‚Äú-‚Äù is created that does not work in bash-e.  Attempts to modify the scripts with a file did not succeed, because my bash programming level somewhat does not reach the level of the person who wrote them, and did not want to kill a lot of time to learn all the subtleties of bash (though not the worst pastime). </li><li>  The third option for review was chosen aptly.  And it seems that this tool is suitable. </li></ul><br><h4>  Work with aptly </h4><br>  The aptly documentation is quite detailed with examples.  In addition, there is a bash-completion. <br>  The possibilities of aptly are very broad, below are only those commands that I use.  Those interested in more deeply recommend <a href="http://www.aptly.info/">the product site</a> . <br><br><h6>  Creating a repository: </h6><br>  You can create at once with all the parameters: <br><pre><code class="bash hljs">aptly repo create -comment=<span class="hljs-string"><span class="hljs-string">"Wheezy prehistoric"</span></span> -distribution=<span class="hljs-string"><span class="hljs-string">"wheezy-prehistoric"</span></span> -architectures=<span class="hljs-string"><span class="hljs-string">"i386,amd64,all"</span></span> -component=<span class="hljs-string"><span class="hljs-string">"non-free"</span></span> wheezy-prehistoric</code> </pre> <br>  You can add the parameters later, and create just like this: <br><pre> <code class="bash hljs">aptly repo create wheezy-prehistoric</code> </pre><br><h6>  Change settings </h6><br>  Change the parameters one by one: <br><pre> <code class="bash hljs">aptly repo edit -comment=<span class="hljs-string"><span class="hljs-string">"Wheezy prehistoric"</span></span> wheezy-prehistoric</code> </pre><br>  Or all at once: <br><pre> <code class="bash hljs">aptly repo edit -comment=<span class="hljs-string"><span class="hljs-string">"Wheezy prehistoric"</span></span> -distribution=<span class="hljs-string"><span class="hljs-string">"wheezy-prehistoric"</span></span> -architectures=<span class="hljs-string"><span class="hljs-string">"i386,amd64,all"</span></span> -component=<span class="hljs-string"><span class="hljs-string">"non-free"</span></span> wheezy-prehistoric</code> </pre><br><h6>  View existing repositories </h6><br><pre> <code class="bash hljs">aptly list</code> </pre><br><h6>  Getting repository information </h6><br>  general information: <br><pre> <code class="bash hljs">aptly show wheezy-prehistoric</code> </pre><br>  information with a list of packages: <br><pre> <code class="bash hljs">aptly repo show -with-packages wheezy-prehistoric</code> </pre><br><h6>  Adding packages to the repository </h6><br>  single file: <br><pre> <code class="bash hljs">aptly repo add wheezy-prehistoric build//Debian-wheezy/chameleon-core_1.3.0-wheezy46_amd64.deb</code> </pre><br>  whole catalog: <br><pre> <code class="bash hljs">aptly repo add wheezy-prehistoric build//Debian-wheezy</code> </pre><br>  when adding, the lack of autocompletion of the file / directory path was somewhat embarrassing. <br><br><h6>  Repository publication </h6><br><pre> <code class="bash hljs">aptly publish repo wheezy-prehistoric</code> </pre><br><h6>  Deleting a post </h6><br><pre> <code class="bash hljs">aptly publish drop wheezy-prehistoric</code> </pre><br><h6>  Get repository graph </h6><br><pre> <code class="bash hljs">aptly graph</code> </pre><br><br>  There is also support for snapshot-s, creating mirrors, moving packages between repositories, dependency support, built-in HTTP server for working with published repositories. <br><br>  There is one feature about which the author wrote - pool is one common to all repositories, which is correct, only if I have files with the same name in different repositories, but different in content and size when publishing these repositories there are no messages, the logic should there was at least something to write.  And in the pool, the first published repository file remains. <br>  By the way, the author responded very quickly and created a <a href="https://github.com/smira/aptly/issues/65">task</a> on the <a href="https://github.com/smira/aptly/issues/65">bug tracker</a> . <br><br><h4>  Evolution continues </h4><br>  At the moment, packages are collected by handles on the vitrual machines.  What is not good.  Work has already begun on the implementation of <a href="http://ru.wikipedia.org/wiki/Jenkins">Jenkins</a> .  From the entire list of available funds for CI, he was chosen.  TeamCity was originally installed, but the cost of licenses was not understood due to the fact that there are other projects that are completely free and have not the worst functionality.  At least it looks like that now.  If, during the operation of Jenkins, its capabilities for some reason will not be enough (although with so many plugins, this is hard to believe), we will change it for something better. <br><br><h4>  PS </h4><br>  At the end of the article I would like to summarize. <br>  The idea of ‚Äã‚Äãthe article was to describe a wonderful tool - aptly, because  in the open spaces Habra did not find anything about him.  Well, to tell in the style of ‚Äúhere's a tool - you can use‚Äù was considered not interesting.  I decided that it would be much more interesting to read which way my organization developed and which tools I used and to draw the community‚Äôs attention to a useful tool with the help of a personal example. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/225825/">https://habr.com/ru/post/225825/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225815/index.html">New Yandex.Market. What happened at the YaC / M conference, and why this could be an important step in the development of Runet</a></li>
<li><a href="../225817/index.html">InfoTeKS Academy launches Transparent Security contest</a></li>
<li><a href="../225819/index.html">Curiosity is back on the road after drilling. New panorama of Mount Sharp</a></li>
<li><a href="../225821/index.html">‚ÄúWhere are you, Stepan?‚Äù Or how do Wi-fi bridges help save on the Internet</a></li>
<li><a href="../225823/index.html">Using Pjax in Yii2 (short review)</a></li>
<li><a href="../225827/index.html">Learning to understand the art of programming</a></li>
<li><a href="../225829/index.html">The method of self-determination of the response time of the LCD monitor screen or TV</a></li>
<li><a href="../225831/index.html">Algorithm for finding the smallest covering capacity of a finite set of its subsets</a></li>
<li><a href="../225837/index.html">Notification during call pickup in Asterisk</a></li>
<li><a href="../225841/index.html">Swift programming language. Russian version</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>