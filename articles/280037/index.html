<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The dhcpclient and resolv.conf relationships in Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Abstract: a description of how the /etc/resolv.conf file is updated under the conditions of a working dhcp client, the specifics of various operating ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The dhcpclient and resolv.conf relationships in Linux</h1><div class="post__text post__text-html js-mediator-article">  Abstract: a description of how the /etc/resolv.conf file is updated under the conditions of a working dhcp client, the specifics of various operating systems and implementation options. <br><br>  Coverage: Debian, Ubuntu, Centos / Fedora / RHEL;  dhclient with resolvconf and without.  NetworkManager is not counted. <br><br>  Lyrics: I just spent a few days (details in English [ <a href="https://medium.com/%40george.shuklin/dhcp-and-resolv-conf-options-88b13afb3bdc">1</a> ], [ <a href="https://medium.com/%40george.shuklin/dhcp-and-resolv-conf-part2-debian-ubuntu-e79ea43aaed5">2</a> ]) figuring out how to properly save the 'options rotate' in /etc/resolv.conf in different distributions with DHCP running.  It turned out that there was no intelligible documentation on this issue, and the information had to be collected from various sources, source texts and experimental data.  Then it will be dry and in the case. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What are we talking about? <br><br>  At the computer, the network interface can be configured in principle by three types: manually / specialized software, statically set settings and through a DHCP client.  (There are still some exotic things, but these three are the main methods).  The first method is not interesting to us, with a static configuration everything is simple - as written, it will be so.  DHCP is interesting because the computer requests settings over the network "from someone".  DCHP has many options (settings) that can change completely unexpected computer settings ‚Äî the time zone, the exact time server address, the routing table, the server name or domain, etc.  From all this we are interested in the ability to set the DNS settings. <br><br>  Traditionally, the DNS-resolver settings are stored in the /etc/resolv.conf file, and after updating the dhcp-lease this file is updated.  This article explains exactly how the file "-sya" is. <br><br><h1>  DHCP client device </h1><br>  There are several implementations of dhcp-client, we are interested in ISC DHCP, as the most common. <br>  The client itself is called / sbin / dhclient, however, it‚Äôs standard to update the settings, it‚Äôs not called, but / sbin / dhclient-script.  dhclient-script calls dhclient and uses its response to change different parts of the system.  In dhclient-script itself there is a function make_resolv_conf, which, in fact, creates the file resolv.conf. <br><a name="habracut"></a><br>  For the convenience of modifying (and obfuscating system administrators) dhclient-script has hooks.  Their position varies (in Ubuntu Xenial and Debian Stretch this is /etc/dhcp/dhclient-exit-hooks.d, for some version of Centos - / etc / dhclient-enter-hooks / etc.).  Hooks are of two types - entry and exit.  Entry are called before the main one when dhclient-script, exit at the end.  You can write your own version of the function make_resolv_conf () in the hooks, and then the dhclient-script will call it, not the built-in one.  What exactly happens with rent is determined by the reason variable (examples of values: PREINIT, BOUND, RENEW, REBIND, REBOOT, EXPIRE, FAIL, RELEASE, etc).  Thanks <a href="https://habrahabr.ru/users/maxzhurkin/" class="user_link">maxzhurkin</a> for pointing out the (corrected) inaccuracies in this section. <br><br><h1>  resolvconf </h1><br>  This is actively used by the authors of the resolvconf package, which allows you to generate the /etc/resolv.conf file using a specified pattern (and not fixedly, as in the case of the native dhclient-script implementation).  They put a file (in Debian / Ubuntu) /etc/dhcp/dhclient-enter-hooks.d/resolvconf, which calls resolvconf -u (update) to create a new version of resolvconf. <br><br>  In order not to interfere with dhcpclient-script live, resolvconf manages the /run/resolvconf/resolv.conf file, and the resolvconf package (not to be confused with the program it provides) replaces / etc / resolvconf with a symlink for the installation /.run/resolvconf/resolv .conf. <br><br>  A typical problem when using resolvconf is the lack of a symlink.  If not, then dhclient-script will simply overwrite /etc/resolv.conf with the settings from the DHCP server, and resolvconf will update its file in the corner, only giving a warning that /etc/resolv.conf is not a symlink. <br><br>  The resolvconf templates are pretty simple: <br><ul><li>  /etc/resolvconf/resolv.conf.d/head </li><li>  /etc/resolvconf/resolv.conf.d/base </li><li>  /etc/resolvconf/resolv.conf.d/tail </li></ul><br>  head and tail are simply written where it should be, but base allows all sorts of strange things that are described in man resolvconf in the section "CONSUMERS OF NAMESERVER INFORMATION"). <br><br><h1>  Specificity of RHEL / Centos / Fedora </h1><br>  Red Hat uses its own version of the dhclient-script script, which is very extensive and complex, taking into account many settings from ifcfg-ethXXX, in particular, the RES_OPTIONS option that interested me.  Debian and Ubuntu use mostly upstream version, in which such delights are absent.  In Centos 7, one time in this script there was a bug that caused the presence of the 'options' line in /etc/resolv.conf upon rebooting, all other lines were removed from it, except the options line, and the new DNS servers in The file was not added. </div><p>Source: <a href="https://habr.com/ru/post/280037/">https://habr.com/ru/post/280037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280027/index.html">SPC and IDC</a></li>
<li><a href="../280029/index.html">How to make friends with iOS typography</a></li>
<li><a href="../280031/index.html">Measuring the flow rate of liquids and gases</a></li>
<li><a href="../280033/index.html">Scale to 100 million users. Cache or not cache?</a></li>
<li><a href="../280035/index.html">New JavaScript framework released: DAAJS</a></li>
<li><a href="../280039/index.html">One developer nearly broke the NPM package manager</a></li>
<li><a href="../280041/index.html">Comparison of programming languages ‚Äã‚Äãregarding work on the upwork.com freelance market + survey</a></li>
<li><a href="../280043/index.html">VolgaCTF 2016 sails the sail</a></li>
<li><a href="../280045/index.html">Yota application for Windows Phone - from Novosibirsk to St. Petersburg</a></li>
<li><a href="../280047/index.html">How we wanted to do something with iBeacons</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>