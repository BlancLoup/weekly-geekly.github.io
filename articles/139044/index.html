<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up document processing on FAST</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the tasks in integrating a third-party search engine into the system is setting up the processing of source documents (roughly speaking, indexi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up document processing on FAST</h1><div class="post__text post__text-html js-mediator-article">  One of the tasks in integrating a third-party search engine into the system is setting up the processing of source documents (roughly speaking, indexing).  The complexity of setting up such a process depends on the functional requirements for the search system and the capabilities of the search engine.  Settings can either be limited to a couple of clicks in the search engine admin panel, or result in writing your own procedures, scripts, etc.  If the standard features of the system (especially if its code cannot be modified) we are used to trust, then for our own scripts I would like to have tests, the implementation of which is not always provided by the engine. <br><a name="habracut"></a><br>  We are faced with the need to implement a search on the MS FAST ESP 5.3 platform.  This serious engine has impressive customization capabilities for processing documents, some of which we have touched upon in our project.  In general, we want to share our way of testing custom stages on this engine. <br><br>  <a href="http://nesfast1.scot.nhs.uk:16089/help/pdfs/assets/pdf/ESP_Document_Processor_Integration_Guide.pdf">The documentation</a> describes the process of creating stages quite well.  We will not retell it, we confine ourselves only to the information necessary for understanding the above. <br>  In FAST ESP terminology, the entire sequence of actions that must be performed when indexing a single document is called Pipeline, and the individual actions are called Stage.  Stage runs in a specific context with which it can interact, one of the elements of which is a document.  For example, a stage can read and write attributes of a document being processed.  Schematically, the entire document processing process is as follows: <br><br><img src="https://habrastorage.org/storage2/a2a/ea6/af3/a2aea6af3628dc5a646f8c641069c0ff.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Stage is presented in the form of two files - xml-specification and implementation (in FAST ESP 5.3, the implementation involves the use of the python v.2.3 language). <br><br>  Below is an example of a stage that writes 500 in the quality field if the hotornew document attribute is true. <br><pre> &lt;processors&gt;
  &lt;processor&gt;
   &lt;load module = "processors. SetOnEqual" class = "SetOnEqual" /&gt;
   &lt;desc&gt; Set high rank to documents, which have HotOrNew = yes
   &lt;/ desc&gt;
   &lt;config&gt;
         &lt;param name = "Input" value = "hotornew" type = "str" ‚Äã‚Äã/&gt;
         &lt;param name = "Output" value = "quality" type = "str" ‚Äã‚Äã/&gt;
         &lt;param name = "InputFieldValue" value = "true" type = "str" ‚Äã‚Äã/&gt;
         &lt;param name = "OutputFieldValue" value = "500" type = "int" /&gt;
        
   &lt;/ config&gt;
   &lt;ops&gt;
     &lt;add /&gt;
   &lt;/ ops&gt;
  &lt;/ processor&gt;
 &lt;/ processors&gt;
</pre><br>  (the specification is not directly involved in the tests, given for the integrity of the image) <br><br><pre><code class="hljs rust">from docproc import Processor, DocumentException, ProcessorStatus class SetOnEqual(Processor.Processor): def ConfigurationChanged(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, attributes): <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.input = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.GetParameter(<span class="hljs-symbol"><span class="hljs-symbol">'Input</span></span>') <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.output = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.GetParameter(<span class="hljs-symbol"><span class="hljs-symbol">'Output</span></span>') <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.inputfieldvalue = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.GetParameter(<span class="hljs-symbol"><span class="hljs-symbol">'InputFieldValue</span></span>') <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.outputfieldvalue = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.GetParameter(<span class="hljs-symbol"><span class="hljs-symbol">'OutputFieldValue</span></span>') def Process(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, docid, document): testField = <span class="hljs-built_in"><span class="hljs-built_in">str</span></span>(document.GetValue(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.input, <span class="hljs-literal"><span class="hljs-literal">None</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> testField == <span class="hljs-built_in"><span class="hljs-built_in">str</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.inputfieldvalue): output = int(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.outputfieldvalue) document.Set(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.output,output) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: document.Set(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.output, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ProcessorStatus.OK</code> </pre> <br>  In order to check the work of the created stage in the native context of document processing, it is necessary to do the sequence of actions indicated in the documentation: <br>  1. To put in a specific directory files specification and implementation; <br>  2. Restart the document processing service - Document Processor (procserver. Upon launching it compiles the step code); <br>  3. Include a new stage in the pipeline; <br>  4. Index the test document; <br>  5. Look at the result of processing the document (you can output to the log file, or you can ‚Äúfind‚Äù a new document through the standard frontend and see all the attributes of the document). <br><br>  If we did not get the expected result (for example, in the document we set the field hotornew = true, and the value of the Quality field has not changed), we will have to debug, which means: <br>  - Search for an error in the procserver log; <br>  - To check if our stage did exactly what they asked for by putting the Spy stages before and after performing the stage.  (Spy uploads a document dump together with its attributes to a file on disk); <br>  - Search for an error in the stage code. <br><br>  Once the error is corrected, you need to check again - i.e.  again perform steps 1, 2, 4, 5. <br>  This is a chore.  It is more convenient to debug the stage code ‚Äúas it is‚Äù by the usual methods, for example, in a unit test: <br><br><img src="https://habrastorage.org/storage2/f11/bc8/4d3/f11bc84d3a956e4c7ce6849ac9b430bd.png"><br><br>  Therefore, in order to ‚Äúrecreate‚Äù the context, we have made primitive classes of classes, with objects that the stage works with: <br><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Document</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Mock  Document """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, default)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getattr(self, name, default) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, field, value)</span></span></span><span class="hljs-function">:</span></span> setattr(self, field, str(value)) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Processor</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Mock  Processor """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getattr(self, name) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, field, value)</span></span></span><span class="hljs-function">:</span></span> setattr(self, field, str(value))</code> </pre><br>  In reality, the document entity provides other methods.  We are limited to those that use. <br>  Now you can write / debug / test a stage without a search engine: <br><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> docproc.Processor <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> proclib <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> docproc <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ProcessorStatus <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SetOnEqual <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testSetOnEqual</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stage = SetOnEqual.SetOnEqual() self.stage.Set(<span class="hljs-string"><span class="hljs-string">'Input'</span></span>, <span class="hljs-string"><span class="hljs-string">'hot'</span></span>) self.stage.Set(<span class="hljs-string"><span class="hljs-string">'Output'</span></span>, <span class="hljs-string"><span class="hljs-string">'quality'</span></span>) self.assertEquals(self.stage.GetParameter(<span class="hljs-string"><span class="hljs-string">'Input'</span></span>), <span class="hljs-string"><span class="hljs-string">'hot'</span></span>) self.assertEquals(self.stage.GetParameter(<span class="hljs-string"><span class="hljs-string">'Output'</span></span>), <span class="hljs-string"><span class="hljs-string">'quality'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_true</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stage.Set(<span class="hljs-string"><span class="hljs-string">'InputFieldValue'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>) self.stage.Set(<span class="hljs-string"><span class="hljs-string">'OutputFieldValue'</span></span>, <span class="hljs-string"><span class="hljs-string">'600'</span></span>) doc = proclib.Document() doc.Set(<span class="hljs-string"><span class="hljs-string">'hot'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>) self.stage.ConfigurationChanged(<span class="hljs-string"><span class="hljs-string">''</span></span>) status = self.stage.Process(<span class="hljs-string"><span class="hljs-string">"docid"</span></span>, doc) self.assertEquals(status, ProcessorStatus.OK) self.assertEquals(doc.GetValue(<span class="hljs-string"><span class="hljs-string">'quality'</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-string"><span class="hljs-string">'600'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_false</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stage.Set(<span class="hljs-string"><span class="hljs-string">'InputFieldValue'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>) self.stage.Set(<span class="hljs-string"><span class="hljs-string">'OutputFieldValue'</span></span>, <span class="hljs-string"><span class="hljs-string">'600'</span></span>) doc = proclib.Document() doc.Set(<span class="hljs-string"><span class="hljs-string">'hot'</span></span>, <span class="hljs-string"><span class="hljs-string">'no'</span></span>) self.stage.ConfigurationChanged(<span class="hljs-string"><span class="hljs-string">''</span></span>) status = self.stage.Process(<span class="hljs-string"><span class="hljs-string">"docid"</span></span>, doc) self.assertEquals(status, ProcessorStatus.OK) self.assertEquals(doc.GetValue(<span class="hljs-string"><span class="hljs-string">'quality'</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-string"><span class="hljs-string">'0'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">suite</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> suite = unittest.TestSuite() suite.addTest(unittest.makeSuite(testSetOnEqual)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> suite <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: unittest.main()</code> </pre><br>  The code is entirely in the <a href="">archive</a> . <br><br>  What gave us this approach: <br>  - Simplification of life itself (great time saver and allows you to not deviate from the practice of unit testing); <br>  - Simplify the life of the tester. <br><br>  <b>Author:</b> <br>  Lia Shabakayeva <br>  Lead Developer <br>  Softline Development Department </div><p>Source: <a href="https://habr.com/ru/post/139044/">https://habr.com/ru/post/139044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139036/index.html">Script for deploying SSRS reports</a></li>
<li><a href="../139037/index.html">What do you think about master classes / workshops from foreign stars?</a></li>
<li><a href="../139039/index.html">The principle of substitution Liskov and contracts</a></li>
<li><a href="../139040/index.html">Centralized syslog</a></li>
<li><a href="../139042/index.html">Login page in the admin site of the city council of Dnepropetrovsk</a></li>
<li><a href="../139045/index.html">Interesting future: Furniture-transformer!</a></li>
<li><a href="../139046/index.html">The story of Panda and iOS</a></li>
<li><a href="../139048/index.html">Popular About Amazon Web Services: CloudFront [continued]</a></li>
<li><a href="../139049/index.html">AMD APP SDK: Compute Abstraction Layer (CAL)</a></li>
<li><a href="../139051/index.html">Sites * .narod.ru work on ZX Spectrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>