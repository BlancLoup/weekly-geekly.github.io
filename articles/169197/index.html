<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Translation SDL Game Framework Series. Part 5 - SDL Animation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! It has been quite a long time since the translation of part 4 of a series of guides for the development of a gaming framework using the well-kn...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Translation SDL Game Framework Series. Part 5 - SDL Animation</h1><div class="post__text post__text-html js-mediator-article">  Hello!  It has been quite a long time since the translation of part 4 of a series of guides for the development of a gaming framework using the well-known <i>SDL</i> library.  Now my schedule has been a little unloaded and I am ready to continue (not the last thing Andrei Firsov aka <a href="https://habrahabr.ru/users/vorobeez/" class="user_link">Vorobeez</a> played in this, who literally pulled me out of the business stream with his own questions ‚ÄúAnd when is the continuation ?!‚Äù).  In addition, I was recently transferred to read-only, and I want to restore the possibility of commenting on posts ... <br><a name="habracut"></a><br>  In the last lesson we tried to make the popular game Tic-Tac-Toe.  I hope most of you try to start the game were successful, maybe someone even managed to modify and improve the written code (and to some it all seems childish prattle).  Even if it is not, try, try, and ultimately you will succeed. <br><br>  In this lesson, we will try to upgrade our skills by adding animation to the piggy bank using SDL.  As before, we will build on previous lessons (but not on <i>TicTacToe</i> , it was a separate cool project).  I think it's time to start. <br><br>  First of all, we need to create a new class for animation processing, and in the next lesson we will create a class for working with <i>Entity</i> (game entities).  Please keep in mind that these two things are completely different in essence, and although I know that they can be easily implemented in the same class, I don‚Äôt want to use this approach.  All criticism is better to send to the author of the series, although any feedback will also be useful to me. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create 2 new <i>CAnimation.h</i> and <i>CAnimation.cpp files,</i> respectively.  Ultimately, when we create the <i>CEntity</i> class, it will inherit from <i>CAnimation</i> , but now we will test only one object, which we will create a little later.  And before we begin, let's add the include directive <i>#include "CAnimation.h"</i> to <i>CApp.h</i> (preferably before <i>#include "CEvent.h"</i> ). <br><br><h5>  Let's make some code! </h5><br>  Open <i>CAnimation.h</i> , and add the following lines: <br><div class="spoiler">  <b class="spoiler_title">CAnimation.h</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _CANIMATION_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _CANIMATION_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SDL.h&gt; class CAnimation { private: int CurrentFrame; int FrameInc; private: int FrameRate; //Milliseconds long OldTime; public: int MaxFrames; bool Oscillate; public: CAnimation(); void OnAnimate(); public: void SetFrameRate(int Rate); void SetCurrentFrame(int Frame); int GetCurrentFrame(); }; #endif</span></span></span></span></code> </pre> <br></div></div><br>  And in <i>CAnimation.cpp we</i> write this: <br><div class="spoiler">  <b class="spoiler_title">CAnimation.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CAnimation.h"</span></span></span><span class="hljs-meta"> CAnimation::CAnimation() { CurrentFrame = 0; MaxFrames = 0; FrameInc = 1; FrameRate = 100; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//Milliseconds OldTime = 0; Oscillate = false; } void CAnimation::OnAnimate() { if(OldTime + FrameRate &gt; SDL_GetTicks()) { return; } OldTime = SDL_GetTicks(); CurrentFrame += FrameInc; if(Oscillate) { if(FrameInc &gt; 0) { if(CurrentFrame &gt;= MaxFrames) { FrameInc = -FrameInc; } }else{ if(CurrentFrame &lt;= 0) { FrameInc = -FrameInc; } } }else{ if(CurrentFrame &gt;= MaxFrames) { CurrentFrame = 0; } } } void CAnimation::SetFrameRate(int Rate) { FrameRate = Rate; } void CAnimation::SetCurrentFrame(int Frame) { if(Frame &lt; 0 || Frame &gt;= MaxFrames) return; CurrentFrame = Frame; } int CAnimation::GetCurrentFrame() { return CurrentFrame; }</span></span></span></span></code> </pre><br></div></div><br>  I think it is worth telling a little about what this code does after all.  In game dev, there is one main element of the animation that we need to handle - the current frame of the animation.  Look at the image that we will use in this lesson.  As you can see, we have 8 frames of dragon on one image.  We will refer to the current frame by its sequence number 1,2, ... and draw it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e08/807/f6f/e08807f6fe32d7509345cbf5c2bd9a41.png"><br><br>  Remember, in the second lesson, we created a function to draw a part of the image?  It remains to apply it, coupled with our frame of animation, and voila! <br><br>  So, for the current frame number, we will have a variable with the talking name <i>CurrentFrame</i> .  This is the current frame of the animation, which we will draw on the screen.  All that he is responsible for is the storage of the sequence number of the part of the surface that we will draw on the screen.  So when we call our drawing function, it will look something like this: <br><br><pre> <code class="cpp hljs">CSurface::OnDraw(Surf_Display, Surf_Image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, Ezhik.GetCurrentFrame() * <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>);</code> </pre><br>  When the CurrentFrame is incremented by 1, we just shift by 64 pixels to the right in the image (frame size), and draw this frame. <br><br>  As you may have guessed, <i>MaxFrames</i> tells us how many animation frames we have.  And finally, we need to know how many frames per second we draw, or rather, how quickly this animation will be displayed (yes, yes, that same notorious FPS).  The definition of the drawing frequency is programmed in the <i>OnAnimate</i> method: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(OldTime + FrameRate &gt; SDL_GetTicks()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre><br>  By adding the old value of the elapsed time since the SDL operation and the desired frame rate, we can compare it with the time that the SDL (current) is already running.  Chew: let's say we just started our program.  <i>SDL_GetTicks</i> returns 0, and OldTime naturally also equals 0. We take it for granted that the desired frame rate is 1 frame per second.  So  FrameRate = 1000 (milliseconds).  So, is 0 + 1000 greater than 0?  Yes, i.e.  we need to skip this beat and wait for the next one.  But on the next clock cycle of 0 + 1000 less than <i>SDL_GetTicks</i> , this should mean that 1 second has passed.  Thus, we increase the frame value, and then reset the OldTime value to the current time, and run the check from the beginning.  I think now it‚Äôs clearer how it all works. <br><br>  And now I will tell about <i>Oscillate</i> and <i>FrameInc</i> .  It‚Äôs not that I want to confuse you by adding all this, rather the opposite, so I‚Äôll show why this is necessary.  In general, when <i>Oscillate is</i> set to <b>true</b> , the animation class will increase the frames until the maximum number of frames is reached, and then decrease.  If we had 10 frames, for example, we would see something like this: 0 1 2 3 4 5 6 7 8 9 8 7 6 5 4 3 2 1 2 ... (CurrentFrame).  We go all the way from 0 to 9 and then go down in the reverse order.  Everything is very simple!  In the next lesson, I will show you an interesting way to use all of this.  How does this work?  Let's take a <i>closer</i> look at <i>OnAnimate</i> . <br><br>  About <i>OldTime</i> and its purpose, we know, and what about the rest of the code?  Look at checking the <i>Oscillate</i> value.  Inside, we simply check to see if <i>CurrentFrame has</i> reached the maximum number of frames.  If so, reset the <i>CurrentFrame</i> back to 0. <br><br>  I think that by setting <i>Oscillate</i> to <b>true</b> , we will have a smoother display of animation!  What do you think?  Let's look at the purpose of <i>FrameInc</i> .  The value of <i>FrameInc</i> is set to either 1 or -1, depending on whether we need to go on frames in one direction or another (decrease or increase).  That is, if <i>FrameInc is</i> greater than 0, we start incrementing frames, otherwise we apply decrement.  Thus, we alternately reach either 0 or the <i>MaxFrames</i> value, which, I think, is much more beautiful (at least there is no hard reset of <i>CurrentFrame</i> to 0). <br><br><h5>  Finish line </h5><br>  Now let's put it all together!  You need to create an object of the CAnimation class in <i>CApp.h</i> : <br><br><pre> <code class="cpp hljs">CAnimation Anim_Yoshi;</code> </pre><br>  Set the value of MaxFrames, inside <i>CApp_OnInit</i> : <br><br><pre> <code class="cpp hljs">Anim_Yoshi.MaxFrames = <span class="hljs-number"><span class="hljs-number">8</span></span>;</code> </pre><br>  If you need animation from 0 frames to 7 and back, set: <br><br><pre> <code class="cpp hljs">Anim_Yoshi.Oscillate = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br>  Make the Yogi animate inside <i>CApp_OnLoop</i> : <br><br><pre> <code class="cpp hljs">Anim_Yoshi.OnAnimate();</code> </pre><br>  And of course, to enjoy the animation, you need to look at it by adding to <i>CApp_OnRender</i> : <br><br><pre> <code class="cpp hljs">CSurface::OnDraw(Surf_Display, Surf_Test, <span class="hljs-number"><span class="hljs-number">290</span></span>, <span class="hljs-number"><span class="hljs-number">220</span></span>, Anim_Yoshi.GetCurrentFrame() * <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>);</code> </pre><br>  Well that's all!  Compile our updated project and run it!  Do not forget to download the picture from this article, because in the original frames in the column, that, IMHO, looks ugly.  And a couple of moments.  Since the picture is .PNG, you need to use IMG_Load (in previous articles I wrote about this function) and connect the library to the project with the <i>-lSDL_image</i> key.  Also, try turning off this annoying pink color from Yozhi (how to do this, too, can be seen in previous articles).  Good luck to you, in the hard work of GameDeveloper'a!  I hope these articles help ... <br><br>  Links to source code: <br><ul><li>  <a href="">Win32</a> </li><li>  <a href="">* nix</a> </li></ul><br><br>  Links to all lessons: <br><ul><li>  <a href="http://habrahabr.ru/post/166875/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/166875/">Part 1 - The Basics of SDL</a> </li><li>  <a href="http://habrahabr.ru/post/167035/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/167035/">Part 2 - Coordinates and Mapping</a> </li><li>  <a href="http://habrahabr.ru/post/167245/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/167245/">Part 3 - Events</a> </li><li>  <a href="http://habrahabr.ru/post/167443/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/167443/">Part 4 - Tic-Tac-Toe</a> </li><li>  Developing a game framework.  Part 5 - Animation </li><li>  <a href="http://habrahabr.ru/post/169295/">Developing a game framework.</a>  <a href="http://habrahabr.ru/post/169295/">Part 6 - Entities</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/169197/">https://habr.com/ru/post/169197/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169187/index.html">Dependency Injection Introduction</a></li>
<li><a href="../169189/index.html">CodenameOne or Java vs HTML5</a></li>
<li><a href="../169191/index.html">We want to show you WCAG: we are learning the basics of web accessibility to music.</a></li>
<li><a href="../169193/index.html">How to recover text in one minute after unsuccessful web form submission</a></li>
<li><a href="../169195/index.html">AppFuscator - .NET cloud protection</a></li>
<li><a href="../169199/index.html">C ++ library from Google with map and set containers on B-trees</a></li>
<li><a href="../169201/index.html">Even the blonde will be able to pick up a normal Android device (+ bonus: the top most-most Android devices)</a></li>
<li><a href="../169203/index.html">Adobe Flash Player updated, updated again.</a></li>
<li><a href="../169207/index.html">About the commission in Bitcoin</a></li>
<li><a href="../169209/index.html">Dell Venue Pro - year together</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>