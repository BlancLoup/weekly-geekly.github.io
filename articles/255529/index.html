<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use Java smart cards to protect software. Chapter 1. General Information</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction 
 In this series of articles we will discuss the use of Java smart cards (cheaper analog keys of electronic keys) to protect software....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use Java smart cards to protect software. Chapter 1. General Information</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/22d/989/e78/22d989e78ad04030bec8bf788de74983.gif" alt="image"><br><br><h4>  1. Introduction </h4><br>  In this series of articles we will discuss the use of Java smart cards (cheaper analog keys of electronic keys) to protect software.  The cycle is divided into several chapters. <br><br>  To read and understand the information from the articles you will need the following skills: <br><ul><li>  Basics of software development for Windows (programming skills are enough in any visual environment, such as Delphi or Visual Basic) </li><li>  Basic knowledge from the field of cryptography (what is a cipher, symmetric, asymmetric algorithm, initialization vector, CBC, etc. I recommend Applied Cryptography by Bruce Schneier for mandatory reading). </li><li>  Basic programming skills in any language, even remotely resembling Java syntax (Java, C ++, C #, PHP, etc.) </li></ul><br>  The purpose of the cycle is to acquaint the reader with Java maps (there is very little literature in Russian on their use).  The cycle does not claim the status of "Guidelines for the development of software protection based on Java cards" or the title of "Handbook of Java cards." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The composition of the cycle: </h4><br><ul><li>  <a href="http://habrahabr.ru/post/255529/">Chapter 1. Java card.</a>  <a href="http://habrahabr.ru/post/255529/">General information.</a> </li><li>  <a href="http://habrahabr.ru/post/255531/">Chapter 2. Java map from the point of view of the applet developer</a> </li><li>  <a href="http://habrahabr.ru/post/255533/">Chapter 3. Installing and Configuring IDE</a> </li><li>  <a href="http://habrahabr.ru/post/255535/">Chapter 4. We write the first applet</a> </li><li>  <a href="http://habrahabr.ru/post/255537/">Chapter 5. Security</a> </li></ul><br><a name="habracut"></a><br><h4>  2. Assumptions </h4><br>  No article in the cycle claims to be complete and accurate, although the author tried very hard to make all of them the most complete and accurate. <br>  When using any information from this series of articles, remember that you do this at your own peril and risk.  The author is not responsible for any damage that may be caused to you by using this information. <br><br>  The series of articles deals with Java cards that comply with the <a href="http://www.globalplatform.org/">GlobalPlatform</a> version 2.1.1 and <a href="http://www.oracle.com/technetwork/java/embedded/javacard/downloads/default-1970005.html">JavaCard</a> 2.2.1, such as <a href="http://www.nxp.com/documents/line_card/75016728.pdf">NXP JCOP</a> or <a href="http://www.gemalto.com/Products/top_javacard/index.html">Gemalto TOP</a> GX.  All information in this series of articles or part of it may not be applicable to Java-cards that do not meet these standards (the exception, of course, is the later versions of the standards mentioned).  Using cards that do not meet these standards for software protection may be unsafe for the project. <br><br>  Since the description of the GlobalPlatform standard of one particular version takes about 350 printed A4 sheets, the author deliberately goes to some simplification of the terms and theories underlying the architecture of the described cards, which in his opinion does not contradict the actual data. <br><br><h4>  3. Basic Java Card Information </h4><br>  What is a java card?  A java card is a small computer enclosed in a SIM card case, similar to the one you use in your cell phone.  This microcomputer has its own microprocessor (such as <a href="https://www.charismathics.com/fileadmin/files/pdf/datasheets/SPI_P8WE5017.pdf">Philips P8WE5017</a> , for example), a certain amount of ‚Äúflash‚Äù memory for storing programs (usually from 32 to 128 kilobytes), a cryptographic coprocessor. <br><br>  The computer communicates with the computer through a special reader, usually inserted into the USB port.  But there are also contactless cards that you simply bring to the reader to establish a connection. <br><br>  In memory cards can be stored programs called applets.  Applets are written in a slightly truncated version of the Java language (a text file with the .java extension), then compiled into a byte code using a regular Java compiler (you get a * .class file) and are converted by a special converter program to directly load into the map (usually, * .cap or * .ijc file).  The Java language variant used to write applets is simplified so that applets are as fast and compact as possible (for example, support for types such as string has been removed from the language, and most of the cards do not support int, either. this in the following articles).  Communication with the card is <a href="http://en.wikipedia.org/wiki/Smart_card_application_protocol_data_unit">accomplished</a> by sending a command to the card, called an <a href="http://en.wikipedia.org/wiki/Smart_card_application_protocol_data_unit">APDU</a> (Application protocol data unit), consisting of a header, 5 bytes long and the data of the command.  In response, the card can respond with a double-byte code: either an error code or a code indicating successful execution of the operation (as a rule, 90 00).  Together with the successful execution code, the card can transmit to the application a stream of bytes corresponding to the result of the command execution (for example, decrypted data). <br><br>  On a card, usually by default, at least one applet already exists, called ISD or Card Manager, which provides basic functionality (for example, installing and removing applets).  Sometimes the manufacturer installs a card and other applets (for example, an applet supporting <a href="https://en.wikipedia.org/wiki/PKCS_11">PKCS # 11</a> or an electronic wallet). <br><br>  Most Java cards carry a cryptographic coprocessor that speeds up the execution of encryption and checksum calculations by applets.  The most commonly used are DES, AES, RSA and SHA1.  A complete list of supported algorithms can be found in the JavaCard SDK.  The list of algorithms supported by a specific card is in the documentation for specific cards (yes, as a rule, the card does not fully support the standard, for example, due to export restrictions). <br><br>  Technically, the applet code is an instance of a class inherited from some abstract JavaCard API class (Applet), whose methods provide basic functionality (installation processing, response to commands from a computer).  All members of the applet class are persistent and stored in the EEPROM card.  Thus, if the instance of the applet class has a field short x = 5 and as a result of the execution of the APDU command, the applet changed this value, after removing the card from the computer and inserting it back into the reader, the applet will have the modified value available. <br><br>  The amount of memory card (RAM) is usually small and depends on the implementation.  Usually no more than 1Kb. <br><br>  Access keys are used to protect the card.  There are usually three of them - encryption key (ENC / AUTH), signature key (MAC) and important data encryption key (DEK / KEK), which is used when changing access keys to the card, as a rule).  This is usually 3DES2 keys of 16 bytes each.  Knowledge of these keys is necessary only for manipulations with the applet (writing and deleting, reading the list of applets installed on the card).  Sending a command to your applet and getting a response from it does not require knowledge of these keys. <br><br>  To communicate with the card from your Windows-based software, SmartCard API is used, which allows you to transparently communicate with all cards that meet the standard, regardless of the type of card and reader.  In many programming languages ‚Äã‚Äã(Java, .NET, Delphi and others) there are wrapper libraries for communicating with the map, providing the required functionality in a convenient for the developer form of classes / components. <br><br>  Some cards on the market (such as Gemalto CyberFlex Egate 32k) have a built-in USB interface and can be used with a reader that can be ‚Äúsoldered‚Äù almost at home.  True, such cards are noticeably more expensive than ordinary ones.  The cost of a reader for cards with a USB interface for large batches can be about $ 1.  The cost of a standard reader, as a rule, which has built-in Windows drivers for production on Chinese capacities is a few dollars. <br><br>  Cards are supplied in the form factor of a SIM-card of a cell phone, and in the <a href="">"big"</a> format. <br><br>  The API for working with cards is able to respond to inserting and extracting a card, which allows it to be implemented using cards, for example, employee time management systems (you need to leave - put the card in the reader or the reader with his card in the PC. Soft responded, asked the applet to sign random data, checked the signature and made the registration). <br><br><h4>  4. Why Java cards are useful for software protection </h4><br>  The owner of the Java card can load one or several applets that implement almost any algorithms (complexity, of course, is limited by the speed of the card's processor and the amount of available memory).  But these applets <b>cannot be read</b> from the card by anyone, including the cardholder (the applet can only be erased and the new one replaced in its place).  You can only give the applet some command and get an answer.  Perfect black box. <br><br>  The GlobalPlatform standard allows for remote secure update of applets, for example, via the Internet.  In this case, using cryptographic algorithms ensures that the source code of the applet cannot be intercepted by a third party (I had to write client-server solutions for such operations. I cannot say that everything is simple, since the cards are still different, but, nevertheless, quite possible). <br><br>  A Java card is usually protected from electronic retrieval of information by special methods (that is, it is impossible to make a copy of it).  Remember that we are talking about specific cards that implement specific standards.  Some <a href="https://ru.wikipedia.org/wiki/Mifare">Mifare</a> cards, for example, which our metro system used in the past, can be easily cloned (although this is not a Java card), whereas IBM JCOP-based technology is usually very difficult. <br><br>  The applet can independently block (to unblock it, you need to establish a secure session, which requires knowledge of the card access keys) or destroy the card (further work with it by any means will be impossible, the card will always respond with an error). <br><br>  Many Java cards are certified by EAL standards (some JCOP are certified, for example, by <a href="http://en.wikipedia.org/wiki/Evaluation_Assurance_Level">EAL4 +, EAL5</a> ), which guarantees reliable protection.  Some cards use, for example, such companies as Visa as e-wallets. <br><br>  The cost of some Java-cards for purchases in large quantities is very small (some simple JCOP variants cost a few euros for large lots).  Compare this cost with the cost of some specialized protection keys like <a href="https://ru.wikipedia.org/wiki/HASP">HASP</a> or <a href="http://www.guardant.ru/">Guardant</a> , the majority of which, by the way, do not allow arbitrary algorithms to be stored in the key's memory. <br><br>  The Java language variant used to write applets is extremely simple to learn and use. <br>  All tools for working with most cards on the market are open and free. <br><br><h4>  5. Is it possible to hack software protected by a Java card? </h4><br>  The complexity of hacking software protected by a card depends on the complexity of the algorithm that you put on the card.  For example, if you place an applet in the map that will summarize the two numbers transferred and return the result, there are good chances that the first hacker will make an emulator.  He will not even have to break the software for this (it is enough to replace the dll in Windows, which communicates with the map).  However, it should be noted that in this case you will be able to release the V2 version of your applet, which will summarize three numbers already and will thus be <i>‚Äúmore resistant‚Äù</i> to cracking. <br><br>  But, for example, if you wrote software that uses the card to generate electronic signature of documents using RSA keys that you put in the applet, such software will not be able to be hacked, since it is absolutely impossible to extract the RSA key from the applet if the applet itself does not want .  However, as a rule, the protection mechanisms placed in the applet are a cross between the two examples and we will talk about this later. <br><br><h4>  6. Select Java card </h4><br>  When choosing cards to protect your software, be careful. <br><br><ul><li>  Examine all the documents and specifications of the cards that you offer. </li><li>  Make sure the cards are certified and protected from attacks. </li><li>  Pay attention to the list of algorithms supported by the card.  For example, on some cheap JCOPs, AES and RSA are disabled (algorithms may not be completely disabled. Let's say that only keys with limited length will be available). </li></ul><br><br>  As for me, with a light heart, I can advise you to use only NXP JCOP or Gemalto TOP (and their older versions). <br><br><h4>  7. Where to buy </h4><br>  In general, it is better to buy cards abroad from trusted suppliers who work with large companies.  In Russia, their prices are simply wild (although, of course, everything depends on the quantity).  But for tests or initial development, you can buy them in online stores.  Unfortunately, very few people will give you a good price for a small batch of cards.  But on trial it is quite possible to buy a couple of pieces. <br><br><h4>  8. Gratitude to patient readers. </h4><br>  Thanks to everyone who read to this place.  Gratitude and indignation are accepted. <br><br>  I will welcome any questions in the comments and try to update the article so that it includes the answers. </div><p>Source: <a href="https://habr.com/ru/post/255529/">https://habr.com/ru/post/255529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255513/index.html">We are switching from STM32 to the Russian K1986BE92QI microcontroller. Practical application: Generate and reproduce sound. Part one: we generate a square and sinusoidal signal. Mastering the DAC (DAC)</a></li>
<li><a href="../255519/index.html">Return oriented programming. We collect exploit in pieces</a></li>
<li><a href="../255523/index.html">SQL Language Tutorial (DDL, DML) on the example of MS SQL Server dialect. Part two</a></li>
<li><a href="../255525/index.html">Encryption and decryption - accessing the OpenSSL API using JNI calls</a></li>
<li><a href="../255527/index.html">Ordinary Primes: The Secrets of the Weavers' Secret Society</a></li>
<li><a href="../255531/index.html">Use Java smart cards to protect software. Chapter 2. Java smart card from the applet developer's point of view</a></li>
<li><a href="../255533/index.html">Use Java smart cards to protect software. Chapter 3. Installing and Configuring IDE</a></li>
<li><a href="../255535/index.html">Use Java smart cards to protect software. Chapter 4. We write the first applet</a></li>
<li><a href="../255537/index.html">Use Java smart cards to protect software. Chapter 5. Security</a></li>
<li><a href="../255539/index.html">Release elementary OS "Freya"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>