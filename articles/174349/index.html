<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Economic strategy "Sakhalin colony"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sakhalin colony - an economic strategy whose goal is to survive. The player is given a typical or randomly generated playing field divided into cells....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Economic strategy "Sakhalin colony"</h1><div class="post__text post__text-html js-mediator-article">  <b>Sakhalin colony</b> - an economic strategy whose goal is to survive.  The player is given a typical or randomly generated playing field divided into cells. <br>  Each cell represents a specific resource, or a blank field.  At the beginning of the game, the player is given an administration building and 2 plots of land on which he can build resource-extraction structures.  All buildings are destroyed over time and need to be repaired - for money gained from the sale of resources.  The administration building is the main one - the impossibility of its repair leads to the end of the game. <br>  To get a plus on income is not easy, and a rare, but expensive administration repair often breaks up beautifully constructed plans. <br><br><img src="https://habrastorage.org/storage2/8c0/fe5/1b6/8c0fe51b6608d555dfdacf4c9931d25f.png"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Once upon a time, I really liked the economic strategy of the ‚ÄúSakhalin colony‚Äù of Grigory Zhmulevsky.  Now it was from her that I decided to write my first completed game, and at the same time explore various aspects of C #.  Having received a concise ‚ÄúOf course‚Äù from the author on the question of copying his game, I set to work. <br>  Sources in C ++ are available on the author‚Äôs website, and I turned to them to copy these objects ‚Äî the cost, how much the object lives, in what situations it is destroyed more or less, and so on.  For the rest, I tried to rely only on myself. <br>  Together with chrome, the size of the original is 640480.  I chose the same dimensions of the application, but without chrome.  Due to this, as well as more optimal use of space, it was possible to increase the size of the map cell by 2 pixels.  Little, but also good. <br>  The internal logic of the game is almost completely preserved.  Added brief reference. <br><br>  <b>Summary of development.</b> <br><br>  <u>General</u> <br>  It was decided to make the game on XNA in particular because for him I already had some gui work. <br>  A fairly simple architecture was chosen for implementation: <br>  Game classes without using specific XNA classes, for the simplicity of a possible port to another engine in the future: <br><ul><li>  Class game with reference to the map </li><li>  Map class with reference to cell array </li><li>  Cell with your data and link to the building </li><li>  Building with your own data and cell index </li><li>  A static class containing all immutable data, incl.  transfers. </li></ul><br>  Xna class Game: <br><ul><li>  In update (), open / close dialog forms, call update controls. </li><li>  In draw () - drawing game elements, call draw controls. </li></ul><br>  Class event_handlers: <br><ul><li>  Class-layer between the Game and game classes.  The call of game methods is carried out only through it.  Again, for the simplicity of a possible port to another engine.  In it - work with flows. </li></ul><br>  Xml class: <br><ul><li>  Work on the preservation, reading data. </li></ul><br><br>  <u>Serialization</u> <br>  Serialization could in theory help to discard the cumbersome data storage / reading class using an XmlDocument. <br>  However, in practice, when introducing the serialization functionality, I was faced with a number of tasks without which it could not work. <br>  In particular, most of the static classes had to be made public.  The result was a static top-level class containing a link to the public class of the game.  This approach allowed, on the one hand, to preserve the simplicity of accessing the necessary data, on the other - to use serialization.  During programming and intermediate tests, I encountered a strange behavior of the program when opening and saving data - everything worked on the development computer, but on the other the game took off all the time for serialization.  Adding try catch constructs to the game was able to get and display error information in a file.  It turned out that the serializer (only!) On the client computer could not parse some static classes.  It turned out that the problem is in the fields - enumerations that are declared in the auxiliary static class.  After a long search, I was advised to exclude them from the serialization attribute [XmlIgnore].  However, these fields are necessary in logic, so it was decided to duplicate them into string fields, and after reading xml, immediately parse the string representation into the corresponding enumeration.  It worked. <br><br>  <u>Content</u> <br>  At first, I planned to fill the game with images marked free from the Internet, because  he himself was never able to draw, but the search for suitable pictures <br>  turned out to be surprisingly difficult.  In the end, having tried to draw the icons myself, I saw what was going on normally (in my opinion), and it‚Äôs faster in time than searching for them on the Internet.  At the moment there are only three pictures in the game from the Internet - money, food, gold.  The rest are drawn in paint.  Post-processing in a more serious editor is quite small.  All the icons of land and buildings are in fact twice as large as those displayed in the game - so it was easier to draw them.  In addition, icons of this size will be easier to use in the future.  Reducing is easier than increasing. <br><br><img src="https://habrastorage.org/storage2/1d0/423/70e/1d042370e37aa17e1373b9a7efe2c9f0.png"><br><br>  <u>Texture Cards</u> <br>  Initially, all the graphic content was broken - each button has one file.  Moreover, the built-in XNA content mechanism was not used - all textures were loaded into the game in the standard way for C # and then converted to Texture2d via Stream.  Textures were stored in the named array.  A large number of files and difficulties with publishing made us think about texture maps.  Gathering (almost) all <br>  textures in maps managed to reduce the memory consumption of the application by almost 10 megabytes (the value of the ‚Äúallocated memory‚Äù column in the controller decreased from 69 to 60 MB).  The named array was also replaced with n separate variables. <br><br>  <u>Interface</u> <br>  Unfortunately, XNA does not have its own graphical interface.  Connecting win form or wpf imposes its limitations.  Since  One of the goals of the project is to teach programming in C # as a whole and specifically in the gaming environment, it was decided to recall a relatively old bike - Gui under XNA. <br>  Initially, this gui was conceived as a very powerful mechanism - an interface constructor.  His power turned into huge blocks of code with hard-to-find errors and slow work.  I had to cut a lot of code, simplify the work, reduce the number of auxiliary function calls to update. <br>  The edit control was also written - accepting only numbers, decimal point, plus and minus signs (excluding plus and minus on the additional keyboard - did not find them in the XNA key list).  Means gui, if necessary, create additional textures - pressing, pointing, inaccessible state.  It turned out a small, but quite working gui. <br><br><img src="https://habrastorage.org/storage2/198/49c/57d/19849c57de402b06b840f8b7cea7c8bd.png"><br><br>  <u>Streams</u> <br>  The application uses windows, incl.  modal.  Windows-questions, messages, as well as a form of trade, should send some information to the program that will be processed. <br>  During the work, the following solution was found: when the window is activated in a separate stream, the target method is invoked, for example, building repair.  The cost of repair is being calculated, the activation flag of the window, the text of the question itself is transferred to the static question class. <br>  The method of building repair (called flow) enters the loop by a flag ‚Äî a sign that the user has received a response.  Parallel to the execution of this cycle, in the Update method (main thread) a window is opened - the dialogue, gui execution, by pressing the yes key by the user yes or no, the corresponding flags are set in the static class of the question.  The child thread goes out of the cycle, and continues the execution of the structure repair method based on the user‚Äôs response received. <br>  In order not to generate many parallel threads and to screen other possible problems, all the game buttons are blocked when the question is activated.  System buttons are not blocked, in particular because they use standard windows dialogs, which already completely block the application. <br><br>  <u>application</u> <br>  Written under win 7, requires installed XNA components, .net 4.0 framework - everything you need is downloaded automatically during the installation process. <br>  XNA components can be downloaded separately <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D27598">www.microsoft.com/en-us/download/details.aspx?id=27598</a> <br><br>  Exe: <a href="http://rusfolder.com/35736586">rusfolder.com/35736586</a> <br><br>  Setup: <a href="http://rusfolder.com/35736588">rusfolder.com/35736588</a> </div><p>Source: <a href="https://habr.com/ru/post/174349/">https://habr.com/ru/post/174349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../174331/index.html">Google I / O Easter Eggs</a></li>
<li><a href="../174335/index.html">How big corporations kill small startups</a></li>
<li><a href="../174337/index.html">Experiment: two weeks without time</a></li>
<li><a href="../174339/index.html">Vow: the fastest promises</a></li>
<li><a href="../174347/index.html">A brief introduction to boost :: program_options</a></li>
<li><a href="../174353/index.html">Bitmessage - program for P2P exchange of encrypted messages</a></li>
<li><a href="../174359/index.html">Lifeboat Foundation: How Stephen Wolfram Prepares for Singularity</a></li>
<li><a href="../174369/index.html">Common mistakes when developing lockfree-algorithms and their solutions</a></li>
<li><a href="../174373/index.html">RPG game in Excel workbook</a></li>
<li><a href="../174375/index.html">Github Visualizer - A service to visualize the history of repositories with GitHub</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>