<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operator overloading in freepascal on the example of ordinary fractions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We all remember how ordinary fractions were taught in school. Numerators, denominators, GCD and LCM, arithmetic operations with fractions. But even in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operator overloading in freepascal on the example of ordinary fractions</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/23d/1d3/d25/23d1d3d25594700c3ff1cfac82f69730.jpg" alt="image"></div><br>  We all remember how ordinary fractions were taught in school.  Numerators, denominators, GCD and LCM, arithmetic operations with fractions.  But even in real life, ordinary fractions are successfully used in various fields of activity, including legal ones: for example, ordinary fractions can express the shares of participants in economic societies, shares in the right of common share ownership, etc. <br><br>  And so, it took some time to implement a couple of functions in a corporate application for operating with ordinary fractions.  The current implementation of pascal, whether delphi or freepascal, offers convenient tools for this. <br><a name="habracut"></a><br>  The resulting module grew in the process of studying operator overloading. <br><blockquote>  <i>When the module was ready, I saw that a year ago, participants in the English-language freepascal forum developed a similar, albeit collectively, weighed down with a mass of functions and various implementations of the same.</i>  <i>Well, we will consider made by a kind of import substitution.</i> </blockquote><br>  The main data type will be the following structure: <br><br><pre><code class="delphi hljs">TFraction = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> Numerator: longint; Denumerator: longint; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ANum, ADenum: longint)</span></span></span><span class="hljs-function">:</span></span> TFraction; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toStr</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toFloat</span></span></span><span class="hljs-function">:</span></span> extended; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><blockquote>  Do not forget to include the necessary compiler directive - {$ MODESWITCH ADVANCEDRECORDS} </blockquote><br>  The structure has two fields - an integer numerator and denominator, a constructor function for assigning values ‚Äã‚Äãto one line and a couple of functions for converting a common fraction to a string and a decimal fraction. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Auxiliary functions of the module (can be used independently): <br><br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">//     procedure SetEqualDenum(var ALeftFr, ARightFr: TFraction); //   -     function ExpandFraction(AFraction: TFraction; Factor: longint): TFraction; //    function gcd(ALeftDenum, ARightDenum: longint): longint; //    function lcm(ALeftDenum, ARightDenum: longint): longint; //   -    ,  toGCD        function CollapseFraction(AFraction: TFraction; Divider: longint = toGCD): TFraction; //     function CompareFractions(ALeftFr, ARightFr: TFraction): TfrCompareResult; //   ,        function ReverseFraction(AFraction: TFraction): TFraction;</span></span></code> </pre> <br>  The main ones in the module are overloaded operators for addition, subtraction, multiplication, division, assignment and comparison of fractions: <br><pre> <code class="delphi hljs"><span class="hljs-comment"><span class="hljs-comment">//    operator +(ALeftFr, ARightFr: TFraction) r: TFraction; //     operator +(ALeftFr: TFraction; const Term: longint) r: TFraction; //   operator -(ALeftFr, ARightFr: TFraction) r: TFraction; //    operator -(ALeftFr: TFraction; const Sub: longint) r: TFraction; //    operator * (ALeftFr, ARightFr: TFraction) r: TFraction; //     operator * (AFraction: TFraction; const Multiplier: longint) r: TFraction; operator * (const Multiplier: longint; AFraction: TFraction) r: TFraction; //    operator / (ALeftFr, ARightFr: TFraction) r: TFraction; //     operator / (AFraction: TFraction; const Divider: longint) r: TFraction; //    operator = (ALeftFr, ARightFr: TFraction) r: boolean; // ,     operator &gt; (ALeftFr, ARightFr: TFraction) r: boolean; // ,     operator &lt; (ALeftFr, ARightFr: TFraction) r: boolean; //      ( = 1) operator := (const AIntegerPart: longint) r: TFraction; //    /   operator := (const AStringFr: string) r: TFraction;</span></span></code> </pre> <br><blockquote>  <i>Unfortunately, in freepascal it is impossible to transfer as an assigned value an enumeration of integers (dictionary, set, call it what you like, the meaning is that it is impossible: A: = (1,2); or so B: = [1,2] ), therefore, the initiation of a fraction goes through a constructor function or a string value, although nothing prevents you from simply setting values ‚Äã‚Äãto two fields, but I wanted to make it as simple as possible.</i> </blockquote><br><div class="spoiler">  <b class="spoiler_title">The implementation of overloaded methods, such as addition, division, assignment or comparison, looks like this:</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+(ALeftFr, ARightFr: TFraction)r: TFraction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SetEqualDenum(ALeftFr, ARightFr); r.Numerator := ALeftFr.Numerator + ARightFr.Numerator; r.Denumerator := ALeftFr.Denumerator; r := CollapseFraction(r, toGCD); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>/(ALeftFr, ARightFr: TFraction)r: TFraction; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> r := ALeftFr * ReverseFraction(ARightFr); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>:=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AStringFr: <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>)r: TFraction; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> i := PosEx(char(SolidorSym), AStringFr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> TryStrToInt(LeftStr(AStringFr, i - <span class="hljs-number"><span class="hljs-number">1</span></span>), r.Numerator) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'Numerator is not integer!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> TryStrToInt(RightStr(AStringFr, Length(AStringFr) - i), r.Denumerator) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'Denumerator is not integer!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(ALeftFr, ARightFr: TFraction)r: boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := CompareFractions(ALeftFr, ARightFr) = crEqual; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&gt;(ALeftFr, ARightFr: TFraction)r: boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := CompareFractions(ALeftFr, ARightFr) = crLeft; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>&lt;(ALeftFr, ARightFr: TFraction)r: boolean; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := CompareFractions(ALeftFr, ARightFr) = crRight; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br></div></div><br>  I repeat, in the module of ‚Äúcompetitors‚Äù there are more functions and overloaded operators, so they additionally overloaded&gt; =, &lt;=, **, and also introduced assignment through decimal fraction and conversion to a string with the issuance of the ‚Äúcorrect‚Äù fraction, the last for mathematical expressions is not need to. <br><br>  To calculate the <abbr title="the greatest common factor">GCD,</abbr> I chose the simplest recursive algorithm: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gcd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ALeftDenum, ARightDenum: longint)</span></span></span><span class="hljs-function">:</span></span> longint; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ARightDenum = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Result := abs(ALeftDenum) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Result := abs(gcd(ARightDenum, ALeftDenum <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> ARightDenum)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  GCD we need to reduce fractions and calculate the <abbr title="least common multiple">LCM</abbr> : <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lcm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ALeftDenum, ARightDenum: longint)</span></span></span><span class="hljs-function">:</span></span> longint; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := abs(ALeftDenum * ARightDenum) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> gcd(ALeftDenum, ARightDenum); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  NOC, in turn, is used to bring the fractions to a common denominator: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetEqualDenum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ALeftFr, ARightFr: TFraction)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tDenum: longint; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ALeftFr.Denumerator = ARightFr.Denumerator <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>; tDenum := lcm(ALeftFr.Denumerator, ARightFr.Denumerator); ALeftFr := ExpandFraction(ALeftFr, tDenum <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> ALeftFr.Denumerator); ARightFr := ExpandFraction(ARightFr, tDenum <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> ARightFr.Denumerator); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br>  And this function is used as a result in the overloaded addition, subtraction, and comparison operators. <br><br>  Operator overloading allows you to write such simple assignments: <br><br><pre> <code class="delphi hljs">Fr1, Fr2: TFraction; ... Fr1 := <span class="hljs-number"><span class="hljs-number">12</span></span>; <span class="hljs-comment"><span class="hljs-comment">// (  12/1) Fr2 := '3/5'; // (   ) //     Fr3 := TFraction.Create(22,7); // 22/7</span></span></code> </pre> <br>  It becomes easier to write operations with fractions and inequalities: <br><br><pre> <code class="delphi hljs">Fr3 := Fr1+ Fr2; Fr3 := Fr1 * Fr2; Fr2 := Fr1 - <span class="hljs-number"><span class="hljs-number">1</span></span>; Fr2 := Fr1 / <span class="hljs-number"><span class="hljs-number">3</span></span>; Fr3 := Fr1 / Fr2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Fr1 &gt; Fr2 ‚Ä¶</code> </pre> <br>  Combined assignment operators will also work: <br><br><pre> <code class="delphi hljs">Fr1 += Fr2; Fr2 -= <span class="hljs-number"><span class="hljs-number">1</span></span>; Fr3 *= <span class="hljs-string"><span class="hljs-string">'1/2'</span></span>;</code> </pre> <br>  Even the following expressions are allowed: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Fr1 &gt; <span class="hljs-string"><span class="hljs-string">'2/3'</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> Fr2 &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> ...</code> </pre> <br>  These inequalities compile perfectly and give the correct logical result. <br><br>  In the standard delivery of freepascal there are a couple of similar modules for working with mathematical matrices and complex numbers, you can look at their implementation as examples. <br>  In my opinion, operator overloading brings the same simplification in the cleanliness and visibility of the code, like generics (the lists from fgl are especially loved by me), of course, if you don‚Äôt overload the operator plus the division method.  The compiler will always (well, almost) stop you if you forget that the operator is overloaded or vice versa (due to data type mismatch). <br><br>  The described module is far from perfect, you need to add processing of the result in cases of getting zero for mathematical operations, dividing by zero, you can also add conversions of decimal fractions to ordinary ones and vice versa. <br><br>  ‚Üí The <a href="">full text of the module is here</a> . <br>  ‚Üí <a href="http://wiki.freepascal.org/Fractions">Module from the freepascal.org forum</a> . </div><p>Source: <a href="https://habr.com/ru/post/327450/">https://habr.com/ru/post/327450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327440/index.html">Its a web server on NodeJS, and not a single framework. Part 1</a></li>
<li><a href="../327442/index.html">Post effects in mobile games</a></li>
<li><a href="../327444/index.html">Sports data analysis, or how to become a data science specialist</a></li>
<li><a href="../327446/index.html">Your recruitment is not social: features of social networks, lifehacks and tools for HR</a></li>
<li><a href="../327448/index.html">Learning from the masters: design levels Legend Of Zelda</a></li>
<li><a href="../327452/index.html">Mobile application prototyping: from idea to desktop</a></li>
<li><a href="../327454/index.html">Everything is not so simple with Ctrl + Z: about undo in fast editing ONLYOFFICE</a></li>
<li><a href="../327456/index.html">Container lsp</a></li>
<li><a href="../327458/index.html">Revision # 1. The key to start</a></li>
<li><a href="../327460/index.html">Compare Java 8, RxJava, Reactor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>