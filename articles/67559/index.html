<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Appendix "harmonious couple." Second wind!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I already wrote about how for the social network "In Contact" by us ( charly , vandriichuk ) the application "Harmonious Couple" was created. 
 After ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Appendix "harmonious couple." Second wind!</h1><div class="post__text post__text-html js-mediator-article">  I already wrote about how for the social network "In Contact" by us ( <a href="https://geektimes.ru/users/charly/" class="user_link">charly</a> , <a href="https://geektimes.ru/users/vandriichuk/" class="user_link">vandriichuk</a> ) the application "Harmonious Couple" was created. <br>  After some time, it turned out that no one needs serious applications.  Ie, the application that is looking for a harmonious couple according to the ascendant, turned out to be unclaimed. <br><br>  As one girl said, ‚ÄúWhy do I need such a pessimistic app?  I want entertaining! ‚Äù <br><br>  Then it was decided to increase the functionality of the application.  Add some fun moments. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  What did we do? </h3><br><br>  We have added the section "Fun".  In this section, you can send an audio joke or flash card to a friend / friend (you can select all of this from the list, add your own accompanying text). <br><br>  Audio jokes and cards are comic in nature (for example, you can throw a tomato at a friend or make a declaration of love).  It's nice to get them :) <br><br>  But sending this kind of message involves sending users a notification that they have received a new audio message or card. <br><br>  <b>Here we got the first pitfall.</b> <br><br>  To send notifications, <u>Secure application interaction with API is</u> required. <br>  <i>Protected interaction of the application with the API, as opposed to the standard, takes place without client participation and is carried out between the VKontakte API and its own remote developer server.</i> <i><br><br></i>  <i>The application interacts with the VKontakte API by creating an HTTP request (POST or GET) to <a href="http://api.vkontakte.ru/api.php">api.vkontakte.ru/api.php</a> .</i> <i><br></i> <br><br>  The documentation on this issue, I think, is not sufficient.  It was necessary by trial and error, day and night to search for a solution.  Since I am a flasher, not a php progger, I had to dig a little bit in the manuals and chat with some people.  As a result, a script was written every other day (thanks to the people from the VKontakte developers club). <br><br>  I am citing the php script code that receives the users id and the message that they need to show in the notification. <br><br><blockquote><code>&lt;?php <br> <br> $uids=$_POST['notify_uids']; <br> $send_m=$_POST['notify_message']; <br> <br> $api = array(); <br> $api['api_id'] = 'ID  '; // ID  <br> $api['method'] = "secure.sendNotification"; <br> $api['random'] = mt_rand(100000,9999999); //      <br> $api['timestamp'] = time(); //  unixtime  ,            150  <br> $api['v'] = "2.0"; <br> $api['uids'] = $uids; <br> $api['message'] = $send_m; <br> <br> ksort($api); //       , ..   <br> $api_sig = " ,      "; <br> $sig_src = ''; <br> foreach($api as $api_key =&gt; $api_value) $sig_src .= ($api_key.'='.$api_value); <br> $sig_src .= $api_sig; <br> $api['sig'] = md5($sig_src); <br> <br> $finish_string=''; <br> foreach($api as $api_key =&gt; $api_value) $finish_string .= ($api_key.'='.$api_value.'&amp;'); <br> <br> $finish_string= substr($finish_string, 0, strlen($finish_string)-1); <br> <br> $api_request = 'api.vkontakte.ru/api.php?'.$finish_string; <br> <br> $url = "http://api.vkontakte.ru/api.php"; <br> $ch = curl_init(); <br> curl_setopt($ch, CURLOPT_URL,$url); // set url to post to <br> curl_setopt($ch, CURLOPT_FAILONERROR, 1); <br> curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);// allow redirects <br> curl_setopt($ch, CURLOPT_RETURNTRANSFER,1); // return into a variable <br> curl_setopt($ch, CURLOPT_TIMEOUT, 3); // times out after 4s <br> curl_setopt($ch, CURLOPT_POST, 1); // set POST method <br> curl_setopt($ch, CURLOPT_POSTFIELDS, $finish_string); // add POST fields <br> $result = curl_exec($ch); // run the whole process <br> curl_close($ch); <br> echo $result; <br> <br> ?&gt; <br> <br></code> <br></blockquote><br><br>  In addition to the section with jokes some more goodies were added. <br>  The characteristic of the ascendant was extended (added sections of life, car, food, relationships, career, etc.). <br>  Some moments of the application have been completely redone. <br><br>  And as a result, a few days after the completion of all work on the application, users began to add it to themselves and use it directly. <br><br>  The number of unique views increased by 3 times (from a modest 70 unique per day to a modest 210). <br><br>  Although it is not very much, but still nice!  There is an incentive to work on. <br><br><h3>  A little bit about earnings </h3><br>  You can earn on your application!  But for this it must be popular. <br>  Voices are being earned (currency in vkontakte), which are displayed through payment systems or sold on the black market. <br><br>  There are two main ways to earn votes: <br><ul><li>  sell virtual things / services within the application for the voices of users. </li><li>  show targeted advertising from vKontakte. </li></ul><br><br>  Here with the targeted advertising there was a <b>second pitfall</b> . <br><br>  Unbeknownst to all, the administration of VKontakte removed the advertisement that was displayed on the left below the menu on the application pages.  If earlier it was necessary to simply allow in the settings to show ads on the page of your own application, now you need to send a request to the API inside the application to get such advertising.  The method used is not described in the VK API Documentation. <br><br>  <i>They speak about him only in the developers club.</i> <i><br></i>  <i>Ie, if you are a novice and have not made a single application, then you will never know about it.</i> <br><br><blockquote>  <i>We are starting to test the new getAds method.</i> <i><br></i>  <i>With it, you can receive up to 10 targeted advertising modules aimed at the current user.</i> <i><br></i>  <i>The method has a single count parameter that can be used to limit the number of ads returned.</i>  <i>By default, this parameter is 10.</i> <i><br><br></i>  <i>Starting July 20, all applications that have third-party advertising will be forced to switch to using targeted VK ads.</i> <br></blockquote><br><br>  The advertising module consists of several fields: <br>  title <br>  descrition <br>  photo <br>  link <br><br>  And the link will not work if it is not processed in this way: <br><br><blockquote> <code>link = String(xml.link).split('&amp;').join('&amp;');</code> <br> </blockquote><br><br>  A line of code finds the html &amp; symbol and changes it to &amp;. <br><br><h3>  Conclusion </h3><br>  I hope this post was interesting for you.  I tried to reveal a few points that are hard to find on the Internet. <br><br>  Finally, I want to wish you to find your Harmonious couple!  And do not talk about your friends.  They also want to get funny :) </div><p>Source: <a href="https://habr.com/ru/post/67559/">https://habr.com/ru/post/67559/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../67551/index.html">To-do lists</a></li>
<li><a href="../67554/index.html">Project on enthusiasm, part 2: Realities</a></li>
<li><a href="../67555/index.html">Canon G11: less megapixels</a></li>
<li><a href="../67557/index.html">Installation for dummies: nginx + php-cgi + mysql + eaccelerator + memcache on Debian 5.0 "lenny"</a></li>
<li><a href="../67558/index.html">UUID and / dev / disk / by-id rush to the rescue</a></li>
<li><a href="../67560/index.html">Flickr galleries</a></li>
<li><a href="../67563/index.html">Leechcraft 0.3.0</a></li>
<li><a href="../67564/index.html">Watch James Bond</a></li>
<li><a href="../67565/index.html">Chinese office # 2</a></li>
<li><a href="../67567/index.html">Interestingly, IE interprets the source code.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>