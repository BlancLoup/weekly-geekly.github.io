<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DBMS Cach√©. Woodworking - SQL access to multidimensional data structures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúCach√© gives programmers the freedom to choose how to store and access data through SQL objects, or through direct access to multidimensional data str...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DBMS Cach√©. Woodworking - SQL access to multidimensional data structures</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/334/798/b16/334798b16e98d44653ef5a4324b7629e.jpg" align="left">  ‚ÄúCach√© gives programmers the freedom to choose how to store and access data through SQL objects, or through direct access to multidimensional data structures.  Regardless of the access method, all data in Cach√© databases is stored in multidimensional arrays. " <br>  <a href="http://intersystems.ru/cache/technology/techguide/cache_tech-guide_02.html">Cach√© Technology Handbook</a> <br><br>  ‚ÄúGlobals (global stored variables) are an abstraction of B-tree structures used in MUMPS for storing large amounts of data.‚Äù <br>  <a href="http://www.mgateway.com/docs/universalNoSQL.pdf">A Universal NoSQL Engine, Using a Tried and Tested Technology</a> <br><br>  The article presents a couple of examples of creating SQL projections on various global structures. <br><a name="habracut"></a><br>  For new stored classes, Cach√© automatically uses the standard storage method, <a href="">CacheStorage</a> .  When might you need to create your own storage methods (CacheSQLStorage or CustomStorage)? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  When upgrading <a href="http://ru.wikipedia.org/wiki/MUMPS">MUMPS</a> (or switching from <a href="http://globalsdb.org/">GlobalsDB</a> ) applications built on globals.  The global is often used as a non-formalized (dynamic) structure, the meaning of the nodes of which is determined by the agreement of the developers.  Why not formalize these conventions (create a class description), connect a version control system for them and use all the advantages of OOP development? </li><li>  For a number of special tasks: classes with a large number of properties, their own projection classes on system globals. </li></ul><br><h4>  Some theory </h4><br><ul><li>  <b>CacheStorage</b> - used by Cach√© when compiling new stored classes.  Methods for working through SQL and objects are generated by the system. </li><li>  <b>CacheSQLStorage</b> - used to work with existing globals via SQL.  Created by a programmer.  In the object data access methods (% SaveData,% LoadData,% DeleteData), SQL is used, respectively, triggers are triggered.  It is necessary to customize the SQL projection. </li><li>  <b>CustomStorage</b> - used to implement its own complex object access logic.  Created by a programmer.  You must independently implement the% SaveData,% LoadData,% DeleteData methods.  You can customize the SQL projection. </li></ul><br>  For the CacheSQLStorage (or CustomStorage) storage scheme, a SQL projection (SQL storage map) is configured.  The projection contains the necessary information for the compiler about the globals used, their keys (subscripts), the rules for passing through the keys and the location of the data.  Based on this information, the compiler generates the necessary data access methods. <br><br><h4>  More practice </h4><br>  Let us take a look at a simple example from the article <a href="http://www.mgateway.com/docs/universalNoSQL.pdf">A Universal NoSQL Engine</a> .  The telephone directory uses two global <i>^ telephone</i> - to store data and <i>^ nameIndex</i> - to store the index by phone number owner. <br><img src="https://habrastorage.org/storage2/d1c/1c5/435/d1c1c543513e7a6814346c276715b94d.png"><br>  An important point in creating an SQL projection is to establish the correspondence between the keys of the data global and the object identifier.  In our case, this is the phone number - the first key <i>^ telephone</i> . <br><ul><li>  Create a new stored class data.phones (phone book), add the properties <i>name</i> , <i>number</i> , <i>address</i> and index by the property <i>number</i> with type <i>IdKey</i> . </li><li>  Add to the class the method of storing CacheSQLStorage with the name sql.  Create a projection map to the data in the global <i>telephone</i> with the name data.  We will begin to fill the map with the definition of global keys.  We add the first key, we specify that the number property is stored in this key </li><li>  We proceed to the description of the location of property values.  Add a projection to the <i>address</i> property.  We indicate that the values ‚Äã‚Äãare stored in the node with the additional (second) key <i>"address"</i> .  By default, the system assumes the storage of properties in a delimited string.  In our case, this is not the case.  Therefore, we remove the separator and the position number.  We act in a similar way for the <i>name</i> property - the value is stored in the additional key <i>‚Äúname‚Äù</i> .  Remove the separator and position number.  Compile the class.  Check the work of the projection - execute the Select query. </li><li>  Add a projection on the index global.  Create an index by the <i>name</i> property.  Add a map (with type index) on <i>^ nameIndex</i> .  Add a description of the keys - the first key is the <i>name</i> property, the second key is the property <i>number</i> .  Compile the class.  We look at the plan of the request for sampling from the telephone directory with filtering by the <i>name</i> field. </li></ul><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/KUC9pDwDec4%3Ffeature%3Doembed&amp;xid=17259,15700002,15700021,15700186,15700191,15700253&amp;usg=ALkJrhj3pAIKIRi8A8okyP70cok9HmgFRQ" frameborder="0" allowfullscreen=""></iframe><br>  After setting up the storage, execute insert, update, delete requests to the <i>data.phones</i> class.  Try using object access to class instances (% New,% Save,% DeleteId).  Pay attention to the contents of the global after operations. <br><br>  Consider a more complex example typical of legacy applications.  At the entrance of the global view: <br><blockquote>  ^ dish (3) = "CASH" <br>  ^ dish (3.315) = ‚ÄúViscous rice porridge * 200 * 178.2 * 3.1 * 4.4 * 33.7 ** gr * 780‚Äù <br>  ^ dish (3.315.2) = "Water * 161 * 161" <br>  ^ dish (3,315,36) = "Rice groats * 43.6 * 43.6" <br>  ^ dish (3,315,50) = "Butter * 5 * 5" <br>  ^ dish (3.316) = ‚ÄúViscous pearl barley porridge * 200 * 178.7 * 4.1 * 4.6 * 32.1 ** then * 4744‚Äù <br>  ^ dish (3.316.2) = "Water * 161 * 161" <br>  ^ dish (3,316,34) = "Pearl barley * 43.6 * 43.6" <br>  ^ dish (3,316,50) = ‚ÄúButter * 5 * 5‚Äù <br>  ^ dish (3.317) = ‚ÄúViscous oatmeal porridge * 200 * 206.5 * 5.8 * 6.9 * 32 ** then * 6282‚Äù <br>  ^ dish (3,317,2) = "Water * 157 * 157" <br>  ^ dish (3,317,33) = "Oatmeal * 49.0 * 49.0" <br>  ^ dish (3,317,50) = ‚ÄúButter * 5 * 5‚Äù <br>  ^ dish (3,318) = "Oatmeal viscous porridge * 200 * 192.2 * 5.7 * 6.8 * 28.6 ** then * 2436" <br>  ^ dish (3.318.2) = "Water * 161 * 160" <br>  ^ dish (3,318,3) = "Hercules * 43.6 * 43.6" <br>  ^ dish (3,318,50) = ‚ÄúButter * 5 * 5‚Äù <br></blockquote><br>  Objects of several classes are stored in one global: <i>dish.kind</i> - dish type, <i>dish.dish</i> - dish, <i>dish.product</i> - dish product.  Moreover, the global structure determines the type of relationship between these classes - <a href="">parent-child</a> . <br><img src="https://habrastorage.org/storage2/2ab/542/1f2/2ab5421f2f521f831a0ca35caea32188.png"><br><br>  A feature of the projection setting for the <i>dish.dish</i> and <i>dish.product classes</i> is the syntax for describing global keys <br><img src="https://habrastorage.org/storage2/087/0c5/0dd/0870c50ddc92ed888f6233139ed434b2.png"><br>  Instead of the name of the property, the name of the parent of the class is indicated, and after the dot, the name of its property ‚Äî the identifier. <br>  Accelerated projection creation process: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/-lqto0LT6U4%3Ffeature%3Doembed&amp;xid=17259,15700002,15700021,15700186,15700191,15700253&amp;usg=ALkJrhgXiRhZKgaO1swYqLanO_OP2J6DaA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Tips and secrets. </h4><br>  The configured projection is stored by Cache in instances of classes: <br><ul><li>  <a href="">% Dictionary.StorageDefinition</a> - storage definition </li><li>  <a href="">% Dictionary.StorageSQLMapDefinition</a> - definition of data cards and indexes that make up the SQL projection </li><li>  <a href="">% Dictionary.StorageSQLMapSubDefinition</a> - global keys, order and rules for passing through them </li><li>  <a href="">% Dictionary.StorageSQLMapDataDefinition</a> - Property Location </li><li>  <a href="">% Dictionary.StorageSQLMapRowIdSpecDefinition</a> - to indicate the correspondence between an object identifier and a row identifier.  Specify to the compiler which keys are included in the string identifier. </li></ul><br>  Accordingly, storage can be created programmatically.  For example, make <a href="">your own</a> storage creation <a href="">wizard</a> .  In Studio, the configured storage method is displayed as xml (in Cache 2013.1 automatically, and in earlier versions through the menu: <i>View - Show Storage</i> ). <br><br>  For each stored class, Cach√© creates an Extent request and generates programs for its execution.  The generated class code can help in setting up or debugging the projection (see labels zExtentExecute, zExtentFetch). <br><br>  Interesting examples of projections can be found in the Cach√© system classes.  For example, the above storage scheme classes are a projection on the global. <br><br>  For more information on setting up projections, please read the <a href="">lecture by</a> Vadim Fedorov from the Intersystems School of Innovation. </div><p>Source: <a href="https://habr.com/ru/post/179523/">https://habr.com/ru/post/179523/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179495/index.html">Three professional deformation IT specialists</a></li>
<li><a href="../179497/index.html">Build target platform. Equinox for developer</a></li>
<li><a href="../179499/index.html">How stable is your job and what's in that backpack?</a></li>
<li><a href="../179505/index.html">DevConf 2013 Prepared for Special Day - Active Voting for Reports</a></li>
<li><a href="../179507/index.html">A new version of Yandex Browser has been released: with synchronization and Board API</a></li>
<li><a href="../179525/index.html">Solving the border-radius + overflow: hidden problem with canvas</a></li>
<li><a href="../179529/index.html">We write the simplest scripting programming language in C # (Part 1)</a></li>
<li><a href="../179531/index.html">How I chose Android for testing</a></li>
<li><a href="../179533/index.html">Improving 3d printing quality with cooling</a></li>
<li><a href="../179535/index.html">Million PPS per second - connectedness and balancing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>