<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fenom - yet another PHP template engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. The first stable version of the new Fenom template engine has been released. For the impatient, Fenom is a lightweight (statistics attached)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fenom - yet another PHP template engine</h1><div class="post__text post__text-html js-mediator-article">  Good day.  The first stable version of the new <a href="https://github.com/bzick/fenom">Fenom</a> template engine has been released.  For the impatient, <b>Fenom</b> is a lightweight (statistics attached), fast (benchmark attached), flexible (API attached) template engine, which can be a good substitute for Twig or Smarty template engines. <br><a name="habracut"></a><br><br>  The <b>Fenom</b> template engine is a vivid example of how the question ‚Äúinteresting, and what is the <a href="http://php.net/manual/en/book.tokenizer.php">tokenizer</a> extension <a href="http://php.net/manual/en/book.tokenizer.php">capable of</a> ?‚Äù Could lead to something more than a couple of scripts in the sandbox.  Like many projects, the template engine started just-for-fun and was created in one evening.  The first version of the template engine occupied only 900 lines of code that parsed primitive templates.  To maintain extensibility, we had to add another 2500 lines of code to the template code. <br><br>  If anyone is interested, I can tell you in a separate article all the interesting points and nuances that I had to face when creating a template. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Ideology </h2><br><br>  When it became clear that the experiment went beyond the usual sandbox game, there was a desire to bring it to a full-fledged OpenSource project that could be used in highload projects and compete with popular PHP template engines.  Templating in highload projects is a very complex topic.  When you have to deal with hundreds of thousands of user-space templates, all template engines begin to have their own ‚Äúcockroaches‚Äù.  By the time Fenom was created, I managed to work with PHP templates such as Smarty2, Smarty3, Quicky, Twig, Latte.  My experience with them helped me understand what the ‚Äúmy dream‚Äù template should be :) <br>  When developing a template engine, I tried to adhere to the following requirements: <br><ul><li>  <b>Maximum flexibility.</b>  The flexibility of the template engine should be sufficient to add any functionality or the ability to change the behavior of the template engine if necessary.  This is dictated by the fact that the author of the template engine may not be aware of all the requirements for template matching, and therefore must enable the expansion of the template engine. </li><li>  <b>Trust but check.</b>  Safety of the template engine should include not only protection against various injections, but also protection against the incorrect use of various templates of the template engine itself, which can lead to PHP errors when executing the template code.  This is especially true when regular users have access to templates. </li><li>  <b>The faster the better.</b>  Performance should be comparable to the speed of generating a template written in pure PHP code.  And under certain conditions, the template engine should win on speed templates in pure PHP. <br>  I suppose, in order to avoid unnecessary holivars, this point needs to be clarified: If we give the task to the developer to implement some view in pure PHP, the implementation will most likely be through OOP, not to mention duplicating the code.  The template engine is devoid of all prejudices and easily creates sheets of valid code optimized for fast execution.  An excellent example is the template inheritance algorithm. </li><li>  <b>Keep it simple and people will reach out to you.</b>  The template engine, like any other project, should be based on the <a href="http://ru.wikipedia.org/wiki/KISS_(%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BD%25D1%2586%25D0%25B8%25D0%25BF)">KISS</a> principle.  The code is as compact and clear as possible, OOP without fanaticism, everywhere traceable logic.  This is very important for any project, since the more code in a project, the harder it is to maintain, debug, test and involve third-party developers in such a project.  This is one of the reasons why regular expressions are not used at all in Fenom to parse templates. </li><li>  <b>An old friend is better than two new ones.</b>  It is better to adopt the generally accepted simple syntax of existing template engines than to implement a new one.  In Fenom, the Smarty-like syntax of templates is taken as the basis, since there is only one type of tag framed in braces and this syntax is easier to convert to tokens. </li><li>  <b>Do not eat a lot.</b>  Fenom algorithms are trying to save the resources of the machine to the maximum - both the CPU and RAM.  The template engine tries to make all the complex calculations at the template compilation stage so that the execution is as fast as possible and not resource-intensive.  As a consequence, the template engine has the ability to stream data (display and export methods) without accumulating in memory. </li><li>  <b>Do not swine.</b>  Fenom templates are objects that will free up memory if there are no references to them, while Twig has classes, Smarty are functions that you can‚Äôt remove from memory, which can add difficulty when processing a large number of templates.  In addition, the final PHP code of the template should not be large, since the larger the template, the more op-code, the less memory in op-caches. </li></ul><br><br><h2>  Performance </h2><br><br>  I borrowed a set of tests from a friend of <a href="https://habrahabr.ru/users/veg/" class="user_link">VEG</a> from the article <a href="http://habrahabr.ru/post/128083/">Smarty vs.</a>  <a href="http://habrahabr.ru/post/128083/">Twig: A performance</a> where Twig performed well.  Not a little time has passed since then, so I decided to repeat, the tests cited in the article, with an additional rival - Fenom.  Characters: Smarty version 3.1.13, Twig version 1.13.0 + extension twig.so, Fenom version 1.0.3.  I really wanted to test the Volt from the Phalcon native framework, but, alas, at the first test it went into an endless loop, so it had to be disqualified. <br><br>  Each test was run in 3 different modes: <br><ul><li>  <b>Cold start</b> - the template is not compiled and, therefore, not loaded into the template engine.  A very rare case when the template runs for the first time.  However, if a cache flush occurred, a surge in template compilations could ruin the system.  The rate of compilation, loading and execution patterns. </li><li>  <b>Regular launch</b> - the template is already compiled to the file system, but not loaded into the template engine.  Quite a frequent case when the template has already been run before, so it already has its own compilation cache on the file system.  The indicator is relevant if the template is used only once per script execution.  The value characterizes the speed of loading and execution of templates. </li><li>  <b>Hot start</b> - the template is compiled and even already loaded into the template engine.  Means that the template is used more than 1 time per script call.  The rate of performance of the template. </li></ul><br><br>  Tests were performed at 2.6 GHz Intel Core i7, 8 GB 1600 MHz DDR3, MacOS 10.8.4, PHP 5.4.15 from under the CLI.  Ubuntu 12.04 also showed a ratio in the results.  PHP was run with the -n flag, which disables all external extensions.  With twig.so tested separately.  The result was taken from the second test run, when the OS has already <a href="http://ru.wikipedia.org/wiki/Mmap">cached</a> test files and templating engines.  Op-keshery, of course, disabled as all other extensions. <br><br>  So, the first test is the output of a large number of variables.  In fact, this test makes sense since all patterns consist of outputting variables to a pattern. <br>  <b>The output of a large number of variables:</b> <br><table><tbody><tr><th>  Template engines </th><th>  Cold start </th><th>  Regular launch </th><th>  Hot start </th></tr><tr><td>  Smarty3 </td><td>  4.3394 sec, 15.2 MiB </td><td>  0.0239 sec, 9.2 MiB </td><td>  0.0015 sec, 9.2 MiB </td></tr><tr><td>  Twig </td><td>  1.9618 sec, 68.9 MiB </td><td>  0.0341 sec, 17.0 MiB </td><td>  0.0013 sec, 17.0 MiB </td></tr><tr><td>  Fenom </td><td>  0.3432 sec, 8.9 MiB </td><td>  0.0157 sec, 6.6 MiB </td><td>  0.0011 sec, 6.6 MiB </td></tr></tbody></table><br>  In the first test, Twig allocated itself - tests dropped due to exceeding the memory limit (by default, 32MB). <br><br>  The second test is an iteration of a large array, which is also a frequent case in templates. <br>  <b>Iteration of a large array:</b> <br><table><tbody><tr><th>  Template engines </th><th>  Cold start </th><th>  Regular launch </th><th>  Hot start </th></tr><tr><td>  Smarty3 </td><td>  0.0223 sec, 5.8 MiB </td><td>  0.0036 sec, 3.1 MiB </td><td>  0.0024 sec, 3.1 MiB </td></tr><tr><td>  Twig </td><td>  0.0300 sec, 4.0 MiB </td><td>  0.0174 sec, 2.7 MiB </td><td>  0.0166 sec, 2.7 MiB </td></tr><tr><td>  Twig + extension </td><td>  0.0225 sec, 4.7 MiB </td><td>  0.0064 sec, 3.2 MiB </td><td>  0.0060 sec, 3.5 MiB </td></tr><tr><td>  Fenom </td><td>  0.0080 sec, 3.1 MiB </td><td>  0.0022 sec, 2.5 MiB </td><td>  0.0017 sec, 2.5 MiB </td></tr></tbody></table><br><br>  The third test is the inheritance of a large number of patterns.  I consider this test more contrived because more than 2-3 levels of inheritance are enough for the eyes, nevertheless, 100 level inheritance remains in the test.  In spite of all artificiality, the test gives a general idea about the performance of template inheritance. <br>  <b>Inheritance of a large number of patterns:</b> <br><br><table><tbody><tr><th>  Template engines </th><th>  Cold start </th><th>  Regular launch </th><th>  Hot start </th></tr><tr><td>  Smarty3 </td><td>  0.4165 sec, 10.1 MiB </td><td>  0.0008 sec, 3.1 MiB </td><td>  0.0001 sec, 3.1 MiB </td></tr><tr><td>  Twig </td><td>  0.3626 sec, 11.2 MiB </td><td>  0.0252 sec, 6.5 MiB </td><td>  0.0021 sec, 6.5 MiB </td></tr><tr><td>  Fenom </td><td>  0.0569 sec, 3.2 MiB </td><td>  0.0005 sec, 2.5 MiB </td><td>  0.0000 sec, 2.5 MiB </td></tr></tbody></table><br>  Twig stood out here, the test fell due to exceeding the allowable nesting, in this case recursion.  An error was thrown by the xDebug extension, which later turned off for tests. <br><br>  <b>Total</b> <br>  The obvious winner was the Fenom, which was largely ahead of Smarty and Twig in terms of both speed and resource saving.  In second place is Smarty, Twig gets bronze. <br><br><h2>  What is under the hood? </h2><br>  Below is a table of the fat content of the code: <br><table><tbody><tr><th>  Template engine </th><th>  Number of files </th><th>  Number of classes </th><th>  Number of lines of code </th></tr><tr><td>  Smarty (3.1.13) </td><td>  320 </td><td>  190 </td><td>  55095 </td></tr><tr><td>  Twig (1.13.0) </td><td>  162 </td><td>  131 </td><td>  13908 </td></tr><tr><td>  Fenom (1.0.4) </td><td>  9 </td><td>  13 </td><td>  3967 </td></tr></tbody></table><br><br>  I will note that: <br><ul><li>  Smarty uses the <a href="http://www.gnu.org/software/bison/">BISON</a> parser generator, which has spawned a cloud of methods.  Well, in terms of performance, he showed himself not badly.  However, the resulting code is not pretty neat. </li><li>  Twig <a href="https://github.com/fabpot/Twig/blob/master/lib/Twig/Lexer.php">sits</a> tight <a href="https://github.com/fabpot/Twig/blob/master/lib/Twig/Lexer.php">on regular</a> expressions, but I <a href="https://github.com/kakserpom/quicky/blob/master/Quicky_compiler.class.php">'ve seen</a> <a href="https://github.com/kakserpom/quicky/blob/master/Quicky_compiler.class.php">worse</a> .  The code is pleasant, readable, but, you can consider me <a href="http://habrahabr.ru/post/153225/">Marcus</a> , it is full of entities. </li><li>  Fenom makes full use of the basic <a href="http://php.net/manual/en/book.tokenizer.php">tokenizer</a> extension (which is also built using BISON). </li></ul><br><br><h2>  Where to get? </h2><br>
: <a href="https://github.com/bzick/fenom">github.com/bzick/fenom</a><br>
Packagist.org: <a href="https://packagist.org/packages/bzick/fenom">packagist.org/packages/bzick/fenom</a><br>
Composer: <code>"fenom/fenom": "1.*"</code><br>
: <a href="">github.com/bzick/fenom/blob/master/docs/readme.md</a><br>
 : <a href="https://github.com/bzick/fenom/issues">github.com/bzick/fenom/issues</a><br>
<br>
<h2> ?</h2><br>
<br>
   Fenom      <a href=""></a>.      <i>{parent}</i>   ,   <i>in</i>  <i>is</i>,          .      .<br>
<br>
<b>P.S.</b><br>
           ,       ;)<br>
<b>P.P.S.</b><br>
     ,    raw .    1.0.7          .</div><p>Source: <a href="https://habr.com/ru/post/169525/">https://habr.com/ru/post/169525/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169511/index.html">What is the H-REAP / FlexConnect mode for Cisco wireless access points?</a></li>
<li><a href="../169513/index.html">PostgreSQL on different fs (ext3, ext4, xfs)</a></li>
<li><a href="../169519/index.html">DICOM - What kind of medicine seal is needed?</a></li>
<li><a href="../169521/index.html">Improving the quality of the code with the help of automatic utilities</a></li>
<li><a href="../169523/index.html">The source code for the Opera browser's Presto engine is likely to be open</a></li>
<li><a href="../169527/index.html">Again on the protection of personal data or preparing to check Roskomnadzor</a></li>
<li><a href="../169529/index.html">ASP.NET and client code compression</a></li>
<li><a href="../169533/index.html">Soap phone - sending notes from the phone to the "soap"</a></li>
<li><a href="../169535/index.html">Sports: If you do ...</a></li>
<li><a href="../169537/index.html">HOWTO: One of the possible implementation of the Model (MVC) in the Zend Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>