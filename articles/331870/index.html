<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cobian Backup and sending messages to Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think there are very few system administrators who do not backup any data. This note will be useful (I hope) for those who use such software as Cobi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cobian Backup and sending messages to Telegram</h1><div class="post__text post__text-html js-mediator-article"><p>  I think there are very few system administrators who do not backup any data.  This note will be useful (I hope) for those who use such software as <strong>Cobian Backup</strong> .  And especially for those who do not have backup in one place, or even in different cities. </p><br><p>  As you already understood from the title, I want to share with you a small script that allows you to send <strong>something</strong> (in my case, a piece of the log file) to the telegram. </p><br><p>  For those who are wondering why it is Telegram, because Cobian Backup can send messages to the post office - I will explain my point of view.  Telegram is a popular developing messenger that uses a huge number of people.  In my subjective opinion, this is more convenient than an email client.  Also, this method was tested on ooooochen bad internet - everything works.  And sending by email in the same conditions did not work. </p><a name="habracut"></a><br><h3 id="skript-dlya-otpravki-soobscheniy-v-telegram">  Script for sending messages to Telegram </h3><br><p>  Logic for myself, I built the following.  When performing a task in Cobian Backup, in the last but one line of the log file we have about the following text: "2017-05-31 12:11 Copy completed. Errors: 0, processed files: 3893, copied files: 3893, total size: 2.43 GB ".  So I somehow need to pull this penultimate line from the log file.  Well, actually what I did - below. </p><br><p>  To send messages we will use PowerShell.  I borrowed the script myself <a href="https://groosha.gitbooks.io/telegram-bot-lessons/content/telegram_powershell.html"><strong>here</strong></a> , but modified it a little bit. </p><br><pre><code class="hljs mel">$chat_id = <span class="hljs-string"><span class="hljs-string">'chat_id'</span></span> #  id ,     .     ,   . $date=get-<span class="hljs-keyword"><span class="hljs-keyword">date</span></span> -uformat <span class="hljs-string"><span class="hljs-string">"%Y-%m-%d"</span></span> #      $text = get-content -Path (<span class="hljs-string"><span class="hljs-string">'c:\Program Files (x86)\Cobian Backup 11\Logs\log '</span></span>+$date+<span class="hljs-string"><span class="hljs-string">'.txt'</span></span>) -Encoding UTF8 # ,    cobian backup $token = <span class="hljs-string"><span class="hljs-string">'token'</span></span> # ,      [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>]$text=$text[$text.count<span class="hljs-number"><span class="hljs-number">-2</span></span>] #   #     $payload = @{ <span class="hljs-string"><span class="hljs-string">"chat_id"</span></span> = $chat_id; <span class="hljs-string"><span class="hljs-string">"text"</span></span> = <span class="hljs-string"><span class="hljs-string">"$text"</span></span>; <span class="hljs-string"><span class="hljs-string">"parse_mode"</span></span> = <span class="hljs-string"><span class="hljs-string">'HTML'</span></span>; } Invoke-WebRequest <span class="hljs-string"><span class="hljs-string">` -Uri ("https://api.telegram.org/bot{0}/sendMessage" -f $token) `</span></span> -Method Post <span class="hljs-string"><span class="hljs-string">` -ContentType "application/json;charset=utf-8" `</span></span> -Body (ConvertTo-Json -Compress -InputObject $payload)</code> </pre> <br><h3 id="nastroyka-cobian-backup">  Cobian Backup Setup </h3><br><p>  For those who use Cobian Backup as a backup utility, I think you shouldn‚Äôt describe how tasks are created.  For those who are just going to - I think after installation you don‚Äôt even need to look for something on the Internet - everything is very simple and accessible.  True, there is one BUT - Cobian Backup does not know how to execute PowerShell scripts.  Well, it does not matter - but he knows what BAT is.  To run use the following BATnik </p><br><pre> <code class="dos hljs">TIMEOUT /T <span class="hljs-number"><span class="hljs-number">5</span></span> /NOBREAK <span class="hljs-variable"><span class="hljs-variable">%SystemRoot%</span></span>\System32\WindowsPowerShell\v1.<span class="hljs-number"><span class="hljs-number">0</span></span>\PowerShell.exe -ExecutionPolicy ByPass -command "C:\ToTelegram.ps1"</code> </pre> <br><p>  ToTelegram.ps1 is a script that we previously created in PowerShell.  After creating the bat file, you can already add its execution to the task.  In the task parameters, pop up the menu item "Additional actions" and add our BAT file to the final actions. </p><br><p>  That's basically all, as you can see nothing complicated.  I hope for someone it will be useful. </p><br><p>  PS This script satisfies my needs, but I will be very happy if someone makes their suggestions and comments. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/331870/">https://habr.com/ru/post/331870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331860/index.html">WannaCry and Petya - how does the center for monitoring and response to cyber attacks in case of global incidents work?</a></li>
<li><a href="../331862/index.html">Secure USB flash drive. Myth or Reality</a></li>
<li><a href="../331864/index.html">Sizes of raster images: pixels, DPI, PPI, centimeters - you do not confuse anything?</a></li>
<li><a href="../331866/index.html">Using Pinba in Badoo: what you don't know yet</a></li>
<li><a href="../331868/index.html">IBM Bluemix in universities: examples of implemented projects from students and teachers</a></li>
<li><a href="../331872/index.html">CoreDNS - DNS server for the cloud native world and Service Discovery for Kubernetes</a></li>
<li><a href="../331874/index.html">How to create a successful loyalty program: approaches, technology and statistics</a></li>
<li><a href="../331878/index.html">AGAIN UPDATED: Technical details of the new global attack Trojan.Encoder.12544 (in various sources - Petya, etc.)</a></li>
<li><a href="../331880/index.html">[Peter] Meeting JUG.ru with the parallel programming legend Maurice Herlihy - Transactional Memory and Beyond</a></li>
<li><a href="../331882/index.html">How to confuse the analyst. Part one</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>