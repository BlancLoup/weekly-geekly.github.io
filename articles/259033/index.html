<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Through the hardships of PC development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the eve of Computex 2015, our company has published an article about a new, even more powerful mini-computer . But was it so easy for us, the devel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Through the hardships of PC development</h1><div class="post__text post__text-html js-mediator-article">  On the eve of Computex 2015, our company <a href="http://geektimes.ru/company/ctcom/blog/251138/">has published an article about a new, even more powerful mini-computer</a> .  But was it so easy for us, the developers of this product?  How many sleepless nights did the engineers cost this development, how many problems did they have to solve and did the pitfalls get around?  In this article we would like to talk about the very beginning of this journey, it was 2009, ‚Äúwe survived as we could.‚Äù  I think, dear reader, it will be interesting for you to read what rakes and with what force we were naughty during the creation of the first board. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/860/1e3/d47/8601e3d4768f46a6b394d642c3a94064.jpg"></div><br><a name="habracut"></a><h2>  <font color="#3969b8">A bit of history</font> </h2><br>  In early 2009, the company's management decides to create, or rather, to revive the direction of the development of computer technology.  The company's history is quite long; we can only mention that in the 80s the company participated in the development of the Irisha PC.  And so, in 2009, the official Taiwan branch of Communication Technology begins a dialogue with Intel and its official distributor in Taiwan.  As a result, we receive documents on the Intel PineTrail-M TigerHill platform - this is a duet of the Intel Atom processor N400 / D500 series and the NM10 chipset.  To debug the first version of our board, it was decided to dissolve it in the COM Express form factor.  This is a 95x95 mm mezzanine module, with a long multi-pin connector.  And so that you understand the severity of the situation, the module's circuitry and wiring were made not in some new-fashioned Cadence or Altium, but in the old tube PCAD 2006. <br><br>  The photo is already the second revision of this module: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/8bf/090/98f/8bf09098f1b949ffaaa7bd80ab541df8.jpg"><br><br><h2>  <font color="#3969b8">The patient is rather alive ...</font> </h2><br>  Just imagine.  Soldered 5 modules.  Lie down on my desk.  It is urgent to run.  I am in Taiwan, my boss in Moscow.  Documents from Intel - reference diagram, guide for the razvodchika and a couple of datasheets per chipset and processor.  Anything more there is nothing. <br><br>  I want to tell you that my immediate supervisor is Anatoly Viktorovich Sorokin, an excellent and experienced engineer who changed the circuitry for compatibility with COM Express and removed from it the so-called EC - Embedded Controller.  This microcircuit is responsible for starting and controlling power supplies, controlling fans, etc.  things.  Accordingly, the power supply chain has become trivially simple, the power supply just went up one after the other and in the end the common so-called POWER_GOOD was raised, telling the chipset that all the power was ready.  In principle, this EC is absolutely not needed on this module, it can be installed on the motherboard, or it may not be installed, it does not play a noticeable role. <br><br>  The board on the table, the passive board (motherboard) is also ours, simple as a detector receiver.  Two power supplies - + 5B for peripherals and + 12V for the COM Express module, the launch of which is controlled by a small microcontroller.  The same microcontroller polls the state of the On button, some necessary signals from the chipset are also monitored.  It is now I know how this kitchen works, and then it was NOTHING UNDERSTANDING. <br><br>  Okay, we supply power from a laboratory source, press the power button, the microcontroller raises + 5V and + 12V, pulls the PWRBTN # signal for 100 ms and waits a second from the chipset to raise the SUS_S5 # signal.  While he was waiting for this second, one of the tantalum capacitors flew up into the air, mixing the polarity during soldering.  Well, solder and check the rest.  A couple had to be soldered. <br><br>  Run again.  SUS_S5 # is in the unit, nothing happens, the current consumption is small, it means power.  I note that the launch of the power supply is generally the very first step of launching any board, but for such complex clever platforms there are 10-15 separate DC / DC converters that must be run in strict sequence, and some even with delays.  In our case, the first step is to convert + 12V to two main power supplies + V5A, + V3.3A.  A - this is the main power, which should be started by the iron on the power button, it feeds the chipset. <br><br>  Yeah, these stuffs are there.  PWRBTN # to the chipset comes.  The next step is the RSMRST # signal - Resume Reset.  We look where it comes from, it comes with a DC / DC converter + V5A / + V3.3A signal POWER_GOOD.  It does not rise, infection, aha, since the power is present, it means that it must be pulled.  We pull in, RSMRST # rises, after that SLP_S5 #, SLP_S4 # and SLP_S3 # take turns in turn from the chipset.  These are so-called slipy, the chipset tells the platform - I entered the S4 state, cut in peripheral power (HDD, USB, memory, etc.), I entered the S3 state - cut in S power for everything else.  The sequence is approximately the same - SLP_S4 # -&gt; + V5, + V3.3, + V1.8 for powering DDR.  SLP_S3 # -&gt; + V5S, + V3.3S, + V0.9S for DDR, + V1.5S for CPU and chipset blocks.  + V1.5S_POWER_GOOD -&gt; + V1.05S for DMI, Analog DDR, GPIO units on the CPU and chipset.  Further + V1.05S_POWER_GOOD -&gt; + V0.89 for the graphic block CPU.  And in the end, if all the power have risen, all the POWER_GOOD are assembled ‚ÄúAND‚Äù by logic into one common, a delay of 99 msec is done, to stabilize all the power supplies, and + VCC_CPU, the main power of the processor, is started.  It is waiting for the PWROK and a separate VMPWRGD for + VCC_CPU.  Fuuuh ... A couple of weeks, together with Anatoly, fought over these power supplies, as a result, one of the POWER_GOOD needed to be tightened, in the comparator circuit to control the voltage, to change the nominal values, and there was still a lot there, not to remember.  As a result - all the power are, but the system is silent. <br><br>  We understand further.  The PWROK and VMPWRGD uplift chipset is required to inform the CPUPWRGOOD processor and raise the PLTRST # - Platform Reset.  Those.  He says to him - everything, power supply, I release the reset, start it!  CPUPWRGOOG is rising, PLTRST # is not.  Oops ... Sailed ... It's good that I still have all the captured dumps of the analyzer, here it is, the problem: <br><br><img src="https://habrastorage.org/files/f2b/5f4/1df/f2b5f41dfca740498ceb3693438f1584.jpg"><br><br>  For two weeks we struggled with this problem, which we didn‚Äôt try.  In the end, I found one of the endless potential problems - one of the pins of the chipset should have been pulled to the ground, and here it was hanging in the air!  In general, we removed the chipset from the board, installed a thin wire on the contact and soldered a new chipset.  And it earned!  This is how it looked: <br><br><img src="https://habrastorage.org/files/6a4/26e/c5e/6a426ec5e9ab439288b4d8d706905159.jpg"><br><br>  Unfortunately, there are no photos of how the iron looks under debugging, but, for example, the board on the Haswell platform looked on my desk like this: <br><br><img src="https://habrastorage.org/files/35e/d3d/f78/35ed3df782094eb3b934c2d4c6d480a6.jpg"><br><br>  Great, now it's the BIOS.  While on the debug board I see the code 0x00, which means that the BIOS does not boot from the SPI EEPROM.  The photo is a replica, the motherboard was different, but just to show how it approximately looked on the table: <br><br><img src="https://habrastorage.org/files/71d/795/d1b/71d795d1b53a4ec0a0e081a874c2b95a.jpg"><br><br>  We understand further, we get up to SPI_CLK - a clock is present, requests are coming, we get up to SPI_MOSI - the chipset issues packets of requests, we get up to SPI_MISO - zero.  Tightening SPI_MISO - and cheers, code 0x87.  Finally.  Most likely the BIOS requires EC.  We get up on the LPC with the analyzer, test and see requests to the address 0x164E and 0x164F, this is definitely EC, it hangs after the BIOS requests.  Such: <br><br><img src="https://habrastorage.org/files/220/2de/731/2202de7313454313a72a392a00d0b5dd.jpg"><br><br>  Posted in AMI, Phoenix and Insyde.  Phoenix sent the binary, but it didn‚Äôt start, Insyde started asking stupid questions at all, and AMI quickly understood the problem, and their binary started up the first time.  Everything, the main iron is started, further only the periphery is checked. <br><br><h2>  <font color="#3969b8">Unexpected Audio Codec Issues</font> </h2><br>  After the launch of the board, some time passed, we made a passivation with the audio codec from Realtek.  Nothing foreshadowed troubles, the HDAUDIO interface hooked up the codec, the device saw OSes, even earned the output to the speaker, but some outputs and inputs simply did not work. <br><br>  They wrote to Realtek, talked, it turned out that the BIOS, at the start, should fill in the audio codec with the so-called VERB Table.  In essence, set the internal registers of the codec in accordance with the requirements of use.  Those.  of the variety of outputs - only one can really be used.  This table is generated by a special application from Realtek HDACfg.  It shows all the information, up to the location, color and type of connector.  Well, they arrived, there are no BIOS sources, AMI did not help us for free.  What to do? <br><br>  I do not even remember how, but I found a program on the network (BIOS Patcher 7.0), which was able to disassemble my BIOS into its component parts.  UEFI BIOS is represented as a kind of capsule, inside there is a tree structure of different types of modules.  The modules are mostly packed.  And some of its cunning compression.  Okay, I found a way to unpack all modules, I found a module responsible for initializing devices on the HDAUDIO bus.  Very lucky that the table of one of the devices was larger than mine.  I replaced it with my own, and, of course, did not forget to fix the length.  But it was absolutely unwilling to assemble back.  EDK Tianocore helped me a lot, with the help of its utilities, namely genffsfile, gensection, genfvimage, I manually collected all the necessary sections.  And it earned! <br><br><h2>  <font color="#3969b8">Total</font> </h2><br>  Now, with some pride or something, I recall these winning moments, because there was nothing, no documentation on launching the platform, no BIOS sources, no sane support from Intel.  Only intuition and experience helped. <br><br>  Now it is somewhat simpler, of course, we have all the sources, you can fix anything in the BIOS quickly enough, the dialogue with AMI is adjusted, I occasionally deliver glitches to them and they correct them.  Documents from Intel are already complete, i.e.  for you to understand, for example, on the Broadwell platform there are about 130 of them.  In Skylake, it‚Äôs already under 400. But still, the first revision of the board always ends up being finalized, there‚Äôs always something that isn‚Äôt attracted, or some other problem. <br><br>  Now there is a debugger for BIOS, debugging can be viewed, and it has already rescued us many times.  There is one person more in our team, a wonderful engineer, a hardware worker who solves a bunch of problems.  Now we have our SMD lines, and the mystery of the pilot production takes place literally in the next room.  Now Intel integrates chipsets into SoC and fewer problems with wiring.  Now we have many partners and contacts around the world.  But then there were other times, ‚Äúwe survived as best we could‚Äù ... <br><br>  For the first time, perhaps, everything seemed to be just a couple of paragraphs, but in practice, with all this, they suffered for about two months.  If you like it, then in the following articles we will talk about something similar, but for now ask questions in the comments. <br><br>  PS And, of course, I look that way when I enter the BIOS. <br><br><img src="https://habrastorage.org/files/487/c44/c5a/487c44c5ace24ca19997887b929d9556.gif"><br><br>  References: <br>  - " <a href="http://www.ct-msk.ru/">Network Technologies</a> " <br>  - ‚Äú <a href="http://www.ctcom.com.tw/">Communication Technology</a> ‚Äù <br>  - <a href="http://www.raydget.ru/">Raydget Russia</a> <br>  - <a href="http://www.raydget.com.tw/">Raydget Taiwan</a> <br>  - <a href="http://geektimes.ru/company/ctcom/blog/251138/">Pocket desktop</a> </div><p>Source: <a href="https://habr.com/ru/post/259033/">https://habr.com/ru/post/259033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259023/index.html">Fedora 22 - all trends in one build</a></li>
<li><a href="../259025/index.html">Web-based Crona</a></li>
<li><a href="../259027/index.html">InGaAs Semiconductor as an Alternative to Silicon</a></li>
<li><a href="../259029/index.html">Samba4 - using Python Scripting Interface</a></li>
<li><a href="../259031/index.html">Double dispatch</a></li>
<li><a href="../259035/index.html">Text Analytics as Commodity: Text Analytics Application Overview</a></li>
<li><a href="../259041/index.html">How to make a small contest in one day</a></li>
<li><a href="../259047/index.html">OWASP TOP-10: a practical look at web application security: # 1 - injections</a></li>
<li><a href="../259051/index.html">That new versions of UEFI standards are prepared for us, part one, PI 1.4</a></li>
<li><a href="../259053/index.html">The second version of the Evernote SDK for Android: new Evernote features in your applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>