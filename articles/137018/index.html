<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Script for PlanetLab. Removing and adding Nodes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since I recently had to delve into the subtleties of using PlanetLab, I decided to share an example script to automatically add-delete nodes. Perhaps ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Script for PlanetLab. Removing and adding Nodes</h1><div class="post__text post__text-html js-mediator-article">  Since I recently had to delve into the subtleties of using PlanetLab, I decided to share an example script to automatically add-delete nodes.  Perhaps this will shorten the time for someone in the future. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a2/86e/f94/1a286ef944e852cb77a5d1ea31f3a67b.png" alt="image"><br><br><a name="habracut"></a>  I will describe briefly what is at stake.  PlanetLab is a network widely used to test new network services or modify existing ones.  PlanetLab nodes (there are about 1024's) are distributed in different countries and access to them is obtained only by employees of those institutions that host PlanetLab nodes.  A more detailed article on PlanetLab is <a href="http://habrahabr.ru/blogs/p2p/137177/">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are developing distributed applications, it will be difficult to manage without PlanetLab.  When testing a distributed application, you will most likely have to deal with a large number of nodes (Nodes).  The problem is that in PlanetLab the nodes often go offline.  Accordingly, these nodes need to be removed from your account (slice) and connect new ones instead.  It is certainly possible to do it through the web interface by hand.  However, the process is tedious, so the best way to use the script.  This is the script that I want to share with you.  It is written on python. <br><br>  A description of all the API methods of PlanetLab can be found at <a href="https://www.planet-lab.eu/doc/api">www.planet-lab.eu/doc/api</a> .  The script itself has tried to provide sufficient number of comments so that it is clear what is happening. <br><br>  <font color="#666666">#! / usr / bin / env python</font> <br><br>  <font color="#007800">import</font> xmlrpclib <br>  <font color="#007800">import</font> sys <br>  plc_host = <font color="#c20cb9">'www.planet-lab.eu'</font> <br>  auth = <br>  { <font color="#c20cb9">'AuthMethod'</font> : <font color="#c20cb9">'gpg'</font> , <br>  <font color="#c20cb9">'name'</font> : <font color="#c20cb9">'your user name'</font> , <br>  <font color="#c20cb9">'signature'</font> : <font color="#c20cb9">'GnuPG signature'</font> , <br>  } <br><br>  slice_name = <font color="#c20cb9">'tudresdenple_backup'</font> <br><br>  api_url = " <a href="">% s</a> : 443 / PLCAPI /"% plc_host <br>  #api_url = " <a href="">% s / PLCAPI</a> "% plc_host <br><br>  plc_api = xmlrpclib.ServerProxy (api_url, allow_none = True) <br><br>  #get list of all nodes <br>  <font color="#007800">print</font> <font color="#ff0000">‚Äúnodes:"</font> <br>  nodes = plc_api.GetNodes (auth, {}, [ <font color="#c20cb9">'node_id'</font> , <font color="#c20cb9">'hostname'</font> , <font color="#c20cb9">'boot_state'</font> ]) <br><br>  #get ids the slice <br>  attached_nodes_ids = plc_api.GetSlices (auth, [slice_name], [ <font color="#c20cb9">'node_ids'</font> ]) [0] [ <font color="#c20cb9">'node_ids'</font> ] <br>  #obtain nodes hostnames, which will look like {'hostname': ''} <br>  attached_nodes = plc_api.GetNodes (auth, attached_nodes_ids, [ <font color="#c20cb9">'hostname'</font> , <font color="#c20cb9">'boot_state'</font> ]) <br><br>  #extract hostname only <br>  have_nodes = [] <br><br>  <font color="#007800">for</font> node <font color="#007800">in</font> attached_nodes: <br>  have_nodes.append (node ‚Äã‚Äã[ <font color="#c20cb9">'hostname'</font> ]) <br><br>  <font color="#007800">for</font> node <font color="#007800">in</font> have_nodes: <br>  <font color="#007800">print</font> node <br><br>  #Filter all the nodes that have been in the boot state and therefor <br>  <font color="#007800">print</font> <font color="#ff0000">"Searching for non-boot nodes slice:"</font> <br>  to_delete = [] <br><br>  <font color="#007800">for</font> node_record <font color="#007800">in</font> attached_nodes: <br>  <font color="#007800">if</font> node_record [ <font color="#c20cb9">'boot_state'</font> ]! = <font color="#c20cb9">'boot'</font> : <br>  to_delete.append (node_record [ <font color="#c20cb9">'hostname'</font> ]) <br><br>  <font color="#007800">for</font> node_record <font color="#007800">in</font> to_delete: <br>  <font color="#007800">print</font> node_record <br>  #delete those nodes <br><br>  num_of_deleted = <font color="#007800">len</font> (to_delete) <br><br>  <font color="#007800">if</font> num_of_deleted&gt; 0: <br>  success = plc_api.DeleteSliceFromNodes (auth, slice_name, to_delete) <br>  <font color="#007800">if</font> success == 1: <br>  <font color="#007800">print</font> <font color="#ff0000">"Successfullly detached non-booted nodes"</font> <br>  <font color="#007800">else</font> : <br>  <font color="#007800">print</font> <font color="#ff0000">"Deleting of the non-booted nodes has failed!"</font> <br>  sys.exit () <br>  <font color="#007800">else</font> : <br>  <font color="#007800">print</font> "Nothing to delete or add" <br>  sys.exit () <br><br>  #add as the number of deleted ones <br>  <font color="#007800">print</font> <font color="#ff0000">"Adding new booted nodes"</font> <br>  to_add = [] <br><br>  <font color="#007800">for</font> node_record <font color="#007800">in</font> nodes: <br>  <font color="#007800">if</font> num_of_deleted&gt; 0: <br>  num_of_deleted - = num_of_deleted <br>  <font color="#007800">else</font> : <br>  break <br>  <font color="#007800">if</font> (node_record [ <font color="#c20cb9">'hostname'</font> ] <font color="#007800">not in</font> have_nodes) and node_record [ <font color="#c20cb9">'boot_state'</font> ] == <font color="#c20cb9">'boot'</font> : <br>  to_add.append (node_record [ <font color="#c20cb9">'hostname'</font> ]) <br><br>  <font color="#007800">if</font> <font color="#007800">len</font> (to_add)&gt; 0: <br>  success = plc_api.AddSliceToNodes (auth, slice_name, to_add) <br>  <font color="#007800">if</font> success == 1: <br>  <font color="#007800">print</font> <font color="#ff0000">"Successfullly attached new nbooted nodes"</font> <br>  <font color="#007800">else</font> : <br>  <font color="#007800">print</font> <font color="#ff0000">"Addint of the booted nodes has failed!"</font> <br>  sys.exit () <br><br>  <font color="#007800">print</font> <font color="#ff0000">"The following nodes were added:"</font> <br>  <font color="#007800">for</font> node_record <font color="#007800">in</font> to_add: <br>  <font color="#007800">print</font> node_record </div><p>Source: <a href="https://habr.com/ru/post/137018/">https://habr.com/ru/post/137018/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137009/index.html">SPDY protocol can be enabled in HTTP / 2.0</a></li>
<li><a href="../137010/index.html">Leaflet - API maps from Cloudmade. Review</a></li>
<li><a href="../137011/index.html">Preparing network infrastructure for PHD</a></li>
<li><a href="../137014/index.html">The right hand does not know what the left hand is doing.</a></li>
<li><a href="../137015/index.html">Some statistics IT Challenge</a></li>
<li><a href="../137019/index.html">Create a preset manager in PureData</a></li>
<li><a href="../137020/index.html">Pictographic password. Result</a></li>
<li><a href="../137022/index.html">Graph of user relations Google+. Gephi</a></li>
<li><a href="../137023/index.html">Source codes of cross-platform framework Enyo 1.0 and 2.0</a></li>
<li><a href="../137024/index.html">DIY alarm system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>