<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating the use of Javascript API Vkontakte</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of days ago, as usual, without notifying anyone, Contact added the ability to develop JavaScript applications connected via iframe. Access to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating the use of Javascript API Vkontakte</h1><div class="post__text post__text-html js-mediator-article">  A couple of days ago, as usual, without notifying anyone, Contact added the ability to develop JavaScript applications connected via iframe.  Access to the API in these applications is, in general, the same as accessing the API from Flash - anyway, this is the usual REST protocol.  Parameters are passed through the GET request string, and the result is returned as JSON or XML. <br><br>  One of the problems of using the Vkontakte API is to send a cross-domain request to http://api.vkontakte.ru/api.php.  Another problem is the cumbersome calculation of the signature, which needs to sign all requests. <a name="habracut"></a>  First of all, I, like many other developers, took up jQuery.  However, firstly, using the 68-kilobyte library for the sake of cross-domain queries is like shooting a gun at sparrows.  Yes, and somehow cumbersome was a call to API functions using jQuery, so I had to abandon jQuery in favor of a small function for cross-domain queries.  Well, in order to somehow simplify my life, I decided to make a small library that would not only load the specified URL with getting the server response, but also perform the most inconvenient API in all this - signature calculation. <br><br>  The end result can be found by clicking on the links at the end of the article, and I will focus on the individual points of use and implementation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To use the Vkontakte API, you need to connect a file with the library to the HTML document of the application: <blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font>&lt;!--   ,    </font> <font>  HTML- --&gt;</font> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">src</font> <font color="#0000ff">="vk_api.js"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font></font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><font><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> &lt;!--   ,     <font>  HTML- --&gt;</font> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">src</font> <font color="#0000ff">="vk_api.js"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><font><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font>&lt;!--   ,    </font>   HTML- --&gt; <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">src</font> <font color="#0000ff">="vk_api.js"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font>&lt;!--   ,    </font> <font>  HTML- --&gt;</font> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">src</font> <font color="#0000ff">="vk_api.js"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font>&lt;!--   ,    </font> <font>  HTML- --&gt;</font> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">src</font> <font color="#0000ff">="vk_api.js"</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font></font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  The library itself is a single <em>vk_api</em> object and the <em>md5</em> function, honestly borrowed from Webtoolkit.  The <em>vk_api</em> object is not ready for use by itself - it is necessary to create an instance from it using the constructor: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">var</font> api = <font color="#0000ff">new</font> vk_api ( <font color="#008000">/ * parameters * /</font> ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  In principle, it would be possible to perform all initialization when loading the <i>vk_api.js</i> script <i>itself</i> , but this is not the way of a samurai - what if you don‚Äôt have to call the API in this session at all?  In addition, during initialization, the constructor is passed parameters that somehow need to be set somewhere and passed to the script. <br><br>  So, let's try to create an object: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Create an object from vk_api ().</font>  <font color="#008000">All further work must take place.</font> </li><li>  <font color="#008000">// with api object only.</font> </li><li>  <font color="#0000ff">var</font> api = <font color="#0000ff">new</font> vk_api ( </li><li>  <font color="#008000">// This is a Secret, it is listed on the application editing page</font> </li><li>  <font color="#A31515">'hGtsH5G0'</font> , </li><li></li><li>  <font color="#008000">// This function will be called if the initialization of the API is successful.</font> </li><li>  <font color="#008000">// Good place to set all callback functions through</font> </li><li>  <font color="#008000">// addCallback ()</font> </li><li>  <font color="#0000ff">function</font> () { </li><li></li><li>  <font color="#008000">// Call the change settings window with the marked settings for</font> </li><li>  <font color="#008000">// access to friends and to the wall.</font>  <font color="#008000">User will not be able to close</font> </li><li>  <font color="#008000">// called window until it sets the required settings.</font> </li><li>  api.makeSettings (api.SETT_FRIENDS | api.SETT_WALL); </li><li></li><li>  <font color="#008000">// Add a function that will run if the user adds</font> </li><li>  <font color="#008000">// application to your page.</font> </li><li>  api.addCallback ( </li><li>  <font color="#A31515">'onApplicationAdded'</font> , </li><li>  <font color="#0000ff">function</font> () { </li><li>  <font color="#008000">//actions</font> </li><li>  } </li><li>  ); </li><li>  }, </li><li></li><li>  <font color="#008000">// This function is called if the API initialization failed.</font> </li><li>  <font color="#008000">// In this case, it is impossible to use external (external) calls.</font> </li><li>  <font color="#0000ff">function</font> () { </li><li>  <font color="#008000">// error message</font> </li><li>  } </li><li>  ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  As you can see, everything is very simple.  The designer is supposedly given a secret key (aha, the secret one is presented in the page code in an open form) and two functions, the first of which is performed in case of successful initialization and the other in case of an error during initialization.  In fact, the second function is not at all necessary if the developer does not want to take into account those isolated cases when an error occurs during initialization.  In addition, there is another parameter, which is a normal logical flag, indicating whether the test mode is enabled. <br><br>  The fact is that in test mode, for each API method called, one more always the same parameter must be added.  So, the support of the global one-time inclusion of the testing mode will relieve developers of unnecessary gestures when preparing an application for release - you will need to remove only one designer parameter, instead of editing multiple API calls. <br><br>  If you look at a couple of dozens of Vkontakte applications, then very many of them require users to install them and allow them to do something.  In this case, the applications either simply display a message with instructions on <s>where to go,</s> what to do, or, at best, immediately display the setup or change settings window.  Well, it was a sin not to implement such functions at the library level.  Moreover, at the request of one person, I went a little further, and implemented these functions in such a way that the user cannot close the window with a proposal to install the application at all or allow him something until he agrees with the requirements of the application.  Thus, it is not necessary to provide additional application pages for those users who refused to install or did not allow something to the application - it is enough to simply call one or two functions: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Display a window asking to install the application.</font> </li><li>  api.makeInstall (); </li><li>  api.addCallback ( </li><li>  <font color="#A31515">'onApplicationAdded'</font> , </li><li></li><li>  <font color="#008000">// This function will be called when the user installs the application.</font> </li><li>  <font color="#0000ff">function</font> () { </li><li>  $ ( <font color="#A31515">'#text'</font> ) .append ( <font color="#A31515">'Application added \ n'</font> ); </li><li></li><li>  <font color="#008000">// Ask the user to allow the application to access</font> </li><li>  <font color="#008000">// to friends and to post on the walls</font> </li><li>  api.makeSettings (api.SETT_FRIENDS | api.SETT_WALL); </li><li>  api.addCallback ( </li><li>  <font color="#A31515">'onSettingsChanged'</font> , </li><li></li><li>  <font color="#008000">// The function will be executed when the user changes the application settings.</font> </li><li>  <font color="#0000ff">function</font> (settings) { </li><li>  $ ( <font color="#A31515">'#text'</font> ) .append ( <font color="#A31515">'New parameters:'</font> + String (settings) + <font color="#A31515">'\ n'</font> ); </li><li>  } </li><li>  ); </li><li>  } </li><li>  ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  Let us turn, finally, to why the application was developed, i.e., directly to the call of API functions.  For this, the <em>call</em> method is provided: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#008000">// Call the API method via the call () function</font> </li><li>  api.call ( </li><li></li><li>  <font color="#008000">// Name of the API method.</font> </li><li>  <font color="#008000">// Suppose getting extended information about profiles.</font> </li><li>  <font color="#A31515">'getProfiles'</font> , </li><li></li><li>  <font color="#008000">// This is an object with API method parameters.</font>  <font color="#008000">If there are no parameters,</font> </li><li>  <font color="#008000">// then this argument can be omitted.</font> </li><li>  { </li><li>  uids: <font color="#A31515">'4124584,2327412,1237975'</font> , </li><li></li><li>  <font color="#008000">// You can specify arrays that will be automatically</font> </li><li>  <font color="#008000">// converted to strings.</font> </li><li>  fields: [ </li><li>  <font color="#A31515">'first_name'</font> , <font color="#A31515">'last_name'</font> , <font color="#A31515">'nickname'</font> , </li><li>  <font color="#A31515">'bdate'</font> , <font color="#A31515">'city'</font> , <font color="#A31515">'country'</font> , <font color="#A31515">'photo'</font> </li><li>  ] </li><li>  }, </li><li></li><li>  <font color="#008000">// This function will be called when a response is received from the server.</font> </li><li>  <font color="#008000">// data is a ready-to-use object created from a string</font> </li><li>  <font color="#008000">// JSON received from the server.</font> </li><li>  <font color="#0000ff">function</font> (data) { </li><li>  <font color="#008000">// Actions with the data object</font> </li><li>  } </li><li>  ); </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote>  As you can see, everything is simple, and no unnecessary actions that we need. <br><br>  As for the so-called secret key, transmitted to the <em>vk_api</em> constructor <em>by the</em> first parameter, for it I provided the simplest, not even encryption, but encoding.  The key in encoded form looks like this: <em>sx - 36l76l11l57l52l14l65l42l56l31l</em> - a variation on the theme of character codes.  The first characters of the string <em>sx--</em> are needed in order to preserve the possibility of transmitting an uncoded secret key to the designer - if the string starts with <em>sx--</em> , then the key is encoded, otherwise the key is transmitted in clear text.  Why such simple coding?  Yes, because it is a fool proof, no more.  From the young hacker, who just read another article in a well-known magazine, this method will help to protect themselves, and from a qualified developer who knows the basics of JavaScript, no encryption will save, because in the end, the script needs a secret in the clear, and therefore the function to decrypt must be in code. <br><br>  Actually, there is nothing unusual in the library.  But from routine work when developing applications, the library will save.  As promised, below is the download link. <br><br>  Library: <a href="">vk_api-1.4.4.zip</a> . <br>  Project page on Google Code: <a href="http://vk-jsapi.googlecode.com/">http://vk-jsapi.googlecode.com/</a> <br>  <a href="http://bit.ly/79ziY1">New versions and full description</a> . <br><br></div><p>Source: <a href="https://habr.com/ru/post/81654/">https://habr.com/ru/post/81654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../81637/index.html">Otrivin Sea</a></li>
<li><a href="../81638/index.html">SSH Layer 3 Tunnel Organization</a></li>
<li><a href="../81639/index.html">Tenders and fingertips</a></li>
<li><a href="../81645/index.html">No official Python certification</a></li>
<li><a href="../81646/index.html">Google improves search</a></li>
<li><a href="../81655/index.html">Briefly about this GF1</a></li>
<li><a href="../81657/index.html">Use 7zip for data backup. Continuation</a></li>
<li><a href="../81658/index.html">On January 21, 2010, Google Trend Awards 2009 were presented.</a></li>
<li><a href="../81662/index.html">"The agony of the IT project" or "How to find out that the horse is dead?"</a></li>
<li><a href="../81665/index.html">How to make an application that users will like</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>