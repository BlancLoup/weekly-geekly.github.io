<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Library development: from API to public release</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's look at the library from the wrong side, which is more familiar to us, that is, the user side, but from the point of view of the developer of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Library development: from API to public release</h1><div class="post__text post__text-html js-mediator-article">  Let's look at the library from the wrong side, which is more familiar to us, that is, the user side, but from the point of view of the developer of the mobile development library.  Let's talk what approaches should be followed when developing your library.  We begin, of course, with designing such an API that you yourself would like to use, which would be convenient.  We will think about what needs to be considered to make not just a working code, but a really good library, and we will get to release a real adult public release.  <strong>Asya Sviridenko</strong> , who will share her considerable experience in developing the mobile SpeechKit library in <a href="https://habr.com/company/yandex/">Yandex,</a> will help us in this. <br><br>  The material will be useful not only to those who develop the library or framework, but also to those who want to separate part of their application into a separate module, and then reuse it, or, for example, share their code with the rest of the developer community, putting it in public access. <br><br>  For everyone else, the story will be filled with genuine stories from the life of the mobile SpeechKit team, so it should be fun. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/uvx060VepYo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><h3>  Content <br></h3><br><ul><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/429912/">Minute SpeechKit</a> . <br></li><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/429912/">Designing a</a> convenient, understandable API that you want to use. <br></li><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/429912/">Development</a> .  What to add to the code so that it not only works and performs the functionality, but also helps your users. <br></li><li>  <a href="https://habr.com/ru/company/oleg-bunin/blog/429912/">Run</a> - what you need not to forget when you roll the release. <br></li></ul><br><a name="speechkit"></a><br><h2>  Minute SpeechKit </h2><br>  I will not ask if you heard about SpeechKit, because even inside Yandex, not everyone knows what it is. <br><br>  <strong>SpeechKit is the door to all Yandex speech technologies</strong> .  With this library, you can integrate speech technology into your application: speech recognition and synthesis, voice activation. <br><br>  You‚Äôve probably heard about Alice‚Äôs voice assistant - she‚Äôs just running on SpeechKit.  SpeechKit itself does not include recognition or synthesis, it happens on the server.  But it is through our library that everything can be integrated into the application. <br><br>  A question usually follows: if everything happens on the server, what does the library do?  Why is it needed? <br><br>  The library does a lot: <br><br><ol><li>  <strong>Synchronization of all processes.</strong>  For example, using a voice assistant, the user presses a button, says something, interrupts the assistant, makes requests ‚Äî it all goes through the library.  For the user of our library, this is transparent; they should not worry about all this. </li><li>  <strong>Networking</strong>  Since everything happens on the server, you need to receive data from there, process it, give it to the user.  Now SpeechKit can go to several different servers within one network connection: one recognizes, the other allocates meaning, the third recognizes music, etc.  It's all hidden inside the library, users don‚Äôt have to worry about it. </li><li>  <strong>Work with audio sources.</strong>  We deal with the speech of a person, and work with audio also takes place inside SpeechKit.  And we can not only write from a standard device, but also receive data from anywhere.  It can be a file or stream - we can work with all this. </li></ol><br>  SpeechKit is used in internal commands.  Now it was integrated by 16 teams of Yandex.  And we even know about several external teams that have done this too. <br><a name="disain"></a><br><h2>  Design </h2><br>  Let's think about what we mean by a convenient application.  Usually, this is a thoughtful and understandable UX, the solution of our problems, stable work, etc. <br><br>  When we say that a library is convenient, first of all we mean that it has an API that is understandable to use.  How to achieve this? <br><br><h3>  Basic principles <br></h3><br>  These are some aspects that I learned from my experience with SpeechKit. <br><br><ul><li>  <strong>First of all, remember that your users are developers</strong> . <br></li></ul><br>  On the one hand, this is good, because you don‚Äôt explain to ordinary users: ‚ÄúYou see, we have a backend and therefore nothing works, and we‚Äôre fine!‚Äù You can explain this to developers - you can explain a lot to developers! <br><br>  On the other hand, you get such users who will definitely take the opportunity to find a hole and break something if you leave it.  We all use libraries with you and try to squeeze the maximum out of them.  They declare that they do only this, this and this, and we think: "No, now we are here a little bit podshamanit, we will give it, and everything will be as it should." <br><br>  In addition, the fact that users are developers means that you will always have a lot of advice and recommendations on how to develop and how to make things better. <br><br>  The second important point is fully correlated with the first. <br><br><ul><li>  <strong>Anything that is not allowed in your library should be prohibited,</strong> <strong><br></strong>  <strong>so that there are no unwanted loopholes.</strong> <br></li></ul><br>  If your users start doing something with the library that you did not anticipate, this is a direct path to bugs, and to those that are hard to debug.  Try to use everything that gives the language and the technology that you use: public / private, final, deprecated, readonly.  Reduce scopes, disable inheritance and the use of some methods, mark properties that cannot be changed - provide everything you can to prevent them from doing something your library is simply not designed for. <br><br><ul><li>  <strong>Do not allow doubleness in the interpretation of your library's API.</strong> <br></li></ul><br>  If this particular class can be created in a single way, deny all others.  If this property cannot be null, indicate this explicitly.  In iOS, there is a nullable / nonnull, designated initializer, the same is in Java and Android.  Use all this in order for the user to open the file, open your class, run over it with his eyes and immediately understand what can and cannot be done. <br><br><h3>  Case SpeechKit API <br></h3><br>  Using SpeechKit as an example, I‚Äôll tell you how we refactored version 2 into version 3. We changed the API a lot and tried to use all these principles. <br><br>  The need arose from the fact that the <strong>API was complex and "theoretical</strong> . <strong>"</strong>  It had global components that had to be called first - did not call - everything does not work.  Very strange settings were made.  The API was fairly ‚Äútheoretical‚Äù because SpeechKit was originally part of the Navigator, and then this piece was brought to the library.  The API basically worked with the cases used in the Navigator. <br><br>  Gradually, the number of users grew, and we began to understand what they really needed: what methods, callbacks, parameters.  They came to us with requests that the API did not allow to implement.  This was repeated time after time, and it became clear that the API does not stand up.  So we got involved in refactoring. <br><br>  <strong>The refactoring process was long (six months) and painful (everyone was unhappy)</strong> .  The main difficulty was not to take a mountain of code and rewrite.  It was impossible to just go on refactoring, but it was necessary to support all the active versions that were in use.  We couldn‚Äôt just say to our users: ‚ÄúGuys, yes, it doesn‚Äôt work for you, yes, you need this feature - we‚Äôll do everything in version 3, please wait half a year!‚Äù <br><br>  As a result, refactoring took a long time, and the process was painful, and for users too.  Because in the end, we changed the API without backward compatibility.  They came to them and said: ‚ÄúHere is a new, beautiful SpeechKit, please take it!‚Äù - in response, they heard: ‚ÄúNo, we have not planned to switch to your version 3.0 at all‚Äù.  For example, we had a team that switched to this version for a year.  Therefore, we supported the previous version for a whole year. <br><br>  But the result was worth it.  We <strong>got simple integration and fewer bugs</strong> .  This is what I mentioned in the basic principles of API design.  If you are sure that your API is used correctly, there are definitely no problems in this part: all classes are called correctly, all parameters are correct.  Finding bugs is much easier, fewer cases where something can go wrong. <br><br>  Below is an example of what the main class that deals with recognition looked like before refactoring. <br><br><pre><code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">// SpeechKit v2 @interface YSKRecognizer: NSObject @property (nonatomic, strong, readonly, getter=getModel) NSString* model; @property (nonatomic, assign, getter=isVADEnabled) BOOL VADEnabled; - (instancetype)initWithLanguage:(NSString *)language model:(NSString *)m; - (void)start; - (void)cancel; - (void)cancelSync; @end @interface YSKInitializer: NSObject - (instancetype)init; - (void)dealloc; - (void)start; + (BOOL)isInitializationCompleted; @end extern NSString *const YSKInactiveTimeout; extern NSString *const YSKVADEnabled; @interface YSKSpeechKit: NSObject + (instancetype)sharedInstance; ‚Äì (void)setParameter:(NSString *)name withValue:(NSString *)value; @end</span></span></code> </pre> <br>  This is a common class that inherits from NSObject.  Consider separately each of its details.  It is clear that we can inherit from it, redefine some methods in it - everything that can be done with NSObject. <br><br>  Further at creation two lines are transferred to it (language and model).  What are these lines?  If you pass in the language "Hello, world", then the output will be a translation, or what?  Not very clear. <br><br>  In addition, since this is the heir of NSObject, we can call it init, new, etc.  What will happen?  Will it work, or will it wait for some parameters? <br><br>  Of course, I know the answers to these questions, I know this code.  But the people who look at it for the first time do not understand at all what this is all about.  Even methods with setter and getter do not look at all what it would look like in iOS.  Methods start, cancel, cancelSync (and the one that just cancel - is it aSync?) - what happens if you call them together?  A lot of questions to this code. <br><br>  Next comes the object I was talking about (YSKInitializer), which you definitely need to start in order for everything to work - this is generally some kind of magic.  It can be seen that this code was written by developers who do not write for iOS, but do C ++. <br><br>  Further, the settings for this replicator were set through global components that were transferred to another global object, and in fact it was impossible to create two different replicators with different sets of parameters.  And this was probably one of the most sought-after cases that did not support the API. <br><br><h3>  How v3 better v2 <br></h3><br>  What did we get when we refactored and switched to version 3? <br><br><ul><li>  <strong>Fully native API.</strong> <br></li></ul><br>  Now we have an iOS API like iOS-API, Android API like Android. <br><br><blockquote>  An important point that we did not immediately realize was that platform guidelines are much more important than the uniformity of your library's API. <br></blockquote><br>  For example, classes for Android are created using builders, because this is a very clear pattern for Android developers.  In iOS, this is not so popular, so another approach is used: we create objects with a special class of settings. <br><br>  I remember how we argued for a long time on this topic.  It seemed to us important that the developer took our code on iOS or Android, and the coincidence would be 99%.  But it is not.  Better the code will be similar to the platform for which it is developed. <br><br><ul><li>  <strong>Simple and clear initialization</strong> . <br></li></ul><br>  We need this object - these are its settings, you create them, you transfer - profit!  That is, there are no hidden global settings that need to be transferred somewhere. <br><br><ul><li>  <strong>Lack of global components.</strong> <br></li></ul><br>  We threw out global components that confused everyone, scared and raised many questions even from the developers of this library, not only from the users. <br><br>  Now the same class in the new version looks like this (this is still Objective-C - it was impossible to switch to Swift then). <br><br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">// SpeechKit v3 NS_ASSUME_NONNULL_BEGIN __attribute__((objc_subclassing_restricted)) @interface YSKOnlineRecognizer: NSObject&lt;YSKRecognizing&gt; @property (nonatomic, copy, readonly) YSKOnlineRecognizerSettings *settings; - (instancetype)initWithSettings:(YSKOnlineRecognizerSettings *)s audioSource:(id&lt;YSKAudioSource&gt;)as NS_DESIGNATED_INITIALIZER; + (instancetype)new __attribute__((unavailable("Use designated initializer."))); - (instancetype)init __attribute__((unavailable("Use designated initializer."))); @end NS_ASSUME_NONNULL_END @protocol YSKRecognizing &lt;NSObject&gt; - (void)prepare; - (void)startRecording; - (void)cancel; @end @interface YSKOnlineRecognizerSettings: NSObject&lt;NSCopying&gt; @property (nonatomic, copy, readonly) YSKLanguage *language; @property (nonatomic, copy, readonly) YSKOnlineModel *model; @property (nonatomic, assign) BOOL enableVAD; - (instancetype)initWithLanguage:(YSKLanguage *)l model:(YSKOnlineModel *)m NS_DESIGNATED_INITIALIZER; @end @interface YSKLanguage: YSKSetting + (instancetype)russian; + (instancetype)english; @end</span></span></code> </pre><br>  This is the heir to NSObject, but now we are clearly talking about not being inherited from it.  All methods that are characteristic of this object are transferred to a special protocol.  It is created using the settings and audioSource.  Now all the settings are encapsulated in a single object, which is passed specifically here to set the settings for a specific recliner. <br><br>  Moreover, we have taken out the work with audio from here, that is, the installer now is not the component that writes audio.  This component deals with recognition issues, and any source can be passed here. <br><br>  Other creation methods via new or via init are prohibited, because this class needs default settings.  Please, if you want to use it, create at least some default settings. <br><br>  The main thing is that those settings that are transmitted here are immutable, that is, you cannot change them in the process of work.  Do not try, when something is recognized, to replace the model or language.  Accordingly, we do not give users the opportunity to change an object with settings that has already been transferred. <br><br>  NS_ASSUME_NONNULL_BEGIN / NS_ASSUME_NONNULL_END macros in order to emphasize that these settings cannot be null: audioSource cannot be null - it all must have some specific value in order to work. <br><br>  As I said, the start and cancel methods (cancelSync gone) moved to a separate protocol.  There are places in the library in which you can use any other not our recliner.  For example, we use Apple native, which implements this protocol and into which our components can be transferred. <br><br>  The settings here are NSCopying so that we can copy them, and they could not be changed during work.  In init, the required parameters are language, model, and NS_DESIGNATED_INITIALIZER.  It does not show a piece of code that is identical to the deprecate methods, but the idea is clear.  These are required parameters with which settings are created.  They must be, and must be nonzero. <br><br>  The rest of the set - it is about 20 settings of the rekgnizer set here.  Even the settings of a language or model are also separate classes that do not allow us to transmit something abstract, with which we cannot work.  That is, we clearly say: ‚ÄúPlease do not give us something with which we are not able to work.  The compiler won't let you do it. ‚Äù <br><br>  So, we talked about what can be done with the API.  The development also has its own nuances. <br><a name="develop"></a><br><h2>  Development </h2><br>  First of all, the library should do the things for which you wrote it ‚Äî perform its functionality well.  But you can make your code a really good library.  I offer several remarks that I collected in the process of developing SpeechKit. <br><br><h3>  Code not only for yourself <br></h3><br>  <strong>Collecting Debug information is</strong> absolutely necessary, because you do not want users to say that their service is not working because of your library. <br><br>  IOS has a debug information level that shows what information you need to collect.  By default, it will collect absolutely everything it can find: all calls, all values.  This is great, but it is a very large amount of data.  The -gline-tables-only setting allows you to collect information about function calls.  This is more than enough to find the problem and fix it. <br><br>  This is enabled in the Xcode settings (Build Settings), and is called the debug information level.  For example, by turning on this setting, we reduced the size of the SpeechKit binary file from 600 MB to 90 MB.  This is not very necessary information and we just threw it out. <br><br>  The second important thing is to <strong>hide private characters</strong> .  You all know that every time you lay out your library in iTunes, you risk getting a new warning that you are using something wrong, you are not adding something.  Therefore, if you use libraries that Apple considers private, don't forget to hide them.  It means nothing to you, you can also work with them, but as soon as your users try to upload the application with your library to iTunes, they will get an error.  Not everyone will ask you to fix it, most simply refuse to use your solution. <br><br>  <strong>Avoid character conflicts</strong> : add prefixes to everything that you have, to your classes, to categories.  If the library has a UIColor + HEX category, be sure that your users have exactly the same category, and when they integrate your library, they will get character conflicts.  And again, not everyone will want to tell you and tell about it. <br><br>  Another question is when you yourself use third-party libraries in your library.  There are a couple of nuances that are worth remembering.  First, if you use something that appears in a version older than your library, don't forget to use <a href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPFrameworks/Concepts/WeakLinking.html">Weak Linking</a> (Xcode -&gt; Build Phases -&gt; Link Binary With Libraries -&gt; Status is enabled).  This allows not to fall, if suddenly this library is not. <br><br>  Apple documentation describes in detail how it works.  But weak linking does not mean that the library will not load if it is not used.  That is, if it is important for your users to start the application and may not need that part of your library that uses a third-party library and takes time to start, weak linking will not help you.  With it, the library still loads, whether it is used or not. <br><br>  If you want to load in runtime, it will help to get rid of the linking problem at the start, then you need to use dlopen and dynamic loading.  This requires a lot of fuss, and you must first understand whether it makes sense.  Facebook has posted quite an <a href="">interesting code for an</a> example of how they dynamically link. <br><br>  Last - <strong>try not to use global entities inside</strong> .  There are some global components in each platform.  It is advisable not to pull them into your library.  This seems obvious because it is a global object, and users of your library can take it and configure it the way they want.  You use it in your library, you need to somehow save its state, reconfigure, then restore the state.  There are many nuances, and there is where to go wrong.  Remember this and try to avoid. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In SpeechKit, for example, up to the third version, we worked with audio inside the library, and we clearly set up and activated the audio session. An audio session in iOS is the kind of thing that every application has - don't say that you don't have it. It is created at the start, is responsible for the interaction of the application and the system media daemon and says what your application wants to do with audio. This is a singleton object in the truest sense of the word. We calmly took it, set it up as we needed, but this led to the fact that users had minor problems like changing the volume of the sound. Another method of audio sessions, which is responsible for setting the settings, is quite long. It takes about 200 ms, and this is a noticeable slowdown on activation or deactivation.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the third version, I happily rendered an audio session from the library. </font><font style="vertical-align: inherit;">After that, almost all users of all services that have SpeechKit integrated have been told how terribly unhappy they are. </font><font style="vertical-align: inherit;">Now we need to know that there is some kind of audio session that needs to be specifically configured for our SpeechKit.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The conclusion from this is this: anyway, try not to use global entities, but be prepared for the fact that your users will not always be happy with your solutions. </font></font><br></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Making users comfortable </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> How else can you help your users? </font></font><br><br><ul><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add logs: different levels, dynamic inclusion</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></li></ul><br>    ‚Äî   ,      debug-.       ,      ,    ,    ,    . <br><br><ul><li> <strong>    .</strong> <br></li></ul><br>   ,          ‚Äî     ,      .      , , ,  2%    iOS 8,      iOS 8.    ,               .        . <br><br>    ,     ,    ,       ,   -  .       iOS 7.  ,   ,    iOS 8      iOS 9.     iOS 7,      ,      ,              . <br><br> -    : ¬´       ,    ¬ª, ‚Äî ,        ,     . <br><br><ul><li> <strong>     .</strong> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is very ‚Äúnot very‚Äù for library developers. </font><font style="vertical-align: inherit;">In the release I want to release everything that's ready. </font><font style="vertical-align: inherit;">You made the features, fixed the bugs - now we'll put the whole pack and roll it into release. </font><font style="vertical-align: inherit;">Release is also a process. </font><font style="vertical-align: inherit;">For your users, this is not the case. </font><font style="vertical-align: inherit;">When they are in the process of testing their product and preparing it for release, they do not want to get you to build with new features that need to be further tested. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We really had cases when we rolled back some releases, divided them into pieces and rolled them out into pieces. </font><font style="vertical-align: inherit;">Then those teams for which we implemented the changes could take exactly the version in which there are small changes, but not all at once.</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This is really not very convenient for development, but minimal increment in versions will make your users a little bit happier. </font></font><br></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tests do not happen much </font></font><br></h3><br>      ,   .       . <br><img src="https://habrastorage.org/webt/jk/1n/gb/jk1ngbzjsq3q-9vrkndir038u2w.jpeg"><br> <strong></strong> , , ,      <strong> </strong>   .      ,   ,  ,       .     ,    . <br><br>     -   ,  ,   -,       ,    <strong> </strong> .        ,    , ‚Äî     .        ,       ‚Äî  .     ,  <strong> </strong> .           ,  , ,        . <br><br> ,      ‚Äî      <strong> ,   </strong> : , , ,      .        ,          . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will not protect against changes and the need to speed up the library, but it will help to figure out what went wrong. If you have graphics, it will help to monitor in real time what kind of functionality has added time delays or increased power consumption. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is almost never time for this, because this is not the library's functionality, this is not why you develop it. But this is what helps you maintain it in good condition and in good quality. </font></font><br><br> <a href="https://habr.com/company/yandex/blog/311046/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here</font></font></a>  ,        .      . ,   ,      ,      SpeechKit   .   ,     .     , ,      ,      ,      . <br><br>    ,     ,    ,       . ,      ,     :  ,   - ,   .    ,     ,   .      -  ,    , ‚Äî   .      ,    . <br><br>        ,    .   ,  .     ,    ,           ,      . <br><a name="deploy"></a><br><h2>  Launch </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally we come up the last important part - this is the launch. </font><font style="vertical-align: inherit;">The code is written, a good API is designed so that users are comfortable. </font><font style="vertical-align: inherit;">Now how is it all release a release. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will start with local releases for users inside Yandex. </font><font style="vertical-align: inherit;">The scheme here is the same as in the development of a regular application: regular, monthly or weekly releases. </font></font><br><img src="https://habrastorage.org/webt/by/kz/vj/bykzvjvcxhseq5viva1mcy8gwno.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The process consists of the usual stages, but when developing the library, each of these items has its own peculiarities.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Planning </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For me, this is the most painful part, because the library has several product teams. In a typical application, there is one product manager who sets the tasks that the team prioritizes and one by one begins to do. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there are several product commands, then each of them receives requests that must be processed in real time. I will give advice: if there is a person who knows how to deal with a multitude that arrives at one moment, tasks, try to take him to your team. Because there must be someone between all external managers and development - the one who will take over the functionality of prioritizing tasks.</font></font><br><br>       SpeechKit ,        , , .  ,    ,  -         .       ,       ‚Äî   .    ,      n .        ,      .          ,         ,    -   . <br><br><h3>  Development <br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Development, as in any application, usually begins as in a startup: we just work day and night, all these processes are not important to us. Then words about Agile-methodology are recalled and the construction of team work processes begins. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After we worked as a startup, we realized that there is a problem - unpredictability. No one could say exactly what features and when they will be launched. And it was very important! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then we decided to try </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Scrum</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . He really helped, we began to plan a number of tasks, implement them, release them. That is, we sort of coped with the task of making releases predictable. I say ‚Äúsort of like,‚Äù because we should not forget about the problem of several product teams.</font></font><br><br> Scrum  ,    ,  ,  ‚Äî      ‚Äî       , .     .      ‚Äî      ,        - . ,     ?  ,      : ¬´,         ,    ,         ¬ª.  ,       ,   - ,      ,  Scrum  .    ! ,       . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we have switched to a kind of kanban. There is a board with tasks that are set in order of priority, and we just take the upper tasks. On the one hand, we lost in the predictability of our release. Now we cannot say to the teams using our library that if the task hit the board, then it will definitely be in the next release. But then we can say for sure that the most important tasks will fall into the release. Now it is more important for us.</font></font><br><br><h3>  Support <br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth remembering that when you release a release it is not just one version that you sent and that someone took to use. Perhaps the changes you made in this release are also needed in other versions used by other teams. This is what I said about the minimum increment of versions. You can not tell your users: "We fixed the error in version 4, and you have version 3 - just go to the fourth." Sometimes it is possible to do this, but it is better not to abuse it. If there are any bugs or minor additions in the release, look at who has what versions and </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">release the fixes for all versions</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> that are currently being used. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From here follows the next point - </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">all your releases should be fast.</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Configure Continuous Integration so that you can really press one big red button and send to those versions you need, because there </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">will be a lot of releases</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Prioritize it </font></font><br></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A little bit about how we solved the problem with prioritizing tasks. I will highlight two types of tasks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grocery tasks.</font></font></strong> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Everything is clear here - first of all you need to look at the </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">importance for the company</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . If Arkady had somehow come to us and asked for a killer feature to do for Yandex, we would, of course, have left everything and would have done it. Although he never did. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The release time of other commands is</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an important parameter for the priority of product tasks. If one feature is needed in a month, and another in a week, then it seems obvious what to do. But do not forget to warn the team that is waiting for the first feature that they have begun to do something more high priority. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wishlist users.</font></font></strong> <br><br>       ,  ,   ,   ‚Äî ,      ,  ,    ,    ,    ! <br><br>    .  , <strong>   </strong> .        ,  ,    -,     . <br><br>        ‚Äî <strong>   </strong> .       SpeechKit   .  ,  ,    ‚Äî ,   - .      ‚Äî   ,   -     . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We look further, </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">as far as it will simplify life of the user</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">If the work leads to the fact that the user instead of 4 lines of code causes 2, it seems that this is not quite the right approach to prioritization. </font><font style="vertical-align: inherit;">If a huge canvas of code is replaced by one call, or it becomes possible to do something that could not be done before, then we take it on the board. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last is </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">how long to implement it</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">When a feature is interesting, it‚Äôs cool, but to make it a month, you need to carefully weigh everything.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Documentation. </font></font> It.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seriously </font></font><br></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Especially for the library, because it is used by someone who did not write this code. </font><font style="vertical-align: inherit;">Therefore, be sure to add </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation in the code</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It should be written in files so that people can open, read, view help and see how to use all this. </font></font><br><img src="https://habrastorage.org/webt/a8/ip/yi/a8ipyiozxkbcgk_-fr0fuk8a9hi.jpeg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add a </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quick start</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We are all looking for libraries like this: we find something, take a piece of code from GitHub, insert it to ourselves, launch it. </font><font style="vertical-align: inherit;">Works - hurray, does not work - we look further. </font><font style="vertical-align: inherit;">Having a quick start in the documentation will help to be closer to the users, your library will be easier to integrate and understand what it can. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After that, give </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">examples of using</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> so that you can understand how to do something more tricky and complex with your library, understand how to set up parameters, calls, etc. </font></font><br><br><h2>   <br></h2><br>  ,     ,    : <br><br><ul><li> <strong>.</strong>    ,        .   -   ,    ,    . <br></li><li> <strong></strong> .      ,      .      ,  OpenSource ,  ,    ,    ,      . </li><li> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Support. </font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remember that support will fall entirely on your shoulders. </font><font style="vertical-align: inherit;">You will not have the first or second line, which will explain to users what to transfer to the function. </font><font style="vertical-align: inherit;">This is all you do. </font><font style="vertical-align: inherit;">My user support for SpeechKit sometimes takes more than half the working time.</font></font><br></li></ul><br><h1>  Results <br></h1><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Do not allow users to break you, consider this in your API. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Write code that will ease the lives of your users, and not only will perform the necessary functionality. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The release cycle should be adjusted to several commands. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Remember that your library will definitely change someone's life for the better :) You do the work for someone, your code can be reused. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yandex.SpeachKit on GitHub for </font></font><a href="https://github.com/yandexmobile/yandex-speechkit-ios"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , for </font></font><a href="https://github.com/yandexmobile/yandex-speechkit-android"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and </font><font style="vertical-align: inherit;">Mobile SDK </font></font><a href="https://tech.yandex.ru/speechkit/mobilesdk/doc/intro/speechkit-mobilesdk-about-docpage/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documentation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><blockquote> <a href="http://appsconf.ru/moscow/2019">AppsConf</a> ‚Äî       ‚Äî    <b>22  23  2019 </b> ,      ,    <a href="https://conf.ontico.ru/lectures/propose%3Fconference%3Dac2019"> </a>  . <br><br>          <a href="https://habr.com/company/oleg-bunin/blog/429910/"></a>  . , ,     . <br></blockquote></div><p>Source: <a href="https://habr.com/ru/post/429912/">https://habr.com/ru/post/429912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429898/index.html">DMS (Dealership Management System) - Implementation of Information EcoSystems for Dealer Networks Management</a></li>
<li><a href="../429902/index.html">Page Rank in the Web 2.0 era - Part 1</a></li>
<li><a href="../429904/index.html">Funny and sad stories about the development of computer games</a></li>
<li><a href="../429908/index.html">How to use korutiny in prode and sleep well at night</a></li>
<li><a href="../429910/index.html">AppsConf Rises</a></li>
<li><a href="../429914/index.html">OpenSceneGraph: Scene graph and smart pointers</a></li>
<li><a href="../429916/index.html">How to build and build</a></li>
<li><a href="../429918/index.html">Intel Virtual World. Part 2: SMP</a></li>
<li><a href="../429920/index.html">The tragicomedy in NaN acts: how we made the game on JS and released it on Steam</a></li>
<li><a href="../429922/index.html">How to turn a simple project into unfinished or cutting off all unnecessary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>