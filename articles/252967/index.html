<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to configure antifraud rules on user geography</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I had to replenish my wallet in Eleksnet with Alfa-Bank's credit card ‚Äî a standard procedure that I have already successfully completed seve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to configure antifraud rules on user geography</h1><div class="post__text post__text-html js-mediator-article">  Recently, I had to replenish my wallet in Eleksnet with Alfa-Bank's credit card ‚Äî a standard procedure that I have already successfully completed several times.  As usual, after logging in to the wallet and entering the card data instead of the usual success message, I received the following error: <br><br><img src="https://habrastorage.org/files/2ad/f89/aaa/2adf89aaa83641079896fd4322ad6f29.png"><br><br>  Oops.  "Anti-black list"!  I forgot that this time I am abroad. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I spent some time on unsuccessful attempts to pay, but alas.  Out of desperation, I even tried to do this operation through Tor, but it certainly did not help (I wasted time to figure out how to quickly set up output nodes from only certain countries in Tor settings, but I didn‚Äôt want to), but I didn‚Äôt want a couple of times got a second interesting error with the following text: <br><br>  <b>"User IP address country does not match BIN country"</b> <br><br>  That is, this time the discontent of the antifraud system of Eleksnet caused a mismatch between the country of the IP address of my foreign provider and the country of the card issuer. <br><a name="habracut"></a><br>  The saddest thing is that the error message does not give me, as a user, any choice but to try to repeat the operation or abandon it.  And the window on the screen at the same time does not even contain any recommendations or references - where to run, to whom to write and what to do so that everything would work out.  And surely it will finish off those users who do not know English, since everything in the window is written in Russian, only an error message in English itself. <br><br>  Actually, why is it all so bad? <br><br>  From the above errors, it is possible to draw conclusions about the structure of the antifraud rules of Eleksnet (at least those that work on the card replenishment operation): <br><br><ul><li>  There is a certain list of allowed countries, most likely it is Russia and the CIS countries.  Accordingly, replenishment operations are allowed only from the IP addresses of these countries, all others are prohibited. </li><li>  Another rule checks the coincidence of the user's IP geography and the country of the issuer.  Here are possible options: it is likely that a common geographical space has been made for Russia and the CIS (that is, it is possible to replenish an account from Ukraine with a Russian map, although I did not check it). </li><li>  Worse, if the logic is stricter: the country of the user must necessarily coincide with the country of the issuer and nothing else.  Why, then, did I get the second error, while the antifraud did not swear at the anti-black list?  It is here that suspicions creep in that at this moment the IP address of the Tor output node may have just turned out to be from the allowed country, but the country itself with Russia (the card issuer) did not match.  Guard! </li></ul><br><br>  As a result, there is a system of several simple antifraud-rules, which, I think, both successfully fighting fraud and complicate the lives of normal users like me.  It's all about how not to do it. <br><br>  Now, actually, how it was possible (and necessary) to do it right. <br><br><ul><li>  First of all, I am not a new customer of Eleksnet.  More precisely, I have already used the same card several times to replenish the same wallet.  That is, my pattern of payment behavior is very simple and transparent: about once a month I replenish my wallet from the same card.  It is somewhat strange to suppose that Froder will now replenish my wallet from my stolen card.  Hence, the first correct step: it is necessary to memorize both the map and operations on it, and apply strict policies only when a new map appears in the system (that is, one about which nothing is known and it is fixed for the first time).  If the card does the same typical action (in this case replenishes the wallet) for the fifth time in a row, then most likely it is the cardholder who does this and needs to soften the anti-fraud policy and allow the specific operation regardless of geographic location. and card issuer.  Another option is to ‚Äúdance‚Äù from the wallet and memorize the history of payment behavior from the point of view of the wallet (from where it replenishes, where it pays or transfers, etc.). </li><li>  You also need to remember what the wallet in the Eleksnet system is.  The wallet number is essentially the phone number of its owner.  And during authorization, you must specify a pair of phone number + password to access the wallet issued during registration.  But after all, Eleksnet perfectly knows how to send SMS on any action in the system, in my case I receive SMS both when replenishing the wallet and when paying with it.  So what is the case, in the opinion of Eleksnet, of a suspicious operation, simply to request its confirmation via SMS?  This is a common standard practice that is used in a variety of payment systems (enhanced, or two-factor authorization, such as Yandex.Money) and in banks (the most obvious example here is 3D Secure authorization): at the time of the operation, the user receives an SMS with code , which enters on the page of its payment operator, thereby confirming the transaction.  And what's more, the user of Eleksnet informs his phone number immediately upon registration and later this number is equal to the number of the user's wallet, so all that remains to be done is to send the SMS to the user and wait for the confirmation of the operation. </li><li>  If various blacklists are present in the antifraud system (this is normal), then there must also be a flexible logic for their use, and for this, many factors must be taken in addition to the blacklist itself.  The approach "in the forehead" (to prohibit everything, to allow everything to others) is inconvenient, inflexible, and ruins the lives of ordinary users at the first opportunity. </li><li>  And finally, if the anti-fraud rules worked and banned the operation, then of course it is not necessary to tell the user why this happened (remember that this could be a froder).  But be sure to tell you how to solve the problem!  (since this is what is important for an honest user who has fallen under the <s>horse</s> antifraud).  Namely, where to write or call him, what simple system settings to tweak and so on, and all this in human language.  In my case, the ideal option would be a message like: <i>‚ÄúSorry!</i>  <i>The operation fails.</i>  <i>We do not recognize you, probably, you are trying to replenish the wallet differently than usual.</i>  <i>We will now send you the code via SMS, enter it in the box below, so that we can make sure that you are you</i> . <i>‚Äù</i> </li></ul><br><br>  At a minimum, these simple steps could greatly reduce the number of innocently suffering customers who had the negligence to go abroad, and only as a result of their geographical movement were they unable to use the service. <br><br>  If you go further along the path of improving antifraud rules, you can add more complex logic, for example, take into account the speed of user movement between countries (payment from different countries every other day is much more likely than five minutes apart), take into account the number of attempts to perform an operation ( including for different cards, thereby preventing the enumeration of card numbers), the fact of using proxy servers or anonymizers, and so on. <br><br>  Here it is important to add that when I committed further actions with the wallet of Elefsnet‚Äôs antifraud, I didn‚Äôt interfere: after I replenished my account with a friend in Russia (I had to give him step-by-step instructions on Skype), I calmly managed to withdraw money from my wallet at the expense of another Russian bank, still being abroad.  And this also raises questions.  Indeed, from the point of view of the antifraud policy, it is important to stop not only suspicious attempts to use bank cards, but also, perhaps, atypical manipulations with the funds on the wallet itself, and above all it concerns risky areas of payment, in particular, cash withdrawals (and this is the ultimate goal any froder, and the sooner the better!).  I can justify all this only with a small amount of operation (within a few thousand rubles). <br><br>  As a result, the chain of my actions was as follows: <br><br><ul><li>  Several times I replenish my wallet from a bank card from time to time, while in Moscow - no problems. </li><li>  Now I am replenishing my wallet from the same Russian card from abroad - several attempts and each time the replenishment is blocked by anti-fraud rules. </li><li>  I'm trying to do the same through Tor (obviously, the IP address could easily be different from the original country) - the same thing, the operation is impossible. </li><li>  I appeal to a friend in Moscow for help and send him detailed instructions via Skype - finally the operation is over and the wallet is replenished. </li><li>  Immediately after that, I withdraw money from my wallet to a card of another Russian bank, geographically being still there, abroad, from where I could not replenish my wallet.  No questions, the operation was successful, the money withdrawn. </li></ul><br><br>  The moral of this story is this: people move around the world, but for their financial services this should not be a source of problems, such as blocking bank cards, the inability to replenish an electronic wallet or pay for their own Moscow mobile phone while in the other hemisphere. <br><br>  Fight fraud right! </div><p>Source: <a href="https://habr.com/ru/post/252967/">https://habr.com/ru/post/252967/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252955/index.html">Vesta CP: Installing Ruby and Python Web Applications</a></li>
<li><a href="../252957/index.html">Powershell for testers</a></li>
<li><a href="../252959/index.html">Microsoft has released EMET 5.2</a></li>
<li><a href="../252963/index.html">How to steal money that is not. Or something new about cryptocurrencies</a></li>
<li><a href="../252965/index.html">Neuroplasticity in artificial neural networks</a></li>
<li><a href="../252969/index.html">Localization of Android applications using Google Sheets</a></li>
<li><a href="../252971/index.html">Building a Nodejs Modular System</a></li>
<li><a href="../252973/index.html">Proper increase in disk size in a virtual machine</a></li>
<li><a href="../252975/index.html">Create your Amazon-like navigation menu</a></li>
<li><a href="../252977/index.html">Time is money =?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>