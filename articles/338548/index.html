<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to distinguish birds from flowers. Or flowers from birds</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As a weekend program, I wanted to play around with a kind of ‚Äúneural‚Äù network (a spoiler - there are no neurons in it). And so that it would not be pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to distinguish birds from flowers. Or flowers from birds</h1><div class="post__text post__text-html js-mediator-article">  As a weekend program, I wanted to play around with a kind of ‚Äúneural‚Äù network (a spoiler - there are no neurons in it).  And so that it would not be painfully painful for hours <s>spent</s> aimlessly, I thought that we feed him in vain, let him benefit, let this grid disassemble the home photo archive and at least arrange the photos of flowers into a separate folder. <br><br><h2>  The simplest network </h2><br><img src="https://habrastorage.org/webt/59/d8/d4/59d8d492bd6ce006546399.jpeg" title="How to Tell the Birds from the Flowers. A Manual of Flornithology for Beginners, Robert Williams Wood, 1907" align="right" height="400">  The simplest network was found in the article " <a href="https://habrahabr.ru/post/271563/">Neural network in 11 lines in Python</a> " (this is a translation from <a href="https://habrahabr.ru/users/sly_g/" class="user_link">SLY_G of the</a> article " <a href="http://iamtrask.github.io/2015/07/12/basic-python-network/">A Neural Network in 11 lines of Python (Part 1)</a> ", in general the author has another continuation " <a href="http://iamtrask.github.io/2015/07/27/python-network-part2/">A Neural Network in 13 lines of Python (Part 2 - Gradient Descent)</a> ", but the first article is enough here). <br><br>  Brief description of the grid - there is exactly one dependency in this network - <a href="http://www.numpy.org/">NumPy</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The set of inputs is treated as a matrix. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>X</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.98ex" height="2.057ex" viewBox="0 -780.1 852.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-58" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> X </script>  , multiple outputs - as a vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>y</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.155ex" height="1.817ex" viewBox="0 -520.7 497.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> y </script>  .  In the original article, the network multiplies the input matrix, in dimension (4 x 3), by the input weights matrix. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi><mi>y</mi><mi>n</mi><mn>0</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.803ex" height="2.298ex" viewBox="0 -728.2 2068 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6E" x="967" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-30" x="1567" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>y</mi><mi>n</mi><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-3"> syn0 </script>  (3 x 4), applies the transfer function to the product, and gets the layer matrix <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>l</mi><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.856ex" height="2.057ex" viewBox="0 -780.1 799 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="298" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-4"> l1 </script>  (4 x 4). <br><a name="habracut"></a><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>X&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{bmatrix}&amp;#xA0;1&amp;#xA0;&amp;amp;&amp;#xA0;2&amp;#xA0;&amp;amp;&amp;#xA0;3&amp;#xA0;&amp;amp;&amp;#xA0;4&amp;#xA0;\\&amp;#xA0;5&amp;#xA0;&amp;amp;&amp;#xA0;6&amp;#xA0;&amp;amp;&amp;#xA0;7&amp;#xA0;&amp;amp;&amp;#xA0;8&amp;#xA0;\\&amp;#xA0;9&amp;#xA0;&amp;amp;&amp;#xA0;10&amp;#xA0;&amp;amp;&amp;#xA0;11&amp;#xA0;&amp;amp;&amp;#xA0;12&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{bmatrix}&amp;#xA0;\\&amp;#xA0;y&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{bmatrix}&amp;#xA0;1&amp;#xA0;\\&amp;#xA0;2&amp;#xA0;\\&amp;#xA0;3&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{bmatrix}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">X&nbsp;=&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;1&nbsp;&amp;&nbsp;2&nbsp;&amp;&nbsp;3&nbsp;&amp;&nbsp;4&nbsp;\\&nbsp;5&nbsp;&amp;&nbsp;6&nbsp;&amp;&nbsp;7&nbsp;&amp;&nbsp;8&nbsp;\\&nbsp;9&nbsp;&amp;&nbsp;10&nbsp;&amp;&nbsp;11&nbsp;&amp;&nbsp;12&nbsp;\&nbsp;end&nbsp;{bmatrix}&nbsp;\\&nbsp;y&nbsp;=&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;1&nbsp;\\&nbsp;2&nbsp;\\&nbsp;3&nbsp;\&nbsp;end&nbsp;{bmatrix}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>X&nbsp;=&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;1&nbsp;&amp;&nbsp;2&nbsp;&amp;&nbsp;3&nbsp;&amp;&nbsp;4&nbsp;\\&nbsp;5&nbsp;&amp;&nbsp;6&nbsp;&amp;&nbsp;7&nbsp;&amp;&nbsp;8&nbsp;\\&nbsp;9&nbsp;&amp;&nbsp;10&nbsp;&amp;&nbsp;11&nbsp;&amp;&nbsp;12&nbsp;\&nbsp;end&nbsp;{bmatrix}&nbsp;\\&nbsp;y&nbsp;=&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;1&nbsp;\\&nbsp;2&nbsp;\\&nbsp;3&nbsp;\&nbsp;end&nbsp;{bmatrix}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> X = \ begin {bmatrix} 1 & 2 & 3 & 4 \\ 5 & 6 & 7 & 8 \\ 9 & 10 & 11 & 12 \ end {bmatrix} \\ y = \ begin {bmatrix} 1 \\ 2 \\ 3 \ end {bmatrix} </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>X</mi><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>0</mn><mo stretchy=&quot;false&quot;>)</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>l</mi><mn>1</mn></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="26.426ex" height="2.66ex" viewBox="0 -832 11378 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-58" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="2042" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="2404" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="2749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="3628" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="4094" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="4564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="5033" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6E" x="5531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-30" x="6131" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="6632" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="7271" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="7617" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-70" x="8495" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="8999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="9297" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="9643" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="10109" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="10579" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="10877" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>X</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>0</mn><mo stretchy="false">)</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>l</mi><mn>1</mn></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> f (X \ times syn0) \ implies l1 </script></p><br>  Next layer <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>l</mi><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.856ex" height="2.057ex" viewBox="0 -780.1 799 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="298" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-7"> l1 </script>  multiplied by the output weights matrix <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi><mi>y</mi><mi>n</mi><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.803ex" height="2.298ex" viewBox="0 -728.2 2068 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6E" x="967" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="1567" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>y</mi><mi>n</mi><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-8"> syn1 </script>  (4 x 1), is also passed through the function, and a layer is obtained <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>l</mi><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.856ex" height="2.057ex" viewBox="0 -780.1 799 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-32" x="298" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>l</mi><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-9"> l2 </script>  (4 x 1), which is the result of the network. <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mi>l</mi><mn>1</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>l</mi><mn>2</mn><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>y</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="35.72ex" height="2.66ex" viewBox="0 -832 15379.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="1238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="1989" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="2350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="2696" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="3574" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="4041" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="4510" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="4980" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6E" x="5477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="6078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="6578" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="7218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="7563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-70" x="8442" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="8945" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="9244" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="9589" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="10056" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="10525" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-32" x="10824" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="11574" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="11920" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-70" x="12798" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="13302" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="13600" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="13946" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="14412" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="14882" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>l</mi><mn>1</mn><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>1</mn><mo stretchy="false">)</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>l</mi><mn>2</mn><mtext>&nbsp;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>y</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> f (l1 \ times syn1) \ implies l2 \ implies y </script></p>  Total, omitting the scalar transfer function, the network implements two matrix multiplications: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>X</mi><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>0</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>1</mn><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>y</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.878ex" height="2.419ex" viewBox="0 -780.1 14586.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-58" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="1102" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="1464" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="1809" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="2688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="3154" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="3624" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="4093" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6E" x="4591" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-30" x="5191" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="5942" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="6303" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="6649" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="7527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="7994" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="8463" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="8933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6E" x="9430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="10031" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="10781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="11127" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-70" x="12005" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6C" x="12509" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="12807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="13153" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="13619" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-79" x="14089" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>X</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>0</mn><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>y</mi><mi>n</mi><mn>1</mn><mtext>&nbsp;</mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>s</mi><mi>y</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> X \ times syn0 \ times syn1 \ implies y </script></p>  The consequence of this, according to the rules of matrix multiplication, is that one of the dimensions does not change during the operation of the network. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>4</mn><mo>&amp;#x2217;</mo><mn>3</mn><mo stretchy=&quot;false&quot;>)</mo><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mn>3</mn><mo>&amp;#x2217;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><mn>4</mn><mo>&amp;#x2217;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="28.522ex" height="2.66ex" viewBox="0 -832 12280.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-34" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-33" x="1834" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="2335" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="2974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="3336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="3681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="4560" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="5026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="5496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-33" x="5885" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="6608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="7331" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="7831" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-3D" x="8499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="9555" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-34" x="9944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="10667" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31" x="11390" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="11890" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mn>4</mn><mo>‚àó</mo><mn>3</mn><mo stretchy="false">)</mo><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mn>3</mn><mo>‚àó</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>4</mn><mo>‚àó</mo><mn>1</mn><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12"> (4 * 3) \ times (3 * 1) = (4 * 1) </script>  and get at the output of a single number is impossible. <br><br>  Therefore, I have slightly modified the code from the article, added the transposition after multiplication and work with an arbitrary number of layers in the grid.  This gave me the opportunity to receive any combination of dimensions of inputs and outputs. <br><br>  For example, if it is necessary to have a matrix (3 x 4) at the input, and the output is a single number, then we add two matrices of synapses (4 x 1) and (3 x 1): <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>((\&amp;#xA0;begin&amp;#xA0;{bmatrix}&amp;#xA0;1&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;\\&amp;#xA0;0&amp;#xA0;&amp;amp;&amp;#xA0;1&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;\\&amp;#xA0;0&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;&amp;amp;&amp;#xA0;1&amp;#xA0;&amp;amp;&amp;#xA0;0&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{bmatrix}&amp;#xA0;\&amp;#xA0;times&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{bmatrix}&amp;#xA0;0&amp;#xA0;\\&amp;#xA0;0&amp;#xA0;\&amp;#xA0;\&amp;#xA0;1&amp;#xA0;\\&amp;#xA0;1&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{bmatrix})&amp;#xA0;^&amp;#xA0;T&amp;#xA0;\&amp;#xA0;times&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{bmatrix}&amp;#xA0;0&amp;#xA0;\\&amp;#xA0;1&amp;#xA0;\\&amp;#xA0;1&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{bmatrix})&amp;#xA0;^&amp;#xA0;T&amp;#xA0;=&amp;#xA0;[1]&amp;#xA0;\\&amp;#xA0;(((3&amp;#xA0;*&amp;#xA0;4)&amp;#xA0;\&amp;#xA0;times&amp;#xA0;(4&amp;#xA0;*&amp;#xA0;1))&amp;#xA0;^&amp;#xA0;T&amp;#xA0;\&amp;#xA0;times&amp;#xA0;(3&amp;#xA0;*&amp;#xA0;1))&amp;#xA0;^&amp;#xA0;T&amp;#xA0;=&amp;#xA0;(1&amp;#xA0;*&amp;#xA0;1)&amp;#xA0;\\</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">((\&nbsp;begin&nbsp;{bmatrix}&nbsp;1&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;\\&nbsp;0&nbsp;&amp;&nbsp;1&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;\\&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;1&nbsp;&amp;&nbsp;0&nbsp;\&nbsp;end&nbsp;{bmatrix}&nbsp;\&nbsp;times&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;0&nbsp;\\&nbsp;0&nbsp;\&nbsp;\&nbsp;1&nbsp;\\&nbsp;1&nbsp;\&nbsp;end&nbsp;{bmatrix})&nbsp;^&nbsp;T&nbsp;\&nbsp;times&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;0&nbsp;\\&nbsp;1&nbsp;\\&nbsp;1&nbsp;\&nbsp;end&nbsp;{bmatrix})&nbsp;^&nbsp;T&nbsp;=&nbsp;[1]&nbsp;\\&nbsp;(((3&nbsp;*&nbsp;4)&nbsp;\&nbsp;times&nbsp;(4&nbsp;*&nbsp;1))&nbsp;^&nbsp;T&nbsp;\&nbsp;times&nbsp;(3&nbsp;*&nbsp;1))&nbsp;^&nbsp;T&nbsp;=&nbsp;(1&nbsp;*&nbsp;1)&nbsp;\\</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>((\&nbsp;begin&nbsp;{bmatrix}&nbsp;1&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;\\&nbsp;0&nbsp;&amp;&nbsp;1&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;\\&nbsp;0&nbsp;&amp;&nbsp;0&nbsp;&amp;&nbsp;1&nbsp;&amp;&nbsp;0&nbsp;\&nbsp;end&nbsp;{bmatrix}&nbsp;\&nbsp;times&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;0&nbsp;\\&nbsp;0&nbsp;\&nbsp;\&nbsp;1&nbsp;\\&nbsp;1&nbsp;\&nbsp;end&nbsp;{bmatrix})&nbsp;^&nbsp;T&nbsp;\&nbsp;times&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;0&nbsp;\\&nbsp;1&nbsp;\\&nbsp;1&nbsp;\&nbsp;end&nbsp;{bmatrix})&nbsp;^&nbsp;T&nbsp;=&nbsp;[1]&nbsp;\\&nbsp;(((3&nbsp;*&nbsp;4)&nbsp;\&nbsp;times&nbsp;(4&nbsp;*&nbsp;1))&nbsp;^&nbsp;T&nbsp;\&nbsp;times&nbsp;(3&nbsp;*&nbsp;1))&nbsp;^&nbsp;T&nbsp;=&nbsp;(1&nbsp;*&nbsp;1)&nbsp;\\</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-13"> ((\ begin {bmatrix} 1 & 0 & 0 & 0 \\ 0 & 1 & 0 & 0 \\ 0 & 0 & 1 & 0 \ end {bmatrix} \ times \ begin {bmatrix} 0 \\ 0 \ \ 1 \\ 1 \ end {bmatrix}) ^ T \ times \ begin {bmatrix} 0 \\ 1 \\ 1 \ end {bmatrix}) ^ T = [1] \\ (((3 * 4) \ times (4 * 1)) ^ T \ times (3 * 1)) ^ T = (1 * 1) \\ </script></p>  Or, say, you can convert an input matrix (10 x 8) to an output (4 x 5): <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mo stretchy=&quot;false&quot;>(</mo><mo stretchy=&quot;false&quot;>(</mo><mo stretchy=&quot;false&quot;>(</mo><mn>10</mn><mo>&amp;#x2217;</mo><mn>8</mn><mo stretchy=&quot;false&quot;>)</mo><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mn>8</mn><mo>&amp;#x2217;</mo><mn>5</mn><mo stretchy=&quot;false&quot;>)</mo><msup><mo stretchy=&quot;false&quot;>)</mo><mi>T</mi></msup><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo stretchy=&quot;false&quot;>(</mo><mn>10</mn><mo>&amp;#x2217;</mo><mn>4</mn><mo stretchy=&quot;false&quot;>)</mo><msup><mo stretchy=&quot;false&quot;>)</mo><mi>T</mi></msup><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><mn>4</mn><mo>&amp;#x2217;</mo><mn>5</mn><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.01ex" height="3.021ex" viewBox="0 -987.6 21532.1 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="779" y="0"></use><g transform="translate(1168,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="2391" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-38" x="3114" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="3614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="4254" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="4615" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="4961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="5839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="6306" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="6775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-38" x="7165" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="7888" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-35" x="8610" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="9111" y="0"></use><g transform="translate(9500,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-54" x="550" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-74" x="10738" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-69" x="11100" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-6D" x="11445" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-65" x="12324" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-73" x="12790" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="13260" y="0"></use><g transform="translate(13649,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-30" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="14872" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-34" x="15595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="16095" y="0"></use><g transform="translate(16485,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMATHI-54" x="550" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-3D" x="17750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-28" x="18807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-34" x="19196" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-2217" x="19919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-35" x="20642" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/338548/&amp;xid=17259,15700022,15700043,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgOnfzaRyAsnlF_FPR_5G2ZgKLiew#MJMAIN-29" x="21142" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mn>10</mn><mo>‚àó</mo><mn>8</mn><mo stretchy="false">)</mo><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mn>8</mn><mo>‚àó</mo><mn>5</mn><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mo stretchy="false">(</mo><mn>10</mn><mo>‚àó</mo><mn>4</mn><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo>=</mo><mo stretchy="false">(</mo><mn>4</mn><mo>‚àó</mo><mn>5</mn><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-14"> (((10 * 8) \ times (8 * 5)) ^ T \ times (10 * 4)) ^ T = (4 * 5) </script></p><br>  The resulting code is: <br><br><div class="spoiler">  <b class="spoiler_title">nnmat.py</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonlin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x,deriv=False)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(deriv==<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (x)*(<span class="hljs-number"><span class="hljs-number">1</span></span>-(x)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/(<span class="hljs-number"><span class="hljs-number">1</span></span>+np.exp(-x)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fmax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x,deriv=False)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(deriv==<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.33</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> np.maximum(x,<span class="hljs-number"><span class="hljs-number">0</span></span>)/<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NN</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, shapes, func=nonlin)</span></span></span><span class="hljs-function">:</span></span> self.func = func self.shapes = shapes self.syns = [ <span class="hljs-number"><span class="hljs-number">2</span></span>*np.random.random((shapes[i<span class="hljs-number"><span class="hljs-number">-1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>],shapes[i][<span class="hljs-number"><span class="hljs-number">0</span></span>])) - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, len(shapes)) ] self.layers = [ np.zeros(shapes[i]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, len(shapes)) ] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">learn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, X, y, cycles)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(cycles): res = self.calc(X) prev = y - res <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.layers)<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>): l_delta = (prev*self.func(self.layers[i], <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)).T <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.syns[i] += XTdot(l_delta) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: prev = l_delta.dot(self.syns[i].T) self.syns[i] += self.layers[i<span class="hljs-number"><span class="hljs-number">-1</span></span>].T.dot(l_delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.layers[<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,X)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(self.syns)): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i == <span class="hljs-number"><span class="hljs-number">0</span></span>: self.layers[i] = self.func(np.dot(X,self.syns[i])).T <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.layers[i] = self.func(np.dot(self.layers[i<span class="hljs-number"><span class="hljs-number">-1</span></span>],self.syns[i])).T <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.layers[<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: X = np.array([ [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>],[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>],[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>],[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>] ]) y = np.array([[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]]) print(<span class="hljs-string"><span class="hljs-string">'X ='</span></span>,X) print(<span class="hljs-string"><span class="hljs-string">'y ='</span></span>,y) nn = NN((X.shape, (y.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], X.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), y.shape)) nn.learn(X,y,<span class="hljs-number"><span class="hljs-number">1000</span></span>) print(<span class="hljs-string"><span class="hljs-string">'Result ='</span></span>,nn.calc(X).round(<span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre> <br>  Result of work: <br><br><pre> <code class="bash hljs">X = [[0 0 1] [0 1 1] [1 0 1] [1 1 1]] y = [[0 1 1 0]] Result = [[ 0.02 0.99 0.98 0.02]]</code> </pre> </div></div><br><h2>  Upload photos </h2><br>  So, there is a grid, now you need to figure out how to load photos.  Photos are on disk, mostly in JPG, but there are other formats.  Their sizes are also different, depending on what they were shooting and how they were processed, from 3 Mpx to 16 Mpx. <br><br>  At first I tried to upload photos via Qt, a QImage class, it can work with different formats, provides conversion and gives direct access to the image data.  Surely there is a simpler way in Python, but I didn‚Äôt have to figure it out with a QImage.  In order for the network to work with a picture, it should be transferred to a monochrome image and reduced to a standard size. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file, imageSize)</span></span></span><span class="hljs-function">:</span></span> img = QImage(file) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> img.isNull(): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> img = img.convertToFormat(QImage.Format_Grayscale8) img = img.scaled(imageSize[<span class="hljs-number"><span class="hljs-number">0</span></span>],imageSize[<span class="hljs-number"><span class="hljs-number">1</span></span>],Qt.IgnoreAspectRatio) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img</code> </pre><br>  To transfer to the grid, you need to convert the image to the numpy.ndarray matrix.  QImage.bits () gives a pointer to image data, where each byte corresponds to a pixel.  In NumPy, there was a function called recarray, capable of making an array of records from the buffer, and it has a view method, which we will make the numpy.ndarray matrix without copying the data. <br><br><pre> <code class="python hljs"> srcBi = img.bits() srcBi.setsize(img.width() * img.height()) srcBy = bytes(srcBi) srcW, srcH = img.width(), img.height() srcArr = np.recarray((srcH, srcW), dtype=np.int8, buf=srcBy).view(dtype=np.byte,type=np.ndarray)</code> </pre><br><h2>  Network for images </h2><br>  The picture, although reduced, directly fed to the input of the network will be too costly - I have already said that the network does matrix multiplication, so even one training cycle will result in 400x400x400 = 64 million multiplications.  Experts recommend using <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%2591%25D1%2580%25D1%2582%25D0%25BE%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BD%25D0%25B5%25D0%25B9%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B5%25D1%2582%25D1%258C">convolution</a> .  Wikipedia has a wonderful illustration of her work: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/578/ba8/6d5/578ba86d5bfdd5c71c472f4bb4662429.gif"></div><br>  This animation shows that the dimension of the result is equal to the dimension of the original matrix.  But I‚Äôll simplify my life a bit, I‚Äôll not move by pixels, but break the image into pieces the same size as the input matrix, and apply the grid to them one by one.  In matrices, cutting a piece is quite simple: <br><br><pre> <code class="python hljs">srcArr[x:x+dw, y:y+dw]</code> </pre> <br>  The result of processing the pieces by the network is formed into a matrix of a smaller size; this matrix is ‚Äã‚Äãtransmitted to the input of the common network.  That is, there will be two networks - the first one works with pieces of the image, the second one with the result of the first network working on the pieces. <br><br>  Creating a primary network: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImgNN</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, shape, resultShape = </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">, imageSize = </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">400</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">,</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">400</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.resultShape = resultShape self.w = imageSize[<span class="hljs-number"><span class="hljs-number">0</span></span>] // shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] self.h = imageSize[<span class="hljs-number"><span class="hljs-number">1</span></span>] // shape[<span class="hljs-number"><span class="hljs-number">1</span></span>] self.net = NN([shape, (<span class="hljs-number"><span class="hljs-number">1</span></span>,shape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)]) self.shape = shape self.imageSize = imageSize</code> </pre><br>  Inside, self.net is created - the network itself, with the given size of the input shape matrix and with the output as an 1x1 elementary matrix.  Yes, it was possible to inherit from the NN network class, but it was a holiday, I wanted to quickly get the result, but the architecture was not yet settled.  Time to market beats in our hearts! <br><br>  Image Counting by First Network: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, srcArr)</span></span></span><span class="hljs-function">:</span></span> w = srcArr.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] // self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] h = srcArr.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>] // self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>] resArr = np.zeros(self.resultShape) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(w): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(h): a = srcArr[x:x+self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], y:y+self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a.shape != (self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]): <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x &gt;= self.resultShape[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y &gt;= self.resultShape[<span class="hljs-number"><span class="hljs-number">1</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> res = self.nn.calc(a) resArr[x,y] = res[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resArr</code> </pre><br>  At the output we have a resArr matrix, with a dimension equal to the number of pieces into which the image was divided.  This matrix is ‚Äã‚Äãpassed to the input of the second network, which will give the final result. <br><br><pre> <code class="python hljs"> y = np.array([[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]]) firstShape = (<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>) middleShape = (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>) imageSize = firstShape[<span class="hljs-number"><span class="hljs-number">0</span></span>]*middleShape[<span class="hljs-number"><span class="hljs-number">0</span></span>], firstShape[<span class="hljs-number"><span class="hljs-number">1</span></span>]*middleShape[<span class="hljs-number"><span class="hljs-number">1</span></span>] ... nn = ImgNN(firstShape, resultShape=middleShape, imageSize=imageSize) nn2 = NN([middleShape, (y.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], middleShape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), y.shape]) ... i = readImage(f, imageSize) mid = nn.calc(i) res = nn2.calc(mid)</code> </pre><br>  Here you have to ask me where I took the first line, and what it means: <br><br><pre> <code class="python hljs">y = np.array([[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]])</code> </pre> <br>  This is the expected result of the network in the event of a positive response, i.e.  if the network believes that the input image of the flower.  The dimension has chosen from the principle of ‚Äúneither a little nor a lot‚Äù - if we take the dimension of 1x1, then it is difficult to judge from one resulting number how much the network ‚Äúdoubts‚Äù as a result.  There is no sense to set a larger dimension too - it will not give more information.  An equal number of zeros and ones gives a clear guideline - the closer to it, the greater the coincidence.  If we take all the units or all the zeros, then the network will have an incentive to retrain - increase all factors or, accordingly, reset them to get the desired result regardless of the input data. <br><br><h2>  How to train a convolutional network? </h2><br>  I made a training set of my own photos, simply expanding them into two catalogs: <br>  <i>flowers</i> <br><br><img src="https://habrastorage.org/webt/59/cd/4b/59cd4b7287211208200072.png"><br><br>  and <i>noflowers</i> <br><br><img src="https://habrastorage.org/webt/59/cd/4b/59cd4b7284a41394520266.png"><br><br>  Paths to the pictures will collect in two arrays <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os fl = [e.path <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.scandir(<span class="hljs-string"><span class="hljs-string">'flowers'</span></span>)] nofl = [e.path <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.scandir(<span class="hljs-string"><span class="hljs-string">'noflowers'</span></span>)] all = fl+nofl</code> </pre><br>  Teaching simple networks is usually proposed, including in the original article, by the traditional method ‚Äî the <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%2580%25D0%25B0%25D1%2581%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BA%25D0%25B8">reverse propagation of error</a> .  But in order to apply this method to a convolutional network consisting of two elementary, it is necessary to ensure the end-to-end transmission of the accumulated error from the second network to the first.  In general, there are <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%2591%25D1%2580%25D1%2582%25D0%25BE%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BD%25D0%25B5%25D0%25B9%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2581%25D0%25B5%25D1%2582%25D1%258C">other methods</a> for convolutional networks.  I was too lazy to redo the working network, at least for the time being, so I decided to train the second network, and not to train the first one at all, leave it crammed when creating random values, reasoning that since the human eye nerves are not trained, then I have nothing to teach the primary network, "Looking" at the image. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> epoch <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>): print(<span class="hljs-string"><span class="hljs-string">'Epoch ='</span></span>, epoch) nn = ImgNN(firstShape, resultShape=middleShape, imageSize=imageSize) nn2 = NN([middleShape, (y.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], middleShape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), y.shape]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fl: i = readImage(f, imageSize) <span class="hljs-comment"><span class="hljs-comment"># nn.learn(i, yy, 1) mid = nn.calc(i) nn2.learn(mid, y, 1000)</span></span></code> </pre><br>  In each epoch, right after the training, I run the entire sample through the network and see what happened. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all: i = readImage(f, imageSize) mid = nn.calc(i) res = nn2.calc(mid) delta = abs(y-res) v = round(np.std(delta),<span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre><br>  If the network has learned correctly, then at its output there should be a value close to the given [[1,0,1,0]], if there is a flower at the entrance, and as different as possible from the specified one, for example [[0,1,0, 1]], if the entrance is not a flower.  The result is estimated, empirically I accepted a deviation from a successful result of no more than 0.2 - this is also a successful result, and the number of errors is considered.  From all the runs, choose the one where the least errors are made, and save the weights of the synapses of both grids to files.  Then these files can be used to load grids. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">0.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fl: fails += <span class="hljs-number"><span class="hljs-number">1</span></span> failFiles.append(f) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> v&lt;<span class="hljs-number"><span class="hljs-number">0.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> nofl: fails +=<span class="hljs-number"><span class="hljs-number">1</span></span> failFiles.append(f) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> minFails == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> fails &lt; minFails: minFails = fails lastSyns = nn.net.syns lastSyns2 = nn2.syns print(<span class="hljs-string"><span class="hljs-string">'fails ='</span></span>,fails, failFiles) print(<span class="hljs-string"><span class="hljs-string">'min ='</span></span>,minFails) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> minFails &lt;= <span class="hljs-number"><span class="hljs-number">1</span></span>: print(<span class="hljs-string"><span class="hljs-string">'found!'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(lastSyns)): np.savetxt(<span class="hljs-string"><span class="hljs-string">'syns_save%s.txt'</span></span>%i, lastSyns[i]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(len(lastSyns2)): np.savetxt(<span class="hljs-string"><span class="hljs-string">'syns2_save%s.txt'</span></span>%i, lastSyns2[i])</code> </pre><br><h2>  Though call it a rose, though not </h2><br>  Hopefully, I launch and ... wait ..., then wait another ..., and also ... I get complete nonsense - the grid does not learn: <br><br><div class="spoiler">  <b class="spoiler_title">Nothing happened</b> <div class="spoiler_text"> <code>flowers\178.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> flowers\179.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\180.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> flowers\182.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\186-2.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> flowers\186.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\187.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\190 (2).jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\190.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> flowers\191.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\195.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> flowers\199.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> flowers\2.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> flowers\200.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\032.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\085.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> noflowers\088.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\122.JPG res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\123.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\173.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> noflowers\202.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\205.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\cutxml.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.241 <br> noflowers\Getaway.jpg res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> noflowers\IMGP1800.JPG res = [[ 0.98 0.5 0.98 0.5 ]] v = 0.24 <br> noflowers\trq-4.png res = [[ 0.97 0.51 0.97 0.51]] v = 0.239 <br> fails = 14</code> <br> </div></div><br>  Being a carrier of real living, not artificial neurons, it dawned on me that the main difference between <i>colors</i> is <i>color</i> (yes, cap, thank you for being there, although you are often late with your advice).  Therefore, it would be necessary to translate it into some color model, where the color component will be highlighted (HSV or HSL), and train the network on color. <br><br>  But it turned out that the <a href="http://doc.qt.io/qt-5/qimage.html">QImage</a> class <a href="http://doc.qt.io/qt-5/qimage.html">does not know such color spaces</a> .  I had to abandon it and upload photos using OpenCV, where such an opportunity exists. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readImageCV</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file, imageSize)</span></span></span><span class="hljs-function">:</span></span> img = cv2.imread(file) small = cv2.resize(img, imageSize) hsv = cv2.cvtColor(small, cv2.COLOR_BGR2HSV) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hsv[:,:,<span class="hljs-number"><span class="hljs-number">0</span></span>]/<span class="hljs-number"><span class="hljs-number">255</span></span></code> </pre><br>  True, OpenCV refused to work with Russian letters in file names, had to rename them. <br><br>  Launched - the result is not pleased, almost the same. <br><br>  I also thought, I decided that the problem was in very random values ‚Äã‚Äãin the first grid, in vain I hoped that the stars would converge without my help, so I added a small pretraining to her, only 2 cycles per file.  For a sample of a positive result, I took the identity matrix. <br><br><pre> <code class="python hljs"> yy = np.zeros(middleShape) np.fill_diagonal(yy,<span class="hljs-number"><span class="hljs-number">1</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fl: i = readImage(f, imageSize) nn.learn(i, yy, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment"># -    mid = nn.calc(i) nn2.learn(mid, y, 1000)</span></span></code> </pre><br>  I started it again - it became much more interesting, the numbers began to change, although it did not reach the ideal. <br><br><div class="spoiler">  <b class="spoiler_title">Best result</b> <div class="spoiler_text"> <code>Epoch = 34 <br> flowers\178.jpg res = [[ 0.86 0.47 0.88 0.47]] v = 0.171 <br> flowers\179.jpg res = [[ 0.87 0.51 0.89 0.5 ]] v = 0.194 <br> flowers\180.jpg res = [[ 0.79 0.69 0.79 0.67]] v = 0.233 <br> flowers\182.jpg res = [[ 0.87 0.53 0.88 0.48]] v = 0.189 <br> flowers\186-2.jpg res = [[ 0.89 0.41 0.89 0.39]] v = 0.144 <br> flowers\186.jpg res = [[ 0.85 0.54 0.83 0.55]] v = 0.194 <br> flowers\187.jpg res = [[ 0.86 0.54 0.86 0.54]] v = 0.199 <br> flowers\190 (2).jpg res = [[ 0.96 0.25 0.97 0.15]] v = 0.089 <br> flowers\190.jpg res = [[ 0.95 0.13 0.97 0.14]] v = 0.048 <br> flowers\191.jpg res = [[ 0.81 0.57 0.82 0.57]] v = 0.195 <br> flowers\195.jpg res = [[ 0.81 0.55 0.79 0.56]] v = 0.177 <br> flowers\199.jpg res = [[ 0.89 0.45 0.89 0.45]] v = 0.171 <br> flowers\2.jpg res = [[ 0.83 0.56 0.83 0.55]] v = 0.195 <br> flowers\200.jpg res = [[ 0.91 0.42 0.89 0.43]] v = 0.163 <br> noflowers\032.jpg res = [[ 0.7 0.79 0.69 0.8 ]] v = 0.246 <br> noflowers\085.jpg res = [[ 0.86 0.53 0.86 0.53]] v = 0.192 <br> noflowers\088.jpg res = [[ 0.86 0.56 0.87 0.53]] v = 0.207 <br> noflowers\122.JPG res = [[ 0.81 0.63 0.81 0.62]] v = 0.218 <br> noflowers\123.jpg res = [[ 0.83 0.59 0.84 0.55]] v = 0.204 <br> noflowers\173.jpg res = [[ 0.83 0.6 0.83 0.58]] v = 0.209 <br> noflowers\202.jpg res = [[ 0.78 0.7 0.8 0.65]] v = 0.234 <br> noflowers\205.jpg res = [[ 0.84 0.77 0.79 0.75]] v = 0.287 <br> noflowers\cutxml.jpg res = [[ 0.81 0.61 0.81 0.63]] v = 0.213 <br> noflowers\Getaway.jpg res = [[ 0.85 0.56 0.85 0.55]] v = 0.202 <br> noflowers\IMGP1800.JPG res = [[ 0.85 0.55 0.86 0.54]] v = 0.199 <br> noflowers\trq-4.png res = [[ 0.7 0.72 0.7 0.71]] v = 0.208 <br> fails = 3 ['flowers\\180.jpg', 'noflowers\\085.jpg', 'noflowers\\IMGP1800.JPG'] <br> min = 3</code> <br> </div></div><br>  Further ... And then the day off ended, and it was time for me to do household work. <br><br><h2>  What to do next? </h2><br>  Of course, this network, the way I taught it, and the test dataset correlate very little with real networks and what data scientists are doing.  This is just a toy for gymnastics of the mind, do not place great hopes on it. <br><br>  You can outline further steps on how to achieve the desired result (if you need one): <br><br><ol><li>  Add one more intermediate layer or several to the second network - this way it will have more freedom in learning.  Still, the network on the matrix multiplication is not quite classical, since there are fewer synapse connections between the layers, and the synapses themselves are not unique. </li><li>  To use approximations to successful results as blanks for subsequent trainings - i.e.  remember the synapse weights of the most successful result, and not overwrite with all random values. </li><li>  To try genetic algorithms - to mix and divide, multiply successful and reject unsuccessful. </li><li>  Try other ways of learning, of which there is already a car and a small truck. </li><li>  To use more information from the source image, for example, simultaneously submit color and monochrome to different networks, process the results in a common network. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> nnmat <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt5.QtGui <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PyQt5.QtCore <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> meshandler <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImgNN</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, shape, resultShape = </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, </span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">, imageSize = </span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">400</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">,</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">400</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.resultShape = resultShape self.w = imageSize[<span class="hljs-number"><span class="hljs-number">0</span></span>] // shape[<span class="hljs-number"><span class="hljs-number">0</span></span>] self.h = imageSize[<span class="hljs-number"><span class="hljs-number">1</span></span>] // shape[<span class="hljs-number"><span class="hljs-number">1</span></span>] self.net = NN([shape, (<span class="hljs-number"><span class="hljs-number">1</span></span>,shape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)]) self.shape = shape self.imageSize = imageSize <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">learn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, srcArr, result, cycles)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(cycles): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.w): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.h): a = srcArr[x:x+self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], y:y+self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a.shape != (self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]): print(a.shape) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> self.net.learn(a, result[x,y], <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, srcArr)</span></span></span><span class="hljs-function">:</span></span> resArr = np.zeros(self.resultShape) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.w): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(self.h): a = srcArr[x:x+self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], y:y+self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a.shape != (self.shape[<span class="hljs-number"><span class="hljs-number">0</span></span>], self.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>]): <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x &gt;= self.resultShape[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y &gt;= self.resultShape[<span class="hljs-number"><span class="hljs-number">1</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> res = self.net.calc(a) resArr[x,y] = res[<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> resArr <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">learnFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, file, result, cycles)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.learn(readImage(file, self.imageSize), result, cycles) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, file)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.calc(readImage(file, self.imageSize)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readImageCV</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file, imageSize)</span></span></span><span class="hljs-function">:</span></span> img = cv2.imread(file) small = cv2.resize(img, imageSize) hsv = cv2.cvtColor(small, cv2.COLOR_BGR2HSV) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hsv[:,:,<span class="hljs-number"><span class="hljs-number">0</span></span>]/<span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">readImageQ</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(file, imageSize)</span></span></span><span class="hljs-function">:</span></span> img = QImage(file) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> img.isNull(): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> img = img.convertToFormat(QImage.Format_Grayscale8) img = img.scaled(imageSize[<span class="hljs-number"><span class="hljs-number">0</span></span>],imageSize[<span class="hljs-number"><span class="hljs-number">1</span></span>],Qt.IgnoreAspectRatio) srcBi = img.bits() srcBi.setsize(img.width() * img.height()) srcBy = bytes(srcBi) srcW, srcH = img.width(), img.height() srcArr = np.recarray((srcH, srcW), dtype=np.uint8, buf=srcBy).view(dtype=np.uint8,type=np.ndarray) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> srcArr/<span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: readImage = readImageCV y = np.array([[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]]) firstShape = (<span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>) middleShape = (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>) imageSize = firstShape[<span class="hljs-number"><span class="hljs-number">0</span></span>]*middleShape[<span class="hljs-number"><span class="hljs-number">0</span></span>], firstShape[<span class="hljs-number"><span class="hljs-number">1</span></span>]*middleShape[<span class="hljs-number"><span class="hljs-number">1</span></span>] StartLearn = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> StartLearn: pictDir = <span class="hljs-string"><span class="hljs-string">'2014-05'</span></span> nn = ImgNN(firstShape, resultShape=middleShape, imageSize=imageSize) nn.net.syns[<span class="hljs-number"><span class="hljs-number">0</span></span>] = np.loadtxt(<span class="hljs-string"><span class="hljs-string">'syns_save0.txt'</span></span>) nn.net.syns[<span class="hljs-number"><span class="hljs-number">1</span></span>] = np.loadtxt(<span class="hljs-string"><span class="hljs-string">'syns_save1.txt'</span></span>) nn2 = NN([middleShape, (y.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], middleShape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), y.shape]) nn2.syns[<span class="hljs-number"><span class="hljs-number">0</span></span>] = np.loadtxt(<span class="hljs-string"><span class="hljs-string">'syns2_save0.txt'</span></span>) nn2.syns[<span class="hljs-number"><span class="hljs-number">1</span></span>] = np.loadtxt(<span class="hljs-string"><span class="hljs-string">'syns2_save1.txt'</span></span>) files = [e.path <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.scandir(pictDir)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: i = readImage(f, imageSize) res = nn2.calc(i) delta = y-res v = round(np.std(delta),<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v &lt; <span class="hljs-number"><span class="hljs-number">0.2</span></span>: print(<span class="hljs-string"><span class="hljs-string">'Flower'</span></span>,f) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">'No flower'</span></span>,f) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: fl = [e.path <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.scandir(<span class="hljs-string"><span class="hljs-string">'flowers'</span></span>)] nofl = [e.path <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.scandir(<span class="hljs-string"><span class="hljs-string">'noflowers'</span></span>)] all = fl+nofl yy = np.zeros(middleShape) np.fill_diagonal(yy,<span class="hljs-number"><span class="hljs-number">1</span></span>) minFails = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> epoch <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>): print(<span class="hljs-string"><span class="hljs-string">'Epoch ='</span></span>, epoch) nn = ImgNN(firstShape, resultShape=middleShape, imageSize=imageSize) nn2 = NN([middleShape, (y.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], middleShape[<span class="hljs-number"><span class="hljs-number">0</span></span>]), y.shape]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fl: i = readImage(f, imageSize) nn.learn(i, yy, <span class="hljs-number"><span class="hljs-number">2</span></span>) mid = nn.calc(i) nn2.learn(mid, y, <span class="hljs-number"><span class="hljs-number">1000</span></span>) fails = <span class="hljs-number"><span class="hljs-number">0</span></span> failFiles = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all: i = readImage(f, imageSize) mid = nn.calc(i) res = nn2.calc(mid) delta = abs(y-res) v = round(np.std(delta),<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">#v = round(delta.sum(),3) print(f, 'res = ', res.round(2),'v =',v) if v &gt; 0.2 and f in fl: fails += 1 failFiles.append(f) elif v&lt;0.2 and f in nofl: fails +=1 failFiles.append(f) if minFails == None or fails &lt; minFails: minFails = fails lastSyns = nn.net.syns lastSyns2 = nn2.syns print('fails =',fails, failFiles) print('min =',minFails) if minFails &lt;= 1: print('found!') break for i in range(len(lastSyns)): np.savetxt('syns_save%s.txt'%i, lastSyns[i]) for i in range(len(lastSyns2)): np.savetxt('syns2_save%s.txt'%i, lastSyns2[i])</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Useful articles on Habr√©</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/305578/">Hello, TensorFlow.</a>  <a href="https://habrahabr.ru/post/305578/">Google Machine Learning Library</a> , <a href="https://habrahabr.ru/users/freetonik/" class="user_link">freetonik</a> translation </li><li>  <a href="https://habrahabr.ru/post/334380/">PyTorch - your new deep learning framework</a> , <a href="https://habrahabr.ru/users/devpony/" class="user_link">devpony</a> article </li><li>  <a href="https://habrahabr.ru/company/intel/blog/333612/">Deep Learning, now in OpenCV</a> , an Intel blog article </li></ul><br></div></div><br><br>  <a href="https://habrahabr.ru/post/339994/">Continuation</a> </div><p>Source: <a href="https://habr.com/ru/post/338548/">https://habr.com/ru/post/338548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338536/index.html">Automation to collect data on the growth of tables and files of all MS SQL Server databases</a></li>
<li><a href="../338538/index.html">MikroTik - several addresses and several different MAC on one interface</a></li>
<li><a href="../338540/index.html">CGLayout - new automatic layout system in iOS</a></li>
<li><a href="../338542/index.html">How does Microsoft try to send mobile mail to itself?</a></li>
<li><a href="../338544/index.html">Creating a sound effects synthesizer from retro games</a></li>
<li><a href="../338550/index.html">MVP recommendation system for GitHub weekly</a></li>
<li><a href="../338554/index.html">Visualization of election results in Moscow on a map in Jupyter Notebook</a></li>
<li><a href="../338556/index.html">Go: 10 years and grow further</a></li>
<li><a href="../338558/index.html">Reactive applications with Model-View-Intent. Part 2: View and Intent</a></li>
<li><a href="../338560/index.html">Who, how and why is going to regulate Big Data in Russia?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>