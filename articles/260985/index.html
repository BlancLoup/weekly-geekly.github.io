<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RAD using multidimensional table processor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to share with the business community a project from the field of business intelligence, which I have been doing in my spare time for the last y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RAD using multidimensional table processor</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b27/60b/5e7/b2760b5e70264b43b890e955f8878e0c.png"><br><br>  I want to share with the business community a project from the field of business intelligence, which I have been doing in my spare time for the last year and a half. <br><br>  Many use tabular processors (Excel, OpenOffice Calc, etc.) to quickly create applications that perform simple calculations, help in creating reports or make planning easier.  Despite the fact that the capabilities of such applications are usually very limited, the simplicity of tabular processors makes this approach very popular.  This article focuses on trying to expand the capabilities of tabular processors using a multidimensional data model (usually associated with the concept of <acronym>OLAP</acronym> ), while trying not to complicate the work with the new tool too much.  Who cares read on. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Problem </h2><br>  For the past five years I have been working as an IT consultant and have been engaged in .NET development mainly in the field of controlling and planning in large enterprises.  During this time, I have already come across projects several times when a client showed a complex excel document with many formulas and a couple of scripts and said that he wanted an application with the same functionality plus a couple of additional features.  These projects combined a similar scenario of using the document, consisting of three steps: <br><br><ol><li>  Collect data from many (5-1000) users.  The data consisted of numbers tied to several attributes, such as: sales at a certain point, for a certain time, of a certain product or expenses for a project, category, department.  The document was usually either located in a network folder, or copies were sent to users by e-mail, and the answer was manually transferred to one document. </li><li>  Calculate statistics / result.  Excel became more complicated over the course of several years and, apart from the multitude of formulas, its use implied several steps that were performed manually.  Simulations of computations with different inputs are also possible.  For example: what would have happened if the dollar had risen by 10%. </li><li>  Show result as a table.  Usually this table was subsequently used in printed reports or in presentation slides. </li></ol><br>  Solutions based on tabular processors with which I dealt, as a rule, were used for one of two purposes: <br><ul><li>  planning, when plans and forecasts for the future are not in the company's transaction bases, but in the heads of experts </li><li>  special reports whose source data is not maintained in transactional systems </li></ul><br>  Over time, the amount of manual work associated with the use of tabular processors greatly increased, and the organization decided to pay for the development of special software with the possibility of parallel operation of many users and reliable data storage in the database. <br><br><h2>  Example </h2><br>  Here is a fictional and very simplified example of such a spreadsheet, which, nevertheless, illustrates the difficulties associated with the ‚Äúflat‚Äù data model. <br><br>  Imagine a company selling lemonade.  We have 3 employees who sell lemonade in different places of the city.  The company decides to plan sales for each day in order to: <br><ol><li>  approximately know how many lemons to buy in the morning </li><li>  pay bonuses to employees who are trying to increase sales (for example, calling people, rather than playing on the phone behind the counter) </li></ol><br>  Since the company has 3 employees, 1 product and so far there is no special need to keep long-term statistics, she decides to use spreadsheets.  This is how our document looks like: <br><img src="https://habrastorage.org/files/83f/e75/fa8/83fe75fa8d1a4d0c96e56ac7d0c9dd06.png"><br><br>  In the rows are days, and in the columns the number of sold cups of lemonade, revenue and percentage of the plan.  In order to compare plans with reality, we will keep data in two versions: planned and actual.  We created a worksheet for each employee, and we count on them the amount based on the fact that in each sheet the row Total has the number 33. Every month we copy a piece of paper, erase the data and fill out again. <br><br>  <b>Question:</b> What to do if we have several products (fresh orange juice?), We want statistics by months or a year, the salesmen‚Äôs headquarters expand, and we want to see data on the city‚Äôs districts (for example, to see the effect of advertising)?  What if we want to complicate the formulas and add cost planning?  Of course, we can still suffer a bit with the tables: produce worksheets for each product and seller (for example, only 5 products and 10 sellers = 50 sheets), correct copied formulas, write scripts to group sellers and so on.  What if‚Ä¶ <br><br><h2>  Idea </h2><br>  Remembering the university course on databases, I immediately noticed that the multidimensional data model is very well suited for describing such systems. <br>  My first solution was to create a .NET framework that stored data in the database as a multidimensional cube, was in charge of controlling access to the data, and allowed the calculations to be described as IronPython scripts.  Although the code for each new project required significantly less, using this framework required knowledge of C # and databases. <br>  After some time, the idea emerged to create <b>a multidimensional system similar to tabular processors, working with which would not require programming skills</b> . <br><br><h2>  Market </h2><br>  Then it goes about <acronym>OLAP</acronym> and multidimensional data analysis.  Since this topic has already been discussed at Habr√© (for example, <a href="http://habrahabr.ru/post/126810/">Introduction to multivariate analysis</a> ), I will not repeat and assume that the reader knows about what is at stake. <br>  An Internet search showed that the idea is not new.  I came across two categories of similar products: <br><br><h4>  Multidimensional table processors (Multi-dimensional spreadsheets) </h4><br>  In 1991, Lotus Development Corporation released the Lotus Improv product, which is a typical representative of this type of software.  Despite the fact that this product served as an example for a whole class of similar systems, it was not very successful, and its development was discontinued in 1996.  As I understand from the articles on the Internet, the product was designed for one user.  For myself, I made the following conclusions: <br><ul><li>  The multidimensional data model is too complicated a concept for most ordinary users. </li><li>  Using a multidimensional cube alone rarely makes sense.  The data that one person enters will most often fit in a two-dimensional tablet.  A multi-dimensional data model makes sense in a multi-user scenario. </li></ul><br><h4>  Full Business Intelligence Systems with Planning Function </h4><br>  Several large (or even very large) companies already offer server systems of this type. <br>  In the description of such systems, the word OLAP is usually present, but there are several differences in their work from the classical OLAP systems, which are usually designed to analyze existing data from transactional systems.  In my understanding, planning systems with a multidimensional data model are different in that they allow convenient multi-user data entry into a multidimensional cube.  This means that the database behind such a system must simultaneously support both transactional (save user input) and analytical (data aggregation) mode of operation. <br>  It turned out that some of my clients had already tried using one or another planning system with a multidimensional data model and had the following difficulties: <br><ul><li> The use of most of these systems requires the presence of highly paid specialists, since: the ability to program in special scripting languages ‚Äã‚Äãis necessary;  In order to properly install or administer a system, it is often necessary to read several hundred pages of documentation. </li><li>  Relatively expensive and complex licenses. </li><li>  At the same time, the functionality of such systems is limited and the use of the final product created on the basis of the system is usually more complicated than the use of a specially written application. </li></ul><br>  With the last item is difficult to do anything.  The idea to create software without programming skills is not new, but artificial intelligence has not yet been invented, the possibilities of such programs will be limited.  The first two points I decided to fix. <br><br><h2>  Decision </h2><br>  Write a system, the work with which will be as simple as the use of tabular processors, which has the following properties: <br><ul><li>  Multidimensional and hierarchical data model </li><li>  Formulas as close as possible to the familiar formulas of tabular processors </li><li>  Ability to work in parallel through the web </li><li>  Control of access to data and formulas </li><li>  Simple installation, the ability to start working in a couple of minutes using the free version </li><li>  Easy maintenance (no need to work in the cloud) </li><li>  Only a few people who create an application model need to understand OLAP concepts.  The user who enters the data simply fills the table. </li><li>  The ability to store and quickly calculate large amounts of data (up to a billion values) </li></ul><br><h2>  Design </h2><br><h4>  Common architecture </h4><br>  The system (codename Egeria) is designed for multi-user work via the Web and consists of a server written in .NET / C # and a web client.  To work "at home" there is a simple application (Launcher), which allows you to select a folder with data, starts the local server and opens the browser with the desired address. <br><br><h4>  Dimensions and their elements </h4><br>  Unlike tabular processors, where rows and columns are numbered by numbers and letters, respectively, members / dimension members in cubes are usually created from elements of the application area (in this case, they are sellers, products, days, and so on).  Often, database tables are used to describe the elements of each dimension.  Since I did not want to complicate the lives of users by learning SQL, I decided to create a visual concept for representing metadata. <br>  What turned out, I called the visual document.  All metadata in the system, including system objects (such as a cube or dimension), is described by a visual document.  An example of such a document that describes the formatting of a report position is shown in the following image: <br><img src="https://habrastorage.org/files/10f/cbb/e53/10fcbbe53d5f49a4819e93dd8910fcd0.png"><br><br>  Each document has two fields: a code (Code) for references to a document from formulas and a name (Name) for display on the screen.  The visual document itself has a hierarchical structure and consists of ordinary input elements, such as a text field, selection lists, a checkbox, or a list of elements.  The structure of a visual document is described by a visual scheme, which in turn is a visual document (the structure of a visual scheme can be described by a visual scheme in the same way that an XML Schema structure can be described using an XML Schema instance).  The scheme that describes the document from the previous image defines the "format" field.  This diagram can be seen in the ‚ÄúLevel data type‚Äù section of the following image: <br><img src="https://habrastorage.org/files/144/c85/3fb/144c853fb52043b98135ca2ad69f6687.png"><br><br>  This picture shows the description of the ‚Äúposition report‚Äù measurement.  In Egeria, all dimensions are hierarchical (even if only one level of hierarchy is defined).  This means that each dimension can be represented as a tree.  As already mentioned, the elements of this tree are visual documents.  Documents of each hierarchy level have their own scheme, described in the Dimension model.  Position measurement has one hierarchy level, which is called position.  Also, a zero element with an asterisk (*) code is added to each dimension.  This item contains no data and is at the highest level of the hierarchy, which also has a star identifier (*).  In the first picture on the left we see that the Position measurement consists of 5 elements: *, P01, P02, P03, P04. <br><br><h4>  Cubes </h4><br>  Numerical data is stored in the so-called cubes.  A cube is described by its dimensions and is something like a multi-dimensional Excel sheet.  One number can be stored in each cell of the cube. <br><br><h4>  Data View: Worksheet </h4><br>  Modern screens show no more than two dimensions, which forces us to design data into rows and columns of a two-dimensional table.  This transformation and selection of the cube section accessible to the user is described using the worksheet concept. <br>  In Egeria, unlike tabular processors, a worksheet does not contain data (it is stored in a cube), but simply displays data from parts of a cube.  Two sheets can show the same cube region. <br>  Everything works the same as a pivot table in tabular processors.  The user selects which measurements will be columns, which rows and which filters using drag &amp; drop.  After that, for each dimension, the elements that will be displayed in the worksheet are selected.  After the worksheet is saved, you can enter data into the cube and create formulas. <br><br><h4>  Calculations </h4><br>  A simple but flexible cube computing processing system is the main advantage of Egeria.  All calculations are made on the server.  Formulas are compiled into machine code and therefore run very quickly.  On an average laptop, a cube with five million values ‚Äã‚Äãis completely calculated in 10‚Äì20 seconds (the number of unfilled cells in a cube does not matter).  The dependency tracking system in a cube allows you to calculate the change in a single cell of a cube instantly (unless, of course, another 5 million cells depend on this cell). <br>  I wanted to make the Egeria formulas as similar as possible to the formulas of conventional tabular processors.  Here are 3 main differences that I could not avoid: <br><ul><li>  Egeria slightly extends the standard formula language to allow the use of metadata in formulas.  The expression pos.format, for example, will return the contents of the format field of an element of the pos dimension of the current cell. </li><li>  Added a couple of new features that allow you to work with metadata and format cells.  More information about them can be found in the system documentation. </li><li>  An important innovation is the addressing system in the cube: </li></ul><br><h4>  Cube Addressing </h4><br>  Addresses in tabular processors look like this: B3 or $ C $ 4 (first relative, second absolute).  It would be too difficult to write each dimension to each address (we can have 10-15 measurements).  In addition, Egeria refuses to copy formulas for reasons of speed and clarity of the resulting model of calculations (for each formula we describe the space in which it operates). <br>  Addressing in the system is always relative to the cell, which is considered at the moment. <br>  Each reference to a cube is enclosed in square brackets.  In parentheses, comma-separated lists of addresses for each dimension that needs to be changed to get to the desired cell.  The expression <b>[]</b> will return the cell that is currently being processed.  The expression <b>[dim1: a1]</b> returns the cell with the code a1 in the dimension dim1, leaving the rest of the address unchanged.  There are also special functions that allow you to access the elements of hierarchical dimensions.  <b>[dim1: children ()]</b> , for example, returns one cell for each element under the current element in the dim1 dimension.  This way you can aggregate data. <br><br><h2>  What will our example look like in Egeria? </h2><br>  We get about this: <br><br><img src="https://habrastorage.org/files/850/22b/324/85022b3244d44e68b46da0b4ecbc3278.png"><br><br>  Selecting the seller in the tree on the left and the month and product through the selection lists on top, we will see sales in the table on the right. <br>  If you select a street in the tree, then on the right you will see sales on this street: <br><br><img src="https://habrastorage.org/files/f84/a61/2d0/f84a612d0ca4453eb1790a92da1b4f46.png"><br><br>  You can create this application in 20 minutes (including data entry) by following these steps: <br><ol><li>  Open the metadata editor and create the following measurements (in parentheses are the measurement code used in the formulas): <br><ul><li>  Day (day) - Day of sale with items from 1 to 31. </li><li>  Month (mon) - Month of sale with items from 1 to 12. </li><li>  Data type (dty) - Data type with elements: planned (Planned) and valid (Actual) </li><li>  Position (pos) - Position of the report / input form with the elements: the number of cups of lemonade sold (Cups sold), the revenue (Sales), the percentage of the plan fulfillment (Plan fulfillment) and the price per glass (Cup price). </li><li>  Business unit (bu) - Our employees are grouped by the streets on which they work. </li><li>  Product (prod) - Products that our employees sell. </li></ul><br></li><li>  Create the following worksheets (worksheets or input forms): <br><ul><li>  Prices: Entering prices through the streets. </li><li>  Sales: Enter sold cups and count revenue. </li><li>  Sales by month: Aggregation of data by month. </li></ul><br></li><li>  Add formulas. <br>  The formula for calculating sales, for example, is: <pre>  [day: *, dty: *, mon: *, pos: P04, bu: parent ()] * [pos: P01] </pre>  pos: P01 is the element code of the measurement ‚Äúposition of the report‚Äù which is called ‚Äúthe number of cups sold‚Äù (Cups sold), pos: 04 - ‚Äúthe price of the glass‚Äù.  Since the price of a glass depends only on the street and the product, we store it on the zero (*) element in the dimensions day (day), data type (dty), and month (mon). <br>  The expression bu: parent () goes from the hierarchy level ‚Äúseller‚Äù (measuring a business unit) to the hierarchy level ‚Äústreet‚Äù. <br></li></ol><br>  Detailed video with step-by-step creation of this system can be found in the <a href="http://egeria.rocks/screencasts">screencasts</a> section <a href="http://egeria.rocks/screencasts">on the system website</a> . <br><br><h2>  Want to know more? </h2><br>  On the website <a href="http://egeria.rocks/">http://egeria.rocks</a> you will find: <br><ul><li>  project documentation and screencasts (unfortunately, only in English) </li><li>  free system preview </li><li>  a couple of sample apps created with egeria </li></ul><br>  In addition to the example given here, there is: <br><ul><li>  a sales planning system that automatically calculates the company's revenues from sales and expenses, while converting currencies </li><li>  investment planning system on the example of an amusement park </li><li>  real estate appraisal system </li><li>  project time tracking system with the ability to enter holidays </li></ul><br>  and this is only a small part of what Egeria can be used for. <br><br><h2>  Tech data </h2><br>  For those who are interested in how it all works: <br><br><h4>  Front-end </h4><br>  In connection with the recent growth in popularity and capabilities of web applications, the choice fell on JavaScript / HTML5 (Single Page Application) as a client.  In this case, the server role is limited to providing the REST API. <br>  The client uses AngularJS, which implements the MVVM pattern.  The presence of a large number of free components for this platform and its well-thought-out architecture greatly simplified the development of the client. <br><br><h4>  Back-end </h4><br>  The server is written in C #.  Nancy FX is used as a server framework. <br>  ASP.NET seemed too heavy for me to simply create a REST API.  In addition, the simplicity of Nancy and the use of the facade pattern will make it possible, if necessary, to replace the web framework within one or two days. <br>  I also wanted the user to just download and launch the application, thus obtaining a local web server.  It perfectly supports the self-host script using Nancy. <br>  For parsing formulas used <a href="https://github.com/sprache/Sprache">Sprache Framework</a> , which allows you to create a parser for a few hours.  After parsing from the syntax tree, Expression Trees are generated, which the .NET runtime turns into native code. <br><br><h4>  Database </h4><br>  Since under a hood a visual document is serialized into a JSON document, Egeria can store data in any JSON database.  Currently there is an adapter for MongoDB.  To store data in local files, a self-signed copy-on-write key-value storage (key-value-store) and data serialization using protobuf-net are used.  Unfortunately, I could not find a well-maintained key-value repository written entirely in managed code.  <a href="">JSON.NET is</a> used to work with JSON objects. <br><br>  Cube data is stored in a compressed binary representation (approximately 30 bytes per point with .NET decimal accuracy), which saves memory and quickly moves data from the key-value-store to memory and back.  The system is built on the principle of in-memory processing and assumes that all data will fit into memory.  The cube is loaded asynchronously and the system is available almost immediately after the start. <br><br><h2>  Feedback </h2><br>  I would be very happy to hear your opinion about the system. <br><ul><li>  Another bike or something new? </li><li>  Got an idea for a system? </li><li>  I think about putting the code in a readable form, putting it on Github.  Would you like the system code to be open, or is quality technical support still more important here? </li><li>  Found a bug or want to suggest a new feature? </li></ul><br>  Write comments. <br>  Especially interesting is the opinion of people who have already been involved in planning systems with a multidimensional data model. </div><p>Source: <a href="https://habr.com/ru/post/260985/">https://habr.com/ru/post/260985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260975/index.html">The importance of the output serialization API</a></li>
<li><a href="../260977/index.html">Software-defined WAN: well-made electrical tape?</a></li>
<li><a href="../260979/index.html">STC Metrotek: how it was. Part One (2004-2006)</a></li>
<li><a href="../260981/index.html">Visualization of results in R: first steps</a></li>
<li><a href="../260983/index.html">PHP extension. Writing a simple array with Traversable and ArrayAccess</a></li>
<li><a href="../260987/index.html">Go away HTML, go away</a></li>
<li><a href="../260989/index.html">Messenger spam: is the law broken?</a></li>
<li><a href="../260991/index.html">Getting rid of "historical causes" in cmd.exe</a></li>
<li><a href="../260993/index.html">Solving sparse SLAEs of large dimensions using ManagedCuda in .NET</a></li>
<li><a href="../260995/index.html">The general concept of the direction SafeCityNET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>