<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Opening API for working with services from Russian low-cost host (part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After a long pause, we gathered our thoughts and decided to prepare a small cycle of articles that would be useful both for developers and our regular...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Opening API for working with services from Russian low-cost host (part 1)</h1><div class="post__text post__text-html js-mediator-article">  After a long pause, we gathered our thoughts and decided to prepare a small cycle of articles that would be useful both for developers and our regular customers, who would need to order more than one service at a time. <br><br> <a href="https://www.ihor.ru/"><img src="https://habrastorage.org/files/f46/c10/a09/f46c10a096f84562ad985ed82f55ed92.png"></a> <br><br>  Prerequisites for this publication appeared a long time ago.  One of the clients with a large number of virtual servers inquired about whether it is possible to work with our billing API.  At that time, to be honest, we were not ready for such a dialogue and could not offer a ready-made solution. <br>  From the beginning of the summer, we received several more such questions and realized that we could not leave them unanswered.  And today I will tell you how to work with our company's billing API to order virtual servers of any quantity. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As a billing system, we use the product of the Russian company ISPsystem - BILLmanager4.  For all ISP products, there is an open API and it is described to a greater or lesser extent on their official documentation site <a href="http://ispdoc.com/">ispdoc.com</a> <br>  You can work with the API either from the command line, directly accessing the mgrctl interpreter, or via the browser address bar (or any other application that will send a request to the web server: curl, wget, etc.) <br>  Based on the documentation, you can make a request to any of the products, BUT, when working with billing, a certain amount of information is required, which is available only from the hosting provider. <br><br>  The request itself for ordering a virtual server, for example, KVM Ferrum for one month with automatic monthly renewal, using the Centos-6.7-x86_64-minimal OS template without using the ISPmanager license, will look like this: <br><br><pre><code class="html hljs xml">https://billing.ihor.ru/billmgr?authinfo=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">USER</span></span></span><span class="hljs-tag">&gt;</span></span>:<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PASS</span></span></span><span class="hljs-tag">&gt;</span></span>&amp;addon_1101=20&amp;addon_1103=1&amp;addon_1104=1&amp;addon_1110=1&amp;addon_1791=4&amp;enum_1112=21&amp;enum_1106=25&amp;agree=on&amp;domain=test-for.habr&amp;ostempl= Centos-6.7-x86_64-minimal&amp;period=1210&amp;price=1100&amp;autoprolong=1210&amp;payfrom=neworder&amp;func=vds.order.7&amp;sok=ok</code> </pre> <br><br>  Now we will try to decipher all this jumble of variables and numbers. <br>  The request itself can be divided conditionally into two parts: these are the billing URL and the request billing parameters passed. <br>  The parameters themselves can be distributed as follows: <br><br><h2>  Description of parameters </h2><br><ul><li>  Authorization - authinfo </li></ul><br>  The login and password of the user registered in the billing is specified as the authorization data. <br><br><ul><li>  Tariff plan - price </li></ul><br>  Each tariff plan has its own identifier in the billing, taken from the table "Tariff Plans". <br><br><ul><li>  Tariff parameters - addon_ </li></ul><br>  The parameters of the tariff plan include the parameters of the virtual server, its resources.  Each parameter of the tariff plan has its own identifier and its default value, which corresponds to the size of the disk, the number of processor cores and RAM, as well as IPv6 and IPv4 addresses. <br><br><ul><li>  Additional services - enum_ </li></ul><br>  Additional services include DNS servers and the use of an ISPmananger license. <br><br><img src="https://habrastorage.org/files/5b3/feb/c07/5b3febc07cb64d708d06ee41075ca6c1.png"><br>  <sub>(default settings for KVM Ferrum)</sub> <br><br><ul><li>  Order period - period </li><li>  Auto Renew - autoprolong </li></ul><br>  The identifier of the order period and auto-renewal for each of the services are absolutely the same. <br><br><ul><li>  Server domain name - domain </li></ul><br>  Domain name must be unique.  Otherwise, an error will occur. <br>  <b>Error: The domain is already in use.</b>  <b>Specify a different domain name.</b> <br>  When mass adding virtual servers, I recommend using the format + &lt;sequence number&gt;. <br><br><ul><li>  OS Template - ostempl </li></ul><br>  An incomplete list of templates is provided in this text just below.  Please note that when ordering an OS template without ISPmanager, the setting of the value of the additional services should be disabled using the ISPmanager control panel (for all tariff plans this identifier is the same - 25) <br><br><ul><li>  Payment options - payfrom </li></ul><br>  In the example, I gave the value of the payment parameter - neworder, which corresponds to a separate order with payment for each server.  <b>payfrom = neworder</b> . <br><br><ul><li>  Payment order - func </li></ul><br>  Since the entire order of the virtual server consists of 7 steps, the API, which is not particularly obvious at first glance, should indicate not only the vds.order function itself, but also the number of the last step - 7. Thus, the full value of this item looks like this: <b>func = vds.order.7</b> <br><br><ul><li>  Confirm User Agreement - agree </li></ul><br>  When ordering any of the services, we offer to familiarize with the user agreement and accept it (then the order goes for activation) or not accept it (then the order is canceled).  In the API, this item is also required: <b>agree = on</b> . <br><br><br>  Part of the parameters is fixed and I gave their values ‚Äã‚Äãin the description, and the values ‚Äã‚Äãof others can be taken from the table, which is entirely shown on the website page with reference information on working with <a href="https://wiki.ihor.ru/billmanager:%25D0%25BA%25D0%25B0%25D0%25BA_%25D0%25B7%25D0%25B0%25D0%25BA%25D0%25B0%25D0%25B7%25D0%25B0%25D1%2582%25D1%258C_vds_%25D1%2581_%25D0%25BF%25D0%25BE%25D0%25BC%25D0%25BE%25D1%2589%25D1%258C%25D1%258E_api">hosting</a> . <br><br>  In order not to clutter the text with large tables with all tariff plans, I will give only the part that will help you figure out how the line was drawn up for ordering a virtual server with the KVM Ferrum tariff plan.  As well as two other junior tariff plans SSD and OVZ <br><br><h2>  Tariff Plans </h2><br><table><tbody><tr><th colspan="2">  price </th><th colspan="4">  period / autoprolong </th></tr><tr><td>  Rate </td><td>  ID </td><td>  1 month </td><td>  3 months </td><td>  6 months </td><td>  1 year </td></tr><tr><td>  KVM Ferrum </td><td>  1100 </td><td>  1210 </td><td>  1213 </td><td>  1214 </td><td>  1211 </td></tr><tr><td>  SSD Ferrum </td><td>  1033 </td><td>  1180 </td><td>  1183 </td><td>  1184 </td><td>  1181 </td></tr><tr><td>  Ovz ferrum </td><td>  2061 </td><td>  1758 </td><td>  1761 </td><td>  1762 </td><td>  1759 </td></tr></tbody></table><br><br><h2>  Tariff parameters </h2><br><table><tbody><tr><th></th><th colspan="5">  addon_ </th><th colspan="2">  enum_ </th></tr><tr><td>  Tariff / Value </td><td>  Disk </td><td>  Ram </td><td>  CPU </td><td>  IPv4 </td><td>  IPv6 </td><td>  NS </td><td>  ISPmgr </td></tr><tr><td>  KVM Ferrum </td><td>  1101 <br>  / 20 <br></td><td>  1103 <br>  / one <br></td><td>  1104 <br>  / one <br></td><td>  1110 <br>  / one <br></td><td>  1791 <br>  / four <br></td><td>  1112 <br>  / 21 <br></td><td>  1106 <br>  / (1/25) <br></td></tr><tr><td>  SSD Ferrum </td><td>  1034 <br>  / 20 <br></td><td>  1037 <br>  / one <br></td><td>  1043 <br>  / one <br></td><td>  1036 <br>  / one <br></td><td>  1404 <br>  / four <br></td><td>  1045 <br>  / 21 <br></td><td>  1039 <br>  / (1/25) <br></td></tr><tr><td>  Ovz ferrum </td><td>  2062 <br>  / 20 <br></td><td>  2065 <br>  / one <br></td><td>  2071 <br>  / one <br></td><td>  2064 <br>  / one <br></td><td>  2074 <br>  / four <br></td><td>  2073 <br>  / 21 <br></td><td>  2067 <br>  / (1/25) <br></td></tr></tbody></table><br><h2>  Template List </h2><br><ul><li>  FreeBSD-11-amd64-minimal </li><li>  Centos-6.7-x86_64-minimal </li><li>  Debian-7-x86_64-minimal </li><li>  Debian-8-x86_64-ispconfig </li><li>  Ubuntu-16.04-x86_64-minimal </li><li>  CentOS-7-x86_64-ispmgr5 </li></ul><br>  If the request is correct and the application for activation of the new service is accepted, you will receive in response something like this: <br><br><pre> <code class="javascript hljs">&lt;script language=<span class="hljs-string"><span class="hljs-string">'JavaScript'</span></span>&gt;fr_master(<span class="hljs-string"><span class="hljs-string">'startpage=vds'</span></span>, <span class="hljs-string"><span class="hljs-string">'top.'</span></span>);<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><br>  Below, as a bonus, I attach several scripts to order an arbitrary number of virtual servers for the Linux and Windows console. <br>  If the comments show interest in the development of the topic of working with our billing API, we will try to describe it in more detail using various programming languages ‚Äã‚Äãand software products for integration. <br><br>  BASH example <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#/bin/bash # #    USER=user PASS=password #  10   for i in {1..10} do /usr/bin/curl https://billing.ihor.ru/billmgr?authinfo=$USER:$PASS&amp;addon_1101=20&amp;addon_1103=1&amp;addon_1104=1&amp;addon_1110=1&amp;addon_1791=4&amp;enum_1112=21&amp;enum_1106=25&amp;agree=on&amp;domain=$USER-$i.ru&amp;ostempl= Centos-6.7-x86_64-minimal&amp;period=1210&amp;price=1100&amp;autoprolong=1210&amp;payfrom=neworder&amp;func=vds.order.7&amp;sok=ok" done</span></span></code> </pre><br><br>  Unfortunately, it was not possible to come up with any decent option, except for how to duplicate the previous cycle using curl, assembled to work in Windows.  But if from among the readers there are experienced in scripting / programming under Windows, then please share more rational scripts in the comments. <br><br>  An example on PowerShell, the curl.exe file must be located in the same directory where the script is running from <br><br><pre> <code class="bash hljs">USER=user PASS=password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-variable"><span class="hljs-variable">$i</span></span>=1; <span class="hljs-variable"><span class="hljs-variable">$i</span></span> -lt 10; <span class="hljs-variable"><span class="hljs-variable">$i</span></span>++) { .\curl.exe https://billing.ihor.ru/billmgr?authinfo=<span class="hljs-variable"><span class="hljs-variable">$USER</span></span>:<span class="hljs-variable"><span class="hljs-variable">$PASS</span></span>&amp;addon_1101=20&amp;addon_1103=1&amp;addon_1104=1&amp;addon_1110=1&amp;addon_1791=4&amp;enum_1112=21&amp;enum_1106=25&amp;agree=on&amp;domain=<span class="hljs-variable"><span class="hljs-variable">$USER</span></span>-<span class="hljs-variable"><span class="hljs-variable">$i</span></span>.ru&amp;ostempl= Centos-6.7-x86_64-minimal&amp;period=1210&amp;price=1100&amp;autoprolong=1210&amp;payfrom=neworder&amp;func=vds.order.7&amp;sok=ok<span class="hljs-string"><span class="hljs-string">" }</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/305716/">https://habr.com/ru/post/305716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305706/index.html">Add an arbitrary phone in the personal account of the mobile operator Kyivstar (Ukraine)</a></li>
<li><a href="../305708/index.html">Impressions from the best reports at the International PHP Conference</a></li>
<li><a href="../305710/index.html">GIMP 2.9.4 released</a></li>
<li><a href="../305712/index.html">ViaLatM and social functions</a></li>
<li><a href="../305714/index.html">Introducing Iron: Melt Ore on Rust</a></li>
<li><a href="../305718/index.html">Checking the source code of FlashDevelop with PVS-Studio</a></li>
<li><a href="../305720/index.html">Business Processes: How everything is started and confused. Chapter Three General BPM Classification and BPMS Philosophy</a></li>
<li><a href="../305722/index.html">How to write a good text for a site or email-letter: WIIFM technology</a></li>
<li><a href="../305724/index.html">Features of the choice of solid-state drives (SSD) for servers and RAID-arrays</a></li>
<li><a href="../305726/index.html">Kerio Connect 9.1 - helps small and medium-sized companies work more productively</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>