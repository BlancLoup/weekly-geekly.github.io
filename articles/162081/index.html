<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pseudo 3D effect</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I paid attention to the videos of the programs that implement the so-called pseudo-3D effect: when the picture of the application changes de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pseudo 3D effect</h1><div class="post__text post__text-html js-mediator-article">  Recently, I paid attention to the videos of the programs that implement the so-called pseudo-3D effect: when the picture of the application changes depending on the user's position relative to the phone.  Or phone relative to the user: depending on which side you are from :).  To achieve this effect, you can use either sensors or track the position of the user's eyes (so-called head tracking).  The second method is somewhat more complicated, although it gives a more plausible result. <br><br>  As an experiment, we decided to try to make such a 3D background in the <a href="https://itunes.apple.com/us/app/deluxe-moon-pro-moon-phases/id482361332%3Fmt%3D8">Deluxe Moon Pro</a> program (In the version on the market, this effect has not yet been realized!). <br><br>  Here is an example of what we did: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/iUaur6ainb8%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjcpUVCSGC6OXY188CKV6qiE52sZA" frameborder="0" allowfullscreen=""></iframe>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, let's begin. <br><a name="habracut"></a><br>  In order to achieve the 3D effect, it is necessary to divide the image into ‚Äúlayers‚Äù and, depending on the accelerometer reading, displace each layer by a certain amount. <br><br>  It would seem simple, but there are a few problems. <br><br><ol><li>  Hand shake causes flickering pictures </li><li>  The phone is kept tilted.  Therefore, when starting the program, it is better to assume that in this position the user's gaze was directed normal to the plane of the phone, and all sensor changes are counted from this initial value. </li></ol><br>  Thus, the general approach to solving this problem is as follows: <br><br><ol><li>  Split the background into several layers that will move relative to each other.  This can be text, background images or special elements created to give "depth". </li><li>  Subscribe to accelerometer events. </li><li>  When changing the accelerometer: </li><li>  Correct sensor readings relative to initial values. </li><li>  Smooth vibrations from shaking hands </li><li>  Shift each layer by its size. </li><li>  Make the sensors optional: not all users might like this surprise. </li></ol><br>  So, in our case, we have a background image, + 2 layers of stars, + layers of various screen elements. <br><br>  For filtering, we set some constants: <br><pre><code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#define kUpdateFrequency 240.0 //   #define kCutoffFrequency 5.0 //  #define kAccDataScale 2.2 // </span></span></code> </pre> <br>  When starting the program, we initialize the low-pass filter in order to remove background rattling caused by hand-shake. <br>  you can read about it <a href="http://en.wikipedia.org/wiki/Low-pass_filter">here</a> <br>  and download the Apple implementation example <a href="https://developer.apple.com/library/ios/">here</a> <br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)awakeFromNib { filter = [[LowpassFilter alloc] initWithSampleRate:kUpdateFrequency/<span class="hljs-number"><span class="hljs-number">10</span></span> cutoffFrequency:kCutoffFrequency]; <span class="hljs-comment"><span class="hljs-comment">//    if ([Options instance].useSensors) { [self performSelector:@selector(startAcc) withObject:nil afterDelay:4]; //              } [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(didGoToBG:) name:UIApplicationDidEnterBackgroundNotification object:nil]; //    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(didResume:) name:UIApplicationDidBecomeActiveNotification object:nil]; //   [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(useSensorsChanged) name:@"useSensors" object:nil]; //    }</span></span></code> </pre><br>  I think it‚Äôs not worth describing the reaction to changing the option by turning on / off the 3D background effect and folding the program into the background, everything is trivial <br><br>  Now consider the function that runs all this beauty. <br>  PS ARC is used because no retain or release <br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)startAcc { <span class="hljs-keyword"><span class="hljs-keyword">@try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!acc) { startY = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     Y          acc = [UIAccelerometer sharedAccelerometer]; acc.updateInterval = 1/kUpdateFrequency; acc.delegate = self; } } @catch (NSException *exception) { NSLog(@"startAcc %@",exception); } }</span></span></code> </pre><br>  To stop the whole thing <br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)stopAcc { <span class="hljs-keyword"><span class="hljs-keyword">@try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (acc) { acc.delegate = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; acc = <span class="hljs-literal"><span class="hljs-literal">nil</span></span>; [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> resetState]; } } <span class="hljs-keyword"><span class="hljs-keyword">@catch</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">NSException</span></span> *exception) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"stopAcc %@"</span></span>,exception); } }</code> </pre><br>  Then we just have to catch the accelerometer update event. <br><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)accelerometer:(<span class="hljs-built_in"><span class="hljs-built_in">UIAccelerometer</span></span> *)accelerometer didAccelerate:(<span class="hljs-built_in"><span class="hljs-built_in">UIAcceleration</span></span> *)acceleration { <span class="hljs-keyword"><span class="hljs-keyword">@try</span></span> { [filter addAcceleration:acceleration]; <span class="hljs-comment"><span class="hljs-comment">//    ¬´¬ª  double x = filter.x*kAccDataScale; //  double y = filter.y*kAccDataScale; if (startY == 100) { startY = acceleration.y*kAccDataScale; //     Y } //    X if (x &gt; 1) { x = 1; } else if (x &lt; -1) { x = -1; } //    Y if (y &gt; 1) { y = 1; } else if (y &lt; -1) { y = -1; } //    y = (y - startY); //   [self setOffsetElementForX:x Y:y]; } @catch (NSException *exception) { NSLog(@"accelerometer %@",exception); } } @end</span></span></code> </pre><br>  And finally, in the shift function, we move different layers to different fixed values.  Therefore, the upper elements move at a slower speed than the background, which creates the 3D effect.  In this case, all elements must move in the direction of rotation of the device. <br><pre> <code class="objectivec hljs">-(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)setOffsetElementForX:(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)x Y:(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)y { <span class="hljs-keyword"><span class="hljs-keyword">@try</span></span> { allEll.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-8.5</span></span>*x, <span class="hljs-number"><span class="hljs-number">11.5</span></span>*y); movingButtonsView.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-8.5</span></span>*x, <span class="hljs-number"><span class="hljs-number">11.5</span></span>*y); arcView.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-8.5</span></span>*x, <span class="hljs-number"><span class="hljs-number">11.5</span></span>*y); bgView.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-17</span></span>*x, <span class="hljs-number"><span class="hljs-number">23</span></span>*y); bgStar1View.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-13</span></span>*x, <span class="hljs-number"><span class="hljs-number">18</span></span>*y); bgStar2View.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-10</span></span>*x, <span class="hljs-number"><span class="hljs-number">13</span></span>*y); allEll2.transform = <span class="hljs-built_in"><span class="hljs-built_in">CGAffineTransformMakeTranslation</span></span>(<span class="hljs-number"><span class="hljs-number">-17</span></span>*x, <span class="hljs-number"><span class="hljs-number">21</span></span>*y); } <span class="hljs-keyword"><span class="hljs-keyword">@catch</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">NSException</span></span> *exception) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"offsetElementForX %@"</span></span>,exception); } }</code> </pre><br>  These 4 simple steps will make the program more attractive, more interesting and more innovative.  21st century after all.  Remember that a spectacular and stylish design can positively affect the evaluation of your application by reviewers, as well as distinguish them from hundreds of thousands of competitors.  We at Lifeware Solutions (http://www.lifewaresolutions.com/) are actively engaged in research and will be happy if our experience will be useful to you.  I would be very grateful for your feedback. </div><p>Source: <a href="https://habr.com/ru/post/162081/">https://habr.com/ru/post/162081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162071/index.html">Final Selection Skolkovo MD</a></li>
<li><a href="../162073/index.html">Computer on Elm Street</a></li>
<li><a href="../162075/index.html">SMS ransomware in the form of a set of plug-ins for browsers</a></li>
<li><a href="../162077/index.html">Copyright history. Part 3: Monopoly is dying ... and reborn</a></li>
<li><a href="../162079/index.html">Working with ContactListener from Box2d to Libgdx</a></li>
<li><a href="../162085/index.html">RAW collective processing service</a></li>
<li><a href="../162087/index.html">Collectd - Monitor the system with minimal cost. Setting and using notifications</a></li>
<li><a href="../162091/index.html">SMS notifications from nagios by means of clickatell.com and site monitor on bash</a></li>
<li><a href="../162093/index.html">EPAM IT Share # 3: Search for related images. Define Cloud Computing</a></li>
<li><a href="../162095/index.html">Answers Minister of Communications to the questions of users: part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>