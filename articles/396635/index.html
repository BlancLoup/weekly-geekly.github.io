<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We manage NooLite devices from Zyxel Keenetic router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will talk about how to manage nooLite devices via a USB PC1xx adapter directly from a Zyxel Keenetic router - without a computer. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We manage NooLite devices from Zyxel Keenetic router</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/fb4/f06/ba8/fb4f06ba81d27b58a54bbe44adbdbb61.png" alt="image"><br><br>  In this article I will talk about how to manage nooLite devices via a USB PC1xx adapter directly from a Zyxel Keenetic router - without a computer. <br><br><h3>  Preamble </h3><br>  Themes about NooLite have already flashed here more than once, but just in case, let me remind you that these are components for building a ‚Äúsmart home‚Äù that communicate with each other via a radio channel.  You can also order a USB adapter to their system, which allows you to send commands from a computer (in fact, there is one that can receive these commands, but we will not consider it now).  Once upon a time, I specifically raised a Web server on my machine, which I could access from a computer or phone on my home network and control the lighting, as well as add scheduled tasks.  For example - I, like a true owl, hardly wake up early in the morning, and even would not do it with pleasure, but I must.  And to wake up in the dark from the sound of the alarm clock, it was extremely difficult, even if you put on it the sweetest melody, of all the sweet melodies on earth.  And I decided to conduct an experiment by writing a script for smoothly turning on the light, when the brightness increases from 0 to 100% in 20 minutes, thereby imitating the sunrise, and the experiment was a success - it became much easier to wake up when the light does not sharply hit the eyes, but barely increases noticeably, and the body reacts to such an awakening much better than the alarm clock ... But something I left the topic.  It all worked quietly for myself, and yet I wasn‚Äôt even bothered by the fact that a constantly turned on computer was required, I had quiet fans and it was hardly heard, but not so long ago after learning that you could install OpenWRT packages on Zyxel Keenetic with the second version firmware an idea began to ripen in my mind.  And when this idea completely finished me, in no way wanting to leave my brain alone, I decided - well, to hell with it!  Ahead of the weekend, and I will do it! <br><a name="habracut"></a><br><h3>  Agenda </h3><br>  So what did I actually do?  I did the following: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      - Web-based light and load control interface directly in Zyxel Keenetic router. <br>  - Commands are sent directly from the router, via the USB transmitter NooLite (PC1xxx) plugged into the USB port of the router. <br>  - In the web interface, you can configure scheduled tasks for cron to control the light. <br>  - A console utility that allows you to send commands directly from the command line of the router (under SSH) and if my web interface was not to your taste, you can write your own or embed its call from anywhere. <br><br>  <b>Shut up and take my money</b> <br>  So what we need to configure.  To begin with, we will prepare a router, this is done simply and in sufficient detail described <a href="https://habrahabr.ru/post/306378/">here</a> .  Next we need to install several packages, therefore we do the following: <br><br><pre><code class="bash hljs">opkg update opkg install php5-cgi lighttpd-mod-fastcgi cron</code> </pre> <br>  This command installs a web server, php, and cron for scheduling tasks.  I would also put the Midnight Commander, for it is more convenient: <br><pre> <code class="bash hljs">opkg install mc</code> </pre><br>  Next, edit the Web server settings: /opt/etc/lighttpd/lighttpd.conf specifying the correct port: <br> <code>server.port = 82 <br></code> <br>  The 80th port is already occupied by the web interface of the router, so we select another one. <br>  Then we edit the file: /opt/etc/lighttpd/conf.d/30-fastcgi.conf, doing this: <br><br> <code>fastcgi.server = ( ".php" =&gt; <br> ( "php-local" =&gt; <br> ( <br> "socket" =&gt; "/opt/tmp/php-fastcgi-1.socket", <br> "bin-path" =&gt; "/opt/bin/php-fcgi", <br> "max-procs" =&gt; 1, <br> "broken-scriptfilename" =&gt; "enable", <br> ) <br> ), <br> # ..... <br> # ..... <br> ) <br></code> <br><br>  That's all, and now we start the server: <br><br><pre> <code class="bash hljs">lighttpd -f /opt/etc/lighttpd/lighttpd.conf</code> </pre><br>  This preparation is completed, and you can proceed to the most important.  Download <a href="">this</a> archive.  It contains the program, a couple of libs, and php files.  From the binaries folder we throw the binaries on the router's USB flash drive, bin in bin, lib in lib, share in share.  In theory, he should not offer something to replace, but if he offers, we refuse, because we need to figure it out.  If you do not trust me, then in the archive in the source folder is the source code of the utility for sending NooLite commands, you can build it yourself.  How to do this is a separate topic, I will not paint here, there is a lot of information about this on the net.  So, if all the files are thrown in their places, you can check the performance of this miracle.  Go to the browser and enter the IP address of the router and the port that you specified in the web server settings. <br> <code>http://192.168.1.1:82/ <br></code> <br><img src="https://habrastorage.org/getpro/geektimes/post_images/19e/294/730/19e294730d125d9604a924e33e298821.png" alt="image"><br><br>  Here we should see a page with lighting control.  But not yours, but mine.  In order to make your settings, you need to edit the file: /opt/share/www/config.php <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/4d2/4da/ab6/4d24daab6b910e532de44056b94df658.png" alt="image"><br><br>  I specifically documented it with comments, I think there will be no problems with editing it.  After you configure everything to fit your configuration, you can start using it.  The web interface is made more for mobile devices, but on the desktop you can also use it.  Special attention is paid to what to create, enable, disable and delete tasks for cron, you can directly from the browser, with changes, cron will be restarted and you do not need to think about anything.  If you want to use the console utility, just type the following command in SSH: <br>  noolite <br><br>  You will see a list of parameters, here, too, nothing complicated. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3b6/908/973/3b6908973ee96a2abaf68ea891ec27d4.png" alt="image"><br><br>  I checked it on Zyxel Keenetic Giga II, it has 2 USB ports, but as far as I know, on routers with one USB port, you can use a hub.  I decided to check it out and it worked for me through the hub. <br><br>  That's all, I hope you were interested and you found this article useful.  If you have questions - ask, I will be glad to answer. </div><p>Source: <a href="https://habr.com/ru/post/396635/">https://habr.com/ru/post/396635/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../396625/index.html">Personal electronic computer "Apogee BK-01"</a></li>
<li><a href="../396627/index.html">New IKEA batteries and chargers</a></li>
<li><a href="../396629/index.html">Backblaze statistics: determine the best HDD in the 2nd quarter of 2016</a></li>
<li><a href="../396631/index.html">In China, launched a bus portal - and he was fake</a></li>
<li><a href="../396633/index.html">Seagate has introduced a new 60 TB SSD</a></li>
<li><a href="../396637/index.html">Invented a very useful "acoustic prism"</a></li>
<li><a href="../396641/index.html">Another smart home, in several parts. Weather station from scrap materials</a></li>
<li><a href="../396645/index.html">50 shades of stub * Microchip microcontroller I / O ports</a></li>
<li><a href="../396647/index.html">FAS fined Google 438 million rubles</a></li>
<li><a href="../396649/index.html">Bitfinex bitcoin-exchange hacked and brought about $ 65 million in equivalent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>