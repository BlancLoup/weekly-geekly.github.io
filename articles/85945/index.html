<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sorting task</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Perhaps, this task will seem trivial to someone, but personally I spent several hours on it, having spent the prompts ‚Äúhall opinion‚Äù and ‚Äúcall a frien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sorting task</h1><div class="post__text post__text-html js-mediator-article"> Perhaps, this task will seem trivial to someone, but personally I spent several hours on it, having spent the prompts ‚Äúhall opinion‚Äù and ‚Äúcall a friend‚Äù.  Why did I decide this?  The answer is simple: I really needed to implement such an approach for my small site, <a href="http://www.odio.ru/">Odio.ru.</a>  In short, there are published records from a variety of sites, contracted by RSS.  The difficulty is that the dates in these records can completely coincide (even within one tape), while the sequence ID makes sense only within one tape, but does not affect the entire stream of records.  So let's go to the conditions of the problem. <br><br><a name="habracut"></a>  Since this is a blog about MySQL, I will <code>SHOW CREATE TABLE</code> for our test table: <br><br> <code>CREATE TABLE `test` ( <br> `id` int(10) unsigned NOT NULL AUTO_INCREMENT, <br> `date` datetime NOT NULL, <br> `content` varchar(255) NOT NULL, <br> PRIMARY KEY (`id`), <br> KEY `date` (`date`) <br> ) ENGINE=MyISAM;</code> <br> <br>  Now fill it with test data: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>INSERT INTO `test` (`id` ,`date` ,`content`) <br> VALUES (NULL , '2010-03-01 11:00:00', 'Test 1'), <br> (NULL , '2010-03-01 12:00:00', 'Test 2'), <br> (NULL , '2010-03-01 13:00:00', 'Test 4'), <br> (NULL , '2010-03-01 12:00:00', 'Test 3'), <br> (NULL , '2010-03-01 14:00:00', 'Test 5');</code> <br> <br>  As a result, we get the following table ( <code>SELECT * FROM `test` ORDER BY `id`</code> ): <br><br> <code>| 1 | 2010-03-01 11:00:00 | Test 1 | <br> | 2 | 2010-03-01 12:00:00 | Test 2 | <br> | 3 | 2010-03-01 13:00:00 | Test 4 | <br> | 4 | 2010-03-01 12:00:00 | Test 3 | <br> | 5 | 2010-03-01 14:00:00 | Test 5 |</code> <br> <br>  As you can see, the table is now sorted by ID and the dates are in the wrong order. <br><br>  Now, actually, the task itself: we have one of the entries at the entrance (that is, we know the ID and DATE), <b>we need to get the ID of the neighboring records</b> (previous and next), while if the DATE is the same, then the previous record will have an ID less than the current and the next one has more. <br><br>  The observant reader will immediately understand that if you just do (for the previous record): <code>SELECT `id` FROM `test` WHERE `date` &lt;= $date AND `id` != $id ORDER BY `date` DESC, `id` DESC LIMIT 1</code> , then we will "loop" between records 2 and 4, because they have the same DATE - that is, 2 will have a previous one for 4, and 4 will have a previous one for 2. At the same time, it is important that extreme records (1 and 5) as neighbors (respectively, the previous one for 1 and the next one for 5) did not return. <br><br>  To simplify, let's look only for the previous entry.  We start with 5 entries, we have ID = 5 and DATE = '2010-03-01 14:00:00'.  We need to get record 3, and then we get for the conditions ID = 3 and DATE = '2010-03-01 13:00:00', and so on ... <br><br>  I will clarify right away, the task has at least one solution;) One request - one previous entry, the same query with different parameters - the next previous entry.  That is, the option "get everything and walk on it" does not fit.  Also, the option ‚Äúadd a column ORDER_NUM and rebuild it for the whole table when adding a new record‚Äù is not suitable.  The option ‚Äúwrite IDs of already shown records and exclude them from the sample‚Äù is no longer suitable. <br><br>  In general, we need an ‚Äúhonest‚Äù request, which, by the ID and DATE of the current record, will return the real ID of this previous record. <br><br>  In order to avoid unnecessary flames in the comments, I answer immediately: yes, I deliberately hung the link to the address of my site, because it is a living example of the application of the solution to this problem.  Well, of course, like any other site, he wants to come to him more often;) <br><br>  Also, I reserve the right to use your request if it turns out to be better than what I came up with;) Naturally, with your permission ... <br><br>  If in the conditions of the task something is not clear, I will be happy to clarify in the comments. <br><br>  And please do not need to write: ‚ÄúWhat kind of nonsense?  Use% framework_name%, it will do everything for you ... ‚Äù- I'm not interested, and the blog about MySQL, the task of sorting in MySQL, so we do everything within MySQL. <br><br>  <b>UPDATE</b> Found 1 solution: <br><br> <code>SELECT `id` <br> FROM `test` <br> WHERE `date` &lt; $date or (`date` = $date and `id` &lt; $id) <br> ORDER BY `date` DESC, `id` DESC LIMIT 1</code> <br> <br>  <a href="https://habrahabr.ru/users/sabmakc/" class="user_link">Submitted by</a> : <a href="https://habrahabr.ru/users/sabmakc/" class="user_link">SabMakc</a> <br><br>  There are other solutions, perhaps more complicated than the one presented, but, nevertheless, you can continue the search ... <br><br>  <b>UPDATE 2</b> I cite a ‚Äúcomplex‚Äù three-story solution to this problem: <br><br> <code>SELECT `id`, `date`, IF (`date` = $date AND id &lt; $id, 0, 1) AS `ordr` <br> FROM `test` <br> WHERE `date` &lt;= $date AND `id` != $id <br> HAVING `date` &lt; IF (`ordr` = 1, $date, NOW()) <br> ORDER BY `ordr`, `date` DESC, `id` DESC <br> LIMIT 1</code> <br> <br>  This is my decision.  In essence, it does the same thing as the previous <a href="https://habrahabr.ru/users/sabmakc/" class="user_link">SabMakc</a> solution, but through a slightly different gate ... </div><p>Source: <a href="https://habr.com/ru/post/85945/">https://habr.com/ru/post/85945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85934/index.html">LG GX500 Review</a></li>
<li><a href="../85936/index.html">23 short films in two days: HackDay3 was held in St. Petersburg on February 20-21</a></li>
<li><a href="../85942/index.html">How not to buy on ebay</a></li>
<li><a href="../85943/index.html">Competition for SaaS Solutions Developers</a></li>
<li><a href="../85944/index.html">Site of administration of Lipetsk</a></li>
<li><a href="../85947/index.html">Exchange of private tasks and assignments - nastoronu.ru</a></li>
<li><a href="../85948/index.html">Beautiful and correct dates in any language.</a></li>
<li><a href="../85949/index.html">The first prototype for Windows Phone 7</a></li>
<li><a href="../85950/index.html">Freedom or fear. Make your choice</a></li>
<li><a href="../85952/index.html">Get inspired with InspireMe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>