<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shine and Poverty Java for Desktop</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You will not believe it, but in 2018 you still need to develop Desktop applications. 

 Imagine such a club of anonymous Java programmers, drunken and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Shine and Poverty Java for Desktop</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/_y/vd/kh/_yvdkhyuwe-iy3oaxnlrxbjzvay.png" alt="image"></div><br>  You will not believe it, but in 2018 you still need to develop Desktop applications. <br><br>  Imagine such a club of anonymous Java programmers, drunken and fast-boned, who sit and share their problems. <br><br>  - Hello, my name is Yuri, I am writing a Desktop application in 2018. <br>  - Hello, Yuri, let him pat, he was able to share his problem! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Yes, indeed, we are still writing Desktop applications.  Usually, I don‚Äôt really want to do this, most often these are legacy projects.  But it happens that you need to write and new desktop applications. <br><br>  Why are we still doing this if there is a web with its new advanced features: Progressive Web Apps, Service Worker, Web RTC, Web GL, etc? <br><br>  Under the cut I will tell you how to live with it and what does Java have to do with it. <br><a name="habracut"></a><br>  Unfortunately, web and desktop still cannot be compared in terms of number of possibilities.  The Web will never give us anything that a user machine gives us.  First of all, it is working with local files and devices.  We can process big data on the client, use specific equipment, well, we can refer to what we want. <br><br>  For example, we can use a fingerprint scanner and other fancy devices.  Most often, additional equipment is used in enterprise applications: banks, ERP, accounting, etc.  Here it is all exactly needed. <br><br>  In addition, there are tasks that can be badly solved in the web.  The main one is server and network independence. <br><br>  It is especially important if your application will be used on laptops.  We assume that in 2018 laptops finally won and now can not get away from them.  Very often, people work with a laptop on trains and airplanes offline and they need to be able to work locally with data that is already loaded on their car.  The web is still difficult to implement this behavior. <br><br><h2>  And what about Java? </h2><br>  Recently, Java desktop technologies are not evolving: Swing is frozen forever, there are no new features in SWT.  The latest live desktop technology is Java FX. <br><br>  The impact of web technologies on desktop frameworks is very large.  Qt invented its own Qt Script and QML based on JavaScript, and in Java FX they implemented support for CSS.  Sadly, CSS in Java FX is partially implemented and all properties of components differ from properties in web-UI. <br><br>  As a result, we must again study the specific framework for the desktop, instead of reusing a huge amount of ready-made developments for the UI from the world of the web. <br><br>  And the personnel question comes to the fore here: no one is eager to write desktop applications on Swing and Java FX, but at the same time, the market is full of good web-UI specialists. <br><br>  Java on the desktop causes pain not only because of Java FX / Swing.  Recently, <a href="http://www.oracle.com/technetwork/java/javase/9-deprecated-features-3745636.html">Oracle decided to kill the Web Start technology</a> . <br><br>  Everything goes to one thing - specialized UI frameworks for desktop applications die. <br><br><h2>  Where to run!? </h2><br>  And now, about how to reuse your experience in web development and web-UI in the development of desktop systems in Java.  So that you do not have to develop separate web and desktop applications. <br><br>  <a href="https://electronjs.org/">Electron.js</a> is a fairly well-known framework that allows you to use web technologies for developing desktop applications.  This is the technology on which the GitHub Atom editor is built.  Atom is the first widely-known desktop application built on HTML / JavaScript / CSS and Node.js. <br><br>  Electron.js is an Open Source framework that allows you to write UI for desktop applications on a web stack.  You might be surprised, but a whole bunch of tools and applications are now built on this framework: Slack / Skype and VS Code are used for UI by Electron.js. <br><br>  In a nutshell, Electron consists of server-side JavaScript - Node.js and Chromium integrated web browser in one executable process, which allows the use of native operating system features: windows, notifications, tray icons and much more. <br><br>  Until recently, this framework assumed the development of applications only in JavaScript.  But we figured out how to use it for our Java applications! <br><br>  There are two options for developing applications: <br><br><ol><li>  Compile Java to JS </li><li>  Run the JVM unnoticed by the user and show the UI in the web browser </li></ol><br>  If you already have a frontend on JS, then there is nothing to think about, it remains to pack it into Electron.js and get a desktop application.  So do, for example, in the Slack messenger. <br><br>  And if you have a lot of Java code?  And while it can not just be collected in JS, you will immediately lose your reflection, access to hardware and the possibility of using common libraries. <br><br>  In this case, you can use a special Node.js module - <a href="https://nodejs.org/api/child_process.html">child_process</a> , which allows you to start child processes in all major operating systems.  In essence, we need to implement one JS file that will launch the JVM and open the Electron window: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (platform === <span class="hljs-string"><span class="hljs-string">'win32'</span></span>) { serverProcess = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'child_process'</span></span>) .spawn(<span class="hljs-string"><span class="hljs-string">'cmd.exe'</span></span>, [<span class="hljs-string"><span class="hljs-string">'/c'</span></span>, <span class="hljs-string"><span class="hljs-string">'demo.bat'</span></span>], { <span class="hljs-attr"><span class="hljs-attr">cwd</span></span>: app.getAppPath() + <span class="hljs-string"><span class="hljs-string">'/demo/bin'</span></span> }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { serverProcess = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'child_process'</span></span>) .spawn(app.getAppPath() + <span class="hljs-string"><span class="hljs-string">'/demo/bin/demo'</span></span>); }</code> </pre> <br>  The main thing is not to forget to kill this process afterwards, when the application window is closed, which is easy to do with the <a href="https://www.npmjs.com/package/tree-kill">tree-kill</a> module: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> kill = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'tree-kill'</span></span>); kill(serverProcess.pid, <span class="hljs-string"><span class="hljs-string">'SIGTERM'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server process killed'</span></span>); serverProcess = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; mainWindow.close(); });</code> </pre><br>  The full code of such integration is in my <a href="https://github.com/cuba-labs/java-electron-tutorial">tutorial</a> .  It uses Vaadin as a framework for the UI, which allows you to write all Java code without JS, and the Jetty servlet container is integrated directly into the application.  We can run the application without deployment, like the same Spring Boot. <br><br>  In this embodiment, our frontend will access the JVM over the network, which is somehow strange.  I sweetened the pill a bit by changing the transport between the browser and the JVM to the WebSocket protocol.  Vaadin makes it <a href="https://vaadin.com/docs/v8/framework/advanced/advanced-push.html">extremely easy</a> to do.  So we significantly reduce the time to send messages from the frontend to the JVM over the network, literally up to 1ms and get rid of unnecessary HTTP garbage: headers and cookies, and also do not create a connection, but always use ready-made. <br><br>  On this stack I wrote a <a href="https://github.com/jreznot/electron-java-app">small TODO application</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9u/6i/2p/9u6i2pwxmtdmi4rerigff_rfp1q.png" alt="image"></div><br>  There you will find some more cool tricks: <br><br><ul><li>  loading static files (CSS / JS) directly from disk bypassing the JVM </li><li>  access to Electron.js API from Java </li><li>  custom header windows on HTML and CSS </li><li>  automatically installing Node.js from Gradle </li></ul><br>  Well, now let's get rid of the net!  For a long time in operating systems * nix and Windows there is an API for interprocess communication - IPC.  On Windows, it is called named pipes, and on * nix, it is called Unix sockets.  This is a buffer / virtual file in RAM that is controlled by the OS and allows two independent processes to transfer data. <br><br>  For the sake of diversity, I implemented this approach on <a href="https://github.com/jreznot/kotlin-hd">Kotlin and Kotlin.js</a> . <br><br>  In Node.js, we can easily create both a named pipe and a Unix socket using the - <a href="https://nodejs.org/api/net.html">net</a> module: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pipeServer = net.createServer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function">) </span></span>{ stream.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Pipe: '</span></span>, c.toString().trim()); }); stream.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ pipeServer.close(); }); pipeStream = stream; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Pipe is connected'</span></span>); global.pipe.send(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, {}); }).listen(PIPE_PATH, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// start JVM process here }); }</span></span></code> </pre><br>  To work with named pipe from Java / Kotlin you need to use the RandomAccessFile class: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pipe: RandomAccessFile <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { pipe = RandomAccessFile(<span class="hljs-string"><span class="hljs-string">"\\\\.\\pipe\\demo"</span></span>, <span class="hljs-string"><span class="hljs-string">"rw"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (f: FileNotFoundException) { println(<span class="hljs-string"><span class="hljs-string">"Unable to open communication pipe"</span></span>) exitProcess(-<span class="hljs-number"><span class="hljs-number">7</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>: String? = pipe.readLine() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// do something data = pipe.readLine() }</span></span></code> </pre><br>  So we can completely get rid of the network and not start the HTTP server on the user's machine.  And of course, the performance of such a solution is better than transferring data through the network stack. <br><br><h2>  Why do we need this? </h2><br>  As you probably know, we are making a tool for developers - <a href="https://www.cuba-platform.com/download">CUBA Studio</a> , which allows you to quickly write business applications on the CUBA Platform. <br><br>  We used the Vaadin framework in the CUBA Platform and CUBA Studio, which allowed us to reuse a large number of developments.  From the very first release, CUBA Studio has been a web application that runs locally and shows the UI in a web browser. <br><br>  Using this approach, we were finally able to give developers the convenience of using a desktop application: windows, browser independence, Alt + Tab switching, and an icon in the taskbar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nz/sq/ns/nzsqnsuqlftqvsixo8gmead-sv0.png" alt="image"></div><br>  CUBA Studio still uses the network, but WebSocket is involved instead of AJAX.  This is enough for users to feel no UI delays. <br><br>  The Electron.js ecosystem pleased us with <a href="https://github.com/electron-userland/electron-builder">additional tools</a> . <br><br><ul><li>  modules for creating installation files and packages </li><li>  smooth auto update </li></ul><br>  As you might guess, CUBA Studio is not the ultimate goal. <br><br><h2>  How to replace Swing in our applications </h2><br>  From the very first public release of the platform, we have provided two technologies for building a UI: a web client based on Vaadin and a desktop client based on Swing.  The implementation of Generic UI allows us to write code that works in two versions automatically, of course, with appropriate restrictions. <br><br>  The desktop client was developed in 2011 on the basis of Swing, because then there was no other stable and viable technology for desktop applications in Java. <br><br>  But everything changes. <br><br>  Today we are faced with new requirements for desktop user interfaces: responsive UI, animation, integration with network services such as Google.  In essence, applications move towards the web UI technologies, and we cannot ignore this movement. <br><br>  I see only one alternative to Swing and Java FX - Electron.js.  Therefore, I tried to adapt this approach for our applications: <br><br><ol><li>  We take a web client </li><li>  Add Electron.js </li><li>  We pack everything and give it to the client </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jn/2p/o9/jn2po9y9w4aqxmy7cy0tu_fisrm.png" alt="image"></div><br>  Applications on the CUBA Platform can be distributed as a <a href="https://doc.cuba-platform.com/manual-latest/uberjar_deployment.html">Uber JAR</a> .  This version of deployment allows you to start the application with a simple command: <br><br> <code>&gt; java -jar app.jar <br></code> <br><br>  We just need to add a special launch script on Electron and get a Desktop client from a ready-made web application! <br><br>  You can find the full application code <a href="https://github.com/cuba-labs/cuba-electron-demo">here</a> . <br><br><h2>  Yes, you are crazy! </h2><br>  I also thought that the guys from GitHub were crazy.  But gradually penetrated.  I want to have a flexible UI creation tool, and the most flexible tool today is HTML / JS / CSS. </div><p>Source: <a href="https://habr.com/ru/post/353440/">https://habr.com/ru/post/353440/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353430/index.html">18 rules of the perfect psd layout - a useful checklist for designers</a></li>
<li><a href="../353432/index.html">How to write an exchange with 50 suppliers and do not go crazy</a></li>
<li><a href="../353434/index.html">Choose Yii2 or laravel</a></li>
<li><a href="../353436/index.html">How the Internet of Things shifts analytics to the periphery</a></li>
<li><a href="../353438/index.html">Features of setting up and launching PVS-Studio in Docker using the example of Azure Service Fabric code</a></li>
<li><a href="../353444/index.html">We write the plugin for Unity correctly. Part 2: Android</a></li>
<li><a href="../353446/index.html">Operators?. ?? and |>: future JavaScript features you'll like</a></li>
<li><a href="../353448/index.html">Great, we are going to devOps-ping. So, 15 years of planning?</a></li>
<li><a href="../353458/index.html">Code generation during application operation: real examples and techniques</a></li>
<li><a href="../353460/index.html">RTCP REMB: we twist the video call settings in the browser</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>