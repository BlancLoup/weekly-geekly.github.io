<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Get to know WannaCry</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The ransomware attack caused damage to many companies and organizations around the world, including the Spanish telecommunications company Telefonica,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Get to know WannaCry</h1><div class="post__text post__text-html js-mediator-article">  The ransomware attack caused damage to many companies and organizations around the world, including the Spanish telecommunications company Telefonica, hospitals in the UK and the US delivery company FedEx.  A malicious program belonging to the class of cryptographers has become known as ‚ÄúWannaCry‚Äù. <br><br>  The malware can TCP port 445 (Server Message Block / SMB) and spread like a worm, attacking hosts and encrypting the files on them.  After that, he needs to list a certain number of bitcoins for decryption. <br><a name="habracut"></a><br>  In connection with this attack, it was recommended to all organizations to make sure that the latest updates were installed on their computers running on Windows.  Also on them should be closed ports 139 and 445 for external access.  Ports are used by the SMB protocol. <br><br>  It should also be noted that the threat is still being actively investigated, so that the situation may change depending on the reaction of the attackers to the actions of computer security specialists. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>CAMPAIGN DETAILS</b> <br><br>  We saw a spike in scanning our ‚ÄúInternet Lures‚Äù, which began almost at 5 am EST (9 am UTC). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/529/f87/b3b/529f87b3b3f0c0d512852d7a17d8ffea.gif" alt="image"><br><br>  <b>INFRASTRUCTURE ANALYSIS</b> <br><br>  Researchers at Cisco Umbrella first noticed requests to the domain switch (iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea [.] Com), which began at 07:24 UTC, and after only 10 hours, the number of requests already exceeded 1400 per hour ( <b><i>approx. Transl</i></b> .: Apparently, it‚Äôs about requests for their service). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f90/10d/b6e/f9010db6e1975de306332513b46949c5.png" alt="image"><br><br>  The domain name looks like it was composed by humans, since most of the characters are on adjacent rows of the keyboard. <br><br>  This domain can be called a switch, based on its role in the execution of the malware: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ac/e62/48f/5ace6248f329b92f3f1233f17d0f6c8e.png" alt="image"><br><br>  The code above attempts to get a GET request to the domain and, in case of failure, continues to propagate.  If the request is successful, the program ends.  Now the domain is registered to a known <a href="https://en.wikipedia.org/wiki/DNS_sinkhole">DNS funnel</a> , which causes it to interrupt a malicious action. <br><br>  From the translator: The <a href="https://en.wikipedia.org/wiki/Command_and_control_(malware)">C &amp; C domain was</a> specifically registered, according to <a href="https://twitter.com/MalwareTechBlog">MalwareTech's tweeter, to stop or suspend the distribution of Malvari</a> . <br><br>  <b>ANALYSIS OF THE HARVEST</b> <br><br>  The original mssecsvc.exe file runs another file called tasksche.exe.  Then the domain switch is checked, after which the service mssecsvc2.0 is created.  This service executes the mssecsvc.exe file with a different entry point than during the first launch.  The second launch receives the IP address of the infected machine and tries to connect to the 445 TCP port of each IP address within the subnet.  When the malware successfully connects to a remote machine, a connection is established and data is transferred.  Apparently, somewhere in the process of this transfer, a known vulnerability is used, which was closed by updating MS 17-010.  At the moment there is no complete understanding of SMB traffic, and under what conditions the malware can spread, using a security hole. <br><br>  The taskche.exe file checks all drives, as well as folders and connected devices that are linked to letters, like 'C: /', 'D: /', etc.  Malware then looks for files with the extensions that are listed in the program (and are listed below) and encrypts them using 2048-bit RSA encryption.  While the files are encrypted, the Tor / folder is created where the tor.exe file is placed and the 9 dll files it uses.  Additionally, taskdl.exe and taskse.exe are created.  The first one deletes the temporary files, and the second launches @ wanadecryptor @ .exe, which shows the user a window asking him to pay.  The @ wanadecryptor @ .exe file is responsible only for displaying the message.  File encryption occurs in the background using tasksche.exe. <br><br>  The tor.exe file is launched using @ wanadecryptor @ .exe.  This new process starts connecting to Tor nodes.  Thus, WannaCry maintains anonymity by passing all of its traffic through the Tor network. <br><br>  As is typical for ransomware programs, the program also deletes any <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BD%25D0%25B5%25D0%25B2%25D0%25B0%25D1%258F_%25D0%25BA%25D0%25BE%25D0%25BF%25D0%25B8%25D1%258F">shadow copies</a> on the victim's computer to make recovery even more difficult.  This is done using WMIC.exe, vssadmin.exe and cmd.exe <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/87f/556/2a0/87f5562a0569a2c47f1b97f159d1efdb.png" alt="image"></div><br>  WannaCry uses various ways to help its accomplishment.  So it is used attrib.exe, to change the flag + h (hide), as well as icacls.exe, to give full rights to all users: ‚Äúicacls.  / grant Everyone: F / T / C / Q ". <br><br>  It is noteworthy that the program has a modular architecture.  It is likely that all executable files in it are written by different people.  Potentially, this may mean that the structure of the program may allow different malicious scripts to be run. <br><br>  After the encryption is complete, the malware displays a window requesting a ransom for the files.  An interesting point is that the window is an executable file, not a picture, an HTA file, or a text file. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96b/2e3/cdc/96b2e3cdc501473b52d3399cc8851a12.jpg" alt="image"></div><br>  Victims should understand that there is no obligation for criminals to actually provide the keys for decryption after paying the ransom. <br><br>  <b>HOW TO FIGHT</b> <br><br>  To combat this malware there are two recommendations: <br><br><ul><li>  Ensure that all computers using Windows have the latest update.  At a minimum, update MS17-010. </li><li>  In accordance with the best practices, any organization in which SMB is publicly available (ports 139, 445) should immediately block incoming traffic. </li></ul><br>  <b>Lesion indicators</b> <br><br>  File Names: <br><br><ul><li>  d5e0e8694ddc0548d8e6b87c83d50f4ab85c1debadb106d6a6a794c3e746f4fa b.wnry </li><li>  402751fa49e0cb68fe052cb3db87b05e71c1d950984d339940cf6b29409f2a7c r.wnry </li><li>  e18fdd912dfe5b45776e68d578c3af3547886cf1353d7086c8bee037436dff4b s.wnry </li><li>  4a468603fdcb7a2eb5770705898cf9ef37aade532a7964642ecd705a74794b79 taskdl.exe </li><li>  2ca2d550e603d74dedda03156023135b38da3630cb014e3d00b1263358c5f00d taskse.exe </li><li>  97ebce49b14c46bebc9ec2448d00e1e397123b256e2be9eba5140688e7bc0ae6 t.wnry </li><li>  b9c5d4339809e0ad9a00d4d3dd26fdf44a32819a54abf846bb9b560d81391c25 u.wnry </li></ul><br>  IP used: <br><br><ul><li>  188 [.] 166 [.] 23 [.] 127: 443 </li><li>  193 [.] 23 [.] 244 [.] 244: 443 </li><li>  2 [.] 3 [.] 69 [.] 209: 9001 </li><li>  146 [.] 0 [.] 32 [.] 144: 9001 </li><li>  50 [.] 7 [.] 161 [.] 218: 9001 </li><li>  217.79.179 [.] 77 </li><li>  128.31.0 [.] 39 </li><li>  213.61.66 [.] 116 </li><li>  212.47.232 [.] 237 </li><li>  81.30.158 [.] 223 </li><li>  79.172.193 [.] 32 </li><li>  89.45.235 [.] 21 </li><li>  38.229.72 [.] 16 </li><li>  188.138.33 [.] 220 </li></ul><br>  File Encryption Extensions: <br><br><pre><code class="bash hljs">.der, .pfx, .key, .crt, .csr, .p12, .pem, .odt, .sxw, .stw, .3ds, .max, .3dm, .ods, .sxc, .stc, .dif, .slk, .wb2, .odp, .sxd, .std, .sxm, .sqlite3, .sqlitedb, .sql, .accdb, .mdb, .dbf, .odb, .mdf, .ldf, .cpp, .pas, .asm, .cmd, .bat, .vbs, .sch, .jsp, .php, .asp, .java, .jar, .class, .mp3, .wav, .swf, .fla, .wmv, .mpg, .vob, .mpeg, .asf, .avi, .mov, .mp4, .mkv, .flv, .wma, .mid, .m3u, .m4u, .svg, .psd, .tiff, .tif, .raw, .gif, .png, .bmp, .jpg, .jpeg, .iso, .backup, .zip, .rar, .tgz, .tar, .bak, .ARC, .vmdk, .vdi, .sldm, .sldx, .sti, .sxi, .dwg, .pdf, .wk1, .wks, .rtf, .csv, .txt, .msg, .pst, .ppsx, .ppsm, .pps, .pot, .pptm, .pptx, .ppt, .xltm, .xltx, .xlc, .xlm, .xlt, .xlw, .xlsb, .xlsm, .xlsx, .xls, .dotm, .dot, .docm, .docx, .doc</code> </pre> <br>  ‚Üí <a href="http://blog.talosintelligence.com/2017/05/wannacry.html">Source</a> </div><p>Source: <a href="https://habr.com/ru/post/328548/">https://habr.com/ru/post/328548/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328538/index.html">Ransomware day: Wana Decrypt0r mass infection</a></li>
<li><a href="../328540/index.html">Security Week 19: Windows Defender launches someone else's code, a Trojan was in HandBrake, phishers attacked Gmail users</a></li>
<li><a href="../328542/index.html">About memory, tags and coherence</a></li>
<li><a href="../328544/index.html">Introducing 3CX V15.5 Beta</a></li>
<li><a href="../328546/index.html">Telegram of your business</a></li>
<li><a href="../328550/index.html">Organizing a large project on the Zend Framework 2/3</a></li>
<li><a href="../328552/index.html">Dirty game tricks</a></li>
<li><a href="../328554/index.html">Dark LinkedIn Patterns or Why You are Spammed by Friends, Encouraging You to Join LinkedIn</a></li>
<li><a href="../328556/index.html">Problems of Modern Data Science</a></li>
<li><a href="../328558/index.html">The best way to upload files to Ruby is with Shrine. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>