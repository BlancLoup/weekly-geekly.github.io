<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dog collar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 

 So, I have a dog. 
 Brief summary: 
 Nickname: Squirrel 
 Color: White with red 
 Breed: West Siberian with someone else 
 Origin: Nob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dog collar</h1><div class="post__text post__text-html js-mediator-article">  <b>Introduction</b> <br><img src="https://habrastorage.org/storage2/959/922/6d0/9599226d023f7e799198b8deee2367b1.jpg"><br>  So, I have a dog. <br>  <b>Brief summary:</b> <br>  Nickname: Squirrel <br>  Color: White with red <br>  Breed: West Siberian with someone else <br>  Origin: Noble <br>  Cost: 0p 0k <br><br>  The dog was purchased at its own entrance for food and shelter.  Was thrown out by some villains without food and water in a cardboard box without company logos of the breed and the address of the manufacturer.  Well, it does not matter, we have dealt with a lower-quality product, and here such a red face, and completely free.  We take! <br>  I had to take the goods as is, NO-NAME.  Most likely made in China.  Warranty claims are also unclear to whom to bring, and they were - in a dog there were worms longer than itself.  Fortunately, all this is in the past.  The beast has grown up.  She proved her loyalty and obedience, for which she was able to walk without a rope around her neck.  Since this is not just a dog, but a real reverie dog, which is used to a full four-time walk without a leash (I‚Äôm not at all aggressive, but very curious and obedient), it took a kind of beacon to watch its adventures even in the dark, and not nervous where did she go.  And to eat her is where - her favorite activity - to bring sticks to the owner, and to demand that he threw it.  Well, to find, really her business.  But this is not a simple dog, but a dog, whose folder is a programmer and a little bit of an electronics engineer.  However, even a simple collar with DealExtreme attracts the eyes of others, especially children are happy.  Isn't it worth it?  But let's start from the beginning.  Under the cut a lot of text! <br><a name="habracut"></a><br>  <b>Factory models</b> <br>  So, I ordered a collar with DX that glows in the dark.  If you're curious, <a href="http://dx.com/p/adjustable-2-mode-led-flashing-dog-collar-belt-orange-17830">here it is</a> . <br><img src="https://habrastorage.org/storage2/da7/682/dd1/da7682dd1052acbd5cf2892597d71f5f.jpg"><br>  Electronic unit in the housing <br><img src="https://habrastorage.org/storage2/87b/bab/2f2/87bbab2f2c05b0e0647d27623a002383.jpg"><br>  This is what his offal looks like when turned on. <br><img src="https://habrastorage.org/storage2/db1/fe2/4b5/db1fe24b56a03548e876c61f005d83f6.jpg"><br>  The light guide is actually transparent.  Made of some kind of flexible plastic or rubber, it has an oval cross section with a cutout for the LED and is fixed on top with heat shrink. <br><br>  Can I recommend it for purchase?  A moot point.  Yes and no.  Why yes?  He works.  Its light guide really shines, and there are 3 modes - constant, blinking and quickly blinking.  It is powered by one CR2032 battery.  Consumption about 20mah.  Why I will not recommend it?  Because the cunning Chinese saved a piece of light guide, and on my dog ‚Äã‚Äãit only lasts half the neck, since it turned out to be just opened to the full length.  However, even this is enough for the wow-effect from other dog breeders, and just very impressionable citizens.  Recently, collars have appeared much cheaper, and <a href="http://www.tinydeal.com/nylon-dog-collar-with-flashing-light-p-65834.html">in different colors</a> .  Here I am waiting for this <br><img src="https://habrastorage.org/storage2/4ea/2fa/e44/4ea2fae443e39cfeaee17ede2ef2e8fb.jpg"><br>  <b>Fresh addition.</b>  The collar came, very disappointed me.  It is small, it is faulty, it is very badly made.  I do not recommend. <br>  <s>I don‚Äôt presume to judge their sizes and exact characteristics, I don‚Äôt have one yet, but it will be soon,</s> because the redhead for my project doesn‚Äôt fit - through the colored collar you cannot see colors except red.  Ibey is also full of different modifications, it is searched for on request Dog collar.  And despite having a suitable collar, I decided to go further! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, the main idea was to make a collar on an RGB LED that would be shaded in different colors.  In China, I have not found such, but I want to do something unusual, which no one has!  Well, it's all the cooler than a simple red blinker!  Now arduin-haters will come running, and they will say that all that Atmel microcontrollers can do is flash diodes.  And they will be right - it turns out they do quite well, at least, the outputs are quite pulling the LED without the need to install transistors.  Of course, I did not embed the arduin into the collar, and I never had it once.  But with AtMega controllers dealt with.  Therefore, I chose AtTiny13A.  Why a?  Because they have clever energy saving technologies!  Let's figure it out! <br><br>  <b>Energy saving</b> <br>  Since the power from our batteries, the energy must somehow save.  At least in the off state.  We didn‚Äôt want to set the switch, so we have only one button to turn on, turn off and switch modes.  As a result of Datasheet smoking, it turned out that there is a special power-down mode that will help us save extra battery energy when the collar does not need to shine to the envy of those around!  Let's start with it.  There is a special interrupt INT0, which allows our sleeping beauty AtTiny to wake up without the help of seven dwarfs and the handsome prince - you just need to hang a specially trained button on the right foot!  So that's great!  On the button, just reset all the colors that we need to display to black, reset the settings of the last selected mode, well, all sorts of suppressing bounce of buttons, turning off the diode at the moment of pressing, and of course, switching the mode - why else does the user need this single button! <br><br><pre><code class="cpp">ISR (INT0_vect) 
{
	OFF_LED();
	WAITBUTTON();
	mode++;
	if (mode&gt;MAX_MODE) mode=0;
	want_new_color=1;
	need_delay=0;
	R_value=0;
	G_value=0;
	B_value=0;
	ON_LED();
}</code></pre><br>
<br>
!    ,        .      ,  !  - ? , ,         ,   .     ,   .<br>
<br>
<b>  </b><br>
-    .   <a href="http://bsvi.ru/bam-alternativa-shimu/">BAM</a>! -      ,  .     .      BAM.     -  .       0  255.  ,  .    ‚Äî      1,     128 ,     ‚Äî 64 ,  - 32,  . .  -      .   !  ,       ,    . ,           OCR0A.  :<br>
<br>
<pre><code class="cpp">ISR(TIM0_COMPA_vect)
{
	OCR0A&gt;&gt;=1;
	if (OCR0A==0) OCR0A=0x80;

	// 
	uint8_t leds=0xFF;

	//    
	if (R_value&amp;OCR0A) leds^=LED_R;
	if (G_value&amp;OCR0A) leds^=LED_G;
	if (B_value&amp;OCR0A) leds^=LED_B;

	//!
	PORTB=leds;
}</code></pre><br>
<br>
,  BAM (Bit angle modulation)   ,    (PWM ‚Äì Pulse Width Modulation),     !   ,       600 (4.8,  8),   8,     5 ,    ,        .  8, ,  ,   !  ?   , !    ,   :<br>
<pre><code class="cpp">OCR0A&gt;&gt;=1;
if (OCR0A==8) OCR0A=0x80;</code></pre><br>
,       .      ?     ,       power-down,         BAM          . ,       ASM-,          -128.     ‚Ä¶ (FOREVERALONE.JPG)<br>
<br>
 ?        .           (         ,        ).       ‚Äî 256    + .       ,       .      .<br>
<br>
<pre><code class="cpp">uint8_t inc_light(uint8_t value) {

	if (value&lt;50) value++;

	else if (value&lt;128) value+=2;
	else if (value&lt;253) value+=3;
	else value=255;
	return(value);
}</code></pre><br>
<br>
<b></b><br>
     .  main()     ,           R, G, B.     . ,     ¬´  ¬ª. Random()   ,       TCNT0.  ,   . <br>
<br>
<pre><code class="cpp">if (want_new_color) {
	new_color=color;
	while((color==new_color)|(new_color==0)) {
		new_color=((TCNT0^(TCNT0&gt;&gt;3)) &amp; 0b00000111);
	}	
	color=new_color;
	want_new_color=0;
}</code></pre><br>
<br>
,         ,  -      ,  ,       .          .<br>
<br>
  .  ‚Äî       .   .  ‚Äî . <br>
           .  ‚Äî ¬´ ¬ª. - .     ,     .   .    ‚Äî   , ,    .    AVR Studio 4.18 build 700, WinAVR-20100110.   992 ,   .     . ,   HEX .  ,  .   , . <br>
<br>
<b> </b><br>
  ,   .   ,    .<br>
<img src="http://habrastorage.org/storage2/852/36a/b99/85236ab99f6f885c03a034fafdd2a137.png"><br>
         4  .     BTN  GND       .     AtTiny13A,    .     2  CR2032 (6V),   <a href="http://habrahabr.ru/post/149830/"></a>   <a href="https://www.national.com/ds/LP/LP2980.pdf">LP2980</a>    5V    50mA.    ,         15mA.       ,     ¬´¬ª  ,      . ,       3.3V.  9.6     .    47, 10V,  B.   ,   ,    .  ,   ,       .    12V    ,      .<br>
 <br>
   ,   .<br>
<img src="http://habrastorage.org/storage2/d78/a50/59f/d78a5059f504cd63e2a333d2464ce27f.jpg"><br>
<br>
<img src="http://habrastorage.org/storage2/fb0/650/01d/fb065001d1b0e77c7058d981b5fd566d.jpg"><br>
<br>
,       .    ,      (   ).     ?  !<br>
<br>
<b></b><br>
    ‚Äî      .     ,    ,      ?     ,        7V,    5.5V   .   -  , .         65 .  , , .     fail:        ,  ,  .     .   ,      .      ,  ,        .   ,      .<br>
<br>
<b> </b><br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/3lAFHzGAsEU%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhi8M02Hgu9qZ1NwJG2FqAvf31wvFg" frameborder="0" allowfullscreen=""></iframe><br>
  ‚Äî    .      .   , !<br>
<br>
,    <a href=""></a>  <a href=""> </a><br>
<br>
.       ,     , ,  , <a href="http://youtu.be/xa7oC1tDgxE">home video</a>.       .  18+, .<br>
<br>
2.   ,     .          ,        ,   .<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/HycQVBxhbus%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhJ7mb0s8AjVGZo9gDh6twjVEmPbg" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/155427/">https://habr.com/ru/post/155427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155411/index.html">Coursera outlawed in Minnesota (updated)</a></li>
<li><a href="../155413/index.html">25 million new buildings appeared on Google Maps</a></li>
<li><a href="../155419/index.html">Microflees for programmers without any hassle</a></li>
<li><a href="../155421/index.html">Are you constantly distracted from work? Hire a clapper!</a></li>
<li><a href="../155425/index.html">The digest of interesting news and materials from the world of PHP for the last two weeks # 2 (10/6/2012 - 10/19/2012)</a></li>
<li><a href="../155429/index.html">What do programmers do and how to explain it to the others?</a></li>
<li><a href="../155431/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ27 (October 13 - 19, 2012)</a></li>
<li><a href="../155433/index.html">Using the Internet to control robots from space</a></li>
<li><a href="../155435/index.html">Development of Unity3d-plugin for working with Facebook</a></li>
<li><a href="../155437/index.html">Calculated fields for any LINQ provider</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>