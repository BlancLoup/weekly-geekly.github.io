<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Refactoring: highlight the method when it makes sense</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now it‚Äôs hard to remember the moment when I first realized that it‚Äôs a good idea to select functions from large pieces of useful code. Whether I got t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Refactoring: highlight the method when it makes sense</h1><div class="post__text post__text-html js-mediator-article">  Now it‚Äôs hard to remember the moment when I first realized that it‚Äôs a good idea to select functions from large pieces of useful code.  Whether I got this knowledge from <a href="http://www.amazon.com/Code-Complete-Practical-Handbook-Construction/dp/0735619670/ref%3Dsr_1_1">‚ÄúPerfect Code‚Äù</a> , or from <a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882/ref%3Dsr_1_2">‚ÄúClean Code‚Äù</a> is hard to remember.  In general, this is not particularly important.  We all know that we need to distribute business logic across well-named functions.  The longest feature I've ever seen in my life was a 5k line of video.  I am personally acquainted with the ‚Äúprogrammer‚Äù who wrote that code.  I remember the first time I met this function.  It is not difficult to predict that my first reaction was: ‚ÄúWhat the hell !!!  Who produced this piece of shit ??? ‚Äù <br>  Yes, imagine, this ‚Äúprogrammer‚Äù is still hanging around here in the office, where I am currently working on current projects.  I do not want to delve into this story, but I want to mention that that function with a length of 5k lines was the core of the program, approximately 150k lines in size.  The development of the program eventually came to a standstill, because of that terrible function that had a very negative effect on the architecture of the application.  In the end, it was decided to rewrite the application from scratch. <br><a name="habracut"></a><br>  This story illustrates one extreme of the problem of the size of functions, which led to disastrous consequences.  At the other extreme, turn off the brain and start allocating classes with single-line functions inside.  I do not mean that such functions are bad, I say that we should not forget to use the power of your brain.  First, you should consider the problem. <br>  Before I continue to explore the problem more deeply, I would like to note that, generally speaking, some time ago there was a small battle between Uncle Bob and Kristin Gorman on this topic.  Uncle Bob <a href="http://cleancoders.com/episode/clean-code-episode-3/show">presented a technique that he called ‚ÄúExtract till you drop‚Äù</a> , which briefly means - extract functions as long as there is something to extract.  Christine Gorman <a href="https://vimeo.com/49484333">found that this technique eliminates the use of the brain</a> .  In addition, there was a <a href="http://simpleprogrammer.com/2015/04/13/why-comments-are-stupid-a-real-example/">John Sonmez post about refactoring a single function from .NET BCL</a> (although the original purpose of the article was to show that most of the comments are evil). <br><br>  Let's look at an example of refactoring done by John.  He took for example the following method: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SplitDirectoryFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> directory, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">out</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> file</span></span></span><span class="hljs-function">)</span></span> { directory = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; file = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-comment"><span class="hljs-comment">// assumes a validated full path if (path != null) { int length = path.Length; int rootLength = GetRootLength(path); // ignore a trailing slash if (length &gt; rootLength &amp;&amp; EndsInDirectorySeparator(path)) length--; // find the pivot index between end of string and root for (int pivot = length - 1; pivot &gt;= rootLength; pivot--) { if (IsDirectorySeparator(path[pivot])) { directory = path.Substring(0, pivot); file = path.Substring(pivot + 1, length - pivot - 1); return; } } // no pivot, return just the trimmed directory directory = path.Substring(0, length); } return; }</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order to make this code easier to read, John created a new class by putting the refactored source method in it.  Here is what he did: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DirectoryFileSplitter</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> validatedFullPath; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rootLength; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> pivotFound; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Directory { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> File { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DirectoryFileSplitter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> validatedFullPath</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.validatedFullPath = validatedFullPath; length = validatedFullPath.Length; rootLength = GetRootLength(validatedFullPath); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Split</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (validatedFullPath != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { IgnoreTrailingSlash(); FindPivotIndexBetweenEndOfStringAndRoot(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!pivotFound) TrimDirectory(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TrimDirectory</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Directory = validatedFullPath.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, length); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindPivotIndexBetweenEndOfStringAndRoot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pivot = length - <span class="hljs-number"><span class="hljs-number">1</span></span>; pivot &gt;= rootLength; pivot--) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsDirectorySeparator(validatedFullPath[pivot])) { Directory = validatedFullPath.Substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, pivot); File = validatedFullPath.Substring(pivot + <span class="hljs-number"><span class="hljs-number">1</span></span>, length - pivot - <span class="hljs-number"><span class="hljs-number">1</span></span>); pivotFound = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IgnoreTrailingSlash</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (length &gt; rootLength &amp;&amp; EndsInDirectorySeparator(validatedFullPath)) length--; } }</code> </pre><br><br>  Wow, yes?  It‚Äôs not so easy to decide whether refactoring really helped make the code more readable.  The feeling that, in fact, it has become harder to read.  Previously, there was a relatively small function with helpful comments, which has now been turned into a class with four functions inside without comments.  I would not say that the new class is bad and the whole refactoring was a bad idea, and the programmer who did the refactoring should be executed.  Not at all.  I'm not so bloodthirsty.  There are several differences between these two code examples.  Consider these differences: <br><br><ol><li>  If you are trying to achieve a deep understanding of what the top-level function does, the function has become more difficult to read than it was originally, because now you need to skip all the functions and understand what is happening in each of them.  On the contrary, the initial version can easily be quickly run through the eyes. </li><li>  If you are trying to understand what the top-level function is doing conceptually, then the refactor version is easier to read, because we immediately see what the function is doing inside of the concept. </li><li>  The third difference I see is the cost of support.  As for our specific example, I would say that the cost of supporting the refactored version is higher than the original one (at least you need to refactor).  In general, the answer to the question of which option is more expensive to support lies in the plane of requirements.  These requirements dictate whether it is important in this situation to follow the SRP (the principle of sole responsibility) or not.  If this function can be written once and forgotten until the end of time, then there is no reason to waste time refactoring it.  On the contrary, if it is expected that the functionality will grow, then you have every reason to refactor the function into a separate class. </li></ol><br>  In addition, I want to touch upon a situation where you accidentally (or deliberately) stumble upon a similar function in the legacy system.  Do you immediately rush out to extract a class with four functions inside?  My advice - do not do this for no good reason, even if test coverage of your code base tends to be 100%.  Why?  Because there is no technical duty.  I'm talking about a serious technical duty, which is the cause of suffering. <br><br>  Thus, there is nothing wrong with the ‚Äúextract till you drop‚Äù technique.  You just have to keep some thoughts in my head, in my opinion. <br>  Summing up, I want to say that you should never commit meaningless acts.  You must first think, analyze, draw a conclusion, and only after that act. </div><p>Source: <a href="https://habr.com/ru/post/263371/">https://habr.com/ru/post/263371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263359/index.html">Operation Liberpy: Attackers Used Spyware in Latin America</a></li>
<li><a href="../263363/index.html">Add a hamburger to the Windows 10 application menu</a></li>
<li><a href="../263365/index.html">Porting Unity Editor to Linux: Things You Should Wanna Do in advance</a></li>
<li><a href="../263367/index.html">Cryptocurrency - how to create it?</a></li>
<li><a href="../263369/index.html">Integration of PVS-Studio with the IncrediBuild distributed assembly system</a></li>
<li><a href="../263373/index.html">Build your tab on the ribbon (Ribbon) AutoCad means. Net (C #)</a></li>
<li><a href="../263375/index.html">Why is it not easy to show all colors in a one-dimensional space, and how many times it can be done</a></li>
<li><a href="../263377/index.html">How software and hardware are used on computers in Russian companies</a></li>
<li><a href="../263379/index.html">Snipper - a little programmer assistant</a></li>
<li><a href="../263381/index.html">Registration for MBLTdev 15 - international conference of mobile developers has begun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>