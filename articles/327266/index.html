<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to beat groundhog day ‚Üí Automate testing of the KOMPAS-3D v17 interface</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article, we described how the KOMPAS-3D testing process is organized. We continue the topic. Today's post is devoted to how regression tes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to beat groundhog day ‚Üí Automate testing of the KOMPAS-3D v17 interface</h1><div class="post__text post__text-html js-mediator-article">  In the last <a href="https://habrahabr.ru/company/ascon/blog/327582/">article,</a> we described how the KOMPAS-3D testing process is organized.  We continue the topic.  Today's post is devoted to how regression tests were automated and developed its own program for testing not only the interface, but also other KOMPAS-3D modules. <br><br><img src="https://habrastorage.org/files/8b3/2ae/5c1/8b32ae5c123c4a8ba7a4df7e7c152c90.jpg"><br><br>  Says testing engineer Ekaterina Rodina. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The key element of the KOMPAS-3D v17 version is the new interface.  Its development was carried out in a separate branch, and every two or three days the developments merged into the main branch of the product so that other teams could use them.  But before you give, you need to check. <br><a name="habracut"></a><br>  The interface was changing very actively.  It so happened that because of the innovations, what had been done ‚Äúbroke down‚Äù.  In order not to miss such moments, we did manual regression tests.  Before each discharge into the common branch, in addition to testing the new code, they checked the old one.  Over time, the work of testers turned into an endless groundhog day, as in the eponymous film: each working day began with a manual run of all test cases. <br><br>  The first time the check took only half an hour.  With the accumulation of functionality working with the new interface, the duration of the regression test increased, approached the whole working day, and this was not the limit.  Less time was left for testing new functionality;  programmers stood in line waiting to check their work.  The question arose: ‚ÄúWhat should I do?‚Äù The answer suggested itself: regression testing should be automated! <br><br>  The first task is the selection of a tool.  Do we need to ‚Äúreinvent the wheel‚Äù for this?  Or you can use existing and well-proven automated testing programs? <br><br>  After the research, it became clear that the adaptation of ready-made solutions, writing tests for them and maintaining them in working condition in a constantly changing interface is an impossible task. <br><br>  As a result, it was decided to modify KOMPAS to test itself using its own modules.  With this approach, the main problems that are not allowed to use third-party products for regression testing are solved. <br><br>  1. Does not interfere with the constantly changing environment. <br>  2. Fully simulated user actions in a window with 3D-graphics. <br><br>  The task of creating an automated testing module KOMPAS-3D for our programmers was new and unusual, and therefore interesting.  Inspiration was enough for the entire development period and allowed to bring this complex work to implementation.  The ‚Äútape recorder‚Äù (the resulting module was so named) became the main tool of regression testing v17.  Of course, not everything was smooth, but we managed! <br><br><h2>  <font color="#00B2FF">How we work with ‚Äútape recorder‚Äù</font> </h2><br>  First, manual testing of each element is performed, errors are fixed, their solution is discussed.  Regression testing tests are recorded at the final stage of work, when all errors are corrected and the element is stable. <br><br>  Recording is carried out on the principle of a recorder.  Press the Play button ‚Äî execute the test case script by hand ‚Äî press Stop.  The test case fully describes the user's actions with the element being checked: opening the program, performing the build, closing the program.  Control points are created at certain points in time.  The test file is ready, it is now possible to use it for automated testing. <br><br>  When you run the test, the program repeats the previously recorded actions, the test points compare the results, the test closes. <br><br>  The test script is written in an xml-file with the possibility of manual editing by a tester or a programmer. <br><br>  Software KOMPAS-3D is divided into modules: interface, module of 3D-models, module of drawings.  Respectively divided into modules and autotests. <br><br><h2>  <font color="#00B2FF">Interface</font> </h2><br>  The interface test record is based on binding events to interface logical objects.  There is a button name and there is an event that happens to it.  Interface checkpoint consists of two elements - snapshot and screenshot. <br><br>  A snapshot is a text file in which all data on the state of the system is currently recorded.  In fact, when comparing two control points, the snapshots are compared.  All differences are displayed as errors. <br><br>  Screenshots are used for visualization.  To simplify the visual assessment of the result, a feature has been added: all differences that are identified in the snapshot are highlighted in the screenshot with a purple frame. <br><br><img src="https://habrastorage.org/web/157/a06/5e5/157a065e58574b56b29fc0f863fb8b86.png"><br>  <i>Visualization of differences in snapshots</i> <br><br><h4>  <font color="#00B2FF">What problems had to be solved:</font> </h4><br>  <b>1. Large size snapshots</b> <br><br>  I wanted to have all the information about the state of the system, so the snapshots took up too much space.  100 tests - 28 GB. <br><br>  The first thing that was done to reduce the volume - removed elements that do not affect the appearance.  If the user does not see any elements, then at the moment information about them is not needed, and there is no need to write it in snapshots.  Then the entire interface was divided into components with a choice: whether you want to - write down information about all the elements, or about one or two that you are working with at the moment. <br><br><img src="https://habrastorage.org/web/f45/5b7/b0e/f455b7b0e7944fe582987cf582b802ed.png"><br>  <i>Select items to compare</i> <br><br>  This approach has reduced the space occupied on the hard disk, 50 times.  Now 100 tests occupy 0.5 GB.  The test run time has been reduced three times - from an average of 30 seconds per test to 10 seconds. <br><br>  <b>2. A large number of errors</b> <br><br>  Often after draining the next interface changes as a result of running autotests, a shaft of errors was observed (1000 errors in one test).  For example, the length of the panel has changed and the length of all controls that are located on this panel has changed.  The tester perceives this as one mistake, the program - as a dozen.  Such errors were combined into blocks with the addition of verification between the parent and child elements.  If a child had the same error as the parent, it was excluded from the results, it was thought that this error was already taken into account in the tests. <br><br>  <b>3. Separation of errors from modifications</b> <br><br>  For example, analysts have decided that the button on the left looks ugly and needs to be moved to the right.  As a result, all tests where this button is physically present give an error - the button is in the wrong position.  Separating such a mistake from the real one in the general pool was difficult.  We added the ability to ignore the error pattern. <br><br><img src="https://habrastorage.org/web/474/859/3e9/4748593e9b2249ea9e8cb1b79f815e4f.jpg"><br>  <i>Ignore by pattern</i> <br><br>  We run 100 tests, open one of them, we see that the button was moved, we set the ‚Äúignore error‚Äù checkbox, and in all subsequent tests this error is wiped out and is no longer taken into account. <br><br>  <b>4. Work with test suites</b> <br><br>  For each test a certain number of tags are hung in order to sort them easily. <br><br><img src="https://habrastorage.org/web/0fd/555/033/0fd55503348241cda3ffa2b73cbe7370.jpg"><br>  <i>Use of tags</i> <br><br><h2>  <font color="#00B2FF">Workspace 3D</font> </h2><br>  The test for the workspace is fundamentally different from the interface.  Events are tied to the three-dimensional coordinates (x, y, z) of the model.  We create a bitmap image that is compared with the standard.  To do this, use a third-party program ImageMagick, all differences are highlighted in red. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/R486FYwNV2U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>Test Example</i> <br><br>  Tests for different modules can be recorded both together and separately from each other.  In the test from the video for clarity, an error was specifically laid down: the wrong distance between the wheel and the brake disc was set.  When comparing raster images, we see that the wheels are highlighted in red - they are located incorrectly. <br><br><h4>  <font color="#00B2FF">What difficulties arose here:</font> </h4><br>  <b>1. Scalability</b> <br><br>  On monitors with different resolutions (different scales), a situation arose when the cursor clicked and clicked and suddenly began to miss.  This was due to recalculation to another scale.  The resulting error at some point became critical.  We solved this problem very simply - by compulsory assignment of resolution and scale in all tests.  No matter which monitor you run the test on, the program window will automatically adjust to the size of the desired resolution.  Naturally, this works from a smaller scale to a larger one.  In the opposite direction will not work.  We just agreed on the scale of the monitor writing tests. <br><br>  <b>2. Performance</b> <br><br>  For example, the user performs the action in two seconds, and the program in ten seconds, five times longer.  What are these autotests?  Began to understand and found out.  The cursor coordinates were recorded as follows: the 2D coordinate of the cursor was taken on the monitor, converted through a video card into a 3D coordinate that is in the model, and then an event occurred.  The conversion constantly pulled a redraw on the video card, the model was constantly redrawn.  If you come across a three-dimensional model with a large number of parts lying inside, the redrawing took a long time.  We generally refused to convert and immediately began to write in the three-dimensional coordinates of the model.  Excluded the video card from this chain. <br><br>  <b>3. Implementation of models on different video cards</b> <br><br>  Anyway, on different video cards the bitmap image of the same model will be different.  However, the differences are insignificant, and we decided to assign an error of 1%.  If the model matches up to 1%, then the model is correct.  If more than 1%, then an error has occurred.  Now on different video cards, the models coincide to 0.01. <br><br>  <b>4. Background control</b> <br><br>  The solution to this problem is, but not yet implemented.  Suppose we have a photo of a 3D model, but from this photo you will not find out what is located on the ‚Äúback‚Äù of the model until you turn it back and take a photo.  It is planned to use the refined control system - split the model into segments, vertices, faces, and compare the properties of the specified elements. <br><br><h2>  <font color="#00B2FF">Practical application</font> </h2><br>  In the process of developing KOMPAS-3D v17, automatically regression checks were performed every 2-3 days.  We have more time to test the new functionality, less time was spent on processing tests.  Initially, the recorder was designed to relieve the interface group, but it found application in testing other KOMPAS-3D modules. <br><br>  We are not going to stop there.  The plans include expanding the use of autotests (ideally covering all the functionality of KOMPAS), increasing the test base.  And, of course, the use of "tape recorder" to stabilize subsequent updates and service packs KOMPAS-3D v17. <br><br> <a href=""><img src="https://habrastorage.org/files/de8/87e/0b6/de887e0b6670475289a06db356bf3726.jpg"></a>  Ekaterina Rodina, interface testing engineer. </div><p>Source: <a href="https://habr.com/ru/post/327266/">https://habr.com/ru/post/327266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327256/index.html">How DDos-attacks are ‚Äúordered‚Äù: life story</a></li>
<li><a href="../327258/index.html">Why do we need chat bots, or the story of Bitrix24</a></li>
<li><a href="../327260/index.html">How Google Cloud protects its data centers from cybercriminals and internal errors</a></li>
<li><a href="../327262/index.html">UIKit + Viper or MVC healthy person</a></li>
<li><a href="../327264/index.html">Everything is bad</a></li>
<li><a href="../327270/index.html">Hacksplaining - an online course on web vulnerabilities</a></li>
<li><a href="../327272/index.html">‚ÄúCryptography in blockchains‚Äù: about hash functions, keys and digital signatures</a></li>
<li><a href="../327274/index.html">Development of an accelerated BBC News homepage</a></li>
<li><a href="../327276/index.html">Open access to HighLoad ++ video over the past five years</a></li>
<li><a href="../327280/index.html">Sending voice messages VKontakte using VK API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>