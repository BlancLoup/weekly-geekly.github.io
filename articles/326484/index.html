<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Architecture of modular React + Redux applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most developers start exploring Redux with the Todo List Project . This application has the following structure: 



actions/ todos.js components/ tod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Architecture of modular React + Redux applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b58/8ec/9ac/b588ec9acf7b41b196ba8dc9735eb943.png"><br><br>  Most developers start exploring Redux with the <a href="http://redux.js.org/docs/basics/ExampleTodoList.html">Todo List Project</a> .  This application has the following structure: <br><br><pre><code class="hljs axapta">actions/ todos.js components/ todos/ TodoItem.js ... constants/ actionTypes.js reducers/ todos.js <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js rootReducer.js</code> </pre> <br>  At first glance, such an organization of code seems logical, because it resembles the standard conventions of many backend MVC frameworks: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs">app/ controllers/ models/ views/</code> </pre> <br>  In fact, this is a bad choice for both MVC and React + Redux applications for the following reasons: <br><br><ol><li>  As the application grows, it becomes extremely difficult to monitor the relationship between components, actions and reductors. </li><li>  If you change the action or component, you are likely to make changes to the reducer.  If the number of files is large, scrolling up / down the IDE is not convenient </li><li>  Such a structure connives copy-paste in rediresers. </li></ol><br>  Not surprisingly, many authors ( <a href="https://jaysoo.ca/2016/02/28/organizing-redux-application/">one</a> , <a href="https://medium.com/front-end-hacking/structuring-react-and-redux-applications-255361d24f84">two</a> , <a href="https://medium.com/collaborne-engineering/organizing-redux-projects-7f12483f761a">three</a> ) advise to structure the application by "functionality" ( <i>by feature</i> ). <a name="habracut"></a><br><br>  We came to the same conclusion in backend development quite a long time ago, so we are doing the same in the frontend.  In Russian there is no suitable translation for the word feature as a unit of functionality.  Instead, we use the word "module".  In ES6, the term ‚Äúmodule‚Äù has a different meaning.  In order not to confuse them with each other in case of ambiguity, the phrase ‚Äúapplication module‚Äù can be used.  There were no difficulties in everyday work, besides this, the term ‚Äúmodule‚Äù is well understood and suitable for communication with business users. <br><br><h3>  Modular structure </h3><blockquote>  The module is a functionally complete fragment of the program. <br><br>  Modular programming is the organization of a program as a set of small independent blocks, called modules, whose structure and behavior obey certain rules. <br></blockquote><br>  A modular application in my understanding should meet the following requirements: <br><br><ol><li>  All module code is located in one folder.  To completely remove a module from the program, simply delete the corresponding folder.  Removing a module does not violate the functionality of other modules, but deprives the application of some functionality. </li><li>  Modules are independent of each other.  Modification of any module does not affect the operation of other modules.  The modules are allowed to depend on the ‚Äúcore‚Äù of the system. </li><li>  The system kernel contains a public API that provides I / O modules for the modules and a set of components for creating a UI. </li></ol><br>  We get the following application structure: <br><br><pre> <code class="hljs pgsql">app/ modules/ Module1/ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js Module2/ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js core/ ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js routes.js store.js</code> </pre> <br>  At the entry point we place the <code>AppContainer</code> , necessary for <code>react-hot-reload</code> , with the <code>Root</code> component attached.  <code>Root</code> contains only the <a href="">Provider</a> , providing communication with <code>redux</code> and <code>react-router</code> , which defines the entry point into the application using <code>indexRoute</code> .  The component can be transferred to the npm-package and connected in any application, since  it only initializes the infrastructure and does not contain the logic of the object model. <br><br><h3>  index.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'isomorphic-fetch'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./styles/app.sass'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ReactDOM <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { AppContainer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-hot-loader'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> browserHistory <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./core/history'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Root <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./core/containers/Root'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./routes'</span></span>; ReactDOM.render( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Root</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">store</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{store}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{browserHistory}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">routes</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{routes}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">AppContainer</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, document.getElementById('root'));</span></span></code> </pre><br><h3>  Root.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Provider} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-redux"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {Router} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"react-router"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Root = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">store</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.store}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.history}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">routes</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.routes}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Provider</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">) Root.propTypes = { history: PropTypes.object.isRequired, routes: PropTypes.array.isRequired, store: PropTypes.object.isRequired } export default Root</span></span></code> </pre><br>  So far, everything is quite simple.  It remains for us to connect the modular system to the state (store) and set up routing. <br><br><h3>  defineModule </h3><br>  Let's write a small function: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defineModule = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> title, path, component, reducer = (state = {}</span></span></span><span class="hljs-function">) =&gt;</span></span> state, onEnter = <span class="hljs-literal"><span class="hljs-literal">null</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {title, path, component, reducer, onEnter} }</code> </pre> <br>  Let's create a module in the user's personal account in the <code>modules</code> folder. <br><br><pre> <code class="hljs pgsql">modules/ Profile/ Profile.js <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js</code> </pre> <br><h3>  Profile / Profile.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Profile = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> (<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, {props.name}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>) Profile.propTypes = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: PropTypes.string.isRequired } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> Profile</code> </pre><br><h3>  Profile / index.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SET_NAME = <span class="hljs-string"><span class="hljs-string">'Profile/SetName'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducer (state = {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>}, action) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(action.type){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SET_NAME: {‚Ä¶state, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: action.name} } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> defineModule(<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'/profile, Profile'</span></span>)</code> </pre> <br>  And register the module in the modules / index.js file <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Profile <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Profile'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { Profile }</code> </pre> <br><blockquote>  This step can be avoided, but for clarity, we will leave the manual initialization of the modular structure.  Two lines of import / export is not so difficult to write. </blockquote><br>  I use <code>CamelCase</code> and <code>/</code> for better readability in action titles.  In order to make it easier to collect, you can use this function: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> combineName = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...parts</span></span></span><span class="hljs-function">) =&gt;</span></span> parts .filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x &amp;&amp; toLowerCamelCase(x) != DATA) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> toUpperCamelCase(x)) .reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c,n</span></span></span><span class="hljs-function">) =&gt;</span></span> c ? c + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + n : n) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Module = <span class="hljs-string"><span class="hljs-string">'Profile'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SET_NAME = combineName(Module, <span class="hljs-string"><span class="hljs-string">'SetName'</span></span>)</code> </pre> <br>  It remains to connect the personal account to the router and insert the module into the layout.  Everything is simple with the layout.  We create <code>core/components/App.js</code>  Note that the same array is transferred to the <code>Navigation</code> component as to the router to avoid duplication. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PropTypes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'prop-types'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Navigation <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./Navigation'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{props.title}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Navigation</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">routes</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{props.routes}/</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> {props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">) App.propTypes = { title: PropTypes.string.isRequired, routes: PropTypes.array.isRequired } export default App</span></span></code> </pre> <br><h3>  Router </h3><br>  And with a router it will be a little more difficult.  In general, it should be possible to associate more than one URL with a module.  For example, <code>/profile</code> contains basic <code>/profile</code> information, and <code>/profile/transactions</code> , a list of user transactions.  Suppose We want to always display the user name in your personal account, and below display the component with two tabs: ‚Äúgeneral information‚Äù and ‚Äútransactions‚Äù. <br><br>  Then, the logical structure of the routes will be: <br><br><pre> <code class="javascript hljs"> &lt;Router&gt; &lt;Route path="/profile" component={Profile}&gt; &lt;Route path="/info" component={Info}/&gt; &lt;Route path="/transactions" component={Transaction}/&gt; &lt;/ Route &gt; &lt;/Router&gt;</code> </pre> <br>  The <code>Profile</code> component will display the user name and tabs, and <code>Info</code> and <code>Transactions</code> will display the profile details and the list of transactions, respectively.  But it is also necessary to support the option when the module components do not need an additional grouping module (for example, the order list and the order viewing window are independent pages). <br><br><h3>  We introduce an agreement </h3><br>  From a module, you can export an object as a structure as returned from the <code>defineModule</code> function or an array of such objects.  All components will be added to the list of routes without additional nesting. <br><br>  A module may contain the <code>children</code> key, which contains a structure similar to the <code>modules/index.js</code> .  In this case, one of them should be called <code>Index</code> .  It will be used as an <code>IndexRoute</code> .  Then we get the structure corresponding to the "personal account". <br><br>  We use the <a href="https://fsharpforfunandprofit.com/posts/monoids-without-tears/">monoidal nature of the list</a> and obtain a flat array of modules, taking into account the ability to export an array or object. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> flatModules = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modules</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(modules) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray(modules[x]) ? modules[x] : [modules[x]] res.forEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">y</span></span></span><span class="hljs-function"> =&gt;</span></span> y[MODULE] = x) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res }) .reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c,n</span></span></span><span class="hljs-function">) =&gt;</span></span> c.concat(n))</code> </pre> <br>  In Router, you can transfer not only <code>Route</code> components, but also just an array with ordinary objects, which we will use. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getRoutes = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modules, store, App, Home, title = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span></span><span class="hljs-function">) =&gt;</span></span> [ { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: title, <span class="hljs-attr"><span class="hljs-attr">component</span></span>: App, <span class="hljs-attr"><span class="hljs-attr">indexRoute</span></span>: { <span class="hljs-attr"><span class="hljs-attr">component</span></span>: Home }, <span class="hljs-attr"><span class="hljs-attr">childRoutes</span></span>: flatModules(modules) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!x.component) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Component for module '</span></span> + x + <span class="hljs-string"><span class="hljs-string">' is not defined'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> route = { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: x.path, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: x.title, <span class="hljs-attr"><span class="hljs-attr">component</span></span>: x.component, <span class="hljs-attr"><span class="hljs-attr">onEnter</span></span>: x.onEnter ? <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">routeParams</span></span></span><span class="hljs-function"> =&gt;</span></span> { x.onEnter(routeParams, store.dispatch) } : <span class="hljs-literal"><span class="hljs-literal">null</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x.children){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!x.children.Index || !<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(x.children.Index.component)){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Component for index route of "'</span></span> + x.title + <span class="hljs-string"><span class="hljs-string">'" is not defined'</span></span>) } route.indexRoute = { <span class="hljs-attr"><span class="hljs-attr">component</span></span>: x.children.Index.component } route.childRoutes = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.keys(x.children).map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">y</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cm = x.children[y] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!cm.component) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Component for module '</span></span> + x + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + y + <span class="hljs-string"><span class="hljs-string">' is not defined'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: x.path + cm.path, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: cm.title, <span class="hljs-attr"><span class="hljs-attr">component</span></span>: cm.component, <span class="hljs-attr"><span class="hljs-attr">onEnter</span></span>: cm.onEnter ? <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">routeParams</span></span></span><span class="hljs-function"> =&gt;</span></span> { cm.onEnter(routeParams, store.dispatch) } : <span class="hljs-literal"><span class="hljs-literal">null</span></span> } }) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> route }) } ]</code> </pre><br>  Thus, adding a module to the <code>modules/index.js</code> will automatically initialize new routes.  If the developer forgets to announce the route or gets confused in the agreements, he will see an unambiguous error message in the console. <br><br><h3>  onEnter </h3><br>  Note that the module can also export the onEnter function.  To which, when switching to the corresponding route, the path parameters and the store.dispatch function will be transferred.  This avoids the use of <a href="https://facebook.github.io/react/docs/react-component.html">componentDidMount</a> to initialize components.  Instead, you can throw an event into the store (or Promise, if you, like me, decide to throw <a href="https://github.com/redux-saga/redux-saga">redux-saga</a> and leave <a href="https://github.com/gaearon/redux-thunk">redux-thunk</a> ), process it in the reducer, modify the state, thus causing the component to be redrawn. <br><br>  We connect receivers to the stora <br>  We will need DevTools and thunk.  We declare a small function to initialize the store. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> composeEnhancers = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">window</span></span> === <span class="hljs-string"><span class="hljs-string">'object'</span></span> &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ ? <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({}) : compose; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createAppStore = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">reducer, ...middleware</span></span></span><span class="hljs-function">) =&gt;</span></span> { middleware.push(thunk) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore( reducer, composeEnhancers(applyMiddleware(...middleware))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> createAppStore</code> </pre> <br>  And one more for receiving and arranging all the reducer for all modules: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> combineModuleReducers = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modules</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducers = {} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> flat = flatModules(modules) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; flat.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> red = flat[i].reducer <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(red) !== <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Module '</span></span> + i + <span class="hljs-string"><span class="hljs-string">' does not define reducer!'</span></span>) } reducers[flat[i][MODULE]] = red <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(flat[i].children) === <span class="hljs-string"><span class="hljs-string">'object'</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> flat[i].children){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(flat[i].children[j].reducer) !== <span class="hljs-string"><span class="hljs-string">'function'</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'Module '</span></span> + j + <span class="hljs-string"><span class="hljs-string">' does not define reducer!'</span></span>) } reducers[j] = flat[i].children[j].reducer } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reducers }</code> </pre> <br>  It is possible to make less strictly and simply skip modules that do not contain reducer, and not fall with the exception, but I like a more strict approach.  If the module does not contain any logic at all, it is easier to arrange it simply as a component and add it to the router manually. <br><br><h3>  We combine everything in the file store.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> createAppStore(combineReducers(combineModuleReducers(modules)))</code> </pre> <br><br>  Now each module corresponds to a part of the state, which coincides with the key in the <code>modules/index.js</code> .  For personal account it will be <code>Profile</code> <br>  I have everything about the structure of modular applications.  The organization of the "core" and the provision of public API modules - the topic of a separate article. </div><p>Source: <a href="https://habr.com/ru/post/326484/">https://habr.com/ru/post/326484/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326460/index.html">DroidScript - a simple and functional tool for developing mobile applications for Android</a></li>
<li><a href="../326472/index.html">Component library as a tool to maintain website integrity</a></li>
<li><a href="../326476/index.html">Work from home is one of the main bonuses that programmers require.</a></li>
<li><a href="../326478/index.html">The future of the Russian online travel market</a></li>
<li><a href="../326482/index.html">Do you find the button to go to page 100 unsuccessful?</a></li>
<li><a href="../326486/index.html">Nginx + Lua, flexible load balancing with session saving</a></li>
<li><a href="../326490/index.html">The third service is superfluous: Telegram is also friends with telephony</a></li>
<li><a href="../326494/index.html">7 Major Game Design Changes from the Nintendo 64 Era</a></li>
<li><a href="../326498/index.html">iThink - the first iOS conference from NIX Solutions in Kharkov</a></li>
<li><a href="../326500/index.html">Mission critical communication and what does NFV have to do with it?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>