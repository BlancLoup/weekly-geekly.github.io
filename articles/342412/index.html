<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kubernetes success stories in production. Part 5: Monzo Digital Bank</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The series of Kubernetes success stories continues with the story of the British startup bank Monzo. This young company is classified as ‚Äúchallenger b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kubernetes success stories in production. Part 5: Monzo Digital Bank</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/cg/js/ii/cgjsiijjwodutktupktzcoil1fa.png"><br><br>  The series of Kubernetes success stories continues with the story of the British startup bank Monzo.  This young company is classified as ‚Äúchallenger banks‚Äù <i>(yes, this is already a term from the <a href="https://en.oxforddictionaries.com/definition/challenger_bank">Oxford Dictionary</a> )</i> , i.e.  small banks that challenge the large and long-established financial industry.  This becomes possible thanks to the active and widespread use of modern information technologies in their very basis, i.e.  the rejection of operations in the traditional format in favor of electronic counterparts, allowing for a qualitative reduction in costs <i>(banks with this approach are also called ‚Äúdigital-only‚Äù)</i> .  The example of Monzo, created just 2 years ago, is interesting because it is supported by Kubernetes platform, Go language and other modern Open Source products, which are well known to DevOps engineers and not only, to achieve great goals. <a name="habracut"></a><br><br><h2>  What kind of monzo? </h2><br>  <a href="https://monzo.com/">Monzo</a> , originally known as Mondo, was <a href="https://en.wikipedia.org/wiki/Monzo_(bank)">founded</a> in 2015 by a team from another challenger bank, Starling Bank, created a year earlier, led by entrepreneur Tom Blomfield, who was already successful at that time, 29 years old.  By <a href="https://www.bloomberg.com/news/articles/2015-08-18/mondo-s-ceo-wants-to-build-a-bank-for-people-who-hate-banks">positioning</a> Monzo as a ‚Äúbank for those who hate [traditional] banks,‚Äù the founders were able to quickly find their audience: in early 2016, they <a href="http://uk.businessinsider.com/mondo-crowdfunding-record-crowdcube-2016-3">run the</a> ‚Äúfastest crowdfunding campaign in history,‚Äù collecting 1 million GPB in 96 seconds. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/73/1d/ho/731dho4awgnlvtslexytzodq4c8.png"><br><br>  In August of the same year, Monzo <a href="https://monzo.com/blog/2016/08/11/we-are-now-a-bank/">received</a> his first (limited) license for official activity as a bank, and in April 2017 managed to remove the restrictions, which <a href="https://monzo.com/blog/2017/04/05/banking-licence/">made</a> Monzo a ‚Äúfully authorized bank‚Äù and allowed to offer current accounts to its users.  For her first truly active calendar year (2016), Monzo <a href="https://monzo.com/blog/2017/01/06/year-in-numbers/">activated</a> 83700 cards and increased her staff from 16 people to 71. <br><br>  The company's end-user service is an e-bank, available as a mobile application for iOS and Android, which in real time receives push notifications of all payments made using Monzo bank cards.  It also stores transaction history with an indication of the location where payments were made, and automatic assignment of categories depending on the type of company receiving the money (this data is improved by the users themselves in accordance with the approach of crowd-sourced suggestions).  <i>(A more detailed description of the functionality of the application and the bank is beyond the scope of this material.)</i> <br><br>  In August 2016, analysts from IDC published a <a href="https://d0.awsstatic.com/analyst-reports/EMEA41642116%2520Web.pdf">report</a> in which they expressed confidence that Monzo would be able to "provide all the guarantees offered by any [traditional] bank and effectively compete with large transnational banks in the country." <br><br><h2>  Infrastructure and solutions </h2><br>  The first sufficiently detailed information about the software architecture in Monzo and the infrastructure serving it became known thanks to the report ‚Äú <a href="https://www.youtube.com/watch%3Fv%3DYkOY7DgXKyw">Building a Bank with Kubernetes</a> ‚Äù by Oliver Beattie, who heads the company's engineers <i>(by that time, 10 people <a href="https://news.ycombinator.com/item%3Fid%3D12406567">were working</a> in the backend engineering team)</i> .  This performance took place at Kubernetes London Meetup (October'16), and then at KubeCon 2016 (November'16). <br><br>  Taking extensibility as one of the main factors for the main application of the bank, the company's engineers immediately chose the <b>microservice architecture</b> , explaining that they don‚Äôt want to get one big ‚Äúbloated‚Äù application that cannot be changed ‚Äúnot only now, but after 10, after 20 years ", And this is exactly what happens with legacy banks, as they are called in Monzo: <br><br><blockquote>  ‚ÄúThe IT systems of many large banks are not expanding in the sense that making changes is too expensive for them.  Take, for example, the ability to freeze the card in the application by pressing a button.  A friend from RBS <i>(Royal Bank of Scotland, part of the "Big Four" of UK banks - approx. Transl.)</i> Told me that they had considered this opportunity many times, but it took too much time to figure out which of the 20 IT systems will require changes, and modifications for some of them have been frozen for years.  Ultimately, this idea was discarded as too expensive. ‚Äù <br>  <i>- <a href="https://news.ycombinator.com/item%3Fid%3D12538939">Jonas Huckestein</a> , Co-founder and CTO of Monzo</i> </blockquote><br>  At the time Oliver spoke, the company had about <b>150 microservices in production</b> (Docker was used for containers).  One of the problems they encountered on their way to this was the efficiency of the application.  When there are few microservices, it was enough to duplicate all of them on each machine, but over time (with an increase in the number of microservices), this approach stopped working.  Then, the engineers began to break up microservices into certain groups ( <i>app</i> , <i>core</i> , etc.) for posting to different hosts, but this option did not become effective: it happened that the <i>app</i> did not have enough computing power, and the <i>core</i> machines were idle.  At this stage, Kubernetes <b>came to Monzo engineers</b> , who allowed ‚Äújust to have a common pool of resources‚Äù, where the application is launched and easily scaled as needed.  No less interesting was how this change affected the costs of IT infrastructure: <br><br><img src="https://habrastorage.org/webt/06/br/gq/06brgqaeb-dawa9pgjrpsiu__kg.jpeg"><br><br>  The red on this chart indicates the cost of the former infrastructure, and the white on the managed Kubernetes.  (Monzo uses AWS cloud as the infrastructure iron.) <br><br>  The next problem is the flexibility of a complex system consisting of many interconnected microservices.  At first, it was partially solved by the use of RabbitMQ-based queues, but this approach was not focused on Kubernetes, and the number of requirements made here grew strongly: <br><br><img src="https://habrastorage.org/webt/cc/xd/6k/ccxd6ko_snudc-2bhz6thjivcyu.jpeg"><br><br>  The general essence of these requirements was reduced to the minimum delays in responses to user requests and the maximum success in the chance to give an answer.  To achieve these goals, <b>linkerd</b> was chosen <i>(we wrote about this project and service mesh as a software class in <a href="https://habrahabr.ru/company/flant/blog/327536/">here</a> )</i> and <b>Finagle</b> . <br><br>  On each host where microservices were run, a local linkerd instance was installed, to which local microservices addressed their requests, and he had already contacted the rest of linkerd to decide where to send this request. <br><br><img src="https://habrastorage.org/webt/ml/z7/yv/mlz7yvfrbw_odamgdu0cceeu-dk.png"><br>  <em>Illustration of using linkerd when a GET request is made to a Unicorn HTTP server</em> <br><br>  To ensure the network isolation of various areas of its infrastructure, Monzo took Calico and the network policies of Kubernetes.  For example, the ‚Äúsuper-secure‚Äù zone can be used to store full bank card numbers (it is not required to transmit this information ‚Äúin its pure form‚Äù for most services, so they may be located in other zones). <br><br>  At the next KubeCon conference, already European and held in March 2017, the same Oliver from Monzo again <a href="https://www.youtube.com/watch%3Flist%3DPLj6h78yzYM2PAavlbv0iZkod4IVh_iGqV%26v%3DwBgBwNZo_EE">spoke</a> with a shorter story about the use of Kubernetes in the company's infrastructure, saying that by that time the <b>number of microservices in production had grown to 200</b> .  And almost all of them belonged to the stateless category: only Apache Kafka was mentioned from stateful, with a note that ‚Äúwe began to move there more actively and technologies related to databases‚Äù.  His presentation, entitled ‚ÄúProcessing Real Money at Monzo with Kubernetes and Linkerd,‚Äù was continued by the Buoyant (Oliver Gould) namesake, part of the report which was more focused on getting to know linkerd (instead of any specifics with Monzo). <br><br>  And the latest facts about the Monzo infrastructure were found in the report ‚Äú <a href="https://resources.coreos.com/youtube-coreos-fest-2017/securing-your-infrastructure-with-coreos-oliver-beattie-monzo-bank">Securing your Infrastructure with CoreOS</a> ‚Äù (May 31 at CoreOS Fest 2017): <br><br><ul><li>  the number of microservices in Monzo increased to <b>230</b> ; </li><li>  Apache Cassandra DBMS is used to store all data; </li><li>  Vault is used to store secrets (with the Cassandra backend), but not all of the data has been transferred there; </li><li>  For communication with payment systems <i>(or rather, between AWS and the co-location, which directly communicates with these systems)</i> , a VPN based on <b>WireGuard is used</b> , which is ‚Äúexcellent for container infrastructure‚Äù. </li></ul><br><img src="https://habrastorage.org/webt/cp/sp/cs/cpspcst3jkss_tbwavvtx3xu0v0.png"><br><br><h2>  Major incident October 27 </h2><br>  A spoonful of tar in this success story adds an event that <a href="http://www.theregister.co.uk/2017/10/31/kubernetes_bug_bank_app_monzo/">happened</a> just recently - at the end of last month.  In short, the production of Monzo did not work correctly for about 80 minutes due to a well-known bug in Kubernetes and circumstances. <br><br>  Respect is the fact that on the community forum Monzo, the same Oliver <a href="https://community.monzo.com/t/resolved-current-account-payments-may-fail-major-outage-27-10-2017/26296/95">published a</a> very detailed post-mortem about what happened with explanations, even for those who first heard about Kubernetes.  The essence of the problem that arose was that, 2 weeks before the incident, Monzo engineers made changes to the etcd cluster, increasing the number of nodes from 3 to 9 and updating the etcd version at the same time, and checked its performance ... However, one fine day the next rollout of the updated service caused strange problems in the system that did not decide to roll back to the working version. <br><br>  In addition to a certain sequence of events in the work with the infrastructure, <a href="https://github.com/kubernetes/kubernetes/issues/47131">bug #</a> 47131 in Kubernetes played a role in this incident, manifesting itself on certain versions of etcd (still not closed), and <a href="https://github.com/linkerd/linkerd/issues/1219">bug # 1219</a> in linkerd (closed in April with the release of linkerd 1.0) .  The operational work of the company's engineers and the existing processes / mechanisms in case of accidents kept the problem to a minimum, but full of a simple banking platform for 20 minutes (and significant problems for more than an hour) is, of course, an unacceptable mistake even for such a ‚Äúyouth‚Äù startup.  However, the community‚Äôs reaction to this engineering post was pleasantly surprised by the positive attitude of the Monzo audience, which welcomed the openness and honesty of the company after what happened. <br><br><h2>  Their designs </h2><br>  In Monzo's <a href="https://github.com/monzo">GitHub</a> account, you can find dozens of repositories, some of which are Go's own developments.  In particular: <br><br><ul><li>  <a href="https://github.com/monzo/typhon">typhon</a> - RPC-framework for interaction between microservices; </li><li>  <a href="https://github.com/monzo/slog">slog</a> - a library for receiving logs in a structured form (taking into account the context and arbitrary key-value pairs for each event) and sending them to the seelog; </li><li>  <a href="https://github.com/monzo/phosphor">phosphor</a> - distributed tracing system, similar to Google's Dapper and Twitter's Zipkin; </li><li>  <a href="https://github.com/monzo/terrors">terrors</a> - the Golang error wrap package with additional information. </li></ul><br>  You can find out more about how Monzo develops Go in the report ‚Äú <a href="https://community.monzo.com/t/building-a-bank-with-go-presentation-tv/8216">Building a Bank with Go</a> ‚Äù, voiced by the Monzo engineer for distributed systems (Matt Heath) in March of this year. <br><br><h2>  Summarizing </h2><br>  As of October 30, the number of Monzo users <a href="https://twitter.com/monzo/status/925080178451189760">was</a> 469 thousand, and the last round of investments, which ended in November, <a href="https://techcrunch.com/2017/11/06/monzo-moolah/">brought the</a> company 71 million GBP, and all this indicates the great prospects of the project. <br><br>  In general, Monzo and Kubernetes are united not only by a similar age, but also by the value they bring to the world, making available today what many have dreamed of and what is the logical development of their industry.  The October incident, of course, does not paint the reputation of any bank, but from the reaction that followed it, we can conclude that in this case it will bring more useful new experience to a very talented engineering team rather than lead to a collapse of trust. <br><br><h2>  Other articles from the cycle </h2><br><ul><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/334140/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/334140/">Part 1: <b>4,200 pods and TessMaster on eBay</b></a> . ‚Äù </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/334770/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/334770/">Part 2: <b>Concur and SAP</b></a> . ‚Äù </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/335814/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/335814/">Part 3: <b>GitHub</b></a> . </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/339724/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/339724/">Part 4: <b>SoundCloud (by Prometheus)</b></a> . ‚Äù </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/345780/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/345780/">Part 6: <b>BlaBlaCar</b></a> . </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/347098/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/347098/">Part 7: <b>BlackRock</b></a> . </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/349940/">Kubernetes success stories in production.</a>  <a href="https://habrahabr.ru/company/flant/blog/349940/">Part 8: <b>Huawei</b></a> . </li><li>  ‚Äú <a href="https://habr.com/company/flant/blog/349940/">Kubernetes success stories in production.</a>  <a href="https://habr.com/company/flant/blog/349940/">Part 9: <b>CERN and 210 K8s clusters.</b></a> ‚Äù </li><li>  ‚Äú <a href="https://habr.com/ru/company/flant/blog/441754/">Kubernetes success stories in production.</a>  <a href="https://habr.com/ru/company/flant/blog/441754/">Part 10: <b>Reddit</b></a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/342412/">https://habr.com/ru/post/342412/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342402/index.html">Web application on Node and Vue, part 4: code reuse</a></li>
<li><a href="../342404/index.html">Javascript: the path to code clarity</a></li>
<li><a href="../342406/index.html">Kali Linux: packages modification, kernel build, and ISO image creation exercises</a></li>
<li><a href="../342408/index.html">Russian AI Cup 2017 - beta test report, start of the championship. StarCraft wanted, got weird Total War</a></li>
<li><a href="../342410/index.html">Writing x86-64 JIT compiler from scratch in stock Python</a></li>
<li><a href="../342420/index.html">A new Alina has been detected - a malware for POS terminals.</a></li>
<li><a href="../342424/index.html">Atmega328p + ENC28J60 = Bridge between UART and Ethernet</a></li>
<li><a href="../342426/index.html">How to create graphics for VR - Google recommendations</a></li>
<li><a href="../342428/index.html">1000 ++ way to run commands on a remote computer</a></li>
<li><a href="../342430/index.html">Interns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>