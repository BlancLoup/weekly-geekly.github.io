<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing the synthesizability of the beautiful features of SystemVerilog in practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the design situation, our team had to study the possibilities of the SystemVerilog language, after which no-no, but there are heated debates ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing the synthesizability of the beautiful features of SystemVerilog in practice</h1><div class="post__text post__text-html js-mediator-article">  Due to the design situation, our team had to study the possibilities of the SystemVerilog language, after which no-no, but there are heated debates about which part of it is synthesized and which part is not.  To put an end to speculation, I spent a little testing in practice.  During the development of the test project, a number of questions were removed by delving into the literature, but one interesting point surfaced, an explicit description of which was not found.  To remedy the situation, I decided to document it. <br><br>  So.  We have a project, the most stuffed with all sorts of SytemVerilog-ovsky things.  Even if it seems that the use of this or that thing does not give much benefit - this is an erroneous impression, because the main task of the ‚Äúproject‚Äù is to study the possibilities of SystemVerilog.  And so, we have a set of several modules (specifically, I have UART receivers), the data from which should be ‚Äúmerged‚Äù into a single bus, sorting them out using the RoundRobin algorithm (specifically in the case of UART, we merge the accumulated data into a single queue which on the other hand will go to the USB bus). <br><img src="https://habrastorage.org/webt/ux/8e/4r/ux8e4ro-et7moza6_rcgcmlrxuy.png" width="80%"><br><a name="habracut"></a><br>  Here is the declaration of the UART module: <br><br><pre><code class="hljs pgsql">module UARTreceiver( RxBus.Slave Bus, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> logic [<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] divider, <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> logic RxD );</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is what its interface looks like, with which I plan to work using the RoundRobin algorithm: <br><br><pre> <code class="hljs lua">//   FIFO      interface RxFifoBus #(parameter width=<span class="hljs-number"><span class="hljs-number">8</span></span>)(<span class="hljs-built_in"><span class="hljs-built_in">input</span></span> clk); logic [width<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] data; logic rdReq; logic empty; modport slave (<span class="hljs-built_in"><span class="hljs-built_in">input</span></span> clk, rdReq, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> data,empty); modport master (<span class="hljs-built_in"><span class="hljs-built_in">input</span></span> clk, data, empty, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> rdReq); endinterface</code> </pre><br><br>  In the merging module, the interfaces are described as an array, so that they can be indexed: <br><br><pre> <code class="hljs markdown">RxBus rcvBuses [<span class="hljs-string"><span class="hljs-string">0:UARTS</span></span>](<span class="hljs-link"><span class="hljs-link">.clk (Bus.clk</span></span>),.reset_n);</code> </pre> <br><br>  With the modules themselves, they are connected via Generate: <br><br><pre> <code class="hljs matlab">genvar <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; generate <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;UARTS;<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) begin : RxGen UARTreceiver rec ( .Bus(rcvBuses[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]), .divider (<span class="hljs-number"><span class="hljs-number">16</span></span>'d3125), .RxD (RxDs[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endgenerate</code> </pre> <br><br>  It would seem - beauty!  Know yourself to be engaged in switching, like this (I will give an example only for the data line): <br><br><img src="https://habrastorage.org/webt/en/e3/zv/ene3zvfpcoghmoho_csguo4_zds.png">  , <br><div class="spoiler">  <b class="spoiler_title">Text</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">logic [$clog2(UARTS)-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] cnt; always @ (posedge <span class="hljs-keyword"><span class="hljs-keyword">Bus</span></span>.clk, negedge reset_n) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!reset_n) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> cnt &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> cnt &lt;= cnt + <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h1</span></span>; dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;= rcvBuses[cnt].data; dataToFifo [<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">8</span></span>] &lt;= cnt; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></div></div><br><br>  But that is waiting.  But in reality, we get an error about the impossibility of accessing the rcvBuses object.  If the index is a constant or a genvar-variable (actually, also the equivalent of a constant) - no problem, index as much as you want.  For example, no one forbids doing "head on": <br><br><pre> <code class="hljs vhdl">always_comb <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> (cnt) <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h0</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">0</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h1</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">1</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h2</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">2</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h3</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">3</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h4</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">4</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h5</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">5</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h6</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">6</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h7</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">7</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h8</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">8</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h9</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">9</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'ha</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">10</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'hb</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">11</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'hc</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">12</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'hd</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">13</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'he</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">14</span></span>].data; <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'hf</span></span>: dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">15</span></span>].data; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>:dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] = rcvBuses[<span class="hljs-number"><span class="hljs-number">0</span></span>].data; endcase <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br><br>  It will work this way, but the opportunity to change the number of receivers processed through parameterization of the module is lost.  And now we are precisely checking how beautiful the solutions in the studied language can be. <br><br>  Buried in the literature, I made it clear for myself that the interface is unpacked.  And, unlike the structure, it cannot be declared as a wrapped entity.  In the famous book SystemVerilog for Design 2nd Edition in one of the examples the solution is mentioned (but not described in detail) in passing.  You need to get out of the beautiful object-oriented world into the cruel ordinary world, for which you add an array of chains: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">logic</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[7:0]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dataBuses</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[0:UARTS-1]</span></span>;</code> </pre> <br><br>  To connect the two worlds (object and old) we add the following line: <br><br><img src="https://habrastorage.org/webt/wm/ev/vy/wmevvy-dttk_yohdf96qcusxp5a.png"><br><div class="spoiler">  <b class="spoiler_title">Text</b> <div class="spoiler_text"><pre> <code class="hljs matlab">genvar <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; generate <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>;<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>&lt;UARTS;<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) begin : RxGen assign dataBuses [<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = rcvBuses[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>].data; UARTreceiver rec ( .Bus(rcvBuses[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]), .divider (<span class="hljs-number"><span class="hljs-number">16</span></span>'d3125), .RxD (RxDs[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]) ); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endgenerate</code> </pre><br></div></div><br><br>  And in the loop we do this: <br><br><img src="https://habrastorage.org/webt/hc/fi/iy/hcfiiyxawqnptbt1l2lovkwttgy.png"><br><div class="spoiler">  <b class="spoiler_title">Text</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">logic [$clog2(UARTS)-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] cnt; always @ (posedge <span class="hljs-keyword"><span class="hljs-keyword">Bus</span></span>.clk, negedge reset_n) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!reset_n) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> cnt &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> cnt &lt;= cnt + <span class="hljs-number"><span class="hljs-number">4</span></span><span class="hljs-symbol"><span class="hljs-symbol">'h1</span></span>; dataToFifo [<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;= dataBuses[cnt]; dataToFifo [<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">8</span></span>] &lt;= cnt; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></div></div><br><br>  The new array is packaged, so the system stops swearing at us, although, in fact, after optimization, it will be just two aliases of the same entity. <br><br>  Good.  What is possible, and what is not - clarified.  Now it would be good to make sure with simple examples that all this disgrace will be synthesized correctly.  It so happened that I now have at hand only a breadboard with a pair of buttons and a dual-channel oscilloscope.  Not a lot, but that is.  Let's try to come up with a task that beautifully proves the performance (or inoperability) of the indexing described above in such Spartan conditions. <br><br>  There are only two buttons.  That is, many sources do not imitate.  But no one bothers to check everything on the reverse system.  Not a lot of tires in one, and one in a lot!  Two buttons - two-bit bus.  We will distribute it on the FPGA legs: <br><img src="https://habrastorage.org/webt/o4/pp/d_/o4ppd_yhha-43dujjn8_mlceo64.png" width="80%"><br>  One button will affect one group of legs and not affect another.  When you change the state of the button, the signal will spread along the legs with a delay.  The delay will be one measure between each pair.  Thus, it will be possible to monitor all things of interest - both the indexing of the elements of the array and the fact that the buses switch correctly. <br><br>  We make such a project: <br><br><pre> <code class="hljs markdown">module ObjTest1 #(parameter cnt=4) ( input logic clk50, input logic [<span class="hljs-string"><span class="hljs-string">1:0</span></span>] button, output logic [<span class="hljs-string"><span class="hljs-string">cnt-1:0</span></span>] group1, output logic [<span class="hljs-string"><span class="hljs-string">cnt-1:0</span></span>] group2 ); //     , //     1  . logic clk; MainPll pll ( .inclk0 (clk50), .c0 (clk) ); //   ,     //     ( ) logic [<span class="hljs-string"><span class="hljs-string">1:0</span></span>] wires [<span class="hljs-string"><span class="hljs-string">0:cnt-1</span></span>]; //        //   ,       //  genvar i; generate for (i=0;i<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">cnt;i++)</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">begin</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">generilka</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">assign</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">group1</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">] = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">wires</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">assign</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">group2</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">] = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">wires</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">]; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">endgenerate</span></span></span></span><span class="xml"><span class="hljs-tag"> //      </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">logic</span></span></span></span><span class="xml"><span class="hljs-tag"> [$</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">clog2</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">cnt</span></span></span></span><span class="xml"><span class="hljs-tag">)</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-1:0</span></span></span></span><span class="xml"><span class="hljs-tag">] </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">iter</span></span></span></span><span class="xml"><span class="hljs-tag">; //      //      </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">always_ff</span></span></span></span><span class="xml"><span class="hljs-tag"> @(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">posedge</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">clk</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">begin</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">iter</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">iter</span></span></span></span><span class="xml"><span class="hljs-tag"> + </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">'</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">wires</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">iter</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">] &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">button[0];</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">wires</span></span></span></span><span class="xml"><span class="hljs-tag"> [</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">iter</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">] &lt;= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">button[1];</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">end</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">endmodule</span></span></span></span></span></span></code> </pre><br><br>  From what I have not yet described - PLL.  In <a href="https://habrahabr.ru/post/337974/">one of the past articles,</a> I came to the wrong conclusions, working on the high limits of the oscilloscope.  To eliminate this, PLL reduces the frequency to one megahertz.  The rest is already described.  Therefore, let's go over the top of the rack: <br><br>  The actual legs of the microcircuit are described as two vectors.  Not very nice, but then decorate: <br><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">output</span></span> logic [cnt<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] group1, <span class="hljs-built_in"><span class="hljs-built_in">output</span></span> logic [cnt<span class="hljs-number"><span class="hljs-number">-1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] group2</code> </pre><br><br>  For now, we associate them with the array under study: <br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//   ,     //     ( ) logic [1:0] wires [0:cnt-1];</span></span></code> </pre><br><br>  like this: <br><br><pre> <code class="hljs vhdl">//        //   ,       //  genvar i; <span class="hljs-keyword"><span class="hljs-keyword">generate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;cnt;i++) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> : generilka assign group1 [i] = wires [i][<span class="hljs-number"><span class="hljs-number">0</span></span>]; assign group2 [i] = wires [i][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endgenerate</code> </pre><br><br>  Buttons - described as a bus: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">input</span></span> logic [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] button,</code> </pre> <br><br>  And we implement the Round Robin algorithm as follows: <br><br><pre> <code class="hljs vhdl">//      logic [$clog2(cnt)-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] iter; //      //      always_ff @(posedge clk) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> iter &lt;= iter + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>; wires [iter] &lt;= button; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  We compile, enjoy how many resources it took (we have 8 legs snapped on, plus 2 bits on the counter - totally less than ten triggers could not physically turn out) <br><br><img src="https://habrastorage.org/webt/cd/7s/ai/cd7saia2vg2ulced_dltilvvk1i.png"><br><br>  RTL Viewer also does not show anything extra.  There is a PLL, there is a counter, there is a decoder, there are triggers combined into two-bit buses.  Everything, as we asked: <br><br><img src="https://habrastorage.org/webt/z5/u0/h4/z5u0h4g7by4zuhprmi1crtd8fwm.png"><br><br>  Fill in the crystal, connect to the two adjacent legs, start playing the button.  We get a delay of 1 microsecond, which corresponds to a frequency of 1 MHz. <br><br><img src="https://habrastorage.org/webt/oz/be/vj/ozbevjvyn4m6d6jjo9zuzhjb0sc.png"><br><br>  We transfer the second probe to the next leg: <br><br><img src="https://habrastorage.org/webt/fw/t7/w6/fwt7w64ajtfavjtmrkfmxzjkesy.png"><br><br>  And the following: <br><br><img src="https://habrastorage.org/webt/ao/ma/27/aoma27rtu1btndrokbohm-lp4na.png"><br><br>  Everything corresponds to the theory.  This half does not respond to the other button. <br><br>  And finally, we will check what the development environment will tell us if we describe the legs not as two groups of contacts, but as a single array, which will allow us to avoid the boring generate block that connects the array with groups.  Such code contains absolutely nothing superfluous, only the essence of the research (well, the PLL, transferring the results to a region that is clearly visible on the oscilloscope) <br><br><pre> <code class="hljs vhdl">module ObjTest2 #(<span class="hljs-keyword"><span class="hljs-keyword">parameter</span></span> cnt=<span class="hljs-number"><span class="hljs-number">4</span></span>) ( input logic clk50, input logic [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] button, output logic [<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> [<span class="hljs-number"><span class="hljs-number">0</span></span>:cnt-<span class="hljs-number"><span class="hljs-number">1</span></span>] ); //     , //     <span class="hljs-number"><span class="hljs-number">1</span></span>  . logic clk; MainPll pll ( .inclk0 (clk50), .c0 (clk) ); //      logic [$clog2(cnt)-<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>] iter; //      //      always_ff @(posedge clk) <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> iter &lt;= iter + <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> [iter] &lt;= button; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> endmodule</code> </pre><br><br>  Go to Pin Planner and remember the joke about a mixed feeling: <br><br><img src="https://habrastorage.org/webt/is/pu/6f/ispu6fwj0j00t4dbcxw2sbfv72w.png"><br><br>  On the one hand, there is some strange group (I circled it in red), which is neither to the village nor to the city.  But on the other hand, nothing is assigned to it.  And our multidimensional group is also available.  And it can assign legs.  And the oscilloscope shows that everything is working correctly. <br>  By the way, the picture RTL View has become just beautiful!  Though in the textbook on circuitry insert! <br><br><img src="https://habrastorage.org/webt/ux/tb/oo/uxtbooniwn5asaj1sx2pbn6_2cs.png"><br><br>  <b>Conclusion</b> <br><br>  The wonderful features provided by SystemVerilog are perfectly synthesized in the Quartus II development environment (I specifically downloaded the most recent version, since the language is young, and in older versions of Quartus everything may not be so rosy).  Unfortunately, the language has some inconveniences due to which programming exclusively in the object-oriented world is impossible.  But these are features of the language.  They are solved by creating ordinary entities, which add clutter to the text, but do not affect the complexity of the resulting code, since they are just pseudonyms of object entities. <br><br>  The questions about which we argued on this topic in our company are closed.  Perhaps something of the above will be interesting and the rest. </div><p>Source: <a href="https://habr.com/ru/post/345638/">https://habr.com/ru/post/345638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345628/index.html">What ITOM can do and why it is needed</a></li>
<li><a href="../345630/index.html">Volumetric atmospheric light scattering</a></li>
<li><a href="../345632/index.html">Dell EMC Technologies for Data Protection</a></li>
<li><a href="../345634/index.html">Developing mobile games - the thorny path of the Padawan</a></li>
<li><a href="../345636/index.html">How people's habit of posting photos from concerts has changed the life of mobile operators</a></li>
<li><a href="../345640/index.html">Christmas magic and gifts (version 2018)</a></li>
<li><a href="../345642/index.html">Fukubukuro in LANIT office: sharing a bag of happiness</a></li>
<li><a href="../345644/index.html">‚ÄúRussian cloud‚Äù: what domestic startups use virtual infrastructure</a></li>
<li><a href="../345646/index.html">"Hack us to be beautiful"</a></li>
<li><a href="../345648/index.html">SOC for beginners. 3 myths about automation and artificial intelligence in the Security Operations Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>