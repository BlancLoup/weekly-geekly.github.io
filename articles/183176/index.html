<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>IPv6 practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Summary: 


- Selectel Cloud News: 1. IPv6 in all templates is enabled by default. All new machines are installed with IPv6 settings and immediately a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>IPv6 practice</h1><div class="post__text post__text-html js-mediator-article">  Summary: <br><ul><li>  Selectel Cloud News: <br><ol><li>  IPv6 in all templates is enabled by default.  All new machines are installed with IPv6 settings and immediately after installation are available at their IPv6 address. </li><li>  OpenSUSE 12.3 with Linux 3.7-xen kernel is available in the list of templates. </li></ol></li><li>  <b>The story about the practical problems that we encountered in the operation of IPv6.</b> </li></ul><br><br>  With openSUSE, everything is clear, so let's discuss the implications of IPv6. <br><br> <a href="http://blog.selectel.ru/ipv6-adresa-v-oblake-selektel/"><img src="https://habrastorage.org/getpro/habr/post_images/468/f95/838/468f9583891ffc549d6a6758c2e63e8c.jpg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Original article in the <a href="http://blog.selectel.ru/ipv6-adresa-v-oblake-selektel/">selecttek corporate blog</a> . <br><br><h1>  IPv6 for cloud servers </h1><br>  For all virtual machines in the pools of St. Petersburg (1) and St. Petersburg (2), when installing new virtual machines and reinstalling existing ones, support for IPv6 is enabled by default (and is the preferred protocol for outgoing connections).  IPv4, of course, remains and works.  Previously, we issued IPv6, but did not include it by default. <br><br>  Why do you need it?  Honestly, now the lion's share of the Internet works on ipv4.  Some islands of live IPv6 are in Asia, plus several major sites (such as google.com, vk.com, facebook.com) are answered by IPv6.  Home users in Russia almost all work only on IPv4. <br>  Here is more or less relevant information about which of the Russian providers have IPv6: <a href="http://version6.ru/isp">version6.ru/isp</a> <br><br>  However, the transition to IPv6 should occur - and the more sites will be ready to work with IPv6, the easier and calmer the transition will occur, so this is an investment in the future. <br><br>  What does the appearance of IPv6 mean from a practical point of view for a particular cloud server? <br><a name="habracut"></a><br><ul><li>  Site users who have IPv4 as went to IPv4 addresses, so go and will </li><li>  Users who have an IPv6 will be able to access the IPv6 server address only if this address is registered in the DNS (AAAA record) </li><li>  Outgoing connections from the server to IPv4-only nodes will go using IPv4 </li><li>  Outgoing connections from the server to the nodes with IPv6 and IPv4 addresses will go using IPv6 addresses </li></ul><br><br>  The cloud server service has an informal competition with the cloud storage service: who will have more IPv6 traffic.  Until today, cloud storage has won - but there is hope of dragging the flag to one‚Äôs side. <br><br>  Basically, where will IPv6 traffic go: <br><ul><li>  Google services </li><li>  mirror.selectel.ru and mirror.yandex.ru (Yandex turned on IPv6 for mirror, but did not turn it on for search, alas), and on the rest of the mirrors of distributions, which mostly support IPv6 </li><li>  If you configure AAAA record for a domain, then a google robot will come to you via IPv6.  If you have a web crawler or fetch on other sites, it will also prefer IPv6. </li></ul><br><br><h1>  IPv6 in real life </h1><br>  There is a widespread change that all modern OS support IPv6 out of the box, everything works there and everything is simple and easy.  There is a reverse opinion, they say, everything will be buggy and beeping.  As practice shows, it works out of the box and beeps.  Or, on the contrary, it is buggy and everything is easy and simple.  In other words, it works, but a rake brings with it a fair amount, but you can live. <br><br>  Below is a story about some of them. <br><br>  The presence of dual stack means that in every place where we have, explicitly or implicitly (for example, outgoing connections) appear IPv6 we need <em>to think</em> .  There are many such places - as soon as you have a dual stack, you immediately have all the utilities (starting with wget and ending with ssh) starting to walk on IPv6 over ipv4.  Sometimes silently, sometimes silently falling off.  Some well-respected companies prescribe AAAA for the domain, but they forget to set up a web server.  It turns out an incident. <br><br><h2>  Postgresql and IPv6 </h2><br>  PostgreSQL has always been known for an excellent set of data types.  Starting from geometric objects and ending with money.  IP addresses are also included.  There are two types: inet and cidr.  Both store in a special way ip-address and mask.  The difference is that inet stores the node address (that is, nonzero bits are allowed in the zero zone under the mask), and cidr stores networks (that is, host addresses in the zero zone are not valid).  In essence, this is the same thing, but if you try to write the host address in cidr, you will get an error because the conditions are not met. <br><br>  Type one for IPv4 and IPv6.  Dimension is determined automatically. <br><br>  Valid operations: addition with a scalar, subtraction of a scalar, any kind of comparison in, not in, overlapping ranges, equality, etc.  In the case of ipv4, this allowed to implement everything you want.  For example, if we do an ipv4 distribution, then we simply take max_ipv4 and say +1, and then check if it falls within the range allowed for selection. <br><br>  With IPv6, the situation is different.  Addresses are allocated / 64, and in case of allocation of routed networks - / 48.  In order to get the next one / 48 you need to take the last selected one and make max_ipv6 + 1208925819614629174706176 (2 <sup>128-48</sup> = 2 <sup>80</sup> ).  Everything is good, but bigint in postgres is just a 64-bit number, which even 2 <sup>64</sup> cannot store, not to mention 2 <sup>80</sup> .  In other words, the attempt of such a ‚Äúplus‚Äù causes an error due to the added size of the scalar being added.  Total - in postgres the control mechanism of IPv6 networks is completely broken.  Our temporary solution is the implementation of inet / cidr in persist (haskell library for working with the DBMS) and the implementation of independent mathematics.  Upstream problem is fixated, there is no solution (as of 9.2). <br><br><h2>  Multiple IPv6 on interface, DAD and nginx </h2><br>  The only way to write multiple IPv6 addresses on the interface is to use the post and pre sections using ifconfig.  The address on the interface appears, but not immediately, since DAD starts to work - Duplicate address detection.  In its simplest form, the computer asks ‚Äúwho has my address?‚Äù And is waiting for an answer.  This protocol avoids the occurrence of duplicate addresses, however, ifconfig finishes its work on configuring the interface before the wait is completed in the DAD. <br><br>  As a result, if nginx (or any other server) has a setting for the corresponding address, and not for an asterisk, then when you try to listen, the server receives an error.  And does not listen.  This is a pure race of conditions that can be noticed only during the server loading process (since in other cases DAD will have time to work before starting / restarting the server).  Debugging this problem was very, very unpleasant. <br><br><h2>  Points in an IPv6 Address </h2><br>  Do not believe?  Think colon only? <br>  :: 192.168.1.1 - a valid IPv6 address, although not used on the Internet. <br><br>  So to say, congratulations to all who hoped that regexps for IPv6 addresses in interfaces will be simple ... <br><br><h2>  routing advertisement &amp;&amp; forwarding </h2><br>  Linux, if it is told that it is a router, stops trusting routing advertisement.  In particular, if a node receives routes only from RA, then after switching on routing, it stops trusting RAs (that is, the ipv6 network stops working).  If you want to have both RA and forvarding, then the RA value should be set to 2 (net.ipv6.conf.eth0.accept_ra = 2).  If the service of announcements (radvd) is started, then one should carefully distinguish whose advertisements we trust and whose ones we do not.  Trusting your own announcements is ridiculous and does not work. </div><p>Source: <a href="https://habr.com/ru/post/183176/">https://habr.com/ru/post/183176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183164/index.html">My job is to wait for IT disasters</a></li>
<li><a href="../183166/index.html">Acoustic Surveillance Systems</a></li>
<li><a href="../183168/index.html">Cloud computing threats and methods to protect them</a></li>
<li><a href="../183170/index.html">Pure-FTPD with user storage in the MYSQL database</a></li>
<li><a href="../183172/index.html">Download Youtube playlist in mp3 format with one bash-script</a></li>
<li><a href="../183182/index.html">Yandex on the draft law on arbitrary blocking of sites: continued</a></li>
<li><a href="../183184/index.html">USB support in KolibriOS: what's inside? Part 2: Basics of working with host controllers</a></li>
<li><a href="../183186/index.html">Free course of 11 lectures on marketing, sales and customer service in a web-studio / agency</a></li>
<li><a href="../183188/index.html">Patterns of JavaScript modules in Impress for node.js and browsers</a></li>
<li><a href="../183190/index.html">ICQ, new features - new holes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>