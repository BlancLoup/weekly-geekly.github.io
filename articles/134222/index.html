<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Training course. Loading data from the Entity Framework in an ASP.NET MVC application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is an extension of a series of articles devoted to developing with the Entity Framework and ASP.NET MVC 3. You can find the first chapters at the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Training course. Loading data from the Entity Framework in an ASP.NET MVC application</h1><div class="post__text post__text-html js-mediator-article">  This is an extension of a series of articles devoted to developing with the Entity Framework and ASP.NET MVC 3. You can find the first chapters at the following links: <br><ul><li>  <a title="Creating the Entity Framework data model for an ASP.NET MVC application" href="http://msdn.microsoft.com/ru-ru/hh559531">Creating the Entity Framework data model for an ASP.NET MVC application</a> </li><li>  <a title="Implementing Basic CRUD Functionality with the Entity Framework in an ASP.NET MVC Application" href="http://msdn.microsoft.com/ru-ru/hh559490">Implementing Basic CRUD Functionality with the Entity Framework in an ASP.NET MVC Application</a> </li><li>  <a title="Sorting, filtering and paging with the Entity Framework in an ASP.NET MVC application" href="http://msdn.microsoft.com/ru-ru/hh547468">Sorting, filtering and paging with the Entity Framework in an ASP.NET MVC application</a> </li><li>  <a title="Creating a complex data model for an ASP.NET MVC application" href="http://msdn.microsoft.com/ru-ru/hh546908">Creating a complex data model for an ASP.NET MVC application</a> </li><li>  <a title="Creating a complex data model for an ASP.NET MVC application, part 2" href="http://msdn.microsoft.com/ru-ru/hh546951">Creating a complex data model for an ASP.NET MVC application, part 2</a> </li></ul>  In the last lesson, we completed the School data model.  In this tutorial we will load and display the necessary data loaded by the Entity Framework in the navigation properties. <br><br>  The illustration shows the results of our work. <br><br><img title="clip_image001" alt="clip_image001" src="https://habrastorage.org/getpro/habr/post_images/e68/a0c/2a0/e68a0c2a0dddfe6d27bfd3fe9ada6ca8.png" width="430" height="455"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img title="clip_image002" alt="clip_image002" src="https://habrastorage.org/getpro/habr/post_images/135/774/dff/135774dff7adde1c98bba97690870fd3.png" width="351" height="455"><br><br><h4>  Lazy, Eager, and Explicit download necessary data </h4><br>  There are several methods that EF uses to load the necessary data into the navigation properties of an entity: <br><ul><li>  <i>Lazy</i> <i>loading</i> .  When the entity is first accessed, the corresponding associated data is not loaded.  However, when you first access the navigation property, the associated data is loaded automatically.  In this case, a set of queries is made to the database: one for the entity and one for each time the data is loaded. </li></ul><img title="clip_image003" alt="clip_image003" src="https://habrastorage.org/getpro/habr/post_images/1ab/49a/6bc/1ab49a6bc2ff3129fde64414d6f9d9e8.png" width="550" height="131"><br><ul><li>  <i>Eager</i> <i>loading</i> .  Data is loaded when the entity is accessed.  This is usually followed by a single join request, which returns all data.  You can specify the use of eager loading using the Include method. </li></ul><img title="clip_image004" alt="clip_image004" src="https://habrastorage.org/getpro/habr/post_images/fc7/73d/555/fc773d5557a83d8e938ac21e20cf3526.png" width="539" height="130"><br><ul><li>  <i>Explicit</i> <i>loading</i> .  This method is similar to lazy loading except for the fact that you yourself indicate data loading - this does not happen automatically when you access the navigation property.  Data is loaded manually using an entity object manager and calling the Collection.Load method for collections and the Reference.Load method for properties with a single value.  (In the example, if you want to load the Administrator navigation property, replace the Collection (x =&gt; x.Courses) with the Reference (x =&gt; x.Administrator).) </li></ul><img title="clip_image005" alt="clip_image005" src="https://habrastorage.org/getpro/habr/post_images/91e/167/851/91e167851b2b6d8663e1e1ea69fbba93.png" width="550" height="138"><br><br>  Due to the fact that the data is not immediately loaded, lazy loading and explicit loading have the common name <i>deferred</i> <i>loading</i> . <br><br>  In general, if you have a need for data for each entity, the eager loading method offers the best performance because a single query is usually more efficient than a multitude of queries for each entity.  For example, imagine that there are ten courses at each department.  The example for eager loading will be accompanied by one join request.  Examples for lazy loading and explicit loading will be followed by eleven. <br><br>  On the other hand, if the access to the navigation properties of entities is rarely performed or a small number of entities is used, lazy loading can be more efficient - eager loading will load more data than necessary.  Usually explicit loading is used only when lazy loading is disabled.  Suppose there is a situation where lazy loading can be turned off during the serialization process, when you are sure that you do not need all the navigation properties.  If lazy loading is enabled, all navigation properties will load automatically, since serialization refers to all properties. <br><br>  The database context class uses lazy loading by default.  There are two ways to turn off lazy loading: <br><ul><li>  When declaring the navigation properties, skip the virtual modifier. </li><li>  For all navigation properties, specify LazyLoadingEnabled as false. </li></ul>  Lazy loading can hide code that causes performance problems.  For example, code that does not use eager or explicit loading but uses a large number of entities and several navigation properties in a loop may be very inefficient due to the large number of database calls, but everything will be fine if lazy loading is used.  Temporarily disabling lazy loading is one of the ways to find a code that is oriented towards using lazy loading.  In this, the navigation properties will be Null and an error will be triggered. <br><br>  <b>Creating the</b> <b>Courses</b> <b>Index</b> <b>page</b> <br><br>  Entity Course has a navigation property that contains the entity Department - the entity of the faculty that owns the course.  To display the name of the faculty, you need to refer to the Name property of the corresponding entity. <br><br>  Create a controller of type Course: <br><br><img title="clip_image006" alt="clip_image006" src="https://habrastorage.org/getpro/habr/post_images/ac7/488/9c4/ac74889c414278436e687a6aad801f0b.png" width="550" height="377"><br><br>  In <i>Controllers \ CourseController.cs,</i> notice the Index method: <br><br><pre><code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ViewResult <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>() { var courses = db.Courses.<span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>(c =&gt; c.Department); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(courses.ToList()); }</code> </pre> <br>  Automatic scaffolding determines the use of the eager loading for the Department navigation property using the Include method. <br><br>  In <i>Views \ Course \ Index.cshtml,</i> replace the code with: <br><br><pre> <code class="html hljs xml">@model IEnumerable<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ContosoUniversity.Models.Course</span></span></span><span class="hljs-tag">&gt;</span></span> @{ ViewBag.Title = "Courses"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Courses<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Create New", "Create") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Number<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Credits<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Department<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Edit", "Edit", new { id=item.CourseID }) | @Html.ActionLink("Details", "Details", new { id=item.CourseID }) | @Html.ActionLink("Delete", "Delete", new { id=item.CourseID }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.CourseID) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Title) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Credits) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Department.Name) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The following changes have been made: <br><br><ul><li>  Title changed to <b>Courses</b> . </li><li>  Lines are aligned to the left. </li><li>  Added a column under the <b>Number</b> heading that displays the value of the CourseID property.  (Primary keys are usually not included in the page, since they do not make sense, but in this case the meaning is meaningful and needs to be shown. </li><li>  The heading of the last column is changed to <b>Department</b> . </li></ul>  Notice that for the last column, the value of the Name property of the Department from the Department of the navigation property is displayed: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Department.Name) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Select Courses to see the list with the names of the faculties. <br><br><img title="clip_image001 [1]" alt="clip_image001[1]" src="https://habrastorage.org/getpro/habr/post_images/e68/a0c/2a0/e68a0c2a0dddfe6d27bfd3fe9ada6ca8.png" width="430" height="455"><br><br>  <b>Creating the</b> <b>Instructors</b> <b>Index</b> <b>Page</b> <b>with a list of courses and students of these courses</b> <br><br>  You will create a controller and view for the Instructor entity to display the Instructors Index page: <br><br><img title="clip_image002 [1]" alt="clip_image002[1]" src="https://habrastorage.org/getpro/habr/post_images/135/774/dff/135774dff7adde1c98bba97690870fd3.png" width="351" height="455"><br><br>  Loading and display of data occurs in the following scenario: <br><ul><li>  The teacher list displays the corresponding OfficeAssignment entity data.  The Instructor and OfficeAssignment entities are one-to-zero-or-to-one.  For the OfficeAssignment entity, eager loading is used. </li><li>  When a user selects a teacher, the associated entities of the Course are displayed.  The entities Instructor and Course are connected many-to-many.  You will use eager loading for Course Entities and the associated Department entities.  In this case, lazy loading will be more efficient because it is necessary to upload data about courses only for the selected teacher.  However, the example shows the use of eager loading. </li><li>  When the user selects the course, the Enrollments entity data is displayed.  Entities Course and Enrollment are one-to-many.  You add explicit loading for the Enrollment entity and its associated Student entities.  (With lazy loading enabled, using Explicit loading is optional, but we'll just show how explicit loading works.) </li></ul>  <b>Creating a view model for the</b> <b>Instructor</b> <b>Index</b> <b>view</b> <br><br>  The Instructor Index page displays three different tables.  To do this, we will create a view model that includes three properties, each of which contains data for each of the tables. <br><br>  In the <i>ViewModels</i> folder, create <i>InstructorIndexData.cs</i> : <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ContosoUniversity.Models; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ContosoUniversity.ViewModels</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InstructorIndexData</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;Instructor&gt; Instructors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;Course&gt; Courses { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;Enrollment&gt; Enrollments { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } }</code> </pre><br><h4>  Styles for selected columns </h4><br>  Selected columns require a separate background color.  To do this, add the following code to <i>Content</i> <i>\</i> <i>Site</i> <i>.</i>  <i>css</i> : <br><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* MISC ----------------------------------------------------------*/</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.selectedrow</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#EEEEEE</span></span>; }</code> </pre><br><h4>  Creating a controller and views for the Instructor </h4><br>  Create an Instructor type controller: <br><br><img title="clip_image007" alt="clip_image007" src="https://habrastorage.org/getpro/habr/post_images/f09/5b0/f7c/f095b0f7c7f9e499860cef705015bf77.png" width="550" height="384"><br><br>  In <i>Controllers \ InstructorController.cs,</i> add using for ViewModels: <br><br>  using ContosoUniversity.ViewModels; <br><br>  The generated code in the Index method defines the use of eager loading only for the OfficeAssignment navigation property: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ViewResult <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>() { var instructors = db.Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>(i =&gt; i.OfficeAssignment); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(instructors.ToList()); }</code> </pre><br>  Replace the Index method with the following code that loads additional data and puts it into the view model: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span>(Int32? id, Int32? courseID) { var viewModel = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> InstructorIndexData(); viewModel.Instructors = db.Instructors .<span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>(i =&gt; i.OfficeAssignment) .<span class="hljs-keyword"><span class="hljs-keyword">Include</span></span>(i =&gt; i.Courses.<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(c =&gt; c.Department)) .OrderBy(i =&gt; i.LastName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ViewBag.InstructorID = id.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; viewModel.Courses = viewModel.Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(i =&gt; i.InstructorID == id.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>).Single().Courses; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (courseID != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ViewBag.CourseID = courseID.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; viewModel.Enrollments = viewModel.Courses.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(x =&gt; x.CourseID == courseID).Single().Enrollments; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(viewModel); }</code> </pre><br>  The method accepts optional string parameters: ID values ‚Äã‚Äãof the selected teacher and course, and then passes the necessary data to the view.  IDs come from the <b>Select</b> links on the page. <br><br>  The code starts by creating an instance of the representation model and transferring the list of teachers to it: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InstructorIndexData(); viewModel.Instructors = db.Instructors .Include(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.OfficeAssignment); .Include(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.Courses.Select(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c.Department)) .OrderBy(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.LastName);</code> </pre><br>  We define an eager loading for Instructor.OfficeAssignment and Instructor.Courses navigation property.  For related entities, the Course eager loading is defined for the Course.Department navigation property using the Select method in the Include method.  Results are sorted by last name. <br><br>  If a teacher is selected, this teacher is retrieved from the list of teachers in the data model, after which the Courses property is initialized by the Course entities from the corresponding teacher in the Courses navigation property. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ViewBag.InstructorID = id.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; viewModel.Courses = viewModel.Instructors.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(i =&gt; i.InstructorID == id.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>).Single().Courses; }</code> </pre><br>  The Where method returns a collection, but in this case the condition passed to the method indicates to return only one Instructor entity.  The Single method converts the collection into one Instructor entity, which allows you to access the Courses property corresponding to this entity. <br><br>  The Single method is used on the collection if it is known that the collection will consist of one element.  This method throws exceptions if the collection is empty or consists of more than one element.  However, in this case, an exception will be thrown (due to the Course property with a null reference).  By calling Single instead of a separate call to Where, you can pass the condition itself: <br><br>  .Single (i =&gt; i.InstructorID == id.Value) <br><br>  Instead: <br><br>  .Where (I =&gt; i.InstructorID == id.Value). Single () <br><br>  Further, if a course is selected, then this course is extracted from the list of courses in the model.  The Enrollments model property is then initialized by the entities Enrollments navigation property. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (courseID != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ViewBag.CourseID = courseID.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; viewModel.Enrollments = viewModel.Courses.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(x =&gt; x.CourseID == courseID).Single().Enrollments; }</code> </pre><br>  And finally, the return to the model: <br><br>  return View (viewModel); <br><br>  <b>Editing</b> <b>the</b> <b>Instructor Index</b> <b>view</b> <br><br>  In <i>Views \ Instructor \ Index.cshtml,</i> replace the code with: <br><br><pre> <code class="html hljs xml">@model ContosoUniversity.ViewModels.InstructorIndexData @{ ViewBag.Title = "Instructors"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>Instructors<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Create New", "Create") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Last Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>First Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Hire Date<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Office<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Instructors) { string selectedRow = ""; if (item.InstructorID == ViewBag.InstructorID) { selectedRow = "selectedrow"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@selectedRow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Select", "Index", new { id = item.InstructorID }) | @Html.ActionLink("Edit", "Edit", new { id = item.InstructorID }) | @Html.ActionLink("Details", "Details", new { id = item.InstructorID }) | @Html.ActionLink("Delete", "Delete", new { id = item.InstructorID }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.LastName <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.FirstMidName <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @String.Format("{0:d}", item.HireDate) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @if (item.OfficeAssignment != null) { @item.OfficeAssignment.Location } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Changes: <br><ul><li>  The title of the page is changed to <b>Instructors</b> . </li><li>  Moved the row link to the left. </li><li>  Removed column <b>FullName</b> . </li><li>  An <b>Office</b> column has been added <b>that</b> displays item.OfficeAssignment.Location in the event that item.OfficeAssignment is not null.  (Due to the one-to-zero-or-one relationship, no OfficeAssignment entity may be associated with an entity.) </li></ul><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @if (item.OfficeAssignment != null) { @item.OfficeAssignment.Location } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><ul><li>  Added code dynamically adding class = "selectedrow" to the tr container of the selected instructor.  So we set the background color using the CSS class.  (the valign attribute will be useful in the future when we add a multi-line column to the table) </li></ul><br><pre> <code class="html hljs xml">string selectedRow = ""; if (item.InstructorID == ViewBag.InstructorID) { selectedRow = "selectedrow"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@selectedRow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><ul><li>  Before the links, a new ActionLink <b>Select was</b> added to each row, which allows you to transfer the ID of the selected teacher to the Index method. </li></ul>  Run the project to see the list of teachers.  The page displays the Location property associated with the OfficeAssignment entities and an empty cell if there are no related OfficeAssignment entities. <br><br><img title="clip_image008" alt="clip_image008" src="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-44-06-metablogapi/0726.clip_5F00_image008_5F00_75851AE7.png" width="550" height="453"><br><br>  in <i>Views</i> <i>\</i> <i>Instructors</i> <i>\</i> <i>Index</i> <i>.</i>  <i>cshtml</i> after the container table add the code that displays the list of courses of the selected teacher. <br><br><pre> <code class="html hljs xml">@if (Model.Courses != null) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Courses Taught by Selected Instructor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>ID<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Department<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Courses) { string selectedRow = ""; if (item.CourseID == ViewBag.CourseID) { selectedRow = "selectedrow"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@selectedRow"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Select", "Index", new { courseID = item.CourseID }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.CourseID <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.Title <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.Department.Name <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre><br>  The code loads the Courses view model property to display a list of courses, and displays a Select link, which is used to pass the selected course ID to the Index method. <br><br>  Select a teacher, and you will see a table with the courses of the teacher and the departments where the courses are conducted. <br><br><img title="clip_image009" alt="clip_image009" src="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-44-06-metablogapi/4035.clip_5F00_image009_5F00_6C686999.png" width="407" height="455"><br><br>  <b>Note</b> if the selected line does not change color, refresh the page, sometimes it is needed to load the .css file. <br><br>  After the code that you added, add a code that displays a list of students studying at the selected course. <br><br><pre> <code class="html hljs xml">@if (Model.Enrollments != null) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> Students Enrolled in Selected Course<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Grade<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Enrollments) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.Student.FullName <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @item.Grade <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre><br>  The code loads the Enrollments view model property to display a list of students on the selected student course. <br><br>  Select a teacher and click on the course to see students and their grades. <br><br><img title="clip_image002 [2]" alt="clip_image002[2]" src="http://blogs.msdn.com/cfs-file.ashx/__key/communityserver-blogs-components-weblogfiles/00-00-01-44-06-metablogapi/4024.clip_5F00_image0022_5F00_3B197F39.png" width="351" height="455"><br><br>  <b>Add</b> <b>Explicit</b> <b>Loading</b> <br><br>  In <i>InstructorController</i> <i>.</i>  <i>cs</i> and take a look at how the Index method loads the list of students for the selected course: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (courseID != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ViewBag.CourseID = courseID.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; viewModel.Enrollments = viewModel.Courses.<span class="hljs-keyword"><span class="hljs-keyword">Where</span></span>(x =&gt; x.CourseID == courseID).Single().Enrollments; }</code> </pre><br>  While loading the teacher list, you defined the eager loading for the Courses navigation property and the properties of each of the Department‚Äôs courses, then sent the Courses collection to the view model, and now you load the Enrollments navigation property from one of the entities in this collection.  Due to the fact that you have not defined the eager loading for Course.Enrollments navigation property, the data of this property appears on the page as a result of lazy loading. <br><br>  If you disable lazy loading, the Enrollments property will be null no matter how many students learn in this course.  In this case, to initialize the Enrollments property, you must define for it an eager loading or explicit loading.  To determine explicit loading, replace the Index method code with: <br><br><pre> <code class="hljs javascript">public ActionResult Index(Int32? id, Int32? courseID) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> viewModel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InstructorIndexData(); viewModel.Instructors = db.Instructors .Include(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.OfficeAssignment) .Include(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.Courses.Select(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c.Department)) .OrderBy(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.LastName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { ViewBag.InstructorID = id.Value; viewModel.Courses = viewModel.Instructors.Where(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">i</span></span></span><span class="hljs-function"> =&gt;</span></span> i.InstructorID == id.Value).Single().Courses; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (courseID != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { ViewBag.CourseID = courseID.Value; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> selectedCourse = viewModel.Courses.Where(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.CourseID == courseID).Single(); db.Entry(selectedCourse).Collection(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.Enrollments).Load(); foreach (Enrollment enrollment <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> selectedCourse.Enrollments) { db.Entry(enrollment).Reference(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.Student).Load(); } viewModel.Enrollments = viewModel.Courses.Where(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.CourseID == courseID).Single().Enrollments; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(viewModel); }</code> </pre><br>  After loading the selected Course entity, the new code explicitly loads the Enrollments properties: <br><br>  db.Entry (selectedCourse) .Collection (x =&gt; x.Enrollments) .Load (); <br><br>  Then the Student entities are explicitly loaded: <br><br>  db.Entry (enrollment) .Reference (x =&gt; x.Student) .Load (); <br><br>  Note that you use the Collection method to initialize the collection property, but for a single-element property you use the Reference method.  Now you can open the Instructor Index page - nothing has changed in appearance, but the principle of data loading has changed. <br><br>  So, you used all three methods of data loading in navigation properties.  In the next lesson, you will learn how to update related data. <br><br><h4>  Acknowledgments </h4><br>  Thanks for the help in the translation of Alexander Belotserkovsky ( <a href="http://habrahabr.ru/users/ahriman/">ahriman</a> ). </div><p>Source: <a href="https://habr.com/ru/post/134222/">https://habr.com/ru/post/134222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134211/index.html">Video from Web Standards Days in Minsk</a></li>
<li><a href="../134214/index.html">Yandex - now search by default</a></li>
<li><a href="../134215/index.html">Why do we still use Firefox, not Chrome?</a></li>
<li><a href="../134220/index.html">Failover proxy server based on Squid in the Windows domain</a></li>
<li><a href="../134221/index.html">Singltons version 5.3 in 5.2</a></li>
<li><a href="../134225/index.html">Your own 3D scanner</a></li>
<li><a href="../134227/index.html">Vibroy - vibrodynamic with high-quality sound</a></li>
<li><a href="../134228/index.html">Understanding the xCAT server deployment and maintenance system</a></li>
<li><a href="../134231/index.html">We work with EMS on violation of the delivery time of packages - instructions</a></li>
<li><a href="../134233/index.html">iPhone Gloss.ua 3.0 with a poster for 16 cities of Ukraine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>