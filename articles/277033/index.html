<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generators in ES6 and asynchronous code in a new way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When we start to deal with ES6, the generators are almost at the end of the list of innovations that we pay attention to. Often, we simply perceive ge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generators in ES6 and asynchronous code in a new way</h1><div class="post__text post__text-html js-mediator-article">  When we start to deal with ES6, the generators are almost at the end of the list of innovations that we pay attention to.  Often, we simply perceive generators as an easy way to create custom iterators, but in fact they can provide us with much more interesting features and are most likely one of the most interesting innovations in ES6. <br><a name="habracut"></a><br><h4>  What are generators and how do they work? </h4><br>  Generators are functions that can be started, paused, and resumed at various stages of execution.  Essentially, this special function returns an iterator.  Functions generators are indicated by an asterisk after the keyword <i>function</i> , and all magic is hidden in the use of the special keyword <b>yield</b> .  It determines that the iterator should return after the next call to the <b>next ()</b> method. <br><br>  And immediately an example of a simple generator in ES6: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">'first'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> input = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">'second'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> input; } <span class="hljs-comment"><span class="hljs-comment">//    let iterator = myGenerator(); //  ,    yield console.log(iterator.next()): // { value: 'first', done: false } // (   ),    yield console.log(iterator.next()); // { value: 'second', done: false } //  ( )    yield console.log(iterator.next('third')); // { value: 'third', done: false } //   (yield  ) console.log(iterator.next()); // { value: undefined, done: true }</span></span></code> </pre> <br>  So what happens here? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  We declare the function generator using the special <i>function * myGenerator () {}</i> syntax <i>.</i> </li><li>  The first call to this function returns an iterator object.  This object has a method <b>next</b> to resume the function of the generator in its current state. </li><li>  The generator function does not start its execution until we run <b>iterator.next.</b> </li><li>  Each time, when <b>iterator.next is</b> called, the function resumes its execution from the place of the last pause and executes all the code until it ‚Äústumbles‚Äù on the next <b>yield</b> and again pauses. </li><li>  A call to <b>iterator.next</b> returns an object containing the value that was passed to <b>yield</b> and a <b>flag</b> that indicates whether the function has completed its execution or not. </li></ul><br><h4>  Generators as iterators </h4><br>  At the beginning of the article it was mentioned that often generators are used as a simple mechanism for creating iterators.  All this can be done using <b>for for</b> syntax: <br><br>  For example: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">'first'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">'second'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-string"><span class="hljs-string">'third'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> myGenerator()) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(v); }</code> </pre><br>  Or for example: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myGenerator</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start, stop</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = start; i &lt; stop; i++) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> i; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> myGenerator()) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(v); }</code> </pre><br>  Ok, iterators are great, but let's see what things can be done more abruptly using generators. <br><br>  So, we need to log in to some kind of backend, then use an authentication token to retrieve data from the API.  If we apply the generator mechanism, it will look like this: <br><br><pre> <code class="javascript hljs">co(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">* (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> login(username, password); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posts = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> getPosts(result.token); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> posts; }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(value); }, err =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">username, password</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetch(<span class="hljs-string"><span class="hljs-string">'/login'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({ <span class="hljs-attr"><span class="hljs-attr">username</span></span>: username password: password }) }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.json()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPosts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">token</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetch(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Headers({ <span class="hljs-string"><span class="hljs-string">'X-Security-Token'</span></span>: token }) }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.json()); }</code> </pre><br>  This example uses the <a href="https://github.com/tj/co">co</a> library, which makes your asynchronous code look like synchronous using the promise mechanism.  Here for each <b>yield,</b> promise returns the result to the generator function and saves it to a variable. <br><br><h4>  Express vs Koa </h4><br>  <i>Eeee, Koa?</i>  <i>What is it all about?</i> <br><br>  <b>Koa</b> is a <i>new generation framework</i> (from the subtitle of the official website), which improves the middleware writing mechanism, using the same generators and the <a href="https://github.com/tj/co">co</a> library, and thus saving your applications from the <a href="http://callbackhell.com/">hell of callbacks</a> . <blockquote>  From a philosophical point of view, Koa seeks to ‚Äúfix and replace the node,‚Äù and Express, on the contrary, ‚Äúexpand the node‚Äù (from the Koa documentation). <br></blockquote><br><br>  Middleware in Koa is built on the mechanism of generators and is a ‚Äúcascade‚Äù.  Simply put, the mechanism ‚Äúdownstream‚Äù ( <b>downstream</b> ) through all middleware is first launched, and then ‚Äúupstream‚Äù through all middleware ( <b>upstream</b> ). <br><br>  So, an example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> koa = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'koa'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> app = koa(); <span class="hljs-comment"><span class="hljs-comment">// x-response-time app.use(function *(next){ var start = new Date; yield next; var ms = new Date - start; this.set('X-Response-Time', ms + 'ms'); }); // logger app.use(function *(next){ var start = new Date; yield next; var ms = new Date - start; console.log('%s %s - %s', this.method, this.url, ms); }); // response app.use(function *(){ this.body = 'Hello World'; }); app.listen(3000);</span></span></code> </pre><br>  This example will return to us 'Hello World', but first: <br><br><ol><li>  The request will go through the middleware <b>x-response-time</b> to do everything that goes to the <b>yield next line.</b> </li><li>  Then, <b>next yield</b> will stop the current function and transfer control to another middleware <b>logger</b> , it will also do everything to its <b>next yield.</b> </li><li>  In the logger, <b>yield next</b> will transfer control to the latest middleware. </li><li>  He in turn will form the answer <b>this.body = 'Hello World'</b> . </li><li>  We don‚Äôt have more middleware to transfer <b>downstream</b> , so the <b>upstream</b> process will start.  Those.  each middleware resumes its work after <b>yield next</b> , thus implementing an ‚Äúupstream‚Äù mechanism. </li></ol><br>  Cool in general, what else to say.  More about <b>Koa</b> can be viewed on the <a href="http://koajs.com/">official website</a> and on <a href="https://github.com/koajs/koa">github</a> . <br><br><h4>  Conclusion </h4><br>  ES6 generators are a powerful mechanism that allows you to write cleaner and more understandable asynchronous code.  Instead of using a bunch of callbacks throughout the code, we can now write asynchronous code that looks similar to synchronous, but in fact with the help of generators and the <b>yield</b> keyword, it ‚Äúwaits‚Äù for the asynchronous operation to complete. </div><p>Source: <a href="https://habr.com/ru/post/277033/">https://habr.com/ru/post/277033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277021/index.html">We disassemble decorators ES2016</a></li>
<li><a href="../277023/index.html">The book "Head First. Programming for Android ¬ª</a></li>
<li><a href="../277025/index.html">From complex to simple: we start a virtual server Windows / Linux</a></li>
<li><a href="../277029/index.html">Log server Elasticsearch + Logstash + Kibana4 + Beats (windows / linux). Installation and Setup</a></li>
<li><a href="../277031/index.html">MyHTML - HTML parser on the "bare" C with POSIX Threads support</a></li>
<li><a href="../277035/index.html">Initial Setup of Extreme Networks Wireless Controllers</a></li>
<li><a href="../277037/index.html">Ultima 2C is a free ERP II class solution based on Ultima Businessware platform.</a></li>
<li><a href="../277041/index.html">Multichannel site upgrade. How to make your life easier</a></li>
<li><a href="../277043/index.html">Ariadna. Why do I need another geocoder for OSM?</a></li>
<li><a href="../277045/index.html">Announcement WordPress Meetup # 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>