<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are testing integration with external services.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern applications rarely work in isolation, most often they are integrated with many third-party services. Therefore, there is an urgent need to tes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are testing integration with external services.</h1><div class="post__text post__text-html js-mediator-article">  Modern applications rarely work in isolation, most often they are integrated with many third-party services.  Therefore, there is an urgent need to test this integration in the framework of integration or functional testing.  And then you can step on many of the rakes, which I am going to talk about.  For whom this topic is relevant, please under the cat. <br><br><a name="habracut"></a><br><br><h3>  What is the actual problem? </h3>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first solution that comes to mind is to test directly on a real service.  In some cases this may be justified, but often leads to the following problems: <br><br><ul><li>  <b>Tests slow down quite strongly</b> .  An external service is usually accessed over a network using public protocols, which is much slower than local integration.  External service is usually not as fast and is subject to its own load, during which it can slow down even more.  As a result, I have seen in practice a slowdown of the integration test suite from 10 minutes to a couple of hours, and the execution time floated heavily. </li><li>  <b>Tests are becoming less stable</b> .  As I have already said, external services are subject to loads, sometimes unavailable due to updates, they "fall" when service developers incorrectly update, and network errors are also not excluded.  All this greatly affects your test suite and its stability.  Tests ‚Äúfall‚Äù unexpectedly, it takes a lot of time to study the problem and the team members start to be incredulous about the tests in general.  As a result, the very usefulness of testing may be questioned. </li><li>  You simply <b>do not have the opportunity to get some external service responses</b> (errors, specific data, etc.), which may affect the coverage of your code with tests, which means reliability of regression testing with integration tests.  After all, it is necessary to cover not only positive, but also negative scenarios. </li><li>  A real service does not always have a test interface and you have to use a completely real one.  And this is <b>not always free</b> and any <b>errors in your code put the real data</b> on an external service <b>at risk</b> .  Thanks to this problem, you can easily delete very important data or block access from a real application.  And without saying that a lot of money can be spent on the ‚Äúunexpected‚Äù use of an external service. </li></ul><br><br>  The problems described cause you to look for alternative solutions and they exist. <br><br><h3>  Plugs rule the world of testing! </h3><br><br>  You can come to the aid of various options for stubs (I did not find a better translation of the term <b>mock objects</b> ).  There are several options for stubs: mock, stub, dummy, spy, fake.  Knowing and distinguishing between them is necessary and important, so it‚Äôs worthwhile to <a href="http://xunitpatterns.com/Mocks,%2520Fakes,%2520Stubs%2520and%2520Dummies.html">read</a> and understand the specifics, but this is not about this.  We only need one of the types of stubs that are most suitable for working with external services - <b>fake implementation</b> . <br><br>  Fake implementation is a simplified version of this service that works completely predictably, locally, gives full access to data and settings, and also does not require any additional work in each test.  Thus, we can transparently replace the real service in the tests for fake implementation and solve all the problems.  Sounds easy?  Not really! <br><br>  First, we will need to implement this simplified version of the service, which takes time and the efforts of developers.  You are lucky if your external service provides fake implementation for local testing.  Then you simply download the library, configure it, launch it and use it for health.  Some services allow you to access a special version of the external service for testing, which is not subject to the problems listed in the first part.  But such a service unit.  Almost always you will have to write a fake implementation yourself. <br><br>  Secondly, you have to take care that your fake implementation behaves in the same way as a real service.  This is one of the most frequent rakes, which are attacked by supporters of the described approach.  You make a fake implementation today, and after a week the real service starts to behave differently.  Your tests still pass and you live in peace until you push your code onto the live servers.  And there you will find an unpleasant surprise! <br><br>  This problem is very easy to fix, but it will take a little more effort.  You need to write another set of tests, now for a real service, the purpose of which will be to control and maintain the reliability of the protocol between your application and the third-party service.  This is some <b>kind of smoke test</b> for an external service that can be run once an hour, day or week depending on the stability of your external service.  Then you really control and test integration with an external service and avoid surprises when it changes. <br><br><h3>  I am not ready for such changes! </h3><br><br>  The described solution is not for everyone (in principle, like any other).  Therefore, I will give some tips with which you can smooth out the problems from the first part of this article. <br><br><ul><li>  <b>Separate tests</b> for those where you need integration into external services, and those where only the internal functionality of your product is important.  I will give a couple of simple examples.  If you are testing the registration, then you probably are not so important system of displaying advertising, pulling up the latest entries from Twitter, etc.  Therefore, external services can and should be disabled.  Each application can do this in its own way.  For example, in a web application it is very easy to use a monitored proxy, which can block access to one of the external services at any time.  Such a simple measure will allow you to greatly speed up your tests. </li><li>  Actively <b>use custom caching</b> to retrieve data from external services.  Usually with integration or functional testing, you go through the same parts of the application repeatedly, and there is not always a need for updated data.  Therefore, you can greatly save on calls to external services by caching the results of the previous call.  Thus, you are still testing the acquisition of real data, but much more optimally. </li><li>  Be sure to <b>look for open source fake solution</b> for your service.  Usually for popular services it exists, since many people come across a similar testing task and not all of them are as lazy as you.  For example, there is a great <a href="https://github.com/jubos/fake-s3">fake-s3</a> project for working with Amazon S3 service.  It implements the same API, allowing you to test integration for free, safely and locally.  All you need is the ability to configure access to the service in your application. </li><li>  Check with the service provider if it has the ability to localize testing.  Perhaps you just do not know about the existence of such solutions or push the provider to create it.  For the demand is not hit, as they say. </li></ul><br><br>  Someone even this set of measures will significantly improve their testing. <br><br><h3>  Conclusion </h3><br><br>  In general, the most important thing is to understand the problems described and to have the desire to solve them.  Then you can come up with many alternative solutions and approaches that will work even better than those given in the article for your particular case.  And then your tests will again be fast, reliable and even more useful for your team. </div><p>Source: <a href="https://habr.com/ru/post/170637/">https://habr.com/ru/post/170637/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170621/index.html">Dimension Elite 3D Printer Review</a></li>
<li><a href="../170623/index.html">Is there a future for component architecture?</a></li>
<li><a href="../170627/index.html">CoffeeScript 1.5.0 allows you to write comments in Markdown format</a></li>
<li><a href="../170633/index.html">Bayesian analysis in Python</a></li>
<li><a href="../170635/index.html">How much does it cost to get to the top Apple App Store?</a></li>
<li><a href="../170639/index.html">Yandex.Money distributes gifts</a></li>
<li><a href="../170641/index.html">Announced the official date for the presentation of the Samsung Galaxy S IV</a></li>
<li><a href="../170647/index.html">Surfingbird as a tool to attract new users</a></li>
<li><a href="../170649/index.html">LinkMeUp. Release 0</a></li>
<li><a href="../170651/index.html">How we found your dao in developing an application for Windows 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>