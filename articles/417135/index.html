<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity3D: how to know the degree of illumination of the point of the scene?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings 

 I know, and you know deep down, what your card games or ‚Äúthree in a row‚Äù games are missing. Stealth systems! 

 And of course, any self-r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity3D: how to know the degree of illumination of the point of the scene?</h1><div class="post__text post__text-html js-mediator-article">  Greetings <br><br>  I know, and you know deep down, what your card games or ‚Äúthree in a row‚Äù games are missing.  Stealth systems! <br><br>  And of course, any self-respecting stealth system must be able to take into account the ambient light around the player.  I was amazed to dig up the topic and find an abnormally small amount of information.  Therefore, I hasten to share the fruits. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Today we will not develop a full-fledged system of secrecy for the player, consider purely interaction with lighting. <br><a name="habracut"></a><br><h3>  Method 1: colliders </h3><br>  Simple and not very resource-intensive way. <br><br>  To each light source we add a spherical collider.  Making it a trigger.  We set the dimensions approximately equal to the radius of light. <br><br>  The rest is clear as a shadow.  We write a simple script, where in OnTriggerEnter () we place the activation of the calculation of illumination (so that the light sources do not work "idle" when there is no player nearby). <br><br>  The light calculation itself will be located in Update ().  In fact, this is the usual Physics.Raycast ().  If it hits the player, the player is in the light zone.  If it doesn't, then the player is behind the obstacles and, therefore, in the shadows. <br><br>  Also here you can add the calculation of the distance between the player and the light source.  Thus, to determine the illumination we will have a simple float, which will vary depending on the distance to the light sources.  And you can use it where your heart desires. <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/c9/nu/43/c9nu43wv6trcy2hg28eijiq4j_o.png"><br>  <i>At point 1, the illumination is close to the maximum.</i>  <i>At point 2, the illumination is minimal - between the light and the point of the obstacle.</i>  <i>At point 3, the illumination is average.</i> <br></div></div><br>  And that's not it!  You can add trigger colliders to various ‚Äúshadow zones‚Äù where the player must hide.  In the best traditions of Manhunt.  Similarly, you can mark bright zones with a collider, simulating, for example, a spotlight. <br><br><h4>  Benefits: </h4><br><ul><li>  Easy to set up point lights. </li><li>  Quite economical in terms of resources, if not spam light sources. </li></ul><br><h4>  Disadvantages: </h4><br><ul><li>  Spot light and Directional light are heavily tuned.  If for the first it is enough to rationalize the collider in the field of light (to increase the visibility of the player at the entrance), then the second seems to be a real horror.  It is necessary either to place colliders at each shadow (to reduce the player‚Äôs visibility at the entrance), or to constantly check with Physics.Raycast () between the player and the ‚Äúsun‚Äù - the one under the rays or in the shade. </li><li>  A large number of colliders litter the scene, complicating physics. </li><li>  Care must be taken with intersecting light sources. </li><li>  Dynamic light (moving or changing intensity) should be added separately through scripts. </li></ul><br><h3>  Method 2: RenderTexture </h3><br>  What are we doing here?  In fact, we get a ‚Äúscreenshot‚Äù from the camera, and not necessarily from the main camera.  And then analyze the color of the screenshot to find out how bright the light falls on the subject. <br><br>  First we need an object from which we will ‚Äúread‚Äù the light.  Create a normal sphere or plane, make a small one (scale 0.1), place it close to the floor, make it white, remove the collider: <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hb/ri/7o/hbri7op9p5lyq091ia1ozgeiasc.png"><br></div></div><br>  Add a camera (be sure to remove the audio listener and check that the MainCamera tag is not worth it).  Bind it to our object.  We put it a little higher, we direct it down.  We set in the settings not the main display.  Whether to make it orthographic is to your taste. <br><br>  At the end we position it so that it looks at our object and only at it. <br><br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/de/3y/uvde3ygsuysuvuysojxbsvmbml8.png"><br></div></div><br>  At the end, we set up the Culling mask of the main and secondary cameras so that the main one does not display our ‚Äúlight‚Äù objects, and the secondary ones only see them without being littered with anything else. <br><br>  And here the most interesting begins.  We tie a script to the camera: <br><br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Camera</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cam</span></span>; //   <span class="hljs-selector-tag"><span class="hljs-selector-tag">RenderTexture</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Texture2D</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">tex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Start</span></span> () { //    "". // ,       -   . // Depth   0   -   . tex = new RenderTexture (1, 1, 8); // RenderTexture "" , //   ,    . _tex = new Texture2D (1, 1, TextureFormat.RGB24, false); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Update</span></span> () { //   ""  cam.targetTexture = tex; cam.Render (); //     RenderTexture.active = tex; //   Texture2D _tex.ReadPixels (new Rect (0, 0, 1, 1), 0, 0); _tex.Apply (); Color col = _tex.GetPixel (0, 0); float vis = (col.r + col.g + col.b) / 3; }</code> </pre> <br>  At the output, we obtain a float vis, which, in essence, is a numerical representation of the level of illumination falling on our object.  If the source is close - the object is white - vis is 1. If it is dark - the object is black - vis is ~ 0. <br><br>  We do not need to perform the above operation every frame, so we embed a small second timer: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">interval</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Update</span></span> () { interval += Time.deltaTime; if (interval &lt; 1) return; interval = 0; //   }</code> </pre> <br>  Next, we tie our entire system to the player so that it moves with it.  And our vis variable automatically provides the illumination around the player! <br><br>  This system can be used not only in conjunction with the player.  You can place it anywhere and in any way, creating a kind of light sensors.  As a rule, there are more effective ways to implement them, but is it always nice to have alternatives? <br><br>  The advantages are obvious, let's talk about the disadvantages. <br><br><h4>  disadvantages </h4><br><ul><li>  Each ‚Äúlight detector‚Äù (if there are more than one) requires a separate camera. </li><li>  Texture2D.ReadPixels () is extremely slow.  Even if you do it once a second, and not every frame, even if you break the functions of writing and reading textures into different frames, you still have 40-110ms of spans. </li><li>  This system does not take into account some rare cases.  For example, on the character shine a flashlight.  The character is well lit, but the light falls on him and behind him, not down, respectively, our light detector shows a low level of illumination.  You can solve the problem, for example, by placing the detector not at the floor, but at the level of the character‚Äôs chest.  Then you need to put two cameras on opposite sides to read the light from either side.  That will slow the system even twice. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/417135/">https://habr.com/ru/post/417135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417123/index.html">Spark Streaming and Kafka Integration</a></li>
<li><a href="../417125/index.html">RTC Meetup .Net: welcome to first meeting</a></li>
<li><a href="../417127/index.html">Tesla has signed an agreement to build Gigafabrika 3 in China</a></li>
<li><a href="../417129/index.html">Mind universe</a></li>
<li><a href="../417131/index.html">How to already feel transactions in MongoDB</a></li>
<li><a href="../417137/index.html">Angular: Create a multiple checkbox component that is suitable for reuse.</a></li>
<li><a href="../417139/index.html">Evidences that have deceived scientists for several decades</a></li>
<li><a href="../417141/index.html">It's never too early to think about 6G</a></li>
<li><a href="../417143/index.html">Evidence in science? They are not</a></li>
<li><a href="../417145/index.html">Burger King app: mock personal data protection. Correct?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>