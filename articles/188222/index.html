<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Struts2 is under attack or CVE-2013-2115</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to write a small post for those who own Struts2 projects. Guys, if you don‚Äôt read the CERT mailing list and my Twitter account (well, I can for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Struts2 is under attack or CVE-2013-2115</h1><div class="post__text post__text-html js-mediator-article">  I want to write a small post for those who own Struts2 projects.  Guys, if you don‚Äôt read the CERT mailing list and my Twitter account (well, I can forgive this ...), and don‚Äôt pay attention to the Struts2 newsletter about updates - then think again, this story is for you. <br><img src="https://habrastorage.org/storage2/def/7d7/ccb/def7d7ccb413c74016bd83c0a5a1f616.png"><br><br><a name="habracut"></a><br><br><h4>  Start. </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This story began on the 16th of July.  I peacefully rode the subway and read Isaac Asimov, as they say, nothing foreshadowed trouble.  In between times, I decided to check the corporate mail, and found a letter from our guys from the Chinese office.  The guys said that today there was a message about the vulnerability in Struts2, the vulnerability allowed anyone to get full remote control over the server (arbitrary code execution) with web service rights.  Palekhcha guys ... the day of the current has begun.  Okay, but besides, our guys found out about it from the hacking Chinese forum, where other funny guys posted a full-fledged exploit, like ‚Äúhit the button and hacked the Internet‚Äù, which means that now, all these funny guys will start breaking this most unhappy Internet.  This is not particularly pleasant when you realize that we have several services that are based on this framework.  Nervously tugging with my foot, I mentally accelerated the movement of the train.  And now I run into the office, turn on the laptop.  Yes indeed - advisor from the vendor - <a href="http://struts.apache.org/release/2.3.x/docs/s2-016.html">http://struts.apache.org/release/2.3.x/docs/s2-016.html</a> .  Yes, the guys even slightly cropped example of an exploit in his message added.  And ... this is OGNL again ... Struts2 has eternal problems with OGNL: <br><br>  <a href="http://blog.o0o.nu/2010/07/cve-2010-1870-struts2xwork-remote.html">http://blog.o0o.nu/2010/07/cve-2010-1870-struts2xwork-remote.html</a> (2010) <br>  <a href="http://blog.o0o.nu/2012/01/cve-2011-3923-yet-another-struts2.html">http://blog.o0o.nu/2012/01/cve-2011-3923-yet-another-struts2.html</a> (2011) <br>  <a href="https://communities.coverity.com/blogs/security/2013/05/29/struts2-remote-code-execution-via-ognl-injection">https://communities.coverity.com/blogs/security/2013/05/29/struts2-remote-code-execution-via-ognl-injection</a> (2013, May) <br><br>  And here again ... Okay.  But this time the matter is limited by time - in the Chinese forum, in public is available - ‚ÄúAn exploit for all‚Äù - <a href="http://kuxoo.com/archives/260/">http://kuxoo.com/archives/260/</a> . <br><br>  An example of a layer to not open a link with hieroglyphs - look in your logs: <br><br> <code><a href="http://localhost/Struts2/test.action%3Fredirect"></a> localhost/Struts2/test.action?redirect:${#a=(new java.lang.ProcessBuilder(new java.lang.String[]{'netstat'})).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get('com.opensymphony.xwork2.dispatcher.HttpServletResponse'),#matt.getWriter().println(#e),#matt.getWriter().flush(),#matt.getWriter().close()}</code> <br> <br>  What does this mean?  And the fact that time went on for seconds.  At the same time, I hope you understand that you cannot just take and put an update from Struts2 on production services, without testing and other procedures, besides, there are different time zones in different regions.  All these are normal working moments, one way or another, where it was possible - fixes were rolled up, IPS / WAF was adjusted in other places, thirdly service filters ‚Äî in general, solutions, how to prevent a threat ‚Äî weight, everything was done in such a way as to protect against possible attacks. <br><br>  On the 17th, an enemy was found on our borders.  Mostly Chinese IP addresses.  Unsuccessfully scanned precisely on this vulnerability.  It turns out that the reaction time to prevent invasion since the release of the patch was <b>1 day</b> and was crucial.  The Chinese all one and all used the same exploit, which can be determined by the <i>matt</i> variable.  Although the options for how to execute code through OGNL expressions are mass - almost all the power of Java in the hands of the attacker. <br><br><h4>  Internet reaction </h4><br><br>  At this time on the Internet - in the blogosphere, in the news, and even on Twitter it was quiet.  This is not very similar to the information security community - too quiet, given the popularity of Struts2, this is strange.  I tweeted on this topic, but it was quiet, only a few colleagues said that they were fighting off attacks. <br>  A little later (on the 21st or the 22nd) the news about hacking developer.apple.com thundered.  I did not pay attention, only then I suddenly realized that the developer portal was on Struts2.  Apparently they got to that way ... Of course there was news that a certain researcher reported vulnerabilities, but I do not believe.  Most likely this guy just repeated the Chinese public-exploit, and reported a bug, but before it was already a server hacked.  Otherwise, it would not be turned off for such a long time.  And then this guy just decided to turn the PR action in honor of his beloved, they say he hacked Apple.  Around the 24-25 number, it was interesting to me, AT ALL, at least someone scratched and fixed. <br>  For example, one large Belarusian bank fixed only on the 25th.  About QIWI you can read here - <a href="http://habrahabr.ru/company/qiwi/blog/187724/">http://habrahabr.ru/company/qiwi/blog/187724/#comment_6524512</a> .  The rest of Russia in peace and quiet.  The state order system found is vulnerable.  One important service of the Ministry of the Russian Federation, with a bunch of personal and more interesting data, is vulnerable.  What kind of cyber war can we talk about, Lukatsky didn‚Äôt write about it in a blog - and figs with him, and the fact that the Chinese comrades are full of backdoors - who cares, this isn‚Äôt PD to discuss.  Sadly, the country is not ready either for 0day, but for the known 1day attacks in its most acute time period, even more than a week after the release of the patch!  Banks of the CIS and that more quickly appeared.  BUT if you think that only in Russia everything is always bad - you are mistaken.  I was not lazy and scanned the most interesting resources - the government resources of other countries are still vulnerable.  And the attack on some of them will have quite interesting consequences in the physical world. <br><br><h4>  Not every workaround is good </h4><br><br>  The second observation is those who <b>knew about the attacks and the bug</b> , and muddied a hot fix.  I found two services from major world vendors.  Both servers had hotfixes that did not allow the attack to pass.  But both vendors made the same mistake.  In the advisory and in the public exploit there was only one attack vector - the GET request.  But it is worth checking and POST.  The guys did not foresee this in the heat of battle, as a result I received shell on both servers, which I immediately informed both companies about.  The fixes came out in a few hours.  Screenshots c proof of access in the next issue of the magazine] [ <br><br><h4>  Instead of conclusion </h4><br><br>  Conclusions about what and why, and how to live and fight with this, I also left for the magazine, although this is so obvious.  But I decided to write to Habr, which would be trite to warn - I cannot write to each vendor personally, especially to government structures and banks - this is your job not mine, YOU should react to your incidents, for example, since it did QIWI, they did not need wait a week (my im respect).  The rest - just know, and take action, because the enemy does not wait for <b>one month</b> from the moment the patch is released, as it is written in the paper standard that you proudly meet ... he started the attack <b>one day</b> after fixing from the vendor. </div><p>Source: <a href="https://habr.com/ru/post/188222/">https://habr.com/ru/post/188222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188208/index.html">UXtra Show - Release 1: Dream Interfaces</a></li>
<li><a href="../188210/index.html">NASA missions in the coming years</a></li>
<li><a href="../188212/index.html">Canon i-SENSYS LBP6020 in CentOS 6 or never write in those. support</a></li>
<li><a href="../188214/index.html">Method for quickly calculating the IPv4 network address by mask</a></li>
<li><a href="../188218/index.html">Attracting audiences - do-it-yourself affiliate program</a></li>
<li><a href="../188224/index.html">Visual overview of optical transmitters</a></li>
<li><a href="../188226/index.html">New sensory material for measuring strain, humidity, temperature, pressure ... and then what?</a></li>
<li><a href="../188230/index.html">SOINN - self-learning algorithm for robots</a></li>
<li><a href="../188232/index.html">New kind of mozilla vlc plugin</a></li>
<li><a href="../188236/index.html">SIM-cards of passengers of the Moscow metro will be subjected to contactless reading</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>