<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How fake programmers design</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Real programmers are clouds, big data, high load ... And we have almost DIY. 2 installations - already replicating, 100 pieces - production ... But th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How fake programmers design</h1><div class="post__text post__text-html js-mediator-article">  Real programmers are clouds, big data, high load ... And we have almost DIY.  2 installations - already replicating, 100 pieces - production ... But then nuclear icebreakers, shunting locomotives, tractors, locks, bridges, descending from excess asphalt, drones the size of a house, 50 people of staff per shop more than two kilometers long ... and reliability, reliability , reliability ... And heels of general directors in suits right on the field while demonstrating the system on a tractor ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/44d/2c7/f71/44d2c7f7195dff1f8b66be8c31629c34.jpg" alt="image"><br>  <i>Normal end of debugging - we remove the antennas from the tracker</i> <br><br>  So ... there was a request from colleagues to write a TKP (technical and commercial proposal) to a tricky GPS tracker.  And the comments that big and real refused to do. <br><a name="habracut"></a><br>  Hmm ... we, of course, are engaged in GPS, but to put it mildly quite different.  Not trackers, and high-precision.  Well, as the bridge moves, we can measure it.  Or make a satellite compass.  And the trackers are not ours.  But it is interesting to try where the real ones refused! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b><i>The main purpose of the work is to comply with paragraph 597 of the Federal norms and rules in the field of industrial safety ‚Äú <a href="http://base.garant.ru/70691622/">Safety rules for mining and processing of solid minerals</a> ‚Äù</i></b> <br><br>  There is a quarry.  It is driven by mining excavators and trucks.  And people work.  Who does not know - career cars are big.  From the cab - people are not visible.  In recent years, customers have a couple of accidents with human victims.  Therefore, we need a system to prevent collisions.  That is smart GPS trackers. <br><br>  It is clear how big and real they do it.  GPS tracker for mobile communications (GPRS, 3G) sends the coordinates to the database server.  The database server provides the coordinates of the application server, it determines the possibility of a collision and sends warnings to the control room via the Internet.  From the control room, they are somehow (SMS? Pager? Radio call?) Transferred to the staff.  We start to think why the big ones refused. <br><br><div class="spoiler">  <b class="spoiler_title">We read paragraph 597</b> <div class="spoiler_text">  597. When using positioning equipment to ensure the safe operation of technological transport and mining equipment, control of speed limits and the mutual arrangement of mountain vehicles and actuators, the following conditions are met: <br>  continuous transfer of coordinates and speeds to the control tower with display of navigation parameters on the terminals of operators; <br><br>  positioning accuracy. <br><br>  The positioning accuracy should be: <br>  for career road transport and bulldozers - no more than 3 m; <br>  for railway transport - no more than 1 m; <br>  for actuators of drilling rigs and mining equipment - no more than 0.1 m; <br>  for staff - no more than 3 m. <br><br>  Personnel located at the mining site must be equipped with individual positioning tools with continuous transfer of personnel location to the control room. <br>  The software should provide timely alarm and alert personnel about the danger of collisions, possible attacks, approaching danger zones, violations of technological parameters and modes of operation of mining and transport equipment. </div></div><br>  Yeah, it's already clear.  The accuracy of household GPS and GNSS receivers is 3 meters <a href="https://ru.wikipedia.org/wiki/%25D0%25BA%25D1%2580%25D1%2583%25D0%25B3%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B5_%25D0%25B2%25D0%25B5%25D1%2580%25D0%25BE%25D1%258F%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BE%25D1%2582%25D0%25BA%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">KVO-50</a> .  That is, 50% of the time - they give an accuracy of 3 meters, 49.8% - from 3 to 9 meters and 0.2% further.  And in the TZ most likely it means 3 meters <a href="https://en.wikipedia.org/wiki/Circular_error_probable">KVO-95</a> .  That is, 95% of the time the error should fit into a circle with a radius of 3 meters.  Well, this is understandable as solved.  Instead of a household one, we take a semi-professional receiver supporting <a href="https://ru.wikipedia.org/wiki/DGPS">DGNSS</a> .  This is such a system when there is a fixed receiver with known coordinates.  It calculates the reception error for each satellite and transmits this error to other receivers - mobile ones.  And those already consider taking into account a known error (first of all ionospheric).  CSO!  The project already has a <b>base station</b> and a <b>base station</b> <b>communication channel</b> with receivers. <br><br>  We take the receiver Russian-Ukrainian <a href="http://nvs-gnss.ru/products/modules/item/2-nv08c-csm.html/">NV08C-CSM</a> from <a href="http://navis.ru/">KB Navis.</a>  Well, simply because the authors are friends.  So - if you have problems, get advice.  We look at the parameters - in the DGNSS mode, the accuracy is 1 meter of the standard <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BD%25D0%25B5%25D0%25BA%25D0%25B2%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D0%25BE%25D1%2582%25D0%25BA%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">deviation</a> , that is, 1.7 meters KVO-95.  Fulfilled.  And the sergeant gap is good. <br><br>  What is next?  Transfer by GPRS / 3G.  We read the <b><i>statement of work</i></b> : The <b><i>remoteness of the camera clay from the quarry of cement clays is 7 km., From the limestone quarry - 100 km.</i></b>  .  We look at the map - what about the coverage of cellular operators?  And the devil knows what's in the career.  On the surface, maybe 3G will be, but down in the quarry ... So the link between the trackers and the base station is via radio.  <a href="http://lo-ra.ru/">Choosing LoRa</a> , <s>well, I want our electronics engineer to play with this technology</s> because it is cheap and productive.  At the same time - we save the customer on operating costs.  Pay for 3 SIM cards is cheaper than 40. <br><br>  We learn about the Internet - have not seen it in these careers.  But what about the connection with the control room?  So you need a GSM antenna on the mast.  And not just an antenna, but with an amplifier.  We recall Sochi and 1 package once every 20 minutes via GPRS.  Although it was not a season, in the evening the cell was filled with voice communication and there were no slots left on the GPRS.  Then we remember how the <a href="http://www.kommersant.ru/doc/201664">entire Fora network was put up for a day by</a> updating the software in St. Petersburg.  No, one operator is not enough for us.  We make 3 towers - each for its own operator. <br><br>  And once 3 towers means 3 base stations DGNSS and 3 channels LoRa.  Just climbed into the range with frequency division.  However, the temporary separation is probably better? <br><br>  What's next for the big ones?  Application server defining a dangerous approximation?  Do you need him?  And if the Internet is not?  No, <a href="http://www.ozon.ru/context/detail/id/34449682/">we are paranoid</a> .  We have connection of trackers with base stations.  Coordinates broadcast trackers transmit.  Trackers listen to each other.  So the tracker itself can determine if there is anyone nearby.  And who is this person or car?  And if not?  Well, a radio signal can go bad through a mining truck.  So the safety system - at base stations.  They also analyze the approximations and give an alarm to the tracker. <br><br>  DB server?  Oh his <s>to the demon</s> in the control room.  Mnemoschemu control room - draw on the <a href="http://www.masterscada.ru/">Master Scud</a> , from it is also the server.  But the colleagues and the mnemonic colleagues will cope better than us - this is their part in the overall project.  And ours - trackers and base stations. <br><br><img src="https://habrastorage.org/files/f5d/bc4/794/f5dbc47946eb45f8b18512c5be30c6fb.jpg" alt="image"><br><br>  The concept is already clear.  We go further.  Next we have power.  With base stations, all is well.  We feed 220 volts on a cable.  The cable will disconnect - not scary, there are two more.  There will be no electricity at all - well, <s><a href="http://www.anekdot.ru/id/171665/">somehow</a></s> , <s><a href="http://www.anekdot.ru/id/171665/">hrum-hrum-hrum</a></s> , but the trackers will work.  The control room will turn off, but detection of people's dangerous proximity to the technology will remain.  With loss of accuracy - but it will remain. <br><br>  And what about the power trackers?  Lithium battery like a big one?  And how to change it when it is discharged?  Real trackers do not send data once a second, their tracker basically works in sleep mode.  No, we do power on two 18650 batteries. And first we eat from one, and after its full discharge from the other.  To check the power - put a button and a LED.  Pressed - lit, then the norm.  Flashing long - right battery discharged.  Blinking short - discharged both.  Well, the charging station - to charge everything together at night.  The quarry works in 1-2 shifts, so there is a night of charging.  And there will be no night - just increase the number of batteries and change them between shifts. <br><br>  And what about the trackers on cars?  And here the oscilloscope is needed.  It is not clear whether they, too, from the batteries to power, or whether it is possible from the onboard network + ionistor.  The problem is that when the vehicle goes from power supply to batteries to diesel power supply, there is a surge in voltage and our devices hang.  It is necessary to relax with an oscilloscope, to understand what kind of throw.  But for now, we decide that the onboard network is better. <br><br>  And what about the car with the antenna?  UPS, the antenna built into the tracker will not work in the iron case.  Well, or will be, but the signal will give a weak and accuracy will decrease.  It means that the antenna on the car is external, and to have a common device for pedestrians and cars will not work. <br><br>  Accordingly, we have three devices: a base station, a wearable tracker on batteries with a built-in antenna and a car tracker with power from the on-board network and an antenna on the roof. <br><br>  Next we have drivers.  Does the driver need a tracker?  Yes, it seems that we need.  If the driver got out of the car - it should be warned about the movement of other cars.  And what to do when landing in the car?  It will always ring.  So you need a function to turn off the ringing by clicking on the button.  At the same time solve the problem with the supply by car.  Came to the car, the tracker rings.  I pressed the button - the tracker was silent until the exit from the 3-meter zone. <br><br>  Do you need to track a dump truck on the way from the quarry to the railway station or factory?  Yes, it seems necessary, but this is already an option.  We put 3G modems in car trackers, but as an option.  We give a higher price - here the ‚Äúbig ones‚Äù can do better than us, let the customer buy a separate system from them. <br><br>  Well, the compositions of the devices are clear. <br><br><ul><li>  Base station: GNSS receiver, 3G modem, mast, GNSS antenna, 3G antenna, 3G amplifier, power supply (220 by 5 and 12 volts), LoRa radio transmitter, LoRa antenna, <a href="https://ru.wikipedia.org/wiki/Renesas_Electronics">Renesas processor</a> , linux OS. </li><li>  Wearable tracker: GNSS receiver, GNSS antenna, LoRa radio transmitter, LoRa antenna, <a href="https://ru.wikipedia.org/wiki/STMicroelectronics">STM32 processor</a> , <a href="https://ru.wikipedia.org/wiki/FreeRTOS">FreeRTOS</a> , buzzer, button, LED, 2 batteries. </li><li>  Automobile tracker: GNSS receiver, LoRa radio transmitter, 3G modem <a href="https://ru.wikipedia.org/wiki/STMicroelectronics">STM32 processor</a> , <a href="https://ru.wikipedia.org/wiki/FreeRTOS">FreeRTOS</a> , buzzer, button, LED, 2 batteries. </li><li>  Carried out part of the car tracker on the roof: GNSS antenna, 3G antenna, LoRa antenna. </li><li>  In the house at the checkpoint: charging station and night storage of wearable trackers.  In the same place - a double of the dispatcher's console, receiving data through the Internet from a scud. </li></ul><br>  Next buns, that is, what we did not order, but that <s>can easily</s> be done as an option: <br><br><ol><li>  SOS signal from wearable and mobile trackers; </li><li>  Reception of radio call signals (up to 4 signal variants); </li><li>  Scanner to determine the direction of people falling asleep; </li><li>  Geomonitoring landslides on the sides of the quarry; </li><li>  Geomonitoring the edges of the career; </li><li>  Adaptive polling frequency (from 1 time per second to 1 time per minute) in the wearable tracker, depending on the possibility of collisions.  Including - while in the car; </li><li>  Router for the distribution of the Internet in the shelter house; </li><li>  Providing multiple operator workplaces by installing a data multiplier; </li><li>  Analysis of historical data (tracks and accidents). </li></ol><br>  What is behind the scenes?  The budget of the radio channel.  Here, first of all, studies on career are needed.  But one way or another, we will provide the connection.  And the connection of trackers among themselves and base stations with trackers and base stations among themselves.  At the very least, the base stations will transmit in a circle, every 3 seconds each.  And rovers - at every second.  This is due to the fact that there is a stream from the base station 25 times more than from the rover: coordinates of all 20 rovers + DGNSS corrections. <br><br>  <b>PS</b> As it happens in 80% of cases, the tender won the customer's own design bureau.  Well, yes, they are in Bryansk, their salaries are lower and office rent is cheaper.  Well, we are not mad.  A couple of days you can on an interesting project and work for free. <br><br>  <b>UPD1:</b> On a tip, <a href="https://habrahabr.ru/users/wicron/" class="user_link">Wicron clarifies</a> that the warning to both pedestrians and drivers is done by beeping (ringing) through a buzzer. <br><br>  <b>UPD2:</b> In the comments, it was noted many people who wanted to make a collision and collision avoidance system based on RFID.  Alas, we were not ordered a "collision warning system", we were ordered to <b><i>comply with paragraph 597 of the Federal rules and regulations in the field of industrial safety " <a href="http://base.garant.ru/70691622/">Safety rules for mining and processing solid minerals</a> "</i></b> .  A violation of these rules entails responsibility up to the criminal.  Speech on Article 216. " <a href="http://www.consultant.ru/document/Cons_doc_LAW_10699/5b1545ec2873bc6031c84b5c060c1c422e61c6f8/">Violation of safety rules in the conduct of mining, construction or other works</a> " <br><br>  Basic requirements of the rules: <br><br><ul><li>  continuous transfer of coordinates and speeds to the control tower with display of navigation parameters on the terminals of operators; </li><li>  3 meter positioning accuracy </li><li>  The personnel located at the mining site must be equipped with individual positioning tools with the continuous transfer of personnel location to the control room. </li><li>  The software should provide timely alarm and alert personnel about the danger of collisions, possible attacks, approaching danger zones, violations of technological parameters and modes of operation of mining and transport equipment. </li></ul><br>  The rules do not prohibit making the system on the basis of <a href="http://www.gaw.ru/html.cgi/txt/doc/Wireless/nanonet/index_loc.htm">radio equipment</a> , ultrasound, infrared sensors, but the transfer of information about the position must go throughout the entire area of ‚Äã‚Äãthe quarry.  This is about 2.5 to 1.5 kilometers. <br><br>  UPD3.  At the request of <a href="https://habrahabr.ru/users/theshock/" class="user_link">TheShock</a> I write more about the budget of the radio channel LoRa.  About the very <a href="https://geektimes.ru/company/unwds/blog/280198/">separation of channels in LoRa</a> I will not tell a lot, but it happens to be frequency, code, and temporary. <br><br>  The problem is this.  Each tracker transmits 37 bits: 23 bits of coordinates, 8 bits of speed, 1 bit - SOS button, 5 bits - tracker number.  The base station transmits the coordinates and speeds of all 20 trackers, that is, 620 bits + 30 bits of corrections DGNSS + 5 bits to the station number, a total of 655 bits.  If everyone is sitting on the same frequency channel, then only 2035 bits are transmitted.  Between transfers - protective gaps.  As a result, it will be necessary to transmit at speeds of the order of 7 kilobits, if not more.  But - the widest transmission band - 500 kilohertz. <br><br>  There is another option.  Each base station broadcasts on its own frequency.  Those receivers that are closer to it broadcast on the same frequency.  Then, on average, we have 37 * 7 + 655 = 914 bits, and at worst, 37 * 20 + 655 = 1295 bits.  But the receiver has a code for selecting a frequency channel, and for base stations, the second and third LoRa receiver to listen to each other's channels.  And the channels in this case are 125 or 250 kilohertz. <br><br>  There is another option.  Base stations operate on one channel, but each transmits 1 time in 3 seconds.  Then we will have 1295 bits. <br><br>  And which option is better - we will find out when we sign the contract, we get accurate topographic maps of the quarries and carry out a computer simulation of visibility with different placement of the towers.  More precisely we will not know. </div><p>Source: <a href="https://habr.com/ru/post/318894/">https://habr.com/ru/post/318894/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318880/index.html">Drawing vector graphics - triangulation, rasterization, anti-aliasing and new scenarios</a></li>
<li><a href="../318882/index.html">Launch Telegram bot on Android device (Remote Bot for Telegram)</a></li>
<li><a href="../318886/index.html">Comparison of signal recognition methods. Neural networks against matched filter</a></li>
<li><a href="../318890/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ243 (December 26 - January 1, 2017)</a></li>
<li><a href="../318892/index.html">Pebble for lazy programmers</a></li>
<li><a href="../318896/index.html">Truly live code reload in golang</a></li>
<li><a href="../318898/index.html">Simple XML Framework - we write API for working with diagrams DIA</a></li>
<li><a href="../318900/index.html">Sovereign Internet. Why it will not be in 2017</a></li>
<li><a href="../318904/index.html">How I uploaded base in GIT</a></li>
<li><a href="../318906/index.html">How IT professionals work. Anton Karpov, Head of Security at Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>