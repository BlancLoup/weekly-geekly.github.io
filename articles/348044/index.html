<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rook - "self-service" data store for Kubernetes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On January 29, the technical committee of CNCF (Cloud Native Computing Foundation), behind Kubernetes, Prometheus and other Open Source products from ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rook - "self-service" data store for Kubernetes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/9w/9-/7x/9w9-7xyjoy4lkpxya9qbeghmzpc.png"><br><br>  On January 29, the technical committee of CNCF (Cloud Native Computing Foundation), behind Kubernetes, Prometheus and other Open Source products from the world of containers and cloud native, <a href="https://www.cncf.io/blog/2018/01/29/cncf-host-rook-project-cloud-native-storage-capabilities/">announced</a> the adoption of the <b>Rook</b> project into its ranks.  An excellent opportunity to get to know this ‚ÄúKubernetes distributed data storage orchestrator‚Äù closer. <a name="habracut"></a><br><br><h2>  What kind of Rook? </h2><br>  <a href="https://rook.io/">Rook</a> is software written on Go ( <a href="https://github.com/rook/rook">distributed</a> under the free Apache License 2.0), designed to endow data warehouses with automated functions that make them <b>self-managing, self-scaling, and self-healing</b> .  For this, Rook automates (for data warehouses used in the Kubernetes environment): deployment, bootstrapping, configuration, provisioning, scaling, upgrades, migrations, disaster recovery, monitoring and resource management. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The project is in alpha stage and specializes in orchestrating Ceph distributed storage system in Kubernetes clusters.  The authors also announce plans to support other storage systems, but this will not happen in the next release. <br><br><h2>  Components and technical device </h2><br>  The basis of the work of Rook inside Kubernetes is a special operator <i>(we wrote more about Kubernetes Operators in <a href="https://habrahabr.ru/company/flant/blog/326414/">this article</a> )</i> automating the configuration of the repository and implementing its monitoring. <br><br>  So, <b>the Rook operator</b> is represented as a container that contains everything necessary for the deployment and subsequent maintenance of the repository.  Among the duties of the operator: <br><br><ul><li>  creating a DaemonSet for Ceph storage daemons <i>( <a href="http://docs.ceph.com/docs/master/man/8/ceph-osd/">ceph-osd</a> )</i> with a simple RADOS cluster; </li><li>  creation of Ceph monitoring pods <i>(with <a href="http://docs.ceph.com/docs/master/man/8/ceph-mon/">ceph-mon</a> , checking the cluster status; for the quorum, in most cases, three instances unfold, and if any of them fall, a new one rises)</i> ; </li><li>  CRDs ( <a href="https://kubernetes.io/docs/concepts/api-extension/custom-resources/">Custom Resource Definitions</a> ) management for the <a href="https://rook.github.io/docs/rook/master/cluster-crd.html">cluster</a> itself, <a href="https://rook.github.io/docs/rook/master/pool-crd.html">storage pools</a> , <a href="https://rook.github.io/docs/rook/master/object-store-crd.html">object stores</a> <i>(sets of resources and services for serving HTTP requests that perform PUT / GET for objects - they are compatible with S3 and Swift API)</i> , as well as <a href="https://rook.github.io/docs/rook/master/filesystem-crd.html">file systems</a> ; </li><li>  initialization of podov for start of all necessary services; </li><li>  creating agents Rook. </li></ul><br>  <b>Rook agents are</b> represented by separate decks that are deployed on each Kubernetes node.  The agent's purpose is to configure the <a href="">FlexVolume</a> plugin that provides support for storage volumes in Kubernetes.  The agent implements storage operation: connects network storage devices, mounts volumes, formats file system, etc. <br><br><img src="https://habrastorage.org/webt/ll/b8/1c/llb81ci6jv6jfxo1hudetkpcdeq.png"><br>  <i>The place and role of the Rook components in the general Kubernetes cluster scheme</i> <br><br>  Rook offers three types of storage: <br><br><ol><li>  <a href="https://rook.github.io/docs/rook/master/block.html">block</a> ( <b>Block</b> , <code>StorageClass</code> ) - mounts storage to a single hearth; </li><li>  <a href="https://rook.github.io/docs/rook/master/object.html">Object</a> ( <b>Object</b> , <code>ObjectStore</code> ) - available inside and outside the Kubernetes cluster (by S3 API); </li><li>  <b>Shared File System</b> ( <code>Filesystem</code> ) is a file system that can be mounted for reading and writing from a variety of pods. </li></ol><br>  The internal structure of the Rook includes: <br><br><ul><li>  <b>Mons</b> - pods for Ceph monitoring (with ceph-mon already mentioned); </li><li>  <b>OSDs</b> - pods with ceph-osd daemons (Object Storage Daemons); </li><li>  <b>MGR</b> - with <a href="http://docs.ceph.com/docs/master/mgr/">ceph-mgr</a> daemon (Ceph Manager), providing additional monitoring capabilities and interfaces for external systems (monitoring / control); </li><li>  <b>RGW</b> <i>(optional)</i> - pods with object storage; </li><li>  <b>MDS</b> <i>(optional)</i> - pods from a shared file system. </li></ul><br><br><img src="https://habrastorage.org/webt/qb/su/7j/qbsu7jt4qtrayeg5vg21-wilmrw.png"><br><br>  All Rook daemons (Mons, OSDs, MGR, RGW, MDS) are compiled into a single binary ( <code>rook</code> ) running in a container. <br><br>  <i>For a short presentation of the Rook project, this small (12 slides) <a href="https://www.slideshare.net/bassamtabbara/rook-cncfwgstorage">presentation</a> from Bassam Tabbara (CTO at Quantum Corp) can also be useful.</i> <br><br><h2>  Rook operation </h2><br>  The Rook operator fully supports Kubernetes version 1.6 and higher <i>(and, in part, the older release of K8s - 1.5.2)</i> .  Its <b>installation</b> in the <a href="https://rook.github.io/docs/rook/master/quickstart.html">simplest scenario</a> looks like this: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> cluster/examples/kubernetes kubectl create -f rook-operator.yaml kubectl create -f rook-cluster.yaml</code> </pre> <br>  In addition, <a href="">Helm chart has been</a> prepared for the Rook operator, thanks to which the installation can be carried out like this: <br><br><pre> <code class="bash hljs">helm repo add rook-alpha https://charts.rook.io/alpha helm install rook-alpha/rook</code> </pre> <br>  There are a small number <a href="">of configuration options</a> (for example, you can disable <a href="https://kubernetes.io/docs/admin/authorization/rbac/">RBAC</a> support if this feature is not used in your cluster), which are transferred to <code>helm install</code> via the parameter <code>--set key=value[,key=value]</code> (or stored in a separate YAML file , and transmit - via <code>-f values.yaml</code> ). <br><br>  After installing the Rook operator and running the sweepstakes with its agents, it remains to create the Rook cluster itself, the simplest configuration of which is as follows ( <code>rook-cluster.yaml</code> ): <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Namespace metadata: name: rook --- apiVersion: rook.io/v1alpha1 kind: Cluster metadata: name: rook namespace: rook spec: dataDirHostPath: /var/lib/rook storage: useAllNodes: true useAllDevices: false storeConfig: storeType: bluestore databaseSizeMB: 1024 journalSizeMB: 1024</code> </pre> <br><br>  <i><b>Note</b> : Special attention should be paid to the <code>dataDirHostPath</code> attribute, the correct value of which is necessary to save the cluster after reboots.</i>  <i>For cases of its use as a permanent storage location for Rook data on Kubernetes, the authors recommend to have at least 5 GB of free disk space in this directory.</i> <br><br>  It remains to actually create a cluster from the configuration and make sure that the subs were created in the cluster (in the <code>rook</code> namespace): <br><br><pre> <code class="bash hljs">kubectl create -f rook-cluster.yaml kubectl -n rook get pod NAME READY STATUS RESTARTS AGE rook-api-1511082791-7qs0m 1/1 Running 0 5m rook-ceph-mgr0-1279756402-wc4vt 1/1 Running 0 5m rook-ceph-mon0-jflt5 1/1 Running 0 6m rook-ceph-mon1-wkc8p 1/1 Running 0 6m rook-ceph-mon2-p31dj 1/1 Running 0 6m rook-ceph-osd-0h6nb 1/1 Running 0 5m</code> </pre> <br>  <b>An upgrade of the</b> Rook cluster (to the new version) is a procedure that at this stage requires a sequential update of all its components in a certain sequence, and it can be started only after you have verified that the current Rook installation is completely healthy.  Detailed step-by-step instructions on the example of updating Rook version 0.5.0 to 0.5.1 can be found in the <a href="https://rook.github.io/docs/rook/master/upgrade.html">project documentation</a> . <br><br>  Last November, a <b>performance</b> comparison with EBS <a href="https://blog.rook.io/run-your-own-high-performance-ebs-wherever-kubernetes-runs-798a136bd808">was published</a> on the Rook blog.  His results are worthy of attention, and if absolutely briefly, they are: <br><br><img src="https://habrastorage.org/webt/fi/fj/nk/fifjnk9ictxiyl7yf0ywyc56alk.png"><br><img src="https://habrastorage.org/webt/i-/hk/rc/i-hkrcqvtt5eewvk_vj53cu9rhk.png"><br><br><h2>  Perspectives </h2><br>  The current status of Rook is alpha, and the last major release to date is <a href=""><b>version 0.6</b></a> , released in November 2017 (the latest fix - <a href="">v0.6.2</a> - was released on December 14).  Already in the first half of 2018, releases of more mature versions are expected: beta and stable (officially ready for use in production). <br><br>  According to the <a href="">roadmap</a> project, developers have a detailed vision on the development of Rook in at least two upcoming releases: 0.7 (its readiness in the GitHub tracker <a href="https://github.com/rook/rook/milestones">is estimated</a> at 60%) and 0.8.  The expected changes include the transfer of Ceph Block and Ceph Object support to beta status, dynamic provisioning of volumes for CephFS, advanced logging system, automated cluster updates, support for snapshots for volumes. <br><br>  Accepting Rook in the number <a href="https://www.cncf.io/projects/">of CNCF projects</a> (at the very early stage, ‚Äúinception-level‚Äù, along with <a href="https://habrahabr.ru/company/flant/blog/327536/">linkerd</a> and <a href="https://habrahabr.ru/company/flant/blog/331872/">CoreDNS</a> ) is a kind of guarantee of growing interest in the product.  As far as it consolidates in the world of cloud applications, it will become better clear after the emergence of stable versions, which, of course, will bring Rook new "testers" and users. <br><br><h2>  PS </h2><br>  Read also in our blog: <br><br><ul><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/329666/">Create a permanent repository with Ceph based provisioning in Kubernetes</a> ‚Äù; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/326414/">Operators for Kubernetes: how to run stateful applications</a> ‚Äù; </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/331872/">CoreDNS - DNS server for the cloud native world and Service Discovery for Kubernetes</a> "; </li><li>  ‚Äú <a href="https://habrahabr.ru/company/flant/blog/329830/">Container Networking Interface (CNI) - network interface and standard for Linux containers</a> ‚Äù; </li><li>  " <a href="https://habrahabr.ru/company/flant/blog/341760/">Infrastructure with Kubernetes as an affordable service</a> ." </li></ul></div><p>Source: <a href="https://habr.com/ru/post/348044/">https://habr.com/ru/post/348044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348034/index.html">Meeting Room Little Helper</a></li>
<li><a href="../348036/index.html">Software sound synthesis on early personal computers. Part 1</a></li>
<li><a href="../348038/index.html">WSTester - JS library for testing web services with WebSocket</a></li>
<li><a href="../348040/index.html">How Atlassian has built a $ 10 billion business. Part 2</a></li>
<li><a href="../348042/index.html">Developing a PCI device driver for Linux</a></li>
<li><a href="../348046/index.html">What exactly is personal data?</a></li>
<li><a href="../348052/index.html">Top 5 Information Security Forecasts</a></li>
<li><a href="../348054/index.html">How we adapted the ELK stack to monitor and analyze errors in Java and .NET projects</a></li>
<li><a href="../348056/index.html">How I wrote the Java Olympics or why it is better not to use Scanner</a></li>
<li><a href="../348058/index.html">Free Tesla K80 GPU for your experiments with neural networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>