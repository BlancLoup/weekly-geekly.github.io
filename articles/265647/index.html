<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AMI. Versatile Originate. CTI application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Originate can be translated from English as "give rise to." The possibilities of the team are very broad and not all are obvious. Originate, among CTI...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AMI. Versatile Originate. CTI application</h1><div class="post__text post__text-html js-mediator-article">  Originate can be translated from English as "give rise to."  The possibilities of the team are very broad and not all are obvious.  Originate, among CTI application developers, is one of the most popular AMI teams.  More often it is used to initiate outgoing calls and organize call backs.  In this article, we will consider advanced features. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">AMI setup and telnet connection example</b> <div class="spoiler_text">  Set up an account in the <i>/etc/asterisk/manager.conf</i> file: <br><br><pre><code class="hljs pgsql">[general] enabled = yes port = <span class="hljs-number"><span class="hljs-number">5038</span></span> bindaddr = <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>cami] ; secret=PASSWORD1cami deny=<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> permit=<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> ;    . <span class="hljs-keyword"><span class="hljs-keyword">read</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>=originate</code> </pre> <br>  Next, in the Asterisk CLI, execute the command: <br><br><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reload</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">manager</span></span></span></span></code> </pre><br>  For connection we will use the telnet tools: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs objectivec">~ <span class="hljs-meta"><span class="hljs-meta"># telnet 127.0.0.1 5038 Asterisk Call Manager/1.2</span></span></code> </pre><br>  As soon as the ‚Äú <b>Asterisk Call Manager</b> ‚Äù prompt appears, you can enter commands.  The first command should be authorization. <br><br><pre> <code class="hljs pgsql">Action: <span class="hljs-keyword"><span class="hljs-keyword">Login</span></span> Username: <span class="hljs-number"><span class="hljs-number">1</span></span>cami Secret: PASSWORD1cami</code> </pre><br>  The end of the command is an empty line.  If successful, we get the answer: <br><br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Success Message: Authentication accepted</code> </pre><br></div></div><br><h2>  Baseline Originate Example </h2><br><div class="spoiler">  <b class="spoiler_title">AMI command parameter description</b> <div class="spoiler_text"><ul><li>  <b>Channel</b> - The name of the channel.  The format is type / identifier.  Type - channel type, depending on the used SIP / IAX2 / DAHDI driver </li><li>  <b>Context</b> - The name of the context to make the call.  Should be used with Exten and Priority parameters. </li><li>  <b>Exten</b> - phone number defined in the context context </li><li>  <b>Priority</b> - Priority, position in Context, from which call processing will begin </li><li>  <b>Timeout</b> - Timeout in milliseconds.  If the originator of the outgoing call did not answer, the call will be terminated. </li><li>  <b>CallerID</b> - the callerid value for the outgoing call.  The format "EmployeeName &lt;Telephone Number&gt;" </li><li>  <b>Variable</b> - setting variables for originated channels </li><li>  <b>Account</b> - Accauntcode field value for outgoing calls </li><li>  <b>Application</b> - dialplan command to be executed, used in conjunction with the ‚ÄúData‚Äù parameter </li><li>  <b>Async</b> - a sign of asynchronous command execution.  If set to ‚Äú1‚Äù, the result will be returned in an ‚ÄúEvent‚Äù type package with the name ‚ÄúOriginateResponse‚Äù <b>Data</b> - Dialplan command parameters </li><li>  <b>ActionID</b> is a request identifier, it is useful to use with several simultaneous asynchronous requests.  Allows you to match the result with the original request </li></ul><br><br>  "Event" response codes with the name "OriginateResponse" <br><ul><li>  <b>0</b> = Number not found in Context </li><li>  <b>1</b> = No answer </li><li>  <b>4</b> = Successful (answered) </li><li>  <b>8</b> = Overload or subscriber not available (congested or not available) </li></ul><br></div></div><br>  Consider initiating a call from SIP channel 104 to the number 74952293042 in the context of from-internal: <br><br><pre> <code class="hljs cs">Action: Originate Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span> Context: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> Exten: <span class="hljs-number"><span class="hljs-number">74952293042</span></span> Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> Callerid: <span class="hljs-number"><span class="hljs-number">104</span></span> Variable: SIPADDHEADER=<span class="hljs-string"><span class="hljs-string">"Call-Info:\;answer-after=0"</span></span></code> </pre><br>  As a result of this command, the internal telephone associated with the SIP / 104 channel will ring.  After lifting the handset, the call will go to the number 74952293042 in the from-internal context, priority 1. <br><br>  In some cases, it is convenient to combine an outgoing call with an <b>intercom</b> , to do this, use the Variable parameter. <br>  For Cisco, Linksys, Yealink and some softphones, setting the variable ‚Äú <b>SIPADDHEADER</b> ‚Äù to the value: " <b>Call-Info: \; answer-after = 0</b> " <br><br>  Suppose a Linksys telephone is used at the workplace.  As a result, Originate will trigger an automatic call answer on the phone connected to the SIP / 104 channel. <br><br><h2>  Call Pickup </h2><br>  Everyone has heard about the function of intercepting a call received by a nearby telephone. <br>  Usually the function is implemented by the "old code" <b>* 8</b> . <br><br>  To implement interception, the dialplan application can use <b>PickUp</b> or <b>PickupChan</b> , the network has quite a few examples of use. <br><br><h3>  How to organize this function using AMI? </h3><br>  To capture the call, you can use the Origin command.  She has two interesting parameters: <br><ul><li>  <b>Application</b> - the application to be started </li><li>  <b>Data</b> - application data </li></ul><br>  Let us describe an example of intercepting a call received on sip account 104: <br><br><pre> <code class="hljs sql">Action: Originate Channel: SIP/104 Application: PickupChan Data: SIP/104-0000003c Priority: 1 Callerid: 104 Variable: SIPADDHEADER="<span class="hljs-keyword"><span class="hljs-keyword">Call</span></span>-Info:\;answer-after=0"</code> </pre><br>  The peculiarity of this Originate is that there is no need to describe the ‚Äúcontext‚Äù parameter. <br><br>  But there is a need to track the channels that we can intercept.  In this example, the channel is described as ‚ÄúSIP / 104-0000003b‚Äù. <br><br>  You can track the appearance of new channels in the event " <b>Newstate</b> ", where " <b>ChannelState</b> " is set to <b>"5" (Ringing)</b> .  Below is an example event: <br><br><pre> <code class="hljs pgsql">Event: Newstate Privilege: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span><span class="hljs-number"><span class="hljs-number">-0000003</span></span>c ChannelState: <span class="hljs-number"><span class="hljs-number">5</span></span> ChannelStateDesc: Ringing CallerIDNum: <span class="hljs-number"><span class="hljs-number">104</span></span> CallerIDName: <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span> ConnectedLineNum: <span class="hljs-number"><span class="hljs-number">104</span></span> ConnectedLineName: Uniqueid: askozia<span class="hljs-number"><span class="hljs-number">-1438348824.146</span></span></code> </pre><br>  As soon as the event " <b>Newstate</b> " <b>arrives</b> , where " <b>ChannelState</b> " is set to <b>"6" (Up)</b> , the call has already been answered: <br><br><pre> <code class="hljs pgsql">Event: Newstate Privilege: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">all</span></span> Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span><span class="hljs-number"><span class="hljs-number">-0000003</span></span>c ChannelState: <span class="hljs-number"><span class="hljs-number">6</span></span> ChannelStateDesc: Up CallerIDNum: <span class="hljs-number"><span class="hljs-number">104</span></span> CallerIDName: <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span> ConnectedLineNum: <span class="hljs-number"><span class="hljs-number">104</span></span> ConnectedLineName: Uniqueid: askozia<span class="hljs-number"><span class="hljs-number">-1438348824.146</span></span></code> </pre><br>  The attentive reader will notice in the example of some nonsense: <br><br><pre> <code class="hljs">Action: Originate Channel: SIP/104 Application: PickupChan Data: SIP/104-0000003b</code> </pre><br>  There is no error.  The call is performed with the Channel SIP / 104, PickupChan is performed for the channel SIP / 104-0000003b.  That is, for your own channel. <br><br><h3>  I will comment on the example </h3><br>  We have launched this feature for everyday use.  An IP phone is installed in my workplace.  A headset is connected to the phone. <br><ol><li>  I receive an incoming call; </li><li>  I press the button ‚ÄúAnswer the call‚Äù in our CTI application; </li><li>  The originate example described above is executed; </li><li>  Thanks to the ‚ÄúSIPADDHEADER‚Äù installed, an auto-answer occurs; </li><li>  The phone makes an outgoing call and a pick-up call. </li></ol><br>  <b>Physically, I do not pick up the phone.</b>  I communicate with the client on the headset.  Hands free - profit on the face. <br><br><h2>  Listen to the recording of the conversation </h2><br>  In some cases, it is convenient to listen to the recording of a conversation from a telephone as a callback.  Our number 104 will receive a call.  When answered, we will hear a recording of the conversation. <br><br>  AMI Example: <br><br><pre> <code class="hljs pgsql">Action: Originate Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span> Application: Playback Data: /<span class="hljs-keyword"><span class="hljs-keyword">storage</span></span>/usbdisk1/test_file Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> Callerid: Playback Variable: SIPADDHEADER="Call-Info:\;answer-after=0"</code> </pre><br>  The application " <b>Playback</b> " is used, the full file name without the extension " <b>/ storage / usbdisk1 / test_file</b> " is transferred as data. <br><br><h2>  Overhear the conversation </h2><br>  For training new employees, we began to use an unusual approach.  Each intern can eavesdrop / listen to the conversations of his supervisor.  Due to this, the employee quickly begins to understand how to build a conversation with the client. <br>  In this case, we use the application " <b>ChanSpy</b> ": <br><br><pre> <code class="hljs perl">Action: Originate Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span> Application: ChanSpy Data: SIP/<span class="hljs-number"><span class="hljs-number">105</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">qx</span></span> Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> Callerid: Spy-<span class="hljs-number"><span class="hljs-number">105</span></span> &lt;<span class="hljs-number"><span class="hljs-number">105</span></span>&gt; Variable: SIPADDHEADER=<span class="hljs-string"><span class="hljs-string">"Call-Info:\;answer-after=0"</span></span></code> </pre><br><ul><li>  <b>q</b> - ‚Äúsilent mode‚Äù, joining the conversation is not announced in the conversation. </li></ul><br><br><h2>  Join the conversation </h2><br>  In some cases, the curator needs to join the conversation and ‚Äúget out‚Äù the situation.  In this case, use the following example: <br><br><pre> <code class="hljs vhdl">Action: Originate Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span> Application: ChanSpy Data: SIP/<span class="hljs-number"><span class="hljs-number">105</span></span>,qBx Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> Callerid: Spy-<span class="hljs-number"><span class="hljs-number">105</span></span> &lt;<span class="hljs-number"><span class="hljs-number">105</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">Variable</span></span>: SIPADDHEADER=<span class="hljs-string"><span class="hljs-string">"Call-Info:\;answer-after=0"</span></span></code> </pre><br><ul><li>  <b>B</b> - both channels can hear the joined subscriber </li></ul><br><br><h2>  Prompter mode </h2><br>  The curator can join the conversation and prompt the intern: <br><br><pre> <code class="hljs vhdl">Action: Originate Channel: SIP/<span class="hljs-number"><span class="hljs-number">104</span></span> Application: ChanSpy Data: SIP/<span class="hljs-number"><span class="hljs-number">105</span></span>,wx Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> Callerid: Spy-<span class="hljs-number"><span class="hljs-number">105</span></span> &lt;<span class="hljs-number"><span class="hljs-number">105</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">Variable</span></span>: SIPADDHEADER=<span class="hljs-string"><span class="hljs-string">"Call-Info:\;answer-after=0"</span></span></code> </pre><br><ul><li>  <b>w</b> - whisper mode, the joined subscriber will hear only the channel behind which we ‚Äúspy‚Äù </li></ul><br><br><h2>  Conclusion </h2><br>  The teams described fit perfectly into CTI applications and can significantly improve the usability and efficiency of employees. <br><br>  When developing, I recommend to pay attention to the <b>PAMI, NAMI and Shift8 projects</b> . <br><br>  I hope this article will help in understanding the work of the originate command, which will make your CTI applications more functional. </div><p>Source: <a href="https://habr.com/ru/post/265647/">https://habr.com/ru/post/265647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265633/index.html">Study: Which operating systems do IaaS provider clients use?</a></li>
<li><a href="../265635/index.html">Navigation in major projects for Vim and Emacs</a></li>
<li><a href="../265639/index.html">Application for replacing SMS and Email notifications on mobile devices</a></li>
<li><a href="../265641/index.html">Improved tab selection in the assembly Vivaldi 1.0.258.3</a></li>
<li><a href="../265645/index.html">Digest of useful materials for iOS developers</a></li>
<li><a href="../265649/index.html">Node.js and Express as they are</a></li>
<li><a href="../265651/index.html">Case "Visualization. What is the benefit for a retailer? ‚Äù</a></li>
<li><a href="../265653/index.html">3CX API - what are they and what to do with them? (Part 1)</a></li>
<li><a href="../265655/index.html">Thousand and one blister. Search for overpriced drugs</a></li>
<li><a href="../265657/index.html">Interview with the co-founder of the service to increase the conversion of mobile applications SplitMetrics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>