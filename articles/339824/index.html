<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configure two-factor authentication in VMware Horizon View 7 using JaCarta PKI smart cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, we talked about how to configure 2FA authentication based on the PKI infrastructure and x509 certificates in a Citrix virtual environment us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configure two-factor authentication in VMware Horizon View 7 using JaCarta PKI smart cards</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e1bdba3610812233.png"></div><br>  Recently, we <a href="https://habrahabr.ru/company/aladdinrd/blog/334322/">talked about</a> how to configure 2FA authentication based on the PKI infrastructure and x509 certificates in a Citrix virtual environment using the JaCarta PKI electronic keys.  Today we will talk about the closest "friend" of Citrix XenDesktop in the field of delivering virtual desktops and applications - VMware Horizon View. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e1ae2ff417774006.jpeg"></div><br><a name="habracut"></a><br><h2>  How it works? </h2><br>  In simple terms, you can imagine just such a scheme. <br><br><div style="text-align:center;"><img width="500" hspace="5" src="https://habrastorage.org/webt/59/dd/bb/59ddbb0687c17823214516.png"></div><br>  Two-factor authentication in a VDI session using a JaCarta PKI consists of the following steps: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  the user presents a token (the first factor is possession of the device) and enters a PIN code (the second factor is knowledge of the PIN code); <br></li><li>  the server is checking the user credentials; <br></li><li>  the user gets a desktop \ application or denial of service. </li></ol><br>  The reasons for ‚Äúmaking friends‚Äù of VMware Horizon View with electronic keys, however, like any introduction of 2FA, have a number of advantages in comparison with classical password authentication.  First of all, this is a general increase in the level of security that occurs due to the rejection of passwords and the transition to strong authentication using the second authentication factor.  We will not dwell on this in detail, there are enough articles, and even whole books on the topic.  Secondly, since authentication by tokens or smart cards is implemented, they can and should be used already within the VDI session.  For example, for electronic signature in various scenarios and programs, for access to various web-applications, for electronic document management systems and remote banking services.  It is possible to use both Western crypto algorithms and the national GOST.  Additional benefits include the fact that the same card can be used for authentication, signature and access to the premises (if there is an RFID tag).  In this case, there are options for customization - the application of the logo and corporate identity.  And as part of the specials.  projects there is the possibility of implementing payment applications on the same cards (Mir, MasterCard, Visa). <br><br><h2>  Introductory </h2><br>  It is assumed that the public key infrastructure is already deployed within Windows Server (version is not important) with the role Active Directory Certificate Services.  VDI is deployed as part of VMware Horizon View 7 (working with 6.x and c 5.x) and is configured for simple password authentication.  Another condition is that users have JaCarta electronic keys with digital certificates issued by MSCA. <br><br>  The client is any PC, thin client, laptop with VMware Horizon Client installed. <br><br><h2>  Customization </h2><br>  All configuration is reduced to configuring certificates and enabling the certificate authentication option on the horizon view server. <br><br><h2>  Export Root Certificate </h2><br>  Open the <b>Certification Authority</b> snap-in on the root CA by running the <b>certsrv.msc</b> command <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e22979d867170566.png"></div><br>  Open the <b>Certification Authority -&gt; CA Name -&gt; Properties</b> window <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e23a301057332124.png"></div><br>  On the <b>General</b> tab, select the root certificate and click the <b>View Certificate</b> button. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e2661c0215884011.png"></div><br>  Click the <b>Details</b> tab and click the <b>Copy to File</b> button. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e27e7ac684660043.png"></div><br>  On the file format selection page, select <b>Base-64 encoded X.509 (.CER)</b> <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e2cea9c122456044.png"></div><br>  Specify the path to export the file, for example, <b>C: \ temp \ RootCA.cer</b> <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e2a96fc363097888.png"></div><br><br><h2>  Creating a JKS key container file </h2><br>  On the <b>VMware Horizon View</b> server, open a command prompt and navigate to the directory with the <b>keytool.exe</b> utility (C: \ Program Files \ VMware \ VMware View \ Server \ jre \ bin). <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e2c9af7897516791.png"></div><br>  Import the root certificate into the storage file using the <b>keytool -import -alias alias -file root_certificate -keystore truststorefile.key command</b> , where alias is the alias (any value), root_certificate is the full path to the certificate file, truststorefile.key is the name of the storage file . <br><br>  During the import process, you will need to enter a password phrase to protect the repository and confirm trust in the certificate. <br><br><div style="text-align:center;"><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e2f2c4b522817521.png"></div><br>  The storage <b>file truststorefile.key</b> must be copied to the SSL Gateway directory: <br>  install_directory \ VMware \ VMware View \ Server \ sslgateway \ conf \ truststorefile.key <br><br>  In the SSL Gateway directory (install_directory \ VMware \ VMware View \ Server \ sslgateway \ conf \ locked.properties), you must create a file named <b>locked.properties</b> and edit it (for example, in notepad) before the following content: <br><br><pre><code class="cpp hljs">trustKeyfile= truststorefile.key trustStoretype=JKS useCertAuth=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  Save the file and restart the <b>View Connection Server service</b> . <br><br><h2>  Certificate Login Setup </h2><br>  Access the VMware Horizon View web console. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e30ecc9853544581.png"></a> </div><br>  Go to server properties: <b>Inventory ‚Üí View Configuration ‚Üí Servers ‚Üí Connections Servers ‚Üí Edit</b> . <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e380651024816765.png"></a> </div><br>  Go to the <b>Authentication</b> tab and select your preferred authentication mode. <br><br>  Authentication to the administrative console using a smart card is configured from the drop-down list <b>Smart card authentication for administrators</b> : <br><br><ul><li>  <b>Not Allowed</b> - do not use a smart card; <br></li><li>  <b>Optional</b> ‚Äî mixed authentication ‚Äî either by password or by smart card; <br></li><li>  <b>Required</b> - mandatory use of a smart card. </li></ul><br>  User authentication in VDI with a smart card is configured from the <b>Smart card authentication for users</b> drop-down list: <br><br><ul><li>  <b>Not Allowed</b> - do not use a smart card; <br></li><li>  <b>Optional</b> ‚Äî mixed authentication ‚Äî either by password or smart card; <br></li><li>  <b>Required</b> - mandatory use of a smart card. </li></ul><br>  The <b>Disconnect user sessions on smart card removal</b> option defines a policy when a <b>smart card</b> is disabled.  Check the box if you need to disconnect the session when removing the smart card. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e3a3fd9670409716.png"></a> </div><br>  Click <b>OK</b> . <br><br><h2>  Configuring user smart card forwarding </h2><br>  Allowing a user's smart card allows transparent authentication to a virtual machine with a PIN entered once. <br><br>  When using Teradici thin clients, configuration is usually not required. <br><br>  When using Windows, MacOS, Linux software clients, you must install the VMware View Agent with the Smartcard Redirection option activated. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e3b9a36107929693.png"></a> </div><br><br><h2>  Check </h2><br>  To verify, we will log in to the Horizon View administration console and to the virtual desktop. <br><br><h2>  Login to admin console </h2><br>  Insert the smart card and go to the administration console. <br><br>  In the login form window that appears, select the administrator certificate and click <b>OK</b> . <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e3ce223664520131.png"></a> </div><br>  You will be prompted to enter a PIN code.  After successful verification of the PIN, authentication will be made to the web interface. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e3e0713669517519.png"></a> </div><br><br><h2>  Login to virtual desktop </h2><br>  On the client device, launch the VMware Horizon Client and select the required connection. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e406559542976634.png"></a> </div><br>  You will be prompted to enter a PIN code. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e412367448577089.png"></a> </div><br>  After successful authentication, the available resources are displayed. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e42a683210808805.png"></a> </div><br>  Well, let's make sure that the smart card has been forwarded to the delivered desktop. <br><br><div style="text-align:center;"> <a href=""><img width="300" hspace="5" src="https://habrastorage.org/webt/59/dc/d9/59dcd9e49996d576860487.png"></a> </div><br>  That's all. </div><p>Source: <a href="https://habr.com/ru/post/339824/">https://habr.com/ru/post/339824/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339814/index.html">DevOps history</a></li>
<li><a href="../339816/index.html">Review of music software code defects. Part 2. Audacity</a></li>
<li><a href="../339818/index.html">"Best Practices" for building a relationship between the humanities manager and developers</a></li>
<li><a href="../339820/index.html">20 working methods on the Linux command line, which will save a lot of time</a></li>
<li><a href="../339822/index.html">The most successful ICOs in their entire history</a></li>
<li><a href="../339826/index.html">AMA, or ask the Avito backend: an announcement</a></li>
<li><a href="../339828/index.html">Kali Linux: research formalization and attack types</a></li>
<li><a href="../339830/index.html">How to offer your game to YouTube / streamer</a></li>
<li><a href="../339832/index.html">Intel introduced the first 17-qubit quantum chip</a></li>
<li><a href="../339834/index.html">Who left: three stories of alumni of the HeadHunter School of Programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>