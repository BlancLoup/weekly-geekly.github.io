<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio: analyze the code of the ReactOS operating system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having checked the ReactOS code, I was able to fulfill three of my desires at once. First, I have long wanted to write an article about an ordinary pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio: analyze the code of the ReactOS operating system</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/06e/005/d1a/06e005d1a29ce0c46fc523d93d5e96e6.png" alt="PVS-Studio vs ReactOS"><br>  Having checked the ReactOS code, I was able to fulfill three of my desires at once.  First, I have long wanted to write an article about an ordinary project.  It is not interesting to check the code of such projects as Chromium.  It is too high quality and, in order to maintain this quality, resources that are not available in ordinary projects are spent.  Secondly, there was a good example where you can show how static analysis is needed in a large project, especially if it is developed by a heterogeneous distributed team.  Thirdly, I received confirmation that PVS-Studio is getting better and more useful. <br><a name="habracut"></a><br><h2>  PVS-Studio is getting better and better </h2><br>  I will start from the last moment, regarding the usefulness of the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> tool.  ReactOS indirectly confirms that PVS-Studio is developing in the right direction.  Here's the news about testing ReactOS with a heavyweight like Coverity - ‚ÄúStatic Analysis in Coverity‚Äù [ <a href="http://www.viva64.com/go.php%3Furl%3D722">1</a> ].  I, of course, know and understand that Coverity‚Äôs possibilities are far from us.  But, nevertheless, where, thanks to Coverity, ‚Äúseveral new mistakes were found‚Äù, PVS-Studio finds them a whole car and a small cart.  At the same time, no code should be sent anywhere.  You can just take and check the project.  So we are on the right track. <br><br><h2>  What is ReactOS? </h2><br>  ReactOS is a modern, free and open operating system based on the Windows XP / 2003 architecture.  The system was written from scratch and has as its goal the repetition of the Windows-NT architecture created by Microsoft, from the hardware to the application layer.  The source code for C, C ++ and assembler is about 220 megabytes. <br><br>  Various links: <br><ul><li>  <a href="http://www.viva64.com/go.php%3Furl%3D717">Official site of the project ReactOS</a> . </li><li>  <a href="http://www.viva64.com/go.php%3Furl%3D718">How to participate in the development of ReactOS</a> . </li><li>  Wikipedia.  <a href="http://www.viva64.com/go.php%3Furl%3D719">ReactOS</a> . </li><li>  An article in Computerra.  <a href="http://www.viva64.com/go.php%3Furl%3D720">ReactOS: catch up and overtake</a> . </li><li>  Lurkmore.  <a href="http://www.viva64.com/go.php%3Furl%3D721">ReactOS</a> . </li></ul><br><h2>  Errors in ReactOS </h2><br>  Now let's talk about the carriage of errors that I encountered in the ReactOS code.  Of course, they all will not enter the article.  <a href="http://www.viva64.com/external-pictures/txt/PVS-Studio-vs-ReactOS-ru-unicode.txt">Here</a> I posted a text file with a description of the errors that I noticed during the analysis.  The file contains diagnostic messages with file names and line numbers.  I also highlighted the errors in the short code and made some comments.  Therefore, those who want to make edits in ReactOS are better guided by this file, and not by the article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Better yet, download and test the project yourself using PVS-Studio.  After all, I am not familiar with the project and wrote out only those errors that are clear to me.  For many code fragments, I don‚Äôt know if they contain errors or not.  So my analysis is rather superficial.  The key to check out select. <br><br>  Errors that can be found in ReactOS various.  Just a zoo.  There are typos of one character. <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOL WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMenuItemInfoA</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ ... mii-&gt;cch = mii-&gt;cch; ... }</code> </pre> <br>  In fact, it should be written like this: "mii-&gt; cch = miiW-&gt; cch;".  Lost the letter 'W'.  As a result, programs can no longer trust the function GetMenuItemInfoA. <br><br>  And here is another typo in one character.  This time the comparison of two names does not work correctly. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> _Stl_loc_combine_names(_Locale_impl* L, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* name1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* name2, locale::category c) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((c &amp; locale::all) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(name1, name1) == <span class="hljs-number"><span class="hljs-number">0</span></span>) ... }</code> </pre> <br>  There is confusion between the &amp;&amp; and &amp; operator.  A very common mistake.  I meet in almost every project where they work with bits or file attributes. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LRESULT APIENTRY </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ACEditSubclassProc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((This-&gt;options &amp;&amp; ACO_AUTOSUGGEST) &amp;&amp; ((HWND)wParam != This-&gt;hwndListBox)) ... }</code> </pre> <br>  The correct code should look like this "(This-&gt; options &amp; ACO_AUTOSUGGEST)".  The example below contains a related error, due to which the entire condition is always false. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adns__querysend_tcp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(adns_query qu, struct timeval now)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(errno == EAGAIN || EWOULDBLOCK || errno == EINTR || errno == ENOSPC || errno == ENOBUFS || errno == ENOMEM)) { ... }</code> </pre> <br>  If you look closely, you can see the insidious fragment: "|| EWOULDBLOCK ||". <br><br>  By the way, in ReactOS there were many conditions that are always true or false.  Some are not scary, because, for example, they are located in the assert () macro.  But there are, in my opinion, critical ones. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">INT WSAAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IN SOCKET s, IN CONST struct sockaddr *name, IN INT namelen)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">/* Check if error code was due to the host not being found */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Status == SOCKET_ERROR) &amp;&amp; (ErrorCode == WSAEHOSTUNREACH) &amp;&amp; (ErrorCode == WSAENETUNREACH)) { ... }</code> </pre> <br>  Agree that the implementation of such functions as ‚Äúconnect‚Äù should be tested as fully as possible.  And here we have a condition that is always false.  It is not so easy to quickly notice a defect, so I will highlight the essence of the error: <br><pre> <code class="cpp hljs">(ErrorCode == <span class="hljs-number"><span class="hljs-number">10065</span></span>) &amp;&amp; (ErrorCode == <span class="hljs-number"><span class="hljs-number">10051</span></span>)</code> </pre> <br>  By the way, the part related to sockets generally looks raw.  Perhaps this is due to the fact that in the Linux world, SOCKET is usually declared as a signed type.  And in Windows it is unsigned: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> UINT_PTR SOCKET;</code> </pre> <br>  As a result, we have various errors in comparison operations: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adns_finish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(adns_state ads)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ads-&gt;tcpsocket &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) adns_socket_close(ads-&gt;tcpsocket); ... }</code> </pre> <br>  The expression "ads-&gt; tcpsocket&gt; = 0" does not make sense, since it is always true. <br><br>  There are just strange fragments.  Most likely, these are unfinished and forgotten sections of code. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ERROR_SUCCESS == hres) { Names[count] = HeapAlloc(GetProcessHeap(), <span class="hljs-number"><span class="hljs-number">0</span></span>, strlenW(szValue) + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Names[count]) strcmpW(Names[count], szValue); }</code> </pre> <br>  Why call "strcmpW" if the result is not used in any way? <br><br>  There are errors associated with the priority of operations. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">VOID NTAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AtapiDmaInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ ... ULONG treg = <span class="hljs-number"><span class="hljs-number">0x54</span></span> + (dev &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) ? (dev &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) : <span class="hljs-number"><span class="hljs-number">7</span></span>; ... }</code> </pre> <br>  I will place brackets to make it clear how this expression actually works: <br><pre> <code class="cpp hljs">ULONG treg = (<span class="hljs-number"><span class="hljs-number">0x54</span></span> + (dev &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>)) ? (dev &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) : <span class="hljs-number"><span class="hljs-number">7</span></span>;</code> </pre> <br>  The following error is definitely found in any large project.  There are a couple in ReactOS.  This is an extra semicolon - ';'. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOLEAN </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CTEScheduleEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PCTE_DELAYED_EVENT Event, PVOID Context)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Event-&gt;Queued); { Event-&gt;Queued = TRUE; Event-&gt;Context = Context; ExQueueWorkItem(&amp;Event-&gt;WorkItem, CriticalWorkQueue); } ... }</code> </pre> <br>  I also like errors with the initialization of array elements.  I do not know why.  They are touching.  Perhaps I recall my first experiments with arrays in the Basic language. <br><pre> <code class="cpp hljs">HPALETTE CardWindow::CreateCardPalette() { ... <span class="hljs-comment"><span class="hljs-comment">//include button text colours cols[0] = RGB(0, 0, 0); cols[1] = RGB(255, 255, 255); //include the base background colour cols[1] = crBackgnd; //include the standard button colours... cols[3] = CardButton::GetHighlight(crBackgnd); cols[4] = CardButton::GetShadow(crBackgnd); ... }</span></span></code> </pre> <br>  You can continue to bring different interesting parts of the code.  Unfortunately, then the article will become too long and you need to stop.  Let me remind you that you can look at the other errors that I found in ReactOS in this <a href="http://www.viva64.com/external-pictures/txt/PVS-Studio-vs-ReactOS-ru-unicode.txt">file</a> .  I'll just bring this piece of code for sweets: <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SWAP(a,b,c) c = a;\ a = b;\ a = c</span></span></code> </pre> <br>  Example of use: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOL FASTCALL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IntEngGradientFillTriangle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ ... SWAP(v2,v3,t); ... }</code> </pre> <br>  It is a masterpiece. <br><br><h2>  Static code analysis </h2><br>  I consider ReactOS a very good example of a project where regular static code analysis is essential.  And it's not about the qualifications of the developers.  The project is large and contains a variety of subsystems.  This means that a large number of people always work on such a project.  And in a large team, someone always programs worse, someone better.  Someone uses one style, someone else.  But no one is immune from mistakes.  Look here. <br><br>  One person picked up and wrote to ReactOS like this: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((res = setsockopt(....) == <span class="hljs-number"><span class="hljs-number">-1</span></span>))</code> </pre> <br>  The code does not do what it wants.  The correct option: if ((res = setsockopt (....)) == -1).  If you follow the practice of writing a constant at the beginning, you will never accidentally make an erroneous assignment inside an if statement.  We have a different type of error here.  But if you write code according to the above rule, you will not be able to make a mistake in the expression under consideration: "if (-1 == res = setsockopt (....))". <br><br>  But the knowledge of this practice does not prevent another person from making a mistake in an alternative way. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> DWORD CALLBACK </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegistrationProc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LPVOID Parameter)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> == LoadStringW(hDllInstance, IDS_UNKNOWN_ERROR, UnknownError, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(UnknownError) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(UnknownError[<span class="hljs-number"><span class="hljs-number">0</span></span>] - <span class="hljs-number"><span class="hljs-number">20</span></span>))) ... }</code> </pre> <br>  Here, the constant 0 is beautifully written at first. The only thing is that the parenthesis is not closed where it should be.  Common typo. <br><br>  Why do I have all these examples?  And the fact that none of us programmers are perfect.  And neither the coding standard, nor the programming technology, nor the self-control guarantee the absence of errors in the code. <br><br>  In large projects, assistive technologies such as dynamic and static analysis are simply needed.  I emphasize: <br><br>  <b>I believe that static code analysis should be a mandatory element of the development cycle of ReactOS and other large projects.</b> <br><br>  I will explain my statement.  In such systems, it is impossible to approach 100% of the code coverage when testing using unit tests or regression tests.  I will clarify a little.  Of course you can, but the costs of creating and maintaining such tests become unacceptably high. <br><br>  The reason is that the number of possible system states and the possible ways of executing the code branches are very large.  Some branches rarely get control, but that does not make them unnecessary.  It is here that it turns out to see the advantage that static analysis has.  It checks the entire code, regardless of how often it gets control in the course of the program. <br><br>  An example of checking code that rarely receives control: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HRESULT STDMETHODCALLTYPE </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CBindStatusCallback_OnProgress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (This-&gt;szMimeType[<span class="hljs-number"><span class="hljs-number">0</span></span>] != _T(<span class="hljs-string"><span class="hljs-string">'\0'</span></span>)) _tprintf(_T(<span class="hljs-string"><span class="hljs-string">"Length: %I64u [%s]\n"</span></span>), This-&gt;Size, This-&gt;szMimeType); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> _tprintf(_T(<span class="hljs-string"><span class="hljs-string">"Length: %ull\n"</span></span>), This-&gt;Size); ... }</code> </pre> <br>  Most likely, the code was originally written incorrectly.  Then someone noticed that the message was formed incorrectly and made a correction by writing "% I64u".  But he did not pay attention to the code in the neighborhood.  And there is still an incorrect format "% ull".  Apparently the branch is called extremely rarely.  Static analysis will not miss this.  Actually, he did not miss it, since I can demonstrate this example. <br><br>  Another good example is the large number of memory cleanup errors that I saw ReactOS.  Why so many of them, I understand.  No one is testing whether the memory is full or not.  Firstly, it is difficult to realize that in these simple places you can make a mistake.  And secondly, it is not so easy to check whether some temporary buffer was cleared inside the function or not.  Here, static analysis is again at altitude.  I will give only a couple of examples.  In fact, I counted at least 13 errors of filling arrays with a constant value. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MEMSET_BZERO(p,l) memset((p), 0, (l)) char *SHA384_End(SHA384_CTX* context, char buffer[]) { ... MEMSET_BZERO(context, sizeof(context)); ... }</span></span></code> </pre> <br>  We only clear the first bytes of the array, since sizeof (context) returns the pointer size, not the structure. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RtlFillMemory(Destination, Length, Fill) \ memset(Destination, Fill, Length) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> IOPM_FULL_SIZE 8196 HalpRestoreIopm(VOID) { ... RtlFillMemory(HalpSavedIoMap, 0xFF, IOPM_FULL_SIZE); ... }</span></span></code> </pre> <br>  Arguments are confused when using the RtlFillMemory macro.  The call should be like this: <br><pre> <code class="cpp hljs">RtlFillMemory(HalpSavedIoMap, IOPM_FULL_SIZE, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>);</code> </pre> <br><h2>  Tabs and spaces again </h2><br>  <i>I want to ask in advance not to start a new heated discussion on this topic in the comments.</i>  <i>I'll just give my opinion.</i>  <i>You can agree with him or not.</i>  <i>But it is not worth discussing.</i> <br><br>  There are two irreconcilable camps.  Some use tabs in the code, as this allows you to adjust the display of the code for themselves [ <a href="http://www.viva64.com/go.php%3Furl%3D725">2</a> ].  Others say that it still does not work and that there is no reasonable reason to use tabs.  From tabbing only mischief and driving about formatting.  I am one of them [ <a href="http://www.viva64.com/go.php%3Furl%3D726">3</a> ]. <br><br>  One may say that the tabulation should be used correctly and then everything will be fine.  Unfortunately, it is said by those who work on one project and are not confronted with the outside world.  In any open or just a large project, it is not possible to achieve normal code design, if you allow tabs to be used in any form. <br><br>  I will not engage in abstract reasoning.  This time I‚Äôll just give my opponents a good example.  Now such an example would be ReactOS code. <br><br>  The ReactOS coding standard [ <a href="http://www.viva64.com/go.php%3Furl%3D724">4</a> ] says a good rule from a theoretical point of view: <br>  <b>Generic note about TABs usage: Don't use TABs for formatting;</b>  <b>use TABs for indenting only and use only spaces for formatting.</b> <br><pre> Example: 
 NTSTATUS
 SomeApi (IN Type Param1,
 [spaces] IN Type Param2)
 {
 [TAB] ULONG MyVar;
 [TAB] MyVar = 0;
 [TAB] if ((MyVar == 3) &amp;&amp;
 [TAB] [sp] (Param1 == TRUE))
 [TAB] {
 [TAB] [TAB] CallSomeFunc ();
 ... </pre><br>  Tab fans are happy.  However, I open the source codes of ReactOS and observe corrupted formatting in many places.  Why? <br><img src="https://habrastorage.org/getpro/habr/post_images/ead/b5f/0db/eadb5f0dbbd404583c9aad0e7a513a72.png" alt="Tabs vs Spaces 1"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2de/2dc/7ee/2de2dc7ee166e5756bf46343671840f9.png" alt="Tabs vs Spaces 2"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e6/052/177/1e6052177a1ec4d3f427f798a71e1803.png" alt="Tabs vs Spaces 3"><br>  The answer is of course obvious.  Because it is difficult to remember where to press TAB, and where to put some spaces, if this is not the only project you are working with.  Here people are constantly wrong.  And if so, there is nothing to be theorists, but you have to be practitioners.  We must take and prohibit the use of tabs in general.  And then everything will be the same for everyone, and the culprit who begins to use tabulation is easy to find and make him a suggestion. <br><br>  This is not a step back in the design of the code!  This is a step forward!  This is the next level of awareness.  The theoretical beauty of customizable indentation is not combined with practice.  First of all, it is important to provide a clear view of the code and ease of development in a large team.  Google understands this.  And in their standard for formatting only spaces are used [ <a href="http://www.viva64.com/go.php%3Furl%3D679">5</a> ].  To those who advocate the use of tabulation, I once again recommend thinking about why the distributed team of high-class professionals who develop Chromium chose exactly the gaps. <br><br>  Once again.  The theoretical beauty of customizable indentation is not combined with practice.  No matter how beautiful the theory sounds, if it doesn't work.  That is exactly what happens in ReactOS. <br><br>  I recommend the team developing ReactOS to modify their standard and stop using tabulation.  Any tabulation should be regarded as an error and be eliminated from the code. <br><br>  By the way, this practice will make it possible to find such ugliness in ReactOS code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOLEAN </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">KdInitSystem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(IN ULONG BootPhase, IN PLOADER_PARAMETER_BLOCK LoaderBlock)</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">/* Check if this is a comma, a space or a tab */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((*DebugOptionEnd == <span class="hljs-string"><span class="hljs-string">','</span></span>) || (*DebugOptionEnd == <span class="hljs-string"><span class="hljs-string">' '</span></span>) || (*DebugOptionEnd == <span class="hljs-string"><span class="hljs-string">' '</span></span>)) ... }</code> </pre> <br>  The last comparison is a comparison with the tab character and not with a space, as it may seem.  Normal code should look like this: "(* DebugOptionEnd == '\ t')". <br><br>  <b>Note for tabs.</b>  I don‚Äôt need to tell me again how to use tabs correctly.  And this is not my code.  Look, there is a very specific ReactOS project.  It has poorly formatted code.  Think what actions will allow the new programmer to open the project code and not guess what size of the tab character he needs to set in the editor settings.  Thoughts in the spirit of ‚Äúit was necessary to immediately write correctly‚Äù have no practical value. <br><br><h2>  Bibliographic list </h2><br><ol><li>  ReactOS N79 news release.  Static analysis in Coverity.  <a href="http://www.viva64.com/go.php%3Furl%3D722">http://www.viva64.com/go.php?url=722</a> </li><li>  It's time to start using spaces instead of tabs in the code.  <a href="http://www.viva64.com/go.php%3Furl%3D725">http://www.viva64.com/go.php?url=725</a> </li><li>  It's time to tie tabs to code.  <a href="http://www.viva64.com/go.php%3Furl%3D726">http://www.viva64.com/go.php?url=726</a> </li><li>  ReactOS.  Coding Style.  <a href="http://www.viva64.com/go.php%3Furl%3D724">http://www.viva64.com/go.php?url=724</a> </li><li>  Google C ++ Style Guide.  <a href="http://www.viva64.com/go.php%3Furl%3D679">http://www.viva64.com/go.php?url=679</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/127493/">https://habr.com/ru/post/127493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127487/index.html">How to trees on jQuery</a></li>
<li><a href="../127488/index.html">Internet banking on Android from Bank24.ru</a></li>
<li><a href="../127489/index.html">SMS-Banking and Mobile Internet Banking</a></li>
<li><a href="../127491/index.html">ArBB, Cilk +, OpenMP, OpenCL, TBB - Knowledge Day or Election Day</a></li>
<li><a href="../127492/index.html">A new version of the NuGet 1.5 batch manager has been released.</a></li>
<li><a href="../127494/index.html">New details about Poulson</a></li>
<li><a href="../127496/index.html">Alternativa3D 8.12.0 next version with support for Flash Player 11 Beta 2</a></li>
<li><a href="../127497/index.html">Free webinar for e-book developer Vladimir Levchenko</a></li>
<li><a href="../127498/index.html">Kernel.org has been infected for 17 days</a></li>
<li><a href="../127499/index.html">SPB Shell 3D for Symbian released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>