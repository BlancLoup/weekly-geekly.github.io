<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Formation of tournament tables, stored procedures SQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day I read a post about the automated formation of football championships and decided to share my solution to this problem, which I used for...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Formation of tournament tables, stored procedures SQL</h1><div class="post__text post__text-html js-mediator-article">  The other day I read a post about the <a href="http://habrahabr.ru/post/167539/">automated formation of football championships</a> and decided to share my solution to this problem, which I used for a small game.  The implementation of the draw is not a standard approach, using MS SQL Server stored procedures. <br><br>  As a result, I got the database structure and stored procedures that allow you to create a table of games between the teams (to draw) and process the results of the championship.  All scripts can be <a href="https://github.com/creativ/FootballTournament">downloaded from the repository on github</a> . <br><br><h4>  Championship game table </h4><br>  The main stored procedure is the procedure for forming championship games between teams.  When forming, I adhered to the basic rules of the tournament: <br><ul><li>  The number of teams participating in the tournament must be even; </li><li>  Each team must play on the other 2 times - in their own stadium and in the stadium of rivals; </li><li>  In the same round, the same team can play only once; </li><li>  For winning the match, the team gets 2 points, for a draw, 1 point, and for losing, respectively - 0. </li></ul><br>  Let's consider step by step the algorithm for forming the table of games.  I will try to describe the logic in detail, not boring and with a demonstration of the schemes.  As an example, let's take the championship in which 4 teams participate, although the algorithm can work with any even number of teams.  Conventionally, let's denote our teams as 1, 2, 3, and 4, which in my implementation are their direct IDs. <br><a name="habracut"></a><br>  The first thing that needed to be done was to calculate the number of championship tournaments and form pairs of teams for games.  The number of tournaments depends on the number of teams, since one team with another can play in one round only once and it should not play with itself.  This is calculated by the formula: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="sql hljs">@TournamentsCnt = (@TeamsCnt * (@TeamsCnt - 1) * 2) / @TeamsCnt</code> </pre> <br><img align="right" src="https://habrastorage.org/storage2/e3a/f12/452/e3af124521c63541d1ad634bde5a3372.png"><br>  After that we form a list of pairs of teams for all games of the championship.  For this we can assume that we have 2 lists with identical numbers of all the teams of the championship. <br><br clear="all"><img align="right" src="https://habrastorage.org/storage2/e3a/857/f9f/e3a857f9f6b29f5b98622200a1ac8996.png"><br>  Each team of the first list must play with each team of the second list once, excluding the team with the same number (itself).  As a result, we get a list of pairs of championship teams of the next type. <br><br clear="all"><img align="right" src="https://habrastorage.org/storage2/abb/b9a/369/abbb9a369e054b599e06158774eff7aa.png"><br>  After we received a list of pairs of teams, we need to distribute them around the tour without forgetting about the condition: one team can play only once per round and two teams can play only twice with each other for the championship at home and guest stadiums. <br><br>  The number of games that occur in one round are equal to the total number of championship teams.  For the formation of the tour, the very first pair of teams is taken from the previously formed list, the numbers of the teams are written into the game of the tour and into a temporary array, and are removed from the list of pairs of teams.  The same logic will be used to form the remaining games of the tour, only now pairs of teams that have numbers in the temporary array will be skipped, so two identical teams will not be able to play in one round, but none of the teams will remain idle.  Upon completion, the temporary array is cleared and this algorithm will be repeated until all tours are filled. <br><br clear="all"><img align="right" src="https://habrastorage.org/storage2/f43/c31/ce0/f43c31ce0ee3d45c4af6d7e912884926.png"><br>  At the end of the algorithm, the list of all pairs of championship teams will be empty, the games will be formed and all the tours are filled with games - everything follows the rules of the championship. <br><br clear="all">  The main algorithm I wanted to share is described, I did not go into the details of the syntax of the stored SQL procedures, since this is another topic and another post.  All scripts with an example implementation can be found in the github repository.  At the moment, the scripts are working and tested on MS SQL Server, if this is interesting for you, I will rewrite it under the DBMS that you are using.  The project also contains stored procedures for calculating the best goalkeeper, scorer, "The Way of the Champion" and several others to interact with the championship data. <br><br>  For the scripts to work correctly, you must first create the FootballTournament database.  For the operation of the stored counting procedures, better than the scorer, goalkeeper and other auxiliary stored procedures, the first two must be performed: the formation of tournaments and the generation of random data of game results. <br><br>  Run the scripts from the example in the following order: <br><ol><li>  Formation of database schema ' <a href="">schema.sql</a> '. </li><li>  Tables are filled with players, teams, coaches and their ' <a href="">fillTestData.sql</a> ' stadiums. </li><li>  Creating stored procedures ' <a href="">storedProcedurs.sql</a> '. </li><li>  Call stored procedures ' <a href="">execute.sql</a> '. </li></ol><br>  I thank everyone who was interested to read to the end. <br><br>  <a href="https://github.com/creativ/FootballTournament">Link to the project repository on github</a> </div><p>Source: <a href="https://habr.com/ru/post/167937/">https://habr.com/ru/post/167937/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167919/index.html">Apple first became # 1 mobile phone supplier in the US</a></li>
<li><a href="../167921/index.html">Nokia Protected Phones - A Tour of History</a></li>
<li><a href="../167927/index.html">Dialup sound</a></li>
<li><a href="../167931/index.html">FICON protocol. Short educational program</a></li>
<li><a href="../167935/index.html">Detailed manual "How to create the PA infotype in SAP HR" or "How to tame SAP?" (Part 1)</a></li>
<li><a href="../167939/index.html">Introducing the Gates Foundation's College Knowledge Challenge Winners</a></li>
<li><a href="../167943/index.html">EVE Online, the battle of Asakai, what really happened</a></li>
<li><a href="../167945/index.html">Symbian is dead, but 808 PureView is not yet!</a></li>
<li><a href="../167947/index.html">A nice acquaintance with the Prestigio MultiPhone 5000 DUO DualSim smartphone</a></li>
<li><a href="../167949/index.html">Install CPU-Fan from socket 1155 on LGA775</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>