<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous function sequential call</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As is known, the JavaScript language pursues the event-oriented programming paradigm. This is certainly good, but what to do if, after one asynchronou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous function sequential call</h1><div class="post__text post__text-html js-mediator-article">  As is known, the JavaScript language pursues the event-oriented programming paradigm.  This is certainly good, but what to do if, after one asynchronous function, another asynchronous function is called, and then another, and another ... Sometimes such code is very confusing, and not only the person who is used to the synchronous and alternate function calls.  This applies to complex animations, timeouts, Ajax, when one must be followed by another, and so on. <br><br>  Therefore, I developed my crutch, which allows you to more visually call asynchronous functions that trigger a callback after execution.  It is likely that the solution has long existed, but, unfortunately, I have not found such a solution. <br><br>  UPD <br><img src="https://habrastorage.org/getpro/habr/post_images/1f7/a26/d5b/1f7a26d5bddd25a702eea2940fc6a3b3.jpg" alt="image"><br>  Below is my solution, which is an analogue of <a href="https://github.com/caolan/async">this function of</a> the <a href="https://github.com/caolan/async">async</a> module and a heap of other similar solutions presented in the comments.  Thanks to all the commentators and <a href="http://habrahabr.ru/users/sedictor/" class="user_link">sedictor</a> in particular. <br>  / UPD 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider an example (which is taken from the head and errors are possible in it) of the hypothetical site parser, which after parsing enters the data into the database, and, after entering, causes some code. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = <span class="hljs-string"><span class="hljs-string">''</span></span>; request.on(<span class="hljs-string"><span class="hljs-string">'response'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ response.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) </span></span>{ html = html + chunk; }); response.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//-  parse(html, function(data){ //- ,     addToDatabase(data, function() { doSomething(); }) }); }); });</span></span></code> </pre> <br><br>  Many nested kolbekov - not gud, we try differently. <br><a name="habracut"></a><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> html = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> responceOnEnd = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ parse(html, parsed); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parsed = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span>{ addToDatabase(data, addedToDatabase) } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addedToDatabase = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ doSomething(); } request.on(<span class="hljs-string"><span class="hljs-string">'response'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) </span></span>{ response.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) </span></span>{ html = html + chunk; }); response.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, responceOnEnd); });</code> </pre> <br><br>  But here are a few extra variables in which you can also get confused. <br><br>  I suggest doing this: <br><br><pre> <code class="javascript hljs">wait(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runNext</span></span></span><span class="hljs-function">)</span></span>{ request.on(<span class="hljs-string"><span class="hljs-string">'response'</span></span>, runNext); }).wait(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runNext, response</span></span></span><span class="hljs-function">)</span></span>{ response.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">chunk</span></span></span><span class="hljs-function">) </span></span>{ html = html + chunk; }); response.on(<span class="hljs-string"><span class="hljs-string">'end'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ runNext(html); }); }).wait(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runNext, html</span></span></span><span class="hljs-function">)</span></span>{ parse(html, runNext); }).wait(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runNext, data</span></span></span><span class="hljs-function">)</span></span>{ addToDatabase(data, runNext); }).wait(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ doSomething(); })</code> </pre> <br><br>  Interesting?  Let's go further. <br><br>  Function wait. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//first ‚Äî  ,   wait = function(first){ //       return new (function(){ var self = this; var callback = function(){ var args; if(self.deferred.length) { /*       */ args = [].slice.call(arguments); /*    -     */ args.unshift(callback); //      self.deferred[0].apply(self, args); //     self.deferred.shift(); } } this.deferred = []; //    this.wait = function(run){ //      this.deferred.push(run); // this      return self; } first(callback); //   }); }</span></span></code> </pre><br><br>  I'm not sure that the code and comments are transparent, I have to think about it myself for a few seconds :) <br><br>  For clarity, I made several sequential animations: <br><br><pre> <code class="javascript hljs"> wait(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">runNext</span></span></span><span class="hljs-function">)</span></span>{ log(<span class="hljs-string"><span class="hljs-string">'  '</span></span>); $(<span class="hljs-string"><span class="hljs-string">'#div1'</span></span>).animate({ <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span> }, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// -     runNext(1,2); }); }).wait(function(runNext, a, b){ //     log('  , a='+a+' b='+b ); $('#div2').animate({ top: 50 }, 1000, runNext); }).wait(function(runNext){ log('  '); setTimeout(function(){ log('  ') runNext(); }, 2000); }).wait(function(runNext){ log('  '); $('#div3').animate({ left: 50 }, 1000, runNext); }).wait(function(runNext){ log(' '); $('#div1').animate({ top: 0, left: 45 }, 1000, runNext); }).wait(function(){ log(''); });</span></span></code> </pre>  <a href="http://jsfiddle.net/finom/XSGub/37/">Run an example on JSFidle</a> <br><br>  How it works? <br>  The first thing to do is to call the function wait, whose argument is another function that runs immediately with one argument that serves as a callback (in the example, it is defined as runNext) to call the next portion of code.  After the callback is executed, to which you can pass some arguments received at the current step, the next function called in the wait method is called, the first argument of this function is the callback calling the next part of the script, the rest are the arguments passed to the callback in the previous step.  And so on. <br><br>  Actually, everything. <br>  PS <s>As stated above, I‚Äôm not sure of the uniqueness of this development, so if the Chabrasoobshchestvo evaluates this short article as a commonplace, it will quietly go to drafts.</s> <br>  Judging by the number of people who added the article to the favorites, the post has some value, so, perhaps, I will not hide it. </div><p>Source: <a href="https://habr.com/ru/post/134823/">https://habr.com/ru/post/134823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134818/index.html">Kiri</a></li>
<li><a href="../134819/index.html">XNA Draw: write deferred lighting to three sources using a shader</a></li>
<li><a href="../134820/index.html">Introduction to mnemonics</a></li>
<li><a href="../134821/index.html">Three20 demystifying: TTModel</a></li>
<li><a href="../134822/index.html">SockJS server performance study</a></li>
<li><a href="../134824/index.html">2GIS - iOS version appeared</a></li>
<li><a href="../134825/index.html">Recognition and speech synthesis in any iOS application in an hour</a></li>
<li><a href="../134826/index.html">Do I need authorization after registration?</a></li>
<li><a href="../134828/index.html">Optimize battery consumption</a></li>
<li><a href="../134830/index.html">Bleed, I'm sorry. Or a post dedicated to hamsters from IT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>