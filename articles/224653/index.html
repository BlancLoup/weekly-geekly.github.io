<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The minimax algorithm on the example of the game "Collect 4 (connect4)"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The implementation of the minimax algorithm on the example of the game ‚ÄúCollect 4‚Äù is a very exciting activity and, in connection with this, there was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The minimax algorithm on the example of the game "Collect 4 (connect4)"</h1><div class="post__text post__text-html js-mediator-article">  The implementation of the minimax algorithm on the example of the game ‚ÄúCollect 4‚Äù is a very exciting activity and, in connection with this, there was a desire to tell someone else about this hobby, which he did.  The game is available at this <a href="http://www.mathsisfun.com/games/connect4.html">address</a> . <br><br>  The field of the game can be varied by setting constants, I took 7 to 6 as in the example of the link.  The meaning of the game is to, making moves, to build 4 of their figures (crosses or zeros) in one row: horizontally, vertically, diagonally.  To create a game (apparently any), two things are needed: a move generator and a move (position) analyzer. <br><a name="habracut"></a><br>  The rules of the game are such that it is not possible to install a figure to any place on the board, but only to the bottom, and the field above the field occupied by the figure (any) is also considered the bottom.  Board presented in the form of a one-dimensional array <pre><code class="cpp hljs">TicTac field[NSIZE_I*NSIZE_J];</code> </pre>  the structures themselves may be <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> {Tic, Tac, EMPTY} TicTac;</code> </pre>  , the game will need a lot of procedures (relatively of course), the code validation procedure implemented as <pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validstep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> TicTac *field, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((field[step]==EMPTY)&amp;&amp;((step + NSIZE_J &gt;= NSIZE_I*NSIZE_J)||((step + NSIZE_J &lt; NSIZE_I*NSIZE_J)&amp;&amp;(field[step + NSIZE_J] != EMPTY))));}</code> </pre>  , the generator of moves was performed in the simplest and non-optimal way, but the least brainwashing - by simply looking at the equations of verticals, horizontals and diagonals, it turned out quite voluminous, but nothing complicated <br><habracut><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c4getrait</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> TicTac *field, TicTac Me)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, j, k, score=<span class="hljs-number"><span class="hljs-number">0</span></span>, maxscore=<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* X X X */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;NSIZE_I; i++){ score=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j&lt;NSIZE_J; j++){ <span class="hljs-comment"><span class="hljs-comment">//printf( "i=%d; j=%d\n", i, j ); if(field[i*NSIZE_J + j] == Me) score++; else { maxscore = (score &gt; maxscore)?score:maxscore; score = 0; if(maxscore == WIN) return maxscore; } } maxscore = (score &gt; maxscore)?score:maxscore; } /* XXX */ for(j=0; j&lt;NSIZE_J; j++){ score=0; for(i=0; i&lt;NSIZE_I; i++){ if(field[i*NSIZE_J + j] == Me) score++; else { maxscore = (score &gt; maxscore)?score:maxscore; score = 0; if(maxscore == WIN) return maxscore; } } maxscore = (score &gt; maxscore)?score:maxscore; } /*main up diag XXX XX X */ for(k=0; k&lt;NSIZE_J; k++){ score=0; for(i=0, j=NSIZE_J-k-1; i&lt;NSIZE_I&amp;&amp;j&gt;=0; i++, j--){ //printf( "i=%d; j=%d\n", i, j ); if(field[i*NSIZE_J + j] == Me) score++; else { maxscore = (score &gt; maxscore)?score:maxscore; score = 0; if(maxscore == WIN) return maxscore; } } //printf( "\n" ); maxscore = (score &gt; maxscore)?score:maxscore; }...</span></span></code> </pre>  . <br><br>  Of course the most important and difficult procedure in the program is the minimax algorithm itself.  The essence of the algorithm is to find the optimal move, and, the assessment is developed as a set of assessments of the moves of his and his opponent.  The procedure is recursive.  At each step, we look for an assessment of our progress and an assessment of the opponent‚Äôs best move.  For example: we estimate our move at 2 points, the opponent‚Äôs answer at 10 points, total = 2 - 10 = -8 - this is the assessment of our move, recursively making our way down the options tree, we estimate the position to a depth of N. This game, although it is enough simple, but going through all the options, and they are factorial 42 for an empty field, an impossible task on a personal computer (apparently only on a super computer).  The inability to calculate until it stops makes it necessary to use heuristics - position calculation.  I will give a minimax procedure: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Step </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">game</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TicTac *field, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> deep, WHO it, TicTac t)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rait, koeff = <span class="hljs-number"><span class="hljs-number">1</span></span> - Koeff[it]*deep; Step s, r; s.step = <span class="hljs-number"><span class="hljs-number">-1</span></span>; s.rait = <span class="hljs-number"><span class="hljs-number">-1000.</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(deep &gt; DEEPMAX){ s.rait = <span class="hljs-number"><span class="hljs-number">0.</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;NSIZE_I*NSIZE_J; i++){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( validstep(field, i) ){ field[i] = t; rait = c4getrait(field, t); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rait &gt;= WIN){ field[i] = EMPTY; s.rait = <span class="hljs-number"><span class="hljs-number">10.</span></span>*koeff; s.step = i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!isstep(field)){ rait = <span class="hljs-number"><span class="hljs-number">0.</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { r = game(field, deep+<span class="hljs-number"><span class="hljs-number">1</span></span>, it, (t==Tic)?Tac:Tic); rait-=r.rait; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rait &gt; s.rait){ s.rait = rait; s.step = i; } field[i] = EMPTY; } } s.rait = s.rait*koeff; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; }</code> </pre>  The procedure iterates through all positions in the cycle. <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;NSIZE_I*NSIZE_J; i++){...</code> </pre>  make another move <pre> <code class="cpp hljs">field[i] = t;</code> </pre>  looking for evaluation <pre> <code class="cpp hljs">rait = c4getrait(field, t);</code> </pre>  if we won <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rait &gt;= WIN){</code> </pre>  , it makes no sense to look deeper - no, the recursion stops, if there are no moves (a draw) - we return 0 (maybe not optimal), otherwise <pre> <code class="cpp hljs">r = game(field, deep+<span class="hljs-number"><span class="hljs-number">1</span></span>, it, (t==Tic)?Tac:Tic); rait-=r.rait;</code> </pre>  we estimate the opponent's reaction to our move and calculate the rating, then we select the maximum rating and return the position <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rait &gt; s.rait){ s.rait = rait; s.step = i; } field[i] = EMPTY;</code> </pre>  , return the result <pre> <code class="cpp hljs">s.rait = s.rait*koeff; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s;</code> </pre>  . <br><br>  For a correct estimate, you must enter the coefficients (my theory is pure :).  This is due to the fact that winnings at different depths are not equivalent concepts (and, in general, an estimate), because the value is higher, the smaller the search depth.  Explanation: for example, at move A, you get a loss at a depth of 5, and at move B - at a depth of 2. It is clear that 2 will happen earlier than 5 :), and therefore, in this situation, move 5 is preferable for you, this is not the case only victories / defeats, but also simply assessments of the position.  In this regard, it is necessary to form coefficients on the principle, the deeper, the less importance we attach to the move.  But, this is where the difficulties begin :) It is necessary that the algorithm correctly weighs the positions, despite the contradiction - to think deeper, but to underestimate the score, the greater the depth.  Here, apparently, strict mathematics is possible, but I have no special training.  But it is possible and so obvious: in the cycle to hold the party between the programs with a gradual change in the coefficients and recording in the log.  Then the log can find the best options and write off the coefficients.  For depth of search 6 - I got 0.2.  Approximately at this stage I finish, I see, although, in the course, another improvement is to vary the depth depending on the number of options, it is clear that the number of options in this game decreases proportionally to the occupied fields ... Now the algorithm easily wins the average player: ) With the program on the link above loses, if he walks second, first - draws on the maximum difficulty.  The program was written 2 days along with debugging and configuration.  Thanks for attention. </habracut></div><p>Source: <a href="https://habr.com/ru/post/224653/">https://habr.com/ru/post/224653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224635/index.html">MS-DOS is not a question! (video)</a></li>
<li><a href="../224639/index.html">The new version of Unity, the new ‚Äútrivial‚Äù hit, new categories in Google Play - the main mobile news of the week</a></li>
<li><a href="../224645/index.html">Using ViewController in ExtJS 5</a></li>
<li><a href="../224647/index.html">250 million international events in one place</a></li>
<li><a href="../224649/index.html">A team of enthusiasts has successfully established a connection with the ISEE-3 space hardware after a 15-year freeze.</a></li>
<li><a href="../224655/index.html">An effective approach to non-standard site development</a></li>
<li><a href="../224661/index.html">On the outskirts of Ur</a></li>
<li><a href="../224663/index.html">Netatmo - stylish core for smart home</a></li>
<li><a href="../224667/index.html">Comics on network creativity Yuri Nesterenko (aka YuN) - why buggy programs</a></li>
<li><a href="../224669/index.html">Google closes the Q & A service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>