<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sending and receiving SMS messages using VoIP gateways GoIP and Yeastar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Since we are selling VoIP equipment, we are often addressed with various technical issues. Sometimes it comes to the point that customers ask for code...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sending and receiving SMS messages using VoIP gateways GoIP and Yeastar</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/40b/1df/923/40b1df923760430793a04766d1d6d08a.jpg"><br><p><br>  Since we are selling VoIP equipment, we are often addressed with various technical issues.  Sometimes it comes to the point that customers ask for code examples in specific programming languages.  Working with SMS and integrating them into business processes is just one of these regular questions, so I want to stop there and look at it in more detail. <a name="habracut"></a></p><br><h2>  Why GoIP and Yeastar </h2><br><p>  In fact, I would like to tell you more about OpenVox, but there is already an article on Habr√© about their gateways, and they were not available at the time of this writing.  Dinstar also makes such similar gateways, but there are so few catastrophic calls on these gateways, so I decided not to consider them either. </p><br><h2>  Goip </h2><br><img src="https://habrastorage.org/files/3a6/5d7/7b3/3a65d77b3d25424ca4400f79d6f27e22.jpg"><br><p><br>  GoIP GSM gateways are manufactured in China under the brands of several companies and belong to the lowest price category, which is partly why they are the most popular.  Everything I described in relation to <a href="https://arttel.ru/shop/gsm-shlyuzy/gsm-shlyuz-goip-4">DBL's GoIP 4</a> , in theory, it should work on Hybertone gateways, but I will not vouch for this, since there may be differences in the firmware. </p><br><h3>  ‚ñ™ Web interface </h3><br><p>  The easiest way to send an SMS is to go to the gateway page, select the Send SMS section, specify the line from which you want to send the message, the recipient's number and the text of the message itself.  The option is simple, but it is good except for the test, nothing more.  However, it is possible to send SMS using GET and POST requests. </p><br><h4>  <font color="#9cc2ce">‚Üí GET</font> </h4><br><p> For the GET type, use the query of the form: <br> <code>http://192.168.1.190/default/en_US/send.html?u=admin&amp;p=admin&amp;l=1&amp;n=89991234567&amp;m=test</code> </p> <br><pre> <code class="hljs pgsql">u=<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> ‚Äì   p=<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span> ‚Äì  l=<span class="hljs-number"><span class="hljs-number">1</span></span> ‚Äì ,      n=<span class="hljs-number"><span class="hljs-number">89991234567</span></span> ‚Äì   (    ¬´<span class="hljs-number"><span class="hljs-number">8</span></span>¬ª,   ¬´+<span class="hljs-number"><span class="hljs-number">7</span></span>¬ª  ¬´<span class="hljs-number"><span class="hljs-number">7</span></span>¬ª  ) m=test ‚Äì  </code> </pre> <br><p>  If something went wrong, then in response we will receive a message of the form: <code>¬´ERROR,  ¬ª</code> , otherwise: <code>¬´Sending, L1 Send SMS to 89991234567; ID:55c489da¬ª</code>  <code>¬´Sending, L1 Send SMS to 89991234567; ID:55c489da¬ª</code> . <code>¬´Sending, L1 Send SMS to 89991234567; ID:55c489da¬ª</code>  I think everything is clear here: the status, the line number, the recipient's number, and the assigned indicator so that you can later track the status of the shipment. </p><br><h4>  <font color="#9cc2ce">‚Üí POST</font> </h4><br><p>  Sending a request with a POST is the same as sending through a form in the web interface, it is different in that we ourselves must specify an SMS identifier, in certain cases it may be more convenient.  Also through POST, we can send a USSD request, which can also be useful. </p><br><p>  A simple <em>perl</em> example using the <em>Mojolicious</em> framework: </p><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use utf8; use Mojo::UserAgent; my $ua = Mojo::UserAgent-&gt;new; $ua-&gt;post('http://admin:admin@192.168.1.190/default/en_US/sms_info.html?type=sms' =&gt; {Accept =&gt; '*/*'} =&gt; form =&gt; { line =&gt; '1', smskey =&gt; '57867a25', action =&gt; 'SMS', telnum =&gt; '89991234567', smscontent =&gt; '!', send =&gt; 'Send' });</span></span></code> </pre> <br><p>  To send a USSD, you will have to slightly change the request: </p><br><pre> <code class="perl hljs">$ua-&gt;post(<span class="hljs-string"><span class="hljs-string">'http://admin:admin@192.168.1.190/default/en_US/sms_info.html?type=ussd'</span></span> =&gt; {<span class="hljs-string"><span class="hljs-string">Accept =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'*/*'</span></span>} =&gt; <span class="hljs-string"><span class="hljs-string">form =&gt;</span></span> { <span class="hljs-string"><span class="hljs-string">line1 =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">smskey =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'57876006'</span></span>, <span class="hljs-string"><span class="hljs-string">action =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'USSD'</span></span>, <span class="hljs-string"><span class="hljs-string">telnum =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'*100#'</span></span>, <span class="hljs-string"><span class="hljs-string">send =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">'Send'</span></span> });</code> </pre> <br><p>  To get the result, you will have to make a separate GET request for the status of messages. </p><br><h4>  <font color="#9cc2ce">‚Üí Message Status</font> </h4><br><p>  It is necessary to track statuses at least because we can try to send a message while the line is busy sending another message and, as a result, it will not work.  Plus, the GoIP developers did not bother with the creation of a separate means of obtaining the results of USSD queries, but simply write them in the form of decoding errors. </p><br><p>  Shipping statuses can be tracked to: <br> <code>http://192.168.1.190/default/en_US/send_status.xml?u=admin&amp;p=admin</code> </p> <br><p>  In response, we will receive XML, which displays the status of one last post to the channel, I had GoIP 4 on hand, and it had a single firmware with the eighth, therefore, in the statuses of 8 channels, although physically there were 4 of them: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">send-sms-status</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id1</span></span></span><span class="hljs-tag">&gt;</span></span>57867a25<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status1</span></span></span><span class="hljs-tag">&gt;</span></span>DONE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error1</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id2</span></span></span><span class="hljs-tag">&gt;</span></span>57867277<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status2</span></span></span><span class="hljs-tag">&gt;</span></span>ERRORDONE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error2</span></span></span><span class="hljs-tag">&gt;</span></span>send, but provider not reply.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id3</span></span></span><span class="hljs-tag">&gt;</span></span>57876006<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status3</span></span></span><span class="hljs-tag">&gt;</span></span>DONE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error3</span></span></span><span class="hljs-tag">&gt;</span></span> : 57.2 .<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id4</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id4</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status4</span></span></span><span class="hljs-tag">&gt;</span></span>DONE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status4</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error4</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error4</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id5</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id5</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status5</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status5</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error5</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error5</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id6</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id6</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status6</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status6</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error6</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error6</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id7</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id7</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status7</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status7</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error7</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error7</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id8</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id8</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status8</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">status8</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error8</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">error8</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">send-sms-status</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3>  ‚ñ™ SMPP protocol </h3><br><p>  SMPP (Short message peer-to-peer protocol) is a special protocol used to transfer SMS and USSD messages between a client and a server.  This is probably the only "normal" way to receive messages.  Yes, the web interface displays the last five messages for each channel, but the option to periodically climb on it and check if something new has appeared, I cannot be considered adequate. </p><br><p><img src="https://habrastorage.org/files/cfe/38c/f21/cfe38cf211174dedbd4cf5dcf9ad3822.png" alt=" SMPP" title="Enable and configure SMPP"></p><br><p><br>  Although with SMPP, everything is not so smooth.  First, messages come in <code>UTF-16BE</code> encoding.  At first, I did not get information about this anywhere and had to jump pretty with a tambourine in order to understand what kind of encoding SMS messages are received in.  The truth after that was found the parameter ( <code>data_coding</code> ), which just indicates how the message is encoded. </p><br><p>  Secondly, as <code>destination_addr</code> there will always be <code>system_id</code> , with which we connect to GoIP, that is, there is no way to understand which particular SIM card the message came from.  This can be bypassed - it is necessary to connect with <code>system_id + 0 +  </code> , then we will receive messages only for a given channel, naturally, a minus of such a solution is that you need to keep several connections. </p><br><p>  The simplest example of receiving messages using the library <code>Net::SMPP</code> : </p><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use utf8; use strict; use Net::SMPP; use Encode; use feature 'say'; my $smpp = Net::SMPP-&gt;new_transceiver('192.168.1.190', system_id =&gt; 'arttel', #        ‚Äì arttel01,  ‚Äì arttel02  .. password =&gt; 'arttel', port =&gt; '7777', smpp_version=&gt; 0x34 ) or die "Can't connect to SMSC: $!"; while (1) { my $pdu = $smpp-&gt;read_pdu(); #     my $short_message = Encode::decode("UTF-16BE", $pdu-&gt;{short_message}); say $short_message; }</span></span></code> </pre> <br><p>  With sending the same story, if you need to send an SMS from a specific SIM card, then connect with the id of the desired channel: </p><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use utf8; use strict; use Net::SMPP; my $smpp = Net::SMPP-&gt;new_transceiver('192.168.4.107', system_id =&gt; 'arttel01', password =&gt; 'arttel', port =&gt; '7777', smpp_version=&gt; 0x34 ) or die "Can't connect to SMSC: $!"; &amp;send_message('89991234567', '!!!'); sub send_message { my ($sm_dest_addr, $sm_message) = @_; my $result = eval { my $pru = $smpp-&gt;submit_sm( source_addr_ton =&gt; 0x05, #    source_addr_npi =&gt; 0x01, #     source_addr =&gt; '', dest_addr_ton =&gt; 0x01, #    dest_addr_npi =&gt; 0x01, #     destination_addr =&gt; $sm_dest_addr, data_coding =&gt; 0x01, #        short_message =&gt; $sm_message ) or return 1; return 0; }; if ($result == 1){ print "Can't send message: $!"; } } #   SMSC $smpp-&gt;unbind();</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Description of send options</b> <div class="spoiler_text"><table><thead><tr><th>  Parameter </th><th>  Description </th><th>  Meanings </th></tr></thead><tbody><tr><td>  <nobr>source_addr_ton</nobr> </td><td>  Sender number type </td><td>  0x00 - Unknown (Unknown) <br>  0x01 - International (International) <br>  0x02 - State <br>  0x03 - Network Special <br>  0x04 - Subscriber Number (Subscriber Number) <br>  0x05 - Alphanumeric <br>  0x06 - Abbreviated </td></tr><tr><td>  source_addr_npi </td><td>  Sender Numbering Plan ID </td><td>  0x00 - Unknown 0x01 - ISDN (E163 / E164) <br>  0x02 - Data (X.121) <br>  0x03 - Telex (F.69) <br>  0x04 - Land Mobile (E.212) <br>  0x05 - National <br>  0x06 - Private <br>  0x07 - ERMES <br>  0x08 - Internet (IP) <br>  0x09 - WAP Client Id (must be defined by the WAP Forum) </td></tr><tr><td>  dest_addr_ton </td><td>  Recipient Number Type </td><td>  0x01 - International (International) </td></tr><tr><td>  dest_addr_npi </td><td>  Recipient Numbering Plan Identifier </td><td>  0x01 - ISDN (E163 / E164) (for numbers) <br>  0x02 - National (for the rest) </td></tr><tr><td>  data_coding </td><td>  Defines the encoding scheme for user data of a short message. </td><td>  0x01 - IA5 (CCITT T.50) / ASCII (ANSI X3.4) Latin alphabet 7 bits per 1 character maximum length of one message 160 characters <br>  0x07 - Latin / Hebrew (ISO-8859-8) Latin alphabet 8 bits per 1 character maximum message length 140 characters <br>  0x08 - UCS2 (ISO / IEC-10646) for national alphabets (for example, Russian) maximum message length 70 characters </td></tr></tbody></table></div></div><br><h2>  Yeastar </h2><br><img src="https://habrastorage.org/files/836/b73/3a2/836b733a2ef74fad8b51d6080ffe242f.jpg"><br><p><br>  Yeastar‚Äôs homeland is the same as GoIP‚Äôs China, although it seems to me that Yeastar try to make devices with a greater claim for quality and usability than their competitors.  This applies to both physical and software execution.  But they also have flaws.  For example, the documentation does not always keep up with changes in new firmware, and in some cases it may not have important points. </p><br><h3>  ‚ñ™ Web interface </h3><br><p>  You can send and receive messages through the web interface, in general, this is the standard way for such hardware.  In Yeastar gateways, this interface is something remotely reminiscent of unpretentious web muzzles - <code>Inbox</code> and <code>Outbox</code> ‚Äú <code>Outbox</code> with simple filters and search.  In any case, it is a head taller than what is in the GoIP, and most importantly not the last five incoming messages for each channel are stored, but much more.  Only, unfortunately, it is not clear how much, again in the <code>datasheet</code> about this there is not a word. </p><br><h4>  <font color="#9cc2ce">‚Üí GET</font> </h4><br><p>  Just as in most of these glands, you can send a message using a GET request, which is generally not surprising, it is one of the easiest ways to integrate.  Naturally, Yeastar has its own implementation with its own features. </p><br><p>  First you need to enable the ability to send SMS messages and USSD requests.  To do this, you need to activate "API Settings", if you prefer the interface in Russian, then this section will be called "AMI Settings" (is it really very logical?).  Secondly, it is necessary to change the default password until you do this, authorization does not pass, about this, again, not a word in the documentation. </p><br><p><img src="https://habrastorage.org/files/bf7/cea/c95/bf7ceac957a74313bbc067f57ac01eae.png" alt="API Settings Settings"></p><br><p>  After these manipulations, we can use requests for SMS and USSD, respectively: </p><br><p> <code>http://192.168.5.150/cgi/WebCGI?1500101=account=arttel&amp;password=arttel&amp;port=1&amp;destination=89991234567&amp;content=test</code> </p> <br><pre> <code class="hljs pgsql">Response: Success Message: <span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span> successfully!</code> </pre> <br><p> <code>http://192.168.5.150/cgi/WebCGI?1500102=account=arttel&amp;password=arttel&amp;port=1&amp;content=%2A100%23</code> </p> <br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">Request</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,*<span class="hljs-number"><span class="hljs-number">100</span></span># <span class="hljs-built_in"><span class="hljs-built_in">Response</span></span>: Success Message:  : <span class="hljs-number"><span class="hljs-number">36.3</span></span> .</code> </pre> <br><p>  Briefly about the parameters: </p><br><pre> <code class="hljs 1c">account=arttel ‚Äì        API Settings password=arttel ‚Äì  <span class="hljs-keyword"><span class="hljs-keyword"></span></span> API Settings port=<span class="hljs-number"><span class="hljs-number">1</span></span> ‚Äì ,      destination=<span class="hljs-number"><span class="hljs-number">89991234567</span></span> ‚Äì  ,     SMS content=test ‚Äì   <span class="hljs-keyword"><span class="hljs-keyword"></span></span> USSD </code> </pre> <br><p>  The main difference from GoIP: when sending SMS from Yeastar, there is no need to monitor the busy channel or not, our message is put in a queue and as soon as the channel is released it will be sent.  And with USSD requests, the work happens synchronously, that is, we receive the answer immediately and there is no need to search for it somewhere later.  The only drawback is that the answers come in plain text, but I would like something more appropriate: JSON or XML. </p><br><h3>  ‚ñ™ Asterisk Managment Interface </h3><br><p>  The entire line of Yeastar gateways is built around Asterisk (a software program for IP-telephony from the company Digium), therefore there is no support for such a specific protocol like SMPP.  But there is the AMI protocol, native to Asterisk, which is quite simple to work with. </p><br><p>  First, let's see how to receive messages: </p><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use utf8; use strict; use warnings; use AnyEvent::Impl::Perl; use Asterisk::AMI; use Data::Dumper; use URI::Escape; use feature 'say'; #   AMI my $astman = Asterisk::AMI-&gt;new( PeerAddr =&gt; '192.168.5.150', #   Username =&gt; 'arttel', #    API Settings Secret =&gt; 'arttel', #   API Settings Events =&gt; 'on', Handlers =&gt; { ReceivedSMS =&gt; \&amp;received_sms #     }, Keepalive =&gt; 60, on_error =&gt; sub { print "Error occured on socket\r\n"; exit; }, on_timeout =&gt; sub { print "Connection to asterisk timed out\r\n"; exit; } ); die "Unable to connect to asterisk" unless ($astman); sub received_sms { my ($asterisk, $event) = @_; say Dumper($event); #      say uri_unescape($event-&gt;{'Content'}) if ($event-&gt;{'Content'}); return 1; } AnyEvent::Impl::Perl::loop; =result $VAR1 = { 'Total' =&gt; '1', 'Recvtime' =&gt; '2016-07-15 17:49:55', 'ID' =&gt; '', 'Event' =&gt; 'ReceivedSMS', 'Privilege' =&gt; 'all,smscommand', 'Index' =&gt; '1', 'GsmSpan' =&gt; '4', 'Sender' =&gt; '+79991234567', 'Smsc' =&gt; '+79997456321', '--END SMS EVENT--' =&gt; undef, 'Content' =&gt; '%EF%BB%BF%D0%9A%D1%83-%D0%BA%D1%83' }; - =end</span></span></code> </pre> <br><p>  The example is quite simple and it seems to me that everything should be clear.  The only thing I want to pay attention to is <code>¬´GsmSpan¬ª</code> .  We are all used to the fact that array indexing starts from 0, here it‚Äôs not 0 and not 1, but 2, the serial number of the channel is displayed as <code> + 1</code> , so the minimum <code>GsmSpan</code> is 2. </p><br><p>  We can also send SMS and USSD requests via AMI: </p><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use strict; use warnings; use Asterisk::AMI; use Data::Dumper; use URI::Escape; use Encode; use feature 'say'; # Connect to asterisk my $astman = Asterisk::AMI-&gt;new( PeerAddr =&gt; '192.168.5.150', Username =&gt; 'arttel', Secret =&gt; 'arttel', Timeout =&gt; 30, #    ,   USSD    Keepalive =&gt; 60, on_error =&gt; sub { print "Error occured on socket\r\n"; exit; }, on_timeout =&gt; sub { print "Connection to asterisk timed out\r\n"; exit; } ); die "Unable to connect to asterisk" unless ($astman); #  USSD  my %action = ( Action =&gt; 'smscommand', Command =&gt; 'gsm send ussd 2 "*100#"' ); my $actionid = $astman-&gt;send_action(\%action); my $response = $astman-&gt;get_response($actionid); my @cmd = @{$response-&gt;{CMD}}; my $i = 0; while ($i &lt;= $#cmd) { if ($cmd[$i] =~ /USSD Message: (.+)/) { #   ,      my $decodedHex = pack('H*', $1); say decode("UCS-2BE", $decodedHex); } $i++; } #  SMS %action = ( Action =&gt; 'smscommand', Command =&gt; 'gsm send sms 2 89991234567 "" 11111' ); $actionid = $astman-&gt;send_action(\%action); $response = $astman-&gt;get_response($actionid);</span></span></code> </pre> <br><p>  According to USSD, I think everything is clear, just do not forget that the channels are numbered from two.  And there is a small clarification via SMS: if the fate of a message is indifferent to us and the status is not necessary to track, then nothing can be indicated after the message text.  Otherwise, you must specify a unique identifier.  Then, when the fate of sms will be known, the system will send us a message about its condition.  Something like this: </p><br><pre> <code class="perl hljs">$VAR1 = { <span class="hljs-string"><span class="hljs-string">'ID'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'11111'</span></span>, <span class="hljs-string"><span class="hljs-string">'Event'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'UpdateSMSSend'</span></span>, <span class="hljs-string"><span class="hljs-string">'--END SMS EVENT--'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">undef</span></span>, <span class="hljs-string"><span class="hljs-string">'Status'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'Privilege'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'all,smscommand'</span></span>, <span class="hljs-string"><span class="hljs-string">'Smsc'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'+79991234567'</span></span> };</code> </pre> <br><p>  Status = 1 tells us that the message was successfully delivered, and in case of an error the status will be 0. You can receive such messages by subscribing to the <code>UpdateSMSSend</code> event, this is done in the same way as when receiving an SMS. </p><br><h2>  As a conclusion </h2><br><p>  Personally, it would be more convenient for me to work with the <a href="https://arttel.ru/shop/gsm-shlyuzy/gsm-shlyuz-yeastar-neogate-tg400">Yeastar TG400</a> gateway via AMI.  On the other hand, I do not see any big problems in the case of using GoIP.  What I deliberately kept silent about: each manufacturer has a free software SMS server, in the case of GoIP you need PHP, Apache and MySQL to use it, and in the case of Yeastar, Windows.  Such products are more suitable for sending identical messages to pre-prepared database of numbers, rather than integration with some applications.  This is the reason why I missed them.  If someone is interested, on the websites of manufacturers must be appropriate descriptions. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/395947/">https://habr.com/ru/post/395947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../395937/index.html">Which Wall Street companies are most popular with job seekers: LinkedIn statistics</a></li>
<li><a href="../395939/index.html">Top 5 Financial Information Aggregators According to PayOnline</a></li>
<li><a href="../395941/index.html">Women who have influenced the development of information technology</a></li>
<li><a href="../395943/index.html">Friday format: A selection of unusual acoustics</a></li>
<li><a href="../395945/index.html">Ask Ethan # 70: Does the universe have a center?</a></li>
<li><a href="../395951/index.html">Japan allowed cars without rearview mirrors</a></li>
<li><a href="../395953/index.html">New Nintendo Game Console: Reduced NES with Updated Controller</a></li>
<li><a href="../395955/index.html">Israeli company General Robotics presented a mini-drone equipped with short-barreled weapons</a></li>
<li><a href="../395957/index.html">Spector: a miniature scanner to identify fonts and accurately copy color</a></li>
<li><a href="../395959/index.html">Immunity as a regulator of social behavior</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>