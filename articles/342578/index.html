<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jest and Puppeteer: automation of testing web interfaces</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article was written by Italian programmer Valentino Gagliardi. He says that immediately after the release of Puppeteer, he was interested in auto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jest and Puppeteer: automation of testing web interfaces</h1><div class="post__text post__text-html js-mediator-article">  This article was written by Italian programmer Valentino Gagliardi.  He says that immediately after the release of Puppeteer, he was interested in automating the testing of web interfaces using this library and Jest.  After that, he began to experiment. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/342578/"><img src="https://habrastorage.org/webt/tg/wy/la/tgwylackafqptsmzpztufu_13qy.jpeg"></a> <br><br>  Here we will talk about the basics of working with Puppeteer and Jest on the example of testing a web form.  Also here will be considered the peculiarities of using Chromium with and without user interface, and some useful trivia regarding various aspects of testing web pages and organization of the working environment.  Valentino believes that, although Puppeteer is a relatively new tool and its API may well undergo changes, it has a chance to take a worthy place in the arsenal of web developers. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">About some features of the considered tests</font> </h2><br>  I recently wrote interface tests and at this time came across a Kent S. Dodds <a href="https://blog.kentcdodds.com/making-your-ui-tests-resilient-to-change-d37a6ee37269">post</a> dedicated to improving test stability by using the <code>data-*</code> attribute.  This, in a nutshell, is custom attributes that can be set for almost any HTML element.  They are especially useful when organizing data exchange with JavaScript-programs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I came across Kent's material very much in time, since I then used something like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">await</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">page</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.waitForSelector</span></span>("<span class="hljs-selector-id"><span class="hljs-selector-id">#contact-form</span></span>"); <span class="hljs-selector-tag"><span class="hljs-selector-tag">await</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">page</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.click</span></span>("<span class="hljs-selector-id"><span class="hljs-selector-id">#name</span></span>"); <span class="hljs-selector-tag"><span class="hljs-selector-tag">await</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">page</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.type</span></span>("<span class="hljs-selector-id"><span class="hljs-selector-id">#name</span></span>", <span class="hljs-selector-tag"><span class="hljs-selector-tag">user</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span>);</code> </pre> <br>  Here it should be noted that I mainly do server programming.  And although I am not campaigning for the use of <code>data-*</code> in tests, I must admit that this is, after all, an excellent approach.  This is especially useful in large applications, but for now, in our simple example, I will use the classic way of addressing elements. <br><br><h2>  <font color="#3AC1EF">Testing the feedback form</font> </h2><br>  So, our goal is to test the feedback form on <a href="https://www.servermanaged.it/gestione-server-dedicato.html">this page</a> , the work on which I do.  Here is this form: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/833/fae/530/833fae5309b6c76018e6b267405f6b7a.png"></div><br>  It includes the following elements: <br><br><ul><li>  Name field. <br></li><li>  The field to enter the email address. <br></li><li>  Phone entry field. <br></li><li>  Area for entering arbitrary text. <br></li><li>  The checkbox, setting which, the user agrees with the data processing rules. <br></li><li>  Form submit button. <br></li></ul><br>  During testing, you need to check the performance of the form, namely, to make sure that the site visitor can use it to send a request to the company. <br><br><h2>  <font color="#3AC1EF">Project Setup</font> </h2><br>  For a start, let's take a closer look at the tools that we will use to automate testing. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8bd/698/219/8bd698219b68cccfa5db9f9f81611111.png"></div><br>  <a href="https://facebook.github.io/jest/">Jest</a> is a testing framework developed by Facebook.  Jest provides a platform for automated testing, as well as a basic library that allows you to build statements (Expect). <br><br>  <a href="https://github.com/GoogleChrome/puppeteer">Puppeteer</a> is a library for Node.js, which allows you to control the Chromium browser without a user interface.  The tool is quite new, so it's time to test it and think about whether it is needed in a specific project, and if needed - how to integrate it into an existing ecosystem. <br><br>  <a href="https://www.npmjs.com/package/faker">Faker</a> is a Node.js library that can generate random data.  Among them are names, phone numbers, addresses.  This is, by the way, something like Faker for PHP. <br><br>  If you already have a project on which you want to experiment, you can install the necessary libraries with the following command: <br><br><pre> <code class="hljs pgsql">npm i jest puppeteer faker <span class="hljs-comment"><span class="hljs-comment">--save-dev</span></span></code> </pre> <br>  The installation of Puppeteer will take some time, since, among other things, the Chromium browser is installed during the installation of the library. <br><br>  Chromium is an open source web browser that is the foundation of Google Chrome.  Chromium and Chrome have almost the same features, the main differences are in the features of licensing. <br><br>  After everything necessary is installed, we will configure Jest in <code>package.json</code> .  The <code>test</code> command should point to the executable jest file: <br><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"jest"</span></span> }</code> </pre> <br>  In addition, in Jest, I prefer to use this design: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "puppeteer";</code> </pre> <br>  So here we need Babel for Jest: <br><br><pre> <code class="hljs pgsql">npm i babel-core babel-jest babel-preset-env <span class="hljs-comment"><span class="hljs-comment">--save-dev</span></span></code> </pre> <br>  After installing Babel, create a <code>.babelrc</code> file in the project folder with the following contents: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"presets"</span></span>: [<span class="hljs-string"><span class="hljs-string">"env"</span></span>] }</code> </pre> <br>  This preliminary preparation is completed and we can begin to write tests. <br><br><h2>  <font color="#3AC1EF">We write tests</font> </h2><br>  Create a new directory in the project folder.  You can call it <code>test</code> or <code>spec</code> .  Then, in this directory, you need to create a file <code>form.spec.js</code> <br><br>  Now I propose to examine the test code in parts, starting with the import section.  Below I give all this code in its entirety. <br><br>  First import Faker and Puppeteer: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> faker <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "faker"; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> puppeteer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "puppeteer";</code> </pre> <br>  Now we will set the form URL.  Perhaps you decide to test a version of the form that is under development and is available locally, instead of connecting to the work site: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> APP = <span class="hljs-string"><span class="hljs-string">"https://www.change-this-to-your-website.com/contact-form.html"</span></span></code> </pre> <br>  Now, using Faker, create a fictitious user: <br><br><pre> <code class="hljs pgsql">const lead = { <span class="hljs-type"><span class="hljs-type">name</span></span>: faker.name.firstName(), email: faker.internet.email(), phone: faker.phone.phoneNumber(), message: faker.random.words() };</code> </pre> <br>  Next, we define some variables necessary for working with Puppeteer: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> page; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> browser; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> width = <span class="hljs-number"><span class="hljs-number">1920</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> height = <span class="hljs-number"><span class="hljs-number">1080</span></span>;</code> </pre> <br>  Now configure the behavior of the Puppeteer: <br><br><pre> <code class="hljs javascript">beforeAll(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { browser = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> puppeteer.launch({   <span class="hljs-attr"><span class="hljs-attr">headless</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>,   <span class="hljs-attr"><span class="hljs-attr">slowMo</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>,   <span class="hljs-attr"><span class="hljs-attr">args</span></span>: [<span class="hljs-string"><span class="hljs-string">`--window-size=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${width}</span></span></span><span class="hljs-string">,</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${height}</span></span></span><span class="hljs-string">`</span></span>] }); page = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> browser.newPage(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.setViewport({ width, height }); }); afterAll(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { browser.close(); });</code> </pre> <br>  Here we use the Jest <code>beforeAll</code> and <code>afterAll</code> .  We need the first one because we need to start a browser using Puppeteer before running the tests.  After launching the browser, we can open a new page.  When the tests are completed, the browser should be closed.  This is done in the <code>afterAll</code> method using the <code>browser.close()</code> command. <br><br>  It should be noted that we are not limited to the methods <code>beforeAll</code> and <code>afterAll</code> .  To learn about other features of the Jest, take a look at the <a href="https://facebook.github.io/jest/docs/en/api.html">documentation</a> for this library.  In any case, it is recommended to use one instance of the browser to perform the entire test suite, rather than opening and closing the browser for each individual test. <br><br>  Here I would like to make some comments about the above code snippet.  Namely, notice that I launch the browser in windowed mode using the <code>headless: false</code> parameter.  In this case, this is done in order to be able to record what is happening on the screen on video and show the testing process.  Performing real tests using the tools described is usually not necessary to monitor what is happening.  To start the browser without an interface, you can simply remove the parameters used when calling the <code>launch()</code> method. <br><br>  The same applies to the <code>setViewPort()</code> command, which can also be removed.  Or, even better, you can set up two different testing environments.  One is used for visual debugging (it will be discussed below), the second is for working with a browser without a user interface. <br><br>  Now we write the test code: <br><br><pre> <code class="hljs coffeescript">describe(<span class="hljs-string"><span class="hljs-string">"Contact form"</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { test(<span class="hljs-string"><span class="hljs-string">"lead can submit a contact request"</span></span>, async () =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.waitForSelector(<span class="hljs-string"><span class="hljs-string">"[data-test=contact-form]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">"input[name=name]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.type(<span class="hljs-string"><span class="hljs-string">"input[name=name]"</span></span>, lead.name);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">"input[name=email]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.type(<span class="hljs-string"><span class="hljs-string">"input[name=email]"</span></span>, lead.email);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">"input[name=tel]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.type(<span class="hljs-string"><span class="hljs-string">"input[name=tel]"</span></span>, lead.phone);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">"textarea[name=message]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.type(<span class="hljs-string"><span class="hljs-string">"textarea[name=message]"</span></span>, lead.message);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">"input[type=checkbox]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.click(<span class="hljs-string"><span class="hljs-string">"button[type=submit]"</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.waitForSelector(<span class="hljs-string"><span class="hljs-string">".modal"</span></span>); }, <span class="hljs-number"><span class="hljs-number">16000</span></span>); });</code> </pre> <br>  Note the possibility of using the <a href="https://www.valentinog.com/blog/testing-api-koa-jest/">async / await</a> construction <a href="https://www.valentinog.com/blog/testing-api-koa-jest/">with Jest</a> .  Here it is assumed that testing is conducted using one of the latest versions of Node.js. <br><br>  Consider these tests.  Here are the actions that a program-controlled browser performs: <br><br><ul><li>  Jump to the address specified in the APP constant. <br></li><li>  Waiting for the feedback form to appear. <br></li><li>  Clicking on the fields and filling them with data. <br></li><li>  Checkbox <br></li><li>  Submitting the form. <br></li><li>  Waiting for a modal window to appear. <br></li></ul><br>  Note that the Jasmine <code>test()</code> function, as the second parameter, is timed out (16000).  This allows you to observe exactly how the browser works with the page. <br><br>  If you test using a browser that is visible on the screen, and you do not set a timeout, the following error will occur: <br><br><pre> <code class="hljs pgsql">Timeout - Async callback was <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> invoked <span class="hljs-keyword"><span class="hljs-keyword">within</span></span> timeout specified <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> jasmine.DEFAULT_TIMEOUT_INTERVAL</code> </pre> <br>  If you perform testing by launching a browser without an interface, the timeout can be removed. <br><br>  Now everything is ready and testing can be run with the following command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">npm</span></span> test</code> </pre> <br>  After that, it remains only to observe the browser, which itself works with the page. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qYo-NL2qFPM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  If anyone is interested, this on-screen video was recorded on Fedora using <code>recordmydesktop</code> and the following command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">recordmydesktop</span></span> --width <span class="hljs-number"><span class="hljs-number">1024</span></span> --height <span class="hljs-number"><span class="hljs-number">768</span></span> -x <span class="hljs-number"><span class="hljs-number">450</span></span> -y <span class="hljs-number"><span class="hljs-number">130</span></span> --<span class="hljs-literal"><span class="hljs-literal">no</span></span>-sound</code> </pre> <br>  However, this is not all. <br><br><h2>  <font color="#3AC1EF">Testing other interface elements</font> </h2><br>  Now that we‚Äôve dealt with the form, you can test some more page elements. <br><br>  Find out how things are with what is in the <code>&lt;title&gt;&lt;/title&gt;</code> .  As you know, there should be a meaningful title page: <br><br><pre> <code class="hljs cs">describe(<span class="hljs-string"><span class="hljs-string">"Testing the frontend"</span></span>, () =&gt; { test(<span class="hljs-string"><span class="hljs-string">"assert that &lt;title&gt; is correct"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.title();   expect(title).toBe(     <span class="hljs-string"><span class="hljs-string">"Gestione Server Dedicati | Full Managed | Assistenza Sistemistica"</span></span>   ); }); <span class="hljs-comment"><span class="hljs-comment">//      });</span></span></code> </pre> <br>  And what about our navigation bar?  She must be present on the page.  Check with Jest and Puppeteer if this is the case: <br><br><pre> <code class="hljs bash">// <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>(<span class="hljs-string"><span class="hljs-string">"assert that a div named navbar exists"</span></span>, async () =&gt; {   const navbar = await page.<span class="hljs-variable"><span class="hljs-variable">$eval</span></span>(<span class="hljs-string"><span class="hljs-string">".navbar"</span></span>, el =&gt; (el ? <span class="hljs-literal"><span class="hljs-literal">true</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>));   expect(navbar).toBe(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }); //</code> </pre> <br>  You can also find out if a certain element contains the text that should be in it: <br><br><pre> <code class="hljs bash">// <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>(<span class="hljs-string"><span class="hljs-string">"assert that main title contains the correct text"</span></span>, async () =&gt; {   const mainTitleText = await page.<span class="hljs-variable"><span class="hljs-variable">$eval</span></span>(<span class="hljs-string"><span class="hljs-string">"[data-test=main-title]"</span></span>, el =&gt; el.textContent);   expect(mainTitleText).toEqual(<span class="hljs-string"><span class="hljs-string">"GESTIONE SERVER, Full Managed"</span></span>); }); //</code> </pre> <br>  How about testing a page for search engine optimization?  Check for example the presence of a <a href="https://yoast.com/rel-canonical/">canonical link</a> : <br><br><pre> <code class="hljs javascript">describe(<span class="hljs-string"><span class="hljs-string">"SEO"</span></span>, () =&gt; { test(<span class="hljs-string"><span class="hljs-string">"canonical must be present"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.goto(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${APP}</span></span></span><span class="hljs-string">`</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> canonical = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> page.$<span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-string"><span class="hljs-string">"link[rel=canonical]"</span></span>, el =&gt; el.href);   expect(canonical).toEqual(<span class="hljs-string"><span class="hljs-string">"https://www.servermanaged.it/"</span></span>); }); });</code> </pre> <br>  By the same principles, you can create many other tests. <br><br>  As a result, all my tests were successfully completed, which can be judged by the pleasant green messages. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dd/065/8ec/3dd0658ecab0d51c8b396d29b2f5553a.png"></div><br><h2>  <font color="#3AC1EF">Visual debugging</font> </h2><br>  We have already said that Puppeteer allows you to automate work with Chromium, run with or without a user interface.  Recall the following code snippet: <br><br><pre> <code class="hljs ruby">beforeAll(async () =&gt; { browser = await puppeteer.launch({     <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       <span class="hljs-symbol"><span class="hljs-symbol">headless:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>,     <span class="hljs-symbol"><span class="hljs-symbol">slowMo:</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>,     <span class="hljs-symbol"><span class="hljs-symbol">args:</span></span> [<span class="hljs-string"><span class="hljs-string">`--window-size=1920,1080`</span></span>]   }); page = await browser.newPage(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ });</span></span></code> </pre> <br>  In addition, you need to remember that when launching the browser with a graphical interface, you need to pass the Jasmine timeout parameter.  Otherwise, testing will complete quickly and unexpectedly.  The timeout is the second argument of the <code>test()</code> method: <br><br><pre> <code class="hljs lisp">describe(<span class="hljs-string"><span class="hljs-string">"Contact form"</span></span>, () =&gt; { test(   <span class="hljs-string"><span class="hljs-string">"lead can submit a contact request"</span></span>,   async () =&gt; {   /////    },   <span class="hljs-number"><span class="hljs-number">16000</span></span> // &lt;&lt;&lt; - Jasmine )<span class="hljs-comment"><span class="hljs-comment">; });</span></span></code> </pre> <br>  With automated testing, it is not necessary to display the browser window, otherwise it will take forever to perform at least some serious test suite.  However, it is sometimes useful to observe what exactly happens in the browser, controlled from the code.  How to set up a convenient switch between tests using a browser with and without an interface? <br><br>  You can solve this problem by creating an auxiliary function.  We will do this and put it in the <code>testingInit.js</code> file: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isDebugging = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> debugging_mode = {   <span class="hljs-attr"><span class="hljs-attr">puppeteer</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">headless</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>,     <span class="hljs-attr"><span class="hljs-attr">slowMo</span></span>: <span class="hljs-number"><span class="hljs-number">80</span></span>,     <span class="hljs-attr"><span class="hljs-attr">args</span></span>: [<span class="hljs-string"><span class="hljs-string">`--window-size=1920,1080`</span></span>]   },   <span class="hljs-attr"><span class="hljs-attr">jasmine</span></span>: <span class="hljs-number"><span class="hljs-number">16000</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> process.env.NODE_ENV === <span class="hljs-string"><span class="hljs-string">"debug"</span></span> ? debugging_mode : <span class="hljs-literal"><span class="hljs-literal">false</span></span>; };</code> </pre> <br>  Then you can access it from the file with the test code, first importing it, and then using it when launching the browser: <br><br><pre> <code class="hljs ruby">/<span class="hljs-regexp"><span class="hljs-regexp">//</span></span> import { isDebugging } from <span class="hljs-string"><span class="hljs-string">"./testingInit.js"</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ beforeAll(async () =&gt; { browser = await puppeteer.launch(isDebugging().puppeteer)); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ &lt;&lt;&lt;   page = await browser.newPage(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">//</span></span> });</code> </pre> <br>  The same function is useful when setting the timeout: <br><br><pre> <code class="hljs lisp">describe(<span class="hljs-string"><span class="hljs-string">"Contact form"</span></span>, () =&gt; { test(   <span class="hljs-string"><span class="hljs-string">"lead can submit a contact request"</span></span>,   async () =&gt; {   /////    }, isDebugging().jasmine // &lt;&lt;&lt; - Jasmine )<span class="hljs-comment"><span class="hljs-comment">; });</span></span></code> </pre> <br>  After that, in order to start testing in a browser without an interface, just run the following command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">npm</span></span> test</code> </pre> <br>  To run tests in visual mode, you will need to do the following: <br><br><pre> <code class="hljs pgsql">NODE_ENV=<span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> npm test</code> </pre> <br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  It may not be quite convenient for you to work with the Puppeteer itself or its API.  I understand you.  And if the novelty of this project fills you with doubt about its practical applicability, you can take a look, for example, on <a href="https://www.cypress.io/">Cypress</a> .  However, Puppeteer gives developers a truly unlimited opportunity.  Now testing frameworks are being created based on this library.  Of course, over time, the API Puppeteer may change, but I suppose that the basic things that we talked about here are not going anywhere.  In addition, it should be noted that the Puppeteer goes well with Jest.  Many also perform Puppeteer <a href="https://ropig.com/blog/end-end-tests-dont-suck-puppeteer/">E2E testing</a> . <br><br>  Dear readers!  How do you automate web interface testing? </div><p>Source: <a href="https://habr.com/ru/post/342578/">https://habr.com/ru/post/342578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342566/index.html">How to write your swagger and not regret it</a></li>
<li><a href="../342570/index.html">Rewrite the message database VKontakte from scratch and survive</a></li>
<li><a href="../342572/index.html">Classification of the humanities and techies by comments in VK</a></li>
<li><a href="../342574/index.html">We pick a cryptograph, let's call it - ‚Äúnekema‚Äù</a></li>
<li><a href="../342576/index.html">User survey Habra</a></li>
<li><a href="../342580/index.html">ShellCheck Static Analyzer and Script Improvement for Linux and Unix</a></li>
<li><a href="../342582/index.html">Top Ten Antivirus for Linux</a></li>
<li><a href="../342588/index.html">Microservices: deploy, coordination and data consistency</a></li>
<li><a href="../342590/index.html">7 habits of successful Site Reliability Engineers (according to the version of New Relic)</a></li>
<li><a href="../342592/index.html">One for all: how to break the vicious circle of difficulties in developing a boxed product</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>