<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Feel Kotlin (and slightly Gradle) on the example of Posting-long-tweets (open source)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have never been a fan of HelloWorld and tutorials. They usually solve problems that are solved well with this tool, but sharp angles and shortcoming...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Feel Kotlin (and slightly Gradle) on the example of Posting-long-tweets (open source)</h1><div class="post__text post__text-html js-mediator-article">  I have never been a fan of HelloWorld and tutorials.  They usually solve problems that are solved well with this tool, but sharp angles and shortcomings are delicately managed.  You can really touch a language or library only on a real application, writing a ‚Äúbusiness code‚Äù, and not ‚Äúa service of a factory of services of factories of service models‚Äù.  An example of such a simple application is in the video.  Here we go? <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/bz-GXC7x3iE%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiP3orxOb2Vdgn_rtcJPENO3geVyg" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h2>  Prerequisites for the task </h2><br>  I love to read books from my phone and I love to tweet quotes from these books.  But since these books usually contain quotes longer than 140 characters, the situation was somewhat annoying.  The problem could be solved in two ways: <br><br><ol><li>  send quotes in multiple tweets </li><li>  tweet text with pictures. </li></ol><br>  It was the second way that seemed to me less awful.  The result is an application used in a chain of actions: share text from any application -&gt; get into our program -&gt; share a picture in any application again 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What can be learned from the resulting project </h2><br><ol><li>  look at the pros Kotlin </li><li>  look at the typical build script in gradle </li><li>  drag off the function of calculating the font size to fit the text into the rectangle, receive the text shared from another application, the function of sharing the picture in other applications and other trifles. </li></ol><br><h2>  Benefits Kotlin </h2><br>  Recent months, fame * Xamarin'u, I wrote under the mobile phones on .NET (C #).  After it, returning to Android (where Java 7 reigns with limitations, if you want to write for Android 4.1+) is not that unpleasant, but the contrast is very noticeable.  Sugar is not enough.  Kotlin, however, is wildly pleased with the opportunity to write code concisely, the machine does a sickly part of the routine for you. <br><br>  Need to declare just a POJO class with readonly fields?  Easy. <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val width:Int,val height:Int)</span></span></span></span>;</code> </pre> <br>  Independently declare the type of variables?  But why, if the compiler can output them for you! <br><br><pre> <code class="java hljs">val textPaint = TextPaint(Paint.ANTI_ALIAS_FLAG); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paint = Paint();</code> </pre><br>  Moreover, <b>var</b> is a variable, and <b>val</b> is a <b>final</b> object, so that you do not accidentally replace it with another value. <br>  Also, the code allows reducing operators like <b>with</b> : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alertError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text:String)</span></span></span></span>{ val builder = AlertDialog.Builder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); with(builder) { setTitle(R.string.error_title) setMessage(text) setPositiveButton(R.string.ok, { dialogInterface, button -&gt; }) } builder.create().show(); }</code> </pre><br>  Or the ability to stick variables inside a string without the format function or similar in meaning: <br><br><pre> <code class="java hljs">val cachePath = File(getExternalCacheDir(), <span class="hljs-string"><span class="hljs-string">"temp"</span></span>); cachePath.mkdirs(); val fileName = <span class="hljs-string"><span class="hljs-string">"$cachePath/long_text_image.png"</span></span>;</code> </pre><br>  Callback'i for clicks are also assigned quite shorter code: <br><br><pre> <code class="java hljs">buttonSend.setOnClickListener { val text = editText.getText().toString(); <span class="hljs-comment"><span class="hljs-comment">// ..... }</span></span></code> </pre><br>  And as you probably already noticed their examples above, the ‚Äúnew‚Äù operator is also abolished. <br><br>  I also liked the opportunity to declare functions without classes as an alternative to static methods, which, as I understood, do not exist in Kotlin. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.newbilius.longtextsharer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> [...] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMaxFontSizeOfMultilineText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text: String, maxSize: Size, maxTextSize: Int)</span></span></span><span class="hljs-function">: Float </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeightOfMultiLineText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text: String, textSize: Int, maxWidth: Int)</span></span></span><span class="hljs-function">: Int </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//[...] } var textSize = maxTextSize; while (getHeightOfMultiLineText(text, textSize, maxSize.width) &gt; maxSize.height) textSize--; return textSize.toFloat(); }</span></span></code> </pre><br>  And under Kotlin + Android, Kotlin has such a cool thing - <a href="http://kotlinlang.org/docs/tutorials/android-plugin.html">Kotlin Android Extensions</a> .  It allows <b>you</b> to forget <b>findViewById ()</b> as a bad dream and make the following feint with your ears: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> kotlinx.android.synthetic.activity._xml__activity.* <span class="hljs-comment"><span class="hljs-comment">//    ID-,   XML' override fun onCreate(savedInstanceState: Bundle?) { super.onCreate(savedInstanceState) setContentView(R.layout.activity_send) editText.setText(getIntent().getStringExtra(Intent.EXTRA_TEXT)); //[...] }</span></span></code> </pre><br>  An order of magnitude more convenient than annotations <b>RoboGuice</b> . <br><br>  Perhaps the only thing that seemed strange to me was the format for early exit from CallBack: <br><br><pre> <code class="java hljs">buttonSend.setOnClickListener { val text = editText.getText().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (text.length()==<span class="hljs-number"><span class="hljs-number">0</span></span>) { alertError(R.string.error_empty_text); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span><span class="hljs-meta"><span class="hljs-meta">@setOnClickListener</span></span>; <span class="hljs-comment"><span class="hljs-comment">//        } //[...] }</span></span></code> </pre><br><h2>  Use Gradle </h2><br>  Today, assembling Android applications using Gradle is considered a standard.  The truth is that it‚Äôs a bit annoying that Groovy‚Äôs underlying Gradle development is stopped (?) At the beginning of the year.  Well, okay, let's be optimistic.  The minimum application build script (in the debug and release builds) looks like this. <br><br><div class="spoiler">  <b class="spoiler_title">Gradle script</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> groovy.swing.SwingBuilder buildscript { ext.kotlin_version = <span class="hljs-string"><span class="hljs-string">'0.12.1218'</span></span> repositories { jcenter() mavenCentral() } dependencies { classpath "com.android.tools.build:gradle:1.1.1" classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version" classpath "org.jetbrains.kotlin:kotlin-android-extensions:$kotlin_version" } } repositories { jcenter() mavenCentral() } gradle.taskGraph.whenReady { taskGraph -&gt; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(taskGraph.hasTask(<span class="hljs-string"><span class="hljs-string">':longtextsharer:assembleRelease'</span></span>)) { def pass = <span class="hljs-string"><span class="hljs-string">''</span></span>; pass = <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.console().readPassword("\nPlease enter key passphrase: ") pass = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> String(pass) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pass.size() &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { throw <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> InvalidUserDataException("You must enter a password to proceed.") } android.signingConfigs.<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>.storePassword = pass android.signingConfigs.<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>.keyPassword = pass } } android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">22</span></span> buildToolsVersion "22.0.1" signingConfigs { <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> { storeFile file("sign/SET_YOU_KEY.jks") storePassword "" keyAlias "SET_YOU_KEY" keyPassword "" } } defaultConfig { applicationId "com.newbilius.longtextsharer" minSdkVersion <span class="hljs-number"><span class="hljs-number">16</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">22</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName "1.0" } buildTypes { <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> { debuggable <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">release</span></span> { debuggable <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> minifyEnabled <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> signingConfig signingConfigs.<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> proguardFiles getDefaultProguardFile(<span class="hljs-string"><span class="hljs-string">'proguard-android.txt'</span></span>), <span class="hljs-string"><span class="hljs-string">'proguard-rules.pro'</span></span> } } sourceSets { main.java.srcDirs += <span class="hljs-string"><span class="hljs-string">'src/main/kotlin'</span></span> } } dependencies { compile fileTree(dir: <span class="hljs-string"><span class="hljs-string">'libs'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: [<span class="hljs-string"><span class="hljs-string">'*.jar'</span></span>]) compile <span class="hljs-string"><span class="hljs-string">'com.android.support:appcompat-v7:22.2.1'</span></span> compile <span class="hljs-string"><span class="hljs-string">'com.android.support:design:22.2.1'</span></span> compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version" }</code> </pre> </div></div><br>  By the way, I highly recommend using <b>proguard</b> to build the release version - without it, I have a Kotlin application that weighed 5 times more than a similar Java application.  After processing with proguard, the difference in size was 100 kilobytes or so.  In the proguard-rules for the assembly had to add just one rule: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-dontwarn</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.w3c</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.events</span></span>.*</code> </pre> <br>  However, if you build the same script not from the console, but from IntelliJ IDEA, for example, you will come across a problem - in this case you don‚Äôt have a console to enter the password for the certificate.  For this problem, there <a href="https://www.timroes.de/2014/01/19/using-password-prompts-with-gradle-build-files/">seems to be a solution</a> - but it didn‚Äôt suit me, when I tried to use it, I received an error: <br><br><pre> <code class="bash hljs">Error:(29, 0) Gradle: Failed to create component <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'dialog'</span></span> reason: java.awt.HeadlessException &gt; java.awt.HeadlessException (no error message)</code> </pre><br>  Perhaps you are more lucky and you will help me find a mistake?  Versions of libraries, Java and IDE itself are the latest. <br><br><h2>  Local decisions and conclusions </h2><br>  I will not enumerate the features of the functions of calculating the font size for inscribing text in a rectangle or sharing an application - everything is in the source code of the described application on GitHub. <br><br>  <a href="https://github.com/Newbilius/longtext_sharer">Link to the app on github.</a> <br><br>  In general, as for me, on Kotlin the code is more concise and simple, so for my small projects I will continue to use it (as well as share the source code).  If it seemed to you that I didn‚Äôt use any other cool (and relevant) features of Kotlin or Gradle in this application - I‚Äôm waiting for pull-requests and comments! <br><br>  * fame is very limited, article listing kilotons of pitfalls on the way </div><p>Source: <a href="https://habr.com/ru/post/263657/">https://habr.com/ru/post/263657/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263645/index.html">Features of development for Xamarin.Forms</a></li>
<li><a href="../263647/index.html">TargetSummit - evening conference on analytics and promotion of mobile applications</a></li>
<li><a href="../263649/index.html">Crosswalk Project - replacement of Android WebView. Project Integration</a></li>
<li><a href="../263651/index.html">Node-RED node for converting locations into what3words addresses</a></li>
<li><a href="../263655/index.html">Crosswalk Project - replacement of Android WebView. Integration issues</a></li>
<li><a href="../263665/index.html">Corporate Laboratories PENTESTIT: Modern IB Threats</a></li>
<li><a href="../263671/index.html">Compare .NET calendars. Experience first acquaintance</a></li>
<li><a href="../263673/index.html">ZeroRPC is a lightweight, reliable library for distributed communication between servers.</a></li>
<li><a href="../263675/index.html">Oracle Form Study with Java Development API (JDAPI)</a></li>
<li><a href="../263677/index.html">Unit tests in Cach√© are just</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>