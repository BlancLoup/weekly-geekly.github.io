<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Problems Exception Handling in WCF under Mono</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For business reasons, I had to deal with the task of creating a client of a WCF service under Mono 2.6.7. 
 Everything seemed to be going well - the c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Problems Exception Handling in WCF under Mono</h1><div class="post__text post__text-html js-mediator-article">  For business reasons, I had to deal with the task of creating a client of a WCF service under Mono 2.6.7. <br>  Everything seemed to be going well - the client worked both under .NET and under Mono - until I started to handle exceptions that may arise in the methods of the WCF service. <br>  The problems started when I needed to process my own exception, containing not only the exception message, but also some additional information. <br>  I decided that I would organize the handling of exceptional situations as described in the article ‚ÄúExceptions through WCF‚Äù (http://habrahabr.ru/blogs/net/41638/) of the respected Roman <a href="https://habrahabr.ru/users/romannikitin/" class="user_link">RomanNikitin</a> . <br>  In .NET, the client worked as it should, but when launching under Mono, the following error occurred: <br><img src="https://habrastorage.org/getpro/habr/post_images/51d/7b5/51f/51d7b551fb97e9d42ff92ab0c93c60f3.png" alt="image"><br><a name="habracut"></a><br><br>  Having studied various books on WCF, articles on the Internet, after analyzing the diagnostics of transmitted SOAP messages, I came to the conclusion that the error is due to the fact that the Mono-client incorrectly understands the message, which is FaultMessage. <br>  This problem can be solved by taking over the responsibility for serializing and deserializing ‚Äúfault‚Äù messages to itself. <br><br>  The solution scheme is as follows: <br><img src="http://i25.fastpic.ru/big/2011/0829/3d/6715ee7d023263828e054ab047c8373d.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Configure WCF service </h5><br>  For the WCF service, I defined the FaultErrorHandler error handler, implementing the IErrorHandler interface. <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///    WCF-</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> FaultErrorHandler : IErrorHandler <br> { <br> WCFExceptionSerializer serializer = <font color="#0000ff">new</font> WCFExceptionSerializer(); <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  ,   ,   ,  ,          .</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;param name="error"&gt;,   -   WCF-&lt;/param&gt;</font> <br> <font color="#008000">/// &lt;returns&gt;/&lt;/returns&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">bool</font> HandleError(Exception error) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///       </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;param name="error"&gt;,   -   WCF-&lt;/param&gt;</font> <br> <font color="#008000">/// &lt;param name="version"&gt; SOAP-&lt;/param&gt;</font> <br> <font color="#008000">/// &lt;param name="fault"&gt;,  &lt;/param&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> ProvideFault(Exception error, System.ServiceModel.Channels.MessageVersion version, <font color="#0000ff">ref</font> System.ServiceModel.Channels.Message fault) <br> { <br> fault = Message.CreateMessage(version, <font color="#2B91AF">String</font> .Empty, error, serializer); <br> fault.Headers.Add(MessageHeader.CreateHeader( <font color="#A31515">"error"</font> , <font color="#2B91AF">String</font> .Empty, <font color="#0000ff">null</font> )); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Serialization of the error message is assigned to the serializer object of the WCFExceptionSerializer class, the successor of the abstract class XmlObjectSerializer.  However, the error message is not a FaultMessage, but an ordinary Message.  In order for the client to distinguish such a message from a regular message, the element ‚Äúerror‚Äù is inserted into the header of this message. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  -</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> WCFExceptionSerializer : XmlObjectSerializer <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">bool</font> IsStartObject(System.Xml.XmlDictionaryReader reader) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">object</font> ReadObject(System.Xml.XmlDictionaryReader reader, <font color="#0000ff">bool</font> verifyObjectName) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> WriteEndObject(System.Xml.XmlDictionaryWriter writer) <br> { <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> WriteStartObject(System.Xml.XmlDictionaryWriter writer, <font color="#0000ff">object</font> graph) <br> { <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;param name="writer"&gt;  -&lt;/param&gt;</font> <br> <font color="#008000">/// &lt;param name="graph"&gt; &lt;/param&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> WriteObjectContent(System.Xml.XmlDictionaryWriter writer, <font color="#0000ff">object</font> graph) <br> { <br> Exception e = graph <font color="#0000ff">as</font> Exception; <br> <br> writer.WriteStartElement(e.GetType().Name); <br> writer.WriteElementString( <font color="#A31515">"Message"</font> , e.Message); <br> <font color="#0000ff">if</font> (e <font color="#0000ff">is</font> SomeCustomException) writer.WriteElementString( <font color="#A31515">"AddData"</font> , (e <font color="#0000ff">as</font> SomeCustomException).AdditionalData.ToString()); <br> writer.WriteEndElement(); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The WCFExceptionSerializer serializer creates an element with the name corresponding to the type of exception that occurred.  An exception message and its specific data (if any) are recorded as child elements.  You can also include data such as StackTrace, Source, etc. in this message.  As a result, the message is as follows: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">s:Envelope</font> <font color="#ff0000">xmlns:s</font> <font color="#0000ff">="http://schemas.xmlsoap.org/soap/envelope/"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">s:Header</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">error</font> <font color="#ff0000">i:nil</font> <font color="#0000ff">="true"</font> <font color="#ff0000">xmlns:i</font> <font color="#0000ff">="http://www.w3.org/2001/XMLSchema-instance"</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">error</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">s:Header</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">s:Body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">DivideByZeroException</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Message</font> <font color="#0000ff">&gt;</font>    . <font color="#0000ff">&lt;/</font> <font color="#800000">Message</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">DivideByZeroException</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">s:Body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">s:Envelope</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  We connect our error handler to the service using the behavior for the ErrorHandlingBehavior service application contract. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  ,    </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> ErrorHandlingBehavior : <font color="#2B91AF">Attribute</font> , IContractBehavior <br> { <br> <font color="#008000">//  </font> <br> <font color="#0000ff">private</font> <font color="#0000ff">void</font> ApplyDispatchBehavior(ChannelDispatcher dispatcher) <br> { <br> <font color="#0000ff">foreach</font> (IErrorHandler errorHandler <font color="#0000ff">in</font> dispatcher.ErrorHandlers) <br> { <br> <font color="#0000ff">if</font> (errorHandler <font color="#0000ff">is</font> FaultErrorHandler) <br> { <br> <font color="#0000ff">return</font> ; <br> } <br> } <br> dispatcher.ErrorHandlers.Add( <font color="#0000ff">new</font> FaultErrorHandler()); <br> } <br> <br> <font color="#008000">//</font> <br> <font color="#008000">//     ContractBehavior</font> <br> <font color="#008000">//</font> <br> <font color="#0000ff">void</font> IContractBehavior.AddBindingParameters(ContractDescription contractDescription, ServiceEndpoint endpoint, BindingParameterCollection bindingParameters) <br> { <br> } <br> <br> <font color="#0000ff">void</font> IContractBehavior.ApplyClientBehavior(ContractDescription contractDescription, ServiceEndpoint endpoint, ClientRuntime clientRuntime) <br> { <br> clientRuntime.MessageInspectors.Add( <font color="#0000ff">new</font> ErrorInspector()); <br> } <br> <font color="#0000ff">void</font> IContractBehavior.ApplyDispatchBehavior(ContractDescription contractDescription, ServiceEndpoint endpoint, DispatchRuntime dispatchRuntime) <br> { <br> <font color="#0000ff">this</font> .ApplyDispatchBehavior(dispatchRuntime.ChannelDispatcher); <br> } <br> <br> <font color="#0000ff">void</font> IContractBehavior.Validate(ContractDescription contractDescription, ServiceEndpoint endpoint) <br> { <br> <font color="#0000ff">return</font> ; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  We connect the behavior of ErrorHandlingBehavior to the service using the attribute mechanism: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">[ServiceContract, ErrorHandlingBehavior] <br> <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IMyService <br> { <br> [OperationContract] <br> <font color="#0000ff">void</font> MethodWithException(); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> MyService : IMyService <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> MethodWithException() <br> { <br> <font color="#2B91AF">Random</font> r = <font color="#0000ff">new</font> <font color="#2B91AF">Random</font> ( <font color="#2B91AF">DateTime</font> .Now.Millisecond); <br> r.Next(100); <br> <font color="#0000ff">int</font> a = 30 / (r.Next(100) % 2); <br> <font color="#0000ff">throw</font> <font color="#0000ff">new</font> SomeCustomException( <font color="#A31515">" "</font> , 12.987); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The only method of the MyService service throws out the usual DivideByZeroException exception, then the created SomeCustomException exception, which contains some additional data (a floating-point number).  In the latter case, the message will look like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">s:Envelope</font> <font color="#ff0000">xmlns:s</font> <font color="#0000ff">="http://schemas.xmlsoap.org/soap/envelope/"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">s:Header</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">error</font> <font color="#ff0000">i:nil</font> <font color="#0000ff">="true"</font> <font color="#ff0000">xmlns:i</font> <font color="#0000ff">="http://www.w3.org/2001/XMLSchema-instance"</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">error</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">s:Header</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">s:Body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">SomeCustomException</font> <font color="#ff0000">xmlns</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">Message</font> <font color="#0000ff">&gt;</font>   <font color="#0000ff">&lt;/</font> <font color="#800000">Message</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">AddData</font> <font color="#0000ff">&gt;</font> 12,987 <font color="#0000ff">&lt;/</font> <font color="#800000">AddData</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">SomeCustomException</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">s:Body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">s:Envelope</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Now the service is ready to work. <br><br><h5>  Let's go to the client. </h5><br>  We define the ErrorInspector message inspector for the client, who will receive messages from the service and process them if the message header contains the element ‚Äúerror‚Äù. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> ErrorInspector : IClientMessageInspector <br> { <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///     -</font> <br> <font color="#008000">///  (  Fault-)   </font> <br> <font color="#008000">///    </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;param name="reply"&gt;&lt;/param&gt;</font> <br> <font color="#008000">/// &lt;param name="correlationState"&gt;,   </font> <br> <font color="#008000">///   BeforeSendRequest    (      )&lt;/param&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> AfterReceiveReply( <font color="#0000ff">ref</font> Message reply, <font color="#0000ff">object</font> correlationState) <br> { <br> <font color="#0000ff">int</font> errorHeaderIndex = reply.Headers.FindHeader( <font color="#A31515">"error"</font> , <font color="#2B91AF">String</font> .Empty); <br> <font color="#0000ff">if</font> (errorHeaderIndex &gt; -1) <br> { <br> <font color="#0000ff">throw</font> ExtractException(reply.GetReaderAtBodyContents()); <br> } <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///     -</font> <br> <font color="#008000">///    </font> <br> <font color="#008000">///    </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">object</font> BeforeSendRequest( <font color="#0000ff">ref</font> Message request, System.ServiceModel.IClientChannel channel) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///     </font> <br> <font color="#008000">///       </font> <br> <font color="#008000">///   WCFException.</font> <br> <font color="#008000">///    </font> <br> <font color="#008000">///   Data  WCFException.</font> <br> <font color="#008000">///     -    .</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#008000">/// &lt;param name="xdr"&gt;  &lt;/param&gt;</font> <br> <font color="#008000">/// &lt;returns&gt;  WCFException (   WCF-)&lt;/returns&gt;</font> <br> <font color="#0000ff">private</font> WCFException ExtractException(XmlDictionaryReader xdr) <br> { <br> WCFException wcfError = <font color="#0000ff">new</font> WCFException(); <br> wcfError.ExceptonType = xdr.Name; <br> <br> xdr.ReadToFollowing( <font color="#A31515">"Message"</font> ); <br> xdr.Read(); <br> wcfError.Message = xdr.Value; <br> <br> <font color="#0000ff">if</font> (wcfError.ExceptonType == WCFException.SomeCustomException) <br> { <br> xdr.ReadToFollowing( <font color="#A31515">"AddData"</font> ); <br> xdr.Read(); <br> wcfError.Data[ <font color="#A31515">"AddData"</font> ] = xdr.Value; <br> } <br> <br> <font color="#0000ff">return</font> wcfError; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Adding our message inspector to ErrorHandlingBehavior behavior occurs in the ApplyClientBehavior method. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">void</font> IContractBehavior.ApplyClientBehavior(ContractDescription contractDescription, ServiceEndpoint endpoint, ClientRuntime clientRuntime) <br> { <br> clientRuntime.MessageInspectors.Add( <font color="#0000ff">new</font> ErrorInspector()); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The ‚Äúfault‚Äù messages are processed by the ExtractException method, and the corresponding data is read from the message body.  Based on the read data, an object of the WCFException type is created (the successor of Exception), various additional data are entered into its Data collection, if necessary. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///    WCF-</font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> WCFException : <font color="#2B91AF">Exception <br></font> { <br> <font color="#008000">//     </font> <br> <font color="#008000">//      Data</font> <br> <font color="#008000">//  </font> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> <font color="#0000ff">string</font> SomeCustomException = <font color="#A31515">"SomeCustomException"</font> ; <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///   </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> WCFException() <br> : <font color="#0000ff">base</font> () <br> { <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">string</font> ExceptonType <br> { <br> <font color="#0000ff">get</font> ; <br> <font color="#0000ff">set</font> ; <br> } <br> <br> <font color="#008000">/// &lt;summary&gt;</font> <br> <font color="#008000">///  </font> <br> <font color="#008000">/// &lt;/summary&gt;</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">new</font> <font color="#0000ff">string</font> Message <br> { <br> <font color="#0000ff">get</font> ; <br> <font color="#0000ff">set</font> ; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Now it remains to create a client of the WCF service and add the already familiar ErrorHandlingBehavior behavior to the contract application for the client application. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">MyServiceClient client = <font color="#0000ff">new</font> MyServiceClient(); <br> client.Endpoint.Contract.Behaviors.Add( <font color="#0000ff">new</font> ErrorHandlingBehavior()); <br> <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">" Enter,    "</font> ); <br> <font color="#2B91AF">Console</font> .ReadKey(); <br> <br> <font color="#0000ff">try</font> <br> { <br> client.MethodWithException(); <br> } <br> <font color="#0000ff">catch</font> (WCFException wcfEx) <br> { <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">":"</font> ); <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">": "</font> + wcfEx.Message); <br> <font color="#0000ff">if</font> (wcfEx.ExceptonType == WCFException.SomeCustomException) <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">" : "</font> + wcfEx.Data[ <font color="#A31515">"AddData"</font> ].ToString()); <br> } <br> <font color="#0000ff">catch</font> (Exception e) <br> { <br> <font color="#2B91AF">Console</font> .WriteLine(e.Message); <br> } <br> <font color="#2B91AF">Console</font> .ReadKey();</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  In a catch block, a WCFException exception is caught and processed depending on what type of exception it represents. <br><br>  We test the service and the client with the new ErrorHandlingBehavior behavior connected. <br>  DivideByZeroException is handled correctly: <br><img src="https://habrastorage.org/getpro/habr/post_images/e58/1b8/867/e581b8867eb2e548a85b5a3c86a01de4.png" alt="image"><br><br>  and a new SomeCustomException: <br><img src="https://habrastorage.org/getpro/habr/post_images/132/382/a61/132382a61920cbcc14ea91c968705b7a.png" alt="image"><br><br>  At the same time, we have access to any additional data that our arbitrary exception may have. <br>  The amount of code is also reduced in parallel, since we do not need to create exception description classes (defined as FaultContract) to handle exceptions, and the volume of messages does not increase;  we send only the data that interests us. <br>  Among the shortcomings, it is possible to note that in order to add a new user exception with its own additional information to this system, you must manually add how this information will be serialized into WCFExceptionSerializer and deserialized into ErrorInspector.  Also, the name of this new custom message will have to be placed in a static, read-only field of the WCFException class. <br>  Perhaps this procedure can be automated to make using this method more convenient. <br><br>  <a href="http://ifolder.ru/25444297">Download source code (standard error handling method)</a> <br>  <a href="http://ifolder.ru/25444329">Download source code (suggested error handling method)</a> </div><p>Source: <a href="https://habr.com/ru/post/127790/">https://habr.com/ru/post/127790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127784/index.html">.Net MVC 3 logging in 30 minutes</a></li>
<li><a href="../127786/index.html">An inside look: Opening the Nvidia 8600M GT chip</a></li>
<li><a href="../127787/index.html">Using MVP Patterns in Classic ASP.NET</a></li>
<li><a href="../127788/index.html">Easy Linux Management Over Twitter</a></li>
<li><a href="../127789/index.html">Matrix barcodes: the bridge between the real and the virtual world</a></li>
<li><a href="../127791/index.html">Page Sorter for printing a book</a></li>
<li><a href="../127792/index.html">Upgrading Microsoft SQL Server Databases</a></li>
<li><a href="../127793/index.html">Easy linux management over twitter</a></li>
<li><a href="../127794/index.html">Automated backups for DB2 on * nix</a></li>
<li><a href="../127795/index.html">Convergence - Possible Replacement Certification Authority System</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>