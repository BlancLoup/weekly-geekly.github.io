<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We check the code of the dynamic analyzer Valgrind using a static analyzer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I‚Äôll say right away that the article is not written at all to show that static analysis works better than dynamic one. Such a statement would be wrong...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We check the code of the dynamic analyzer Valgrind using a static analyzer</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/44d/90d/38e/44d90d38efc7e0a9333e5af93663ea95.png" alt="Friendship static and dynamic analysis" align="left">  I‚Äôll say right away that the article is not written at all to show that static analysis works better than dynamic one.  Such a statement would be wrong, as well as the reverse.  Static and dynamic analysis tools complement each other, and do not compete with each other.  Those and those have strengths and weaknesses.  Some errors cannot detect dynamic analyzers, and some cannot find static ones.  Therefore, you should treat this note simply as a regular demonstration of the capabilities of PVS-Studio, and not as a comparison of the two methodologies. <br><a name="habracut"></a><br><h2>  Methodologies for dynamic and static code analysis </h2><br>  The source code of the program contains hints that help identify errors.  Consider a simple example: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str = foo(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str == <span class="hljs-string"><span class="hljs-string">'\0'</span></span>)</code> </pre> <br>  It is strange to compare a pointer not with <i>nullptr</i> , <i>NULL</i> or at least <i>0</i> , but with the character literal <i>'\ 0'</i> .  Based on this oddity, the static code analyzer can assume that they really wanted to check not that the pointer is 0, but that the string is empty.  Those.  We wanted to check that the <a href="https://www.viva64.com/ru/t/0088/">terminal zero</a> is located at the beginning of the line, but accidentally forgot to dereference the pointer.  Most likely it turns out that this is really a mistake, and the correct code should be like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str = foo(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*str == <span class="hljs-string"><span class="hljs-string">'\0'</span></span>)</code> </pre> <br>  When compiling this information is lost, and the dynamic analyzer is not able to identify this error.  From the point of view of the dynamic analyzer, the pointer is checked for <i>NULL</i> equality <i>-</i> there is nothing to worry about. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Another weakness of dynamic analyzers is the need to execute code that contains an error.  And for many parts of the code, this can be very difficult.  Let me explain with the example of code taken from a real application: <br><br><pre> <code class="cpp hljs">ADOConnection* piTmpConnection = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; hr = CoCreateInstance( CLSID_DataLinks, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, CLSCTX_INPROC_SERVER, IID_IDataSourceLocator, (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>**)&amp;dlPrompt ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( FAILED( hr ) ) { piTmpConnection-&gt;Release(); dlPrompt-&gt;Release( ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> connstr; }</code> </pre> <br>  If the <i>CoCreateInstance</i> function fails, then the null pointer <i>piTmpConnection</i> will be dereferenced.  In fact, here is the line <i>piTmpConnection-&gt; Release ();</i>  just superfluous, since no connection has yet been created. <br><br>  To identify such a situation using a dynamic analyzer is problematic, since it is necessary to emulate a situation where the <i>CoCreateInstance</i> function returns an error status.  Make it easy. <br><br>  Purely theoretically, a static analyzer has information about the code, and therefore is able to find more errors than a dynamic analyzer.  In practice, the capabilities of static analyzers are limited by the amount of available memory and acceptable runtime.  In other words, a static analyzer can consider how the code will work for all possible input data.  But he will do it for 150 years on a cluster, where, in addition, an incredible amount of memory is installed. <br><br>  As a result, in practice, static analyzers cannot identify many types of errors.  For example, they do not notice leaks if the pointer is passed between many functions.  In turn, dynamic analyzers do an excellent job with such tasks, regardless of the complexity of the code. <br><br><h2>  Test results </h2><br>  We regularly <a href="https://www.viva64.com/ru/inspections/">check</a> various projects to popularize static code analysis methodology, and I could not get past such a project like Valgrind.  Finding mistakes in it is a kind of challenge.  This is a high-quality, tested project, which in addition is checked by the Coverity analyzer.  And in general, I am sure that this code was tested by enthusiasts with various tools.  So even finding a few mistakes is a big success. <br><br>  Let's see what PVS-Studio analyzer found in the code of the Valgrind project, which is interesting. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lk_fini</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Int exitcode)</span></span></span><span class="hljs-function"> </span></span>{ .... VG_(umsg)(<span class="hljs-string"><span class="hljs-string">" taken: %'llu (%.0f%%)\n"</span></span>, taken_Jccs, taken_Jccs * <span class="hljs-number"><span class="hljs-number">100.0</span></span> / total_Jccs ?: <span class="hljs-number"><span class="hljs-number">1</span></span>); .... }</code> </pre> <br>  PVS-Studio warning: V502 Perhaps the '?:' Operator works in a different way.  The '?:' Operator has a lower limit than the '/' operator.  lk_main.c 1014 <br><br>  Operator?: Extremely tricky, and it should be used very carefully.  I talked more about this topic in Chapter 4 of my <a href="https://www.viva64.com/ru/b/0391/">small book</a> , where I recommend looking.  Consider what this code is suspicious. <br><br>  It seems to me that the programmer wanted to protect himself from division by zero.  Therefore, if the variable <i>total_Jccs</i> is <i>0</i> , then the division should be carried out by <i>1</i> .  It was planned that the code would work like this: <br><br><pre> <code class="cpp hljs">taken_Jccs * <span class="hljs-number"><span class="hljs-number">100.0</span></span> / (total_Jccs ?: <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  However, the priority of the operator?: Is lower than that of the multiplication and division operators.  Therefore, the expression is calculated as: <br><br><pre> <code class="cpp hljs">(taken_Jccs * <span class="hljs-number"><span class="hljs-number">100.0</span></span> / total_Jccs) ?: <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  However, perhaps the code works exactly as intended.  If this is so, anyway, it is better to add brackets so that other programmers won‚Äôt guess later on whether there is an error or not. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doHelperCall</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... UInt nVECRETs = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... vassert(nVECRETs == (retTy == Ity_V128 || retTy == Ity_V256) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>); .... }</code> </pre> <br>  PVS-Studio warning: V502 Perhaps the '?:' Operator works in a different way.  The '?:' Operator has a lower limit than the '==' operator.  host_arm_isel.c 795 <br><br>  Interesting case.  The?: Operator is used incorrectly, but the code is correct. <br><br>  It was thought that the test should work like this: <br><br><pre> <code class="cpp hljs">nVECRETs == ((retTy == Ity_V128 || retTy == Ity_V256) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  But it works like this: <br><br><pre> <code class="cpp hljs">(nVECRETs == (retTy == Ity_V128 || retTy == Ity_V256)) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  The funny thing is that if you look closely, it is clear that these checks are equivalent.  The result will be the same. <br><br>  Similar checks are found here: <br><br><ul><li>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '==' operator.  host_arm64_isel.c 737 </li><li>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '==' operator.  host_mips_isel.c 611 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> ULong DiOffT; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> Bool fromC; DiOffT off; SizeT size; SizeT used; UChar data[]; } CEnt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_sane_CEnt</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... CEnt* ce = img-&gt;ces[i]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(ce-&gt;size == CACHE_ENTRY_SIZE)) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> fail; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(ce-&gt;off &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> fail; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (!(ce-&gt;off + ce-&gt;used &lt;= img-&gt;real_size)) goto fail; .... }</span></span></code> </pre> <br>  PVS-Studio warning: V547 Expression 'ce-&gt; off&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. image.c 147 <br><br>  The <i>off</i> member is an unsigned type variable, which means it is always greater than or equal to zero.  Thus, the condition <i>(! (Ce-&gt; off&gt; = 0)) is</i> always false. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sdel_Counts</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Counts* cts )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(cts, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(Counts)); <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(cts); }</code> </pre> <br>  PVS-Studio warning: V597 The compiler could delete the memset function call, which is used to flush the 'cts' object.  The memset_s () function should be used to erase the private data.  cg_merge.c 324 <br><br>  Apparently, to simplify the search for errors in Valgrind itself, the memory is filled with zeros before being freed.  However, in the release version, the compiler will most likely remove the <i>memset</i> function call, since the buffer is no longer used before the <i>free</i> function call. <br><br>  Similar places where memory can not be reset: <br><br><ul><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'ffn' object.  The memset_s () function should be used to erase the private data.  cg_merge.c 263 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush the object.  The memset_s () function should be used to erase the private data.  cg_merge.c 332 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush the cpf object.  The memset_s () function should be used to erase the private data.  cg_merge.c 394 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dis_AdvSIMD_scalar_shift_by_imm</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DisResult* dres, UInt insn)</span></span></span><span class="hljs-function"> </span></span>{ .... ULong nmask = (ULong)(((Long)<span class="hljs-number"><span class="hljs-number">0x8000000000000000</span></span>ULL) &gt;&gt; (sh<span class="hljs-number"><span class="hljs-number">-1</span></span>)); .... }</code> </pre> <br>  PVS-Studio warning: V610 Unspecified behavior.  Check the shift operator '&gt;&gt;'.  The left operand '((Long) 0x8000000000000000ULL)' is negative.  guest_arm64_toIR.c 9428 <br><br>  If the right-shift operand is negative, the resulting value depends on the implementation (implementation-defined).  So we are dealing with dangerous code. <br><br>  Now consider the situation when pointer dereferencing is before it is checked for <i>NULL</i> equality: <br><br><pre> <code class="cpp hljs">PRE(xsm_op) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vki_xen_flask_op</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">op</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vki_xen_flask_op</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ARG1</span></span></span><span class="hljs-class">;</span></span> PRINT(<span class="hljs-string"><span class="hljs-string">"__HYPERVISOR_xsm_op ( %u )"</span></span>, op-&gt;cmd); <span class="hljs-comment"><span class="hljs-comment">// &lt;= PRE_MEM_READ("__HYPERVISOR_xsm_op", ARG1, sizeof(vki_uint32_t) + sizeof(vki_uint32_t)); if (!op) // &lt;= return; .... }</span></span></code> </pre> <br>  PVS-Studio warning: V595 The 'op' pointer was used before it was verified against nullptr.  Check lines: 350, 360. syswrap-xen.c 350 <br><br>  Similar cases: <br><br><ul><li>  V595 The 'sysctl' pointer was used before it was verified against nullptr.  Check lines: 568, 578. syswrap-xen.c 568 </li><li>  V595 The 'domctl' pointer was used before it was verified against nullptr.  Check lines: 710, 722. syswrap-xen.c 710 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ML_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(read_elf_debug_info)</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( struct _DebugInfo* di )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inrw &amp;&amp; sdynbss_present) { vg_assert(di-&gt;sbss_present); sdynbss_present = False; vg_assert(di-&gt;sbss_svma + di-&gt;sbss_size == svma); di-&gt;sbss_size += size; .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (inrw &amp;&amp; !di-&gt;sbss_present) { di-&gt;sbss_present = True; di-&gt;sbss_svma = svma; di-&gt;sbss_avma = svma + inrw-&gt;bias; .... }</span></span></code> </pre> <br>  PVS-Studio warning: V705 It is possible that 'else' block was forgotten or commented out, thus the program's operation logics.  readelf.c 2231 <br><br>  The <i>else</i> keyword looks extremely suspicious in this code.  The code is not aligned in accordance with the logic of its work.  In addition, <i>else is</i> followed by an empty string.  This suggests that we are confronted with the consequences of unsuccessful code refactoring and given <i>else</i> is superfluous. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Bool </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doHelperCallWithArgsOnStack</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (guard) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (guard-&gt;tag == Iex_Const &amp;&amp; guard-&gt;Iex.Const.con-&gt;tag == Ico_U1 &amp;&amp; guard-&gt;Iex.Const.con-&gt;Ico.U1 == True) { <span class="hljs-comment"><span class="hljs-comment">/* unconditional -- do nothing */</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> no_match; <span class="hljs-comment"><span class="hljs-comment">//ATC cc = iselCondCode( env, guard ); } } .... }</span></span></code> </pre> <br>  PVS-Studio warning: V779 Unreachable code detected.  It is possible that an error is present.  host_arm_isel.c 461 <br><br>  Line of code: <br><br><pre> <code class="cpp hljs">cc = iselCondCode( env, guard );</code> </pre> <br>  never done: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reset_valgrind_sink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *info)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VG_(log_output_sink).fd != initial_valgrind_sink.fd &amp;&amp; initial_valgrind_sink_saved) { VG_(log_output_sink).fd = initial_valgrind_sink.fd; VG_(umsg) (<span class="hljs-string"><span class="hljs-string">"Reset valgrind output to log (%s)\n"</span></span>, (info = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ? <span class="hljs-string"><span class="hljs-string">""</span></span> : info)); } }</code> </pre> <br>  PVS-Studio warning: V547 Expression '((void *) 0)' is always false.  server.c 110 <br><br>  The analyzer warning looks strange and needs clarification. <br><br>  We are interested in the following expression: <br><br><pre> <code class="cpp hljs">(info = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ? <span class="hljs-string"><span class="hljs-string">""</span></span> : info))</code> </pre> <br>  The macro <i>NULL</i> takes place in <i>(((void *) 0)</i> and it turns out: <br><br><pre> <code class="cpp hljs">(info = ((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-string"><span class="hljs-string">""</span></span> : info))</code> </pre> <br>  The priority of the operator <i>?: Is</i> higher than that of the operator <i>=</i> , so the calculations are as follows: <br><br><pre> <code class="cpp hljs">(info = (((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) <span class="hljs-number"><span class="hljs-number">0</span></span>) ? <span class="hljs-string"><span class="hljs-string">""</span></span> : info)))</code> </pre> <br>  Agree that the condition <i>((void *) 0)</i> for the operator <i>?:</i> Looks strange, which is what the PVS-Studio analyzer warns about.  Apparently, we are dealing with a typo, and the code should have been like this: <br><br><pre> <code class="cpp hljs">(info == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ? <span class="hljs-string"><span class="hljs-string">""</span></span> : info))</code> </pre> <br>  And the latest code snippet for today: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">genReload_TILEGX</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*OUT*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HInstr ** i1, </span></span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-params"><span class="hljs-comment">/*OUT*/</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HInstr ** i2, HReg rreg, Int offsetB )</span></span></span><span class="hljs-function"> </span></span>{ TILEGXAMode *am; vassert(!hregIsVirtual(rreg)); am = TILEGXAMode_IR(offsetB, TILEGXGuestStatePointer()); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (hregClass(rreg)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HRcInt64: *i1 = TILEGXInstr_Load(<span class="hljs-number"><span class="hljs-number">8</span></span>, rreg, am); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> HRcInt32: *i1 = TILEGXInstr_Load(<span class="hljs-number"><span class="hljs-number">4</span></span>, rreg, am); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: ppHRegClass(hregClass(rreg)); vpanic(<span class="hljs-string"><span class="hljs-string">"genReload_TILEGX: unimplemented regclass"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  PVS-Studio warning: V751 Parameter 'i2' is not used inside function body.  host_tilegx_defs.c 1223 <br><br>  I think here we forgot to write <i>NULL</i> to <i>i2</i> , as it is done in other similar functions: <br><br><pre> <code class="cpp hljs">*i1 = *i2 = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>;</code> </pre> <br>  A similar error is found here: <br><br>  V751 Parameter 'i2' is not used inside function body.  host_mips_defs.c 2000 <br><br><h2>  Conclusion </h2><br>  Thank you all for your attention.  Try our static code analyzer PVS-Studio for Linux. <br><br><ul><li>  Download: <a href="https://www.viva64.com/ru/pvs-studio-download-linux/">PVS-Studio for Linux</a> </li><li>  Get a temporary license key: <a href="https://www.viva64.com/ru/about-feedback/">email us</a> . </li><li>  Instructions: <a href="https://www.viva64.com/ru/m/0036/">How to run PVS-Studio in Linux</a> . </li></ul><br>  Windows developers, I invite here: <a href="https://www.viva64.com/ru/pvs-studio-download/">PVS-Studio for Windows</a> .  For them, everything is a little easier.  They can simply install a plugin for Visual Studio and test their C, C ++ and C # projects with the help of the demo version. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0504/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="http://www.viva64.com/en/b/0504/">Checking the code of Valgrind dynamic analyzer by a static analyzer</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/327994/">https://habr.com/ru/post/327994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327982/index.html">Reaction to user feedback in order to increase the average rating</a></li>
<li><a href="../327984/index.html">Mikrotik guarding temperature</a></li>
<li><a href="../327986/index.html">We broadcast a video stream from a web page via WebRTC to Facebook and YouTube at the same time</a></li>
<li><a href="../327988/index.html">Free from all shackles: Emercoin version 6.2 has become completely decentralized</a></li>
<li><a href="../327990/index.html">Pentestit Security Conference 2017: reports</a></li>
<li><a href="../327996/index.html">BK-0010 emulator on FPGA</a></li>
<li><a href="../327998/index.html">Conference Outsource-People 2017, Krakow (day two)</a></li>
<li><a href="../328000/index.html">Segmentation of text lines of documents into characters using convolutional and recurrent neural networks</a></li>
<li><a href="../328002/index.html">SimplePage: a simple, declarative framework for rapid prototyping</a></li>
<li><a href="../328004/index.html">Part 3. Where to store data for decentralized applications on the blockchain?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>