<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the real noise of Perlin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="According to the search query, the noise of the pearl immediately comes across this transfer to Habr√©. As rightly noted in the comments to the publica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the real noise of Perlin</h1><div class="post__text post__text-html js-mediator-article">  According to the search query, the <i>noise of the pearl</i> immediately comes across <a href="http://habrahabr.ru/post/142592/">this transfer</a> to Habr√©.  As rightly noted in the comments to the publication, this is not at all the noise of Perlin.  Perhaps the author of the translation himself was not in the know. <br><br>  What is the difference between the noise of Perlin, you can <s>easily</s> notice if you compare the pictures. <br><br>  Normal noise (from the same article): <br><img width="150" height="150" src="https://habrastorage.org/files/e25/379/112/e2537911225f47f7b66ece483e60f282.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Perlin's noise: <br><img width="150" height="150" src="https://habrastorage.org/getpro/habr/post_images/0ca/7bd/595/0ca7bd5956a3aa93d6ec570a5aabe49d.gif" alt="image"><br><br>  And by increasing the number of octaves, you can‚Äôt bring the first picture to the second.  I will not describe the advantages of Perlin noise and its area of ‚Äã‚Äãapplication (because the article is about programming, and not about application), but I will try to explain how it is implemented.  I think this will be useful to many programmers, because the hacker sources of Ken Perlin do not explain much, even with comments. <br><a name="habracut"></a><br><br><h4>  Retreat </h4><br>  Amazingly, judging by the reviews in PM and in the comments, it turned out that not everyone is able to see any difference at all between the simple smoothed noise in the grayscale and the Perlin noise.  But, probably, because of this paradox, the very article appeared and raped. <br><br>  I'll try to give a tip: <br>  The first picture consists of distinct pixels (enlarged) in different shades of gray: <br><img src="https://habrastorage.org/files/f62/73f/f0e/f6273ff0edaa47aca3accd4e4e5dfafb.png"><br>  The second one (Perlin noise) looks like black and white blurry worms. <br><br>  Here is what happens after simple operations in the graphical editor (search for boundaries, inversion, posterization): <br>  Perlin: <br><img src="https://habrastorage.org/files/fb1/dd6/703/fb1dd67034ea406f8194a494998ce424.jpg"><br>  Picture from the article (exactly the same operations are applied): <br><img src="https://habrastorage.org/files/c65/f67/158/c65f671584254982b4938f04551d0cea.jpg"><br><br>  Yes, in fractal noise, if there are a lot of octaves, then it‚Äôs hard to understand what‚Äôs in the original - Perlin or not.  But this is not a reason to call fractal noise Perlin noise. <br>  On it I will finish with the description of a difference. <br>  <b>The end of the retreat.</b> <br><br>  Consider the two-dimensional option.  For the time being, we will only write a blank class.  The incoming data is a two-dimensional vector or two floating-point numbers: x, y. <br><br>  The return value is a number from -1.0 to 1.0: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Perlin2d</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Noise</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotImplementedException(); } }</code> </pre> <br><h3>  Couple of words about interpolation </h3><br>  The idea of ‚Äã‚Äãthe usual smoothed noise is that there is a discrete pseudo-random grid of values, and for the requested point there is an interpolation between the grid nodes (the closer the point is to some grid node, the more its value corresponds to the node value). <br><br>  Here in the third conventional square, the point in the very center after interpolation will have the value 3: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c28/bff/3e4/c28bff3e4c5eb81370fd8ecb67b66f35.png" alt="image"><br><br>  Consider in more detail how it turns out the three.  Point coordinates: <br> <code>x:2.5, <br> y:0.5 <br></code> <br><br>  The integer coordinates of the point (the upper left corner of the square): <br> <code>x:2, <br> y:0 <br></code> <br>  are obtained by rounding down (floor function). <br><br>  The local coordinates of a point inside a square are obtained by subtracting: <br> <code>x = 2.5 ‚Äì 2 = 0.5, <br> y = 0.5 ‚Äì 0 = 0.5 <br></code> <br><br>  Take the value of the upper left corner of the square (1) and the upper right (2).  Interpolate the top edge using the local x coordinate (0.5).  Linear interpolation looks like this: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Lerp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// return a * (t - 1) + b * t;      ( ,    ): return a + (b - a) * t; }</span></span></code> </pre><br><br>  Take the value of the lower left corner of the square (2) and lower right (7).  Interpolate the lower bound using the same local x coordinate (0.5). <br>  Results: <br> <code>: 1.5 <br> : 4.5 <br></code> <br><br>  Now there is an interpolation of the upper and lower using the local y coordinate (also 0.5): <br> <code>1.5 * 0.5 + 4.5 * (1 ‚Äì 0.5) = 3 <br></code> <br><br>  Bilinear interpolation is the easiest but the result is not the most attractive. <br><br>  Other interpolation options involve modifying the local coordinate (parameter t) before interpolation.  Smoother transitions near the boundary values ‚Äã‚Äã(0 and 1) are obtained. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/498/090/a13/498090a135f5b0ab322cee72e9bb78fb.png" alt="image"><br><br>  The first variant is involved in Perlin‚Äôs noise; it gives a rather strong curvature. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QunticCurve</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t * t * t * (t * (t * <span class="hljs-number"><span class="hljs-number">6</span></span> - <span class="hljs-number"><span class="hljs-number">15</span></span>) + <span class="hljs-number"><span class="hljs-number">10</span></span>); } ... <span class="hljs-comment"><span class="hljs-comment">//     : Lerp(a, b, QuinticCurve(t))</span></span></code> </pre><br><br><h3>  The main idea and difference noise Perlin </h3><br>  Everything is very simple: <br>  1. At the grid nodes, pseudo-random <b>vectors</b> (two-dimensional for two-dimensional noise, three-dimensional for three-dimensional, and so on), <b>and not</b> pseudo-random <b>numbers</b> . <br>  2. <b>Interpolate between the scalar products</b> a) vectors from the vertices of a square to a point inside the square (a three-dimensional cube) and b) pseudo-random vectors (when describing Perlin noise, they are called gradient vectors). <br><br>  In his <a href="http://mrl.nyu.edu/~perlin/noise/">improved version of the</a> noise Ken Perlin uses a total of 12 gradient vectors.  For the two-dimensional version, only 4 are required - by the number of faces (there are 4 in a square).  The vectors are directed (conditionally from the center of the cube / square) towards each of the faces and are not normalized. <br><br>  Here they are: <br><pre> <code class="cs hljs">{ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> } { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> } { <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span> }</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/98d/b1a/aa498db1a164a974953430a1a31a5a91.png" alt="image"><br><br>  So, each of the grid nodes corresponds to one of the four vectors.  Let the vector be an array of floats. <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPseudoRandomGradientVector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v = <span class="hljs-comment"><span class="hljs-comment">// -   0  3      x  y switch (v) { case 0: return new float[]{ 1, 0 }; case 1: return new float[]{ -1, 0 }; case 2: return new float[]{ 0, 1 }; default: return new float[]{ 0,-1 }; } }</span></span></code> </pre><br><br><h3>  Implementation </h3><br>  We need the scalar product of vectors: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>] * b[<span class="hljs-number"><span class="hljs-number">0</span></span>] + a[<span class="hljs-number"><span class="hljs-number">1</span></span>] * b[<span class="hljs-number"><span class="hljs-number">1</span></span>]; }</code> </pre><br><br>  Main method: <br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Noise</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fy</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        int left = (int)System.Math.Floor(fx); int top = (int)System.Math.Floor(fy); //        float pointInQuadX = fx - left; float pointInQuadY = fy - top; //       : float[] topLeftGradient = GetPseudoRandomGradientVector(left, top ); float[] topRightGradient = GetPseudoRandomGradientVector(left+1, top ); float[] bottomLeftGradient = GetPseudoRandomGradientVector(left, top+1); float[] bottomRightGradient = GetPseudoRandomGradientVector(left+1, top+1); //        : float[] distanceToTopLeft = new float[]{ pointInQuadX, pointInQuadY }; float[] distanceToTopRight = new float[]{ pointInQuadX-1, pointInQuadY }; float[] distanceToBottomLeft = new float[]{ pointInQuadX, pointInQuadY-1 }; float[] distanceToBottomRight = new float[]{ pointInQuadX-1, pointInQuadY-1 }; //        /* tx1--tx2 | | bx1--bx2 */ float tx1 = Dot(distanceToTopLeft, topLeftGradient); float tx2 = Dot(distanceToTopRight, topRightGradient); float bx1 = Dot(distanceToBottomLeft, bottomLeftGradient); float bx2 = Dot(distanceToBottomRight, bottomRightGradient); //   ,     : pointInQuadX = QunticCurve(pointInQuadX); pointInQuadY = QunticCurve(pointInQuadY); // , : float tx = Lerp(tx1, tx2, pointInQuadX); float bx = Lerp(bx1, bx2, pointInQuadX); float tb = Lerp(tx, bx, pointInQuadY); //  : return tb; }</span></span></code> </pre><br><br>  As a bonus: <br><div class="spoiler">  <b class="spoiler_title">multi octave noise</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> Noise(<span class="hljs-type"><span class="hljs-type">float</span></span> fx, <span class="hljs-type"><span class="hljs-type">float</span></span> fy, <span class="hljs-type"><span class="hljs-type">int</span></span> octaves, <span class="hljs-type"><span class="hljs-type">float</span></span> persistence = <span class="hljs-number"><span class="hljs-number">0.5</span></span>f) { <span class="hljs-type"><span class="hljs-type">float</span></span> amplitude = <span class="hljs-number"><span class="hljs-number">1</span></span>; //      ,    ""  //    -  persistence <span class="hljs-type"><span class="hljs-type">float</span></span> max = <span class="hljs-number"><span class="hljs-number">0</span></span>; //     <span class="hljs-type"><span class="hljs-type">float</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; //   <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (octaves<span class="hljs-comment"><span class="hljs-comment">-- &gt; 0) { max += amplitude; result += Noise(fx, fy) * amplitude; amplitude *= persistence; fx *= 2; //    (   )    fy *= 2; } return result/max; }</span></span></code> </pre><br></div></div><br><br>  And the last - use of the table with random numbers.  In the Ken Pearl code, such a table is registered manually and the values ‚Äã‚Äãobtained from there are quite different.  Here you can experiment and the uniformity of noise and the absence of obvious patterns in it depend on this. <br><br>  I did <br><div class="spoiler">  <b class="spoiler_title">So</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Perlin2D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] permutationTable; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perlin2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Random(seed); permutationTable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; rand.NextBytes(permutationTable); <span class="hljs-comment"><span class="hljs-comment">//    } private float[] GetPseudoRandomGradientVector(int x, int y) { // -   ,         int v = (int)(((x * 1836311903) ^ (y * 2971215073) + 4807526976) &amp; 1023); v = permutationTable[v]&amp;3; switch (v) { ...</span></span></code> </pre><br><br>  <b>&amp; 3</b> here cuts off any int32 number to 3, read <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D1%2582%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B5_%25D0%25BE%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8">about AND operation on wikipedia</a> <br>  An operation like <b>% 3</b> would also work, but much slower. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">The entire source code (no comments)</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Perlin2D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] permutationTable; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Perlin2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> seed = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Random(seed); permutationTable = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; rand.NextBytes(permutationTable); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPseudoRandomGradientVector</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> v = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(((x * <span class="hljs-number"><span class="hljs-number">1836311903</span></span>) ^ (y * <span class="hljs-number"><span class="hljs-number">2971215073</span></span>) + <span class="hljs-number"><span class="hljs-number">4807526976</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1023</span></span>); v = permutationTable[v]&amp;<span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (v) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span> }; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">QunticCurve</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> t * t * t * (t * (t * <span class="hljs-number"><span class="hljs-number">6</span></span> - <span class="hljs-number"><span class="hljs-number">15</span></span>) + <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Lerp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> t</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + (b - a) * t; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dot</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a[<span class="hljs-number"><span class="hljs-number">0</span></span>] * b[<span class="hljs-number"><span class="hljs-number">0</span></span>] + a[<span class="hljs-number"><span class="hljs-number">1</span></span>] * b[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Noise</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fy</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)System.Math.Floor(fx); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> top = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)System.Math.Floor(fy); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pointInQuadX = fx - left; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pointInQuadY = fy - top; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] topLeftGradient = GetPseudoRandomGradientVector(left, top ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] topRightGradient = GetPseudoRandomGradientVector(left+<span class="hljs-number"><span class="hljs-number">1</span></span>, top ); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] bottomLeftGradient = GetPseudoRandomGradientVector(left, top+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] bottomRightGradient = GetPseudoRandomGradientVector(left+<span class="hljs-number"><span class="hljs-number">1</span></span>, top+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] distanceToTopLeft = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ pointInQuadX, pointInQuadY }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] distanceToTopRight = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ pointInQuadX<span class="hljs-number"><span class="hljs-number">-1</span></span>, pointInQuadY }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] distanceToBottomLeft = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ pointInQuadX, pointInQuadY<span class="hljs-number"><span class="hljs-number">-1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] distanceToBottomRight = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[]{ pointInQuadX<span class="hljs-number"><span class="hljs-number">-1</span></span>, pointInQuadY<span class="hljs-number"><span class="hljs-number">-1</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> tx1 = Dot(distanceToTopLeft, topLeftGradient); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> tx2 = Dot(distanceToTopRight, topRightGradient); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bx1 = Dot(distanceToBottomLeft, bottomLeftGradient); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bx2 = Dot(distanceToBottomRight, bottomRightGradient); pointInQuadX = QunticCurve(pointInQuadX); pointInQuadY = QunticCurve(pointInQuadY); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> tx = Lerp(tx1, tx2, pointInQuadX); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> bx = Lerp(bx1, bx2, pointInQuadX); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> tb = Lerp(tx, bx, pointInQuadY); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tb; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Noise</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fy, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> octaves, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> persistence = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.5f</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> amplitude = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> max = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (octaves-- &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { max += amplitude; result += Noise(fx, fy) * amplitude; amplitude *= persistence; fx *= <span class="hljs-number"><span class="hljs-number">2</span></span>; fy *= <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result/max; } }</code> </pre><br></div></div><br><br>  Result: <br><img src="https://habrastorage.org/getpro/habr/post_images/e6c/948/5fd/e6c9485fded22bce7ffb9c3e647e37ec.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/265775/">https://habr.com/ru/post/265775/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265765/index.html">Vendor replacement for IT infrastructure (telecommunications): which import can be exchanged for another import</a></li>
<li><a href="../265767/index.html">Preparing for iOS 9</a></li>
<li><a href="../265769/index.html">Best Approaches to Database Versioning</a></li>
<li><a href="../265771/index.html">Summary of Udi Dahan‚Äôs ‚ÄúIntegrated Service Approach‚Äù presentation from ¬µCon 2014: The Microservices Conference</a></li>
<li><a href="../265773/index.html">SpiderTest: use the power of CI</a></li>
<li><a href="../265777/index.html">Windows 10 through 10. Issue # 2. Interaction with users through live tiles and notifications</a></li>
<li><a href="../265779/index.html">‚ÄúThank you for using our products and services.‚Äù What we allow services</a></li>
<li><a href="../265781/index.html">Fourier processing of digital images</a></li>
<li><a href="../265783/index.html">Housing cost as a function of coordinates</a></li>
<li><a href="../265785/index.html">Data Access Layer as a storage management tool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>