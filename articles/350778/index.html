<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do you work with Laravel?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I'm curious how other developers work with the Laravel framework. I saw Adam Wathan talk about writing resource controller code and how simple / clean...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do you work with Laravel?</h1><div class="post__text post__text-html js-mediator-article"> I'm curious how other developers work with the Laravel framework.  I saw Adam Wathan talk about writing resource controller code and how simple / clean it looks. <br>  I would like to share with the community how they work with Laravel.  I would like to learn something new and see what I can improve with my design patterns. <br><br>  In my code right now I use the following approach: <br><br> <code>Controller -&gt; Service -&gt; Repository -&gt; Model</code> <br> <br>  Where possible, I try to follow the principles of SOLID as a general guide.  So, without further introduction, let's move on to the code. <br><a name="habracut"></a><br><h2>  Routes </h2><br>  I like using Laravel Resource Controllers.  As an example, let's create a pizza list page (index).  I also added two examples to show the order sub-page pertaining to pizza only.  (page to create, and then, finally, page to save the order). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">Route::resource(<span class="hljs-string"><span class="hljs-string">'/pizzas'</span></span>, <span class="hljs-string"><span class="hljs-string">'PizzaController'</span></span>, [<span class="hljs-string"><span class="hljs-string">'only'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'index'</span></span>, ]]); Route::group([<span class="hljs-string"><span class="hljs-string">'prefix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pizzas'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Route::resource(<span class="hljs-string"><span class="hljs-string">'/orders'</span></span>, <span class="hljs-string"><span class="hljs-string">'Pizza\OrderController'</span></span>, [<span class="hljs-string"><span class="hljs-string">'only'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'create'</span></span>, <span class="hljs-string"><span class="hljs-string">'store'</span></span>, ]]); });</code> </pre><br>  Final routes: <br><br> <code>GET /pizzas <br> App\Http\Controllers\PizzaController@index <br> <br> GET /pizzas/orders/create <br> App\Http\Controllers\Pizza\OrderController@create <br> <br> POST /pizzas <br> App\Http\Controllers\Pizza\OrderController@store <br></code> <br><br>  You will notice that I define my URL-based namespaces.  The reason I am doing this is that it is easy for me to understand where to debug, in the event of a crash.  Plus, in my opinion, it separates the tasks and allows me to control my controllers with only 7 actions that the resource controller processes. <br><br><ul><li>  Pizza \ OrderController - is only responsible for processing pizza orders </li><li>  PizzaController - is responsible for processing pizza parts </li></ul><br><h2>  Controllers </h2><br>  As you can see above, I try to use only 7 methods, as suggested in the Laravel documentation for Resource Controllers: <br><br><ul><li>  index () </li><li>  create () </li><li>  store () </li><li>  show () </li><li>  edit () </li><li>  update () </li><li>  destroy () </li></ul><br>  I admit that there are times when I can use additional methods within a particular controller class if I feel that this makes sense, but I try to do it rarely. <br><br>  My controller methods will use automatic injection to load the Service class.  So for our pizza list page we want to use PizzaService to get all the pizza from the database. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PizzaService $pizzaService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view(<span class="hljs-string"><span class="hljs-string">'pizza.index'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'pizzas'</span></span> =&gt; $pizzaService-&gt;all(), ]); }</code> </pre><br>  <i>Note: the view also matches the same folder template as the namespace.</i> <br><br><h2>  Services </h2><br>  I like to use Services to process logic in my applications.  Service for me can be the concept of Domain Driven or 1-to-1 using a model (database table).  I have an abstract class that handles common methods that I use a lot in my Services.  <i>(Note: comments / dockblock removed in code examples)</i> <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Services</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $repo; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;all(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paginated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;paginated(config(<span class="hljs-string"><span class="hljs-string">'paginate'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $input)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;create($input); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;find($id); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, array $input)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;update($id, $input); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;destroy($id); } }</code> </pre><br>  Therefore, my Domain / Model based Service looks like this: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Services</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>\<span class="hljs-title"><span class="hljs-title">PizzaRepository</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PizzaService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $pizzaRepository; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PizzaRepository $pizzaRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pizzaRepository = $pizzaRepository; } }</code> </pre><br>  In this PizzaService, I can add my own logic-specific methods that I am trying to implement.  In the <code>$pizzaService-&gt;all()</code> list page continuation, <code>$pizzaService-&gt;all()</code> calls the all () method in the BaseRepository, since we do not overwrite it. <br><br><h2>  Repositories </h2><br>  The repositories in my code are mostly methods that use Eloquent to get or write data to the database.  Only the Service can call the repository level.  (I doubted this approach, but now I always try to follow it). <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Eloquent</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $sortBy = <span class="hljs-string"><span class="hljs-string">'created_at'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $sortOrder = <span class="hljs-string"><span class="hljs-string">'asc'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model -&gt;orderBy(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortBy, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortOrder) -&gt;get(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">paginated</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($paginate)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span> -&gt;model -&gt;orderBy(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortBy, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortOrder) -&gt;paginate($paginate); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($input)</span></span></span><span class="hljs-function"> </span></span>{ $model = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model; $model-&gt;fill($input); $model-&gt;save(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $model; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;where(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, $id)-&gt;first(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;find($id)-&gt;delete(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, array $input)</span></span></span><span class="hljs-function"> </span></span>{ $model = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;find($id); $model-&gt;fill($input); $model-&gt;save(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $model; } }</code> </pre><br>  So, PizzaRepository, which is loaded by PizzaService, looks like this: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Models</span></span>\<span class="hljs-title"><span class="hljs-title">Pizza</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PizzaRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Pizza $pizza)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model = $pizza; } }</code> </pre><br>  It should also be noted that in my Services and Repositories, if I need to, I can overwrite the default methods to use my own implementation.  You remember earlier in our example of the pizza list, BaseService called the all () method in the repository.  Now, since PizzaRepositoryis does not overwrite the BaseRepository, it uses the all () method in the BaseRepository to return a list of all the pizzas from the database. <br><br>  As an example, when overwriting the BaseRepository method, one of my methods uses stored procedures to insert data, so I could overwrite the create method from BaseRepository, for example: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Models</span></span>\<span class="hljs-title"><span class="hljs-title">Pizza</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PizzaRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Pizza $pizza)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model = $pizza; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $input)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;hydrate( DB::select( <span class="hljs-string"><span class="hljs-string">'CALL create_pizza(?, ?)'</span></span>, [ $name, $hasCheese, ] ) ); } }</code> </pre><br>  This is a simple example, but now I return the hydrated result from my stored procedure. <br><br><h2>  Traits </h2><br>  I just introduced the idea of ‚Äã‚ÄãTraits into my code.  This happened when I discovered that some of my repository layers need the ability to customize sorting (you will notice that my BaseRepository has two properties, sortBy and sortOrder. So I created the Sortable feature. Now I can sort the page with a list of pizza with these properties. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>\<span class="hljs-title"><span class="hljs-title">Traits</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Sortable { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $sortBy = <span class="hljs-string"><span class="hljs-string">'created_at'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $sortOrder = <span class="hljs-string"><span class="hljs-string">'asc'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSortBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sortBy = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'created_at'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortBy = $sortBy; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setSortOrder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($sortOrder = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'desc'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortOrder = $sortOrder; } }</code> </pre><br>  So, now in my Service, where I applied the Trait, I can set the sorting.  (The example below establishes order in the constructor, but you can also run this method in your custom Service methods.) <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Services</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>\<span class="hljs-title"><span class="hljs-title">PizzaRepository</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PizzaService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $pizzaRepository; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PizzaRepository $pizzaRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pizzaRepository = $pizzaRepository; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pizzaRepository-&gt;setSortBy(<span class="hljs-string"><span class="hljs-string">'sort_order'</span></span>); } }</code> </pre><br>  I also had some difficulties trying to figure out how to handle a greedy boot.  I didn‚Äôt like the idea of ‚Äã‚Äãreturning data to my controller, and then using a lazy greedy download.  This was not very convenient for optimizing database queries.  As soon as I made Sortable Trait, I decided to make a similar Relationable trait. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Repositories</span></span>\<span class="hljs-title"><span class="hljs-title">Traits</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">trait</span></span> Relationable { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $relations = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setRelations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($relations = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;relations = $relations; } }</code> </pre><br>  Then I added the with () method to my BaseRepository methods: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model -&gt;with(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;relations) -&gt;orderBy(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortBy, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;sortOrder) -&gt;get(); }</code> </pre><br>  Through my service, I can add the following code to any method (orders is the model's relationship method). <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repo-&gt;setRelations([<span class="hljs-string"><span class="hljs-string">'orders'</span></span>]);</code> </pre> <br>  I'm worried that over time it can be easy to complicate my application with too many Traits, but now it works very well. </div><p>Source: <a href="https://habr.com/ru/post/350778/">https://habr.com/ru/post/350778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350764/index.html">Expanding the capabilities of CleanTalk Anti-Spam</a></li>
<li><a href="../350768/index.html">DigiCert revokes 23 thousand SSL certificates: what is the reason</a></li>
<li><a href="../350772/index.html">Convert React to Angular using a universal abstract tree. Proof of concept</a></li>
<li><a href="../350774/index.html">Java 9 - Have you switched? Not? Do not need ...!?</a></li>
<li><a href="../350776/index.html">Is it easy to speak at a conference for the first time?</a></li>
<li><a href="../350780/index.html">Thin diskless client based on Ubuntu that does not require mounting the file system over the network</a></li>
<li><a href="../350782/index.html">Learn OpenGL. Lesson 4.9 - Geometric Shader</a></li>
<li><a href="../350786/index.html">Do not deny yourself anything: giving carte blanche to uncensored reviews of our events in our blog</a></li>
<li><a href="../350788/index.html">Issue # 14: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../350790/index.html">Lightning Network In Depth, part 2: HTLC And Payment Routing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>