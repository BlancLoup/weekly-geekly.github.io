<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTTP / 2: getting ready for the transition</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last year a very important event happened in the world of network technologies: a new version of the HTTP protocol, HTTP / 2, was approved and standar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTTP / 2: getting ready for the transition</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/bd0/7ba/9a8/bd07ba9a8607d3bb617b96467dd206ae.png" alt="HTTP / 2" width="100%" height="100%"><br><br>  Last year a very important event happened in the world of network technologies: a new version of the HTTP protocol, HTTP / 2, was approved and standardized.  HTTP / 2 is already supported in popular web servers: Apache and Nginx.  Work is underway on the implementation of HTTP / 2 in IIS.  Implemented support in most modern browsers. <br><br>  The use of HTTP / 2 has recently expanded significantly. <br><a name="habracut"></a><br>  According to mid-2015, the percentage of sites and web services that switched to HTTP / 2 was small - only 0.4%.  <a href="http2/ranking" rel="nofollow">Very recent statistics</a> (January 2016) shows a significant increase: from 0.4 to 6.5%.  There is every reason to believe that in the near future the growth rate will increase. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To think about the practical aspects of the transition to HTTP / 2 should be now.  We would like to touch on this topic in today's article.  We will be especially interested in the problem of adapting the existing methods of optimizing the performance of websites to the specifics of the new protocol. <br>  Before proceeding directly to the consideration of this issue, we turn to the history of the HTTP / 2 protocol and briefly describe the main innovations that distinguish it from HTTP / 1.1. <br><br><h2>  From HTTP to HTTP / 2 </h2><br><h3>  A bit of history </h3><br>  <a href="https://www.w3.org/Protocols/HTTP/AsImplemented.html" rel="nofollow">The first description of the HTTP protocol</a> (HyperText Transfer Protocol) was published in 1991.  In 1999, HTTP 1.1 was developed and described, which is still used today.  In that distant time (almost 20 years ago), websites were not at all the same as now.  For a relatively short period of time, sites began to "weigh" much more.  The home page of an average modern website contains approximately 1.9 MB of data: images, JS, CSS, and more. <br><br>  Due to the restriction on the number of simultaneous connections in HTTP / 1.1, loading pages that contain a large amount of "heavy" content is slow.  There are two ways to solve this problem.  The first is to use various performance optimization techniques (some of which we <a href="https://blog.selectel.ru/staticheskie-sajty-nastrojka-i-optimizaciya/">have already written</a> ), and the second is to try to modify the HTTP protocol itself in order to eliminate possible bottlenecks.  Consider such attempts in more detail. <br><br>  The first large-scale HTTP reforming project was introduced in 2009 by Google engineers.  This is the <a href="http://googleresearch.blogspot.co.uk/2009/11/2x-faster-web.html" rel="nofollow">SPDY protocol</a> , the purpose of which was primarily to accelerate the work of websites and applications by modifying the traditional methods of receiving and sending requests. <br><br>  SPDY requires support both on the server side and on the client side.  Google developers have created specialized modules for Apache ( <a href="https://developers.google.com/speed/spdy/mod_spdy/" rel="nofollow">mod_spdy</a> ) and for Nginx ( <a href="http_spdy_module.html" rel="nofollow">ngx_http_spdy_module</a> ).  It is supported in almost all popular browsers. <br><br>  HTTP / 2, introduced six years later, is largely based on SPDY.  The new version of HTTP was created by the working group Hypertext Transfer Protocol working group.  In May 2015, the HTTP / 2 specification was published as <a href="https://tools.ietf.org/html/rfc7540" rel="nofollow">RFC 7540</a> . <br><br>  The HTTP / 2 protocol is backward compatible with HTTP / 1.1.  Changes aimed at eliminating bottlenecks and increasing productivity largely continue the SPDY line.  Consider briefly the most important of them. <br><br><h2>  HTTP / 2: major innovations </h2><br><h3>  Multiplexing </h3><br>  Perhaps this is the most important advantage of HTTP / 2.  In HTTP / 1.1, each request requires a separate TCP connection.  Multiplexing allows the browser to perform multiple requests within a single TCP connection: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d1/26e/26a/0d126e26a6ee3d6925e7e824ca7df364.png" alt="HTTP / 2" width="100%" height="100%"><br><br>  In modern browsers, the number of simultaneous TCP connections is limited.  Therefore, pages with a lot of static content are not loaded as quickly as we would like. <br><br>  In HTTP / 2, by multiplexing, static elements are loaded in parallel, and as a result, performance is greatly improved. <br><br><h3>  Priorities </h3><br>  Another HTTP / 2 innovation is prioritization.  Each request can be assigned a priority. <br>  There are two approaches to assigning priorities: based on weight and based on dependencies. <br><br>  In the first approach, each thread receives a certain weight.  Then, based on the weight, the server distributes the load among the threads.  This approach has already been used in the SPDY protocol. <br><br>  The second method, which is the main one in HTTP / 2, is as follows: the browser asks the server to download certain content items first.  For example, the browser may ask the server to first load the CSS files or JavaScript, and only then HTML or images. <br><br>  In HTTP / 2, prioritization is not a mandatory, but a desirable method.  However, multiplexing without it will not work properly.  Download speed may be even lower than HTTP / 1.1.  Resources with lower priority will occupy the band, which will lead to lower productivity. <br><br><h3>  HTTP header compression </h3><br>  A modern web page consists of many elements: images, JS, CSS and others.  In the request to download each of these elements, the browser sends an HTTP header.  By sending the requested items, the server also adds a header to them.  All this is associated with the waste of resources. <br><br>  In HTTP / 2, headers are transmitted in compressed form.  This reduces the amount of information exchanged between the server and the browser.  Instead of gzip / deflate algorithms, <a href="http2-spec/compression.html" rel="nofollow">HPACK is</a> used.  This reduces vulnerability to <a href="https://en.wikipedia.org/wiki/BREACH_(security_exploit)" rel="nofollow">BREACH attacks</a> . <br><br><h2>  HTTP / 2 and security </h2><br>  One of the most important requirements of the SPDY protocol is the mandatory encryption (HTTPS) of the connection between the client and the server.  In HTTP / 2 it is not mandatory.  However, browser developers decided to implement a new protocol only for TLS (HTTPS) connections.  Therefore, those who are thinking about switching to HTTP / 2, you must first switch to HTTPS. <br><br>  This is needed not only for HTTP / 2.  In Google search, using a secure connection is <a href="https-as-ranking-signal.html" rel="nofollow">one of the ranking criteria</a> .  Browsers (see <a href="http-sites-as-bad/" rel="nofollow">here</a> and <a href="http/" rel="nofollow">here</a> ) will soon mark sites that do not support https as ‚Äúunsafe‚Äù.  We also add that many features of HTML5 - for example, geolocation - without a secure connection <a href="https://code.google.com/p/chromium/issues/detail%3Fid%3D464874" rel="nofollow">will not be available</a> . <br><br><h2>  Basic HTTP / 2 configuration in Nginx and Apache </h2><br>  Here are brief instructions on how to enable and configure HTTP / 2 in Nginx and Apache.  As mentioned above, most modern browsers work with HTTP / 2 only via TLS, so the appropriate settings should be specified in the configuration of your web server. <br><br><h3>  Nginx </h3><br>  HTTP / 2 support is implemented only in the latest versions of Nginx (1.9.5 and higher).  If you have another version installed, you will need to update it. <br><br>  After that, open the configuration file /etc/nginx/nginx.conf and find the following line in the server section: <br><br><pre> listen 443 ssl;
</pre><br><br>  and replace it with: <br><br><pre> listen 443 ssl http2;
</pre><br><br>  Save the changes and restart Nginx: <br><br><pre> $ sudo service nginx reload
</pre><br><br><h3>  Apache </h3><br>  Apache HTTP / 2 is supported only in versions 2.4.17 and higher.  If you have an earlier version installed, upgrade and plug in the <a href="http2.html" rel="nofollow">mod_http2</a> module.  After that, add the following lines to the configuration file: <br><br><pre> # for a https server
 Protocols h2 http / 1.1

 # for a http server
 Protocols h2c http / 1.1
</pre><br><br>  After that, restart Apache.  That's all - for the basic configuration of this is enough. <br><br><h2>  HTTP / 2 and site optimization </h2><br>  HTTP / 2 is backward compatible with HTTP / 1.1.  Therefore, in principle, you can take no action: nothing threatens the work of your service. <br>  But as popular web servers and web browsers switch to HTTP / 2, you will see that your site, which was once optimized to increase page loading speed and increase productivity, is not working as fast as before. <br><br>  Many optimization methods successfully used in HTTP / 1.1 will not work in HTTP / 2.  Some of them will need to be modified, and some will be abandoned altogether.  Consider this question in more detail. <br><br><h3>  Combining images into sprites </h3><br>  In HTTP / 1.1, it was more convenient to upload one large image than to do a lot of requests and download many small ones.  This is due to the fact that requests are queued for each other.  The most common way to increase download speed was to combine multiple small images into a <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Images/Implementing_image_sprites_in_CSS">sprite file</a> . <br><br>  Sprite returned in response to a single request.  Even if the user went to the page on which there is only one small image, it was necessary to load the entire sprite. <br><br>  In HTTP / 2 with its multiplexing, there are no such problems, but using sprites in certain situations may be useful.  Combining multiple images into a sprite (especially if all these images are on the same page) helps to improve compression and thus reduce the total amount of data loaded. <br><br><h3>  Embedding Images with DataURI </h3><br>  Another popular way to solve the problem of multiple HTTP requests in HTTP / 1.1 is to <a href="https://css-tricks.com/data-uris/" rel="nofollow">embed images using the Data URI</a> .  This significantly increases the size of the style sheet. <br><br>  If simultaneously with embedding images for optimization, JS and CSS are also used for concatenation, the user will most likely have to download all the relevant code, even if he does not visit the page with these images. <br>  In HTTP / 2, this practice will worsen rather than improve performance. <br><br><h3>  JS and CSS concatenation </h3><br>  To optimize the work sites often used concatenation of small CSS-and JS-files.  Many small files are combined into one large.  Thus, it is possible to bypass the limit on the number of HTTP requests. <br><br>  However, using concatenation can cause the same problem as with sprites: by going to any one page of the site, the user will download all the CSS and JS files used on it (it‚Äôs very likely that most of these files never will need).  Of course, you can carefully select files for each page of the site, but it will take too much time. <br><br>  Another difficulty lies in the fact that all elements of the concatenated file must be cleaned from the cache at the same time.  It is impossible to make so that for some elements one expiration date is set, and for others (which are also used more often) another one.  If you change at least one line in CSS, all elements will expire immediately. <br><br>  Should I use concatenation in HTTP / 2?  If HTTP requests do not require significant resources, then you can easily do without it.  Loading a lot of small style files won't make any problems.  There will be no difficulties with expiration and caching. <br><br><h3>  Domain Sharding </h3><br>  HTTP / 1.1 has a limit on the number of open connections.  To get around this limitation, you have to load static resources from several subdomains of the same domain.  This technique is called domain sharding;  It is often used, for example, for pages with a large number of images.  This helps to increase the download speed, but at the same time creates <a href="http://calendar.perfplanet.com/2013/reducing-domain-sharding/" rel="nofollow">additional problems</a> . <br><br>  With the HTTP / 2 transition, there is no need for domain sharding.  You can request as many resources as you need.  Moreover, in the case of HTTP / 2, sharding does not improve performance, but rather leads to the opposite effect, since it creates additional TCP connections and interferes with prioritization. <br><br><h2>  When to go? </h2><br>  When to plan the transition to HTTP / 2?  There is no unequivocal answer to this question, and there can not be.  We will give, however, one clue: regularly review the attendance logs of your service.  When you see that most visitors use HTTP / 2-capable browsers, you can proceed.  Currently, HTTP / 2 support is implemented in Chrome (including the mobile version for Android), Firefox, Opera, Edge, Safari. <br><br>  When planning the transition should take into account the features of your project.  If you have a lot of users that come to you from mobile devices, this means that you want to switch to HTTP / 2 as soon as possible.  On smartphones and tablets, the benefits of the new protocol will be especially obvious.  However, here you need to take into account many nuances: for example, <a href="http://www.opera.com/blogs/india/2015/05/opera-mini-becomes-one-of-the-worlds-most-popular-android-apps/" rel="nofollow">in many regions of the world</a> there are still many users of the Opera Mini browser, and it does not yet support HTTP / 2. <br><br>  If you plan to launch a new web service - think about the prospect of switching to HTTP / 2.  Of course, you still have to use HTTP / 1.1 for some time, but now you can take optimization measures that will make your life easier in the future. <br><br><h2>  useful links </h2><br>  In conclusion, we give some interested links for interested readers on the topic: <br><br><ul><li>  <a href="httpwg.org/specs/rfc7540.html" rel="nofollow">full text of the HTTP / 2 specification</a> ; </li><li>  <a href="http2.github.io/faq/" rel="nofollow">HTTP / 2 FAQ</a> - a brief but informative excerpt from the specifications at the link above; </li><li>  <a href="http2/" rel="nofollow">clarifications on HTTP / 2</a> , written by the developer of the curl utility Daniel Sternberg (see also <a href="https://habrahabr.ru/post/221427/" rel="nofollow">Russian translation</a> ); </li><li>  <a href="https://docs.google.com/presentation/d/1r7QXGYOLCh4fcUq0jDdDwKJWNqWK1o4xMtYpKZCJYjM/edit" rel="nofollow">presentation about website optimization for HTTP / 2</a> . </li></ul><br><br>  Readers who for one reason or another can not leave comments here are invited <a href="http2-gotovimsya-k-perexodu/">to our blog</a> . </div><p>Source: <a href="https://habr.com/ru/post/278167/">https://habr.com/ru/post/278167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278151/index.html">Pathfinding: A simple implementation of a funnel algorithm (Funnel Algorithm)</a></li>
<li><a href="../278153/index.html">Part 1. Installing and Configuring a Reputable DNS Server Based on the PowerDNS Solution // Basic Installation</a></li>
<li><a href="../278159/index.html">Debian's RISC under QEMU</a></li>
<li><a href="../278163/index.html">CodingFuture + Puppet. Part III: Install Puppet Server (cfpuppetserver)</a></li>
<li><a href="../278165/index.html">Best practices Richard Siddeway Powershell in depth</a></li>
<li><a href="../278169/index.html">How to shoot yourself in Kotlin</a></li>
<li><a href="../278171/index.html">Simple checksum calculation</a></li>
<li><a href="../278173/index.html">ASP.NET Core + Docker: Cooking Together</a></li>
<li><a href="../278175/index.html">Differences between Azure Resource Manager and Azure Service Manager - a developer‚Äôs perspective</a></li>
<li><a href="../278177/index.html">Azure-IaaS-Digest number 2 (February)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>