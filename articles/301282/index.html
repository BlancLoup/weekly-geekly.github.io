<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Router on Golang</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Welcome, or No Trespassing 
 (C) E.G. Klimov 1964 

 A router written in Go (or as it is sometimes called a router), which turned out to be fast enoug...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Router on Golang</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/05e/1f4/b85/05e1f4b8523c451e296a2a982a38374d.jpg" alt="image">  <i>Welcome, or No Trespassing</i> <i><br></i>  <i>(C) E.G. Klimov 1964</i> <br><br>  A router written in Go (or as it is sometimes called a router), which turned out to be fast enough so that it would not be a shame to compare it with the leaders of go-routing: Bone, Httprouter, Gorilla, Zeus.  The name of the router was given by the simple Russian word ‚ÄúLogin‚Äù, typed in English letters in the Volapuk coding <a href="https://en.wikipedia.org/wiki/Volapuk_encoding">en.wikipedia.org/wiki/Volapuk_encoding</a> <br><br><a name="habracut"></a><br>  <i>Never happened to me like this: no entry!</i>  <i>Wherever you stick - everywhere are solid windows.</i> <i><br></i>  <i>(C) Arkady and Boris Strugatsky.</i>  <i>Lame fate</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Bxog (English letters), reads Biksouji.  In the comments I propose to call a router to choose from: Login, Bxog, Biksouji, Bixog.  For the module in the application that first meets the user's request, the name, from my point of view, is quite appropriate.  By analogy with Windows, I would like to call my Door router, but I'm afraid to be misunderstood;) <br><br>  Links to sources: <br>  <a href="https://github.com/claygod/Bxog">github.com/claygod/Bxog</a> <br>  <a href="https://github.com/claygod/BxogTest">github.com/claygod/BxogTest</a> <br><br><h2>  What for </h2>  <i>And what for me these feathers?</i> <i><br></i>  <i>(C) From a joke</i> <br><br>  I will say right away, the crisis is to blame for everything: salaries are not enough, with Adsens on old sites, nothing is already dripping, but we must live.  We need additional income, but on what to do it?  I was tired of puffing, but I don‚Äôt know how to do anything else, well, I don‚Äôt really want to go to the web designers ... Frontend, this is somehow not mine. <br><br>  Initially, I looked at C / C ++, moreover I tended to lean toward C (here each has his own).  But taking into account pointers, pointers to pointers, pointers to functions and pointers to functions that function pointers take as input, my fragile brain demanded a return from nonalcoholic to classical beer, which the body somehow opposed (unity and struggle of opposites). <br><br>  After a pleasant and <a href="https://habrahabr.ru/topic/edit/278389/">interesting Lua</a> , I got a new hand (for me) Golang: simple, quickly mastered, similar to C.  Put LiteIDE, and you can work.  An important plus is that you can put everything on a work computer under Windows even with user rights (well, strict corporate rules at my work, this is a fact). <br><br>  It remains to determine what to write in the process of learning a language (I believe that it is normal not to study a different language).  Framework, this is somehow a bit too much ... And if you study even just one language per year, how many frameworks do you have to rivet?  I am afraid that the planet will not endure this, I'm not alone on it :) I decided to write a router, and on this, perhaps, I will finish the lyrical digression. <br><br><h2>  Development </h2>  Since I didn‚Äôt yet know the Go language at the time of the beginning of development, the structure of the router, and the principles of its storage and route search changed several times (dramatically, four times).  The first iteration was completely introductory.  Looking at it (with tears, but how), I understood the basics of Golang and made the second version, in which even looking at the code was not too scary.  However, even simple ab testing showed me that my work was pretty slow. <br><br>  Having changed the algorithms and made some more edits, I decided to get acquainted with other Go-routers.  From the list I liked <a href="https://github.com/go-zoo/bone">Bone</a> , I would not be surprised if it is largely due to the name and the funny picture.  Looking at this router, I thought that, oh, I would be able to be able to ... The number of stars under a thousand of this router was also somehow inspiring. <br><br>  Bone has a bench, which pushed me to the third iteration of the development of his creation.  Having written myself a similar bench, I again changed the storage structure and the search algorithm.  Now, lo and behold, my Bixojie was able to overtake Gorilla Pat (Gorilla Mux is slower, and it‚Äôs not difficult to deal with it).  At the same time, I realized that Bone's favorite is not at all sharpened by large dynamic URLs, although it copes well with the short static ones, and its bench just written for this. <br><br>  The king is dead, long live the king!  Now I will fight with <a href="httprouter">HttpRouter</a> .  In the course of the play, I realized that the maps in Go, to put it mildly, do not shine with speed compared to arrays.  The next round of development began to bring the router to the finish line, where the leader's bench became close, we can say the neighbor.  Looking away at my code, I decided that it was too verbose, and in addition, it required fine tuning. <br><br>  Having polished the router for as long as I had enough patience and brains, I proceeded to write tests (I confess, I just tested it manually and occasionally).  Tests have shown that I have not so much patience and brains, but at the same time revealed a couple of major and implicit errors that had to be fixed. <br><br>  Since <i>strings. Split</i> was also not fast, with the hesitating light of a candle, I had to write an analogue that met my requirements.  Yes, to be honest, sometimes writing fast code means writing a not very nice and hardcore code.  Wood chopping - chips fly.  In the end, I was able to achieve superiority over the king in benches.  It was a bit flattering to my vanity, and although it was not intended to be a clear goal. <br><br><h2>  Fast start </h2>  In principle, I tried to organize the code so that the router‚Äôs operation was simple and clear, that is, I hope the code speaks for itself.  Well, below I give a comprehensive example of using a router, demonstrating all of its methods. <br><div class="spoiler">  <b class="spoiler_title">comprehensive example of using a router</b> <div class="spoiler_text"><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"io"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/claygod/Bxog"</span></span> ) <span class="hljs-comment"><span class="hljs-comment">// Handlers func IHandler(w http.ResponseWriter, req *http.Request, r *bxog.Router) { io.WriteString(w, "Welcome to Bxog!") } func THandler(w http.ResponseWriter, req *http.Request, r *bxog.Router) { params := r.Params(req, "/abc/:par") io.WriteString(w, "Params:\n") io.WriteString(w, " 'par' -&gt; "+params["par"]+"\n") } func PHandler(w http.ResponseWriter, req *http.Request, r *bxog.Router) { //     params := r.Params(req, "country") io.WriteString(w, "Country:\n") io.WriteString(w, " 'name' -&gt; "+params["name"]+"\n") io.WriteString(w, " 'capital' -&gt; "+params["city"]+"\n") io.WriteString(w, " 'valuta' -&gt; "+params["money"]+"\n") //    io.WriteString(w, "Creating a URL from route:\n") io.WriteString(w, r.Create("country", map[string]string{"name": "Russia", "capital": "Moscow", "money": "rouble"})) } // Main func main() { m := bxog.New() m.Add("/", IHandler) m.Add("/abc/:par", THandler) m.Add("/country/:name/capital/:city/valuta/:money", PHandler). Id("country"). //    ID Method("GET") //  GET    ,    m.Start(":80") }</span></span></code> </pre> <br></div></div><br>  After starting the above example, click on the links: <br><ul><li>  <a href="http://localhost/">localhost</a> </li><li>  <a href="http://localhost/abc/123">localhost / abc / 123</a> </li><li>  <a href="http://localhost/country/USA/capital/Washington/valuta/dollar">localhost / country / USA / capital / Washington / valuta / dollar</a> </li></ul><br><br><h2>  Configuration </h2>  You need to configure the router by editing the configuration file <a href="">github.com/claygod/bxog/config.go</a> The file contains constants that can be changed. <br><br><h5>  HTTP_METHOD_DEFAULT </h5>  The method used by the default router (GET, POST, etc.).  This option allows you to write less code and in fact just sugar. <br><br><h5>  HTTP_SECTION_COUNT </h5>  The maximum number of sections in urla.  A section is a set of characters between two slashes.  It is not necessary to set this figure against the number of sections in the largest route.  If 32 is not enough, then write 64, so as not to bother, well, etc. <br><br><h5>  HTTP_PATTERN_COUNT </h5>  The maximum length of the URL.  It is clear without explanation. <br><br><h5>  READ_TIME_OUT </h5>  Maximum wait time while reading <br><br><h5>  WRITE_TIME_OUT </h5>  Maximum recording timeout <br><br><h5>  FILE_PREF </h5>  Local path from the root of the site in URL for files available for download. <br><br><h5>  FILE_PATH </h5>  The full path to the directory from which the files will be available for download. <br><br><h2>  Benchmark </h2>  The router turned out fast enough so that it was not a shame to test it in the benchmark together with such popular routers written on Go as Bone, Httprouter, Gorilla, Zeus. The benchmark code and tests of the router are here - <a href="https://github.com/claygod/bxogtest">github.com/claygod/bxogtest</a> <br><br>  The benchmark result for the specified routers in comparison with Bxog with 150 generated 6-section routs (I do not specify the computer configuration, because here it is not absolute numbers that are most important, but their comparison): <br><br><ul><li>  BenchmarkBxogMux-4 5000000 330 ns / op </li><li>  BenchmarkHttpRouterMux-4 3000000 395 ns / op </li><li>  BenchmarkZeusMux-4 100000 23772 ns / op </li><li>  BenchmarkGorillaMux-4 50000 30223 ns / op </li><li>  BenchmarkGorillaPatMux-4 1,000,000 1253 ns / op </li><li>  BenchmarkBoneMux2-4 20000 63656 ns / op </li></ul><br>  Very pleased with Gorilla Pat, which shows good, although not the best performance.  If you are satisfied with the program from Gorilla, then to find a quick solution Gorilla Pat is a very good solution. <br>  If we talk about the choice of the router in general, then it is important to see how it suits you from the inside (this is my opinion, someone thinks that apart from the API, you don‚Äôt have to look at anything).  But the fact that there is a choice is already good.  The picture below shows that the top three, depending on the number of routes, do not change much. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/745/cf9/1f2/745cf91f2e61ed4b7ba15e5b259d6de8.png" alt="image"><br><br><h2>  Tests </h2>  Perhaps the tests are not enough, or at some point they are not covered enough, I will be glad to receive tips in the comments.  In general, DISCLAIMER, in the jambs that probably exist, do not blame me, I just passed by here. <br><br><h2>  API </h2>  The API of the router is as simple as an orange.  As a small sweetness (if the orange is sour), the ability to not only access the parameters from the URL in the handler, but also generate a new URL is added.  This may be convenient when developing a Go site (or a framework for such tasks). <br><br>  Methods: <br><ul><li>  New - create multiplexer </li><li>  Add - add a route.  By default, the GET method and the route ID as a string are its rules, respectively, these are not required options.  Example with method and ID: m.Add ("/ abc /: param", YourHandler) .Method ("POST"). Id ("abc") </li><li>  Start - start the server with the port that you want to listen </li><li>  Params - get parameters from URL </li><li>  Create - create a URL from the parameters of the route </li><li>  Test - analogue Start (only for testing) </li></ul><br>  A simple example: <br><pre> <code class="go hljs"> m := bxog.New() m.Add(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, IndexHandler) m.Start(<span class="hljs-string"><span class="hljs-string">":80"</span></span>)</code> </pre><br><br><h2>  Sections </h2>  As mentioned above, URL slashes are divided into sections.  A section can be static (immutable) and dynamic (argument).  The dynamic section begins with a colon (this is a common practice of routers).  The last section should not end with a slash. <br><br><h2>  Static files </h2>  With the help of the <i>FILE_PREF</i> and <i>FILE_PATH</i> constants, it is necessary to indicate to the router which way static files will be accessible in the browser and which path to these files on the hard disk. <br><br><h2>  Golang </h2>  Disputes about Go do not subside.  Some criticize him, others praise him.  And the one and the other, perhaps justified.  I liked the forced formatting of the code: reading other people's sources no longer causes any problems, everything is homogeneous and readable.  Sometimes reminders of created and unused variables interfere, but in the end, you simply change your programming style so that the compilation is immediately successful.  Will I continue to use this language?  Yes.  Would I recommend it to others?  Yes.  Is it necessary to make it the main and only language in your work?  No, and not because it is bad, you just need to expand your horizons. <br><br><h2>  Summing up </h2>  <i>That's all write "emergency exit."</i>  <i>And at least one contagion wrote "emergency entrance".</i> <i><br></i>  <i>(C) Dmitry Emets.</i>  <i>Methodius Buslaev.</i>  <i>Revenge of the Valkyries</i> <br><br>  Starting to write my Bixoge, I did not set out to wipe the nose of the go-router router * Httprouter * in the speed of processing the request.  The fact that my code was fast is rather a nice bonus.  In my opinion, for an application using a router, this same router is unlikely to be a narrow neck.  But if you set a goal to write a really fast application, then ... another thing.  Most likely it will be a small application, service or something else like that.  For large and complex applications, speed ceases to be the only and most important criterion. <br><br><h2>  And what about the work? </h2>  I did not find a job, because I have not yet searched.  I would very much like to read in the comments about the real situations of the market of Go-programmers, otherwise I have some doubts disassembled, I can immediately buy a new textbook on the XXX language :) <br><br>  <a href="https://github.com/claygod/Bxog">github.com/claygod/Bxog</a> <br>  <a href="https://github.com/claygod/BxogTest">github.com/claygod/BxogTest</a> <br><br><h2>  UPD: 01/17/2017 </h2><br>  Made a clone of the router under the <i>Fast HTTP server</i> : <br>  <a href="https://github.com/claygod/door">github.com/claygod/door</a> <br><br><h2>  UPD: 02/28/2017 </h2><br>  Recently drew attention to the fact that the speed of the main rival HttpRouter was slightly increased by its author.  Also, to my regret, the commits that made working with command line parameters through the native Context slowed down my favorite router significantly.  Accordingly, I had to spend a couple of evenings and increase the performance of my brainchild.  Today, the benchmark for the hundreds of six-section routes looks like this: <br><br><ul><li>  BenchmarkBxogMux-4 5000000 277 ns / op </li><li>  BenchmarkHttpRouterMux-4 3000000 307 ns / op </li><li>  BenchmarkZeusMux-4 100000 18631 ns / op </li><li>  BenchmarkGorillaMux-4 50000 25302 ns / op </li><li>  BenchmarkGorillaPatMux-4 1,000,000 1253 ns / op </li><li>  BenchmarkBoneMux2-4 20000 63656 ns / op </li></ul><br>  For GorillaPat and Bone, the situation has not changed, so I left the old numbers.  I would also note that the situation is even better for routs with a smaller number of sections, but since I decided to measure in six-sections, then so be it. </div><p>Source: <a href="https://habr.com/ru/post/301282/">https://habr.com/ru/post/301282/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301268/index.html">Yandex.Algorithm. Analysis of last year's qualifying round and the last chance to participate in the championship</a></li>
<li><a href="../301270/index.html">12 ideas on how to improve game localization</a></li>
<li><a href="../301274/index.html">Fifth "Webmaster" right now</a></li>
<li><a href="../301276/index.html">Chew linear-square regulator to control the inverted pendulum</a></li>
<li><a href="../301278/index.html">Why automation of work with the client sometimes does not help, but hinders</a></li>
<li><a href="../301286/index.html">What are the bad sample solutions for ‚Äúquick launch‚Äù of your own business?</a></li>
<li><a href="../301288/index.html">Experience of moving to a Single Page Application with an emphasis on SEO</a></li>
<li><a href="../301290/index.html">UX for beginners: a practical guide. Part 1</a></li>
<li><a href="../301292/index.html">Yum, cheat sheet</a></li>
<li><a href="../301294/index.html">In Russia, launched the first accelerator for FMCG startups</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>