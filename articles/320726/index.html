<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Random Forest: walks in the winter forest</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction 


 This is a small practical guide to the use of machine learning algorithms. Of course, there is a considerable number of machine le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Random Forest: walks in the winter forest</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/9a8/9eb/e8a/9a89ebe8a4844633bbded2a1bf5f58dd.png" alt="Random forest"><br><p><br></p><br><h3 id="1-vstuplenie">  1. Introduction </h3><br><p>  This is a small practical guide to the use of machine learning algorithms.  Of course, there is a considerable number of machine learning algorithms and methods of mathematical (statistical) analysis of information, however, this note is dedicated to Random Forest.  The note shows examples of using this algorithm for problems of classification and regression, and also gives some theoretical explanations. </p><br><a name="habracut"></a><br><h3 id="2-neskolko-slov-o-derevyah">  2. A few words about trees </h3><br><p>  First of all, we will consider some basic theoretical principles of this algorithm, and let us begin with a concept such as decision trees.  Our main task is to make a decision based on the available information.  In the simplest case, we have only one sign (metric, predictor, regressor) with well distinguishable boundaries between classes (the maximum value for one class is clearly less than the minimum value for another).  For example, knowing the body weight, it is necessary to distinguish a whale from a bee, if it is known that among all the observations there is not a single whale that has a body weight like that of a bee.  Therefore, just one indicator (predictor) is enough to give an accurate answer, thus predicting the correct class. </p><br><p>  Suppose that the points of one class (let them be shown in red) in all observations are above the blue points.  A person can draw a straight line between them and say that this will be the border of classes.  Therefore, everything located above this boundary will belong to one class, and everything below the line will belong to another. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ed6/ffc/8c1/ed6ffc8c196749b3beb3c13f29e60b9a.png" alt="Random forest"></div><br><p>  Let's display it in the form of a tree structure.  If we use one of the algorithms (CART) to create a decision tree using the previously specified data, we get the following classification condition: </p><br><pre><code class="hljs pgsql">Conditional inference tree <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> terminal nodes Response: <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>: a Number <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> observations: <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) a &lt;= <span class="hljs-number"><span class="hljs-number">5</span></span>; criterion = <span class="hljs-number"><span class="hljs-number">1</span></span>, statistic = <span class="hljs-number"><span class="hljs-number">31</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)* weights = <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) a &gt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>)* weights = <span class="hljs-number"><span class="hljs-number">16</span></span></code> </pre> <br><p>  Therefore, its visual presentation will be as follows: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d8a/242/012/d8a24201262e49c085a12fb130d2e0ca.png" alt="Random forest"></div><br><p>  Of course, each feature has a different degree of importance.  From the following data set (LibSVM format) it is clear that the first sign (its index is 1, since the numbering does not start from zero) is absolutely identical in representatives of all classes.  In fact, this indicator has no value for classification, therefore, it can be called redundant information that does not carry any practical benefits.  The situation is similar with the second sign (predictor).  However, the third one is different. </p><br><pre> <code class="hljs css">1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 3<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span></code> </pre> <br><p>  It is the third feature (feature 2) that will serve as the cherished distinction with which you can predict the class by vector.  It is logical to assume that the problem can be solved by one single condition (If-Else).  Indeed, each tree in the machine learning algorithm correctly understood the differences.  The following shows debug information (using the Random Forest classifier from the Apache Spark 2.1.0 framework) for several trees of the random forest ensemble. </p><br><pre> <code class="hljs dos"> <span class="hljs-built_in"><span class="hljs-built_in">Tree</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">2</span></span> &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Tree</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">2</span></span> &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Tree</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">2</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">2</span></span> &gt; <span class="hljs-number"><span class="hljs-number">4</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  More complex tasks require more complex trees.  In the following example, the pattern has ceased to be so obvious to humans.  You need to look more closely at the dataset to notice the differences.  The condition will be a bit more complicated, as additional verification is needed. </p><br><pre> <code class="hljs css">1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:15</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:15</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:25</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 1 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:15</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span> 0 1<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> 2<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:20</span></span></code> </pre> <br><p>  These additional checks require new branches (nodes) of the tree.  After each branching, it will be necessary to do more checks, i.e.  new branches.  This can be seen on the debug information.  In order to save space, I cite only a few trees: </p><br><pre> <code class="hljs dos"> <span class="hljs-built_in"><span class="hljs-built_in">Tree</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Tree</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Tree</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> (feature <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">0</span></span> &gt; <span class="hljs-number"><span class="hljs-number">10</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> (feature <span class="hljs-number"><span class="hljs-number">1</span></span> &gt; <span class="hljs-number"><span class="hljs-number">20</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span>) Predict: <span class="hljs-number"><span class="hljs-number">1</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Now let's imagine a data set of a million rows and several hundred (even thousands) columns.  Agree that with simple conditions such tasks will be difficult to solve.  Moreover, under very difficult conditions (deep tree) it may be too specific for a particular data set (retrained).  One tree is resistant to data scaling, but not to noise.  If you combine a large number of trees in one composition, you can get much better results.  The result is a very effective and fairly universal model. </p><br><h3 id="3-random-forest">  3. Random Forest </h3><br><p>  In fact, Random Forest is a composition (ensemble) of many decision trees, which allows to reduce the problem of retraining and improve accuracy in comparison with a single tree.  The forecast is obtained by aggregating the responses of multiple trees.  The training of trees occurs independently of each other (on different subsets), which not only solves the problem of building identical trees on the same data set, but also makes this algorithm very convenient for use in distributed computing systems.  In general, the idea of ‚Äã‚Äãbagging, proposed by Leo Braiman, is well suited for the distribution of calculations. </p><br><p>  For bagging (independent learning of classification algorithms, where the result is determined by voting), it makes sense to use a large number of decision trees with a sufficiently large depth.  During classification, the final result will be the class for which the majority of trees voted, provided that one tree has one vote. </p><br><p>  For example, if a model with 500 trees was formed in the binary classification problem, among which 100 indicate the zero class, and the remaining 400 indicate the first class, then as a result the model will predict exactly the first class.  If you use Random Forest for regression problems, then the approach of choosing the solution for which the majority of trees voted for would be inappropriate.  Instead, there is a choice of the average solution for all trees. </p><br><p>  Random Forest (due to the independent construction of deep trees) requires a lot of resources, and the limitation on depth will damage accuracy (to solve complex problems, you need to build many deep trees).  It can be seen that the training time of trees increases approximately linearly in their number. </p><br><p>  Naturally, an increase in the height (depth) of trees does not have the best effect on performance, but it increases the efficiency of this algorithm (although with this, the tendency to retraining increases).  Too much fear of retraining should not be, as this will be compensated by the number of trees.  But you shouldn't get carried away either.  Everywhere, optimally matched parameters (hyperparameters) are important. </p><br><p>  Consider an example of classification in the R programming language. Since we now need a classification model, rather than a regression model, the first parameter should be explicitly stated that the class is a factor.  In addition to the number of trees, we will pay attention to the number of features (mtry) that the elementary model (tree) will use for branching.  In fact, these are the two main parameters that it makes sense to configure in the first place. </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">library(randomForest) dataset </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">read.csv</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/home/kalinin84/data/real.csv"</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">head</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">TRUE,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">sep</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">","</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span></span><span class="xml"><span class="hljs-tag"> &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">randomForest</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">factor</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Class</span></span></span></span><span class="xml"><span class="hljs-tag">) ~ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">dataset,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ntree</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">250,</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mtry</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">9)</span></span></span></span></span></span></code> </pre> <br><p>  Make sure that this is exactly the model for classification: </p><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">model</span></span>$<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code> </pre> <br><p>  Let's look at the confusion matrix results: </p><br><pre> <code class="hljs perl">model$confusion</code> </pre> <br><p>  It is interesting to see the predicted values ‚Äã‚Äã(based on an out-of-bag): </p><br><pre> <code class="hljs perl">model$predicted</code> </pre> <br><p>  And the varImpPlot and importance functions are intended for displaying the importance of predictors (values ‚Äã‚Äãfor the accuracy of the classifier). </p><br><pre> <code class="hljs lisp">varImpPlot(<span class="hljs-name"><span class="hljs-name">model</span></span>) importance(<span class="hljs-name"><span class="hljs-name">model</span></span>)</code> </pre> <br><p>  Of course, there is a special function for obtaining a probable class.  It is called predict.  The model requires the first argument, and the data set as the second.  The result will be a vector of predicted classes.  For reliable testing, it is necessary to perform training on one data set, and check on another data set. </p><br><p>  One more example.  This time we use Apache Spark 2.1.0 and the Scala programming language.  We read the information from a file of the LibSVM format.  After that, it will be necessary to explicitly divide the data set into two parts.  One of them will be educational, and the second - test.  There is little point in standardizing or normalizing.  Our model is resistant to this, as well as sufficiently resistant to data of different nature (weight, age, income). </p><br><p>  I repeat that the training should be done only on the training sample.  The number of classes in this example will be two.  Let the number of trees be 50. Let's leave the Ginny index as a criterion for splitting, since theoretically the use of entropy would not be a much more effective criterion.  The depth of the tree is limited to nine. </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.mllib.tree.<span class="hljs-type"><span class="hljs-type">RandomForest</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.mllib.tree.model.<span class="hljs-type"><span class="hljs-type">RandomForestModel</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.mllib.util.<span class="hljs-type"><span class="hljs-type">MLUtils</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> data = <span class="hljs-type"><span class="hljs-type">MLUtils</span></span>.loadLibSVMFile(sc, <span class="hljs-string"><span class="hljs-string">"/home/kalinin84/data/real.data"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> splits = data.randomSplit(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-number"><span class="hljs-number">0.3</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> (trainingData, testData) = (splits(<span class="hljs-number"><span class="hljs-number">0</span></span>), splits(<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> model = <span class="hljs-type"><span class="hljs-type">RandomForest</span></span>.trainClassifier(trainingData, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-type"><span class="hljs-type">Map</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Int</span></span>](), <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-string"><span class="hljs-string">"auto"</span></span>, <span class="hljs-string"><span class="hljs-string">"gini"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>)</code> </pre> <br><p>  Now we use a test dataset to check the operation of the classifier with the specified parameters.  It should be noted that the threshold of accuracy (suitability of the model) is determined individually in each specific case. </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.spark.mllib.evaluation.<span class="hljs-type"><span class="hljs-type">BinaryClassificationMetrics</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> result = testData.map(p =&gt; (p.label, model.predict(p.features))) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> metrics = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">BinaryClassificationMetrics</span></span>(result) <span class="hljs-comment"><span class="hljs-comment">// : 1.0 ‚Äî ..    ROC metrics.areaUnderROC // : Array((0.0,0.0), (0.0,1.0), (1.0,1.0), (1.0,1.0)) metrics.roc.collect</span></span></code> </pre> <br><p>  Having received the vector of predictors at the input, the system should guess (with an admissible probability) the class of the object.  If, as a result of several checks on a large data set, this was done, then it is possible to assert the accuracy of the model.  However, no person and no system will be able to guess with very high accuracy on the height of a person his level of education.  Consequently, without properly collected and prepared data it will be difficult (or impossible at all) to solve the problem. </p><br><h3 id="4-neskolko-mysley-o-prakticheskom-primenenii">  4. A few thoughts on practical application </h3><br><p>  There are such situations when a simple condition or methods of descriptive statistics cannot solve the problem right away.  Just in the tasks of improving the efficiency of Internet projects (customer analysis, identifying purchase probability, optimal advertising strategies, selection of products for display in popular blocks, recommendations and personal rankings, classification of entries in catalogs and directories) and there are similar complex data sets. </p><br><p>  I remember a few years ago I first encountered the need to use ML technologies.  There was a situation when my colleagues (the development team) and I tried to come up with a method for classifying materials from a detailed reference on a very large portal.  Previously, the classification was done manually by other specialists, which required a huge amount of time.  But there was no way to automate (the rules and statistical methods did not give the required accuracy).  We already had a set of vectors, which were previously marked out by experts. </p><br><p>  Then I was surprised that several lines of code (using one of the popular machine learning libraries) were able to solve the problem almost immediately.  Naturally, the possibility of using various models (including neural networks) was studied and rational hyperparameters were thought out.  But since this note is about a random forest, the example in the Python programming language will be devoted to him.  Naturally, the example code was written with regard to new versions of ready classifiers, and not used then: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> classification_report, accuracy_score <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-comment"><span class="hljs-comment"># #   # dataset = pd.read_csv('/home/kalinin84/data/real.csv') # #  (   ) # train, test = train_test_split(dataset, test_size = 0.4) classes = train.pop('Class').values features = train testClasses = test.pop('Class').values testFeatures = test # #   # model = RandomForestClassifier(n_estimators=500, max_depth=30).fit(features, classes) # #     # print(classification_report(testClasses, model.predict(testFeatures))) print(accuracy_score(testClasses, model.predict(testFeatures)))</span></span></code> </pre> <br><p>  There are a lot of such examples.  I'll tell you another story.  The task was to increase the effectiveness of a huge advertising management system.  Her work was directly dependent on the accuracy of predicting the rating of goods and services.  Each of them had a vector of 64 signs.  It was strategically important to give in advance a relatively accurate forecast of the value of the rating for each new feature vector.  Prior to this, the system was governed by simple rules and descriptive statistics.  But, as you know, efficiency and accuracy in such matters does not happen much.  To solve the problem of increasing efficiency, a regression model was used, similar to that indicated in the example: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.datasets <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_svmlight_files <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mean_squared_error <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestRegressor <span class="hljs-comment"><span class="hljs-comment"># #   (   ) # X, y, Xt, yt = load_svmlight_files(("/data/001.data", "/data/001_test.data")) # #        # model = RandomForestRegressor(n_estimators=500, max_features=5).fit(X,y) print(mean_squared_error(yt, model.predict(Xt))) # #        #        # import xgboost as xgb modelXGB = xgb.XGBRegressor().fit(X, y) print(mean_squared_error(yt, modelXGB.predict(Xt)))</span></span></code> </pre> <br><p>  As a result, we get a fairly powerful tool for analyzing information that is able to come to the aid in those tasks where other methods do not give the best results. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/320726/">https://habr.com/ru/post/320726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320716/index.html">Passive methods to detect illegal traffic termination</a></li>
<li><a href="../320718/index.html">PHP SQL query</a></li>
<li><a href="../320720/index.html">Own search algorithm for similar images. Theory</a></li>
<li><a href="../320722/index.html">Creating a quest tour of Berlin - step by step instructions</a></li>
<li><a href="../320724/index.html">New Year's Promises by Go-Developer</a></li>
<li><a href="../320728/index.html">Design patterns, iOS view developer. Part 0. Singleton Single</a></li>
<li><a href="../320730/index.html">IBM Model 5100: IBM's first laptop 40 years ago.</a></li>
<li><a href="../320732/index.html">The digest of interesting materials for the mobile # 188 developer (January 23-29)</a></li>
<li><a href="../320734/index.html">Who lives on Habr√©?</a></li>
<li><a href="../320744/index.html">OAuth security in the era of mobile applications, or what the Internet is silent about</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>