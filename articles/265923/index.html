<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Who is the most important VKontakte?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 



 We are already familiar from previous articles on data analysis . Now it is time to talk about one very practical task that we have lea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Who is the most important VKontakte?</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br><img src="https://habrastorage.org/files/0f7/c12/13d/0f7c1213d47a4e14bb6356ac8a00121b.jpeg"><br><br>  We are already familiar from <a href="http://habrahabr.ru/users/akrot/topics/">previous articles on data analysis</a> .  Now it is time to talk about one very practical task that we have learned to solve.  Namely, we will find out <b>who actually controls our opinion on the social network VKontakte</b> .  Code cut many unusual results and interesting mathematics. <br><a name="habracut"></a><br>  <b>Immediately a reservation - we do not mean anything concrete and do not draw any conclusions, we just love math and just use open data</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Many of you will remember that not so long ago we opened <a href="http://mlclass.ru/">one of the open projects</a> in which, under the guidance of experienced people, participants could solve real data analysis tasks and gain experience.  Now it's time to talk about the results and show where we are going next.  To begin, let us recall the problem that we solved. <br><br><h3>  Introduction </h3><br>  It is no secret that lately social networks have become one of the most effective tools for disseminating information.  Not so long ago, the public saw examples when these tools are used for other purposes - you seem to be sitting for yourself - you do not do anything, when suddenly an unknown account is added to friends and involuntarily you begin to receive new incomprehensible entries in the Facebook feed.  To date, there are many methods for the promotion of groups and pages in social networks for generating traffic and the subsequent benefit from this.  It is also far from a secret that Internet companies actively struggle with this kind of activity and cooperate with the relevant departments, since  Often the activity of ‚Äúopinion leaders‚Äù threatens, including the national security of countries. <br><br>  Do you know how you can manage opinion on social networks?  In fact, this is not so difficult - it is important to know which channels to disseminate information.  And here, as always, one cannot do without mathematics, in particular - the theory of graphs. <br><br>  That is why we decided to launch a series of tasks in which we will show <b>how, using a fairly limited API of social networks, learn to find opinion leaders, measure the quality of advertising campaigns and follow the spread of information in social networks using the example of VKontakte</b> . <br><br>  The first, and simplest task that brings us closer to calculating the opinion leaders is the task of <b>identifying users with the maximum number of subscribers within a limited API</b> .  A feature here is that the entire graph of the social network is almost impossible to view.  Given that the monthly VKontakte audience has more than 300 million users, and requests to the API are allowed to do no more than 3 per second, it is easy to figure out that it took about 3 years to calculate the number of subscribers of all people.  <b>We will show how to calculate the TOP100 people with the maximum number of subscribers in a few minutes</b> .  But first, a little dive into formal definitions.  After all, without good mathematics is not enough. <br><br>  From the point of view of mathematics, a social network can be represented as a <b>directed graph</b> , the vertices of which are users, and the edges connecting them signify the fact of friendship / follow / subscription.  At the same time, our graph is oriented - the edges have a direction (depending on who ‚Äúfollowers‚Äù ‚Äã‚Äãfrom whom).  For an undirected graph, the notion of <b>degree</b> (the number of friends of a vertex) is defined.  For the oriented, the incoming degree (the number of ‚Äúfollowers‚Äù) and the outgoing degree (the number of people for whom people are ‚Äúsigned‚Äù). <br><br>  In general, nothing special <b>if many of the graphs that occur in life would not be arranged in a certain way</b> .  For this, there is even a whole science, which is engaged in the study of so-called web graphs.  It all started with the fact that in 1999 the article by A.-L.  Barabashi and R.Albert, in which the authors experimentally investigated the properties of the Internet and proposed the idea of ‚Äã‚Äãits formation, which was subsequently formalized by many authors and is very actively used in practice.  So let's start with those very features of social networks. <br><br><h3>  Properties of real networks </h3><br>  Let us say right away that when we talk about a web graph, by vertices we mean certain units on the Internet, for definiteness, we will consider sites (for example, we can also consider hosts).  The edges will connect those vertices between which there are links.  It is clear that the graph is oriented and multiple edges are allowed.  Even loops (edges from apex into itself) and even multiple loops are allowed. <br><br><h4>  1. The diameter of the web graph is small </h4><br>  This is one of the most famous properties of web type graphs, which many people know as the <b>‚Äútheory of six handshakes,‚Äù</b> which means that any 2 people on Earth know each other in 6 handshakes.  In the language of graph theory, this property means that the graph has a small diameter.  This suggests that the graph should be dense enough, however, it is not. <br><br><h4>  2. Sparseness </h4><br>  A web graph is a fairly <b>sparse</b> graph.  More formally, on <b>n</b> vertices there are only about <b>const * n edges</b> .  It would seem that a large graph of small diameter should be very dense, i.e.  to have about <b>n ^ 2</b> edges, however, the fact remains.  The following property for a person who is not familiar with mathematics does not sound so informative, but it is in the future that will tell you how the graph itself should be formed in order to satisfy all the properties of the real web. <br><br><h4>  3. The power law of the distribution of powers of the vertices </h4><br>  It turns out that the proportion of vertices of degree d in the web graph is estimated as <b>const / d ^ a</b> , where <b>2 &lt;a &lt;3</b> (at the time of the study, the value of <b>a</b> was about <b>2.1</b> ). <br><br>  These are the properties of the Internet.  Now, if we know how the process of such a graph works, we will be able to do many things, starting from what we look for spam structures (many of which are co-dense dicotyledine subgraphs), ending up in order to effectively search for vertices of the maximum degree (about this we will describe below). <br><br><h3>  Preferred Attachment Idea </h3><br>  To date, one of the most common ideas underlying the construction of a web graph is the idea of ‚Äã‚Äãpreferred connection, the logic of which is as follows.  <b>Let's assume that as soon as a new site appears, it will most likely prefer to be on those who are already popular at that time</b> .  More formally - the probability with which the new site will link to an existing one is proportional to the number of links already available to that site. <br><br>  It is clear that the idea described above is poorly formalized and by specifying many details one can obtain many models of web graphs.  So the Bollobash-Riordan, Buckley-Ostgus models, the copy model and many others appeared.  Not so long ago, Yandex even considered <a href="">a whole class of models</a> for which many interesting results <a href="http://arxiv.org/abs/1507.07771">were proved</a> . <br><br>  I hope the reader has an understanding of how the Internet works from the point of view of graph theory.  It turns out that many other real networks, including social.  networks are similar.  That is what will help us in our task. <br><br><h3>  Heuristic algorithm for determining vertices of maximum degree </h3><br>  Now back to our task.  How can we use the properties of real networks described above in order to find the vertices of the maximum degree with a sufficiently high accuracy?  Let's take some number of arbitrary vertices of our graph (for example, from a uniform distribution).  Denote this set of vertices by <b>A.</b>  It is approximately clear that with sufficiently high probability many of them refer to one of some popular peaks.  Let's then remove edges from these vertices (let's see who these vertices are subscribed to) - we denote the set of these vertices by <b>B.</b>  It is clear that some vertices from <b>A</b> refer to the same vertex from <b>B.</b>  For each vertex <b>V</b> of set <b>B, we</b> calculate the number of vertices from <b>A</b> that hit the vertex <b>V.</b>  Thus, we get a lower estimate for the incoming degree (number of subscribers) of each vertex from the set <b>B.</b>  We call this the ‚Äúestimate of the input degree‚Äù of a vertex <b>V.</b> <br><br>  And now the main point that is very difficult to explain to the reader without serious mathematical preparation in more detail than in this article: due to the fact that the social graph has the properties described above, it turns out that the set <b>B</b> will contain exactly the vertices of the maximum degree in the original graph.  Thus, it remains to sort the vertices from the set <b>B</b> according to the ‚Äúestimate of the incoming degree‚Äù and to clarify for each of these vertices the real value of the subscribers in it.  More details about the algorithm and its justification can be found <a href="">here</a> . <br><br>  As you can see, the algorithm is quite simple and not demanding on computing resources.  This is exactly what was supposed to be realized by the participants of our research for the Russian social network VKontakte. <br><br><h4>  Small offtop </h4><br>  As we said earlier, including at past conferences, when teaching people, we try to explain complex things in simple language and give maximum practical skills.  For a person to form a certain image and understanding, sufficient for the practical application of data analysis skills.  That is why we take people from different subject areas, and by sharing experiences with each other, we instill the missing skills of the participants and ourselves. <br><br>  One of the research participants was <a href="https://ru.linkedin.com/in/morozovgleb">Gleb Morozov</a> , who for more than 6 years had been solving analytical problems in large federal retail chains, including, for example, <b>ZAO Tander (Magnit)</b> or <b>TD Megapolis</b> .  After a large number of jointly solved tasks, which he will talk about a little later, Gleb learned how to use machine learning in retail, and the MLClass team gained domain experience.  Gleb will tell about the tasks themselves later on independently, but for now I will give his code, which he used to solve the above task. <br><br><h3>  The implementation of the algorithm in R </h3><br>  Below is a fairly simple and well-commented implementation of this algorithm in <b>R.</b>  Any reader will be able to easily reproduce the result. <br><br><pre><code class="hljs pgsql">library("RCurl") #      API library("jsonlite") #    <span class="hljs-type"><span class="hljs-type">JSON</span></span> library("stringr") #      #     url &lt;- "https://api.vk.com/method/users.getSubscriptions?user_id=" #     url2 &lt;- "https://api.vk.com/method/users.getFollowers?user_id=" #  id   replace (  <span class="hljs-number"><span class="hljs-number">2.8</span></span> . id <span class="hljs-number"><span class="hljs-number">700</span></span>   ) id_num &lt;- sample.int(<span class="hljs-number"><span class="hljs-number">280000000</span></span>, size = <span class="hljs-number"><span class="hljs-number">300</span></span>, replace = T) #    id     get_id_account &lt;- <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(id) { url_get &lt;- str_c(url, id) #    API resp &lt;- getURL(url_get) #     Sys.sleep(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) #      -    #     id  fromJSON(resp)$response$<span class="lua"><span class="lua">users$items } #    -   get_count &lt;- </span><span class="hljs-function"><span class="hljs-keyword"><span class="lua"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="hljs-params"><span class="lua"><span class="hljs-function"><span class="hljs-params">(id)</span></span></span></span></span><span class="lua"> { url_get &lt;- str_c(url2, id) resp &lt;- getURL(url_get) Sys.sleep(</span><span class="hljs-number"><span class="lua"><span class="hljs-number">0.5</span></span></span><span class="lua">) fromJSON(resp)$response$</span></span>count } # ,    get_id_account, id      list account_id &lt;- sapply(id_num, get_id_account) #  list  data.frame account_id &lt;- unlist(account_id) #  -    id   account_id &lt;- <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>(account_id) #   data.frame account_id &lt;- <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.data.frame(account_id) #     account_id &lt;- account_id[<span class="hljs-keyword"><span class="hljs-keyword">order</span></span>(-account_id$Freq),] # ,    get_count, -  result &lt;- sapply(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(account_id$account_id[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>])), get_count) #     -   id  result &lt;- cbind(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.numeric(<span class="hljs-keyword"><span class="hljs-keyword">as</span></span>.character(account_id$account_id[<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">300</span></span>])), result) #     result &lt;- result[<span class="hljs-keyword"><span class="hljs-keyword">order</span></span>(-result[,<span class="hljs-number"><span class="hljs-number">2</span></span>]),] result &lt;- data.frame(id = result[,<span class="hljs-number"><span class="hljs-number">1</span></span>], count_of_followers = result[, <span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>.csv(result, "result_subscribers.csv")</code> </pre> <br><br>  As you can see, the algorithm, that its implementation is very simple.  Now let's take a quick look at the results. <br><br><h3>  results </h3><br>  In just a few minutes we will get the following results (TOP20 vertices of the maximum degree, for a more complete list - <a href="">see here</a> ). <br><br><table><tbody><tr><td>  <b>Person</b> </td><td>  <b># Of subscribers</b> </td></tr><tr><td>  <a href="http://vk.com/id1">Pavel Durov</a> </td><td>  6192543 </td></tr><tr><td>  <a href="http://vk.com/id53083705">Dmitry Medvedev</a> </td><td>  2058871 </td></tr><tr><td>  <a href="http://vk.com/id5592362">Kate Clap</a> </td><td>  1397818 </td></tr><tr><td>  <a href="http://vk.com/id53636214">Ivan Rudskoy</a> </td><td>  1308458 </td></tr><tr><td>  <a href="http://vk.com/id39377403">Nyusha Shurochkina</a> </td><td>  916338 </td></tr><tr><td>  <a href="http://vk.com/id45269508">Mariya Kozhevnikova</a> </td><td>  908909 </td></tr><tr><td>  <a href="http://vk.com/id169902419">Sasha Spielberg</a> </td><td>  837179 </td></tr><tr><td>  <a href="http://vk.com/id87896266">Mikhail Zadornov</a> </td><td>  736109 </td></tr><tr><td>  <a href="http://vk.com/id2677959">Maxim Golopolosov</a> </td><td>  734602 </td></tr><tr><td>  <a href="http://vk.com/id1034437">Victoria Bonya</a> </td><td>  733385 </td></tr><tr><td>  <a href="http://vk.com/id16971887">Christina the Good-natured</a> </td><td>  607419 </td></tr><tr><td>  <a href="http://vk.com/id5401645">Maria wei</a> </td><td>  598583 </td></tr><tr><td>  <a href="http://vk.com/id20020126">Tina Kandelaki</a> </td><td>  541142 </td></tr><tr><td>  <a href="http://vk.com/id79201190">Katya Sambuka</a> </td><td>  538611 </td></tr><tr><td>  <a href="http://vk.com/id2183659">Sofia Temnikova</a> </td><td>  530157 </td></tr><tr><td>  <a href="http://vk.com/id49794138">Alexey Dolmatov</a> </td><td>  518934 </td></tr><tr><td>  <a href="http://vk.com/id44625516">Mikhail Galustyan</a> </td><td>  515012 </td></tr><tr><td>  <a href="http://vk.com/id100897602">Mariana Rozhkova</a> </td><td>  508894 </td></tr><tr><td>  <a href="http://vk.com/id2128351">Vasya Vakulenko</a> </td><td>  445594 </td></tr><tr><td>  <a href="http://vk.com/id38940203">Vladimir Zhirinovsky</a> </td><td>  442578 </td></tr></tbody></table><br>  In general, when we saw this list (and then looked at it further), we made 2 conclusions: <br><ul><li>  The algorithm works. </li><li>  The results are a little overwhelming.  We especially liked the schoolboy Ivan Rudskoy, who made many Russian pop stars </li></ul><br>  We started to doubt how well the algorithm works, but since  we did not find people in open sources with the maximum number of subscribers, we decided to test the algorithm on groups (look for groups with the maximum number of subscribers), since there are lists for them, <a href="http://9net.ru/53-public-vk.html">like this</a> .  And, indeed, having received <a href="">these results</a> , and realizing that VKontakte is not at all the world of the notorious <b>MDK</b> , they were satisfied. <br><br><h3>  TOTAL </h3><br>  Now, after we have obtained such results, we will move on, namely, using the same API to try to build a <b>‚Äúrepost‚Äù graph from the pages of these people</b> , in order to evaluate a person not only by the number of subscribers, but also by how this person is able to spread the opinion, using his influence in the network.  There are ideas how to correctly apply <b>PageRank</b> . <br><br>  If you want to connect to this study and get a very cool experience - join our <a href="http://mlclass.ru/">Data Science community</a> and email me ( <b>al.krot.kav@gmail.com</b> ) a letter with the topic <b>"Opinion Leaders VKontakte"</b> <br><br>  Well, in the meantime, we will continue research and will delight you with new articles from the world of data analysis and good mathematics! <br><br>  <b>UPD</b> <br>  Oh, by the way, found a lot of beautiful girls in this way <br>  Here, for example, <a href="https://vk.com/id109507300">vk.com/id109507300</a> , madam gained subscribers more than many Russian stars.  Enjoy watching! </div><p>Source: <a href="https://habr.com/ru/post/265923/">https://habr.com/ru/post/265923/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265909/index.html">KolibriOS Digest # 9</a></li>
<li><a href="../265911/index.html">2D Platform Implementation Guide (start)</a></li>
<li><a href="../265917/index.html">Vision and Sports Summer School 2015 in Prague: how it was</a></li>
<li><a href="../265919/index.html">What awaits us in Liferay 7.0</a></li>
<li><a href="../265921/index.html">RailsClub 2015: Interview with Koichi Sasada</a></li>
<li><a href="../265929/index.html">We write a synthesizer for the concert. PureData Field Tests</a></li>
<li><a href="../265931/index.html">ReactOS-Hakfest or another option to pro ... code the last month of summer</a></li>
<li><a href="../265933/index.html">PayPal launched service PayPal.Me</a></li>
<li><a href="../265935/index.html">How to quickly and free access to windows on osx or linux</a></li>
<li><a href="../265937/index.html">Stop using React for everything.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>