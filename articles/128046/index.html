<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Robotic Operating System 2 Basics: Tell the World "Hello, world!"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good all the phases of rotation of the Earth! 
 Today, we will continue our acquaintance with the ROS system, which allows us to easily and easily cre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Robotic Operating System 2 Basics: Tell the World "Hello, world!"</h1><div class="post__text post__text-html js-mediator-article">  Good all the phases of rotation of the Earth! <br>  Today, we will continue our acquaintance with the ROS system, which allows us to easily and easily create robot control systems.  For those who missed the previous lesson - an approximate work plan. <br><ol><li>  <a href="http://habrahabr.ru/blogs/robot/128024/">Installation, basic concepts</a> </li><li>  Create your package, get acquainted with the messages, a simple program </li><li>  Services and options </li></ol><br>  Last time we found that the basic element of the ROS is a packet.  The educational process can not pass by this interesting fact, so get a magnifying glass or microscope stronger - we will study! <br><a name="habracut"></a><br>  In this case, the most convenient will be to build your package.  In order not to spoil anything, and to maintain the ROS microflora in good condition, we will create a separate directory for all experiments.  In my case it will be ~ / ros. <br><br><pre><code class="bash hljs">. /opt/ros/electric/setup.sh <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mkdir ros <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./ros <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ROS_PACKAGE_PATH=<span class="hljs-string"><span class="hljs-string">"~/ros:/opt/ros/electric/stacks"</span></span></code> </pre> <br>  The last line sets the environment variable that stores the paths to the standard package repository (number 2) and to the user‚Äôs ones (in this case, path number 1).  A particularly inquisitive reader may suggest that we have created a custom stack.  Alas, it will be an erroneous assumption - we lack the stack.xml manifest file.  However, it is fixable, but now it is absolutely not necessary.  And now is the time for the sacrament. <br><br><h4>  Wrap up please </h4><br>  Packages are created with the roscreate-pkg command and called as follows: <br><pre> <code class="bash hljs">$ roscreate-pkg tutorial std_msgs rospy roscpp</code> </pre><br>  The first argument is the name of the package, then the list of dependencies follows (we'll talk about them a bit later).  Now we need to register our package with the help of the rospack command already known from the last lesson. <br><pre> <code class="bash hljs">rospack profile rospack find tutorial /home/crady/ros/tutorial</code> </pre> <br>  Everything seems to be going well.  But what happens if we run our package on another machine?  And if there is another version of ROS?  And if it is, and then immediately in-oh-oh-oh-oh?  Dependency tracking should help with all this.  ROS identifies 2 types of connections between packets - the first stage and all the rest.  The division immediately becomes clear if you look in the manifest of our module: <br><pre> <code class="bash hljs"> cat ./ros/tutorial/manifest.xml</code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">brief</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tutorial"</span></span></span><span class="hljs-tag">&gt;</span></span> tutorial <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span>crady<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">license</span></span></span><span class="hljs-tag">&gt;</span></span>BSD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">license</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">review</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">status</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"unreviewed"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">notes</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://ros.org/wiki/tutorial<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depend</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"std_msgs"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depend</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rospy"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">depend</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"roscpp"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">package</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Here in the attribute &lt;depend&gt; the dependencies of the first queue are listed.  All that they already require for themselves are ‚Äúindirect‚Äù requirements.  In order not to climb every time in the manifest, you can again use the rospack command: <br><pre> <code class="bash hljs">$ rospack depends1 tutorial std_msgs rospy roscpp $ rospack depends tutorial rospack roslib std_msgs rosgraph_msgs rosbuild roslang rospy cpp_common roscpp_traits rostime roscpp_serialization xmlrpcpp rosconsole roscpp</code> </pre><br>  There is just a little bit of theory left and we will move on to the most delicious thing - writing code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  That's when he tells me ... </h4><br><img src="https://habrastorage.org/storage1/415ccc47/39ae1102/5195ff94/a2f5a654.jpg" align="left">  Suppose that our package is ready and can ... can ... knows how to calculate the energy of a picture using MRF.  Maybe someday I will tell you how and why this is not the point.  In order for this to have any benefit, obviously, our executable file (as you remember from the last lesson, it is called <b>a</b> [node] in terms of ROS) must receive something (for example, a picture) at the input and that something to give (say, a number or even a series of numbers).  Since we have a lot of various libraries, it makes sense to standardize the format of input and output data.  This is done using the <b>message</b> mechanism (msg).  In fact, we get the following system: the <b>publisher</b> (Publisher) talks to the <b>subscriber</b> (Subscriber) on a specific <b>topic</b> (Topic). <br>  So, we have a framework for the future application and some theoretical knowledge.  It's time to build on these ridiculous bones a bit of meat and see what the programs look like in ROS. <br><br><h4>  And so you code ... </h4><br>  The message publisher will write in the wonderful Python language.  In fact, it would have to be a hello-world, but we will go our own way and change the text of the message!  Go to the folder with our package: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> $(rospack find tutorial)</code> </pre> <br>  Create a folder for the script: <br><pre> <code class="bash hljs">$ mkdir scripts</code> </pre> <br>  And create in it a text file of a simple content: <br><pre> <code class="bash hljs">$ vi ./scripts/talker.py</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python #    #      import roslib roslib.load_manifest('tutorial') #   . rospy  ROS  Python, #String -         import rospy from std_msgs.msg import String def talker(): #    chatter     String pub = rospy.Publisher('chatter', String) # ROS,     rospy.init_node('talker') # ROS ,   while not rospy.is_shutdown(): str = "Zooo! %s"%rospy.get_time() rospy.loginfo(str) pub.publish(String(str)) rospy.sleep(1.0) if __name__ == '__main__': try: talker() except rospy.ROSInterruptException: pass</span></span></code> </pre><br><br>  Since this is a talker module, you must specify the format of the messages it publishes: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"string str"</span></span> &gt; ./msg/Str.msg</code> </pre> <br>  The following data types are supported: <br><ul><li>  int8, int16, int32, int64 (and uint *) </li><li>  float32, float64 </li><li>  string </li><li>  time, duration </li><li>  other msg files </li><li>  Variable and fixed-length arrays (array [] and array [C], respectively) </li></ul><br>  All that is needed is to simply list the required fields in the text field, with 1 line corresponding to one parameter.  ‚ÄúIs that all?‚Äù, The reader will ask.  Well, by and large, yes.  The msg code generation takes over the local make.  By the way, it's time for us to do it. <br><pre> <code class="bash hljs"> $ vi ./CMakeLists.txt</code> </pre> <br>  All you need is to uncomment the following line: <br><pre> <code class="bash hljs">rosbuild_genmsg()</code> </pre> <br>  This will make the system understand that the node wants to share information with someone and need to compile the appropriate code. <br>  Everything, we enter into consoles <br><pre> <code class="bash hljs">$ make $ chmod +x ./scripts/listener.py</code> </pre> <br>  and enjoy.  Yes, Python here also requires make, in fact, for messages.  chmod marks the file as executable (this is important!). <br>  In the meantime, we will deal with the interlocutor in an equally remarkable C ++ language.  Yes, the msgs mechanism allows you to communicate with completely different nodes without problems and unnecessary gestures. <br>  Create a new package: <br><pre> <code class="bash hljs">$ roscreate-pkg tutorialSubscriber roscpp std_msgs $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> tutorialSubscriber/ $ vi ./src/listener.cpp</code> </pre> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ros/ros.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"std_msgs/String.h"</span></span></span><span class="hljs-meta"> void chatterCallback(const std_msgs::String::ConstPtr&amp; msg) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//  ROS_INFO("There something on the line! [%s]", msg-&gt;data.c_str()); } int main(int argc, char **argv) { //  listener ros::init(argc, argv, "listener"); ros::NodeHandle n; //,     chatter,        1000, //   -   chatterCallback ros::Subscriber sub = n.subscribe("chatter", 1000, chatterCallback); //spin     callback   ,  ROS    ros::spin(); return 0; }</span></span></span></span></code> </pre> <br><img src="https://habrastorage.org/storage1/e2a80604/5a6195a1/3cd7907f/b3b60bd7.png" align="left">  It remains to change a little make: <br><pre> <code class="bash hljs">vi ./CMakeLists.txt</code> </pre> <br>  It is necessary to bring the penultimate line to the following form: <br><pre> <code class="bash hljs">rosbuild_add_executable(listener src/listener.cpp)</code> </pre> <br>  Run make here, but to compile the executable file. <br>  Everything, it remains to evaluate our works, we open as many as 4 terminals: <br><ol><li>  roscore will launch a master process </li><li>  rosrun tutorial talker.py will launch Publisher </li><li>  rosrun tutorialSubcriber listener will launch the subscriber </li><li>  rxgraph will show us the connection scheme of nodes </li></ol><br>  The diagram shows that the message text will be printed twice - on the listener node and on / rosout, an analogue of stdout. <br><br><h4>  Meanwhile... </h4><br>  Meanwhile, the party is gaining momentum.  People got to the condition and decided to play pool in the pool.  But something went wrong ... <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/HMx1xW2E4Gg%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhhCVomlTQkopNk47MHc_wswMjZyIQ" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/128046/">https://habr.com/ru/post/128046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128040/index.html">Remote access from Windows on FreeBSD for beginners</a></li>
<li><a href="../128041/index.html">New Wi-Fi standard</a></li>
<li><a href="../128042/index.html">DIY disassembler</a></li>
<li><a href="../128044/index.html">1080p on Raspberry Pi</a></li>
<li><a href="../128045/index.html">Notes on restoring embedded systems</a></li>
<li><a href="../128047/index.html">Graph visualization using arbor.js library</a></li>
<li><a href="../128048/index.html">We lift several Ruby on Rails projects on the same server under different versions of ruby ‚Äã‚Äã(Nginx + Unicorn)</a></li>
<li><a href="../12805/index.html">A new version of Bluetooth is coming</a></li>
<li><a href="../128050/index.html">Google bought the company Zagat</a></li>
<li><a href="../128051/index.html">Twitter has 100 million active users.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>