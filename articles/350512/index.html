<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the KOMPAS-3D API ‚Üí Lesson 7 ‚Üí Getting to know the settings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of articles on working with the CAD API KOMPAS-3D Sergey Norseev, an engineer-programmer of the All-Russian Scientific-Research ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the KOMPAS-3D API ‚Üí Lesson 7 ‚Üí Getting to know the settings</h1><div class="post__text post__text-html js-mediator-article">  We continue the cycle of articles on working with the CAD API KOMPAS-3D Sergey Norseev, an engineer-programmer of the All-Russian Scientific-Research Institute ‚ÄúSignal‚Äù, the author of the book ‚ÄúDevelopment of applications for KOMPAS in Delphi‚Äù.  C ++ Builder is used as the medium.  In this lesson we will talk about the KOMPAS system settings. <br><br><img src="https://habrastorage.org/webt/fg/q0/9q/fgq09q7lb_0fhal0jymzenqmaee.png"><br><a name="habracut"></a><br><blockquote><h4>  Content of the cycle of lessons ‚ÄúWorking with the API KOMPAS-3D‚Äù </h4><br>  1. <a href="https://habrahabr.ru/company/ascon/blog/328088/">Basics</a> <br>  2. <a href="https://habrahabr.ru/company/ascon/blog/330588/">Design drawing</a> <br>  3. <a href="https://habrahabr.ru/company/ascon/blog/332554/">Correct connection to COMPAS</a> <br>  4. <a href="https://habrahabr.ru/company/ascon/blog/337288/">Title Block</a> <br>  5. <a href="https://habrahabr.ru/company/ascon/blog/342030/">Graphic primitives</a> <br>  6. <a href="https://habrahabr.ru/company/ascon/blog/346772/">Saving a document in various formats</a> <br>  7. <b>Getting to know the settings</b> <br>  8. More complex methods of writing to the main title <br></blockquote><h2>  <font color="#00B2FF">Read settings</font> </h2><br>  To read the settings, use the <b>KompasObject</b> interface's <b>ksGetSysOptions method</b> .  Below is its prototype. <br><br><pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ksGetSysOptions ( <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> optionsType, <span class="hljs-comment"><span class="hljs-comment">//  LPDISPATCH param //  );</span></span></code> </pre> <br>  The <b>optionsType</b> parameter contains an integer specifying which setting we want to receive.  The <b>param</b> parameter is a pointer to the interface in which the requested setting will be written.  The type of this interface depends on the setting we requested.  The correspondence between the <b>optionsType</b> and <b>param</b> parameters is given in the table below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/ue/rd/cd/uerdcdeftspxqribufcy4zbszs8.png"><br>  <i>Table 1. Correspondence between <b>optionsType</b> and <b>param</b> parameters</i> <br><br>  These constants are declared in the <i>ldefin2d.h</i> file. <br>  If successful, the <b>ksGetSysOptions</b> method returns the value <i>1</i> , and in case of error, the value <i>zero</i> . <br><br>  In a number of places in the KOMPAS documentation, it is indicated that the <b>ksGetSysOptions</b> method allows you to get this or that interface.  However, it is not.  This method allows you to fill the interface, but not get it.  You must get the interface yourself using the <b>KompasObject</b> interface's <b>GetParamStruct method</b> .  If a failed interface is <b>passed</b> to the <b>ksGetSysOptions</b> method, the method will return <i>zero</i> (error). <br><br><h2>  <font color="#00B2FF">Bindings Settings</font> </h2><br>  Looking at Table 1, one can unwittingly assume that to get the <b>SNAP_OPTIONS_EX</b> setting <b>,</b> you must have an active document, and to get the <b>SNAP_OPTIONS</b> setting <b>, the</b> document is not necessary.  In fact, it is not.  As shown by my experiments, if you do not have an active document, the <b>ksGetSysOptions</b> method returns a value of <i>zero</i> (error) for <b>SNAP_OPTIONS</b> , and not for <b>SNAP_OPTIONS_EX</b> .  An error message is displayed. <br><br><img src="https://habrastorage.org/webt/ex/kl/ly/exkllyo7drgeooqx3gmejiha8t0.png"><br>  <i>Error message</i> <br><br>  Please also note that if you encounter the error described above, then you may need to restart KOMPAS to correct it.  The fact is that all subsequent calls to the <b>ksGetSysOptions</b> method, even if there is an active document, will fail. <br><br>  Briefly consider the interface <b>ksSnapOptions</b> .  His properties: <br>  <b>angSnap</b> - whether the ‚Äúsnap‚Äù <b>snap</b> is on ( <i>true</i> - on, <i>false</i> - off); <br>  <b>angleStep</b> - angle pitch ( <i>in degrees</i> ); <br>  <b>commonOpt</b> - set of flags of common bindings (we will not consider); <br>  <b>grid</b> ‚Äî whether <b>gridding</b> is enabled ( <i>true</i> ‚Äî enabled, <i>false</i> ‚Äî disabled); <br>  <b>intersect</b> - if the ‚Äúintersection‚Äù binding is enabled ( <i>true</i> - enabled, <i>false</i> - disabled); <br>  <b>localSnap</b> - type of local binding; <br>  <b>nearestMiddle</b> - whether the midpoint binding is on ( <i>true</i> - on, <i>false</i> - off); <br>  <b>nearestPoint</b> ‚Äî whether the ‚Äúnearest point‚Äù <b>snap</b> is on ( <i>true</i> ‚Äî on, <i>false</i> ‚Äî off); <br>  <b>pointOnCurve</b> - whether the ‚Äúpoint on curve‚Äù snap is on ( <i>true</i> - on, <i>false</i> - off); <br>  <b>tangentToCurve</b> - whether the ‚Äútouch‚Äù binding is enabled ( <i>true</i> - enabled, <i>false</i> - disabled); <br>  <b>xyAlign</b> - whether the alignment binding is on ( <i>true</i> - on, <i>false</i> - off). <br>  There <b>are</b> only three methods for the <b>ksSnapOptions</b> interface: <br>  <b>Init ()</b> - resets all properties, if successful returns <i>true</i> ; <br>  <b>GetCommonOptValue</b> and <b>SetCommonOptValue</b> are designed to work with the <b>commonOpt</b> property. <br>  Below is an example of a program that demonstrates how to work with the <b>ksSnapOptions</b> interface. <br><br><pre> <code class="hljs haskell">//   <span class="hljs-type"><span class="hljs-type">KompasObjectPtr</span></span> kompas; kompas.<span class="hljs-type"><span class="hljs-type">CreateInstance</span></span>(<span class="hljs-type"><span class="hljs-type">L</span></span><span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //   <span class="hljs-type"><span class="hljs-type">DocumentParamPtr</span></span> <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>; <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>=(<span class="hljs-type"><span class="hljs-type">DocumentParamPtr</span></span>)kompas-&gt;<span class="hljs-type"><span class="hljs-type">GetParamStruct</span></span>(ko_DocumentParam); <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">Init</span></span>(); <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>-&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">= lt_DocSheetStandart;//    //  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2DPtr</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class"> = (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2DPtr</span></span></span><span class="hljs-class">)kompas-&gt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">-&gt;ksCreateDocument(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DocumentParam</span></span></span><span class="hljs-class">); //   ksSnapOptionsPtr </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SnapOptions</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SnapOptions</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ksSnapOptionsPtr</span></span></span><span class="hljs-class">)kompas-&gt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetParamStruct</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ko_SnapOptions</span></span></span><span class="hljs-class">); kompas-&gt;ksGetSysOptions(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SNAP_OPTIONS</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SnapOptions</span></span></span><span class="hljs-class">); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ShowMessage</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FloatToStr</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SnapOptions</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">get_angleStep</span></span></span><span class="hljs-class">())); //  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DocumentParam</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SnapOptions</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">(); kompas-&gt;set_Visible(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">); kompas.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">();</span></span></code> </pre><br>  In this example, we define the angle pitch.  For example, on my home computer it was <i>45 ¬∞</i> (you may have another).  Note that this is an extremely simplified example.  It does not implement a correct connection to KOMPAS and error handling is omitted. <br><br><h2>  <font color="#00B2FF">Sheet options</font> </h2><br>  Sheet parameters in the context of settings are described by the <b>ksSheetOptions</b> interface.  This interface is similar to the <b>ksSheetPar</b> interface, which we discussed in the second part of this series of articles.  Consider the properties of the interface <b>ksSheetOptions</b> . <br>  <b>layoutName</b> is the path to the layout library. <br>  <b>sheetType</b> - sheet type ( <i>true</i> - custom format, <i>false</i> - standard sheet); <br>  <b>shtType</b> - the type of the title block from the layoutName library. <br>  The <b>layoutName</b> and <b>shtType</b> properties are similar to those of the <b>ksSheetPar</b> interface with the same name. <br>  There <b>are</b> only two methods for the <b>ksSheetOptions</b> interface: <br>  <b>GetSheetParam</b> - returns the sheet parameters interface ( <b>ksStandartSheet</b> for standard sheets and <b>ksSheetSize</b> for non-standard sheets).  As a single parameter, it accepts a sheet format attribute ( <i>true</i> ‚Äî non-standard sheet, <i>false</i> ‚Äî standard sheet).  Note that the parameter value must match the value of the <b>sheetType</b> property.  This duplication of information remained because of the need for compatibility with some old libraries. <br>  <b>Init ()</b> - resets the values ‚Äã‚Äãof all interface properties. <br>  The following is an example of using this interface to define a sheet format. <br><br><pre> <code class="hljs haskell">//   <span class="hljs-type"><span class="hljs-type">KompasObjectPtr</span></span> kompas; kompas.<span class="hljs-type"><span class="hljs-type">CreateInstance</span></span>(<span class="hljs-type"><span class="hljs-type">L</span></span><span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //    <span class="hljs-type"><span class="hljs-type">SheetOptionsPtr</span></span> <span class="hljs-type"><span class="hljs-type">SheetOptions</span></span>; <span class="hljs-type"><span class="hljs-type">SheetOptions</span></span> = (ksSheetOptionsPtr)kompas-&gt;<span class="hljs-type"><span class="hljs-type">GetParamStruct</span></span>(ko_SheetOptions); //  kompas-&gt;ksGetSysOptions(<span class="hljs-type"><span class="hljs-type">SHEET_OPTIONS_EX</span></span>, <span class="hljs-type"><span class="hljs-type">SheetOptions</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-type"><span class="hljs-type">SheetOptions</span></span>-&gt;get_sheetType()) <span class="hljs-type"><span class="hljs-type">ShowMessage</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //  ksStandartSheetPtr <span class="hljs-type"><span class="hljs-type">StandartSheet</span></span>; <span class="hljs-type"><span class="hljs-type">StandartSheet</span></span> = (ksStandartSheetPtr)<span class="hljs-type"><span class="hljs-type">SheetOptions</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">GetSheetParam</span></span>(false); <span class="hljs-type"><span class="hljs-type">ShowMessage</span></span>(<span class="hljs-type"><span class="hljs-type">IntToStr</span></span>(<span class="hljs-type"><span class="hljs-type">StandartSheet</span></span>-&gt;get_format())); <span class="hljs-type"><span class="hljs-type">StandartSheet</span></span>.<span class="hljs-type"><span class="hljs-type">Unbind</span></span>(); } //  <span class="hljs-type"><span class="hljs-type">SheetOptions</span></span>.<span class="hljs-type"><span class="hljs-type">Unbind</span></span>(); kompas-&gt;set_Visible(true); kompas.<span class="hljs-type"><span class="hljs-type">Unbind</span></span>();</code> </pre><br>  This example defines the parameters of a document sheet.  If it has a non-standard size, then the line ‚ÄúNon-standard sheet‚Äù is displayed.  If it has a standard format, then a number indicating the format is displayed on the screen.  For example, on my home computer the number <i>4</i> is displayed, which sets an <i>A4</i> sheet (it may differ from you). <br><br>  You probably noticed that the example does not create any document.  A reasonable question arises: the format of the sheet of which document we define in the program, if there is no document?  The example defines the format of the new document by default. <br><br>  The KOMPAS documentation also mentions the <b>SHEET_OPTIONS</b> ( <i>3</i> ) constant as an analogue of the <b>SHEET_OPTIONS_EX</b> constant.  However, the <b>SHEET_OPTIONS</b> constant is deprecated and left for compatibility with some older libraries. <br><br><h2>  <font color="#00B2FF">Background colors</font> </h2><br>  Background colors are described by the <b>ksViewColorParam</b> interface.  Consider the properties of this interface. <br><br>  <b>BottomColor</b> - lower transition color, available only for document models. <br>  <b>Color</b> - background color.  If the value of this property is <i>-1</i> , the window color set in the Windows system is used. <br>  <b>TopColor</b> - top color transition, available only for model documents. <br>  <b>UseGradient</b> - sign of using gradient transition ( <i>true</i> - used, <i>false</i> - not used). <br>  Although the KOMPAS API documentation does not explicitly state which color format is used, like in KOMPAS itself, the RGB format is used in the API. <br>  <b>There is</b> only one method for the <b>ksViewColorParam</b> interface. <br>  <b>Init ()</b> - reset values ‚Äã‚Äãof all interface properties.  Returns <i>true</i> if successful. <br>  The following is an example of using this interface. <br><br><pre> <code class="hljs erlang-repl">//   KompasObjectPtr kompas; kompas.CreateInstance(L<span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //    ksViewColorParamPtr ViewColor; ViewColor = (ksViewColorParamPtr)kompas-&gt;GetParamStruct(ko_ViewColorParam); kompas-&gt;ksGetSysOptions(VIEWCOLOR_OPTIONS, ViewColor); DWORD color; color = ViewColor-&gt;get_color(); AnsiString str; str = <span class="hljs-string"><span class="hljs-string">"(0x"</span></span>+IntToHex(GetRValue(color),<span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-string"><span class="hljs-string">";0x"</span></span>+IntToHex(GetGValue(color),<span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-string"><span class="hljs-string">";0x"</span></span>+IntToHex(GetBValue(color),<span class="hljs-number"><span class="hljs-number">2</span></span>) + <span class="hljs-string"><span class="hljs-string">")"</span></span>; ShowMessage(str); //  ViewColor.Unbind(); kompas-&gt;set_Visible(true); kompas.Unbind();</code> </pre><br>  This example determines the background color of the working area of ‚Äã‚Äãthe document and displays it as components of red, green, and blue. <br><br><h2>  <font color="#00B2FF">Data Type Option</font> </h2><br>  A variant is a variable storing a value of some type.  KOMPAS implements options using the <b>ksLtVariant</b> interface.  It has a lot of properties and it is most convenient to consider them relative to the main property - <b>valType</b> .  This property specifies the type of value stored in the variant.  Valid values ‚Äã‚Äãfor this property, as well as other properties for the <b>ksLtVariant</b> interface, <b>are</b> shown in the table below. <br><br><img src="https://habrastorage.org/webt/2y/wi/mb/2ywimbaf-gc9hzlyecokbss44li.png"><br>  <i>Table 2. <b>ksLtVariant</b> interface <b>properties</b></i> <br><br>  These constants are declared in the <i>ldefin2d.h</i> file. <br>  For example, if the value of the <b>valType</b> property is <b>ltv_Uint</b> , then the value stored in the variant is in the <b>uIntVal</b> property.  If the value of the <b>valType</b> property is <b>ltv_Double</b> , then the value stored in the variant is in the <b>doubleVal</b> property. <br><br>  <b>There is</b> only one method for the <b>ksLtVariant</b> interface. <br>  <b>Init ()</b> - resets the values ‚Äã‚Äãof all interface properties.  Returns <i>true</i> if successful. <br><br><h2>  <font color="#00B2FF">Unit Settings</font> </h2><br>  According to Table 1, the unit settings are requested using the <b>LENGTHUNITS_OPTIONS</b> constant.  In this case, the <b>ksGetSysOptions</b> method fills in the <b>ksLtVariant</b> variant of the <b>ltv_Short</b> type.  One of the valid values ‚Äã‚Äãshown in the table below is recorded in the variant. <br><br><img src="https://habrastorage.org/webt/jv/9h/t-/jv9ht-gzv-qvg3okbaqbfhw5u9s.png"><br>  <i>Table 3. Valid <b>ksLtVariant</b> values ‚Äã‚Äãof type <b>ltv_Short</b></i> <br><br>  These constants are declared in the <i>ldefin2d.h</i> file. <br>  Note that the <i>decimeter</i> unit is not supported. <br>  The following is an example of a program that demonstrates unit definitions. <br><br><pre> <code class="hljs haskell">//   <span class="hljs-type"><span class="hljs-type">KompasObjectPtr</span></span> kompas; kompas.<span class="hljs-type"><span class="hljs-type">CreateInstance</span></span>(<span class="hljs-type"><span class="hljs-type">L</span></span><span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //    ksLtVariantPtr <span class="hljs-type"><span class="hljs-type">Variant</span></span>; <span class="hljs-type"><span class="hljs-type">Variant</span></span> = (ksLtVariantPtr)kompas-&gt;<span class="hljs-type"><span class="hljs-type">GetParamStruct</span></span>(ko_LtVariant); kompas-&gt;ksGetSysOptions(<span class="hljs-type"><span class="hljs-type">LENGTHUNITS_OPTIONS</span></span>, <span class="hljs-type"><span class="hljs-type">Variant</span></span>); <span class="hljs-type"><span class="hljs-type">AnsiString</span></span> str; switch(<span class="hljs-type"><span class="hljs-type">Variant</span></span>-&gt;get_shortVal()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">ST_MIX_MM</span></span>: str = <span class="hljs-string"><span class="hljs-string">""</span></span>; break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">ST_MIX_SM</span></span>: str = <span class="hljs-string"><span class="hljs-string">""</span></span>; break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">ST_MIX_DM</span></span>: str = <span class="hljs-string"><span class="hljs-string">""</span></span> ; break; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">ST_MIX_M</span></span> : str = <span class="hljs-string"><span class="hljs-string">""</span></span> ; break; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: str = ""; } <span class="hljs-type"><span class="hljs-type">ShowMessage</span></span>(<span class="hljs-title"><span class="hljs-title">str</span></span>); //  <span class="hljs-type"><span class="hljs-type">Variant</span></span>.<span class="hljs-type"><span class="hljs-type">Unbind</span></span>(); kompas-&gt;set_Visible(<span class="hljs-title"><span class="hljs-title">true</span></span>); kompas.<span class="hljs-type"><span class="hljs-type">Unbind</span></span>();</code> </pre><br>  This program determines the current unit of measurement and displays it on the screen. <br>  In this example, we do not check the type of the variant, relying on the fact that it is of type <b>ltv_Short</b> .  I did this to simplify the example.  In real-world applications, you should always check the type of the variant. <br><br><h2>  <font color="#00B2FF">Change settings</font> </h2><br>  To change the settings, use the <b>KompasObject</b> interface's <b>ksSetSysOptions method</b> .  Below is a prototype of this method. <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ksSetSysOptions ( <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> optionsType, <span class="hljs-comment"><span class="hljs-comment">//  LPDISPATCH param //   );</span></span></code> </pre><br>  It is easy to see that the prototype of this method is similar to the prototype of the <b>ksGetSysOptions</b> method.  The relationship between the type of setting and the interface describing it is also determined by table 1. If successful, the <b>ksSetSysOptions</b> method returns the value <i>1</i> , and in the case of an error, it returns <i>zero</i> . <br>  Note that the modified settings "exist" only during the current KOMPAS session.  After it is restarted, all settings will return to their original value. <br>  Below is an example of a program that demonstrates changing the background color of a document using the <b>ksSetSysOptions</b> method. <br><br><pre> <code class="hljs haskell">//   <span class="hljs-type"><span class="hljs-type">KompasObjectPtr</span></span> kompas; kompas.<span class="hljs-type"><span class="hljs-type">CreateInstance</span></span>(<span class="hljs-type"><span class="hljs-type">L</span></span><span class="hljs-string"><span class="hljs-string">"KOMPAS.Application.5"</span></span>); //   kompas-&gt;set_Visible(true); //   <span class="hljs-type"><span class="hljs-type">DocumentParamPtr</span></span> <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>; <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>=(<span class="hljs-type"><span class="hljs-type">DocumentParamPtr</span></span>)kompas-&gt;<span class="hljs-type"><span class="hljs-type">GetParamStruct</span></span>(ko_DocumentParam); <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">Init</span></span>(); <span class="hljs-type"><span class="hljs-type">DocumentParam</span></span>-&gt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">= lt_DocSheetStandart;//    //  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2DPtr</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class"> = (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2DPtr</span></span></span><span class="hljs-class">)kompas-&gt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">-&gt;ksCreateDocument(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DocumentParam</span></span></span><span class="hljs-class">); //     </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParamPtr</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParam</span></span></span><span class="hljs-class">; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParam</span></span></span><span class="hljs-class"> = (</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParamPtr</span></span></span><span class="hljs-class">)kompas-&gt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">GetParamStruct</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ko_ViewColorParam</span></span></span><span class="hljs-class">); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParam</span></span></span><span class="hljs-class">-&gt;set_color(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RGB</span></span></span><span class="hljs-class">(0,0</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xFF</span></span></span><span class="hljs-class">,0)); //   kompas-&gt;ksSetSysOptions(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VIEWCOLOR_OPTIONS</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParam</span></span></span><span class="hljs-class">); //  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ViewColorParam</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DocumentParam</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">(); </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Document2D</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">(); kompas.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Unbind</span></span></span><span class="hljs-class">();</span></span></code> </pre><br>  In this example, we set the background color to green. <br>  Note: KOMPAS is made visible almost immediately, before changing the settings.  If KOMPAS is made visible after changing a setting, it will not be changed, although the <b>ksSetSysOptions</b> method returns <i>1</i> . <br>  Unfortunately, the <b>ksSetSysOptions</b> method <b>does</b> not allow changing the format of a document sheet. <br><br><h2>  <font color="#00B2FF">The ksGetDocOptions and ksSetDocOptions methods</font> </h2><br>  The <b>ksDocument2D</b> interface contains the <b>ksGetDocOptions</b> and <b>ksSetDocOptions</b> methods that are analogous to the <b>ksGetSysOptions</b> and <b>ksSetSysOptions</b> methods of the <b>KompasObject</b> interface.  All these methods have the same prototype and allow you to read (change) any setting.  The difference is that the methods of the <b>ksDocument2D</b> interface return (change) the settings of not the entire system, but only one document. <br><br>  The KompasObject interface also contains the <b>ksGetDocOptions</b> and <b>ksSetDocOptions methods</b> .  They are similar to the <b>ksDocument2D</b> interface methods of the same name and return (change) the settings of the current document. <br>  The <b>ksGetDocOptions</b> method (of both interfaces) has one (undocumented) difference from the <b>ksGetSysOptions</b> method.  It handles the <b>SHEET_OPTIONS_EX</b> setting somewhat differently.  If the <b>ksGetSysOptions</b> method always returns a <i>one</i> if successful, then this is not the case for the <b>ksGetDocOptions</b> method.  The value returned by it depends on the type of document (standard or not).  If successful, it returns the value <b>lt_DocSheetStandart</b> ( <i>1</i> ) for a standard document and <b>lt_DocSheetUser</b> ( <i>2</i> ) for a non-standard document. <br><br>  Note that in the case of multi-sheet documents, the <b>ksGetDocOptions</b> methods return the <b>SHEET_OPTIONS_EX</b> settings for the first sheet of the document only.  It is impossible to determine the format of subsequent sheets using APIs version 5.  For this you need to use API interfaces 7 versions. <br><br>  The <b>ksSetDocOptions</b> method (of both interfaces) as well as the <b>ksSetDocOptions</b> method <b>does</b> not allow changing the document format. <br><br>  <b>Conclusion</b> <br>  In this article, we met with the properties.  Unfortunately, it‚Äôs impossible to describe them all in detail in one article.  We did not consider in particular the settings of overlapping objects and the size settings, but they are not very complex. <br><br>  <b>To be continued, stay tuned to the blog.</b> <br><br> <a href=""><img src="https://habrastorage.org/web/595/eee/f27/595eeef271b24830b3578751fcb52716.png"></a>  Sergey Norseev, author of the book ‚ÄúDevelopment of applications for KOMPAS in Delphi‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/350512/">https://habr.com/ru/post/350512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350500/index.html">Work with Anaconda on the example of searching for the correlation of cryptocurrency rates</a></li>
<li><a href="../350502/index.html">Rational prioritization of key operations</a></li>
<li><a href="../350504/index.html">Unit testing of react components withRouter (jest, enzyme)</a></li>
<li><a href="../350508/index.html">Lessons to learn from the LLVM / Clang codebase</a></li>
<li><a href="../350510/index.html">Collector task</a></li>
<li><a href="../350514/index.html">Two-tier ERP and SAP Business One: how it works</a></li>
<li><a href="../350516/index.html">Using the KOMPAS-3D API ‚Üí Lesson 8 ‚Üí More complex methods of writing to the title block</a></li>
<li><a href="../350520/index.html">Google, Qualcomm and cloud gaming services. Integration success?</a></li>
<li><a href="../350524/index.html">Results of MentorHack: chat bot for selecting conversations from dialogues, services for building career paths and teams</a></li>
<li><a href="../350526/index.html">WhiteList vs BlackList: how to implement file extension checks and not become a victim of hackers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>