<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JSON-RPC 2.0 and PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are a developer, and you have a project in PHP, and he finally needed to implement his own API - this article is definitely for you;). 

 JSON-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JSON-RPC 2.0 and PHP</h1><div class="post__text post__text-html js-mediator-article">  If you are a developer, and you have a project in PHP, and he finally needed to implement his own API - this article is definitely for you;). <br><br>  <a href="https://secure.wikimedia.org/wikipedia/en/wiki/JSON-RPC">JSON-RPC</a> v1.0 appeared in 2005, 5 years later the <a href="http://www.jsonrpc.org/specification">second version appeared</a> .  In the age of javascript and mobile applications, many developers still use their own bikes instead of a ready-made standard. <br><a name="habracut"></a><br><h4>  Why JSON-RPC, and yes even 2.0? </h4><br>  I will try to highlight key features: <br><ul><li>  It is at least some kind of standard.  A rich selection of libraries for various platforms. </li><li>  Fast easy parsing.  JSON-RPC is not as monstrous as XML-RPC or SOAP. </li><li>  Built-in error handling.  With REST bikes, you have to figure out how to build the answer and what to do with it further. </li><li>  Call Queuing Support.  Now 5 HTTP requests can be wrapped into one :). </li><li>  Single point for API.  For example, /rpc-server.php will be able to handle various methods. </li><li>  Support for named and optional parameters when calling methods. </li></ul><br>  For those familiar with version 1.0, significant innovations in 2.0 were named parameters and a call queue. <br>  A simple request / response is as follows: <br><pre><code class="hljs erlang-repl">--&gt; {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"subtract"</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>: {<span class="hljs-string"><span class="hljs-string">"subtrahend"</span></span>: <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-string"><span class="hljs-string">"minuend"</span></span>: <span class="hljs-number"><span class="hljs-number">42</span></span>}, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>} &lt;-- {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"result"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>} --&gt; {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"subtract"</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>: [<span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>], <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} &lt;-- {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"result"</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} --&gt; [ {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"sum"</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>: [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>} ] &lt;-- [ {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"result"</span></span>: <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"error"</span></span>: {<span class="hljs-string"><span class="hljs-string">"code"</span></span>: -<span class="hljs-number"><span class="hljs-number">32601</span></span>, <span class="hljs-string"><span class="hljs-string">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Method not found."</span></span>}, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"2"</span></span>} ]</code> </pre> <br><br>  In this complicated ‚Äúcreative‚Äù world of programming, the question always arises: to take something ready or write something of your own? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Perfect world.  What do we need? </h4><br>  As usual, we define the criteria for the tool that I want to find / get: <br><ul><li>  <b>Full compliance with the specification.</b>  Given this factor, most likely, there will be no problems with other client / server solutions. </li><li>  <b>Single-file independent implementation.</b>  I don't want to drag along some kind of framework a la Zend or PEAR </li><li>  <b>Availability of tests.</b>  At least some guarantee that the open-source solution will work correctly;) </li><li>  <b>Beautiful realization</b> inside.  Everything should be as simple as possible, understandable and logical. </li><li>  <b>The presence of auto-discover mechanism.</b>  JSON-RPC Server should be able to give meta-information about its methods. </li><li>  <b>Easy connection.</b>  I connected the file, called a couple of methods, everything works. </li><li>  <b>Generate client proxy classes.</b>  Why write a client when we already have a ready server with metadata?  ;) </li></ul><br>  Enough for a start. <br><br><h4>  A bit of theory </h4><br>  Because  JSON-RPC is a fairly young protocol, there are still moments in it that are not fully approved.  One of them is the <a href="http://dojotoolkit.org/reference-guide/1.8/dojox/rpc/smd.html">Service Mapping Description</a> proposed by Dojo.  SMD can fully describe a web service, starting from its methods, ending with expanded return types.  Unfortunately, very few solutions support its implementation, for example, the <a href="http://framework.zend.com/manual/ru/zend.json.server.html">Zend_Json_Server</a> , the inputEx framework ( <a href="http://neyric.github.com/inputex/examples/rpc/smdtester.html">generating the test forms</a> ) and the <a href="http://dojotoolkit.org/reference-guide/1.8/dojox/rpc/SMDLibrary.html">Dojo framework itself</a> . <br><br>  Let us turn to the search for existing solutions. <br><br><h4>  Existing PHP implementations </h4><br>  I took the list of clients from the <a href="https://secure.wikimedia.org/wikipedia/en/wiki/JSON-RPC">tablet in Wikipedia</a> . <br><table><tbody><tr><td></td><td>  <a href="https://bitbucket.org/jbg/php-json-rpc/src">php-json-rpc</a> </td><td>  <a href="https://github.com/mpcm/JSON-RPC-PHP">jsonrpc2php</a> </td><td>  <a href="https://github.com/marcelklehr/tivoka">tivoka</a> </td><td>  <a href="https://github.com/EvilScott/junior/">junior</a> </td><td>  <a href="https://github.com/Pozo/json-rpc-php">json-rpc-php</a> </td><td>  <a href="https://github.com/foglcz/JSONRpc2">JSONRpc2</a> </td><td>  <a href="http://framework.zend.com/manual/ru/zend.json.server.html">Zend</a> <a href="http://framework.zend.com/manual/ru/zend.json.server.html"><br></a>  <a href="http://framework.zend.com/manual/ru/zend.json.server.html">Json</a> <a href="http://framework.zend.com/manual/ru/zend.json.server.html"><br></a>  <a href="http://framework.zend.com/manual/ru/zend.json.server.html">Server</a> </td><td>  <a href="http://sourceforge.net/projects/jsonrpc20api/">zoServices</a> </td></tr><tr><td colspan="9">  <strong>Server</strong> </td></tr><tr><td>  Compliance specification </td><td>  - </td><td>  Proper support for Notification in Batch mode. <br></td><td>  + </td><td>  No optional named params </td><td>  + </td><td>  + </td><td>  + </td><td>  No optional named params </td></tr><tr><td>  Number of files </td><td>  - </td><td>  2 </td><td>  &gt; 7 </td><td>  3 </td><td>  6 </td><td>  one </td><td>  &gt; 5 </td><td>  6 </td></tr><tr><td>  SMD diagram </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  + </td><td>  - </td></tr><tr><td>  Tests </td><td>  - </td><td>  + </td><td>  - </td><td>  + </td><td>  - </td><td>  + </td><td>  + </td><td>  - </td></tr><tr><td>  Internal implementation (1..5) </td><td>  - </td><td>  four <br>  Manual mapping of exported functions </td><td>  3. Too difficult implementation for such a simple task. </td><td>  four </td><td>  4. Difficult </td><td>  4. Magic Inside! </td><td>  4+.  Zend </td><td>  3 </td></tr><tr><td colspan="9">  <strong>Customer</strong> </td></tr><tr><td>  Compliance specification </td><td>  No Batch and Notification </td><td>  - </td><td>  + </td><td>  + </td><td>  + </td><td>  No batch </td><td>  - </td><td>  Notificaiton missing </td></tr><tr><td>  Number of files </td><td>  one </td><td>  - </td><td>  &gt; 7 </td><td>  four </td><td>  2 </td><td>  one </td><td>  - </td><td>  6 </td></tr><tr><td>  Tests </td><td>  - </td><td>  - </td><td>  - </td><td>  + </td><td>  - </td><td>  + </td><td>  - </td><td>  - </td></tr><tr><td>  Internal implementation (1..5) </td><td>  four </td><td>  - </td><td>  3. Extra steps to call methods </td><td>  four </td><td>  four </td><td>  4+.  :) </td><td>  - </td><td>  3 </td></tr><tr><td>  Automatic generation </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td><td>  - </td></tr></tbody></table><br>  A clever reader can argue, what a difference, how many files are used for implementation, you can still glue everything into one.  Yes, it is possible, but this is an additional unnecessary action. <br><br>  As we see, there is no ‚Äúideal‚Äù solution that would suit us and which can be used calmly without a file.  I hope that on other platforms the situation is much better :) <br>  There is a general feeling of the projects being left undone; no solution can offer a full cycle of using the exported API (server, smd-schema, client-generation). <br>  I also do not really understand those developers who are trying to make PHP, say Java or C #.  For the most part, PHP is used in the request / response scheme, and not in the application server scheme with its own states.  The script is the same not compiled closed library. <br><br>  The answer to the question ‚Äúuse something ready‚Äù or ‚Äúwrite your own‚Äù is obvious. <br><br><h4>  Eazy JSON-RPC 2.0 </h4><br>  Project on <a href="https://github.com/sergeyfast/eazy-jsonrpc">github</a> .  All requirements, indicated earlier, are implemented :) <br><br><h5>  Server </h5><br>  There are two use options: either to inherit from the BaseJsonRpcServer class, or to create an instance of it and pass the exported object to the constructor: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'BaseJsonRpcServer.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'tests/lib/DateTimeRpcService.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   $server = new DateTimeRpcService(); //  new BaseJsonRpcServer( new DateTimeService() ); $server-&gt;Execute();</span></span></code> </pre><br>  Thus, we have opened out all public methods of the DateTimeRpcService class.  The SMD scheme can be obtained through the <i>smd</i> GET parameter (for example, <a href="http://eazyjsonrpc/example-server.php%3Fsmd">eazyjsonrpc / example-server.php? Smd</a> ).  At construction of the scheme phpDoc-blocks are considered. <br><div class="spoiler">  <b class="spoiler_title">What is there for such a scheme ...</b> <div class="spoiler_text"><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"transport"</span></span>:<span class="hljs-string"><span class="hljs-string">"POST"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"envelope"</span></span>:<span class="hljs-string"><span class="hljs-string">"JSON-RPC-2.0"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"SMDVersion"</span></span>:<span class="hljs-string"><span class="hljs-string">"2.0"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"contentType"</span></span>:<span class="hljs-string"><span class="hljs-string">"application\/json"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"target"</span></span>:<span class="hljs-string"><span class="hljs-string">"\/example-server.php"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"services"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"GetTime"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>:[{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"timezone"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"default"</span></span>:<span class="hljs-string"><span class="hljs-string">"UTC"</span></span>},{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"format"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"default"</span></span>:<span class="hljs-string"><span class="hljs-string">"c"</span></span>}],<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"Get Current Time"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"returns"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>}},<span class="hljs-attr"><span class="hljs-attr">"GetTimeZones"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>:[],<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"Returns associative array containing dst, offset and the timezone name"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"returns"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"array"</span></span>}},<span class="hljs-attr"><span class="hljs-attr">"GetRelativeTime"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>:[{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"text"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"a date\/time string\r"</span></span>},{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"timezone"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"default"</span></span>:<span class="hljs-string"><span class="hljs-string">"UTC"</span></span>},{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"format"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"default"</span></span>:<span class="hljs-string"><span class="hljs-string">"c"</span></span>}],<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"Get Relative time"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"returns"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>}},<span class="hljs-attr"><span class="hljs-attr">"Implode"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"parameters"</span></span>:[{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"glue"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>},{<span class="hljs-attr"><span class="hljs-attr">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"pieces"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"optional"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"array"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"default"</span></span>:[<span class="hljs-string"><span class="hljs-string">"1"</span></span>,<span class="hljs-string"><span class="hljs-string">"2"</span></span>,<span class="hljs-string"><span class="hljs-string">"3"</span></span>]}],<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"Implode Function"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"returns"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"string"</span></span>}}},<span class="hljs-attr"><span class="hljs-attr">"description"</span></span>:<span class="hljs-string"><span class="hljs-string">"Simple Date Time Service"</span></span>}</code> </pre> <br></div></div><br><br><h5>  Client </h5><br>  Again, there are two use cases: either create an instance of the BaseJsonRpcClient class and pass it the web service link in the constructor, or use the generator: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'BaseJsonRpcClient.php'</span></span>; $client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseJsonRpcClient( <span class="hljs-string"><span class="hljs-string">'http://eazyjsonrpc/example-server.php'</span></span> ); $result = $client-&gt;GetRelativeTime( <span class="hljs-string"><span class="hljs-string">'yesterday'</span></span> );</code> </pre><br><br><h5>  Generator </h5><br>  Based on the SMD scheme, we can generate a class to work with the server (see the example of <a href="https://github.com/sergeyfast/eazy-jsonrpc/blob/master/tests/lib/DateTimeServiceClient.php">DateTimeServiceClient.php</a> ).  To do this, call the generator: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">php</span></span> JsonRpcClientGenerator.php http://eazyjsonrpc/example-server.php?smd DateTimeServiceClient</code> </pre><br>  The result of the command will be the DateTimeServiceClient.php file with the methods we need. <br><br><h5>  A spoon of tar </h5><br>  The unspoken rule for calling <i>class-&gt; method ()</i> in JSON-RPC is using <i>class.method</i> as the method name (through a dot). <br>  In the current implementation of this functionality is not provided.  It is assumed that the url is an exported class, then the option with dots disappears :).  Regarding the client side, you can always add something here, it's just PHP. <br><br>  It is also possible in SMD to describe the returned types as objects with their properties, but due to the complexity of the implementation, we will omit this moment. <br><br>  For those who want to find detailed documentation, I can suggest reading the method names again, phpDoc comments for them, and the source code of the Server or Client. <br><br><h4>  Lifehacks </h4><br><h5>  What we have with authentication? </h5><br>  There are several implementation options: <br><ol><li>  Use HTTP Basic Auth.  In the client, it is enough to add a login and password to the $ CurlOptions array :) </li><li>  Use tokens via HTTP headers.  To obtain tokens, you can write the necessary method. </li><li>  Use tokens as method parameters. </li></ol><br><h5>  How to deal with file uploads? </h5><br>  Some people offer a strange variant with encoding a file in base64 and sending it in some field. <br>  A more or less normal solution is to implement a method that tells you where to start downloading a file. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="hljs erlang-repl">--&gt; {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"send_image"</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>: ..., <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} &lt;-- {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"result"</span></span>: {<span class="hljs-string"><span class="hljs-string">"URL"</span></span>: <span class="hljs-string"><span class="hljs-string">"/exampleurl?id=12345"</span></span>, <span class="hljs-string"><span class="hljs-string">"maxsize"</span></span>: <span class="hljs-number"><span class="hljs-number">10000000</span></span>, <span class="hljs-string"><span class="hljs-string">"accepted-format"</span></span>:[<span class="hljs-string"><span class="hljs-string">"jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"png"</span></span>]}, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} --&gt;      .      ,    --&gt; {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"send_done"</span></span>, <span class="hljs-string"><span class="hljs-string">"params"</span></span>: {<span class="hljs-string"><span class="hljs-string">"checksum"</span></span>: <span class="hljs-string"><span class="hljs-string">"1a5e8f13"</span></span>}, <span class="hljs-string"><span class="hljs-string">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>} &lt;-- {<span class="hljs-string"><span class="hljs-string">"jsonrpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"result"</span></span>: <span class="hljs-string"><span class="hljs-string">"ok"</span></span>}</code> </pre></div></div><br><h5>  Error processing </h5><br>  The protocol itself already provides for the presence of an <i>error</i> object with the <i>code</i> , <i>message,</i> and <i>data</i> fields.  When using BaseJsonRpcServer inside the called method, you can throw an Exception in which to pass <i>code</i> and <i>data</i> .  You can add your <i>message</i> to the $ errorMessages array at a specific <i>code</i> . <br><br><h5>  Exporting objects with specific fields only. </h5><br>  It is all up to you, how you implement it - so be it.  I can only advise to create some class <i>ObjectToJsonConverter</i> , in which to implement the transformation of the object into the desired array. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-class"><span class="hljs-keyword"><span class="php"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span><span class="php"><span class="hljs-class"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-class"><span class="hljs-title">ObjectToJsonConverter</span></span></span></span><span class="php"><span class="hljs-class"> </span></span></span><span class="php">{ </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="php"><span class="hljs-comment"> City $city * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span></span><span class="php"><span class="hljs-comment"> array */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">static</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">GetCity</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">( City $city )</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">return</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'id'</span></span></span><span class="php"> =&gt; $city-&gt;cityId , </span><span class="hljs-string"><span class="php"><span class="hljs-string">'name'</span></span></span><span class="php"> =&gt; $city-&gt;title , </span><span class="hljs-string"><span class="php"><span class="hljs-string">'region'</span></span></span><span class="php"> =&gt; $city-&gt;region-&gt;title ); } } </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">// -     return array_map( 'ObjectToJsonConverter::GetCity', $cities );</span></span></span></span></code> </pre></div></div><br><br><h5>  Conversion to client-side objects </h5><br>  Here again, it all depends on you.  For example, you can create the required classes and write some simple converter back (ideas on conversion can be taken in <a href="http://api.myshows.ru/shared/samples/MyShowsClient.php">MyShowsClient.php</a> ) <br><br><h4>  Conclusion </h4><br>  Hopefully, after reading the article, JSON-RPC will not be deprived of attention when choosing an interaction protocol. <br>  Even after covering the tests&gt; 89% of the code, I can only say: "It seems to work" :) </div><p>Source: <a href="https://habr.com/ru/post/150803/">https://habr.com/ru/post/150803/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150797/index.html">The story of our startup Dia-Life - the service of adherence to diets and compensation for diabetes</a></li>
<li><a href="../150798/index.html">Generators vs classes</a></li>
<li><a href="../150800/index.html">Microsoft Project delenda est</a></li>
<li><a href="../150801/index.html">A little bit about multi-threaded programming. Part 1. Synchronization is evil or not.</a></li>
<li><a href="../150802/index.html">7 lessons learned from creating Reddit</a></li>
<li><a href="../150804/index.html">Researchers uncover the location of the Pirate Bay uploaders</a></li>
<li><a href="../150805/index.html">LISP interpreter on pure C</a></li>
<li><a href="../150806/index.html">Yii in phar</a></li>
<li><a href="../150807/index.html">Moscow Air Quality Monitoring System</a></li>
<li><a href="../150808/index.html">About sorting content based on user ratings: Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>