<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The Complete Docker Practical Guide: From Scratch to AWS Cluster</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Content 


- Questions and answers 
- Introduction Pre-requisites Computer settings 
- Pre-requisites 
- Computer settings 
- 1.0 Playing with Busybox...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The Complete Docker Practical Guide: From Scratch to AWS Cluster</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/b5a/800/403/b5a800403b774406a4529c1d7addd037.jpg"></p><br><br><h2>  Content </h2><br><ul><li>  <a href="https://habr.com/ru/post/310460/">Questions and answers</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">Introduction</a> <br><ul><li>  <a href="https://habr.com/ru/post/310460/">Pre-requisites</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">Computer settings</a> <br></li></ul><br></li><li>  <a href="https://habr.com/ru/post/310460/">1.0 Playing with Busybox</a> <br><ul><li>  <a href="https://habr.com/ru/post/310460/">1.1 Docker Run</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">1.2 Terminology</a> <br></li></ul><br></li><li>  <a href="https://habr.com/ru/post/310460/">2.0 Web Applications and Docker</a> <br><ul><li>  <a href="https://habr.com/ru/post/310460/">2.1 Static sites</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">2.2 Images</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">2.3 Our first image</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">2.4 Dockerfile</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">2.5 Docker on AWS</a> <br></li></ul><br></li><li>  <a href="https://habr.com/ru/post/310460/">3.0 Multiple Container Environments</a> <br><ul><li>  <a href="https://habr.com/ru/post/310460/">3.1 SF Food Trucks</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">3.2 Docker networks</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">3.3 Docker Compose</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">3.4 AWS Elastic Container Service</a> <br></li></ul><br></li><li>  <a href="https://habr.com/ru/post/310460/">4.0 Conclusion</a> <br><ul><li>  <a href="https://habr.com/ru/post/310460/">4.1 Next steps</a> <br></li><li>  <a href="https://habr.com/ru/post/310460/">4.2 Feedback to the author</a> <br></li></ul></li></ul><br><p><a name="faq"></a></p><h2>  Questions and answers </h2><br><h3>  What is a docker? </h3><br><p>  The definition of <a href="https://www.docker.com/">Docker</a> on Wikipedia is: </p><br><blockquote><p>  software to automate the deployment and management of applications in a virtualization environment at the operating system level;  allows you to "pack" the application with all its environments and dependencies into a container, and also provides a container management environment. </p><br></blockquote><br><p>  Wow!  How much information. <a name="habracut"></a>  In simple words, Docker is a tool that allows developers, system administrators, and other professionals to deploy their sandbox applications (called <em>containers</em> ) to run on a target operating system, such as Linux.  The key advantage of Docker is that it allows users to <strong>package the application with all its dependencies in a standardized module</strong> for development.  Unlike virtual machines, containers do not create such an extra load, so you can use the system and resources more efficiently with them. </p><br><h3>  What is a container? </h3><br><p>  The standard in the industry today is to use virtual machines to run applications.  Virtual machines run applications inside the guest operating system that runs on the virtual hardware of the main server operating system. </p><br><p>  Virtual machines are great for completely isolating the process for an application: almost no problems with the underlying operating system can affect the software of the guest OS, and vice versa.  But for this isolation you have to pay.  There is a significant computational load required for guest OS virtualization. </p><br><p>  Containers use a different approach: they provide isolation levels similar to virtual machines, but due to the proper use of the low-level mechanisms of the main operating system, they do so with a much smaller load. </p><br><h3>  Why should I use them? </h3><br><p>  Docker's takeoff was truly epic.  Despite the fact that the containers themselves are not a new technology, until Docker they were not so common and popular.  Docker changed the situation by providing a standard API, which greatly simplified the creation and use of containers, and allowed the community to work together on container libraries.  An article published in <a href="http://www.theregister.co.uk/2014/05/23/google_containerization_two_billion/">The Register</a> in mid-2014 states that Google supports more than <strong>two billion containers per week</strong> . </p><br><p>  <strong>Google Trends for 'Docker'</strong> <br><img src="https://habrastorage.org/files/469/7ad/a07/4697ada0727345c9a8f5ac7f8553ec70.png" alt="interest"></p><br><p>  In addition to Docker's continued growth, the company-developer Docker Inc.  was valued at more than two billion dollars!  With its advantages in efficiency and portability, Docker began to receive more and more support, and now he is at the head of the <strong>containerization</strong> movement.  As modern developers, we need to understand this trend and find out how we can benefit from it. </p><br><h3>  What will this manual teach me? </h3><br><p>  This is a single and complete manual on all aspects of working with Docker.  In addition to explaining the myths about Docker and his ecosystem, it will allow you to get a little experience in building and deploying your own web applications in the cloud.  We will use <a href="http://aws.amazon.com/">Amazon Web Services</a> for deploying static sites, and two dynamic web applications will be secured on <a href="https://aws.amazon.com/ec2/">EC2</a> using <a href="https://aws.amazon.com/elasticbeanstalk/">Elastic Beanstalk</a> and <a href="https://aws.amazon.com/ecs/">Elastic Container Service</a> .  Even if you never deploili, this manual will give you everything you need. </p><br><h2>  How to use this document </h2><br><p>  This document contains several sections, each of which is devoted to a particular aspect of Docker.  In each section, we will enter commands or write code.  All code is available in <a href="http://github.com/prakhar1989/docker-curriculum">the Github repository</a> . </p><br><p><a name="intro"></a></p><h2>  Introduction </h2><p></p><br><blockquote><p>  Note: This manual uses Docker version <strong>1.12.0-rc2</strong> .  If you encounter an incompatibility, please send an <a href="https://github.com/prakhar1989/docker-curriculum/issues">issue</a> .  Thank! </p><br></blockquote><br><p><a name="prereq"></a></p><h3>  Pre-requisites </h3><p></p><br><p>  All you need to complete this tutorial is basic command line skills and a text editor.  Experience in developing web applications will be useful, but not required.  During the work we will encounter several cloud services.  You will need to create an account on these sites: </p><br><ul><li>  <a href="http://aws.amazon.com/">Amazon Web Services</a> </li><li>  <a href="https://hub.docker.com/">Docker hub</a> </li></ul><br><p><a name="setup"></a></p><h3>  Computer settings </h3><p></p><br><p>  Installing and configuring all the necessary tools can be a difficult task, but, fortunately, Docker has become quite stable, and installing and running it on any OS has become a very simple task.  So, install Docker. </p><br><h5>  Docker </h5><br><p>  A few more releases ago, the launch of Docker on OS X and Windows was problematic.  But the development team has done a tremendous job, and today the whole process has nowhere else.  This tutorial <em>getting started</em> includes detailed installation instructions for <a href="https://www.docker.com/products/docker">Mac</a> , <a href="https://www.docker.com/products/docker">Linux</a> and <a href="https://www.docker.com/products/docker">Windows</a> . </p><br><p>  Check if everything is installed correctly: </p><br><pre><code class="bash hljs">$ docker run hello-world Hello from Docker. This message shows that your installation appears to be working correctly. ...</code> </pre> <br><h5>  Python </h5><br><p>  Python is usually pre-installed on OS X and on most Linux distributions.  If you need to install Python, then download the installer <a href="https://www.python.org/downloads/">here</a> . </p><br><p>  Check version: </p><br><pre> <code class="bash hljs">$ python --version Python 2.7.11</code> </pre><br><p>  We will use <a href="https://pip.readthedocs.org/en/stable/">pip</a> to install packages for our application.  If pip is not installed, then <a href="http://pip.readthedocs.org/en/stable/installing/">download the</a> version for your system. </p><br><p>  To check, run the following command: </p><br><pre> <code class="bash hljs">$ pip --version pip 7.1.2 from /Library/Python/2.7/site-packages/pip-7.1.2-py2.7.egg (python 2.7)</code> </pre><br><h5>  Java (optional) </h5><br><p>  The application we are developing will use <a href="https://www.elastic.co/">Elasticsearch</a> for storage and retrieval.  To run Elasticsearch locally, you'll need Java.  In this tutorial, everything will run inside the container, so you don‚Äôt need to have Java locally.  If Java is installed, the <code>java -version</code> should generate a similar output: </p><br><pre> <code class="bash hljs">$ java -version java version <span class="hljs-string"><span class="hljs-string">"1.8.0_60"</span></span> Java(TM) SE Runtime Environment (build 1.8.0_60-b27) Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)</code> </pre><br><hr><br><p><a name="bb"></a></p><h2>  1.0 Playing with Busybox </h2><p></p><br><p>  Now that everything you need is set, it's time to get to work.  In this section, we will launch the <a href="https://en.wikipedia.org/wiki/BusyBox">Busybox</a> container on our system and try to run the <code>docker run</code> . </p><br><p>  To get started, run the following command: </p><br><pre> <code class="bash hljs">$ docker pull busybox</code> </pre><br><blockquote><p>  Attention: depending on how you installed Docker on your system, you may <code>permission denied</code> messages.  If you are on a Mac, then make sure that the Docker engine is running.  If you're on Linux, then run this command with <code>sudo</code> .  Or you can <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">create a docker group</a> to get rid of this problem. </p><br></blockquote><br><p>  The <code>pull</code> command downloads the busybox image from Docker's <a href="https://hub.docker.com/explore/"><strong>register</strong></a> and saves it locally.  You can use the <code>docker images</code> to view a list of images in the system. </p><br><pre> <code class="bash hljs">$ docker images REPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE busybox latest c51f86c28340 4 weeks ago 1.109 MB</code> </pre><br><p><a name="dockerrun"></a></p><h3>  1.1 Docker Run </h3><p></p><br><p>  Fine!  Now let's run the Docker <strong>container</strong> with this image.  For this we use the <code>docker run</code> magic command: </p><br><pre> <code class="bash hljs">$ docker run busybox $</code> </pre><br><p>  Wait, nothing happened!  Is this a bug?  Well no.  Under the hood, a lot of things happened.  The docker client found an image (in our case, busybox), loaded the container and ran the command inside this container.  We did the <code>docker run busybox</code> , but did not specify any commands, so the container was loaded, an empty command was launched and the program was terminated.  Well, yes, somehow offensive, so let's do something more interesting. </p><br><pre> <code class="bash hljs">$ docker run busybox <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"hello from busybox"</span></span> hello from busybox</code> </pre><br><p>  Hurray, finally some kind of conclusion.  In our case, the Docker client obediently launched the <code>echo</code> command inside the container, and then left it.  You probably noticed that everything happened very quickly.  Now imagine how you need to boot a virtual machine, run a command in it and turn it off.  Now it‚Äôs clear why the containers are said to be fast! </p><br><p>  Now let's take a look at the <code>docker ps</code> .  It displays a list of all running containers. </p><br><pre> <code class="bash hljs">$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES</code> </pre><br><p>  There are no containers now, so an empty line is displayed.  Not very useful, so let's run a more useful option: <code>docker ps -a</code> </p><br><pre> <code class="bash hljs">$ docker ps -a CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 305297d7a235 busybox <span class="hljs-string"><span class="hljs-string">"uptime"</span></span> 11 minutes ago Exited (0) 11 minutes ago distracted_goldstine ff0a5c3750b9 busybox <span class="hljs-string"><span class="hljs-string">"sh"</span></span> 12 minutes ago Exited (0) 12 minutes ago elated_ramanujan</code> </pre><br><p>  Now we see a list of all the containers that we launched.  In the <code>STATUS</code> column, you can see that the containers completed their work a few minutes ago. </p><br><p>  You are probably wondering how to run more than one command in a container.  Let's try: </p><br><pre> <code class="bash hljs">$ docker run -it busybox sh / <span class="hljs-comment"><span class="hljs-comment"># ls bin dev etc home proc root sys tmp usr var / # uptime 05:45:21 up 5:58, 0 users, load average: 0.00, 0.01, 0.04</span></span></code> </pre><br><p>  The <code>run</code> command with the <code>-it</code> flag connects the interactive tty to the container.  Now you can run as many commands as you like inside.  Try it. </p><br><blockquote><p>  <strong>Dangerously!</strong>  : If you want a thrill, you can try the <code>rm -rf bin</code> in a container.  But make sure you run it inside the container, <strong>not outside</strong> .  If you do it outside on your computer, it will be very bad, and commands like <code>ls</code> , <code>echo</code> will stop working.  When everything inside the container stops working, just exit and restart it with the <code>docker run -it busybox sh</code> .  The docker creates a new container at launch, so everything will work again. </p><br></blockquote><br><p>  On this exciting tour of the capabilities of the <code>docker run</code> team is over.  Most likely, you will use this command quite often.  So it is important that we understand how to handle it.  To learn more about <code>run</code> , use <code>docker run --help</code> , and see a full list of supported flags.  Soon we will see some more ways to use the <code>docker run</code> . </p><br><p>  Before continuing, let's take a quick look at the removal of containers.  We saw above that with the help of the <code>docker ps -a</code> you can still see the remnants of the completed containers.  Throughout this tutorial, you will run the <code>docker run</code> several times, and the remaining, homeless containers will eat up disk space.  So I made it a rule to remove containers after completing work with them.  To do this, use the <code>docker rm</code> .  Just copy the ID (several) from the output above and pass the parameters to the command. </p><br><pre> <code class="bash hljs">$ docker rm 305297d7a235 ff0a5c3750b9 305297d7a235 ff0a5c3750b9</code> </pre><br><p>  When deleted, identifiers will be displayed again.  If you need to remove a lot of containers, instead of manually copying and pasting, you can do this: </p><br><pre> <code class="bash hljs">$ docker rm $(docker ps -a -q -f status=exited)</code> </pre><br><p>  This command removes all containers that have <code>exited</code> status.  The <code>-q</code> flag returns only numeric IDs, and the <code>-f</code> flag filters output based on the provided conditions.  The last useful detail is that the <code>--rm</code> flag can be passed to the <code>docker run</code> <code>--rm</code> , then the container will be automatically deleted upon completion.  This is very useful for one-time launches and experiments with Docker. </p><br><p>  You can also delete unnecessary images with the <code>docker rmi</code> . </p><br><p><a name="terminology"></a></p><h3>  1.2 Terminology </h3><p></p><br><p>  In the previous section, we used a lot of Docker-specific jargon, and this can be confusing to many.  Before continuing, let's examine some terms that are often used in the Docker ecosystem. </p><br><ul><li>  <em>Images</em> (images) - Schemes of our application, which are the basis of containers.  In the example above, we used the <code>docker pull</code> to download the <strong>busybox</strong> image. </li><li>  <em>Containers</em> (containers) - Created on the basis of the image and run the application itself.  We created the container with the <code>docker run</code> , and used the busybox image that we downloaded earlier.  The list of running containers can be viewed using the <code>docker ps</code> . </li><li>  <em>Docker Daemon</em> ‚Äî A background service running on a host machine that is responsible for creating, launching, and destroying Docker containers.  A daemon is a process that runs on the operating system with which the client interacts. </li><li>  <em>Docker Client</em> ( <em>Docker</em> client) - A command line utility that allows the user to interact with the daemon.  There are other forms of client, for example, <a href="https://kitematic.com/">Kitematic</a> , with a graphical interface. </li><li>  <em>Docker Hub</em> - <a href="https://hub.docker.com/explore/">Register</a> Docker-images.  Roughly speaking, the archive of all available images.  If necessary, you can keep your own register and use it to get images. </li></ul><br><p><a name="webapps"></a></p><h2>  2.0 Web Applications and Docker </h2><p></p><br><p>  Super!  Now we have learned how to work with the <code>docker run</code> , played with several containers and understood the terminology.  Armed with this knowledge, we are ready to move on to real things: deploying web applications with Docker! </p><br><p><a name="static"></a></p><h3>  2.1 Static sites </h3><p></p><br><p>  Let's start small.  First, consider the simplest static website.  Download the image from the Docker Hub, run the container and see how easy it will be to start the web server. </p><br><p>  Go.  For a one-page <a href="http://github.com/prakhar1989/docker-curriculum">site,</a> we need an image that I created in advance for this tutorial and placed in the <a href="https://hub.docker.com/r/prakhar1989/static-site/">register</a> - <code>prakhar1989/static-site</code> .  You can download the image directly with the <code>docker run</code> . </p><br><pre> <code class="bash hljs">$ docker run prakhar1989/static-site</code> </pre><br><p>  Since the image does not exist locally, the client first downloads the image from the register, and then starts it.  If everything is okay, then you will see the message <code>Nginx is running...</code> in the terminal.  Now the server is running.  How to see the site in action?  What port is the server running on?  And, most importantly, how to directly reach the container from the host container? </p><br><p>  In our case, the client does not open any ports, so you will need to restart the <code>docker run</code> to make the ports public.  At the same time, let's make sure that the terminal is not attached to the running container.  In this case, you can safely close the terminal, and the container will continue to work.  This is called <strong>detached</strong> mode. </p><br><pre> <code class="bash hljs">$ docker run -d -P --name static-site prakhar1989/static-site e61d12292d69556eabe2a44c16cbd54486b2527e2ce4f95438e504afb7b02810</code> </pre><br><p>  The <code>-d</code> flag will detach the terminal, the <code>-P</code> flag will make all open ports public and random, and finally the <code>--name</code> flag is the name we want to give to the container.  Now you can see the ports with the <code>docker port [CONTAINER]</code> . </p><br><pre> <code class="bash hljs">$ docker port static-site 80/tcp -&gt; 0.0.0.0:32769 443/tcp -&gt; 0.0.0.0:32768</code> </pre><br><p>  Open <a href="http://localhost:32769/">http: // localhost: 32769</a> in your browser. </p><br><blockquote><p>  Note: If you are using the docker-toolbox, you may need to use <code>docker-machine ip default</code> to get the IP address. </p><br></blockquote><br><p>  You can also mark your port.  The client will redirect connections to it. </p><br><pre> <code class="bash hljs">$ docker run -p 8888:80 prakhar1989/static-site Nginx is running...</code> </pre><br><p><img src="https://habrastorage.org/files/eeb/188/7e6/eeb1887e65cd4703bcf2612122072eff.png" alt="static"></p><br><p>  To stop a container, launch <code>docker stop</code> and specify the identifier (ID) of the container. </p><br><p>  Agree, everything was very simple.  To set this up on a real server, you just need to install Docker and run the command above.  Now that you have seen how to run a web server inside an image, you are probably wondering - how to create your own Docker image?  We will explore this topic in the next section. </p><br><p><a name="images"></a></p><h3>  2.2 Images </h3><p></p><br><p>  We have dealt with images earlier, but in this section we take a deeper look: what are Docker images and how to create our own images.  Finally, we use our own image to run the application locally, and then upload it to <a href="http://aws.amazon.com/">AWS</a> to show friends.  Cool?  Cool!  Let's start. </p><br><p>  Images are the basis for containers.  In the last example, we downloaded ( <strong>pull</strong> ) an image called <em>Busybox</em> from the register, and asked the Docker client to launch a container <strong>based</strong> on that image.  To see a list of images available locally, use the <code>docker images</code> . </p><br><pre> <code class="bash hljs">$ docker images REPOSITORY TAG IMAGE ID CREATED VIRTUAL SIZE prakhar1989/catnip latest c7ffb5626a50 2 hours ago 697.9 MB prakhar1989/static-site latest b270625a1631 21 hours ago 133.9 MB python 3-onbuild cf4002b2c383 5 days ago 688.8 MB martin/docker-cleanup-volumes latest b42990daaca2 7 weeks ago 22.14 MB ubuntu latest e9ae3c220b23 7 weeks ago 187.9 MB busybox latest c51f86c28340 9 weeks ago 1.109 MB hello-world latest 0a6ba66e537a 11 weeks ago 960 B</code> </pre><br><p>  This is a list of images that I downloaded from the register, as well as those that I did myself (see soon how to do it).  <code>TAG</code> is a specific snapshot or snapshot of an image, and <code>IMAGE ID</code> is the corresponding unique image identifier. </p><br><p>  For simplicity, you can treat the image as a git repository.  You can <a href="https://docs.docker.com/engine/reference/commandline/commit/">commit images</a> with changes, and you can have several versions.  If you do not specify a specific version, the client defaults to the <code>latest</code> .  For example, you can download a specific version of the <code>ubuntu</code> image: </p><br><pre> <code class="bash hljs">$ docker pull ubuntu:12.04</code> </pre><br><p>  To get a new Docker image, you can download it from the registry (such as Docker Hub) or create your own.  There are tens of thousands of images on the <a href="https://hub.docker.com/explore/">Docker Hub</a> .  You can search directly from the command line using <code>docker search</code> . </p><br><p>  It is important to understand the difference between basic and child images: </p><br><ul><li>  <strong>Base images</strong> (base images) are images that do not have a parent image.  These are usually operating system images such as ubuntu, busybox or debian. </li><li>  <strong>Child images</strong> (child images) are images that are built on basic images and have additional functionality. </li></ul><br><p>  There are official and custom images, and any of them can be basic and child. </p><br><ul><li>  <strong>Official images</strong> are images that are officially supported by the Docker team.  Usually in their name one word.  In the list above, <code>python</code> , <code>ubuntu</code> , <code>busybox</code> and <code>hello-world</code> are basic images. </li><li>  <strong>Custom images</strong> are images created by ordinary users like you and me.  They are built on basic images.  Usually, they are named after the <code>user/image-name</code> format. </li></ul><br><p><a name="ownimage"></a></p><h3>  2.3 Our first image </h3><p></p><br><p>  Now that we understand better what images are and what they are, it's time to create our own image.  The goal of this section is to create an image with a simple application on <a href="http://flask.pocoo.org/">Flask</a> .  For this tutorial, I made a small <a href="https://github.com/prakhar1989/docker-curriculum/tree/master/flask-app">application</a> that displays a random gif with a cat.  Well, because who doesn't love cats?  Clone this repository to your local machine. </p><br><p>  First, let's verify that the application is running locally.  Enter the <code>flask-app</code> directory with the <code>cd</code> and install the dependencies. </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> flask-app $ pip install -r requirements.txt $ python app.py * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</code> </pre><br><p>  If all is well, then you will see the output as in the example above.  Go to <a href="http://localhost:5000/">http: // localhost: 5000</a> to see the application in action. </p><br><blockquote><p>  Note: If the <code>pip install</code> command crashes with "permission denied" errors, then try running it with <code>sudo</code> .  If you do not want to install custom packages at the system level, use the command <code>pip install --user -r requirements.txt</code> . </p><br></blockquote><br><p>  Looks great, right?  Now you need to create an image with the application.  As mentioned above, all custom images are based on the base image.  Since our application is written in Python, we need a basic <a href="https://hub.docker.com/_/python/">Python 3</a> image.  In particular, we need a version of <code>python:3-onbuild</code> base image with Python. </p><br><p>  What is the version of <code>onbuild</code> , you ask? </p><br><blockquote><p>  These images include several ONBUILD triggers, which are usually enough to quickly deploy an application.  When building, the <code>requirements.txt</code> file will be copied, <code>pip install</code> will be launched with this file, and then the current directory will be copied to <code>/usr/src/app</code> . </p><br></blockquote><br><p>  In other words, the <code>onbuild</code> version includes helpers that automate the boring application launch processes.  Instead of manually performing these tasks (or writing scripts), the images do everything for you.  Now we have all the ingredients for creating our own image: a working web application and a basic image.  How to do it?  Answer: use <strong>Dockerfile</strong> . </p><br><p><a name="dockerfile"></a></p><h3>  2.4 Dockerfile </h3><p></p><br><p>  <a href="https://docs.docker.com/engine/reference/builder/">Dockerfile</a> is a simple text file that contains a list of Docker client commands.  This is an easy way to automate the image creation process.  The great thing is that the <a href="https://docs.docker.com/engine/reference/builder/">commands</a> in Dockerfile are <em>almost</em> identical to their Linux counterparts.  This means that, in principle, no new syntax needs to be learned in order to start working with dockerfiles. </p><br><p>  In the application directory there is a Dockerfile, but since we are doing everything for the first time, we need to create it from scratch.  Create a new empty file in your favorite text editor, and save it in <strong>the same</strong> directory as the flask application.  Name the file <code>Dockerfile</code> . </p><br><p>  To begin, let us indicate the base image.  To do this, use the keyword <code>FROM</code> . </p><br><pre> <code class="bash hljs">FROM python:3-onbuild</code> </pre><br><p>  Then usually indicate the commands for copying files and installing dependencies.  But fortunately, the <code>onbuild</code> version of the base image takes over these tasks.  Next we need to specify the port that should be opened.  Our application runs on port 5000, so we specify it: </p><br><pre> <code class="bash hljs">EXPOSE 5000</code> </pre><br><p>  The last step is to specify the command to start the application.  This is just <code>python ./app.py</code> .  To do this, use the <a href="https://docs.docker.com/engine/reference/builder/">cmd</a> command: </p><br><pre> <code class="bash hljs">CMD [<span class="hljs-string"><span class="hljs-string">"python"</span></span>, <span class="hljs-string"><span class="hljs-string">"./app.py"</span></span>]</code> </pre><br><p>  The main purpose of a <code>CMD</code> is to tell the container which commands to execute at startup.  Now our <code>Dockerfile</code> ready.  Here is what it looks like: </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># our base image FROM python:3-onbuild # specify the port number the container should expose EXPOSE 5000 # run the application CMD ["python", "./app.py"]</span></span></code> </pre><br><p>  Now you can create an image.  The <code>docker build</code> deals with the complex task of creating an image based on <code>Dockerfile</code> . </p><br><p>  The listing below shows the process.  Before you run the command yourself (do not forget the dot at the end), check that there is your username instead of mine.  Username must match what was used when registering on the <a href="https://hub.docker.com/">Docker hub</a> .  If you have not registered yet, do it before executing the command.  The <code>docker build</code> pretty simple: it takes an optional tag with the <code>-t</code> flag and the path to the directory where the <code>Dockerfile</code> . </p><br><pre> <code class="bash hljs">$ docker build -t prakhar1989/catnip . Sending build context to Docker daemon 8.704 kB Step 1 : FROM python:3-onbuild <span class="hljs-comment"><span class="hljs-comment"># Executing 3 build triggers... Step 1 : COPY requirements.txt /usr/src/app/ ---&gt; Using cache Step 1 : RUN pip install --no-cache-dir -r requirements.txt ---&gt; Using cache Step 1 : COPY . /usr/src/app ---&gt; 1d61f639ef9e Removing intermediate container 4de6ddf5528c Step 2 : EXPOSE 5000 ---&gt; Running in 12cfcf6d67ee ---&gt; f423c2f179d1 Removing intermediate container 12cfcf6d67ee Step 3 : CMD python ./app.py ---&gt; Running in f01401a5ace9 ---&gt; 13e87ed1fbc2 Removing intermediate container f01401a5ace9 Successfully built 13e87ed1fbc2</span></span></code> </pre><br><p>  If you do not have a <code>python:3-onbuild</code> image <code>python:3-onbuild</code> , then the client will download it first, and then take up the creation of your image.  So, the output on the screen may differ from mine.  Take a good look at the onbuild triggers.  If everything went well, the image is ready!  Run <code>docker images</code> and see your image in the list. </p><br><p>  The last step is to run the image and test its performance (replace username with your own): </p><br><pre> <code class="bash hljs">$ docker run -p 8888:5000 prakhar1989/catnip * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</code> </pre><br><p>  Go to the URL and see the application in work. </p><br><p><img src="https://habrastorage.org/files/daa/076/b70/daa076b707304b0ca36f389951a7fffb.png" alt="static"></p><br><p>  Congratulations!  You have successfully created your first image of Docker! </p><br><p><a name="aws"></a></p><h3>  2.5 Docker on AWS </h3><p></p><br><p>  What good is an app that cannot be shown to friends, right?  So in this section we will learn how to deploy our awesome application to the cloud.  We will use AWS <a href="https://aws.amazon.com/elasticbeanstalk/">Elastic Beanstalk</a> to solve this problem in a couple of clicks.  We will see how using Beanstalk to easily manage and scale our application. </p><br><h5>  Docker push </h5><br><p>  The first thing to do before deploying to AWS is to publish our image in the register so that you can download it from AWS.  There are several <a href="https://aws.amazon.com/ecr/">Docker registers</a> (or you can create <a href="https://docs.docker.com/registry/deploying/">your own</a> ).  For starters, let's use the <a href="https://hub.docker.com/">Docker Hub</a> .  Just follow: </p><br><pre> <code class="bash hljs">$ docker push prakhar1989/catnip</code> </pre><br><p>  If this is your first publication, the client will ask you to log in.  Enter the same information that you use to access Docker Hub. </p><br><pre> <code class="bash hljs">$ docker login Username: prakhar1989 WARNING: login credentials saved <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /Users/prakhar/.docker/config.json Login Succeeded</code> </pre><br><p>  Do not forget to replace the image name with your own.  It is very important to save the <code>username/image_name</code> format so that the client understands where to publish the image. </p><br><p>  After that you can look at your image on the Docker Hub.  For example, here is the <a href="https://hub.docker.com/r/prakhar1989/catnip/">page of</a> my image. </p><br><blockquote><p>  Note: one important point that should be clarified before continuing is that it is <strong>not necessary</strong> to store the image in a public register (or in any other register at all) in order to deploy it on AWS.  If you are writing code for the next multi-million dollar startup unicorn, you can skip this step.  We publish our image to simplify deploy, skipping a few configuration steps. </p><br></blockquote><br><p>  Now our image is online, and any docker client can play around with it using a simple command: </p><br><pre> <code class="bash hljs">$ docker run -p 8888:5000 prakhar1989/catnip</code> </pre><br><p>  If in the past you suffered with the installation of a local work environment and attempts to share your configuration with colleagues, then you understand how cool it sounds.  That's why Docker is power! </p><br><h5>  Beanstalk </h5><br><p>  AWS Elastic Beanstalk (EB) is PaaS (Platform as a Service - platform as a service) from Amazon Web Services.  If you used Heroku, Google App Engine, etc., then everything will be familiar.  As a developer, you tell EB how to run your application, and EB does everything else, including scaling, monitoring, and even updates.  In April 2014, EB added the ability to run Docker containers, and we will use this opportunity for deployment.  EB   <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3.html">  </a> ,     ,      -    . </p><br><p>  ,      <a href="http://aws.amazon.com/">AWS</a> .     ,   .       .   ,   ,  ,         . </p><br><p>  : </p><br><ul><li>    <a href="http://console.aws.amazon.com/"> AWS</a> . </li><li>   Elastic Beanstalk.     compute,    .   <a href="https://console.aws.amazon.com/elasticbeanstalk"> </a> . </li></ul><br><p><img src="https://habrastorage.org/files/142/fc9/163/142fc91638bd4a918e9a7c13deaa948f.png" alt="static"></p><br><ul><li>   "Create New Application"    . </li><li>     ( )  ,  ,  . </li><li>   <strong>New Environment</strong>  <strong>Web Server Environment</strong> . </li><li>    .  <em>Docker</em>    .   <em>Environment type</em>  .  Click Next. </li></ul><br><p><img src="https://habrastorage.org/files/727/95c/ac4/72795cac408f4a21ae462025bd01293b.png" alt="static"></p><br><ul><li>      EB   .  <a href=""> Dockerrun.aws.json</a>   <code>flask-app</code>   <code>Name</code> ,      .  ,     .    "upload your own"   . </li><li> ,     URL.  URL      ,     - . </li><li>         <em>Additional Resources</em> .  Next    <em>Configuration Details</em> . </li><li>         <code>t1.micro</code> .   ,    <strong></strong>   AWS.  ,      .    ,   ,        .        . </li><li>      <em>Environment Tags</em> and <em>Permissions</em> ,     Next   .     <em>Review</em> .    ,    <strong>Launch</strong> . </li><li>      .      . ,       . </li></ul><br><p>  ,      <code>Dockerrun.aws.json</code> .    AWS,        . EB     . </p><br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"AWSEBDockerrunVersion"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"Image"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"prakhar1989/catnip"</span></span>, <span class="hljs-string"><span class="hljs-string">"Update"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> }, <span class="hljs-string"><span class="hljs-string">"Ports"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"ContainerPort"</span></span>: <span class="hljs-string"><span class="hljs-string">"5000"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"Logging"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/log/nginx"</span></span> }</code> </pre><br><p>   ,      <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_docker_image.html"> </a> .    ,  EB      . </p><br><p>        .    EB       . </p><br><p><img src="https://habrastorage.org/files/b56/a4a/de3/b56a4ade3c6642c1b12b3ba267d5aa6e.png" alt="static"></p><br><p>    URL        .    ,       . </p><br><p>  Congratulations!     -!  ,     ,     EB       . ,  ,            .     <a href="http://docs.aws.amazon.com/elasticbeanstalk/latest/dg/docker-singlecontainer-deploy.html"> AWS</a>  single-container Docker environment  ,     EB. </p><br><p>  ,   ,       ,    .     -.  Go! </p><br><p><a name="multi"></a></p><h2> 3.0   </h2><p></p><br><p>     ,         .      ,    Flask-.         ,  .    :     <strong>  </strong> . </p><br><p>         ,   ,       .      (    ).   <a href="http://redis.io/">Redis</a>  <a href="http://memcached.org/">Memcached</a>      -. ,      "" ,     . </p><br><p>  ,  ,     <strong></strong> -.    ,  ? ,       ,    .          ( )     . </p><br><p>  ,     ,    <strong></strong>   .       ,       .          ,      ,     .       <a href="http://martinfowler.com/articles/microservices.html"> </a> .    ,    (    )   <a href="https://medium.com/aws-activate-startup-blog/using-containers-to-build-a-microservices-architecture-6e1b8bacb7d1"></a>    . </p><br><p><a name="sfft"></a></p><h3> 3.1 SF Food Trucks </h3><p></p><br><p> ,     ,  SF Food Trucks ( <i> ,       ‚Äî . .</i> ).     -  (       ), -,      ,       .    . </p><br><p><img src="https://habrastorage.org/files/475/435/1dc/4754351dcf6a434f8bac6adaee0b1e10.png" alt="sf food trucks"></p><br><p>      (Flask),     <a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a> .       ,    <a href="http://github.com/prakhar1989/FoodTrucks">Github</a> .    ,      - . </p><br><p> ,    (),  ,     .       Flask   Elasticsearch. ,       :   Flask,   Elasticsearch (ES).    ,         ,     . </p><br><p> ,    .   , ?    Flask-   .   Elasticsearch‚Ä¶  ,   -  : </p><br><pre> <code class="bash hljs">$ docker search elasticsearch NAME DESCRIPTION STARS OFFICIAL AUTOMATED elasticsearch Elasticsearch is a powerful open <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> se... 697 [OK] itzg/elasticsearch Provides an easily configurable Elasticsea... 17 [OK] tutum/elasticsearch Elasticsearch image - listens <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> port 9200. 15 [OK] barnybug/elasticsearch Latest Elasticsearch 1.7.2 and previous re... 15 [OK] digitalwonderland/elasticsearch Latest Elasticsearch with Marvel &amp; Kibana 12 [OK] monsantoco/elasticsearch ElasticSearch Docker image 9 [OK]</code> </pre><br><p>  ,    <a href="https://hub.docker.com/_/elasticsearch/"></a>  Elasticsearch.   ES,     <code>docker run</code> ,      ,      ES. </p><br><pre> <code class="bash hljs">$ docker run -dp 9200:9200 elasticsearch d582e031a005f41eea704cdc6b21e62e7a8a42021297ce7ce123b945ae3d3763 $ curl 0.0.0.0:9200 { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"Ultra-Marine"</span></span>, <span class="hljs-string"><span class="hljs-string">"cluster_name"</span></span> : <span class="hljs-string"><span class="hljs-string">"elasticsearch"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span> : { <span class="hljs-string"><span class="hljs-string">"number"</span></span> : <span class="hljs-string"><span class="hljs-string">"2.1.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"40e2c53a6b6c2972b3d13846e450e66f4375bd71"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_timestamp"</span></span> : <span class="hljs-string"><span class="hljs-string">"2015-12-15T13:05:55Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_snapshot"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"lucene_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.3.1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"tagline"</span></span> : <span class="hljs-string"><span class="hljs-string">"You Know, for Search"</span></span> }</code> </pre><br><p>      Flask.    <code>Dockerfile</code> .       <code>python:3-onbuild</code>   . ,   ,     <code>pip</code> ,  ,     Javascript-  .    Nodejs.       ,      <code>ubuntu</code> . </p><br><blockquote><p> :  ,        ,          .   ,    Docker Hub    <code>Dockerfile</code>  Github.    ‚Äî         . </p><br></blockquote><br><p>  <a href="https://github.com/prakhar1989/FoodTrucks/blob/master/Dockerfile">Dockerfile</a>  Flask-   : </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># start from base FROM ubuntu:14.04 MAINTAINER Prakhar Srivastav &lt;prakhar@prakhar.me&gt; # install system-wide deps for python and node RUN apt-get -yqq update RUN apt-get -yqq install python-pip python-dev RUN apt-get -yqq install nodejs npm RUN ln -s /usr/bin/nodejs /usr/bin/node # copy our application code ADD flask-app /opt/flask-app WORKDIR /opt/flask-app # fetch app specific deps RUN npm install RUN npm run build RUN pip install -r requirements.txt # expose port EXPOSE 5000 # start app CMD [ "python", "./app.py" ]</span></span></code> </pre><br><p>    .     <a href="https://wiki.ubuntu.com/LTS">Ubuntu LTS</a> ,     <code>apt-get</code>   ,   ‚Äî Python  Node.  <code>yqq</code>        "Yes"   .        node.       . </p><br><p>     <code>ADD</code>         ‚Äî <code>/opt/flask-app</code> .      .        ,          . ,     ,     .   Node,    npm    ,     <a href=""> package.json</a> .     Python,         <code>CMD</code> ,    . </p><br><p> ,       ( <code>prakhar1989</code>   username ). </p><br><pre> <code class="bash hljs">$ docker build -t prakhar1989/foodtrucks-web .</code> </pre><br><p>       ,        ubuntu,      .   <code>docker build</code>      .     </p><br><pre> <code class="bash hljs">$ docker run -P prakhar1989/foodtrucks-web Unable to connect to ES. Retying <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 5 secs... Unable to connect to ES. Retying <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 5 secs... Unable to connect to ES. Retying <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 5 secs... Out of retries. Bailing out...</code> </pre><br><p>  Oops!     ,        Elasticsearch.              ?  ‚Äî   . </p><br><p><a name="net"></a></p><h3> 3.2  Docker </h3><p></p><br><p>  ,        ,       . ,       ,    . </p><br><p> ,   <code>docker ps</code> ,    : </p><br><pre> <code class="bash hljs">$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES e931ab24dedc elasticsearch <span class="hljs-string"><span class="hljs-string">"/docker-entrypoint.s"</span></span> 2 seconds ago Up 2 seconds 0.0.0.0:9200-&gt;9200/tcp, 9300/tcp cocky_spence</code> </pre><br><p> ,     ES     <code>0.0.0.0:9200</code> ,       .           ,      ES, ?    <a href="https://github.com/prakhar1989/FoodTrucks/blob/master/flask-app/app.py">  </a> , ,   . </p><br><pre> <code class="bash hljs">es = Elasticsearch(host=<span class="hljs-string"><span class="hljs-string">'es'</span></span>)</code> </pre><br><p>   Flask-,   ES    <code>0.0.0.0</code> (   <code>9200</code> ),   , ?  , ,   IP <code>0.0.0.0</code>        <strong>-</strong> ,     .        . ,    ,           ES? ,   . </p><br><p>   ,      .  ,     : </p><br><pre> <code class="bash hljs">$ docker network ls NETWORK ID NAME DRIVER 075b9f628ccc none null be0f7178486c host host 8022115322ec bridge bridge</code> </pre><br><p>  <strong>bridge</strong> ‚Äî  ,      .  ,      ES,      bridge.  ,  : </p><br><pre> <code class="bash hljs">$ docker network inspect bridge [ { <span class="hljs-string"><span class="hljs-string">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>, <span class="hljs-string"><span class="hljs-string">"Id"</span></span>: <span class="hljs-string"><span class="hljs-string">"8022115322ec80613421b0282e7ee158ec41e16f565a3e86fa53496105deb2d7"</span></span>, <span class="hljs-string"><span class="hljs-string">"Scope"</span></span>: <span class="hljs-string"><span class="hljs-string">"local"</span></span>, <span class="hljs-string"><span class="hljs-string">"Driver"</span></span>: <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPAM"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Driver"</span></span>: <span class="hljs-string"><span class="hljs-string">"default"</span></span>, <span class="hljs-string"><span class="hljs-string">"Config"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"Subnet"</span></span>: <span class="hljs-string"><span class="hljs-string">"172.17.0.0/16"</span></span> } ] }, <span class="hljs-string"><span class="hljs-string">"Containers"</span></span>: { <span class="hljs-string"><span class="hljs-string">"e931ab24dedc1640cddf6286d08f115a83897c88223058305460d7bd793c1947"</span></span>: { <span class="hljs-string"><span class="hljs-string">"EndpointID"</span></span>: <span class="hljs-string"><span class="hljs-string">"66965e83bf7171daeb8652b39590b1f8c23d066ded16522daeb0128c9c25c189"</span></span>, <span class="hljs-string"><span class="hljs-string">"MacAddress"</span></span>: <span class="hljs-string"><span class="hljs-string">"02:42:ac:11:00:02"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPv4Address"</span></span>: <span class="hljs-string"><span class="hljs-string">"172.17.0.2/16"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPv6Address"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } }, <span class="hljs-string"><span class="hljs-string">"Options"</span></span>: { <span class="hljs-string"><span class="hljs-string">"com.docker.network.bridge.default_bridge"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.docker.network.bridge.enable_icc"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.docker.network.bridge.enable_ip_masquerade"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.docker.network.bridge.host_binding_ipv4"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.docker.network.bridge.name"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker0"</span></span>, <span class="hljs-string"><span class="hljs-string">"com.docker.network.driver.mtu"</span></span>: <span class="hljs-string"><span class="hljs-string">"1500"</span></span> } } ]</code> </pre><br><p> ,   <code>e931ab24dedc</code>    <code>Containers</code> .   IP-,    ‚Äî <code>172.17.0.2</code> .      ?  :  Flask-       IP: </p><br><pre> <code class="bash hljs">$ docker run -it --rm prakhar1989/foodtrucks-web bash root@35180ccc206a:/opt/flask-app<span class="hljs-comment"><span class="hljs-comment"># curl 172.17.0.2:9200 bash: curl: command not found root@35180ccc206a:/opt/flask-app# apt-get -yqq install curl root@35180ccc206a:/opt/flask-app# curl 172.17.0.2:9200 { "name" : "Jane Foster", "cluster_name" : "elasticsearch", "version" : { "number" : "2.1.1", "build_hash" : "40e2c53a6b6c2972b3d13846e450e66f4375bd71", "build_timestamp" : "2015-12-15T13:05:55Z", "build_snapshot" : false, "lucene_version" : "5.3.1" }, "tagline" : "You Know, for Search" } root@35180ccc206a:/opt/flask-app# exit</span></span></code> </pre><br><p>     .         <code>bash</code> .  <code>--rm</code>   ,       .   <code>curl</code> ,     .    ,    <code>172.17.0.2:9200</code>       ES!  Super! </p><br><p>    ,        ,      : </p><br><ol><li>      <code>/etc/hosts</code>  Flask-,   ,    <code>es</code>  <code>172.17.0.2</code> .  IP- ,     . </li><li>    <em>bridge</em>     ,   <strong> </strong> . </li></ol><br><p>    :       .      .        <code>/etc/hosts</code> ,   . </p><br><p> -,    : </p><br><pre> <code class="bash hljs">$ docker network create foodtrucks 1a3386375797001999732cb4c4e97b88172d983b08cd0addfcb161eed0c18d89 $ docker network ls NETWORK ID NAME DRIVER 1a3386375797 foodtrucks bridge 8022115322ec bridge bridge 075b9f628ccc none null be0f7178486c host host</code> </pre><br><p>  <code>network create</code>    <em>bridge</em> .      .    ,        <a href="https://docs.docker.com/engine/userguide/networking/dockernetworks/"> </a> . </p><br><p>     .          <code>--net</code> .    ,      ElasticSearch,      bridge  . </p><br><pre> <code class="bash hljs">$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES e931ab24dedc elasticsearch <span class="hljs-string"><span class="hljs-string">"/docker-entrypoint.s"</span></span> 4 hours ago Up 4 hours 0.0.0.0:9200-&gt;9200/tcp, 9300/tcp cocky_spence $ docker stop e931ab24dedc e931ab24dedc $ docker run -dp 9200:9200 --net foodtrucks --name es elasticsearch 2c0b96f9b8030f038e40abea44c2d17b0a8edda1354a08166c33e6d351d0c651 $ docker network inspect foodtrucks [ { <span class="hljs-string"><span class="hljs-string">"Name"</span></span>: <span class="hljs-string"><span class="hljs-string">"foodtrucks"</span></span>, <span class="hljs-string"><span class="hljs-string">"Id"</span></span>: <span class="hljs-string"><span class="hljs-string">"1a3386375797001999732cb4c4e97b88172d983b08cd0addfcb161eed0c18d89"</span></span>, <span class="hljs-string"><span class="hljs-string">"Scope"</span></span>: <span class="hljs-string"><span class="hljs-string">"local"</span></span>, <span class="hljs-string"><span class="hljs-string">"Driver"</span></span>: <span class="hljs-string"><span class="hljs-string">"bridge"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPAM"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Driver"</span></span>: <span class="hljs-string"><span class="hljs-string">"default"</span></span>, <span class="hljs-string"><span class="hljs-string">"Config"</span></span>: [ {} ] }, <span class="hljs-string"><span class="hljs-string">"Containers"</span></span>: { <span class="hljs-string"><span class="hljs-string">"2c0b96f9b8030f038e40abea44c2d17b0a8edda1354a08166c33e6d351d0c651"</span></span>: { <span class="hljs-string"><span class="hljs-string">"EndpointID"</span></span>: <span class="hljs-string"><span class="hljs-string">"15eabc7989ef78952fb577d0013243dae5199e8f5c55f1661606077d5b78e72a"</span></span>, <span class="hljs-string"><span class="hljs-string">"MacAddress"</span></span>: <span class="hljs-string"><span class="hljs-string">"02:42:ac:12:00:02"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPv4Address"</span></span>: <span class="hljs-string"><span class="hljs-string">"172.18.0.2/16"</span></span>, <span class="hljs-string"><span class="hljs-string">"IPv6Address"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } }, <span class="hljs-string"><span class="hljs-string">"Options"</span></span>: {} } ]</code> </pre><br><p>    ,   ,        <code>es</code> .  ,     ,    ,     . </p><br><pre> <code class="bash hljs">$ docker run -it --rm --net foodtrucks prakhar1989/foodtrucks-web bash root@53af252b771a:/opt/flask-app<span class="hljs-comment"><span class="hljs-comment"># cat /etc/hosts 172.18.0.3 53af252b771a 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 172.18.0.2 es 172.18.0.2 es.foodtrucks root@53af252b771a:/opt/flask-app# curl es:9200 bash: curl: command not found root@53af252b771a:/opt/flask-app# apt-get -yqq install curl root@53af252b771a:/opt/flask-app# curl es:9200 { "name" : "Doctor Leery", "cluster_name" : "elasticsearch", "version" : { "number" : "2.1.1", "build_hash" : "40e2c53a6b6c2972b3d13846e450e66f4375bd71", "build_timestamp" : "2015-12-15T13:05:55Z", "build_snapshot" : false, "lucene_version" : "5.3.1" }, "tagline" : "You Know, for Search" } root@53af252b771a:/opt/flask-app# ls app.py node_modules package.json requirements.txt static templates webpack.config.js root@53af252b771a:/opt/flask-app# python app.py Index not found... Loading data in elasticsearch ... Total trucks loaded: 733 * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit) root@53af252b771a:/opt/flask-app# exit</span></span></code> </pre><br><p>  Hooray!  Works!         <code>/etc/hosts</code> ,   <code>es:9200</code>     ‚Äî        ES.  Fine!    Flask- -: </p><br><pre> <code class="bash hljs">$ docker run -d --net foodtrucks -p 5000:5000 --name foodtrucks-web prakhar1989/foodtrucks-web 2a1b77e066e646686f669bab4759ec1611db359362a031667cacbe45c3ddb413 $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2a1b77e066e6 prakhar1989/foodtrucks-web <span class="hljs-string"><span class="hljs-string">"python ./app.py"</span></span> 2 seconds ago Up 1 seconds 0.0.0.0:5000-&gt;5000/tcp foodtrucks-web 2c0b96f9b803 elasticsearch <span class="hljs-string"><span class="hljs-string">"/docker-entrypoint.s"</span></span> 21 minutes ago Up 21 minutes 0.0.0.0:9200-&gt;9200/tcp, 9300/tcp es $ curl -I 0.0.0.0:5000 HTTP/1.0 200 OK Content-Type: text/html; charset=utf-8 Content-Length: 3697 Server: Werkzeug/0.11.2 Python/2.7.6 Date: Sun, 10 Jan 2016 23:58:53 GMT</code> </pre><br><p>   <a href="http://0.0.0.0:5000/">http://0.0.0.0:5000</a> ,     .  ,  ,    ,        4        .      <a href="">bash-</a> . </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # build the flask container docker build -t prakhar1989/foodtrucks-web . # create the network docker network create foodtrucks # start the ES container docker run -d --net foodtrucks -p 9200:9200 -p 9300:9300 --name es elasticsearch # start the flask app container docker run -d --net foodtrucks -p 5000:5000 --name foodtrucks-web prakhar1989/foodtrucks-web</span></span></code> </pre><br><p>  ,      .     ,   .        ! </p><br><pre> <code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/prakhar1989/FoodTrucks $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> FoodTrucks $ ./setup-docker.sh</code> </pre><br><p>  That's all! -,          ! </p><br><h5> Docker Links </h5><br><p>  ,    ,  ,  <code>docker network</code>    ,    <a href="https://blog.docker.com/2015/11/docker-1-9-production-ready-swarm-multi-host-networking/"></a> Docker 1.9 . </p><br><p>  ,   <code>network</code> ,        .     <a href="https://docs.docker.com/engine/userguide/networking/default_network/dockerlinks/"></a> , linking      deprecated.      ,   <code>link</code>   ,        <code>network</code> (    links  legacy, ‚Äî . .) </p><br><p><a name="compose"></a></p><h3> 3.3 Docker Compose </h3><p></p><br><p>       .            ,     .  Some of these are: </p><br><ol><li> <a href="https://docs.docker.com/machine/">Docker Machine</a>   -   ,     -. </li><li> <a href="https://docs.docker.com/compose/">Docker Compose</a> ‚Äî      - . </li><li> <a href="https://docs.docker.com/swarm/">Docker Swarm</a> ‚Äî    . </li></ol><br><p>           ‚Äî Docker Compose,  ,        . </p><br><p>  Docker Compose   .      OrchardUp     Fig.    ,        .      <a href="https://news.ycombinator.com/item%3Fid%3D7132044">Hacker News</a> -   ,    ,      . </p><br><p> <a href="https://news.ycombinator.com/item%3Fid%3D7133449"> </a>     ,   Fig    : </p><br><blockquote><p>   ,    :  .      API   :    ( ,  )    (shared volumes),    -  ,  ,   .   :       . <br>    ,             "",    ,           .       Fig:         .    " " ( , "   ")  " ". </p><br></blockquote><br><p> ,        . , Fig  , Docker Inc. ,      Docker Compose. </p><br><p> ,   <em>Compose</em> ?         -.     <code>docker-compose.yml</code> ,            . </p><br><p>  ,      <code>docker-compose.yml</code>    SF-Foodtrucks  ,     ,  . </p><br><p>     Docker Compose.    Windows  Mac,  Docker Compose   ‚Äî      Docker Toolbox.  Linux   Docker Compose  <a href="https://docs.docker.com/compose/install/"> </a>   . Compose   Python,     <code>pip install docker-compose</code> .   : </p><br><pre> <code class="bash hljs">$ docker-compose version docker-compose version 1.7.1, build 0a9ab35 docker-py version: 1.8.1 CPython version: 2.7.9 OpenSSL version: OpenSSL 1.0.1j 15 Oct 2014</code> </pre><br><p>      ,     <code>docker-compose.yml</code> .  <code>yml</code> -  ,      <a href=""></a> ,     </p><br><pre> <code class="bash hljs">version: <span class="hljs-string"><span class="hljs-string">"2"</span></span> services: es: image: elasticsearch web: image: prakhar1989/foodtrucks-web <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: python app.py ports: - <span class="hljs-string"><span class="hljs-string">"5000:5000"</span></span> volumes: - .:/code</code> </pre><br><p>     .          : <code>es</code>  <code>web</code> .       ,   <code>image</code> ‚Äî .  <code>es</code>     Docker Hub  <code>elasticsearch</code> .  Flask- ‚Äî  ,        . </p><br><p>      <code>command</code>  <code>ports</code>     . <code>volumes</code>    ,       <code>web</code> .   ,  ,        .        <a href="https://docs.docker.com/compose/compose-file">  </a> . </p><br><blockquote><p> :       <code>docker-compose.yml</code>      Compose. </p><br></blockquote><br><p>  Fine!  ,    <code>docker-compose</code>  .    ,   .        Flask  ES,    : </p><br><pre> <code class="bash hljs">$ docker stop $(docker ps -q) 39a2f5df14ef 2a1b77e066e6</code> </pre><br><p>    <code>docker-compose</code> .      Foodtrucks    <code>docker-compose up</code> . </p><br><pre> <code class="bash hljs">$ docker-compose up Creating network <span class="hljs-string"><span class="hljs-string">"foodtrucks_default"</span></span> with the default driver Creating foodtrucks_es_1 Creating foodtrucks_web_1 Attaching to foodtrucks_es_1, foodtrucks_web_1 es_1 | [2016-01-11 03:43:50,300][INFO ][node ] [Comet] version[2.1.1], pid[1], build[40e2c53/2015-12-15T13:05:55Z] es_1 | [2016-01-11 03:43:50,307][INFO ][node ] [Comet] initializing ... es_1 | [2016-01-11 03:43:50,366][INFO ][plugins ] [Comet] loaded [], sites [] es_1 | [2016-01-11 03:43:50,421][INFO ][env ] [Comet] using [1] data paths, mounts [[/usr/share/elasticsearch/data (/dev/sda1)]], net usable_space [16gb], net total_space [18.1gb], spins? [possibly], types [ext4] es_1 | [2016-01-11 03:43:52,626][INFO ][node ] [Comet] initialized es_1 | [2016-01-11 03:43:52,632][INFO ][node ] [Comet] starting ... es_1 | [2016-01-11 03:43:52,703][WARN ][common.network ] [Comet] publish address: {0.0.0.0} is a wildcard address, falling back to first non-loopback: {172.17.0.2} es_1 | [2016-01-11 03:43:52,704][INFO ][transport ] [Comet] publish_address {172.17.0.2:9300}, bound_addresses {[::]:9300} es_1 | [2016-01-11 03:43:52,721][INFO ][discovery ] [Comet] elasticsearch/cEk4s7pdQ-evRc9MqS2wqw es_1 | [2016-01-11 03:43:55,785][INFO ][cluster.service ] [Comet] new_master {Comet}{cEk4s7pdQ-evRc9MqS2wqw}{172.17.0.2}{172.17.0.2:9300}, reason: zen-disco-join(elected_as_master, [0] joins received) es_1 | [2016-01-11 03:43:55,818][WARN ][common.network ] [Comet] publish address: {0.0.0.0} is a wildcard address, falling back to first non-loopback: {172.17.0.2} es_1 | [2016-01-11 03:43:55,819][INFO ][http ] [Comet] publish_address {172.17.0.2:9200}, bound_addresses {[::]:9200} es_1 | [2016-01-11 03:43:55,819][INFO ][node ] [Comet] started es_1 | [2016-01-11 03:43:55,826][INFO ][gateway ] [Comet] recovered [0] indices into cluster_state es_1 | [2016-01-11 03:44:01,825][INFO ][cluster.metadata ] [Comet] [sfdata] creating index, cause [auto(index api)], templates [], shards [5]/[1], mappings [truck] es_1 | [2016-01-11 03:44:02,373][INFO ][cluster.metadata ] [Comet] [sfdata] update_mapping [truck] es_1 | [2016-01-11 03:44:02,510][INFO ][cluster.metadata ] [Comet] [sfdata] update_mapping [truck] es_1 | [2016-01-11 03:44:02,593][INFO ][cluster.metadata ] [Comet] [sfdata] update_mapping [truck] es_1 | [2016-01-11 03:44:02,708][INFO ][cluster.metadata ] [Comet] [sfdata] update_mapping [truck] es_1 | [2016-01-11 03:44:03,047][INFO ][cluster.metadata ] [Comet] [sfdata] update_mapping [truck] web_1 | * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</code> </pre><br><p>   IP   .  Cool, yeah?        -   .       detached mode: </p><br><pre> <code class="bash hljs">web_1 | * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit) Killing foodtrucks_web_1 ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> Killing foodtrucks_es_1 ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> $ docker-compose up -d Starting foodtrucks_es_1 Starting foodtrucks_web_1 $ docker-compose ps Name Command State Ports ---------------------------------------------------------------------------------- foodtrucks_es_1 /docker-entrypoint.sh elas ... Up 9200/tcp, 9300/tcp foodtrucks_web_1 python app.py Up 0.0.0.0:5000-&gt;5000/tcp</code> </pre><br><p>  ,     .   ?  Compose  .    ?  Compose   ?  ,  . </p><br><p>  ,   .      : </p><br><pre> <code class="bash hljs">$ docker-compose stop Stopping foodtrucks_web_1 ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> Stopping foodtrucks_es_1 ... <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br><p> ,    <code>foodtrucks</code> ,     .     ,   <em>Compose</em>     . </p><br><pre> <code class="bash hljs">$ docker network rm foodtrucks $ docker network ls NETWORK ID NAME DRIVER 4eec273c054e bridge bridge 9347ae8783bd none null 54df57d7f493 host host</code> </pre><br><p>  Great!       ,   <em>Compose</em>  . </p><br><pre> <code class="bash hljs">$ docker-compose up -d Recreating foodtrucks_es_1 Recreating foodtrucks_web_1 $ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES f50bb33a3242 prakhar1989/foodtrucks-web <span class="hljs-string"><span class="hljs-string">"python app.py"</span></span> 14 seconds ago Up 13 seconds 0.0.0.0:5000-&gt;5000/tcp foodtrucks_web_1 e299ceeb4caa elasticsearch <span class="hljs-string"><span class="hljs-string">"/docker-entrypoint.s"</span></span> 14 seconds ago Up 14 seconds 9200/tcp, 9300/tcp foodtrucks_es_1</code> </pre><br><p>   . ,   - : </p><br><pre> <code class="bash hljs">$ docker network ls NETWORK ID NAME DRIVER 0c8b474a9241 bridge bridge 293a141faac3 foodtrucks_default bridge b44db703cd69 host host 0474c9517805 none null</code> </pre><br><p> ,  Compose    <code>foodtrucks_default</code>       , ,       .       ,        .    hostname,     .  ,      <code>/etc/hosts</code> . </p><br><pre> <code class="bash hljs">$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES bb72dcebd379 prakhar1989/foodtrucks-web <span class="hljs-string"><span class="hljs-string">"python app.py"</span></span> 20 hours ago Up 19 hours 0.0.0.0:5000-&gt;5000/tcp foodtrucks_web_1 3338fc79be4b elasticsearch <span class="hljs-string"><span class="hljs-string">"/docker-entrypoint.s"</span></span> 20 hours ago Up 19 hours 9200/tcp, 9300/tcp foodtrucks_es_1 $ docker <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> -it bb72dcebd379 bash root@bb72dcebd379:/opt/flask-app<span class="hljs-comment"><span class="hljs-comment"># cat /etc/hosts 127.0.0.1 localhost ::1 localhost ip6-localhost ip6-loopback fe00::0 ip6-localnet ff00::0 ip6-mcastprefix ff02::1 ip6-allnodes ff02::2 ip6-allrouters 172.18.0.2 bb72dcebd379</span></span></code> </pre><br><p>  Oops! ,      <code>es</code> .     ?      : </p><br><pre> <code class="bash hljs">root@bb72dcebd379:/opt/flask-app<span class="hljs-comment"><span class="hljs-comment"># ping es PING es (172.18.0.3) 56(84) bytes of data. 64 bytes from foodtrucks_es_1.foodtrucks_default (172.18.0.3): icmp_seq=1 ttl=64 time=0.049 ms 64 bytes from foodtrucks_es_1.foodtrucks_default (172.18.0.3): icmp_seq=2 ttl=64 time=0.064 ms ^C --- es ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 999ms rtt min/avg/max/mdev = 0.049/0.056/0.064/0.010 ms</span></span></code> </pre><br><p>  Voila!  Works! -        <code>es</code> . , Docker 1.10    ,      DNS-.  ,     <a href="https://github.com/docker/libnetwork/issues/767"></a>  <a href="https://blog.docker.com/2016/02/docker-1-10/">release notes</a> . </p><br><p>      Docker Compose .        ,         ,     .      <a href="https://docs.docker.com/compose/overview/"></a>  Docker Compose. </p><br><p> ,            Compose.        AWS! </p><br><p><a name="awsecs"></a></p><h3> 3.4 AWS Elastic Container Service </h3><p></p><br><p>      <code>docker-compose</code>       : <code>docker-compose up</code> . ,   ,     ,  ,         .        ,            AWS. </p><br><p>      ,    ,  Docker ‚Äî   .    .              . , -    AWS, <a href="https://azure.microsoft.com/en-us/documentation/articles/virtual-machines-docker-vm-extension/">Azure</a> , <a href="http://blog.rackspace.com/docker-with-the-rackspace-open-cloud/">Rackspace</a> , <a href="https://www.digitalocean.com/community/tutorials/how-to-use-the-digitalocean-docker-application">DigitalOcean</a>   .          Elastic Beanstalk,       AWS <a href="https://aws.amazon.com/ecs/">Elastic Container Service ( ECS)</a> . </p><br><p> AWS ECS ‚Äî        ,    .        EC2   API.  Beanstalk     ,  ECS        .    ECS ‚Äî       . </p><br><p>  ,  ECS   <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_CLI.html">   (CLI)</a>   Docker Compose     ECS!         <code>docker-compose.yml</code> ,     AWS    .  Let's start! </p><br><p>    CLI.      CLI-    Windows.    CLI  Mac  Linux      <a href="http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_CLI_installation.html"> </a> .  ,      : </p><br><pre> <code class="bash hljs">$ ecs-cli --version ecs-cli version 0.1.0 (*cbdc2d5)</code> </pre><br><p>   ‚Äî       .    <a href="https://console.aws.amazon.com/ec2/v2/home%3Fregion%3Dus-east-1">EC2 Console</a>    keypair.        .    ‚Äî  .     <code>ecs</code>    <code>us-east-1</code> .      . </p><br><p><img src="https://habrastorage.org/files/089/375/4f7/0893754f72334f7caa93249a3c6940a7.png" alt="keypair.png"></p><br><p>   CLI: </p><br><pre> <code class="bash hljs">$ ecs-cli configure --region us-east-1 --cluster foodtrucks INFO[0000] Saved ECS CLI configuration <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cluster (foodtrucks)</code> </pre><br><p>  <code>configure</code>   ,      ,   .   <strong>  </strong> ,     .      <a href="https://aws.amazon.com/cli/">AWS CLI</a> ,   <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-set-up.html"></a> ,     . </p><br><p>       <a href="https://aws.amazon.com/cloudformation/">CloudFormation</a> . </p><br><pre> <code class="bash hljs">$ ecs-cli up --keypair ecs --capability-iam --size 2 --instance-type t2.micro INFO[0000] Created cluster cluster=foodtrucks INFO[0001] Waiting <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> your cluster resources to be created INFO[0001] Cloudformation stack status stackStatus=CREATE_IN_PROGRESS INFO[0061] Cloudformation stack status stackStatus=CREATE_IN_PROGRESS INFO[0122] Cloudformation stack status stackStatus=CREATE_IN_PROGRESS INFO[0182] Cloudformation stack status stackStatus=CREATE_IN_PROGRESS INFO[0242] Cloudformation stack status stackStatus=CREATE_IN_PROGRESS</code> </pre><br><p>     ,    (   <code>ecs</code> ),   ( <code>--size</code> )   ,     .  <code>--capability-iam</code>  ,   ,       IAM. </p><br><p>       <code>docker-compose.yml</code> .   ,     ,       <code>aws-compose.yml</code> .  <a href=""> </a> ( ): </p><br><pre> <code class="bash hljs">es: image: elasticsearch cpu_shares: 100 mem_limit: 262144000 web: image: prakhar1989/foodtrucks-web cpu_shares: 100 mem_limit: 262144000 ports: - <span class="hljs-string"><span class="hljs-string">"80:5000"</span></span> links: - es</code> </pre><br><p>      <code>docker-compose.yml</code>   <code>mem_limit</code>  <code>cpu_shares</code>   . </p><br><p> ,   <code>version</code>  <code>services</code> ,   AWS    <a href="https://docs.docker.com/compose/compose-file/"> 2</a>   Compose.          <code>t2.micro</code> ,   250  .       Docker Hub.     , ecs-cli <strong> </strong>  <code>build</code> .  Docker Compose <a href="https://docs.docker.com/compose/compose-file/"></a>   . </p><br><pre> <code class="bash hljs">$ docker push prakhar1989/foodtrucks-web</code> </pre><br><p>  Beauty!    ,     ECS! </p><br><pre> <code class="bash hljs">$ ecs-cli compose --file aws-compose.yml up INFO[0000] Using ECS task definition TaskDefinition=ecscompose-foodtrucks:2 INFO[0000] Starting container... container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/es INFO[0000] Starting container... container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/web INFO[0000] Describe ECS container status container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/web desiredStatus=RUNNING lastStatus=PENDING taskDefinition=ecscompose-foodtrucks:2 INFO[0000] Describe ECS container status container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/es desiredStatus=RUNNING lastStatus=PENDING taskDefinition=ecscompose-foodtrucks:2 INFO[0036] Describe ECS container status container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/es desiredStatus=RUNNING lastStatus=PENDING taskDefinition=ecscompose-foodtrucks:2 INFO[0048] Describe ECS container status container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/web desiredStatus=RUNNING lastStatus=PENDING taskDefinition=ecscompose-foodtrucks:2 INFO[0048] Describe ECS container status container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/es desiredStatus=RUNNING lastStatus=PENDING taskDefinition=ecscompose-foodtrucks:2 INFO[0060] Started container... container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/web desiredStatus=RUNNING lastStatus=RUNNING taskDefinition=ecscompose-foodtrucks:2 INFO[0060] Started container... container=845e2368-170d-44a7-bf9f-84c7fcd9ae29/es desiredStatus=RUNNING lastStatus=RUNNING taskDefinition=ecscompose-foodtrucks:2</code> </pre><br><p> ,      <strong>Docker Compose</strong> ‚Äî  .  <code>--file</code>       ( <code>docker-compose.yml</code> ).    ,     <code>desiredStatus=RUNNING lastStatus=RUNNING</code>   . </p><br><p>  Cool!   .    ? </p><br><pre> <code class="bash hljs">ecs-cli ps Name State Ports TaskDefinition 845e2368-170d-44a7-bf9f-84c7fcd9ae29/web RUNNING 54.86.14.14:80-&gt;5000/tcp ecscompose-foodtrucks:2 845e2368-170d-44a7-bf9f-84c7fcd9ae29/es RUNNING ecscompose-foodtrucks:2</code> </pre><br><p>  <a href="http://54.86.14.14/">http://54.86.14.14</a>  ,   Food Trucks    - ! ,     <a href="https://console.aws.amazon.com/ecs/home%3Fregion%3Dus-east-1">AWS ECS</a> . </p><br><p><img src="https://habrastorage.org/files/658/ba4/442/658ba44423c747b0a1e4a692e7318e6d.png" alt="ECS cluster"></p><br><p><img src="https://habrastorage.org/files/bbd/71f/8c6/bbd71f8c6142469b91125f07a2b4ba06.png" alt="ECS cluster"></p><br><p> ,    ECS- 'foodtrucks',         .            . </p><br><p>  That's all.    ‚Äî     AWS! </p><br><p><a name="outro"></a></p><h2> 4.0  </h2><p></p><br><p>    .  , ,        !       ,     .    ,   ,     - ,  ,      . </p><br><p> ,             .          ,   ,        . </p><br><p><a name="next"></a></p><h3> 4.1   </h3><p></p><br><p>       .             .         ,       .   ,     ,       . ,    ,              ,     . </p><br><p>  ‚Äî    .       .    ‚Äî    . </p><br><p> <strong> </strong> </p><br><ul><li> <a href="https://github.com/veggiemonk/awesome-docker">Awesome Docker</a> </li><li> <a href="http://docker.atbaker.me/">Hello Docker Workshop</a> </li><li> <a href="https://www.youtube.com/watch%3Fv%3DPJ95WY2DqXo">Building a microservice with Node.js and Docker</a> </li><li> <a href="https://blog.codeship.com/why-docker/">Why Docker</a> </li><li> <a href="https://www.docker.com/newsletter-subscription">Docker Weekly</a> and <a href="https://blog.docker.com/docker-weekly-archives/">archives</a> </li><li> <a href="https://blog.codeship.com/">Codeship Blog</a> </li></ul><br><p> ,  ! </p><br><p><a name="feedback"></a></p><h3> 4.2   </h3><p></p><br><p>     .   ?    ,     -? </p><br><p>   (  , ‚Äî . .)   <a href="">prakhar@prakhar.me</a>   <a href="https://github.com/prakhar1989/docker-curriculum/issues/new"> issue</a> .    <a href="https://twitter.com/prakharsriv9"></a> ,    ,    . </p><br><p> <em>(    -, ‚Äî . .).</em> </p><br><p>     .         .  ,           .        . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310460/">https://habr.com/ru/post/310460/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310448/index.html">How do American fintech startups replace banking freelancers</a></li>
<li><a href="../310450/index.html">Development of an electronic document management system from the inside: How we prepare SED TEZIS for release</a></li>
<li><a href="../310452/index.html">The book "Command line Linux. Complete Guide ¬ª</a></li>
<li><a href="../310454/index.html">Secrets of Progressive Web Apps: Part 1</a></li>
<li><a href="../310456/index.html">Custom Software Development</a></li>
<li><a href="../310462/index.html">Put on a diet PostgreSQL indices for Zabbix</a></li>
<li><a href="../310464/index.html">Work with Apache Ignite topology</a></li>
<li><a href="../310466/index.html">Automation of IT services</a></li>
<li><a href="../310470/index.html">Solar JSOC - the experience of building a commercial SOC</a></li>
<li><a href="../310472/index.html">You do not have enough speed R? We are looking for hidden reserves</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>