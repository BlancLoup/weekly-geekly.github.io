<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Route graph for apache camel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell you about how you can build a route graph for applications with Apache Camel, monitor the status of these routes and colle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Route graph for apache camel</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/c4/zn/0h/c4zn0huecdpwdc07r4vokl-mhau.png"></p><br><p>  In this article I will tell you about how you can build a route graph for applications with Apache Camel, monitor the status of these routes and collect metrics for them. <br>  We use Apache Camel in spring applications and Apache ServiceMix.  And if the routes in a separate service is a thing that is understandable and easily foreseeable, then within the data bus, where there are many such routes, it is not so simple. </p><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">What is Apache ServiceMix</b> <div class="spoiler_text"><p>  Apache Camel is an open framework for integrating applications through the use of simple dsl and a rich set of ready-made data access components. </p><br><p>  Apache ServiceMix is ‚Äã‚Äãan open solution based on Apache ActiveMQ, Camel, CXF, Karaf, which allows you to build a platform for integration solutions.  Apache ServiceMix can be used as a corporate service bus.  Camel in this case will allow you to simplify the creation of routes in the bus using dsl in the form of xml, java, scala, etc.  For example, if we need to transfer messages from one queue to another (let's not think about why we need it), we can describe the route in the xml file (example below), throw it into the required service directory and it will be deployed. </p><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blueprint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.osgi.org/xmlns/blueprint/v1.0.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.osgi.org/xmlns/blueprint/v1.0.0 http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">camelContext</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://camel.apache.org/schema/blueprint"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:camel/input"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">log</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Moving ${file:name} to the output directory"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:camel/output"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">camelContext</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blueprint</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The described route transfers files from one directory to another. </p></div></div><br><p>  Over the years of use, the tire has accumulated more than a hundred different difficulty routes, and we have come to understand that it is becoming more and more difficult to remember all these connections.  Drawing route maps with hands or describing them in the form of tables has ceased to seem a convenient and easily supported solution.  But it began to seem that the automatic construction of the route graph would save everyone. </p><br><p>  To construct a graph, we need vertices and edges.  And from them we are blind to something beautiful! </p><br><h2 id="elementy-marshruta">  Route elements </h2><br><p>  The entry point (it is one) for the route is described by the <code>from</code> operator with an endpoint specified.  Those.  for </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:camel/input"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  endpoint will be <code>file:camel/input</code> .  He tells us that at the beginning of the route the files will be taken from the <code>camel/input</code> directory. </p><br><p>  The exit points of the route (there are many of them, which is why I indicated the plural number) are determined differently - depending on <a href="http://camel.apache.org/exchange-pattern.html">the message exchange pattern,</a> also with an indication of an endpoint.  In the example above, this point is described by <code>to</code> .  Those.  for </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file:camel/output"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><p>  endpoint will be <code>file:camel/output</code> .  He tells us that at the end of the route files will be saved to the <code>camel/output</code> directory. </p><br><p>  Endpoint's are the vertices we need.  The ribs will determine the routes themselves. </p><br><h2 id="poluchenie-opisaniya-marshrutov">  Getting route descriptions </h2><br><p>  Servicemix provides the ability to access various information using JMX and we will use <a href="https://jolokia.org/">jolokia</a> to access this information via http. </p><br><p>  As an example, take this description of the routes. </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd http://camel.apache.org/schema/spring http://camel.apache.org/schema/spring/camel-spring.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">camelContext</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://camel.apache.org/schema/spring"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"the-clock-is-ticking"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"timer://foo?fixedRate=true&amp;amp;period=1000"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jms:topic:timer?connectionFactory=demo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"service-a"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jms:topic:timer?connectionFactory=demo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jms:queue:service-a?connectionFactory=demo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"service-a-log"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">from</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jms:queue:service-a?connectionFactory=demo"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">to</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"log:service-a"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">camelContext</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="spisok-marshrutov">  Route list </h3><br><p>  The <code>http://host:8181/jolokia/read/org.apache.camel:type=routes,*</code> method returns a list of routes with details. </p><br><p>  Sample return data for the <code>service-a</code> route: </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"org.apache.camel:context=a.xml,name=\"service-a\",type=routes"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"StatisticsEnabled"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"EndpointUri"</span></span>: <span class="hljs-string"><span class="hljs-string">"jms:\/\/topic:timer?connectionFactory=demo"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"CamelManagementName"</span></span>: <span class="hljs-string"><span class="hljs-string">"a.xml"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ExchangesCompleted"</span></span>: <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LastProcessingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ExchangesFailed"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Description"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"FirstExchangeCompletedExchangeId"</span></span>: <span class="hljs-string"><span class="hljs-string">"ID-..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"StartTimestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-17T07:01:12Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"FirstExchangeCompletedTimestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-17T07:01:13Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LastExchangeFailureTimestamp"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"MaxProcessingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">35</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LastExchangeCompletedTimestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-17T07:04:05Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Load15"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"DeltaProcessingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">-8</span></span>, <span class="hljs-attr"><span class="hljs-attr">"OldestInflightDuration"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ExternalRedeliveries"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ExchangesTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ResetTimestamp"</span></span>: <span class="hljs-string"><span class="hljs-string">"2018-12-17T07:01:12Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ExchangesInflight"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"MeanProcessingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LastExchangeFailureExchangeId"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"FirstExchangeFailureExchangeId"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Uptime"</span></span>: <span class="hljs-string"><span class="hljs-string">"2 minutes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"CamelId"</span></span>: <span class="hljs-string"><span class="hljs-string">"camel-3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TotalProcessingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">827</span></span>, <span class="hljs-attr"><span class="hljs-attr">"FirstExchangeFailureTimestamp"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"RouteId"</span></span>: <span class="hljs-string"><span class="hljs-string">"service-a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"RoutePolicyList"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"FailuresHandled"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"MessageHistory"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Load05"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"OldestInflightExchangeId"</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">"State"</span></span>: <span class="hljs-string"><span class="hljs-string">"Started"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"InflightExchanges"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Redeliveries"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"MinProcessingTime"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">"LastExchangeCompletedExchangeId"</span></span>: <span class="hljs-string"><span class="hljs-string">"ID-..."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Tracing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Load01"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre> <br><p>  There are many <code>RouteId</code> , and among them, of particular interest for graph construction are <code>RouteId</code> , <code>Context</code> , <code>EndpointUri</code> , <code>State</code> , <code>Uptime</code> . </p><br><p>  It is important to mention that the method returns and metrics along the route: <code>ExchangesTotal</code> , <code>ExchangesCompleted</code> , <code>ExchangesFailed</code> , <code>ExchangesInflight</code> , etc. </p><br><p>  The above method covers 90% of our data needs, but what it does not return is information about exit points from the route.  To obtain this information you need to use the method of obtaining details of the route and the method of obtaining the scheme.  One of the methods is not enough, since in some cases the methods do not return all the data necessary to form a list of exit points. </p><br><h3 id="detali-marshruta">  Route details </h3><br><p>  The route details are obtained from the method. <br> <code>http://host:8181/jolokia/exec/org.apache.camel:context=a.xml,type=routes,name="service-a"/createRouteStaticEndpointJson(boolean)/true</code> </p> <br><p>  Sample return data: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"mbean"</span></span>: <span class="hljs-string"><span class="hljs-string">"org.apache.camel:context=a.xml,name=\"service-a\",type=routes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arguments"</span></span>: [<span class="hljs-string"><span class="hljs-string">"true"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"exec"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"createRouteStaticEndpointJson(boolean)"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"{\"routes\": { \"service-a\": { \"inputs\": [ { \"uri\": \"jms:\/\/topic:timer?connectionFactory=demo\" } ], \"outputs\": [ { \"uri\": \"jms:\/\/queue:service-a?connectionFactory=demo\" } ] }}\n}\n"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-number"><span class="hljs-number">1545040570</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> }</code> </pre> <br><h3 id="shema-marshruta">  Route map </h3><br><p>  The route map is obtained from the method <br>  <code>http://host:8181/jolokia/exec/org.apache.camel:context=a.xml,type=routes,name="service-a"/dumpRouteAsXml(boolean)/true</code> . </p><br><p>  The method returns the route map in xml form only if it has been framed.  For example, if a route is described using <code>org.apache.camel.builder.RouteBuilder</code> (used when describing routes in a spring application), then the method will not return anything. </p><br><p>  Sample return data: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"mbean"</span></span>: <span class="hljs-string"><span class="hljs-string">"org.apache.camel:context=a.xml,name=\"service-a\",type=routes"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arguments"</span></span>: [<span class="hljs-string"><span class="hljs-string">"true"</span></span>], <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"exec"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"dumpRouteAsXml(boolean)"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?&gt;\n&lt;route customId=\"true\" id=\"service-a\" xmlns=\"http:\/\/camel.apache.org\/schema\/spring\"&gt;\n &lt;from uri=\"jms:topic:timer?connectionFactory=demo\"\/&gt;\n &lt;to uri=\"jms:queue:service-a?connectionFactory=demo\" id=\"to5\"\/&gt;\n&lt;\/route&gt;\n"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>: <span class="hljs-number"><span class="hljs-number">1545040727</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> }</code> </pre> <br><h2 id="risuem-graf">  Draw graph </h2><br><p>  Combining all the information received, you can safely draw a graph, I used <code>vis.js</code> and got this result <br><img src="https://habrastorage.org/webt/xm/cd/4q/xmcd4q9dgtit6akmjut_fw_6nne.png"><br>  The points are the points of entry and exit, the edges are the routes, and the gray numbers on the routes are the <code>ExchangesTotal</code> metric. </p><br><h2 id="postroenie-grafa-dlya-neskolkih-servisov">  Graphing for several services </h2><br><p>  The described approach to the construction of a graph is also suitable for the case when camel is used not only in the data bus, but also in applications.  For example, having described the route in the application as follows: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventRoutes</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ from(<span class="hljs-string"><span class="hljs-string">"jms:topic:timer"</span></span>) .inOnly(<span class="hljs-string"><span class="hljs-string">"bean:service?method=handle"</span></span>); } }</code> </pre> <br><p>  You can combine all the data on the routes from the <code>servicemix</code> and the application and draw a general graph <br><img src="https://habrastorage.org/webt/ou/_9/ex/ou_9exsfvhosre_r6zwie1kvobq.png"><br>  Notice that a new route appears in the diagram from <code>jms:topic:timer</code> to <code>bean:service</code> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Having implemented the described approach to building a route graph, we were able to get a general picture for both the bus and integrated services.  Actually the graph of our tires looks like <br><img src="https://habrastorage.org/webt/p-/si/4n/p-si4ndyze4n5ur_wla4bqnacyu.png"><br>  Proof of concept applications can be viewed here - <a href="https://github.com/avvero/camel-graph">github</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/435594/">https://habr.com/ru/post/435594/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435584/index.html">Slush 2018. Day one, day two</a></li>
<li><a href="../435586/index.html">The art of shamanism or custom firmware for Olinuxino. Kernel and Ubuntu Part 3</a></li>
<li><a href="../435588/index.html">Promotion of a mobile application on real experience in numbers</a></li>
<li><a href="../435590/index.html">Forecasting again, part 1</a></li>
<li><a href="../435592/index.html">Azores: the last reserve of flora in the mid-Atlantic</a></li>
<li><a href="../435596/index.html">Conversations and traffic Russians offer to store only on Russian equipment</a></li>
<li><a href="../435600/index.html">How to migrate to another mobile operator and not go bankrupt (for iOS owners)</a></li>
<li><a href="../435602/index.html">Azure Exam Preparation</a></li>
<li><a href="../435604/index.html">BlaBlaCar became what was not intended</a></li>
<li><a href="../435606/index.html">How to write unit tests for actors? SObjectizer approach</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>