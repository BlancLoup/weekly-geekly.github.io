<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lumia Midsummer Night: How a photo installation was created at the MSND festival</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On June 21, on the day of the summer solstice, Midsummer Night's Dream was held at the Serednikovo estate near Moscow. Every year, guests gather at th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lumia Midsummer Night: How a photo installation was created at the MSND festival</h1><div class="post__text post__text-html js-mediator-article">  On June 21, on the day of the summer solstice, <a href="http://www.midsummernightsdream.ru/">Midsummer Night's Dream</a> was held at the Serednikovo estate near Moscow.  Every year, guests gather at the event in truly impressive masquerade costumes.  However, today we want to tell a little about it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/804/358/ba7/804358ba7b1ed93b26f381737724d1ed.png"><br><br>  Our cooperation with the organizers has become a good tradition.  This year we decided to surprise visitors with an interactive installation - ‚Äúbullet time‚Äù with a photo machine consisting of 60 Nokia Lumia 1520 smartphones. It allowed making impressive live pictures with the effect of frozen time in 360 ¬∞ format, which the guests of the festival could later enjoy.  We talked about the technical aspects of the creation of this machine with our colleagues who were responsible for the direct implementation of the project. <br><a name="habracut"></a><br><h4>  Process </h4><br>  We came to our colleagues from Hello Computer with a ready-made idea and ... deadlines.  Fortunately, they readily went to work: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/a38/791/ff7/a38791ff7a5702f9c0fef0788e2fdfec.jpg"><br><br>  ‚Äú <i>The project was allocated only three weeks, and after all the approvals and writing of the TOR, there are generally two.</i>  <i>Therefore, we immediately tried to determine the most optimal solutions and platforms that could provide us with a fast development speed.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd2/939/381/fd2939381f4f85079c9afc9016e0f788.jpg"><br><br></i>  <i>First of all, we started with the synchronization of phones.</i>  <i>It is clear that forcing 60 devices connected via wireless to take a picture at the same time is a rather difficult task.</i>  <i>Therefore, our choice fell on the architecture of "client-server</i> ". " <br><br>  As planned by the developers, the phones (clients) had to contact the server, synchronize time with it, calculating the corrections for the signal and get the time from the server when you need to take a picture. <br><br><h4>  Team </h4><br>  The team that worked on the project included 7 people: two Windows / Windows Phone developers (one worked as a phone application, the other on a tablet);  server developer who worked with the central server and utilities for gluing and sharing;  project producer and assistant producer responsible for management;  designer;  Technical Director, on whose shoulders lay the preparation of TZ, coordination of work, prototyping, network and equipment design. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/14f/c2a/def/14fc2adef400852dfbe6d0da62f53197.jpg"><br><br><h4>  Architecture </h4><br>  As it should be, the collective thought process began with a heated discussion, although the subject itself was Nokia Lumia 1520: <br><br>  ‚Äú <i>In our studio, only one person uses Windows Phone, so everyone else was interested in testing the devices and at the same time spending half a day on‚Äú holivar ‚Äùon the topic:‚Äú Do we need such big phones? ‚Äù,‚Äú Is the Windows Phone platform good? ‚ÄùAnd so on. d.</i>  ". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d80/de1/ffe/d80de1ffed84b795a7614bc26cb6684d.jpg"><br><br>  However, soon the project began to acquire its features from the technical side: <br><br>  ‚Äú <i>Since we decided from the very beginning with the architecture of the project, the main task for us was to remove as much logic as possible to the server.</i>  <i>Setting up any kind of settings in 60 phones is a very time-consuming task.</i> <i><br><br></i>  <i>We started with a simple NodeJS server prototype and a skeleton application for a Windows Phone 8.1 phone.</i>  <i>Once a second, the server sent requests for smartphones to synchronize the current time and time of the moment of shooting.</i>  <i>We also concluded that the difference between the ‚Äúinternal‚Äù time of the device and the timing it received from the server.</i>  <i>This difference pleased us: it was only within 20-30 milliseconds</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2da/c2b/4e5/2dac2b4e5218c54ed1246e834b89b647.jpg"><br><br>  At the first design stage, the developers had 5 smartphones, of which they assembled the first prototype.  After a quick test, as usual, unforeseen difficulties emerged: <br><br>  ‚Äú <i>The first thing that caught my eye was the difference in color and illumination of images.</i>  <i>And for the "glue" we needed to get the same picture on all devices.</i> <i><br><br></i>  <i>Here, Windows Phone pleased us with good and complete documentation (for example, about what settings can be transferred to the phone) and ready-made examples.</i>  <i>It was important for us to set the same white balance, shutter speed and ISO on all devices.</i>  <i>And thanks to the advanced shooting settings in the Nokia Lumia 1520, which are usually found only in cameras, we were able to easily build a frame on each of the devices.</i>  <i>We were also pleasantly surprised and the manual focus adjustment mode was useful.</i> <i><br><br></i>  <i>All these settings were also received from the server</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ddc/8de/382/ddc8de382dcde9590dca05a5df1bec95.jpg"><br><br>  Next, the team had to establish interaction between the devices and the server: <br><br>  ‚Äú <i>Pretty quickly we set up automatic sending of photos back to the server.</i>  <i>At this point, we had a ready-made prototype of the application, which could be started to be tested on more phones.</i> <i><br><br></i>  <i>We organized all client-server interaction according to the principles of REST API.</i>  <i>In NodeJS (more precisely, in Express) this is done quite quickly and simply.</i>  <i>We made the management interface in the form of a simple web page that opens from a local server.</i>  <i>Data exchange implemented using weboket.</i>  <i>Fortunately, we didn‚Äôt have to worry about cross-browser compatibility</i> . ‚Äù <br><br><h4>  Gluing and placing in the network </h4><br>  In parallel with writing an application for phones, the team worked on utilities for pasting photos into one video and then posting them on the network.  As was clear from the number of devices involved in the project, the input of the utility should have received a set of 60 photos. <br><br>  ‚Äú <i>We decided not to reinvent the wheel and used ffmpeg for gluing and resizing photos.</i>  <i>He pleasantly surprised us by the fact that he could do everything we needed: to glue the photo into a video with a change in the quality of compression and fps ;, change the size of the photo, impose a watermark</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3c3/a59/a95/3c3a59a95a51a70954c510d307473978.jpg"><br><br>  An important task of the project was the ability to automatically post the resulting video to the network.  For us, the social component of this project was a priority, so the team was required to teach the photo machine to automatically upload videos to the public stream, send links to the mail and enable MSND guests to share videos on social networks. <br><br>  ‚Äú <i>It was decided to take <a href="http://coub.com/view/27gin">Coub</a> as the video hosting for several reasons.</i>  <i>Firstly, our short looped videos with music is the perfect format for Kouba.</i>  <i>Secondly, this service has a convenient API for downloading, with which we have already worked before.</i>  <i>The documentation, unfortunately, is hidden, but the guys send it on request.</i>  <i>Thirdly, it was possible to easily and conveniently set up the feed and beautifully draw it.</i>  <i>And, of course, each video could be shared online - this opportunity was provided by Coube itself, which saved development time.</i> <i><br><br> <a href="http://coub.com/view/26yiy"><img src="https://habrastorage.org/getpro/habr/post_images/70c/cf0/913/70ccf0913a16e26321bf81bbae67eb6c.png"><br></a> <br><br></i>  <i>From the previous project, we still have a suitable Python script.</i>  <i>It worked quite simply: it scanned the correct folder and downloaded each new video file, after which it created a small text file with the video address and its status.</i>  <i>We specifically abandoned the use of databases in favor of script flexibility and portability in any other project.</i>  <i>Also, this script was able to send video to the mail</i> . " <br><br>  We also asked to add the ability to download the video to your device via the OneDrive service: <br>  ‚Äú <i>OneDrive has a clean and convenient API.</i>  <i>Therefore, we simply added our script with a module for uploading video to the ‚Äúcloud‚Äù.</i>  <i>First, he passed the standard OAuth authorization, then uploaded files to our account and received a link to view and download.</i>  <i>This link was saved to the same small file</i> . ‚Äù <br><br>  An important aspect of the work of all utilities was the support of offline mode.  If the download of files for one reason or another did not succeed, the scripts silently tried to repeat it after a while. <br><br><h4>  The tablet </h4><br>  The tablet on Windows RT - Lumia 2520 was chosen as a device on which guests could view their 360 ¬∞ images. The developers wrote an application that also accessed the server and received a list of all the videos from it.  In the application, users could enter the mail, as well as get a QR code with a link to OneDrive or Coub. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e1/c84/723/1e1c84723f837f65347b31782b07b2c0.jpg"><br><br><h4>  Network architecture </h4><br>  When the software was ready, it was time to go to the field trials.  To begin with, all 60 smartphones and the server were merged into one network.  In order for the team not to get confused during the final assembly and further work with content, the server was assigned 254 addresses, and smartphones from 1 to 60. All devices were strictly numbered, and in the router each MAC address was assigned its own IP. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f20/81f/d19/f2081fd197fec7cd16ee59d254a2d48d.jpg"><br><br>  However, a one-time connection of 60 phones to one Wi-Fi network was not such a simple task: <br><br>  ‚Äú <i>We received all 60 smartphones 5 days before launch, and then the funniest‚Äú tambourine dances ‚Äùbegan in this project.</i> <i><br><br></i>  <i>We started tests on one of the most top routers (hereinafter, manufacturers and models of routers are not mentioned in order to avoid causing any reputational damage, author's note).</i>  <i>He calmly withstood the connection of all 60 Lumia, but when he tried to get pictures from the devices, the files started to get lost.</i>  <i>We were ready for this and had ready ‚Äúplates‚Äù from another well-known manufacturer in order to distribute the customers evenly across three routers</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f76/f57/160/f76f57160dd761c5f076fd35318c5f3f.jpg"><br><br>  However, in this case, the team failed: the transfer of the first packet of photos took place without any problems, but the rest were lost in transmission or came with a delay of several minutes. <br><br>  ‚Äú <i>We started to panic - 4 days before launch, and with Wi-Fi everything is bad.</i>  <i>We tried to dissolve everything on different non-intersecting channels.</i>  <i>It's better, but not much.</i>  <i>With that, the ‚Äúweight‚Äù of one photo is only 500 kilobytes, that is, the total size of 60 photos was 30 megabytes + service traffic</i> . ‚Äù <br><br>  Began a long phase of testing.  Engineers tried to understand how the situation changes when one or another number of phones is disconnected. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f7e/d59/0ea/f7ed590eae3b0f967f81b6e51cf6c4e7.jpg"><br><br>  ‚Äú <i>Probably, the conclusions reached by us will seem logical for specialists, but we are faced with such problems for the first time.</i>  <i>Therefore, their decision cost us a lot of time.</i> <i><br><br></i>  <i>The key mistake for us was that we tried to transfer all the photos at the same time.</i>  <i>The signals interfered with each other, so the files were transferred very slowly.</i>  <i>We were able to solve the problem by setting a delay of 2 seconds for each next device in the chain</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e46/e2b/4ff/e46e2b4ffc56e238b7cb228e7d8ea913.jpg"><br><br>  As a result, we came to a scheme in which every 20 devices were separated into a separate router and its own channel.  This made it possible to transfer simultaneously 1 file per each router, taking into account a two-second delay, without any special problems.  In such an architecture, sending one image took from 0.5 to 2 seconds (sometimes there were delays of up to 10 seconds), but the loss of files was already excluded from the list of problems. <br><br>  ‚Äú <i>Thus, it took us about 45 seconds to collect all the photos from the devices.</i>  <i>Probably, this process could have been done faster, but under the conditions of a hard deadline there was no time for further experiments.</i>  <i>Yes, and this speed, in principle, suited everyone: the change of guests inside the farm (the internal name of the installation among developers, author's note) and the preparation for the shooting took about the same amount of time</i> ‚Äù. <br><br><h4>  "Farm" </h4><br>  The basis of the ‚Äúfarm‚Äù was the classic construction for shooting video in bullet time format: a curved spiral-shaped frame on which devices are mounted for shooting.  In the course of the discussion of the project, some decorative improvements were proposed.  One of them was, for example, a decorative fire in the center of the installation that was suitable for the subject of the event, through which guests had to jump at the time of the shooting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/472/dfb/ce1/472dfbce1ae69b8276f940e1f1b4eb4a.jpg"><br><br>  Experimenting with the shape of the frame the team stopped at a four-meter radius and vertical position of the phones.  This was explained both by the features of the shooting of the smartphones themselves and by the budget: an increase in the radius to 6 or 8 meters would lead to a significant increase in the cost of the project. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a26/bc5/068/a26bc5068c63adbbb1bb07caa27e2676.jpg"><br><br>  ‚Äú <i>The main engineering task at this stage was the development of a mount that would allow very precisely adjusting the position of the phones in 2 planes of rotation.</i>  <i>As a result, we stopped at a plastic mount with metal clips.</i>  <i>The only thing left was to produce and assemble everything in time</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cdf/c8a/7b3/cdfc8a7b387943d03110ebc31777a1bf.jpg"><br><br><h4>  X-day: montage </h4><br>  At the last stage, the team had to assemble the disparate components into one single system.  They had only two days to install the equipment.  The first day was completely given away for installation of the structure and Internet equipment, and the second day was for installation and configuration of smartphones, technical equipment and their testing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f9/a38/384/1f9a383842d94bf011a4c0a91839e25c.jpg"><br><br>  ‚Äú <i>The most difficult and time-consuming stage is the installation of smartphones.</i>  <i>Filling software on all 60 devices takes about an hour.</i>  <i>Now imagine what any bugs we found cost (well, that the client did not agree to 120 phones :)).</i> <i><br><br></i>  <i>During the testing phase, we did encounter several errors with several times; as a result, we had to update the software on all devices again and again.</i>  <i>Probably, it would be possible to make a system update by air, but there was no time for it anymore.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b0f/9c8/bc3/b0f9c8bc32740261d1348ff3e86f3a07.jpg"><br><br></i>  <i>A separate story - installation 60 "Lumy".</i>  <i>Smartphones had to be mounted very precisely, so that there were no jumps in the final videos.</i>  <i>To do this, we made a special setting mode when smartphones displayed the image from the camera on the screen with a label in the center.</i>  <i>In the center of the farm, we installed a rack with a bright target, which smartphones placed on.</i>  <i>At first glance it seems that it is simple, but in reality it took us about 4 hours to set up the initial setting and another 3 hours to adjust</i> . ‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/181/9e1/518/1819e1518de603a0fb8d4ad361fb59cb.jpg"><br><br>  All night and the following day, right up to the beginning of the event, the team was engaged in testing software, debugging modules and fixing software bugs. <br><br><h4>  Planning </h4><br>  Implementing a project of this level for a two-week period was a serious challenge for the development team. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dca/a9c/27d/dcaa9c27d7e1c9d50130050e7fcd3a64.jpg"><br><br>  ‚Äú <i>This project was made for a specific event and had a clear‚Äú deadline ‚Äù, so even a day delay would be a complete failure for all of us.</i>  <i>We needed to clearly plan our resources.</i> <i><br><br></i>  <i>We tried first to simplify the task as much as possible.</i>  <i>Make a raw minimum, and then add to it "features" and additional functionality.</i>  <i>And so in all aspects - from programming to design design.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/063/322/232/063322232c2d83234ccd12c3505e74bc.jpg"><br><br></i>  <i>In order to accurately meet the deadline all the processes had to run in parallel.</i>  <i>We tried to make the components as autonomous as possible, so that developers do not depend on each other</i> . ‚Äù <br><br><h4>  Impressions </h4><br>  ‚Äú <i>In fact, such projects are very charged.</i>  <i>We worked together very closely for the whole two weeks.</i>  <i>It was felt that everyone was sick for the result.</i>  <i>Including Nokia: the client went to meet us and promptly made all the decisions.</i> <i><br><br></i>  <i>In general, the project was a success, and we all implemented on time.</i>  <i>Of course, there are a lot of aspects that can be improved.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/eee/434/8e3/eee4348e3fcbf593ab15b75c6fed04ec.jpg"><br><br></i>  <i>For example, we could not achieve super accurate synchronization: some people were jerking on the video in a jump.</i>  <i>In this case, you need to come up with some more reliable solution.</i>  <i>We also have to work on the network and improve the speed of receiving photos, making it a separate process in the background and, possibly, moving the system to the 5 GHz standard.</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/69e/080/bfe/69e080bfeaf023a4b30acc10ca93c817.jpg"><br><br></i>  <i>As for the Windows Phone OS and Windows OS installed on the Nokia Lumia 1520, we were generally satisfied with them.</i>  <i>Not being familiar with the development of these platforms, we treated them with skepticism.</i>  <i>As it turned out, not only are they comfortable and pleasant to work with, Microsoft and Nokia are building a good infrastructure around them with tools and complete documentation</i> . ‚Äù </div><p>Source: <a href="https://habr.com/ru/post/230373/">https://habr.com/ru/post/230373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230357/index.html">Parallel non-parallel or search for prime numbers on the GPU</a></li>
<li><a href="../230359/index.html">SASM - IDE for assembler</a></li>
<li><a href="../230361/index.html">LG G3: outside and inside the clearest smartphone in the world</a></li>
<li><a href="../230365/index.html">HybridAuth for UMI.CMS. Authorization through social networks on UMI.CMS</a></li>
<li><a href="../230367/index.html">Machine learning is a microscope of a modern scientist. Why CERN Yandex Technologies</a></li>
<li><a href="../230377/index.html">Unity3D + Google Services: multiplayer for your project on Android and iOS</a></li>
<li><a href="../230383/index.html">What is my hard drive</a></li>
<li><a href="../230385/index.html">Google announced free programming courses for Android</a></li>
<li><a href="../230389/index.html">Mapcode - the simple and short address of any place on Earth</a></li>
<li><a href="../230391/index.html">"Holographic" displays for smartphones may appear in a couple of years</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>