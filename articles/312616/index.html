<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New PowerShell Features in Windows Server 2016</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day% HabraUser%! Not so long ago, I was fortunate enough to become the owner of VDS with pre-installed Windows Server 2016 to get acquainted with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New PowerShell Features in Windows Server 2016</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/636/82b/4ee/63682b4eee8b4b08a9a804a7d4f0fb62.jpg" align="left">  Good day% HabraUser%!  Not so long ago, I was fortunate enough to become the owner of VDS with pre-installed Windows Server 2016 to get acquainted with this operating system and its new features.  Due to the fact that for the past few years I have been a fan of administration using PowerShell, it was he who first of all interested me, as I use it in my work daily to automate routine tasks.  In the corporate environment today, most often the last used version of Windows 8.1 and Windows Server 2012 R2 operating systems, respectively, I did not pay attention to the changes that Windows 10 brought me on my home computer, and as it turned out in vain.  I missed the updated tool, which has become much better, more convenient and faster than previous versions, and I would like to talk about these major changes.  Welcome under cat. <br><a name="habracut"></a><br>  At the beginning of the list there will be the most minor changes that are designed to make the daily use of this product more comfortable for the administrator: <br><br><ul><li>  The PowerShell editor window can now be resized, a dubious achievement, but now the window can be maximized; <br><br>  Let's compare: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/9eb/ca3/9b9/9ebca39b90be45fb9ce9f04b2d1e4cfd.png"><br>  <em>Powershell 2.0</em> <br><br><img src="https://habrastorage.org/files/01b/93f/868/01b93f86835f4c7a88b69c153901e124.png"><br>  <em>Powershell 5.1</em> <br><br></li><li>  The next obvious difference that can be seen on the screenshots is syntax highlighting - this is already a very big plus; <br><br></li><li>  It is followed by another innovation - henceforth, modules and cmdlets of different versions should continue to be supported; <br><br>  This example is best seen in the screenshots: <br><br><img src="https://habrastorage.org/files/6b7/482/b92/6b7482b92dca4d44b33ccf348a674cdb.png"><br>  <em>Powershell 2.0</em> <br><br><img src="https://habrastorage.org/files/869/e3d/928/869e3d9280334928833cbc70cba1f5fd.png"><br>  <em>Powershell 5.1</em> <br><br>  As can be seen from the screenshot, a new team has appeared, which, just like the more well-known Update-Help to update the help, serves to update versions of Update-Module modules. <br><br></li><li>  Classes have appeared, there is a separate <a href="https://habrahabr.ru/post/254999/">article</a> on this subject; <br><br></li><li>  The speed of work with com objects has increased. </li></ul><br>  About the last point I would like to talk separately.  The size of Active Directory in organizations is different, there were cases when it was 20-60 users, and there were also when there are more than several tens of thousands and if in the first case you can do with only a graphical interface, then in the second you can do it, but rather difficult.  Few administrators imagine Active Directory as a voluminous database of information from which you can get the data you need to work in a matter of minutes by applying the right approach to it. <br><br><div class="spoiler">  <b class="spoiler_title">Some advertising</b> <div class="spoiler_text">  The image of Windows Server 2016 appeared only yesterday for download in the Microsoft partners catalog, and today you can familiarize yourself with all its features for only 250 rubles per vpsville. </div></div><br><div class="spoiler">  <b class="spoiler_title">Lyrical digression...</b> <div class="spoiler_text">  Microsoft initially presented Active Directory as a tool not only for system administrators, but also for human resources staff.  The first must contain everything in working condition in terms of server and software architecture, the latter in turn are responsible for correctly filling the directory.  Therefore, as is commonly understood from all sources from which information can be gathered on this issue, the administrator should not create user accounts, and create groups based on Active Directory ideology as well, but in our harsh Russian realities, things <s>are</s> not quite right. </div></div><br><div class="spoiler">  <b class="spoiler_title">Instead of technical specifications.</b> <div class="spoiler_text">  Let's imagine that we do not work in the smallest organization and have under control several domain controllers in branches scattered throughout our vast country, respectively, the number of employees we have for example will be at least one thousand people.  Recall that the country we have is divided into many time zones and when some just come to work, others are already going to sleep, so the Active Directory management model will be partially centralized, which implies the existence of administrators in the regions, and not only in the central office.  We also have internal technical documentation with the requirements of maintaining Active Directory, so that everything would be unified and convenient, we remember that this is a cool database, not just a blooper. </div></div><br>  And so we have the knowledge and the task that needs to be solved, let's do just that. <br><br>  Due to the fact that according to our technical specification, the data we have is very well structured, we can refer to them using standard queries, one such example is the directory of employees that is used in each enterprise. <br><br>  This is what PowerShell looks like: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADUser -<span class="hljs-keyword"><span class="hljs-keyword">Filter</span></span> * -SearchBase "OU=Users,OU=Main Office,DC=MyCompany,DC=ru" -<span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> <span class="hljs-string"><span class="hljs-string">'Domain Controller Name'</span></span> -Properties displayName, description, physicalDeliveryOfficeName, telephoneNumber, mail, title, department, company, manager | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> displayName, description, physicalDeliveryOfficeName, telephoneNumber, mail, title, department, company, manager | Export-CSV "C:\Export\MainOffice.csv" -NoType -UseCulture -<span class="hljs-keyword"><span class="hljs-keyword">Encoding</span></span> Unicode</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Comments on the code</b> <div class="spoiler_text">  <a href="https://technet.microsoft.com/en-us/library/ee617241.aspx">Get-ADUser</a> - a cmdlet that receives an array of users from the search area (-SearchBase) with the properties specified with a comma after the -Properties parameter; <br>  <a href="https://technet.microsoft.com/en-us/library/hh849932.aspx">Export-CSV</a> - exports this array to a file. </div></div><br>  As a result, we get a ready-made table with the necessary fields: Name, Account Number, Telephone Number, Mail Address, Position, Department Name, Branch Name, Full Name.  The head of the employee.  This script works for a few seconds and allows us to change only <s>two (file name)</s> one parameter search area (-SearchBase) and get a directory of any branch at the current time.  Then we open the file we created in Excel, change the names of the columns, format as we like and save in the native Excel format.  Realizing that this is self-indulgence and you can do something more serious by yourself came the option of working with a COM object, namely Excel. <br><br><pre> <code class="hljs mel">$Template_Excel = <span class="hljs-string"><span class="hljs-string">"C:\PS\.xlsx"</span></span> $SaveAs = <span class="hljs-string"><span class="hljs-string">"C:\PS\.xlsx"</span></span> $AllExcel = @(Get-Process [e]xcel | %{$_.Id}) $MyExcel = New-Object -ComObject Excel.Application $ExcelId = Get-Process excel | %{$_.Id} | Where {$AllExcel -notcontains $_} $MyExcel.Visible = $False $WorkBook = $MyExcel.workbooks.open($Template_Excel) $WorkSheet = $WorkBook.sheets.item(<span class="hljs-string"><span class="hljs-string">""</span></span>) $Users = Get-ADUser -Filter * -SearchBase <span class="hljs-string"><span class="hljs-string">"OU=Users,OU=Main Office,DC=MyCompany,DC=ru"</span></span> -Server <span class="hljs-string"><span class="hljs-string">'Domain Controller Name'</span></span> -Properties displayName, description, physicalDeliveryOfficeName, telephoneNumber, mail, title, department, company, manager | Select sAMAccountName, displayName, description, physicalDeliveryOfficeName, telephoneNumber, mail, title, department, company, manager For($x = <span class="hljs-number"><span class="hljs-number">0</span></span>; $x -le $Users.count; $x++) { $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">1</span></span>) = $Users[$x].displayName $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">2</span></span>) = $Users[$x].description $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">3</span></span>) = $Users[$x].physicalDeliveryOfficeName $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">4</span></span>) = $Users[$x].telephoneNumber $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">5</span></span>) = $Users[$x].mail $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">6</span></span>) = $Users[$x].title $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">7</span></span>) = $Users[$x].department $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">8</span></span>) = $Users[$x].company $WorkSheet.Rows.Item($x+<span class="hljs-number"><span class="hljs-number">2</span></span>).Columns.Item(<span class="hljs-number"><span class="hljs-number">9</span></span>)= $Users[$x].manager } $Workbook.SaveAs($SaveAs) $MyExcel.<span class="hljs-keyword"><span class="hljs-keyword">quit</span></span>() Stop-Process -Id $ExcelId -Force -ErrorAction SilentlyContinue</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Comments on the code</b> <div class="spoiler_text">  <a href="https://technet.microsoft.com/en-us/library/hh849832.aspx">Get-Process</a> - gets the list of processes, in our case [e] xcel; <br>  <a href="https://technet.microsoft.com/en-us/library/hh849885.aspx">New-Object</a> - create a new COM object, start your Excel process; <br>  <a href="https://technet.microsoft.com/en-us/library/hh849781.aspx">Stop-Process</a> - delete the created object. <br></div></div><br>  The code in PowerShell has become a bit more, but at the output we received a ready-made file, in which nothing needs to be fixed.  There was only one big thing, but this code in Windows 8.1 works ~ 25-40 minutes depending on the number of objects processed, and most of the time it takes to work with the COM object.  Accordingly, it was inconvenient to use this approach before the appearance of PowerShell 5 in my life due to the time it took to form the file.  In Windows 10 or Windows Server 2016, this script works in a couple of minutes, which allows you to expand the scope of opportunities. <br><br><div class="spoiler">  <b class="spoiler_title">*</b> <div class="spoiler_text">  * - in the comments to the code the names of the cmdlets are links to the official documentation. <br></div></div><br>  Thank you for reading to the end.  Chukchi is not a writer, Chukchi reader. </div><p>Source: <a href="https://habr.com/ru/post/312616/">https://habr.com/ru/post/312616/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312596/index.html">Thematic modeling of repositories on GitHub</a></li>
<li><a href="../312600/index.html">NSCO algorithm (Ho-Kashyap algorithm)</a></li>
<li><a href="../312602/index.html">Open a set of free courses on programming and development for FPGA</a></li>
<li><a href="../312604/index.html">Crossover: High-paying, full-time teleworking for IT professionals</a></li>
<li><a href="../312608/index.html">ESP8266 bath control, 2 years - normal flight</a></li>
<li><a href="../312620/index.html">As we all sent to yukh (well, or continuation of the story about the template engine)</a></li>
<li><a href="../312624/index.html">Presentation of DriverPack Cloud</a></li>
<li><a href="../312626/index.html">How to make friends Bagri and MongoDB</a></li>
<li><a href="../312628/index.html">Using CSS Flexbox to position blocks on page</a></li>
<li><a href="../312630/index.html">Asterisk cluster. Centralization of registration information</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>