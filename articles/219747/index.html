<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Walking around the rake and the circles when creating a game from scratch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A post about making a dream and creating a game from scratch. And about a rake of different size. 



 0. Given 

 Once, in times not so distant from ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Walking around the rake and the circles when creating a game from scratch</h1><div class="post__text post__text-html js-mediator-article">  A post about making a dream and creating a game from scratch.  And about a rake of different size. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dbf/266/3d2/dbf2663d2e7c3d9b8d0d8a0e99af6a4c.jpg"></div><br><a name="habracut"></a><br>  <i>0. Given</i> <br><br>  Once, in times not so distant from us, when the Internet in Ufa was still with MBP, I was creating and developing local ‚Äúfrushnyh‚Äù Lineage and WoW servers.  But then there were unlimited tariffs, and local services began to lose their relevance and I went into web development. <br>  In some ways, as a hobby, I even saved my attitude to Geymdev, but on the other hand, developing bots and all that. <br>  The years went by, and the thought of writing something of their own, with preference and poetess, did not cease to torment me.  At some point, I realized that either now or never. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>1. Idea and Prototype</i> <br><br>  Where does the development start?  C prototype.  A prototype - with the idea.  For the first project is to create something small and simple.  Feeding love for puzzles and step-by-step strategies, I got carried away with the thought that you need to do some step-by-step puzzle.  Upon reflection, I remembered one interesting game from the times of the Spectrum (it is worth noting that the author is not as old as it may seem), the idea of ‚Äã‚Äãwhich was beautiful in its simplicity.  The player walks on 1 cell, avoiding obstacles, and the enemies chase him and go on 2 cells, but obstacles do not bypass. <br><img src="https://habrastorage.org/getpro/habr/post_images/515/5e1/11b/5155e111bb619b91f73b71ad0b18c8f5.jpg" align="right"><br>  If we take the situation ‚ÄúA,‚Äù then we can safely walk up and down, and the monster will simply rest against the wall.  In situation ‚ÄúB‚Äù, the monster is in the zigzag, and we can safely walk to the right, above and below it.  Since the game is deterministic, there are two types of monsters that differ in color and path finding algorithm.  This is so that there is no uncertainty about where the monster will go when it stands diagonally.  Red always first reduces the distance to zero along the X axis the situation ‚ÄúC‚Äù, in which the monster will enter the stub and rest against the wall.  Violet is on the Y axis the situation is ‚ÄúD‚Äù, in it the monster will go down, and then right and eat the main character. <br><br>  There could still be a big paragraph about the choice of "engine" for writing the game.  But perhaps you can get along with a few words;  before trying Unity3D, I poked in the native Obj-C, Corona SDK, UE, Cocos2d and a couple of 2D Frameworks, whose name is so deep in the memory stack that I don‚Äôt dig it out. <br>  As a result, the choice fell on Unity3D, it seemed to me optimal and I slowly began to write.  A month later, this iPad app appeared. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8da/82e/41c/8da82e41cb3ee3db869e86844ed59dac.png"></div><br><br>  In it, we played for a peasant in red and ran away from peasants in blue, and at the same time gathered hearts - read the stars.  At that moment, we also used cubes as walls, but then to save space on the screen, we replaced them. <br>  I would like to note that up to this point, I never wrote in C #, but I wrote in JS, so the prototype was written by UnityScript (this is such a dialect of JS within Unity3D).  And it was the first big rake that served us as a lesson.  I had to rewrite everything in C # and it took a couple of months. <br><br>  <i>2. Team</i> <br><br>  How true that what I wrote in a dozen languages ‚Äã‚Äãis also true that I am not able to draw even a straight line.  Therefore, after creating a prototype, I started looking for an artist \ 3Dshnik, for this I went to the freelance website and looked at the first three hundred people, with a dozen - I wrote off.  Finding a person for a share in a rather risky project is not an easy task.  But it was resolved, and a talented artist Ramil appeared in the project;  so - there are two of us. <br>  In parallel, I was looking for an investor.  The point is not the lack of money to buy plug-ins or devices for the test, but to create commitments that will help not to score (not to resign from authority) under certain circumstances.  And such an investor was found, in the form of a friend who decided to invest his hard-earned money, in this dubious, as it seemed to him, venture.  So, there are three of us.  I note that at the time of launch, the game budget was only about 100,000 rubles, while this amount includes the purchase of several Android devices for testing, plug-ins and voice acting. <br><br>  <i>3. Expansion of the basic concept of the game</i> <br><br>  From the very beginning it was assumed that, despite the fact that the game will be as simple as possible, it will be necessary to introduce several new ideas into the basic concept.  So we had one-sided teleporters (later become a boot), traps and disposable mushrooms that eat up those who approach them. <br><br><div class="spoiler">  <b class="spoiler_title">Concept Art</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/5c6/6cc/360/5c66cc360cc3cd6666b5a14ecbb8f6d4.jpg"></div></div><br><br>  The main feature of the game we planned to do is that the character can go back in time, a few moves back.  Those.  not canceling the move, but the ability to move 1 time per level to the cell where the character was 3 moves back.  This gave a huge number of options for the move, but at the first tests it turned out that ordinary players are not able to pass such levels.  Too hard.  Can it cost to do Brainiac Edition? <br><br>  We also experimented a lot with the size of the levels, eventually settling on the fact that the whole level should fit on the screen, even on devices with a small screen.  So we got levels of 5x8 cells.  But at the same time, we have a pinch zoom, for more fingered or 6x10 levels.  In addition to reducing the size of the levels, turning off the return in time, for simplicity, the cancellation was added, up to 5 times per attempt. <br><br>  <i>4. 2D vs 3D</i> <br><br>  At some point, our test builds looked like this: <br><div class="spoiler">  <b class="spoiler_title">Horror horror</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/155/522/5d4/1555225d4995fa0a59c065953518f9c6.jpg"></div></div><br>  The realization came that we are not able to make a picture that we would like to see in 3D with normal fps.  The test scene for comparison, the performance of 2D and 3D showed not comforting results. <br><div class="spoiler">  <b class="spoiler_title">Screenshots from the scene</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/233/c3d/ffc/233c3dffc941fcccb747a244136c4adc.jpg"><br>  As a result, on iphone4, on the left (3D) there were only 20 frames per second, and on the right (2D), stable 60. At the same time, on the right, the picture quality, as you can see, is an order of magnitude better.  Now of course, if you focus on the minimum performance of the iphone5 + level and make specially a few square graphics, kosher shaders + lightmapping + lightp robes, you can make excellent graphics for 3D </div></div><br><br>  As a result, it was decided to redo everything on 2D.  But here we made a mistake, which only then could not be fixed.  2D animation can be of 2 types, the first is a sequence of frames, the second is the overlay and offset of sprites. <br><div class="spoiler">  <b class="spoiler_title">Visual comparison</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/5a8/c85/059/5a8c85059cc4492130342f4e01d3fef8.jpg"></div></div><br><br>  Since we had 3D models, we chose the first option.  As a result, this will result in a large weight of the application, even taking into account the huge number of optimizations, we will not be able to keep within 50 megabytes. <br><br>  <i>5. Force majeure is an opportunity.</i> <br><br>  I don‚Äôt know whether it is possible to call the birth of a child and moving force majeure, but these events excluded our artist from working on the project for a few months.  The same circumstances served me as well.  In order to self-study and knowledge of the intricacies of the stores, I made another small application - the usual guessing movie. <br><div class="spoiler">  <b class="spoiler_title">For those who do not understand what I mean</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ca0/70e/f9b/ca070ef9b7a9fa8137db07117c846810.jpg"></div></div><br>  On this application, I was able to test integration with social services.  networks, several ad networks, internal analytics and in-app purchases. <br><br>  <i>6. Technical part</i> <br><br>  I think it's time to raise the degree of geekiness.  A significant part of the development time took the creation of a level generator.  The generator was written on python, because it was spiritually close to me and numpy allowed me to quickly operate with matrices. <br>  The output generator itself created a txt file (which Unity parsed to create the scene) and a series of pictures showing step-by-step level passing. <br><br><div class="spoiler">  <b class="spoiler_title">gif animation</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b82/63f/462/b8263f462e5a601efc0698698b663399.gif"><br>  Here the green square is the player, yellow is the enemy, the skull is a trap that kills the player or puts the enemy to sleep for 3 turns. <br></div></div><br><br>  Now I can say that writing an external generator in another language is a bad idea.  Mainly, the fact that the game logic begins to be written in two different places.  And this is the risk of a rassinchron.  Especially if you consider that inside the game, there are such concepts as animation and the time of its execution.  Both in the generator and in the game, each cell itself observed what was happening in it: who entered, who left, who died, etc.  But the cells, a kind of teleport or fly swatter (attacks nearby cells), connected several cells together.  And if it didn‚Äôt cause problems in the generator, it was more difficult to repeat the same in the game.  animations of characters from different cells should have synchronized with each other. <br><br>  A huge chunk of time was taken by the integration of native libraries.  Let me be blunt: if you can buy a ready-made implementation of what you need, feel free to buy.  In this case, it is desirable to take everything from one vendor, because as in Unity3D in the manifest (Android), there is such a thing as mainactivity and this is a place where different plugins may conflict.  Then for iOS, most likely, you will have plug-ins that are involved in various post-processing, this is also a place for conflicts.  In general, natives are a place where you can easily get very difficult to detect errors.  Therefore, almost everything related to the native code was bought from Prime31. <br><br><div class="spoiler">  <b class="spoiler_title">Full list of plugins and a few words about each</b> <div class="spoiler_text">  Prime31 (Android + iOS) Admob $ 95 - advertising with a large fillrate, it just so happens that not all networks can show a banner when asked for ... <br>  Prime31 (Android + iOS) Flurry $ 100 - analytics + advertising. <br>  Prime31 (Android + iOS) InApp Purchases $ 130 - in-app purchases. <br>  Prime31 (Android + iOS) Social $ 120 - social integration of Twitter and FaceBook, so that you can post the result or just like the app. <br>  Prime31 (Android + iOS) Etcetera $ 130 is a native application evaluation window + every little thing. <br><br>  Since we are talking about plugins, NGUI $ 50 was also bought, the best plugin to create an interface.  In AssetsStore there are a lot of plug-ins for creating GUIs, but IMHO is the best, besides its developer is now working in the Unity team itself and promised at the forum that when the official GUI comes out, he will try to simplify migration to it.  Must have <br><br>  2DToolKit $ 65 for game animation, now it has an alternative, built-in 2D support from Unity.  But 2DToolKit is sharpened to work with sequences of frames, besides it has several very important features.  For example, it can cut a large image into squares and put them into one atlas, this is necessary if you have some kind of 2048+ texture at 1xxx pixels.  This will allow it to fit into the texture of 2048x2048 (Limiting the size of android textures).  Out of the box it has support for x1 x2 x4 multi atlases.  For example, you have a character;  he has a lot of animations and they don‚Äôt fit into the 2048x2048 texture, it will automatically break into several atlases that, from the code, you will see how one collection.  Must have. <br><br>  UniWebView 15 $ is a plugin that allows you to show the browser and receive from it, normal callbacks.  Needed in order to communicate with VK api <br>  Also some free plugins: <br><br>  The official <a href="https://github.com/playgameservices/play-games-plugin-for-unity">Google Play Games plugin for Unity</a> , for achievements, leaderboards and, subsequently, systems for synchronizing progress between devices. <br><br>  <a href="http://www.pushwoosh.com/">Pushwoosh</a> service for sending push-tagging, which has a package for Unity3D. <br><br>  <a href="http://u3d.as/content/unity-technologies/google-play-obb-downloader/2Qq">Google Play OBB Downloader</a> plugin that allows you to create applications larger than 50 megabytes for the Google Play Store.  It comes with source code, was partially rewritten for compatibility with other native plugins. <br><br>  PoolManager by Path-o-logical Games is a good pullman manager in order to avoid lags when an object is created. <br><br>  Audio Toolkit - for working with sound. <br><br></div></div><br><br>  <i>7. Statistics</i> <br><br>  In the release about 400kb, the code I wrote.  Another 150kb is a generator and some related scripts. <br>  In the game itself, at the moment, 3 chapters of 16 selected levels.  There is also a Test mode, where there are about 700 levels dynamically distributed by complexity. <br>  On average, the level without stars can be completed in 25 turns.  The most difficult levels with stars around 55. <br><br>  <i>8. Monetization and promotion</i> <br><br>  There are no exact figures yet, but we, like the Cylon, have a plan. <br>  Using the example of movie guessing, we realized that you can earn money on advertising only if you have 300k + users.  Since the project we have, no matter how cool niche, I think this is not an option.  But at the same time make a paid application for Android - suicide.  As a result, the standard model was chosen today: the display of advertising and the sale of coins.  With any purchase of coins comes complete disabling advertising.  Coins are given when passing levels and for them you can find out the perfect level passing. <br><br>  We decided to advertise through reviews, because the purchase of plants is very expensive and ROI will be negative. <br><br>  The iOS version is also ready, but it has not yet been decided on how to release it.  Maybe it makes sense to negotiate with some publisher. <br><br>  <i>9. A small video game.</i> <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/g2asnZ14uoQ%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhgajiZ-IA3F15XNju6P6-QIN5O7A" frameborder="0" allowfullscreen=""></iframe><br><br>  True, the game is portrait orientation screen. </div><p>Source: <a href="https://habr.com/ru/post/219747/">https://habr.com/ru/post/219747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219729/index.html">Introduced the first prototype of a modular smartphone from Google.</a></li>
<li><a href="../219731/index.html">A look at the mobile Y.Video</a></li>
<li><a href="../219733/index.html">Watch the online broadcast of the Russian final of the Imagine Cup competition.</a></li>
<li><a href="../219735/index.html">Part 4.2 We return the sight. From points to the excimer laser</a></li>
<li><a href="../219741/index.html">Do you need managers in IT?</a></li>
<li><a href="../219751/index.html">Nokia Lumia 1320: tested in humans</a></li>
<li><a href="../219757/index.html">Always on: UX innovations in modern smartphones</a></li>
<li><a href="../219759/index.html">Happy birthday, Habrahabr!</a></li>
<li><a href="../219761/index.html">Teamlab distributes API for free integration of office applications and allows you to deploy them on your server</a></li>
<li><a href="../219763/index.html">To hold a student programming contest: our experience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>