<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Elastix - Asterisk as an emergency voice alert system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is required to make an emergency voice alert system in case of accidents and other incidents. The scheme of work is as follows: 
 The responsible p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Elastix - Asterisk as an emergency voice alert system</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/7cd/c5b/bdc/7cdc5bbdc042e49ed3d240db4dc0ce40.jpg"><br>  It is required to make an emergency voice alert system in case of accidents and other incidents.  The scheme of work is as follows: <br>  The responsible person calls to a specific phone number, dials the code and enters the voice menu of the alert system.  There he is invited to record a message, listen to it, save it, and the system must make calls simultaneously using 5 telephone lines to pre-set phone numbers in the file.  And in case you didn‚Äôt pick up the phone, call the person you‚Äôll notify.  At the end of the notification, a file with telephone numbers to which they could not reach at all should be sent to the specified mail. <br><br>  If it is interesting how it works please under cat. <br><a name="habracut"></a><br>  For making calls in Asterisk there are call files.  When a file is placed in the <b>/ var / spool / asterisk / outgoing</b> directory, it automatically makes a call.  Let's first understand what the call files consist of and what's inside them. <br><br>  There can be several variables inside each file: <br> <code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code><code><code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> <blockquote> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> </blockquote> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> <blockquote> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> </blockquote> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> <blockquote> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> </blockquote> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> <pre> <code class="hljs pgsql"><code><code><code><code><code>Channel: -      <br> CallerID: <span class="hljs-type"><span class="hljs-type">Name</span></span> -  ,      <br> MaxRetries: -         ,   <span class="hljs-number"><span class="hljs-number">0</span></span>,      <span class="hljs-number"><span class="hljs-number">1</span></span> . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    <span class="hljs-number"><span class="hljs-number">60</span></span>   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-<span class="hljs-type"><span class="hljs-type">name</span></span>&gt;</code> -        (  ) <br> <code><code><code><span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>: -  <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>     . <br> Priority: -    <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>,     . <br> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span>  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/<span class="hljs-keyword"><span class="hljs-keyword">No</span></span></code> ‚Äì    .<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span>/<span class="hljs-number"><span class="hljs-number">11</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>%@<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>-<span class="hljs-type"><span class="hljs-type">internal</span></span>/n <br> CallerID: &lt;<span class="hljs-number"><span class="hljs-number">5102</span></span>&gt; <br> MaxRetries: <span class="hljs-number"><span class="hljs-number">4</span></span> <br> RetryTime: <span class="hljs-number"><span class="hljs-number">60</span></span> <br> WaitTime: <span class="hljs-number"><span class="hljs-number">60</span></span> <br> Context: startmessage <br> <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>: <span class="hljs-number"><span class="hljs-number">5102</span></span> <br> Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> <br> <br> <br>   .     <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span>         CDR (      -     ).  ,   <span class="hljs-number"><span class="hljs-number">5</span></span>     <span class="hljs-number"><span class="hljs-number">60</span></span> ,      <span class="hljs-number"><span class="hljs-number">60</span></span> .       -     startmessage.   <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> <span class="hljs-number"><span class="hljs-number">5102</span></span>,  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br> <br>          <span class="hljs-number"><span class="hljs-number">11</span></span>,         .    FreePBX  Outbound route       <span class="hljs-number"><span class="hljs-number">11</span></span>      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; <span class="hljs-number"><span class="hljs-number">9876</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,Goto(testcontext,s,<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> ,      <span class="hljs-number"><span class="hljs-number">9876</span></span>   ,      . <br>     <span class="hljs-number"><span class="hljs-number">2</span></span> .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,Answer <br> exten =&gt; s,n,Wait(<span class="hljs-number"><span class="hljs-number">2</span></span>) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,<span class="hljs-type"><span class="hljs-type">Record</span></span>(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(<span class="hljs-number"><span class="hljs-number">10</span></span>) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(echo "" &gt; /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,n,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(/mnt/script/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.bash /mnt/CallCenter/telefony.txt /mnt/script/main.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,n,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(/mnt/script/startcall.bash) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, Hangup() <br> <br>   -  ,  <span class="hljs-number"><span class="hljs-number">2</span></span> ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             <span class="hljs-number"><span class="hljs-number">10</span></span>    .    <span class="hljs-number"><span class="hljs-number">999</span></span>,    ,   -  . <br> <br>     <span class="hljs-number"><span class="hljs-number">999</span></span>,          <b>/var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span></b> -    <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> .  <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$<span class="lua"><span class="lua"> </span></span><br></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">      . </span></span><br><span class="lua"><span class="lua">    </span></span><b><span class="lua"><span class="lua">/mnt/script/parser.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #  -   ,    FILE=`cat $</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua"> | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u` </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> sed -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/\%1\%/'</span></span></span><span class="lua">$I</span><span class="hljs-string"><span class="lua"><span class="hljs-string">'/g'</span></span></span><span class="lua"> &lt; $</span><span class="hljs-number"><span class="lua"><span class="hljs-number">2</span></span></span><span class="lua"> &gt;&gt; /mnt/script/tmp/$I.call fi done;</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">           call   %</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua">%,    </span></span><b><span class="lua"><span class="lua">/mnt/script/tmp/</span></span></b><span class="lua"><span class="lua">   </span><span class="hljs-string"><span class="lua"><span class="hljs-string">" "</span></span></span><span class="lua">.call . </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">   </span></span><b><span class="lua"><span class="lua">/mnt/script/startcall.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #     - call  OutDir=</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"/mnt/script/tmp/"</span></span></span><span class="lua"> #      call  inDir=</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"/var/spool/asterisk/outgoing/"</span></span></span><span class="lua"> #  call      (     ) CountIn=</span><span class="hljs-number"><span class="lua"><span class="hljs-number">5</span></span></span><span class="lua">; movefile () #     inDir { CounFileInDir=$(</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">find</span></span></span><span class="lua"> $inDir -name </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"*.call"</span></span></span><span class="lua"> | wc -l); #     inDir -   CountIn,      . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> ((</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$CounFileInDir"</span></span></span><span class="lua"> &lt; </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$CountIn"</span></span></span><span class="lua">)); </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> mv $I $inDir #   </span><span class="hljs-number"><span class="lua"><span class="hljs-number">30</span></span></span><span class="lua">     . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">else</span></span></span><span class="lua"> sleep </span><span class="hljs-number"><span class="lua"><span class="hljs-number">30</span></span></span><span class="lua">; movefile; fi } #       *.call   OutDir. FILE=`</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">find</span></span></span><span class="lua"> $OutDir -name </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"*.call"</span></span></span><span class="lua">` #       FILE,   ,   movefile. </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> movefile; fi done; #     -   . /mnt/script/result.bash</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">   </span></span><b><span class="lua"><span class="lua">/mnt/script/result.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">log</span></span></span><span class="lua">/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     </span><span class="hljs-number"><span class="lua"><span class="hljs-number">11</span></span></span><span class="lua"> (   )      @          temp </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> rm temp.temp cat $logfile | grep </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"ANSWERED"</span></span></span><span class="lua"> | grep </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"startmessage"</span></span></span><span class="lua"> | grep $I | awk </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'BEGIN{FS=","}{print $5}'</span></span></span><span class="lua"> | sed -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/.*\/11//g'</span></span></span><span class="lua"> -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/\@.*//g'</span></span></span><span class="lua"> | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u | uniq` #     . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> J </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE1 </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$J"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     </span><span class="hljs-number"><span class="lua"><span class="hljs-number">9876</span></span></span><span class="lua">   dial. (     extensions_custom.conf? ) </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">       ,    ,     ,            ,       .           ,     .</span></span></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> <pre> <code class="hljs pgsql"><code><code><code><code><code>Channel: -      <br> CallerID: <span class="hljs-type"><span class="hljs-type">Name</span></span> -  ,      <br> MaxRetries: -         ,   <span class="hljs-number"><span class="hljs-number">0</span></span>,      <span class="hljs-number"><span class="hljs-number">1</span></span> . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    <span class="hljs-number"><span class="hljs-number">60</span></span>   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-<span class="hljs-type"><span class="hljs-type">name</span></span>&gt;</code> -        (  ) <br> <code><code><code><span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>: -  <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>     . <br> Priority: -    <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>,     . <br> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span>  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/<span class="hljs-keyword"><span class="hljs-keyword">No</span></span></code> ‚Äì    .<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span>/<span class="hljs-number"><span class="hljs-number">11</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>%@<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>-<span class="hljs-type"><span class="hljs-type">internal</span></span>/n <br> CallerID: &lt;<span class="hljs-number"><span class="hljs-number">5102</span></span>&gt; <br> MaxRetries: <span class="hljs-number"><span class="hljs-number">4</span></span> <br> RetryTime: <span class="hljs-number"><span class="hljs-number">60</span></span> <br> WaitTime: <span class="hljs-number"><span class="hljs-number">60</span></span> <br> Context: startmessage <br> <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>: <span class="hljs-number"><span class="hljs-number">5102</span></span> <br> Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> <br> <br> <br>   .     <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span>         CDR (      -     ).  ,   <span class="hljs-number"><span class="hljs-number">5</span></span>     <span class="hljs-number"><span class="hljs-number">60</span></span> ,      <span class="hljs-number"><span class="hljs-number">60</span></span> .       -     startmessage.   <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> <span class="hljs-number"><span class="hljs-number">5102</span></span>,  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br> <br>          <span class="hljs-number"><span class="hljs-number">11</span></span>,         .    FreePBX  Outbound route       <span class="hljs-number"><span class="hljs-number">11</span></span>      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; <span class="hljs-number"><span class="hljs-number">9876</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,Goto(testcontext,s,<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> ,      <span class="hljs-number"><span class="hljs-number">9876</span></span>   ,      . <br>     <span class="hljs-number"><span class="hljs-number">2</span></span> .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,Answer <br> exten =&gt; s,n,Wait(<span class="hljs-number"><span class="hljs-number">2</span></span>) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,<span class="hljs-type"><span class="hljs-type">Record</span></span>(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(<span class="hljs-number"><span class="hljs-number">10</span></span>) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(echo "" &gt; /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,n,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(/mnt/script/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.bash /mnt/CallCenter/telefony.txt /mnt/script/main.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,n,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(/mnt/script/startcall.bash) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, Hangup() <br> <br>   -  ,  <span class="hljs-number"><span class="hljs-number">2</span></span> ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             <span class="hljs-number"><span class="hljs-number">10</span></span>    .    <span class="hljs-number"><span class="hljs-number">999</span></span>,    ,   -  . <br> <br>     <span class="hljs-number"><span class="hljs-number">999</span></span>,          <b>/var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span></b> -    <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> .  <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$<span class="lua"><span class="lua"> </span></span><br></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">      . </span></span><br><span class="lua"><span class="lua">    </span></span><b><span class="lua"><span class="lua">/mnt/script/parser.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #  -   ,    FILE=`cat $</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua"> | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u` </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> sed -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/\%1\%/'</span></span></span><span class="lua">$I</span><span class="hljs-string"><span class="lua"><span class="hljs-string">'/g'</span></span></span><span class="lua"> &lt; $</span><span class="hljs-number"><span class="lua"><span class="hljs-number">2</span></span></span><span class="lua"> &gt;&gt; /mnt/script/tmp/$I.call fi done;</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">           call   %</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua">%,    </span></span><b><span class="lua"><span class="lua">/mnt/script/tmp/</span></span></b><span class="lua"><span class="lua">   </span><span class="hljs-string"><span class="lua"><span class="hljs-string">" "</span></span></span><span class="lua">.call . </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">   </span></span><b><span class="lua"><span class="lua">/mnt/script/startcall.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #     - call  OutDir=</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"/mnt/script/tmp/"</span></span></span><span class="lua"> #      call  inDir=</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"/var/spool/asterisk/outgoing/"</span></span></span><span class="lua"> #  call      (     ) CountIn=</span><span class="hljs-number"><span class="lua"><span class="hljs-number">5</span></span></span><span class="lua">; movefile () #     inDir { CounFileInDir=$(</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">find</span></span></span><span class="lua"> $inDir -name </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"*.call"</span></span></span><span class="lua"> | wc -l); #     inDir -   CountIn,      . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> ((</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$CounFileInDir"</span></span></span><span class="lua"> &lt; </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$CountIn"</span></span></span><span class="lua">)); </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> mv $I $inDir #   </span><span class="hljs-number"><span class="lua"><span class="hljs-number">30</span></span></span><span class="lua">     . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">else</span></span></span><span class="lua"> sleep </span><span class="hljs-number"><span class="lua"><span class="hljs-number">30</span></span></span><span class="lua">; movefile; fi } #       *.call   OutDir. FILE=`</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">find</span></span></span><span class="lua"> $OutDir -name </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"*.call"</span></span></span><span class="lua">` #       FILE,   ,   movefile. </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> movefile; fi done; #     -   . /mnt/script/result.bash</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">   </span></span><b><span class="lua"><span class="lua">/mnt/script/result.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">log</span></span></span><span class="lua">/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     </span><span class="hljs-number"><span class="lua"><span class="hljs-number">11</span></span></span><span class="lua"> (   )      @          temp </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> rm temp.temp cat $logfile | grep </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"ANSWERED"</span></span></span><span class="lua"> | grep </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"startmessage"</span></span></span><span class="lua"> | grep $I | awk </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'BEGIN{FS=","}{print $5}'</span></span></span><span class="lua"> | sed -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/.*\/11//g'</span></span></span><span class="lua"> -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/\@.*//g'</span></span></span><span class="lua"> | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u | uniq` #     . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> J </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE1 </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$J"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     </span><span class="hljs-number"><span class="lua"><span class="hljs-number">9876</span></span></span><span class="lua">   dial. (     extensions_custom.conf? ) </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">       ,    ,     ,            ,       .           ,     .</span></span></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> <pre> <code class="hljs pgsql"><code><code><code><code><code>Channel: -      <br> CallerID: <span class="hljs-type"><span class="hljs-type">Name</span></span> -  ,      <br> MaxRetries: -         ,   <span class="hljs-number"><span class="hljs-number">0</span></span>,      <span class="hljs-number"><span class="hljs-number">1</span></span> . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    <span class="hljs-number"><span class="hljs-number">60</span></span>   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-<span class="hljs-type"><span class="hljs-type">name</span></span>&gt;</code> -        (  ) <br> <code><code><code><span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>: -  <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>     . <br> Priority: -    <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>,     . <br> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span>  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/<span class="hljs-keyword"><span class="hljs-keyword">No</span></span></code> ‚Äì    .<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span>/<span class="hljs-number"><span class="hljs-number">11</span></span>%<span class="hljs-number"><span class="hljs-number">1</span></span>%@<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>-<span class="hljs-type"><span class="hljs-type">internal</span></span>/n <br> CallerID: &lt;<span class="hljs-number"><span class="hljs-number">5102</span></span>&gt; <br> MaxRetries: <span class="hljs-number"><span class="hljs-number">4</span></span> <br> RetryTime: <span class="hljs-number"><span class="hljs-number">60</span></span> <br> WaitTime: <span class="hljs-number"><span class="hljs-number">60</span></span> <br> Context: startmessage <br> <span class="hljs-keyword"><span class="hljs-keyword">Extension</span></span>: <span class="hljs-number"><span class="hljs-number">5102</span></span> <br> Priority: <span class="hljs-number"><span class="hljs-number">1</span></span> <br> <br> <br>   .     <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span>         CDR (      -     ).  ,   <span class="hljs-number"><span class="hljs-number">5</span></span>     <span class="hljs-number"><span class="hljs-number">60</span></span> ,      <span class="hljs-number"><span class="hljs-number">60</span></span> .       -     startmessage.   <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> <span class="hljs-number"><span class="hljs-number">5102</span></span>,  <span class="hljs-number"><span class="hljs-number">1.</span></span> <br> <br>          <span class="hljs-number"><span class="hljs-number">11</span></span>,         .    FreePBX  Outbound route       <span class="hljs-number"><span class="hljs-number">11</span></span>      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; <span class="hljs-number"><span class="hljs-number">9876</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,Goto(testcontext,s,<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> ,      <span class="hljs-number"><span class="hljs-number">9876</span></span>   ,      . <br>     <span class="hljs-number"><span class="hljs-number">2</span></span> .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,<span class="hljs-number"><span class="hljs-number">1</span></span>,Answer <br> exten =&gt; s,n,Wait(<span class="hljs-number"><span class="hljs-number">2</span></span>) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,<span class="hljs-type"><span class="hljs-type">Record</span></span>(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(<span class="hljs-number"><span class="hljs-number">10</span></span>) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(echo "" &gt; /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,n,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(/mnt/script/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.bash /mnt/CallCenter/telefony.txt /mnt/script/main.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">999</span></span>,n,<span class="hljs-keyword"><span class="hljs-keyword">System</span></span>(/mnt/script/startcall.bash) <br> exten =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, Hangup() <br> <br>   -  ,  <span class="hljs-number"><span class="hljs-number">2</span></span> ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             <span class="hljs-number"><span class="hljs-number">10</span></span>    .    <span class="hljs-number"><span class="hljs-number">999</span></span>,    ,   -  . <br> <br>     <span class="hljs-number"><span class="hljs-number">999</span></span>,          <b>/var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.<span class="hljs-keyword"><span class="hljs-keyword">call</span></span></b> -    <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> .  <span class="hljs-keyword"><span class="hljs-keyword">call</span></span>   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$<span class="lua"><span class="lua"> </span></span><br></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">      . </span></span><br><span class="lua"><span class="lua">    </span></span><b><span class="lua"><span class="lua">/mnt/script/parser.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #  -   ,    FILE=`cat $</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua"> | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u` </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> sed -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/\%1\%/'</span></span></span><span class="lua">$I</span><span class="hljs-string"><span class="lua"><span class="hljs-string">'/g'</span></span></span><span class="lua"> &lt; $</span><span class="hljs-number"><span class="lua"><span class="hljs-number">2</span></span></span><span class="lua"> &gt;&gt; /mnt/script/tmp/$I.call fi done;</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">           call   %</span><span class="hljs-number"><span class="lua"><span class="hljs-number">1</span></span></span><span class="lua">%,    </span></span><b><span class="lua"><span class="lua">/mnt/script/tmp/</span></span></b><span class="lua"><span class="lua">   </span><span class="hljs-string"><span class="lua"><span class="hljs-string">" "</span></span></span><span class="lua">.call . </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">   </span></span><b><span class="lua"><span class="lua">/mnt/script/startcall.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #     - call  OutDir=</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"/mnt/script/tmp/"</span></span></span><span class="lua"> #      call  inDir=</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"/var/spool/asterisk/outgoing/"</span></span></span><span class="lua"> #  call      (     ) CountIn=</span><span class="hljs-number"><span class="lua"><span class="hljs-number">5</span></span></span><span class="lua">; movefile () #     inDir { CounFileInDir=$(</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">find</span></span></span><span class="lua"> $inDir -name </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"*.call"</span></span></span><span class="lua"> | wc -l); #     inDir -   CountIn,      . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> ((</span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$CounFileInDir"</span></span></span><span class="lua"> &lt; </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$CountIn"</span></span></span><span class="lua">)); </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> mv $I $inDir #   </span><span class="hljs-number"><span class="lua"><span class="hljs-number">30</span></span></span><span class="lua">     . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">else</span></span></span><span class="lua"> sleep </span><span class="hljs-number"><span class="lua"><span class="hljs-number">30</span></span></span><span class="lua">; movefile; fi } #       *.call   OutDir. FILE=`</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">find</span></span></span><span class="lua"> $OutDir -name </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"*.call"</span></span></span><span class="lua">` #       FILE,   ,   movefile. </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> movefile; fi done; #     -   . /mnt/script/result.bash</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">   </span></span><b><span class="lua"><span class="lua">/mnt/script/result.bash</span></span></b><span class="lua"><span class="lua"> : </span></span><br><span class="lua"><span class="lua"> </span></span><code class="bash"><span class="lua"><span class="lua">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/</span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">log</span></span></span><span class="lua">/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     </span><span class="hljs-number"><span class="lua"><span class="hljs-number">11</span></span></span><span class="lua"> (   )      @          temp </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> I </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$I"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> rm temp.temp cat $logfile | grep </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"ANSWERED"</span></span></span><span class="lua"> | grep </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"startmessage"</span></span></span><span class="lua"> | grep $I | awk </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'BEGIN{FS=","}{print $5}'</span></span></span><span class="lua"> | sed -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/.*\/11//g'</span></span></span><span class="lua"> -e </span><span class="hljs-string"><span class="lua"><span class="hljs-string">'s/\@.*//g'</span></span></span><span class="lua"> | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | </span><span class="hljs-built_in"><span class="lua"><span class="hljs-built_in">sort</span></span></span><span class="lua"> -u | uniq` #     . </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">for</span></span></span><span class="lua"> J </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">in</span></span></span><span class="lua"> $FILE1 </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">do</span></span></span><span class="lua"> </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">if</span></span></span><span class="lua"> [ -n </span><span class="hljs-string"><span class="lua"><span class="hljs-string">"$J"</span></span></span><span class="lua"> ] </span><span class="hljs-keyword"><span class="lua"><span class="hljs-keyword">then</span></span></span><span class="lua"> cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</span></span></code><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     </span><span class="hljs-number"><span class="lua"><span class="hljs-number">9876</span></span></span><span class="lua">   dial. (     extensions_custom.conf? ) </span></span><br><span class="lua"><span class="lua"> </span></span><br><span class="lua"><span class="lua">       ,    ,     ,            ,       .           ,     .</span></span></code></code></code></code></code></code></code> </pre> <code><code><code><code><code><code><code><code>Channel: -      <br> CallerID: Name -  ,      <br> MaxRetries: -         ,   0,      1 . <br> RetryTime: -     ,   ,    ,    -    ,    -        (   ).    . <br> WaitTime: -             .    60   ,   ,          . <br> Account:</code> -      ‚Äúaccount code‚Äù   CDR,     <br> <code>Context: &lt;context-name&gt;</code> -        (  ) <br> <code>Extension: -  Extension     . <br> Priority: -    Extension,     . <br> Set:</code> -             . <br> <code>Application:</code> -   Asterisk,   .    -     context, extension  priority. <br> <code>Data:</code> -    .   . <br> <code>Archive: Yes/No</code> ‚Äì    .call    "outgoing_done"     "Status: ",    : Completed, Expired  Failed.   . <br> <br>     ,        : <br> <br> Channel: Local/11%1%@from-internal/n <br> CallerID: &lt;5102&gt; <br> MaxRetries: 4 <br> RetryTime: 60 <br> WaitTime: 60 <br> Context: startmessage <br> Extension: 5102 <br> Priority: 1 <br> <br> <br>   .     Local         CDR (      -     ).  ,   5     60 ,      60 .       -     startmessage.   extension 5102,  1. <br> <br>          11,         .    FreePBX  Outbound route       11      .         "  "     . <br> <br>         <b>/etc/asterisk/extensions_custom.conf</b> ( Elastix) <br> <br>    <code>exten =&gt; 9876,1,Goto(testcontext,s,1)</code> ,      9876   ,      . <br>     2 .     ,   .   ,    ,   . <br> <br>   : <br> [testcontext] <br> exten =&gt; s,1,Answer <br> exten =&gt; s,n,Wait(2) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/privet-zapis) <br> exten =&gt; s,n,Record(obzvon-message.wav) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/obzvon-message) <br> exten =&gt; s,n,Playback(/var/lib/asterisk/sounds/custom/zapusk) <br> exten =&gt; s,n,WaitExten(10) <br> exten =&gt; s,n,Hangup() <br> exten =&gt; 999,1,System(echo "" &gt; /var/log/asterisk/cdr-custom/Simple.csv) <br> exten =&gt; 999,n,System(/mnt/script/parser.bash /mnt/CallCenter/telefony.txt /mnt/script/main.call) <br> exten =&gt; 999,n,System(/mnt/script/startcall.bash) <br> exten =&gt; 0,1, Hangup() <br> <br>   -  ,  2 ,     <b>/var/lib/asterisk/sounds/custom/privet-zapis</b> ,   <b>obzvon-message.wav</b> ,                <b>/var/lib/asterisk/sounds/custom/zapusk</b> .             10    .    999,    ,   -  . <br> <br>     999,          <b>/var/log/asterisk/cdr-custom/Simple.csv</b> (    ),    <b>/mnt/script/parser.bash</b>   ,   <b>/mnt/CallCenter/telefony.txt</b> -    (       ),   <b>/mnt/script/main.call</b> -    call .  call   .    <b>/mnt/script/startcall.bash</b> . <br> <br>     windows       , ..        ,   Notepad ++,      Windows. <br> <br>      CDR - <b>/etc/asterisk/cdr_custom.conf</b> : <br> <br> [mappings] <br> <code>Simple.csv =&gt; ${CSV_QUOTE(${CDR(clid)})},${CSV_QUOTE(${CDR(src)})},${CSV_QUOTE(${CDR(dst)})},${CSV_QUOTE(${CDR(dcontext)})},${CSV_QUOTE(${CDR(channel)})},$$ <br></code> <br> <br>      . <br>    <b>/mnt/script/parser.bash</b> : <br> <code class="bash">#!/bin/bash #  -   ,    FILE=`cat $1 | sort -u` for I in $FILE do if [ -n "$I" ] then sed -e 's/\%1\%/'$I'/g' &lt; $2 &gt;&gt; /mnt/script/tmp/$I.call fi done;</code> <br> <br>           call   %1%,    <b>/mnt/script/tmp/</b>   " ".call . <br> <br>   <b>/mnt/script/startcall.bash</b> : <br> <code class="bash">#!/bin/bash #     - call  OutDir="/mnt/script/tmp/" #      call  inDir="/var/spool/asterisk/outgoing/" #  call      (     ) CountIn=5; movefile () #     inDir { CounFileInDir=$(find $inDir -name "*.call" | wc -l); #     inDir -   CountIn,      . if (("$CounFileInDir" &lt; "$CountIn")); then mv $I $inDir #   30     . else sleep 30; movefile; fi } #       *.call   OutDir. FILE=`find $OutDir -name "*.call"` #       FILE,   ,   movefile. for I in $FILE do if [ -n "$I" ] then movefile; fi done; #     -   . /mnt/script/result.bash</code> <br> <br>   <b>/mnt/script/result.bash</b> : <br> <code class="bash">#!/bin/bash #     telefoni=/mnt/CallCenter/telefony.txt #      . logfile=/var/log/asterisk/cdr-custom/Simple.csv; #   . cp $telefoni telefoni.tmp #   FILE        . FILE=`cat telefoni.tmp | sort -u | uniq` #      FILE ,     -    logfile     ANSWERED. # startmessage,     ,            #,     11 (   )      @          temp for I in $FILE do if [ -n "$I" ] then rm temp.temp cat $logfile | grep "ANSWERED" | grep "startmessage" | grep $I | awk 'BEGIN{FS=","}{print $5}' | sed -e 's/.*\/11//g' -e 's/\@.*//g' | uniq &gt;&gt; temp$ fi done; #  FILE1    temp.temp,      . FILE1=`cat temp.temp | sort -u | uniq` #     . for J in $FILE1 do if [ -n "$J" ] then cat telefoni.tmp | grep -v $J &gt; telefoni1.tmp mv telefoni1.tmp telefoni.tmp fi done; rm temp.temp;          cat telefoni.tmp | mail -s Ne_Dozvon testmail@example.com</code> <br> <br>    -     .   Inbound routes     CID      .        -     ,   ,     .    DID         .   destination   Misc Destinations    .   Misc Destinations,     9876   dial. (     extensions_custom.conf? ) <br> <br>       ,    ,     ,            ,       .           ,     .</code></code></code></code></code></code></code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/170849/">https://habr.com/ru/post/170849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170831/index.html">Come to experience new flash storage systems for data centers</a></li>
<li><a href="../170835/index.html">Anyone can program at any age.</a></li>
<li><a href="../170843/index.html">Enthusiasts ported Ubuntu for 24 smartphones and tablet PCs</a></li>
<li><a href="../170845/index.html">PyCon is gone</a></li>
<li><a href="../170847/index.html">Unit testing and continuous integration with Jenkins for C ++ projects</a></li>
<li><a href="../170851/index.html">Comparison of css3 & html5 (v 2.0) browsers</a></li>
<li><a href="../170853/index.html">Canon has released mixed reality glasses</a></li>
<li><a href="../170857/index.html">The announcement of the new generation of PaaS and cloud architecture for developers</a></li>
<li><a href="../170861/index.html">ASUS Transformer Book TX300CA Review</a></li>
<li><a href="../170865/index.html">The driver of the rover Curiosity meets Habra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>