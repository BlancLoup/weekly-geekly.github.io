<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We overload data from XPS to 1C processing without OCR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 Faced, then, with such a problem. There is processing in 1C 8.2 and there it is necessary to push a bunch of data in automatic mode. A lo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We overload data from XPS to 1C processing without OCR</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  Faced, then, with such a problem.  There is processing in 1C 8.2 and there it is necessary to push a bunch of data in automatic mode.  A lot of data was in its database, in its architecture, and connecting the database to 1C or reformatting the tables was not possible.  The only way, as it seemed to me, to bring the table to a virtual printer, and from there start dancing. <br><br>  So, we have a document in the * .xps format, which the careful virtual printer gave us: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/ca8/3ac/4e3/ca83ac4e339c4ad198e914e22f793ef4.jpg"><br><a name="habracut"></a><br>  Actually, from all this, I need only the lines of the work itself, the lines of sub-work (begin with the sign "-") and the column of the standard time for each work.  At first I thought that the XPS format is graphical and I have to get the resulting file into any OCR program, recognize the table there and save the data in Excel format.  At first this was done, but there are huge disadvantages: <br><br>  - there is no automation of the process when converting XPS -&gt; 1C. <br>  - OCR programs can mess up with text recognition. <br>  - The conversion process takes a long time. <br><br>  Therefore, we had to deal with the format of XPS directly. <br><br>  Actually, as it turns out, the XPS format is a regular ZIP file.  All information there is in the form of XML.  Pictures go by pictures, text by text.  But we need the text ... <br><br>  Inside we have the following picture: <br><br><img src="https://habrastorage.org/files/b21/03b/e40/b2103be40f9842cb8ac83cdaab2930e3.jpg"><br><br>  I will not go into the details and content of each folder - everything is simple, if you are interested, you can climb it yourself.  I am specifically interested in only one file: <br>  .. \ Documents \ 1 \ FixedDocument.fdoc <br>  Here is the listing of this file: <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span> - <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FixedDocument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/xps/2005/06"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PageContent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Documents/1/Pages/1.fpage"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PageContent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Documents/1/Pages/2.fpage"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PageContent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Documents/1/Pages/3.fpage"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PageContent</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Documents/1/Pages/4.fpage"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FixedDocument</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  As you can see, here are the paths to the file pages of the document. <br>  We make it all in the code 1C: <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>)  = <span class="hljs-class"><span class="hljs-class"></span></span>.;  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(); . = <span class="hljs-literal"><span class="hljs-literal"></span></span>; . = <span class="hljs-string"><span class="hljs-string">"XPS |*.xps"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .() <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = ..(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> (.[], .); (); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span></code> </pre><br><br>  First, unzip the contents of the file to a temporary folder: <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>)  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-type"><span class="hljs-type"></span></span>, , <span class="hljs-string"><span class="hljs-string">""</span></span>);  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(, <span class="hljs-string"><span class="hljs-string">".xps"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>( + );  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type">Zip</span></span>(<span class="hljs-type"><span class="hljs-type"></span></span>); .( + , <span class="hljs-class"><span class="hljs-class">ZIP</span></span>.); .();</code> </pre><br><br>  Now in the file directory we have all the features to work.  We are interested, as stated above, a list of files with pages.  We overload the list in the table.  We work with this file as with normal XML: <br><br><pre> <code class="1c hljs"> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type">XML</span></span>; .( +  + <span class="hljs-string"><span class="hljs-string">"\Documents\1\FixedDocument.fdoc"</span></span>); .(); .(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .() <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span> (.) <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ..(); ... = .; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; .();</code> </pre><br><br>  All, we have a list of files.  Now proceed to the files themselves.  The page file itself is text, but the rules for writing are not XML.  The structure is block.  The text and graphic information is separately written in blocks.  All blocks have coordinates on the X and Y axis, for positioning on the page.  I am only interested in text blocks and their coordinates, well, their information. <br><br>  The blocks have a beginning and end, to understand where the beginning and end is simple: &lt;/&gt; <br>  In each block, the first word is his name.  Text blocks are named: Glyphs <br><br>  Here is an example block: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Glyphs</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Fill</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#ff000000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontUri</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/Documents/1/Resources/Fonts/DD1ED91D-300C-4E84-BACC-6412D0EB3F5F.odttf"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontRenderingEmSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13.2795"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StyleSimulations</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"None"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OriginX</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"971.84"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OriginY</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"59.68"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Indices</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"19,55;26;17;19;21,55;17;21;19;20,55;24"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">UnicodeString</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"07.02.2015"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  I am only interested in the parameters: <br><br>  - OriginX, for the definition of columns. <br>  - UnicodeString as the very value of what is contained in the string. <br><br>  It is necessary to read as the normal text file.  Text blocks are all written in one line.  In 1C, you can read the line before the translation character of the corset: <br><br><pre> <code class="1c hljs"> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(<span class="hljs-type"><span class="hljs-type"></span></span>, <span class="hljs-class"><span class="hljs-class"></span></span>.UTF8);  = .(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  &lt;&gt; <span class="hljs-literal"><span class="hljs-literal"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = (); ...</code> </pre><br>  And we check the resulting string for the parameter, if it starts with Glyphs, then we take it for review and analysis, if not - read the following. <br><br>  We'll have to analyze the string by letter and rewrite it into a structure. <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) <span class="hljs-keyword"><span class="hljs-keyword"></span></span> , ;  = <span class="hljs-string"><span class="hljs-string">""</span></span>;  = <span class="hljs-string"><span class="hljs-string">""</span></span>;  = <span class="hljs-string"><span class="hljs-string">""""</span></span>;  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>, <span class="hljs-string"><span class="hljs-string">"UnicodeString"</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>, <span class="hljs-string"><span class="hljs-string">"UnicodeString"</span></span>) + <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>) <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>, , <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  &lt;&gt; <span class="hljs-string"><span class="hljs-string">""""</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  =  + ; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .(<span class="hljs-string"><span class="hljs-string">""</span></span>, ); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>, <span class="hljs-string"><span class="hljs-string">"OriginX"</span></span>) + <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>) <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  = <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>, , <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  &lt;&gt;  <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  =  + ; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-built_in"><span class="hljs-built_in"></span></span>()); <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span></code> </pre><br>  Actually, after performing the function, we have everything for analysis.  The name of the parameter, its coordinates, the value of the parameter.  Blocks display text in the XPS from top to bottom and from left to right.  You can define columns by X coordinates, by parameter name we can analyze what information we need and what information is not.  I will not describe further how it all went to the 1C reference book - everything is clear there.  The main thing is, I got the answer how to quickly extract the necessary information from the "graphic" file. </div><p>Source: <a href="https://habr.com/ru/post/250371/">https://habr.com/ru/post/250371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250357/index.html">How we did a single on Ubuntu Studio 14.04</a></li>
<li><a href="../250359/index.html">HGST drives in RAID arrays</a></li>
<li><a href="../250363/index.html">Record of the webinar "Basics of modern server architecture"</a></li>
<li><a href="../250367/index.html">How I voiced the game</a></li>
<li><a href="../250369/index.html">Bank card emulation on the phone</a></li>
<li><a href="../250373/index.html">As we explained to the children, who is a programmer?</a></li>
<li><a href="../250375/index.html">The book about the design on the FPGA (in Ukrainian)</a></li>
<li><a href="../250379/index.html">VkPlaylistServer - add music from VK to almost any audio player</a></li>
<li><a href="../250381/index.html">Metro.Prosto scheme</a></li>
<li><a href="../250383/index.html">Lock-free data structures. Concurrent map: warm up</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>