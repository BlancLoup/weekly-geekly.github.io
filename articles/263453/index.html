<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a game on Blend4Web. Scene and surroundings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nowadays it is difficult to be a pioneer, because there are very few areas left for the inquisitive mind. ‚ÄúEka bent,‚Äù you say, and perhaps think of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a game on Blend4Web. Scene and surroundings</h1><div class="post__text post__text-html js-mediator-article">  Nowadays it is difficult to be a pioneer, because there are very few areas left for the inquisitive mind.  ‚ÄúEka bent,‚Äù you say, and perhaps think of the author‚Äôs modesty.  Well, I will reject philosophical, boring texts and begin the narration in a normal language. <br><br>  There is WebGL - universal technology for the web.  There is Blend4Web - a platform for working with WebGL technology.  There are documentation and examples of working with this platform, but there are no games at all. <br><br>  "Not at all?" <br>  "Alas, absolutely." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Or maybe I was looking bad?  I do not know, but I want to put an end to this injustice and create the first game.  The first is not for myself, because I already have three commercial games on Unity.  First on this engine. <br><br>  I will not particularly spread about the choice of engine.  Articles on this topic have already been written, and spears in the verbal skirmish broken.  I'll just start doing and talk about the progress of the work. <br><a name="habracut"></a><br>  What do you think, how does the game start?  Just do not say that with the idea.  Personally, I prefer to find out the usefulness of the new project for people and for myself at a very early stage.  And what do I need to get: money, experience, PR, or all at once?  So you want to exclaim - just and more!  But, alas, chase two (or already three?) Hares ... <br><br>  Recently, I'm interested in browser games.  I did mobiles, there is also a PC-variant in the piggy bank, but for the web it is somehow not yet available.  Unfortunately, my main tool Unity in this can not help now.  Therefore, I stopped at Blend4Web. <br><br>  Here only I wish to study it on the real working project.  Let it be simple, but allowing me to get such precious exp. <br><br>  The main thing is experience.  And experience is best achieved in openness.  Therefore, the slogan of my project: "Open Source!".  Yes, I will open scripts, models, scenes for free use.  And I hope that return feedback will significantly increase my professionalism. <br><br><h4>  Formulation of the problem </h4><br>  There is such a popular topic as ‚Äúfish hunter‚Äù.  Open Google Play and you will see hundreds of games of similar subjects.  Asians even cooked up a gaming machine and children actively ‚Äúquench‚Äù unfortunate fish.  So I want to create another clone of this game.  But not simple, but with a twist.  In due time I will tell about everything.  For now - to work. <br><br>  Each developer has his own approach to the first stage of work.  Someone makes a prototype, someone sculpts the main characters right away, and I will start with the game scene.  My first task is a pretty billet, a sort of ‚Äúbath‚Äù filled with water, where future hunters will greedily seek out fish.  What I need to do at this stage: <br><ul><li>  beautiful sandy bottom with reflections from the water; </li><li>  realistic water with refraction. </li></ul><br>  And only then, I will begin to fill this scene with all sorts of scenery: from seashells to algae. <br><br>  As you already understood, the main work will go in Blender.  I will not touch on the issue of installing and configuring the Blend4Web SDK - this is quite simple and everything is ‚Äúchewed‚Äù on the developers site.  It is only important to follow some guidelines to simplify the work. <br><br>  Firstly, Blender work projects must be saved in the SDK / Blender / Project Name folder. <br><br>  Secondly, in the editor profile you need to replace the standard Blender Render with Blend4Web.  As a result, Blender functions that are not supported by the engine will disappear. <br><br>  And thirdly, JSON export should be carried out in the SDK / Deploy / Assets / Project Name folder. <br><br>  One little trick.  You have not forgotten that the ultimate platform is the web?  For testing, you need a server, at least local.  So, after installing Blend4Web and with Blender open, the server will automatically start at localhost: 6687.  To speed up the work, the developers propose to set a tick in one inconspicuous option Run in Viewer when exporting.  This will force the program to start the application immediately after export. <br><br>  There is another nice addition - a viewer with the ability to customize the parameters of the engine directly in the browser window.  Just this program starts when the Run in Viewer option is enabled.  It is simply indispensable for fine-tuning materials or other components of the scene in a real WebGL.  After all, Blender does not fully display all the frauds with engine settings. <br><br>  The theoretical part is completed, go to practice. <br><br>  According to my plans, the player must see the picture above.  Camera perspective and motionless.  Light source in one position.  The scene can be presented in the form of puff pie: <br><ul><li>  Water. </li><li>  Floating creatures (fish). </li><li>  Crawling along the bottom of the creature (crabs, starfish) and scenery. </li><li>  Actually, the very bottom. </li></ul><br>  From all this, I now need to make two points - the first and the last. <br><br>  It seems, I hear exclamations: "And all ?!".  Solid "Yes", because I want to do it beautifully.  At the same time, let's see if it is possible at all with the help of Blend4Web. <br><br><img src="https://habrastorage.org/files/6df/b02/6df/6dfb026df11d4005b5c72040f489e29e.jpg" alt="image"><br><br>  What do you think is shown in the picture?  The answer is simple - the base scene.  A bold look will highlight a camera, a light source and two horizontally positioned planes.  This is the future of land and water. <br><br>  It looks cool, if only because it is a sign of the beginning of work.  After all, it's always difficult to start.  I threw a couple of primitives into the scene and you are happy - 0.00001% has already been done. <br><br>  There was a time when Unity Free users licked at the quality version of the Pro version.  In Unity were blanks with the characteristic names of Water (Simple) and Water (Pro).  Now they are mixed and accessible to all. <br><br>  Blend4Web does not initially have such a separation, and even in the free version all the functions of the platform are available.  And it makes me happy, because for the project I use the free SDK.  So, Blend4Web offers its own way of creating water surfaces.  No need to steam with writing scripts or shaders - just adjust the material. <br><br><img src="https://habrastorage.org/files/1bd/ab6/64b/1bdab664b5a744f7b1cc8bcd62d78ff5.jpg" alt="image"><br><br>  Look at this screenshot.  Here, nothing more than a standard Blender material panel.  True, it looks a bit unusual, because the profile Blend4Web, selected earlier, added new features.  So, to turn on some water, you need to do the following: <br><br><ol><li>  Calculate the UV coordinates for the plane.  In my case, this is the simplest Unwrap operation (Edit Mode: U key, select Unwrap). </li><li>  Enable transparency.  Transparency panel, Show Transparency option.  Type must be set to Alpha Blend. </li><li>  Enable refraction.  Refractive option. </li><li>  Enable the Water option. </li></ol><br>  By the way, there are a lot of water settings.  The screenshot shows not all the parameters.  The developers have fastened the possibility of creating the underwater world, coastal foam, waves and much more.  Since I do not need this in my project, I refer those interested in the official certificate. <br><br>  However, the water ‚Äúwill not play‚Äù, if you do not add texture to the material.  This should be a Normal Map simulating water ripples.  There are a lot of them on the Internet, you can do it yourself, but I decided not to waste time and took the texture from the example in the SDK platform. <br><br>  And, interestingly, such textures can be installed as many as 4 pieces (in fact, the file should be the same).  Only for each you need to change its scale (the Texture panel in the Mapping tab).  I understand that it is the imposition of multi-scale textures and causes the effect of the water surface.  And yes, since this is the Normal Map, then you need to disable Diffuse in the Influence parameters and enable Normal.  As a result, by simple frauds you can get just such a picture (see fig.).  Of course, it looks primitive, but there is animated water with refraction in Blend4Web. <br><br><img src="https://habrastorage.org/files/fe6/4ad/f6d/fe64adf6d74648009b794c9a47a17c01.jpg" alt="image"><br><br>  Water bottom.  Personally, I have an association with sand, probably because I grew up on the sea.  All sorts of shells, jellyfish, mermaids - oh, something I did not go there.  In general, we make a sandy bottom. <br><br>  In the primitive understanding, it is a plane with two textures: sand itself and a Normal Map derivative of it.  In principle, working with textures for Blend4Web is no different from standard Blender functionality.  It is only important to take into account the physical location of the files, and they should be located in the SDK / Deploy / Assets / Project Name folder.  Of course, you can cram them anywhere, but Blend4Web has some tools that automate and optimize the final build. <br><br>  I‚Äôll look at creating sand very briefly, because of the similar information on working with textures in Blender pond-pond: <br><ul><li>  Calculate UV-coordinates for the plane (the same operation as for water); </li><li>  Add a basic texture to the texture slot.  It can be left without customization; </li><li>  Add to next  texture slot second texture and set the parameters in the Influence, as for the water Normal Map. </li></ul><br>  In principle, until the work with the bottom we postpone and pay attention to the camera.  If you are not just reading my lesson, but are trying to pile something, you probably already tried to export the scene.  Twisted, twirled it in the viewer, with ecstasy looking at the nondescript planes.  That's just the game is not supposed to.  The camera should be on top and be static.  Note that camera rotation is not a built-in viewer function.  He only performs exactly those settings that are laid when creating the scene, and therefore we turn to the camera settings. <br><br><img src="https://habrastorage.org/files/5cb/790/ce2/5cb790ce29ba43aba1b5323e698c008e.jpg" alt="image"><br><br>  This is a standard camera settings panel with some intersperses from Blend4Web.  Now we are interested in the Camera Move Style tab.  By default there is a Target, i.e.  tracking a certain point in space, but if you select the Static mode, you get a static picture.  Notice that the developers have created as many as 4 camera behaviors, thus making life easier for simple igrodels. <br><br>  But back to our bottom.  Have you tried playing with my recipes?  Refraction, transparency, waves, and yet something is missing.  There is no life. <br><br>  If you find some video of the seabed, you will see the characteristic light overlap.  The peculiar movement of light spots really fascinates and I want the same in my game.  This effect is called caustic. <br><br>  In principle, Blend4Web supports caustics for underwater objects.  This is achieved by adding another texture to the water, but already procedural. <br><br>  Add a Voronoi texture to the new slot, twist its parameters at least as in the official certificate and you will get caustic.  So, in brief, the official reference sounds.  But it was not there.  I struggled with this task for a long time, until I thought that a caustic should be displayed on the objects themselves, and not on the water.  It turned out that caustic tuning consists of two stages: <br><br><ul><li>  Adjust the procedural texture of Voronoi for water. </li><li>  The inclusion of the Caustics option is personalized for each bottom object (Object panel, Special Effects group). </li></ul><br>  If my article is read by the developers of Blend4Web, then I want to contact: "Guys, modify your documentation!".  In my case, add at least a link from the caustic page to the page with the description of the objects. <br><br>  Let's go back to the scene.  It remains to slightly change the environment settings.  To make the objects not too dark, you need to turn on the ambient light.  This is possible in the World panel (Environment Lighting option).  Note that ambient light is calculated from the current white.  It does not suit me and I prefer my own shade. <br><br>  I chose Sky Color from the Environment Color menu and set the desired color a little higher in the Horizon Color settings (turn on the Render Sky option).  I will not give a screenshot, since this stage is the easiest.  But I will brag about the end result (I advise you to see the build, the link to which is slightly lower. The ‚Äúlive‚Äù picture is prettier). <br><br><img src="https://habrastorage.org/files/d93/d4c/95f/d93d4c95fb864d1a816a9701b17f5a5d.jpg" alt="image"><br><br>  Not a masterpiece, but a working option.  Of course, the parameters of light, water, environment will be corrected more than once, and yet, this part of the game has already been done. <br><br><h4>  Afterword </h4><br>  I coped with the task of the first stage and laid the first brick in the foundation of the project.  So far there has been no particular difficulty.  Unfortunately, I have not yet had time to prepare a page with a project on my website and properly arrange the repository on bitbacket. <br><br>  <a href="http://prandgames.com/share/waterhunter/base.html">Assembly</a> <br>  <a href="https://bitbucket.org/prandgames/waterhunter">Sources</a> <br><br>  And to the creators of Blend4Web, I have another request: make a quick button to export the scene in JSON.  A little annoying to open the menu, select the desired options.  While working on a project, it is very often necessary to export the scene for testing.  Such a button will save a lot of time for the developer. <br><br>  <b>UPDATE</b> <br>  The new version of the engine 15.07 changed the approach to creating caustics.  Now you do not need a procedural texture voronoi.  In the Water panel, the Caustic area appeared.  Be careful, the result of the function depends on the distance of the water surface to the objects. </div><p>Source: <a href="https://habr.com/ru/post/263453/">https://habr.com/ru/post/263453/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263443/index.html">Internet Explorer 11 Bookmarklets: Storage Format, Limits and Silent Rules, Treacherous Bug</a></li>
<li><a href="../263445/index.html">TIS-100 - a puzzle about a multithreaded assembler that no one expected</a></li>
<li><a href="../263447/index.html">Nested Intervals and their implementation under Yii2</a></li>
<li><a href="../263449/index.html">IncrediBuild to check a large project with PVS-Studio</a></li>
<li><a href="../263451/index.html">Survey: What data to open the tax office?</a></li>
<li><a href="../263455/index.html">Emoticons for API Vkontakte</a></li>
<li><a href="../263457/index.html">R and Python - worthy rivals?</a></li>
<li><a href="../263459/index.html">Personal data: how realistic is it to get tested by Roskomnadzor?</a></li>
<li><a href="../263461/index.html">My first experience in the development of 2D-games (5 tips)</a></li>
<li><a href="../263465/index.html">Implementation option MVP + DI (Dagger 2) in Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>