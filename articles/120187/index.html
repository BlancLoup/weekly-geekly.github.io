<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to develop on the Zend Framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! The other day a job turned up - to add a site on the zend framework. The programmer, who began to develop this project did not have time to dat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to develop on the Zend Framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f63/c3f/ec0/f63c3fec02f749af8c7a347f6eccc8e1.png" title="Zend Framework" width="400" height="105"><br>  Hello!  The other day a job turned up - to add a site on the zend framework.  The programmer, who began to develop this project did not have time to date, did not fulfill the requirements of the customer and as a result he was replaced.  Having opened the source code for the first time, I was horrified by the number of errors that the developer made, and he claimed to the customer that he was an experienced specialist.  Next, I will try to tell you about some of the mistakes that they made.  This material will be useful for beginners ZF-programmers, as instructions on how to do not <a name="habracut"></a>  .  I will also tell you about some moments not directly related to the framework, but also being vivid examples of developer ignorance. <br><br><h3>  Using built-in model methods, instead of writing your own </h3><br>  The first thing that immediately caught my eye was the execution of requests through the model object directly in the controller code, which completely negates all the advantages of MVC.  To make it clear what I mean, I will give an example of the source code: <br><blockquote><code><font color="#19177C">$model</font> <font color="#666666">=</font> <font color="#008000"><strong>new</strong></font> Model(); <br> <font color="#19177C">$some_data</font> <font color="#666666">=</font> <font color="#19177C">$model</font> <font color="#666666">-&gt;</font> <font color="#7D9029">fetchAll</font> ( <font color="#008000"><strong>array</strong></font> ( <font color="#BA2121">'field1 = ?'</font> <font color="#666666">=&gt;</font> <font color="#666666">1</font> , <font color="#BA2121">'field2 = ?'</font> <font color="#666666">=&gt;</font> <font color="#666666">0</font> )); <br> <font color="#19177C">$all_data</font> <font color="#666666">=</font> <font color="#19177C">$model</font> <font color="#666666">-&gt;</font> <font color="#7D9029">fetchAll</font> (); <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br>  Such a confusion of logic was in each file of the controller, which greatly interfered with reading the code and correcting errors, there were constantly some not obvious dependencies, important data was overwritten.  Accordingly, it is not possible to do this in any way, even if you are developing a small project. <br><br><h3>  Directly access global arrays instead of a Request object. </h3><br>  ZF has a very convenient wrapper over global variables in the form of an object of class Zend_Controller_Request_Http.  This class provides us with a lot of data access capabilities and is used by the framework in the dispatching process.  Therefore, do not neglect the use of the query object. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Lack of context-switching when necessary </h3><br>  To implement the processing of ajax requests, you can use the so-called.  context-switch which is a convenient way to change the response format.  If you are using json, then in the controller's init method set something like the following: <br><blockquote> <code><font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">_helper</font> <font color="#666666">-&gt;</font> <font color="#7D9029">AjaxContext</font> () <font color="#666666">-&gt;</font> <font color="#7D9029">addActionContext</font> ( <font color="#BA2121">'ajax-handler'</font> , <font color="#BA2121">'json'</font> ) <font color="#666666">-&gt;</font> <font color="#7D9029">initContext</font> ( <font color="#BA2121">'json'</font> ); <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br>  Now all the data transferred to the view in the ajax-handler action will be recoded into json format.  This method is preferable to disabling view and manually converting data to json. <br><br><h3>  Neglect using Zend_Form and Zend_Validate </h3><br>  Do not use php functions for data validation, since  in ZF there are very convenient validators that can be grouped together and put on processing certain form fields.  Using ZF-validators you reduce the chance that you miss something and thereby make your applications more sustainable. <br><br><h3>  No validation check </h3><br>  You should check all the data you received from the user, and you should check them in the context of the access rights of this user, for example, if you write the addition / removal of materials from the list of favorites and you have js-functions like the ones below, then you should be very good think: <br><blockquote> <code><font color="#008000"><strong>function</strong></font> addObject(object_id, user_id) { <br> <font color="#008000"><strong>if</strong></font> (user_id <font color="#666666">&gt;</font> <font color="#666666">0</font> ) { <br> $.get( <font color="#BA2121">'/realestate/favorite/oid/'</font> <font color="#666666">+</font> object_id <font color="#666666">+</font> <font color="#BA2121">'/uid/'</font> <font color="#666666">+</font> user_id, <font color="#008000"><strong>function</strong></font> () { <br> $( <font color="#BA2121">"#addfavorite"</font> <font color="#666666">+</font> object_id).hide(); <br> }); <br> } <br> } <br> <br> <font color="#008000"><strong>function</strong></font> removeObject(object_id, user_id) { <br> <font color="#008000"><strong>if</strong></font> (user_id <font color="#666666">&gt;</font> <font color="#666666">0</font> ) { <br> $.get( <font color="#BA2121">'/profile/removefavorite/oid/'</font> <font color="#666666">+</font> object_id <font color="#666666">+</font> <font color="#BA2121">'/uid/'</font> <font color="#666666">+</font> user_id, <font color="#008000"><strong>function</strong></font> () { <br> $( <font color="#BA2121">"#removefavorite"</font> <font color="#666666">+</font> object_id).hide(); <br> }); <br> } <br> } <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br>  As it turned out, the server-side user_id was not checked for equality with the current user ID, which is a serious vulnerability <br><br><h3>  Using controller class hierarchy instead of ACL </h3><br>  Almost every site has several levels of access: guests, users, administrators, etc.  In order to control the access rights of statuses to certain parts of the site, hierarchies of controllers were used.  Those.  a parent class was created for the admin controllers, a class for the rest of the controllers and something like this was executed in this parent class: <br><blockquote> <code><font color="#008000"><strong>public</strong></font> <font color="#008000"><strong>function</strong></font> <font color="#0000FF">preDispatch</font> () { <br> <font color="#408080"><em>//      *fail* <br></em></font> <font color="#008000"><strong>if</strong></font> ( <font color="#666666">!</font> <font color="#008000"><strong>empty</strong></font> ( <font color="#19177C">$_REQUEST</font> [ <font color="#BA2121">'session'</font> ])) { <br> <font color="#008000">session_id</font> ( <font color="#19177C">$_REQUEST</font> [ <font color="#BA2121">'session'</font> ]); <br> } <font color="#008000"><strong>else</strong></font> { <br> <font color="#19177C">$auth</font> <font color="#666666">=</font> Zend_Auth <font color="#666666">::</font> <font color="#7D9029">getInstance</font> (); <br> <font color="#008000"><strong>if</strong></font> ( <font color="#666666">!</font> <font color="#19177C">$auth</font> <font color="#666666">-&gt;</font> <font color="#7D9029">hasIdentity</font> ()) { <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">_redirect</font> ( <font color="#BA2121">'backoffice/auth/login'</font> ); <br> } <br> } <br> } <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br>  What's wrong with this approach?  First of all, the redistribution of access rights is very difficult.  Secondly, it is difficult to maintain several roles.  You can continue for a long time <br>  For these purposes in ZF, there is a great tool for building access lists or ACLs.  Personally, I use a small plugin that checks the access rights of a given user to the requested action / controller in the dispatch process.  This method allows you to create permissions in a simple, easily changeable list, like this: <br><blockquote> <code><font color="#408080"><em>//  <br></em></font> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">addRole</font> ( <font color="#BA2121">'guest'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">addRole</font> ( <font color="#BA2121">'user'</font> , <font color="#BA2121">'guest'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">addRole</font> ( <font color="#BA2121">'manager'</font> , <font color="#BA2121">'user'</font> ); <br> <br> <font color="#408080"><em>//  <br></em></font> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'guest_allow'</font> )); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'index/index'</font> ), <font color="#BA2121">'guest_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'index/registration'</font> ), <font color="#BA2121">'guest_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'error/error'</font> ), <font color="#BA2121">'guest_allow'</font> ); <br> <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'user_allow'</font> )); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'index/logout'</font> ), <font color="#BA2121">'user_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'project/index'</font> ), <font color="#BA2121">'user_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'task/index'</font> ), <font color="#BA2121">'user_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'task/complete'</font> ), <font color="#BA2121">'user_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'task/assigned'</font> ), <font color="#BA2121">'user_allow'</font> ); <br> <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'manager_allow'</font> )); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'project/add'</font> ), <font color="#BA2121">'manager_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'task/add'</font> ), <font color="#BA2121">'manager_allow'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">add</font> ( <font color="#008000"><strong>new</strong></font> Zend_Acl_Resource( <font color="#BA2121">'index/add-user'</font> ), <font color="#BA2121">'manager_allow'</font> ); <br> <br> <font color="#408080"><em>// , -   <br></em></font> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">deny</font> ( <font color="#008000"><strong>null</strong></font> , <font color="#008000"><strong>null</strong></font> , <font color="#008000"><strong>null</strong></font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">allow</font> ( <font color="#BA2121">'guest'</font> , <font color="#BA2121">'guest_allow'</font> , <font color="#BA2121">'show'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">allow</font> ( <font color="#BA2121">'user'</font> , <font color="#BA2121">'user_allow'</font> , <font color="#BA2121">'show'</font> ); <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">allow</font> ( <font color="#BA2121">'manager'</font> , <font color="#BA2121">'manager_allow'</font> , <font color="#BA2121">'show'</font> ); <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br><br><h3>  Filtering data in the fields responsible for entering a password </h3><br>  Never, never filter the data that comes from the password field!  This is fraught with long attempts to find the reason why users can not log in.  In my case, the reason was the following: <br><blockquote> <code><font color="#19177C">$f</font> <font color="#666666">=</font> <font color="#008000"><strong>new</strong></font> Zend_Filter_StripTags(); <br> <font color="#19177C">$pwd</font> <font color="#666666">=</font> <font color="#19177C">$f</font> <font color="#666666">-&gt;</font> <font color="#7D9029">filter</font> ( <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">_request</font> <font color="#666666">-&gt;</font> <font color="#7D9029">getPost</font> ( <font color="#BA2121">'pwd'</font> )); <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br>  Considering that passwords should be stored in an encrypted form and should never be displayed, the presence of tags or spaces in them can not in any way lead to vulnerabilities, respectively, and filtering to nothing <br><br><h3>  Provide localization is necessary in advance. </h3><br>  Often for some reason, the localization of the project is taken to the background, i.e.  at first we‚Äôll drink everything, and then we will fix the localization.  This is a big mistake, because  then it will be very difficult to fasten it.  It will be necessary to find all non-localized strings, and this is a very long process.  It is much easier to immediately handle the lines that require multilanguage. <br><br><h3>  Refusal to use ViewHelpers </h3><br>  You should always use url and baseUrl view helpers to generate url and paths to static resources.  This is important because you cannot be sure how the application will be located with other developers.  In our case, the paths were formed as if the application was in the root of the host, which created a number of problems when deploying to my machine. <br><br><h3>  Using text constants instead of logical variables </h3><br>  In conclusion, I want to tell you about an interesting way to replace logical variables with strings.  In the code, I found something like this: <br><blockquote> <code><font color="#008000"><strong>if</strong></font> ( <font color="#19177C">$a</font> <font color="#666666">&gt;</font> <font color="#19177C">$b</font> ) <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">view</font> <font color="#666666">-&gt;</font> <font color="#7D9029">result</font> <font color="#666666">=</font> <font color="#BA2121">'ok'</font> <br> <font color="#008000"><strong>else</strong></font> <br> <font color="#19177C">$this</font> <font color="#666666">-&gt;</font> <font color="#7D9029">view</font> <font color="#666666">-&gt;</font> <font color="#7D9029">result</font> <font color="#666666">=</font> <font color="#BA2121">'fail'</font> ; <br></code> </blockquote>  <font color="gray">Colored with <a href="http://dumpz.org/">dumpz.org</a></font> <br>  Here, no additional explanation is required, I think the last line is very eloquent for me. <br><h2>  Conclusion </h2><br>  This is not a complete list of errors that were found in the process of finalizing the project, but I have described the main ones.  I hope that someone reading this material will begin to write better code.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/120187/">https://habr.com/ru/post/120187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120180/index.html">Accelerate loading rail</a></li>
<li><a href="../120182/index.html">A simple example of phonetic search</a></li>
<li><a href="../120183/index.html">Visual component monitor COM-port</a></li>
<li><a href="../120185/index.html">New service from Google for those who need to quickly get information about the flight</a></li>
<li><a href="../120186/index.html">World War II mechanical encryption device</a></li>
<li><a href="../120188/index.html">RubyGems - detail</a></li>
<li><a href="../120189/index.html">On Friday, WordPress turned 8 years old. WordPress history in screenshots</a></li>
<li><a href="../120191/index.html">Proprietary provider modems 1/3</a></li>
<li><a href="../120192/index.html">JavaScript FAQ: Part 1</a></li>
<li><a href="../120193/index.html">Basics and Misconceptions About JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>