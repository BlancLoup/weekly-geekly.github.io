<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Use Java smart cards to protect software. Chapter 5. Security</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this series of articles we will discuss the use of Java smart cards (cheaper analog keys of electronic keys) to protect software. The cycle is divi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Use Java smart cards to protect software. Chapter 5. Security</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/22d/989/e78/22d989e78ad04030bec8bf788de74983.gif" alt="image"><br><br>  In this series of articles we will discuss the use of Java smart cards (cheaper analog keys of electronic keys) to protect software.  The cycle is divided into several chapters. <br><br>  To read and understand the information from the articles you will need the following skills: <br><ul><li>  Basics of software development for Windows (programming skills are enough in any visual environment, such as Delphi or Visual Basic) </li><li>  Basic knowledge from the field of cryptography (what is a cipher, symmetric, asymmetric algorithm, initialization vector, CBC, etc. I recommend Applied Cryptography by Bruce Schneier for mandatory reading). </li><li>  Basic programming skills in any language, even remotely resembling Java syntax (Java, C ++, C #, PHP, etc.) </li></ul><br>  The purpose of the cycle is to acquaint the reader with Java maps (there is very little literature in Russian on their use).  The cycle does not claim the status of "Guidelines for the development of software protection based on Java cards" or the title of "Handbook of Java cards." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The composition of the cycle: </h4><br><ul><li>  <a href="http://habrahabr.ru/post/255529/">Chapter 1. Java card.</a>  <a href="http://habrahabr.ru/post/255529/">General information.</a> </li><li>  <a href="http://habrahabr.ru/post/255531/">Chapter 2. Java map from the point of view of the applet developer</a> </li><li>  <a href="http://habrahabr.ru/post/255533/">Chapter 3. Installing and Configuring IDE</a> </li><li>  <a href="http://habrahabr.ru/post/255535/">Chapter 4. We write the first applet</a> </li><li>  <a href="http://habrahabr.ru/post/255537/">Chapter 5. Security</a> </li></ul><br><a name="habracut"></a><br>  In 90% of cases you will not be able to come up with an algorithm that would have all the following properties: <br><ul><li>  removing this algorithm from the program would make your software completely non-functional. </li><li>  a hacker could not guess and emulate this algorithm </li></ul><br>  If you hit this 90%, then you should: <br><ul><li>  Encrypt all communications with the card </li><li>  Protect your software with Themida-type protector </li></ul><br><h4>  1. Encryption of data exchange with the card </h4><br>  If you want to build strong protection, traffic encryption keys should change.  A new key should be generated at least every time your application starts.  Generate session keys should be based on the data, as provided by the card, and your program.  The mechanism of a protected session may look, <b>in a primitive version</b> , for example, like this: <br><br><ul><li>  There is a master key DES M. They know the card and software. </li><li>  The card generates 4 bytes of random data (Ccard), the software generates 4 bytes of random data (Csoft).  They exchange this information with each other. </li><li>  The card and software combine both arrays (Ccard + Csoft), encrypting the resulting set of bytes with the M master key. 8 bytes of the 1DES key are obtained, which will later encrypt the entire exchange in the current session. </li></ul><br><br>  <b>Attention!</b>  <b>Do not do as described.</b> <br><br>  In case the decrypted data seems incorrect to the card, it should be blocked.  The easiest option to implement a similar option is to start the CardIsLocked boolean field in the applet class and check its contents in the process method before calling the method corresponding to the passed command code.  If CardIsLocked - give the software an error instead of data. <br><br><h4>  2. Using Themida features </h4><br>  Themida is considered one of the most difficult to remove protectors.  However, just hanging the projector from above is not enough.  If you want to build a truly reliable protection, you should use the Themida API to the full extent: <br><ul><li>  Be sure to use Themida virtual machine protection mechanism </li><li>  Pay particular attention to the Themida help section, which is called ‚ÄúSecureEngine Macros‚Äù.  When developing your own secure session mechanism for communicating with a card, enclose all the code that enables communication with the card in such macros as VM_Start / End, Code_Replace_Start / End. </li><li>  Typically, a secure communication session with the card is established once when the application is launched.  If this is also true in your case, put the code responsible for the start of the protected session in the Clear_Start / End macros so that after setting up the protected session, the code that does this is deleted from the process address space. </li><li>  Use the macros CheckProtectionStart / End, CheckCodeIntegrityStart / End inside the functions that work with the card. </li><li>  Do not let your program run under virtual machines (unless your application requires it) </li></ul><br><br><h4>  3. Cryptographic traps.  A few of the millions waiting for you. </h4><br>  Working with cryptography, it is important to understand what you are doing, what you can do, and what not.  Of course, if you are protecting a console card with a smart card, you can afford anything you want.  But if this tetris is unique and brings you a million dollars tomorrow ... For example, once having used a certain initialization vector with a specific DES key, do not do it again. <br><br>  Do not invent your own super-secret-no-one-known proprietary encryption and hashing algorithms.  Remember the fate of the GSM A5 / 3 cipher and its poor authors who have decided that they are superkriptograf. <br><br>  Having designed a super-resistant security system, do not leave blunt holes in it, like the <a href="http://geektimes.ru/post/83025/">one in the banking client based on BS-Client</a> . <br><br><h4>  4. Gratitude to patient readers. </h4><br>  Thanks to everyone who read to this place.  Gratitude and indignation are accepted. <br><br>  I will welcome any questions in the comments and try to update the article so that it includes the answers. </div><p>Source: <a href="https://habr.com/ru/post/255537/">https://habr.com/ru/post/255537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255527/index.html">Ordinary Primes: The Secrets of the Weavers' Secret Society</a></li>
<li><a href="../255529/index.html">Use Java smart cards to protect software. Chapter 1. General Information</a></li>
<li><a href="../255531/index.html">Use Java smart cards to protect software. Chapter 2. Java smart card from the applet developer's point of view</a></li>
<li><a href="../255533/index.html">Use Java smart cards to protect software. Chapter 3. Installing and Configuring IDE</a></li>
<li><a href="../255535/index.html">Use Java smart cards to protect software. Chapter 4. We write the first applet</a></li>
<li><a href="../255539/index.html">Release elementary OS "Freya"</a></li>
<li><a href="../255547/index.html">Krovi: Big Data - as dream. Unplanned Series 5: Big Game. Private opinion</a></li>
<li><a href="../255549/index.html">Remember watched videos on youtube</a></li>
<li><a href="../255551/index.html">Scaling operations in the Intel Media SDK</a></li>
<li><a href="../255557/index.html">Sunday tale of the importance of updating, even if you are a botnet operator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>