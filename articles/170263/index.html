<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Manage Windows services using PowerShell. Part 6. Service Accounts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With this post, we finish publishing a translation of a series of articles on managing Windows services using PowerShell, which is published on 4sysop...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Manage Windows services using PowerShell. Part 6. Service Accounts</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage2/eef/1be/c68/eef1bec6878c24a31ad68b76ed06356e.jpg"><br>  With this post, we finish publishing a translation of a series of articles on managing Windows services using PowerShell, which is published on <a href="http://4sysops.com/">4sysops.com</a> .  In a <a href="http://habrahabr.ru/company/netwrix/blog/169823/">previous post</a> , we looked at how to manage Windows services in Server 2012 using the CIM cmdlets introduced in PowerShell 3.0.  In this post, we will look at how to manage service accounts using the WMI and CIM cmdlets. <br>  So, under the cut is a translation of an article from the portal 4sysops.com. <a href="http://4sysops.com/archives/managing-services-the-powershell-way-part-8-service-accounts/">Managing Services the PowerShell way - Part 8</a> <br><br>  <b>Previous articles:</b> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/166289/">Manage Windows services using PowerShell.</a>  <a href="http://habrahabr.ru/company/netwrix/blog/166289/">Part 1. Get the status of services</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/167171/">Manage Windows services using PowerShell.</a>  <a href="http://habrahabr.ru/company/netwrix/blog/167171/">Part 2. Stop, start, pause.</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/168011/">Manage Windows services using PowerShell.</a>  <a href="http://habrahabr.ru/company/netwrix/blog/168011/">Part 3. Configuring Services with WMI and CIM</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/168773/">Manage Windows services using PowerShell.</a>  <a href="http://habrahabr.ru/company/netwrix/blog/168773/">Part 4. Changing Services Using WMI</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/169823/">Manage Windows services using PowerShell.</a>  <a href="http://habrahabr.ru/company/netwrix/blog/169823/">Part 5. CIM Cmdlets</a> <br><a name="habracut"></a><br><h4>  We use WMI </h4><br>  To change the password for the service account, we need a reference to the service object.  And I guess this is a service with a user account. <br><br><pre><code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-wmiobject win32_service -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"name='yammmsvc'"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> name,startname name startname ---- --------- YammmSvc .\Jeff</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In <a href="http://habrahabr.ru/company/netwrix/blog/168773/">this post,</a> we considered that for these purposes you can use the Change () method to change the password of the service account.  Also remember that the <b>Invoke-WmiMethod parameters</b> do not follow the order documented on MSDN. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; $svc = <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-wmiobject win32_service -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"name='yammmsvc'"</span></span> PS C:\&gt; $svc.GetMethodParameters(<span class="hljs-string"><span class="hljs-string">"change"</span></span>) __GENUS : <span class="hljs-number"><span class="hljs-number">2</span></span> __CLASS : __PARAMETERS __SUPERCLASS : __DYNASTY : __PARAMETERS __RELPATH : __PROPERTY_COUNT : <span class="hljs-number"><span class="hljs-number">11</span></span> __DERIVATION : {} __SERVER : __NAMESPACE : __PATH : DesktopInteract : DisplayName : ErrorControl : LoadOrderGroup : LoadOrderGroupDependencies : PathName : ServiceDependencies : ServiceType : StartMode : StartName : StartPassword : PSComputerName :</code> </pre><br><br>  The password is on the 11th place.  This means that we need to insert empty values ‚Äã‚Äãfor the previous 10 parameters that do not change. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; $svc | Invoke-WmiMethod -Name Change -ArgumentList @($<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"P@ssw0rd"</span></span>) __GENUS : <span class="hljs-number"><span class="hljs-number">2</span></span> __CLASS : __PARAMETERS __SUPERCLASS : __DYNASTY : __PARAMETERS __RELPATH : __PROPERTY_COUNT : <span class="hljs-number"><span class="hljs-number">1</span></span> __DERIVATION : {} __SERVER : __NAMESPACE : __PATH : ReturnValue : <span class="hljs-number"><span class="hljs-number">0</span></span> PSComputerName :</code> </pre><br><br>  0 as the return value means the success of our action.  But remember that the change will not take effect until we restart the services.  If you forgot how to do this, then see one of the <a href="http://habrahabr.ru/company/netwrix/blog/167171/">previous posts</a> . <br>  If you want to change the name of the account, you need to clarify it in the previous parameter. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; $svc | Invoke-WmiMethod -Name Change -ArgumentList @($<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,$<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"LocalSystem"</span></span>,<span class="hljs-string"><span class="hljs-string">"P@ssw0rd"</span></span>)</code> </pre><br><br>  We also need to set the initial password for system accounts. <br><br><h4>  We use CIM </h4><br><br>  However, it is much easier to use CIM cmdlets to solve such problems.  Once again, we change the account and password for the service. <br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-CimInstance win32_service -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"name='yammmsvc'"</span></span> | Invoke-CimMethod -Name Change -Arguments @{StartName=<span class="hljs-string"><span class="hljs-string">".\Jeff"</span></span>;StartPassword=<span class="hljs-string"><span class="hljs-string">"P@ssw0rd"</span></span>}</code> </pre><br><br>  And the returned value should be 0. Enter the startname in the format MACHINE \ USERNAME or DOMAIN \ USERNAME.  In my case, Jeff is a local account.  If you only want to change the password, you only need to correct the argument in the hash table. <br>  Note that you can execute the query and modify it using <b>Invoke-CimMethod</b> .  The object in it is not necessary to transfer. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Invoke-CimMethod -Name Change -Arguments {StartName=<span class="hljs-string"><span class="hljs-string">".\Jeff"</span></span>;StartPassword=<span class="hljs-string"><span class="hljs-string">"P@ssw0rd"</span></span>} -Query <span class="hljs-string"><span class="hljs-string">"Select * from Win32_Service where name='yammmsvc'"</span></span> ‚ÄìComputername JeffPC</code> </pre><br><br>  Although it was possible to run the command locally, I decided to show its launch on a remote computer.  Below is an example for changing a service on multiple computers. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Invoke-CimMethod -Name Change -Arguments @{StartPassword=<span class="hljs-string"><span class="hljs-string">"P@ssw0rd"</span></span>} -Query <span class="hljs-string"><span class="hljs-string">"Select * from Win32_service where name='MyCustomService'"</span></span> ‚Äìcomputername $computers | out-file c:\work\results.txt</code> </pre><br><br>  As you can see, I reset the password for the MyCustomService service running on all computers listed in the $ computers variable.  The results are saved in a text file, in which the computer name and the returned value are indicated.  Of course, services need to be restarted for the changes to take effect. <br><br><h4>  Summing up </h4><br><br>  If you need to manage your service account, then you will need to use WMI ‚Äî via WMI or CIM cmdlets.  The latter is much easier to use. <br><br>  <b>Previous articles:</b> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/166289/">1. Get the status of services</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/167171/">2. Stop, start, pause</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/168011/">3. Configure services using WMI and CIM</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/168773/">4. Changing Services Using WMI</a> <br>  <a href="http://habrahabr.ru/company/netwrix/blog/169823/">5. CIM cmdlets</a> </div><p>Source: <a href="https://habr.com/ru/post/170263/">https://habr.com/ru/post/170263/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170249/index.html">The network laid out 320 gigapixel panorama of London</a></li>
<li><a href="../170251/index.html">Report on the Exchange environment using Powershell (now on Exchange 2013)</a></li>
<li><a href="../170253/index.html">Since March, Twitter is starting to disable API 1.0.</a></li>
<li><a href="../170259/index.html">Qemu-KVM: Work in Debian</a></li>
<li><a href="../170261/index.html">Facts and figures about digital television</a></li>
<li><a href="../170265/index.html">Anonymous Classes in Objective-C</a></li>
<li><a href="../170267/index.html">Three letters you don't know about</a></li>
<li><a href="../170269/index.html">Separate - Template for PHP</a></li>
<li><a href="../170271/index.html">Rick Byrne: Veeam Backup & Replication Cloud Edition Review</a></li>
<li><a href="../170275/index.html">Copywriting and Intellectual Property Stories</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>