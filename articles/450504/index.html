<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make an application out of the site and put it on Google Play in a few hours. Part 1/2: Progressive Web App</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably all people close to web development have already heard about Progressive Web App. Still would! This technology has practically equalized web ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make an application out of the site and put it on Google Play in a few hours. Part 1/2: Progressive Web App</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/qp/6r/fv/qp6rfvsvw7jfgzexsn2tqlcsxfm.png"><br><br>  Probably all people close to web development have already heard about Progressive Web App.  Still would!  This technology has practically equalized web and mobile development in terms of product distribution and user involvement. <br><br>  Yes, a modern frontend, written, for example, on React, works as an application.  But only this application is downloaded to the browser and launched from it.  This is a huge handicap, which has always had a mobile development.  Let's think, than from the point of view of a regular user, the ‚Äúapplication‚Äù is different from the ‚Äúsite‚Äù.  Immediately comes to mind that the application on the phone, and the site on the computer.  But there is a mobile browser, so the site is on the phone too.  Then there are 3 significant differences: <br><a name="habracut"></a><br><ol><li>  The application icon is on the main screen of the smartphone. <br></li><li>  The application opens in a separate window. <br></li><li>  The application sends push notifications. <br></li></ol><br>  All 3 points are removed thanks to Progressive Web App or PWA.  Now, accessing the site from a mobile browser, we can ‚Äúdownload‚Äù it, after which we will see an icon on the main screen.  In addition, a splash screen appears as it starts up, like in mobile apps, and if you wish, you can configure sending push notifications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And it would seem, everything is fine!  But alas, for more than 10 years of the mobile era, users have become too accustomed to looking for apps on Google Play and the App Store.  Breaking user habits is an ungrateful business, and therefore the guys from Google (by the way, Google is the developer of PWA) decided that if the mountain does not go to Magomed, then ... In general, most recently, on February 6, 2019, they <a href="https://developers.google.com/web/updates/2019/02/using-twa">ensured the use of Trusted Web Activities</a> for calculations of web applications in Google Play. <br><br>  The two-part article will explain how to get from a regular website to an application on Google Play in just a few hours.  All this will be shown on the example of a real service - <a href="https://skorochtec.ru/">Skorotets</a> . <br><br><ol><li>  <a href="https://habr.com/ru/company/mailru/blog/450504/"><u>How to make an application out of the site and put it on Google Play in a few hours.</u></a>  <a href="https://habr.com/ru/company/mailru/blog/450504/"><u>Part 1/2: Progressive Web App</u></a> </li><li>  <a href="https://habr.com/ru/company/mailru/blog/450506/"><u>How to make an application out of the site and put it on Google Play in a few hours.</u></a>  <a href="https://habr.com/ru/company/mailru/blog/450506/"><u>Part 2/2: Trusted Web Activity</u></a> </li></ol><br><br><h1>  Lighthouse </h1><br>  At the entrance we have a mobile layout website: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/330/2db/7bf/3302db7bf5f02c8dd48ebeb089ebbe7b.jpg" width="400"></div><br>  The first step is to install the <a href="https://chrome.google.com/webstore/detail/lighthouse/blipmdconlkpinefehnmjammfjpmpbjk">Lighthouse</a> extension in Google Chrome on your work computer.  It is a tool for analyzing sites in general and for verifying compliance with the Progressive Web App standard in particular. <br><br>  Next, open our website, combat or running locally, and generate a report for it using the Lighthouse: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/308/930/eaf/308930eaf740ff668775f027adeeb319.png" width="400"></div><br>  In the Progressive Web App section of the report you should see something like the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/49e/88f/e73/49e88fe7310fb29ea8eaeea2e0560445.png"><br><br>  Pay attention to the Installable section.  Firstly, if you run the site locally, and you have to do this during development and testing, then you need to use the localhost domain and no other.  Thanks to this, the ‚ÄúUse HTTPS‚Äù requirement will be met, or rather the Lighthouse will simply close its eyes to it, and you will be able to fully test your PWA. <br><br>  In addition to the HTTPS requirement for our application to become PWA and become installable, we need to connect the service worker and the Web app manifest to the site.  Let's do that. <br><br><h1>  Service worker </h1><br>  <a href="https://developer.mozilla.org/ru/docs/Web/API/Service_Worker_API/Using_Service_Workers">Service workers</a> technology allows your site to be online even when the server is unavailable.  This is such an intermediary between the client and the server, which intercepts each request and in the event of that, slips the data from the cache as a response. <br><br>  For PWA to work, a basic implementation of a service worker that looks like this is sufficient: <br><br>  service-worker.js <br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   true  production var doCache = true; //   var CACHE_NAME = 'my-pwa-cache-v2'; //    self.addEventListener('activate', event =&gt; { const cacheWhitelist = [CACHE_NAME]; event.waitUntil( caches.keys() .then(keyList =&gt; Promise.all(keyList.map(key =&gt; { if (!cacheWhitelist.includes(key)) { console.log('Deleting cache: ' + key) return caches.delete(key); } })) ) ); }); // 'install' ,      PWA self.addEventListener('install', function(event) { if (doCache) { event.waitUntil( caches.open(CACHE_NAME) .then(function(cache) { //     ( ) fetch('/static/reader/manifest.json') .then(response =&gt; { response.json() }) .then(assets =&gt; { //        const urlsToCache = [ '/app/', ........ '/static/core/logo.svg*', ] cache.addAll(urlsToCache) console.log('cached'); }) }) ); } }); //   , -         ,    self.addEventListener('fetch', function(event) { if (doCache) { event.respondWith( caches.match(event.request).then(function(response) { return response || fetch(event.request); }) ); } });</span></span></code> </pre> <br>  Here handlers are implemented for three events: <code>install</code> , <code>activate</code> and <code>fetch</code> .  As soon as the user opens the site where there is a service worker, the install event will be triggered.  This is the procedure for installing a service worker in the user's browser.  In its handler in the <code>urlsToCache</code> array <code>urlsToCache</code> you can specify the pages of the site that will be cached, including statics.  Then <code>activate</code> is called, which clears the resources used in the previous version of the service worker script.  And now that the service worker has been successfully installed, it will intercept every <code>fetch</code> event and look for the requested resources in the cache before following them to the server. <br><br>  To make it all work, you need to add a script to register the service worker in the html files.  Since Skorottets is a one-page application (SPA), it has one single html, which after adding the specified script looks like this: <br><br>  index.html <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/build/app.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'serviceWorker'</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">in</span></span></span><span class="javascript"> navigator) { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'load'</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ navigator.serviceWorker.register(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'/service-worker.js'</span></span></span><span class="javascript">).then(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">registration</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// Registration was successful console.log('ServiceWorker registration successful with scope: ', registration.scope); }, function(err) { // registration failed :( console.log('ServiceWorker registration failed: ', err); }).catch(function(err) { console.log(err) }); }); } else { console.log('service worker is not supported'); } </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The <code>navigator.serviceWorker.register('/service-worker.js')</code> function <code>navigator.serviceWorker.register('/service-worker.js')</code> takes as its argument the URL where the service worker file is located.  It does not matter how exactly the file is called, but it is important that it is located in the root of the domain.  Then the service domain will be the entire domain, and it will receive <code>fetch</code> events from any page. <br><br>  Thus, placing the service worker file at <a href="">skorochtec.ru/service-worker.js</a> and adding the necessary script in html, we get the following picture in the Lighthouse report: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ae/e54/f5a/7aee54f5afb99e56c536300a272a94a0.png"><br><br>  If we compare with the previous report, now we are satisfied with the second point and the site responds with 200 even offline, and in the 5th paragraph we see that the service worker was found, but the start page is missing.  Information about the start page and not only is indicated in the Web App Manifest, let's add it! <br><br><h1>  Web App Manifest </h1><br>  <a href="https://developer.mozilla.org/ru/docs/Web/%25D0%259C%25D0%25B0%25D0%25BD%25D0%25B8%25D1%2584%25D0%25B5%25D1%2581%25D1%2582">The manifest</a> provides information about our application: short and long name, icons of all sizes, start page, colors and orientation. <br><br>  manifest.json <br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"short_name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"icons"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-16.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"16x16"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-32.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"32x32"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-48.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"48x48"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-72.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"72x72"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-96.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"96x96"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-144.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"144x144"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-192.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"192x192"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"src"</span></span>:<span class="hljs-string"><span class="hljs-string">"/static/core/manifest/logo-pwa-512.png"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sizes"</span></span>: <span class="hljs-string"><span class="hljs-string">"512x512"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"image/png"</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">"start_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"/app/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"background_color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#7ACCE5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"theme_color"</span></span>: <span class="hljs-string"><span class="hljs-string">"#7ACCE5"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"orientation"</span></span>: <span class="hljs-string"><span class="hljs-string">"any"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"display"</span></span>: <span class="hljs-string"><span class="hljs-string">"standalone"</span></span> }</code> </pre> <br>  The last variable indicates that it will be a separate application.  The manifest file must be located on the site (not necessarily in the root) and connect it to html: <br><br>  index.html <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Add manifest --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"manifest"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{% static "</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">core</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">manifest</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">manifest.json</span></span></span><span class="hljs-tag">" %}"&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Tell the browser it's a PWA --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/static/build/app.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'serviceWorker'</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">in</span></span></span><span class="javascript"> navigator) { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.addEventListener(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'load'</span></span></span><span class="javascript">, </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ navigator.serviceWorker.register(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'/service-worker.js'</span></span></span><span class="javascript">).then(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">registration</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-comment"><span class="javascript"><span class="hljs-comment">// Registration was successful console.log('ServiceWorker registration successful with scope: ', registration.scope); }, function(err) { // registration failed :( console.log('ServiceWorker registration failed: ', err); }).catch(function(err) { console.log(err) }); }); } else { console.log('service worker is not supported'); } </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Let's analyze the Lighthouse site again: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f6/81f/411/0f681f41101fb338efbd166904462b69.png"><br><br>  Hooray!  Now we have not just a website, but a Progressive Web App!  You may have noticed that the download speed has increased dramatically.  It has nothing to do with what we did, I just replaced the development assembly of the React-application with production, so that the report looked as beautiful as possible. <br><br>  Well, we go to the site from mobile Chrome and what do we see? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b35/65a/ac9/b3565aac9825d0080986720cdc9d9231.jpg" width="400"></div><br>  Yes!  You can open the champagne!  Add an application to the main screen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba2/97b/e53/ba297be532bbf6881e561aad65ae95d3.jpg" width="400"></div><br><br>  As a bonus, we get a splash screen at startup, which is assembled from the names specified in the manifest name, background_color and 512x512 icons in the icons array: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e62/684/7e6/e626847e6ed596232f86c46738659178.jpg" width="400"></div><br>  Unfortunately, the color of the text is automatically selected, which in the case of Skoroshtetsa slightly breaks the style. <br><br>  Well, the application itself: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd6/105/230/bd61052307b6b7a6492174c74f67d4fa.jpg" width="400"></div><br><h1>  Restrictions </h1><br>  At the moment, PWA is supported only in Chrome and Safari (starting with iOS version 11.3).  Moreover, Safari supports this technology "quietly."  The user can add the application to the main screen, but there is no message about it, unlike Chrome. <br><br><h1>  Useful tips and tricks </h1><br><h3>  1. Offer to install on Safari </h3><br>  Since Apple did not do this (we hope that we have not done it yet), we have to implement it with our own hands.  It turns out this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e37/997/fff/e37997fffe093504de191c6ccff7bcb9.jpg" width="400"></div><br>  It is implemented with the following javascript code: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isIos = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userAgent = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.navigator.userAgent.toLowerCase(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-regexp"><span class="hljs-regexp">/iphone|ipad|ipod/</span></span>.test( userAgent ); }; <span class="hljs-comment"><span class="hljs-comment">// ,        const isInStandaloneMode = () =&gt; ('standalone' in window.navigator) &amp;&amp; (window.navigator.standalone); //     iOS   ,    if (isIos() &amp;&amp; !isInStandaloneMode()) { this.setState({ isShown: true }); //   React }</span></span></code> </pre> <br><h3>  2. Tracking installations </h3><br>  This works only in Google Chrome.  You need to add a script to the html that catches the appinstalled event and, for example, send a message to your server about this: <br><br><pre> <code class="javascript hljs">&lt;script&gt; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'appinstalled'</span></span>, (evt) =&gt; { fetch(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">your_url</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">, { method: 'GET', credentials: 'include', }); }); </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br><h3>  3. The right choice start_url </h3><br>  Be sure to take care that the url of all pages of the application are a continuation of the <code>start_url</code> specified in the manifest.  Because if you specify <code>"start_url": "/app/"</code> , and then the user navigates to the page, say, "/ books /", the browser‚Äôs address bar will immediately show itself and the entire user experience will break.  In addition, the person will feel deceived: he thought that he was using the application, and this is a disguised browser.  And even the <code>theme_color</code> from the manifest, which will color the browser interface in your corporate color, will not save. <br><br>  In the case of Skoroshtetsa, all pages related to the application begin with / app /, therefore there are no such incidents. <br><br><h1>  What's next? </h1><br>  Well, now you know how to get to the user on the main screen of the smartphone through your website.  But this is only one of the doors, and most likely not the front door.  The <a href="https://habr.com/ru/company/mailru/blog/450506/">second part</a> will explain how to enter through the front door: you will learn how to put your progressive web application on Google Play. <br><br><h1>  useful links </h1><br><ul><li>  <a href="https://auth0.com/blog/introduction-to-progressive-apps-part-one">Introduction to Progressive Web Apps (Offline First) - Part 1</a> </li><li>  <a href="https://auth0.com/blog/introduction-to-progressive-web-apps-instant-loading-part-2">Introduction to Progressive Web Apps (Instant Loading) - Part 2</a> </li><li>  <a href="https://auth0.com/blog/introduction-to-progressive-web-apps-push-notifications-part-3">Introduction to Progressive Web Apps (Push Notifications) - Part 3</a> </li><li>  <a href="https://tuhub.ru/posts/progressive-web-app-with-react">Develop your first Progressive Web App with React</a> </li><li>  <a href="https://www.creativebloq.com/features/9-amazing-pwa-secrets">9 amazing PWA secrets</a> </li><li>  <a href="https://medium.com/%40firt/progressive-web-apps-on-ios-are-here-d00430dee3a7">Progressive Web Apps on iOS are here</a> </li><li>  <a href="https://medium.com/%40addyosmani/progressive-web-apps-with-react-js-part-i-introduction-50679aef2b12">Progressive Web Apps with React.js: Part I - Introduction</a> </li><li>  <a href="https://medium.com/%40addyosmani/progressive-web-apps-with-react-js-part-2-page-load-performance-33b932d97cf2">Progressive Web Apps with React.js: Part 2 - Page Load Performance</a> </li><li>  <a href="https://medium.com/%40addyosmani/progressive-web-apps-with-react-js-part-3-offline-support-and-network-resilience-c84db889162c%3Fsource%3Duser_profile---------11----------------">Progressive Web Apps with React.js: Part 3 - Offline support and network resilience</a> </li><li>  <a href="https://medium.com/%40addyosmani/progressive-web-apps-with-react-js-part-4-site-is-progressively-enhanced-b5ad7cf7a447">Progressive Web Apps with React.js: Part 4 - Progressive Enhancement</a> </li><li>  <a href="https://medium.com/dev-channel/treebo-a-react-and-preact-progressive-web-app-performance-case-study-5e4f450d5299">Performance Case Study: Treebo React And Preact Progressive Web App</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/450504/">https://habr.com/ru/post/450504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450492/index.html">Social work and open design. Introduction</a></li>
<li><a href="../450494/index.html">How does the translation of the term trunk depend on the vendor of the switches?</a></li>
<li><a href="../450498/index.html">How to compress time?</a></li>
<li><a href="../4505/index.html">Tut.By demonstrates Internet censorship in Belarusian</a></li>
<li><a href="../450500/index.html">Development of Full Self-Driving Computer</a></li>
<li><a href="../450506/index.html">How to make an application out of the site and put it on Google Play in a few hours. Part 2/2: Trusted Web Activity</a></li>
<li><a href="../450508/index.html">Joe Armstrong on Elixir, Erlang, OP and OOP</a></li>
<li><a href="../450510/index.html">Five problems in the operation and maintenance of Highload IT systems</a></li>
<li><a href="../450512/index.html">Swift vs. Rust - benchmarking on Linux with a (un) understandable ending</a></li>
<li><a href="../450516/index.html">Qualified macOS e-signature</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>