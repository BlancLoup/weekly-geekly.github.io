<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity: Build under Android or "size matters"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In some cases, it is necessary to work on reducing the size of the assembly for Android . For example, installing heavyweight APKs for mobile Internet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity: Build under Android or "size matters"</h1><div class="post__text post__text-html js-mediator-article">  In some cases, it is necessary to work on <b>reducing the size of the assembly for Android</b> .  For example, installing heavyweight APKs for mobile Internet users can cost a pretty penny.  The excess size of APK in 50 MB on Google Play translates into additional difficulties with upload. <br><br><img src="https://habrastorage.org/files/abf/ef1/93e/abfef193e4924eda800a520d470d9e58.png"><br><br>  We developed a <b>2D game for Android on <a href="http://unity3d.com/">Unity</a></b> , which is replete with images (most with areas of transparency) and various sounds, and faced with the problem of the size of APK.  Looking ahead, I will say that having solved it and reduced the weight by 1.5 times, we received 1.5 times more downloads.  Makes you think, is not it? <br><a name="habracut"></a><br>  Trying to overcome the problem of heavyweight applications, we turned to the great <a href="http://docs.unity3d.com/Manual/ReducingFilesize.html">documentation</a> from Unity.  It turned out that there this topic is discussed only in passing.  It is mentioned which aspects influence the size of the assembly and how to influence these aspects in order to make the APK smaller, and also some specifics about the image import settings. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We practically did not find any other useful information on this issue on the Internet.  Therefore, we conducted a small study, the results of which we hasten to share with you. <br><br>  So, according to the documentation, <b>the size of the assembly affects</b> : <br><ol><li>  Size of assets (images and sounds); </li><li>  Meshes and animated clips; </li><li>  The size of the included dll. </li></ol><br>  We didn‚Äôt work with meshes and imported animation clips, so let's start with assets. <br><br><br><h3>  IMAGES </h3><br>  Specify about the images.  In our game, the principle of <b>pixel-perfect</b> .  All images without alpha channel have a <b>smooth gradient</b> .  The rest of the images are transparent, and the opaque areas also have a smooth gradient. <br><br>  Let us analyze what contribution to the size of the ARC make images in the format of <b>PNG</b> and <b>JPG</b> . <br><br><h3>  PNG pictures </h3><br>  For PNG, this contribution depends on two ‚Äúvariables‚Äù: <br><ol><li>  The size of the picture on the file system; </li><li>  Customize import. </li></ol><br>  We saved 3 pictures in Photoshop with settings: <i>Compression-&gt; Smallest / Slow, Intrelaced: No.</i>  A PNG image of 295 KB in size took 236 KB in assembly.  Picture 612 Kbytes occupied 480 Kbytes.  A picture of 21.2 Kbytes took 23 Kbytes (of course, with the same import settings).  Progressivity is obvious. <br><br>  Next, we saved the first image in Photoshop with the settings: <i>Compression-&gt; None / Fast, Intrelaced: Yes</i> .  Received a file of 9000 KB in size, however he added the same 236 KB in the assembly. <br><br>  This confirms the words from the documentation that <b>Unity recodes all assets to the internal format</b> .  Obviously, it approximately corresponds to the PNG format saved in Photoshop with the following settings: Compression-&gt; Smallest / Slow, Intrelaced: No.  And Unity recodes all PNGs to this format, regardless of the initial file format. <br><br><h3>  JPG pictures </h3><br>  Experiments have unequivocally shown that the JPG images contribute to the size of the assembly in <b>proportion to their size</b> .  While it is not quite clear how Unity behaves if the asset is in JPG format.  We saved the same (first) image in JPG and got a very small file on the file system (75 KB).  However, in the assembly, he took an exorbitant 767 KB (*). <br><br>  We conducted an experiment on a large number of different pictures, here I cite only a small part of the research.  In other experiments, on the contrary, we managed to reduce the overall size of the assembly by converting all files from PNG to JPG. <br>  The causes of this phenomenon have not yet been identified. <br>  Most likely, the internal format of Unity takes place again, however, it has not yet been possible to figure out the exact principles of the interaction of Unity‚Äôs witchcraft mechanism with JPG assets. <br><br>  Another way to work with JPG will be described below. <br><br>  <b>findings</b> <br><ol><li>  Apparently, Unity takes into account the format in which the image is stored, and the characteristics of the image and performs compression on any internal principles; </li><li>  One principle is completely unambiguous: images in the same format contribute to the size of the assembly, which is <i>directly proportional (but NOT EQUAL) to its size on the file system</i> . </li></ol><br>  Import settings affect the size of the assembly completely as described in the dock (the better the picture, the greater its contribution to the size of the assembly).  There are no hidden features here.  (No experiments have yet been carried out with other image formats.) <br><br><h3>  SOUNDS </h3><br>  For sounds, two import settings are important: <b>Audio Format</b> and <b>ForceToMono</b> . <br><br>  WAV files take up more space in the assembly than MP3 files (the contribution to the assembly size is approximately equal to the file size).  The stereo WAV file will take less space if <i>ForceToMono = true is set</i> .  Exactly the same effect can be achieved if you convert the file to "mono" before importing (then ForceToMono will not be available in the inspector). <br><br>  However, if you set the <i>AudioFormat = Compressed</i> import setting for the WAV file, it will take up as much space in the assembly as the corresponding top-quality MP3 file (Audacity: variable bitrate, 220-260 kbps).  That is, Unity independently encodes sound in MP3 format. <br><br>  For files in the same format, the principle is directly proportional to the contribution to the size of the assembly. <br><br>  Other import settings do not affect the size of the assembly.  They affect the amount of space occupied by sound in RAM. <br><br><h3>  AND NOW ABOUT SPECIFIC STEPS TO OUR GOAL </h3><br><ol><li>  If possible, <b>reduce the size and quality of the original graphics files</b> . <br>  (1-a) Trimming areas of transparency. <br>  In our game we used a lot of pictures with impressive areas of transparency around the image.  Transparency areas increase the file size only by a few percent and do not really affect the size of the assembly (although cropping 102 rather big pictures saved us 2 MB).  But areas of transparency increase the use of RAM (since there pictures are presented in BMP). <br><br>  Thus, the advice: <b>to reduce the load on the RAM</b> <br>  * avoid large areas of transparency in images; <br>  * do not form atlases with large areas of transparency, especially in NGUI. <br><br>  (But we were distracted from the main topic.) <br><br></li><li>  For images that do not have transparency and are displayed in the highest quality, <b>Advanced-&gt; RGB24</b> must be set in the import settings.  RGBA32 for them does not make sense, but to leave Automatic Truecolor is not recommended, because (as experience has shown) it can be perceived by the system as RGBA32.  And this is completely superfluous in the absence of areas of transparency (adds weight to the assembly and increases the use of RAM). </li><li>  Reduce the quality of images in the import settings under the scheme: <b>32 bit -&gt; 24 bit -&gt; 16 bit,</b> making sure that the level of image quality remains within acceptable limits. </li><li>  Limit <b>maxTextureSize</b> for images for which this is possible while maintaining acceptable quality. </li><li>  Carefully <b>manually delete unused assets in the Resources folders</b> before the build process.  Remember that for assets located in the Resources folders, Unity does not automatically delete them, even if they are not assigned in the Inspector. </li><li>  For <b>JPG</b> images: change the file extension to <b>bytes</b> and it will turn into TextAsset.  After that, use the <i>Texture2D.LoadImage ()</i> function to load the image.  It should be remembered that this function loads the processor and may be inappropriate in the case of large images that need to be loaded very quickly.  However, this method often helps to impressively facilitate the assembly. </li><li>  Reduce the <b>size of the sound files to the minimum possible</b> size (taking into account the quality requirements).  If possible, use MP3, not WAV.  But if you need the highest quality MP3s, you can use the WAV file with the import setting <i>AudioFormat = Compressed</i> (Unity recodes itself).  If possible, use Mono instead of Stereo.  For <i>wave</i> files - set import setting <i>ForceToMono = true</i> </li></ol><br>  After completing each item, it is advisable to check the effect obtained.  Because in the behavior of Unity there is still some magic. <br><br><h3>  <i>Few words about dll</i> </h3><br>  <a href="http://docs.unity3d.com/Manual/ReducingFilesize.html">The document</a> lists a list of necessarily included in the dll assembly and calls for <b>minimizing the number of additional dll</b> (especially heavy).  In particular, if possible, do not use System.dll (adds 2 MB to the APK).  However, even if we avoid references to methods from this library, <b>System.dll is still (as of Unity 4.5.5) included in the assembly</b> , since it is pulled up by the mandatory Mono.Security.dll.  Therefore, it turns out that the <i>official documentation of Unity in this place is not absolutely relevant</i> . <br><br>  But the use of other (optional) dll is desirable to avoid in the name of reducing the size of the assembly. <br><br>  <i>Today we have everything.</i>  <i>Thanks for attention!</i> <br><br>  (Please consider this material as more or less systematized results of the study, and not as a universal guide to action. I would be very happy with comments, comments, constructive criticism, objections, suggestions, additions. And, of course, I will be very happy to know what methods are used by colleagues from other companies to resolve the issue under discussion.) </div><p>Source: <a href="https://habr.com/ru/post/250873/">https://habr.com/ru/post/250873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250855/index.html">Applied optimization practice and some history</a></li>
<li><a href="../250857/index.html">MailChimp UX Team: Collaboration [Part 2 of the Book]</a></li>
<li><a href="../250859/index.html">VPN everywhere: IPsec without L2TP with strongSwan</a></li>
<li><a href="../250861/index.html">Parsing function calls in PHP</a></li>
<li><a href="../250867/index.html">When the site can be more than 1Mb?</a></li>
<li><a href="../250875/index.html">What is Business Intelligence?</a></li>
<li><a href="../250879/index.html">Everything has been stolen before us.</a></li>
<li><a href="../250881/index.html">Optimizing ASP.NET - practical tips for working with IIS</a></li>
<li><a href="../250885/index.html">Translit for JavaScript and GOST-7.79-2000</a></li>
<li><a href="../250887/index.html">Do not be evil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>