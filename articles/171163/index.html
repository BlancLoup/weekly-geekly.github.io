<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy installation of Asterisk + FreePBX for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Situation 
 There are a lot of descriptions of IP telephony deployment on the network today and basically these are two options: 


- We take the fini...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy installation of Asterisk + FreePBX for beginners</h1><div class="post__text post__text-html js-mediator-article"><h4>  Situation </h4><br>  There are a lot of descriptions of IP telephony deployment on the network today and basically these are two options: <br><ul><li>  We take the finished distribution in the form of an installation image (Elastix, Trixbox etc ...) and as a result we get a working complex without having any knowledge of Linux </li><li>  We install the complex on our own while compiling from source codes and manually editing many configuration files. </li></ul><br>  Each option has both advantages and disadvantages.  If the first method implies almost zero training and makes it possible to get a result without understanding how it works, the second one on the contrary requires extensive knowledge of linux and is very difficult for beginners, although it provides high flexibility and scaling. <br><br><h4>  Prerequisites </h4><br>  In the process of introducing IP telephony in one of the companies with an extensive branch structure, both options were considered but both were not suitable for a number of reasons: <br><ul><li>  The project budget did not imply the costs of attracting third-party companies to deploy the project, it was decided to deploy the whole complex of telephony on its own. </li><li>  Most of the system administrators in the branches were not familiar with Linux systems and were pure Winows administrators. </li><li>  It was necessary to lay the high flexibility of the system for future, not yet invented tasks. </li></ul><br><br>  We faced a dilemma, on the one hand, it is easier to set up the servers and send them to the regions, and on the other hand, the entire burden of escorting such a ‚Äúblack box‚Äù falls on our shoulders, but we are few.  In general, this situation did not suit us.  The option of ordering the introduction of a third-party company was immediately flagged by management for financial reasons. <br>  The option with a ready-made distribution package also disappeared, since the project implied the need to expand the telephony functionality to the needs of the company, taking into account the specifics of the branches, and this extension had to be carried out by local staff.  That is, without learning nix systems in any way. <br><a name="habracut"></a><br><h4>  Decision </h4><br>  We decided to go the way more difficult and labor-intensive for us, but cheap for the company.  Began to teach system administrators the basics of working with linux.  The concept of learning is that an employee can independently take a typical linux ubutu server 12.04 distribution to install Asterisk, the FreePBX Web management and the hylafax + Avantfax web fax management system on it, while using real projects in their current states. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, to simplify deployment, the instruction should be as simple and short as possible.  In the end, it all came down to a simple copy-paste and install most packages from the repositories.  The whole process was checked many times by repeated installations.  We have tried to ensure the principle of minimum sufficiency.  All without which you can do without skipping (left for self-development by employees). <br>  This made the task for Win admins who were not used to the console much easier and made them feel more confident, especially when they received a working system in the minimum number of attempts.  This is very encouraging in the early stages. <br><br><h4>  So the instruction itself </h4><br>  After installing a clean ubuntu server 12.04 LTS <a href="http://ru.man.wikia.com/wiki/Ubuntu_server_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B2%25D1%258B%25D0%25B5_%25D1%2588%25D0%25B0%25D0%25B3%25D0%25B8">with this instruction,</a> we are ready to start the installation. <br><br>  <b>For the first time, ALL actions are performed by copying - pasting without changing anything as it is!</b> <br><br><h5>  LAMPA installation </h5><br>  LAMPA - (Linux, Apache, Mysql, Php, Asterisk) <br><pre><code class="bash hljs">apt-get update apt-get install lamp-server^ libmysqlclient18 asterisk-dev \ asterisk-mysql asterisk-moh-opsound-wav php-db selinux-utils audiofile-tools \ bison libset-intspan-perl curl openssl php5-gd lame sox libxml2 subversion \ dahdi-* linux-headers-`uname -r`</code> </pre> <br>  During the installation process, the wizard will ask you to set a password for the mysql server.  We set for example PaSs or ours and remember.  Empty password is not necessary to leave! <br><br><h5>  Freepbx </h5><br><br>  Specify the password that you installed when installing mysql <br><pre> <code class="bash hljs">passwd=PaSs <span class="hljs-comment"><span class="hljs-comment">#     fpbxver=2.10</span></span></code> </pre><br><br><h5>  Download and create database </h5><br><pre> <code class="bash hljs">svn co http://svn.freepbx.org/freepbx/branches/<span class="hljs-variable"><span class="hljs-variable">$fpbxver</span></span> /usr/src/freepbx <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/src/freepbx mysqladmin create asterisk -p<span class="hljs-variable"><span class="hljs-variable">${passwd}</span></span> mysqladmin create asteriskcdrdb -p<span class="hljs-variable"><span class="hljs-variable">${passwd}</span></span> mysql asterisk &lt; SQL/newinstall.sql -p<span class="hljs-variable"><span class="hljs-variable">${passwd}</span></span> mysql asteriskcdrdb &lt; SQL/cdr_mysql_table.sql -p<span class="hljs-variable"><span class="hljs-variable">${passwd}</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"GRANT ALL PRIVILEGES ON asterisk.* TO asteriskuser@localhost IDENTIFIED BY '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${passwd}</span></span></span><span class="hljs-string">';"</span></span> &gt; /tmp/tmpfbpx <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"GRANT ALL PRIVILEGES ON asteriskcdrdb.* TO asteriskuser@localhost IDENTIFIED BY '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${passwd}</span></span></span><span class="hljs-string">';"</span></span> &gt;&gt; /tmp/tmpfbpx <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"flush privileges;"</span></span> &gt;&gt; /tmp/tmpfbpx <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"quit"</span></span> &gt;&gt; /tmp/tmpfbpx mysql -p<span class="hljs-variable"><span class="hljs-variable">${passwd}</span></span> &lt; /tmp/tmpfbpx</code> </pre><br><br><h5>  Install FREEPBX </h5><br>  Run the installation (fill in the parameters or leave the default): <br><pre> <code class="bash hljs">rm /var/www/index.html ./install_amp --password=<span class="hljs-variable"><span class="hljs-variable">${passwd}</span></span> --webroot=/var/www</code> </pre><br>  Confirm the parameters <br><pre> <code class="bash hljs">adduser www-data asterisk /etc/init.d/apache2 restart wget http://127.0.0.1/admin/config.php<span class="hljs-comment"><span class="hljs-comment"># -O /dev/null</span></span></code> </pre><br><br><h5>  WEB server preparation </h5><br>  Changing the configuration of apache2, for correct work with the Russian language, as well as changing the user www-data on behalf of which apache2 starts on the user asterisk <br><pre> <code class="bash hljs">locale-gen ru_RU perl -pi -e <span class="hljs-string"><span class="hljs-string">'s/#AddDefaultCharset UTF-8/AddDefaultCharset UTF-8/g'</span></span> /etc/apache2/conf.d/charset perl -pi -e <span class="hljs-string"><span class="hljs-string">'s/export APACHE_RUN_USER=www-data/export APACHE_RUN_USER=asterisk/g'</span></span> /etc/apache2/envvars perl -pi -e <span class="hljs-string"><span class="hljs-string">'s/export APACHE_RUN_GROUP=www-data/export APACHE_RUN_GROUP=asterisk/g'</span></span> /etc/apache2/envvars /etc/init.d/apache2 restart</code> </pre><br><h5>  Download modules and updates </h5><br>  Download and install fresh modules. <br><pre> <code class="bash hljs">./setup_svn.php ./install_amp cp amp_conf/moh/*.wav /var/lib/asterisk/moh <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /etc/asterisk rm ccss.conf extensions.conf logger.conf iax.conf sip.conf features.conf sip_notify.conf chan_dahdi.conf chown asterisk:asterisk /etc/amportal.conf</code> </pre><br><br>  At this basic functionality is ready, you can connect to the server by <br> <code><a href="http://xn--80aid7bg/"></a>  </code>  <code><a href="http://xn--80aid7bg/"></a>  </code> login and password: admin <br><br><h5>  Some additions and fixes </h5><br>  A small tweak for stable operation of the FOP panel, restarts it every 10 minutes <br><pre> <code class="bash hljs">chmod 770 -R /var/www/admin/modules/fw_fop <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*/10 * * * * root amportal 2 &gt; /dev/null"</span></span>&gt;&gt;/etc/crontab</code> </pre><br>  We fix shoals with ways to store sounds <br><pre> <code class="bash hljs">cp -r /var/lib/asterisk/sounds/ /usr/share/asterisk/ rm -r /var/lib/asterisk/sounds/ ln -s /usr/share/asterisk/sounds /var/lib/asterisk/ chown -R asterisk:asterisk /var/lib/asterisk/sounds/ chown -R asterisk:asterisk /var/lib/asterisk/sounds/custom/</code> </pre><br><br>  Russification of voice <br><pre> <code class="bash hljs">paths=/usr/share/asterisk/sounds/ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /tmp wget -c http://downloads.asterisk.org/pub/telephony/sounds/asterisk-core-sounds-ru-wav-current.tar.gz mkdir <span class="hljs-variable"><span class="hljs-variable">$paths</span></span>/ru <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$paths</span></span>/ru tar zxvf /tmp/asterisk-core-sounds-ru-wav-current.tar.gz</code> </pre><br><br>  At this stage, the base system is considered to be deployed, then the configuration via the WEB interface is already underway. <br><br>  <a href="http://ru.man.wikia.com/wiki/Asterisk%252BFreePBX">Link to the wiki with instructions</a> </div><p>Source: <a href="https://habr.com/ru/post/171163/">https://habr.com/ru/post/171163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171151/index.html">Garbage Collector's unexpected behavior of sessions</a></li>
<li><a href="../171153/index.html">Perfect watch</a></li>
<li><a href="../171155/index.html">DataEngine and Python2 or How I wrote my widget</a></li>
<li><a href="../171157/index.html">Bitcoin exchange rate hit a record high.</a></li>
<li><a href="../171161/index.html">ASUS Vivobook S200E - an affordable laptop for solving serious problems</a></li>
<li><a href="../171165/index.html">Canonical seriously thinking about abandoning semi-annual releases.</a></li>
<li><a href="../171167/index.html">Intellectual ideas that everyone should know</a></li>
<li><a href="../171169/index.html">White-box cryptography in pictures</a></li>
<li><a href="../171171/index.html">"You must be crazy if you don't use the potential of Open Source." Gerhard Lausser on open source monitoring systems and enterprise solutions</a></li>
<li><a href="../171173/index.html">"Smart" queue size in android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>