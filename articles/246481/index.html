<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Quick Rollback in Veeam Backup & Replication: a new mode for fast recovery of virtual machine disks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Are you familiar with the situation when you had to quickly restore a virtual disk after a virtual machine failed? In this case, you can start the sta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Quick Rollback in Veeam Backup & Replication: a new mode for fast recovery of virtual machine disks</h1><div class="post__text post__text-html js-mediator-article">  Are you familiar with the situation when you had to quickly restore a virtual disk after a virtual machine failed?  In this case, you can start the standard full recovery of the virtual machine and wait until it is fully restored - in the new version of <a href="http://www.veeam.com/ru/vm-backup-recovery-replication-software.html" title="Veeam Backup &amp; Replication v8">Veeam Backup &amp; Replication v8,</a> this can be done much faster by applying the new incremental recovery mode - <b>Quick Rollback</b> . <br><br><img src="https://habrastorage.org/files/c6d/a5a/6cb/c6da5a6cb38c43fe8493554a083a922d.png" alt="image"><br><br><a name="habracut"></a><br>  So, what can you do when you need to fully restore a virtual machine disk (VM): first of all, you can use <i>Instant VM Recovery</i> , and then copy the VM data to production.  It should be noted that in this scenario, backup-storage is activated, which is usually inferior in terms of technical characteristics to storage systems located in the production network.  Suppose that the main priority is the speed of recovery, for which you are ready to restore the machine directly to its original state, bypassing the intermediate testing.  In such a scenario, Veeam Backup &amp; Replication v8.0 functionality can come in handy - this is the <b>Quick Rollback</b> option for the Full VM Restore script, which can be used when restoring a VM <b>to its original location</b> .  This option indicates that only incremental changes to the VM disk need to be rolled back (and not the entire disk, as in the usual case). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  What does this check mark do? </h1><br>  Instead of restoring the entire disk, Veeam Backup &amp; Replication will restore only the blocks that are needed in order to return the VM to the state at the selected recovery point.  Recovery time is significantly reduced, since only data blocks that have changed since the creation of a given recovery point are copied.  Veeam Backup uses the same Change Block Tracking (CBT) tracking technology to identify modified blocks as it does when creating incremental backups: <br><ul><li>  for the VMware platform - a request is made to the vSphere API </li><li>  for the Hyper-V platform - similar information comes from a proprietary component (Veeam CBT engine) </li></ul><br>  Receiving a list of modified virtual disk blocks from the moment of creating a restore point to the current state of the VM, Veeam Backup determines exactly which blocks were changed at what point, and which of them should be restored to disk in order to roll back to the desired state. <br><br>  It seems to be a simple functionality, but very useful in different life situations.  For example, one of the users said that when his virtual machine became a victim of a trojan, he decided not to waste time trying to fix the malware, but tried to recover from the <b>Quick Rollback</b> - and it took only a few seconds to restore. <br><br>  So, in the console, we run the Full VM Restore Wizard Restore Wizard, we reach the <b>Restore Mode</b> selection step. <br>  By default, recovery takes place to the original location (the <b>Restore to the original location</b> option is selected).  In this case, the <b>Quick Rollback</b> option is available for selection - turn it on and proceed to the next step. <br><br><img src="https://habrastorage.org/files/c6d/a5a/6cb/c6da5a6cb38c43fe8493554a083a922d.png" alt="image"><br><br>  What Veeam Backup does: turns off the source VM, if it still works, and begins to restore only the changed blocks. <br><br>  Let's see how performance changes relative to normal full VM recovery: <br><br><img src="https://habrastorage.org/files/09e/1f8/daf/09e1f8daf3cd4c949e4f95e84001d20b.png" alt="image"><br>  Of the 20 GB VMDK disk, 2.2 GB is effectively used.  In the normal scenario with full VM recovery (example on the left), we had to restore all 2.2 GB (it took 1 minute 8 seconds).  When the same machine was restored using the <b>Quick Rollback</b> (example on the right), it took only 29 MB to restore (it took 12 seconds). <br>  We can assume that the effect of using this option for machines with disks the size of terabytes will be even more obvious. <br><br>  I note that <b>Quick Rollback</b> can also be used when restoring a VM in 1 click from the Veeam Backup Enterprise Manager web console (since this is just the built-in script for full VM recovery to its original location): <br><br><img src="https://habrastorage.org/files/e91/f2e/e88/e91f2ee8801a4bef9c5383995efdaf94.png" alt="image"><br><br><h1>  Are there any "pitfalls"? </h1><br>  Let's talk about it.  As mentioned above, the <b>Quick Rollback</b> uses Modified <b>Block</b> Information (CBT).  However, this information in a number of emergency situations cannot be considered 100% reliable.  That is why this option is disabled by default, and <b>users are strongly recommended to use it only in cases when a problem at the guest OS level has led to the need for recovery.</b> <b><br></b>  <b>If there are problems at the hardware level (for example, with a host or storage) or a sudden voltage drop, then using Quick Rollback is not safe</b> - in such situations, there is a possibility of distortion of the SVT data, and there is a risk of ruining the VM drive by starting the recovery of the wrong blocks. <br><br>  We should not forget about a number of restrictions on the use of <b>Quick Rollback</b> in acceptable cases: <br><ol><li>  Check that the backup from which you are going to restore the machine was created with the inclusion of the CBT tracker.  This can be done by clicking the <b>Advanced</b> button in the <b>Storage</b> step of the backup task wizard and going to the tab of the corresponding platform (for more information for <a href="http://helpcenter.veeam.com/backup/80/vsphere/index.html%3Fbackup_job_advanced_vsphere_vm.html">VMware</a> and for <a href="http://helpcenter.veeam.com/backup/80/hyperv/index.html%3Fbackup_job_advanced_hv_hv.html">Hyper-V</a> ). </li><li>  You cannot perform two incremental restorations one after the other - because  after the first such recovery has passed, the CBT tracker on the source VM will be ‚Äúreset‚Äù, and at least one incremental backup pass will be needed so that you can make incremental recovery again. </li><li>  Incremental recovery for VMware uses only two data transfer modes - Network or Virtual Appliance.  Direct SAN Access mode cannot be enabled for this scenario. </li></ol><br>  Hopefully, the simple recommendations outlined here will allow you to successfully apply <b>Quick Rollback</b> for efficient recovery of virtual machines. <br><br><h1>  What else to read: </h1><br><ul><li>  <a href="http://habrahabr.ru/company/veeam/blog/242587/">Article on Habr√© about new features of Veeam Availability Suite 8.0</a> </li><li>  <a href="http://habrahabr.ru/company/veeam/blog/242983/">Article on Habr√© about incremental and other backup methods</a> </li><li>  <a href="http://www.veeam.com/ru/data-center-availability-suite.html">Solution page: an overview of opportunities, links to resources (in Russian)</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/246481/">https://habr.com/ru/post/246481/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246467/index.html">A simple solution for using EDS</a></li>
<li><a href="../246469/index.html">Yet another AOP in .NET</a></li>
<li><a href="../246471/index.html">My personal Sony Hack</a></li>
<li><a href="../246473/index.html">Club of anonymous Santa Clauses in Habr√© 2014-2015</a></li>
<li><a href="../246477/index.html">Yii 1.1.16</a></li>
<li><a href="../246483/index.html">Google's Quantum Online Sandbox</a></li>
<li><a href="../246485/index.html">Administer the server through a single console</a></li>
<li><a href="../246487/index.html">Peace, friendship and chewing on the digital services market</a></li>
<li><a href="../246489/index.html">Contest of games with gamepad support</a></li>
<li><a href="../246491/index.html">Work with sound and library SuperPowered</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>