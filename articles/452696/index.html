<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to run micro payments in your application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last week I spent developing my first public program, a Telegram bot that works as a Bitcoin wallet and allows you to ‚Äúthrow coins‚Äù to other members o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to run micro payments in your application</h1><div class="post__text post__text-html js-mediator-article">  Last week I spent developing my first public program, a Telegram bot that works as a Bitcoin wallet and allows you to ‚Äúthrow coins‚Äù to other members of group chats and also make external Bitcoin payments to yourself or to others.  ‚ÄúLightning Apps‚Äù.  I mean that the reader is generally familiar with Bitcoin and Telegram, because  I will try to write briefly, without going into details.  <a href="https://www.lopp.net/bitcoin-information.html">A selection of resources about Bitcoin is available at this link</a> , and Telegram is an instant messaging tool for mobile devices and PCs, which allows creating small applications (chat bots) on their platform. <br><br><h3>  What are the key features of this app? </h3><br><ul><li>  It allows you to thank or encourage the interlocutor with real material value, and not just a <i>‚Äúvirtual like‚Äù</i> , this takes electronic communication to a whole new level. </li><li>  A real-life example of an application that can financially interact with other applications using an open payment protocol. </li><li>  All components of the application are open source projects and it is possible to modify and apply them for their tasks.  The application does not use closed and / or commercial solutions, despite the fact that it fits into the sphere of e-commerce, which today is quite difficult to call open. </li></ul><br><h3>  And how to apply it in practice? </h3><br>  something like this‚Ä¶ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/097/02b/175/09702b1750c94616a10fc66c1275c00f.png" alt="image"></div><a name="habracut"></a><br>  or so ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ef/1ff/85f/3ef1ff85f1e7b77662c63a9d4d838666.png" alt="image"></div><br>  What do these numbers mean?  These are <b>units of bitcoin - satoshi</b> .  At stock prices in the middle of 2019, 1000 satoshi is about $ 0.06.  Satoshi can be spent online or easily exchanged for national currency.  It is for this reason (liquidity) that is not just another <i>‚Äúrecord in the database‚Äù</i> or <i>‚Äúpoints that you can spend in the stores of our partners,‚Äù</i> but the <b>most real Internet money</b> . <br>  <i>* Immediately I want to note that some words or phrases are not knowingly trying to write in Russian - either I don‚Äôt know the contextual translation itself in some cases, or such a translation in my opinion sounds more misleading than correct</i> <br><br>  It may be asked how to use such an application if there are no bitcoins.  They can easily be purchased in small quantities on one of the many exchanges or exchanger, or from a friend Bitcoiner or even get coins from current bot users.  Many wallets on the phone offer to buy bitcoins directly "without departing from the cash register." <br><br><img src="https://habrastorage.org/getpro/habr/post_images/883/661/461/883661461bdc686aec7d084d5d581236.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/779/716/5d9/7797165d93d292700d9a41a171d882a6.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="image"><br><br>  When bitcoins get hold of (or rather satos- <i>s</i> (?)), <a href="https://t.me/atomic_tipbot">Run @atomic_tipbot</a> and do / deposit. <br><br>  In response, the bot will ask how much Satoshi will contribute to the balance and will send a payment account that can be paid with a mobile wallet by scanning the QR code or by pressing the button ( <i>‚Äúopen in the wallet‚Äù</i> ) on the invoice page. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8fe/33b/84b/8fe33b84bb127132304634363bb4af42.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/4a3/da5/f76/4a3da5f76574ac9ebb2161d56bceff62.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/54d/a43/0be/54da430be68237193dee82ade50bab37.png" alt="image"><br><br>  Confirming the payment on your wallet, almost immediately a payment confirmation will be sent by the bot and this will be visually displayed in the account frame. <br><br>  Up to this point, we have touched on two components of the application - the back-end telegram bot and the cryptocurrency payment processing system (rather, its front-end). <br><br>  To create a Telegram bot, I used the <a href="http://python-telegram-bot.readthedocs.io/">Python Telegram Bot</a> .  And of course, the <a href="https://github.com/reablaz/atomic_tipbot">open source</a> bot itself. <br><br>  As a payment processing system and solving UX-tasks, the choice fell (in fact, there is almost no choice) on <a href="https://www.youtube.com/watch%3Fv%3Dnr0UNbz3AoQ">BTCPayServer</a> , to which the <a href="https://docs.btcpayserver.org/">documentation for this link</a> . <br><br>  If you look for solutions to processing payment events directly, then you should pay attention to the <a href="http://docs.electrum.org/en/latest/cmdline.html">Electrum CLI manual pages</a> for the so-called.  on-chain payments, and for instant micro-payments (Lightning) solutions like <a href="https://github.com/ElementsProject/lightning-charge">Lightning-charge</a> or <a href="https://github.com/fiatjaf/sparko">Sparko</a> . <br><br><h3>  So is it self-hosted or not !? </h3><br>  Yes it is.  In my application, I use free BTCPayServer hosting - <a href="https://btcpayjungle.com/">BTCPayJungle</a> , but this is absolutely possible and does not require much time to launch my own processing center.  However, it is worth remembering that you will need ~ 500GB of Bitcoin (and Litecoin) available on the hard disk for storing blockchains.  Computing and network resources will also be required for the synchronization time and, depending on your needs, the necessary ‚Äúwrappers‚Äù for blockchains to make it convenient to interact with them.  BTCPayServer does not contain <i>by-design</i> private keys or any other information that allows you to control your wallet. <br><br>  For on-chain (ordinary) payments, you must add a so-called.  xpub-key wallet in BTCPayServer to generate addresses for receiving (public keys).  This makes it possible and safe to use BTCPayServer even in a ‚Äúshared‚Äù form.  All these xpub keys and addresses can be easily obtained in good wallets like <a href="http://electrum.org/">Electrum</a> , to further customize the processing. <br><br>  Everyone who has encountered Bitcoin has heard that bitcoin is slow and transaction costs are expensive, especially when HYIP, so for an instant micro-payment it is worth using (off-chain) transactions of the Lightning Network. <br><br><h3>  What is this lightning network? </h3><br>  This is something like a bitcoin plug-in that builds on an additional layer of abstraction and allows you to make instant and almost free transactions on the Bitcoin network.  All this is possible thanks to cryptographic magic with multi-signatures, often called a <i>smart contract</i> .  There are several implementations of the Lightning Network protocol, I use the <a href="https://github.com/ElementsProject/lightning">c-lightning</a> implementation in C. <br><br>  The main difference between on-chain and off-chain (Lightning) payments is how they are stored.  All <b>on-chain</b> transactions are relayed to all network nodes until one of the Bitcoin nodes of the node announces a <a href="https://en.bitcoin.it/wiki/Mining">new naming block</a> with transactions included in it.  (On <a href="https://habr.com/ru/users/bitfury/" class="user_link">Habr√©</a> there is even <a href="https://habr.com/ru/users/bitfury/" class="user_link">BitFury</a> , they just produce iron for mining).  It is for this reason that we call such transactions <b>on-chain</b> .  Such transactions will be recorded in a common blockchain and will remain in it until the end of its existence.  Also, such transactions are publicly available and they can be monitored, monitored and analyzed. <br><br>  In the case of <b>off-chain</b> (Lightning) transactions, everything happens differently.  Each node of the Lightning-network has one <i>(or more)</i> on-chain addresses - these are the most common Bitcoin addresses from which everything begins.  When Bitcoins appear on such an address, it is possible to open a so-called.  <i>lightning channel</i> to another node, which means that using cryptographic techniques, these two nodes have agreed on the availability of funds among themselves.  Later, all transactions (both their own and foreign node transactions) that pass through such a channel are saved only on the nodes of the transaction participants (and intermediary nodes).  The only transactions that are recorded on the blockchain are transactions about opening or closing a channel.  On a more complete scale, such a network of interconnected nodes is obtained which builds thousands of different paths between participants for the ‚Äútransfusion‚Äù of funds from one node to another according to certain strict rules.  Virtually all such transactions are stored only in the database file of the nodes themselves.  It is for this reason that we call them <b>off-chain</b> . <br><br><h3>  The diagram shows the visualization of all application components. </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/3c6/636/b8c/3c6636b8c98d52aab9bd09ff9c52afcb.png" alt="image"><br><br>  In short: <br><br>  1) The user sends the command to the bot in <b>Telegram</b> <br><br>  2) Telegram sends a <b>python</b> event message to the bot <b>application</b> <br><br>  3) The <b>python application</b> sends a request to <b>BTCPayServer</b> <br><br>  4) BTCPayServer generates incoming BTC and LTC addresses, and also sends an invoice request to a <b>lightning-charge</b> , which in turn communicates with the <b>c-lightning</b> daemon.  At the exit, we get a beautiful HTML form of payment processing <br><br>  5) User pays invoice and sees confirmation <br><br>  6) <b>BTCPayServer</b> sends <i>an invoice payment notification</i> (IPN) to the specified callback_url, in our case <b>callbacks.py</b> (another python application for receiving notifications) <br><br>  7) According to the received data, the user's balance changes <br><br>  <i>... and if the user wanted to withdraw funds (coins that he received from others) ...</i> <br><br>  8) A bot's <b>Python application</b> waits for text or a QR code image, and when valid data is received, the <b>paylightning.py *</b> utility makes a payment, which initializes the transaction using c-lightning RPC. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/518/3dc/c81/5183dcc817817f1aa676ff74d17d08bb.png" alt="image"><br><br>  <i>* To be fair, it's worth noting that my paylightning.py wrapper is not completely finished and can return a false-negative result in specific scenarios.</i>  <i>I recommend <a href="https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/waitpay">to use a well-debugged wrapper</a> in cases close to production</i> <br><br>  What we have?  Users of our bot can inside the group chat or directly can transfer <b>material value</b> without restrictions.  And that's not all - thanks to the Lightning Network protocol, which in a sense is a unified and simplified payment network, it is possible to send the same money that was received in a chat to completely third-party applications.  For example, Telegram already had the first Bitcoin payment bot - @lntxbot.  ‚ÄúSingle balance‚Äù allows you to use any of the bots, depending on the preferences of a particular group chat (yes, the problem is absolutely contrived and the solution is quite useless, but the point is).  Throw balance from one bot to another is worth nothing and takes seconds!  It is important to note that the creators of these bots have never been contacted. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f09/c3a/ef9/f09c3aef995f7a82560987646b0d8ee0.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/1e2/344/82c/1e234482c56aa0df1d4b341ecfe3beb8.png" alt="image"><br><br>  Simply send a deposit request message from @lntxbot to @atomic_tipbot and voul'a! <br><br>  This is no longer just a ‚Äútransfer of numbers to the database‚Äù, but a payment between two different, unrelated databases.  Thus, several LApps have already been integrated into the bot, among them: <a href="https://sat2.io/">sat2.io</a> and <a href="https://lnsms.world/">lnsms.world</a> . <br><br>  <b>What does <i>LApp integration mean</i> ?</b> <br><br>  Each <i>Lightning Network</i> node is essentially a bitcoin wallet.  She has two balances: on-chain and off-chain.  On-chain balance is needed to open new channels and store funds from closed channels.  But the off-chain balance is just what goes between the nodes.  The basic requirements for a node are receiving and sending payments, so each node as software has <i><b>pay</b></i> and <i><b>invoice</b></i> functions.  I will demonstrate how this happens: <br><br><pre><code class="bash hljs">user@ln-node:/ % lightning-cli invoice 1000000000 internal_description external_description { <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"expires_at"</span></span> : 1558709834, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6"</span></span> }</code> </pre> <br>  We get the ‚Äúinvoice‚Äù of the <a href="">BOLT11</a> specification in this case, which is the format of payments in the Bitcoin network (and Litecoin, by the way, too).  This is a string containing information about the recipient, transaction amount, request expiration time, etc. Detailed information can be obtained by running decodepay for this line: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 <code class="bash hljs">user@ln-node:/ % lightning-cli decodepay lnbc10m1pwdaj72pp5vnqv3a0c7uytppy845fhdu7j2mujejukq6v8hgu4c26pj0hauksqdpqv4u8getjdeskchmyv4ekxunfwp6xjmmwxqyjw5qcqp2rzjqw3qcrp2u3ggke56wrjlstcg76drmfw680cvjum88sl7ja7mpas7xzxz8sqqfecqqyqqqqlgqqqqqqgqjqn8e3ml733dkms2txxldnuwsllwhhkldss73268hdka3e7f083vjhjqurwqrndqd2rcd85pw7vkywnr4dq7yfd59r0g2mw4wzztwr6dcprxzej6 { <span class="hljs-string"><span class="hljs-string">"currency"</span></span> : <span class="hljs-string"><span class="hljs-string">"bc"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558105034, <span class="hljs-string"><span class="hljs-string">"expiry"</span></span> : 604800, <span class="hljs-string"><span class="hljs-string">"payee"</span></span> : <span class="hljs-string"><span class="hljs-string">"025a14b8ed40583d67aec92da19453e0b2d1fbbf75f96f85d3dd0ff61a51ee0490"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 1000000000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"1000000000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span> : <span class="hljs-string"><span class="hljs-string">"external_description"</span></span>, <span class="hljs-string"><span class="hljs-string">"min_final_cltv_expiry"</span></span> : 10, <span class="hljs-string"><span class="hljs-string">"routes"</span></span> : [ [ { <span class="hljs-string"><span class="hljs-string">"pubkey"</span></span> : <span class="hljs-string"><span class="hljs-string">"03a20c0c2ae4508b669a70e5f82f08f69a3da5da3bf0c973673c3fe977db0f61e3"</span></span>, <span class="hljs-string"><span class="hljs-string">"short_channel_id"</span></span> : <span class="hljs-string"><span class="hljs-string">"574012x1255x1"</span></span>, <span class="hljs-string"><span class="hljs-string">"fee_base_msat"</span></span> : 1000, <span class="hljs-string"><span class="hljs-string">"fee_proportional_millionths"</span></span> : 1, <span class="hljs-string"><span class="hljs-string">"cltv_expiry_delta"</span></span> : 144 } ] ], <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"64c0c8f5f8f708b08487ad1376f3d256f92ccb9606987ba395c2b4193efde5a0"</span></span>, <span class="hljs-string"><span class="hljs-string">"signature"</span></span> : <span class="hljs-string"><span class="hljs-string">"304502210099f31dffd18b6db8296637db3e3a1ffbaf7b7db087a2ad1eedb7639f25e78b25022079038370073681aa1e1a7a05de6588e98ead078896d0a37a15b755c212dc3d37"</span></span> }</code> </pre><br>  But to pay for such an ‚Äúinvoice‚Äù we need the pay function from c-lightning: <br><br><pre> <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j <code class="bash hljs">user@ln-node:/ % lightning-cli pay lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j { <span class="hljs-string"><span class="hljs-string">"id"</span></span> : 163, <span class="hljs-string"><span class="hljs-string">"payment_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"c3e644a005f56e33df89facbce2c9dfcabbef5d105285a98272cacc77ab2de63"</span></span>, <span class="hljs-string"><span class="hljs-string">"destination"</span></span> : <span class="hljs-string"><span class="hljs-string">"03021c5f5f57322740e4ee6936452add19dc7ea7ccf90635f95119ab82a62ae268"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi"</span></span> : 200000, <span class="hljs-string"><span class="hljs-string">"amount_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200000msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"msatoshi_sent"</span></span> : 200003, <span class="hljs-string"><span class="hljs-string">"amount_sent_msat"</span></span> : <span class="hljs-string"><span class="hljs-string">"200003msat"</span></span>, <span class="hljs-string"><span class="hljs-string">"created_at"</span></span> : 1558106072, <span class="hljs-string"><span class="hljs-string">"status"</span></span> : <span class="hljs-string"><span class="hljs-string">"complete"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_preimage"</span></span> : <span class="hljs-string"><span class="hljs-string">"1a9552b9f4e9199e26839353f870b12cc85b7674a2fb134e78aa370032611019"</span></span>, <span class="hljs-string"><span class="hljs-string">"bolt11"</span></span> : <span class="hljs-string"><span class="hljs-string">"lnbc2u1pwdana3pp5c0nyfgq974hr8huflt9uutyalj4maaw3q5594xp89jkvw74jme3sdql2pshjgr5dus8q6r0dejjqampd3kx2aqcqzpgwjgn45gy80jwjhgm3tpsxg33j6h6pehdus0mnjerrad943cz3vs83g30lyhlhfjxtqvtl76vttkuhs5jekuxpsqmf98l8265pwmm76gp4e7z6j"</span></span> }</code> </pre><br>  All transaction states are processed by the entire network and your own node in particular.  There is no need (but there is such an opportunity) to interact with the authors of the application receiving the payment or with some kind of API to obtain information about the status of the payment.  There is no need to check the status of the payment in the processing intermediary system.  No need to wait for approval of your transaction by a bank or government agency.  In the end, there are no charge backs and other external factors that may affect the balance in your account.  This is a decision to transfer value via the Internet, without the need for a third party arbiter who decides whether the transaction complies with the rules (sometimes even internal rules about which not all participants are informed in advance) or not.  There are no ‚Äúinternal rules‚Äù in Bitcoin.  The only rules that you need to follow are the rules of the network - open and well-known. <br><br>  This makes real <b>direct</b> , <b>virtually free</b> and <b>instant</b> cash transactions between people or programs in a completely autonomous mode. <br><br>  If you have the opportunity to receive payment data from a third-party application, then you will be able to interact financially with this application.  As an example, consider the service lnsms.world, which allows you to send an SMS message to an arbitrary number, paying for it with bitcoins.  To integrate this application, we only need to transfer data from the web form directly to the SMS sending script - to emulate user actions on the website: <br><br><pre> <code class="python hljs">payload = { <span class="hljs-string"><span class="hljs-string">'number'</span></span>: phone_number, <span class="hljs-string"><span class="hljs-string">'text'</span></span>: text, <span class="hljs-string"><span class="hljs-string">'force_unicode'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } send_req = requests.post(<span class="hljs-string"><span class="hljs-string">'https://lnsms.world/invoice'</span></span>, data=payload) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> send_req.status_code == <span class="hljs-number"><span class="hljs-number">201</span></span>: plain_invoice = str(send_req.text)</code> </pre><br>  I do not know for what reason, but lnsms responds with 201 HTTP status code and returns the BOLT11 format invoice.  Well, this is enough for the bot users to make payment for sending SMS from their balance received in chatikah.  The user does not even know what is happening there, he just paid a couple of cents for sending SMS.  And I, as a developer, do not go into the details of the work of SMS services.  Just forwarded the payment and received the service.  You can make a surcharge on top, but you can not do it - this is my free choice.  No accounts, agreements and the next API for trivial tasks like sending SMS. <br><br>  Now let's imagine for the moment that our application is something more useful than a chat bot and makes a payment not to another bot, but to another application or device connected to the Internet.  Or is it tens or even hundreds of insignificant payments every second between devices, services, stores or some service providers.  This is the power of micro-payments, this is how the Internet of Things should look.  There are already projects like <a href="https://althea.org/">Althea</a> that embody these ideas in life and in the near future we will see great, in my opinion, changes in the area that we are now calling e-commerce. <br><br>  If you liked the post and you want to try bitcoin in action - <a href="https://tip.ysx.in/">send me a beer, but soft French buns</a> . </div><p>Source: <a href="https://habr.com/ru/post/452696/">https://habr.com/ru/post/452696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452686/index.html">Spying for which they do not ban (history from the 80s)</a></li>
<li><a href="../452688/index.html">Windows service. Search for system errors and display them in WinForm C #</a></li>
<li><a href="../452690/index.html">What's so interesting about the Trans-Siberian Railway?</a></li>
<li><a href="../452692/index.html">The author of the project rePalm rewrote Palm OS from scratch and plans to turn it into a platform for smart watches.</a></li>
<li><a href="../452694/index.html">Universal pool</a></li>
<li><a href="../452698/index.html">Two in one: tourist data and tickets for cultural events were publicly available.</a></li>
<li><a href="../4527/index.html">UN thinks what will happen to the Internet</a></li>
<li><a href="../452700/index.html">News from the world of OpenStreetMap ‚Ññ460 (05/07/2019 - 13/05/2019)</a></li>
<li><a href="../452702/index.html">Tests for code and code for tests</a></li>
<li><a href="../452704/index.html">Post-mortem debugging on Cortex-M</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>