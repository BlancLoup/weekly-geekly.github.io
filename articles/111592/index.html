<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Overview of NDIS Specification Drivers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Network drivers 
 Network drivers can be divided into 2 categories: TDI drivers (Transport Driver Interface) and NDIS drivers (Network Driver Interfac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Overview of NDIS Specification Drivers</h1><div class="post__text post__text-html js-mediator-article"><h4>  Network drivers </h4><br>  Network drivers can be divided into 2 categories: TDI drivers (Transport Driver Interface) and NDIS drivers (Network Driver Interface Specification).  TDI drivers are high-level drivers, for example, SMB client, SMB server, SMB wrappers (NFFS, MSFS), etc.  We will consider the NDIS driver.  NDIS is a special driver (it corresponds to the ndis.sys file), which contains functions used by low-level network drivers.  NDIS envelops low-level network drivers, as it were, and mediates their communication with each other and with hardware.  In fact, NDIS can be considered the third core of Windows.  To clarify more clearly what NDIS is, you can look at the following picture: <br><br><img src="http://files.shelek.su/articles/imgforarticles/struct2.gif" alt="NDIS structure"><br><br><a name="habracut"></a><br>  As you can see from this illustration, NDIS drivers come in three types: <br><ul><li>  Miniport drivers (adapter drivers) </li><li>  Intermediate drivers (for example, psched.sys) </li><li>  Protocol drivers (for example, tcpip.sys) </li></ul><br>  Consider each of them separately. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Miniport drivers </h4><br>  Each network piece of hardware has its own miniport driver.  Through NDIS, the miniport driver receives some commands.  The functions of the miniport driver can be described as follows: <br><ul><li>  initializes its device (adapter) </li><li>  create / enable / disable / delete network connections </li><li>  issuing to the client or changing adapter parameters </li><li>  sending packages </li><li>  receiving packages </li><li>  OS notification of adapter status </li><li>  reboot and stop the adapter </li></ul><br>  The miniport driver contains 22 standard callback functions with which it notifies about various events (some of these functions can be NULL, then the driver is not notified of the corresponding events).  NDIS exports about 150 functions for use by miniport drivers. <br><br>  Miniport drivers are ‚ÄúConnectionless‚Äù (for example, an Ethernet adapter driver) and ‚ÄúConnection-oriented‚Äù (for example, a modem driver).  With the Connection-oriented drivers, the callback system is a bit more complicated, it includes event handlers related to connecting to the communication channel, disconnecting from the channel, choosing a channel (for wireless adapters), etc.  For some operations, connection-oriented drivers call special NDIS functions that have the ‚ÄúCo‚Äù prefix in the name (for example, the driver must call NdisMColndicateReceivePacket instead of NdisMIndicateReceivePacket. <br><br>  Each callback performs its task: issuing information, sending data, receiving data, etc.  More information can be found in the help to the WDK (DDK).  There you can get full information about callbacks. <br><br>  Protocol drivers can reassign the miniport driver (assuming that the miniport driver can do this - either itself or the adapter can do it at the hardware level) some of its functions (for example, to delineate the checksum or digital signature of an IP packet or decide how fragment a large TCP packet).  This greatly enhances the network manufacturer. <br><br>  There are various additional advanced interfaces that the miniport driver can support, for example: <br><ol><li>  LBFO (Load Balancing and Fail Over) - allows adapters that understand it to distribute outgoing traffic and correct each other's errors.  However, what makes sense only on backbone routers (central routers of large networks) that Windows rarely installs on </li><li>  FFP (Fast Forwarding Path) - allows adapters that understand its adapters to route / filter packets purely in hardware, without OS at all and without loading the main processors of the computer </li></ol><br><h4>  Intermediate drivers </h4><br>  The intermediate driver is visible from above as a miniport driver (we look at the picture), i.e.  as if a virtual adapter, and from below - as a protocol driver (again we look at the picture), as if a virtual protocol.  As a special case, it is possible that the intermediate driver is visible only from above. <br><br>  Intermediate drivers usually do one of: <br><ul><li>  organize "fair" access of different client programs to adapters so that programs do not interfere with each other </li><li>  filter and intercept traffic </li><li>  route packets from one network to another if these networks differ (for example, Ethernet and WI-FI) </li></ul><br>  Intermediate drivers are used by sniffers to scan network traffic.  Intermediate drivers can sit on top of one another if the virtual protocol of one intermediate driver binds to the virtual adapter of another intermediate driver.  But they do this rarely because it reduces productivity. <br><br><h5>  Protocol drivers </h5><br>  Protocol drivers are the highest level of NDIS specification.  These drivers are committed to allocating resources for the relevant packages, copying application data into packages and transferring them to lower-level drivers.  Protocol drivers also provide an interface for receiving packets from downstream drivers. <br><br>  Protocol drivers also include transport drivers that implement the network protocol stack, such as TCP / IP (tspip.sys). <br><br>  If the post will be interesting to readers, then in the following posts you can write your sniffer-like intermediate driver using the example or also describe how to write each type of driver (miniport, intermediate or protocol). <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/111592/">https://habr.com/ru/post/111592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111586/index.html">Transformation of the Vogue magazine into a home projector part 1 (careful traffic)</a></li>
<li><a href="../111587/index.html">libscgi is an effective solution for simple and fast scripts</a></li>
<li><a href="../111588/index.html">Python-way. Bug work</a></li>
<li><a href="../111589/index.html">The use of evolutionary strategies to identify the parameters of fuzzy systems</a></li>
<li><a href="../111590/index.html">Patent from Amazon: Down with nasty gifts</a></li>
<li><a href="../111593/index.html">New version of the robot LittleDog from DARPA</a></li>
<li><a href="../111595/index.html">FIXber - software testing services market</a></li>
<li><a href="../111596/index.html">Facebook Hacker Cup</a></li>
<li><a href="../111597/index.html">How to choose customers</a></li>
<li><a href="../111598/index.html">MySpace will fire more than half of its employees.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>