<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Profiling and debugging Python tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, we learned in practice, where and in what cases you can use manual profiling, as well as met with statistical profilers. 

 T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Profiling and debugging Python tools</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="http://habrahabr.ru/company/mailru/blog/201778/">previous article,</a> we learned in practice, where and in what cases you can use manual profiling, as well as met with statistical profilers. <br><br>  Today we will get acquainted with the main and most numerous group of tools - event profilers. <br><br><a name="habracut"></a><br><ul><li>  <a href="http://habrahabr.ru/company/mailru/blog/201594/">Introduction and theory</a> - why do you need profiling, different approaches, tools and differences between them? </li><li>  <a href="http://habrahabr.ru/company/mailru/blog/201778/">Manual and statistical profiling</a> - go to practice </li><li>  <strong>Event Profiling</strong> - tools and their use </li><li>  <a href="http://habrahabr.ru/company/mailru/blog/205426/">Debugging</a> - what to do when nothing works </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Task for training </h2><br>  In the last article we analyzed <a href="http://projecteuler.net/problem%3D3">problem 3</a> from <a href="http://projecteuler.net/">the Euler Project</a> .  For a change, let's take some other example, for example, <a href="http://projecteuler.net/problem%3D7">task 7</a> from the same collection of tasks: <br><blockquote>  Writing out the first six prime numbers, we get 2, 3, 5, 7, 11, and 13. Obviously, the 6th prime is 13. <br>  What is the 10001st prime number? </blockquote><br>  Write the code: <br><pre><code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Project Euler problem 7 solve"""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> print_function <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Checks if num is prime number"""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">2</span></span>, int(math.sqrt(num)) + <span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_prime_numbers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Get 'count' prime numbers"""</span></span> prime_numbers = [<span class="hljs-number"><span class="hljs-number">2</span></span>] next_number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(prime_numbers) &lt; count: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_prime(next_number): prime_numbers.append(next_number) next_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prime_numbers <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: count = int(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> (TypeError, ValueError, IndexError): sys.exit(<span class="hljs-string"><span class="hljs-string">"Usage: euler_7.py number"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> count &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">"Error: number must be greater than zero"</span></span>) prime_numbers = get_prime_numbers(count) print(<span class="hljs-string"><span class="hljs-string">"Answer: %d"</span></span> % prime_numbers[<span class="hljs-number"><span class="hljs-number">-1</span></span>])</code> </pre> <br>  Remember that the code is not perfect, and many things can be done easier, better, faster.  This is the purpose of this article =) <br><br>  In the last article I was <a href="http://habrahabr.ru/company/mailru/blog/201778/">embarrassed</a> and did not do the most important thing: tests.  In fact, breaking a program in the process of refactoring or optimizing is easier than ever, and each cycle of profiling and rewriting the code must necessarily be accompanied by testing functionality (both directly affected by changes and everything else, because side effects are side effects).  Let's try to fix it and add tests to our program.  The easiest and most suitable option for such a simple script is to use the <a href="http://docs.python.org/2/library/doctest.html">doctest</a> module.  Add tests and run them: <br><div class="spoiler">  <b class="spoiler_title">Tests</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Project Euler problem 7 solve"""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> print_function <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Checks if num is prime number. &gt;&gt;&gt; is_prime(2) True &gt;&gt;&gt; is_prime(3) True &gt;&gt;&gt; is_prime(4) False &gt;&gt;&gt; is_prime(5) True &gt;&gt;&gt; is_prime(41) True &gt;&gt;&gt; is_prime(42) False &gt;&gt;&gt; is_prime(43) True """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">2</span></span>, int(math.sqrt(num)) + <span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_prime_numbers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Get 'count' prime numbers. &gt;&gt;&gt; get_prime_numbers(1) [2] &gt;&gt;&gt; get_prime_numbers(2) [2, 3] &gt;&gt;&gt; get_prime_numbers(3) [2, 3, 5] &gt;&gt;&gt; get_prime_numbers(6) [2, 3, 5, 7, 11, 13] &gt;&gt;&gt; get_prime_numbers(9) [2, 3, 5, 7, 11, 13, 17, 19, 23] &gt;&gt;&gt; get_prime_numbers(19) [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67] """</span></span> prime_numbers = [<span class="hljs-number"><span class="hljs-number">2</span></span>] next_number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(prime_numbers) &lt; count: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_prime(next_number): prime_numbers.append(next_number) next_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prime_numbers <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: count = int(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> (TypeError, ValueError, IndexError): sys.exit(<span class="hljs-string"><span class="hljs-string">"Usage: euler_7.py number"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> count &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">"Error: number must be greater than zero"</span></span>) prime_numbers = get_prime_numbers(count) print(<span class="hljs-string"><span class="hljs-string">"Answer: %d"</span></span> % prime_numbers[<span class="hljs-number"><span class="hljs-number">-1</span></span>])</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Test run and result</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">‚ûú python -m doctest -v euler_7.py Trying: get_prime_numbers(<span class="hljs-number"><span class="hljs-number">1</span></span>) Expecting: [<span class="hljs-number"><span class="hljs-number">2</span></span>] ok Trying: get_prime_numbers(<span class="hljs-number"><span class="hljs-number">2</span></span>) Expecting: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] ok Trying: get_prime_numbers(<span class="hljs-number"><span class="hljs-number">3</span></span>) Expecting: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>] ok Trying: get_prime_numbers(<span class="hljs-number"><span class="hljs-number">6</span></span>) Expecting: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>] ok Trying: get_prime_numbers(<span class="hljs-number"><span class="hljs-number">9</span></span>) Expecting: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>] ok Trying: get_prime_numbers(<span class="hljs-number"><span class="hljs-number">19</span></span>) Expecting: [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">37</span></span>, <span class="hljs-number"><span class="hljs-number">41</span></span>, <span class="hljs-number"><span class="hljs-number">43</span></span>, <span class="hljs-number"><span class="hljs-number">47</span></span>, <span class="hljs-number"><span class="hljs-number">53</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>, <span class="hljs-number"><span class="hljs-number">61</span></span>, <span class="hljs-number"><span class="hljs-number">67</span></span>] ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">2</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">3</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">4</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">5</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">41</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">42</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ok Trying: is_prime(<span class="hljs-number"><span class="hljs-number">43</span></span>) Expecting: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ok <span class="hljs-number"><span class="hljs-number">1</span></span> items had <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> tests: euler_7 <span class="hljs-number"><span class="hljs-number">2</span></span> items passed <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> tests: <span class="hljs-number"><span class="hljs-number">6</span></span> tests <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> euler_7.get_prime_numbers <span class="hljs-number"><span class="hljs-number">7</span></span> tests <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> euler_7.is_prime <span class="hljs-number"><span class="hljs-number">13</span></span> tests <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> items. <span class="hljs-number"><span class="hljs-number">13</span></span> passed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> failed. Test passed.</code> </pre></div></div><br><br>  Let's see how fast we got the code: <br><pre> <code class="hljs pgsql">‚ûú python -m timeit -n <span class="hljs-number"><span class="hljs-number">10</span></span> -s<span class="hljs-string"><span class="hljs-string">'import euler_7'</span></span> <span class="hljs-string"><span class="hljs-string">'euler_7.get_prime_numbers(10001)'</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> loops, best <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-number"><span class="hljs-number">1.27</span></span> sec per <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span></code> </pre><br>  Yes, not fast, there is something to optimize =) <br><br><h2>  Instruments </h2><br>  The standard Python libraries are amazing.  In them, it seems, there is everything that a developer may need, and profilers are no exception.  In fact, there are three of them out of the box: <br><ul><li>  <strong>cProfile</strong> is a relatively new (since version 2.5) module written in C and therefore fast </li><li>  <strong>profile</strong> - native implementation of the profiler (written in pure python), slow, and therefore not recommended for use </li><li>  <strong>hotshot</strong> - experimental module on C, very fast, but no longer supported and can be removed from standard libraries at any time. </li></ul><br><br><h3>  cProfile </h3><br>  What talk about python profiling goes without a description of <a href="http://docs.python.org/2/library/profile.html">cProfile</a> - one of the standard Python modules? <br>  I‚Äôm sure every Python programmer ever tried to run cProfile: <br><pre> <code class="hljs pgsql">‚ûú python -m cProfile -s <span class="hljs-type"><span class="hljs-type">time</span></span> euler_7.py <span class="hljs-number"><span class="hljs-number">10001</span></span> <span class="hljs-number"><span class="hljs-number">428978</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> calls <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1.552</span></span> seconds Ordered <span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: <span class="hljs-type"><span class="hljs-type">internal</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span> ncalls tottime percall cumtime percall filename:lineno(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>) <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.955</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">1.361</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">7</span></span>(is_prime) <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.367</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.367</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {range} <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.162</span></span> <span class="hljs-number"><span class="hljs-number">0.162</span></span> <span class="hljs-number"><span class="hljs-number">1.550</span></span> <span class="hljs-number"><span class="hljs-number">1.550</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">32</span></span>(get_prime_numbers) <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.039</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.039</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {math.sqrt} <span class="hljs-number"><span class="hljs-number">104742</span></span> <span class="hljs-number"><span class="hljs-number">0.024</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.024</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {len} <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">0.003</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.003</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'append'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">'list'</span></span> objects} <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-number"><span class="hljs-number">1.552</span></span> <span class="hljs-number"><span class="hljs-number">1.552</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">1</span></span>(&lt;module&gt;) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {print} <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> __future__.py:<span class="hljs-number"><span class="hljs-number">48</span></span>(&lt;module&gt;) <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> __future__.py:<span class="hljs-number"><span class="hljs-number">75</span></span>(__init__) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> __future__.py:<span class="hljs-number"><span class="hljs-number">74</span></span>(_Feature) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'disable'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">'_lsprof.Profiler'</span></span> objects}</code> </pre><br>  <i>Immediately notice the difference in program execution time: without profiler: 1.27 seconds, with profiler: 1.55 seconds, that is, 20% slower in our particular case.</i>  <i>And this is a very good result!</i> <br><br>  So, we see that the longest (in total time) operation is the <strong>is_prime</strong> function.  Almost all the time the program spends in this function.  The next most serious call is the <strong>range</strong> function, which is called from the is_prime function.  We read the <a href="http://docs.python.org/2/library/functions.html">documentation</a> and understand that when you call range, a list is created in memory with all the numbers in the specified range.  Taking into account the fact that the range function is called 104741 times, and the upper limit of the range is incremented with each call (iterating over numbers), it can be concluded that the list created by the range function reaches hundreds of thousands of elements by the end of the program and the list is more than one hundred thousand time.  Having read the <a href="https://wiki.python.org/moin/ForLoop">documentation,</a> we learn that we should use the <strong>xrange</strong> function in this cycle (an attentive reader should feel the sarcasm in this place, because any Pythonist knows about range VS xrange).  The advantage of replacing range with xrange will also be an obvious saving of memory (we will check this theory later).  Replace, run tests: everything is OK, run profiler: <br><pre> <code class="hljs pgsql">‚ûú python -m cProfile -s <span class="hljs-type"><span class="hljs-type">time</span></span> euler_7.py <span class="hljs-number"><span class="hljs-number">10001</span></span> <span class="hljs-number"><span class="hljs-number">324237</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> calls <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1.010</span></span> seconds Ordered <span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: <span class="hljs-type"><span class="hljs-type">internal</span></span> <span class="hljs-type"><span class="hljs-type">time</span></span> ncalls tottime percall cumtime percall filename:lineno(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>) <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.825</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.857</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">7</span></span>(is_prime) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.127</span></span> <span class="hljs-number"><span class="hljs-number">0.127</span></span> <span class="hljs-number"><span class="hljs-number">1.009</span></span> <span class="hljs-number"><span class="hljs-number">1.009</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">32</span></span>(get_prime_numbers) <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.032</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.032</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {math.sqrt} <span class="hljs-number"><span class="hljs-number">104742</span></span> <span class="hljs-number"><span class="hljs-number">0.022</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.022</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {len} <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">0.003</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.003</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'append'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">'list'</span></span> objects} <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-number"><span class="hljs-number">0.001</span></span> <span class="hljs-number"><span class="hljs-number">1.010</span></span> <span class="hljs-number"><span class="hljs-number">1.010</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">1</span></span>(&lt;module&gt;) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {print} <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> __future__.py:<span class="hljs-number"><span class="hljs-number">48</span></span>(&lt;module&gt;) <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> __future__.py:<span class="hljs-number"><span class="hljs-number">75</span></span>(__init__) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> __future__.py:<span class="hljs-number"><span class="hljs-number">74</span></span>(_Feature) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'disable'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">'_lsprof.Profiler'</span></span> objects}</code> </pre><br>  1.010 seconds instead of 1.552, that is, one and a half times faster!  Fine.  Now the bottleneck in the program is the <strong>is_prime</strong> function itself.  We optimize it later using other tools. <br><br>  It is not always convenient to display profiling results in the console; it is much more convenient to save them to a file for further analysis.  To do this, you can use the key "-o": <br><pre> <code class="hljs css">‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">python</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-m</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cProfile</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-o</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">euler_7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.prof</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">euler_7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> 10001 ‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">ls</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">euler_7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.prof</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">euler_7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span></code> </pre><br>  or you can use the simplest decorator: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cProfile <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Decorator for run function profile"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> profile_filename = func.__name__ + <span class="hljs-string"><span class="hljs-string">'.prof'</span></span> profiler = cProfile.Profile() result = profiler.runcall(func, *args, **kwargs) profiler.dump_stats(profile_filename) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper @profile <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_prime_numbers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count)</span></span></span><span class="hljs-function">:</span></span> ...</code> </pre><br>  And then each time the foo function is called, the file with the results of profiling will be saved (‚Äúget_prime_numbers.prof‚Äù in our case). <br><br><h3>  hotshot </h3><br>  <a href="http://docs.python.org/2/library/hotshot.html">hotshot</a> is another standard Python module, currently not supported and can be removed from the standard libraries at any time.  But while it is, you can use it, because it is very fast and gives a minimum overhead when you start the program under the profiler.  Using it is very simple: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hotshot prof = hotshot.Profile(<span class="hljs-string"><span class="hljs-string">"profile_name.prof"</span></span>) prof.start() <span class="hljs-comment"><span class="hljs-comment"># your code goes here prof.stop() prof.close()</span></span></code> </pre><br>  Or in the form of a decorator: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hotshot <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Decorator for run function profile"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> profile_filename = func.__name__ + <span class="hljs-string"><span class="hljs-string">'.prof'</span></span> profiler = hotshot.Profile(profile_filename) profiler.start() result = func(*args, **kwargs) profiler.stop() profiler.close() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper @profile <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_prime_numbers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count)</span></span></span><span class="hljs-function">:</span></span> ...</code> </pre><br><br><h2>  Profiling results analysis </h2><br>  It is rare when it turns out to display the results of profiling on the screen immediately after starting the program  And there is little sense in such results: only the simplest scripts can be studied.  To view and analyze data, it is better to use the <a href="http://docs.python.org/2/library/profile.html">pstats</a> module built into Python (more convenient in combination with the excellent <a href="http://ipython.org/">iPython</a> console): <br><pre> <code class="hljs pgsql">‚ûú ipython <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pstats <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> [<span class="hljs-number"><span class="hljs-number">2</span></span>]: p = pstats.Stats(<span class="hljs-string"><span class="hljs-string">'get_prime_numbers.prof'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">In</span></span> [<span class="hljs-number"><span class="hljs-number">3</span></span>]: p.sort_stats(<span class="hljs-string"><span class="hljs-string">'calls'</span></span>).print_stats() <span class="hljs-number"><span class="hljs-number">324226</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> calls <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1.018</span></span> seconds Ordered <span class="hljs-keyword"><span class="hljs-keyword">by</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> count ncalls tottime percall cumtime percall filename:lineno(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>) <span class="hljs-number"><span class="hljs-number">104742</span></span> <span class="hljs-number"><span class="hljs-number">0.023</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.023</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {len} <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.821</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.854</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">19</span></span>(is_prime) <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">0.034</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.034</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {math.sqrt} <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">0.003</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> <span class="hljs-number"><span class="hljs-number">0.003</span></span> <span class="hljs-number"><span class="hljs-number">0.000</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">method</span></span> <span class="hljs-string"><span class="hljs-string">'append'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-string"><span class="hljs-string">'list'</span></span> objects} <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0.138</span></span> <span class="hljs-number"><span class="hljs-number">0.138</span></span> <span class="hljs-number"><span class="hljs-number">1.018</span></span> <span class="hljs-number"><span class="hljs-number">1.018</span></span> euler_7.py:<span class="hljs-number"><span class="hljs-number">44</span></span>(get_prime_numbers)</code> </pre><br>  The console, of course, is a good thing, but not very visual.  In especially difficult situations, in programs with hundreds and thousands of challenges, analysis of the results is difficult.  So people are arranged, that we (much like computers) take graphic information much easier than text information.  Various tools for analyzing profiling results come to the rescue. <br><br><h3>  kcachegrind </h3><br>  To begin, perhaps, with such a well-known tool, like <a href="http://kcachegrind.sourceforge.net/">kcachegrind</a> , which, in fact, is intended to visualize the results of the <a href="http://valgrind.org/docs/manual/cl-manual.html">Callgrind</a> utility, but after converting the results of the Python-profiler, you can open them in kcachegrind.  <a href="https://github.com/pwaller/pyprof2calltree/">Conversion</a> is performed using the <a href="https://github.com/pwaller/pyprof2calltree/">pyprof2calltree</a> utility: <br><pre> <code class="hljs css">‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">pip</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pyprof2calltree</span></span> ‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">pyprof2calltree</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-i</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">profile_results</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.prof</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-o</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">profile_results</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.kgrind</span></span></code> </pre><br>  You can immediately open the results in kcachegrind, without saving to the file: <br><pre> <code class="hljs matlab">‚ûú pyprof2calltree -<span class="hljs-built_in"><span class="hljs-built_in">i</span></span> profile_results.prof -k</code> </pre><br>  The program allows you to visually see how long a particular call takes, as well as all the calls within it.  You can also see the call tree and a bunch of other useful information.  The interface looks like this: <br><img src="http://habrastorage.org/storage3/e74/79f/99b/e7479f99be484a8ab9e08f0c931bc52b.png"><br><br><h3>  RunSnakeRun </h3><br>  Another program for visualization of the profiling results of <a href="http://www.vrplumber.com/programming/runsnakerun/">RunSnakeRun</a> was originally written to work with the profiler of python (this is evident from its name).  It is similar to kcachegrind, but, as the authors say, stands out with its simpler interface and functionality.  Installation will not cause difficulties: <br><pre> <code class="hljs sql">‚ûú brew <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> wxwidgets ‚ûú pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> SquareMap RunSnakeRun</code> </pre><br>  Use too: <br><pre> <code class="hljs css">‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">runsnake</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">profile_results</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.prof</span></span></code> </pre><br>  Similarly, we see a map of squares: the larger the area of ‚Äã‚Äãthe square, the longer it took to perform the corresponding function: <br><img src="http://habrastorage.org/storage3/d81/18a/559/d8118a55984b6459a4b2352fbc242c55.jpg"><br><br>  RunSnakeRun also allows you to visualize the result of profiling memory consumption using the <a href="https://launchpad.net/meliae">Meliae</a> utility: <br><img src="http://habrastorage.org/storage3/76a/ac5/f12/76aac5f12125c49547eb89c016ef7ae2.png"><br><br><h3>  gprof2dot </h3><br>  The <a href="https://code.google.com/p/jrfonseca/wiki/Gprof2Dot">gprof2dot</a> utility generates a picture with the function call tree and information about the time of their execution.  In most cases, this is enough to find bottlenecks in the program.  We set and generate a picture: <br><pre> <code class="hljs sql">‚ûú brew <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> graphviz ‚ûú pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> gprof2dot ‚ûú gprof2dot -f pstats profile_results.prof | dot -Tpng -o profile_results.png</code> </pre><br>  Result: <br><img src="http://habrastorage.org/storage3/d12/1e9/cd2/d121e9cd2a2ae3a8d1117c34dd5c8633.png"><br><br><h2>  Django Profiling </h2><br>  For Django profiling, it is convenient to use the <a href="https://github.com/django-extensions/django-extensions">django-extensions</a> module, which, in addition to a heap of various useful things, has a useful ‚Äúrunprofileserver‚Äù command.  Using it is easy.  We put: <br><pre> <code class="hljs sql">‚ûú pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> django-extensions</code> </pre> <br>  Add application in settings.py: <br><pre> <code class="python hljs">INSTALLED_APPS += (<span class="hljs-string"><span class="hljs-string">'django_extensions'</span></span>,)</code> </pre><br>  Run: <br><pre> <code class="hljs pgsql">‚ûú python manage.py runprofileserver <span class="hljs-comment"><span class="hljs-comment">--use-cprofile --prof-path=/tmp/prof/</span></span></code> </pre><br>  In the / tmp / prof / directory, a file will be created with the profiling results for each request to the application: <br><pre> <code class="hljs swift">‚ûú ls /tmp/prof/ admin.000276ms.<span class="hljs-number"><span class="hljs-number">1374075009</span></span>.prof admin.account.user.000278ms.<span class="hljs-number"><span class="hljs-number">1374075014</span></span>.prof admin.jsi18n.000185ms.<span class="hljs-number"><span class="hljs-number">1374075018</span></span>.prof favicon.ico.000017ms.<span class="hljs-number"><span class="hljs-number">1374075001</span></span>.prof root.000073ms.<span class="hljs-number"><span class="hljs-number">1374075004</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.admin.css.base.css.000011ms.<span class="hljs-number"><span class="hljs-number">1374075010</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.admin.css.forms.css.000013ms.<span class="hljs-number"><span class="hljs-number">1374075017</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.admin.img.icon-yes.gif.000001ms.<span class="hljs-number"><span class="hljs-number">1374075015</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.admin.img.sorting-icons.gif.000001ms.<span class="hljs-number"><span class="hljs-number">1374075015</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.admin.js.core.js.000018ms.<span class="hljs-number"><span class="hljs-number">1374075014</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.admin.js.jquery.js.000003ms.<span class="hljs-number"><span class="hljs-number">1374075014</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.css.bootstrap-<span class="hljs-number"><span class="hljs-number">2.3</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>.css.000061ms.<span class="hljs-number"><span class="hljs-number">1374074996</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.img.glyphicons-halflings.png.000001ms.<span class="hljs-number"><span class="hljs-number">1374075005</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.js.bootstrap-<span class="hljs-number"><span class="hljs-number">2.3</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>.js.000004ms.<span class="hljs-number"><span class="hljs-number">1374074996</span></span>.prof <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>.js.jquery-<span class="hljs-number"><span class="hljs-number">2.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>.js.000001ms.<span class="hljs-number"><span class="hljs-number">1374074996</span></span>.prof user.login.000187ms.<span class="hljs-number"><span class="hljs-number">1374075001</span></span>.prof</code> </pre><br>  Further analysis can be performed using any of the tools listed above: pstats, kcachegrind, RunSnakeRun or gprof2dot.  Or any other =) <br><br>  In addition to the profiler built into Python, there are also a lot of third-party programs, simple and complex, not very useful. <br><br><h2>  pycallgraph </h2><br>  <a href="https://github.com/gak/pycallgraph/">pycallgraph</a> allows <a href="https://github.com/gak/pycallgraph/">you</a> to build a Python call tree.  We put: <br><pre> <code class="hljs sql">‚ûú brew <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> graphviz ‚ûú pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> pycallgraph</code> </pre><br>  Run and see the result: <br><pre> <code class="hljs css">‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">pycallgraph</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">graphviz</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">euler_7</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> 10001 ‚ûú <span class="hljs-selector-tag"><span class="hljs-selector-tag">open</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pycallgraph</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.png</span></span></code> </pre><br><img src="http://habrastorage.org/storage3/5f6/57a/ac4/5f657aac48a325ae6e02631665b50f3a.png"><br><br><h2>  line_profiler </h2><br>  <a href="https://bitbucket.org/robertkern/line_profiler">line_profiler</a> , as its name implies, allows you to line up the necessary sections of code line by line.  We put: <br><pre> <code class="hljs sql">‚ûú pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> line_profiler</code> </pre><br>  Add the ‚Äúprofile‚Äù decorator to the right places (I temporarily removed the dockstrings for a more compact display of the results): <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@profile def is_prime(num): for i in xrange(2, int(math.sqrt(num)) + 1): if num % i == 0: return False return True @profile def get_prime_numbers(count): prime_numbers = [2] next_number = 3 while len(prime_numbers) &lt; count: if is_prime(next_number): prime_numbers.append(next_number) next_number += 1 return prime_numbers</span></span></code> </pre><br>  We start profiling: <br><pre> <code class="hljs pgsql">‚ûú kernprof.py -v -l euler_7.py <span class="hljs-number"><span class="hljs-number">10001</span></span> Wrote profile results <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> euler_7.py.lprof Timer unit: <span class="hljs-number"><span class="hljs-number">1e-06</span></span> s File: euler_7.py <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>: is_prime at <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> Total <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">10.7963</span></span> s <span class="hljs-type"><span class="hljs-type">Line</span></span> # Hits <span class="hljs-type"><span class="hljs-type">Time</span></span> Per Hit % <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-type"><span class="hljs-type">Line</span></span> Contents ============================================================== <span class="hljs-number"><span class="hljs-number">7</span></span> @profile <span class="hljs-number"><span class="hljs-number">8</span></span> def is_prime(num): <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">2935963</span></span> <span class="hljs-number"><span class="hljs-number">5187211</span></span> <span class="hljs-number"><span class="hljs-number">1.8</span></span> <span class="hljs-number"><span class="hljs-number">48.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> xrange(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-type"><span class="hljs-type">int</span></span>(math.sqrt(num)) + <span class="hljs-number"><span class="hljs-number">1</span></span>): <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">2925963</span></span> <span class="hljs-number"><span class="hljs-number">5421919</span></span> <span class="hljs-number"><span class="hljs-number">1.9</span></span> <span class="hljs-number"><span class="hljs-number">50.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">94741</span></span> <span class="hljs-number"><span class="hljs-number">169309</span></span> <span class="hljs-number"><span class="hljs-number">1.8</span></span> <span class="hljs-number"><span class="hljs-number">1.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">17904</span></span> <span class="hljs-number"><span class="hljs-number">1.8</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> File: euler_7.py <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>: get_prime_numbers at <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> Total <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">23.263</span></span> s <span class="hljs-type"><span class="hljs-type">Line</span></span> # Hits <span class="hljs-type"><span class="hljs-type">Time</span></span> Per Hit % <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-type"><span class="hljs-type">Line</span></span> Contents ============================================================== <span class="hljs-number"><span class="hljs-number">15</span></span> @profile <span class="hljs-number"><span class="hljs-number">16</span></span> def get_prime_numbers(count): <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">5.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> prime_numbers = [<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> next_number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">104742</span></span> <span class="hljs-number"><span class="hljs-number">208985</span></span> <span class="hljs-number"><span class="hljs-number">2.0</span></span> <span class="hljs-number"><span class="hljs-number">0.9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(prime_numbers) &lt; count: <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">22843717</span></span> <span class="hljs-number"><span class="hljs-number">218.1</span></span> <span class="hljs-number"><span class="hljs-number">98.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_prime(next_number): <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">22405</span></span> <span class="hljs-number"><span class="hljs-number">2.2</span></span> <span class="hljs-number"><span class="hljs-number">0.1</span></span> prime_numbers.append(next_number) <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">187927</span></span> <span class="hljs-number"><span class="hljs-number">1.8</span></span> <span class="hljs-number"><span class="hljs-number">0.8</span></span> next_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prime_numbers</code> </pre><br>  <i>Immediately, we notice a huge overhead projector: the program has been running for more than 30 seconds, despite the fact that without a profiler, it performs faster in less than a second.</i> <br><br>  Analyzing the results we can conclude that the program spends the most time in lines 9 and 10, checking the number divisors to determine its ‚Äúsimplicity‚Äù.  And for each subsequent number all the same checks take place.  Logical optimization of the program is to check as divisors only those numbers that were previously defined as simple: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_prime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num, prime_numbers)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Checks if num is prime number. &gt;&gt;&gt; is_prime(2, []) True &gt;&gt;&gt; is_prime(3, [2]) True &gt;&gt;&gt; is_prime(4, [2, 3]) False &gt;&gt;&gt; is_prime(5, [2, 3]) True &gt;&gt;&gt; is_prime(41, [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37]) True &gt;&gt;&gt; is_prime(42, [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41]) False &gt;&gt;&gt; is_prime(43, [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41]) True """</span></span> limit = int(math.sqrt(num)) + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prime_numbers: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &gt; limit: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_prime_numbers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Get 'count' prime numbers. &gt;&gt;&gt; get_prime_numbers(1) [2] &gt;&gt;&gt; get_prime_numbers(2) [2, 3] &gt;&gt;&gt; get_prime_numbers(3) [2, 3, 5] &gt;&gt;&gt; get_prime_numbers(6) [2, 3, 5, 7, 11, 13] &gt;&gt;&gt; get_prime_numbers(9) [2, 3, 5, 7, 11, 13, 17, 19, 23] &gt;&gt;&gt; get_prime_numbers(19) [2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67] """</span></span> prime_numbers = [<span class="hljs-number"><span class="hljs-number">2</span></span>] next_number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(prime_numbers) &lt; count: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_prime(next_number, prime_numbers): prime_numbers.append(next_number) next_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prime_numbers</code> </pre><br>  We run the tests, we make sure that everything works out correctly, we measure the program execution time: <br><pre> <code class="hljs pgsql">‚ûú python -m timeit -n <span class="hljs-number"><span class="hljs-number">10</span></span> -s<span class="hljs-string"><span class="hljs-string">'import euler_7'</span></span> <span class="hljs-string"><span class="hljs-string">'euler_7.get_prime_numbers(10001)'</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> loops, best <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-number"><span class="hljs-number">390</span></span> msec per <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span></code> </pre><br>  We accelerated the work almost three times, not bad.  Run the profiling one more time: <br><pre> <code class="hljs pgsql">‚ûú kernprof.py -v -l euler_7.py <span class="hljs-number"><span class="hljs-number">10001</span></span> Wrote profile results <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> euler_7.py.lprof Timer unit: <span class="hljs-number"><span class="hljs-number">1e-06</span></span> s File: euler_7.py <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>: is_prime at <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> Total <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">4.54317</span></span> s <span class="hljs-type"><span class="hljs-type">Line</span></span> # Hits <span class="hljs-type"><span class="hljs-type">Time</span></span> Per Hit % <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-type"><span class="hljs-type">Line</span></span> Contents ============================================================== <span class="hljs-number"><span class="hljs-number">7</span></span> @profile <span class="hljs-number"><span class="hljs-number">8</span></span> def is_prime(num, prime_numbers): <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">310160</span></span> <span class="hljs-number"><span class="hljs-number">3.0</span></span> <span class="hljs-number"><span class="hljs-number">6.8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> = <span class="hljs-type"><span class="hljs-type">int</span></span>(math.sqrt(num)) + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">800694</span></span> <span class="hljs-number"><span class="hljs-number">1296045</span></span> <span class="hljs-number"><span class="hljs-number">1.6</span></span> <span class="hljs-number"><span class="hljs-number">28.5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prime_numbers: <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">800692</span></span> <span class="hljs-number"><span class="hljs-number">1327770</span></span> <span class="hljs-number"><span class="hljs-number">1.7</span></span> <span class="hljs-number"><span class="hljs-number">29.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &gt; <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">9998</span></span> <span class="hljs-number"><span class="hljs-number">17109</span></span> <span class="hljs-number"><span class="hljs-number">1.7</span></span> <span class="hljs-number"><span class="hljs-number">0.4</span></span> break <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">790694</span></span> <span class="hljs-number"><span class="hljs-number">1409731</span></span> <span class="hljs-number"><span class="hljs-number">1.8</span></span> <span class="hljs-number"><span class="hljs-number">31.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">94741</span></span> <span class="hljs-number"><span class="hljs-number">165761</span></span> <span class="hljs-number"><span class="hljs-number">1.7</span></span> <span class="hljs-number"><span class="hljs-number">3.6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">16599</span></span> <span class="hljs-number"><span class="hljs-number">1.7</span></span> <span class="hljs-number"><span class="hljs-number">0.4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> File: euler_7.py <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>: get_prime_numbers at <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span> Total <span class="hljs-type"><span class="hljs-type">time</span></span>: <span class="hljs-number"><span class="hljs-number">10.5464</span></span> s <span class="hljs-type"><span class="hljs-type">Line</span></span> # Hits <span class="hljs-type"><span class="hljs-type">Time</span></span> Per Hit % <span class="hljs-type"><span class="hljs-type">Time</span></span> <span class="hljs-type"><span class="hljs-type">Line</span></span> Contents ============================================================== <span class="hljs-number"><span class="hljs-number">18</span></span> @profile <span class="hljs-number"><span class="hljs-number">19</span></span> def get_prime_numbers(count): <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> prime_numbers = [<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> next_number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">104742</span></span> <span class="hljs-number"><span class="hljs-number">202443</span></span> <span class="hljs-number"><span class="hljs-number">1.9</span></span> <span class="hljs-number"><span class="hljs-number">1.9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(prime_numbers) &lt; count: <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">10143489</span></span> <span class="hljs-number"><span class="hljs-number">96.8</span></span> <span class="hljs-number"><span class="hljs-number">96.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_prime(next_number, prime_numbers): <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">10000</span></span> <span class="hljs-number"><span class="hljs-number">22374</span></span> <span class="hljs-number"><span class="hljs-number">2.2</span></span> <span class="hljs-number"><span class="hljs-number">0.2</span></span> prime_numbers.append(next_number) <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">104741</span></span> <span class="hljs-number"><span class="hljs-number">178074</span></span> <span class="hljs-number"><span class="hljs-number">1.7</span></span> <span class="hljs-number"><span class="hljs-number">1.7</span></span> next_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prime_numbers</code> </pre><br>  As you can see, the program began to run much faster. <br><br><h2>  memory_profiler </h2><br>  For memory profiling, you can use <a href="https://github.com/fabianp/memory_profiler">memory_profiler</a> .  Using it is as easy as line_profiler.  We put: <br><pre> <code class="hljs sql">‚ûú pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> psutil memory_profiler</code> </pre><br>  Run: <br><pre> <code class="hljs pgsql">‚ûú python -m memory_profiler euler_7.py <span class="hljs-number"><span class="hljs-number">10001</span></span> Filename: euler_7.py <span class="hljs-type"><span class="hljs-type">Line</span></span> # Mem <span class="hljs-keyword"><span class="hljs-keyword">usage</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Increment</span></span> Line Contents ================================================ <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">8.441</span></span> MiB <span class="hljs-number"><span class="hljs-number">-0.531</span></span> MiB @profile <span class="hljs-number"><span class="hljs-number">19</span></span> def get_prime_numbers(count): <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">8.445</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.004</span></span> MiB prime_numbers = [<span class="hljs-number"><span class="hljs-number">2</span></span>] <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">8.445</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB next_number = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.527</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> len(prime_numbers) &lt; count: <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_prime(next_number, prime_numbers): <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB prime_numbers.append(next_number) <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB next_number += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prime_numbers Filename: euler_7.py <span class="hljs-type"><span class="hljs-type">Line</span></span> # Mem <span class="hljs-keyword"><span class="hljs-keyword">usage</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Increment</span></span> Line Contents ================================================ <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB @profile <span class="hljs-number"><span class="hljs-number">8</span></span> def is_prime(num, prime_numbers): <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> = <span class="hljs-type"><span class="hljs-type">int</span></span>(math.sqrt(num)) + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prime_numbers: <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> i &gt; <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span>: <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB break <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> num % i == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">8.973</span></span> MiB <span class="hljs-number"><span class="hljs-number">0.000</span></span> MiB <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  As you can see, we have no special problems with memory.  Everything is within normal limits. <br><br><h2>  More tools </h2><br>  I will list a few more tools for profiling, unfortunately, the article turned out to be huge and it is not possible to disassemble all of them. <br><ul><li>  <a href="http://www.aminus.net/wiki/Dowser">Dowser</a> is an excellent memory profiling tool. </li><li>  <a href="http://guppy-pe.sourceforge.net/">guppy</a> is another memory profiling program. </li><li>  <a href="https://launchpad.net/meliae">Meliae</a> is a memory profiling tool mentioned earlier that can be used with RunSnakeRun </li><li>  <a href="http://pythonhosted.org/Pympler/muppy.html">muppy</a> - memory leak detection </li><li>  <a href="http://jmdana.github.io/memprof/">memprof</a> - again memory profiling </li><li>  <a href="http://mg.pov.lt/objgraph/">objgraph</a> - an interesting tool for the study of objects </li></ul><br><br>  We learned about tools for profiling Python code.  A lot of them are left behind the scenes, I hope my colleagues will complement me in the comments. <br><br>  In the next article, we will introduce methods and tools for debugging Python programs.  Stay in touch! <br><br>  <i>Minute of statistics: in three articles about python profiling I used the word ‚Äúprofiling‚Äù more than a hundred times.</i> </div><p>Source: <a href="https://habr.com/ru/post/202832/">https://habr.com/ru/post/202832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202818/index.html">Podcasts Devops Deflope - Issue 003</a></li>
<li><a href="../202820/index.html">Cache-Conscious Binary Search</a></li>
<li><a href="../202822/index.html">DES to J in a hundred lines</a></li>
<li><a href="../202824/index.html">E-commerce in Universal Analytics</a></li>
<li><a href="../202830/index.html">Flying robotaksi easier to do than unmanned vehicles</a></li>
<li><a href="../202836/index.html">Say a word about organic photovoltaics. Part 2</a></li>
<li><a href="../202838/index.html">NX-ecosystem, optics, 2.1</a></li>
<li><a href="../202840/index.html">Minecraft in C # (19 lines of code)</a></li>
<li><a href="../202842/index.html">Navigation in Django templates</a></li>
<li><a href="../202844/index.html">CSS Slideshow (Sass)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>