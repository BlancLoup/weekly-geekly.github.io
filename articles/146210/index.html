<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt Designer & Runtime Qt library on the service of OpenCV developer, or dragging IplImage on QLabel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Like most Qt developers using the OpenCV library, I was interested in the topic of presenting an image obtained from a webcam as a comp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt Designer & Runtime Qt library on the service of OpenCV developer, or dragging IplImage on QLabel</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Like most Qt developers using the OpenCV library, I was interested in the topic of presenting an image obtained from a webcam as a component of the visual interface design for Qt Designer. <br>  Breaking a bunch of information online, noticed that most articles are repeating each other, and finding the "highlight" is too difficult.  I think my experience of creating a visual component on the representation of the OpenCV library image for Qt Designer will be useful.  In addition, I will share information on how to separate libraries of design design time and code execution time.  This approach has very successfully established itself in RAD Delphi for Windows operating systems. <br><br><h5>  <i>Remarks</i> </h5><br><ul><li>  The author <a href="https://habrahabr.ru/users/coffeesmoke/" class="user_link">coffeesmoke</a> does not "chew" simple truths, methods and subtleties.  The code is clear.  Functions do not exceed 20 lines. </li><li>  The project and example of use is implemented on Qt Creator for Linux OS.  Windows developers should set the settings in <b>.pro</b> files according to their OS. </li><li>  The author does not go into discussions like "and it would be better."  Found the best solution, implement. </li><li>  The author does not respond to Qt Creator and / or Qt Designer settings.  Search engines to help you! </li><li>  Fasting is informative in nature and serves to designate the direction of movement of your thoughts.  Where they go, you know better. </li></ul><br><br><h4>  Design and Execution </h4><br><h5>  Performance </h5><br>  Let's leave for a while the OpenCV image library.  Our task is a universal runtime library (code execution time library). <br>  Perhaps what I show now is used everywhere.  However, I did not meet on the network open spaces on the subject of building plugins for Qt Designer of a similar approach. <br>  The task is not to ‚Äúdrag‚Äù the Qt Designera plugin library into the project, but to get along with the runtime library.  Obviously, the runtime library can be ‚Äúframed‚Äù by the component's widget in the Qt Dessigner palette. <br><a name="habracut"></a><br>  The designer contains a simple <b>QLabel</b> component that can transmit an image with the <b>pixmap</b> property.  For our purposes, this is enough.  Referring to the translation of documentation <a href="http://doc.crossplatform.ru/qtcreator/2.0/adding-plugins.html">Adding Qt Designer Modules</a> <a href="http://doc.crossplatform.ru/qtcreator/2.0/adding-plugins.html"><br></a>  and the most original source of information on the link <a href="http://doc.qt.nokia.com/4.7-snapshot/designer-using-custom-widgets.html">Using Custom Widgets with Qt Designer. The</a> most useful is information about the placement of custom plug-in libraries!  now we know the destination path: $$ QTDIR / plugin / designer <br>  Let's leave the wrapper of the new component to the side. Let's take a component of the runtime library directly.  Let's create a dynamically loaded library with the <strong>CQtOpenCVImage</strong> class of our new widget. <br>  <strong>Cqtopencvimage.h</strong> header file 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> QTOPENCVIMAGE_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> QTOPENCVIMAGE_H</span></span></code> </pre> <br>  <strong>#include &lt;QtDesigner / QDesignerExportWidget&gt;</strong> <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QWidget&gt; #include &lt;QUrl&gt; #include &lt;QLabel&gt; #include "opencv2/opencv.hpp" #include &lt;QScopedPointer&gt; /*----------------------------------------------------------------------------*/</span></span></span></span></code> </pre><br>  <strong>class CQtOpenCVImagePrivate;</strong> <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> #</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">defined</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QDESIGNER_EXPORT_WIDGETS</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QDESIGNER_WIDGET_EXPORT</span></span></span><span class="hljs-class"> #</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">else</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Q_DECL_EXPORT</span></span></span><span class="hljs-class"> #</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endif</span></span></span></span></code> </pre>  <strong>CQtOpenCVImage</strong> <pre> <code class="cpp hljs"> : <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QWidget { <span class="hljs-function"><span class="hljs-function">Q_OBJECT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QUrl capture READ getCapture WRITE slot_setCapture)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QString text READ getLabelText WRITE slot_setLabelText)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QPixmap pixmap READ getPixmap WRITE slot_setPixmap)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> scaledContents READ hasScaledContents WRITE slot_setScaledContents)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> grayscale READ isGrayscale WRITE slot_setGrayscale)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Q_PROPERTY</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Qt::Alignment alignment READ getAlignment WRITE setAlignment)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function">: </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CQtOpenCVImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QWidget* parent = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Qt::WindowFlags f = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~CQtOpenCVImage(); <span class="hljs-function"><span class="hljs-function">QUrl&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCapture</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLabelText</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QPixmap* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPixmap</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QImage* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImage</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; Qt::<span class="hljs-function"><span class="hljs-function">Alignment </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAlignment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAlignment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Qt::Alignment)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> QLabel* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getQLabel</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasScaledContents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isGrayscale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Q_SLOTS: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setCapture</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QUrl&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setLabelText</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QString&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setPixmap</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QPixmap&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setImage</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QImage&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setQLabel</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QLabel&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setGrayscale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">slot_setScaledContents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; Q_SIGNALS: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_Grayscale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_ImageChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_CaptureChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_PixmapChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_LabelChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_AlignmentChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: Q_DISABLE_COPY(CQtOpenCVImage) Q_DECLARE_PRIVATE(CQtOpenCVImage)</code> </pre><br>  <strong>QScopedPointer d_ptr;</strong> <strong><br><br></strong> <pre> <strong><code class="cpp hljs">}; <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// QTOPENCVIMAGE_H</span></span></span></span></code></strong> </pre> <strong><br></strong> <br>  Pay attention to the areas marked with a <strong>special font.</strong> <br><ul><li>  Including the <i>QtDesigner / QDesignerExportWidget</i> header file ensures that the necessary QDESIGNER_WIDGET_EXPORT macro is included when using directives in the project file <pre> <code class="cpp hljs">DEFINES += QDESIGNER_EXPORT_WIDGETS</code> </pre> </li><li>  The <i>CQtOpenCVImagePrivate</i> class hides internal variables and pointers from the declaration of the <strong>main CQtOpenCVImage class</strong> .  I think this is right: do not overload ads with unnecessary information; </li><li>  Declaring the only private pointer variable <pre> <code class="cpp hljs">QScopedPointer&lt;CQtOpenCVImagePrivate&gt; d_ptr;</code> </pre>  on the structure of the internal implementation of algorithms and data within the rules of Qt.  IMHO, "good tone." </li></ul><br>  Our class <i>CQtOpenCVImage</i> provides Qt Designer properties (Q_PROPERTY) for visual image control.  Property recording methods are implemented with <strong>void slot _ **** (***)</strong> slots. <br>  And so, the class of representation of an image derived from a web (IP) camera inherited from QWidget during custom design gives access to the properties: <br><ul><li>  capture - the video capture device URL or webcam number; </li><li>  text - text inscription.  Analogue of the QLabel text property; </li><li>  pixmap - a pointer to an object of type QPixmap.  Analogue properties pixmap QLabel; </li><li>  scaledContents - image scalability.  Analogue of scaledContents QLabel; </li><li>  grayscale is a Boolean switch of the color mode of the image output, where the value <i>true</i> corresponds to grayscale and <i>false</i> to color (RGB); </li><li>  alignment - alignment of text and pixmap contents.  Analogue of the alignment property QLabel; </li></ul><br><br>  I think the purpose of class methods to describe does not make sense: the name speaks for itself. <br><br>  Let us turn to the code for the implementation of classes (file cqtopencvimage.cpp <strong>).</strong> <strong><br></strong> <br>  Consider the hidden class <i>CQtOpenCVImagePrivate</i> , its attributes and methods. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CQtOpenCVImagePrivate</span></span></span><span class="hljs-class"> {</span></span> Q_DECLARE_PUBLIC(CQtOpenCVImage) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CQtOpenCVImagePrivate(CQtOpenCVImage* owner); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~CQtOpenCVImagePrivate(); CQtOpenCVImage* q_ptr; <span class="hljs-comment"><span class="hljs-comment">//      QGridLayout* f_grid_layout; //          QLabel* f_label;//   QLabel    QUrl f_capture_path;// URL      QImage* p_qt_image; //      QImage CvCapture* p_capture; //         OpenCV IplImage* p_opencv_frame; //      p_capture uint f_grayscaled:1; //       void init (); //   void close (); //     void free_qt_image (); //    p_qt_image void new_qt_image ();//     p_qt_image void free_capture (); //    p_capture void new_capture (); //     p_capture };</span></span></code> </pre><br>  Let us turn to the implementation of methods. <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImagePrivate::init () { Q_ASSERT(q_ptr); f_grid_layout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QGridLayout(q_ptr); Q_ASSERT(f_grid_layout); f_label = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QLabel(q_ptr<span class="hljs-comment"><span class="hljs-comment">/*, Qt::WindowNoState*/</span></span>); Q_ASSERT(f_label); f_grid_layout-&gt;addWidget (f_label); p_qt_image = <span class="hljs-number"><span class="hljs-number">0</span></span>, p_capture = <span class="hljs-number"><span class="hljs-number">0</span></span>, p_opencv_frame = <span class="hljs-number"><span class="hljs-number">0</span></span>, f_grayscaled = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImagePrivate::close () { free_qt_image (); free_capture (); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> CQtOpenCVImagePrivate::CQtOpenCVImagePrivate(CQtOpenCVImage* owner) : q_ptr(owner) { init (); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> CQtOpenCVImagePrivate::~CQtOpenCVImagePrivate () { close (); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(f_label-&gt;parent ())) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> f_label; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(f_grid_layout-&gt;parent ())) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> f_grid_layout; } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImagePrivate::free_qt_image () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(p_qt_image) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> p_qt_image; p_qt_image = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImagePrivate::free_capture () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(p_capture) { cvReleaseCapture(&amp;p_capture); p_capture = <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br>  The code is clear and readable.  Questions should not arise.  The <i>CQtOpenCVImage * owner</i> parameter of the constructor represents a pointer to a CQtOpenCVImage object containing an instance of the hidden class as the variable CQtOpenCVImage :: d_ptr. <br>  As the doctor said, the hero Leonid Bronevoy, from the film ‚ÄúFormula of Love‚Äù, - ‚ÄúSo, I will continue ...‚Äù. <br><br>  Consider the definition of a capture device using the <i>new_capture</i> method <i>.</i> <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImagePrivate::new_capture () { free_capture ();<span class="hljs-comment"><span class="hljs-comment">//   bool b_ok; int i_index = f_capture_path.toString ().toInt (&amp;b_ok); //   ,   ,   URL /*   :  ,     CGI  ,     if(b_ok) { p_capture = cvCreateCameraCapture(i_index); if(p_capture) if(!p_opencv_frame) p_opencv_frame = cvQueryFrame (p_capture); } else { while((p_capture =cvCaptureFromFile(f_capture_path.toString ().toStdString ().c_str ()))) { p_opencv_frame = cvQueryFrame (p_capture); new_qt_image (); cvWaitKey (1000); } } */ // ,  ,  .     OpenCV. p_capture = b_ok ? cvCreateCameraCapture(i_index) : cvCaptureFromFile(f_capture_path.toString ().toStdString ().c_str ()); p_opencv_frame = p_capture ? cvQueryFrame (p_capture) : 0; //     OpenCV new_qt_image (); //   QImage }</span></span></code> </pre><br>  For a detailed introduction to OpenCV, read the <a href="http://locv.ru/wiki/%25D0%259E%25D0%25B3%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">Table of Contents.</a> <br><br>  Image formation type QImage: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImagePrivate::new_qt_image () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!p_capture) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; free_qt_image (); <span class="hljs-comment"><span class="hljs-comment">//     if(p_opencv_frame) { //  OpenCV       IplImage *_tmp = f_grayscaled ? cvCreateImage( cvSize( p_opencv_frame-&gt;width, p_opencv_frame-&gt;height ), IPL_DEPTH_8U, 1 ) : cvCloneImage (p_opencv_frame) ; try { //    RGB    cvCvtColor( p_opencv_frame, _tmp, f_grayscaled ? CV_RGB2GRAY : CV_BGR2RGB ); //    QImage p_qt_image = new QImage( (const uchar*)(_tmp-&gt;imageData), _tmp-&gt;width, _tmp-&gt;height, _tmp-&gt;widthStep, (f_grayscaled ? QImage::Format_Indexed8 : QImage::Format_RGB888) ); emit q_ptr-&gt;signal_ImageChanged (); //    q_ptr-&gt;slot_setPixmap (QPixmap::fromImage (*p_qt_image)); //    QLabel } catch(...) { // ...  --  ,  ! close (); } //     ! cvReleaseImage(&amp;_tmp); } }</span></span></code> </pre><br><br><br>  I think everything is clear with the underwater part of the iceberg. <br><br>  Implementing the main class is even easier.  Even too lazy to explain.  See for yourself: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> CQtOpenCVImage::CQtOpenCVImage(QWidget* parent, Qt::WindowFlags f) : QWidget(parent, f), d_ptr(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CQtOpenCVImagePrivate(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) { } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> CQtOpenCVImage::~CQtOpenCVImage() { } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> QUrl&amp; CQtOpenCVImage::getCapture () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (d_func ()-&gt;f_capture_path); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> QString CQtOpenCVImage::getLabelText () <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (d_func ()-&gt;f_label-&gt;text ()); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CQtOpenCVImage::hasScaledContents() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d_func ()-&gt;f_label-&gt;hasScaledContents (); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImage::slot_setScaledContents(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value ) { d_func ()-&gt;f_label-&gt;setScaledContents (Value); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CQtOpenCVImage::isGrayscale() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d_func ()-&gt;f_grayscaled; } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImage::slot_setGrayscale( <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Value ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(d_func ()-&gt;f_grayscaled != Value) { d_func ()-&gt;f_grayscaled = Value; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!(d_func ()-&gt;p_capture)) d_func ()-&gt;new_capture (); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> d_func ()-&gt;new_qt_image (); <span class="hljs-function"><span class="hljs-function">emit </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">signal_Grayscale</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(d_func ()-&gt;f_grayscaled)</span></span></span></span>; } } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImage::slot_setLabelText ( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QString&amp; Value ) { d_func ()-&gt;f_label-&gt;setText (Value); } <span class="hljs-comment"><span class="hljs-comment">/*----------------------------------------------------------------------------*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CQtOpenCVImage::slot_setCapture ( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> QUrl&amp; Value ) { <span class="hljs-comment"><span class="hljs-comment">//       // if(getCapture ().toString () != Value.toString () || !d_func ()-&gt;p_opencv_frame) // { d_func ()-&gt;f_capture_path = Value.toString ().trimmed (); d_func ()-&gt;new_capture (); emit signal_CaptureChanged (); // } } /*----------------------------------------------------------------------------*/ const QPixmap* CQtOpenCVImage::getPixmap () const { return ((const QPixmap*)(d_func ()-&gt;f_label-&gt;pixmap ())); } /*----------------------------------------------------------------------------*/ void CQtOpenCVImage::slot_setPixmap ( const QPixmap&amp; Value ) { d_func ()-&gt;f_label-&gt;setPixmap (Value); emit signal_PixmapChanged (); } /*----------------------------------------------------------------------------*/ const QImage* CQtOpenCVImage::getImage () const { return(d_func ()-&gt;p_qt_image); } /*----------------------------------------------------------------------------*/ void CQtOpenCVImage::slot_setImage ( const QImage&amp; Value ) { d_func ()-&gt;free_qt_image (); d_func ()-&gt;p_qt_image = new QImage(Value); slot_setPixmap (QPixmap::fromImage (*(d_func ()-&gt;p_qt_image))); emit signal_ImageChanged (); } /*----------------------------------------------------------------------------*/ void CQtOpenCVImage::slot_setQLabel ( const QLabel&amp; Value) { d_func ()-&gt;f_label-&gt;setText (Value.text ()); emit signal_LabelChanged (); } /*----------------------------------------------------------------------------*/ Qt::Alignment CQtOpenCVImage::getAlignment() const { return(d_func ()-&gt;f_label-&gt;alignment ()); } /*----------------------------------------------------------------------------*/ void CQtOpenCVImage::setAlignment(Qt::Alignment Value) { d_func ()-&gt;f_label-&gt;setAlignment (Value); emit signal_AlignmentChanged (); } /*----------------------------------------------------------------------------*/ const QLabel* CQtOpenCVImage::getQLabel () const { return ((const QLabel*)(d_func ()-&gt;f_label)); }</span></span></code> </pre><br><br>  We form runtime-library.  We describe the project file images.pro: <br><pre> <code class="cpp hljs">TARGET = QtOpenCVImages TARGET = $$qtLibraryTarget($$TARGET) TEMPLATE = lib CONFIG += debug_and_release</code> </pre><br>  Do not forget to include: <br><pre> <code class="cpp hljs">DEFINES += QDESIGNER_EXPORT_WIDGETS</code> </pre><br>  Determine the path to get the library files: <br><pre> <code class="cpp hljs">unix:!symbian { target.path = $$PWD/../../../../lib DESTDIR = $$PWD/../../../../lib INSTALLS += target }</code> </pre><br><br>  Add class files: <br><pre> <code class="cpp hljs">SOURCES += \ cqtopencvimage.cpp HEADERS += \ cqtopencvimage.h</code> </pre><br><br>  Define the paths of the OpenCV library file headers and project dependency paths: <br><pre> <code class="cpp hljs">INCLUDEPATH += /usr/include/opencv2 DEPENDPATH += /usr/include/opencv2</code> </pre><br><br>  Add the OpenCV library (core and highgui) to our project: <br><pre> <code class="cpp hljs">#win32:CONFIG(release): LIBS += -L/usr/lib/ -lopencv_core #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32:CONFIG(debug, debug|release): LIBS += -L/usr/lib/ -lopencv_cored #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: unix: LIBS += -L/usr/lib/ -lopencv_core #win32:CONFIG(release, debug|release): LIBS += -L$$PWD/../../../../../../usr/lib/release/ -lopencv_highgui #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32:CONFIG(debug, debug|release): LIBS += -L$$PWD/../../../../../../usr/lib/debug/ -lopencv_highguid #win32:CONFIG(release): LIBS += -L/usr/lib/release/ -lopencv_highgui #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:symbian: LIBS += -lopencv_highgui #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: unix: LIBS += -L/usr/lib/ -lopencv_highgui</code> </pre><br><br>  Dear developers of the Windows OS, I ‚Äújumped‚Äù off the Microsoft needle for a long time and I apologize for commenting out the library paths for your OS.  You are smart people, you will understand. <br><h6>  * NIX, use the ln -s command to create links to your libraries from the location in the <code>/usr/lib</code> directory </h6><h6>  Once you create a link, just rebuild the project, and everything will work fine! <br></h6><br>  So, we have created a Qt dynamic library of a visual component for displaying a picture obtained from a webcam using OpenCV. <br><br>  Source Code: <a href="https://cloud.mail.ru/public/DVCo/VQKwci7H4">Wu a La (literally)</a> <br><br><h5>  Design </h5><br>  It is time to connect our runtime library to the shell class of the plugin for Qt Designer. <br>  Create a plugin library project: <br><pre> <code class="cpp hljs">TARGET = QtOpenCVWidgets TARGET = $$qtLibraryTarget($$TARGET) TEMPLATE = lib CONFIG += designer plugin release DEFINES += QDESIGNER_EXPORT_WIDGETS SOURCES += \ qtopencvimageplugin.cpp \ ../qtopencvwidgets.cpp HEADERS +=\ qtopencvimageplugin.h \ ../qtopencvwidgets.h \ ../runtime/images/cqtopencvimage.h RESOURCES += \ qtopencvimages.qrc unix:!symbian { target.path = $$PWD/../../../lib DESTDIR = $$PWD/../../../lib INSTALLS += target } INCLUDEPATH += /usr/include/opencv2 DEPENDPATH += /usr/include/opencv2 #win32:CONFIG(release, debug|release): LIBS += -L/usr/lib/ -lQtOpenCVImages #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:win32:CONFIG(debug, debug|release): LIBS += -L/usr/lib -lQtOpenCVImages #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:symbian: LIBS += -lQtOpenCVImages #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: unix: LIBS += -L/usr/lib -lQtOpenCVImages INCLUDEPATH += $$PWD/../runtime/images DEPENDPATH += $$PWD/../runtime/images</code> </pre><br>  Looks like a runtime project, right?  Consider some of the differences: <br><ul><li>  The name of the library has changed: <i>TARGET = QtOpenCVWidgets</i> ; </li><li>  The <i>CONFIG + = designer plugin release</i> parameter contains the <i>plugin</i> and <i>designer</i> tags; </li><li>  The plugin is implemented in two files, one for the title and the implementation of <i>qtopencvimageplugin. * Qtopencvwidgets. * &lt;. I&gt;;</i> <br>  There is still a dependency on the OpenCV library headers.  added dependency on the included <i>cqtopencvimage.h</i> title <i>on</i> our <i>QtOpenCVImages</i> widget; <br>  The dynamic runtime library <i>libQtOpenCVImages is enabled</i> via a symbolic link from <code>/usr/lib/libQtOpenCVImages.so</code> , indicating its actual location in the project directory <br></li></ul><br>  Create a Qt Designer plugin widget for all Qt canons: <a href="http://doc.qt.nokia.com/4.7-snapshot/designer-creating-custom-widgets.html">Creating Custom Widgets for Qt Designer</a> ( <a href="https://habrahabr.ru/users/coffeesmoke/" class="user_link">coffeesmoke</a> , as loudly said!): <br>  <strong>qtopencvimageplugin.h</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> QTOPENCVIMAGEPLUGIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> QTOPENCVIMAGEPLUGIN_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QObject&gt; #include &lt;QDesignerCustomWidgetInterface&gt; class QtOpenCVImagePlugin : public QObject, public QDesignerCustomWidgetInterface { Q_OBJECT Q_INTERFACES(QDesignerCustomWidgetInterface) public: explicit QtOpenCVImagePlugin(QObject *parent = 0); QString name() const; QString includeFile() const; QString group() const; QIcon icon() const; QString toolTip() const; QString whatsThis() const; bool isContainer() const; QWidget* createWidget(QWidget *parent); void initialize(QDesignerFormEditorInterface *core); bool isInitialized() const; QString domXml() const; signals: public slots: private: bool f_init; }; #endif // QTOPENCVIMAGEPLUGIN_H</span></span></span></span></code> </pre><br>  The basic idea is to declare Q_INTERFACE, inheriting from <i>QDesignerCustomWidgetInterface,</i> and reload the methods of the designer‚Äôs interface class in accordance with its requirements. <br><br>  <strong>qtopencvimageplugin.cpp</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"qtopencvimageplugin.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cqtopencvimage.h"</span></span></span><span class="hljs-meta"> QtOpenCVImagePlugin::QtOpenCVImagePlugin(QObject *parent) : QObject(parent), f_init(false) { } QString QtOpenCVImagePlugin::name() const { return </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"CQtOpenCVImage"</span></span></span><span class="hljs-meta">;</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    } QString QtOpenCVImagePlugin::includeFile() const { return QLatin1String("cqtopencvimage.h"); //     ui_*.h   } QString QtOpenCVImagePlugin::group() const { return tr("OpenCV Widgets"); //       Qt Designer } QIcon QtOpenCVImagePlugin::icon() const { return QIcon(":QtOpenCVLogo.png"); //   } QString QtOpenCVImagePlugin::toolTip() const { return QString(); } QString QtOpenCVImagePlugin::whatsThis() const { return QString(); } bool QtOpenCVImagePlugin::isContainer() const { return false; } QWidget* QtOpenCVImagePlugin::createWidget(QWidget *parent) { return new CQtOpenCVImage(parent); //  ,     ! } void QtOpenCVImagePlugin::initialize(QDesignerFormEditorInterface *core) { //        if (f_init) return; f_init = true; } bool QtOpenCVImagePlugin::isInitialized() const { return f_init; } QString QtOpenCVImagePlugin::domXml() const { //     return "&lt;ui language=\"c++\"&gt;\n" " &lt;widget class=\"CQtOpenCVImage\" name=\"QtOpenCVImage\"&gt;\n" " &lt;property name=\"geometry\"&gt;\n" " &lt;rect&gt;\n" " &lt;x&gt;0&lt;/x&gt;\n" " &lt;y&gt;0&lt;/y&gt;\n" " &lt;width&gt;400&lt;/width&gt;\n" " &lt;height&gt;200&lt;/height&gt;\n" " &lt;/rect&gt;\n" " &lt;/property&gt;\n" " &lt;/widget&gt;\n" "&lt;/ui&gt;"; }</span></span></span></span></code> </pre><br><br><br>  Very little remains: create a common wrapper container for all our <code>Qt &lt;-&gt; OpenCV</code> group widgets <br>  <strong>qtopencvwidgets.h</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> QTOPENCVWIDGETS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> QTOPENCVWIDGETS_H #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;QObject&gt; #include &lt;QtPlugin&gt; #include &lt;QDesignerCustomWidgetCollectionInterface&gt; class QtOpenCVWidgets : public QObject, public QDesignerCustomWidgetCollectionInterface { Q_OBJECT Q_INTERFACES(QDesignerCustomWidgetCollectionInterface) public: explicit QtOpenCVWidgets(QObject *parent = 0); QList&lt;QDesignerCustomWidgetInterface*&gt; customWidgets() const { return f_plugins; } private: QList&lt;QDesignerCustomWidgetInterface *&gt; f_plugins; }; #endif // QTOPENCVWIDGETS_H</span></span></span></span></code> </pre><br><br>  <strong>qtopencvwidgets.cpp</strong> <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"qtopencvwidgets.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"images/qtopencvimageplugin.h"</span></span></span><span class="hljs-meta"> QtOpenCVWidgets::QtOpenCVWidgets(QObject *parent) : QObject(parent) { f_plugins &lt;&lt; new QtOpenCVImagePlugin(this); } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//Q_DECLARE_INTERFACE(QtOpenCVWidgets, "com.trolltech.Qt.Designer.QtOpenCV") Q_EXPORT_PLUGIN2(qtopencvwidgetsplugin, QtOpenCVWidgets)</span></span></span></span></code> </pre><br>  <code>f_plugins &lt;&lt; new QtOpenCVImagePlugin(this);</code> interest is the constructor, namely: <code>f_plugins &lt;&lt; new QtOpenCVImagePlugin(this);</code>  .  At the subsequent addition of new components to the collection, it will be enough to rewrite the constructor, adding one more f_plugins operator &lt;&lt; new &lt;Next&gt; Plugin (this); <br><h5>  Application </h5><br>  Open Qt Designer and look at our QtOpenCVImage on the component palette.  Move it to a new form.  Change the capture to the desired URL <code><a href="http://192.168.0.20/"></a> 192.168.0.20:8080/image.jpg</code>  <code><a href="http://192.168.0.20/"></a> 192.168.0.20:8080/image.jpg</code> .  In this case, this is a Java server applet of the camera server providing the current requested frame. <br>  Put a "tick" on the property <code>grayscale</code> <br>  Source code: <a href="https://cloud.mail.ru/public/DVCo/VQKwci7H4">If downloaded earlier, do not go on it</a> . <br><br><h4>  findings </h4><br><ul><li>  We learned how to create a runtime library to implement our own class based on the visual components of Qt; </li><li>  Learned to frame the runtime library into a Qt Designer plugin, making applications independent of the designer plugin at run time; </li></ul><br><h4>  Applications </h4><br><h5>  Simple test case </h5><br>  Create a standard Qt GUI application, open the main form of the window, place our component with it, create some service controls, build and run. <br>  Change the "Address ..." to 0 (built-in video camera) and look at the image changes. <br><br>  Source code: <a href="https://cloud.mail.ru/public/DVCo/VQKwci7H4">If downloaded earlier, do not go on it</a> . <br><br><h4>  What's next? </h4><br><ul><li>  Optimization of the current project; </li><li>  The description of the proven Canny image visual component search boundary: CQtOpenCVCannyWidget based on the class CQtOpenCVCanny; </li><li>  Relationship between QtOpenCVImage and QtOpenCVCanny </li></ul><br>  All the best. <br></div><p>Source: <a href="https://habr.com/ru/post/146210/">https://habr.com/ru/post/146210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146202/index.html">Trends in the fall Technology Forum 2012: habrarosop</a></li>
<li><a href="../146203/index.html">One character in the UTF-16 encoding is occupied (do not spy on Wikipedia and Google!):</a></li>
<li><a href="../146204/index.html">Notes on completing the course 6.002 MITx</a></li>
<li><a href="../146206/index.html">Smart Start has received investments from Softline Venture Partners</a></li>
<li><a href="../146208/index.html">Many-armed Shiva GALAXY S III</a></li>
<li><a href="../146211/index.html">Digitimes: the cheapest Surface tablet will cost $ 599</a></li>
<li><a href="../146212/index.html">Project K28A or a new generation bicycle</a></li>
<li><a href="../146213/index.html">Petition to Qualcomm: the final?</a></li>
<li><a href="../146214/index.html">Fail on Surface Presentation</a></li>
<li><a href="../146216/index.html">Photosite on MVC 4 for beginners</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>