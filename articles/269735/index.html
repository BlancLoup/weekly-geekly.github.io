<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How lighthouses work: iBeacon Physics Technology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our first publication, we presented a review and comparison of the whole range of iBeacon beacons available on the market. Today we will take a clo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How lighthouses work: iBeacon Physics Technology</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/navigine/blog/269735/"><img src="https://habrastorage.org/files/c3a/3ae/1c1/c3a3ae1c1c764964aa983032362efdfa.jpg" width="400"></a> <br><br>  <i>In our <a href="http://habrahabr.ru/company/navigine/blog/269195/">first publication,</a> we presented a review and comparison of the whole range of iBeacon beacons available on the market.</i>  <i>Today we will take a closer look at how the Bluetooth beacon works on the <a href="http://blog.estimote.com/post/106913675010/how-do-beacons-work-the-physics-of-beacon-tech">example of</a> our European colleagues, and let's talk about how it can be used to calculate the location inside the building.</i> <a name="habracut"></a><br><br><h4>  What is inside </h4><br>  Despite the global coverage of iBeacon technology in the media, business and developer communities, it seems that there is some level of misunderstanding about how it works.  Now we will try to fix it and delve into the basics and explain what the beacons are and how they work. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How do beacons work?  The principles of their work are quite simple.  Under the silicone case is a small ARM computer connected to the Bluetooth module ‚Äî they are powered by a battery.  A small chip from Nordic Semiconductor contains firmware - this is part of the low-level software that guarantees the correct operation of the beacons.  Although processor and memory computing power is limited, it is more than enough to process sensitive data and encrypt ID beacons (to increase security). <br><br>  On the tapered part of the beacon there is a short wire that goes directly from the processor - this is an antenna.  The broadcast antenna emits waves of a certain frequency and length: 2.4 GHz radio waves.  If you disassemble the beacon, you will notice that the antenna does not resemble the antennas of old televisions and radio receivers.  And it's not just about size.  It has a curved shape and looks like a zigzag. <br><br>  This is done for a reason.  The electromagnetic field around the straight wire takes the form of a donut - the waves do not propagate with the same force in all directions, which leads to the formation of "empty" zones.  The best solution is to change the shape of the antenna so that the electromagnetic field takes the form of an ideal sphere.  However, in real conditions this cannot be achieved, therefore a lot of research is carried out for this purpose.  There are a huge number of books on antenna theory, and we conducted our own experiments to make our antennas produce a powerful and stable field. <br><br><img src="https://habrastorage.org/files/52f/9a5/b67/52f9a5b672314299960c79f5083e5cdc.gif" width="450"><br><br>  <i><a href="http://web.mit.edu/6.013_book/www/chapter12/12.4.html">Source: MIT</a></i> <br><br>  For communication, beacons use Bluetooth Smart technology.  This is the latest low-power Bluetooth standard designed for transferring small amounts of data.  The maximum packet size for Bluetooth 4.2 is 257 bytes.  This is not enough to transfer media content, so beacons transmit only their IDs (in the case of the iBeacon protocol, the ID is divided into three parts: UUID, Major, Minor) and information about the strength of the emitted signal ‚Äî this parameter is necessary to calculate the distance to the smartphone. <br><br><h4>  Mathematics and physics </h4><br>  The transmission distance and stability of the beacon signal depend on two main factors: the transmission interval (frequency) and the strength of the broadcast.  The beacon does not transmit signals all the time - it works impulsively.  Frequency is the time elapsed between two consecutive data transfers.  The higher the frequency, the more accurately the signal is determined. <br><br>  This is done because smartphones also ‚Äúlook for‚Äù beacons, scanning the air with a certain frequency, and this frequency may depend on the state of the phone (locked, unlocked).  The type of OS and device also matters.  If the phone is active, it will scan with great frequency;  if you put it in your pocket, after a few minutes it will start to save battery power and limit the number of Bluetooth scans. <br><br>  For Estimote beacons, the time between pulses is 950 ms, but it can be changed in the range from 100 to 2000 ms.  Standard frequency is not chosen by chance.  On average, iOS scans the area for beacons 1 time per second.  950 ms is almost equal to this value.  In a sound-proofed room, the sent packet may not reach the device (or something / someone will block the direct visibility of the smartphone and the beacon).  To increase the stability of the connection, you can increase the frequency of shipments. <br><br>  If you set the interval to 490 ms, two packets will be transmitted in one scan by the smartphone.  If you set the interval to 330 ms, three packets will be transmitted in one scan;  240 ms is four packets and so on.  If the first packet was not received by the device, there is a chance that it will accept the rest.  It is important to remember that the increase in the number of packages sent leads to a decrease in battery life. <br><br><img src="https://habrastorage.org/files/a7e/7a5/c30/a7e7a5c30fae4f839325bb154e03b087.jpeg" width="450"><br><br>  In addition to the frequency should take into account the strength of the broadcast.  It describes the signal strength and is measured in dBm (decibel milliwatts).  dBm is the absolute power level in decibels relative to the reference level of 1 mW.  The working distance of the beacon directly depends on the broadcasting power.  It is impossible to say at what distance the radio waves propagate, since there is no definite point in space where they simply stop.  For example, a light bulb, it illuminates a certain area around itself, but the light goes much further, scattering.  The same thing happens with radio waves. <br><br>  The closer you are to the beacon, the more accurately the distance is calculated - this is due to the greater signal density in the vicinity of the source.  As you move away, the signal becomes more diffuse and distorted until it becomes indistinguishable from background noise.  To better understand the concept, imagine that the beacon is a radio receiver, and the strength of the broadcast is the volume level. <br><br>  If you increase the volume, you can hear the music from a distance, and, coming closer, you will hear it more and more clearly.  But if the volume is very low, it may be difficult to recognize the melody, even if you put your ear directly on the speaker.  However, knowledge of the exact volume level in decibels does not make it possible to perfectly determine the distance at which sound will be heard.  Too many factors affect this: from obstacles (physical matter through which waves must penetrate) to the characteristics of hearing. <br><br><img src="https://habrastorage.org/files/285/247/050/28524705093e4a5f800559a884bdbca3.jpeg" width="450"><br><br><h4>  Distance calculation </h4><br>  You already know that the smartphone will be able to calculate the approximate distance to the beacon after ‚Äúhearing‚Äù it.  To do this, the phone reads the so-called RSSI (Received Signal Strength Indicator) - the power indicator of the received signal, and then compares it with the signal level measured at 1 meter from the transmitter, which is delivered as part of the transmitted data packet.  So the smartphone calculates the approximate distance to the beacon.  A distance of 1 meter was chosen specifically: as mentioned above, it is much easier to obtain accurate values ‚Äã‚Äãat close distances due to the higher signal density. <br><br>  We have written the rules by which the distances to the beacons are calculated, but, as usual, in practice everything is not so simple.  Let's go back to the radio example: Imagine that you put the radio not in the room, but in the middle of a noisy train station.  The radio plays at full volume, and you can easily hear it when you are nearby, but you can‚Äôt determine its exact location - people are scurrying back and forth.  In addition to people, arriving and departing trains make noise, the dispatcher announces landings - all this distorts the sound, so you cannot say with certainty how far you are from the receiver. <br><br>  It is impossible to calculate the exact location of the beacon only on the basis of the received radio waves.  Here you do not interfere with the train and dispatcher, and the multiplicity of routes of wave propagation, diffraction, absorption and interference.  Remember, we said that it is impossible to design an antenna that propagates a signal in all directions with the same force?  Because of this, the mutual orientation of the lighthouse and the smartphone in space can affect the approximation: the RSSI readings vary greatly. <br><br>  If the beacon is located at a distance of 10 meters from your smartphone, the application can show the number 8, then guess and assume a distance of 10 meters, then report about 12 meters, go back to 7 again and again to 10 ... well, you understand.  If you turn the phone, the system may decide that you are 2 meters closer to the beacon. <br><br>  <i>We have analyzed the principles of operation of the iBeacon technology on the example of the description of the action of Estimote beacons.</i>  <i>And now we want to tell you more about how indoor navigation works using technologies developed in <a href="https://vc.ru/p/navigine">Navigine</a> .</i> <br><br><h4>  Indoor navigation: Navigine comment </h4><br>  Location services for iOS are governed by the Core Location framework, of which iBeacon is a part.  The iBeacon standard was not designed to calculate the exact distance to the beacon and operates only with zones.  There are four types of zones: close proximity (very close to the beacon), close (1-3 meters from the beacon), far (an area where the signal fluctuates too much, and it is impossible to determine the distance more accurately) and it is not known.  The Core Location Framework allows you to activate the desired events in each zone. <br><br>  For small rooms, such as a cafe or restaurant, this will be enough, but what if you want to get the exact location on an area of ‚Äã‚Äãthousands of square meters, for example, in a warehouse, an industrial enterprise or a shopping center? <br><br>  So, the question remains: is it possible to build a reliable indoor navigation service using iBeacon-beacons?  In short, yes, you can.  In more detail, it is for this reason that any hardware infrastructure is only part of the navigation systems.  Taking as a basis the simple and cheap iBeacon infrastructure, our knowledge and approaches to indoor navigation (which we talked about in short <a href="http://habrahabr.ru/company/sap/blog/267433/">here</a> , and will soon tell you more), we at Navigine developed a service that allows us to determine the position inside the room in the absence of satellite signals. <br><br>  The service is based on our integrated inertial navigation algorithms with a wide range of additional (corrective) information based on optimal estimation methods using Bayesian type filters. <br><br>  To maximize the scope, we process the following set of additional information: <br><br><ul><li>  RSSI card Bluetooth / WiFi fields (so-called digital fingerprints); </li><li>  GPS and GLONASS signals (if there is a partial signal, for example, near windows); </li><li>  readings of the rough card-less inertial navigation systems (SINS) based on MEMS sensors (gyroscope, smartphone accelerometer); </li><li>  information from magnetometers (compass) and smartphone barometers; </li><li>  odometer information (measuring the speed of an object); </li><li>  information about the room map (walls, obstacles, possible routes). </li></ul><br>  As a result of the work of the navigation algorithms, the output is a point on the map in the mobile application.  In the ideal case, the positioning accuracy will be 1 meter (1 œÉ). <br><br>  Just a year ago, testing indoor navigation based on iBeacon-beacons required a long and boring process of removing a radio card.  Now enough to note where the beacons were installed on the map.  We have an iOS / Android SDK, which you can test by registering on the <a href="https://navigine.com/%3Flang%3Dru">site</a> , plus some of the algorithms are available on GitHub ( <a href="https://github.com/navigine/">our repository</a> ).  Fork on health. </div><p>Source: <a href="https://habr.com/ru/post/269735/">https://habr.com/ru/post/269735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269725/index.html">How did we manage to build a video hosting for 1 ¬¢ / GB</a></li>
<li><a href="../269727/index.html">Multi-tier, extensible business information repository architecture. LSA and SAP BW. Traditional approach</a></li>
<li><a href="../269729/index.html">Certificate Transparency Overview</a></li>
<li><a href="../269731/index.html">Why Go is a badly designed programming language.</a></li>
<li><a href="../269733/index.html">Concepts of natural language versus formal classifications in OpenStreetMap</a></li>
<li><a href="../269737/index.html">Secure crypto programming. Part 2, final</a></li>
<li><a href="../269739/index.html">Conference on web analytics and internet marketing CONVERT.2015 will be held in Yekaterinburg on December 7</a></li>
<li><a href="../269741/index.html">Swift + VK.API, or the story of SwiftyVK</a></li>
<li><a href="../269743/index.html">We continue to fight the frontend-routine</a></li>
<li><a href="../269745/index.html">Learning machine learning</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>