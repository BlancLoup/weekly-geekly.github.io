<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity newbie bugs tested in their own skin</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. It's me again, Ilya Kudinov, QA-engineer from the company Badoo. But today I‚Äôll tell you not about testing (I‚Äôve already done this on Monday...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity newbie bugs tested in their own skin</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/kx/vi/x3/kxvix32yqiqtyabuvgwl079cpqu.png" width="500"></div>  Hi, Habr.  It's me again, Ilya Kudinov, QA-engineer from the company Badoo.  But today I‚Äôll tell you not about testing (I‚Äôve already done this <a href="https://habrahabr.ru/company/badoo/blog/345478/">on Monday</a> ), but about game devs.  No, we don‚Äôt do that at Badoo, developing computer games is my hobby. <br><br>  <i>Industry professionals, do not judge strictly.</i>  <i>All the tips in this article are for beginner developers who decide to try their hand at Unity.</i>  <i>Many tips can be attributed to the development as a whole, but I will try to add Unity-specificity to them.</i>  <i>If you can advise something better than I suggest - write in the comments, I will update the article.</i> <br><br>  I dreamed of developing toys since childhood.  Probably already back in 1994, when they gave me my first Dendy, I thought: ‚Äú <i>How would it be if there were more cool things in this igluchka ...</i> ‚Äù In high school, I began to learn programming and together with He made his first playable crafts (oh, how we loved them!).  At the institute, my friends and I made Napoleonic plans for a fundamental change in the industry with the help of our completely new topic ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And in 2014, I started to learn Unity and finally, REALLY started to make games.  However, the trouble is: I have never <u>worked as a</u> programmer.  I had no experience of real corporate development (before that I did everything ‚Äúon my knee‚Äù, and, apart from me, no one would understand my code).  I could program, but I couldn‚Äôt do it well.  All my knowledge of Unity and C # was limited to the official tutorials that were scarce at that time.  And my favorite way to learn about the world is to make mistakes and learn from them.  And I have done plenty of them. <br><br>  Today I will talk about some of them and show you how to avoid them (oh, if I knew all this three years ago!) <br><br>  <i>In order to understand all the terms used in the material, it is enough to first go through one or two official Unity tutorials.</i>  <i>Well, and have at least some idea of ‚Äã‚Äãprogramming.</i> <a name="habracut"></a><br><br><h3>  Do not thrust all the logic of the object into one MonoBehaviour </h3><br>  Ah, my class <code>MonsterBehaviour</code> in our debut game!  3200 lines of spaghetti code in his worst days.  Every need to return to this class gave me a slight shiver, and I always tried to postpone this work as long as I could.  When I got to his refactoring a little more than a year after its creation, I not only broke it into a base class and several heirs, but also made several blocks of functionality into separate classes, which I added to objects directly from the code using <a href="http://docs.unity3d.ru/ScriptReference/GameObject.AddComponent.html"><code>gameObject.AddComponent()</code></a> , so I did not have to change the already accumulated prefabs. <br><br>  It was: <br>  the monster class <code>MonsterBehaviour</code> , which kept in itself all the personal settings of the monsters, which determined their behavior, animation, leveling, finding the way and everything. <br><br>  It became: <br><br><ul><li>  <code>MonsterComponent</code> abstract class, from which all other components are inherited and which binds them and, for example, basic optimization in the form of caching the results of the <a href="https://docs.unity3d.com/ScriptReference/GameObject.GetComponent.html"><code>gameObject.GetComponent&lt;T&gt;();</code></a> call <a href="https://docs.unity3d.com/ScriptReference/GameObject.GetComponent.html"><code>gameObject.GetComponent&lt;T&gt;();</code></a> </li><li>  <code>MonsterStats</code> class in which game designer enters the parameters of monsters.  He stores them, changes them with the level and gives them to other classes upon request; </li><li>  the <code>MonsterPathFinder</code> class, which is searching for paths and stores the generated data in static fields to optimize the algorithm; </li><li>  <code>MonsterAttack</code> abstract class with heirs for different types of attack (weapons, claws, magic ...), which control everything related to the monster's combat behavior - timings, animation, the use of special techniques; </li><li>  There are still many additional classes that implement all kinds of specific logic. </li></ul><br>  In just a few hours of work, I was able to cut a few hundred lines of hard-to-maintain code and save hours of nervous digging in go-bad code. <br><br>  What, the essence of my advice is not to write giant classes, <i>thank you, cap</i> ?  Not.  My advice: split your logic into atomic classes before they become large.  First, let your objects have three or four meaningful components with ten lines in each code, but it will be no more difficult to navigate them than in one of the 50 lines, but with the further development of logic you will not find yourself in a situation like me.  At the same time there are more opportunities to reuse the code - for example, the component responsible for health and taking damage, you can stick to the player, and opponents, and even obstacles. <br><br>  <i>Clever term - <a href="https://en.wikipedia.org/wiki/Interface_segregation_principle">Interface segregation principle</a> .</i> <br><br><h3>  Do not forget about OOP </h3><br>  No matter how simple at first glance the design of objects in Unity ( <i>‚ÄúProgramming with the mouse, fuuuu‚Äù</i> ) may seem, one should not underestimate this component of the development.  Yes, yes, I underestimated.  Straight by points: <br><br><ul><li>  <b>Inheritance</b> .  It is always nice to bring some common logic of several classes into a common base class.  Sometimes it makes sense to do this in advance if the objects are ‚Äúideologically‚Äù similar, even if they do not yet have common methods.  For example, level chests and decorative torches on the walls initially had nothing in common.  But when we began to develop the mechanics of extinguishing and igniting torches, we had to take out from the chests into the general class the mechanics of interaction with the player and the display of prompts in the interface.  And I could have guessed right away.  And I also have a common base class for all objects, which is a superstructure over MonoBehaviour, with a bunch of useful new features. </li><li>  <b>Encapsulation</b> .  I will not even explain how useful the installation of the correct scopes can be.  It simplifies the work, reduces the likelihood of a stupid mistake, makes it easier to debug ... It is still useful to know about two directives - <code>[HideInInspector]</code> , which hides the public component fields in the inspector that should not be edited in objects (however, it makes sense to avoid public fields at all) bad practice - it‚Äôs better to use <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/classes-and-structs/properties">property</a> instead, thanks to <a href="https://habrahabr.ru/users/charoplet/" class="user_link">Charoplet</a> for the reminder), and <code>[SerializeField]</code> , on the contrary, displays private fields in the inspector (which is very useful for more convenient debugging). </li><li>  <b>Polymorphism</b> .  Here the question is exclusively in the beauty and brevity of the code.  One of my favorite pieces to support polymorphism in C # is universal templates.  For example, I wrote such simple and convenient methods for pulling out a random element of an arbitrary class from L <code>ist&lt;T&gt;</code> (and I do it very often): </li></ul><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> T GetRandomFromList&lt;T&gt;(List&lt;T&gt; list) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list[Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, list.Count)]; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> T PullRandomFromList&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> List&lt;T&gt; list) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, list.Count); T result = list[i]; list.RemoveAt(i); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br>  At the same time, C # is such a sweetheart that allows you not to produce these parameters, and these two calls will work identically: <br><br><pre> <code class="cs hljs">List&lt;ExampleClass&gt; list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ExampleClass&gt;(); ExampleClass a = GetRandomFromList&lt;ExampleClass&gt;(list); ExampleClass a = GetRandomFromList(list);</code> </pre> <br>  <i>Clever term - <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">Single responsibility principle</a> .</i> <br><br><h3>  Explore the GUI Editor </h3><br>  I did it <u>much</u> later than it was worth.  I have already written <a href="https://habrahabr.ru/company/badoo/blog/307170/">an article</a> on how this can help both a programmer and a game designer in developing.  In addition to custom inspectors for individual attributes and whole components, the GUI Editor can be used for a huge number of things.  Create separate editor tabs to view and edit SAVE files of the game, to edit scenarios, to create levels ... The possibilities are endless!  And the potential time savings are just amazing. <br><br><h3>  Think localization right from the start. </h3><br>  Even if you are not sure that you will translate the game into other languages.  To force localization into an already formed project is intolerable pain.  You can think of a variety of ways to localize and store translations.  It is a pity that Unity is not able to independently carry out all the lines in a separate file that can be localized out of the box and without access to the rest of the application code (as, for example, in Android Studio).  You will have to write such a system yourself.  Personally, I use two solutions for this, albeit not very elegant ones. <br><br>  Both are based on my own <code>TranslatableString</code> class: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TranslatableString</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LANG_EN = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LANG_RU = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LANG_DE = <span class="hljs-number"><span class="hljs-number">2</span></span>; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> english; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> russian; [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> german; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">implicit</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">operator</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TranslatableString translatableString</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> languageId = PlayerPrefs.GetInt(<span class="hljs-string"><span class="hljs-string">"language_id"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (languageId) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LANG_EN: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translatableString.english; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LANG_RU: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translatableString.russian; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> LANG_DE: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translatableString.german; } Debug.LogError(<span class="hljs-string"><span class="hljs-string">"Wrong languageId in config"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> translatableString.english(); } }</code> </pre> <br>  <i>It still has a bunch of lines with error protection and field completeness checks, now I have removed them for readability.</i>  <i>You can store translations as an array, but for a number of reasons I still chose separate fields.</i> <br><br>  All the ‚Äúmagic‚Äù is in the method of implicit conversion to a string.  Thanks to him, you can call something like this anywhere in the code: <br><br><pre> <code class="cs hljs">TranslatableString lexeme = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranslatableString(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> text = lexeme;</code> </pre> <br>  - and immediately receive the necessary translation in the text string, depending on the current language in the player‚Äôs settings.  That is, in most places when adding localization, you don‚Äôt even have to change the code - it will just continue to work with strings, as before! <br><br>  The first localization option is very simple and suitable for games where there are very few lines, and all of them are located in the UI.  We simply add each object with a translatable <code>UnityEngine.UI.Text</code> component. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TranslatableUIText</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TranslatableString translatableString; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { GetComponent&lt;UnityEngine.UI.Text&gt;().text = translatableString; } }</code> </pre> <br>  We fill in all the translation lines in the inspector - and voila, that's it! <br><br>  For games where there are more tokens, I use a different approach.  I have a <code>Singleton</code> LexemeLibrary <code>LexemeLibrary</code> that stores a map of the form ‚Äúid tokens‚Äù =&gt; ‚Äúserialized <code>TranslatableString</code> ‚Äù, from which I get the tokens in the right places.  You can fill this library in any convenient way: with pens in the inspector, through a custom interface (hello, Editor GUI) or by exporting / importing CSV files.  The latter option works great with outsourced translators, but it takes a little more work to avoid mistakes. <br><br>  By the way, a useful thing - the language of the player‚Äôs system (in fact, its localization preferences) can be obtained using, for example, the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetLanguage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language_id</span></span></span><span class="hljs-function">)</span></span> { PlayerPrefs.SetInt(<span class="hljs-string"><span class="hljs-string">"language_id"</span></span>, language_id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GuessLanguage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Application.systemLanguage) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SystemLanguage.English: SetLanguage(TranslatableString.LANG_EN); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SystemLanguage.Russian: SetLanguage(TranslatableString.LANG_RU); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SystemLanguage.German: SetLanguage(TranslatableString.LANG_DE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre> <br>  <i>Clever term - <a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">Dependency inversion principle</a> .</i> <br><br><h3>  Write detailed logs! </h3><br>  This may seem redundant, but now some of my games write to the log almost every sneeze.  On the one hand, this wildly clutters the Unity console (which, unfortunately, does not know how to do any convenient filtering), on the other hand, you can open the source log files in any convenient software for viewing logs and compile any reports convenient to you, which will help to be engaged both in application optimization, and search of anomalies and their reasons. <br><br><h3>  Create self-contained entities </h3><br>  I did stupid things.  Suppose we want to somehow store the settings of the various levels of a game: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Mission { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> duration; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> enemyDelay; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> difficultyMultiplier; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MissionController</span></span> : <span class="hljs-title"><span class="hljs-title">Singleton</span></span>&lt;<span class="hljs-title"><span class="hljs-title">MissionController</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Mission[] missions; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> currentMissionId; }</code> </pre> <br>  The <code>MissionController</code> component sits in an object, contains settings for all game missions, and is accessible from anywhere in the code via <code>MissionController.Instance</code> . <br>  <i>About my class Singleton can be read in the already mentioned <a href="https://habrahabr.ru/company/badoo/blog/307170/">article</a> .</i> <br><br>  My initial approach was this: <code>Mission</code> stores only parameters, and <code>MissionController</code> handles all other requests.  For example, to get a better player account at a certain level, I used methods like <br><br><pre> <code class="cs hljs">MissionController.GetHighScore(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> missionId) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PlayerPrefs.GetInt(<span class="hljs-string"><span class="hljs-string">"MissionScore"</span></span> + missionId); }</code> </pre> <br>  It would seem that everything is working properly.  But then such methods became more and more, entities grew, proxy methods appeared in other classes ... In general, spaghetti-hell came.  Therefore, in the end, I decided to put all the methods for working with missions into the <code>Mission</code> structure itself and began to receive mission records, for example, in the following way: <br><br><pre> <code class="cs hljs">MissionController.GetCurrentMission().GetHighScore();</code> </pre> <br>  which made the code much more readable and easy to maintain. <br><br><h3>  Do not be afraid to use PlayerPrefs </h3><br>  Many sources say that <code><a href="https://docs.unity3d.com/ScriptReference/PlayerPrefs.html">PlayerPrefs</a></code> should be used very carefully and on every possible occasion, instead, serialize the data yourself and write them into your own files.  Previously, I diligently prepared my own binary file format for each saved entity.  Now I do not do that. <br><br>  The <code>PlayerPrefs</code> class is <code>PlayerPrefs</code> to storing ‚Äúkey =&gt; value‚Äù pairs in the file system, and it works the same on all platforms, it simply stores its files in different places. <br><br>  Constantly writing data to the <code>PlayerPrefs</code> fields (and reading them) is bad: regular disk queries do not do any good to anyone.  However, you can write a simple but reasonable system that will help to avoid this. <br><br>  For example, you can create a single SAVE object that stores all the settings and player data: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">System.Serializable</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> Save { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> exp; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] highScores; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> languageId; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> muteMusic; }</code> </pre> <br>  We write a simple system that does lazy initialization of this object (reads it from <code>PlayerPrefs</code> on the first request, puts it in a variable and on further requests already uses this variable), writes all changes to this object and saves it back to <code>PlayerPrefs</code> only when necessary ( when you exit the game and change key data). <br><br>  To manipulate such an object as a string for <code>PlayerPrefs.GetString()</code> and <code>PlayerPrefs.SetString()</code> , it is enough to use JSON serialization: <br><br><pre> <code class="cs hljs">Save save = newSave; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> serialized = JsonUtility.ToJson(newSave); Save unserialized = JsonUtility.FromJson&lt;Save&gt;(serialized);</code> </pre> <br><br><h3>  Watch out for objects in the scene. </h3><br>  Here you have launched your game.  It works, you rejoice.  Played it for about 15 minutes, paused to check this curious vorning in the console ... VALUE, WHY IN 717 OBJECTS IN THE CORN ???  HOW TO ME ANYTHING TO FIND ??? <br><br>  Understanding this garbage is very difficult.  Therefore, try to follow two rules: <br>  Put all objects created through <code>Instantiate()</code> into some object structures.  For example, I now always have a <code>GameObjects</code> object in a scene with category sub-objects into which I put everything I create.  In order to avoid human error, in most cases I have add-ins over <code>Instantiate()</code> like <code>InstantiateDebris()</code> , which immediately put the object in the desired category. <br>  Delete objects that are no longer needed.  For example, some of my add-ins have a call <code>Destroy(gameObject, timeout);</code>  with pre-assigned timeout for each category.  Thanks to this, I don‚Äôt have to worry about cleaning things like blood stains on the walls, bullet holes, projectiles flying into infinity ... <br><br><h3>  Avoid GameObject.Find () </h3><br>  Very expensive in terms of resources function to search for objects.  Yes, and it is tied to the name of the object, which must be changed every time at least in two places (in the scene and in the code).  The same can be said about <code>GameObject.FindWithTag()</code> (I would generally suggest not using tags - you can always find more convenient ways to determine the type of object). <br><br>  If it is very impatient, be sure to cache each call into a variable in order not to do it more than once.  Or even make the connection of objects through the inspector. <br><br>  But you can do and more elegantly.  You can use the class - the repository of references to objects, into which each potentially necessary object is registered, save the <code>GameObjects</code> meta-object from the previous board and search for the necessary objects in it via <code>transform.Find()</code> .  All this is much better than polling each object in the scene about its name in search of the necessary, and then still fall with an error, because you recently renamed this object. <br><br>  By the way, the Transform component implements the <code>IEnumerable</code> interface, which means that you can conveniently bypass all the child objects of the object in this way: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (Transform child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> transform) { child.gameObject.setActive(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }</code> </pre> <br>  Important: unlike most other functions for searching for objects, transform.Find () returns even disabled (gameObject.active == false) objects at the moment. <br><br><h3>  Agree with the artist about the image format </h3><br>  Especially if the artist is yourself.  Especially if the artist has never worked on games and IT projects in general before. <br><br>  I will not be able to give a lot of texture advice for 3D games - I haven‚Äôt dug myself deep into it yet.  It is important to teach the artist to save all the pictures with POT dimensions (Power Of Two, so that each side of the picture is a power of two, for example, 512x512 or 1024x2048), so that they are more efficiently compressed by the engine and do not occupy precious megabytes (which is especially important for mobile games). <br><br>  But I can tell a lot of sad stories about sprites for 2D games. <br><br><ul><li>  Combine the same type of sprites (and especially individual sprites of the same animation) in the overall picture.  If you need 12 sprites of 256x256 pixels in size, then you do not need to save 12 pictures - it is much more convenient to make one 1024x1024 pixel image, and in it spread out sprites on a grid with a side of 256 pixels and use the automatic texture splitting into sprites.  There will be four empty seats - it does not matter, suddenly you will need to add more pictures of this type.  Important: if the slots for sprites become missed, then tell your artist to increase the canvas to new powers of two only to the right and upwards;  in this case, you will not have to edit the meta-data for existing sprites - they will remain at the same coordinates.  <b>UPD by <a href="https://habrahabr.ru/users/konh/" class="user_link">KonH</a></b> : instead of manual placement of sprites, it is more convenient to use the built-in utility <a href="https://docs.unity3d.com/Manual/SpritePacker.html">SpritePacker</a> .  I didn‚Äôt touch her myself yet, so I‚Äôm not able to tell you more details (: </li><li>  Be sure to draw all the project's sprites at the same scale, even if they still turn out to be on different textures.  You can not imagine how much time I spent on adjusting the values ‚Äã‚Äãof Pixels per unit for different sprites of monsters, so that in the game world they were of appropriate sizes.  Now on each texture I have an unused image of the main character, so that you can compare the correspondence of the scales.  Nothing complicated - and so much time and nerves save! </li><li>  Align all sprites of the same type to one common Pivot.  Ideally, the center of the picture or the middle of any side.  For example, all sprites of a player‚Äôs weapons should be placed in the slot (or in a separate image) so that the point at which the player will hold these weapons is exactly in the center.  Otherwise you have to put this Pivot in the editor;  it will be inconvenient, you can forget about it - and the character will hold a spear at the very tip or ax for the base of the blade.  Very stupid character. </li></ul><br><h3>  Install Milestone </h3><br>  What it is?  For good, Mylston (milestones - stones that used to set every mile along the road to mark distances) is a certain state of the project when it has reached its current goals and can move on to further development.  Or maybe not go. <br><br>  Perhaps it was our main mistake when working on a debut project.  We set a lot of goals and went to all at once.  Something was always left unfinished, and we could not say: ‚ÄúBut now the project is really ready!‚Äù Because we constantly wanted to add something else to the existing functionality. <br><br>  Don't do that.  The best way to develop a game is to know the exact set of features and not to deviate from it.  But it hurts rarely when it comes to large-scale industrial development.  Games are often developed and upgraded right in the development process.  So how to stay in time? <br><br>  Make a plan of versions (Miles).  So that each version was a complete game: so that there were no temporary stubs, crutches and unrealized functionality.  So that it would be no shame on any Mailtown to say: ‚ÄúWe‚Äôll finish it!‚Äù And release (or close forever in the closet) a quality product. <br><br><h3>  Conclusion </h3><br>  I was stupid three years ago, right?  I hope you will not repeat my mistakes and save a lot of time and nerves.          ,  ,        . <br><br> <i>PS       ‚Äú       ‚Äù,      Unity         .          .  ,  ?</i> </div><p>Source: <a href="https://habr.com/ru/post/345710/">https://habr.com/ru/post/345710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345700/index.html">Mobile retargeting - the main tool for promoting mobile applications in 2018</a></li>
<li><a href="../345702/index.html">The story of the emergence of financial accounting in my life</a></li>
<li><a href="../345704/index.html">Amazon EC2 vs Atlex Cloud VDC: Performance Comparison</a></li>
<li><a href="../345706/index.html">Distributed backends for 2GIS video advertising on .NET Core and Kubernetes</a></li>
<li><a href="../345708/index.html">Cross-platform New Year's demo on .NET Core and Avalonia</a></li>
<li><a href="../345712/index.html">New to the New Year: a review of Veeam Backup & Replication 9.5 Update 3</a></li>
<li><a href="../345714/index.html">Mathematical models of relay-pulse regulators</a></li>
<li><a href="../345716/index.html">SAP Cloud Platform Webinar Library: from Internet of Things services to machine learning and UX</a></li>
<li><a href="../345724/index.html">Efficient use of process.env</a></li>
<li><a href="../345726/index.html">Mobile devices from the inside. The image structure of partitions containing the file system. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>