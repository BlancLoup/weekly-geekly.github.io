<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Subject-oriented design in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article can be said about sore. 
 Due to the low threshold of entry, the habit of bundling with MySQL, the lack of need for assembly, the lack of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Subject-oriented design in PHP</h1><div class="post__text post__text-html js-mediator-article">  The article can be said about sore. <br>  Due to the low threshold of entry, the habit of bundling with MySQL, the lack of need for assembly, the lack of strong typing and other factors, projects written in PHP often do not shine with quality and contain a lot of piled requests to the database instead of beautiful clean code. <br><br>  PHP is a scripting language, the server responds to the request, and objects die.  Yes, this is not a desktop application. <br>  But this does not mean that the objects of the subject area, with which we must work, are not needed at all. <br>  On the contrary!  They are needed, they should help us save and restore their state, after their removal from memory. <br><br>  In PHP, you can and should write high-quality code, otherwise it does not depend on the language at all! <br>  First of all, the article will be useful for beginners, but I think it will not hurt experienced developers.  Perhaps, in your project, everything is not as it should be? <br><a name="habracut"></a><br>  3 years engaged in the development of PHP and constantly tormented by one thing.  Instead of working with entities in code, we work with the database.  Although this is wrong at the root. <br>  I am sure there are many high-quality products, but in most cases the situation is very sad. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In all projects with which it was necessary to work, in the code there are no clearly defined models of the domain with which to work and the encapsulation that needs to be followed.  Everywhere the same thing. <br><br>  In projects of low quality, the concept of ‚ÄúModel‚Äù is often absent altogether, there is only confusing logic, in the code of which something is pulled out of the database, then a huge heap of cycles and conditions and then the data goes to the template.  Moreover, there are still many applications with bare MySQL queries, at best, through the wrapper over PDO. <br><br>  In higher-quality projects, ORM is used, but this is not something with which I would like to work to implement certain functionality.  Anyway, in order to do something, you need to look at the ‚ÄúModel‚Äù, see the connections, or execute DESC / EXPLAIN in the console, with the database connected. <br>  As a result, the application code does not hide any operations on the data in the entity methods.  And the code where there should be simple (or not) business logic is replete with lines like Orm :: find. <br>  This mess is very upsetting.  Especially when the project is large and impossible to rewrite.  Maximum - in parallel to lead a new code and work with it, and over time, slowly move away from the old one. <br><br>  After reading the remarkable book by Erik Evans, "Object-Oriented Design" (link at the end of the article), or Domain-Driven Design, the thought occurred that basically PHP development comes down to pulling lines from the database. <br><br>  Correctly, in the project there should be objects and their aggregates, through the interface of which you can work with the entities of the domain. <br>  We should not bypass the aggregate and climb into its subordinate objects, and in the same way we should not ‚Äúwrite requests‚Äù instead of working with objects. <br><br>  Objects should be able to maintain their <u>state</u> , as well as recover from the database.  For complex objects and aggregates, you can use factories.  But in no case can you base all logic on mysql queries. <br><br>  However, all projects in which I had to work maliciously violate this architectural rule. <br><br>  I will give a very simple example: <br><br>  Customer - the ‚ÄúCustomer‚Äù entity object <br>  Order - ‚ÄúOrder‚Äù aggregate object <br>  The order unit is an immutable object value ‚ÄúOrderItem‚Äù <br><br>  A customer may have many orders, one order may consist of many units. <br>  The order unit is an immutable value, since  in the event of a change in the price of the goods (as well as the availability of discounts at the customer), or the removal of goods from the store, the order history must be reliable and store in itself the data that was relevant at the time of purchase.  It is wrong to simply refer to the product. <br><br>  And so, you need to write simple logic in the API method / controller, which should display the user's order. <br>  The code is intentionally simplified and shows only the essence.  In this case, it does not matter how the id came, and how we will authorize the user. <br><br>  <b>Option 1:</b> <br><br><pre> $ order = Orm :: find ('Order', [['id', $ id], ['user_id', $ user-&gt; getId ()]]);
 if (! empty ($ order)) {
   $ items = Orm :: find ('OrderItem', [['order_id', $ id]]); 
   return $ items;
 } else {
   return 'Order was not found';
 }
</pre><br><br>  <b>Option 2:</b> <br><br><pre> $ order = $ user-&gt; getOrder ($ id);
 return $ order-&gt; getItems ();
</pre><br><br>  In the first case, we go to the database and get an order with the requested ID from the current user, so as not to issue someone else's order, <br>  then we go to the base and get records from the OrderItem table that are tied to this order. <br>  Next, you will most likely need to ‚Äúiterate‚Äù the result using foreach / array_walk / array_map to bring the data into the desired form. <br><br>  This code certainly works, but it quickly grows the same, and it is duplicated in different parts of the project. <br>  Such challenges completely destroy the built architecture of the project and make it simply meaningless. <br><br>  Accompanying the first version of the code is much more complicated, and it is not read as easily as the second option.  Orm :: find c is not always with such obvious parameters and an extra condition. <br><br>  In the event of some change in the storage of orders in the database, we will have to search and edit all ORM calls, at best. <br><br>  In the second case, we have pronounced entities with a user-friendly interface. <br>  In the <i>getOrder</i> method, the order-user connection test logic is already <i>embedded</i> , in which case, for example, Exception will be thrown.  And the <i>getItems</i> method already has everything you need to simply return a list of positions.  Reading this code, it is immediately clear what it actually does.  In addition, this code is easier to test.  You can even write everything in one line: <br><br><pre>  return $ user-&gt; getOrder ($ id) -&gt; getItems (); </pre><br><br>  <b>Findings:</b> <br><br>  In one of his projects, which another programmer was starting to write, in the course of development, introduce models that not only encapsulate work with a database, but also hide the flaws of its architecture and implicit field names. <br><br>  Write the code so that you enjoy working with it in the future and are easy to maintain. <br>  Since we are writing code using OOP, let's work with objects and use all the advantages of this paradigm. <br>  The business logic we describe in projects is based on entities, and not on mysql samples and arrays.  Do not complicate the life of yourself and others! <br><br>  Do not be lazy to write a class that describes the essence, where necessary, do not be lazy to write a method that will be useful to you again, copy-paste is evil.  And with a set of ready-made entities and ready-made methods, the subsequent development, refactoring and testing will be simplified and accelerated! <br><br>  PS: Article - just food for thought. <br><br>  Book Reference: <a href="http://www.ozon.ru/context/detail/id/5497184/">Eric Evans - Domain-Based Design</a> </div><p>Source: <a href="https://habr.com/ru/post/247775/">https://habr.com/ru/post/247775/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247763/index.html">What lessons did I learn from the not very successful f2p socials</a></li>
<li><a href="../247765/index.html">Types and functions</a></li>
<li><a href="../247769/index.html">How Bitrix didn‚Äôt ruin the New Year</a></li>
<li><a href="../247771/index.html">How to get a lot of street wifi? Experience in building OpenDoor networks with high subscriber density</a></li>
<li><a href="../247773/index.html">Bovanenkovo ‚Äã‚Äã- the organization of communication in the gas field No. 3 in Russia from the BS on permafrost</a></li>
<li><a href="../247779/index.html">How I stopped worrying and loved Hyper-V replication</a></li>
<li><a href="../247781/index.html">Mikrotik - Open and check cooling</a></li>
<li><a href="../247783/index.html">Network hard drive using SSHFS and Raspberry Pi</a></li>
<li><a href="../247785/index.html">Stunning collection of free fonts for 2014</a></li>
<li><a href="../247787/index.html">Quantum mechanics. Theoretical minimum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>