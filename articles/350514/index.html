<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Two-tier ERP and SAP Business One: how it works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 This time we decided to return to the topic of ERP-systems. There are different products in the SAP product line for companies of various si...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Two-tier ERP and SAP Business One: how it works</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  This time we decided to return to the topic of ERP-systems.  There are different products in the SAP product line for companies of various sizes - from multinational corporations to small and medium businesses.  There are combinations - when companies use several types of ERP, for headquarters and for branches.  Such cases are called two-tier ERP, and SAP Business One is great as a ‚Äúlightweight‚Äù system.  In this article we will talk about the details and details of integration. <br><br>  <b>But first, let's answer the question - what is a two-tier ERP?</b> <b><br></b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/hm/jv/on/hmjvonqh0qp5krus25thdfr6c44.png" alt="image"><br><br><a name="habracut"></a><br><br>  The term "two-tier ERP" has already become familiar to many.  The concept of a two-tier ERP system is used in corporations that need a uniform standard for reporting and business applications in their subsidiaries or branches.  In many small business units, for many reasons, it is simply inappropriate to use large ERPs: other business processes, difficulty in adapting employees, and slow deployment, which can take months.  And if you add more time for staff training here, the costs of maintaining the system and with all this you need to implement a ‚Äúbig‚Äù solution in 40 branches at once - it will take a lot of time (often even months) and will require significant costs.  For comparison - ‚Äúsmall‚Äù solutions can be implemented in a few weeks. <br><br>  Two-tier ERP today is applicable not only for large corporations, with their ‚Äúheadquarters =&gt; branch‚Äù relations.  This strategy is viable when dealing with suppliers, distributors, dealers and service organizations. <br><br>  An example of our European client is Heineken Spain.  They had a task - how to establish data exchange between 600 distributors and Heineken Spain on orders, goods movement and invoices for payment and then automate all processes.  As a result, the company decided to develop a solution based on SAP Business One. <br>  In Heinekein Spain, they invented a scenario using the Internet of things - they collect data from more than 300 thousand sensors that are embedded in beer taps.  The company receives information about the consumption of beer with a single information system.  As a result, Heineken realized how to better manage the sales channel, optimize the sales chain and improve performance.  They also began to receive data on beer consumption in real time, one might say, ‚Äúfrom each tap‚Äù. <br><br><img src="https://habrastorage.org/webt/r6/cx/pk/r6cxpkf4igm4dp05pzrgafu0jj4.png"><br><br>  With two-tier ERP systems, not everything is perfect.  Let's see what problems may arise when integrating different systems. <br><br>  Why in general to implement ERP-systems in branches or subsidiaries?  In large holdings or large companies, of course, they want to receive transparent analytics or reporting on business processes.  With this often happens such a problem - in each branch they put their decision, which is convenient for local specialists, and as a result, a ‚Äúzoo‚Äù of systems and services appears in the company.  And of course, they may not be compatible with the "head" ERP for various reasons - for example, due to the use of solutions with closed API.  In this case, you can not rely on a single reporting, nor on any automation of business processes. <br><br>  What does SAP have?  We have a whole line of ERP-systems, for different tasks and goals.  For companies with complex business processes, ‚Äúheavyweights‚Äù are needed - here choose S / 4HANA, ECC or R / 3.  For organizations, SAP Business One is simpler or smaller.  At the same time, B1 can be easily integrated with large SAP solutions - S / 4HANA, Hybris, Ariba, Customer Checkout, Concur, mobile applications and even public services. <br><br><img src="https://habrastorage.org/webt/g4/b8/_m/g4b8_ml9zkcija73mcfgfqigwpm.png"><br><br>  What opportunities does SAP Business One have for developing integration services? <br><br><ul><li>  .Net development for integration via SAP Business One SDK / DI-API </li><li>  .Net development for integration via Service Layer (available for SAP Business One version for SAP HANA) </li><li>  Integration Framework (Integration Platform) </li></ul><br><br>  Features, target audience and scope of application are shown in the table: <br><img src="https://habrastorage.org/webt/3v/e9/8j/3ve98jqcfua83uvpf--yjnx2hts.png"><br><br>  The following article will tell you in detail about the Integration Framework platform. <br><br><h3>  Integration Framework <br></h3><br>  The SAP Business One Integration Framework (B1iF) is available in the SAP Business One ERP system, starting with version 8.8.  It can be installed on a SAP HANA or MS SQL database.  The main objective of B1iF is to send and receive data from external (SAP and non-SAP) systems.  Packages of integration scripts are built inside the Integration Framework.  The script logic is based on business processes: error management, conflicts, transactions (and their order of execution), execution guarantees, monitoring, debugging and administration are performed in B1iF. <br><br><img src="https://habrastorage.org/webt/p8/mv/ws/p8mvws6accevp-oet-0k0utcs-q.png"><br><br>  To develop a scenario for the integration of two systems, programming skills are not required. <br>  The sequence of the process is set using the built-in graphic designer in the platform.  The built-in functional units of B1iF BizFlow Atoms are used for matching values, setting up calls (SAP Business One, SAP ERP, HTTP, SQL, file systems, etc.), XSLT transformations.  Data mapping is done using XSLT transformations in the embedded (or external) XML editor.  Debugging tools allow you to develop an individual process sequence in a structured and visual way. <br><br><img src="https://habrastorage.org/webt/0v/cn/5r/0vcn5rlnv1k_tf0th0cicsqbc7s.png"><br><br>  Integration scripts that run on an integration platform are called script packages.  Everything you need for complete data exchange between systems is in the script package. <br>  A script package contains one or more script steps.  A scenario step is a specific integration flow that includes the inbound phase, the processing phase and the outbound phase. <br><br><img src="https://habrastorage.org/webt/-3/cz/7d/-3cz7dwyjck4ltqfwxm-jz5poaa.png"><br><br>  In the first phase, the integration platform receives the incoming message and translates it into an XML format.  During the processing phase, the message is transformed and processed, the recipient is defined and the message parameters are mapped.  At the output stage, the integration platform transforms the message into the format of the recipient's ERP system and sends the message. <br><br>  In the process of designing a step of a script, it is necessary to set basic parameters: a way to launch a step, which systems interact with each other, how the integration platform processes the message, whether there are further steps (for example, calling an external system). <br><br>  The script steps may be as follows: <br><br>  1. Synchronous (request-response): <br>  - the sender makes a request that initiates the step <br>  - the processing result is returned to the sender as a response <br><img src="https://habrastorage.org/webt/7u/wj/u7/7uwju7o9bqhuwuboxu4jsgffjgu.png"><br><br>  2. Asynchronous (sender to receiver): <br>  - run by timer, event or call <br>  - data comes from the sending system, processed, transformed and transmitted to the recipient at any time <br><img src="https://habrastorage.org/webt/yz/rk/oi/yzrkoilgldyujfdfr7ohrmguqsu.png"><br><br>  An inbound channel describes the type of sender system and an interface (API) that an integration platform can use to receive incoming data.  HTTP, file, empty message (Void (timer)), Web Service, SAP Business One and SAP ERP can be used as an incoming channel. <br><br>  The outgoing channel describes the type of recipient system and the interface (API) that the integration platform will use for data transfer.  HTTP, file, empty message (Void, for synchronous steps only), Web Service, database, SAP Business One and SAP ERP can be selected as the outgoing channel. <br><br>  A graphic tool is used for the processing phase.  The main design element are atoms.  Atoms are arranged in a sequence and are used to call external systems (for example, a SQL database or email).  Each atom receives an incoming message, performs certain tasks, and passes the message to the next atom. <br><br><img src="https://habrastorage.org/webt/hy/xf/fm/hyxffm8zy0q7caahqhjircdfahw.png"><br><br>  To transfer data between integration steps, an internal queue processing mechanism is used.  In this way, integration steps can be combined into a script package. <br><br>  <b>An example of developing an integration scenario</b> <b><br></b> <br><br>  Businesses need access to real-time data about their processes, as well as automation of manual labor.  Automating processes can help a company optimize staff utilization and reduce the risk of errors in information transfer.  Integration with the supplier‚Äôs system or a separate type of business will eliminate these risks. <br><br>  Let's look at a simple practical example of the integration of two systems - the customer and the supplier.  Both companies work in SAP Business One and want to automate the process of placing orders.  In this example, the ‚ÄúPurchase Order‚Äù in Company 1 is transferred to Company 2, where the ‚ÄúSales Order‚Äù document is generated.  Company 2 confirms the formation of the order in the company 1. <br><br><img src="https://habrastorage.org/webt/ph/cb/lo/phcblojfyp-c-zj1wdszamnkuig.png"><br><br>  The integration scenario can be launched by creating a Purchase Order document in company 1. There will be 2 integration steps in the scenario: <br><ul><li>  in the first step, a sales order document is formed in company 2 using the atom B1 Object call </li><li>  Call Step atom is used to bind with the second step </li><li>  the second step informs the user of company 1 about the status of the created document ‚ÄúSales order‚Äù </li></ul><br><br><img src="https://habrastorage.org/webt/x6/hy/ga/x6hyga7j5zasabyuqbuueepjwuc.png"><br><br>  To run the integration scenario, we will need the company master data code 1. This data is not contained in the ‚ÄúOrder‚Äù and is not transmitted to the integration platform.  A global table can be used to store this information.  To set global table parameters, it is necessary to define the type of global table (type 1 for relations 1 &lt;-&gt; 1; type 2 for relations 1 &lt;-&gt; N), the length and names of the table fields: <br><br><img src="https://habrastorage.org/webt/xi/-f/ke/xi-fkekq0tlxtyyym1pakenukto.png"><br><br>  After creating a global table, we can enter data into it: <br><br><img src="https://habrastorage.org/webt/0k/0n/ho/0k0nho_3bjs8uquxwhrd3_2u7nu.png"><br><br>  Next, for integration step 1, we define the incoming channel: <br><ul><li>  channel type - SAP Business One </li><li>  launch on event B1 Event (creating a document ‚ÄúPurchase order‚Äù) </li><li> as an identifier is used the object ID "Purchase Order" (22) </li><li>  Data acquisition by DI-API with type Object </li></ul><br><br><img src="https://habrastorage.org/webt/lm/9y/xs/lm9yxsgvknsomied5frucuavwny.png"><br><br>  For the outgoing channel, select an empty message (void), since  we do not have a recipient system: <br><br><img src="https://habrastorage.org/webt/wl/cu/xd/wlcuxdkwgpxbngnomz2zbweul8o.png"><br><br><img src="https://habrastorage.org/webt/_u/lq/nt/_ulqntfctxpzhn9kupsb72vlmgy.png"><br><br>  Let us turn to the configuration of the processing message.  The numbering of atoms is carried out in the order of addition to the process. <br><br>  The transform atom (atom1) is optional.  It allows you to store information about the launch conditions and the sending system for later use in other atoms.  The CustomerCode value for company 1 is loaded from the global table.  The User ID value is selected from section T (trigger, trigger) of the XML transformation of the incoming B1 Event, which creates a ‚ÄúPurchase Order‚Äù. <br><br><img src="https://habrastorage.org/webt/ox/yz/ur/oxyzur1cw_rbmivb0gouwebcd5s.png"><br><br><pre><code class="sql hljs">&lt;Values&gt; &lt;xsl:variable name="MappingCardCode" <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"document('/com.sap.b1i.vplatform.scenarios.design/vPac.xxx.B2BB1/vTbl.B1MappingCardCode.xml')"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"Vendor"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$msg/BOM/BO/Documents/row/CardCode"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"Customer"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$MappingCardCode/table/row[./col[2]=$Vendor]/col[1]"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;CustomerCode&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$Customer"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/CustomerCode&gt; &lt;B1User&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"/vpf:Msg/vpf:Body/vpf:Payload[./@Role='T']/Event/b1e:b1events/b1e:b1event/b1e:userid"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/B1User&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Values</span></span>&gt;</code> </pre> <br><br>  When configuring an atom B1 Object (atom2) we will use the following parameters: <br><br><ul><li>  Sysid: ID assigned by SAP Business One in the integration platform </li><li>  B1 Login: assigned from the settings of the integration platform </li><li>  Method: synchronous </li><li>  Object identifier: 17 (sales order) </li><li>  Key Name: DocEntry </li><li>  Key Value: N / A (filled automatically when the document is created in SAP Business One) </li><li>  Payload: the name of the previous conversion atom </li></ul><br><br><img src="https://habrastorage.org/webt/4t/zo/xl/4tzoxlciszy_l570w8rnou_nt-c.png"><br><br>  Before the atom B1 Object we use the preceding transform atom (atom3).  In this atom, information is prepared for loading into atom2 (B1 Object). <br>  In the Documents section, you need to define the values ‚Äã‚Äãof the header of the document ‚ÄúSales order‚Äù: <br><ul><li>  customer master data code for company 1 (CardCode) </li><li>  The document date (DocDate) is set by calling the date and time function built into the integration platform, which returns the current date and time </li><li>  Shipping Date (DocDueDate) is calculated based on DocDate </li></ul><br><br>  The Document_Lines section defines the lines of the Sales Order document.  The necessary information is extracted from section S (the message from the sender system, sender message) of the incoming ‚ÄúPurchase order‚Äù document. <br><br><img src="https://habrastorage.org/webt/0b/jz/oo/0bjzoode6isrd8qul3x5q24fm9y.png"><br><br><pre> <code class="sql hljs">&lt;Documents&gt; &lt;row&gt; &lt;xsl:variable name="date"&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"b1ilib.today"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&gt; &lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;DocDate&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$date"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/DocDate&gt; &lt;DocDueDate&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"b1ilib.date_plus"</span></span>&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-param <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"date"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$date"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-param&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-param <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"x"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-param&gt; &lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">call</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&gt; &lt;/DocDueDate&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"Customer"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"/vpf:Msg/vpf:Body/vpf:Payload[./@id='atom1']/Values/CustomerCode"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;CardCode&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$Customer"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/CardCode&gt; &lt;NumAtCard&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$msg/BOM/BO/Documents/row/DocNum"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/NumAtCard&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>&gt; &lt;/Documents&gt; &lt;Document_Lines&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">each</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$msg/BOM/BO/Document_Lines/row"</span></span>&gt; &lt;<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>&gt; &lt;ItemCode&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"ItemCode"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/ItemCode&gt; &lt;Quantity&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"Quantity"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/Quantity&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">row</span></span>&gt; &lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">each</span></span>&gt; &lt;/Document_Lines&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> href=<span class="hljs-string"><span class="hljs-string">"../../com.sap.b1i.system.lib/xsl/datetime.xsl"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>&gt;</code> </pre><br><br>  The terminating atom (atom0), as a rule, converts the data for transfer to the recipient system.  In our scenario, an empty message (void) is selected as the outgoing channel type.  However, we must define this atom to create an entry in the logs.  The element will contain the attributes DIresult and DImsg.  The DImsg attribute must contain the key of the created document (in case of successful completion of the script) or an error message (in case of unsuccessful execution). <br><br><img src="https://habrastorage.org/webt/6j/zi/87/6jzi87z76ywqgnxytugio1ao-ji.png"><br><br><pre> <code class="sql hljs">&lt;xsl:variable name="Status" <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$msgB1/@DIresult"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=<span class="hljs-string"><span class="hljs-string">"Entry"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"$msgB1/@DImsg"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">variable</span></span>&gt; &lt;Msg&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"concat('Message: ',$Status, ', DocEntry: ',$Entry)"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/Msg&gt;</code> </pre><br><br>  Atom4 and atom5 belong to the second integration step: sending a message to user of company 1. A call atom (with type Call step) does not imply a prior conversion atom.  However, as in the case of the first step, for atom4 we define the preceding transformation atom (atom5).  In the parameters of the atom5 we indicate the data transmitted to the called atom.  In our case, this data will contain an element with DIresult attributes (the result of processing the B1 Object atom) and an SAP Business One user code (B1User). <br><br><img src="https://habrastorage.org/webt/6j/zi/87/6jzi87z76ywqgnxytugio1ao-ji.png"><br><br><pre> <code class="sql hljs">&lt;B1Result&gt; &lt;Result&gt; &lt;xsl:value-of <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"/vpf:Msg/vpf:Body/vpf:Payload[./@id='atom2']/@DIresult"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">Result</span></span>&gt; &lt;B1User&gt; &lt;xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span>=<span class="hljs-string"><span class="hljs-string">"/vpf:Msg/vpf:Body/vpf:Payload[./@id='atom1']/Values/B1User"</span></span>&gt;&lt;/xsl:<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">of</span></span>&gt; &lt;/B1User&gt; &lt;/B1Result&gt;</code> </pre><br><br>  For the atom of the call, we set the parameters: <br><ul><li>  type of processing of the called atom (synchronous or asynchronous) </li><li>  name of the called atom </li><li>  atom with input parameters (preceding transform atom) </li></ul><br><br><img src="https://habrastorage.org/webt/38/ns/2-/38ns2-jiij7klrwfepbp3dhygyy.png"><br><br>  Let us proceed to the formation of the second integration step.  We want to send different messages to user company 1 depending on the result of the document creation process.  For this we will use an atom with the type of the beginning of branching (branch). <br><br><img src="https://habrastorage.org/webt/39/z9/dn/39z9dn51mucwpezo894oyatgilw.png"><br><br>  For atoms with conditions, several atoms with the path type can be used and only one atom of the type otherwise.  The integration platform only works with true results when executing the path.  Therefore, in our case, you only need to specify the condition for the path atom: <br><br>  /*[/vpf:Msg/vpf:Body/vpf:Payload[./@Role='S'/B1Result/Result = 'success'] <br><br>  The atom otherwise will work only if the result of the path atom is false.  The unbranch atom completes branching and contains the results of atom conditions. <br><br><img src="https://habrastorage.org/webt/zf/bx/sm/zfbxsm7vnmaywea2pedh16pzqvi.png"><br><br>  In the parameters of the atoms B1 Message, you must specify the subject and text of the message, as well as information about the user <br><br>  /vpf:Msg/vpf:Body/vpf:Payload[./@Role='S'/B1Result/B1User <br><br><img src="https://habrastorage.org/webt/tu/-m/hg/tu-mhgti6je1yvr-snzbkkbsz9y.png"><br><br>  In the final atom of the second integration step, it is necessary to check the execution of branching.  To do this, you can use the XSL template stored in the integration platform. <br><br><img src="https://habrastorage.org/webt/-k/ko/kf/-kkokfuxwtlbkajcrbltzqy68us.png"><br><br>  <b>Script activation and validation</b> <b><br></b> <br>  The integration platform verifies the integrity of the integration scenario when opening the script configuration window. <br><br><img src="https://habrastorage.org/webt/eh/br/66/ehbr66jxgnr0qc_9zj7suddorau.png"><br><br>  In our case, the test was successful, and we can proceed to the execution of the script. <br>  Create a "Purchase Order" in the database of company 1 from the supplier V22222. <br><br><img src="https://habrastorage.org/webt/gb/xg/ae/gbxgaeyp7rpt5qysv9tsoqfjpry.png"><br><br>  After creating the document, we see a notification from the user B1i that the order was created successfully: <br><br><img src="https://habrastorage.org/webt/6r/op/3k/6rop3kbjlapkwb1if3wppqa6jxg.png"><br><br>  In company 2, a sales order was created with data from the purchase order and an indication of the document number in company 1: <br><br><img src="https://habrastorage.org/webt/yw/ms/wg/ywmswgqh154c6tjmhyoj18yjqhu.png"><br><br>  <b>Conclusion</b> <b><br></b> <br>  As a conclusion, I suggest watching the video of our client - the company DeLaval.  The company has been actively using the two-tier ERP strategy for a long time: in the head office and in large branches - SAP ERP, and in small subsidiaries - SAP Business One.  In <a href="https://youtu.be/a-2FqZSDwMU">this video,</a> Steve Woodgate, Business Integration Director at DeLaval, talks about the reasons and results for choosing SAP Business One as a second-level ERP. <br><br>  You can get acquainted with examples of SAP Business One implementations <a href="https://www.sapb1repository.com/">on our website</a> . <br><br>  Video with reviews of the solutions and not only available <a href="https://www.youtube.com/user/businessonesap/featured">on our Youtube channel</a> . <br><br>  In the next article we will talk about the capabilities of the new version of SAP Business One 9.3, which is now actively testing both SAP and customers.  By the way, one of the first ‚Äúlive‚Äù customers in the world on SAP Business One version 9.3 was the customer from Russia - Telecom-Exchange.  A video with customer comments can be viewed here: <a href="https://youtu.be/GTgm-nJddDI">youtu.be/GTgm-nJddDI</a> <br><br>  Thank you all for reading and feedback! </div><p>Source: <a href="https://habr.com/ru/post/350514/">https://habr.com/ru/post/350514/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350502/index.html">Rational prioritization of key operations</a></li>
<li><a href="../350504/index.html">Unit testing of react components withRouter (jest, enzyme)</a></li>
<li><a href="../350508/index.html">Lessons to learn from the LLVM / Clang codebase</a></li>
<li><a href="../350510/index.html">Collector task</a></li>
<li><a href="../350512/index.html">Using the KOMPAS-3D API ‚Üí Lesson 7 ‚Üí Getting to know the settings</a></li>
<li><a href="../350516/index.html">Using the KOMPAS-3D API ‚Üí Lesson 8 ‚Üí More complex methods of writing to the title block</a></li>
<li><a href="../350520/index.html">Google, Qualcomm and cloud gaming services. Integration success?</a></li>
<li><a href="../350524/index.html">Results of MentorHack: chat bot for selecting conversations from dialogues, services for building career paths and teams</a></li>
<li><a href="../350526/index.html">WhiteList vs BlackList: how to implement file extension checks and not become a victim of hackers</a></li>
<li><a href="../350528/index.html">How we did the Olympiad in SQL (end)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>