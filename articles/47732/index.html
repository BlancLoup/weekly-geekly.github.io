<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C ++ / CLI - sticky tongue</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this topic I will talk about C ++ / CLI - an intermediate language for pasting code in C / C ++ and .NET 

 This is a fairly common task, because t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C ++ / CLI - sticky tongue</h1><div class="post__text post__text-html js-mediator-article">  In this topic I will talk about C ++ / CLI - an intermediate language for pasting code in C / C ++ and .NET <br><br>  This is a fairly common task, because tons of time-tested high-performance code written in C / C ++ cannot be rewritten into controlled languages. <br><br>  Our task is to provide a .NET interface to these libraries.  But how to do it if they are written in C / C ++? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Microsoft offers two solutions to the problem. <br><br><a name="habracut"></a><br><h1>  P / Invoke </h1><br>  The first is the Platform Invoke mechanism, with which you can use libraries with C <a href="http://en.wikipedia.org/wiki/Application_binary_interface">ABI</a> .  It looks something like this: <br><br><pre><code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">DllImport (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user32.dll"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MessageBeep</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.UInt32 type</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><br>  P / Invoke provides <a href="http://en.wikipedia.org/wiki/Marshalling_(computer_science)">marshalling</a> (translation) of all simple data types, as well as strings, structures with fields, and even callback functions (delegates). <br><br><br><h1>  C ++ / CLI </h1><br>  But what if the library does not have a C-interface, or P / Invoke‚Äôs capabilities are missing?  C ++ / CLI comes to the rescue. <br><br>  This is the ideal language for generating <a href="http://en.wikipedia.org/wiki/Glue_code">glue code</a> between managed and unmanaged execution environments, because it allows you to generate code for both environments + generates a transition code, eliminating the need to glue something manually. <br><br>  CLI suffix - indicates that the language implements the <a href="http://ru.wikipedia.org/wiki/Common_Language_Infrastructure">Common Language Infrastructure</a> specification, i.e.  is a full member of the .NET platform language family <br><br>  So, we will need Visual C ++ Express 2008. Click on ‚ÄúNew Project‚Äù, select the project type - CLR.  This will create a project with the default / clr (Use Common Language Runtime) option set.  This means that the compiler will generate the correct MSIL build and will let us use the new syntax - which we will now consider. <br><br><br><h1>  Crash course </h1><br><h3>  Allocation of managed / unmanaged-blocks </h3><br>  By default, the compiler considers all C ++ project code to be compiled into MSIL.  Most likely, it will not work (it will not compile), and if it compiles, then this is most likely not what you would like. <br><br>  Special preprocessor commands allow you to specify which part of the code should be compiled in x86, and which part in MSIL. <br><br><pre> <code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">/* ...   ... */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> unmanaged </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...   ++ ... */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> managed </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ...    ... */</span></span></span></span></code> </pre> <br><br>  Most likely, if you connect a library, you will first have to compile it into a static .lib and remember to wrap its headers in the <code>#pragma unmanaged</code> block.  Or build a library into one large .c file (translation unit) - as in <a href="http://www.sqlite.org/amalgamation.html">SQLite amalgamation</a> . <br><br><h3>  Connecting MSIL assemblies </h3><br>  Again preprocessor: <br><br><pre> <code class="hljs css"><span class="hljs-selector-id"><span class="hljs-selector-id">#using</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">System</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dll</span></span>&gt; <span class="hljs-selector-id"><span class="hljs-selector-id">#using</span></span> "..\<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyLocalAssembly</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dll</span></span>"&gt;</code> </pre> <br><br><h3>  Namespaces </h3><br>  Here, just like in regular C ++: <br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> System::Collections::Generic;</code> </pre> <br><br><h3>  Type-value declaration </h3><br>  This is what in C # is called ‚Äústruct‚Äù. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Vector</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> X; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Y; Vector (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y) : X (x), Y (y) {} };</code> </pre> <br><br><h3>  Reference type declaration, methods, properties </h3><br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Resource</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PublicMethod</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... } property <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> SomeProperty { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { ... } }; };</code> </pre> <br><br>  By the way, interestingly, C ++ / CLI supports some CLR features that are not implemented in C #.  For example, property indexers - you can define indexers (operator []) for individual properties, and not just for the entire class.  Here only such code cannot be caused from C # :) <br><br><h3>  Interface type declaration </h3><br>  What is called interface in C #: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">class</span></span> <span class="hljs-title"><span class="hljs-title">IApplicationListener</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnWait</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnd</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; };</code> </pre> <br><br><h3>  Enum's </h3><br><br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderMode</span></span></span><span class="hljs-class"> {</span></span> Normal = FT_RENDER_MODE_NORMAL, Light = FT_RENDER_MODE_LIGHT, Mono = FT_RENDER_MODE_MONO, LCD = FT_RENDER_MODE_LCD };</code> </pre> <br><br><h3>  Life inside the method - basic syntax </h3><br><br><pre> <code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">/*   GC-, nullptr ‚Äî  null  C# */</span></span> System::String ^ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  , gcnew ‚Äî  new  C#,      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> gcnew System::Exception (<span class="hljs-string"><span class="hljs-string">L"   "</span></span>);</code> </pre> <br><br><h3>  Generics, type constraints, arrays </h3><br><br>  Here the generic keyword is used similarly to template in C ++: <br><br><pre> <code class="hljs ruby">generic&lt;typename T&gt; where T : value <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Buffer</span></span></span><span class="hljs-class"> ^ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateVertexBuffer</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">array</span></span></span><span class="hljs-class">&lt;T&gt; ^ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">elements</span></span></span><span class="hljs-class">) { /*  </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">array</span></span></span><span class="hljs-class">&lt;T&gt; ‚Äî </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CLR</span></span></span><span class="hljs-class">-,  </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">[]  </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">C</span></span></span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># */ }</span></span></span></span></code> </pre> <br><br><h3>  Making a wrapper for unmanaged resource </h3><br>  Very frequent task.  We use the IDisposable pattern. <br><br>  Pay particular attention that C ++ - the destructor in the ref class is automatically translated into the Dispose () method.  For finalizers, a different syntax is used. <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Tessellator : <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>::IDisposable { <span class="hljs-type"><span class="hljs-type">internal</span></span>: //       Unmanaged::Tessellator * tess; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: Tessellator (<span class="hljs-type"><span class="hljs-type">int</span></span> numSteps) { tess = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Unmanaged::Tessellator (numSteps); } ~Tessellator () // IDisposable::Dispose () { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> tess; } };</code> </pre> <br><br><h3>  We receive the crude pointer on GC-object </h3><br>  This operation in the CLR architecture is called ‚Äúpinning‚Äù.  When ‚Äúnailing‚Äù the object is prohibited to move in the heap during garbage collection and compaction of the heap.  This allows unmanaged code to use the address of the object and write / read something at that address. <br><br>  Be careful, as nailing objects interferes with the garbage collector and strongly fragments the pile.  This operation is intended only for short-term manipulations with heap objects. <br><br>  "Pinned" pointers are implemented in C ++ / CLI as a template <a href="http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization">RAII</a> -type <pre> <code class="hljs rust"><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> pin_ptr&lt;T&gt; p = &amp;(elements[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/*   , *       */</span></span> void * address = p; }</code> <br> <br>   <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  wide <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ path = ... <span class="hljs-comment"><span class="hljs-comment">/*  ""     String */</span></span> pin_ptr&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  ANSI C  (RAII-): <br> <br> <code><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringToANSI</span></span></span></span> { private: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * p; public: StringToANSI (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ s) : p ((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p; } };</code> <br> <br>  ANSI-  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <br> <br> <code><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * ptr = <span class="hljs-string"><span class="hljs-string">"ANSI string"</span></span>; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = gcnew System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </pre> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <h3> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </h3> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <pre> <code class="hljs rust"><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> pin_ptr&lt;T&gt; p = &amp;(elements[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/*   , *       */</span></span> void * address = p; }</code> <br> <br>   <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  wide <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ path = ... <span class="hljs-comment"><span class="hljs-comment">/*  ""     String */</span></span> pin_ptr&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  ANSI C  (RAII-): <br> <br> <code><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringToANSI</span></span></span></span> { private: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * p; public: StringToANSI (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ s) : p ((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p; } };</code> <br> <br>  ANSI-  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <br> <br> <code><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * ptr = <span class="hljs-string"><span class="hljs-string">"ANSI string"</span></span>; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = gcnew System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </pre> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <pre> <code class="hljs rust"><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> pin_ptr&lt;T&gt; p = &amp;(elements[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/*   , *       */</span></span> void * address = p; }</code> <br> <br>   <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  wide <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ path = ... <span class="hljs-comment"><span class="hljs-comment">/*  ""     String */</span></span> pin_ptr&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  ANSI C  (RAII-): <br> <br> <code><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringToANSI</span></span></span></span> { private: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * p; public: StringToANSI (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ s) : p ((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p; } };</code> <br> <br>  ANSI-  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <br> <br> <code><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * ptr = <span class="hljs-string"><span class="hljs-string">"ANSI string"</span></span>; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = gcnew System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </pre> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <pre> <code class="hljs rust"><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> pin_ptr&lt;T&gt; p = &amp;(elements[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/*   , *       */</span></span> void * address = p; }</code> <br> <br>   <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  wide <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ path = ... <span class="hljs-comment"><span class="hljs-comment">/*  ""     String */</span></span> pin_ptr&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  ANSI C  (RAII-): <br> <br> <code><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringToANSI</span></span></span></span> { private: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * p; public: StringToANSI (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ s) : p ((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p; } };</code> <br> <br>  ANSI-  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <br> <br> <code><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * ptr = <span class="hljs-string"><span class="hljs-string">"ANSI string"</span></span>; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = gcnew System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </pre> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <h3> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </h3> <code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <pre> <code class="hljs rust"><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> pin_ptr&lt;T&gt; p = &amp;(elements[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">/*   , *       */</span></span> void * address = p; }</code> <br> <br>   <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  wide <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ path = ... <span class="hljs-comment"><span class="hljs-comment">/*  ""     String */</span></span> pin_ptr&lt;<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>  ANSI C  (RAII-): <br> <br> <code><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringToANSI</span></span></span></span> { private: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * p; public: StringToANSI (<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ s) : p ((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p; } };</code> <br> <br>  ANSI-  System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>: <br> <br> <code><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> * ptr = <span class="hljs-string"><span class="hljs-string">"ANSI string"</span></span>; System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ^ <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = gcnew System::<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code><code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </pre> <code><code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> <h1> <code><code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </h1> <code><code><code><code><code>pin_ptr.    std::auto_ptr ( ,  ).    pin_ptr   , GC-  . <br> <br> generic&lt;typename T&gt; where T : value class Buffer ^ CreateVertexBuffer (array&lt;T&gt; ^ elements) { /*      */ pin_ptr&lt;T&gt; p = &amp;(elements[0]); /*   , *       */ void * address = p; }</code> <br> <br>   <br> <br>  System::String  wide char  (wchar_t *): <br> <br> <code>#include &lt;vcclr.h&gt; System::String ^ path = ... /*  ""     String */ pin_ptr&lt;const wchar_t&gt; pathChars = PtrToStringChars (path);</code> <br> <br>  System::String  ANSI C  (RAII-): <br> <br> <code>struct StringToANSI { private: const char * p; public: StringToANSI (String ^ s) : p ((const char*) ((Marshal::StringToHGlobalAnsi (s)).ToPointer ())) { } ~StringToANSI() { Marshal::FreeHGlobal (IntPtr ((void *) p)); } operator const char * () { return p; } };</code> <br> <br>  ANSI-  System::String: <br> <br> <code>const char * ptr = "ANSI string"; System::String ^ str = gcnew System::String (ptr);</code> <br> <br>    GC-  unmanaged- <br>         -   .        .   C++/CLI         . ,      <code>gcroot: <br> <br> #include &lt;msclr/auto_gcroot.h&gt; #pragma unmanaged class UnmanagedWindowCounterpart { private: /*     */ gcroot&lt;IInputEventListener ^&gt; MouseEventListener; ... };</code> <br> <br>  <br> <br>       ,     .      MSDN. <br> <br> Happy coding!</code></code></code></code> </div><p>Source: <a href="https://habr.com/ru/post/47732/">https://habr.com/ru/post/47732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../47719/index.html">UFOs both flew and fly away</a></li>
<li><a href="../47721/index.html">Microsoft "borrowed" the name for the X-Box 360 from Sony</a></li>
<li><a href="../47723/index.html">The start of sales of the Emotiv EPOC is postponed to 2009.</a></li>
<li><a href="../47725/index.html">Semicolon evolution</a></li>
<li><a href="../47728/index.html">The first version of Zine, a Wordpress clone in Python, has been released.</a></li>
<li><a href="../47733/index.html">FTP server joke ¬©</a></li>
<li><a href="../47737/index.html">Come the developer's ammunition! # 3</a></li>
<li><a href="../47742/index.html">Create your own personal OpenID</a></li>
<li><a href="../47743/index.html">Who added to myself my habratopik?</a></li>
<li><a href="../47747/index.html">Gift wrapping like geeks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>