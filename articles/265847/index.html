<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using ES6 in AngularJs 1.x with Browserify + Babel build</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will look at how to write the components of AngularJs on an ES6 application, then build using Browserify and Babel based on a small...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using ES6 in AngularJs 1.x with Browserify + Babel build</h1><div class="post__text post__text-html js-mediator-article">  In this article we will look at how to write the components of AngularJs on an ES6 application, then build using Browserify and Babel based on a small application that you can download from <a href="https://github.com/SRobertZ/es6angular">github</a> and play around. <br><a name="habracut"></a><br>  <b>Writing Controller</b> <br><br>  The controller in AngularJs is a constructor function that can extend the generated scope either by injecting the $ scope parameter into the controller's constructor, or by using the controller as approach.  First, we consider a more common approach through injecting $ scope using the example of a registration controller: <br><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SignupController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>($scope, $state, accountService) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.init($scope, $state, accountService); } init($scope, $state, accountService) { $scope.signup = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ accountService.signup().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> { $state.go(<span class="hljs-string"><span class="hljs-string">'main.list'</span></span>); }); }; } } SignupController.$inject = [<span class="hljs-string"><span class="hljs-string">'$scope'</span></span>, <span class="hljs-string"><span class="hljs-string">'$state'</span></span>, <span class="hljs-string"><span class="hljs-string">'accountService'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> {SignupController}</code> </pre> <br>  As you can see, the controller is represented by the ES6 class, which injects dependencies of $ scope and two services into the constructor. <br><br>  Here I want to immediately note that we have lost the ability to enumerate dependencies using inline array annotation, that is, as follows: <br><pre> <code class="javascript hljs">someModule.controller(<span class="hljs-string"><span class="hljs-string">'MyController'</span></span>, [<span class="hljs-string"><span class="hljs-string">'$scope'</span></span>, <span class="hljs-string"><span class="hljs-string">'greeter'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope, greeter</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... }]);</span></span></code> </pre><br>  Thus, the possibility of specifying dependencies and their order of injection remains only through the $ inject property defined in the created SignupController class. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second way to define a controller using the ‚Äúcontroller as‚Äù approach looks more ‚Äúmagical‚Äù in combination with the ES6 class.  And when writing a controller, I think it is most preferable. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _state = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _accountService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigninController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>($state, accountService) { _state.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, $state); _accountService.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, accountService); } login() { _accountService.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).login().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">=&gt;</span></span> { _state.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).go(<span class="hljs-string"><span class="hljs-string">'main.list'</span></span>); }); }; } SigninController.$inject = [<span class="hljs-string"><span class="hljs-string">'$state'</span></span>, <span class="hljs-string"><span class="hljs-string">'accountService'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> {SigninController}</code> </pre><br>  Apparently the class has lost the explicit mention of scope, has become a bit more independent of AngularJs, and even dependencies are injected through the constructor.  But now private variables appear in the class, and with them the problem of using them within the class.  The article " <a href="http://habrahabr.ru/post/257305/">Implementing private fields using WeakMap in JavaScript</a> " is very accessible about this and the best solution to guarantee the release of resources and the belonging of variables only to this class will be the use of WeakMap- from the minuses - we write a little more code, we sleep well. <br><br>  Now we have to do the last step - declare the Controller in the Angular module. <br><br>  To do this, I created a separate module.js file, in which ES6 modules are imported and registered in Angular modules. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> router <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./router.js'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {SigninController} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./controllers/signin/signin.controller.js'</span></span>; angular.module(<span class="hljs-string"><span class="hljs-string">'account'</span></span>).controller(<span class="hljs-string"><span class="hljs-string">'SigninController'</span></span>, SigninController);</code> </pre><br>  <b>Writing Provider, Factory, Service</b> <br><br>  The next step will be the introduction of some business logic class ‚Äî in my case this will be the AccountService class. <br><br>  It looks as magical as the previous class - without any mention of AngularJs <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> api <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./accountApi.factory.js'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AccountService</span></span></span><span class="hljs-class"> </span></span>{ login(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.login(); } signup(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> api.signup(); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> {AccountService}</code> </pre><br>  Note that the AccountService class depends on the module declared in the accountApi.factory.js file, but the dependency is imported, rather than being injected using the DI mechanism provided by AngularJs.  In principle, the AccountService controller described above could have been imported, not injected.  It all depends on how you want to build your application. <br><br>  So the service class is described, it now remains to declare the service in the Angular module. <br><br>  The Angular service is the easiest to announce.  With Factory and Provider, everything is a few lines more complicated. <br><br>  We declare the service in our module.js file: <br><br><pre> <code class="javascript hljs">........ import {AccountService} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./services/accountService.factory.js'</span></span>; ......... angular.module(<span class="hljs-string"><span class="hljs-string">'account'</span></span>).service(<span class="hljs-string"><span class="hljs-string">'accountService'</span></span>, AccountService);</code> </pre><br>  Everything is simple here - an instance of the AccountService class will be created using the new operator, since the service method expects a constructor function. <br><br>  What code would look like if we needed to declare a provider: <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'account'</span></span>).provider(<span class="hljs-string"><span class="hljs-string">'accountService'</span></span>, providerBuilder(AccountService)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">providerBuilder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">obj</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$get = [<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> obj(); }]; } }</code> </pre><br>  And finally, if we needed a factory: <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'account'</span></span>).factory(<span class="hljs-string"><span class="hljs-string">'accountService'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AccountService()});</code> </pre><br>  And it is better to declare a static function in the class AccountService, which will create an instance of the class and then the code will look like this: <br><br><pre> <code class="javascript hljs">angular.module(<span class="hljs-string"><span class="hljs-string">'account'</span></span>).factory(<span class="hljs-string"><span class="hljs-string">'accountService'</span></span>, AccountService.createInstance);</code> </pre><br>  I will give an example with similar behavior below. <br><br>  <b>Write directive</b> <br><br>  The directive will look like this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _accountService = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Copyright</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>($templateCache, accountService) { _accountService.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, accountService); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.restrict = <span class="hljs-string"><span class="hljs-string">'E'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.template = $templateCache.get(<span class="hljs-string"><span class="hljs-string">'account/directives/copyright/copyright.directive.html'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope = {}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.controller = [<span class="hljs-string"><span class="hljs-string">'$scope'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$scope</span></span></span><span class="hljs-function">) </span></span>{ $scope.copyright = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Page - 2015'</span></span>; }; }]; } link(scope) { scope.doSomething = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//-  var accountService= _accountService.get(Copyright.instance); //-  } } static createInstance($templateCache, accountService) { Copyright.instance = new Copyright($templateCache, accountService); return Copyright.instance; } } Copyright.createInstance.$inject = ['$templateCache', 'accountService']; export {Copyright}</span></span></code> </pre><br>  My directive does nothing, but it has all the main parts. <br><br>  In class, I define all the standard directive fields that are needed and I want to focus your attention on how the directive is declared. <br>  The directive is declared in the Angular module almost as well as the factory, but there is one small difference: this constructor function will not be equal to this in the link function and therefore I keep a reference to this in the instance field of the class. <br><br>  Similarly, you can declare filter, constant, and value. <br><br>  <b>Build project</b> <br><br>  So, we wrote some code that is broken into ES6 modules and now we need to put it together.  Browserify is responsible for finding dependencies of modules and assembling them into one file.  To do this, first determine the entry point from which the assembly will begin. <br><br>  I propose to define 2 points of entry - entry point of the module - that is, this is a file that imports modules / files of its module only and a common entry point that combines the entry points of the modules. <br><br>  But I have only 1 module and therefore there will be only 2 such files too: <br><ol><li>  The module.js file located in the root of the account folder and having relative links to all used module files </li><li>  The app.js file located in the root of the application and having links to all the module.js files of the project </li></ol><br>  The second task is to convert the code written on ES6 to ES5.  This task will be performed by Babel, connected to Browserify as a plugin using the transform option. <br><br>  The code for the builder, as well as the project code, can be found in <a href="https://github.com/SRobertZ/es6angular">the github repository</a> . <br><br>  <b>Literature:</b> <br><ol><li>  <a href="https://docs.angularjs.org/guide">Guide to AngularJS Documentation</a> </li><li>  <a href="http://habrahabr.ru/post/257305/">Implementing Private Fields with WeakMap in JavaScript</a> </li><li>  <a href="">Fast browserify builds with watchify</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/265847/">https://habr.com/ru/post/265847/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265835/index.html">IBM Cognos BI and QlikView, where to start curious?</a></li>
<li><a href="../265837/index.html">Urho3D Editor (Part 2)</a></li>
<li><a href="../265841/index.html">Deliver voice to mobile network: step 2 - Analog Digital Conversion</a></li>
<li><a href="../265843/index.html">Dagaz: Kicks to common sense (part 10)</a></li>
<li><a href="../265845/index.html">RESTful API - big lie</a></li>
<li><a href="../265851/index.html">Cage with all amenities</a></li>
<li><a href="../265853/index.html">How to create forms for subscribing to email newsletter: Errors and solutions</a></li>
<li><a href="../265855/index.html">Bringing NetApp Storage Systems Out of a Cluster</a></li>
<li><a href="../265857/index.html">The Day of Knowledge! Conferences, courses, documentation and other resources for developers from Microsoft</a></li>
<li><a href="../265859/index.html">New course "Analysis of the safety of web projects" on Stepic</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>