<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tic Tac Toe, Part 5: Backend in C ++ Boost.Beast, HTTP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tic Tac Toe: Content Cycle 

 In this article, we will consider the backend implementation using the C ++ Boost.Beast library using an example of a sy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tic Tac Toe, Part 5: Backend in C ++ Boost.Beast, HTTP</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <a href="https://habr.com/ru/post/461589/">Tic Tac Toe: Content Cycle</a> </blockquote><p>  In this article, we will consider the backend implementation using the <a href="https://www.boost.org/doc/libs/1_70_0/libs/beast/doc/html/index.html">C ++ Boost.Beast</a> library using an example of a synchronous server.  The same functionality as in the <a href="https://habr.com/ru/post/460621/">previous article</a> - we get a random number from 0 to 8 inclusive from the backend.  It turned out that raising the container for Beast is no more difficult than for Flask.  The main thing is to immediately find a good <a href="https://github.com/vinniefalco/CppCon2018">suitable example</a> .  Here I took a Dockerfile for my project. </p><br><p><img src="https://habrastorage.org/webt/it/h3/mk/ith3mklwv8-l2qfad0txn8myj1q.jpeg" alt="image"></p><br><p>  The picture was taken from the presentation of <a href="https://www.youtube.com/watch%3Fv%3D7FQwAjELMek">this report</a> to attract attention, as well as to increase the mood and motivation for those who do not know C ++. </p><a name="habracut"></a><br><h6 id="ustanovka-proekta">  Project Installation </h6><br><p>  We clone the project on your computer: </p><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nomhoi/tic-tac-toe-part5.git</code> </pre> <br><p>  Launch containers: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> tic-tac-toe-part5 docker-compose up -d</code> </pre> <br><p>  We build the web application: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> front npm install npm run-script build</code> </pre> <br><p>  Open the browser at <a href="http://localhost/">http: // localhost</a> . </p><br><h6 id="docker-konteynery">  Docker containers </h6><br><p>  The <strong>flask</strong> service was replaced with the <strong>beast</strong> service. </p><br><p>  <strong>docker-compose.yml:</strong> </p><br><pre> <code class="plaintext hljs">version: '3.6' services: nginx: image: nginx:alpine container_name: nginx volumes: - ./front/public:/usr/share/nginx/html - ./default.conf:/etc/nginx/conf.d/default.conf:ro ports: - "80:80" depends_on: - beast networks: - backend beast: container_name: beast build: context: beast/ dockerfile: Dockerfile ports: - "8080:8080" networks: - backend networks: backend: name: backend</code> </pre> <br><h6 id="frontend">  Frontend </h6><br><p>  Here we changed only the setting in the nginx'a <strong>default.conf</strong> configuration file. </p><br><pre> <code class="plaintext hljs">location /number { proxy_pass http://beast:8080; }</code> </pre> <br><h6 id="bekend">  Backend </h6><br><p>  Dockerfile was taken here: <a href="https://github.com/vinniefalco/CppCon2018">https://github.com/vinniefalco/CppCon2018</a> . </p><br><pre> <code class="plaintext hljs">FROM ubuntu:bionic AS build # Install tools required for the project RUN apt-get update \ &amp;&amp; apt-get install gcc -y \ &amp;&amp; apt-get install g++ -y \ &amp;&amp; apt-get install cmake -y \ &amp;&amp; apt-get install wget -y # Install Boost RUN cd /home \ &amp;&amp; wget http://downloads.sourceforge.net/project/boost/boost/1.70.0/boost_1_70_0.tar.gz \ &amp;&amp; tar xfz boost_1_70_0.tar.gz \ &amp;&amp; rm boost_1_70_0.tar.gz \ &amp;&amp; cd boost_1_70_0 \ &amp;&amp; ./bootstrap.sh --with-libraries=system \ &amp;&amp; ./b2 install # Copy the entire project and build it COPY ./app /cpp/src/project/ WORKDIR /cpp/src/project/ RUN g++ http_server_sync.cpp -o http_server_sync -lpthread FROM ubuntu:bionic COPY --from=build /cpp/src/project /app/ ENTRYPOINT ["/app/http_server_sync", "0.0.0.0", "8080", "/app/wwwroot"] EXPOSE 8080</code> </pre> <br><p>  As you can see, <a href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage assembly</a> technology is used.  At the first stage, the necessary packages and the Boost library are installed, the <strong>http_server_sync</strong> server is <strong>built</strong> .  At the second stage, the finished server is copied to the final container and is launched there. </p><br><p>  The source code of the synchronous server was taken <a href="https://www.boost.org/doc/libs/1_70_0/libs/beast/example/http/server/sync/">here</a> .  Added a <strong>handle_number_request</strong> function to handle the request at <strong>/ number</strong> . </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Return a random number template&lt; class Body, class Allocator, class Send&gt; void handle_number_request( beast::string_view doc_root, http::request&lt;Body, http::basic_fields&lt;Allocator&gt;&gt;&amp;&amp; req, Send&amp;&amp; send) { http::response&lt;http::string_body&gt; res; res.version(11); // HTTP/1.1 res.result(http::status::ok); res.set(http::field::server, "Beast"); res.body() = std::to_string(rand() % 9); res.prepare_payload(); return send(std::move(res)); }</span></span></code> </pre> <br><p>  In the response body we write a random number from 0 to 8 inclusive. </p><br><h6 id="zaklyuchenie">  Conclusion </h6><br><p>  As you can see, Flask helped us quickly get a general idea of ‚Äã‚Äãthe interaction between the frontend and backend, we quickly got the framework of the entire application.  When developing the backend on Beast, we already understood how the interaction worked and focused only on finding the right container and writing the backend server itself. </p><br><p>  As your homework, you can try to remake the nginx service using a multi-stage build, so that the frontend is assembled at the first stage.  Now the nginx service is configured so that it is more convenient to conduct front-end development, without unnecessary assembly. </p><br><p>  Second homework: try to remove the nginx service, and raise the frontend in the beast service.  I think it should work out. </p><br><p>  Post your decisions in the comments. </p><br><p>  The third task: to meditate on the subject of scalability - vertical and horizontal.  How to combine these two languages, C ++ and Python, in one web framework to solve this issue. </p><br><h6 id="repozitoriy-na-github">  GitHub repository </h6><br><p>  <a href="https://github.com/nomhoi/tic-tac-toe-part5">https://github.com/nomhoi/tic-tac-toe-part5</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/460991/">https://habr.com/ru/post/460991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460983/index.html">I'm not real</a></li>
<li><a href="../460985/index.html">14 Best Kanban Tools in 2019</a></li>
<li><a href="../460987/index.html">"God Mode for the Internet": tracking users through extensions Chrome and Firefox</a></li>
<li><a href="../460989/index.html">Which language - D, Go or Rust has better prospects to replace C and why?</a></li>
<li><a href="../46099/index.html">Real estate without intermediaries</a></li>
<li><a href="../460993/index.html">Stealing EDS Using Man-In-The-Disk</a></li>
<li><a href="../460995/index.html">We deploy the ML project using Flask as a REST API and make it accessible through the Flutter application</a></li>
<li><a href="../460997/index.html">Tourists help scientists estimate the number of large predators</a></li>
<li><a href="../460999/index.html">Let's play a little game with Lamoda</a></li>
<li><a href="../461/index.html">IT for small businesses - a separate market segment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>