<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex.Probki. Do you go there?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The last article touched upon the topic of information security of such a large company as Google. 
 It is time to look towards the domestic manufactu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex.Probki. Do you go there?</h1><div class="post__text post__text-html js-mediator-article"> The <a href="http://habrahabr.ru/company/dsec/blog/140882/">last</a> article touched upon the topic of information security of such a large company as Google. <br>  It is time to look towards the domestic manufacturer, namely, Yandex and its service cards. <br>  How it all began  I stood, it means, somehow in a traffic jam and I thought that it forces all people to go by one route or another.  The answer is obvious: a lot of things. <br>  However, the presence of traffic jams and all sorts of traffic situations definitely plays a significant role (traffic accidents, cloth repairs, cameras). <br>  In addition, these factors take into account all modern navigators when plotting a route. <br>  Well, let's try to influence the traffic situation, at least virtually ... <br><br><img src="https://habrastorage.org/storage2/104/ee6/ad5/104ee6ad50f78cf40c1664d90fe34f4f.png"><br><a name="habracut"></a><br>  We will play with cards from Yandex.  First, let's look at how the system works.  It's simple: mobile users install the application and send data with coordinates, direction and speed to a cozy Yandex server, where the data is aggregated, after which the map is drawn. <br>  In short, you go slowly - it means you are standing in traffic, quickly - everything is free.  The more people (devices) send statistics, the more accurate the data.  More about the work of the system is written at the very <a href="http://company.yandex.ru/technologies/yaprobki/">Yandex</a> . <br><br>  Reading the descriptions of the work of the system, an inquiring mind must certainly be interested in the following phrase: <br>  "All data is impersonal, that is, it does not contain any information about the user or his car." 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So-so-so, if the data is impersonal, then why don't we try to become that bunch of users who send data, for example, with the speed we need, so that the information about traffic in the chosen direction changes?  ( <a href="http://en.wikipedia.org/wiki/Spoofing_attack">http://en.wikipedia.org/wiki/Spoofing_attack</a> ) <br>  So, we have an Android phone on board, a <a href="https://play.google.com/store/apps/details%3Fid%3Dru.yandex.yandexmaps">Yandex map</a> application and a <a href="https://play.google.com/store/apps/details%3Fid%3Dlv.n3o.shark">Shark</a> sniffer. <br>  You need to start to see how the application and the server communicate with each other. <br>  We agree to send data about road situations, launch a sniffer and ride around the city, collecting packets (network, of course). <br><br>  To begin with, let's try to put some label on the traffic situation, for example: <br><br><img src="https://habrastorage.org/storage2/eec/817/baa/eec817baa9e59eb5554f6d058acfd1aa.png"><br><br>  catch the package: <br><br> <code>GET /userpoi/addpoint?uuid=a61d46553953fc3e346dae59d852c950&amp;catidx=2&amp;lat=59.985712&amp;lon=30.350740&amp;utf&amp;comment=bla%20bla&amp;packetid=2936036690 HTTP/1.1 <br> Host: mobile-partners.maps.yandex.net</code> <br> <br>  uuid - user id parameter <br>  catidx - tag category <br>  lat; lon - coordinates where the mark is placed <br>  comment - comment <br>  packetid - package ID <br><br>  As, in fact, expected, you can randomly change the uuid.  Tags successfully put.  The change of packetid also did not affect anything. <br>  Playing with different values ‚Äã‚Äã(coordinates and label type) and repeatedly sending packets, you can make it difficult to view the map in a short time: <br><br><img src="https://habrastorage.org/storage2/8ce/2b4/d70/8ce2b4d702479b548a80ab997b042871.png"><br><br>  But this is all childish, where is the traffic data? <br>  You do not have to wait long, the following package immediately catches the eye: <br><br> <code>POST /ymm_collect/2.x/?uuid=a61d46553953fc3e346dae59d852c950&amp;packetid=2052426273&amp;compressed=1&amp;oauth_token= HTTP/1.1 <br> Content-Type: multipart/form-data; boundary=edge_here <br> Host: mobile-partners.maps.yandex.net <br> <br> --edge_here <br> Content-Disposition: form-data; name="data" <br> Content-Type: application/gzip <br> <br> ..........m.[.. .E.....(/.4.C1... ..../ml.Y;G....i..........'....4..}..&gt;..3...[.:.E...1i.d![)x..?.'.k...a&lt;.......0.=o..*w.[.FH...J)c.)ot^.......z#oq..x... <br> .i......</code> <br> <br>  uuid is a familiar identifier parameter, whose value can be arbitrarily changed. <br>  packetid - as the name implies, is the package ID.  It is also its checksum. <br><br>  In the payload of the POST request, this is nothing more than gzip, inside which you can see something like: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf8" ?&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">traffic_collect</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">point</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lat</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"59.946379"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"30.329207"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">avg_speed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">direction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"180"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"23052011:194509"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">traffic_collect</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Just what we are looking for: current location, direction, speed and time. <br><br>  We try to play with the values ‚Äã‚Äãin xml, changing the direction, position, speed and time =&gt; packets are not accepted by the server.  It is obvious, the checksums do not converge.  Only one way out: learn how to generate packetid. <br><br>  Much has already been <a href="http://habrahabr.ru/post/128555/">said</a> about how to get the source code of the Android application, so we will not dwell on this. <br><br><img src="http://habrastorage.org/storage2/bed/280/cfd/bed280cfdb7844798d16600c7570c44a.png"><br><br>  Gorgeous.  The source is, it remains only to figure out how it works. <br>  And it worked as follows: <br><br>  1) xml with gzip data <br>  2) the resulting gzip is byte-by-byte with uuid <br>  3) CRC32 was calculated from the result obtained <br>  4) the final result was the coveted packetid <br><br>  We know how checksums are generated - now nothing prevents us from nakodit script that will send data with our coordinates and speed to the Yandex server. <br>  Test <br><br><img src="http://habrastorage.org/storage2/77e/6d0/9d3/77e6d09d334cbe6e8575d09a8075051d.png"><br><br>  Everything works fine: a non-existent congestion appeared on the street. <br>  And if there is still a couple of marks about the accident or road works, then it is quite possible to force some gullible drivers (or their navigators) to decide to change their route, thereby allowing me, my darling, to freely drive home! <br><br>  This and many other infobase reports can be heard at the monthly meetings of the <a href="https://defcon-russia.ru/">Russian Defcon Group</a> , which take place in St. Petersburg.  Come, there is always interesting. <br><br>  So it goes. <br>  Oh yeah, the information about this bug was promptly provided to the guys from I, who covered everything very quickly.  Well done. <br>  You also suggest not to get upset, because there is still Google and Nokia with their traffic jams! <br>  Well, quite curious - the script code for spoofing Yandex.Probok: <a href="http://pastebin.com/9y4hmFX9">http://pastebin.com/9y4hmFX9</a> <br>  Many thanks <a href="https://habrahabr.ru/users/ntkt/" class="user_link">ntkt</a> for help and with the past DR! <br><br>  See you on the roads. </div><p>Source: <a href="https://habr.com/ru/post/142166/">https://habr.com/ru/post/142166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142157/index.html">We organize your hosting with 0, or the story of one sleepless night</a></li>
<li><a href="../142159/index.html">Semantic Web, ARC2 and PHP</a></li>
<li><a href="../142160/index.html">GTD: Programs and Services for Task Management</a></li>
<li><a href="../142162/index.html">The introduction of electronic payment methods in the company</a></li>
<li><a href="../142164/index.html">Website development - from the first meeting with the customer to the delivery of the project, or how to be a freelancer and survive</a></li>
<li><a href="../142167/index.html">"Superbase"</a></li>
<li><a href="../142168/index.html">NormaSahar - a diabetic startup</a></li>
<li><a href="../142169/index.html">Conference Records Lang.NEXT 2012 for those interested in programming languages</a></li>
<li><a href="../142170/index.html">‚ÄúRunet today‚Äù, April 16, 2012. Experts of the issue: Stanislav Protasov, Pavel Alashkin</a></li>
<li><a href="../142171/index.html">StartUp Sabantuy! - new IT park project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>