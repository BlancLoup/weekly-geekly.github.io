<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PostSharp. Aspect-oriented programming vs Dependency Injection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my conversation with Andres Hejlsberg about fears, insecurity, and doubts about Aspect-Oriented Programming, I mentioned general confusion and misu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PostSharp. Aspect-oriented programming vs Dependency Injection</h1><div class="post__text post__text-html js-mediator-article">  In my <a href="http://www.sharpcrafters.com/blog/post/AOP-in-C-Over-Anders-Hejlsberge28099s-Dead-Body!.aspx">conversation with Andres Hejlsberg</a> about fears, insecurity, and doubts about Aspect-Oriented Programming, I mentioned general confusion and misunderstanding that AOP and DI are competing concepts.  In this article I will try to explain to you about all the differences and similarities in these two approaches. Recently, I had a great time reading Dino Esposito‚Äôs article ‚Äú <a href="http://msdn.microsoft.com/en-us/magazine/gg490353.aspx">Aspect-oriented programming, interception and unity 2.0,</a> ‚Äù in the December issue of MSDN Magazine.  This is a great article and I strongly advise any developer involved in .NET development to read it completely.  Like many DI frameworks, and some basic frameworks (WCF, ASP.NET MVC), Unity offers a similar feature to AOP: interceptors. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/afa/19d/045/afa19d045b2bce238895a5f2856f9174.gif"><br><h4></h4><br><h4>  What is Dependency Injection? </h4><br>  Dependency Injection is an architectural template that is designed to reduce dependencies between components.  One of the benefits of reducing dependencies (moving from a closely-connected architecture to a weakly-connected architecture) is reducing the awareness of the components about each other.  Thereby, a better separation of tasks is achieved using the design principle ‚Äúa program based on an interface, and not on classes‚Äù (orig .: ‚Äúprogram to an interface, not to an implementation‚Äù). A common misinterpretation of this design pattern among C # and Java developers consists that clients usually work with interfaces (what you declare as the interface keyword), and not with classes.  I prefer to interpret it like this: ‚Äúprogram-for-contract, not program-for-implementation‚Äù (orig .: ‚Äúprogram to a contract, not to an implementation‚Äù).  The contract for the use of a class in this case consists of public (public) members of the class, supplied with documentation (plus their pre-, postconditions, if applicable).  To be even more precise: ‚Äúa program based on documentation, not on classes‚Äù.  Thus, if your goal is just to divide concepts, you really do not need interfaces so much.  All you need are the keywords public, Internal, protected and private.  It is important to note that in object-oriented design, interfaces are not dogma at all.  Not all framework developers adhere to this philosophy: ‚ÄúThe Java class library is based on interfaces more than .NET, simply because .NET developers have a negative experience using COM interfaces‚Äù <br><br>  Programming based on interfaces (not classes) is useful when your component needs to work with many interface implementations.  There are countless cases in which this will be very useful (after all, we all want our architecture to be extensible), but let's face it: in many cases where our component must interact with another component, we know it perfectly subsequent implementation, and we know perfectly well that no other implementation is foreseen.  So why then use it here?  There are two options when you may want to use the concept of a program based on interfaces: <br><ul><li>  You depend on a component that was not provided to you, but you have a need to start development, you cannot wait.  And more importantly, you already need to test your own code.  You need to mock (mock) the operation of this component until it is provided to you, only for testing purposes. </li><li>  You depend on a component that has a constant state (for example, a database), some kind of real-world process (for example, a bank card processing system), or simply a dependency on a slow or unreliable resource (web service).  You need to simulate the operation of these components with your own implementation for testing purposes only. </li></ul><br>  In these situations (which actually happen only when it comes to testing) it is actually very good that the components are not related in the source code, even if we know how they will depend on each other during the final installation.  So how do we tie these components together?  This is where Dependency Injection comes into play.  With the Dependency Injection design pattern, you instruct the ‚Äúcontainer‚Äù as objects must be linked to each other, and you force this ‚Äúcontainer‚Äù to link objects to each other.  In fact, you do not create class objects using constructors; you do this using ‚Äúcontainer‚Äù methods.  The container decides which implementation you need, creates an object and returns it to you. <br><h4></h4><br><h4>  Aspect-oriented programming </h4><br>  Dependency Injection solves the problem of associating weakly related components with each other.  Aspect-oriented programming solves a variety of problems.  Indeed, in reality, where various functions and capabilities (such as auditing, logging, transaction processing) affect almost all business requirements, AOP expresses this complex reality as a compact solution, with minimal code duplication.  When we want to conduct a code review, audit our code, our natural desire will be to see only one file.  However, when we do a revision of the code that relates to some management of customer requirements, we do not want to see this code.  As you understand, this is not possible to achieve using only object-oriented programming, and this was the reason for the emergence and development of Aspect-Oriented programming. <br><h5></h5><br><h5>  Similarities and differences between AOP and DI </h5><br>  There are some similarities between DI and AOP: <br><ul><li>  Both achieve weak connectivity in architecture. </li><li>  Both achieve a better separation of functionality. </li><li>  Both offload some of the problems with the main code. </li></ul><br>  However, DI and AOP differ significantly in situations where they prove to be helpful: <br><ul><li>  DI is good when you have a dependency on components, and you don‚Äôt care how they are implemented; </li><li>  AOP is good when you need to apply some behavior to a large number of code elements.  Moreover, the target code does not necessarily depend on this behavior. </li></ul><br><br><h4>  Dynamic proxies </h4><br>  So after all, how did Dependency Injection become associated with Aspect-Oriented Programming?  Yes, a simple DI design pattern makes it easy to add new behaviors to components.  Here's how to do it: when you request a dependency on a container, you expect to get an interface implementation.  You can only guess what kind of implementation you will get, but often you play a game with it.  If you ask the container to add some behavior (for example, call tracing) to the component, you will not get the object itself.  Instead, you will get a dynamic proxy object.  The proxy object will be between you and the requested component, and will implement the behavior you requested.  And since DI frameworks have the ability to embed behavior between a client and a component implementation, DI is understood by many as one of the technologies that can enable you to develop in AOP. <br><h5></h5><br><h5>  Proxy-based AOP: what's good? </h5><br>  What I love about the proxy-based approach is how AOP fits into the concept of DI.  DI helps you customize the container, how it will build components, using dependencies between objects, setting their properties and invoking initialization methods.  You can configure aspects simply as some dependencies in the XML file or using C # code, so  the construction and assembly of components will be unified. <br>  The ability to add aspects, just changing configuration files, can be a very useful feature.  Suppose there is some problem somewhere.  And you want to track all calls to a component.  You can do this without recompiling the entire application.  This can be a decisive advantage in a runtime environment where there are no appropriate debugging tools.  Where in order to find a problem and solve it, it may take several months. <br><h5></h5><br><h5>  Proxy-based AOP: What's Bad? </h5><br>  Proxy-based AOP, which is implemented using DI frameworks has a large number of restrictions: <br>  They <ul><li>  work only on components implemented through the interface.  They do not work on all methods that are internal to the component, be it public or private, static or instance.  Remember that a component is part of an application, and usually includes many classes; </li><li>  They will work only in cases where the client code receives a link to the component from the container.  Aspects will not be applied if the component calls its own methods, or the component will be called without direct interaction through the container; </li><li>  Because  aspects are applied at runtime, there is no way to do checks at compile time.  Build-time frameworks, such as PostSharp, will provide you with errors not properly using aspects during compilation and may even provide the aspect developer with various ways to do this correctly (for example, you cannot add a caching aspect to methods that return to Stream, or to methods that have security aspects); </li><li>  It is difficult to understand (a) what aspects were applied to the parts of the code you are working with, and (b) to which parts of the code you are working with, the aspects were applied.  Full frameworks, such as PostSharp or AspectJ, can highlight you full details, right in the IDE.  Which helps to significantly improve the understanding of the source code. </li><li>  Run-time AOP has much worse performance than build-time frameworks.  This may be of secondary importance if you apply aspects to a small number of ‚Äúrough‚Äù -projected classes.  However, if you will create dynamic proxies for hundreds of classes, you will feel significant costs for performance; </li><li> Dynamic proxies were always just a third-party feature of DI frameworks and never implemented full vision, even if it is technically feasible.  They are always limited to implementation in methods, and this cannot be compared with what PostSharp and AspectJ can offer. </li></ul><br><h5>  Proxy-based AOP: What is Ugly? </h5><br>  When a developer begins to practice something all the time, without being distracted by competing technologies, it becomes a risk, because a person who practices something constantly feels safe.  And practice becomes dogma.  This happens in TDD, which imposes people to write tests at a meaningless level of detail.  And the same with Dependency Injection, where people are forced to isolate all classes from each other.  Remember, DI was originally designed to isolate components, not classes.  Components are parts of an application, its blocks, not objects.  I‚Äôm concerned that we are forced (under the pressure of society) to write much more complex applications just to meet the testing requirements, which in fact do not lead to an improvement in the quality of the final product.  Remember that unit testing is a tool, not a goal.  The ultimate goal is the quality of your application throughout its life. <br><h5></h5><br><h4>  Conclusion </h4><br>  Aspect-oriented programming and Dependency Injection are very different concepts, but there are a limited number of cases when they are well suited to each other.  In these situations, the use of AOP within DI makes sense.  For other options, you have only two choices: deactivate the dynamic proxy (and this is not the solution), or use a specialized tool for AOP development.  And this dilemma is not just for me, PostSharp, or .NET.  The same dilemma hangs over Java programmers who think what to choose: Spring AOP or AspectJ.  AOP and DI are not competing technologies.  You can use them together in one project.  However, it is important to know and understand what each technology was made for and focus on the quality of your code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br>  References: <br><ul><li>  <a href="http://habrahabr.ru/blogs/net/123480/">We solve the problem of caching</a> </li><li>  <a href="http://software.intel.com/ru-ru/blogs/2010/03/09/postsharp-i/">Intel blogs: PostSharp.</a>  <a href="http://software.intel.com/ru-ru/blogs/2010/03/09/postsharp-i/">Part 1</a> </li><li>  <a href="http://software.intel.com/ru-ru/blogs/2010/03/16/postsharp/">Intel blogs: PostSharp.</a>  <a href="http://software.intel.com/ru-ru/blogs/2010/03/16/postsharp/">Alternatives</a> </li><li>  <a href="http://habrahabr.ru/blogs/net/124860/">PostSharp.</a>  <a href="http://habrahabr.ru/blogs/net/124860/">Problem solving logging and auditing</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/123186/">https://habr.com/ru/post/123186/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123178/index.html">Twitter has a new achievement: 200 million tweets per day</a></li>
<li><a href="../123179/index.html">I want to see</a></li>
<li><a href="../123180/index.html">What is a computer virus?</a></li>
<li><a href="../123182/index.html">IE10 PP2 released: WebWorkers, Drag & Drop, File API, CSS3 Positioned Floats, HTML5 Forms and more</a></li>
<li><a href="../123183/index.html">Google introduced a new tool for creating mobile sites</a></li>
<li><a href="../123187/index.html">Add Pattern Matching and Parameterized Methods in Objective-C</a></li>
<li><a href="../123188/index.html">RIPE Visits Selectel Holds Training Courses in St. Petersburg</a></li>
<li><a href="../123190/index.html">Canobuvosti, 98th edition</a></li>
<li><a href="../123191/index.html">Mobile web development</a></li>
<li><a href="../123192/index.html">Design is not design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>