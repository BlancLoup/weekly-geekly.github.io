<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Routing layer in iOS applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Has it happened to you that you opened a Storyboard and from what you see you begin to overwhelm positive emotions? 

 At this point, you may think th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Routing layer in iOS applications</h1><div class="post__text post__text-html js-mediator-article">  Has it happened to you that you opened a <i>Storyboard</i> and from what you see you begin to overwhelm <s>positive</s> emotions? <br><img src="https://habrastorage.org/files/f48/3f6/224/f483f62244194e138a61ca7e2a0e6b47.gif"><br>  At this point, you may think that well-designed navigation between screens (hereinafter <i>Routing</i> ) in large projects can be an extremely important task, the solution of which will help save time and nerves to everyone who participates in the project. <a name="habracut"></a><br><br>  <u>What is meant by the word <i>Routing</i> in this publication?</u> <br><br>  In general terms, this can be described as a path from one screen to another.  And everyone has his own way.  Someone will immediately submit a <i>Storyboard Segue</i> , and someone like this challenge: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.navigationController?.pushViewController(<span class="hljs-built_in"><span class="hljs-built_in">UIViewController</span></span>(), animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>)</code> </pre> <br>  <u>At what point may there be a need to rethink the <i>routing</i> layer?</u> <br><br><ul><li>  You opened an old project (maybe even yours) and cannot understand the whole picture of transitions between screens. </li><li>  You are working on a large project and want to immediately make it available and transparent for all project participants. </li><li>  You are reading <a href="https://www.objc.io/issues/13-architecture/viper/">an article about VIPER</a> and planning to plunge into the <s>wonderful</s> world of architectural discussions. </li><li>  Your <i>Storyboard has</i> become so big that you‚Äôll experience various difficulties adding each new screen. </li><li>  Low-powered machines are simply unable to open the <i>Storyboard</i> project. </li><li>  You don‚Äôt use <i>Storyboard</i> at all ( <a href="https://github.com/facebook/AsyncDisplayKit/blob/master/examples/Swift/Sample/ViewController.swift">for this reason?</a> ) And <i>pushViewController</i> calls are scattered throughout the project. </li><li>  <i>Your unique case and other situations.</i> </li></ul><br>  <u>How can I start rethinking the <i>Routing</i> layer?</u> <br><br>  It is important to decide what things fall into <i>Routing</i> .  These can be <i>UIViewController</i> , <i>UINavigationController</i> and other functions that perform various <i>transitions</i> : <i>pushViewController</i> , <i>popViewController</i> , <i>popToViewController</i> , <i>popToRootViewController</i> , <i>present</i> , <i>dismiss</i> , <i>setViewControllers</i> .  Also in <i>Routing</i> can display various pop-up windows like <i>alert</i> , <i>action sheet</i> , <i>toast</i> , <i>snackbar</i> . <br><br>  An equally important step will be to decide how the transition will be triggered.  Ideally, the transition code will be fairly brief and clear even to those who see it for the first time. <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { ... routing(with: .dismiss) }</code> </pre> <br>  <u>Preparing <i>UIViewController</i> for transitions</u> <br><br>  If you try to implement the example above, then <i>routing</i> will be a function that <i>UIViewController implements</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">routing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with routing: Routing)</span></span></span></span> { ... } }</code> </pre> <br>  Next, you need to create an element <i>Routing</i> , which will fall into the function as a parameter.  In the swift language, the listings turned out to be very flexible and will work best in this situation: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Routing</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> dismiss <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> preparedNavigation <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> selectedCityTransport(<span class="hljs-type"><span class="hljs-type">CityTransport</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> selectedTrafficRoute(<span class="hljs-type"><span class="hljs-type">TrafficRoute</span></span>) ... }</code> </pre> <br>  It is worth noting that the same <i>Routing</i> parameter can be called by different <i>UIViewController</i> and, for example, with such calls different transitions should occur.  Accordingly, the application must know from which specific <i>UIViewController the</i> transition was triggered.  You can achieve adequate <i>UIViewController mapping</i> and transitions in a variety of ways.  However, ideally, I would like to have a certain parameter for <i>UIViewController</i> for this purpose.  For example, using the <s>forbidden magic</s> <a href="http://nshipster.com/swift-objc-runtime/">runtime</a> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> undefined <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> navigation <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> transport ... } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Keys</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> key = <span class="hljs-string"><span class="hljs-string">"\(#file)+\(#line)"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type: <span class="hljs-type"><span class="hljs-type">ViewType</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> objc_getAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-type"><span class="hljs-type">Keys</span></span>.key) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">ViewType</span></span> ?? .undefined } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { objc_setAssociatedObject(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-type"><span class="hljs-type">Keys</span></span>.key, newValue, .<span class="hljs-type"><span class="hljs-type">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span></span>) } } }</code> </pre> <br>  By entering a new <i>type</i> parameter for <i>UIViewController,</i> you can detail the <i>routing</i> function, in which all transition calls between application screens will be collected and broken down by the type of the calling <i>UIViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">routing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with routing: Routing)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .navigation: preparedNavigation(with: routing) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .transport: selectedCityTransport(with: routing) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } }</code> </pre> <br>  A specific implementation of each transition can, for example, be put into a separate private <i>UIViewController extension</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preparedNavigation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with routing: Routing)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> routing { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .preparedNavigation: <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> view = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">UINavigationController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } view.setViewControllers([<span class="hljs-type"><span class="hljs-type">TransportView</span></span>()], animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">selectedCityTransport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(with routing: Routing)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> routing { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .selectedCityTransport(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> object): navigationController?.pushViewController(<span class="hljs-type"><span class="hljs-type">RoutesView</span></span>(object), animated: <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } } }</code> </pre> <br>  <u>What did you achieve in the end?</u> <br><br><ul><li>  All application transitions are described in one place, ordered and not duplicated. </li><li>  The transition call is concise and easy to use. </li><li>  If necessary, you can safely refuse to use <i>Storyboard</i> , if there are any reasons.  For example, you decide to use <a href="http://asyncdisplaykit.org/">AsyncDisplayKit</a> . </li><li>  No new managers, services or singltons appeared ... All the logic remains inside the <i>UIViewController extension</i> . </li></ul><br>  <u>Was this approach used by the authors of the publication?</u> <br><br>  In two projects written in swift from scratch, we managed to implement the presented implementation of the <i>Routing</i> layer.  One of the projects was written using <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> and the <i>routing</i> call was wrapped like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> Reactive <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> Base: UIViewController { var observerRouting: AnyObserver&lt;Routing&gt; { let binding = UIBindingObserver(UIElement: base) { (<span class="hljs-keyword"><span class="hljs-keyword">view</span></span>: UIViewController, routing: Routing) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.routing(<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>: routing) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binding.asObserver() } }</code> </pre> <br>  Project sizes were 55k and 125k <a href="https://gist.github.com/Tokuriku/f7d6ce5a68d2154c28b0">loc</a> .  The sizes of files in each project, which contained the entire <i>Routing</i> layer, were approximately the same and amounted to about 600 lines of code. </div><p>Source: <a href="https://habr.com/ru/post/321842/">https://habr.com/ru/post/321842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321832/index.html">Budget option of transition from the working group to the domain</a></li>
<li><a href="../321834/index.html">We create a neural network InceptionV3 for image recognition</a></li>
<li><a href="../321836/index.html">Collecting VK posts for Samsung Gear</a></li>
<li><a href="../321838/index.html">How we built cloud infrastructure in Azure</a></li>
<li><a href="../321840/index.html">Notification of problems with your site through Telegrams and other features of Hosttracker</a></li>
<li><a href="../321844/index.html">Overview of the 5 most popular JavaScript frameworks and libraries 2017</a></li>
<li><a href="../321846/index.html">Paul Graham's Strategic Essay: Refraction (Entire)</a></li>
<li><a href="../321848/index.html">BP lessons from creating EVE: Valkyrie</a></li>
<li><a href="../321850/index.html">Analysis of the report of Alexey Vinogradov about cargo cult and other diseases</a></li>
<li><a href="../321852/index.html">The practice of collecting customer feedback is a bad thing.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>