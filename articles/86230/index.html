<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Change libdc1394 library to support the desired camera</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When it comes to free software, one of the arguments ‚Äúfor‚Äù is the ability to make changes to the code yourself. It seems to me personally that the end...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Change libdc1394 library to support the desired camera</h1><div class="post__text post__text-html js-mediator-article">  When it comes to free software, one of the arguments ‚Äúfor‚Äù is the ability to make changes to the code yourself.  It seems to me personally that the end user does not care about this opportunity.  And the matter can be not only in the absence of programming skills, but also simply in the lack of understanding that this is possible. <br><br>  In this article I will briefly describe my experience of ‚Äúfinishing‚Äù the <a href="http://damien.douxchamps.net/ieee1394/libdc1394/">libdc1394</a> library for myself, or rather, for the camera with which I work.  I suppose that the article may be interesting to those people who have never done anything themselves in third-party libraries and those who have to deal with firewire cameras in Linux. <br><a name="habracut"></a><br>  The culprit of the celebration is the Flir infrared camera A40.  The camera connects to the computer via the IEEE 1394 interface (hereinafter firewire).  The manufacturer offers drivers for Windows, but does not support Linux.  When connected to a computer, you can make sure that the camera is ‚Äúvisible‚Äù to the system, but you can only work with it at a low level. <br><br>  The libdc1394 library provides high-level functions for working with a camera in Linux and supports any cameras that follow the IIDC / DCAM specification.  With the use of this library written many programs working with cameras.  This library does not ‚Äúsee‚Äù the connected A40 camera.  Therefore, the first task is to determine the symptoms and possibilities.  What can we learn about the camera? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is logical to check the camera for compliance with the specifications.  And it‚Äôs best to do it yourself, and not to trust the library.  For this, the <a href="http://gscanbus.berlios.de/">gscanbus</a> program and the specification text are used.  First of all, I tried to read the name of the camera and the manufacturer of the ROM.  The information in the ROM is stored in blocks of 32 bits or, in other words, in quadlets (4 bytes).  Address offsets are also indicated in quadlets.  At first, it is confusing.  For example, if we read the value of <i>a</i> , which is an offset, then in order to apply it in the gscanbus program, we need to add the value <i>4 * a</i> to the base address. <br><br>  After successfully reading the name of the camera and the manufacturer, it became obvious that the camera somehow, but meets the IIDC 1.30 specification.  And here a natural question arises - why then the library libdc1394 cannot work with this camera?  The specification defines several exact values.  These values ‚Äã‚Äãare checked by libdc1394 library when searching for cameras connected to a computer.  One of these values ‚Äã‚Äãis unit_spec_ID, equal to 0x00A02D.  The A40 camera unit_spec_ID is 0x407F.  Knowing this, the programmer needs to change the condition being checked in the library, and now she sees the connected camera. <br><br>  A similar research procedure is conducted with supported formats.  The camera feed returned zeros for supported formats and an error for unsupported ones.  According to the specification, zeros indicate a lack of support. <br><br>  After changing all the if'of it turned out that the picture comes, but "broken." <br><img src="https://habrastorage.org/getpro/habr/post_images/e1b/f44/bb3/e1bf44bb3dfa20297e7bccf4f4935c74.jpg" alt="broken picture from infrared camera"><br><br>  A survey of friends and Google could not help me.  Working with a camera on firewire in Linux is not a very popular topic.  It is worth adding that I saw how this camera worked under Linux on one computer.  Unfortunately, I did not have access to it, I could not compare configurations and I had to reinvent the wheel.  But I was sure that it was possible to invent a bicycle and that it would ride! <br><br>  At this stage I had to study in detail the work of libdc1394 based on its sources.  And at some point I paid attention to either the size of the packets received from the camera, or I peered at the contents of the resulting image in a hex editor and suspected something and turned to the size of the packets.  It turned out that the camera, in addition to the data of the image itself, sends 40 additional bytes.  At that moment everything became clear.  Before sending a frame, the user must go through the packets that make up the frame, remove the extra 40 bytes from each packet and put the pieces together.  The result is an image. <br><img src="https://habrastorage.org/getpro/habr/post_images/363/a5b/433/363a5b43300c3bd4fb91a9981c7870b9.jpg" alt="correct image from infrared camera"><br><br>  Wishing I send to the description of <a href="http://kit.origo.ethz.ch/wiki/flir_a40_and_libdc1394">specific implementation with code pieces</a> .  Although Habr's policy does not welcome the reprinting of the material in other sources, the text that I wrote in English follows the link, as well as different from this article. <br><br>  Unfortunately, the libdc1394 library developers do not want to support cameras that do not fully meet the specifications.  My suggestions to add changes to the official code were ignored.  And this means that when a new version of the library is released, its interface can change dramatically and camera support will have to be re-introduced. <br><br>  In conclusion, I would like to say ‚Äúfi‚Äù to companies that do not follow specifications and standards.  And also I wish good luck to all who will encounter difficulties when working with video in Linux.  Remember that if your camera ‚Äúcannot be found,‚Äù then you may still be able to work with it after making changes to the libdc1394 library. <br><br>  <strong>UPD.</strong>  Transferred to "Linux for all." <br><br>  <strong>UPD 1.</strong> Reliable Swiss hosting Origo ordered to live long.  Unfortunately, the original wiki ‚Äì page has not been preserved, but the libdc1394-flir patch itself has been <a href="https://github.com/fralik/libdc1394-flir">posted on the githab</a> </div><p>Source: <a href="https://habr.com/ru/post/86230/">https://habr.com/ru/post/86230/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86216/index.html">Skype in the Ovi Store</a></li>
<li><a href="../86217/index.html">Health: 9 reasons to drink more water</a></li>
<li><a href="../86221/index.html">Video virus, or I have not watched a movie</a></li>
<li><a href="../86224/index.html">Facebook targets $ 1 billion in revenue in 2010</a></li>
<li><a href="../86227/index.html">Has the change in the pricing of phone calls in Moscow and the Moscow region occurred?</a></li>
<li><a href="../86233/index.html">Gandi distributes domains</a></li>
<li><a href="../86236/index.html">How is 3D printing?</a></li>
<li><a href="../86237/index.html">German Constitutional Court repealed the Law on Accumulative Storage of Telecommunications Connection Data</a></li>
<li><a href="../86238/index.html">Sennheiser HD 228: What is he like a cat in a bag?</a></li>
<li><a href="../86239/index.html">Photographing gadgets for review or website in a quick way.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>