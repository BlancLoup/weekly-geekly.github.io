<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to rewrite a big project or refactoring that is painless for business</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The most frequently asked question for me is how to talk about refactoring with a manager? 
 In such cases, I give somewhat controversial advice: do n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to rewrite a big project or refactoring that is painless for business</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/408/447/882/4084478828594fc4aa62857cfaa16766.jpg" width="600"><br><blockquote>  The most frequently asked question for me is how to talk about refactoring with a manager? <br>  In such cases, I give somewhat controversial advice: do not tell him anything! <br></blockquote>  <i>Martin Fowler, Refactoring.</i>  <i>Improving existing code</i> <br><br>  Obsolete code, support difficulties, unpredictable bugs - these terms appear one after another in the developer‚Äôs life as the product is developed.  And if the first is more likely the interests of the developer, then the last is a direct business problem. <br><br>  In this article, I want to share the experience of rewriting a large project and, as a bonus, bring a couple of pieces of code that helped us and, I hope, help you begin this interesting way. <br><a name="habracut"></a><br><h1>  Debriefing </h1><br><h2>  Problems </h2><br>  They usually start in a known scenario: <br><ol><li>  The boss comes running screaming, ‚ÄúNothing works with us, the main client is at risk!‚Äù; </li><li>  or a manager with a request to fasten an unrealizable chip; </li><li>  less often, we, the developers, are so tired of digging into the ‚ÄúLegacy‚Äù <s>shit</s> code that we decide to rewrite everything. </li></ol><br>  And usually it ends with general indignation and frustration, because the chip is needed urgently, clients cannot wait either, and because of the sad heritage the team tends to run up.  The situation is spoiled by the lack of ‚Äúmoney for refactoring‚Äù (inaction of the team in terms of business) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As for the last point, I need to add that I don‚Äôt consider the situation with a new person in the team who is eager to rewrite everything, but he can easily argue the described approach for the project development. <br><br><h2>  Tasks </h2><br><ol><li>  Translate the project on modern architecture </li><li>  Ensure minimal refactoring costs </li></ol><br><h2>  Implementation scheme </h2><br>  Our project was originally written in Kohana, we rewrote it in Symfony2, so all the examples are given in the context of these systems.  However, this approach can be applied with any frameworks.  The necessary requirement is a single entry point to the application. <br><br>  Initially, the application handles user requests through the app_kohana.php entry point. <br><img src="https://habrastorage.org/files/701/f97/eff/701f97eff56740bfbe51e4a09a833f7b.png"><br>  We will wrap the entry point in the new system, organizing a kind of ‚Äúproxy‚Äù. <br><br><h1>  Refactoring </h1><br><h2>  Controller - wrapper for the old system </h2><br>  The idea is quite simple and is as follows: <br><ol><li>  We deploy two systems in parallel (kohana + symfony) </li><li>  Change the entry point to a new one (symfony) </li><li>  We organize a universal controller, which by default will forward all requests to the old system </li></ol><br><img src="https://habrastorage.org/files/8e1/7ea/bf5/8e17eabf584e453499d6470c1c43545c.png"><br>  And if there shouldn't be any problems with the first two points, the third one is of interest, because it can reveal pitfalls. <br><br>  The first thing that comes to mind is to wrap the include in ob_start.  So do: <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PassThroughController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Symfony</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FrameworkBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kohanaAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ob_start(); $kohanaPath = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;getParameter(<span class="hljs-string"><span class="hljs-string">'kernel.root_dir'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/../app_kohana.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $kohanaPath; $response = ob_get_clean(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response($response); } }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Routing for universal controller</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">application.passthrough_kohana: <span class="hljs-type"><span class="hljs-type">path</span></span>: /{slug} defaults: _controller: ApplicationBundle:PassThrough:kohana requirements: slug: .*</code> </pre><br></div></div><br><br>  In this format, the system is already working, but after some time, the first bug arrives.  For example, incorrect handling of ajax errors.  Or on the site errors are given with the code 200 instead of 404. <br><br>  Here we understand that the buffer swallows headers, so they need to be processed explicitly. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PassThroughController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Symfony</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FrameworkBundle</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kohanaAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ob_start(); $kohanaPath = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;getParameter(<span class="hljs-string"><span class="hljs-string">'kernel.root_dir'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/../app_kohana.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $kohanaPath; $headers = headers_list(); $code = http_response_code(); $response = ob_get_clean(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response($response, $code, $headers); } }</code> </pre><br>  After this flight is normal. <br><br><h2>  The problems of the old system affecting the functioning of the new </h2><br><h3>  exit () </h3><br>  We had places in the system where, at the end of the controller, exit () was joyfully called.  This is practiced, for example, in Yii (CApplication :: end ()).  It does not deliver a particular headache until you start using the event model in the new system and handle events that occur after the execution of the controller.  The most striking example is the Symfony Profiler, which stops working for requests with exit. <br>  This case must be borne in mind and, if necessary, take appropriate measures. <br><br><h3>  ob_end _ * () </h3><br>  Reckless use of ob_end functions can easily break the work of the new system by clearing the buffer of the new proxy controller.  It should also be borne in mind. <br><br><h3>  Kohana_Controller_Template :: $ auto_render </h3><br>  The variable is responsible for the automatic drawing of the data received from the controller in the global template (it can strongly depend on the template used).  During the adaptation of a new system, this can save debugging time in places where, for example, json is outputted by a simple <em>echo $ json;</em>  <em>exit ();</em>  .  The controller will take approximately the following form: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;auto_render = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $json; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre><br><br><h2>  What else is worth taking care </h2><br>  The entry points described above are an ideal situation.  Our initial entry point was app.php and it was required that it should remain after refactoring (reconfiguration of numerous servers looked hopeless).  The following algorithm was chosen: <br><ol><li>  Rename app.php to app_kohana.php </li><li>  The entry point of the symphony is placed in app.php </li><li>  Profit </li></ol><br>  And everything seemed to be started, except for the console commands that were launched in Kohana through the same file.  Therefore, at the beginning of the new app.php, the following crutch was born for backward compatibility: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PHP_SAPI == <span class="hljs-string"><span class="hljs-string">'cli'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'app_kohana.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre><br><br><h1>  Life after refactoring </h1><br><h2>  New controllers </h2><br>  We try to write all new controllers in symfony.  The separation takes place at the routing level, the necessary one is added to the ‚Äúuniversal‚Äù route, and Kohana does not load further.  While we are writing in the new system only ajax-controllers, so the issue with reusing patterns (Twig) remains open. <br><br><h2>  DB and Configuration </h2><br>  To access the database, models from the current database were generated using standard Doctrine methods.  New methods of working with the database are added to the repository as necessary.  However, the configuration of the connection to the database is used existing from Kohana.  To do this, a configuration file has been written that pulls data from the Kohang config and converts it into symphony configuration parameters.  The logic of the search for the config, depending on the platform, alas, is duplicated in order not to connect the Kohana classes in the new system. <br><div class="spoiler">  <b class="spoiler_title">Application / Resources / config / kohana.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Symfony\Component\DependencyInjection\ContainerBuilder $container */</span></span> $kohanaDatabaseConfig = []; $kohanaConfigPath = $container-&gt;getParameter(<span class="hljs-string"><span class="hljs-string">'kernel.root_dir'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/config'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!defined(<span class="hljs-string"><span class="hljs-string">'SYSPATH'</span></span>)) { define(<span class="hljs-string"><span class="hljs-string">'SYSPATH'</span></span>, realpath($container-&gt;getParameter(<span class="hljs-string"><span class="hljs-string">'kernel.root_dir'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/../vendor/kohana/core'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/'</span></span>); } $mainConfig = $kohanaConfigPath . <span class="hljs-string"><span class="hljs-string">'/database.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($mainConfig)) { $kohanaDatabaseConfig = <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $mainConfig; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'PLATFORM'</span></span>])) { $kohanaEnvConfig = $kohanaConfigPath . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $_SERVER[<span class="hljs-string"><span class="hljs-string">'PLATFORM'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/database.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($kohanaEnvConfig)) { $kohanaDatabaseConfig = array_merge($kohanaDatabaseConfig, <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $kohanaEnvConfig); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($kohanaDatabaseConfig[<span class="hljs-string"><span class="hljs-string">'default'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Symfony\Component\Filesystem\<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>\FileNotFoundException(<span class="hljs-string"><span class="hljs-string">'Could not load database config'</span></span>); } $dbParams = $kohanaDatabaseConfig[<span class="hljs-string"><span class="hljs-string">'default'</span></span>]; $container-&gt;getParameterBag()-&gt;add([ <span class="hljs-string"><span class="hljs-string">'database_driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'pdo_mysql'</span></span>, <span class="hljs-string"><span class="hljs-string">'database_host'</span></span> =&gt; $dbParams[<span class="hljs-string"><span class="hljs-string">'connection'</span></span>][<span class="hljs-string"><span class="hljs-string">'hostname'</span></span>], <span class="hljs-string"><span class="hljs-string">'database_port'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'database_name'</span></span> =&gt; $dbParams[<span class="hljs-string"><span class="hljs-string">'connection'</span></span>][<span class="hljs-string"><span class="hljs-string">'database'</span></span>], <span class="hljs-string"><span class="hljs-string">'database_user'</span></span> =&gt; $dbParams[<span class="hljs-string"><span class="hljs-string">'connection'</span></span>][<span class="hljs-string"><span class="hljs-string">'username'</span></span>], <span class="hljs-string"><span class="hljs-string">'database_password'</span></span> =&gt; $dbParams[<span class="hljs-string"><span class="hljs-string">'connection'</span></span>][<span class="hljs-string"><span class="hljs-string">'password'</span></span>], ]);</code> </pre></div></div><br>  The config is connected in the standard way <br><div class="spoiler">  <b class="spoiler_title">Application / DependencyInjection / ApplicationExtension.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationExtension</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Symfony</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpKernel</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DependencyInjection</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $configs, ContainerBuilder $container)</span></span></span><span class="hljs-function"> </span></span>{ $loader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Loader\PhpFileLoader($container, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileLocator(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>.<span class="hljs-string"><span class="hljs-string">'/../Resources/config'</span></span>)); $loader-&gt;load(<span class="hljs-string"><span class="hljs-string">'kohana.php'</span></span>); } }</code> </pre></div></div><br><h2>  How to continue: making functional in services </h2><br>  Further movement from Kohana to a symphony fits very well into rendering the functional to symphony services and using them in the old system through a DI-container.  It so happened that we began to use the DI component before connecting the symphony to the project, so this process went quite smoothly, but nothing prevents you from doing it from scratch.  The main task will be to throw the DI-container from the symphony into the kohana.  We did this in Kohana-style through a static property; in another framework, you can find the appropriate approach. <br><br><div class="spoiler">  <b class="spoiler_title">Override the Kohans system class, add a property for the container there.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kohana</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kohana_Core</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Symfony\Component\DependencyInjection\ContainerBuilder */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> $di; }</code> </pre></div></div><br>  And then you need to turn a couple more frauds to put in this property a DI-container between the initialization of the kohana and the execution of the controller code.  To do this, we divide our app_kohana.php initialization file into two parts, highlighting directly the initialization of the system and the launch of the controller itself. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** app_kohana_init.php */</span></span> <span class="hljs-comment"><span class="hljs-comment">//   ,     bootstrap /** app_kohana_run.php */ echo Request::factory(TRUE, array(), FALSE) -&gt;execute() -&gt;send_headers(TRUE) -&gt;body(); /** app_kohana.php */ include 'app_kohana_init.php'; include 'app_kohana_run.php';</span></span></code> </pre><br><br>  We modify our controller by doing operations similar to app_kohana.php, but adding container forwarding between inclusions <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kohanaAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ob_start(); $kohanaPath = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container-&gt;getParameter(<span class="hljs-string"><span class="hljs-string">'kernel.root_dir'</span></span>) . <span class="hljs-string"><span class="hljs-string">'/..'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $kohanaPath . <span class="hljs-string"><span class="hljs-string">'/app_kohana_init.php'</span></span>; \Kohana::$di = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;container; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $kohanaPath . <span class="hljs-string"><span class="hljs-string">'/app_kohana_run.php'</span></span>; $headers = headers_list(); $code = http_response_code(); $response = ob_get_clean(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Response($response, $code, $headers); }</code> </pre><br><br>  After that, we in the old system can use the DI-container and all the services declared in the new system, including the EntityManager and the new doctrine models. <br><br><h1>  At last </h1><br><h2>  Pros of implementation </h2><br><ul><li>  We have taken the first step for the further development of the system. </li><li>  The new system is independent of the old.  All new code works without old </li><li>  Minimum time spent </li></ul><br><br><h2>  Implementation minuses </h2><br><ul><li>  Additional overhead resources on the "wrapper" while working with the old part of the system.  However, compared to the delays in the old system, the overhead projector (both in memory and processor) can be neglected. </li><li>  The new system is independent of the old.  We cannot use the old code in the new one, but this is rather a plus, since we decided to rewrite. </li><li>  We have to maintain the model in two places. </li></ul><br><br>  Thank you for reading to the end, I wish you success in refactoring, brush away the accumulated dust from the old code! <br>  And sorry for the terrible fonts on the diagrams: ( </div><p>Source: <a href="https://habr.com/ru/post/252405/">https://habr.com/ru/post/252405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252393/index.html">The nuances of commercial development on WordPress</a></li>
<li><a href="../252395/index.html">Half a pixel?</a></li>
<li><a href="../252397/index.html">A large collection of links about galleries and everything connected with them.</a></li>
<li><a href="../252399/index.html">Do it with love - an application that teaches you to love</a></li>
<li><a href="../252403/index.html">Budget SAN Storage on LSI Syncro Part 1</a></li>
<li><a href="../252407/index.html">Intel¬Æ Galileo Gen 2. Features of the beginning of operation</a></li>
<li><a href="../252409/index.html">PaintCode 2, a brief digression and notes</a></li>
<li><a href="../252411/index.html">Putting Wi-Fi robot</a></li>
<li><a href="../252415/index.html">LVS + OpenVZ</a></li>
<li><a href="../252417/index.html">Announcement of the book by Brian Kernigan "The Go Programming Language"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>