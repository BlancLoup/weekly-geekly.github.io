<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Thinstation session selection menu</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the second version of Thinstation there was a session selection menu at boot time - Replimenu . Although it was ugly and sometimes it drove into a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Thinstation session selection menu</h1><div class="post__text post__text-html js-mediator-article">  In the second version of Thinstation there was a session selection menu at boot time - <b>Replimenu</b> .  Although it was ugly and sometimes it drove into a stupor an unprepared user who was used to a full-fledged graphics mode, but it worked.  In the fifth version, it ‚Äúbroke down‚Äù, and the developers didn‚Äôt screw any replacement, to the question ‚ÄúWhere did the menu go?‚Äù Answered: <br><blockquote>  If you‚Äôre not in the first place, you‚Äôre not 10 years and are no longer on the support radar. </blockquote>  what in free translation means - such computers, so that very little memory, for 10 years they don‚Äôt produce, use a window manager with icons on the desktop. <br>  I was not satisfied with such an approach to solving the problem, and therefore I decided to create my own menu for session selection, since the Thinstation functionality allows it. <a name="habracut"></a><br><br>  From the run-up, to implement a full-fledged replacement, so that any session option from the configuration file would automatically hook up, did not work, and there was no such task.  It was necessary to give the user the choice of connecting to one of the three terminal servers on Windows. <br><br>  To display the menu, we will use the <b>Zenity</b> utility, which displays dialog boxes from the command line and shell scripts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create folders and package files, I called it <b>xmenu</b> , copy the cursor and font into it: <pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ///thinstation/ts/build/packages mkdir -p xmenu/{etc/{init.d,rc5.d},bin,lib/{fonts/X11/TTF,icons/default/cursors}} cp icons-cursor/lib/icons/dmz-aa/cursors/top_left_arrow xmenu/lib/icons/default/cursors cp fonts-TTF-liberation/lib/fonts/X11/TTF/LiberationMono-Regular.ttf xmenu/lib/fonts/X11/TTF <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> -e <span class="hljs-string"><span class="hljs-string">"base\nzenity\npango\nfontconfig"</span></span> &gt; xmenu/dependencies <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">",dependencies,0,0,,0,,,,,,,,,"</span></span> &gt; xmenu/.dna <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> &gt; xmenu/bin/xmenu <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> &gt; xmenu/etc/init.d/xmenu chmod 766 xmenu/bin/xmenu chmod 766 xmenu/etc/init.d/xmenu <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> xmenu/etc/rc5.d ln -s ../init.d/xmenu xmenu</code> </pre> <br>  Copy the initialization script to <b>xmenu / etc / init.d / xmenu</b> : <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/sh . $TS_GLOBAL case "$1" in init) if ! pkg_initialized $PACKAGE; then pkg_set_init_flag $PACKAGE fi ;; console) exec /bin/xmenu ;; help) echo "Usage: $0 {init|console}" ;; *) exit 1 ;; esac exit 0</span></span></code> </pre><br>  In <b>xmenu / bin / xmenu,</b> copy the menu script itself: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh . $TS_GLOBAL # IP  IPSHOW=$(ifconfig | grep 'inet addr:'| grep -v '127.0.0.1' | cut -d: -f2 | awk '{ print $1}') #     xsetroot -cursor_name top_left_arrow -solid rgb:4B/69/83 #Menu zenity: ip=`zenity --list --timeout=30 --height=250 --print-column=1,2 --hide-column=1,2 \ --text=": $(hostname) ||| IP: $IPSHOW""\n"'&lt;span foreground="blue"&gt;\ \n    [Cancel]\n\       [OK]\n\ &lt;/span&gt;' --column "type" --column "server" --column " :" \ "$MENU_1_TYPE" "$MENU_1_SERVER" "$MENU_1_TITLE" \ "$MENU_2_TYPE" "$MENU_2_SERVER" "$MENU_2_TITLE" \ "$MENU_3_TYPE" "$MENU_3_SERVER" "$MENU_3_TITLE"` retval=$? #     : case $retval in 0) # IP : ipserver=$(echo $ip | awk -F'|' '{ print $2 }') #   rdesktop   , : if echo $ip | grep rdesktop &amp;&amp; echo $ip | grep -u ; then rdesktop $RDESKTOP_OPTIONS $ipserver #   rdesktop  , : elif echo $ip | grep rdesktop; then rdesktop -u '' $RDESKTOP_OPTIONS $ipserver #   freerdp, : elif echo $ip | grep freerdp; then xfreerdp $FREERDP_OPTIONS /v:$ipserver #       ,   : else zenity --warning --text="   .\n \   ..." xmenu fi;; #   [Cancel]  Esc  ,   : 1|5|-1) poweroff;; esac exit 0</span></span></code> </pre><br>  This script is suitable for running freerdp and rdesktop sessions, after 30 seconds of inactivity (parameter <b>--timeout = 30</b> ) the computer will turn off. <br><br>  The menu package is ready, we include it into the build with the line <b>package xmenu</b> in the <b>build.conf.example</b> file and <b>build the</b> image. <br><br>  In <b>thinstation.conf.xxx,</b> you need to <u>REPLACE</u> session variables with: <pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,   SESSION_0_TYPE=xmenu SESSION_0_AUTOSTART=On #  ,   : RDESKTOP_OPTIONS="-x 0x90 -N -a 16 -f -k ru -x l" FREERDP_OPTIONS="+fonts -sec-tls -sec-nla" #   ,    IP  MENU_1_TITLE="1" MENU_1_TYPE=rdesktop MENU_1_SERVER=192.168.111.100 MENU_2_TITLE="2" MENU_2_TYPE=freerdp MENU_2_SERVER=192.168.111.100 MENU_3_TITLE="3" MENU_3_TYPE=freerdp MENU_3_SERVER=192.168.111.100</span></span></code> </pre><br>  After loading the image, we‚Äôll see such a nice menu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/872/827/f83/872827f83b1c69f51503299e7950118b.png" alt="image"><br><br>  In my opinion it is much nicer than replimenu, everything is in Russian and users with a mouse are more comfortable to manage.  When you click the " <b>Cancel</b> " button in the menu or <b>Esc</b> on the keyboard, the thin client will turn off. <br><br>  If users don‚Äôt see the menu items, you can increase the font size in the <b>packages / fontconfig / etc / fonts / conf.avail / 51-local.conf file</b> , bringing it to this look and changing the <b>pixelsize</b> parameter: <pre> <code class="bash hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span>?&gt; &lt;!DOCTYPE fontconfig SYSTEM <span class="hljs-string"><span class="hljs-string">"fonts.dtd"</span></span>&gt; &lt;fontconfig&gt; &lt;!-- Load <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> system customization file --&gt; &lt;match target=<span class="hljs-string"><span class="hljs-string">"font"</span></span>&gt; &lt;edit name=<span class="hljs-string"><span class="hljs-string">"pixelsize"</span></span> mode=<span class="hljs-string"><span class="hljs-string">"assign"</span></span>&gt;&lt;int&gt;22&lt;/int&gt;&lt;/edit&gt; &lt;/match&gt; &lt;include ignore_missing=<span class="hljs-string"><span class="hljs-string">"yes"</span></span>&gt;local.conf&lt;/include&gt; &lt;/fontconfig&gt;</code> </pre>  Get this menu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b48/985/888/b4898588872ad311b1a83af8682e8168.png" alt="image"><br><br>  If the config download is configured over the network and the server names in the menu should be written in Russian (Cyrillic), then in the <b>packages / netfiles / etc / init.d / network_files file</b> , at the beginning there are 34 lines <br><pre> <code class="bash hljs">catv /tmp/<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$CONFNET</span></span></span><span class="hljs-string">"</span></span>network |sed -e <span class="hljs-string"><span class="hljs-string">'s/\^M//g'</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$TS_NETWORK</span></span> 2&gt; /dev/null</code> </pre>  replace <b>catv</b> with <b>cat</b> , otherwise in the menu you will get kryakozyabry. <br>  In principle, you can replace catv with cat in the whole file, it won't be worse. </div><p>Source: <a href="https://habr.com/ru/post/268697/">https://habr.com/ru/post/268697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268681/index.html">From game design to gameplay</a></li>
<li><a href="../268683/index.html">The usefulness of the checked exceptions is highly questionable, and the harm is obvious.</a></li>
<li><a href="../268685/index.html">As we did the first internship on iOS and Android-development in Redmadrobot</a></li>
<li><a href="../268689/index.html">Cloud for development companies: how Teslawatch smart bracelets use the cloud</a></li>
<li><a href="../268695/index.html">3 ways to set markup for different devices in C # / XAML Windows UWP applications</a></li>
<li><a href="../268699/index.html">Bomberlands - development history, annual report and tips for beginners</a></li>
<li><a href="../268701/index.html">Do you remember how it all started‚Ä¶</a></li>
<li><a href="../268703/index.html">What can a student expect in IT, and what options are there at all</a></li>
<li><a href="../268705/index.html">Create the first application for Apple watchOS 2</a></li>
<li><a href="../268707/index.html">Tablet for the elderly. How the project has evolved over the past two years</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>