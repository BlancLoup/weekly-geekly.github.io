<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>D for beginners, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr! 

 It is already quite an adult language, and there is very little material in Russian in the network. It is necessary to fill the gap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>D for beginners, part 1</h1><div class="post__text post__text-html js-mediator-article">  Good day, Habr! <br><br>  It is already quite an adult language, and there is very little material in Russian in the network.  It is necessary to fill the gap.  In this post I want to talk about a rather boring, but very important topic of modifiers, attributes and the like.  Their abundance in D can scare away people who are just starting to get acquainted with the language.  And not everyone who uses the language has a complete picture.  But not so scary, not harder than others) <br><a name="habracut"></a><br><h4>  Variable declaration and initialization </h4><br>  Let's start with the simple: <br><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> z; // z == <span class="hljs-type"><span class="hljs-type">int</span></span>.init == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span> a = <span class="hljs-number"><span class="hljs-number">5</span></span>; //    auto b = <span class="hljs-number"><span class="hljs-number">5</span></span>; // <span class="hljs-type"><span class="hljs-type">int</span></span> auto bl = <span class="hljs-number"><span class="hljs-number">5</span></span>_000_000_000; // long,    <span class="hljs-type"><span class="hljs-type">int</span></span>   auto bu = <span class="hljs-number"><span class="hljs-number">5</span></span>U; // uint, u  U ,   unsigned auto bl2 = <span class="hljs-number"><span class="hljs-number">5</span></span>L; // long,    L, l ( L)    <span class="hljs-number"><span class="hljs-number">1</span></span> auto bul = <span class="hljs-number"><span class="hljs-number">5</span></span>UL; // ulong,   U  L    const c = <span class="hljs-number"><span class="hljs-number">5</span></span>; // const(<span class="hljs-type"><span class="hljs-type">int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">immutable</span></span> d = <span class="hljs-number"><span class="hljs-number">5</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">immutable</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span>) shared e = <span class="hljs-number"><span class="hljs-number">5</span></span>; // shared(<span class="hljs-type"><span class="hljs-type">int</span></span>) shared const f = <span class="hljs-number"><span class="hljs-number">5</span></span>; // shared(const(<span class="hljs-type"><span class="hljs-type">int</span></span>)) shared <span class="hljs-keyword"><span class="hljs-keyword">immutable</span></span> g = <span class="hljs-number"><span class="hljs-number">5</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">immutable</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span>) auto k; // :       ,         <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> std.variant; Variant k2; //   ,    ,     </code> </pre> <br>  The type is explicitly indicated only for z, a, k2, in all the others it is derived from the literal, since  it is always easy to calculate the type of a variable.  You can read about the main data types <a href="http://habrahabr.ru/post/226565/">here</a> .  In addition to the literal, the type of the variable is automatically calculated if the result of the function is written to it. <br>  By default, in D all variables local to the stream ( <a href="https://en.wikipedia.org/wiki/Thread-local_storage">TLS</a> ), to use a variable in another thread, it must be shared or immutable.  It‚Äôs worth explaining how immutable differs from const.  When we create a variable, there is not much difference, and we cannot change the one and the other after initialization.  The significant difference appears when we transfer them to functions and methods, so we will return to this issue when considering the arguments of functions. <br><br><h4>  Array Types </h4><br><pre> <code class="hljs markdown">int[<span class="hljs-string"></span><span class="hljs-string"></span>] a; //   int[<span class="hljs-string"><span class="hljs-string">3</span></span>] b; //   int[<span class="hljs-string"><span class="hljs-string">int</span></span>] c; //   (    ) int[][] d; //   int[int[]] e; //      </code> </pre><br>  The last option, though possible, is not convenient, since you need to use an array of immutable values ‚Äã‚Äã(immutable) to set the value as the key: <br><pre> <code class="hljs pgsql">e[cast(<span class="hljs-keyword"><span class="hljs-keyword">immutable</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span>)[])[<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>]] = <span class="hljs-number"><span class="hljs-number">42</span></span>;</code> </pre><br>  And here we smoothly touched the topic of array type modifiers <br><pre> <code class="hljs objectivec">immutable(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] a = [<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//   int' a = [ 1, 2, 3, 4 ]; //        a,        (,  ) a.length = 8; //    a ~= a; //     a a[0] = 3; // :      ,  immutable(int) immutable(int[]) b = [8,3]; //    int,      immutable int[] c = [1,2,3]; // immutable(int[]),   </span></span></code> </pre><br>  I did not find a way to create an immutable array of mutable data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Modifiers can be combined: <br><pre> <code class="hljs pgsql">const(shared(<span class="hljs-type"><span class="hljs-type">int</span></span>)[]) a = [<span class="hljs-number"><span class="hljs-number">1</span></span>]; //      shared(const(<span class="hljs-type"><span class="hljs-type">int</span></span>)[]) b = [<span class="hljs-number"><span class="hljs-number">2</span></span>]; //      const(shared <span class="hljs-type"><span class="hljs-type">int</span></span>[]) c = [<span class="hljs-number"><span class="hljs-number">3</span></span>]; //    shared(const <span class="hljs-type"><span class="hljs-type">int</span></span>[]) d = [<span class="hljs-number"><span class="hljs-number">4</span></span>]; //   </code> </pre><br>  At first it may seem that there is not much difference between them. <br><div class="spoiler">  <b class="spoiler_title">And you can even check it out quickly.</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">(shared(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)[]) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> shared(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)[]) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_c</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">(shared </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_d</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> shared(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">) a )</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(shared(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[]) a = [<span class="hljs-number"><span class="hljs-number">1</span></span>]; shared(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[]) b = [<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(shared <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]) c = [<span class="hljs-number"><span class="hljs-number">3</span></span>]; shared(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]) d = [<span class="hljs-number"><span class="hljs-number">4</span></span>]; fnc_a( a ); fnc_a( b ); fnc_a( c ); fnc_a( d ); fnc_b( a ); fnc_b( b ); fnc_b( c ); fnc_b( d ); fnc_c( a ); fnc_c( b ); fnc_c( c ); fnc_c( d ); fnc_d( a ); fnc_d( b ); fnc_d( c ); fnc_d( d ); }</code> </pre><br></div></div><br>  Between the last two definitely not (this is one type).  But the rest is different.  This will be shown in the section on function arguments (spoiler "passing arrays by reference"). <br><br>  It is worth noting that string, wstring, dstring are just alias for immutable arrays of corresponding characters. <br><br><h4>  Pointers </h4><br>  <b>WARNING!</b>  there is a behavior different from C / C ++ <br><pre> <code class="hljs pgsql">const <span class="hljs-type"><span class="hljs-type">char</span></span> * a; // const(<span class="hljs-type"><span class="hljs-type">char</span></span>*),  ,    C/C++ const(<span class="hljs-type"><span class="hljs-type">char</span></span>)* b; // const(<span class="hljs-type"><span class="hljs-type">char</span></span>)*,  const <span class="hljs-type"><span class="hljs-type">char</span></span> *  C/C++ const(<span class="hljs-type"><span class="hljs-type">char</span></span>*) c; // const(<span class="hljs-type"><span class="hljs-type">char</span></span>*),    ,  </code> </pre><br>  And it is worth noting that there are no constructs in the language that create a constant pointer to non-constant memory, as could be done in C / C ++. <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> c; <span class="hljs-comment"><span class="hljs-comment">//  D  </span></span></code> </pre><br>  In general, the declaration of pointers and the rules for the distribution of modifiers are similar to those described for arrays (* instead of [] and everything). <br><br>  <b>WARNING!</b>  there is a behavior different from C / C ++ <br>  You should always remember that * (and []) in D explicitly refer to the data type and not to the variable identifier: <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* a, b; <span class="hljs-comment"><span class="hljs-comment">//      int</span></span></code> </pre><br>  In D, there is no way to declare variables of different types in one declaration; if you need a number and a pointer, then there will be 2 different declarations. <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* b;</code> </pre><br><h4>  Functions and Arguments </h4><br>  Let's start with the const and immutable arguments: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> A a )</span></span></span><span class="hljs-function"> </span></span>{ writeln( a.val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( immutable A a )</span></span></span><span class="hljs-function"> </span></span>{ writeln( a.val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A; <span class="hljs-comment"><span class="hljs-comment">//  ,  const   immutable func1( a ); //    func2( a ); //   ,     func2    A,   immutable }</span></span></code> </pre><br>  And so we see that immutable in this case is not the same as const.  When we declare a const argument, we guarantee that within the function this argument will not change.  In the case of immutable, we guarantee that the argument will never change after initialization.  The last statement allows you to use immutable variables as shared in other threads, since they are still immutable (never under any circumstances). <br>  There is a slippery moment: if we replace the class with the struct (and, accordingly, initialize the variable not as new A, but as A.init), then the code will work.  This is explained by the fact that structures, numerical types, static arrays are passed by value, and classes, dynamic and associative arrays are passed by reference.  And when passed by value, a copy is created, which implicitly can be reduced to the desired type. <br><br>  Types that are passed by value can be passed by reference: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func0</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ref A a )</span></span></span><span class="hljs-function"> </span></span>{ writeln( a.val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ref </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> A a )</span></span></span><span class="hljs-function"> </span></span>{ writeln( a.val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ref immutable A a )</span></span></span><span class="hljs-function"> </span></span>{ writeln( a.val ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> a = A.init; func0( a ); func1( a ); <span class="hljs-comment"><span class="hljs-comment">//   ,         func2( a ); //      immutable A b; func2( b ); func1( b ); //   , immutable   const func0( b ); //   ,    }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Passing arrays by reference</b> <div class="spoiler_text"><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">(shared(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)[]) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> shared(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)[]) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_c</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">(shared </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">) a )</span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(shared(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[]) a = [<span class="hljs-number"><span class="hljs-number">1</span></span>]; shared(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[]) b = [<span class="hljs-number"><span class="hljs-number">2</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(shared <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]) c = [<span class="hljs-number"><span class="hljs-number">3</span></span>]; fnc_a( a ); <span class="hljs-comment"><span class="hljs-comment">//fnc_a( b ); //fnc_a( c ); //fnc_b( a ); fnc_b( b ); //fnc_b( c ); //fnc_c( a ); fnc_c( b ); fnc_c( c ); }</span></span></code> </pre><br>  The array is a thick pointer (in D arrays store the size of the array and the pointer), and this pointer is copied to the function when passed to the function and can be converted to the desired type when copied, as with ordinary numbers.  But links are no longer implicitly cited.  The exception in the example is a call to a function that takes ref const (shared int []) with the argument shared (const (int) []), but everything is logical: the type of elements inside shared (const (int)), and the array itself is shared, and accepted by const.  In essence, the exception is that a simple argument can be passed to a function that expects a constant reference.  But with immutable it is no longer a ride.  But in conjunction with shared other combinations are possible: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> immutable(shared(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)[]) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> shared(immutable(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span></span><span class="hljs-function">)[]) a )</span></span> {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fnc_c</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> immutable(shared </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[]</span></span></span><span class="hljs-function">) a )</span></span> {} immutable(shared(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[]) a = [<span class="hljs-number"><span class="hljs-number">1</span></span>]; shared(immutable(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[]) b = [<span class="hljs-number"><span class="hljs-number">2</span></span>]; immutable(shared <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[]) c = [<span class="hljs-number"><span class="hljs-number">3</span></span>]; fnc_a( a ); <span class="hljs-comment"><span class="hljs-comment">//fnc_a( b ); fnc_a( c ); //fnc_b( a ); fnc_b( b ); //fnc_b( c ); fnc_c( a ); //fnc_c( b ); fnc_c( c ); }</span></span></code> </pre><br>  Since in this case the type of the variable a and c coincides: immutable (int []).  The immutable modifier "eats" all the combinations inside. <br></div></div><br>  If you want to write a function that works with different links, then const will do, but if you want to return the corresponding type depending on the argument, without using metaprogramming, inout will suit you: <br><pre> <code class="hljs cs">import std.stdio; inout(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] func( inout(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] a ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a[<span class="hljs-number"><span class="hljs-number">2.</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { auto a = [ <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span> ]; auto af = func(a); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">is</span></span></span></span><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-function"><span class="hljs-params">(af</span></span></span><span class="hljs-function">)</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] ) ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] b = [ <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span> ]; auto bf = func(b); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">is</span></span></span></span><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-function"><span class="hljs-params">(bf</span></span></span><span class="hljs-function">)</span></span> == <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] ) ); immutable(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] c = [ <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span> ]; auto cf = func(c); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">is</span></span></span></span><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">typeof</span></span></span></span><span class="hljs-function"><span class="hljs-params">(cf</span></span></span><span class="hljs-function">)</span></span> == immutable(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)[] ) ); }</code> </pre><br>  For cases when the argument passed by reference works for the output (to write the result to it, we do not care about the initial value) there is a special keyword out: <br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ int val; } void <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( out A a )</span></span></span></span> { } <span class="hljs-comment"><span class="hljs-comment">//    void main() { auto a = A(5); assert( a.val == 5 ); func( a ); assert( a.val == 0 ); //   }</span></span></code> </pre><br>  During a call to func, the variable a is assigned the value A.init (initializing the value for the data type). <br><br>  You may want to pass an argument by reference, with the guarantee that it will not be changed.  At first it may seem that the keyword in for it exists, but it is not, in is an abbreviation for the const scope, so you should be verbose about what you want: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v </span></span></span><span class="hljs-function">)</span></span> {}</code> </pre><br>  This is useful when transferring large structures, in order to avoid the overhead of copying.  But such an entry will not work with rvalue values, in this case it will not be possible to call func (5), since the literal has no address (this also applies to structures created at the time of the function exit).  Unfortunately, this can be bypassed only in one way - using templates: <br><pre> <code class="hljs go">void <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( auto ref </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T v )</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( is(T==</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> )</span></span>{}</code> </pre><br>  The auto ref construct will allow the function to be instantiated as to accept the link, and if it is not possible, then to accept a copy of the argument.  The if (is (T == int)) signature restriction construction allows you to instantiate a function only when the condition inside is met (in our case, this is a T type identity condition with an int), is always compile-time.  In fact, 2 different functions are instantiated for links and for copying. <br><div class="spoiler">  <b class="spoiler_title">Not good</b> <div class="spoiler_text">  The auto ref construct for the return type works with normal functions, as will be shown later.  Developers are <a href="">discussing the</a> problem, and even have a <a href="https://github.com/D-Programming-Language/dmd/pull/4717">solution</a> .  Here everything is not so simple and unambiguous, as it may seem. <br></div></div><br>  In D, as in many languages ‚Äã‚Äãthere is a lazy calculation of arguments (the calculation of an argument only at the moment when it is used) of the function: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, lazy </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str )</span></span></span><span class="hljs-function"> </span></span>{ writeln( <span class="hljs-string"><span class="hljs-string">"foo call"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( x ) writeln( str ); } <span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ writeln( <span class="hljs-string"><span class="hljs-string">"build string"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"hello habr"</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ writeln( <span class="hljs-string"><span class="hljs-string">"x = false"</span></span> ); foo( <span class="hljs-literal"><span class="hljs-literal">false</span></span>, bar() ); writeln( <span class="hljs-string"><span class="hljs-string">"x = true"</span></span> ); foo( <span class="hljs-literal"><span class="hljs-literal">true</span></span>, bar() ); }</code> </pre><br>  will lead <br><pre> <code class="hljs sql">x = false foo <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> x = <span class="hljs-literal"><span class="hljs-literal">true</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">build</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> hello habr</code> </pre><br>  A complete list of storage classes of arguments: <br><ul><li>  no - argument as mutable copy </li><li>  in - same as const scope </li><li>  out - pass by reference with initialization by default </li><li>  ref - just passing by reference </li><li>  scope - links inside such a parameter cannot be ‚Äúreleased outside‚Äù (escaped), for example, assigned to a global variable * </li><li>  lazy - the argument is calculated only at the moment when it is used in the function body </li><li>  const - the argument is implicitly cast to const type </li><li>  immutable - the argument is implicitly cast to the immutable type </li><li>  shared - the argument is implicitly cast to the shared type. </li><li>  inout - the argument is implicitly cast to the inout type. </li></ul><br><div class="spoiler">  <b class="spoiler_title">about scope</b> <div class="spoiler_text">  In fact, I did not understand what he was doing.  The documentation is written: <br><blockquote>  scope - references in the parameter cannot be escaped (eg assigned to a global variable) </blockquote><br>  What is denied by the performance of such a code: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* glob1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* glob2; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* ptr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( scope A a )</span></span></span><span class="hljs-function"> </span></span>{ glob1 = &amp;(a.val); glob2 = a.ptr; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> val = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> a = A(<span class="hljs-number"><span class="hljs-number">5</span></span>,&amp;val); func( a ); assert( &amp;val != &amp;(a.val) ); <span class="hljs-comment"><span class="hljs-comment">// a  assert( &amp;val == glob2 ); }</span></span></code> </pre><br>  Maybe I misunderstood something?  Maybe they cut the implementation of this behavior because they want to make the scope deprecated keyword.  Maybe this is just a bug. <br></div></div><br><br>  Of course, the auto keyword can be used to calculate the return value: <br><pre> <code class="hljs go">auto <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a )</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre><br>  With multiple returns, the enclosing type is computed: <br><pre> <code class="hljs go">auto <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, double b )</span></span></span><span class="hljs-function"> //   </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( a &gt; b ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( b &gt; a ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>UL; }</code> </pre><br>  For the case when you want to return a reference, you can use the auto ref return type. <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">A</span></span> { <span class="hljs-function"><span class="hljs-function">auto </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ref</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">B</span></span> : <span class="hljs-title"><span class="hljs-title">A</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> auto </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ref</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x; } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">C</span></span> : <span class="hljs-title"><span class="hljs-title">A</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> auto </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">ref</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x </span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> k; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { auto a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A; auto b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B; auto c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> C; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">//a.foo( val ) = 12; // :    rvalue  b.foo( val ) = 14; //   :      val assert( val == 14 ); c.foo( val ) = 16; //   :        c assert( val == 14 ); assert( ck == 16 ); }</span></span></code> </pre><br>  An example with OOP is given, because I do not quite understand why using auto ref outside this context, if you have a good, simple example illustrating the need for auto ref for normal functions, I will be happy to add it. <br><br>  <a href="http://habrahabr.ru/post/261079/">In the second</a> part we will talk about @ safe, pure, nothrow and some other aspects. <br>  Here I could forget something important (implicit for newcomers to the language), so I‚Äôll add to the commentators well. <br><br>  <b>UPD</b> : added pro pointers </div><p>Source: <a href="https://habr.com/ru/post/261043/">https://habr.com/ru/post/261043/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261031/index.html">Reactive extensions</a></li>
<li><a href="../261033/index.html">Turing's Cathedral: the origin of the digital universe</a></li>
<li><a href="../261035/index.html">MiTM Mobile Contest: How Mobile Phone Broke on PHDays V</a></li>
<li><a href="../261039/index.html">Inside the antivirus for Virusday sites - Part 1</a></li>
<li><a href="../261041/index.html">Children's camp: Bisectral-Pythagorean triangles, brain reprogramming, radar detector and breaking handcuffs</a></li>
<li><a href="../261045/index.html">Is the Internet of Things a Myth or a Reality?</a></li>
<li><a href="../261047/index.html">Updated functionality on VDS.menu</a></li>
<li><a href="../261049/index.html">CrystaX NDK 10.2 release</a></li>
<li><a href="../261051/index.html">May Python Meetup: machine learning and where to put the source</a></li>
<li><a href="../261055/index.html">When it's all about quantity. Nonlinear arithmetic of large quantities of electronic devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>