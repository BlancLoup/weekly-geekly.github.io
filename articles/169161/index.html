<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NodeSmarty new template engine for node.js (3.beta)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably every web developer has heard of the Smarty template engine (php) . But since I often enjoy javascript, it was decided to find a similar temp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NodeSmarty new template engine for node.js (3.beta)</h1><div class="post__text post__text-html js-mediator-article"><img src="http://nodesmarty.com/styles/logo_pre_min.png" alt="image" align="left">  Probably every web developer has heard of the <a href="http://www.smarty.net/">Smarty</a> template engine <a href="http://www.smarty.net/">(php)</a> .  But since I often enjoy javascript, it was decided to find a similar template engine for this language, but server (node.js, yeah).  The first links in the search engine give out such template engines such as: <a href="http://ectjs.com/">ECT</a> , <a href="https://github.com/baryshev/just">JUST</a> , <a href="https://github.com/raycmorgan/Mu">Mu</a> .  All of them, of course, did not fit for me, because  were too far from the Smarty syntax. <br><br>  Well, if you want, but there are no solutions, then do it.  Looking for time at work and sometimes getting on the "header", was born the project <b>NodeSmarty</b> , which, in the future, will partially copy the syntax of <b>Smarty</b> . <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, the project started its roots about 4 months ago, in September 2012, and gradually acquired a working look.  At the beginning, the entire algorithm for compiling templates was taken from Smarty (Smarty_Compiler.class.php file), some functions were not transferred.  In the process of writing code, I did all sorts of code abbreviations in terms of simplicity, since this is ‚Äúmy style‚Äù.  Therefore, all the huge regular expressions were replaced (and, by the way, it still was full of unnecessary garbage), part of the logic in the functions. <br><br>  Since the project is unpatched, it is perfectly clear that a sufficient number of bugs will be found in the process.  Also I am sure that there will be complaints in the direction of error handling in the templates (at this stage this ‚Äúfunction‚Äù is implemented poorly).  I will only be happy to receive messages on improving the code, and as far as possible I will make both corrections and new features. <br><br>  Examples of template work: <br><br>  <b>compiler.js:</b> <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> NodeSmarty = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./NodeSmarty/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Template = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NodeSmarty(); Template .setTemplateDir(<span class="hljs-string"><span class="hljs-string">'./templates/'</span></span>) .setCompileDir(<span class="hljs-string"><span class="hljs-string">'./compile/'</span></span>) .setCacheDir(<span class="hljs-string"><span class="hljs-string">'./cache/'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span> = [<span class="hljs-string"><span class="hljs-string">'val1'</span></span>, <span class="hljs-string"><span class="hljs-string">'two'</span></span>]; Template.assign({ <span class="hljs-string"><span class="hljs-string">'Value'</span></span>:<span class="hljs-string"><span class="hljs-string">'first'</span></span>, <span class="hljs-string"><span class="hljs-string">'number'</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'array'</span></span>:<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Final = Template.fetch(<span class="hljs-string"><span class="hljs-string">'template.tpl'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data); });</code> </pre> <br><br>  <b>template.tpl:</b> <br><pre> <code class="javascript hljs">{include file=<span class="hljs-string"><span class="hljs-string">"header.tpl.html"</span></span>} {$Value} {$number*<span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">20</span></span>} {<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !$Value} <span class="hljs-comment"><span class="hljs-comment">//... {elseif $number = $Value} //... {else} //... {/if} {* comment *} {literal} for(var di=0; di &lt; 10; di++) { console.log(di); } {/literal} {foreach from=$array item=Foo key=Key} Item: {$Foo} key: {$Key} {/foreach}</span></span></code> </pre><br><br>  The speed of code execution is higher than that of EJS and JUST.  This happens because when you re-request a file, it is not the template that is called, but already the compiled code.  But there is one more plus (although it is not there, but it will be in the future) - increasing the speed of execution also depends on the file system (yes, first you need to check whether the templates have changed, to recompile them).  If you compile the files at the first request, and then simply unload them from memory, then the speed will increase accordingly, and the code execution time will be even smaller! <br><br>  Comparing the speed of code execution at 1000 iterations: <br><br><img src="http://nodesmarty.com/styles/tests.png" alt="speed comparison"><br><br>  A little bit about the principle of work. <br><br>  If the template is changed before the file is compiled, the library simply loads the compiled file and inserts values ‚Äã‚Äãinto it.  If the template is changed later, the following instructions are followed: <br><br>  First of all, the document is parsed for the presence of the opening tag: <b>{</b> and the closing tag: <b>}</b> (although you can change it at will, see the documentation). <br>  Then each tag is parsed to the main parameter and attributes.  The main parameter is also processed and divided into 2 types: command or variable.  The variable is different from the command with the leading dollar sign ( <b>$</b> ).  Both the variable and the command are processed to convert themselves into working JavaScript code.  The compiled code is written to a file and <b>eval</b> text occurs (although there is not eval, but <b>new Function ()</b> ). <br><br><img src="http://nodesmarty.com/styles/logo_min2.png" alt="nodesmarty.com" align="left">  Link to the project: <a href="http://nodesmarty.com/">NodeSmarty.com</a> <br><br><img src="https://github.com/favicon.ico" alt="github.com" align="left">  GitHub.com Link: <a href="https://github.com/lampaa/NodeSmarty">github.com/lampaa/NodeSmarty</a> <br><br><img src="http://nodejs.org/favicon.ico" alt="nodejs" align="left">  Link to node.js: <a href="http://node.js/">node.js</a> </div><p>Source: <a href="https://habr.com/ru/post/169161/">https://habr.com/ru/post/169161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169149/index.html">Backing up data from a Google account: video How to</a></li>
<li><a href="../169151/index.html">Digital data storage: 60 years of progress</a></li>
<li><a href="../169153/index.html">Microsoft released another set of updates, February 2013</a></li>
<li><a href="../169157/index.html">Google will pay Apple $ 1 billion in 2014 for the right to be the default search engine in iOS</a></li>
<li><a href="../169159/index.html">Raspberry Pi as a Time Capsule for Mac OS</a></li>
<li><a href="../169163/index.html">Google announced the 9th "release" of Summer Of Code</a></li>
<li><a href="../169165/index.html">Personal experience: hobby = business?</a></li>
<li><a href="../169167/index.html">DateTime customization in SharePoint</a></li>
<li><a href="../169169/index.html">We remove advertising on the new site Computerra</a></li>
<li><a href="../169171/index.html">What to do in the case of large-scale alien invasion?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>