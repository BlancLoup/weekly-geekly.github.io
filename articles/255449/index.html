<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of all tasks of the qualifying game Yandex.Root</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tonight ended the first game of the qualifying round of Yandex.Root - the Olympics for Unix engineers and system administrators. It was attended by 45...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of all tasks of the qualifying game Yandex.Root</h1><div class="post__text post__text-html js-mediator-article">  Tonight ended the first game of the qualifying round of <a href="https://root.yandex.com/">Yandex.Root</a> - the Olympics for Unix engineers and system administrators.  It was attended by 456 people from 229 teams, 194 of which completed at least one task.  38 teams coped with all nine. <br><br>  We are conducting Root for the fourth time, but for the first time we decided to publish the task analysis on Habr√©.  The tasks that we give at the Olympiad are comparable to those that our system administrators regularly solve.  In Yandex, almost every day something rolls out and, when something goes wrong, you need to quickly recognize it and respond effectively. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/255449/"><img src="https://habrastorage.org/files/6d3/4a2/b15/6d34a2b1590449159129c06e45e3a04a.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, contests for system administrators are a much rarer genre than contests of programmers, so in some way we have to be pioneers here.  We tried very hard to make the tasks interesting, as well as those that really showed in the participants the qualities that are important in real work.  As far as we got it, judge you. <br><br>  We will be grateful if you tell us about it and share your opinion on how to do better.  By the way, if you want, you can try yourself in a real game.  The second part of the first round will take place in four days - on Tuesday, April 14, and you can still <a href="https://root.yandex.com/team/create">register</a> for it. <br><br><h2>  Shannon game </h2><br>  We decided to name all the games in memory of people who contributed to modern technologies that are used in our work.  This one is dedicated to <a href="http://en.wikipedia.org/wiki/Claude_Shannon">Claude Shannon</a> , an engineer and mathematician, who among other things gave us the word "bit."  By the way, the <a href="https://root.yandex.ru/">root.yandex.ru</a> service <a href="https://root.yandex.ru/">itself is</a> running on the compute nodes of the Yandex private cloud. <br><a name="habracut"></a><br>  The goal of the qualifying game is to solve several problems on the virtual machine by changing the configuration of the installed OS: for example, to start the service or adjust the program.  Tasks can be both related and independent.  It is necessary to ‚Äúclear the monitoring‚Äù, that is, to solve problems with the Critical status (marked in red) inside the virtual machine.  Her image can be downloaded in advance, the image is encrypted - the decryption key is published and sent to all participants by email at the beginning of the game. <br><br>  After decrypting the image, you need to establish a connection to the gaming VPN.  To do this, all participants receive a config-file: the captain receives it by mail at the time of approval of the application, team members - when they accept the invitation of the captain.  In case of loss, the file can be downloaded again with the ‚Äúdownload‚Äù command.  Each player can connect to the VPN from his virtual machine, so tasks can be distributed within the team and solved in parallel. <br><br><h3>  Base </h3><br>  <a href="https://en.wikipedia.org/wiki/Arch_Linux">ArchLinux is</a> used as the operating system for this game.  After the OS is loaded, the user sees the ‚Äúshannon login:‚Äù prompt.  The player has no clues regarding the access details.  As a rule, in such cases, you need to use the presence of "physical" access to the machine and reset the superuser password: <br><br><ul><li>  reboot, stop the countdown timer in the Grub bootloader; </li><li>  press 'e', ‚Äã‚Äãfind the linux line ..., append to the end init = / bin / bash; </li><li>  press Ctrl-X, waiting for the download; </li><li> enter the <code>passwd</code> command, set a new password; </li><li>  enter the <code>exec /sbin/init</code> command, the download continues. </li></ul><br>  After performing this procedure, you can log in with a new password. <br><br>  To solve problems, you need to install some packages, which means you need to prepare the package manager for work: <br><br><ul><li>  synchronize with the external mirror: <code>pacman-Sy</code> , <code>pacman-key --populate</code> ; </li><li>  update package manager: <code>pacman -S pacman</code> , <code>pacman-db-upgrade;</code> </li><li>  to solve some of the tasks we need tcpdump and strace: <br> <code>pacman -S tcpdump strace.</code> </li> </ul><br><br>  Inside the game image is a <i>game</i> program that runs test scripts (hereinafter referred to as checks) on a remote server.  In case of successful verification, the game counts the execution of the task. <br><br>  To ensure connectivity with a remote server, you need to configure OpenVPN.  The organizers have already prepared everything you need - just copy the configuration file (it is attached to the letter from Yandex.Root) in /etc/openvpn/openvpn.conf and execute the <code>systemctl start openvpn@openvpn</code> command. <br><br><h3>  1.SSL </h3><br>  This task was decided first of all.  The team SudariLudari coped with it.  The task is to generate a certificate signed by the specified certificate of the certification authority. <br><br><div class="spoiler">  <b class="spoiler_title">Set up a webserver with SSL</b> <div class="spoiler_text">  Here to generate your certificate: <br>  ----- BEGIN RSA PRIVATE KEY ----- <br>  MIICXAIBAAKBgQCjKwGnBHUwQtTzLb5uhrh + eRRAQyQwGzCg + n4XWzt8M + iX / OGx <br>  4QCG4GjKhi9Nqzhm41 + AjPB5cndU3Oe5j1LrcvWvxe2n15FG7hPSLG5dHe97pzpj <br>  KVma8OkcrUc6WWIccZ48FlV21ZCeUFukthtqEDDEEw1CxEnwHgIydnynlwIDAQAB <br>  AoGADTAfrREmK6VrMtCCsMpAxTAiG + ORXDYGYyx73oVoNGy5ovc0gr0N3tjqf1wD <br>  HML3BxHfmTNLCHXhAUHtlMjpya7kkJELurrFgEQ9gkcdogcf8Iw / J6GjBpJG2WlX <br>  vVL4zEiYw0T5TULGI54Iest0ZQx88EX8r + 6x1jI668RHCtECQQDYUPLf2K / 0FUyk <br>  csXoKq1ECseSVpfhG5NITqsLOc93jh3xAQFYtSuM7E3CeHkP + ZoKY / SGd9QkWrhd <br>  QQFoGL5vAkEAwRoCwNqlUWwTVayGdgw / D / mxtFelKRYl8kj50MeMraBqHM / ijXZt <br>  + wF5exUmuPio + nF64UIqLA1VCYhnqJ49WQJAL3DJY0hdhnVpYqN9PeamK0cF79Un <br>  6AmpKnF + V67tDjZP4LwstGy / SV / FygGr41IFc4Pqa9c54mM3DdSk31SV5wJAHW9f <br>  mBI8PQsib17bKEd5nW / MfNcXYAn2QtaI7iBc + 2KGilnOCQ5SeX6iC / cPbgbJi1Od <br>  DZVOZGSr38YhNvzYEQJBALoFJQEg6Xj44ClcJFIjbA + xyipk4h5JcmGvpUeKfaKF <br>  EBSJMECLR8wIa5XUkeRuM30JhTkd0s3WPUFaoBAvcvs = <br>  ----- END RSA PRIVATE KEY ----- <br><br>  ----- BEGIN CERTIFICATE ----- <br>  MIIDHzCCAoigAwIBAgIJALEwbIlKhnreMA0GCSqGSIb3DQEBBQUAMGkxCzAJBgNV <br>  BAYTAlJVMQ8wDQYDVQQIEwZNb3Njb3cxDzANBgNVBAcTBk1vc2NvdzEPMA0GA1UE <br>  ChMGWWFuZGV4MQ0wCwYDVQQLEwRSb290MRgwFgYDVQQDEw9yb290LnlhbmRleC5j <br>  b20wHhcNMTUwNDA2MTY0MzA5WhcNMTYwNDA1MTY0MzA5WjBpMQswCQYDVQQGEwJS <br>  VTEPMA0GA1UECBMGTW9zY293MQ8wDQYDVQQHEwZNb3Njb3cxDzANBgNVBAoTBllh <br>  bmRleDENMAsGA1UECxMEUm9vdDEYMBYGA1UEAxMPcm9vdC55YW5kZXguY29tMIGf <br>  MA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCjKwGnBHUwQtTzLb5uhrh + eRRAQyQw <br>  GzCg + n4XWzt8M + iX / OGx4QCG4GjKhi9Nqzhm41 + AjPB5cndU3Oe5j1LrcvWvxe2n <br>  15FG7hPSLG5dHe97pzpjKVma8OkcrUc6WWIccZ48FlV21ZCeUFukthtqEDDEEw1C <br>  xEnwHgIydnynlwIDAQABo4HOMIHLMB0GA1UdDgQWBBQG + ykV13EVW9XxCTncLjLV <br>  YVX83TCBmwYDVR0jBIGTMIGQgBQG + ykV13EVW9XxCTncLjLVYVX83aFtpGswaTEL <br>  MAkGA1UEBhMCUlUxDzANBgNVBAgTBk1vc2NvdzEPMA0GA1UEBxMGTW9zY293MQ8w <br>  DQYDVQQKEwZZYW5kZXgxDTALBgNVBAsTBFJvb3QxGDAWBgNVBAMTD3Jvb3QueWFu <br>  ZGV4LmNvbYIJALEwbIlKhnreMAwGA1UdEwQFMAMBAf8wDQYJKoZIhvcNAQEFBQAD <br>  gYEAmvNk8iAbV4 + YMq / 9oxkMeB6RxLs9m6jhYyAPuAI / dUhWSX + D + BnRcbsHWK4r <br>  a9G / riM1zerb5BD1apMz3faON2ydFJGB0thjlgr / KXfgaUXjp15QslEhsyhZIgEB <br>  Tak + 0BQkkh5 + cFAvJhGCZqajr6m2I8Dix3mF3Ey7nSx1GDU = <br>  ----- END CERTIFICATE ----- </div></div><br>  Let's write the data from the task into the ca.crt and ca.key files, respectively.  Now look at the certificate of the certification center: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># openssl x509 -in ca.crt -noout -text Certificate: Data: Version: 3 (0x2) Serial Number: 12767824280512002782 (0xb1306c894a867ade) Signature Algorithm: sha1WithRSAEncryption Issuer: C=RU, ST=Moscow, L=Moscow, O=Yandex, OU=Root, CN=root.yandex.com Validity Not Before: Apr 6 16:43:09 2015 GMT Not After : Apr 5 16:43:09 2016 GMT Subject: C=RU, ST=Moscow, L=Moscow, O=Yandex, OU=Root, CN=root.yandex.com Subject Public Key Info: Public Key Algorithm: rsaEncryption Public-Key: (1024 bit) Modulus: 00:a3:2b:01:a7:04:75:30:42:d4:f3:2d:be:6e:86: b8:7e:79:14:40:43:24:30:1b:30:a0:fa:7e:17:5b: 3b:7c:33:e8:97:fc:e1:b1:e1:00:86:e0:68:ca:86: 2f:4d:ab:38:66:e3:5f:80:8c:f0:79:72:77:54:dc: e7:b9:8f:52:eb:72:f5:af:c5:ed:a7:d7:91:46:ee: 13:d2:2c:6e:5d:1d:ef:7b:a7:3a:63:29:59:9a:f0: e9:1c:ad:47:3a:59:62:1c:71:9e:3c:16:55:76:d5: 90:9e:50:5b:a4:b6:1b:6a:10:30:c4:13:0d:42:c4: 49:f0:1e:02:32:76:7c:a7:97 Exponent: 65537 (0x10001) X509v3 extensions: X509v3 Subject Key Identifier: 06:FB:29:15:D7:71:15:5B:D5:F1:09:39:DC:2E:32:D5:61:55:FC:DD X509v3 Authority Key Identifier: keyid:06:FB:29:15:D7:71:15:5B:D5:F1:09:39:DC:2E:32:D5:61:55:FC:DD DirName:/C=RU/ST=Moscow/L=Moscow/O=Yandex/OU=Root/CN=root.yandex.com serial:B1:30:6C:89:4A:86:7A:DE X509v3 Basic Constraints: CA:TRUE Signature Algorithm: sha1WithRSAEncryption 9a:f3:64:f2:20:1b:57:8f:98:32:af:fd:a3:19:0c:78:1e:91: c4:bb:3d:9b:a8:e1:63:20:0f:b8:02:3f:75:48:56:49:7f:83: f8:19:d1:71:bb:07:58:ae:2b:6b:d1:bf:ae:23:35:cd:ea:db: e4:10:f5:6a:93:33:dd:f6:8e:37:6c:9d:14:91:81:d2:d8:63: 96:0a:ff:29:77:e0:69:45:e3:a7:5e:50:b2:51:21:b3:28:59: 22:01:01:4d:a9:3e:d0:14:24:92:1e:7e:70:50:2f:26:11:82: 66:a6:a3:af:a9:b6:23:c0:e2:c7:79:85:dc:4c:bb:9d:2c:75: 18:35</span></span></code> </pre> <br>  Request a new certificate with the same values: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># openssl req -out cert.csr -new -nodes Country Name (2 letter code) [AU]:RU State or Province Name (full name) [Some-State]:Moscow Locality Name (eg, city) []: Organization Name (eg, company) [Internet Widgits Pty Ltd]:Yandex Organizational Unit Name (eg, section) []:Root Common Name (eg server FQDN or YOUR name) []:10.0.0.15 Email Address []: Please enter the following 'extra' attributes to be sent with your certificate request A challenge password []: An optional company name []:</span></span></code> </pre> <br>  Prepare a structure for the work of the certification center: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir /etc/ssl/newcerts # echo 01 &gt; /etc/ssl/serial # touch /etc/ssl/index.txt</span></span></code> </pre> <br>  The following command will return an error, the text of which is not so obvious: <br><br><pre> <code class="hljs pgsql"># openssl ca -cert ca.crt -keyfile ca.key -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cert.csr -<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> cert.crt <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> /etc/ssl/openssl.cnf <span class="hljs-keyword"><span class="hljs-keyword">Check</span></span> that the request matches the signature Signature ok The stateOrProvinceName field needed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be the same <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the CA certificate (Moscow) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> the request (Moscow)</code> </pre> <br>  In fact, the problem is that the lines in the certificate <br>  Certification center and request are written in different encodings.  To work around this problem, edit the <i>/etc/ssl/openssl.cnf</i> file and change the value of the <code>string_mask</code> parameter in the <code>[req]</code> section to <code>pkix</code> . <br><br>  It remains to prepare the files for the web server: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mv privkey.pem cert.key # cat ca.crt &gt;&gt; cert.crt</span></span></code> </pre> <br>  Now we will install the web server <code>(pacman -S nginx)</code> and <i>enable</i> SSL in <i>/etc/nginx/nginx.conf%</i> , uncommenting the appropriate section of the <i>server {}</i> . <br><br>  Checking: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful # systemctl restart nginx</span></span></code> </pre> <br>  But the decision is not made by the checking system with the diagnostics <i>‚ÄúSSLv3 is weak‚Äù</i> .  Change the configuration to the recommended <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/">Mozilla</a> : <br><br><ul><li>  mark the options Nginx and Modern, insert the configuration in <i>nginx.conf</i> ; </li><li>  generate the Diffie-Hellman parameters: <code>openssl dhparam -out dhparam.pem -outform PEM -2 2048</code> ; </li><li>  restart <i>nginx</i> : <code>systemctl restart nginx.</code> </li></ul><br><h3>  2.MariaDB repair </h3><br>  This task requires recovery of the database. <br><br><blockquote>  There is a MariaDB database in / var / lib / mysql.  We had access there with login checker and master key, but something went wrong. <br><pre> <code class="bash hljs">BTW, the `data` table structure was: +-------+---------+------+-----+---------+-------+ | Field | Type | Null | Key | Default | Extra | +-------+---------+------+-----+---------+-------+ | name | text | YES | | NULL | | | hits | int(11) | YES | | NULL | | | size | int(11) | YES | | NULL | | +-------+---------+------+-----+---------+-------+</code> </pre> </blockquote><br><br>  From the name it is obvious that the database is used <a href="https://en.wikipedia.org/wiki/MariaDB">MariaDB</a> , known MySQL fork. <br><br>  Install the DBMS: <code>pacman -S mariadb</code> and try to start <code>systemctl start mysqld</code> .  From the logs it is clear that <i>mysqld is</i> looking for files in the wrong place.  From the configuration file <code>/etc/mysql/my.cnf</code> can see that the system‚Äôs operation in the network mode is broken - <i>skip-networking</i> , <i>bind-address</i> options are added, the wrong <i>datadir</i> value is specified.  To save time, we will not attempt to repair the configuration file;  instead, replace it with a known working: <br><br><pre> <code class="bash hljs">[mysqld] key_buffer_size = 16M max_allowed_packet = 1M table_open_cache = 64 sort_buffer_size = 512K net_buffer_length = 8K read_buffer_size = 256K read_rnd_buffer_size = 512K myisam_sort_buffer_size = 8M tmpdir = <span class="hljs-string"><span class="hljs-string">'/var/tmp'</span></span></code> </pre> <br>  Let's correct the owner of the files - <code>chown -R mysql:mysql /var/lib/mysql</code> , and try to start the database again - <code>systemctl restart mysqld</code> . <br><br>  Hurray, <i>mysqld</i> works.  Let's try to connect: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mysql ERROR 1045 (28000): Access denied for user 'root'@'localhost' (using password: NO)</span></span></code> </pre> <br>  We see that password protection is set, and the password is unknown to us / So, as in the case of the operating system, we will have to reset it: <br><br><ul><li>  stop <code>mysqld: systemctl stop mysqld</code> ; </li><li>  prepare the file with the reset instruction: <code>echo "UPDATE mysql.user SET password = PASSWORD('root') where user = 'root';" &gt; /tmp/reset.sql</code>  <code>echo "UPDATE mysql.user SET password = PASSWORD('root') where user = 'root';" &gt; /tmp/reset.sql</code> ; </li><li>  we start mysqld with loading of our file: <code>mysqld --user=mysql --init-file=/tmp/reset.sql</code> ; </li><li>  Now we <i>‚Äôll</i> stop <i>mysqld in a</i> regular way. To do this, press <code>Ctrl-\</code> ; </li><li>  run unit again - <code>systemctl start mysqld</code> </li></ul><br>  After performing this procedure, we can already connect to the database with the password <code>root</code> .  Let's try: <code>mysql -ppassword -uroot</code> .  From the output of the <code>show databases</code> command, we see the existence of the <code>db</code> database, but there is no <code>data</code> table in it.  However, this table is on disk <code>(/var/lib/mysql/db/data.ibd)</code> .  Not enough table definition (data.frm). <br><br>  Fortunately, the task contains a hint on how the table looks, which allows you to reconstruct frm without analyzing the system tables.  Run the query: <br><br><pre> <code class="bash hljs">create table data2 (name text, hits int(11), size int(11));</code> </pre> <br>  Create a table with the name data does not work, because the system tables still contain its mention.  Now connect the data file to our new table.  To do this, disable the "empty" ibd-file from the table: <code>alter table data2 discard tablespace;</code>  , substitute it filled with <code>mv data.ibd data2.ibd</code> and connect back to <code>alter table data2 import tablespace;</code>  . <br><br>  Since db.data is still listed in the system tables, we cannot make the <code>drop table db.data</code> .  You will have to create a temporary database, transfer a new table to it, delete the old one, and then create it again: <br><br><pre> <code class="bash hljs">rename table db.data2 to db2.data; drop database db; create database db character <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> utf8; rename table db2.data to db.data; alter table db.data engine = innodb;</code> </pre> <br>  It remains only to give access to the user: <code>grant all privileges on db.* to 'checker'@'%' identified by 'masterkey';</code>  .  Unfortunately, the test fails due to a connection error.  A check with tcpdump indicates that mysqld is not responding.  Let's check the firewall with <code>iptables-save</code> and find the problem left by the villain ‚Äî erroneous rules have been added to the nat table.  However, removing them briefly restores the network - the rules appear again. <br><br>  As a rule, periodic actions are caused by the work of <i>crontab</i> .  Check <code>(crontab -l, cat /etc/cron.* /etc/crontab /etc/cron.d/*)</code> and delete all the tasks of the current user <code>(crontab -r)</code> . <br><br><h3>  3.Binary </h3><br><blockquote>  Run 1.exe </blockquote><br><br>  In this task, you need to run an "unusual" program.  From the task we know the file name - "1.exe".  Find the file on the file system and check its contents: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># find / -iname 1.exe /root/1/1.exe # file /root/1/1.exe /root/1/1.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows</span></span></code> </pre> <br>  To run .NET applications under <i>GNU / Linux,</i> there is a mono environment.  Install it <code>(pacman -S mono)</code> and try to run our program: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cd /root/1 # mono 1.exe</span></span></code> </pre><br>  But this task is not as simple as it seems.  In return, the <i>game</i> will return: <br><br><pre> <code class="bash hljs">Name: Binary Status: uncompleted Output: bad program</code> </pre> <br>  Let's try to understand what the 1.exe program does.  Running <i>mono</i> under <i>strace</i> will show that the program listens on a TCP socket and executes the commands sent by the test.  Surface traffic analysis using <i>tcpdump</i> shows that the program can read files, access the embedded database and perform calculations.  Verification finishes work after performing the calculations, which means that the problem most likely lies in them. <br><br>  You can often extract additional information by searching for text strings inside executable files.  Let's try to use this technique - install the <code>binutils</code> software <code>binutils</code> and apply the <i>strings</i> program to the 1.exe file.  One piece of output is similar to the list of libraries used by the program: <br><br><pre> <code class="bash hljs">System.Core mscorlib System.Xml dnAnalytics</code> </pre> <br>  All of these libraries, except <i>dnAnalytics</i> , are part of <i>mono</i> - this is easy to check with the help of the package manager <code>(pacman -Ql mono)</code> . <br><br>  Install the missing library by downloading and unpacking the <a href="http://download-codeplex.sec.s-msft.com/Download/Release%3FProjectName%3Ddnanalytics%26DownloadId%3D76989%26FileTime%3D128967908865470000%26Build%3D20983">archive from the official site</a> (bin / *. Dll should be put in / root / 1). <br>  After restarting, the program successfully passes the test. <br><br><h3>  4.Mongo </h3><br>  In this task, you need to deploy the MongoDB shard storage, writing down the data offered by the organizers. <br><br><blockquote>  There is a database in /var/lib/db.tar.gz. <br><br>  Make a root. Features a collection of 2 shards <br></blockquote><br>  First, install mongodb: <code>pacman -S mongodb</code> .  The organizers left the archive with the base, unpack it and make an archive copy: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /var/lib/mongodb tar jxf /var/lib/db.tar.bz2 mongod --dbpath db mongodump rm -rf db</code> </pre> <br>  For sharding you will need a special service database called <i>configdb</i> .  Create it: <br><br><pre> <code class="bash hljs">mkdir -p /data/configdb mongod --configsvr &amp;</code> </pre> <br>  Now run the ‚Äúsharper‚Äù mongos: <code>mongos --configdb localhost &amp;</code> .  The task is to raise two shards, so we will prepare two <i>mongod</i> instances: <br><br><pre> <code class="bash hljs">mkdir /var/lib/mongodb/s1 /var/lib/mongodb/s2 mongod --dbpath /var/lib/mongodb/s1 --port 30001 --nojournal &amp; mongod --dbpath /var/lib/mongodb/s1 --port 30002 --nojournal &amp;</code> </pre> <br>  And connect them to <i>mongos</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mongo mongos&gt; sh.addShard("localhost:30001") mongos&gt; sh.addShard("localhost:30002") mongos&gt; sh.enableSharding("root")</span></span></code> </pre> <br>  Now it remains to load the dump back: <code>mognorestore --port 30001 dump/</code> . <br><br>  However, this is not enough to solve the problem - the root.features collection will not be evenly shared between two shards.  Let's solve this problem by creating an index on the document identifier and turning on the balancer: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mongo root mongos&gt; db.features.ensureIndex({"_id":"hashed"}) mongos&gt; sh.shardCollection("root.features", {"_id":"hashed"}) mongos&gt; sh.enableBalancing("root.features")</span></span></code> </pre> <br>  Having waited until the collection is redistributed between shards, we will run the test again. <br><br><h3>  5.Strange Protocol </h3><br>  This task was the most difficult.  Actually, as we ourselves predicted. <br><blockquote>  Set up an echo server on port 13000. </blockquote><br>  This time we need to start the echo server on port 13000. <br><br>  This task seems simple - indeed, the simplest implementation of the echo server is already built in, for example, in <a href="https://en.wikipedia.org/wiki/Xinetd">xinetd</a> .  Running <i>tcpdump port 13000</i> shows that the exchange takes place via the UDP protocol, but setting up the <i>echo-dgram</i> in <i>xinetd</i> does not give the expected result. <br><br>  Let's take a closer look at the traffic - run <i>tcpdump</i> again, but with the -X option.  The latest package seems interesting: <br><br><pre> <code class="bash hljs"> 0x0010: 0a00 000f ebee 32c8 0012 ffd6 656e 6574 ......2.....enet 0x0020: 2065 7272 6f72 .error</code> </pre><br>  Searching for the word <code>enet</code> leads to a site that describes the implementation of the enet protocol, which allows you to send data streams via UDP without worrying about packet loss (as in TCP). <br><br>  Further search leads to the <code>pyenet</code> library, binding to the <i>enet</i> for the Python language, which is just right for our task.  Let's write a simple program: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> enet <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys host = enet.Host(enet.Address(<span class="hljs-string"><span class="hljs-string">b'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">13000</span></span>), <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: evt = host.service(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> evt.type == enet.EVENT_TYPE_RECEIVE: data = evt.packet.data evt.peer.send(<span class="hljs-number"><span class="hljs-number">0</span></span>, enet.Packet(data))</code> </pre> <br>  It remains to install these libraries: <br><br><pre> <code class="bash hljs">pacman -S git git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/aresch/pyenet <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pyenet git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/lsalzman/enet pacman -S cython base-devel python setup.py build python setup.py install</code> </pre> <br>  We start our program, and the check is performed successfully this time. <br><br><h3>  6.File </h3><br>  The organizers hid root.txt somewhere inside <i>/ root / file</i> . <br><blockquote>  There is a / root / file inside your image.  Find a good root.txt file and make it available via <a href="http://image_ip/root.txt">image_ip / root.txt</a> . </blockquote><br>  Let's try to understand what is <i>/ root / file</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># file /root/file /root/file: LVM2 PV (Linux Logical Volume Manager), UUID: XT6zLL-YAUv-nmA9-BSrw-2pBV-CTi2-vqKe35, size: 31457280</span></span></code> </pre> <br>  It looks like a disk image.  Linux has a kernel <i>loop</i> module, which allows you to turn files into block devices.  We use it: <br><br><pre> <code class="bash hljs">losetup /dev/loop0 /root/file</code> </pre> <br>  Since the LVM volume is located inside the disk image, let's connect it with regular tools: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vgchange -ay 1 logical volume(s) in volume group "VolGroup00" now active</span></span></code> </pre><br>  Let's see what's inside: <br><br><pre> <code class="bash hljs">mount /dev/mapper/VolGroup00-lv0 /mnt ls /mnt</code> </pre> <br>  <i>See root.txt.gz</i> , unpack: <code>gunzip /mnt/root.txt.gz</code> . <br><br>  Since we have already installed nginx for setting SSL, we will use it to distribute the file via HTTP: <br><pre> <code class="bash hljs">umount /mnt mount /dev/mapper/VolGroup00-lv0 /usr/share/nginx/html/</code> </pre><br>  Unfortunately, the check fails - we found the wrong <i>root.txt</i> .  We will look further.  Let's see what our file system is: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># file -s /dev/dm-0 /dev/dm-0: BTRFS Filesystem sectorsize 4096, nodesize 4096, leafsize 4096)</span></span></code> </pre> <br>  Since <a href="https://en.wikipedia.org/wiki/Btrfs">btrfs</a> has an understandable <a href="http://en.wikipedia.org/wiki/Btrfs">subvolume</a> , let's look at their list: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># pacman -S btrfs-progs # btrfs subvolume list /usr/share/nginx/html/ ID 256 gen 14 top level 5 path root ID 257 gen 11 top level 5 path root_1</span></span></code> </pre> <br>  It turns out that there is another <i>subvolume</i> - root_1.  We mount it exactly: <br><br><pre> <code class="bash hljs">umount /usr/share/nginx/html mount -t btrfs -o subvol=root_1 /dev/mapper/VolGroup00-lv0 /usr/share/nginx/html/</code> </pre> <br>  Now we have found another <i>root.txt.gz</i> file.  Unpack it: <nobr>gunzip <code>/usr/share/nginx/html/root.txt.gz</code></nobr> . <br><br>  This will be the solution to the problem. <br><br><h3>  7.MariaDB Tuning </h3><br>  While solving the MariaDB repair problem, we repaired the database, but it works too slowly.  It is time to fix it. <br><br><blockquote>  The repaired MariaDB is slow.  Tune it up. </blockquote><br>  Let's see where our base slows down.  Let's turn on the <i>slow query log</i> , where all queries that run for longer than a second will get: <br><br><pre> <code class="bash hljs">mysql -u root -ppassword db mysql&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> global slow_query_log = ON; mysql&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> global long_query_time = 1;</code> </pre> <br>  Run the check and look at the log: <code>tail /var/lib/mysql/shannon-slow.log</code> . <br><br>  We see the query <code>SELECT COUNT(*) FROM db.data WHERE size &lt; 10;</code>  . <br><br>  Let's look at the query plan: <br><br><pre> <code class="bash hljs">mysql&gt; explain SELECT COUNT(*) FROM db.data WHERE size &lt; 10 \G *************************** 1. row *************************** id: 1 select_type: SIMPLE table: data <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: ALL possible_keys: NULL key: NULL key_len: NULL ref: NULL rows: 25061163 Extra: Using <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> 1 row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> (0.00 sec)</code> </pre> <br>  Of course, such a query is executed too slowly - we do not have indices for this field.  Add an index: <code>mysql&gt; create index data_size on data(size);</code>  . <br><br>  Restarting the test will show us the same problem for data (hits), which we solve in the same way. <br><br><h3>  8.HG </h3><br>  In <code>/root/repo  mercurial</code> repository, for which we need to correct the story and make it available via http. <br><br><blockquote>  There is a HG repository in / root / repo. <br><br>  Drop all .gz files in all revisions available via <a href="http://ip/">ip</a> : 8000 / <br></blockquote><br>  First, install <i>mercurial</i> : <code>pacman -S mercurial</code> .  You can change the history using the <i>convert</i> module, which is disabled by default.  Turn it on: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat &lt;&lt;EOF &gt; ~/.hgrc [extensions] hgext.convert= EOF</span></span></code> </pre> <br>  This module can apply file matching rules in the source and target repositories.  Such rules are called <code>filemap</code> .  We write and apply a rule that throws out a file <i>2.osm.gz</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'exclude "2.osm.gz"'</span></span> &gt; /root/fmap hg convert --filemap ~/fmap /root/repo /root/repo1</code> </pre> <br>  After executing the command, we get the repository <i>/ root / repo1</i> , which is devoid of the <i>2.osm.gz</i> file in all revisions.  It remains to make it accessible from the outside.  <i>Mercurial</i> has a built-in web server, which we will use: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /root/repo1 hg serve</code> </pre> <br><h3>  9.Strange File </h3><br>  This task was handled by the largest number of commands - 151. There is a strange <i>tester / file</i> on the file system that no one can change. <br><br><blockquote>  We got a strange file in ~ tester / file.  No one can change it.  Fix it. </blockquote><br>  Indeed, the file cannot be changed - even from under the root: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># echo test &gt;&gt; ~tester/file -bash: /home/tester/file: Permission denied</span></span></code> </pre> <br>  First, let's see what our file system is: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount | grep ' on / ' /dev/sda2 on / type ext4 (rw,relatime,data=ordered)</span></span></code> </pre> <br>  From the ext4 <code>(man 5 ext4)</code> you can find out that files on this file system can have <br>  following attributes: <div class="spoiler">  <b class="spoiler_title">FILE ATTRIBUTES</b> <div class="spoiler_text">  The ext2, ext3, and ext4 filesystems support the following file attributes on <br>  Linux systems using the chattr (1) utility: <br><br>  a - append only <br><br>  A - no atime updates <br><br>  d - no dump <br><br>  D - synchronous directory updates <br><br>  i - immutable <br><br>  S - synchronous updates <br><br>  u - undeletable <br><br>  In addition, the ext3 and ext4 filesystems support the following flag: <br><br>  j - data journaling <br><br>  Finally, the ext4 filesystem also supports the following flag: <br><br>  e - extents format <br><br>  For descriptions of these attribute flags, please refer to the chattr (1) man page. </div></div><br>  Let's look at the <i>chattr (1)</i> page, where the behavior of the system for files with the <i>immutable</i> attribute set is described in detail: <div class="spoiler">  <b class="spoiler_title">ATTRIBUTES</b> <div class="spoiler_text">  It is not possible to write it.  CAP_LINUX_IMMUTABLE capability can only be set or clear this attribute. </div></div><br>  The answer is obvious - you need to remove this attribute from the file: <code>chattr -i ~tester/file</code> .  Problem solved. </div><p>Source: <a href="https://habr.com/ru/post/255449/">https://habr.com/ru/post/255449/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255437/index.html">Use the built-in firewall in InfoboxCloud</a></li>
<li><a href="../255439/index.html">Intel Summer School 0x7DF. Time to apply</a></li>
<li><a href="../255443/index.html">Git for Windows Alternatives</a></li>
<li><a href="../255445/index.html">RTOS should simplify the development of IoT devices</a></li>
<li><a href="../255447/index.html">Microsoft hackathon "IoT - Internet of Things" in Nizhny Novgorod</a></li>
<li><a href="../255451/index.html">The story of one spacewalk</a></li>
<li><a href="../255453/index.html">Microsoft Unveils New Container Technology for Next-Generation Cloud</a></li>
<li><a href="../255455/index.html">Ice cream candy, or how to add some Material to your application</a></li>
<li><a href="../255457/index.html">Lights Out and its unusual uses</a></li>
<li><a href="../255459/index.html">Making the code cleaner: A few words about the managed resources in the Linux kernel for device drivers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>