<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Guide: how to use Python for algorithmic trading on the exchange. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to publish an adaptation of the DataCamp manual on using Python to develop financial applications. The first part of the material was abou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Guide: how to use Python for algorithmic trading on the exchange. Part 2</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/itinvest/blog/331940/"><img src="https://habrastorage.org/web/9d0/e62/776/9d0e627764b748f3aaac1dfddc3d2a40.png"></a> <br><br>  We continue to publish an adaptation of <a href="https://www.datacamp.com/community/tutorials/finance-python-trading">the DataCamp manual</a> on using Python to develop financial applications.  <a href="https://habrahabr.ru/company/itinvest/blog/331542/">The first part of the</a> material was about the structure of financial markets, stocks and trading strategies, these time series, as well as what is needed to start developing. <br><br>  Now that you already know more about the data requirements, understand the concept of time series and become familiar with pandas, it's time to dive deeper into the topic of financial analysis, which is necessary to create a trading strategy. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Jupyter notebook of this manual can be downloaded <a href="https://github.com/Kacawi/datacamp-community">here</a> .</i> <a name="habracut"></a><br><br><h2>  General financial analysis: profit calculation </h2><br>  With a <b>simple calculation of the daily percentage change</b> , for example, dividends and other factors are not taken into account - the percentage change in the price of the acquired shares is simply noted compared to the previous trading day.  It is easy to calculate such changes using the pct_change () function included in the Pandas package. <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Import `numpy` as `np` import numpy as np # Assign `Adj Close` to `daily_close` daily_close = aapl[['Adj Close']] # Daily returns daily_pct_change = daily_close.pct_change() # Replace NA values with 0 daily_pct_change.fillna(0, inplace=True) # Inspect daily returns print(daily_pct_change) # Daily log returns daily_log_returns = np.log(daily_close.pct_change()+1) # Print daily log returns print(daily_log_returns)</span></span></code> </pre> <br>  Revenue will be calculated on a logarithmic scale - this allows you to more clearly track changes over time. <br><br>  Knowing the profit per day is good, but what if we need to calculate this figure for a month or even a quarter?  In such cases, you can use the resample () function, which we discussed in the last part of the manual: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Resample `aapl` to business months, take last observation as value monthly = aapl.resample('BM').apply(lambda x: x[-1]) # Calculate the monthly percentage change monthly.pct_change() # Resample `aapl` to quarters, take the mean as value per quarter quarter = aapl.resample("4M").mean() # Calculate the quarterly percentage change quarter.pct_change()</span></span></code> </pre> <br><br>  Using pct_change () is convenient, but in this case it is difficult to understand exactly how the daily income is calculated.  Therefore, as an alternative, you can use the Pandas function called shift ().  Then you need to divide the daily_close values ‚Äã‚Äãby daily_close.shift (1) -1.  When using this function, the NA values ‚Äã‚Äãwill be at the beginning of the resulting data frame. <br><br>  For reference, the calculation of the daily change in the value of shares is calculated by the formula: <br><br><img src="https://habrastorage.org/web/333/042/732/333042732b0e4eafb3ee6478447bf4c1.png">  , <br><br>  Where p is the price, t is the time (in our case, the day), and r is the income.  You can create a daily_pct_change distribution schedule: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Import matplotlib import matplotlib.pyplot as plt # Plot the distribution of `daily_pct_c` daily_pct_change.hist(bins=50) # Show the plot plt.show() # Pull up summary statistics print(daily_pct_change.describe())</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/67b/87e/346/67b87e34695ede31f80665823b6e11d5.png" alt="image"><br><br>  The result looks symmetrical and normally distributed: the daily price change is around bin 0.00.  It should be understood that to correctly interpret the results of the histogram, use the describe () function applied to daily_pct_c.  In this case, it will be seen that the average value is also close to bin 0.00, and the standard deviation is 0.02.  You also need to examine the percentiles in order to understand how much data goes beyond the boundaries of -0.010672, 0.001677 and 0.014306. <br><br>  The indicator of the <b>total daily rate of return</b> is useful for determining the value of investments on regular segments.  You can calculate the total daily rate of return using the values ‚Äã‚Äãof daily changes in asset prices as a percentage, adding 1 to them and calculating the final values: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Calculate the cumulative daily returns cum_daily_return = (1 + daily_pct_change).cumprod() # Print `cum_daily_return` print(cum_daily_return)</span></span></code> </pre> <br>  Here again, you can use Matplotlib to quickly draw cum_daily_return.  It is only necessary to add the function plot () and, optionally, determine the size of the graphic using figsize. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Import matplotlib import matplotlib.pyplot as plt # Plot the cumulative daily returns cum_daily_return.plot(figsize=(12,8)) # Show the plot plt.show()</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/2a4/89f/e2b/2a489fe2bf4e888d001b8fe0c1450243.png" alt="image"><br><br>  It's pretty simple.  Now, if you want to analyze not daily income, but monthly, you should return to the resample () function - with its help you can bring cum_daily_return to monthly values: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Resample the cumulative daily return to cumulative monthly return cum_monthly_return = cum_daily_return.resample("M").mean() # Print the `cum_monthly_return` print(cum_monthly_return)</span></span></code> </pre> <br>  Knowing how to calculate income is a useful skill, but in practice these values ‚Äã‚Äãrarely carry valuable information unless you compare them with other stocks.  That is why in different examples two or more actions are often compared. <br><br>  To do this too, you first need to upload more data - in our case, from Yahoo!  Finance.  To do this, you can create a function that will use the ticker of the stock, as well as the start and end dates of the trading period.  In the example below, the data () function takes a ticker to receive data, starting from startdate to enddate, and returns the result of the get () function.  The data is laid out using the correct ticker (ticker), the result is a data frame containing this information. <br><br>  In the code below, Apple, Microsoft, IBM, and Google share data are loaded into one common data frame: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tickers, startdate, enddate)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ticker)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (pdr.get_data_yahoo(ticker, start=startdate, end=enddate)) datas = map (data, tickers) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(pd.concat(datas, keys=tickers, names=[<span class="hljs-string"><span class="hljs-string">'Ticker'</span></span>, <span class="hljs-string"><span class="hljs-string">'Date'</span></span>])) tickers = [<span class="hljs-string"><span class="hljs-string">'AAPL'</span></span>, <span class="hljs-string"><span class="hljs-string">'MSFT'</span></span>, <span class="hljs-string"><span class="hljs-string">'IBM'</span></span>, <span class="hljs-string"><span class="hljs-string">'GOOG'</span></span>] all_data = get(tickers, datetime.datetime(<span class="hljs-number"><span class="hljs-number">2006</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), datetime.datetime(<span class="hljs-number"><span class="hljs-number">2012</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>))</code> </pre> <br>  <i><b>Note</b> : this code was also used in the <a href="http://shop.oreilly.com/product/9781783985104.do">Pandas use</a> guide <a href="http://shop.oreilly.com/product/9781783985104.do">for the financial industry</a> , it was later finalized.</i>  <i>Also, since there are currently problems with loading data from Yahoo!</i>  <i>Finance, for correct operation, you may have to download the fix_yahoo_finance package ‚Äî installation instructions can be found <a href="https://github.com/ranaroussi/fix-yahoo-finance">here</a> or in the <a href="https://www.datacamp.com/community/tutorials/finance-python-trading">Jupyter notebook of this guide</a> .</i> <br><br>  Here is the result of executing this code: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fad/b73/e6d/fadb73e6dbfd4688d942670ab5506a55.png" alt="image"><br><br>  This large data frame can be used to draw interesting graphs: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Import matplotlib import matplotlib.pyplot as plt # Isolate the `Adj Close` values and transform the DataFrame daily_close_px = all_data[['Adj Close']].reset_index().pivot('Date', 'Ticker', 'Adj Close') # Calculate the daily percentage change for `daily_close_px` daily_pct_change = daily_close_px.pct_change() # Plot the distributions daily_pct_change.hist(bins=50, sharex=True, figsize=(12,8)) # Show the resulting plot plt.show()</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/5a2/5f2/1ce/5a25f21ce819b06ca303774b5189891e.png" alt="image"><br><br>  Another useful graph for financial analysis is the scattering matrix.  You can get it using the pandas library.  It will be necessary to add the function scatter_matrix () to the code.  As arguments, the daily_pct_change is passed, and the diagonal is set to an optional value so as to obtain a graph of the core density estimation (Kernel Density Estimate, KDE).  Also, using the alpha argument, you can set the transparency, and using figsize to change the size of the graph. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Import matplotlib import matplotlib.pyplot as plt # Plot a scatter matrix with the `daily_pct_change` data pd.scatter_matrix(daily_pct_change, diagonal='kde', alpha=0.1,figsize=(12,12)) # Show the plot plt.show()</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/e2e/8ee/f33/e2e8eef330b8a55a9d0b894ca5bb2795.png" alt="image"><br><br>  In the case of local work, the plotting module (i.e., pd.plotting.scatter_matrix ()) may be needed to build the scattering matrix. <br><br>  The next part of the guide will discuss the use of sliding windows for financial analysis, the calculation of volatility and the application of the usual least squares regression. <br><br>  <i>To be continued‚Ä¶..</i> <br><br><h2>  Other materials on finance and stock market from <a href="http://www.itinvest.ru/services/">ITinvest</a> : </h2><br><ul><li>  <a href="http://www.itinvest.ru/education/">ITinvest educational resources</a> </li><li>  <a href="http://www.itinvest.ru/analytics/">Analytics and market reviews</a> </li><li>  <a href="https://habrahabr.ru/company/itinvest/blog/331826/">How HFT works: 3 simple explanations</a> </li><li>  <a href="https://habrahabr.ru/post/275663/">What could be a stack of technologies for high-frequency trading</a> </li><li>  <a href="https://habrahabr.ru/post/271493/">Infrastructure and trading robots: What programming languages ‚Äã‚Äãare used in finance</a> </li><li>  <a href="https://habrahabr.ru/post/269367/">Experiment: Is it possible to create an effective trading strategy using machine learning and historical data</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/331940/">https://habr.com/ru/post/331940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331912/index.html">How to create an alternative to Google Drive and Dropbox in 3700 hours</a></li>
<li><a href="../331916/index.html">N ways to use Ahrefs when conducting a search audit</a></li>
<li><a href="../331930/index.html">Transition to binary</a></li>
<li><a href="../331934/index.html">Learn all programming languages</a></li>
<li><a href="../331938/index.html">Configuring Dockerfile to create and run a Docker container with your Go program</a></li>
<li><a href="../331944/index.html">Algorithm for finding the best route in linux</a></li>
<li><a href="../331946/index.html">Using GAP analysis to identify and coordinate project tasks</a></li>
<li><a href="../331948/index.html">Multicore DSP TMS320C6678. Core memory organization</a></li>
<li><a href="../331952/index.html">Example of creating a WCF service running inside a Windows service</a></li>
<li><a href="../331954/index.html">Baking Boards or the secret ingredient in the perfect Agile cuisine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>