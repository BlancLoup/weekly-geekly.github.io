<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unit tests in Cach√© are just</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most of all, programmers love programs that don‚Äôt need to fix bugs. A step on the way to this unrealistic dream is writing unit tests. In Cach√©, as in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unit tests in Cach√© are just</h1><div class="post__text post__text-html js-mediator-article">  Most of all, programmers love programs that don‚Äôt need to fix bugs.  A step on the way to this unrealistic dream is writing unit tests.  In Cach√©, as in any modern DBMS, there is an implementation of a framework for automatic execution of tests. <br><br> <a href="http://habrahabr.ru/company/intersystems/blog/263677/"><img src="https://habrastorage.org/files/d24/9e3/83b/d249e383b49540798cf8dd0fb2036ee1.jpg" title="Nikolai Zagrekov - Three workers for ramming"></a> <br><a name="habracut"></a><br>  For a detailed description of the philosophy and methodology of writing unit tests, I refer you to the Internet - to <a href="http://habrahabr.ru/hub/tdd/">Habr</a> and to the wonderful book ‚ÄúGrowing Object-Oriented Software Guided by Tests‚Äù.  It is not translated into Russian, but English is simple and understandable there. <br><br>  As an example, we will write a thoroughly tested method that takes a last name, first name and position at the entrance, stores them in a table and returns the id of the created object.  The table will be called <i>Tutorial.Person</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      According to all TDD canons, we first create a test: <br><br><blockquote>  <font color="#000080">Class Tutorial.Test.Person Extends% UnitTest.TestCase</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">Method</font> <font color="#000000">TestNewPerson () {</font> <font color="#000000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">surname</font> <font color="#000000">=</font> <font color="#008000">"John"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">name</font> <font color="#000000">=</font> <font color="#008000">"Doe"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">job</font> <font color="#000000">=</font> <font color="#008000">"quality assurance developer"</font> <font color="#008000"><br></font>  <font color="#0000ff">set</font> <font color="#800000">id</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Tutorial.Person</font> <font color="#000000">).</font>  <font color="#0000ff">AddPerson</font> <font color="#000000">(</font> <font color="#800000">surname</font> <font color="#000000">,</font> <font color="#800000">name</font> <font color="#000000">,</font> <font color="#800000">job</font> <font color="#0000ff">,. Ec</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do $$$ AssertStatusOK</font> <font color="#000000">(</font> <font color="#800000">ec</font> <font color="#000000">)</font> <font color="#000000"><br><br></font>  <font color="#0000ff">set</font> <font color="#800000">p</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">Tutorial.Person</font> <font color="#000000">).</font>  <font color="#0000ff">% Openid</font> <font color="#000000">(</font> <font color="#800000">id</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do $$$ AssertTrue</font> <font color="#000000">(</font> <font color="#0000ff">$ IsObject</font> <font color="#000000">(</font> <font color="#800000">p</font> <font color="#000000">))</font> <font color="#000000"><br><br></font>  <font color="#0000ff">do $$$ AssertEquals</font> <font color="#000000">(</font> <font color="#800000">p</font> <font color="#000000">.</font> <font color="#0000ff">Surname</font> <font color="#000000">,</font> <font color="#800000">surname</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do $$$ AssertEquals</font> <font color="#000000">(</font> <font color="#800000">p</font> <font color="#000000">.</font> <font color="#0000ff">Name</font> <font color="#000000">,</font> <font color="#800000">name</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">do $$$ AssertEquals</font> <font color="#000000">(</font> <font color="#800000">p</font> <font color="#000000">.</font> <font color="#0000ff">Job</font> <font color="#000000">,</font> <font color="#800000">job</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> </blockquote><br>  The class containing the tests must inherit from the <i>% UnitTest.TestCase</i> class.  All methods of this class that begin with the word Test are considered tests.  Macros and methods available to the heirs of <i>% UnitTest.TestCase</i> are described in the <a href="">documentation</a> . <br><br>  The tests runs the <i>## class</i> method <i>(% UnitTest.Manager). RunTest (subdir, spec)</i> .  This method loads and executes all classes with tests from the <i>subdir subdir of the</i> directory that is specified in the global <i>^ UnitTestRoot</i> .  Spec - additional keys to run.  By default, after execution, classes with tests are deleted.  We will not allow this, of course, by adding the second argument to the RunTest line with the key " <i>/ nodelete</i> ". <br><br>  So, create a folder <i>c: \ unittests \ habr</i> and export our class with a test to it (it is clear that you can name the folder as you like and that it would be better to call the subfolder tutorial, denoting the package that we will check; but to emphasize that these names do not have to match, I called the subfolder habr).  Export the test to this folder (I called the file <i>tutorial.test.person.xml</i> ) and go to the terminal! <br><br><pre><code class="hljs kotlin">USER&gt;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ^UnitTestRoot=<span class="hljs-string"><span class="hljs-string">"c:\UnitTests"</span></span> USER&gt;<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(%UnitTest.Manager).RunTest(<span class="hljs-string"><span class="hljs-string">"habr"</span></span>,<span class="hljs-string"><span class="hljs-string">"/nodelete/noload"</span></span>) ================================================================== Directory: C:\UnitTests\habr\ ================================================================== habr begins ...      <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">26</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">59</span></span>:<span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-string"><span class="hljs-string">'*.xml;*.XML'</span></span>   C:\UnitTests\habr\tutorial.test.person.xml  xml   . Tutorial.Test.Person begins ... TestNewPerson() begins ... LogStateStatus:<span class="hljs-number"><span class="hljs-number">0</span></span>:TestNewPerson: #<span class="hljs-number"><span class="hljs-number">5002</span></span>: : &lt;CLASS DOES NOT EXIST&gt;zTestNewPerson+<span class="hljs-number"><span class="hljs-number">4</span></span>^Tutorial.Test.Person.1 *Tutorial.Person &lt;&lt;==== **FAILED** habr:Tutorial.Test.Person:TestNewPerson: TestNewPerson failed Tutorial.Test.Person failed Skipping deleting classes habr failed Use the following URL to view the result: http:<span class="hljs-comment"><span class="hljs-comment">//192.168.1.6:57772/csp/sys/%25UnitTest.Portal.Indices.cls?Index=2&amp;$NAMESPACE=USER Some tests FAILED in suites: habr</span></span></code> </pre> <br>  Please note - I have specified two keys in the RunTest method: <i>/ nodelete</i> ‚Äî do not delete the class with tests after launch, <i>/ noload</i> ‚Äî do not load and do not compile the class itself. <br><br>  As you can see, our test successfully ended with an error.  At the end of the output, the URL for the web interface of the results of the test and the launch history is printed.  Note that this URL refers to the web application <i>/ csp / sys</i> , indicating the desired area by the argument.  If you change the area to USER in the Management Portal and then follow the links <i>System Explorer&gt; Tools&gt; UnitTest Portal</i> , you will probably see a Forbidden error when you try to open the following URL: <br><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/&lt;yourhost&gt;:&lt;yourport&gt;/csp</span></span><span class="hljs-regexp"><span class="hljs-regexp">/user/</span></span>%<span class="hljs-number"><span class="hljs-number">25</span></span>UnitTest.Portal.Home.zen?$NAMESPACE=USER</code> </pre> <br>  This error is caused by the fact that Cach√© by default prohibits accessing system (percentage) pages from web applications that do not begin with / csp / sys.  To allow opening of pages related to unit tests in the USER area, execute the following command in the terminal in the% SYS area: <br><br><pre> <code class="hljs perl">%SYS&gt;Set ^SYS(<span class="hljs-string"><span class="hljs-string">"Security"</span></span>,<span class="hljs-string"><span class="hljs-string">"CSP"</span></span>,<span class="hljs-string"><span class="hljs-string">"AllowPrefix"</span></span>,<span class="hljs-string"><span class="hljs-string">"/csp/user/"</span></span>,<span class="hljs-string"><span class="hljs-string">"%UnitTest."</span></span>)=<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Since there are almost always a lot of classes with tests, I create a separate class with a method that first uploads all classes with tests to the directory, and then calls RunTest: <br><br><blockquote>  <font color="#000080">Class Tutorial.Test.All</font> <font color="#000000">[</font> <font color="#000080">Abstract</font> <font color="#000000">]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">runall ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">do $ system</font> <font color="#008080">.OBJ</font> <font color="#000000">.</font>  <font color="#0000ff">Export</font> <font color="#000000">(</font> <font color="#008000">"Tutorial.Test.Person.cls"</font> <font color="#000000">, ^ UnitTestRoot_</font> <font color="#008000">"\ habr \"</font> <font color="#000000">_</font> <font color="#008000">"tutorial.test.person.xml"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#008000">;</font>  <font color="#008000">here you can add export of new classes with tests.</font> <font color="#008000"><br><br></font>  <font color="#0000ff">do</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% UnitTest.Manager</font> <font color="#000000">).</font>  <font color="#0000ff">RunTest</font> <font color="#000000">(</font> <font color="#008000">"habr"</font> <font color="#000000">,</font> <font color="#008000">"/ nodelete / noload"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> </blockquote><br>  The last thing left is to create the <i>Tutorial.Person</i> class and the <i>AddPerson</i> method, run the tests and see the long-awaited ‚Äú <i>ALL PASSED</i> ‚Äù: <br><br><pre> <code class="hljs vhdl">USER&gt;do ##class(Tutorial.Test.<span class="hljs-keyword"><span class="hljs-keyword">All</span></span>).runall()   XML   <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">26</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span>  : Tutorial.Test.Person   . ================================================================== Directory: C:\UnitTests\habr\ ================================================================== habr begins ...      <span class="hljs-number"><span class="hljs-number">07</span></span>/<span class="hljs-number"><span class="hljs-number">26</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>:<span class="hljs-number"><span class="hljs-number">12</span></span> '*.xml;*.XML'   C:\UnitTests\habr\tutorial.test.person.xml  xml   . Tutorial.Test.Person begins ... TestNewPerson() begins ... AssertStatusOK:ec (passed) AssertTrue:$IsObject(p) (passed) AssertEquals:p.Surname== surname (passed) AssertEquals:p.Name== name (passed) AssertEquals:p.Job== job (passed) LogMessage:Duration <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> execution: .<span class="hljs-number"><span class="hljs-number">000503</span></span> sec. TestNewPerson passed Tutorial.Test.Person passed Skipping deleting classes habr passed <span class="hljs-keyword"><span class="hljs-keyword">Use</span></span> the following URL <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> the result: http://<span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">1.6</span></span>:<span class="hljs-number"><span class="hljs-number">57772</span></span>/csp/sys/%<span class="hljs-number"><span class="hljs-number">25</span></span>UnitTest.Portal.Indices.cls?Index=<span class="hljs-number"><span class="hljs-number">7</span></span>&amp;$NAMESPACE=USER <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> PASSED</code> </pre><br>  At this point, an inquisitive reader (hello, <a href="http://habrahabr.ru/users/tsafin/" class="user_link">tsafin</a> ) will be <a href="http://habrahabr.ru/users/tsafin/" class="user_link">indignant</a> : ‚Äú <i>Why are there so many perversions to run a simple test ?!</i>  <i>Could it be any simpler?</i>  ".  Of course <s>you</s> can <s>not</s> !  But not much easier.  If the c: \ UnitTests \ habr folder is present and the path ‚Äúc: \ UnitTests‚Äù is specified in ^ UnitTestRoot, then you can start a separate class with tests (without first unloading) as follows: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(%UnitTest.Manager).DebugRunTestCase(<span class="hljs-string"><span class="hljs-string">"habr"</span></span>,<span class="hljs-string"><span class="hljs-string">"Tutorial.Test.Person"</span></span>)</code> </pre><br>  Don't forget, Cach√© is a DBMS.  All test results are saved and available for SQL queries.  Open Portal window for SQL input.  Check the box next to System to show the system classes.  Select the% UnitTest_Result scheme from the drop-down list.  For example, in the Duration column of some tables in this scheme, the duration of an individual test (or a method inside a test) is stored.  By running tests regularly, you can watch not only so that they do not fall, but also so that the time to complete them does not increase. <br><br>  In conclusion, I recommend to go through a <a href="">small tutorial</a> on unit tests, which is in the Cach√© documentation, and also to look at the <a href="">class descriptions of the% UnitTest package</a> in the class reference book. </div><p>Source: <a href="https://habr.com/ru/post/263677/">https://habr.com/ru/post/263677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263657/index.html">Feel Kotlin (and slightly Gradle) on the example of Posting-long-tweets (open source)</a></li>
<li><a href="../263665/index.html">Corporate Laboratories PENTESTIT: Modern IB Threats</a></li>
<li><a href="../263671/index.html">Compare .NET calendars. Experience first acquaintance</a></li>
<li><a href="../263673/index.html">ZeroRPC is a lightweight, reliable library for distributed communication between servers.</a></li>
<li><a href="../263675/index.html">Oracle Form Study with Java Development API (JDAPI)</a></li>
<li><a href="../263681/index.html">And we decided to make friends with Baresip and Nodejs</a></li>
<li><a href="../263685/index.html">How to use exceptions</a></li>
<li><a href="../263687/index.html">Magic of tensor algebra: Part 14 - Non-standard introduction to the dynamics of a rigid body</a></li>
<li><a href="../263689/index.html">Joker 2015: News July 16-27, 2015 - new speakers and reports</a></li>
<li><a href="../263691/index.html">vCloud Director for the smallest (part 5): VPN setup</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>