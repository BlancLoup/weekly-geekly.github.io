<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We fasten monitoring of smart or any temperature parameters (cpu, motherboard) to Zabbix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Actually I didn‚Äôt find the article collected in a pile how to fasten any temperature monitoring to zabbix, so I decided to write my own. 

 Task1. 
 W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We fasten monitoring of smart or any temperature parameters (cpu, motherboard) to Zabbix</h1><div class="post__text post__text-html js-mediator-article">  Actually I didn‚Äôt find the article collected in a pile how to fasten any temperature monitoring to zabbix, so I decided to write my own. <br><a name="habracut"></a><br>  <b>Task1.</b> <b><br></b>  <b>We have installed and configured monitoring system zabbix 1.8.2.</b>  <b>You need to tighten the temperature monitoring of hard drives (or any other smart parameter) on a linux server (debian).</b> <br>  Go. <br>  1. Install the smartmontools package. <br>  2. Team <br><pre><code class="bash hljs">smartctl --all /dev/sdX</code> </pre> <br>  displays all the smart parameters, looking for the temperature value there. <br>  3. I have a parameter called Temperature_Celsius. <br>  4. Next, select the temperature value from the output of the smartctl command.  This can be done in one line, but the problem is that the zabbix-agent will run this command from the user zabbix, and it requires root rights.  You can of course add zabbix user to sudoers, or something else, but I just added the script launch <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh #get temperature of HDD and save it into temporary file /user/sbin/smartctl --all /dev/sdX | grep Temperature &gt; /tmp/smart</span></span></code> </pre><br>  in the crontab, with a startup interval of 15 minutes (of course, it strains to write to the syslog every 15 minutes, then I can redo it). <br>  5. Now we add a user parameter to the zabbix agent config in which we select only the last three bytes of the file (after grep there is a line where the last two characters are the hard drive temperature, the third character is probably the end of the line) <br><blockquote>  UserParameter = smart_ct, tail -bytes 3 / tmp / smart </blockquote><br>  We restart the zabbix-agent daemon. <br>  And do not forget that if you do not add the agent UnsafeUserParameters = 1 to the config, then the commands in the commands are invalid: \ '"` *?  [] {} ~ $!  &amp;;  () &lt;&gt; |  # @. <br>  6. We look at the agent logs for curses.  We check on our zabbix server whether our parameter is working <br><pre> <code class="bash hljs">zabbix_get -s hostname -p 10050 -k ‚Äúsmart_ct‚Äù</code> </pre><br>  7. And now the case of technology is to add a new data item to the host from the web of the zabbix's muzzle, a trigger, and, actually, everything. <br>  A side effect is that I watch the temperature in the server room this way. <br>  <b>Task 2.</b> <b><br></b>  <b>We have installed and configured monitoring system zabbix 1.8.2.</b>  <b>It is necessary to fasten monitoring of the temperature of the motherboard (processor, memory etc) on the linux server (debian).</b>  <b>Initially built-in data elements with the sensor keys [temp1 | 2 | 3] write that they are not supported.</b> <br>  Go <br>  1. Install the lm-sensors package. <br>  2. Run the command <br><pre> <code class="bash hljs">sensors</code> </pre><br>  and most likely we see that we are sent to sensors-detect. <br>  3. Run <br><pre> <code class="bash hljs">sensors-detect</code> </pre><br>  all questions except the last answer yes.  If there are supported glands, then we see (in my case) something like the following <br><blockquote>  To load everything that is needed, add this to / etc / modules: <br>  # ---- cut here ---- <br>  # Chip drivers <br>  <b>coretemp</b> <br>  <b>f71882fg</b> <br>  # ---- cut here ---- </blockquote><br>  Bold is kernel modules, which further suggest adding to / etc / modules.  But I want to try them separately, so we answer ‚Äúno‚Äù and use modeprobe. <br>  4. We load the modules, after loading the <b>coretemp</b> , the sensors command did not generate anything again, so I unloaded it and <b>loaded f71882fg</b> .  Now the sensors command shows everything that is needed and not necessary, including the speed of rotation of the coolers and the temperature of the MP.  After selection for the desired temperature, we have the following output from the sensors <br><blockquote>  temp3 +45 </blockquote><br>  5. Since the sensors command does not require root rights, we add a user parameter to the zabbix agent <br><blockquote>  UserParameter = temb_mb, / usr.bin / sensors |  grep 'temp3' |  cut -f 2 -d + |  grep -Eo '^ ..' </blockquote><br>  here I had to remember a little regular expressions, in the end we got such a construction to extract the temperature from the line.  I am sure that it can be made easier, but experience is not enough.  We also add the line UnsafeUserParameters = 1 to the agent's config (why it is written above).  We restart the zabbix-agent daemon. <br>  6. We look at the agent logs for curses, check whether the parameter is working on the zabbix server <br><pre> <code class="bash hljs">zabbix_get -s hostname -p 10050 -k ‚Äútemp_mb‚Äù</code> </pre><br>  7. And now the case of technology is to add a new data item to the host from the web of the zabbix's muzzle, a trigger, and, actually, everything. <br>  The number of parameters that the sensors command outputs naturally depends on the hardware.  It is possible that the data elements for temperature monitoring, built initially in zabbix, work for someone, but I was not lucky ... </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/162627/">https://habr.com/ru/post/162627/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../162617/index.html">Internal ASLR device in Windows 8</a></li>
<li><a href="../162619/index.html">Sony Xperia V Review</a></li>
<li><a href="../162621/index.html">Course "Introduction to Financial Engineering"</a></li>
<li><a href="../162623/index.html">Large, long, uncircumcised (or ‚ÄúHow to make a lot of text at home‚Äù)</a></li>
<li><a href="../162625/index.html">Web service as a real-time system</a></li>
<li><a href="../162629/index.html">Reading books in English and learning the language is easier with WordMemo</a></li>
<li><a href="../162631/index.html">What do businesses actually sell to customers?</a></li>
<li><a href="../162633/index.html">Dell goes out of the smartphone business, stops working with Android</a></li>
<li><a href="../162635/index.html">Add a download icon to large CSS images.</a></li>
<li><a href="../162637/index.html">Cappa - an interesting project of personal hydroelectric power station</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>