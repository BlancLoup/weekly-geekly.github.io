<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a convenient OpenFileDialog for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, like many Android developers, I encountered the other day with the need to implement in my application file selection by the user. Since ini...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a convenient OpenFileDialog for Android</h1><div class="post__text post__text-html js-mediator-article">  Probably, like many <b>Android</b> developers, I encountered the other day with the need to implement in my application file selection by the user.  Since initially there is no such functionality in <b>Android</b> , I turned to the <a href="https://www.google.ru/">great and terrible</a> .  It seemed strange to me, but from a pile of questions on <a href="http://stackoverflow.com/">stackoverflow</a> and a small number of domestic forums, there are only three main sources: <br><ol><li>  <a href="https://code.google.com/p/android-file-dialog/">Android File Dialog</a> - almost all links from <b>stackoverflow</b> lead here.  In principle, a good solution, but implemented through a separate <b>activity</b> , but I wanted something in the spirit of <b>OpenFileDialog</b> 'from <b>.Net</b> . </li><li>  <a href="http://habrahabr.ru/post/109486/">This article</a> is generally about a separate file manager, and it was not possible to get some ideas from it. </li><li>  I really liked the idea <a href="http://www.wtg.ru/products/onlinedev/031/">from here</a> , however, it seemed to me to realize all this can be somewhat more beautiful. </li></ol><br>  As a result, having started to implement my decision, I ran into some difficulties that seemed very interesting to solve.  And therefore, I decided to describe in this article not just a ready-made solution, but all the steps that led to it.  Those who want to go through them - <a name="habracut"></a><br>  So let's get started!  In any familiar environment (I use <b>IntelliJ IDEA</b> ) we will create a new application.  On the main <b>activity we</b> locate one single button and write to it, while empty, a click handler: <br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnOpenFileClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ }</code> </pre> <br>  Create a new class with a constructor: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.AlertDialog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AlertDialog</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .setNegativeButton(android.R.string.cancel, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } }</code> </pre><br>  and in the handler of the button we call the dialog: <br><pre> <code class="java hljs">OpenFileDialog fileDialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenFileDialog(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); fileDialog.show();</code> </pre><br>  The buttons seemed, now it would be necessary to find the files themselves.  We start the search from the root <b>sdcard</b> , for which we define the field: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String currentPath = Environment.getExternalStorageDirectory().getPath();</code> </pre><br>  and implement the following method: <br><pre> <code class="javascript hljs"> private <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[] getFiles(<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> directoryPath){ File directory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(directoryPath); File[] files = directory.listFiles(); <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[files.length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; files.length; i++) { result[i] = files[i].getName(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br>  (since the main requirement for the class is to work immediately with any developer, without connecting additional libraries, we will not use any <a href="https://code.google.com/p/google-collections/">google-collections</a> , and we will have to work with arrays in the old fashion), and in the constructor we <b>will</b> add <b>.setItems (getFiles ( currentPath), null)</b> . <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/91a/17f/703/91a17f7032ed216a7fc0d7cdb7936a5b.png"></div><br>  Well, not bad, but the files are not sorted.  Implement the <b>Adapter</b> as an inner class for this case, replace <b>setItems</b> with <b>setAdapter</b> and rewrite <b>getFiles a bit</b> : <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FileAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayAdapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">File</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FileAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, List&lt;File&gt; files)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context, android.R.layout.simple_list_item_1, files); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ TextView view = (TextView) <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getView(position, convertView, parent); File file = getItem(position); view.setText(file.getName()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view; } }</code> </pre><br><pre> <code class="java hljs">.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAdapter(context, getFiles(currentPath)), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)</code> </pre><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;File&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String directoryPath)</span></span></span></span>{ File directory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(directoryPath); List&lt;File&gt; fileList = Arrays.asList(directory.listFiles()); Collections.sort(fileList, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Comparator&lt;File&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compare</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file, File file2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.isDirectory() &amp;&amp; file2.isFile()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.isFile() &amp;&amp; file2.isDirectory()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file.getPath().compareTo(file2.getPath()); } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fileList; }</code> </pre><br>  Even better, but we need to go inside by clicking on the folder.  You can reach the built-in <b>listview</b> , but I just replaced it with my own (this will come in handy later).  Plus, the <b>adapter‚Äôs</b> changes inside the <b>listview</b> handler caused an <b>exception</b> , and the list of files had to be moved to a separate field: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;File&gt; files = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;File&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); files.addAll(getFiles(currentPath)); ListView listView = createListView(context); listView.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAdapter(context, files)); setView(listView) .setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .setNegativeButton(android.R.string.cancel, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RebuildFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArrayAdapter&lt;File&gt; adapter)</span></span></span><span class="hljs-function"> </span></span>{ files.clear(); files.addAll(getFiles(currentPath)); adapter.notifyDataSetChanged(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ListView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createListView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ ListView listView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ListView(context); listView.setOnItemClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdapterView.OnItemClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AdapterView&lt;?&gt; adapterView, View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ArrayAdapter&lt;File&gt; adapter = (FileAdapter) adapterView.getAdapter(); File file = adapter.getItem(index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.isDirectory()) { currentPath = file.getPath(); RebuildFiles(adapter); } } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listView; }</code> </pre><br>  Great, just by clicking on the <b>Android</b> folder, we get a list of everything from one <b>data</b> directory, and our window is immediately reduced in size. <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/b95/ce0/a38/b95ce0a38a526eaba309238350309278.png"></div><br>  Perhaps this is normal, but I did not like it, and I began to look for opportunities to keep the size.  The only option I found was to set <b>setMinimumHeight</b> .  Setting this property for a <b>listview</b> caused additional problems, but they were resolved by <b>wrapping</b> it in <b>LinearLayout</b> : <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); LinearLayout linearLayout = createMainLayout(context); files.addAll(getFiles(currentPath)); ListView listView = createListView(context); listView.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAdapter(context, files)); linearLayout.addView(listView); setView(linearLayout) .setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .setNegativeButton(android.R.string.cancel, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> LinearLayout </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMainLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ LinearLayout linearLayout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout(context); linearLayout.setOrientation(LinearLayout.VERTICAL); linearLayout.setMinimumHeight(<span class="hljs-number"><span class="hljs-number">750</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linearLayout; }</code> </pre><br>  The result still turned out to be a little different from the way I would like: the dialog is maximized when starting, and decreases to <b>750px</b> after switching to the <b>Android</b> directory.  Yes, and the screens of different devices have different heights.  We will solve both of these problems at <b>once by</b> setting <b>setMinimumHeight</b> to the maximum possible for the current screen: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Display </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultDisplay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((WindowManager)context.getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Point </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getScreenSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ Point screeSize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(); getDefaultDisplay(context).getSize(screeSize); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> screeSize; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLinearLayoutMinHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getScreenSize(context).y; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> LinearLayout </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMainLayout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ LinearLayout linearLayout = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinearLayout(context); linearLayout.setOrientation(LinearLayout.VERTICAL); linearLayout.setMinimumHeight(getLinearLayoutMinHeight(context)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> linearLayout; }</code> </pre><br>  No need to be afraid of the fact that we set the full screen size in <b>setMinimumHeight</b> , the system itself will reduce the value to the maximum allowed. <br>  Now there is a problem of understanding the user in which directory he is now, and returning up.  Let's deal with the first.  It seems everything is easy - set the value of <b>title</b> in <b>currentPath</b> and change it when the last one changes.  Add a call to <b>setTitle (currentPath)</b> in the constructor and in the <b>RebuildFiles</b> method. <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/cb6/7e6/738/cb67e6738a4fa7d615782f408448d014.png"></div><br>  It seems all is well.  Go to the <b>Android</b> directory: <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/9fe/906/a48/9fe906a48e620852e5fafd2aaffaa27a.png"></div><br>  And no - the title has not changed.  Why <b>setTitle</b> does not work after showing the dialog, the documentation is silent.  However, we can fix this by creating our own title and replacing it with a standard one: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextView title; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); title = createTitle(context); LinearLayout linearLayout = createMainLayout(context); files.addAll(getFiles(currentPath)); ListView listView = createListView(context); listView.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAdapter(context, files)); linearLayout.addView(listView); setCustomTitle(title) .setView(linearLayout) .setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .setNegativeButton(android.R.string.cancel, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ TypedValue value = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TypedValue(); DisplayMetrics metrics = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DisplayMetrics(); context.getTheme().resolveAttribute(android.R.attr.rowHeight, value, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); getDefaultDisplay(context).getMetrics(metrics); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)TypedValue.complexToDimension(value.data, metrics); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TextView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ TextView textView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextView(context); textView.setTextAppearance(context, android.R.style.TextAppearance_DeviceDefault_DialogWindowTitle); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemHeight = getItemHeight(context); textView.setLayoutParams(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, itemHeight)); textView.setMinHeight(itemHeight); textView.setGravity(Gravity.CENTER_VERTICAL); textView.setPadding(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); textView.setText(currentPath); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textView; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RebuildFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArrayAdapter&lt;File&gt; adapter)</span></span></span><span class="hljs-function"> </span></span>{ files.clear(); files.addAll(getFiles(currentPath)); adapter.notifyDataSetChanged(); title.setText(currentPath); }</code> </pre><br>  And again, all is not well: if you go far enough, the line in the title will not get <br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/231/909/d9c/231909d9c533d7866ecc94b8e9392b0b.png"></div><br>  The solution to setting <b>setMaximumWidth is</b> not true, since the user will only see the beginning of a long path.  I do not know how correct my decision is, but I did this: <br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTextWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String text, Paint paint)</span></span></span><span class="hljs-function"> </span></span>{ Rect bounds = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(); paint.getTextBounds(text, <span class="hljs-number"><span class="hljs-number">0</span></span>, text.length(), bounds); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bounds.left + bounds.width() + <span class="hljs-number"><span class="hljs-number">80</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String titleText = currentPath; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> screenWidth = getScreenSize(getContext()).x; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> maxWidth = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) (screenWidth * <span class="hljs-number"><span class="hljs-number">0.99</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getTextWidth(titleText, title.getPaint()) &gt; maxWidth) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (getTextWidth(<span class="hljs-string"><span class="hljs-string">"..."</span></span> + titleText, title.getPaint()) &gt; maxWidth) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> start = titleText.indexOf(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (start &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) titleText = titleText.substring(start); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> titleText = titleText.substring(<span class="hljs-number"><span class="hljs-number">2</span></span>); } title.setText(<span class="hljs-string"><span class="hljs-string">"..."</span></span> + titleText); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { title.setText(titleText); } }</code> </pre><br>  We now solve the problem with the return.  This is fairly easy, given that we have a <b>LinearLayout</b> .  Add another <b>TextView to it</b> and rebuild the code a bit: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ListView listView; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); title = createTitle(context); changeTitle(); LinearLayout linearLayout = createMainLayout(context); linearLayout.addView(createBackItem(context)); files.addAll(getFiles(currentPath)); listView = createListView(context); listView.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAdapter(context, files)); linearLayout.addView(listView); setCustomTitle(title) .setView(linearLayout) .setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .setNegativeButton(android.R.string.cancel, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TextView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTextView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> style)</span></span></span><span class="hljs-function"> </span></span>{ TextView textView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextView(context); textView.setTextAppearance(context, style); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> itemHeight = getItemHeight(context); textView.setLayoutParams(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, itemHeight)); textView.setMinHeight(itemHeight); textView.setGravity(Gravity.CENTER_VERTICAL); textView.setPadding(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textView; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TextView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTitle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ TextView textView = createTextView(context, android.R.style.TextAppearance_DeviceDefault_DialogWindowTitle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textView; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TextView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createBackItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ TextView textView = createTextView(context, android.R.style.TextAppearance_DeviceDefault_Small); Drawable drawable = getContext().getResources().getDrawable(android.R.drawable.ic_menu_directions); drawable.setBounds(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>); textView.setCompoundDrawables(drawable, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); textView.setLayoutParams(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, ViewGroup.LayoutParams.WRAP_CONTENT)); textView.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(currentPath); File parentDirectory = file.getParentFile(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parentDirectory != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { currentPath = parentDirectory.getPath(); RebuildFiles(((FileAdapter) listView.getAdapter())); } } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textView; }</code> </pre><br><div style="text-align:center;"><img src="http://habrastorage.org/storage3/851/770/dd0/851770dd0402a0d2912ca75ba6828a56.png"></div><br>  The ability to go back one step up can lead the user to directories that he is denied access to, so we <b>‚Äôll</b> change the <b>RebuildFiles</b> function: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RebuildFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArrayAdapter&lt;File&gt; adapter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ List&lt;File&gt; fileList = getFiles(currentPath); files.clear(); files.addAll(fileList); adapter.notifyDataSetChanged(); changeTitle(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NullPointerException e){ Toast.makeText(getContext(), android.R.string.unknownName, Toast.LENGTH_SHORT).show(); } }</code> </pre><br>  (The message is not very informative, but soon we will add to the developer the opportunity to fix it). <br>  No <b>OpenFileDialog</b> can do without a filter.  Add it too: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FilenameFilter filenameFilter; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OpenFileDialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String filter)</span></span></span><span class="hljs-function"> </span></span>{ filenameFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FilenameFilter() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(File file, String fileName)</span></span></span><span class="hljs-function"> </span></span>{ File tempFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(String.format(<span class="hljs-string"><span class="hljs-string">"%s/%s"</span></span>, file.getPath(), fileName)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tempFile.isFile()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tempFile.getName().matches(filter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br><pre> <code class="java hljs">List&lt;File&gt; fileList = Arrays.asList(directory.listFiles(filenameFilter));</code> </pre><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenFileDialog(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).setFilter(<span class="hljs-string"><span class="hljs-string">".*\\.txt"</span></span>);</code> </pre><br>  Note that the filter accepts a regular expression.  It would seem that everything is fine, but the first selection of files will work in the constructor, before assigning the filter.  Let's transfer it to the redefined <b>show</b> method: <br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(context); title = createTitle(context); changeTitle(); LinearLayout linearLayout = createMainLayout(context); linearLayout.addView(createBackItem(context)); listView = createListView(context); linearLayout.addView(listView); setCustomTitle(title) .setView(linearLayout) .setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) .setNegativeButton(android.R.string.cancel, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AlertDialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ files.addAll(getFiles(currentPath)); listView.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileAdapter(getContext(), files)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.show(); }</code> </pre><br>  It remains quite a bit: return the selected file.  Again, I still do not understand why you need to install <b>CHOICE_MODE_SINGLE</b> , and then still write extra code to highlight the selected element, when it (the code) will work without <b>CHOICE_MODE_SINGLE</b> , and therefore do without it: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> selectedIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ TextView view = (TextView) <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getView(position, convertView, parent); File file = getItem(position); view.setText(file.getName()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectedIndex == position) view.setBackgroundColor(getContext().getResources().getColor(android.R.color.holo_blue_light)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> view.setBackgroundColor(getContext().getResources().getColor(android.R.color.background_dark)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view; }</code> </pre><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RebuildFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArrayAdapter&lt;File&gt; adapter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ List&lt;File&gt; fileList = getFiles(currentPath); files.clear(); selectedIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span>; files.addAll(fileList); adapter.notifyDataSetChanged(); changeTitle(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NullPointerException e){ Toast.makeText(getContext(), android.R.string.unknownName, Toast.LENGTH_SHORT).show(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ListView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createListView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ ListView listView = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ListView(context); listView.setOnItemClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdapterView.OnItemClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AdapterView&lt;?&gt; adapterView, View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ArrayAdapter&lt;File&gt; adapter = (FileAdapter) adapterView.getAdapter(); File file = adapter.getItem(index); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.isDirectory()) { currentPath = file.getPath(); RebuildFiles(adapter); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index != selectedIndex) selectedIndex = index; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> selectedIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span>; adapter.notifyDataSetChanged(); } } }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> listView; }</code> </pre><br>  And create the listener interface: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenDialogListener</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSelectedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String fileName)</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OpenDialogListener listener; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OpenFileDialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOpenDialogListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OpenDialogListener listener)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listener = listener; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br><pre> <code class="java hljs">‚Ä¶ .setPositiveButton(android.R.string.ok, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogInterface.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DialogInterface dialog, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> which)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectedIndex &gt; -<span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; listener != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { listener.OnSelectedFile(listView.getItemAtPosition(selectedIndex).toString()); } } }) ‚Ä¶</code> </pre><br>  Well, let's change the challenge: <br><pre> <code class="java hljs"> OpenFileDialog fileDialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenFileDialog(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .setFilter(<span class="hljs-string"><span class="hljs-string">".*\\.csv"</span></span>) .setOpenDialogListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OpenFileDialog.OpenDialogListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSelectedFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String fileName)</span></span></span><span class="hljs-function"> </span></span>{ Toast.makeText(getApplicationContext(), fileName, Toast.LENGTH_LONG).show(); } }); fileDialog.show();</code> </pre><br>  A few final improvements: <br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Drawable folderIcon; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Drawable fileIcon; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String accessDeniedMessage; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OpenFileDialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFolderIcon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Drawable drawable)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.folderIcon = drawable; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OpenFileDialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setFileIcon</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Drawable drawable)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fileIcon = drawable; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> OpenFileDialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAccessDeniedMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String message)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.accessDeniedMessage = message; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RebuildFiles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArrayAdapter&lt;File&gt; adapter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ List&lt;File&gt; fileList = getFiles(currentPath); files.clear(); selectedIndex = -<span class="hljs-number"><span class="hljs-number">1</span></span>; files.addAll(fileList); adapter.notifyDataSetChanged(); changeTitle(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (NullPointerException e){ String message = getContext().getResources().getString(android.R.string.unknownName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!accessDeniedMessage.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) message = accessDeniedMessage; Toast.makeText(getContext(), message, Toast.LENGTH_SHORT).show(); } }</code> </pre><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ TextView view = (TextView) <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.getView(position, convertView, parent); File file = getItem(position); view.setText(file.getName()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.isDirectory()) { setDrawable(view, folderIcon); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { setDrawable(view, fileIcon); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (selectedIndex == position) view.setBackgroundColor(getContext().getResources().getColor(android.R.color.holo_blue_dark)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> view.setBackgroundColor(getContext().getResources().getColor(android.R.color.transparent)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> view; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDrawable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TextView view, Drawable drawable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (view != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (drawable != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ drawable.setBounds(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>); view.setCompoundDrawables(drawable, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { view.setCompoundDrawables(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } } }</code> </pre><br>  There are a few problems that I still could not solve, and would be grateful for any help: <br><ol><li>  Highlighting clicking on the item "Up".  It seems to be solved by setting the <b>setBackgroundResource</b> value to <b>android.R.drawable.list_selector_background</b> , but this is the <b>android 2.x</b> style, not <b>holo</b> ! </li><li>  The color of the file selection, depending on the theme chosen by the user. </li></ol><br>  I also look forward to any comments and suggestions.  The full code is <a href="https://github.com/Scogun/Android-OpenFileDialog">here</a> . <br></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/203884/">https://habr.com/ru/post/203884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203872/index.html">Microsoft has released a program for seamless looping animation.</a></li>
<li><a href="../203874/index.html">Key indicators of customer service quality in the retail and service industries</a></li>
<li><a href="../203876/index.html">Curiosity rover fully recovered after electrical system failure</a></li>
<li><a href="../203878/index.html">How to become a "big fish" in the sea of ‚Äã‚Äãmobile applications</a></li>
<li><a href="../203882/index.html">Yandex now supports encryption of outgoing and incoming mail</a></li>
<li><a href="../203886/index.html">We collect "bad data" (bad data)</a></li>
<li><a href="../203890/index.html">JohnSmith - a simple and lightweight JavaScript framework for building UI</a></li>
<li><a href="../203892/index.html">School open data. First 7 lessons and feedback</a></li>
<li><a href="../203904/index.html">Bitcoin rate exceeded $ 1000 for 1 BTC</a></li>
<li><a href="../203906/index.html">December 7-8 - XII selection of projects in the Kazan IT Park Business Incubator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>