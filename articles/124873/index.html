<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenCL under C # is easy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Although the technology OpenCL appeared back in 2008, it has not received much distribution until now. The advantages of technology are undoubted: acc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenCL under C # is easy</h1><div class="post__text post__text-html js-mediator-article">  Although the technology OpenCL appeared back in 2008, it has not received much distribution until now.  The advantages of technology are undoubted: acceleration of calculations, cross-platform, the ability to execute code under both the GPU and the CPU, support for the standard by a number of companies: Apple, AMD, Intel, nVidia and some others.  There are not so many minuses, but they are also there: slower work on nVidia than through CUDA, complexity of use.  The first of the minuses affects only serious development, where the speed of the program is more important than cross-platform.  The second is the main obstacle for developers who make a choice in favor of a particular development method.  It takes a lot of time to figure out a bunch of headers, drivers, and standards.  But it is not all that bad.  The topic of this article will be a short guide on how the easiest way you can run OpenCL under C # and get pleasure from parallel programming. <br><br><a name="habracut"></a><h5>  Driver setup </h5><br>  The longest and most difficult part is setting up drivers for OpenCL.  I will say right away that if the system has been on the computer for more than a year, you have an AMD card and the drivers in the system have been updated - it is likely that the system will have to be rearranged. <br><h6>  AMD </h6>  Although AMD has some driver problems, they have a great SDK with a lot of examples, and the support forums are live and operational.  The latest versions of <a href="http://sites.amd.com/us/game/downloads/Pages/downloads.aspx">AMD Catalyst</a> drivers for OpenCL are installed automatically.  SDK for work can be found <a href="http://developer.amd.com/sdks/AMDAPPSDK/Pages/default.aspx">here</a> .  Before installing, check if your video card <a href="http://developer.amd.com/sdks/AMDAPPSDK/pages/DriverCompatibility.aspx">supports</a> OpenCL.  For AMD, partial support starts from the 4300 series, and full from 5400. <br><h6>  nVidia. </h6>  In principle, the problems with the drivers at nVidia less, but sometimes they also get up.  OpenCL support comes from about the 8600 series.  You can get the driver <a href="http://developer.nvidia.com/cuda-toolkit-30-downloads">here</a> . <br><h6>  Intel </h6>  Unlike AMD and nVidia, I have never had a problem with Intel drivers.  You can take them <a href="http://software.intel.com/en-us/articles/opencl-sdk/">here</a> . <br><br>  Installing drivers on the system does not guarantee that they will work for you.  The number of bugs from AMD goes off scale (problems arose when installed on 2 of 3 computers), in nVidia it is large (1 of 3).  Therefore, after installation, I recommend that you first check whether OpenCL is connected.  The most simple it can be done through programs showing the parameters of video cards.  I use <a href="http://www.ozone3d.net/gpu_caps_viewer/">GpuCapsViewer</a> , opencl-z and GPU-Z also work. <br>  If problems arise ... Remove all old drivers, rearrange.  For AMD, make sure you install the correct driver version.  Laptop drivers are often buggy for them.  If the problems persist, reinstalling Windows will save you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Wrappers </h5><br>  Since our goal is as simple as possible programming on OpenCL under C #, we will not engage in perversions and connect OpenCL headers, but use ready-made libraries that simplify development.  The most complete and bug-free version, it seems to me, today is <a href="http://sourceforge.net/projects/cloo/">cloo.dll</a> , which is part of <a href="http://www.opentk.com/">OpenTK</a> .  The easiest to use, automate many operations is the <a href="">OpenCLTemplate</a> , which is a superstructure over cloo.  Of the minuses of the latter - some glitches when working with AMD, for example, with the latest version of drivers (11.6), devices may refuse to initialize.  Since the project is OpenSource, the glitches that I had I found and corrected, but when I release a new version of the library, I don‚Äôt know.  There are also some lesser-known wrappers that can be found on the Internet. <br><br><h5>  First program </h5><br>  As the first program, let's count through OpenCL the sum of two vectors, v1 and v2.  An example of a program written using cloo.dll: <br><br><h6>  Cloo program <br></h6><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> button4_Click( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#008000">// ,    .  Platforms[1]   </font> <br> <font color="#008000">//   </font> <br> ComputeContextPropertyList Properties = <font color="#0000ff">new</font> ComputeContextPropertyList(ComputePlatform.Platforms[1]); <br> ComputeContext Context = <font color="#0000ff">new</font> ComputeContext(ComputeDeviceTypes.All, Properties, <font color="#0000ff">null</font> , <font color="#2B91AF">IntPtr</font> .Zero); <br> <br> <font color="#008000">// ,    (GPU  CPU).      </font> <br> <font color="#008000">//    .    ,   C99   OpenCL.</font> <br> <font color="#0000ff">string</font> vecSum = <font color="#A31515">@" <br> __kernel void <br> floatVectorSum(__global float * v1, <br> __global float * v2) <br> { <br> int i = get_global_id(0); <br> v1[i] = v1[i] + v2[i]; <br> } <br> <br> "</font> ; <br> <font color="#008000">// ,        vecSum </font> <br> <font color="#2B91AF">List</font> &lt;ComputeDevice&gt; Devs = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt;ComputeDevice&gt;(); <br> Devs.Add(ComputePlatform.Platforms[1].Devices[0]); <br> Devs.Add(ComputePlatform.Platforms[1].Devices[1]); <br> Devs.Add(ComputePlatform.Platforms[1].Devices[2]); <br> <font color="#008000">//   vecSum</font> <br> ComputeProgram prog = <font color="#0000ff">null</font> ; <br> <font color="#0000ff">try</font> <br> { <br> <br> prog = <font color="#0000ff">new</font> ComputeProgram(Context, vecSum); prog.Build(Devs, <font color="#A31515">""</font> , <font color="#0000ff">null</font> , <font color="#2B91AF">IntPtr</font> .Zero); <br> } <br> <br> <font color="#0000ff">catch</font> <br> <br> { } <br> <br> <font color="#008000">//  </font> <br> ComputeKernel kernelVecSum = prog.CreateKernel( <font color="#A31515">"floatVectorSum"</font> ); <br> <br> <font color="#008000">//   ,    .</font> <br> <font color="#0000ff">float</font> [] v1 = <font color="#0000ff">new</font> <font color="#0000ff">float</font> [100], v2 = <font color="#0000ff">new</font> <font color="#0000ff">float</font> [100]; <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; v1.Length; i++) <br> { <br> v1[i] = i; <br> v2[i] = 2 * i; <br> } <br> <font color="#008000">//      .</font> <br> ComputeBuffer&lt; <font color="#0000ff">float</font> &gt; bufV1 = <font color="#0000ff">new</font> ComputeBuffer&lt; <font color="#0000ff">float</font> &gt;(Context, ComputeMemoryFlags.ReadWrite | ComputeMemoryFlags.UseHostPointer, v1); <br> ComputeBuffer&lt; <font color="#0000ff">float</font> &gt; bufV2 = <font color="#0000ff">new</font> ComputeBuffer&lt; <font color="#0000ff">float</font> &gt;(Context, ComputeMemoryFlags.ReadWrite | ComputeMemoryFlags.UseHostPointer, v2); <br> <font color="#008000">//       vecSum</font> <br> kernelVecSum.SetMemoryArgument(0, bufV1); <br> kernelVecSum.SetMemoryArgument(1, bufV2); <br> <font color="#008000">//  .    ,     !</font> <br> ComputeCommandQueue Queue = <font color="#0000ff">new</font> ComputeCommandQueue(Context, Cloo.ComputePlatform.Platforms[1].Devices[0], Cloo.ComputeCommandQueueFlags.None); <br> <font color="#008000">//. Execute  - vecSum    (v1.Length)</font> <br> Queue.Execute(kernelVecSum, <font color="#0000ff">null</font> , <font color="#0000ff">new</font> <font color="#0000ff">long</font> [] { v1.Length }, <font color="#0000ff">null</font> , <font color="#0000ff">null</font> ); <br> <font color="#008000">//    .</font> <br> <font color="#0000ff">float</font> [] arrC = <font color="#0000ff">new</font> <font color="#0000ff">float</font> [100]; <br> GCHandle arrCHandle = GCHandle.Alloc(arrC, GCHandleType.Pinned); <br> Queue.Read&lt; <font color="#0000ff">float</font> &gt;(bufV1, <font color="#0000ff">true</font> , 0, 100, arrCHandle.AddrOfPinnedObject(), <font color="#0000ff">null</font> ); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h6>  And below is the same program implemented through OpenCLTemplate.DLL </h6><br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> btnOpenCL_Click( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#008000">// ,    (GPU  CPU).      </font> <br> <font color="#008000">//    .    ,   C99   OpenCL.</font> <br> <font color="#0000ff">string</font> vecSum = <font color="#A31515">@" <br> __kernel void <br> floatVectorSum(__global    float * v1, <br> __global    float * v2) <br> { <br> int i = get_global_id(0); <br> v1[i] = v1[i] * v2[i]; <br> }"</font> ; <br> <br> <font color="#008000">// .     .     GPU.</font> <br> <font color="#008000">//OpenCLTemplate.CLCalc.InitCL(Cloo.ComputeDeviceTypes.All)    </font> <br> <font color="#008000">//GPU   CPU.</font> <br> OpenCLTemplate.CLCalc.InitCL(); <br> <font color="#008000">//    .</font> <br> <font color="#2B91AF">List</font> &lt;Cloo.ComputeDevice&gt; L = OpenCLTemplate.CLCalc.CLDevices; <br> <font color="#008000">//       </font> <br> OpenCLTemplate.CLCalc.Program.DefaultCQ = 0; <br> <font color="#008000">//  vecSum</font> <br> OpenCLTemplate.CLCalc.Program.Compile( <font color="#0000ff">new</font> <font color="#0000ff">string</font> [] { vecSum }); <br> <font color="#008000">//   ,  .</font> <br> OpenCLTemplate.CLCalc.Program.Kernel VectorSum = <font color="#0000ff">new</font> OpenCLTemplate.CLCalc.Program.Kernel( <font color="#A31515">"floatVectorSum"</font> ); <br> <font color="#0000ff">int</font> n = 100; <br> <br> <font color="#0000ff">float</font> [] v1 = <font color="#0000ff">new</font> <font color="#0000ff">float</font> [n], v2 = <font color="#0000ff">new</font> <font color="#0000ff">float</font> [n], v3 = <font color="#0000ff">new</font> <font color="#0000ff">float</font> [n]; <br> <br> <font color="#008000">//   ,    .</font> <br> <font color="#0000ff">for</font> ( <font color="#0000ff">int</font> i = 0; i &lt; n; i++) <br> { <br> v1[i] = i; <br> v2[i] = i*2; <br> } <br> <br> <br> <font color="#008000">//    </font> <br> OpenCLTemplate.CLCalc.Program.Variable varV1 = <font color="#0000ff">new</font> OpenCLTemplate.CLCalc.Program.Variable(v1); <br> OpenCLTemplate.CLCalc.Program.Variable varV2 = <font color="#0000ff">new</font> OpenCLTemplate.CLCalc.Program.Variable(v2); <br> <br> <font color="#008000">// ,     </font> <br> OpenCLTemplate.CLCalc.Program.Variable[] args = <font color="#0000ff">new</font> OpenCLTemplate.CLCalc.Program.Variable[] { varV1, varV2 }; <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">int</font> [] workers = <font color="#0000ff">new</font> <font color="#0000ff">int</font> [1] { n }; <br> <br> <font color="#008000">//  VectorSum   args    workers</font> <br> VectorSum.Execute(args, workers); <br> <br> <font color="#008000">//  </font> <br> varV1.ReadFromDeviceTo(v3); <br> <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  As you can see, the second option is much simpler and more intuitive. <br><br><h5>  Links at last </h5><br>  First of all this programming is devoted to programming on OpenCL through C # - <a href="http://www.cmsoft.com.br/">www.cmsoft.com.br</a> .  Unfortunately, few people lead it, so the examples are often inadequate, and the OpenCLTemplate created by the authors of the site is very buggy. <br>  A useful place is the site <a href="http://www.opentk.com/">www.opentk.com</a> where very quickly answer questions about programming through cloo.dll <br>  Approximately the same answers can be obtained on <a href="http://sourceforge.net/projects/cloo">sourceforge.net/projects/cloo</a> <br>  The C99 based OpenCl programming standard is described here - <a href="http://www.khronos.org/opencl/">www.khronos.org/opencl</a> <br><br>  Continuing the article " <a href="http://habrahabr.ru/blogs/hi/124925/">Introduction to OpenCl</a> " tells about the features of the programming language with which we program the video card. </div><p>Source: <a href="https://habr.com/ru/post/124873/">https://habr.com/ru/post/124873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124866/index.html">Saving the "broken" portable hard drive with a TrueCrypt-container</a></li>
<li><a href="../124867/index.html">Firefox 6 will support a number of properties from the draft CSS3 Text module</a></li>
<li><a href="../124869/index.html">2D Collision Handling Using LibCanvas</a></li>
<li><a href="../124871/index.html">Task complexity assessment</a></li>
<li><a href="../124872/index.html">Neighbors - will the IM + geosocial network take off?</a></li>
<li><a href="../124874/index.html">Premiere! Droider Show - video cassette about mobile technologies and gadgets</a></li>
<li><a href="../124875/index.html">OOP wrapper for PHP lib_curl</a></li>
<li><a href="../124877/index.html">Startup or proven business - the choice is yours</a></li>
<li><a href="../124878/index.html">Programming without using conditional constructions</a></li>
<li><a href="../124879/index.html">Creating composite components on Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>