<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The popularity of Habr's tags: what are the trends in posts?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! 

 Today we will talk about how you can try to trace trends. Looking at how this makes google have a desire to make such trends based on the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The popularity of Habr's tags: what are the trends in posts?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9f8/ff3/c68/9f8ff3c68458f8f2f2a037457b054c52.png" alt="Habrtrend" align="right"><br>  Good day! <br><br>  Today we will talk about how you can try to trace trends.  Looking at how this makes <a href="http://www.google.com/trends/explore/">google</a> have a desire to make such trends based on the Habr tags.  Perhaps not all users put tags in good faith, but by admitting this as the truth, you can get good results.  So let's try. <br><a name="habracut"></a><br><h4>  1. Description </h4><br>  Honestly, the idea was originally only to collect all the tags and sort them in descending order, looking at which ones are most often used and which are not.  But I decided to go a little further - adding the date had the opportunity to look at this frequency in time, for clarity, adding graphs.  All this will be at the end, but for now let's start from the very beginning. <br><br>  At once I will make a reservation that later in the text the word ‚Äútag‚Äù is encountered - this is the same as the tag, tag, tag.  We will write under python 3.3.2, since in it I did not have any problems with Unicode. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  2. Structure and preparation </h4><br>  For this task we need a database.  It will contain 2 tables post_tags and tags.  Fields of the first pid are post id, tid is tag id, date is post date with tag.  Fields of the second rowid are the tag id, tag_title is the tag header.  It's all very simple, so we will create a class for working with the database. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sqlite3 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self,dbname)</span></span></span><span class="hljs-function">:</span></span> self.con=sqlite3.connect(dbname) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__del__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.con.close( ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">maketables</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    """</span></span> self.con.execute(<span class="hljs-string"><span class="hljs-string">'create table post_tags(pid,tid,date)'</span></span>) self.con.execute(<span class="hljs-string"><span class="hljs-string">'create table tags(tag_title)'</span></span>) self.con.commit( )</code> </pre> <br>  Since everything is saved in the tags.py file, we will try to execute: <br><br><pre> <code class="bash hljs">import tags extend = tags.Base(<span class="hljs-string"><span class="hljs-string">'tags.db'</span></span>) extend.maketables()</code> </pre><br>  Now we have an empty base, let's go fill it up. <br><br><h4>  3. Parsing tags </h4><br>  It is necessary to collect all the tags and write together with the date of publication of the post.  For this we use <a href="http://www.crummy.com/software/BeautifulSoup/">beautifulsoup</a> and <a href="http://docs.python.org/3.0/library/urllib.request.html">urllib.request</a> . <br><br>  Add a function to the created class: <br><ul><li>  get_tag - to get a tag from the database </li><li>  add_tag ‚Äã‚Äã- to add a tag </li><li>  add_post - to view and add post </li></ul><br><div class="spoiler">  <b class="spoiler_title">Parsing Function Code</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_tag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, added = True)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  ,    tid,    cur -   res -        added - /     ,     false """</span></span> cur=self.con.execute(<span class="hljs-string"><span class="hljs-string">"select rowid from %s where %s='%s'"</span></span> % (<span class="hljs-string"><span class="hljs-string">'tags'</span></span>,<span class="hljs-string"><span class="hljs-string">'tag_title'</span></span>,name)) res=cur.fetchone( ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> res==<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> added: cur=self.con.execute(<span class="hljs-string"><span class="hljs-string">"insert into %s (%s) values ('%s')"</span></span> % (<span class="hljs-string"><span class="hljs-string">'tags'</span></span>,<span class="hljs-string"><span class="hljs-string">'tag_title'</span></span>,name)) self.con.commit( ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cur.lastrowid <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_tag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pid, name, date)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    pid -   name -   date -   """</span></span> rowid = self.get_tag(name); print(pid,rowid ,name, date) self.con.execute(<span class="hljs-string"><span class="hljs-string">"insert into %s (%s,%s,%s) values (%d,%d,'%s')"</span></span> % (<span class="hljs-string"><span class="hljs-string">'post_tags'</span></span>,<span class="hljs-string"><span class="hljs-string">'pid'</span></span>,<span class="hljs-string"><span class="hljs-string">'tid'</span></span>,<span class="hljs-string"><span class="hljs-string">'date'</span></span>,pid,rowid,date)) self.con.commit( ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, pid)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   (   ) """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (self.get_post(pid)): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> print(<span class="hljs-string"><span class="hljs-string">'-'</span></span>*<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-string"><span class="hljs-string">'http://habrahabr.ru/post/'</span></span>+str(pid),<span class="hljs-string"><span class="hljs-string">'-'</span></span>*<span class="hljs-number"><span class="hljs-number">10</span></span>) cur=self.con.execute(<span class="hljs-string"><span class="hljs-string">"select pid from %s where %s=%d"</span></span> % (<span class="hljs-string"><span class="hljs-string">'post_tags'</span></span>,<span class="hljs-string"><span class="hljs-string">'pid'</span></span>,pid)) res=cur.fetchone( ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> res==<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: soup=BeautifulSoup(urllib.request.urlopen(<span class="hljs-string"><span class="hljs-string">'http://habrahabr.ru/post/'</span></span>+str(pid)).read( )) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> (urllib.request.HTTPError): self.add_tag(pid,<span class="hljs-string"><span class="hljs-string">"parse_error_404"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>) print(<span class="hljs-string"><span class="hljs-string">"error 404"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: published = soup.find(<span class="hljs-string"><span class="hljs-string">"div"</span></span>, { <span class="hljs-string"><span class="hljs-string">"class"</span></span> : <span class="hljs-string"><span class="hljs-string">"published"</span></span> }) tags = soup.find(<span class="hljs-string"><span class="hljs-string">"ul"</span></span>, { <span class="hljs-string"><span class="hljs-string">"class"</span></span> : <span class="hljs-string"><span class="hljs-string">"tags"</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tags: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tags.findAll(<span class="hljs-string"><span class="hljs-string">"a"</span></span>): self.add_tag(pid, tag.string, get_date(published.string)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.add_tag(pid,<span class="hljs-string"><span class="hljs-string">"parse_access_denied"</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>) print(<span class="hljs-string"><span class="hljs-string">"access denied"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">"post has already"</span></span>)</code> </pre></div></div><br>  To fill the base, it is enough to start a cycle on all posts.  We restrict ourselves to <a href="http://habrahabr.ru/post/196000/">196,000</a> it falls on October 1, 2013. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pid <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">196000</span></span>): extend.add_post(pid+<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre><br>  I know that the method is not ideal and with the megabit Internet would work about 170 hours. <br><blockquote>  To speed up the process, it was decided to add another post table, which will store a separate post id, not associated with the logical part, and use it as a flag.  So most of the time the program "hangs".  While waiting for the page to load, you can run a couple more of these programs and set them on one base to fill it in parallel.  The occurrence of collisions is of course possible and in the end loss or partial recording amounted to 3% of posts, which is not so much.  After such actions, it turned out that more than 8 programs cannot work in parallel, since  at start 9 Habr gives <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D0%25BA%25D0%25BE%25D0%25B4%25D0%25BE%25D0%25B2_%25D1%2581%25D0%25BE%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D1%258F_HTTP">503 error</a> , which is quite logical.  Therefore, launching 6 copies (this number did not cause errors and did not conflict with each other), the <a href="https://db.tt/vT2KqaQA">base</a> was obtained (17 Mb). </blockquote><br><h4>  4. Data processing </h4><br>  Actually, now the main part is to process the received data. <br>  Add a function to the created class: <br><ul><li>  get_count_byid - number by tag ID </li><li>  get_graph - get a list of tuples (date, number) </li><li>  get_image - show image </li><li>  get_all_tags_sorted - sort descending </li><li>  get_all_tag_count - get a list of tuples (id, tag, number) </li></ul><br><div class="spoiler">  <b class="spoiler_title">Function code for data processing</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_count_byname</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name, date = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""  name  tid       get_count_byid name -   date - (*)  mm_yyyy """</span></span> tid = self.get_tag(name, <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.get_count_byid(tid, date) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_count_byid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, tid, date = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""          """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tid: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> date: count=self.con.execute(<span class="hljs-string"><span class="hljs-string">"select count(pid) from %s where %s=%d and %s='%s'"</span></span> % (<span class="hljs-string"><span class="hljs-string">'post_tags'</span></span>,<span class="hljs-string"><span class="hljs-string">'tid'</span></span>,tid,<span class="hljs-string"><span class="hljs-string">'date'</span></span>,date)) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: count=self.con.execute(<span class="hljs-string"><span class="hljs-string">"select count(pid) from %s where %s=%d"</span></span> % (<span class="hljs-string"><span class="hljs-string">'post_tags'</span></span>,<span class="hljs-string"><span class="hljs-string">'tid'</span></span>,tid)) res=count.fetchone( ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_graph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    -  """</span></span> month = (<span class="hljs-string"><span class="hljs-string">'01'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'02'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'03'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'04'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'05'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'06'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'07'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'08'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'09'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'10'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'11'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>),(<span class="hljs-string"><span class="hljs-string">'12'</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>) years = [<span class="hljs-number"><span class="hljs-number">2006</span></span>,<span class="hljs-number"><span class="hljs-number">2007</span></span>,<span class="hljs-number"><span class="hljs-number">2008</span></span>,<span class="hljs-number"><span class="hljs-number">2009</span></span>,<span class="hljs-number"><span class="hljs-number">2010</span></span>,<span class="hljs-number"><span class="hljs-number">2011</span></span>,<span class="hljs-number"><span class="hljs-number">2012</span></span>,<span class="hljs-number"><span class="hljs-number">2013</span></span>] graph = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> years: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> M,M_str <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> month: date = str(M)+<span class="hljs-string"><span class="hljs-string">'_'</span></span>+str(Y) graph.append((date, self.get_count_byname(name, date))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> graph <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   m_x -   X m_y -   Y img_x -   img_y -   """</span></span> img_x = <span class="hljs-number"><span class="hljs-number">960</span></span> img_y = <span class="hljs-number"><span class="hljs-number">600</span></span> img=Image.new(<span class="hljs-string"><span class="hljs-string">'RGB'</span></span>,(img_x,img_y),(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>)) draw=ImageDraw.Draw(img) graph = self.get_graph(name) max_y = max(graph,key=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> item:item[<span class="hljs-number"><span class="hljs-number">1</span></span>])[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> max_y == <span class="hljs-number"><span class="hljs-number">0</span></span>: print(<span class="hljs-string"><span class="hljs-string">'tag not found'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> m_x, m_y = int(img_x/(len(graph))), int(img_y/max_y) draw.text((<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), str(max_y), (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) draw.text((<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), name, (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) x,prev_y = <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x_str, y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> graph: x += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x%<span class="hljs-number"><span class="hljs-number">12</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>): draw.text((x*m_x, img_y - <span class="hljs-number"><span class="hljs-number">30</span></span>), str(x_str[<span class="hljs-number"><span class="hljs-number">3</span></span>:]),(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> prev_y &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>: draw.line(((x<span class="hljs-number"><span class="hljs-number">-1</span></span>)*m_x, img_y-prev_y*m_y<span class="hljs-number"><span class="hljs-number">-1</span></span>, x*m_x, img_y-y*m_y<span class="hljs-number"><span class="hljs-number">-1</span></span>), fill=(<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) prev_y = y img.save(<span class="hljs-string"><span class="hljs-string">'graph.png'</span></span>,<span class="hljs-string"><span class="hljs-string">'PNG'</span></span>) Image.open(<span class="hljs-string"><span class="hljs-string">'graph.png'</span></span>).show() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_all_tags_sorted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, tags)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sorted(tags, key=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> tag:tag[<span class="hljs-number"><span class="hljs-number">2</span></span>], reverse=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_all_tag_count</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> count=self.con.execute(<span class="hljs-string"><span class="hljs-string">"select count(rowid) from %s"</span></span> % (<span class="hljs-string"><span class="hljs-string">'tags'</span></span>)) res=count.fetchone( ) alltag_count = res[<span class="hljs-number"><span class="hljs-number">0</span></span>] tags = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tag_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(alltag_count<span class="hljs-number"><span class="hljs-number">-1</span></span>): tags.append((tag_id+<span class="hljs-number"><span class="hljs-number">1</span></span>,self.get_tag_name(tag_id+<span class="hljs-number"><span class="hljs-number">1</span></span>),self.get_count_byid(tag_id+<span class="hljs-number"><span class="hljs-number">1</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (tag_id+<span class="hljs-number"><span class="hljs-number">1</span></span>,self.get_tag_name(tag_id+<span class="hljs-number"><span class="hljs-number">1</span></span>),self.get_count_byid(tag_id+<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tags</code> </pre></div></div><br><h4>  5. Total (for fans of statistics) </h4><br>  Top 25 leaderboard tags: <br><ol><li>  google - 2611 </li><li>  android - 2188 </li><li>  Google - 2024 </li><li>  linux - 1978 </li><li>  php - 1947 </li><li>  javascript - 1877 </li><li>  microsoft - 1801 </li><li>  apple - 1668 </li><li>  social networks - 1509 </li><li>  startups - 1484 </li><li>  startup - 1317 </li><li>  programming - 1229 </li><li>  Microsoft - 1220 </li><li>  java - 1180 </li><li>  games - 1141 </li><li>  Apple - 1135 </li><li>  iphone - 1122 </li><li>  design - 1110 </li><li>  python - 1108 </li><li>  humor - 1061 </li><li>  Internet - 1040 </li><li>  habrahabr - 983 </li><li>  video - 970 </li><li>  advertising - 968 </li><li>  Android - 876 </li></ol><br>  The full list can be found <a href="https://db.tt/PTvrAKum">here</a> (format id, title_tag, number of mentions). <br><br>  Now, actually, we return to the idea of ‚Äã‚Äãtrends.  Below are a couple of examples (clickable): <br><table cellpadding="2" border="1"><tbody><tr><td>  <b>python</b> </td><td>  <b>javascript</b> </td><td>  <b>android</b> </td></tr><tr><td> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/64a/a89/0ad/64aa890ad77ea3012e201b772da40eca.png"></a> </td><td> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5e6/71a/cbf/5e671acbfc9dc54f49e120e613dc4ffd.png"></a> </td><td> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e31/e0e/036/e31e0e0369882792412245ededbd432c.png"></a> </td></tr></tbody></table>  You can get such images from the get_image (tag_title) function. <br><br>  I am sure that there are still better methods for obtaining a similar result, but "I am not a wizard, I am just learning."  I ask everyone in the comments for discussions and improvements. <br>  Basically, my goal was achieved.  Although there are already thoughts about adding register independence and morphology, as well as the ability to immediately send a list of tags. <br><br>  The full code is posted on <a href="https://github.com/denisbalyko/HabrTrend">github</a> . <br><br>  Thank you all for your attention, I will be glad to criticism. </div><p>Source: <a href="https://habr.com/ru/post/197308/">https://habr.com/ru/post/197308/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197296/index.html">Meteor + JQuery-UI Sortable + Animation + Todos</a></li>
<li><a href="../197298/index.html">Create the first application on NancyFX</a></li>
<li><a href="../197300/index.html">Using Lua and C ++ to process and store data</a></li>
<li><a href="../197302/index.html">How to configure Firewall for VPN on a server with two IPs</a></li>
<li><a href="../197304/index.html">How to prohibit the use of personal data in Google ads</a></li>
<li><a href="../197312/index.html">Getting a list of files in the remote repository</a></li>
<li><a href="../197316/index.html">‚ÄúRead later‚Äù button</a></li>
<li><a href="../197318/index.html">Refrigerator against</a></li>
<li><a href="../197324/index.html">New record of the Grasshopper rocket: 744 meters and a successful landing</a></li>
<li><a href="../197326/index.html">Apple's Tao</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>