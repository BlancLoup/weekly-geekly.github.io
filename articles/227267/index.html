<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How a startup can fly out of the index overnight</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habr! 

 A year ago we ran into a problem. In a nutshell, we were hacked. Hacked creatively, so that we did not immediately understand what was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How a startup can fly out of the index overnight</h1><div class="post__text post__text-html js-mediator-article"> Hello, Habr! <br><br>  A year ago we ran into a problem.  In a nutshell, we were hacked.  Hacked creatively, so that we did not immediately understand what was going on.  In the process of solving the problem, it turned out to acquire useful skills: to make abuse calls and effectively communicate with hosters, incl.  - foreign, more pleased about the safety of our resource, constantly monitor the availability of our site in the index of Yandex and Google, and be attentive to the little things.  In the described case, the <b>usual symbol ‚Äú-‚Äù (hyphen, minus, dash, dash, wand, hyphenosis)</b> played a cruel joke with us. <br><br>  We faced the problem of hacking for the first time, perhaps some things were obvious from the very beginning, but we did not see them, or our steps in the search for a solution would cause a smile, or a misunderstanding of the pros.  Or maybe our experience will be useful for those who are faced with problems in the field of information security. <br><a name="habracut"></a><br>  So, our main resource is located at: <a href="http://www.ist-budget.ru/">www.ist-budget.ru</a> : it has its own permanent audience, an array of indexed pages, for example, a directory of organizations: <a href="http://www.ist-budget.ru/customers.php">www.ist-budget.ru/customers.php</a> and <a href="http://www.ist-budget.ru/suppliers.php">www.ist-budget. ru / suppliers.php</a> , which in total contains more than 5 million pages;  different interactivity, development perspective and so on.  To optimize the resource, development and experimentation, we use a sandbox site with the same name, but on a different domain: <a href="http://www.ist-budget.com/">www.ist-budget.com</a> .  The sandbox is closed from ‚Äúoutside‚Äù visits, incl.  and from search robots that index pages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first alarming signals began to come in June 2013, when, according to the queries in the Google search results, our pages began to appear, but not belonging to the main resource, but rather like a sandbox.  We checked the robots.txt com site (sandbox), made sure once again that it was closed from indexing, and assumed that Google could speed up some of the pages at the time of the short-term removal of restrictions. <br><br>  A few days later, there was a reason for more serious concern - the attendance of the main resource on the RU domain sharply decreased, as a result, the number of incoming calls from site visitors dropped.  And again the search site surfaced in the search engine sandbox, but with the circumstance from the awareness of which we were simultaneously thrashed with cold sweat, we looked closely and found that there is no dash sign in the name of the sandbox, i.e.  instead of the address <a href="http://www.ist-budget.com/">www.ist-budget.com</a> was the address <a href="http://www.istbudget.com/">www.istbudget.com</a> , it is surprising that earlier we paid no attention to this thing.  Services such as whois predictably showed that the site was registered just a couple of weeks ago, for a private person, the American domain registrar CLOUDFLARE and the Moldovan hoster Trabia-Network completed the picture in such a way that even the <b>most inexperienced person in our company became extremely clear - this site is not ‚Äú sandbox ‚Äùand has nothing to do with us</b> . <br><br>  Detailed analysis showed that the site-clone Moldavashka fully preserved our original design, structure and content of the main domain and subdomain pages.  The contact details (address, phone numbers, and details) also remained unchanged, except for the Skype login indicated on the main page: instead of ist-budget.ru, istbudget.com appeared, although this login flatly refused to know Skype (i.e., this login did not was registered). <br>  At the same time, our main domain began to slow down, mainly due to the fact that the clone continued to parse its new pages and updated information in the main sections.  Each ‚Äúfreeze‚Äù was accompanied by SMS from the useful utility Ping Admin (this utility eventually played almost the most important role in solving the problem), constantly monitoring the performance of the site, the number of ‚Äúalarming‚Äù SMS from it about hanging up was then measured in hundreds. <br><br>  As it turned out, the clone proxied all requests to us, and in the responses replaced all the links to themselves, adding advertising to the page code.  The problem was solved by setting the .htaccess file, namely adding lines <br><br>  SetEnvIfNoCase REMOTE_ADDR "^ xxx \ .xxx \. [0-9] + \. [0-9] + $" REDIR = toredir <br>  RewriteCond% {REDIR} ^ toredir $ [NC] <br>  RewriteRule ^ (. *) $ <a href="http://www.ist-budget.com/redir.php%3Fpage%3D">Www.ist-budget.com/redir.php?page=</a> $ 1 [R = 301, L] <br><br>  who sent all the proxy requests from the pool of addresses of a phishing site to a special page, the text of which stated that you are on a phishing site and can find us in Google search by company name.  I had to resort to such tricks because the code that proxied all requests to our site automatically replaced all links to the phishing domain. <br>  Also, a large number of requests from a phishing proxy highlighted the problem with optimizing SQL queries and some functions.  Requests and functionality were completely reworked, and we used Xdebug and Webgrind as an analysis tool. <br><br>  The speed was relatively restored, but two problems remained: <br>  1. In the index of search engines still hung a site-clone, not us. <br>  2. On the clone site, there were still updates synchronously with updates on our domain, but without obvious hangs, which added even more bewilderment to us. <br><br>  And there were more questions than answers.  Here is one of them: if search engines have identified a full double of the two sites - why do they eject from the index a site that is clearly older (the domain is registered three years earlier than that of the clone), and not a freshly duplicate?  There were a lot of delusional answers, for example, we assumed that the priority for search engines (in particular, Google) is always the site in the domain zone * .com, which is why our main RU-domain ‚Äúwent away‚Äù.  And there was also a correspondence with Google technical support.  Although it‚Äôs difficult to call the one-way flow of emails to Google support by correspondence, we simply tried to find out if any sanctions were imposed on our website, which caused the departure from the index.  There were no response letters.  And then it turned out that we were looking for a solution not at all there. <br><br>  The idea to write a letter to the provider, where the clone site was hosted, became the brightest thought in the ongoing chaos.  Having previously phoned with Moldavian technical support (by the way, they speak Russian fairly tolerably), we made a complaint in Russian and English (such a requirement) languages ‚Äã‚Äãand sent by ordinary e-mail. <br><br>  _________________________________________ <br><br>  The letter began like this: <br><br>  Good day. <br>  On June 13, 2013, the phishing site <a href="http://www.istbudget.com/">www.istbudget.com</a> was registered <a href="http://www.istbudget.com/">.</a> <br>  The data confirms that it is hosted by you: <br><br>  IP 178.175.138.11 <br>  Host: 178-175-138-11.ip.as43289.net <br>  City: Chisinau <br>  Country: Moldova, Republic of <br>  IP range: 178.175.128.0 - 178.175.255.255 <br>  Provider Name: ICS Trabia-Network SRL <br>  Whois Server Version 2.0 <br>  Domain Name: ISTBUDGET.COM <br>  Registrar: SHANGHAI YOVOLE NETWORKS INC. <br>  Whois Server: whois.yovole.com <br>  Referral URL: <a href="http://www.yovole.com/">www.yovole.com</a> <br>  Name Server: ERIC.NS.CLOUDFLARE.COM <br>  Name Server: RUTH.NS.CLOUDFLARE.COM <br>  Status: clientTransferProhibited <br>  Updated Date: 13-jun-2013 <br>  Creation Date: 13-jun-2013 <br>  Expiration Date: 13-jun-2014 <br><br>  ... <br>  _________________________________________ <br><br>  The answer did not take long to wait, for two hours without any bureaucratic delays the site-clone was blocked, while trying to go to the site of the clone site Chrome reported that the site address does not exist.  Unfortunately, the request to provide information about the owner of the clone site received a refusal and an offer to obtain this data through an appeal to local security agencies.  We celebrated the victory and went home, and in the morning ... <br><br>  And in the morning, to our displeasure, the site-clone was again in service.  Fortunately for us, this time he was hosted not at somewhere in China for dubious proxies, but directly at his domain registrar - in America.  We already went according to a well-established scheme - we sent a complaint against the abuse of a domain registrar and within a few hours the site was again blocked, this time - finally. <br><br>  In general, the quick reaction of the provider and the domain registrar pleased me pleasantly.  Without additional questions and difficulties, we got the desired result.  And then there was an expectation that it would take 2-3 days after the ‚Äúdeath‚Äù of the clone and our site would return to the search engines index, however, this did not happen, the pages of the clone site were still in the issue, and Chrome regularly reported to that the resource does not exist at this address.  And again we wrote letters to the support of Yandex and Google.  It was impossible to create a letter in Yandex webmaster, therefore, they simply wrote to tech support in free form. <br><br>  The solution to the problem was found by chance and not at all where efforts were made: the Ping Admin utility stopped sending SMS when the site was hanging.  We paid attention to this, went into the personal account of the service, checked the balance (it was positive), saw that Ping Admin defined our site as inaccessible for several days now.  They wrote a letter to the support service, reported an error, and in response received a letter, where tech support reported that our primary domain gives the 301st redirect for search robots to the address of the Komov parasite site, respectively, the robots received the following when entering the main resource signal that the domain is a minor mirror of the new clone site. <br><br>  Thanks to the 301 redirect, the ‚Äúmirror man‚Äù of Yandex successfully glued our main domain to the new parasitic domain, which is why the site-clone began to be indexed and appeared in the results of search results instead of the main resource. <br><br>  We found and fixed the vulnerability, having been glad that we got off easily, deleted the redirects that were written by others in our code.  By the way, the parasitic code was found quite easily by calling eval (base64_encode ()). <br><br>  Within 30 minutes, our primary domain returned to the Google index, and a little later, to Yandex.  And that's another story. </div><p>Source: <a href="https://habr.com/ru/post/227267/">https://habr.com/ru/post/227267/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227253/index.html">The model of the natural series of numbers (nrch). Ulam Spiral</a></li>
<li><a href="../227255/index.html">Automobile race and service testing</a></li>
<li><a href="../227257/index.html">Brave new world: mobile operators, as the largest providers of advertising data</a></li>
<li><a href="../227261/index.html">The government is ready to pay for Russian studies in foreign universities</a></li>
<li><a href="../227265/index.html">Data center cyclopic sizes and Tier IV, how can this be? Meet - SuperNAP 8</a></li>
<li><a href="../227273/index.html">Interactive redirection to an exploit kit</a></li>
<li><a href="../227275/index.html">City drones and smart cities</a></li>
<li><a href="../227277/index.html">How we wrote helpdesk</a></li>
<li><a href="../227279/index.html">Who and why is ‚Äúspying‚Äù on Yandex?</a></li>
<li><a href="../227281/index.html">GoogleDocs integration with Redmine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>