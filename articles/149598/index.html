<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Running Linux on a tablet with SoC Allwinner A10 on board</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 I bought myself a tablet on the SoC Allwinner A10 ( sun4i is the code name of the AllWinner A10 processor ARMv7-A of the Cortex family of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Running Linux on a tablet with SoC Allwinner A10 on board</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  I bought myself a tablet on the SoC Allwinner A10 ( <i>sun4i is the code name of the AllWinner A10 processor ARMv7-A of the Cortex family of architecture core A8</i> ).  At first I played with it on Android 2.x and then at 4.x, but over time, this was not enough for me.  Yes, they began to produce minicomputers based on this SoC with Linux on board.  I thought, ‚ÄúHmm, why is my tablet worse?‚Äù And took up the business.  As it turned out, everything was already done for me, <i>and I didn‚Äôt have to do anything</i> : <br><ol><li>  <a href="https://github.com/amery/linux-allwinner">Kernel</a> optimized for this platform </li><li>  <a href="https://github.com/hno/uboot-allwinner">The loader has been</a> optimized for this platform. </li><li>  A new <a href="http://wiki.debian.org/ArmHardFloatPort/">debian armhf</a> port has been <a href="http://wiki.debian.org/ArmHardFloatPort/">released</a> . </li></ol><br>  It remains only the whole thing is configured and assembled. <br><a name="habracut"></a><br><h4>  Wednesday </h4><br>  System - ArchLinux x86-64.  Where to find and how to install the environment for the assembly will not describe, on the Internet, and so enough of this information.  Yes, and most of this is not why, I will put everything you need collected. <br>  I have the following ‚Äúkitchen‚Äù: <br><ul><li>  <a href="http://packages.debian.org/sid/qemu-user-static">qemu-user-static</a> ‚Äî in order to be able to chroot in rootfs, it wasn‚Äôt in turnips, I had to get from the debian repository and build my package.  The whole thing is necessary to run arm elf executables on a machine with a different architecture, in this case mine. </li><li>  gcc version 4.6.1 ( <a href="http://www.mentor.com/embedded-software/sourcery-tools/sourcery-codebench/editions/lite-edition/">Sourcery CodeBench Lite</a> 2011.09-70) - GCC ARM Crosscompiler.  Maybe the old one, but it does not let me down yet.  I also advise you to put a linaro <a href="http://www.linaro.org/downloads/">cross-compiler</a> straight <a href="http://www.linaro.org/downloads/">from the tin.</a> </li></ul><br><h4>  <a href="http://forum.doozan.com/read.php%3F6,8481">SoC boot process</a> </h4><br><ul><li>  <b>brom</b> (looking for a bootloader in mmc, nand, usb called boot0 (the SPL - Second Program Loader: sun4i-spl.bin). </li><li>  <b>boot0</b> (the SPL - Second Program Loader: sun4i-spl.bin) initializes devices </li><li>  <b>SPL</b> (boot0) boots u-boot (boot1) </li><li>  <b>U-boot</b> (boot1) initializes the remaining devices and creates abstractions for working with hardware. </li><li>  It loads the hardware configuration file (script.bin. Evb.bin, mele.bin sys_config.bin) next to the u-boot, similar to the initrd. </li><li>  The u-boot boots the kernel. </li></ul><br>  Those.  The download starts from the SD card, if there is no bootloader, it continues with NAND Flash. <br>  According to the <a href="https://github.com/hno/uboot-allwinner/wiki">documentation for the allwinner-uboot bootloader, the</a> structure of the SD card should look like this: <br><table><tbody><tr><td>  Start </td><td>  the size </td><td>  description </td></tr><tr><td>  0 </td><td>  8KB </td><td>  Unused, available for partition table etc. </td></tr><tr><td>  eight </td><td>  24KB </td><td>  Initial SPL loader </td></tr><tr><td>  32 </td><td>  512KB </td><td>  u-boot </td></tr><tr><td>  544 </td><td>  128KB </td><td>  environment </td></tr><tr><td>  672 </td><td>  352KB </td><td>  reserved </td></tr><tr><td>  1024 </td><td></td><td>  Free for partitions </td></tr></tbody></table><br><h5>  Build u-boot </h5><br>  It is not necessary to collect, sun4i-spl.bin u-boot.bin can be downloaded <a href="">here</a> . <br><h6>  We collect uboot-allwinner: </h6><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/hno/uboot-allwinner <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> uboot-allwinner make sun4i CROSS_COMPILE=arm-none-linux-gnueabi- <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ..</code> </pre> <br><h4>  Bootloader entry </h4><br><habracut><br>  <b>Caution, be careful not to confuse the SD card device with other media.</b>  <b>If you do not understand what you are doing, then do not do it.</b> <br>  $ {SD} is a device variable, can be replaced manually, you can register before execution: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> SD=/dev/sdb</code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># SPL (boot0)    SD dd if=uboot-allwinner/spl/sun4i-spl.bin of=${SD} bs=1024 seek=8 conv=notrunc #  (boot1) u-boot   SD dd if=uboot-allwinner/u-boot.bin of=${SD} bs=1024 seek=32 conv=notrunc</span></span></code> </pre><br><habracut><br><h4>  We break the microSD drive </h4><br><habracut><br>  Attention, as a result of the operation, data on MicroSD drives will be lost, save everything you need in a safe place. <br><ul><li>  We need to create two sections necessarily. </li><li>  The first section is a section with an iron configuration file (evb.bin) and a kernel (uImage).  It should start with sector 2048, be 32MB-100MB in size and have a FAT file system (FAT partition type) or ext2 / 3 (partition type 83). </li><li>  The second partition is the rootfs partition, the entire system itself, the partition size is preferably within 1GB-4GB, the file system is strictly ext4, the partition type is 83. </li><li>  You can make another swap section, if desired. </li><li>  Use the remaining space for yourself.  I created a section for my data, you can mount it in / home / </li></ul><br>  Here is how I broke my 16GB card: <br><pre> <code class="bash hljs">fdisk -l /dev/sdb Disk /dev/sdb: 15.9 GB, 15935209472 bytes 64 heads, 32 sectors/track, 15197 cylinders,  31123456  Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x000728ca -     Id  /dev/sdb1 2048 34815 16384 83 Linux /dev/sdb2 34816 6326271 3145728 83 Linux /dev/sdb3 6326272 31123455 12398592 83 Linux</code> </pre><br>  According to the points described above, we split the MicroSD drive. <br>  I hope those who use linux can use fdisk. <br><pre> <code class="bash hljs">fdisk <span class="hljs-variable"><span class="hljs-variable">${SD}</span></span></code> </pre><br><habracut><br><habracut><br><h6>  Formatting: </h6><br><pre> <code class="bash hljs">mkfs.vfat <span class="hljs-variable"><span class="hljs-variable">${SD}</span></span>1 -n sun4i-boot mkfs.ext4 <span class="hljs-variable"><span class="hljs-variable">${SD}</span></span>2 -L sun4i-rootfs</code> </pre><br>  We mount in the right place: <br><pre> <code class="bash hljs">mkdir /mnt/sun4i-boot mkdir /mnt/sun4i-rootfs mount <span class="hljs-variable"><span class="hljs-variable">${SD}</span></span>1 /mnt/sun4i-boot mount <span class="hljs-variable"><span class="hljs-variable">${SD}</span></span>2 /mnt/sun4i-rootfs</code> </pre><br><h4>  Kernel build </h4><br><habracut><br>  The kernel can not be compiled, I have attached the finished kernel with modules from below. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  git clone git://github.com/amery/linux-allwinner.git #  cd linux-allwinner make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- sun4i_defconfig #  make ARCH=arm CROSS_COMPILE=arm-linux-gnueabi- gconfig</span></span></code> </pre><br>  Instead of gconfig, you can use xconfig (qt interface) or menuconfig (console interface).  Do not forget to include the necessary drivers in the kernel as well as the features you need.  Read hints to the parameters. <br>  I advise you not to forget about the modules of the touchscreen and FS (fat, ntfs). <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># make ARCH=arm CFLAGS="march=armv7-a -mfloat-abi=hard -mfpu=neon -ftree-vectorize -mvectorize-with-neon-quad -mcpu=cortex-a8 -mtune=cortex-a8 -mthumb -O2 -pipe -fstack-protector --param=ssp-buffer-size=4 -D_FORTIFY_SOURCE=2 -ffast-math" CROSS_COMPILE=arm-none-linux-gnueabi- -j3 uImage modules #  make ARCH=arm CFLAGS="march=armv7-a -mfloat-abi=hard -mfpu=neon -ftree-vectorize -mvectorize-with-neon-quad -mcpu=cortex-a8 -mtune=cortex-a8 -mthumb -O2 -pipe -fstack-protector --param=ssp-buffer-size=4 -D_FORTIFY_SOURCE=2 -ffast-math" CROSS_COMPILE=arm-none-linux-gnueabi- -j3 INSTALL_MOD_PATH=/mnt/sun4i-rootfs #   boot  cp arch/arm/boot/uImage /mnt/sun4i-boot</span></span></code> </pre><br>  The -j argument specifies the number of concurrent compilation threads.  It has been empirically established that there should be one more threads than the cores in the processor. <br>  Optimization flags are taken from the <a href="http://habrahabr.ru/post/146877/">ValdikSS article</a> .  Frankly, the kernel compiled with them.  But I have not installed it on the SD flash card yet. <br><h4>  Install rootfs </h4><br>  I will not describe the initial rootfs how to load with the help of <a href="http://wiki.debian.org/Debootstrap">debootstrap</a> , since it is worthy of another article.  I'd rather butt ready Debian Wheezy ARMHF rootfs, and you use. <br>  Rootfs must be unpacked with the attributes saved to the second SD partition, since this is the way the u-boot is configured by default (you can read about the configuration <a href="https://github.com/hno/uboot-allwinner/wiki">here</a> . <br>  Download <a href="http://narod.ru/disk/59191784001.4e6748d3ae5218f2bb326d262a32893a/debian-wheezy-armhf-rootfs.img.tar.bz2.html">Debian Wheezy Rootfs</a> and unpack: <br><pre> <code class="bash hljs">tar -xpf debian-wheezy-armhf-rootfs.img.tar.bz2 -C /mnt/sun4i-boot</code> </pre><br>  By the way, there are modules for the 3.0.36+ kernel.  There is also a lxde, slim autoloading user user, network-manager, nm-applet starts at the start of the session.  Touchscreen works in touchpad mode. <br>  It is likely that all the necessary modules will load udev, but to be sure, they can be written into / mnt / sun4i-rootfs / etc / modules.  The list of required modules can be obtained in AndroidOS via TerminalEmulator: <br><div class="spoiler">  <b class="spoiler_title">TerminalEmulator: $ lsmod</b> <div class="spoiler_text"><img src="http://rghost.net/39804415/image.png" alt="lsmod"></div></div><br>  either through ADB: <br><pre> <code class="bash hljs">adb shell lsmod</code> </pre><br><h5>  Linux boot setup </h5><br>  Download the <a href="http://narod.ru/disk/59188122001.dedcfd0cc567def813ff0d9605a8c782/debian-wheezy-armhf-boot.tar.bz2.html">archive</a> with the contents of the first boot partition. <br>  And extract the evb.bin configuration file in / mnt / sun4i-boot from the archive. <br><pre> <code class="bash hljs">tar -xf debian-wheezy-armhf-boot.tar.bz2 evb.bin -C /mnt/sun4i-boot</code> </pre><br>  If you did not compile the kernel, then the assembled kernel 3.0.36+ can also be extracted: <br><pre> <code class="bash hljs">tar -xf debian-wheezy-armhf-boot.tar.bz2 uImage -C /mnt/sun4i-boot</code> </pre><br><h5>  Launch </h5><br>  All, perhaps, is ready.  We installed the system on an SD drive.  Insert the microSD card into the card reader and turn it on.  After 5 seconds after switching on, the backlight should light up, the screen will remain black.  After a few minutes, the entire system should boot up. <br>  <b>Remember, the default password is root - root, user - user.</b>  <b>I advise you to change them.</b> <br>  If you do not have a usb keyboard, then a virtual keyboard is pre-installed in the rootfs. <br>  Connect to a wifi network, or use a USB Ethernet adapter and connect to the network using nm-applet.  Immediately you can connect via ssh. <br>  Launch lxterminal and deliver the necessary software. <br><pre> <code class="bash hljs">sudo -i apt-get update apt-get install vlc geany</code> </pre><br><h4>  Possible problems </h4><br><ol><li>  If you don‚Äôt see anything after switching on, it‚Äôs still possible loading, wait about 5 minutes. But if even the backlight isn‚Äôt, then you will need to replace evb.bin with your configuration file from the android firmware that is on nanda. <br>  On an Android device via Terminal Emaulator or via adb: <br><pre> <code class="bash hljs">adb shell su mkdir /<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/data/tmp/nanda mount /dev/block/nanda /<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/data/tmp/nanda</code> </pre><br>  Extracting any ways script.bin, I did this: <br>  $ adb pull /local/data/tmp/nanda/script.bin evb.bin <br><pre> <code class="bash hljs">cp evb.bin /mnt/sun4i-boot/</code> </pre><br></li><li>  If there is still a backlight, but the system has not booted, you can view the system logs, remove the microSD card from the tablet and mount it in / mnt / sun4i-rootfs <br><pre> <code class="bash hljs">cat /mnt/sun4i-rootfs/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/dmesg cat /mnt/sun4i-rootfs/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/Xorg.0.log</code> </pre><br></li><li>  If the touch does not work, then you need to find out in Android which module is responsible for your touch: <br>  Method via ADB: <br><pre> <code class="bash hljs">adb shell <span class="hljs-string"><span class="hljs-string">'lsmod | grep ts'</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Method via TerminalEmulator</b> <div class="spoiler_text"><img src="http://rghost.net/39804502/image.png" alt="lsmod | grep ts"></div></div><br><br>  and prescribe it / mnt / sun4i-rootfs / etc / modules. <br></li></ol><br><h5>  Conclusion </h5><br>  So I launched linux on my MOMO9 tablet.  The system is not yet fully configured, it would not hurt to configure the same laptop-mode and deliver the necessary packages.  Time was spent is not enough.  But then, having assembled the system ‚Äúalmost‚Äù from scratch, you immediately begin to understand how this OS works.  The vocabulary of special English vocabulary is also being replenished, which is not bad either. <br><div class="spoiler">  <b class="spoiler_title">Debian Wheezy on MOMO9 screenshots</b> <div class="spoiler_text">  Here is a screenshot taken on the device itself using the import utility from the MagickImage package. <br><img src="http://rghost.net/39804746/image.png" alt="image"><br><img src="http://rghost.net/39805371/image.png" alt="real"><br>  Filmed on the camera phone, the other was not at hand, so sorry. <br></div></div><br>  <b>And of course, I do not bear any responsibility for what you do on your PC for damage to the equipment.</b>  <b>Do everything with an understanding of the case.</b>  <b>Do not confuse an SD reader device with a hard drive or other device.</b> <br><h4>  UPD: </h4><br><ol><li>  <a href="http://forum.doozan.com/read.php%3F6,8481">SoC boot process.</a>  <a href="http://forum.doozan.com/read.php%3F6,8481">Description on the forum.</a> </li><li>  <a href="http://rhombus-tech.net/allwinner_a10/a10_boot_process/">SoC boot process.</a> </li><li>  The .config file can be retrieved from an already compiled kernel using a script located in the kernel source folder linux-allwinner / scripts / extract-ikconfig.  I mean that you can not configure the new kernel yourself from scratch, but use the configuration file from the old kernel, only when compiling, you will be asked to build a script that you can do with the new features and modules of the kernel (turn on the kernel or not include the kernels). </li><li>  <b>RZK333</b> added sources: Rhombus-Tech channel # arm-netbook @ freenode, where actually all the authors of what you describe (patches for the kernel, patches for u-boot, parsing SPL, loading from SD) and linux-sunxi.org where everything was folded.  The channel was not, but on the wiki information is interesting. <br></li><li>  <a href="http://www.4pda.ru/forum/index.php%3Fshowtopic%3D362324">I drew a lot from this topic.</a>  <a href="http://www.4pda.ru/forum/index.php%3Fshowtopic%3D362324">Linux on AllWinner A10, Principle of work, discussion and assembly of kernels</a> <br></li><li>  Added a few screenshots. <br></li><li>  I do not pretend to the most correct method of installation, perhaps, I do not understand some things that way, since I only recently began to study this sphere.  Therefore, I ask you, if you notice some inaccuracies, do not ‚Äúhesitate‚Äù to correct me.  I will only be grateful to you. <br></li></ol></habracut></habracut></habracut></habracut></habracut></habracut></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/149598/">https://habr.com/ru/post/149598/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149593/index.html">Internet of things - and what is it?</a></li>
<li><a href="../149594/index.html">Overview of JS frameworks. Journey through the jungle javascript MVC. Part 1</a></li>
<li><a href="../149595/index.html">Sberbank fired employee for posting on Twitter</a></li>
<li><a href="../149596/index.html">Overview of vulnerabilities on the Big Three sites</a></li>
<li><a href="../149597/index.html">IBM THINK - a new application about the history of progress</a></li>
<li><a href="../149603/index.html">Unity3D 3.x Get the current active window</a></li>
<li><a href="../149605/index.html">Teach computer feelings (sentiment analysis in Russian)</a></li>
<li><a href="../149606/index.html">Bart Chalkboard Generator</a></li>
<li><a href="../149607/index.html">Java computer vision for Android. BoofCV Library Overview</a></li>
<li><a href="../149608/index.html">Work and travel - stupid, useless, humiliating?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>