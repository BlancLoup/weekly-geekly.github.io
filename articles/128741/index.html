<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hiding, obfuscating and crypting the client side of web applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Obfuscation is the reduction of the source code of a program to a form that preserves its functionality, but complicates the analysis, understanding o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hiding, obfuscating and crypting the client side of web applications</h1><div class="post__text post__text-html js-mediator-article">  Obfuscation is the reduction of the source code of a program to a form that preserves its functionality, but complicates the analysis, understanding of the operation algorithms and modification during decompilation.  For JavaScript, this technology is used in such types of online shadow business as downloads (iframe), spam and SEO.  Our task for today is to study all the methods of hiding the JS-code, which I hope you will use only for the good. <br><img src="https://habrastorage.org/storage1/96d220e6/adc38d1c/f17ee8ef/70a7b9e3.jpg"><h4>  Obfuscated script </h4><a name="habracut"></a><br><h3>  Theory </h3><br>  First, we will answer some questions for ourselves: <br>  <b>1. What are we going to hide?</b> <br>  We will hide only the client part of the web-applications, that is, what eventually a regular user will download to his computer. <br>  The following technologies can be attributed to this type: <ul><li>  HTML code of the page; </li><li>  Javascript / js files pages; </li><li>  CSS code / CSS files of the page; </li><li>  Images and other information (only in browsers that support the "data" protocol). </li></ul>  <b>2. From whom to hide?</b>  It‚Äôs reasonable to hide all this information from: <ul><li>  Antivirus (if it comes to iframe or other malicious scripts); </li><li>  other people (for example, if you wrote a wonderful javascript script and do not want someone to ‚Äúrip it off‚Äù to yourself). </li></ul>  <b>3. How can you be sure of hidden information security?</b> <b><br></b>  Sure can not be. <br>  Why?  Because all the information that the user loads is still performed by the browser.  This means that even if the information is encrypted / hidden in a very complex way, it will not mean that your code cannot be read.  Read it will be possible in any case, you can only make it difficult to read.  We will talk about these methods of difficulty. <br>  <b>4. How is the crypto / obfuscation process in principle?</b> <b><br></b>  There are two different stages: the creation of obfuscated / encrypted code and its decryption for normal execution by the browser.  We will generate the obfuscated code with the help of PHP scripts, although this can be done with the help of anything.  But decoding the execution of the code you need to write in JavaScript: in this case, the script, in fact, decrypts and executes itself. <br><br><img src="https://habrastorage.org/storage1/cc03ecf5/762c0a5c/dc8d62ad/facafd27.jpg"><h4>  JJEncode work </h4><br><h3>  Basic HTML / CSS Encryption </h3><br>  What if we need to encrypt HTML or CSS code?  It's simple: encrypt in JavaScript, and after decryption insert as HTML code. <br>  Insert example (no encryption / crypt / obfuscation): <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> var html = '</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">center</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> -</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">center</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'; //    "html" ,    document.getElementsByTagName('html')[0].innerHTML = html; //    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  We will do the same with CSS styles: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="xml"><span class="xml"> var css = 'body{margin:0px;}.subcl{padding:5px;}'; //    "css" ,    document.getElementsByTagName('html')[0].innerHTML = '</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">style</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"><span class="xml"><span class="undefined">'+css+'</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">style</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">'; //    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Now we will try to abstract from HTML and CSS and talk only about the essence - first, hide and then JavaScript encryption. <br>  Before anyone wants to see and decipher our code, he will try to find it.  Below you will find some effective methods of hiding the code from the eyes of curious users. <br><br><img src="https://habrastorage.org/storage1/ca54968a/20fb0938/56f1ee5a/9c355287.jpg"><h4>  Hide the word "] [akep" in the body of the document </h4><br><h3>  Replacing the attributes of the tag &lt;script&gt; </h3><br>  Everything is very simple, but this cannot be considered a good or even medium defense, as it is focused on the carelessness of users. <br>  The principle itself is utterly simple.  We have a page (‚Äúindex.html‚Äù) and a JavaScript file whose code we want to hide (‚Äúscript.js‚Äù).  On the page "index.html" we have indicated: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And now just create a folder "text", in which we put our script ("script.js") under the name "javascript" and swap attributes.  It will look like this: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  For the best effect, we will immediately divert the user's attention to the path.  For example: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://host.com/////////script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Tested on personal experience: works fine!  In this way, I myself wound the affiliate program on clicks, as I had to use a twist on JavaScript.  The administration of the affiliate program never saw him :). <br><br><h3>  Javascript handlers </h3><br>  This method is also not a universal means for hiding the JS-code, but still I will talk about it.  The main idea is to hide the code inside onLoad, onClick, etc. event handlers.  That is, approximately in the following constructions: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onLoad</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert(1);"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert(1);"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  For example, for the body and frameset tags there is an onLoad handler that will run the prescribed code in it after the page / frame is loaded. <br>  I note that not all objects handlers are the same. <br><br><h3>  Cookie, Referrer and Address </h3><br>  JavaScript can also be hidden in such non-standard places as a cookie (document.cookie), a referrer (document.referrer) and a page address (location.href).  In this case, the code will be stored as plain text, and executed using the eval () function, which takes the text as an argument and executes it as JavaScript code. <br>  As an example, we will accept the following assumption that we already have the following cookies: <br><br><pre> <code class="hljs ruby">cookievalue=<span class="hljs-params"><span class="hljs-params">||</span></span>alert(<span class="hljs-number"><span class="hljs-number">1</span></span>);<span class="hljs-params"><span class="hljs-params">||</span></span></code> </pre> <br>  Now execute this alert as follows: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">eval</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">unescape</span></span></span><span class="javascript">(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.cookie).split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"||"</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">]);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Here we take the text of all the cookie-records for our host and divide it into parts in places where there is a ‚Äú||‚Äù.  Then we take the second element ([1]) and run it through eval (). <br>  This method is not so bad, because the code that we want to execute is not visible on the page itself, and also because we can force the code to delete itself!  Example of implementation: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//    JavaScript- +   (  123) setcookie('cook', '||alert(1);document.cookie="cook=123";||'); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;script&gt; //    . eval(unescape(document.cookie).split('||')[1]); &lt;/script&gt;</span></span></code> </pre> <br>  Similarly, you can use other strings available via JavaScript, such as location.href and document.referrer. <br><br><h3>  Ajax code hiding </h3><br>  In this case, the code will be in a separate file, and its launch will be carried out by reading this file and executing its contents with the eval () function. <br>  We will need to create a page with hidden code, as well as a page with the function to run this code: <ol><li>  The page with the code that we want to hide (with the name "l"): <br><pre> <code class="javascript hljs">alert(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> </li><li>  Code calling page: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">x</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>)</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">try</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> XMLHttpRequest();}</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">catch</span></span></span><span class="javascript">(e){</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">try</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> ActiveXObject(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Msxml2.XMLHTTP'</span></span></span><span class="javascript">);}</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">catch</span></span></span><span class="javascript">(e){</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">try</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> ActiveXObject(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'Microsoft.XMLHTTP'</span></span></span><span class="javascript">);}</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">catch</span></span></span><span class="javascript">(e){</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">return</span></span></span><span class="javascript"> </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">;}}}};</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">y</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>)</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> z=x();</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(z){z.open(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'get'</span></span></span><span class="javascript">,</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'./l'</span></span></span><span class="javascript">);z.onreadystatechange=</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>)</span></span></span><span class="javascript">{</span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript">(z.readyState==</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">4</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">eval</span></span></span><span class="javascript">(z.responseText);}};z.send(</span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">null</span></span></span><span class="javascript">);}};y();</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </li></ol>  This method hides the code in a separate file (in our case "l").  Of course, you can find the path of the file and open it, but when obfuscating such a code, finding the file name is quite difficult. <br><br><h3>  Nullbyte attacks Opera </h3><br>  This method is simple and effective enough, but, unfortunately, it is designed only for the Opera browser.  The essence of the method is to put the so-called nullbyte before the hidden code (nullbyte or nullbyte is a character with the ASCII code ‚Äú0‚Äù).  What for?  Then, that Opera simply does not show the code in the built-in viewer after this symbol.  Example: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> - <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php">(chr(</span><span class="hljs-number"><span class="php"><span class="hljs-number">0</span></span></span><span class="php">)); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">alert(</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1</span></span></span><span class="actionscript">); </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/*     */</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In this example, first comes the normal code, which we do not need to hide.  Then, using PHP, we insert a null byte, and after it comes the hidden code. <br><br><h3>  Hiding in the HTML code and comments </h3><br>  The code can be easily hidden in HTML, then processed and executed.  For example, like this: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./pict.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">a</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"al"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"er"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">c</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"t(1);"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">a = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.body.innerHTML; </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">eval</span></span></span><span class="javascript">(a.split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'a="'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">].split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]+a.split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'b="'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">].split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]+a.split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">' c="'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">].split(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'"'</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]);</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In this case, we hid the code in the attributes of the img tag, and then processed the code of the entire page, collecting scattered pieces.  In the same way, you can hide text in HTML / JavaScript comments: <br><br><pre> <code class="hljs xml">  HTML: <span class="hljs-comment"><span class="hljs-comment">&lt;!-- alert(1); --&gt;</span></span>   JavaScript: // alert(1); /* alert(1); */</code> </pre> <br>  Separately, it is worth noting that it is very effective to hide the code inside popular frameworks - for example, jQuery, mooTools and the like.  These files are not suspicious, and their research will take a long time (although there is always the possibility of automatic comparison of the original and the modified file). <br>  Now, I think, we can talk about what the security expert sees, after all, and about what antiviruses are researching.  Below read about the most popular methods of encrypting and obfuscation of JS-code. <br><br><h3>  Substitution of standard JavaScript functions / methods </h3><br>  This method is intended to substitute its own variables instead of standard JavaScript functions or methods: <br><br><pre> <code class="html hljs xml"> : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"html"</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].innerHTML = </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"body"</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].length;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>  : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript">a=</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">;c=</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'getElementsByTagName'</span></span></span><span class="javascript">;a[c](</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"html"</span></span></span><span class="javascript">).innerHTML = a[c](</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"body"</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].innerHTML.length;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In this case, we replaced the ‚Äúdocument‚Äù object with the variable ‚Äúa‚Äù, and the getElementsByTagName method replaced the variable ‚Äúc‚Äù.  It should be noted that methods (what starts with a dot, for example, .length or .getElementsByTagName) can also be replaced by defining a key in an array (if we consider an object as an array).  If we have a document object, and there is a getElementsByTagName element in it, this means that we can call it in two ways: <br><ol><li> <code>document.getElementsByTagName</code> </li> <li> <code>document['getElementsByTagName']</code> </li> </ol>  From this it follows that in the second method we use string data (‚ÄúgetElementsByTagName‚Äù), therefore, they can be replaced with a variable containing a string - the name of the method. <br>  The substitution is useful in the case of frequent use of the same standard object / function / variable.  This greatly changes the code, and also compresses it. <br><br><h3>  Flood comments and code </h3><br>  This method is designed to insert in obfusciable code flood, that is, something that does not carry the semantic load for the script code.  Flood can be both code and comments: <br><br><pre> <code class="html hljs xml"> : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* pOIEPGpmkG13Pg */</span></span></span><span class="actionscript"> a </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* PGpmkG13Pggweg */</span></span></span><span class="actionscript"> = </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* mkG13Pg */</span></span></span><span class="actionscript"> </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'hahaha'</span></span></span><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* pOIE13Pg */</span></span></span><span class="actionscript"> ; </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* wegEGoh */</span></span></span><span class="actionscript"> alert </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* oiwboierhper */</span></span></span><span class="actionscript"> ( </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* igwepreorh */</span></span></span><span class="actionscript"> a </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* wbnponrhR */</span></span></span><span class="actionscript"> ) </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* inboierh */</span></span></span><span class="actionscript"> ; </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">/* roinero */</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span>  : <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> weoibog = </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'gwrobgoerh'</span></span></span><span class="actionscript">; a = </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'hahaha'</span></span></span><span class="actionscript">; bfionb = </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'wgeogioweg'</span></span></span><span class="actionscript">; alert(a);</span></span></code> </pre> <br>  In this case, the flood comments are too dense, although in fact the code was very simple: ‚Äú <code>a = "hahaha"; alert(a);</code> <code>a = "hahaha"; alert(a);</code>  ". <br>  Flood code can also interfere with flooding comments.  If you wish, you can write a PHP function to add flooding to the JavaScript code.  Personally, I took some article from an English blog, parsed words, and the function added a random number of these words in the comments. <br>  By the way, it is also desirable to use multi-line comments in the form of a ‚Äúfake close‚Äù: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*/ alert(1); /*/</span></span> alert(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*/ alert(3); /*/</span></span></code> </pre> <br>  Which number will show the alert?  :) <br><br><img src="https://habrastorage.org/storage1/4c0918cc/99e24a70/a2342744/afa84912.jpg"><h4>  Obfuscated Alert Job </h4><br><h3>  Replacing text with hexadecimal codes </h3><br>  I wanted to refer to this paragraph and some other ways to convert the text, but left only this one, since this is the only encryption method that does not require help functions to decrypt: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> alert(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"\x63\x6F\x6F\x6B\x69\x65"</span></span></span><span class="javascript">]); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  In this case, we firstly used the internal variable ‚Äúcookie‚Äù of the ‚Äúdocument‚Äù object as an element of the array.  Secondly, we translated its name in hexadecimal format.  If we used the cookie variable through a dot, that is, as document.cookie, we would not be able to translate the call to it in hexadecimal format, since this applies only to strings (in the array, the key is a string), and in document. no cookie strings. <br>  PHP translation function in hexadecimal format: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cescape</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (str_split($s,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $sym) { $d = dechex(ord($sym)); $c[] = (strlen($d) == <span class="hljs-number"><span class="hljs-number">1</span></span>) ? <span class="hljs-string"><span class="hljs-string">'0'</span></span>.$d : $d; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span>.<span class="hljs-string"><span class="hljs-string">'\\'</span></span>.implode(<span class="hljs-string"><span class="hljs-string">''</span></span>.<span class="hljs-string"><span class="hljs-string">'\\'</span></span>,$c)); } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><h3>  The trick with non-existent features </h3><br>  As we already know from the above, in JavaScript, you can call methods as elements of the object: document.getElementById and document ['getElementById'].  Both options are actually the same, the only difference is in the record - in the second version we use the string. <br>  One evening I came up with a very interesting way to get these lines.  For example, we need to encrypt the above-mentioned ‚ÄúgetElementById‚Äù.  Let us take a look at a short explanation of this method using the following example: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> a = b(c(d())); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This script will not work because the b, c, and d functions have not been previously declared.  Now we will try to make this code work, for this we will use the sandbox of the try {} catch () {} structure: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">try</span></span></span><span class="actionscript">{a = b(c(d()))}</span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">catch</span></span></span><span class="actionscript">(e){alert(e);} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  After the launch, we will see an error, which means that, although the code is not working, it did not stop the execution of the remaining correct part. <br>  And now we ask ourselves how such a scheme can be associated with the encryption of the string ‚ÄúgetElementById‚Äù?  That's how: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">try</span></span></span><span class="actionscript">{(getE(leme(ntB(yId()))))}</span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">catch</span></span></span><span class="actionscript">(e){x = (e+</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">''</span></span></span><span class="actionscript">).split(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'('</span></span></span><span class="actionscript">).slice(</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1</span></span></span><span class="actionscript">,</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">5</span></span></span><span class="actionscript">).join(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">''</span></span></span><span class="actionscript">);}</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  After executing this code, we get the string ‚ÄúgetElementById‚Äù contained in the variable ‚Äúx‚Äù. <br>  What is the salt of this method?  The fact that the heuristic analysis of antiviruses when finding functions will swear that they do not exist.  Thus, we obfuscate the code not at the level of encryption of strings in different ways, but at the level of receiving data strings from JavaScript itself. <br><br><h3>  Numbers using the operator "~" </h3><br>  The operator "~" (tilde) is a bit negative and is used like this: "alert (~ 13);".  This code will bring us "-14".  This operator works by the principle ‚Äú- (number + 1)‚Äù. <br>  Imagine that we want to assign a number to a variable, and nowhere to write this number: ‚Äúa = ~ []‚Äù; <br>  This code will assign the number ‚Äú-1‚Äù to the variable ‚Äúa‚Äù.  Why?  Because the array is a neutral element with a numeric value of "0", therefore, ~ 0 is equivalent to "- (0 + 1)", that is -1. <br>  Examples of other transformations: <br><br><pre> <code class="javascript hljs">a = ~[]; <span class="hljs-comment"><span class="hljs-comment">// -1 a = -~[]; // 1 a = []^[]; // 0 a = ~~[]; // 0 a = ~true; // -2 a = ~false; // -1 a = -~[]*(""+-~[]+-~-~-~-~-~[]+-~-~true); // 153</span></span></code> </pre> <br><h3>  Letters and strings without string data </h3><br>  Sometimes you want to get a letter / character or some text without writing it explicitly.  One JavaScript feature allows you to do this.  In this language, there are various internal system messages that can be converted to text, and then this text processed. <br>  For example, imagine that we need to get the text ‚Äúcode‚Äù.  This string is contained in the names of methods such as charCodeAt (), fromCharCode (), and others.  You can get the text as follows: <br><br><pre> <code class="javascript hljs">a = (alert+<span class="hljs-string"><span class="hljs-string">''</span></span>).split(<span class="hljs-string"><span class="hljs-string">"ive "</span></span>)[<span class="hljs-number"><span class="hljs-number">1</span></span>].substr(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>);</code> </pre> <br>  In this example, the variable "a" will contain the text "code".  We will analyze in more detail.  Try to execute the following code: "alert (alert +"); ".  You will see something like "function alert () {[native code]}".  Thus, using only the alert () function twice, we got completely different characters. <br>  Now we will try to understand how this all works.  Imagine that every object, function, and everything else in JavaScript has a certain ‚Äúdescription‚Äù.  To access it, you need to explicitly change the type of this object or function to a string, attaching, for example, an empty string (+ ""). <br><br><h3>  String encryption </h3><br>  There are several useful functions for encrypting / decrypting strings in JavaScript.  Let us examine some of them: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">escape</span></span>(); <span class="hljs-comment"><span class="hljs-comment">//    URL unescape(); //  URL- encodeURI(); //    URI decodeURI(); //  URI-</span></span></code> </pre> <br>  There are also two String object methods that work with converting a character to ASCII code and vice versa: <br><br><pre> <code class="javascript hljs">a = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(<span class="hljs-number"><span class="hljs-number">97</span></span>); b = <span class="hljs-string"><span class="hljs-string">"b"</span></span>.charCodeAt();</code> </pre> <br>  It should be noted that strings can also be converted with regular expressions in combination with the .match and .replace methods.  Other methods can be attributed, rather, to search by string. <br><br><h3>  Object / Variable Conversion </h3><br>  The names of objects and variables can also be converted to a string (for example, in order to encrypt this string later).  Conversion takes place on the same principle as the conversion of method names, that is, by moving from the form ‚Äú.method‚Äù to the form ‚Äú[method]‚Äù.  For the correct conversion, you need to find an element that is even higher in the object hierarchy and that has the word ‚Äúdocument‚Äù inside it.  His name is this.  According to JavaScript standards, this is not an object, but an operator that returns a reference to an object.  As a result, we can now safely use getElementById as follows: ‚Äúthis [‚Äú document ‚Äù] [‚Äú getElementById ‚Äù]‚Äù. <br><br><h3>  Code binding </h3><br>  Sometimes it is necessary to write code so that it is executed only after certain conditions are met.  For example, we created JavaScript code and want to sell it, but we want to sell it with a domain binding so that it cannot be run on other sites. <br>  I repeat: no absolute protection can be invented in principle, there are only some ways that make the copying / decoupling difficult. <br>  Here are several types of such bindings + the data on which they depend: <ul><li>  binding to the domain // location.href.split ('/') [2]; </li><li>  binding to parameters (transferred to the page after #?) // location.href.split ('#') [1] or location.href.split ('?'). slice (1); </li><li>  binding to date // a = new Date (); </li><li>  binding to javascript code //; </li><li>  binding to the code of the entire page // a = document.getElementsByTagName ('html') [0] .innerHTML; </li><li>  browser binding // a = navigator.userAgent; </li><li>  linking to cookies // document.cookie; </li><li>  any other bindings you can think of. </li></ul><h3>  Avoiding Suspicious Functions </h3><br>  I also advise you to avoid using eval (), document.write (), and others explicitly.  When searching for a real code, people often use the alert () substitution method instead of these functions, since after that the code can be read the way we began to encrypt it, therefore, the whole point of obfuscation disappears.  How to execute the code without using the eval () function? <br>  Recall the fact that at the head of everything is the operator this.  Using it, the eval () function can be turned into this code: <br><br><pre> <code class="javascript hljs">a = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">"\x65\x76\x61\x6C"</span></span>];</code> </pre> <br>  After this conversion, we can safely use ‚Äúa ()‚Äù instead of ‚Äúeval ()‚Äù. <br><br><h3>  Change to unreadable lines </h3><br>  In the obfuscated code, the following symbols and their combinations should be used to denote identifiers: <ol><li> <code>"o", "O", "0"</code> </li> <li> <code>"i", "I", "l", "1"</code> </li> <li>  <code>"_"</code> (and options <code>"__"</code> , <code>"___"</code> ...) </li><li>  <code>"$"</code> (and options <code>"$$"</code> , <code>"$$$"</code> ...) </li></ol>  After using these characters, the code becomes extremely difficult to read, especially if you squeeze it, removing extra spaces and line breaks. <br><br><h3>  Code encryption </h3><br>  There are an unlimited number of ways to encrypt text, although they are all based on the use of any text / numeric functions.  The construction often works: eval () + decryption function () + encrypted_string.  I will try to show one of such methods without any extra water. <br>  Suppose we need to encrypt the string "alert (1);".  It occurred to me to take two characters from it, translate them into numbers (ASCII code), read them and put the first character next to it in a clean (without translation) form.  Only it is worth considering that, dividing the code into such two-letter parts, we get the code about 2-2.5 times the original, and we must not forget that it is better to somehow divide such blocks (as an element of an array or through a separator).  For the separator, we take the ‚Äú%‚Äù sign, since it makes the encrypted string look like a URL string.  Let's write a simple PHP script: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $a = <span class="hljs-string"><span class="hljs-string">"alert(1);"</span></span>; $a = str_split($a, <span class="hljs-number"><span class="hljs-number">2</span></span>); $e = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($a <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $v) { $e .= <span class="hljs-string"><span class="hljs-string">'%'</span></span> . $v[<span class="hljs-number"><span class="hljs-number">0</span></span>] . (ord($v[<span class="hljs-number"><span class="hljs-number">0</span></span>])+ord($v[<span class="hljs-number"><span class="hljs-number">1</span></span>])); } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span>($e); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  This is what we got: " <code>%a205%e215%t156%190%;59</code> ". <br>  And now we will write the code interpreter of this code in JavaScript: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">d</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function">) </span></span>{ s = s.split(<span class="hljs-string"><span class="hljs-string">'%'</span></span>).slice(<span class="hljs-number"><span class="hljs-number">1</span></span>); c = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; s.length; i++) { c += s[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(s.substr(<span class="hljs-number"><span class="hljs-number">1</span></span>)-s[<span class="hljs-number"><span class="hljs-number">0</span></span>].charCodeAt()); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre> <br>  Calling the code in this case will look like this: "eval (d ('% a205% e215% t156% 190%; 59'));". <br><br>  Now it only remains to obfuscate the whole of this script.  We will not use all the methods described, but will only touch on some of them: <br><br><pre> <code class="javascript hljs">z = <span class="hljs-string"><span class="hljs-string">'73706C697421736C696365216C656E6774682166726F6D43686172436F6465217375627374722163686172436F64654174'</span></span>; _=<span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(__=<span class="hljs-number"><span class="hljs-number">0</span></span>;__&lt;z.length/<span class="hljs-number"><span class="hljs-number">2</span></span>;__++){_+=<span class="hljs-built_in"><span class="hljs-built_in">unescape</span></span>(<span class="hljs-string"><span class="hljs-string">'%'</span></span>+z[__*<span class="hljs-number"><span class="hljs-number">2</span></span>]+z[__*<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>]);} _=_[_[<span class="hljs-number"><span class="hljs-number">0</span></span>]+_[<span class="hljs-number"><span class="hljs-number">1</span></span>]+_[<span class="hljs-number"><span class="hljs-number">2</span></span>]+_[<span class="hljs-number"><span class="hljs-number">3</span></span>]+_[<span class="hljs-number"><span class="hljs-number">4</span></span>]](<span class="hljs-string"><span class="hljs-string">'!'</span></span>);<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">___</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">__</span></span></span><span class="hljs-function">)</span></span>{__ = __[_[<span class="hljs-number"><span class="hljs-number">0</span></span>]](<span class="hljs-string"><span class="hljs-string">'\x25'</span></span>)[_[<span class="hljs-number"><span class="hljs-number">1</span></span>]](-~[]); _I=<span class="hljs-string"><span class="hljs-string">''</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (_l=<span class="hljs-number"><span class="hljs-number">0</span></span>;_l&lt;__[_[<span class="hljs-number"><span class="hljs-number">2</span></span>]];_l++){_I+=__[_l][<span class="hljs-number"><span class="hljs-number">0</span></span>]+<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>[_[<span class="hljs-number"><span class="hljs-number">3</span></span>]](__[_l][_[<span class="hljs-number"><span class="hljs-number">4</span></span>]](<span class="hljs-number"><span class="hljs-number">1</span></span>)-__[_l][<span class="hljs-number"><span class="hljs-number">0</span></span>][_[<span class="hljs-number"><span class="hljs-number">5</span></span>]]());}<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _I;} <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">'\x65\x76\x61\x6C'</span></span>](___(<span class="hljs-string"><span class="hljs-string">'%a205%e215%t156%190%;59'</span></span>));</code> </pre> <br>  Let us take a closer look at the process of how this seemingly unreadable code works: <ol><li>  <code>z = '....'</code> Here the variable is assigned the text that was obtained by translating the string split! slice! length! fromCharCode! substr! charCodeAt into hexadecimal form (\ x73 \ x70 \ x6C \ x69 \ x74 ...) without "\ x "; </li><li>  <code>_='';for(...}</code> Here we translate split! slice! length! fromCharCode! substr! charCodeAt into the variable "_"; </li><li> <code>_=_...('!');</code>  We divide the line in those places where there is a symbol "!"; </li><li>  <code>function ___(__){...}</code> The d () function described above is obfuscated; </li><li> <code>this['\x65\x76\x61\x6C'](....);</code>  Decode line and run code. </li></ol><h3>  At last </h3><br>  Well, let's summarize.  With a combination of all these methods, you can be 100% sure that a simple or even average user will not be able to read or copy your code to yourself.  But since computer security experts are well aware of most of these tricks, and also because I post this information for everyone to see, I can assume that these methods will become more popular and well-known.  I hope you can use the information provided for good purposes. <br><br><img src="http://habrastorage.org/storage1/e3946c5b/66b3106b/576522bb/6c4da6ce.jpg"><h4>  Making the script readable </h4><br><br><img src="http://habr.habrastorage.org/post_images/b7f/72e/a7f/b7f72ea7fa4cd764bcff301000c3d144.jpg" alt="image"><br>  <i>Hacker Magazine, <a href="http://www.xakep.ru/articles/magazine/default.asp">September (09) 152</a></i> <i><br></i>  <i>| qbz |</i>  <i>(lopuxin.iv@yandex.ru, <a href="http://essenzo.net/">http://essenzo.net</a> )</i> . <br><br>  Subscribe to "Hacker" <br><ul><li>  <a href="http://bit.ly/habr_subscribe_paper">1 999 .</a>  <a href="http://bit.ly/habr_subscribe_paper">for 12 numbers of paper version</a> </li><li>  <a href="http://bit.ly/digital_xakep">1249r.</a>  <a href="http://bit.ly/digital_xakep">for an annual subscription to iOS / iPad (Android'a release soon!)</a> </li><li>  <a href="http://bit.ly/habr_android">"Hacker" on Android</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/128741/">https://habr.com/ru/post/128741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128733/index.html">Budget Nettop as HTPC</a></li>
<li><a href="../128734/index.html">ARM Microcontrollers STM32F. Quick start with STM32-Discovery</a></li>
<li><a href="../128736/index.html">Helping about .SUshiki</a></li>
<li><a href="../128737/index.html">The problem of 3D particles in After Effects</a></li>
<li><a href="../128740/index.html">The peculiarity of working with smart points in Qt</a></li>
<li><a href="../128742/index.html">VPN over L2TP: error 678 - one small registry key</a></li>
<li><a href="../128744/index.html">Gamers in Fold.it solved a scientific problem</a></li>
<li><a href="../128745/index.html">OOP Packet Performance in Perl</a></li>
<li><a href="../128746/index.html">Page layout rel = "next | prev"</a></li>
<li><a href="../128747/index.html">Programming Windows Phone 7. Lecture 2. Orientation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>