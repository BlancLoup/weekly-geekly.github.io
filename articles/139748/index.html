<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analogue of the Step Pattern and Asynchronous Call Nesting</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When implementing a model for manipulating data in MongoDB, I came to the conclusion that you need to somehow avoid problems with asynchronous nesting...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analogue of the Step Pattern and Asynchronous Call Nesting</h1><div class="post__text post__text-html js-mediator-article">  When implementing a model for manipulating data in MongoDB, I came to the conclusion that you need to somehow avoid problems with asynchronous nesting.  I did not know about the existence of Step for Node.js and decided to create my own bike.  What I would like to share with you, dear Habro users. <br><a name="habracut"></a><br><br><h5>  Introduction </h5><br><br>  In order to solve the problem of calls and the further transfer of information to the next call in the queue, the AQueue module (implementation of a sequential queue of asynchronous calls) was born.  In the implementation of this module, lies the principle applied in the implementation of the intermediate routing layer in Express.js (for example, to test the accessibility of a particular view).  This mechanism is implemented by calling a callback function called next () with passing it the necessary parameters. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And so let's get started! <br><br><h5>  Implementation </h5><br><br>  For queuing, an array was selected in which the functions are written, in the sequence in which they will be called. <br><ul><li>  The <b>AddTo</b> function - adds the next function to the queue. </li><li>  The function <b>next</b> - allows you to call the next in order function. </li><li>  Function <b>completed</b> - called upon successful completion, or when the err parameter is not null </li><li>  The <b>run</b> function starts the call mechanism in turn. </li><li>  The <b>q</b> property is used to store functions in an array. </li><li>  The <b>cb</b> property is used to store call completion function. </li></ul><br><br><blockquote><ol><li>  <font color="#003366">function</font> AQueue <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#003366">var</font> that <font color="#339933">=</font> <font color="#000066">this</font> <font color="#339933">;</font> </li><li>  that.  <font color="#660066">q</font> <font color="#339933">=</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  that.  <font color="#660066">cb</font> <font color="#339933">=</font> <font color="#003366">null</font> <font color="#339933">;</font> </li><li></li><li>  that.  <font color="#660066">addTo</font> <font color="#339933">=</font> <font color="#003366">function</font> <font color="#009900">(</font> f <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  that.  <font color="#660066">q</font> .  <font color="#660066">push</font> <font color="#009900">(</font> f <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000066">return</font> that <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#339933">;</font> </li><li></li><li>  that.  <font color="#660066">next</font> <font color="#339933">=</font> <font color="#003366">function</font> <font color="#009900">(</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000066">if</font> <font color="#009900">(</font> that. <font color="#660066">q</font> . <font color="#660066">length</font> <font color="#339933">&gt;</font> <font color="#CC0000">0</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#003366">var</font> f <font color="#339933">=</font> that.  <font color="#660066">q</font> .  <font color="#660066">shift</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000066">if</font> <font color="#009900">(</font> err <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  that.  <font color="#660066">q</font> <font color="#339933">=</font> <font color="#009900">[</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  that.  <font color="#660066">cb</font> <font color="#009900">(</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#000066">else</font> <font color="#009900">{</font> </li><li>  f <font color="#009900">(</font> that. <font color="#660066">next</font> <font color="#339933">,</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> <font color="#000066">else</font> <font color="#009900">{</font> </li><li>  that.  <font color="#660066">cb</font> <font color="#009900">(</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> <font color="#339933">;</font> </li><li></li><li>  that.  <font color="#660066">completed</font> <font color="#339933">=</font> <font color="#003366">function</font> <font color="#009900">(</font> cb <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  that.  <font color="#660066">cb</font> <font color="#339933">=</font> cb <font color="#339933">;</font> </li><li>  <font color="#000066">return</font> that <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#339933">;</font> </li><li></li><li>  that.  <font color="#660066">run</font> <font color="#339933">=</font> <font color="#003366">function</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#000066">return</font> that.  <font color="#660066">next</font> <font color="#009900">(</font> <font color="#003366">null</font> <font color="#339933">,</font> <font color="#003366">null</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  exports.  <font color="#660066">AQueue</font> <font color="#339933">=</font> AQueue <font color="#339933">;</font> </li><li></li></ol></blockquote><br><br><h5>  Using </h5><br><br>  Below is an example of using the AQueue module. <br><br><blockquote><ol><li>  <font color="#003366">var</font> AQueue <font color="#339933">=</font> reqiure <font color="#009900">(</font> <font color="#3366CC">'aqueue'</font> <font color="#009900">)</font> .  <font color="#660066">AQueue</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#003366">var</font> aq <font color="#339933">=</font> <font color="#003366">new</font> AQueue <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  aq.  <font color="#660066">addTo</font> <font color="#009900">(</font> <font color="#003366">function</font> <font color="#009900">(</font> next <font color="#339933">,</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#006600">// make the necessary actions</font> </li><li>  next <font color="#009900">(</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#009900">)</font> .  <font color="#660066">addTo</font> <font color="#009900">(</font> <font color="#003366">function</font> <font color="#009900">(</font> next <font color="#339933">,</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#006600">// perform additional actions</font> </li><li>  <font color="#006600">// you can combine data by wrapping it in an object</font> </li><li>  next <font color="#009900">(</font> err <font color="#339933">,</font> <font color="#009900">{</font> data <font color="#339933">:</font> data <font color="#339933">,</font> checked <font color="#339933">:</font> <font color="#003366">true</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> <font color="#009900">)</font> .  <font color="#660066">completed</font> <font color="#009900">(</font> <font color="#003366">function</font> <font color="#009900">(</font> err <font color="#339933">,</font> data <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#006600">// perform final actions.</font> </li><li>  <font color="#009900">}</font> <font color="#009900">)</font> .  <font color="#660066">run</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote></div><p>Source: <a href="https://habr.com/ru/post/139748/">https://habr.com/ru/post/139748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139741/index.html">Writing a Japanese crossword service on gae, backbone, underscore, require and also knows what the hell</a></li>
<li><a href="../139742/index.html">Analysis of Facebook accounts of popular mobile game developers</a></li>
<li><a href="../139743/index.html">Synology Announces the Official Release of DiskStation Manager 4.0</a></li>
<li><a href="../139744/index.html">Farminers Project Academy presents its projects on the first Co-Investment Day</a></li>
<li><a href="../139746/index.html">Presentation of multi-line data in javascript and user scripts</a></li>
<li><a href="../139750/index.html">Virtual girl takes money from users of mobile devices based on Android</a></li>
<li><a href="../139751/index.html">Experience using a 3600 mAh battery for the HTC Sensation smartphone</a></li>
<li><a href="../139752/index.html">If you still think whether to do business on the Internet or not</a></li>
<li><a href="../139753/index.html">We hang the server through PHP</a></li>
<li><a href="../139755/index.html">Recursive Functions - Creating Your Own Mathematics (Scala)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>