<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ghosts in ROM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An old computer sometimes keeps completely unexpected secrets. The guys from the NYResistor site published the story of how they heroically rebuilt se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ghosts in ROM</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/bc4/a51/61f/bc4a5161f1191bbe74d5ae92af13b450.png"><br><br>  An old computer sometimes keeps completely unexpected secrets.  The guys from the NYResistor site published the <a href="http://www.nycresistor.com/2012/08/21/ghosts-in-the-rom/">story of</a> how they heroically rebuilt several digital photographs from the flash memory of the prehistoric Macintosh SE computer, which was lying on the side of the road in Brooklyn.  They called the unknown people in these images ‚Äúghosts in ROM‚Äù. <br><a name="habracut"></a><br>  Found on the side of the road, the Macintosh SE was loaded onto a bicycle trunk and brought home. <br><br><img src="https://habrastorage.org/storage2/16c/3b1/8eb/16c3b18eb085e3e4ef33f9dad5eba2c6.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The computer booted, but did not contain any storage media.  However, the researchers decided to take up digital archeology.  They removed two ROM chips from the motherboard and <a href="http://bitbucket.org/hudson/prom/">dumped them</a> using the <a href="http://bitbucket.org/hudson/prom/">PROMdate</a> device. <br><br><img src="https://habrastorage.org/storage2/729/868/af1/729868af1b258535bf0788f758f3c9c6.jpg"><br><br>  ROM chips are similar to M27C512 PROM programmable flash memory chips, but only here they are not programmable, so there is no corresponding contact, and the ROM address space is increased to 128 KB, compared to the usual 64 KB in a programmable M27C512. <br><br>  The computer runs on a 16-bit bus, and each of the two 8-bit chips contains half a word, so that together they merge into a single 256-kilobyte binary file.  The dumping and merging operation was successful: the search for <code>strings</code> produced a readable text like ‚ÄúChicago‚Äú, ‚ÄúPACK‚Äù and ‚ÄúCDEF‚Äù.  If the bytes after the merge were in the wrong order, it would be something like APKC instead of PACK. <br><br>  The researchers decided to try to find the same <a href="http://www.eeggs.com/items/2258.html">Easter egg</a> with secret photos of the creators of Apple, although no one has yet been able to extract these digital files. <br><br>  Instructions for the Easter egg states that the images are hidden starting at address 0x41D89A.  The researchers were able to boot from the historical ROM in the <a href="http://minivmac.sourceforge.net/">Mini vMac</a> emulator and confirm that there is something there.  But they wanted to remove specific photos and search for other secrets that may be hiding in the ROM. <br><br>  The binary ROM file was converted to ELF format and studied a fragment in the region of 0x41D89A. <br><br><blockquote><pre>  41d89a: 4eba 0018 jsr% pc @ (41d8b4 &lt;rom + 0x1d8b4&gt;)
   41d89e: 5847 addqw # 4,% d7
   41d8a0: 0287 0000 000c andil # 12,% d7
   41d8a6: 6100 002e bsrw 41d8d6 &lt;rom + 0x1d8d6&gt;
   41d8aa: 307c 00b5 moveaw # 181,% a0
   41d8ae: a03b 0120073
   41d8b0: 4efa ffec jmp% pc @ (41d89e &lt;rom + 0x1d89e&gt;) </pre></blockquote><br>  Instruction 0xa03b clearly looks suspicious, because Motorola has reserved all instructions on 0xA for the Motorola 68000 processor. Here comes the <a href="http://www.mac.linux-m68k.org/devel/macalmanac.php">list of instructions</a> for the Motorola 68000, from which it is clear that a03b corresponds to <code>_Delay</code> with an indication of the delay value in <code>%a0</code> .  That is, this function can be translated into C like this: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">easter_egg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span></span><span class="hljs-function">)</span></span> { func_41d8b4(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { d7 = (d7 + <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xC</span></span>; func_0x41d8d6(); _Delay(<span class="hljs-number"><span class="hljs-number">181</span></span>); } }</code> </pre> <br>  This function refers to 0x41d8b4: <br><br><blockquote><pre>  41d8b4: 31fc ffff 0b9e movew # -1, b9e
   41d8ba: 594f subqw # 4,% sp
   41d8bc: 2f3c 6262 6d63 movel # 1650617699,% sp @ -
   41d8c2: 4267 clrw% sp @ -
   41d8c4: a9a0 0124640
   41d8c6: 201f movel% sp @ +,% d0
   41d8c8: 6700 0050 beqw 41d91a &lt;rom + 0x1d91a&gt;
   41d8cc: 2040 moveal% d0,% a0
   41d8ce: 21d0 0a78 movel% a0 @, a78
   41d8d2: 7e00 moveq # 0,% d7
   41d8d4: 4e75 rts
 ...
   41d91a: a9ff 0124777 </pre></blockquote><br>  There is a link to <code>_GetResource</code> (0x62626d63) and the execution of the program clearly begins.  After considerable work on reverse engineering, the specialists were still able to restore the structure and detect the data in the <a href="http://en.wikipedia.org/wiki/PackBits">PackBits</a> format.  Applying the PackBits unpacking utility, as well as the hex2png utility, these bits were arranged in rows of 536 pixels ‚Äî and people's faces appeared on the screen for the first time. <br><br>  Four photos of unknown Apple employees dated in ROM are dated November 20, 1986. <br><br><img src="https://habrastorage.org/storage2/3e9/805/9d2/3e98059d2c03367401a720911ff658a3.png"><br><br><img src="https://habrastorage.org/storage2/3f4/d4e/39c/3f4d4e39cc557456c2df22c472b8940e.png"><br><br><img src="https://habrastorage.org/storage2/ea6/9bc/502/ea69bc502a7efb7ec0cf676a3c01b0c3.png"><br><br><img src="https://habrastorage.org/storage2/30d/1e0/fd3/30d1e0fd30422ef6c9899c00cf2b7dac.png"><br><br>  NYResistor hackers are asked to report if someone found out these people from a photo 25 years ago to solve the puzzle to the end. <br><br>  By the way, another fifth data area was found in ROM, but so far it has not been able to decrypt it.  Perhaps this is an audio recording. </div><p>Source: <a href="https://habr.com/ru/post/150208/">https://habr.com/ru/post/150208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150203/index.html">My view on Scrum</a></li>
<li><a href="../150204/index.html">Solving the problem of installing Cloud9 ide on Ubuntu 12.04</a></li>
<li><a href="../150205/index.html">Recoding video from Intel Quick Sync Video - do it quickly</a></li>
<li><a href="../150206/index.html">Bypassing the proactive protection of Kaspersky Lab products. Video demonstration</a></li>
<li><a href="../150207/index.html">Recommender systems: Bayes theorem and naive Bayes classifier</a></li>
<li><a href="../150209/index.html">How to make friends with Truecrypt loader and Grub 2?</a></li>
<li><a href="../150210/index.html">Compiling packages</a></li>
<li><a href="../150211/index.html">‚Ç¨ 3,000 received by ReactOS from an unknown donor</a></li>
<li><a href="../150212/index.html">Tent: decentralized social web</a></li>
<li><a href="../150213/index.html">Imax B6 - Universal charging harvester</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>