<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Linking the Digital Lab NR05 to the Internet of Things</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this material, we will show how to assemble a device based on the Digital Lab NR05 , which collects data from a temperature sensor and sends it to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Linking the Digital Lab NR05 to the Internet of Things</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/90b/243/f5d/90b243f5d2404b3eb90781ec7c8db602.jpg"><br><br>  In this material, we will show how to assemble a device based on <a href="http://masterkit.ru/shop/studygoods/2016109">the Digital Lab NR05</a> , which collects data from a temperature sensor and sends it to a specialized site for storing and processing such data. <br><br>  As we have repeatedly noted, the Digital Lab kit from the Alphabet of the Electronic Engineer series is intended not only for teaching the beginnings of programming microcontrollers and designing electronic devices based on them, but also for creating completely complete and useful devices.  In our project, we will use ThingSpeak - an open platform for projects built on the ‚ÄúInternet of Things‚Äù concept.  The platform is designed to collect and process data from various sensors.  The main features of ThingSpeak are: <br>  - data collection in real time; <br>  - mathematical and statistical data processing; <br>  - data visualization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The ThingSpeak platform has an advanced API (Application Programming Interface) - an interface between the site and your applications, which allows you not only to send, store and access data, but also provides various statistical methods for processing it.  We consider, for example, one channel for data collection, the whole platform provides up to 8 channels to each user.  With the data of each channel, you can perform individual actions and use the results obtained at your discretion. <br><a name="habracut"></a><br>  To access the Internet, we will use a Wi-Fi module based on an ESP8266 chip with AT firmware <a href="">version 0.21</a> .  This popular chip serves as the basis for building a large number of modules that physically differ in the number of pins, antenna type, USB interface and additional features.  In principle, any device assembled on the basis of the ESP8266 is a self-contained device to which external sensors can be connected, but this is a matter for separate consideration.  In this case, we use the module only as a device for wireless Internet access, and we will use it to connect to any access point and transmit data to ThingSpeak.  A list of all AT commands of the firmware for comparison with the program for Arduino can be found <a href="http://esp8266.ru/esp8266-at-commands-v021/">here</a> . <br><br>  A few words should be said about how to check the firmware version and how to reflash the module if the version is not suitable.  To do this, you need to connect the module to a USB-UART adapter, for example, the <a href="http://masterkit.ru/shop/laboratory/interface-converters/1313485">BM8051</a> , and issue the AT + GMR command.  If the firmware version is displayed as 0021, then everything is in order.  If not, then there are two ways: change the program for Arduino in accordance with possible mismatches in command formats, or reflash the module.  ESP8266 flashing questions claim to be a separate article, so here we will not consider them, but we advise you to refer to the materials published on the websites and specialized forums devoted to this module.  As a temperature sensor, we use the DS18B20 sensor included in the NR05 kit.  The training kit contains a chapter on how to connect and use this sensor, as well as programming examples for reading and displaying temperature measurements.  The sensor is connected to the correspondingly marked contacts on the NR05 expansion card. <br><br>  As a module based on the ESP8266, you can use several devices from the Master Kit product range: <a href="http://masterkit.ru/shop/arduino/shields/1917472">MP8266-01</a> , <a href="http://masterkit.ru/shop/arduino/shields/1919084">MP8266-03</a> , <a href="http://masterkit.ru/shop/arduino/shields/1919085">MP8266-07</a> , <a href="http://masterkit.ru/shop/arduino/shields/1930954">MP8266-12E</a> , and <a href="http://masterkit.ru/shop/arduino/modules/1922604">MP3508</a> .  The last device is a developer's fee and is ‚Äústuffed‚Äù to the maximum.  It does not require an additional 3.3V stabilizer and a USB-UART adapter for programming - all this is already on the board. <br><br>  For other modules, a USB-UART adapter may be required for flashing, if necessary, but a 3.3V stabilizer (for example AMS1117) will be needed precisely because the source of this voltage in the Arduino Nano board, included in the NR05 kit, does not provide the current required for power supply ESP8266. <br><br>  In any case, in the finished project, we use only four ESP outputs: power, ground, and RX and TX to communicate with Arduino. <br><br>  The general algorithm of the program for Arduino is as follows: <br>  - we check the readiness of ESP; <br>  - if ready, connect to the access point; <br><br>  (further actions are repeated once per minute): <br>  - read data from the temperature sensor; <br>  - display the current temperature on the expansion board indicator; <br>  - establish a connection with the site thingspeak.com; <br>  - we transfer the current temperature to the corresponding channel of the site. <br><br>  About theory, perhaps, enough.  Let's go to practice. <br><br>  To begin with, we register for free on thingspepeak.com and as a result of registering an API key that must be used when transferring data to the channel.  The site interface is changing, so our description may be a little inconsistent in part of what is visible in the browser.  But in general, the interface is intuitive, so there should not be any serious problems when registering and creating a new channel. <br>  So, after registering, create a new channel: Channels-My Channels-New Channel.  You need to give the channel a name and enter a short description, the channel can also be Private and Public, choose it yourself.  After creating the channel, you can see the desired API key, we need a Write API Key to write data to the channel. <br><br>  You can test the data record by typing the following line in the browser row: <a href="http://api.thingspeak.com/update%3Fkey%3D%25D0%25B2%25D0%25B0%25D1%2588API%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%26field1%3D0">api.thingspeak.com/update?key= your API key&amp;field1=0</a> <br>  The last character in the string (0) can be any value, and it will be written to the channel.  After pressing Enter, the site will respond with a digit corresponding to the number of values ‚Äã‚Äãwritten to the channel.  Keep in mind that the minimum interval between recordings is 15 seconds.  Now you can transfer data, form the same lines in Arduino and transmit them using ESP8266 to our channel. <br><br>  The wiring diagram of the elements is shown in the following figure: <br><br><img src="https://habrastorage.org/files/b34/ac6/a70/b34ac6a7016c4e33a06145cd8c8a4570.jpg" width="700"><br><br>  We used the MP8266-07 module, so we needed a stabilizer and a capacitor.  Also, for correct operation of the module, it is necessary to connect the output of GPIO15 to ground, and the output of CH_PD (chip select) with a power supply of 3.3V.  The module confidently connects even with the built-in antenna to the access point, located in the next room at a distance of about 20 meters. <br><br><div class="spoiler">  <b class="spoiler_title">Sketch listing for Arduino with detailed comments:</b> <div class="spoiler_text"> // connect the necessary libraries <br>  #include &lt;DallasTemperature.h&gt; <br>  #include &lt;OneWire.h&gt; <br>  #include &lt;SoftwareSerial.h&gt; <br>  #include &lt;LiquidCrystal.h&gt; <br>  // pause between sending data, ms <br>  unsigned long pauseTime = 60000; <br>  // variables for pause organization <br>  unsigned long currentTime; <br>  unsigned long previousTime = 0; <br>  // assign the output D10 to connect the temperature sensor D18B20 <br>  // and create instances of the ONE WIRE bus and sensor objects <br>  #define ONE_WIRE_BUS 10 <br>  OneWire oneWire (ONE_WIRE_BUS); <br>  DallasTemperature sensors (&amp; oneWire); <br>  // set the parameters for connecting to WiFi <br>  #define SSID "Your Access Point Name" <br>  #define PASS "Your Access Point" <br>  // set the IP address of the site thingspeak.com <br>  #define IP "184.106.153.149" <br>  // set the GET command line according to thingspeak.com API <br>  String GET = "GET / update? Key = your API key &amp; field1 ="; <br>  // set the pins for connecting the module ESP8266 for which we will <br>  // send AT commands to the module; <br>  // (the system uses AT commands v0.21 SDK 0.9.5 <br>  // <a href="http://esp8266.ru/esp8266-sdk-0-9-5-v0-21/">esp8266.ru/esp8266-sdk-0-9-5-v0-21</a> ) <br>  SoftwareSerial esp (11, 12);  // RX, TX <br>  // set the pins for connecting the LCD indicator <br>  LiquidCrystal lcd (A1, A2, A3, 2, 4, 7); <br><br>  void setup () <br>  { <br>  // initialize: <br>  esp.begin (9600);  // transmit-receive in ESP8266 at 9600 baud <br>  Serial.begin (9600);  // send-receive to the virtual COM port of the computer (for control) <br>  sensors.begin ();  // temperature sensor <br>  lcd.begin (16, 2);  // LCD indicator <br>  lcd.clear (); <br>  // send AT command to ESP8266 <br>  Send ("AT"); <br>  delay (1000); <br>  // if the module responded OK, connect to the wireless network <br>  if (esp.find ("OK")) { <br>  Serial.println ("ESP8266 Ready: OK"); <br>  connectWiFi (); <br>  previousTime = millis () + 2 * pauseTime; <br>  } <br>  } <br><br>  void loop () { <br>  currentTime = millis (); <br>  if (currentTime - previousTime&gt; pauseTime) { <br>  // request temperature from the sensor <br>  sensors.requestTemperatures (); <br>  float tempC = sensors.getTempCByIndex (0); <br>  // convert temperature to character string <br>  char buffer [10]; <br>  String temp = dtostrf (tempC, 4, 1, buffer); <br>  // send this line to the channel of the site thingspeak.com <br>  updateData (temp); <br>  lcd.setCursor (0,0); <br>  lcd.print (temp); <br>  lcd.print ("\ xDF" "C");  // \ xDF - degree icon <br>  previousTime = currentTime; <br>  } <br>  } <br><br>  // function to send data from ESP8266 to thingspeak.com <br>  void updateData (String data) { <br>  // form and send a connection command to thingspeak.com <br>  String cmd = "AT + CIPSTART = \" TCP \ ", \" "; <br>  cmd + = IP; <br>  cmd + = "\", 80 "; <br>  Send (cmd); <br>  delay (3000); <br>  if (esp.find ("OK")) <br>  Serial.println ("CONNECT TO IP: OK"); <br>  else <br>  Serial.println ("CONNECT TO IP: Error"); <br>  // form and send the command to send data <br>  cmd = GET; <br>  cmd + = data; <br>  cmd + = "\ r \ n"; <br>  esp.print ("AT + CIPSEND ="); <br>  esp.println (cmd.length ()); <br>  // if the ESP8266 module is ready to receive and send data <br>  if (esp.find ("&gt;")) { <br>  Serial.print ("&gt;"); <br>  // send data <br>  esp.print (cmd); <br>  Serial.print (cmd); <br>  if (esp.find ("OK")) Serial.println ("DATA SEND: OK"); <br>  else Serial.println ("DATA SEND: Error"); <br>  } <br>  else { <br>  Send ("AT + CIPCLOSE"); <br>  if (esp.find ("OK")) Serial.println ("CONNECTION FOR CLOSE: OK"); <br>  else Serial.println ("CONNECTION FOR IP CLOSE: Error"); <br>  } <br>  Serial.println (); <br>  } <br><br>  // function to send data to the ESP8266 module <br>  void Send (String cmd) { <br>  Serial.print (‚ÄúSEND TO ESP8266:‚Äû); <br>  esp.println (cmd); <br>  Serial.println (cmd); <br>  } <br><br>  // function to connect to a WiFi network <br>  boolean connectWiFi () { <br>  esp.println (‚ÄúAT + CWMODE = 1‚Äù); <br>  delay (2000); <br>  String cmd = "AT + CWJAP = \" "; <br>  cmd + = SSID; <br>  cmd + = "\", \ ""; <br>  cmd + = PASS; <br>  cmd + = "\" "; <br>  Send (cmd); <br>  delay (5000); <br>  if (esp.find ("OK")) { <br>  Serial.println ("CONNECT TO WIFI: OK"); <br>  return true; <br>  } <br>  else { <br>  Serial.println ("CONNECT TO WIFI: Error"); <br>  return false; <br>  } <br>  } <br></div></div><br><br>  All items in the collection, the program is running: <br><br><img src="https://habrastorage.org/files/0df/ea1/220/0dfea1220b4141ff9593c29046b8a2c1.jpg" width="700"><br><br>  And here is what the measurement results on the site look like: <br><br><img src="https://habrastorage.org/files/e21/a58/e36/e21a58e363c84b37b19f28f349efaf7b.jpg" width="800"><br><br>  The first graph shows the temperature change over time, and the second is a histogram created by MatLab-based visualization tools built into ThingSpeak, which shows how many times in the past 24 hours each temperature value was measured.  On the website, such a histogram is called ‚Äútemperature variation‚Äù, the closest Russian term is temperature fluctuations. <br><br>  Thus, using the Digital Lab kit in combination with the service provided by the ThingSpeak platform, you can collect and process data from various sensors in up to eight channels.  For example, using the four-channel voltmeter scheme described in the previous article, you can monitor the status of batteries or solar panels, while receiving meteorological information at the place of their installation. </div><p>Source: <a href="https://habr.com/ru/post/394357/">https://habr.com/ru/post/394357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../394347/index.html">The updated Raspberry Pi Zero microcomputer received camera support and still costs $ 5</a></li>
<li><a href="../394349/index.html">Collecting RNA from non-living building blocks without the help of enzymes is real</a></li>
<li><a href="../394351/index.html">Chicago police predict who can shoot and be shot</a></li>
<li><a href="../394353/index.html">Andy Grove about the computer market and its players</a></li>
<li><a href="../394355/index.html">Free Wi-Fi will appear on all ground transportation in Moscow until the end of the year.</a></li>
<li><a href="../394359/index.html">Brain system</a></li>
<li><a href="../394361/index.html">Iron based solar panels</a></li>
<li><a href="../394365/index.html">Tesla is preparing a new Roadster</a></li>
<li><a href="../394367/index.html">Online fraud research</a></li>
<li><a href="../394371/index.html">Review Skolkovo Robotics International Conference 2016</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>