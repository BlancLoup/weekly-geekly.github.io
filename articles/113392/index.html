<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a rating module for Joomla, or AJAX in Russian</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When working on the site, I had a need for an article rating system, and it had to be easy and simple. It was decided to abandon the five-point one im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a rating module for Joomla, or AJAX in Russian</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/7aa/ee1/eb3/7aaee1eb3878df0cee1e0da9aa7c7c9f.jpg" alt="image">  When working on the site, I had a need for an article rating system, and it had to be easy and simple.  It was decided to abandon the five-point one immediately, and the ‚ÄúLike / Dislike‚Äù system was chosen.  Unfortunately, a quick search did not find anything like this, and therefore it was decided to write a module from scratch. <br><a name="habracut"></a><br><h5>  Where to begin? </h5><br>  The module begins with a Hello World!  Find it is not difficult, download and unpack into a folder.  Since the module will work with the database, and the standard rating table does not suit us, we will create our own. <br><img src="https://habrastorage.org/getpro/habr/post_images/a3a/02f/08f/a3a02f08f5ed44166b2cd73411204bb7.png" alt="image"><br><ul><li>  id - the main field with auto increment </li><li>  nid - a unique field that stores the material id </li><li>  like - list of users id who liked the news </li><li>  dislike - list of users id who didn‚Äôt like the news </li><li>  rate - total news rating </li></ul><br>  So, we have dealt with the database, now let's proceed to the module itself.  Pedpolozhayu that you already know what <a href="http://ru.wikipedia.org/wiki/AJAX">AJAX is</a> , what it is for.  Since Joomla does not provide for the possibility of using AJAX modules, we will use the features offered <a href="http://tushov.ru/post/568">by Leonid Touches</a> , namely, we will create a file through which all requests will go.  As a result, we now have 2 files in the module folder: ajax.php and mod_likerating (aka Hello World!).  Now we write an xml file installer for them and install it. <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">install</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.5.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>JLikeRating<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span>StyleT<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>   Joomla    / <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filename</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mod_likerating"</span></span></span><span class="hljs-tag">&gt;</span></span>mod_likerating.php<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filename</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filename</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mod_likerating"</span></span></span><span class="hljs-tag">&gt;</span></span>ajax.php<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">filename</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">params</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"suffix"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  "</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"    "</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">params</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">install</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><h5>  Writing the module code </h5><br>  We check the output of the module and go on.  Since the module will be displayed in the full version of the news, then we will display it must have with the plugin <a href="http://www.nonumber.nl/extensions/modulesanywhere">Modules Anywhere</a> with the required parameters <b>Enable parameter overriding</b> , <b>Ignore module state</b> and <b>Enable in components</b> . <br>  Unfortunately, the module does not know the id of the material currently open, so we will pass it as a parameter using the Parameters overriding function of the Modules Anywhere plugin: <br> <code>{module 65|newsid=&lt;?php echo $this-&gt;article-&gt;id; ?&gt;}</code> <br>  65 is the id of our module obtained after installation. <br>  In total, the module code here has become: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> defined(<span class="hljs-string"><span class="hljs-string">'_JEXEC'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Restricted access'</span></span>); $db = JFactory::getDBO();<span class="hljs-comment"><span class="hljs-comment">//  $user = JFactory::getUser();//  $suffix = $params-&gt;get("suffix");//   $newsid = $params-&gt;get("newsid");// id  if (JRequest::getVar('voteresult')) { //  AJAX echo 'hello from AJAX\n'.JRequest::getVar('voteresult'); } else{ //   </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;script type="text/javascript"&gt; function myAJAXSendRequest(voteres) { new Request({ method: 'get', url: '/modules/mod_likerating/ajax.php', data: { 'voteresult' : voteres}, onSuccess: function(responseText) { alert(responseText);}, onFailure: function() { alert('failed');} }).send(); } window.addEvent('domready', function() {//    $('likerating-like').addEvent('click', function(e) {myAJAXSendRequest('like');}); $('likerating-dislike').addEvent('click', function(e) {myAJAXSendRequest('dislike');}); }); &lt;/script&gt; &lt;DIV class="likerating</span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> echo $suffix; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment">"&gt; &lt;button class="like" type="button" id="likerating-like" &gt; &lt;span class="label"&gt;&lt;/span&gt; &lt;/button&gt;&lt;button class="dislike" type="button" id="likerating-dislike"&gt; &lt;span class="label"&gt; &lt;/span&gt; &lt;/button&gt; &lt;/div&gt; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">&lt;?php</span></span></span><span class="hljs-comment"> } </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  Everything worked out?  Works?  Ok, now let's take this code in steps: <br>  1. The Modules Anywhere plugin calls the module and sends it the news id. <br>  2. The module connects classes and receives parameters. <br>  3. The ‚Äúif (JRequest :: getVar ('voteresult'))‚Äù code gives false because there was no ajax request. <br>  4. Output module to the user. <br>  5. User presses the Like button. <br>  6. Parameters specified in the data of the class Request are transmitted to the specified url <br>  7. Called ajax.php calls module <br>  8. The code ‚Äúif (JRequest :: getVar ('voteresult'))‚Äù and only part of the ajax processing is executed, the server responds <br>  9. OnSuccess is called and the server response is processed. <br>  10. All this without reloading the page. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is important to note that now we are transmitting data in text format, whereas new Request.JSON is already working with the JSON format, which is preferable if we accept several variables. <br><br><h5>  We write the actual voting </h5><br>  So below I give the full code of the voting module for which everything was started. <br><pre> <code class="hljs bash">&lt;?php defined(<span class="hljs-string"><span class="hljs-string">'_JEXEC'</span></span>) or die(<span class="hljs-string"><span class="hljs-string">'Restricted access'</span></span>); <span class="hljs-variable"><span class="hljs-variable">$db</span></span> = JFactory::getDBO();//  <span class="hljs-variable"><span class="hljs-variable">$user</span></span> = JFactory::getUser();//  <span class="hljs-variable"><span class="hljs-variable">$suffix</span></span> = <span class="hljs-variable"><span class="hljs-variable">$params</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">"suffix"</span></span>);//   <span class="hljs-variable"><span class="hljs-variable">$newsid</span></span> = <span class="hljs-variable"><span class="hljs-variable">$params</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">"newsid"</span></span>);// id  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (JRequest::getVar(<span class="hljs-string"><span class="hljs-string">'voteresult'</span></span>)) { // <span class="hljs-literal"><span class="hljs-literal">true</span></span>   ajax <span class="hljs-variable"><span class="hljs-variable">$voteres</span></span>= JRequest::getVar(<span class="hljs-string"><span class="hljs-string">'voteresult'</span></span>);//   <span class="hljs-variable"><span class="hljs-variable">$voted</span></span>= JRequest::getVar(<span class="hljs-string"><span class="hljs-string">'voted'</span></span>);//   ,   ,   0- 1- 2-  <span class="hljs-variable"><span class="hljs-variable">$newsid</span></span>= JRequest::getVar(<span class="hljs-string"><span class="hljs-string">'newsid'</span></span>);// id     Modules Anywhere     <span class="hljs-variable"><span class="hljs-variable">$query</span></span>=<span class="hljs-string"><span class="hljs-string">"UPDATE `#__likerating_news` SET "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$voteres</span></span>==<span class="hljs-string"><span class="hljs-string">'like'</span></span>) { switch(<span class="hljs-variable"><span class="hljs-variable">$voted</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 1: <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">"`like`=(SELECT REPLACE(`like`,',"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"','')), `rate`=`rate`-'1'"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>= 0; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 2: <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">"`like`=(SELECT CONCAT_WS(',', `like`, '"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"')), `rate`=`rate`+'2', `dislike`=(SELECT REPLACE(`dislike`,',"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"',''))"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>= 1; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 0: <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">"`like`=(SELECT CONCAT_WS(',', `like`, '"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"')), `rate`=`rate`+'1'"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>= 1; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$voteres</span></span>==<span class="hljs-string"><span class="hljs-string">'dislike'</span></span>) { switch(<span class="hljs-variable"><span class="hljs-variable">$voted</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 1: <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">"`dislike`=(SELECT CONCAT_WS(',', `dislike`, '"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"')), `rate`=`rate`-'2', `like`=(SELECT REPLACE(`like`,',"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"',''))"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>= 2; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 2: <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">"`dislike`=(SELECT REPLACE(`dislike`,',"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"','')), `rate`=`rate`+'1'"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>= 0; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> 0: <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">"`dislike`=(SELECT CONCAT_WS(',', `dislike`, '"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id.<span class="hljs-string"><span class="hljs-string">"')), `rate`=`rate`-'1'"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>= 2; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-variable"><span class="hljs-variable">$query</span></span>.=<span class="hljs-string"><span class="hljs-string">" WHERE `nid`='"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$newsid</span></span>.<span class="hljs-string"><span class="hljs-string">"'"</span></span>; <span class="hljs-variable"><span class="hljs-variable">$db</span></span>-&gt;setQuery(<span class="hljs-variable"><span class="hljs-variable">$query</span></span>); <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$db</span></span>-&gt;loadResult(); <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$answer</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{// AJAX    //            <span class="hljs-variable"><span class="hljs-variable">$db</span></span>-&gt;setQuery(<span class="hljs-string"><span class="hljs-string">"INSERT INTO #__likerating_news (`nid`, `like`, `dislike`, `rate`) VALUES ('"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$newsid</span></span>.<span class="hljs-string"><span class="hljs-string">"', '0', '0', '0')"</span></span>); <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$db</span></span>-&gt;loadResult(); //   ?      <span class="hljs-variable"><span class="hljs-variable">$db</span></span>-&gt;setQuery(<span class="hljs-string"><span class="hljs-string">"SELECT `like`, `dislike` FROM `#__likerating_news` WHERE `nid`='"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$newsid</span></span>.<span class="hljs-string"><span class="hljs-string">"'"</span></span>); <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$db</span></span>-&gt;loadRow(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(strpos(<span class="hljs-string"><span class="hljs-string">"t"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$result</span></span>[0], <span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id)) <span class="hljs-variable"><span class="hljs-variable">$voted</span></span>= <span class="hljs-string"><span class="hljs-string">'1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(strpos(<span class="hljs-string"><span class="hljs-string">"t"</span></span>.<span class="hljs-variable"><span class="hljs-variable">$result</span></span>[1], <span class="hljs-variable"><span class="hljs-variable">$user</span></span>-&gt;id)) <span class="hljs-variable"><span class="hljs-variable">$voted</span></span>= <span class="hljs-string"><span class="hljs-string">'2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-variable"><span class="hljs-variable">$voted</span></span>= <span class="hljs-string"><span class="hljs-string">'0'</span></span>; ?&gt; &lt;script <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt; var voted= <span class="hljs-string"><span class="hljs-string">'&lt;?php echo $voted; ?&gt;'</span></span>;//      JS var newsid= <span class="hljs-string"><span class="hljs-string">'&lt;?php echo $newsid; ?&gt;'</span></span>;//    ajax.php       <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myAJAXSendRequest(voteres) { new Request({ method: <span class="hljs-string"><span class="hljs-string">'get'</span></span>, url: <span class="hljs-string"><span class="hljs-string">'/modules/mod_likerating/ajax.php'</span></span>, data: { <span class="hljs-string"><span class="hljs-string">'voteresult'</span></span> : voteres , <span class="hljs-string"><span class="hljs-string">'voted'</span></span> : voted, <span class="hljs-string"><span class="hljs-string">'newsid'</span></span> : newsid}, onSuccess: <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(responseText) { voted= responseText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(voted==0){//    $(<span class="hljs-string"><span class="hljs-string">'likeratingimg-like'</span></span>).setStyle(<span class="hljs-string"><span class="hljs-string">'background-position'</span></span>, <span class="hljs-string"><span class="hljs-string">'0px -38px'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'likeratingimg-dislike'</span></span>).setStyle(<span class="hljs-string"><span class="hljs-string">'background-position'</span></span>, <span class="hljs-string"><span class="hljs-string">'0px 0px'</span></span>); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(voted==1){ $(<span class="hljs-string"><span class="hljs-string">'likeratingimg-like'</span></span>).setStyle(<span class="hljs-string"><span class="hljs-string">'background-position'</span></span>, <span class="hljs-string"><span class="hljs-string">'0px -58px'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'likeratingimg-dislike'</span></span>).setStyle(<span class="hljs-string"><span class="hljs-string">'background-position'</span></span>, <span class="hljs-string"><span class="hljs-string">'0px 0px'</span></span>); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ $(<span class="hljs-string"><span class="hljs-string">'likeratingimg-like'</span></span>).setStyle(<span class="hljs-string"><span class="hljs-string">'background-position'</span></span>, <span class="hljs-string"><span class="hljs-string">'0px -38px'</span></span>); $(<span class="hljs-string"><span class="hljs-string">'likeratingimg-dislike'</span></span>).setStyle(<span class="hljs-string"><span class="hljs-string">'background-position'</span></span>, <span class="hljs-string"><span class="hljs-string">'0px -19px'</span></span>); } //alert(voted); }, onFailure: <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>() {//    alert(<span class="hljs-string"><span class="hljs-string">'failed'</span></span>); } }).send(); } window.addEvent(<span class="hljs-string"><span class="hljs-string">'domready'</span></span>, <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>() {//    $(<span class="hljs-string"><span class="hljs-string">'likerating-like'</span></span>).addEvent(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(e) {myAJAXSendRequest(<span class="hljs-string"><span class="hljs-string">'like'</span></span>);}); $(<span class="hljs-string"><span class="hljs-string">'likerating-dislike'</span></span>).addEvent(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(e) {myAJAXSendRequest(<span class="hljs-string"><span class="hljs-string">'dislike'</span></span>);}); }); &lt;/script&gt; &lt;DIV class=<span class="hljs-string"><span class="hljs-string">"likerating&lt;?php echo </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$suffix</span></span></span><span class="hljs-string">; ?&gt;"</span></span>&gt; &lt;button class=<span class="hljs-string"><span class="hljs-string">"like"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"button"</span></span> id=<span class="hljs-string"><span class="hljs-string">"likerating-like"</span></span> &gt; &lt;img id=<span class="hljs-string"><span class="hljs-string">"likeratingimg-like"</span></span> class=<span class="hljs-string"><span class="hljs-string">"hand-image"</span></span> style=<span class="hljs-string"><span class="hljs-string">"&lt;?php if(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voted</span></span></span><span class="hljs-string">== '1'){echo 'background-position: 0px -58px;';}?&gt;"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/modules/mod_likerating/images/pixel.gif"</span></span>&gt; &lt;span class=<span class="hljs-string"><span class="hljs-string">"label"</span></span>&gt;&lt;/span&gt; &lt;/button&gt;&lt;button class=<span class="hljs-string"><span class="hljs-string">"dislike"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"button"</span></span> id=<span class="hljs-string"><span class="hljs-string">"likerating-dislike"</span></span>&gt; &lt;img id=<span class="hljs-string"><span class="hljs-string">"likeratingimg-dislike"</span></span> class=<span class="hljs-string"><span class="hljs-string">"hand-image"</span></span> style=<span class="hljs-string"><span class="hljs-string">"&lt;?php if(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voted</span></span></span><span class="hljs-string">== '2'){echo 'background-position: 0px -19px;';}?&gt;"</span></span> src=<span class="hljs-string"><span class="hljs-string">"/modules/mod_likerating/images/pixel.gif"</span></span>&gt; &lt;/button&gt; &lt;/div&gt; &lt;?php } ?&gt;</code> </pre><br>  It is assumed that the background image consists of a sprite that is specified in the CSS style, but to write the actual CSS will be your task. <br>  It is also important that you don‚Äôt need to touch ajax.php at all, just put it in the module folder and throw ajax requests at it. <br>  Everyone probably noticed that the cell of the database's database is filled and taken into account, but the value does not go out of it anywhere, yes, it is, but nobody prevents you from using it. <br><br><h5>  Result </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/b94/c5c/823/b94c5c8233009d4c4ce9c3fff226c7e7.png" alt="image"><br>  That's what ultimately happened to me, the functionality is completely similar to similar buttons on YouTube, I confess, the temporary design is also from there.  If someone needs it, I can send an archive with files, now there is little time, to knock on Skype <br><br><h5>  Nothing works for me, what should I do? </h5><br>  The following is a list of useful links on this topic: <br>  <a href="http://vremenno.net/js/mootools-for-beginners-lesson-3/">Temporarily. NO</a> <br>  <a href="http://mootools.net/docs/core/Request/Request">Class: Request</a> <br>  <a href="http://dev.mysql.com/doc/refman/5.5/en/string-functions.html">My SQL String Functions</a> <br>  <a href="http://davidwalsh.name/basic-ajax-requests-mootools">Basic AJAX Requests Using MooTools 1.2</a> <br><br><h5>  From the author </h5><br>  This is my first topic on Habr√©, and I hope not the last.  Perhaps everything is very detailed here, but there are few detailed descriptions and difficulties that I encountered in my time, and I think this article will help the newcomer save a couple of hours of life. </div><p>Source: <a href="https://habr.com/ru/post/113392/">https://habr.com/ru/post/113392/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113381/index.html">Indexing and searching with Xapian in .NET</a></li>
<li><a href="../113382/index.html">Texas Instruments is preparing a system-on-chip OMAP 5 with 3d support</a></li>
<li><a href="../113383/index.html">Hello again</a></li>
<li><a href="../113387/index.html">Good news for those who need HPC, HA and just an SSI cluster, finally</a></li>
<li><a href="../113390/index.html">Plankton Windows</a></li>
<li><a href="../113393/index.html">Image palette clustering and PNG compression</a></li>
<li><a href="../113395/index.html">Would you be interested in the Russian Railways corporate blog about the company's IT infrastructure and technologies?</a></li>
<li><a href="../113397/index.html">Alien Dalvik to run Android applications on Maemo / MeeGo OS</a></li>
<li><a href="../113399/index.html">Natives from Google and Facebook showed an ‚Äúideal‚Äù task tracker</a></li>
<li><a href="../113401/index.html">Do users use weak passwords? Unofficial statistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>