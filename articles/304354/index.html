<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Php tools for japanese</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After working for a year in a Japanese company as a system engineer, I highlighted a few points that a programmer working with Japanese text must know...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">ğŸ”</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">ğŸ“œ</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">â¬†ï¸</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">â¬‡ï¸</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Php tools for japanese</h1><div class="post__text post__text-html js-mediator-article">  After working for a year in a Japanese company as a system engineer, I highlighted a few points that a programmer working with Japanese text must know. <br><br>  There are 3 alphabets in Japanese, which makes working with text not as simple as in European languages.  Let's start with the simplest and move on to the more complex. <br><a name="habracut"></a><br>  As in Russia, sites with local coding remained in Japan, we translate the text into UTF-8: <br><br><pre><code class="php hljs">$output = iconv(<span class="hljs-string"><span class="hljs-string">'Shift-JIS'</span></span>, <span class="hljs-string"><span class="hljs-string">'UTF-8//IGNORE'</span></span>, $input);</code> </pre> <br>  There is such a feature among the Japanese: the text can be written in two ways - the so-called "full length" (Zen-Kaku) and "half the length" (Han-Kaku).  The Japanese text is Zen-Kaku, the European text is Han-Kaku, but in principle any European text can be written as Zen-Kaku.  Example: ï¼³ï¼¡ï¼¬ï¼¥.  But especially the Japanese love zen-kaku numbers: ï¼‘ï¼’ï¼“. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To translate ï¼³ï¼¡ï¼¬ï¼¥ to SALE: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toHanKaku</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mb_convert_kana($text, <span class="hljs-string"><span class="hljs-string">'a'</span></span>); }</code> </pre><br>  Why are the Japanese 3 alphabet?  In the first kanji (æ¼¢å­—) - hieroglyphs are recorded.  The second is hiragana (ã² ã‚‰ ãŒ ãª), it can be said, the main alphabet, because any kanji can be written hiragana.  And the third is katakana (ã‚« ã‚¿ ã‚« ãƒŠ) and it is the same as hiragana, except for the fact that it records foreign words. <br><br>  To translate hiragana to katakana (ã¯ ãš ã‚Œ in ãƒ¬) (the same word in different alphabets), we use the same function, only with a different key: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toKatakana</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mb_convert_kana($text, <span class="hljs-string"><span class="hljs-string">'C'</span></span>); }</code> </pre><br>  The same problem with regular expressions.  There is a date in the format: ï¼’ï¼ï¼‘ï¼–ï¼ï¼’ï¼ï¼ï¼’ï¼.  So that it is recognized, the mandatory condition modifier "u" is Unicode. <br><br><pre> <code class="php hljs">preg_match(<span class="hljs-string"><span class="hljs-string">'/[\d]{4}.[\d]{2}.[\d]{2}/u'</span></span>, $text, $match);</code> </pre><br>  Like everyone else, the Japanese do not bother with the addresses of the pages and write directly to the address with Japanese hieroglyphs, for example, like this: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ja.wikipedia.org/wiki/ãƒ¤ãƒ•ãƒ¼"</span></span></span><span class="hljs-tag">&gt;</span></span>ãƒ¤ãƒ•ãƒ¼<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The address is correct, but in order for it to be understood, for example, by Curl, it must be encoded: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">japaneseUrlEncode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preg_replace_callback( <span class="hljs-string"><span class="hljs-string">'/[^\x21-\x7e]+/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($matches)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urlencode($matches[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }, $text ); }</code> </pre><br>  The Japanese text entry system is also special, it allows you to add different decorations directly from the keyboard without additional tools: â™ª â™« â˜† â˜… ã€Œã€ ï¸ <img width="14" height="14" src="https://habrastorage.org/getpro/habr/post_images/4d5/a73/663/4d5a73663885207b907f389aff0f76fa.png">  â™¡.  All these things literally overflowing blogs, forums, twitter and similar places. <br><br>  The problem is that when you try to insert some Emoji into a regular utf8_general_ci table, we will get truncated text and an error: <br><br><pre> <code class="sql hljs">Warning: <span class="hljs-comment"><span class="hljs-comment">#1366 Incorrect string value: '\xF0\x9F\x98\x8ASI...' for column 'content' at row 1</span></span></code> </pre><br>  But the point here is that utf8_general_ci is of course a very rich set of characters, but it is limited to 3 bytes per character and does not contain 4-byte emoji.  The encoding that fits is utf8mb4. <br><br>  An example of textual beauty in Japanese: <br><blockquote> ã¯ ãª ã• ã¾ ã“ ã‚“ ã‚“ ã« ã¡ ã¯ â˜… SIENA ã‚¹ ã‚“ ã° ãƒ‘ ãƒ¼ ã‚¹ ã‚¹ åº— ã™ â™¡ <br> æ—¥ ã¯ å…¥ è· ã— ãŸ ã¦ ã® new ãƒ” ã‚¢ ã‚¹ ã® ã” ç´¹ ä»‹ ã§ ã™ â™« </blockquote><br><br>  But not everyone can change the encoding, there is another solution - delete 4-byte emoji: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear4byte</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($string)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preg_replace(<span class="hljs-string"><span class="hljs-string">'%(?: \xF0[\x90-\xBF][\x80-\xBF]{2} | [\xF1-\xF3][\x80-\xBF]{3} | \xF4[\x80-\x8F][\x80-\xBF]{2} )%xs'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $string); }</code> </pre><br>  I hope this material will be useful to those who work with the Japanese text, as well as all the rest for general development. <br><br>  PS: The first publication failed, moderator's comment: <br><blockquote>  The feeling that the article ends somewhere in the middle.  Complete the material and publish again. </blockquote><br>  What is called â€œdeja vuâ€ - just the case described in the last example occurred with Habr, namely: I added four-byte character encoding for clarity, which caused an error, and the text was saved to the database in a truncated form. </div><p>Source: <a href="https://habr.com/ru/post/304354/">https://habr.com/ru/post/304354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304344/index.html">Never give up: how Netscape waged an unequal battle with Internet Explorer</a></li>
<li><a href="../304346/index.html">Why professional social networks should be handled with care</a></li>
<li><a href="../304348/index.html">Increase Conversion: 9 Essential Elements of the Right Email Template</a></li>
<li><a href="../304350/index.html">4 business lessons from the legendary John Wood</a></li>
<li><a href="../304352/index.html">5 rules for working with tickets</a></li>
<li><a href="../304356/index.html">51 tools for APM and server monitoring</a></li>
<li><a href="../304358/index.html">Lenovo server set six world records</a></li>
<li><a href="../304360/index.html">Gamified Generation</a></li>
<li><a href="../304362/index.html">We assemble your first WebAsse assembly component</a></li>
<li><a href="../304366/index.html">Desktop CRM. We have to talk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>