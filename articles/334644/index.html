<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Clustering markers on the Google Maps API map</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I want to talk about my experience in developing a map with clustered markers on google maps api and React.js. Clustering is a grouping of n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Clustering markers on the Google Maps API map</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I want to talk about my experience in developing a map with clustered markers on google maps api and React.js.  Clustering is a grouping of nearby markers, tags, points in one cluster.  This helps to improve the UX and display the data visually more clearly than a bunch of overlapping points. <a name="habracut"></a>  The company in which I work creates a unique product for the media, this is a mobile application, the meaning of which is to take photos / videos / streams of materials and the opportunity to receive excellent compensation from the media if the editor uses your material in the publication.  I am developing a SPA application on the react / redux stack for moderating the content sent by users.  Recently, I faced the task of making an interactive map on which one could see the location of users and send them a push notification if an interesting event occurs nearby. <br><br>  Here is what I had to do: <br><br><img src="https://habrastorage.org/web/2ea/516/fdb/2ea516fdb64740abacef81f45244f5bd.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first thing that came to my mind was to look for a ready solution for react.js.  I found 2 top <a href="https://github.com/istarkov/google-map-react">google-map-react</a> and <a href="https://github.com/tomchentw/react-google-maps">react-google-maps</a> libraries.  They are wrappers over the standard Google Maps API, presented as components for react.js.  I chose google-map-react because it allowed to use any JSX element as a marker, let me remind you that the standard google maps api tools allow you to use an image and a svg element as a marker, there are solutions in the network that describe the tricky html box in as a marker, but google-map-react represents this out of the box. <br><br>  Going further, on the layout you can see that if the markers are close to each other, they are combined into a group marker - this is clustering.  In the readme google-map-react, I found an example of clustering, but it was implemented using recompose ‚Äî this is a utility that creates a wrapper over function components and higher-order components.  The creators are writing so that we think that this is a kind of lodash for the reactor.  But for those who are not familiar with recompose, it will be immediately clear to everyone, so I adapted this example and removed the extra dependency. <br><br>  To begin with, we will set properties for the google-map-react and state components, we will render a map with pre-prepared markers: <br>  (api key we get <a href="https://developers.google.com/maps/documentation/geocoding/get-api-key%3Fhl%3Dru">here</a> ) <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MAP = { <span class="hljs-attr"><span class="hljs-attr">defaultZoom</span></span>: <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-attr"><span class="hljs-attr">defaultCenter</span></span>: { <span class="hljs-attr"><span class="hljs-attr">lat</span></span>: <span class="hljs-number"><span class="hljs-number">60.814305</span></span>, <span class="hljs-attr"><span class="hljs-attr">lng</span></span>: <span class="hljs-number"><span class="hljs-number">47.051773</span></span> }, <span class="hljs-attr"><span class="hljs-attr">options</span></span>: { <span class="hljs-attr"><span class="hljs-attr">maxZoom</span></span>: <span class="hljs-number"><span class="hljs-number">19</span></span>, }, }; state = { <span class="hljs-attr"><span class="hljs-attr">mapOptions</span></span>: { <span class="hljs-attr"><span class="hljs-attr">center</span></span>: MAP.defaultCenter, <span class="hljs-attr"><span class="hljs-attr">zoom</span></span>: MAP.defaultZoom, }, <span class="hljs-attr"><span class="hljs-attr">clusters</span></span>: [], }; <span class="hljs-comment"><span class="hljs-comment">//JSX &lt;GoogleMapReact defaultZoom={MAP.defaultZoom} defaultCenter={MAP.defaultCenter} options={MAP.options} onChange={this.handleMapChange} yesIWantToUseGoogleMapApiInternals bootstrapURLKeys={{ key: 'yourkey' }} &gt; {this.state.clusters.map(item =&gt; { if (item.numPoints === 1) { return ( &lt;Marker key={item.id} lat={item.points[0].lat} lng={item.points[0].lng} /&gt; ); } return ( &lt;ClusterMarker key={item.id} lat={item.lat} lng={item.lng} points={item.points} /&gt; ); })} &lt;/GoogleMapReact&gt;</span></span></code> </pre> <br>  There will be no markers on the map, because the array of this.state.clusters is empty.  To combine markers into a group, use the <a href="https://github.com/mapbox/supercluster">supercluster</a> library <a href="https://github.com/mapbox/supercluster">.</a> <br><br>  For example, generate points with coordinates: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TOTAL_COUNT = <span class="hljs-number"><span class="hljs-number">200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> susolvkaCoords = { <span class="hljs-attr"><span class="hljs-attr">lat</span></span>: <span class="hljs-number"><span class="hljs-number">60.814305</span></span>, <span class="hljs-attr"><span class="hljs-attr">lng</span></span>: <span class="hljs-number"><span class="hljs-number">47.051773</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> markersData = [...Array(TOTAL_COUNT)] .fill(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// fill(0) for loose mode .map((__, index) =&gt; ({ id: index, lat: susolvkaCoords.lat + 0.01 * index * Math.sin(30 * Math.PI * index / 180) * Math.cos(50 * Math.PI * index / 180) + Math.sin(5 * index / 180), lng: susolvkaCoords.lng + 0.01 * index * Math.cos(70 + 23 * Math.PI * index / 180) * Math.cos(50 * Math.PI * index / 180) + Math.sin(5 * index / 180), }));</span></span></code> </pre><br>  Each time the map scale / center changes, we will recalculate the clusters: <br><br><pre> <code class="hljs javascript">handleMapChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ center, zoom, bounds }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState( { <span class="hljs-attr"><span class="hljs-attr">mapOptions</span></span>: { center, zoom, bounds, }, }, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createClusters(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props); } ); }; createClusters = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ <span class="hljs-attr"><span class="hljs-attr">clusters</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.mapOptions.bounds ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getClusters(props).map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ wx, wy, numPoints, points }</span></span></span><span class="hljs-function">) =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">lat</span></span>: wy, <span class="hljs-attr"><span class="hljs-attr">lng</span></span>: wx, numPoints, <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${numPoints}</span></span></span><span class="hljs-string">_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${points[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">].id}</span></span></span><span class="hljs-string">`</span></span>, points, })) : [], }); }; getClusters = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> clusters = supercluster(markersData, { <span class="hljs-attr"><span class="hljs-attr">minZoom</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">maxZoom</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span>, }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clusters(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.mapOptions); };</code> </pre><br>  In the getClusters method, we feed the generated points to the supercluster, and we get clusters at the output.  Thus, the supercluster simply combined the coordinates of the points lying nearby and produced a new point with its coordinates and an array of points where all the entered points lie. <br><br>  Demo can be seen <a href="https://tim152.github.io/clustering-google-map-react/">here.</a> <br>  Sample source code <a href="https://github.com/Tim152/clustering-google-map-react">here</a> </div><p>Source: <a href="https://habr.com/ru/post/334644/">https://habr.com/ru/post/334644/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334630/index.html">How to create a business proposal, based on the result of R & D and technology</a></li>
<li><a href="../334632/index.html">Comparison of prices for traffic from cloud providers</a></li>
<li><a href="../334636/index.html">Introducing dependencies through fields is bad practice</a></li>
<li><a href="../334638/index.html">PERFEXPERT Monitoring System - Database Management Problem Solving</a></li>
<li><a href="../334642/index.html">Alternative planetary data for geographic information systems</a></li>
<li><a href="../334646/index.html">How to monitor the state of a corporate wireless network with Extreme NSight</a></li>
<li><a href="../334648/index.html">Modular testing of Pega applications: changing lives for the better with Ninja</a></li>
<li><a href="../334650/index.html">The authenticity of your videos is now undeniable thanks to Prover.</a></li>
<li><a href="../334652/index.html">Android O: features support for the new operating system</a></li>
<li><a href="../334656/index.html">5 fresh examples of parsing and improving the design in simple ways</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>