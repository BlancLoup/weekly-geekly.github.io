<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Casual bot for casual game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Evaluating google + , accidentally stumbled upon a simple flash game - push the cubes of the same color, they burst, and we get points and profit. But...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Casual bot for casual game</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage2/134/729/feb/134729feb8a4ed9f8175b3d5b7fb3e94.jpg">  Evaluating <a href="http://habrahabr.ru/post/141899/">google +</a> , accidentally stumbled upon a <a href="https://plus.google.com/games/54990740671">simple flash</a> game - push the cubes of the same color, they burst, and we get points and profit.  But instead of clicking on the cubes myself, I decided to write a bot that would do all this for me. <br><br>  A bot for this <a href="http://habrahabr.ru/search/%3Fq%3Ddiamond%2Bdash">long-suffering</a> game <a href="http://habrahabr.ru/post/127110/">already exists</a> ( <i>and not just one</i> ), but I wanted to do not track the transfer protocols, tinkering someone else's and introduce my code, but try to implement pattern recognition and decision-making based on them, that is, some emulation of the real player's actions.  No matane, only <b>for fun</b> .  Implementation on .NET under habrokat. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The blocks in the game are static ( <i>non-animated</i> ) sprites, and with hard positioning.  The easiest way would be to measure the position of each block by pixels, and then determine them by the manually created template.  But it will not be so interesting and boring, especially since such a method will be strictly tied specifically to this game.  Therefore, I decided to make a bot that will ( <i>partly</i> ) determine the position of the playing field and the elements on it. <br><br><img src="https://habrastorage.org/storage2/65f/475/2a3/65f4752a3f0483ee7a59b20e4fb50fde.png"><br><br>  So, first of all, you need to select all possible elements.  In total, they turned out 5 pieces *.  Cut out in the point, save to a folder.  Next, you need to determine the width and height of the playing field, the number of elements placed on it horizontally and vertically. <br><br><img src="https://habrastorage.org/storage2/020/83b/802/02083b80221445e9f96c4441ebbbee3e.png"><br><br>  These elements and need to search on the screen.  In practice, the field begins where one of them meets for the first time.  It is necessary to determine the position of the field only once - at the beginning of the game, so there is no reason to worry too much about the speed of this part.  Pixel-by-pixel comparison is too long, and such accuracy is of no use to us, so we choose the most different points from each other in the sprites of the elements ( <i>I got somewhere in the middle</i> ).  Then <a href="http://msdn.microsoft.com/ru-ru/library/system.drawing.graphics.copyfromscreen.aspx">we get a screenshot of the</a> screen and look for this pixel on it.  If a pixel is found, then we check if the found pixel belongs to the desired element. <br><br><img src="https://habrastorage.org/storage2/8f2/9f2/225/8f29f2225052cfe192b24cc7e048d06e.png"><br><br>  The first element found will indicate the initial boundary of the playing field.  In order to shorten the search for this element, we do not remove the entire screen, but let the user determine the approximate area of ‚Äã‚Äãthe playing field (I used the main form with transparency for this). <br><br>  Further, it is still easier, we break the field into pieces, each of which we need to compare the existing block.  To do this, we define the ‚Äúaverage‚Äù color of each block and the average color of the ‚Äúpiece‚Äù of the field and compare them **. <br><br>  <b>C # code</b> <br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//""  //detail -    . private Color getMidColor(Bitmap inpBit, int x, int y, int w, int h, int detail) { double r = 0, g = 0, b = 0; for (var ii = x; ii &lt; x + w; ii += detail) for (var jj = y; jj &lt; y + h; jj += detail) { var pix = inpBit.GetPixel(ii, jj); r += pix.R; g += pix.G; b += pix.B; } r /= (w * h / detail / detail);// :-( g /= (w * h / detail / detail); b /= (w * h / detail / detail); return Color.FromArgb((int)r, (int)g, (int)b); } //  //   //blcColors -  ""  . private int colorCompare(Color c) { int max=255; int cur = -1; int imax; for(var i=0;i&lt;blcColors.Count;i++) { imax=Math.Abs(cR - blcColors[i].R) + Math.Abs(cG - blcColors[i].G) + Math.Abs(cB - blcColors[i].B) / 3; if (imax &lt; max) { max=imax; cur = i; } } if (max &gt; 50)//    return -1;//     return cur; }</span></span></code> </pre> <br><br>  Then we create a matrix of blocks and look for the largest piece of contiguous blocks (depth) on it.  The task is trivial, a bit similar to the search for a way out of the maze. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//..... for (var i = 0; i &lt; 10; i++) for (var j = 0; j &lt; 9; j++) { if (nots[i, j])//    count[i, j] = //   "" searching(i, j, 0); // ""     if(count[i, j]&gt;max) { x=i; y=j; max = count[i, j]; } } //..... //     private int searching(int i, int j, int c) { nots[i, j] = false; //    for (var di = -1; di &lt;= 1; di++) for (var dj = -1; dj &lt;= 1; dj++) if (di+i &gt;= 0 &amp;&amp; di+i &lt; 10 &amp;&amp; dj+j &gt;= 0 &amp;&amp; dj+j &lt; 9) //   ? if (Math.Abs(di) != Math.Abs(dj)) //     ? if (cube[i, j] == cube[i + di, j + dj]) // ? if (nots[i + di, j + dj]) // ? { c = searching(i + di, j + dj, c+1); //  ! } return c; } }</span></span></code> </pre><br><br>  The shell and form code probably doesn't make sense to write: if you find the playing field on the screen, then start the timer (for example, a quarter of a second).  When the timer is triggered, we determine the most "deep" block and <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms646260(v%3Dvs.85).aspx">click on it on the screen</a> . <br><br>  An example of the work of the bot.  Moreover, at least the program spends 15-20 ms to recognize the blocks and make a decision in the sum, there is not much sense from this, because  On my window, a flash drive and so produces a scant 10-20 fps, and with the removal of the video, and so does a slide show.  Maximum my bot was able to fill 300k. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/D0u_04RKsfs&amp;xid=25657,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhgo67IwDfpAqwXTv2ub71-UcDGNsw" frameborder="0" allowfullscreen=""></iframe><br>  ____ <br>  <i>* In fact, they turned out to be 6. I found out about this only after I added the bot, because</i>  <i>when I played (badly) myself, this block did not appear.</i> <i><br></i>  <i>** It was possible to make a division into 2, 4 or more blocks, but here it was superfluous.</i> </div><p>Source: <a href="https://habr.com/ru/post/142056/">https://habr.com/ru/post/142056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142048/index.html">A set of useful utilities and libraries in the .NET world</a></li>
<li><a href="../142049/index.html">Online store with a discount system, other things being equal, you choose?</a></li>
<li><a href="../142050/index.html">Saga of the capacitors or "Another failure of covers"</a></li>
<li><a href="../142052/index.html">How often do you type in the browser bar Russian letters *.</a></li>
<li><a href="../142055/index.html">Cascadeur - is it possible to replace stuntmen?</a></li>
<li><a href="../142058/index.html">Briefly about tachyons</a></li>
<li><a href="../142059/index.html">The official application of EURO 2012 is not available for download in Ukraine</a></li>
<li><a href="../142060/index.html">Anonymus vs Big China Firewall</a></li>
<li><a href="../142061/index.html">The crowdfunding market grew threefold in 2011</a></li>
<li><a href="../142064/index.html">Fearless Genius: The Digital Revolution in Silicon Valley 1985-2000 (26-50)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>