<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nostalgia: digging near the ‚ÄúTanchiki‚Äù under the hood</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many of us grew up on "Tanchiki", "Mario" and other imperishable masterpieces since the dawn of the gaming industry. Sometimes it is pleasant to remem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nostalgia: digging near the ‚ÄúTanchiki‚Äù under the hood</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9a9/1d2/b0c/9a91d2b0cbdd20908c38e20a172cf452.png" align="left">  Many of us grew up on "Tanchiki", "Mario" and other imperishable masterpieces since the dawn of the gaming industry.  Sometimes it is pleasant to remember how we spent days on end hanging out with friends at TV screens, changing joysticks like gloves.  But time does not stand still, and some interests are replaced by others.  However, sometimes the love of good old toys does not fade. <br>  I attribute myself to people like this, and my interest in old games went in the direction of reverse engineering, which led me to the IT-sphere, where I ended up with ends. <br><br>  I want to tell you about the iron monsters from the famous Battle City game (in common ‚ÄúTanchiki‚Äù) from the equally famous Nintendo Entertainment System console (NES for short, in Russia its Chinese clone ‚ÄúDendy‚Äù) is under the hood.  At one time, this information seemed rather curious to me - I hope, it will seem the same to you. <br><a name="habracut"></a><br><h2>  Prehistory </h2><br>  Several years ago, studying various graphic libraries, I set a goal to write an exact clone of ‚ÄúTanchiki‚Äù.  It so happened that just at that moment a friend of mine was engaged in creating a rather interesting <a href="http://shedevr.org.ru/cgi-bin/parse.cgi%3Fid%3DBinaryCity">remake</a> by modifying the code of the original game, so I decided to consult with him (by the way, thank you very much for his advice and assistance in preparing the article).  Then I was struck by what methods implemented some functionality.  So I decided, years later, to share this knowledge with the public: after all, this is part of the history of gamedev, which may seem interesting both to lovers of the classics and developers of modern games. <br><br>  I would like to say a special thank you to the person under the nickname <a href="http://griever.magicteam.net/">Griever</a> for his efforts in decompiling the game.  First of all, thanks to the source code he received, it became possible to grasp the essence in such detail. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Level maps </h2><br>  Maps in Battle City are made up of 8x8 pixel tiles.  The whole background, seen on the screen, is a map - hypothetically, even with the counter of lives, you can interact, but in fact this, of course, will not succeed. <br><br>  However, in the serialized form, the levels are stored more compactly: for this, tiles are arranged in blocks of 2x2 tiles.  In total there are 16 types of blocks, which are listed in the table below.  Only the main part of the map (13x14 blocks) is stored, on which tanks drive - it makes no sense to keep static walls and supporting information.  4 bits are used to record one block, so the entire card occupies 91 bytes. <br><br><table><tbody><tr><td>  Block </td><td>  Code </td><td>  Block </td><td>  Code </td><td>  Block </td><td>  Code </td><td>  Block </td><td>  Code </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/bf3/d96/d4f/bf3d96d4ff583c76c071da4dd798d1a2.png"></td><td>  0 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/dbd/8e5/8c6/dbd8e58c6f8efa3ea8a3274e3e65c260.png"></td><td>  one </td><td><img src="https://habrastorage.org/getpro/habr/post_images/3bd/279/f97/3bd279f971b80b88c13fe71d826bf899.png"></td><td>  2 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/650/962/cf5/650962cf50ef474e6568afe5c52ddb45.png"></td><td>  3 </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/331/732/cff/331732cff3b5b52f1085be67b6f4e0ec.png"></td><td>  four </td><td><img src="https://habrastorage.org/getpro/habr/post_images/5ac/b68/b03/5acb68b03463c870f8f2a5158c9127cd.png"></td><td>  five </td><td><img src="https://habrastorage.org/getpro/habr/post_images/709/2a1/89e/7092a189e28c977f0b07d5d02b9d3638.png"></td><td>  6 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/fb5/fcf/0f4/fb5fcf0f4207fb13992e84d9ca9aa1d7.png"></td><td>  7 </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/9fc/348/8af/9fc3488af6e805de88265d12296a2312.png"></td><td>  eight </td><td><img src="https://habrastorage.org/getpro/habr/post_images/cd7/b19/be1/cd7b19be17485e23c7d039d8145c3fab.png"></td><td>  9 </td><td><img src="https://habrastorage.org/getpro/habr/post_images/cf4/64b/8b4/cf464b8b4b0500428de23e3c281967ae.png"></td><td>  A </td><td><img src="https://habrastorage.org/getpro/habr/post_images/895/5d3/057/8955d30578eed25dc857e019a6b25e10.png"></td><td>  B </td></tr><tr><td><img src="https://habrastorage.org/getpro/habr/post_images/ce1/e03/11d/ce1e0311d039ddd47c72e725784d3058.png"></td><td>  C </td><td><img src="https://habrastorage.org/getpro/habr/post_images/a38/143/a41/a38143a410daa42157003fa79880ffe4.png"></td><td>  D </td><td><img src="https://habrastorage.org/getpro/habr/post_images/a38/143/a41/a38143a410daa42157003fa79880ffe4.png"></td><td>  E </td><td><img src="https://habrastorage.org/getpro/habr/post_images/a38/143/a41/a38143a410daa42157003fa79880ffe4.png"></td><td>  F </td></tr></tbody></table><br><br>  Unlike blocks, the variations of the tiles themselves are much larger, namely, 256, i.e.  exactly as much as one character generator page - a video memory section, where each tile corresponds to an index from 0 to 255. Tiles are used both to create a level environment and to display information about the number of enemy tanks, lives, etc.  But directly in the elements of their level, only 22 are used - 6 of them are used to form the blocks listed, the remaining 15 are additional tiles of brick blocks, it is worth discussing them in more detail. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/18c/691/d2d/18c691d2df35c3513db029cee0e8ab46.png" align="right">  If the map consists of 8x8 pixel tiles, then how is it possible to destroy brick mini blocks 4x4 pixels in size?  The fact is that in fact there are no ‚Äúbricks‚Äù of this size, instead there are 16 types of ordinary tiles - one for each state.  Those.  when hit by a 4x4 block, in reality a whole tile is replaced, and the brick itself goes into another state, depending on where the projectile hit. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/544/0bb/dca/5440bbdcad01a1368945feb425740e03.png"></div><br><br>  Therefore, by the way, when destroying a part of a brick block, a tank cannot enter the vacated space - the tile itself was not destroyed. <br><br>  The location of the respawn points and the eagle on the map are fixed, the objects will appear in their places regardless of what is in the place of their appearance.  This happens if in the built-in level editor to ‚Äúbrick up‚Äù these areas. <br><br>  If it is interesting to someone to work on mapping, then for these purposes there is a good editor <a href="http://www.romhacking.net/utilities/249/">Quarrel</a> , which works directly with the image of the game. <br><br><h2>  Random Number Generation </h2><br>  The task of generating random values ‚Äã‚Äãfor a long time did not give rest to humanity.  It is impossible to obtain a truly random value programmatically, so the task was often reduced to generating pseudo-random values ‚Äã‚Äãwith a distribution close to what is characteristic of random ones. <br><br>  For a computer with a fully deterministic behavior, generating pseudo-random numbers is even more challenging.  For example, each time you start, exerting the same impact (pressing the same buttons at the same time), we will get the same course of the game - even the gameplay records are based on this principle, where the buttons pressed at that moment are stored for each frame .  But for us, this is not so critical: it is important to get as ‚Äúrandom‚Äù values ‚Äã‚Äãas possible within a single session. <br><br>  Consider how things are going with Battle City.  Here, to generate a pseudo-random value, several ‚Äúrandom‚Äù entities are used - this is the previous random value, the seconds counter and bytes of the so-called alternating bytes.  page zero ‚Äî the first 256 bytes of RAM that the NES processor can address faster and easier than the rest.  That is why the zero page contains the most frequently used, and as a result, the most frequently changed variables, which ensures a more even distribution. <br><br>  As a result, the final value of the number is influenced by many factors: the buttons pressed by the player, the coordinates of all the tanks and bullets on the screen, the number of points of both players, the state of the set of timers (such as bonus) and even the state of the sound channels!  Of course, this is not a complete list. <br><br>  The expression itself, by which the next random number is calculated, is quite simple.  I will not go into details, just show how it would look in C: <br><pre><code class="cpp hljs">uint8 seed = <span class="hljs-number"><span class="hljs-number">0</span></span>; uint8 index = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-function">uint8 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ seed = (seed &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) - seed + secondsCounter + zeroPage[++index]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> seed; }</code> </pre> <br><br>  As can be seen from the code, we can at any time obtain a pseudo-random value in the range from 0 to 255. Moreover, its distribution is quite adequate, as can be seen from the imperishable gameplay. <br><br><h2>  Bonuses </h2><br>  The game has exactly seven types of bonuses - a helmet, a clock, a shovel, a star, a grenade, a tank and a pistol.  In the original game, the latter is not used at all, but it can be found in pirated versions - there it makes an instant maximum upgrade, i.e.  equivalent to the three stars taken (and in some variations also allows you to destroy the "forest").  The actions of the other bonuses, I think, are known to everyone.  But just in case, let me remind you: the clock makes the enemies freeze, the shovel creates armor around the headquarters, the star increases the power of the tank, the grenade destroys all enemies on the screen (no points are awarded for them), and the tank increases the number of lives. <br><br><img src="https://habrastorage.org/webt/ne/6s/g2/ne6sg2pveoe13elymha-dm-xhne.png"><br><br>  By the way, in the pirated versions with a pistol there is another bonus - the ship, which allows you to move through the water.  Also, in some modifications, bonuses can be taken by opponents, which radically changes the balance of the game.  There were even entire collections of such modifications, where the versions differed in various similar trifles. <br><br>  Apparently, it was originally planned to include eight bonuses in the game, but in the end there were six of them left.  However, when a bonus appears, a random value modulo 8 (from 0 to 7) is taken, which is an index in the bonus table, where the star and grenade re-occupied the place of bonuses not included in the game.  As a result, the probability of their loss is 1/4, while the probability of losing other bonuses is 1/8. <br><br>  The bonus clock and helmet act for 10 seconds (during player respawn, the helmet lasts 3 seconds, including the time for respawn), the spade bonus is 20 seconds. <br><br>  Bonus carriers themselves - flashing tanks - appear if the enemy has 17, 10 or 3 tanks left in the hangars.  Those.  tanks 4, 11 and 18 are bonus. <br><br>  It is worth mentioning that the second by the standards of the game lasts a little longer than usual: the NTSC version of the console has a refresh rate of 60 frames per second, and the easiest way to count the seconds is to increase the number of seconds in each frame if the frame counter modulo 60 is zero .  But to simplify the calculations, and also to zero the frame counter as a result of overflow, it does not affect the calculation in this way, this number is rounded to 64 (0x40) - to take a number using this module, it is enough to perform a logical multiplication by 0x3F.  It turns out that the game second is 1.06 real seconds, but this does not apply to time periods, which are measured by the number of frames. <br><br>  An interesting fact, known to everyone familiar with the game: before you stop acting, the defense around the headquarters starts to ‚Äúblink‚Äù, turning into a brick one, then an armored fence (this happens in the last 4 seconds of the bonus action).  At the same time, even if the protection around the headquarters was partially or completely destroyed, each time it blinks, it is restored until it is completely turned back into a whole brick wall. <br><br><h2>  Intelligence opponents </h2><br>  Of course, AI in tanks is not a tactical analyzer, but some logic is still calculated. <br><br>  To begin with, the game has a dynamic complexity.  As a measure of complexity, the value of the delay between the respawns of enemies is used, which depends on the level and number of players - the more these values ‚Äã‚Äãare, the faster the respawn will occur.  The respawn time in frames for a given level (numbering from zero) and the number of players can be calculated using the following formula: <code>190 - level * 4 - (player_count - 1) * 20</code> .  To get the time in seconds, simply multiply the result by 60. <br><br>  There are three periods of tank behavior: at first they move erratically, then they pursue the players, and, finally, they begin to attack the headquarters.  The duration of the first two periods is the same and equal to eight periods of respawn.  That is, dividing the respawn time by 8, we get the duration in seconds (or, multiplying by 8, we get the same time in frames) - for example, for the first level and one player it will be 23 seconds.  The third period will last until the seconds counter is reset (reaching 256) and the cycle of periods begins anew. <br><br>  All this enemy tactics are based on the command system, for which 8 bytes are allocated: two for the players' tanks and six for the enemy tanks.  The four high-order bits of such a byte are used for the command, the remaining four low-order ones are used for its arguments (as a rule, this is the direction of motion).  The result is 16 teams, for each of which there is a handler.  Handlers are called once per frame for each tank after movement has been processed. <br><br>  Surface consider the existing commands: <br><ul><li>  0 - NOP (no tank) </li><li>  1..7 - to process an explosion of a tank (by command for an animation frame) </li><li>  8 - process status (gliding on ice, etc.) </li><li>  9 - change direction </li><li>  A - check for tile border crossing </li><li>  B - move to headquarters </li><li>  C - move to the second player's tank </li><li>  D - move to the first player's tank </li><li>  E..F - spawn control commands </li></ul><br><br>  There is a function of changing direction, which, when called up, changes the direction of the tank randomly in the first period of behavior, in the second period it gives tanks with even numbers a command to move to the first player, from odd ones to the second one, and in the third one gives a command to move towards headquarters. <br><br>  When an enemy tank crosses the border of a tile (when both coordinates are multiples of eight), there is a 1/16 probability that this function will be called for the tank.  If the coordinates of the tank were not multiples of eight, or the function of changing direction was not called, and with all this the tank rests against an obstacle, then with probability 1/4 the following will occur: the tank will change direction to the opposite if at least one of the coordinates is not a multiple eight, otherwise the tank will be given the command to change direction. <br><br>  When executing the change direction command, something else happens: the function described above is called with probability 1/2, otherwise, with equal probabilities, either the previous or the following directions from the list are taken cyclically: up, left, down, right (i.e., the tank turns hour or counterclockwise). <br><br>  You can imagine all this logic in the form of such pseudocode: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">changeDirection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tank tank)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// period duration in seconds, respawn time in frames const int periodDuration = respawnTime / 8; if (time() &lt; periodDuration) { // first period tank.setRandomDirection(); tank.setCommand(cmdCheckTileReach); } else if (time() &lt; periodDuration * 2) { // second period if ((firstPlayer.isAlive &amp;&amp; tank.number % 2 == 0) || !secondPlayer.isAlive) { tank.setCommand(cmdMoveToFirstPlayer); } else { tank.setCommand(cmdMoveToSecondPlayer); } } else { // third period tank.setCommand(cmdMoveToEagle); } } void onCheckTileReachCommand(Tank tank) { if (!tank.isPlayer &amp;&amp; tank.x % 8 == 0 &amp;&amp; tank.y % 8 == 0 &amp;&amp; rand() % 16 == 0) { changeDirection(tank); } else if (!tank.isPlayer &amp;&amp; frontTile.isBarrier &amp;&amp; rand() % 4 == 0) { if (tank.x % 8 != 0 || tank.y % 8 != 0) { tank.invertDirection(); } else { tank.setCommand(cmdChangeDirection); } } } void onChangeDirectionCommand(Tank tank) { if (rand() % 2 == 0) { changeDirection(tank); } else if (rand() % 2 == 0) { tank.rotateClockwise(); } else { tank.rotateAnticlockwise(); } }</span></span></code> </pre><br><br>  An interesting situation is obtained when a tank rests against an obstacle or a wall - since in this case, even if the tank did not turn, one of the coordinates is always a multiple of eight and there is a tile obstacle in front of it, the probability of turning increases several times.  Therefore, the tanks practically do not get stuck on the spot: even getting into a corner or niche, they leave there pretty quickly. <br><br>  No less interesting is the situation with enemy shots.  By themselves, they occur completely apart from the tanks - each enemy has one bullet, and the shot in each frame itself decides whether to launch this bullet or not.  If the bullet is already in flight, the shot does not occur, otherwise there is a 1/32 chance that the tank will fire.  In this case, the bullet is on the front border of the tank at its center and inherits the direction of its tank. <br><br>  It should say a few words about the behavior of the players' tanks in the demonstration mode.  Everything is simple: if there are bonuses on the screen, the tanks tend to them (they can get stuck on the way if the bullet flies past the obstacles they are resting on).  Otherwise, they simply pursue the first available tank, and if there are no such tanks, they stand still.  Projectiles are manufactured according to the same rules as enemy tanks.  Fire on its own in demo mode does not give effect. <br><br><h2>  Collision handling </h2><br>  The collision calculation has always been a fairly resource-intensive task, which can be critical for a processor like the NES.  The calculation of the interaction between the tanks with the implementation "head on" would require to compare each pair of tanks, which, despite their small number, is still quite an expensive procedure for a processor with a clock frequency of 1.76 MHz.  But do not forget that in addition to tanks on the map and fired shells.  Therefore, the developers went to a rather interesting trick. <br><br>  The fact is that each tank ... "draws" under an invisible wall.  Thus, collision detection between tanks occurs at the collision detection stage between tanks and level elements, for which it suffices to determine whether there is an obstacle along a certain coordinate.  It also has side effects: many probably noticed that if you try to ‚Äúdrive‚Äù behind a tank moving forward, the player‚Äôs movement is blocked until the tank moves off for some distance - just at that moment he moves to the next tile, ‚Äúdrawing‚Äù a new one wall and "erasing" the old. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-0/w9/y3/-0w9y3y651r1zecp8huuldkmoti.png"></div><br><br>  The same effect can be noticed when a shell hits the tank.  Visually, contact occurs at different distances from the border of the tank's sprite (both inwards and outwards) - from 0 to 7 pixels.  But if tanks paint a wall under themselves, then bullets do not.  Moreover, the calculation of collisions between shells takes most of the frame time!  And in special cases it may not even be enough, then all these operations will be transferred to the next frame, and the current one will not be changed.  Those.  Yes, and in ‚ÄúTanchiki‚Äù there are lags. <br><br>  When a projectile hits one player differently, the second loses motion control for 192 frames, i.e.  for three seconds playing.  But in the demo mode this does not happen. <br><br>  It is noteworthy that the projectile has two points by which collisions are checked.  They are located on the sides of the nose of the bullet, and in fact two collisions can be processed simultaneously (otherwise, after detecting at least one of them, the projectile disappears).  This happens, for example, if you aim at the center of a brick block: a whole strip is destroyed. <br><br>  Another interesting thing: slow bullets (more detail about the speed below) are processed not every frame, but through the frame.  Theoretically, a situation may arise when the game will slow down in every odd frame, and the processor will not have time to reach the handling of collisions of such a bullet, postponing it.  But in the next frame, he will not have to handle it at all!  Due to a similar set of circumstances, slow bullets in some extreme cases can fly through the walls when the game slows down a lot. <br><br><h2>  Motion </h2><br>  The speed in the game is determined by the number of frames dropped when the coordinates change.  So, for example, the player's coordinate changes every three frames out of four, the fastest enemy in the game - each frame. <br><br>  The same applies to projectiles - there are two types of them: fast, flying at a speed of 4 pixels per frame, and slow, having a speed of 2 pixels per frame. <br><br><table><tbody><tr><td>  Tank </td><td>  Speed, px / frame </td><td>  Projectile type </td><td>  Tank </td><td>  Speed, px / frame </td><td>  Projectile type </td></tr><tr><td><img src="https://habrastorage.org/webt/xc/bo/ss/xcbossk_gu0-1ughcwr2enfllz4.png"></td><td>  3/4 </td><td>  Slow </td><td><img src="https://habrastorage.org/webt/3c/mp/uq/3cmpuqcgm1m7euprhocj0att45o.png"></td><td>  2/4 </td><td>  Slow </td></tr><tr><td><img src="https://habrastorage.org/webt/gp/_5/w7/gp_5w7dnnnzs-t-iayu2hikab_w.png"></td><td>  3/4 </td><td>  Fast </td><td><img src="https://habrastorage.org/webt/rn/0y/m-/rn0ym-s49thtx1ok9elk9-eb7b8.png"></td><td>  4/4 </td><td>  Slow </td></tr><tr><td><img src="https://habrastorage.org/webt/-c/cz/fj/-cczfjwfcciatdfmyaf1ypl7rnc.png"></td><td>  3/4 </td><td>  Fast </td><td><img src="https://habrastorage.org/webt/go/os/u7/goosu7jh4xw_zosnb6_owsgyemm.png"></td><td>  2/4 </td><td>  Fast </td></tr><tr><td><img src="https://habrastorage.org/webt/gz/px/68/gzpx68x8n80nlnrpxqq7ib1jbxa.png"></td><td>  3/4 </td><td>  Fast </td><td><img src="https://habrastorage.org/webt/gl/lf/6x/gllf6xsx6aod6n70nfpb9rqh6b0.png"></td><td>  2/4 </td><td>  Slow </td></tr></tbody></table><br><br>  Since it is necessary to handle collisions when moving, it would be appropriate to optimize the calculations, distributing them evenly across frames.  With the simplest approach, it would be sufficient to handle the movement of all enemies in even frames, and in odd frames, only the movement of the nimble BTR.  But then odd frames could be overloaded, and the game would just lag. <br><br>  In fact, the load is distributed quite cleverly.  A ‚ÄúXOR‚Äù is made between the frame number and the tank number, and only then the parity / oddity of the result is checked.  The result is that in even frames one half of the slow tanks is processed, and in odd frames, the other one. <br><br>  And some information about slipping on ice.  Everything is simple: after the player releases the direction button on the ice, the tank itself will go another 28 frames (i.e. it will pass 21 pixels) or until it leaves the ice.  During this period, the state of its caterpillar track does not change and the sound of the drive does not play, and if you press the direction button already on the ice, a characteristic sound will be played if the slip timer at that moment is zero. <br><br><h2>  Easter eggs </h2><br>  Easter eggs <a href="http://cah4e3.wordpress.com/2010/01/29/love-story/">are found</a> in many games of the time, they have not avoided Battle City. <br><br>  If on the title screen you select CONSTRUCTION mode, enter and exit it 7 times (by pressing START, START), then hold down the down button on the first joystick, press the second A button 8 times, then hold down the first joystick on the first joystick, on the second button B 12 times, and finally press the START button on the first joystick, then we will see a tragic love story. <br><br><img src="https://habrastorage.org/webt/gg/rl/eb/ggrlebz5yflrmr8twvjnjfsrmak.gif"><br><br>  In addition, in the game you can find unused data - the names of the developers (RYOUITI OOKUBO, TAKEFUMI HYOUDOU, JUNKO OZAWA) and hieroglyphs meaning the name of the protagonist lavstori and the name of the street (possibly on which he or his beloved lived). <br><br><img src="https://habrastorage.org/webt/rb/fx/gs/rbfxgsqtukiuhpxn4pok27leim4.png"><br><br>  Perhaps here I will not go into details, because it is described in detail in the link just above. <br><br><h2>  Epilogue </h2><br>  In conclusion, I want to say that before the creation of games was, in a sense, still a great art than it is now.  This is a tremendous skill - to meet the limitations of the hardware, and at the same time create a good game.  This is akin to the demoscene, which, in essence, pursues the same goals - to create masterpieces where it is difficult to imagine. <br><br>  Nowadays, all this is becoming a thing of the past, allowing us not to think too much about how to implement it.  In my opinion, this greatly lowers the threshold for entering the game development process, which gradually but surely turns it into an ordinary business rather than an art.  Although, perhaps, I'm just too aesthetic in this regard. </div><p>Source: <a href="https://habr.com/ru/post/142126/">https://habr.com/ru/post/142126/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142117/index.html">Do you format candid content?</a></li>
<li><a href="../142118/index.html">Enigma Encryption Machine in Excel</a></li>
<li><a href="../142120/index.html">62 useful tools for responsive design (Responsive web design)</a></li>
<li><a href="../142122/index.html">Simplified User Agreement (ToS)</a></li>
<li><a href="../142124/index.html">Release SBShop 1.0 - online store for MODX Evolution</a></li>
<li><a href="../142127/index.html">Creating Attached Property for BusyIndicator step by step</a></li>
<li><a href="../142128/index.html">Authentication in rails applications using facebook, vkontakte</a></li>
<li><a href="../142130/index.html">Epic Fail with VMWare Newsletters</a></li>
<li><a href="../142131/index.html">VolgaCTF as a member</a></li>
<li><a href="../142134/index.html">15 largest transactions on the Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>