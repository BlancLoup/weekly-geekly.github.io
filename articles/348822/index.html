<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mining in blockchain networks: how it works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In early January, the Chinese government ordered the country's "bitcoin miner" army, which generates 3/4 of the entire world cryptocurrency, to stop w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mining in blockchain networks: how it works</h1><div class="post__text post__text-html js-mediator-article">  In early January, the Chinese government <a href="http://www.straitstimes.com/business/companies-markets/china-quietly-orders-its-bitcoin-miners-to-cease-operations-widening">ordered the</a> country's "bitcoin miner" army, which generates 3/4 of the entire world cryptocurrency, to stop working.  One of the main reasons for this decision <a href="https://www.investopedia.com/news/china-intensifies-crackdown-bitcoin-mining/">was the</a> too high amount of electricity consumed by mining farms - now, for security of Bitcoin-blockchain and mining of coins, it <a href="https://digiconomist.net/bitcoin-energy-consumption">takes</a> about 0.2% of the total world energy consumption. <br><br>  Today let's talk about why mining consumes such amount of energy, why it is needed and how it is implemented.  We will talk about the hashing algorithm (SHA-256) and why miners ‚Äúlook for help‚Äù to pools. <br><br> <a href="https://habrahabr.ru/company/bitfury/blog/348822/"><img src="https://habrastorage.org/webt/t8/0q/23/t80q23o1lw3ow20azx04m8g5wo0.jpeg"></a> <a name="habracut"></a><br>  <font color="#A9A9A9"><i>/ image of <a href="https://www.flickr.com/photos/cindyshebley/36690169013/">Cindy Shebley</a> <a href="https://creativecommons.org/licenses/by/2.0/">CC</a></i></font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What is mining for? </h2><br>  Mining is often <a href="http://www.telegraph.co.uk/technology/0/bitcoin-mining-does-work-can-do-home/">considered a</a> way to create new bitcoins, but this is not entirely true.  The main task of mining is <a href="https://en.bitcoinwiki.org/wiki/Mining">to</a> achieve consensus on which transactions to be considered valid, in order not to allow someone from the network participants <a href="https://habrahabr.ru/company/bitfury/blog/346656/">to spend</a> coins already used in another transaction. <br><br>  For this, miners <a href="https://bitcoin.stackexchange.com/questions/8031/what-are-bitcoin-miners-really-solving">solve</a> complex math problems on their equipment and consume electricity, and in return receive bitcoin rewards (and transaction processing fees), which is an incentive to protect the blockchain further (now the network <a href="http://www.bitcoinblockhalf.com/">issues</a> 12.5 bitcoins for each block). <br><br><h2>  What is the work of miners </h2><br>  Miners are committed to selecting a hash value that would fit the transactions in the block and allow you to get the secret key.  The desired hash <a href="https://ru.bitcoinwiki.org/wiki/%25D0%259C%25D0%25B0%25D0%25B9%25D0%25BD%25D0%25B8%25D0%25BD%25D0%25B3">is formed based on the</a> hash of the previous block, the random number (nonce), and the sum of the transaction hashes over the past 10 minutes.  At the same time, it must satisfy the conditions of the system: meet the declared <a href="https://en.bitcoin.it/wiki/Difficulty">complexity of</a> mining (Difficulty) and be less than the <a href="https://en.bitcoin.it/wiki/Target">target complexity</a> (Target) - it <a href="https://medium.com/bitcoin-review/%25D0%25BA%25D1%2580%25D0%25B8%25D0%25BF%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BB%25D1%258E%25D1%2582%25D1%258B-%25D1%2582%25D0%25B5%25D1%2580%25D0%25BC%25D0%25B8%25D0%25BD%25D1%258B-%25D0%25B8-%25D1%2581%25D0%25BE%25D0%25BA%25D1%2580%25D0%25B0%25D1%2589%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F-27293b8413cc">determines the</a> number of zero bits at the beginning of the desired hash. <br><br>  To calculate the complexity of the hash, you can use an algorithm with decomposition into a modified Taylor series, which is listed <a href="https://en.bitcoin.it/wiki/Difficulty">on the</a> bitcoinwiki <a href="https://en.bitcoin.it/wiki/Difficulty">page</a> : <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; #include &lt;cmath&gt; inline float fast_log(float val) { int * const exp_ptr = reinterpret_cast &lt;int *&gt;(&amp;val); int x = *exp_ptr; const int log_2 = ((x &gt;&gt; 23) &amp; 255) - 128; x &amp;= ~(255 &lt;&lt; 23); x += 127 &lt;&lt; 23; *exp_ptr = x; val = ((-1.0f/3) * val + 2) * val - 2.0f/3; return ((val + log_2) * 0.69314718f); } float difficulty(unsigned int bits) { static double max_body = fast_log(0x00ffff), scaland = fast_log(256); return exp(max_body - fast_log(bits &amp; 0x00ffffff) + scaland * (0x1d - ((bits &amp; 0xff000000) &gt;&gt; 24))); } int main() { std::cout &lt;&lt; difficulty(0x1b0404cb) &lt;&lt; std::endl; return 0; }</span></span></span></span></code> </pre> <br>  At the time of writing, the complexity of the blockchain network <a href="https://blockexplorer.com/api/status%3Fq%3DgetDifficulty">is</a> : 2874674234415.941, however, this parameter is recalculated every 2016 blocks.  It is increased or decreased in order to <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25BB%25D0%25BE%25D0%25BA%25D1%2587%25D0%25B5%25D0%25B9%25D0%25BD">maintain the</a> average speed of creating blocks (approximately 6 pieces per hour). <br><br><h5>  SHA-256 </h5><br>  The SHA-256 algorithm was chosen as a tool for hashing in the bitcoin blockchain.  Next, we <a href="http://www.righto.com/2014/09/mining-bitcoin-with-pencil-and-paper.html">look at</a> one of his rounds. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ud/uv/on/uduvone2lux374n1ng6fyt8uteg.png" width="400"></div>  <font color="#A9A9A9"><i>/ Round SHA-256 for eight input words / Wikimedia / <a href="">kockmeyer</a> / <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC</a></i></font> <br><br>  Suppose that the algorithm was given eight words as input, denote them as A, B, C ... H. The function Ma performs bitwise operations with the words A, B and C - if most of the obtained values ‚Äã‚Äãare zero, it also returns zero, otherwise - one. <br><br>  The Œ£0 block shifts the word A three times: by 2, 13, and 22 bits, and the generated values ‚Äã‚Äãare added bit-wise by the xor operation.  Block Œ£1 works in a similar way - shifts are performed on 6, 11 and 25 bits. <br><br>  The Ch block is a function of selecting the result bit based on the bits in E. If the input value is one, then the output will receive the corresponding bit of the word F, otherwise the bit of the word G. <br><br>  The red squares in the diagram are blocks of 32-bit addition, which generate new values ‚Äã‚Äãfor A and E. The whole cycle repeats 64 times, after which the information is reliably encrypted. <br><br>  To illustrate the process of calculating the hash, <a href="https://gist.github.com/anonymous/887fc3180e1159753bb8e36409409d45">we give the code</a> in Python, which forms the hash of the words "Bl0Ckchain" and "blockchain": <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> itertools <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> hashlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sha256 <span class="hljs-comment"><span class="hljs-comment">#          to_long = lambda x: sum(ord(b) &lt;&lt; (8*i) for i, b in enumerate(x)) #       nonce  ; #   -   .    #  (":") ,  PoW   # . combine = lambda nonce, msg: str(nonce) + ":" + msg def verify_pow(msg, nonce, difficulty): h = sha256(combine(nonce, msg)).digest() return to_long(h) % (1 &lt;&lt; difficulty) == 0 def create_pow(msg, difficulty): for nonce in itertools.count(0): if verify_pow(msg, nonce, difficulty): return nonce def print_pow(msg, nonce): print combine(nonce, msg), sha256(combine(nonce, msg)).hexdigest() #---------------------------------------------------- msg = "Bl0Ckchain" nonce = create_pow(msg, 16) print_pow(msg, nonce) # 6571:Bl0Ckchain 0000d087d242930aaf6ac5a790ae8d8ece6b502cdb70ba07c1168738b253d279 assert verify_pow(msg, nonce, 16) msg = "blockchain" nonce = create_pow(msg, 16) print_pow(msg, nonce) # 43952:blockchain 000027b5022f88d2da21bd2802268966050f5a0b031058ce4562939c13727303 assert verify_pow(msg, nonce, 16) #        (1 &lt;&lt; difficulty), #      msg = "Bl0Ckchain" nonce = create_pow(msg, 16) print_pow(msg, nonce) # 6571:Bl0Ckchain 0000d087d242930aaf6ac5a790ae8d8ece6b502cdb70ba07c1168738b253d279 assert verify_pow(msg, nonce, 16)</span></span></code> </pre><br>  But checking created hashes is performed very quickly, even if a lot of resources were spent on their creation: <br><br><pre> <code class="python hljs">msg = <span class="hljs-string"><span class="hljs-string">"blockchain"</span></span> nonce = <span class="hljs-number"><span class="hljs-number">5263268363</span></span> print_pow(msg, nonce) <span class="hljs-comment"><span class="hljs-comment"># 5263268363:blockchain 000000007cf39dfc8fccae534b39b5f362c16891abca02d0e7b1dbd5a129ee17 assert verify_pow(msg, nonce, 32)</span></span></code> </pre><br>  The result of using the SHA-256 function is considered irreversible, therefore, the selection by the ‚Äútarget‚Äù hash miners is performed using brute force search. <br><br>  Since the bitcoin protocol uses double hashing, the miners' task <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D1%2582%25D0%25B0%25D0%25BA%25D0%25B0_%25D0%25BD%25D0%25B0%25D1%2585%25D0%25BE%25D0%25B6%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B0">is to</a> find the second hash type of x '(having the first type of x of the hash of y, where y = H (x)), which would satisfy the condition y = H (x').  However, in order to simplify the task, the miners are looking for only a partial preimage - H (x) / 2 ^ (nk) = 0.  Here n is the ‚Äúsize‚Äù of the result (n = 256 bits for SHA256), and k is the factor responsible for the number of zeros in the resulting hash.  For example, k = 20 will require about one million attempts. <br><br>  Thus, miners change the nonce parameter in the block header and consider the hash until the complexity conditions are met.  When the goal is reached, the block is added to the chain. <br><br><h2>  Mining - joint efforts of network members </h2><br>  The complexity of the decision block is extremely high.  Now miners in the bitcoin network <a href="https://blockchain.info/charts/hash-rate">perform</a> about 20 million terahesh per second, and this figure is growing.  For comparison, one video card <a href="http://www.techradar.com/news/best-mining-gpu">produces</a> about 30 megahesh per second.  Also on his blog, engineer Ken Shirriff (Ken Shirriff) <a href="http://www.righto.com/2014/09/mining-bitcoin-with-pencil-and-paper.html">tried to</a> solve the block with a pen and paper - his achievement was even more modest (0.67 hashes per day). <br><br><img src="https://habrastorage.org/webt/hz/cl/eo/hzcleo_ruktnf0fugr81yw21pw8.png"><br>  <font color="#A9A9A9"><i>/ Number of terahesh per second, according to <a href="https://blockchain.info/charts/hash-rate">blockchain.info</a></i></font> <br><br>  Because of the increased (and constantly growing) complexity, miners have a hard time deciding blocks alone.  Therefore, they are united in pools, where they divide the work on the decision of the block and reward.  Pools issue miners tasks and monitor the amount of work done.  The more contribution to the decision of the block was made by the miner, the greater share of the reward he will receive. <br><br>  To estimate the percentage of work done, the pool asks miners to send information about finding partial solutions.  For example, if a bitcoin blockchain <a href="http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html">requires a</a> block hash of 15 zeros, the pool can ask to send it results with 10 zeros as proof of work.  It is millions of times easier and the miner will receive such a decision several times an hour. <br><br>  Special protocols are responsible for organizing the interaction between the pool and miners.  For example, the <a href="http://mining.bitcoin.cz/stratum-mining">Stratum</a> protocol (still <a href="https://en.bitcoin.it/wiki/Getwork">Getwork</a> , <a href="https://en.bitcoin.it/wiki/Getblocktemplate">Getblocktemplate,</a> and others), which is <a href="https://steemit.com/pools/%40webik/a-list-of-the-main-pools-for-mining-bitcoin">used by</a> most pools.  In his blog, Ken Shirrif <a href="http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html">lists the</a> code sent by the pool when issuing the task, which contains all the necessary information to start working on the block. <br><br>  When a block is resolved, the pool forms the appropriate transaction to issue a reward, approves the header, and verifies the block.  If the block is decided by a miner who was outside the pool, the service gives the participants a new task.  In this case, the miners do not receive a reward for selecting a hash. <br><br>  At its core, bitcoin mining resembles a kind of "arms race."  At the very beginning, people mine cryptocurrency using a CPU, then the CPU power was not enough, and the industry switched to GPUs and <a href="http://bitfury.com/products">specialized</a> ASIC <a href="http://bitfury.com/products">equipment</a> . <br><br>  Note that increasing the complexity of computing, in addition to regulating the number of bitcoins produced, acts as a defense against attacks on the blockchain.  If mining using personal computers on a large-scale network turns out to be profitable, it <a href="https://habrahabr.ru/company/bitfury/blog/327468/">will be easier</a> for attackers <a href="https://habrahabr.ru/company/bitfury/blog/327468/">to</a> find equipment to attack.  The need to invest in "iron" acts as a limiting factor and an additional protective mechanism. <br><br>  But such a binding to technology and the "real world" has its drawbacks.  As already noted, mining is a fairly ‚Äúexpensive‚Äù activity in terms of energy consumption.  To date, Bitcoin blockchain <a href="https://digiconomist.net/bitcoin-energy-consumption">consumes</a> 48 TW / hour per year, with 30‚Äì40% of the energy used for cooling the chips. <br><br>  However, it <a href="https://www.cnbc.com/2017/12/21/no-bitcoin-is-likely-not-going-to-consume-all-the-worlds-energy-in-2020.html">is believed</a> that the amount of energy consumed will begin to gradually decline after 2020, when the next decrease in the block reward will occur, as mining will become less profitable.  In this case, an effective way to motivate miners to continue to protect information in the blockchain <a href="https://habrahabr.ru/company/bitfury/blog/346656/">remains</a> an increase in revenue from transaction processing fees. <br><br>  And for this, it is important to continue to increase public interest in the blockchain-based ecosystem.  This will allow in the future to use bitcoin-blockchain as a kind of ‚Äúarbiter‚Äù for <a href="https://habrahabr.ru/company/bitfury/blog/330370/">permissioned-blockchains</a> and <a href="https://habrahabr.ru/company/bitfury/blog/338222/">sidechains</a> , which will create a new generation financial system. <br><br><hr><br>  <i>We offer you a few more materials about the work of blockchains from our blog:</i> <i><br><br></i> <ul><li>  <i><a href="https://habrahabr.ru/company/bitfury/blog/346398/">How it works: Merkle trees in the bitcoin network</a></i> </li><li>  <i><a href="https://habrahabr.ru/company/bitfury/blog/342208/">How to create a blockchain project on Exonum: a quick guide</a></i> </li><li>  <i><a href="https://habrahabr.ru/company/bitfury/blog/344602/">Blockchain 101: Books, Research, and Related Articles</a></i> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/348822/">https://habr.com/ru/post/348822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348808/index.html">What's inside of HR? (Anatomy will not)</a></li>
<li><a href="../348810/index.html">We will help developers: advantages and disadvantages of loud, we will provide 1000 cloud servers in the Netherlands and the USA for free</a></li>
<li><a href="../348812/index.html">How not to become an honest mailer</a></li>
<li><a href="../348818/index.html">Amazing Angular</a></li>
<li><a href="../348820/index.html">Game development under NES in C. Chapters 7-10. Work with the joystick. Sprite collisions</a></li>
<li><a href="../348824/index.html">Google Chrome will start tagging all http pages as ‚Äúnot protected‚Äù with the release of Chrome 68 in July 2018</a></li>
<li><a href="../348828/index.html">Prototyping is easy how to assemble a puzzle. Multicomponent System Design in Figma</a></li>
<li><a href="../348830/index.html">Evolution of War: Total War II Series AI (Part 2)</a></li>
<li><a href="../348832/index.html">Service control panel. Part 3. Reconnaissance</a></li>
<li><a href="../348836/index.html">The digest of interesting materials for the mobile developer # 240 (February 5 ‚Äî February 11)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>