<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to optimize the online store. Part 1. Automatic calling of incoming leads</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A week after the previous article , where I talked about building a bot for Telegram, an online store of wristwatches asked me for advice, which by th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to optimize the online store. Part 1. Automatic calling of incoming leads</h1><div class="post__text post__text-html js-mediator-article">  A week after the <a href="http://habrahabr.ru/post/263875/">previous article</a> , where I talked about building a bot for Telegram, an online store of wristwatches asked me for advice, which by that time had already built some processes for its needs.  With the growth of business, they are faced with the problem of processing a large number of incoming requests, and depending on the quick response to an application, it depends on whether a person buys a product or not. <br><br>  Here I will describe their case for optimizing online store processes using Corezoid.com and give you open access a link to the process template described below. <br><br>  <b>What needs to be done:</b> <br>  1) Add a lead to CRM (in this case, Bitrix24) with filling in all the necessary additional fields. <br>  2) Notify sellers of the lead or error. <br>  3) Notify the client about the successfully accepted order, as well as tell about the additional action (try to warm up the client, raise the average bill). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>At the entrance we have:</b> <br>  1) The name and phone number of the client who is interested in our product. <br>  2) Defined by ip city of the client. <br>  3) client timezone. <br>  4) The identifier of the partner (ref-link in cookies), from which the request came. <br><br>  The solution was a bunch of API of several services through Corezoid.com, namely: Bitrix24 (CRM-system) + VoxImplant (service for callback implementation) + Telegram (messenger). <br><a name="habracut"></a><br>  To send a lead for processing in Corezoid, you need to make an API request from a php script that receives data from a web form on the site.  On their example, it looks like this: <br><br><pre><code class="javascript hljs">$data = (object) array(<span class="hljs-string"><span class="hljs-string">'server'</span></span>=&gt;$_SERVER,<span class="hljs-string"><span class="hljs-string">'cookies'</span></span>=&gt;$_COOKIE,<span class="hljs-string"><span class="hljs-string">'post'</span></span>=&gt;$_POST ); $full = (object) array(<span class="hljs-string"><span class="hljs-string">'ops'</span></span>=&gt; array( (object) array( <span class="hljs-string"><span class="hljs-string">'ref'</span></span>=&gt;$ip,<span class="hljs-string"><span class="hljs-string">'type'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'create'</span></span>,<span class="hljs-string"><span class="hljs-string">'obj'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'task'</span></span>,<span class="hljs-string"><span class="hljs-string">'conv_id'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'31754'</span></span>,<span class="hljs-string"><span class="hljs-string">'data'</span></span>=&gt; $data)) ); $cmd = ( json_encode( $full ) ); $str = <span class="hljs-string"><span class="hljs-string">"curl 'https://www.corezoid.com/api/1/json/public/31754/e4203ff8f55f17595a46549d35dbd00d51d0879d' -H 'Accept: application/json, text/javascript, */*; q=0.01' --data '"</span></span>.$cmd.<span class="hljs-string"><span class="hljs-string">"' --compressed"</span></span>; $res = shell_exec($str);</code> </pre> <br>  The $ data object is formed from the data that must be passed to Corezoid for processing. <br><br>  The $ ops object includes the ref (referense) parameter - a unique id under which the application will be fixed in Corezoid.  If at the moment there is already an application in the process of working with the same ref, the second one will not be added.  In this example, they use the ip-address of the client as a ref. <br><br>  The parameter conv_id is responsible for the formation of the task in a specific process (ID Process). <br><br>  The URL to which we will send the data and the conv_id of the process is taken from the property in the admin panel: <br><br><img src="https://habrastorage.org/files/cfc/989/24d/cfc98924ddf34ca495939bcd03f8cd75.png"><br><br>  <b>Application processing</b> <br><br>  First of all, the application gets into the starting node.  It is different from all green.  You can view this application and see the data that arrived at the entrance. <br><br><img src="https://habrastorage.org/files/4d2/04b/3b5/4d204b3b5b1c4b7489c3e283d54de7f2.png"><br><br>  Since the store actively uses the affiliate sales scheme, the first step is to determine from which partner the order came. <br><br>  Through API Bitrix24 we get the ID and data of this partner. <br>  For authorization in the API, the value of the ‚Äúauth‚Äù parameter is substituted by a construct that allows you to dynamically get the ‚Äúaccess_token‚Äù value from the process of its generation and update.  <a href="https://www.corezoid.com/how_to_use/plugins/ru/bitrix/autorizatoin.html">A detailed description of this process</a> in the documentation on Corezoid.com <br><br>  In this example, the data on the partner label is stored in the ‚Äúcookies‚Äù object in the ‚Äúutm_source‚Äù parameter, which the company tracks after clicking on the affiliate link.  Pass the value of this parameter to the API. <br><br><img src="https://habrastorage.org/files/c09/394/e93/c09394e938e84dd2a85e556a868fc905.png"><br><br>  The next step is for the CODE logic, in which the store handles the phone.  The processing consists in autostituting the first digit 8 by 7, and if the client has entered only 10 digits and the first one starts at 9, then 7 is added to the beginning in order for the phone to be correctly processed by the dialer script. <br><br><img src="https://habrastorage.org/files/942/0f1/d7a/9420f1d7aab84c3fb06cfeca765115b5.png"><br><br>  The next step is to send the application to a separate <a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25B4%25D0%25B0%25D0%25BB%25D1%2591%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B2%25D1%258B%25D0%25B7%25D0%25BE%25D0%25B2_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2586%25D0%25B5%25D0%25B4%25D1%2583%25D1%2580">RPC</a> ‚ÄúCreate new lead [RPC]‚Äù process.  He creates a lead in CRM and returns the lead ID.  The Corezoid documentation has a <a href="https://www.corezoid.com/how_to_use/plugins/ru/bitrix/new_lead.html">detailed description of this process</a> . <br><br><img src="https://habrastorage.org/files/9b0/bbd/52f/9b0bbd52f84943a0aab3c625f62bfc3b.png"><br><br>  If the lead is successfully created, the id will be returned to the variable lead_id. <br>  The next step is to copy the application into the process that will dial the client.  After copying, it will immediately proceed to the next step, without waiting for the return of any values ‚Äã‚Äãfrom the VoxImplant Robot Call process.  This is the main difference from an RPC request when data from another process is expected to return. <br><br>  First of all, the dialer logic adds a variable with the length of the phone through the CODE logic.  If the phone is longer than 11 digits, then it is sent to the final node, because the phone is too long. <br><br>  The next block receives the current time in the MSC in the variable timenow. <br><br><img src="https://habrastorage.org/files/a50/b67/4c8/a50b674c83e340c7b23ead6ac3df65bd.png"><br><br>  This is necessary so that if the lead came at night or early in the morning, the store would not disturb the customer with a night call, but simply send an SMS about the successfully accepted order and a message that they would call back during working hours. <br><br>  After the CODE logic in the same block, the time of day and the fact of sending SMS to the client is checked.  If the message was not sent and the time is not working, the application goes to the block "Send Night SMS".  Here the store sends an SMS to the client through the API logic and get the answer in the description variable.  Then they go to "sleep" in a timeout of 2 hours. <br><br><img src="https://habrastorage.org/files/3da/e6b/901/3dae6b901d7044cdb4cd752b1b9d0066.png"><br><br>  The application hanging in timeout looks like this: <br><br><img src="https://habrastorage.org/files/0b3/e5b/7ca/0b3e5b7ca2bd4af698fb50381f4de861.png"><br><br>  If the time is working, then you need to call the customer and report on the successfully accepted order, well, tell about the additional action. <br><br>  This task was implemented through API logic, which runs the script on the VoxImplant service. <br><br><img src="https://habrastorage.org/files/778/557/030/77855703051940a59cfa35cc9f718ef9.png"><br><br>  VoxImplant makes a call to the client and loses to it the prepared record of a successfully received order.  Additionally, the function of determining the answering machine is built into the code. <br><br>  <a href="http://jsfiddle.net/jqdr9npr/">{script code}</a> <br><br>  Then the request goes to the Callback logic in Corezoid, which expects a response from VoxImplant with the results of the call.  If we did not wait for an answer, something went wrong, and the application ‚Äúfalls‚Äù in manual processing.  If everything is ok, and VoxImplant sent the results, then we enter the process of distributing the results. <br><br>  If the number is incorrect, then the application goes to the final node, it makes no sense to call and send SMS to this number.  If the client did not pick up the phone or his phone is now turned off, then our application goes to the "Underdial" status and takes a timeout in half an hour. <br><br><img src="https://habrastorage.org/files/e70/bfe/1f5/e70bfe1f5bbb4e698b4a79d6ee777588.png"><br><br>  If the customer has successfully reached the customer, then we will additionally notify via SMS that his order has been successfully accepted, and close the application.  When determining the autoresponder by VoxImplant, the store also sends an SMS to the customer, but they do not ring any further, since it is not known when the customer picks up the phone and the store spends money on each call.  Additionally, in the logic you can embed a limit on the number of calls, as well as update the lead in CRM with the status of the call. <br><br><img src="https://habrastorage.org/files/5e5/007/255/5e5007255525438486fa097536bb5a07.png"><br><br>  The process also provides for a notification in the Telegram to the seller, if the main process when receiving the list of partners is an invalid token and you need to process the request manually.  And the notification of a successfully added lead.  And in the process for dashboards, with the help of the IF logic, the applications are distributed to the nodes according to the criteria that determine the partner or site and the total amount of orders from each partner. <br><br>  <i>In the following articles, I will describe other cases of using Corezoid in an online store and share templates:</i> <i><br><br></i> <ol><li>  <i>Affiliate program organization (Bitrix24 + Corezoid + Google Sheets);</i> </li><li>  <i>automation of courier service (MoySklad + Corezoid + Telegram);</i> </li><li>  <i>Check the status of the invoice (Cdek + Corezoid + Telegram);</i> </li><li>  <i>Bot - the controller of the execution of business processes (Telegram + Corezoid + Bitrix).</i> </li></ol> <i><br></i>  <i>About the most interesting, write in the comments.</i> <br><br>  The template described in the article is available <a href="https://www.corezoid.com/how_to_use/plugins/ru/internet-shop/auto_call_lead.html">by reference</a> .  And you can implement your own case studies of combining different services into a single ecosystem on <a href="https://www.corezoid.com/">Corezoid.com</a> . <br><br>  Have questions? <br>  You can contact me in the <a href="https://telegram.me/rogalskiya">Telegram</a> or by <a href="">e-mail.</a> </div><p>Source: <a href="https://habr.com/ru/post/267085/">https://habr.com/ru/post/267085/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267073/index.html">Vector Drawable API. Application possibilities</a></li>
<li><a href="../267075/index.html">Parsing the Digit Recognizer Challenge Kaggle Competitions</a></li>
<li><a href="../267079/index.html">Isn't it time for relational databases to fall into the dustbin of history?</a></li>
<li><a href="../267081/index.html">The results of the contest for the design of Mail.Ru mailing app on Dribbble</a></li>
<li><a href="../267083/index.html">How to improve resiliency of billing: The experience of "Hydra"</a></li>
<li><a href="../267087/index.html">FP on Scala: Invariant Functor</a></li>
<li><a href="../267091/index.html">The evolution of network communication methods. Part I</a></li>
<li><a href="../267093/index.html">Microsoft has released a major update for Windows RT</a></li>
<li><a href="../267095/index.html">Nginx: protect url one-time password</a></li>
<li><a href="../267097/index.html">Deploy Nginx Flask Application Using Gunicorn</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>