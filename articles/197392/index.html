<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Boost.Asio C ++ Network Programming". Chapter 7: Boost.Asio - additional topics</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 I continue to translate the book of John Torjo "Boost.Asio C ++ Network Programming". 

 Content: 


- Chapter 1: Getting Started with Boost....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Boost.Asio C ++ Network Programming". Chapter 7: Boost.Asio - additional topics</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  I continue to translate the book of John Torjo "Boost.Asio C ++ Network Programming". <br><br>  Content: <br><ul><li>  <a href="http://habrahabr.ru/post/192284/">Chapter 1: Getting Started with Boost.Asio</a> </li><li>  Chapter 2: Boost.Asio Basics <br><ul><li>  <a href="http://habrahabr.ru/post/193038/">Part 1: The Basics of Boost.Asio</a> </li><li>  <a href="http://habrahabr.ru/post/195006/">Part 2: Asynchronous Programming</a> </li></ul></li><li>  <a href="http://habrahabr.ru/post/195386/">Chapter 3: Echo Server / Client</a> </li><li>  <a href="http://habrahabr.ru/post/195794/">Chapter 4: Client and Server</a> </li><li>  <a href="http://habrahabr.ru/post/196354/">Chapter 5: Synchronous vs. Asynchronous</a> </li><li>  <a href="http://habrahabr.ru/post/196888/">Chapter 6: Boost.Asio - Other Features</a> </li><li>  <b>Chapter 7: Boost.Asio - additional topics</b> </li></ul><br><br>  This chapter covers some additional Boost.Asio topics.  It is unlikely that you will use it every day, but it will certainly not be out of place to know: <br><ul><li>  If debugging fails, then you will see that Boost.Asio will help you with this. </li><li>  If you have to work with SSL, then look what Boost.Asio has to offer you. </li><li>  If you are writing an application for a certain OC, then look at what additional functions are in Boost.Asio for you </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Asio vs Boost.Asio </h4><br>  Boost.Asio also provided support for Asio.  You can think of it as Asio, since this library comes in two versions, Asio (not Boost) and Boost.Asio.  The authors claim that updates will first appear in Asio, and will be added periodically to the Boost distribution. <br>  In a nutshell, the differences are as follows: <br><ul><li>  Asio is defined in the <code>asio::</code> namespace, while Boost.Asio is defined in <code>boost::asio::</code> </li><li>  The header file in Asio is <code>asio.hpp</code> and <code>boost/asio.hpp</code> in Boost.Asio </li><li>  Asio has its own class for running threads (equivalent to <code>boost::thread</code> ) </li><li>  Asio provides its classes for error codes ( <code>asio::error_code</code> instead of <code>boost::system::error_cod</code> and <code>asio::system_error</code> instead of <code>boost::system::system_error</code> ) </li></ul><br>  You can get more information on Asio <a href="http://think-async.com/">here</a> . <br>  You must decide for yourself which option you prefer;  I personally prefer Boost.Asio.  Here are a few things you should pay attention to when making your choice: <br><ul><li>  New versions of Asio are released more often than new versions of Boost.Asio (new distributions of Boost are released quite rarely) </li><li>  Asio is purely header (while part of Boost.Asio depends on other Boost libraries that may be needed for compilation) </li><li>  Both Asio and Boost.Asio are quite advanced, so if you are not eager to use the functions from the new release of Asio, then Boost.Asio is a pretty good alternative, especially since you will have other Boost libraries at your disposal. </li></ul><br>  You can use Asio and Boost.Asio in the same application, although I do not recommend you do this.  This may not work out intentionally, in this case everything will be fine, for example, if you use Asio, and some third-party libraries use Boost.Asio and vice versa. <br><br><h4>  Debugging </h4><br>  Debugging a synchronous application is usually simpler than an asynchronous application.  For a synchronous application, if it is blocked, you will simply enter debugging and get a picture of where it happened (synchronous means consecutive).  However, when you program asynchronously, events do not occur sequentially, so if an error occurs, it will be really difficult to catch it. <br>  To avoid this, first, you must understand coroutines very well.  If the program is implemented correctly, then you practically will have no problems at all. <br>  Only when it comes to asynchronous programming, Boost.Asio will give you a helping hand;  Boost.Asio allows you to track handlers if the <code>BOOST_ASIO_ENABLE_HANDLER_TRACKING</code> macro is <code>BOOST_ASIO_ENABLE_HANDLER_TRACKING</code> .  If this is the case, then Boost.Asio contributes to the output of information to the standard error output stream, recording the time, asynchronous operation and, related to it, the final handler. <br><br><h4>  Handler tracking information </h4><br>  Information is not so easy to understand, but nevertheless it is very useful.  The output of Boost.Asio gives the following: <br><br><pre> <code class="cpp hljs">@asio|&lt;timestamp&gt;|&lt;action&gt;|&lt;description&gt;.</code> </pre><br>  The first tag is always <code>@asio</code> , you can use it to easily filter messages coming from Boost.Asio in case other sources write to the standard error stream (equivalent to <code>std::cerr</code> ).  The <code>timestamp</code> instance is counted in seconds and microseconds, starting January 1, 1970 UTC.  An <code>action</code> instance can be one of the following: <br><ul><li>  <code>&gt;n</code> : used when we enter handler number n.  The <code>description</code> instance contains the arguments passed to the handler. </li><li>  <code>&lt;n</code> : Used when handler number n is closed. </li><li>  <code>!n</code> : used when we left handler n due to an exception. </li><li>  <code>~n</code> : used when handler number n is destroyed without a call;  probably because the <code>io_service</code> instance is <code>io_service</code> destroyed too early (before n gets a chance to call out). </li><li>  <code>n*m</code> : used when handler n creates a new asynchronous operation with a trailing handler numbered m.  After the start, the started asynchronous operation will be displayed in the <code>description</code> instance.  The final handler will be called when you see <code>&gt;m(start)</code> and <code>&lt;m(end)</code> . </li><li>  <code>n</code> : used when handler number n performs an operation that is displayed on <code>description</code> (which can be a <code>close</code> or a <code>cancel</code> operation).  Usually, you can safely ignore them. </li></ul><br>  Whenever n = 0, then all the handlers are executed from the outside (asynchronously), usually you see when the first operation (operations) is performed or if you work with signals and the signal is triggered. <br>  You should pay attention to the messages like <code>!n</code> and <code>~n</code> , which occur when there are errors in the code.  In the first case, the asynchronous function did not throw an exception, so the exception must be generated by you; you should not allow exceptions when exiting your final handler.  In the latter case, you probably destroyed the <code>io_service</code> instance too early, before all the called handlers were completed. <br><br><h4>  Example </h4><br>  In order to show you an example of supporting information, let me change the example from Chapter 6.  All you need to do is add an additional <code>#define</code> before enabling <code>boost/asio.hpp</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BOOST_ASIO_ENABLE_HANDLER_TRACKING #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;boost/asio.hpp&gt; ...</span></span></span></span></code> </pre><br>  We will also dump the console to the console when the user logs in and receives the first client list.  The output will be as follows: <br><br><pre> <code class="cpp hljs">@asio|<span class="hljs-number"><span class="hljs-number">1355603116.602867</span></span>|<span class="hljs-number"><span class="hljs-number">0</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>|socket@<span class="hljs-number"><span class="hljs-number">008</span></span>D4EF8.async_connect @asio|<span class="hljs-number"><span class="hljs-number">1355603116.604867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>|ec=system:<span class="hljs-number"><span class="hljs-number">0</span></span> @asio|<span class="hljs-number"><span class="hljs-number">1355603116.604867</span></span>|<span class="hljs-number"><span class="hljs-number">1</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>|socket@<span class="hljs-number"><span class="hljs-number">008</span></span>D4EF8.async_send @asio|<span class="hljs-number"><span class="hljs-number">1355603116.604867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.604867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">2</span></span>|ec=system:<span class="hljs-number"><span class="hljs-number">0</span></span>,bytes_transferred=<span class="hljs-number"><span class="hljs-number">11</span></span> @asio|<span class="hljs-number"><span class="hljs-number">1355603116.604867</span></span>|<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">3</span></span>|socket@<span class="hljs-number"><span class="hljs-number">008</span></span>D4EF8.async_receive @asio|<span class="hljs-number"><span class="hljs-number">1355603116.604867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">2</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.605867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">3</span></span>|ec=system:<span class="hljs-number"><span class="hljs-number">0</span></span>,bytes_transferred=<span class="hljs-number"><span class="hljs-number">9</span></span> @asio|<span class="hljs-number"><span class="hljs-number">1355603116.605867</span></span>|<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">4</span></span>|io_service@<span class="hljs-number"><span class="hljs-number">008</span></span>D4BC8.post @asio|<span class="hljs-number"><span class="hljs-number">1355603116.605867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.605867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">4</span></span>| John logged in @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|<span class="hljs-number"><span class="hljs-number">4</span></span>*<span class="hljs-number"><span class="hljs-number">5</span></span>|io_service@<span class="hljs-number"><span class="hljs-number">008</span></span>D4BC8.post @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">5</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|<span class="hljs-number"><span class="hljs-number">5</span></span>*<span class="hljs-number"><span class="hljs-number">6</span></span>|socket@<span class="hljs-number"><span class="hljs-number">008</span></span>D4EF8.async_send @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">6</span></span>|ec=system:<span class="hljs-number"><span class="hljs-number">0</span></span>,bytes_transferred=<span class="hljs-number"><span class="hljs-number">12</span></span> @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|<span class="hljs-number"><span class="hljs-number">6</span></span>*<span class="hljs-number"><span class="hljs-number">7</span></span>|socket@<span class="hljs-number"><span class="hljs-number">008</span></span>D4EF8.async_receive @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>|ec=system:<span class="hljs-number"><span class="hljs-number">0</span></span>,bytes_transferred=<span class="hljs-number"><span class="hljs-number">14</span></span> @asio|<span class="hljs-number"><span class="hljs-number">1355603116.606867</span></span>|<span class="hljs-number"><span class="hljs-number">7</span></span>*<span class="hljs-number"><span class="hljs-number">8</span></span>|io_service@<span class="hljs-number"><span class="hljs-number">008</span></span>D4BC8.post @asio|<span class="hljs-number"><span class="hljs-number">1355603116.607867</span></span>|&lt;<span class="hljs-number"><span class="hljs-number">7</span></span>| @asio|<span class="hljs-number"><span class="hljs-number">1355603116.607867</span></span>|&gt;<span class="hljs-number"><span class="hljs-number">8</span></span>| John, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> client <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>: John</code> </pre><br>  Let me analyze each line: <br><ul><li>  We enter <code>async_connect</code> , which creates handler 1 (in our case, everyone processes <code>talk_to_svr::step</code> ) </li><li>  Handler 1 is called (after successfully connecting to the server) </li><li>  Handler 1 calls <code>async_send</code> , which creates handler 2 (here we send a message with login to the server) </li><li>  Handler 1 is closing </li><li>  Handler 2 is called and sends 11 bytes ( <code>login John</code> ) </li><li>  Handler 2 calls <code>async_receive</code> , which creates handler 3 (we are waiting for the server to respond to our login message) </li><li>  Handler 2 closes </li><li>  Handler 3 is called and gets 9 bytes ( <code>login ok</code> ) </li><li>  Handler 3 redirects to <code>on_answer_from_server</code> (where handler 4 is created) </li><li>  Handler 3 closes </li><li>  Handler 4 is called, which is then <code>John logged in</code> to the dump <code>John logged in</code> </li><li>  Handler 4 starts another <code>step</code> (handler 5), which will write <code>ask_clients</code> </li><li>  Handler 4 closes </li><li>  Handler 5 opens </li><li>  Handler 5, <code>async_send</code> <code>ask_clients</code> , creates handler 6 </li><li>  Handler 5 closes </li><li>  Handler 6 is <code>ask_clients</code> (we have successfully sent <code>ask_clients</code> server) </li><li>  Handler 6 calls <code>async_receive</code> , which creates handler 7 (we are waiting for the server to send us a list of existing clients) </li><li>  Handler 6 closes </li><li>  Handler 7 is called, and we accept a client list </li><li>  Handler 7 runs <code>on_answer_from_serve</code> (where handler 8 is created) </li><li>  Handler 7 closes </li><li>  Handler 8 is <code>on_clients</code> , and a list of clients is written to the dump ( <code>on_clients</code> ) </li></ul><br>  It will take some time to get used to, but once you understand this, you can isolate the output that contains the problem and find the actual part of the code that needs to be fixed. <br><br><h4>  Writing handler tracking information to a file </h4><br>  By default, the tracking information for handlers is output to the standard error stream (equivalent to <code>std::cerr</code> ).  It is very likely that you will want to redirect this output to another location.  On the one hand, by default, for console applications, the output and reset of errors occurs in one place, that is, in the console.  But for Windows (non-console) applications, the default error flow is empty. <br>  You can redirect error output using the command line, for example: <br><br><pre> <code class="cpp hljs">some_application <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;err.txt</code> </pre><br>  If you are not lazy, you can do it programmatically, as shown in the following code snippet: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// for Windows HANDLE h = CreateFile("err.txt", GENERIC_WRITE, 0, 0, CREATE_ALWAYS, FILE_ATTRIBUTE_NORMAL , 0); SetStdHandle(STD_ERROR_HANDLE, h); // for Unix int err_file = open("err.txt", O_WRONLY); dup2(err_file, STDERR_FILENO);</span></span></code> </pre><br><br><h4>  SSL </h4><br>  Boost.Asio provides classes for supporting some basic SSL features.  Inside she uses <code>OpenSSL</code> .  So if you want to use SSL, first download and build <a href="http://www.openssl.org/">OpenSSL</a> .  It should be noted that, as a rule, building <code>OpenSSL</code> is no easy task, especially if you do not have popular compilers, such as Visual Studio. <br>  If you have successfully compiled <code>OpenSSL</code> , then Boost.Asio has some add-on classes over it: <br><ul><li>  <code>ssl::stream</code> : used instead of class <code>ip::::socket</code> <br>  <code>ssl::context</code> : this is the context for starting a session <br>  <code>ssl::rfc2818_verification</code> : this class is an easy way to verify a certificate for a host name in accordance with RFC 2818 rules <br></li><br><br>  In the next few articles I want to offer translations of the first chapters of several books (three, maybe 4), which one you like more, I will continue to translate the first one. <br><br>  Thank you all, until we meet again! </ul></div><p>Source: <a href="https://habr.com/ru/post/197392/">https://habr.com/ru/post/197392/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197380/index.html">With a camera in the clouds. Part 2</a></li>
<li><a href="../197382/index.html">Future through the eyes of Eric Schmidt: ‚ÄúThe New Digital World‚Äù</a></li>
<li><a href="../197384/index.html">Acronis True Image backup methods</a></li>
<li><a href="../197388/index.html">Instagram Drama - fan lock accounts</a></li>
<li><a href="../197390/index.html">Office of the future on about. Russian - how we implemented IT systems</a></li>
<li><a href="../197398/index.html">Imagination like that of esmeralda</a></li>
<li><a href="../197402/index.html">What gives startup IDCEE 2013 Startup Alley</a></li>
<li><a href="../197412/index.html">Samsung galaxy note 10.1 n8020 and yota</a></li>
<li><a href="../197414/index.html">Protecting the site from spammers and account hijacking</a></li>
<li><a href="../197416/index.html">Writing an HTML5 game in 20 minutes, or an introduction to the Phaser framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>