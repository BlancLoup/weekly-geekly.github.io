<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We roll the "resin ball" or create your own assembly rules using Qbs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Qbs (Qt Build System) is a build system that allows you to describe the process of building projects in a simple language QML (javascript-like declara...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We roll the "resin ball" or create your own assembly rules using Qbs</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://doc.qt.io/qbs/index.html">Qbs</a> (Qt Build System) is a build system that allows you to describe the process of building projects in a simple language QML (javascript-like declarative language), which accelerates the process of building products by building a detailed dependency graph.  Although this system was created by Qt developers, it is not strictly tied to Qt and allows you to build any products for any programming languages ‚Äã‚Äãand even use them not for programming, for example, for administration.  As stated in the official documentation: <br><blockquote>  A, a ball game </blockquote><br>  Today and consider the process of creating your products.  Go‚Ä¶ <br><a name="habracut"></a><br>  Getting to know this build system was well described by <a href="https://habrahabr.ru/users/mapron/" class="user_link">mapron</a> in <a href="https://habrahabr.ru/post/144127/">this article</a> , but we will not dwell on this and get down to business right away. <br><br>  Unfortunately, there is too little information in the documentation and the network about the details of how Qbs works and the meaning of the properties of the elements.  Therefore, I will try to fill in some of the gaps in this, based on my experience with this assembly system.  And I will be grateful to readers for the addition or indication of inaccuracies in this material. <br><br>  So Qbs converts one data to another using the <b><a href="https://doc.qt.io/qbs/rule-item.html">Rule</a></b> element.  This element creates a conversion rule that converts input <b>inputs</b> into output <b>outputs</b> using a set of commands created in the <b>prepare</b> script.  Each team can either transform itself or delegate this work to an external program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Input artifacts </h3><br>  The input artifacts for the transformation rule are the files of the product being assembled with the tag specified in the <b>inputs</b> property, as well as artifacts obtained from the dependencies of the product being assembled with the tag specified in the <b>inputsFromDependencies</b> property (the implicit " <b><i>installable</i></b> " tag is assigned to all files that need to be installed, t. e. <i><b>qbs.install: true</b></i> ). <br><br>  For example: <br><br><pre><code class="javascript hljs">---product1.qbs--- Application { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simpleApplication"</span></span>; targetName: <span class="hljs-string"><span class="hljs-string">"appSimple"</span></span> files: [<span class="hljs-string"><span class="hljs-string">"main.cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"app.h"</span></span>, <span class="hljs-string"><span class="hljs-string">"app.cpp"</span></span>] Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"cpp"</span></span>} } ---product2.qbs--- Product { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"exampleArtefact"</span></span> name: <span class="hljs-string"><span class="hljs-string">"example"</span></span> targetName: <span class="hljs-string"><span class="hljs-string">"myArtefact"</span></span> Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"simpleApplication"</span></span> } Depends {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"exampleModule"</span></span> } Group { <span class="hljs-attr"><span class="hljs-attr">files</span></span>: [<span class="hljs-string"><span class="hljs-string">"description.txt"</span></span>, <span class="hljs-string"><span class="hljs-string">"readme.txt"</span></span>] fileTags: [<span class="hljs-string"><span class="hljs-string">"txtFiles"</span></span>] } Group { <span class="hljs-attr"><span class="hljs-attr">files</span></span>: [<span class="hljs-string"><span class="hljs-string">"imgA.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"imgB.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"imgC.png"</span></span>] fileTags: [<span class="hljs-string"><span class="hljs-string">"pngFiles"</span></span>] } Group { <span class="hljs-attr"><span class="hljs-attr">files</span></span>: [<span class="hljs-string"><span class="hljs-string">"fontA.ttf"</span></span>, <span class="hljs-string"><span class="hljs-string">"fontB.ttf"</span></span>] fileTags: [<span class="hljs-string"><span class="hljs-string">"fontFiles"</span></span>] } } ---exampleModule.qbs--- Module { Rule { <span class="hljs-attr"><span class="hljs-attr">inputs</span></span>: [<span class="hljs-string"><span class="hljs-string">"pngFiles"</span></span>, <span class="hljs-string"><span class="hljs-string">"fontFiles"</span></span>] inputsFromDependencies: [<span class="hljs-string"><span class="hljs-string">"application"</span></span>] Artifact { <span class="hljs-attr"><span class="hljs-attr">filePath</span></span>: product.targetName + <span class="hljs-string"><span class="hljs-string">".out"</span></span> fileTags: [<span class="hljs-string"><span class="hljs-string">"exampleArtefact"</span></span>] } ... } ... }</code> </pre> <br>  In this example, we have 2 products and 1 module: <br><br><ol><li>  A product named <b>simpleApplication is of</b> type application (the Application element is essentially <i><b>Product {type: ‚Äúapplication‚Äù}</b></i> ) containing 3 files: main.cpp, app.h, app.cpp.  This product depends on the cpp module, which indicates that this product will be compiled by the C ++ compiler and the output will be an artifact labeled ‚Äúapplication‚Äù and the name specified in the targetName property, i.e.  appSimple.exe (for windows or appSimple for unix platforms). <br><br></li><li>  A product named <b>example</b> has type exampleArtefact containing 7 files tagged with three tags.  This product depends on the simpleApplication product, which indicates that it will be processed after creating the simpleApplication product.  And also from the module exampleModule, which indicates that the rules of transformation and properties from this module will be taken to create this product.  And the output is expected artifact called myArtefact type (tagged) exampleArtefact. <br><br></li><li>  The module <b>exampleModule</b> contains a rule for converting files with pngFiles and fontFiles tags, as well as artifacts with application tags, which are taken from the dependencies of the collected product. <br></li></ol><br>  When assembling a product, a list of modules will be defined on which the product and the modules themselves depend.  They will search for rules for converting files marked with input tags to output artifacts that correspond to the type of product being collected.  At first, the product is simpleApplication, because  it only depends on the cpp module.  It looks for rules for converting product files to the type of application.  In the cpp module, there are <a href="https://doc.qt.io/qbs/filetagger-item.html">FileTagger</a> elements that use template tags for product files.  Conversion of input files to output (s) can be performed both immediately and along the chain of conversions of files of one type to another, and then to the final one.  At the output of processing the product simpleApplication, we get an appSimple application having the type (tag) of application. <br><br>  Then build the example product will begin.  For its files, a rule will be searched for, giving output artifacts of the type exampleArtefact.  This rule requires for the input files of type (with tag) pngFiles, fontFiles and application.  At the same time, files of type application are searched only in products on which the product being built depends.  Since the product example already contains such files, the following files come into the rule: imgA.png, imgB.png, imgC.png, fontA.ttf, fontB.ttf and appSimple.exe.  And at the output we get the file myArtefact.out of type exampleArtefact, which will be our final product. <br><br><h3>  Output Artifacts </h3><br>  As an output artifact for a rule, there can be one or several artifacts.  The <b><a href="https://doc.qt.io/qbs/artifact-item.html">Artifact</a></b> element is used to describe output artifacts: <br><br><pre> <code class="javascript hljs">Artifact { <span class="hljs-attr"><span class="hljs-attr">filePath</span></span>: input.fileName + <span class="hljs-string"><span class="hljs-string">".out"</span></span> fileTags: [<span class="hljs-string"><span class="hljs-string">"txt_output"</span></span>] }</code> </pre> <br>  This element describes what kind of artifact is produced at the output of the rule.  Through the property <b>filePath</b> - specify the name of the output file.  If you specify a relative path, Qbs will create this artifact relative to the build directory of the current product being built.  The <b>fileTags</b> property specifies the list of tags that the artifact will have after it is created.  This is necessary so that other build rules can use the output artifacts of this rule as their input artifacts.  Also, if the product will have the same tag as its type, then these artifacts will be the result of the assembly of this product. <br><br>  Each rule must have at least one output tag, otherwise the rule will not work.  If there are several artifacts, then you can describe several Artifact elements, or you can use the outputArtifacts and outputFileTags properties for the Rule element. <br><br>  The <b>outputArtifacts</b> property describes a list of JavaScript objects with properties similar to those of the Artifact element.  This property is used for cases when the set of outputs is not fixed, but depends on the content of the input data.  For example: <br><br><pre> <code class="javascript hljs">outputArtifacts: [{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> artifactNames = inputs[<span class="hljs-string"><span class="hljs-string">"pngFiles"</span></span>].map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"pictures/"</span></span>+file.fileName; }); artifactNames = artifactNames.concat(inputs[<span class="hljs-string"><span class="hljs-string">"fontFiles"</span></span>].map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"fonts/"</span></span>+file.fileName; })); artifactNames = artifactNames.concat(inputs[<span class="hljs-string"><span class="hljs-string">"application"</span></span>].map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"app/"</span></span>+file.fileName; })); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> artifacts = artifactNames.map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">art</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = { <span class="hljs-attr"><span class="hljs-attr">filePath</span></span>: art, <span class="hljs-attr"><span class="hljs-attr">fileTags</span></span>: [<span class="hljs-string"><span class="hljs-string">"exampleArtefact"</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> artifacts; }]</code> </pre> <br>  This example shows that for input files with the pngFiles tag, the rule will prepare an output artifact with the same name and place it in the pictures folder.  For the fontFiles and application tags, also placing them respectively in the fonts and app folders.  In this case, because  If the paths are relative, then these folders will be created in the product assembly folder. <br><br>  If we decide to use the outputArtifacts property, then we must also specify the <b>outputFileTags</b> property, which is the list of output tags that the rule potentially produces.  For our example: <br><br><pre> <code class="javascript hljs">outputFileTags: [<span class="hljs-string"><span class="hljs-string">"exampleArtefact"</span></span>]</code> </pre> <br>  All artifacts obtained during product assembly, marked with an output tag that matches the product type, during product installation, will be copied from the assembly directory to the installation directory. <br><br><h3>  Conversion rule </h3><br>  When the input and output artifacts are defined, it is necessary to prepare the sequence of commands to perform the conversion.  The <b>prepare</b> property of the Rule element is used for this.  This property is a JavaScript script that returns a list of commands for converting inputs to outputs.  The code in this script is treated as a function with the <i><b>function (project, product, inputs, outputs, input, output)</b></i> signature. <br>  The <b>input</b> and <b>output</b> parameters are undefined (undefined) if there are several input (and output) artifacts for this rule.  They serve as syntactic sugar: input = inputs [0] and output = outputs [0] and are lists with one element.  The <b>project</b> and <b>product</b> parameters are JavaScript objects through which the properties of the current project and product are accessible, respectively.  Of particular interest are the inputs and outputs.  Consider them in more detail. <br><br><h4>  Input and output objects </h4><br>  The <b>inputs</b> and <b>outputs</b> parameters are JavaScript objects, whose property keys are file tags, and property values ‚Äã‚Äãare lists of objects representing the artifacts corresponding to these tags.  In our example, the inputs variable has 3 keys: pngFiles, fontFiles, application.  And each input artifact is available through the inputs [‚ÄúpngFiles‚Äù] (or inputs.pngFiles, which is equivalent).  Each artifact in this list has the following properties: <br><br><ul><li>  <b>baseName</b> - the base name of the file (for example, for the file c: \ 123 \ test.plugin.dll it will be a test) </li><li>  <b>completeBaseName</b> - the name of the file without the extension (for example, for the file c: \ 123 \ test.plugin.dll it will be test.plugin) </li><li>  <b>fileName</b> - the name of the file (for example, for the file c: \ 123 \ test.plugin.dll it will be test.plugin.dll) </li><li>  <b>filePath</b> - the full path to the file with its full name </li><li>  <b>fileTags</b> - list of tags assigned to the artifact </li></ul><br>  In addition, the artifacts contain all the properties for each module that is used in the product.  This feature can be used to access module properties.  For example, the <i><b>inputs.application [0] .cpp.defines property</b></i> returns for the simpleApplication artifact a list of definitions that will be transferred when the corresponding file is compiled.  This is a very convenient and important point, allowing artifacts to set their values ‚Äã‚Äãthrough the properties of a module and group such artifacts or process them in a special way. <br><br>  <i>* It was noticed on Qbs version 1.7.2 that if the product replaces the properties of the module that contains the build rule, then these properties are not available in the artifact.</i>  <i>Therefore, I carried these properties into a separate module.</i> <i><br><br></i>  <i>* Also inputs.application [0] .cpp.defines does not always work, that's why I use the function <b>inputs.application [0] .moduleProperty ("cpp", "defines")</b> .</i>  <i>If this function is applied to the input artifact, then the properties that the <b>artifact</b> uses in the specified module will be returned.</i>  <i>If we apply it to the product (for example, product.moduleProperty ("cpp", "defines"), then the properties of the specified module will be returned, which the final <b>product</b> currently being assembled uses.</i> <br><br>  <i>* A very convenient function is <b>dumpObject (object)</b> from the ModUtils module, which displays information about the properties of the parameter passed to it to the console.</i>  <i>True, and it does not always show the properties of the modules used in the artifacts.</i> <br><br><h4>  Teams </h4><br>  The result of the script is a list of commands.  The command is what Qbs performs at build time.  The command is always created in the rule preparation script.  Teams are of two types: <br><br><ol><li>  <b>Command</b> that starts an external process </li><li>  <b>JavaScriptCommand</b> , which executes arbitrary javascript code (although it can also run external processes) </li></ol><br>  Properties are available for both types of commands: <br><br><ul><li>  <b>description</b> - the string displayed in the console when executing this command. </li><li>  <b>extendedDescription</b> - a string of detailed information displayed in the console with extended output </li><li>  <b>highlight</b> - type (tag) command.  It affects how the description will be displayed in the console.  Maybe: compiler, linker, codegen, filegen, etc. </li><li>  <b>silent</b> - whether to hide the description description when executing the command </li></ul><br>  To use <b>Command</b> , you need to create an object by passing in its constructor the full path to the executable program and the list of arguments. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> myCommand = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Command(<span class="hljs-string"><span class="hljs-string">"dir"</span></span>, [<span class="hljs-string"><span class="hljs-string">"/B"</span></span>, <span class="hljs-string"><span class="hljs-string">"/O"</span></span>, <span class="hljs-string"><span class="hljs-string">"&gt;&gt;"</span></span>, output.filePath]);</code> </pre> <br>  For example, this command will write the output of the dir command to the output file of the build rule. <br>  Useful properties that allow you to bypass the Windows restriction on the length of the command line are properties: <br><br><ul><li>  <b>responseFileThreshold</b> contains a value.  If this value is greater than zero and less than the length of the full command line, and if responseFileUsagePrefix is ‚Äã‚Äãnot empty, then the contents of the command line are moved to a temporary file whose path becomes the full contents of the argument list.  Then the program should read the full list of arguments from this file.  This mechanism will only work with programs that explicitly support it. </li><li>  <b>responseFileArgumentIndex</b> ‚Äî Indicates the index of the first argument to include in the response file. </li><li>  <b>responseFileUsagePrefix</b> - contains a prefix that tells the program that the rest of the argument is the path to the file containing the actual command line. <br></li></ul><br>  The following properties can be used to process the output of the command being executed: <br><br><ul><li>  <b>stderrFilterFunction</b> is a function with an input parameter equal to the output of the program in stderr and which should return the converted string for further output. <br>  If not specified, no processing will be performed. </li><li>  <b>stdoutFilterFunction</b> - similar to stderrFilePath, only working with stdout </li><li>  <b>stdoutFilePath</b> - the name of the file; the code is sent to the previously filtered output of stdout.  If not specified, output will be made to the console. </li><li>  <b>stderrFilePath</b> - similar to stdoutFilePath, only works with stderr </li></ul><br>  <b>JavaScriptCommand</b> command - is a JavaScript function that will be executed during assembly.  This function is set in the <b>sourceCode</b> property.  In the source code, functions are available project, product, inputs and outputs (giving access to the properties of the project, product, input and output artifacts, respectively).  To pass arbitrary data to the function, you need to add arbitrary properties for the command and assign the desired values ‚Äã‚Äãto them.  For example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> JavaScriptCommand(); cmd.myFirstData = <span class="hljs-string"><span class="hljs-string">"This is 1 string"</span></span>; cmd.mySecondData = <span class="hljs-string"><span class="hljs-string">"This is 2 string"</span></span>; cmd.sourceCode = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.info(<span class="hljs-string"><span class="hljs-string">"String from source code"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// --&gt;&gt; "String from source code" console.info("Property 1: "+myFirstData); // --&gt;&gt; "Property 1: This is 1 string" console.info("Property 2: "+mySecondData); // --&gt;&gt; "Property 2: This is 2 string" };</span></span></code> </pre> <br>  In the function, you can also use various <a href="https://doc.qt.io/qbs/list-of-builtin-services.html">available services</a> : <br><br><ul><li>  <b>Environment Service</b> - to access the system and development environment </li><li>  <b>File Service</b> - for working with files (copying, moving, deleting files, checking for the existence of a file and the date of modification, creating paths and scanning the directory for contents) </li><li>  <b>FileInfo Service</b> - file path processing operations (getting the base file name, path to it, getting relative path, etc.) </li><li>  <b>General Services</b> - additional functions extending the functionality of processing strings, arrays, etc. </li><li>  <b>Process Service</b> - functions that allow you to run and manage external programs, as well as work with its input and output </li><li>  <b>PropertyList Service</b> - functions for working with property lists in JSON, XML, binaty and OpenStep formats for Darwin platforms (iOS, macOS, tvOS, and watchOS) </li><li>  <b>TemporaryDir Service</b> - functions for creating and managing a temporary directory </li><li>  <b>TextFile Service</b> - functions for working with text files and allowing to read / write from / to them. </li><li>  <b>Utilities Service</b> - functions for getting hashes </li></ul><br><h3>  Other properties of the element Rule </h3><br>  The Rule element also has several additional properties: <br><br>  The <b>multiplex</b> property, necessary to specify the order in which input artifacts are processed.  With multiplex = true, one copy of the rule is created for all input artifacts and they are processed all in a crowd.  Thus, the input property will contain all input artifacts.  It is used in cases when it is necessary to produce a group processing of input artifacts.  If multiplex = false, then for each input artifact a separate copy of the transformation rule will be created and its output artifact will be created.  Thus, the inputs property will always contain one element.  By default, this property is set to false. <br><br>  The <b>condition</b> property indicates the condition for the execution of the rule.  For example, specify that the conversion will be performed only in release mode and for the windows platform. <br><br><pre> <code class="javascript hljs"> qbs.buildVariant === <span class="hljs-string"><span class="hljs-string">"release"</span></span> &amp;&amp; qbs.targetOS.contains(<span class="hljs-string"><span class="hljs-string">"windows"</span></span>)</code> </pre> <br>  The <b>explicitlyDependsOn</b> property is a list of tags.  Each artifact, the tag of which coincides with the tag listed in this property, is assigned to each output artifact.  Thus, at the output, we can get output artifacts with already prepared dependencies for further processing. <br><br>  The <b>alwaysRun</b> property indicates the conditions for executing commands in a rule.  If alwaysRun = true, then commands will always be executed, even though the output artifacts are already updated.  The default is false. <br><br><h3>  Example of preparing a transformation rule </h3><br><br>  As an example of the rule I will give the following task: <br><br>  There is a project from several programs and libraries for which you need to copy all the libraries and plug-ins necessary for the operation of Qt programs to a given directory.  To do this, we create a module with a transformation rule and an independent product that will depend on all project products for which it is necessary to prepare Qt libraries.  Additionally, you need to prepare a test file with an indication of all Qt libraries prepared. <br><br><div class="spoiler">  <b class="spoiler_title">winDeployQt - deploy Qt libraries for the project</b> <div class="spoiler_text"><pre> <code class="javascript hljs">-- MyWindowsDeploy.qbs -- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qbs <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qbs.ModUtils Module { Rule { <span class="hljs-attr"><span class="hljs-attr">condition</span></span>: qbs.targetOS.contains(<span class="hljs-string"><span class="hljs-string">"windows"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   windows multiplex: true //      alwaysRun: true //   inputsFromDependencies: ["installable"] //       Artifact { filePath: "Copied_qt_libs.txt"; fileTags: ["deployQt"]; } prepare: { var cmdQt = new JavaScriptCommand(); //   windeployqt.exe cmdQt.windeployqt = FileInfo.joinPaths(product.moduleProperty("Qt.core", "binPath"), "windeployqt.exe"); //      cmdQt.description = "Copy Qt libs and generate text file: "+output.fileName; //      cmdQt.extendedDescription = cmdQt.windeployqt + ".exe " + ["--json"].concat(args).concat(binaryFilePaths).join(" "); //  ,    qt  ("&lt; &gt;/QtLibs") var deployDir = FileInfo.joinPaths(product.moduleProperty("qbs","installRoot"), product.moduleProperty("qbs","installDir")); deployDir = FileInfo.joinPaths(deployDir, "QtLibs"); cmdQt.qtLibsPath = deployDir; //    cmdQt.args = []; cmdQt.args.push("--libdir", deployDir); cmdQt.args.push("--plugindir", deployDir); cmdQt.args.push("--no-translations"); cmdQt.args.push("--release"); //     . cmdQt.outputFilePath = output.filePath; //      ,     cmdQt.binaryFilePaths = inputs.installable.filter(function (artifact) { return artifact.fileTags.contains("application") || artifact.fileTags.contains("dynamiclibrary"); }).map(function(a) { return ModUtils.artifactInstalledFilePath(a); }); cmdQt.sourceCode = function(){ var process; var tf; try { //   console.info("windeployqtRule: outputFilePath: "+outputFilePath); console.info("windeployqtRule: qtLibsPath: "+qtLibsPath); console.info("windeployqtRule: windeployqt: "+windeployqt); console.info("windeployqtRule: windeployqtArgs: "+windeployqtArgs.join(", ")); console.info("windeployqtRule: binaryFilePaths: "+binaryFilePaths.join(", ")); //      Qt File.makePath(qtLibsPath); //  process = new Process(); //  process.exec(windeployqt, ["--json"].concat(windeployqtArgs).concat(binaryFilePaths), true); //   var out = process.readStdOut(); //  JSON var inputFilePaths = JSON.parse(out)["files"].map(function (obj) { //      var fn = FileInfo.joinPaths( FileInfo.fromWindowsSeparators(obj.target), FileInfo.fileName( FileInfo.fromWindowsSeparators( obj.source))); return fn; }); //  tf = new TextFile(outputFilePath, TextFile.WriteOnly); //  tf.writeLine("Copied Qt files:"); inputFilePaths.forEach(function(qtLib){ tf.writeLine(qtLib); //         }); } finally { if (process) process.close(); if (tf) tf.close(); } } return [cmdQt]; } } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Product example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">-- ProductDeploy.qbs -- <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> qbs Product { <span class="hljs-comment"><span class="hljs-comment">//     Qt       //        type: ["deployQt"] //          Depends { name: "MyWindowsDeploy" } //    ,   //   Qt ,   . Depends { name: "libratyA" } Depends { name: "libratyB" } Depends { name: "applicationA" } Depends { name: "applicationB" } Depends { name: "applicationC" } condition: qbs.targetOS.contains("windows") //    windows builtByDefault: false //        qbs.install: true qbs.installDir: "MyProject/qtDeploy" }</span></span></code> </pre> <br></div></div><br><h3>  Links </h3><br><ul><li>  <a href="https://doc.qt.io/qbs/index.html">doc.qt.io/qbs/index.html</a> - official documentation </li><li>  <a href="https://habrahabr.ru/post/144127/">habrahabr.ru/post/144127</a> - acquaintance with Qbs </li><li>  <a href="https://www.opennet.ru/opennews/art.shtml%3Fnum%3D33102">www.opennet.ru/opennews/art.shtml?num=33102</a> - news about the Qbs presentation </li><li>  <a href="https://stackoverflow.com/questions/tagged/qbs">stackoverflow.com/questions/tagged/qbs</a> - question and answer on emerging issues </li><li>  <a href="https://github.com/qt-labs/qbs">github.com/qt-labs/qbs</a> - git repository </li></ul></div><p>Source: <a href="https://habr.com/ru/post/330218/">https://habr.com/ru/post/330218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330206/index.html">Creating a design ecosystem for dozens of related IT solutions: a word to designers</a></li>
<li><a href="../330208/index.html">Understanding the new architectural components in Android</a></li>
<li><a href="../330210/index.html">Deploying Redmine with Capistrano</a></li>
<li><a href="../330214/index.html">The universal function of creating objects on the example of the implementation of $ injector.instantiate in angularjs</a></li>
<li><a href="../330216/index.html">Results of half a day! Break voting on RIT ++ for 50 stickers. Day two</a></li>
<li><a href="../330220/index.html">The append (x) .append (y) call chain in StringBuilder is faster than typical sb.append (x); sb.append (y)</a></li>
<li><a href="../330222/index.html">"MDM vs CRM" or who will help sell more?</a></li>
<li><a href="../330224/index.html">‚ÄúThis is not about money and development‚Äù: 5 misconceptions about the work of the community manager</a></li>
<li><a href="../330226/index.html">Global DevOps Bootcamp + video compilation</a></li>
<li><a href="../330228/index.html">What are interactive systems, or something about elise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>