<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>After the previous post or About different methods of storing configs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This application simply must be configurable. 

 The news feed is not a feed if the admin panel does not allow you to specify how much news to display...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>After the previous post or About different methods of storing configs</h1><div class="post__text post__text-html js-mediator-article">  This application simply must be configurable. <br><br>  The news feed is not a feed if the admin panel does not allow you to specify how much news to display on the main one.  A blog is not a blog, but a dull blog, if it is impossible to fine-tune a million parameters - from the title, to the different color of comments from girls and boys. <br><br>  All these numerous settings, having gathered together, form a single whole - the configuration of your application, or, in other words - the config. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are two problems with the config - <br>  1. How and where to store it? <br>  2. How and where to get it? <br>  The relationship of these problems can be traced very clearly, so they can be reduced to one - ‚ÄúHow to store configs?‚Äù <br><a name="habracut"></a><br><h4>  Ini files </h4><br>  In PHP, there is a rich toolkit for working with ini-files, consisting of as many as two functions: parse_ini_file () and parse_ini_string (). <br><br>  Suppose that we have a config of 1000 variables.  For simplicity of the situation, we will assume that we do not select sections in the ini-file. <br><br>  For those who want to repeat the tests, here is an example of the simplest code for generating a test config file: <br> <code>$f = fopen("./test.ini", "w"); <br> for ( $i=1; $i&lt;=1000; $i++ ) <br> fwrite($f, "var_" . $i . " = \"" . md5(rand()) . "\"\n"); <br> fclose($f);</code> <br> <br>  Let's try to determine the time of access to an arbitrary variable from the config using a simple test code: <br> <code>function getConfigVar($num) { <br> <br> $config = parse_ini_file("./test.ini"); <br> return $config["var_" . $num]; <br> <br> } <br> <br> $start = microtime(); <br> <br> for ( $i=1; $i&lt;=1000; $i++ ) <br> $var = getConfigVar($i); <br> <br> $end = microtime(); <br> <br> list($usec, $sec) = explode(" ", $start); <br> $start = (float)$usec + (float)$sec; <br> <br> list($usec, $sec) = explode(" ", $end); <br> $end = (float)$usec + (float)$sec; <br> <br> echo $end - $start; <br></code> <br><br>  After taking measurements on a test server 10 times and rounding the result, I got <b>2.67 seconds</b> . <br><br><h4>  Serialized data in files </h4><br>  PHP offers us a special technology for storing arbitrary data of any kind in text files - serialization.  For it, there are two special functions - serialize () converts data of any type into a string, and unserialize (), respectively, restores data from a string. <br><br>  Create a test file with the following code: <br> <code>for ( $i=1; $i&lt;=1000; $i++ ) <br> $data["var_" . $i] = md5(rand()); <br> $f = fopen("./test.serial", "w"); <br> fwrite($f, serialize($data)); <br> fclose($f);</code> <br>  and accordingly change the getConfigVar function: <br> <code>function getConfigVar($num) { <br> <br> $config = unserialize(file_get_contents("./test.serial")); <br> return $config["var_" . $num]; <br> <br> } <br></code>  , leaving the rest of the code unchanged. <br><br>  After measuring 10 times and rounding the result, I got <b>1.48 seconds</b> .  Gain in time - almost 2 times! <br><br><h4>  Storage as Plain PHP </h4><br>  However, there is another way that was discussed in my previous topic.  Configs can be stored as code in PHP, and for access, use the include () construct. <br>  Let's see if it gives any performance gain. <br><br>  Code to create a test config file: <br> <code>$f = fopen("./test.conf", "w"); <br> fwrite($f, "&lt;?php\n"); <br> for ( $i=1; $i&lt;=1000; $i++ ) <br> fwrite($f, "\$config['var_" . $i . "'] = \"" . md5(rand()) . "\";\n"); <br> fwrite($f, "return \$config;\n?&gt;"); <br> fclose($f);</code> <br>  Pay attention to the last line of the file being created - ‚Äúreturn $ config;‚Äù. <br>  It would seem - why is the operator returning values ‚Äã‚Äãfrom a function?  The secret is that in PHP the include statement also, like the function, can return the value defined in the return statement of the included file.  This trick will allow us to do without global variables. <br><br>  Testing: <br> <code>function getConfigVar($num) { <br> <br> $config = include("./test.conf"); <br> return $config["var_" . $num]; <br> <br> }</code> <br> <br>  The result is unexpected - <b>5.21 seconds</b> .  I personally thought that this method would be the fastest, but the miracle did not happen ... <br><br><h4>  ... and if to cache? </h4><br><br>  And now let's try to take the slowest method and apply to it the simplest caching algorithm in memory.  The test function will look like this: <br> <code>function getConfigVar($num) { <br> <br> if ( !isset($GLOBALS['config_cache']) ) <br> $GLOBALS['config_cache'] = include("./test.conf"); <br> <br> return $GLOBALS['config_cache']["var_" . $num]; <br> <br> }</code> <br>  The result is striking - <b>0.054 seconds</b> ! <br><br>  For reference, the first method after applying caching showed a result of 0.052 seconds, the second - 0.051 seconds. <br><br>  I think that everyone will draw conclusions for himself. <br><br>  <i>The author is aware of some of the artificiality and tension of these tests.</i>  <i>And hopes that they will simply serve as a tool for warm-up the intelligence of novice programmers, but not as a direct guide to action.</i> <i><br><br></i>  <i>All examples given in the article are artificially invented and artificially simplified for a better understanding.</i> </div><p>Source: <a href="https://habr.com/ru/post/78976/">https://habr.com/ru/post/78976/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../78963/index.html">Promotion in social. networks: who's new?</a></li>
<li><a href="../78964/index.html">New iPhone 3GS = only tethered jailbreak</a></li>
<li><a href="../78968/index.html">Why does Opera need its own JS engine?</a></li>
<li><a href="../78971/index.html">Christmas modeling</a></li>
<li><a href="../78972/index.html">Poster "Systemman's garret"</a></li>
<li><a href="../78977/index.html">DatePicker: Date Picker</a></li>
<li><a href="../78978/index.html">Maths. What is it really? Reflections</a></li>
<li><a href="../78979/index.html">MTS and M.B.A. Finance "against customers</a></li>
<li><a href="../78981/index.html">Plenoptic camera of 12 kenons</a></li>
<li><a href="../78983/index.html">Opera 10.50 pre-alpha for Labs, official description</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>